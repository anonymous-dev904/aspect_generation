{"contents": ["GEODE-3974:", "revert", "a", "change", "to", "log", "the", "exception", "in", "the", "server", "logs", "(#1444)"], "code_tokens": ["@", "@", "-", "215", ",", "9", "+", "215", ",", "10", "@", "@", "protected", "void", "process", "(", "final", "ClusterDistributionManager", "dm", ")", "{", "rex", "=", "new", "ReplyException", "(", "thr", ")", ";", "replyWithException", "(", "dm", ",", "rex", ")", ";", "}", "catch", "(", "Exception", "exception", ")", "{", "logger", ".", "error", "(", "\"", "Exception", "occurred", "on", "remote", "member", "while", "executing", "Function", ":", "{", "}\"", ",", "this", ".", "functionObject", ".", "getId", "(", "),", "exception", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Exception", "occurred", "on", "remote", "member", "while", "executing", "Function", ":", "{", "}\"", ",", "this", ".", "functionObject", ".", "getId", "(", "),", "exception", ")", ";", "}", "stats", ".", "endFunctionExecutionWithException", "(", "this", ".", "functionObject", ".", "hasResult", "(", "))", ";", "rex", "=", "new", "ReplyException", "(", "exception", ")", ";", "replyWithException", "(", "dm", ",", "rex", ")", ";"], "docstring_tokens": ["Code", "deployment", "should", "be", "restricted", "to", "users", "with", "DATA:MANAGE", "privilege"]}
{"contents": ["Improve", "user", "validation", "and", "lookup.", "[#168742757]"], "code_tokens": ["@", "@", "-", "27", ",", "14", "+", "27", ",", "15", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "context", ".", "request", ".", "RequestContextHolder", ";", "import", "org", ".", "springframework", ".", "web", ".", "context", ".", "request", ".", "ServletRequestAttributes", ";", "import", "javax", ".", "mail", ".", "internet", ".", "AddressException", ";", "import", "javax", ".", "mail", ".", "internet", ".", "InternetAddress", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "sql", ".", "Timestamp", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCodeType", ".", "INVITATION", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ".", "ORIGIN", ";", "@", "@", "-", "51", ",", "7", "+", "52", ",", "6", "@", "@", "private", "static", "final", "int", "INVITATION_EXPIRY_DAYS", "=", "7", ";", "public", "static", "final", "String", "USER_ID", "=", "\"", "user_id", "\"", ";", "public", "static", "final", "String", "EMAIL", "=", "\"", "email", "\"", ";", "private", "static", "final", "Pattern", "emailPattern", "=", "Pattern", ".", "compile", "(", "\"^", "(.", "+)", "@(", ".+", ")\\", "\\.", "(.", "+)", "$\"", ");", "private", "final", "ScimUserProvisioning", "scimUserProvisioning", ";", "private", "final", "IdentityProviderProvisioning", "identityProviderProvisioning", ";", "@", "@", "-", "98", ",", "7", "+", "98", ",", "7", "@", "@", "public", "InvitationsEndpoint", "(", "final", "ScimUserProvisioning", "scimUserProvisioning", ",", "for", "(", "String", "email", ":", "invitations", ".", "getEmails", "(", "))", "{", "try", "{", "if", "(", "email", "!", "=", "null", "&", "&", "emailPattern", ".", "matcher", "(", "email", ")", ".", "matches", "(", "))", "{", "if", "(", "email", "!", "=", "null", "&", "&", "validateEmail", "(", "email", ")", ")", "{", "List", "<", "IdentityProvider", ">", "providers", "=", "filter", "(", "activeProviders", ",", "client", ",", "email", ")", ";", "if", "(", "providers", ".", "size", "(", ")", "=", "=", "1", ")", "{", "ScimUser", "user", "=", "findOrCreateUser", "(", "email", ",", "providers", ".", "get", "(", "0", ")", ".", "getOriginKey", "(", "))", ";", "@", "@", "-", "140", ",", "7", "+", "140", ",", "7", "@", "@", "public", "InvitationsEndpoint", "(", "final", "ScimUserProvisioning", "scimUserProvisioning", ",", "private", "ScimUser", "findOrCreateUser", "(", "String", "email", ",", "String", "origin", ")", "{", "email", "=", "email", ".", "trim", "(", ").", "toLowerCase", "(", ");", "List", "<", "ScimUser", ">", "results", "=", "scimUserProvisioning", ".", "query", "(", "String", ".", "format", "(", "\"", "email", "eq", "\\", "\"%", "s", "\\", "\"", "and", "origin", "eq", "\\", "\"%", "s", "\\", "\"\"", ",", "email", ",", "origin", ")", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "List", "<", "ScimUser", ">", "results", "=", "scimUserProvisioning", ".", "retrieveByEmailAndZone", "(", "email", ",", "origin", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "if", "(", "results", "=", "=", "null", "|", "|", "results", ".", "size", "(", ")", "=", "=", "0", ")", "{", "ScimUser", "user", "=", "new", "ScimUser", "(", "null", ",", "email", ",", "\"", "\",", "\"", "\")", ";", "user", ".", "setPrimaryEmail", "(", "email", ".", "toLowerCase", "(", "))", ";", "@", "@", "-", "155", ",", "4", "+", "155", ",", "14", "@", "@", "private", "ScimUser", "findOrCreateUser", "(", "String", "email", ",", "String", "origin", ")", "{", "}", "}", "private", "boolean", "validateEmail", "(", "String", "email", ")", "{", "boolean", "valid", "=", "true", ";", "try", "{", "InternetAddress", "emailAddr", "=", "new", "InternetAddress", "(", "email", ")", ";", "emailAddr", ".", "validate", "(", ");", "}", "catch", "(", "AddressException", "e", ")", "{", "valid", "=", "false", ";", "}", "return", "valid", ";", "}", "}", "@", "@", "-", "18", ",", "10", "+", "18", ",", "13", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "InvalidScimResourceException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimResourceNotFoundException", ";", "import", "java", ".", "util", ".", "List", ";", "public", "interface", "ScimUserProvisioning", "extends", "ResourceManager", "<", "ScimUser", ">", ",", "Queryable", "<", "ScimUser", ">", "{", "ScimUser", "createUser", "(", "ScimUser", "user", ",", "String", "password", ",", "String", "zoneId", ")", "throws", "InvalidPasswordException", ",", "InvalidScimResourceException", ";", "List", "<", "ScimUser", ">", "retrieveByEmailAndZone", "(", "String", "email", ",", "String", "origin", ",", "String", "zoneId", ")", ";", "void", "changePassword", "(", "String", "id", ",", "String", "oldPassword", ",", "String", "newPassword", ",", "String", "zoneId", ")", "throws", "ScimResourceNotFoundException", ";", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "public", "Logger", "getLogger", "(", ")", "{", "public", "static", "final", "String", "READ_PASSWORD_CHANGE_REQUIRED_SQL", "=", "\"", "select", "passwd_change_required", "from", "users", "where", "id", "=", "?", "and", "identity_zone_id", "=", "?\"", ";", "public", "static", "final", "String", "USER_BY_ID_QUERY", "=", "\"", "select", "\"", "+", "USER_FIELDS", "+", "\"", "from", "users", "\"", "+", "\"", "where", "id", "=", "?", "and", "identity_zone_id", "=", "?\"", ";", "public", "static", "final", "String", "USER_BY_EMAIL_QUERY", "=", "\"", "select", "\"", "+", "USER_FIELDS", "+", "\"", "from", "users", "\"", "+", "\"", "where", "email", "=", "?", "and", "origin", "=", "?", "and", "identity_zone_id", "=", "?\"", ";", "public", "static", "final", "String", "ALL_USERS", "=", "\"", "select", "\"", "+", "USER_FIELDS", "+", "\"", "from", "users", "\"", ";", "@", "@", "-", "140", ",", "6", "+", "141", ",", "15", "@", "@", "public", "ScimUser", "retrieve", "(", "String", "id", ",", "String", "zoneId", ")", "{", "}", "}", "@", "Override", "public", "List", "<", "ScimUser", ">", "retrieveByEmailAndZone", "(", "String", "email", ",", "String", "origin", ",", "String", "zoneId", ")", "{", "try", "{", "return", "jdbcTemplate", ".", "query", "(", "USER_BY_EMAIL_QUERY", ",", "mapper", ",", "email", ",", "origin", ",", "zoneId", ")", ";", "}", "catch", "(", "EmptyResultDataAccessException", "e", ")", "{", "throw", "new", "ScimResourceNotFoundException", "(", "\"", "User", "with", "email", "\"", "+", "email", "+", "\"", "does", "not", "exist", "\"", ");", "}", "}", "@", "Override", "protected", "String", "getBaseSqlQuery", "(", ")", "{", "return", "ALL_USERS", ";", "@", "@", "-", "74", ",", "11", "+", "74", ",", "13", "@", "@", "@", "Autowired", "private", "JdbcTemplate", "jdbcTemplate", ";", "private", "String", "joeEmail", ";", "@", "BeforeEach", "void", "setUp", "(", "@", "Autowired", "LimitSqlAdapter", "limitSqlAdapter", ")", "{", "generator", "=", "new", "RandomValueStringGenerator", "(", ");", "joeId", "=", "\"", "joeId", "-", "\"", "+", "UUID", ".", "randomUUID", "(", ").", "toString", "(", ").", "substring", "(", "\"", "joeId", "-", "\".", "length", "(", "))", ";", "joeEmail", "=", "\"", "joe", "@", "joe", ".", "com", "\"", ";", "String", "mabelId", "=", "\"", "mabelId", "-", "\"", "+", "UUID", ".", "randomUUID", "(", ").", "toString", "(", ").", "substring", "(", "\"", "mabelId", "-", "\".", "length", "(", "))", ";", "pagingListFactory", "=", "new", "JdbcPagingListFactory", "(", "jdbcTemplate", ",", "limitSqlAdapter", ")", ";", "@", "@", "-", "94", ",", "7", "+", "96", ",", "7", "@", "@", "void", "setUp", "(", "@", "Autowired", "LimitSqlAdapter", "limitSqlAdapter", ")", "{", "filterConverter", ".", "setAttributeNameMapper", "(", "new", "SimpleAttributeNameMapper", "(", "replaceWith", ")", ");", "jdbcScimUserProvisioning", ".", "setQueryConverter", "(", "filterConverter", ")", ";", "addUser", "(", "jdbcTemplate", ",", "joeId", ",", "\"", "joe", "\"", ",", "passwordEncoder", ".", "encode", "(", "\"", "joespassword", "\"", "),", "\"", "joe", "@", "joe", ".", "com", "\"", ",", "\"", "Joe", "\"", ",", "\"", "User", "\"", ",", "\"", "+", "1", "-", "222", "-", "1234567", "\"", ",", "currentIdentityZoneId", ")", ";", "addUser", "(", "jdbcTemplate", ",", "joeId", ",", "\"", "joe", "\"", ",", "passwordEncoder", ".", "encode", "(", "\"", "joespassword", "\"", "),", "joeEmail", ",", "\"", "Joe", "\"", ",", "\"", "User", "\"", ",", "\"", "+", "1", "-", "222", "-", "1234567", "\"", ",", "currentIdentityZoneId", ")", ";", "addUser", "(", "jdbcTemplate", ",", "mabelId", ",", "\"", "mabel", "\"", ",", "passwordEncoder", ".", "encode", "(", "\"", "mabelspassword", "\"", "),", "\"", "mabel", "@", "mabel", ".", "com", "\"", ",", "\"", "Mabel", "\"", ",", "\"", "User", "\"", ",", "\"", "\",", "currentIdentityZoneId", ")", ";", "}", "@", "@", "-", "103", ",", "6", "+", "105", ",", "33", "@", "@", "void", "tearDown", "(", ")", "{", "jdbcTemplate", ".", "execute", "(", "\"", "delete", "from", "users", "\"", ");", "}", "@", "WithDatabaseContext", "@", "Nested", "class", "WhenFindingByEmailAndZone", "{", "@", "Test", "void", "canRetrieveExistingUser", "(", ")", "{", "List", "<", "ScimUser", ">", "found", "=", "jdbcScimUserProvisioning", ".", "retrieveByEmailAndZone", "(", "joeEmail", ",", "UAA", ",", "currentIdentityZoneId", ")", ";", "assertEquals", "(", "1", ",", "found", ".", "size", "(", "))", ";", "ScimUser", "joe", "=", "found", ".", "get", "(", "0", ")", ";", "assertNotNull", "(", "joe", ")", ";", "assertEquals", "(", "joeId", ",", "joe", ".", "getId", "(", "))", ";", "assertEquals", "(", "\"", "Joe", "\"", ",", "joe", ".", "getGivenName", "(", "))", ";", "assertEquals", "(", "\"", "User", "\"", ",", "joe", ".", "getFamilyName", "(", "))", ";", "assertEquals", "(", "\"", "joe", "@", "joe", ".", "com", "\"", ",", "joe", ".", "getPrimaryEmail", "(", "))", ";", "assertEquals", "(", "\"", "joe", "\"", ",", "joe", ".", "getUserName", "(", "))", ";", "assertEquals", "(", "\"+", "1", "-", "222", "-", "1234567", "\"", ",", "joe", ".", "getPhoneNumbers", "(", ").", "get", "(", "0", ")", ".", "getValue", "(", "))", ";", "assertNull", "(", "joe", ".", "getGroups", "(", "))", ";", "}", "@", "Test", "void", "cannotRetrieveNonexistentUser", "(", ")", "{", "List", "<", "ScimUser", ">", "found", "=", "jdbcScimUserProvisioning", ".", "retrieveByEmailAndZone", "(", "\"", "unknown", "@", "example", ".", "com", "\"", ",", "UAA", ",", "currentIdentityZoneId", ")", ";", "assertEquals", "(", "0", ",", "found", ".", "size", "(", "))", ";", "}", "}", "@", "Test", "void", "canCreateUserWithExclamationMarkInUsername", "(", ")", "{", "String", "userName", "=", "\"", "jo", "!", "!@", "foo", ".", "com", "\"", ";", "@", "@", "-", "378", ",", "10", "+", "378", ",", "10", "@", "@", "void", "inviteUserWithInvalidEmails", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "email", ".", "invalid", "\"", ",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "0", ")", ".", "getErrorCode", "(", "))", ";", "assertEquals", "(", "\"", "email", ".", "invalid", "\"", ",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "1", ")", ".", "getErrorCode", "(", "))", ";", "assertEquals", "(", "\"", "email", ".", "invalid", "\"", ",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "2", ")", ".", "getErrorCode", "(", "))", ";", "assertEquals", "(", "\"", "provider", ".", "non", "-", "existent", "\"", ",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "2", ")", ".", "getErrorCode", "(", "))", ";", "assertEquals", "(", "invalidEmail1", "+", "\"", "is", "invalid", "email", ".", "\",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "0", ")", ".", "getErrorMessage", "(", "))", ";", "assertEquals", "(", "invalidEmail2", "+", "\"", "is", "invalid", "email", ".", "\",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "1", ")", ".", "getErrorMessage", "(", "))", ";", "assertEquals", "(", "invalidEmail3", "+", "\"", "is", "invalid", "email", ".", "\",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "2", ")", ".", "getErrorMessage", "(", "))", ";", "assertEquals", "(", "\"", "No", "authentication", "provider", "found", ".", "\",", "response", ".", "getFailedInvites", "(", ").", "get", "(", "2", ")", ".", "getErrorMessage", "(", "))", ";", "}", "@", "Test"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["MYFACES-3405", "includeViewParameters", "re-evaluates", "param/model", "values", "as", "EL", "expressions", "git-svn-id:", "https://svn.apache.org/repos/asf/myfaces/core/trunk@1205204", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "138", ",", "8", "+", "138", ",", "8", "@", "@", "public", "URL", "getBookmarkableURL", "(", "FacesContext", "context", ")", "throws", "MalformedURLException", "return", "new", "URL", "(", "externalContext", ".", "getRequestScheme", "(", "),", "externalContext", ".", "getRequestServerName", "(", "),", "externalContext", ".", "getRequestServerPort", "(", "),", "context", ".", "getApplication", "(", ").", "getViewHandler", "(", ").", "getBookmarkableURL", "(", "context", ",", "getToViewId", "(", "context", ")", ",", "getParameters", "(", "),", "isIncludeViewParams", "(", "))", ");", "context", ".", "getApplication", "(", ").", "getViewHandler", "(", ").", "getBookmarkableURL", "(", "context", ",", "getToViewId", "(", "context", ")", ",", "_NavigationUtils", ".", "getEvaluatedNavigationParameters", "(", "getParameters", "(", "))", ",", "isIncludeViewParams", "(", "))", ");", "}", "public", "URL", "getResourceURL", "(", "FacesContext", "context", ")", "throws", "MalformedURLException", "@", "@", "-", "156", ",", "8", "+", "156", ",", "8", "@", "@", "public", "URL", "getRedirectURL", "(", "FacesContext", "context", ")", "throws", "MalformedURLException", "return", "new", "URL", "(", "externalContext", ".", "getRequestScheme", "(", "),", "externalContext", ".", "getRequestServerName", "(", "),", "externalContext", ".", "getRequestServerPort", "(", "),", "context", ".", "getApplication", "(", ").", "getViewHandler", "(", ").", "getRedirectURL", "(", "context", ",", "getToViewId", "(", "context", ")", ",", "getParameters", "(", "),", "isIncludeViewParams", "(", "))", ");", "context", ".", "getApplication", "(", ").", "getViewHandler", "(", ").", "getRedirectURL", "(", "context", ",", "getToViewId", "(", "context", ")", ",", "_NavigationUtils", ".", "getEvaluatedNavigationParameters", "(", "getParameters", "(", "))", ",", "isIncludeViewParams", "(", "))", ");", "}", "public", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "getParameters", "(", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "107", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "javax", ".", "faces", ".", "application", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "faces", ".", "context", ".", "FacesContext", ";", "/", "**", "*", "*", "@", "author", "Leonardo", "Uribe", "*", "*", "/", "class", "_NavigationUtils", "{", "/", "**", "*", "Evaluate", "all", "EL", "expressions", "found", "as", "parameters", "and", "return", "a", "map", "that", "can", "be", "used", "for", "*", "redirect", "or", "render", "bookmark", "links", "*", "*", "@", "param", "parameters", "parameter", "map", "retrieved", "from", "NavigationCase", ".", "getParameters", "(", ")", "*", "@", "return", "*", "/", "public", "static", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "getEvaluatedNavigationParameters", "(", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "parameters", ")", "{", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "evaluatedParameters", "=", "null", ";", "if", "(", "parameters", "!", "=", "null", "&", "&", "parameters", ".", "size", "(", ")", ">", "0", ")", "{", "evaluatedParameters", "=", "new", "HashMap", "<", "String", ",", "List", "<", "String", ">", ">(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "List", "<", "String", ">", ">", "pair", ":", "parameters", ".", "entrySet", "(", "))", "{", "boolean", "containsEL", "=", "false", ";", "for", "(", "String", "value", ":", "pair", ".", "getValue", "(", "))", "{", "if", "(", "_isExpression", "(", "value", ")", ")", "{", "containsEL", "=", "true", ";", "break", ";", "}", "}", "if", "(", "containsEL", ")", "{", "evaluatedParameters", ".", "put", "(", "pair", ".", "getKey", "(", "),", "_evaluateValueExpressions", "(", "pair", ".", "getValue", "(", "))", ");", "}", "else", "{", "evaluatedParameters", ".", "put", "(", "pair", ".", "getKey", "(", "),", "pair", ".", "getValue", "(", "))", ";", "}", "}", "}", "else", "{", "evaluatedParameters", "=", "parameters", ";", "}", "return", "evaluatedParameters", ";", "}", "/", "**", "*", "Checks", "the", "Strings", "in", "the", "List", "for", "EL", "expressions", "and", "evaluates", "them", ".", "*", "Note", "that", "the", "returned", "List", "will", "be", "a", "copy", "of", "the", "given", "List", ",", "because", "*", "otherwise", "it", "will", "have", "unwanted", "side", "-", "effects", ".", "*", "@", "param", "values", "*", "@", "return", "*", "/", "private", "static", "List", "<", "String", ">", "_evaluateValueExpressions", "(", "List", "<", "String", ">", "values", ")", "{", "/", "/", "note", "that", "we", "have", "to", "create", "a", "new", "List", "here", ",", "because", "if", "we", "/", "/", "change", "any", "value", "on", "the", "given", "List", ",", "it", "will", "be", "changed", "in", "the", "/", "/", "NavigationCase", "too", "and", "the", "EL", "expression", "won", "'", "t", "be", "evaluated", "again", "List", "<", "String", ">", "target", "=", "new", "ArrayList", "<", "String", ">", "(", "values", ".", "size", "(", "))", ";", "FacesContext", "context", "=", "FacesContext", ".", "getCurrentInstance", "(", ");", "for", "(", "String", "value", ":", "values", ")", "{", "if", "(", "_isExpression", "(", "value", ")", ")", "{", "/", "/", "evaluate", "the", "ValueExpression", "value", "=", "context", ".", "getApplication", "(", ").", "evaluateExpressionGet", "(", "context", ",", "value", ",", "String", ".", "class", ")", ";", "}", "target", ".", "add", "(", "value", ")", ";", "}", "return", "target", ";", "}", "private", "static", "boolean", "_isExpression", "(", "String", "text", ")", "{", "return", "text", ".", "indexOf", "(", "\"#", "{\"", ")", "!", "=", "-", "1", ";", "}", "}", "@", "@", "-", "50", ",", "6", "+", "50", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "myfaces", ".", "config", ".", "RuntimeConfig", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "config", ".", "element", ".", "NavigationRule", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "application", ".", "NavigationUtils", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "util", ".", "HashMapUtils", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "view", ".", "facelets", ".", "tag", ".", "jsf", ".", "PreDisposeViewEvent", ";", "@", "@", "-", "104", ",", "8", "+", "105", ",", "12", "@", "@", "public", "void", "handleNavigation", "(", "FacesContext", "facesContext", ",", "String", "fromAction", ",", "Strin", "ExternalContext", "externalContext", "=", "facesContext", ".", "getExternalContext", "(", ");", "ViewHandler", "viewHandler", "=", "facesContext", ".", "getApplication", "(", ").", "getViewHandler", "(", ");", "String", "toViewId", "=", "navigationCase", ".", "getToViewId", "(", "facesContext", ")", ";", "String", "redirectPath", "=", "viewHandler", ".", "getRedirectURL", "(", "facesContext", ",", "toViewId", ",", "navigationCase", ".", "getParameters", "(", "),", "navigationCase", ".", "isIncludeViewParams", "(", "))", ";", "String", "redirectPath", "=", "viewHandler", ".", "getRedirectURL", "(", "facesContext", ",", "toViewId", ",", "NavigationUtils", ".", "getEvaluatedNavigationParameters", "(", "navigationCase", ".", "getParameters", "(", "))", ",", "navigationCase", ".", "isIncludeViewParams", "(", "))", ";", "/", "/", "Clear", "ViewMap", "if", "we", "are", "redirecting", "to", "other", "resource", "UIViewRoot", "viewRoot", "=", "facesContext", ".", "getViewRoot", "(", ");", "@", "@", "-", "768", ",", "7", "+", "768", ",", "7", "@", "@", "private", "String", "encodeURL", "(", "String", "baseUrl", ",", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "parameters", ")", "{", "if", "(", "pair", ".", "getKey", "(", ")", "!", "=", "null", "&", "&", "pair", ".", "getKey", "(", ").", "trim", "(", ").", "length", "(", ")", "!", "=", "0", ")", "{", "paramMap", ".", "put", "(", "pair", ".", "getKey", "(", "),", "_evaluateValueExpressions", "(", "pair", ".", "getValue", "(", "))", ");", "paramMap", ".", "put", "(", "pair", ".", "getKey", "(", "),", "pair", ".", "getValue", "(", "))", ";", "}", "}", "}", "@", "@", "-", "819", ",", "37", "+", "819", ",", "6", "@", "@", "private", "String", "encodeURL", "(", "String", "baseUrl", ",", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "parameters", ")", "return", "newUrl", ".", "toString", "(", ");", "}", "/", "**", "*", "Checks", "the", "Strings", "in", "the", "List", "for", "EL", "expressions", "and", "evaluates", "them", ".", "*", "Note", "that", "the", "returned", "List", "will", "be", "a", "copy", "of", "the", "given", "List", ",", "because", "*", "otherwise", "it", "will", "have", "unwanted", "side", "-", "effects", ".", "*", "@", "param", "values", "*", "@", "return", "*", "/", "private", "List", "<", "String", ">", "_evaluateValueExpressions", "(", "List", "<", "String", ">", "values", ")", "{", "/", "/", "note", "that", "we", "have", "to", "create", "a", "new", "List", "here", ",", "because", "if", "we", "/", "/", "change", "any", "value", "on", "the", "given", "List", ",", "it", "will", "be", "changed", "in", "the", "/", "/", "NavigationCase", "too", "and", "the", "EL", "expression", "won", "'", "t", "be", "evaluated", "again", "List", "<", "String", ">", "target", "=", "new", "ArrayList", "<", "String", ">", "(", "values", ".", "size", "(", "))", ";", "FacesContext", "context", "=", "FacesContext", ".", "getCurrentInstance", "(", ");", "for", "(", "String", "value", ":", "values", ")", "{", "if", "(", "_isExpression", "(", "value", ")", ")", "{", "/", "/", "evaluate", "the", "ValueExpression", "value", "=", "context", ".", "getApplication", "(", ").", "evaluateExpressionGet", "(", "context", ",", "value", ",", "String", ".", "class", ")", ";", "}", "target", ".", "add", "(", "value", ")", ";", "}", "return", "target", ";", "}", "private", "boolean", "_isExpression", "(", "String", "text", ")", "{", "return", "text", ".", "indexOf", "(", "\"#", "{\"", ")", "!", "=", "-", "1", ";", "}", "/", "**", "*", "@", "since", "2", ".", "0", "*", "/", "@", "@", "-", "65", ",", "6", "+", "65", ",", "7", "@", "@", "public", "void", "tearDown", "(", ")", "throws", "Exception", "*", "Tests", "if", "encodeRedirectURL", "(", ")", "and", "encodeBookmarkableURL", "(", ")", "correctly", "*", "evaluate", "ValueExpressions", "as", "parameters", "values", ".", "*", "/", "/", "*", "TODO", ":", "Invalid", "test", ",", "because", "EL", "evaluation", "should", "be", "done", "before", "call", "these", "methods", ".", "@", "Test", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "void", "testEncodeURLHandlesValueExpressionParameters", "(", ")", "@", "@", "-", "94", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "testEncodeURLHandlesValueExpressionParameters", "(", ")", "Assert", ".", "assertTrue", "(", "bookmarkableUrl", ".", "contains", "(", "\"", "param1", "=", "literalvalue", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "bookmarkableUrl", ".", "contains", "(", "\"", "param1", "=", "myvalue1", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "bookmarkableUrl", ".", "contains", "(", "\"", "param2", "=", "myvalue2", "\"", "))", ";", "}", "}", "*/", "@", "Test", "public", "void", "testEncodeRedirectUrlWithEmptyParamInBaseUrl", "(", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "107", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "application", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "faces", ".", "context", ".", "FacesContext", ";", "/", "**", "*", "*", "@", "author", "Leonardo", "Uribe", "*", "*", "/", "public", "class", "NavigationUtils", "{", "/", "**", "*", "Evaluate", "all", "EL", "expressions", "found", "as", "parameters", "and", "return", "a", "map", "that", "can", "be", "used", "for", "*", "redirect", "or", "render", "bookmark", "links", "*", "*", "@", "param", "parameters", "parameter", "map", "retrieved", "from", "NavigationCase", ".", "getParameters", "(", ")", "*", "@", "return", "*", "/", "public", "static", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "getEvaluatedNavigationParameters", "(", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "parameters", ")", "{", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "evaluatedParameters", "=", "null", ";", "if", "(", "parameters", "!", "=", "null", "&", "&", "parameters", ".", "size", "(", ")", ">", "0", ")", "{", "evaluatedParameters", "=", "new", "HashMap", "<", "String", ",", "List", "<", "String", ">", ">(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "List", "<", "String", ">", ">", "pair", ":", "parameters", ".", "entrySet", "(", "))", "{", "boolean", "containsEL", "=", "false", ";", "for", "(", "String", "value", ":", "pair", ".", "getValue", "(", "))", "{", "if", "(", "_isExpression", "(", "value", ")", ")", "{", "containsEL", "=", "true", ";", "break", ";", "}", "}", "if", "(", "containsEL", ")", "{", "evaluatedParameters", ".", "put", "(", "pair", ".", "getKey", "(", "),", "_evaluateValueExpressions", "(", "pair", ".", "getValue", "(", "))", ");", "}", "else", "{", "evaluatedParameters", ".", "put", "(", "pair", ".", "getKey", "(", "),", "pair", ".", "getValue", "(", "))", ";", "}", "}", "}", "else", "{", "evaluatedParameters", "=", "parameters", ";", "}", "return", "evaluatedParameters", ";", "}", "/", "**", "*", "Checks", "the", "Strings", "in", "the", "List", "for", "EL", "expressions", "and", "evaluates", "them", ".", "*", "Note", "that", "the", "returned", "List", "will", "be", "a", "copy", "of", "the", "given", "List", ",", "because", "*", "otherwise", "it", "will", "have", "unwanted", "side", "-", "effects", ".", "*", "@", "param", "values", "*", "@", "return", "*", "/", "private", "static", "List", "<", "String", ">", "_evaluateValueExpressions", "(", "List", "<", "String", ">", "values", ")", "{", "/", "/", "note", "that", "we", "have", "to", "create", "a", "new", "List", "here", ",", "because", "if", "we", "/", "/", "change", "any", "value", "on", "the", "given", "List", ",", "it", "will", "be", "changed", "in", "the", "/", "/", "NavigationCase", "too", "and", "the", "EL", "expression", "won", "'", "t", "be", "evaluated", "again", "List", "<", "String", ">", "target", "=", "new", "ArrayList", "<", "String", ">", "(", "values", ".", "size", "(", "))", ";", "FacesContext", "context", "=", "FacesContext", ".", "getCurrentInstance", "(", ");", "for", "(", "String", "value", ":", "values", ")", "{", "if", "(", "_isExpression", "(", "value", ")", ")", "{", "/", "/", "evaluate", "the", "ValueExpression", "value", "=", "context", ".", "getApplication", "(", ").", "evaluateExpressionGet", "(", "context", ",", "value", ",", "String", ".", "class", ")", ";", "}", "target", ".", "add", "(", "value", ")", ";", "}", "return", "target", ";", "}", "private", "static", "boolean", "_isExpression", "(", "String", "text", ")", "{", "return", "text", ".", "indexOf", "(", "\"#", "{\"", ")", "!", "=", "-", "1", ";", "}", "}", "@", "@", "-", "63", ",", "6", "+", "63", ",", "7", "@", "@", "import", "javax", ".", "faces", ".", "model", ".", "SelectItem", ";", "import", "javax", ".", "faces", ".", "model", ".", "SelectItemGroup", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "application", ".", "NavigationUtils", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "component", ".", "DisplayValueOnlyCapable", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "component", ".", "EscapeCapable", ";", "import", "org", ".", "apache", ".", "myfaces", ".", "shared", ".", "config", ".", "MyfacesConfig", ";", "@", "@", "-", "1589", ",", "8", "+", "1590", ",", "8", "@", "@", "public", "static", "String", "getOutcomeTargetHref", "(", "FacesContext", "facesContext", ",", "}", "}", "/", "/", "handle", "NavigationCase", "parameters", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "navigationCaseParams", "=", "navigationCase", ".", "getParameters", "(", ");", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "navigationCaseParams", "=", "NavigationUtils", ".", "getEvaluatedNavigationParameters", "(", "navigationCase", ".", "getParameters", "(", "))", ";", "if", "(", "navigationCaseParams", "!", "=", "null", ")", "{", "if", "(", "parameters", "=", "=", "null", ")"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["AMQP-830", "Enable", "Hostname", "Verification", "JIRA:", "https://jira.spring.io/browse/AMQP-830", "*", "Fix", "typos", "and", "non-relevant", "sentences"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "16", ",", "18", "+", "16", ",", "19", "@", "@", "package", "org", ".", "springframework", ".", "amqp", ".", "rabbit", ".", "connection", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "security", ".", "KeyManagementException", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "java", ".", "security", ".", "KeyStoreException", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutorService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ThreadFactory", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "javax", ".", "net", ".", "SocketFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManager", ";", "@", "@", "-", "42", ",", "6", "+", "43", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "config", ".", "AbstractFactoryBean", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "support", ".", "PathMatchingResourcePatternResolver", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ".", "MethodCallback", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ".", "MethodFilter", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "com", ".", "rabbitmq", ".", "client", ".", "ConnectionFactory", ";", "@", "@", "-", "56", ",", "7", "+", "61", ",", "7", "@", "@", "*", "setter", "methods", "and", "optionally", "enabling", "SSL", ",", "with", "or", "without", "*", "certificate", "validation", ".", "When", "{", "@", "link", "#", "setSslPropertiesLocation", "(", "Resource", ")", "sslPropertiesLocation", "}", "*", "is", "not", "null", ",", "the", "default", "implementation", "loads", "a", "{", "@", "code", "PKCS12", "}", "keystore", "and", "a", "*", "{", "@", "code", "JKS", "}", "truststore", "using", "the", "supplied", "properties", "and", "intializes", "{", "@", "code", "SunX509", "}", "key", "*", "{", "@", "code", "JKS", "}", "truststore", "using", "the", "supplied", "properties", "and", "initializes", "{", "@", "code", "SunX509", "}", "key", "*", "and", "trust", "manager", "factories", ".", "These", "are", "then", "used", "to", "initialize", "an", "{", "@", "link", "SSLContext", "}", "*", "using", "the", "{", "@", "link", "#", "setSslAlgorithm", "(", "String", ")", "sslAlgorithm", "}", "(", "default", "TLSv1", ".", "1", ")", ".", "*", "<", "p", ">", "@", "@", "-", "75", ",", "6", "+", "80", ",", "19", "@", "@", "*", "/", "public", "class", "RabbitConnectionFactoryBean", "extends", "AbstractFactoryBean", "<", "ConnectionFactory", ">", "{", "private", "static", "final", "Method", "enableHostnameVerificationNoArgMethod", ";", "static", "{", "final", "AtomicReference", "<", "Method", ">", "method1", "=", "new", "AtomicReference", "<", ">(", ");", "ReflectionUtils", ".", "doWithMethods", "(", "ConnectionFactory", ".", "class", ",", "m", "-", ">", "{", "if", "(", "m", ".", "getParameterTypes", "(", ").", "length", "=", "=", "0", ")", "{", "method1", ".", "set", "(", "m", ")", ";", "}", "}", ",", "m", "-", ">", "m", ".", "getName", "(", ").", "equals", "(", "\"", "enableHostnameVerification", "\"", "))", ";", "enableHostnameVerificationNoArgMethod", "=", "method1", ".", "get", "(", ");", "}", "private", "final", "Log", "logger", "=", "LogFactory", ".", "getLog", "(", "getClass", "(", "))", ";", "private", "static", "final", "String", "KEY_STORE", "=", "\"", "keyStore", "\"", ";", "@", "@", "-", "103", ",", "30", "+", "121", ",", "32", "@", "@", "private", "Resource", "sslPropertiesLocation", ";", "private", "volatile", "String", "keyStore", ";", "private", "String", "keyStore", ";", "private", "volatile", "String", "trustStore", ";", "private", "String", "trustStore", ";", "private", "volatile", "Resource", "keyStoreResource", ";", "private", "Resource", "keyStoreResource", ";", "private", "volatile", "Resource", "trustStoreResource", ";", "private", "Resource", "trustStoreResource", ";", "private", "volatile", "String", "keyStorePassphrase", ";", "private", "String", "keyStorePassphrase", ";", "private", "volatile", "String", "trustStorePassphrase", ";", "private", "String", "trustStorePassphrase", ";", "private", "volatile", "String", "keyStoreType", ";", "private", "String", "keyStoreType", ";", "private", "volatile", "String", "trustStoreType", ";", "private", "String", "trustStoreType", ";", "private", "volatile", "String", "sslAlgorithm", "=", "TLS_V1_1", ";", "private", "String", "sslAlgorithm", "=", "TLS_V1_1", ";", "private", "volatile", "boolean", "sslAlgorithmSet", ";", "private", "boolean", "sslAlgorithmSet", ";", "private", "volatile", "SecureRandom", "secureRandom", ";", "private", "SecureRandom", "secureRandom", ";", "private", "boolean", "skipServerCertificateValidation", ";", "private", "boolean", "enableHostnameVerification", ";", "public", "RabbitConnectionFactoryBean", "(", ")", "{", "this", ".", "connectionFactory", ".", "setAutomaticRecoveryEnabled", "(", "false", ")", ";", "}", "@", "@", "-", "604", ",", "6", "+", "624", ",", "21", "@", "@", "public", "void", "setChannelRpcTimeout", "(", "int", "channelRpcTimeout", ")", "{", "this", ".", "connectionFactory", ".", "setChannelRpcTimeout", "(", "channelRpcTimeout", ")", ";", "}", "/", "**", "*", "Enable", "server", "hostname", "verification", "for", "TLS", "connections", ".", "*", "<", "p", ">", "*", "This", "enables", "hostname", "verification", "regardless", "of", "the", "IO", "mode", "used", "(", "blocking", "or", "*", "non", "-", "blocking", "IO", ")", ".", "*", "Requires", "amqp", "-", "client", "5", ".", "4", ".", "0", "or", "later", ".", "*", "@", "param", "enable", "true", "to", "enable", ".", "*", "@", "since", "1", ".", "7", ".", "10", "*", "/", "public", "void", "setEnableHostnameVerification", "(", "boolean", "enable", ")", "{", "Assert", ".", "notNull", "(", "enableHostnameVerificationNoArgMethod", ",", "\"", "Host", "name", "verification", "requires", "amqp", "-", "client", "5", ".", "4", ".", "0", "or", "later", "\"", ");", "this", ".", "enableHostnameVerification", "=", "enable", ";", "}", "@", "Override", "public", "Class", "<", "?>", "getObjectType", "(", ")", "{", "return", "ConnectionFactory", ".", "class", ";", "@", "@", "-", "686", ",", "6", "+", "721", ",", "7", "@", "@", "protected", "void", "setUpSSL", "(", ")", "throws", "Exception", "{", "SSLContext", "context", "=", "createSSLContext", "(", ");", "context", ".", "init", "(", "keyManagers", ",", "trustManagers", ",", "this", ".", "secureRandom", ")", ";", "this", ".", "connectionFactory", ".", "useSslProtocol", "(", "context", ")", ";", "checkHostVerification", "(", ");", "}", "}", "@", "@", "-", "701", ",", "14", "+", "737", ",", "20", "@", "@", "protected", "SSLContext", "createSSLContext", "(", ")", "throws", "NoSuchAlgorithmException", "{", "}", "private", "void", "useDefaultTrustStoreMechanism", "(", ")", "throws", "NoSuchAlgorithmException", ",", "KeyManagementException", ",", "KeyStoreException", "{", "private", "void", "useDefaultTrustStoreMechanism", "(", ")", "throws", "Exception", "{", "SSLContext", "sslContext", "=", "SSLContext", ".", "getInstance", "(", "this", ".", "sslAlgorithm", ")", ";", "TrustManagerFactory", "trustManagerFactory", "=", "TrustManagerFactory", ".", "getInstance", "(", "TrustManagerFactory", ".", "getDefaultAlgorithm", "(", "))", ";", "trustManagerFactory", ".", "init", "(", "(", "KeyStore", ")", "null", ")", ";", "sslContext", ".", "init", "(", "null", ",", "trustManagerFactory", ".", "getTrustManagers", "(", "),", "null", ")", ";", "this", ".", "connectionFactory", ".", "useSslProtocol", "(", "sslContext", ")", ";", "checkHostVerification", "(", ");", "}", "private", "void", "checkHostVerification", "(", ")", "throws", "Exception", "{", "if", "(", "this", ".", "enableHostnameVerification", ")", "{", "enableHostnameVerificationNoArgMethod", ".", "invoke", "(", "this", ".", "connectionFactory", ")", ";", "}", "}", "}", "@", "@", "-", "179", ",", "6", "+", "179", ",", "11", "@", "@", "Also", "the", "`", "ConnectionBlockedEvent", "`", "and", "`", "ConnectionUnblockedEvent", "`", "events", "are", "emit", "See", "<", "<", "connections", ">", ">", "for", "more", "information", ".", "=", "==", "==", "Connection", "Factory", "Bean", "Changes", "The", "`", "RabbitConnectionFactoryBean", "`", "now", "provides", "an", "`", "enableHostnameVerification", "`", "property", ";", "set", "it", "to", "`", "true", "`", "to", "enable", "host", "name", "verification", ".", "Host", "name", "verification", "requires", "overriding", "the", "`", "amqp", "-", "client", "`", "to", "5", ".", "4", ".", "0", "or", "later", ".", "=", "==", "=", "Earlier", "Releases", "See", "<", "<", "previous", "-", "whats", "-", "new", ">", ">", "for", "changes", "in", "previous", "versions", "."], "docstring_tokens": ["intercept", "traffic", "and", "view", "data", "in", "transit"]}
{"contents": ["Update", "release", "notes", "wrt", "fix", "for", "#90", "(by", "#87)"], "code_tokens": ["@", "@", "-", "23", ",", "16", "+", "23", ",", "13", "@", "@", "*", "Utilities", "to", "aid", "in", "the", "translation", "of", "decimal", "types", "to", "/", "from", "multiple", "parts", ".", "*", "*", "@", "author", "Nick", "Williams", "*", "@", "since", "2", ".", "2", ".", "0", "*", "@", "since", "2", ".", "2", "*", "/", "public", "final", "class", "DecimalUtils", "{", "private", "static", "final", "BigDecimal", "ONE_BILLION", "=", "new", "BigDecimal", "(", "1_000_000_000L", ")", ";", "private", "DecimalUtils", "(", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "DecimalUtils", "cannot", "be", "instantiated", ".", "\")", ";", "}", "private", "DecimalUtils", "(", ")", "{", "}", "public", "static", "String", "toDecimal", "(", "long", "seconds", ",", "int", "nanoseconds", ")", "{", "@", "@", "-", "38", ",", "5", "+", "38", ",", "14", "@", "@", "Sonny", "Gill", "(", "sonnygill", "@", "github", ")", "(", "2", ".", "9", ".", "6", ")", "Adrian", "Palanques", "(", "devdevx", "@", "github", ")", "#", "78", ":", "Year", "deserialization", "ignores", "`", "@", "JsonFormat", "`", "pattern", "*", "Reported", "#", "78", ":", "(", "datetime", ")", "Year", "deserialization", "ignores", "`", "@", "JsonFormat", "`", "pattern", "(", "2", ".", "9", ".", "7", ")", "Andriy", "Plokhotnyuk", "(", "plokhotnyuk", "@", "github", ")", "*", "Reported", "#", "90", "(", "datetime", ")", ":", "Performance", "issue", "with", "malicious", "`", "BigDecimal", "`", "input", ",", "`", "InstantDeserializer", "`", ",", "`", "DurationDeserializer", "`", "(", "2", ".", "9", ".", "8", ")", "Todd", "Jonker", "(", "toddjonker", "@", "github", ")", "*", "Contributed", "fix", "for", "#", "90", "(", "see", "above", ")", "(", "2", ".", "9", ".", "8", ")", "@", "@", "-", "8", ",", "6", "+", "8", ",", "12", "@", "@", "Modules", ":", "=", "==", "Releases", "=", "==", "2", ".", "9", ".", "8", "(", "not", "yet", "released", ")", "#", "90", "(", "datetime", ")", ":", "Performance", "issue", "with", "malicious", "`", "BigDecimal", "`", "input", ",", "`", "InstantDeserializer", "`", ",", "`", "DurationDeserializer", "`", "(", "reported", "by", "Andriy", "P", ",", "fix", "contributed", "by", "Todd", "J", ")", "2", ".", "9", ".", "7", "(", "19", "-", "Sep", "-", "2018", ")", "#", "78", ":", "Year", "deserialization", "ignores", "`", "@", "JsonFormat", "`", "pattern"], "docstring_tokens": ["the", "application", "to", "crash"]}
{"contents": ["Uses", "isSequence", "flag", "to", "block", "chained", "expressions"], "code_tokens": ["@", "@", "-", "287", ",", "7", "+", "287", ",", "7", "@", "@", "public", "void", "setValue", "(", "final", "String", "name", ",", "final", "Map", "<", "String", ",", "Object", ">", "context", ",", "final", "compileAndExecute", "(", "name", ",", "context", ",", "new", "OgnlTask", "<", "Void", ">", "()", "{", "public", "Void", "execute", "(", "Object", "tree", ")", "throws", "OgnlException", "{", "if", "(", "isEvalExpression", "(", "tree", ",", "context", ")", ")", "{", "throw", "new", "OgnlException", "(", "\"", "Eval", "expression", "cannot", "be", "used", "as", "parameter", "name", "\"", ");", "throw", "new", "OgnlException", "(", "\"", "Eval", "expression", "/", "chained", "expressions", "cannot", "be", "used", "as", "parameter", "name", "\"", ");", "}", "Ognl", ".", "setValue", "(", "tree", ",", "context", ",", "root", ",", "value", ")", ";", "return", "null", ";", "@", "@", "-", "303", ",", "7", "+", "303", ",", "7", "@", "@", "private", "boolean", "isEvalExpression", "(", "Object", "tree", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "throw", "if", "(", "context", "!", "=", "null", "&", "&", "context", "instanceof", "OgnlContext", ")", "{", "ognlContext", "=", "(", "OgnlContext", ")", "context", ";", "}", "return", "node", ".", "isEvalChain", "(", "ognlContext", ")", ";", "return", "node", ".", "isEvalChain", "(", "ognlContext", ")", "|", "|", "node", ".", "isSequence", "(", "ognlContext", ")", ";", "}", "return", "false", ";", "}", "@", "@", "-", "360", ",", "7", "+", "360", ",", "7", "@", "@", "public", "Object", "execute", "(", "Object", "tree", ")", "throws", "OgnlException", "{", "private", "void", "checkEnableEvalExpression", "(", "Object", "tree", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "throws", "OgnlException", "{", "if", "(", "!", "enableEvalExpression", "&", "&", "isEvalExpression", "(", "tree", ",", "context", ")", ")", "{", "throw", "new", "OgnlException", "(", "\"", "Eval", "expressions", "has", "been", "disabled", "!", "\")", ";", "throw", "new", "OgnlException", "(", "\"", "Eval", "expressions", "/", "chained", "expressions", "have", "been", "disabled", "!", "\")", ";", "}", "}", "@", "@", "-", "744", ",", "6", "+", "744", ",", "21", "@", "@", "public", "void", "testAvoidCallingSomeClasses", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "expected", ".", "getMessage", "(", "),", "\"", "Method", "\\", "\"", "getRuntime", "\\", "\"", "failed", "for", "object", "class", "java", ".", "lang", ".", "Runtime", "\"", ");", "}", "public", "void", "testBlockSequenceOfExpressions", "(", ")", "throws", "Exception", "{", "Foo", "foo", "=", "new", "Foo", "(", ");", "Exception", "expected", "=", "null", ";", "try", "{", "ognlUtil", ".", "setValue", "(", "\"#", "booScope", "=", "@", "myclass", "@", "DEFAULT_SCOPE", ",", "#", "bootScope", ".", "init", "(", ")\"", ",", "ognlUtil", ".", "createDefaultContext", "(", "foo", ")", ",", "foo", ",", "true", ")", ";", "fail", "(", ");", "}", "catch", "(", "OgnlException", "e", ")", "{", "expected", "=", "e", ";", "}", "assertNotNull", "(", "expected", ")", ";", "assertSame", "(", "OgnlException", ".", "class", ",", "expected", ".", "getClass", "(", "))", ";", "assertEquals", "(", "expected", ".", "getMessage", "(", "),", "\"", "Eval", "expressions", "/", "chained", "expressions", "have", "been", "disabled", "!", "\")", ";", "}", "public", "static", "class", "Email", "{", "String", "address", ";"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["packet:", "Don't", "write", "vnet", "header", "beyond", "end", "of", "buffer", "...", "which", "may", "happen", "with", "certain", "values", "of", "tp_reserve", "and", "maclen.", "Fixes:", "58d19b19cd99", "(\"packet:", "vnet_hdr", "support", "for", "tpacket_rcv\")", "Signed-off-by:", "Benjamin", "Poirier", "<bpoirier@suse.com>", "Cc:", "Willem", "de", "Bruijn", "<willemb@google.com>", "Acked-by:", "Willem", "de", "Bruijn", "<willemb@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "2191", ",", "6", "+", "2191", ",", "7", "@", "@", "static", "int", "tpacket_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "struct", "timespec", "ts", ";", "__u32", "ts_status", ";", "bool", "is_drop_n_account", "=", "false", ";", "bool", "do_vnet", "=", "false", ";", "/", "*", "struct", "tpacket", "{", "2", ",", "3", "}", "_hdr", "is", "aligned", "to", "a", "multiple", "of", "TPACKET_ALIGNMENT", ".", "*", "We", "may", "add", "members", "to", "them", "until", "current", "aligned", "size", "without", "forcing", "@", "@", "-", "2241", ",", "8", "+", "2242", ",", "10", "@", "@", "static", "int", "tpacket_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "netoff", "=", "TPACKET_ALIGN", "(", "po", "-", ">", "tp_hdrlen", "+", "(", "maclen", "<", "16", "?", "16", ":", "maclen", ")", ")", "+", "po", "-", ">", "tp_reserve", ";", "if", "(", "po", "-", ">", "has_vnet_hdr", ")", "if", "(", "po", "-", ">", "has_vnet_hdr", ")", "{", "netoff", "+", "=", "sizeof", "(", "struct", "virtio_net_hdr", ")", ";", "do_vnet", "=", "true", ";", "}", "macoff", "=", "netoff", "-", "maclen", ";", "}", "if", "(", "po", "-", ">", "tp_version", "<", "=", "TPACKET_V2", ")", "{", "@", "@", "-", "2259", ",", "8", "+", "2262", ",", "10", "@", "@", "static", "int", "tpacket_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "skb_set_owner_r", "(", "copy_skb", ",", "sk", ")", ";", "}", "snaplen", "=", "po", "-", ">", "rx_ring", ".", "frame_size", "-", "macoff", ";", "if", "(", "(", "int", ")", "snaplen", "<", "0", ")", "if", "(", "(", "int", ")", "snaplen", "<", "0", ")", "{", "snaplen", "=", "0", ";", "do_vnet", "=", "false", ";", "}", "}", "}", "else", "if", "(", "unlikely", "(", "macoff", "+", "snaplen", ">", "GET_PBDQC_FROM_RB", "(", "&", "po", "-", ">", "rx_ring", ")", "->", "max_frame_len", ")", ")", "{", "@", "@", "-", "2273", ",", "6", "+", "2278", ",", "7", "@", "@", "static", "int", "tpacket_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "if", "(", "unlikely", "(", "(", "int", ")", "snaplen", "<", "0", ")", ")", "{", "snaplen", "=", "0", ";", "macoff", "=", "GET_PBDQC_FROM_RB", "(", "&", "po", "-", ">", "rx_ring", ")", "->", "max_frame_len", ";", "do_vnet", "=", "false", ";", "}", "}", "spin_lock", "(", "&", "sk", "-", ">", "sk_receive_queue", ".", "lock", ")", ";", "@", "@", "-", "2298", ",", "7", "+", "2304", ",", "7", "@", "@", "static", "int", "tpacket_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "}", "spin_unlock", "(", "&", "sk", "-", ">", "sk_receive_queue", ".", "lock", ")", ";", "if", "(", "po", "-", ">", "has_vnet_hdr", ")", "{", "if", "(", "do_vnet", ")", "{", "if", "(", "virtio_net_hdr_from_skb", "(", "skb", ",", "h", ".", "raw", "+", "macoff", "-", "sizeof", "(", "struct", "virtio_net_hdr", ")", ",", "vio_le", "(", "),", "true", ")", ")", "{"], "docstring_tokens": ["and", "disk", "and", "memory", "corruption", ")", "or", "possibly", "have", "unspecified", "other", "impact", "via", "crafted", "system", "calls"]}
{"contents": ["MFH", "fixed", "bug", "#52784", "(Race", "condition", "when", "handling", "many", "concurrent", "signals)"], "code_tokens": ["@", "@", "-", "88", ",", "6", "+", "88", ",", "8", "@", "@", "(", "CURLOPT_STDERR", ")", ").", "(", "Gustavo", ")", "-", "Fixed", "bug", "#", "52786", "(", "PHP", "should", "reset", "section", "to", "[", "PHP", "]", "after", "ini", "sections", ")", ".", "(", "Fedora", "at", "famillecollet", "dot", "com", ")", "-", "Fixed", "bug", "#", "52784", "(", "Race", "condition", "when", "handling", "many", "concurrent", "signals", ")", ".", "(", "nick", "dot", "telford", "at", "gmail", "dot", "com", ",", "Arnaud", ")", "-", "Fixed", "bug", "#", "52772", "(", "var_dump", "(", ")", "doesn", "'", "t", "check", "for", "the", "existence", "of", "get_class_name", "before", "calling", "it", ")", ".", "(", "Kalle", ",", "Gustavo", ")", "-", "Fixed", "bug", "#", "52744", "(", "cal_days_in_month", "incorrect", "for", "December", "1", "BCE", ")", ".", "@", "@", "-", "887", ",", "7", "+", "887", ",", "7", "@", "@", "PHP_FUNCTION", "(", "pcntl_signal", ")", "zend_hash_index_update", "(", "&", "PCNTL_G", "(", "php_signal_table", ")", ",", "signo", ",", "(", "void", "*", "*)", "&", "handle", ",", "sizeof", "(", "zval", "*", "),", "(", "void", "*", "*)", "&", "dest_handle", ")", ";", "if", "(", "dest_handle", ")", "zval_add_ref", "(", "dest_handle", ")", ";", "if", "(", "php_signal", "(", "signo", ",", "pcntl_signal_handler", ",", "(", "int", ")", "restart_syscalls", ")", "=", "=", "SIG_ERR", ")", "{", "if", "(", "php_signal4", "(", "signo", ",", "pcntl_signal_handler", ",", "(", "int", ")", "restart_syscalls", ",", "1", ")", "=", "=", "SIG_ERR", ")", "{", "PCNTL_G", "(", "last_error", ")", "=", "errno", ";", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Error", "assigning", "signal", "\"", ");", "RETURN_FALSE", ";", "@", "@", "-", "1224", ",", "11", "+", "1224", ",", "19", "@", "@", "void", "pcntl_signal_dispatch", "(", ")", "{", "zval", "*", "param", ",", "*", "*", "handle", ",", "*", "retval", ";", "struct", "php_pcntl_pending_signal", "*", "queue", ",", "*", "next", ";", "sigset_t", "mask", ";", "sigset_t", "old_mask", ";", "TSRMLS_FETCH", "(", ");", "/", "*", "Mask", "all", "signals", "*", "/", "sigfillset", "(", "&", "mask", ")", ";", "sigprocmask", "(", "SIG_BLOCK", ",", "&", "mask", ",", "&", "old_mask", ")", ";", "/", "*", "Bail", "if", "the", "queue", "is", "empty", "or", "if", "we", "are", "already", "playing", "the", "queue", "*", "/", "if", "(", "!", "PCNTL_G", "(", "head", ")", "|", "|", "PCNTL_G", "(", "processing_signal_queue", ")", ")", "if", "(", "!", "PCNTL_G", "(", "head", ")", "|", "|", "PCNTL_G", "(", "processing_signal_queue", ")", ")", "{", "sigprocmask", "(", "SIG_SETMASK", ",", "&", "old_mask", ",", "NULL", ")", ";", "return", ";", "}", "/", "*", "Prevent", "reentrant", "handler", "calls", "*", "/", "PCNTL_G", "(", "processing_signal_queue", ")", "=", "1", ";", "@", "@", "-", "1260", ",", "6", "+", "1268", ",", "9", "@", "@", "void", "pcntl_signal_dispatch", "(", ")", "/", "*", "Re", "-", "enable", "queue", "*", "/", "PCNTL_G", "(", "processing_signal_queue", ")", "=", "0", ";", "/", "*", "return", "signal", "mask", "to", "previous", "state", "*", "/", "sigprocmask", "(", "SIG_SETMASK", ",", "&", "old_mask", ",", "NULL", ")", ";", "}", "@", "@", "-", "22", ",", "11", "+", "22", ",", "15", "@", "@", "/", "*", "php_signal", "using", "sigaction", "is", "derrived", "from", "Advanced", "Programing", "*", "in", "the", "Unix", "Environment", "by", "W", ".", "Richard", "Stevens", "p", "298", ".", "*", "/", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", "Sigfunc", "*", "php_signal4", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ",", "int", "mask_all", ")", "{", "struct", "sigaction", "act", ",", "oact", ";", "act", ".", "sa_handler", "=", "func", ";", "sigemptyset", "(", "&", "act", ".", "sa_mask", ")", ";", "if", "(", "mask_all", ")", "{", "sigfillset", "(", "&", "act", ".", "sa_mask", ")", ";", "}", "else", "{", "sigemptyset", "(", "&", "act", ".", "sa_mask", ")", ";", "}", "act", ".", "sa_flags", "=", "0", ";", "if", "(", "signo", "=", "=", "SIGALRM", "|", "|", "(", "!", "restart", ")", ")", "{", "#", "ifdef", "SA_INTERRUPT", "@", "@", "-", "43", ",", "6", "+", "47", ",", "11", "@", "@", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", "return", "oact", ".", "sa_handler", ";", "}", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", "{", "return", "php_signal4", "(", "signo", ",", "func", ",", "restart", ",", "0", ")", ";", "}", "/", "*", "*", "Local", "variables", ":", "*", "tab", "-", "width", ":", "4", "@", "@", "-", "31", ",", "5", "+", "31", ",", "6", "@", "@", "typedef", "void", "Sigfunc", "(", "int", ")", ";", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", ";", "Sigfunc", "*", "php_signal4", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ",", "int", "mask_all", ")", ";", "#", "endif"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "corruption", ")"]}
{"contents": ["x86/iopl/64:", "Properly", "context-switch", "IOPL", "on", "Xen", "PV", "On", "Xen", "PV,", "regs->flags", "doesn't", "reliably", "reflect", "IOPL", "and", "the", "exit-to-userspace", "code", "doesn't", "change", "IOPL.", "We", "need", "to", "context", "switch", "it", "manually.", "I'm", "doing", "this", "without", "going", "through", "paravirt", "because", "this", "is", "specific", "to", "Xen", "PV.", "After", "the", "dust", "settles,", "we", "can", "merge", "this", "with", "the", "32-bit", "code,", "tidy", "up", "the", "iopl", "syscall", "implementation,", "and", "remove", "the", "set_iopl", "pvop", "entirely.", "Fixes", "XSA-171.", "Reviewewd-by:", "Jan", "Beulich", "<JBeulich@suse.com>", "Signed-off-by:", "Andy", "Lutomirski", "<luto@kernel.org>", "Cc:", "Andrew", "Cooper", "<andrew.cooper3@citrix.com>", "Cc:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Boris", "Ostrovsky", "<boris.ostrovsky@oracle.com>", "Cc:", "Borislav", "Petkov", "<bp@alien8.de>", "Cc:", "Brian", "Gerst", "<brgerst@gmail.com>", "Cc:", "David", "Vrabel", "<david.vrabel@citrix.com>", "Cc:", "Denys", "Vlasenko", "<dvlasenk@redhat.com>", "Cc:", "H.", "Peter", "Anvin", "<hpa@zytor.com>", "Cc:", "Jan", "Beulich", "<JBeulich@suse.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "stable@vger.kernel.org", "Link:", "http://lkml.kernel.org/r/693c3bd7aeb4d3c27c92c622b7d0f554a458173c.1458162709.git.luto@kernel.org", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["@", "@", "-", "62", ",", "4", "+", "62", ",", "6", "@", "@", "void", "xen_arch_register_cpu", "(", "int", "num", ")", ";", "void", "xen_arch_unregister_cpu", "(", "int", "num", ")", ";", "#", "endif", "extern", "void", "xen_set_iopl_mask", "(", "unsigned", "mask", ")", ";", "#", "endif", "/", "*", "_ASM_X86_XEN_HYPERVISOR_H", "*", "/", "@", "@", "-", "48", ",", "6", "+", "48", ",", "7", "@", "@", "#", "include", "<", "asm", "/", "syscalls", ".", "h", ">", "#", "include", "<", "asm", "/", "debugreg", ".", "h", ">", "#", "include", "<", "asm", "/", "switch_to", ".", "h", ">", "#", "include", "<", "asm", "/", "xen", "/", "hypervisor", ".", "h", ">", "asmlinkage", "extern", "void", "ret_from_fork", "(", "void", ")", ";", "@", "@", "-", "411", ",", "6", "+", "412", ",", "17", "@", "@", "__switch_to", "(", "struct", "task_struct", "*", "prev_p", ",", "struct", "task_struct", "*", "next_p", ")", "task_thread_info", "(", "prev_p", ")", "->", "flags", "&", "_TIF_WORK_CTXSW_PREV", ")", ")", "__switch_to_xtra", "(", "prev_p", ",", "next_p", ",", "tss", ")", ";", "#", "ifdef", "CONFIG_XEN", "/", "*", "*", "On", "Xen", "PV", ",", "IOPL", "bits", "in", "pt_regs", "-", ">", "flags", "have", "no", "effect", ",", "and", "*", "current_pt_regs", "(", ")-", ">", "flags", "may", "not", "match", "the", "current", "task", "'", "s", "*", "intended", "IOPL", ".", "We", "need", "to", "switch", "it", "manually", ".", "*", "/", "if", "(", "unlikely", "(", "static_cpu_has", "(", "X86_FEATURE_XENPV", ")", "&", "&", "prev", "-", ">", "iopl", "!", "=", "next", "-", ">", "iopl", ")", ")", "xen_set_iopl_mask", "(", "next", "-", ">", "iopl", ")", ";", "#", "endif", "if", "(", "static_cpu_has_bug", "(", "X86_BUG_SYSRET_SS_ATTRS", ")", ")", "{", "/", "*", "*", "AMD", "CPUs", "have", "a", "misfeature", ":", "SYSRET", "sets", "the", "SS", "selector", "but", "@", "@", "-", "961", ",", "7", "+", "961", ",", "7", "@", "@", "static", "void", "xen_load_sp0", "(", "struct", "tss_struct", "*", "tss", ",", "tss", "-", ">", "x86_tss", ".", "sp0", "=", "thread", "-", ">", "sp0", ";", "}", "static", "void", "xen_set_iopl_mask", "(", "unsigned", "mask", ")", "void", "xen_set_iopl_mask", "(", "unsigned", "mask", ")", "{", "struct", "physdev_set_iopl", "set_iopl", ";"], "docstring_tokens": ["gain", "unauthorized", "access", "to", "I/O", "ports", "and", "gain", "elevated", "privileges", "on", "the", "system"]}
{"contents": ["chore:", "cherry-pick", "c244270e23", "from", "chromium.", "(#26484)"], "code_tokens": ["@", "@", "-", "140", ",", "3", "+", "140", ",", "4", "@", "@", "cherry", "-", "pick", "-", "229fdaf8fc05", ".", "patch", "cherry", "-", "pick", "-", "88f263f401b4", ".", "patch", "worker_feat_add_hook_to_notify_script_ready", ".", "patch", "cherry", "-", "pick", "-", "8f24f935c903", ".", "patch", "ignore_renderframehostimpl_detach_for_speculative_rfhs", ".", "patch", "@", "@", "-", "0", ",", "0", "+", "1", ",", "165", "@", "@", "From", "0000000000000000000000000000000000000000", "Mon", "Sep", "17", "00", ":", "00", ":", "00", "2001", "From", ":", "Daniel", "Cheng", "<", "dcheng", "@", "chromium", ".", "org", ">", "Date", ":", "Wed", ",", "11", "Nov", "2020", "00", ":", "54", ":", "41", "+", "0000", "Subject", ":", "Ignore", "RenderFrameHostImpl", ":", ":", "Detach", "(", ")", "for", "speculative", "RFHs", ".", "Currently", ",", "this", "all", "happens", "to", "work", "by", "chance", ",", "because", "the", "speculative", "RFH", "or", "the", "entire", "FTN", "happens", "to", "be", "torn", "down", "before", "the", "browser", "process", "ever", "processes", "a", "Detach", "(", ")", "IPC", "for", "a", "speculative", "RFH", ".", "However", ",", "there", "are", "a", "number", "of", "followup", "CLs", "that", "restructure", "how", "provisional", "RenderFrames", "are", "managed", "and", "owned", "in", "the", "renderer", "process", ".", "To", "simplify", "those", "CLs", ",", "explicitly", "branch", "in", "Detach", "(", ")", "based", "on", "whether", "or", "not", "the", "RFH", "is", "speculative", ".", "In", "the", "future", ",", "additional", "logic", "may", "be", "added", "to", "the", "speculative", "branch", "(", "e", ".", "g", ".", "cancelling", "the", "navigation", ",", "if", "appropriate", ")", ".", "(", "cherry", "picked", "from", "commit", "cf054220a2e1570a9149220494de8826c2e9d4db", ")", "Bug", ":", "1146709", "Change", "-", "Id", ":", "I6490a90f7b447422d698676665b52f6f3a6f8ffd", "Reviewed", "-", "on", ":", "https", ":", "//", "chromium", "-", "review", ".", "googlesource", ".", "com", "/", "c", "/", "chromium", "/", "src", "/", "+/", "2524280", "Commit", "-", "Queue", ":", "Daniel", "Cheng", "<", "dcheng", "@", "chromium", ".", "org", ">", "Reviewed", "-", "by", ":", "Nasko", "Oskov", "<", "nasko", "@", "chromium", ".", "org", ">", "Cr", "-", "Original", "-", "Commit", "-", "Position", ":", "refs", "/", "heads", "/", "master", "@", "{#", "825903", "}", "Reviewed", "-", "on", ":", "https", ":", "//", "chromium", "-", "review", ".", "googlesource", ".", "com", "/", "c", "/", "chromium", "/", "src", "/", "+/", "2530189", "Reviewed", "-", "by", ":", "Adrian", "Taylor", "<", "adetaylor", "@", "chromium", ".", "org", ">", "Cr", "-", "Commit", "-", "Position", ":", "refs", "/", "branch", "-", "heads", "/", "4240", "@", "{#", "1430", "}", "Cr", "-", "Branched", "-", "From", ":", "f297677702651916bbf65e59c0d4bbd4ce57d1ee", "-", "refs", "/", "heads", "/", "master", "@", "{#", "800218", "}", "diff", "-", "-", "git", "a", "/", "content", "/", "browser", "/", "frame_host", "/", "render_frame_host_impl", ".", "cc", "b", "/", "content", "/", "browser", "/", "frame_host", "/", "render_frame_host_impl", ".", "cc", "index", "8a02ff83c8e40d641530211ef944b62b09a03ac8", ".", ".", "3b78a2c33d5ccad8d0a90df895a1f947faab68b4", "100644", "-", "--", "a", "/", "content", "/", "browser", "/", "frame_host", "/", "render_frame_host_impl", ".", "cc", "b", "/", "content", "/", "browser", "/", "frame_host", "/", "render_frame_host_impl", ".", "cc", "@", "@", "-", "2520", ",", "6", "+", "2520", ",", "9", "@", "@", "void", "RenderFrameHostImpl", ":", ":", "UpdateRenderProcessHostFramePriorities", "(", ")", "{", "}", "void", "RenderFrameHostImpl", ":", ":", "OnDetach", "(", ")", "{", "if", "(", "frame_tree_node_", "-", ">", "render_manager", "(", ")-", ">", "speculative_frame_host", "(", ")", "=", "=", "this", ")", "return", ";", "if", "(", "!", "parent_", ")", "{", "bad_message", ":", ":", "ReceivedBadMessage", "(", "GetProcess", "(", "),", "bad_message", ":", ":", "RFH_DETACH_MAIN_FRAME", ")", ";", "diff", "-", "-", "git", "a", "/", "content", "/", "browser", "/", "site_per_process_browsertest", ".", "cc", "b", "/", "content", "/", "browser", "/", "site_per_process_browsertest", ".", "cc", "index", "eeaddcacdf714dff2c84cd39e69477b87b2462b4", ".", ".", "2d7df6e122bdc5d8270e40d6bbacd68daabe4bd7", "100644", "-", "--", "a", "/", "content", "/", "browser", "/", "site_per_process_browsertest", ".", "cc", "b", "/", "content", "/", "browser", "/", "site_per_process_browsertest", ".", "cc", "@", "@", "-", "10347", ",", "6", "+", "10347", ",", "36", "@", "@", "IN_PROC_BROWSER_TEST_F", "(", "SitePerProcessBrowserTest", ",", "EXPECT_EQ", "(", "\"", "opener", "-", "ping", "-", "reply", "\"", ",", "response", ")", ";", "}", "IN_PROC_BROWSER_TEST_P", "(", "SitePerProcessBrowserTest", ",", "DetachSpeculativeRenderFrameHost", ")", "{", "/", "/", "Commit", "a", "page", "with", "one", "iframe", ".", "GURL", "main_url", "(", "embedded_test_server", "(", ")-", ">", "GetURL", "(", "\"", "a", ".", "com", "\"", ",", "\"", "/", "cross_site_iframe_factory", ".", "html", "?", "a", "(", "a", ")", "\")", ");", "EXPECT_TRUE", "(", "NavigateToURL", "(", "shell", "(", "),", "main_url", ")", ");", "/", "/", "Start", "a", "cross", "-", "site", "navigation", ".", "GURL", "cross_site_url", "(", "embedded_test_server", "(", ")-", ">", "GetURL", "(", "\"", "b", ".", "com", "\"", ",", "\"", "/", "title2", ".", "html", "\"", "))", ";", "TestNavigationManager", "nav_manager", "(", "shell", "(", ")-", ">", "web_contents", "(", "),", "cross_site_url", ")", ";", "BeginNavigateIframeToURL", "(", "web_contents", "(", "),", "\"", "child", "-", "0", "\"", ",", "cross_site_url", ")", ";", "/", "/", "Wait", "for", "the", "request", ",", "but", "don", "'", "t", "commit", "it", "yet", ".", "This", "should", "create", "a", "/", "/", "speculative", "RenderFrameHost", ".", "ASSERT_TRUE", "(", "nav_manager", ".", "WaitForRequestStart", "(", "))", ";", "FrameTreeNode", "*", "root", "=", "web_contents", "(", ")-", ">", "GetFrameTree", "(", ")-", ">", "root", "(", ");", "RenderFrameHostImpl", "*", "speculative_rfh", "=", "root", "-", ">", "current_frame_host", "(", ")", "-", ">", "child_at", "(", "0", ")", "-", ">", "render_manager", "(", ")", "-", ">", "speculative_frame_host", "(", ");", "EXPECT_TRUE", "(", "speculative_rfh", ")", ";", "/", "/", "Currently", ",", "the", "browser", "process", "never", "handles", "an", "explicit", "Detach", "(", ")", "for", "a", "/", "/", "speculative", "RFH", ",", "since", "the", "speculative", "RFH", "or", "the", "entire", "FTN", "is", "always", "/", "/", "destroyed", "before", "the", "renderer", "sends", "this", "IPC", ".", "speculative_rfh", "-", ">", "Detach", "(", ");", "/", "/", "Passes", "if", "there", "is", "no", "crash", ".", "}", "#", "if", "defined", "(", "OS_ANDROID", ")", "namespace", "{", "diff", "-", "-", "git", "a", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "cc", "b", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "cc", "index", "98708c6ac228d6bcc969a980c879de20fa3d3269", ".", ".", "936f9564a19c3fac2339af7c1fde9946008a8537", "100644", "-", "--", "a", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "cc", "b", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "cc", "@", "@", "-", "624", ",", "17", "+", "624", ",", "23", "@", "@", "bool", "NavigateToURL", "(", "WebContents", "*", "web_contents", ",", "}", "bool", "NavigateIframeToURL", "(", "WebContents", "*", "web_contents", ",", "-", "std", ":", ":", "string", "iframe_id", ",", "const", "std", ":", ":", "string", "&", "iframe_id", ",", "const", "GURL", "&", "url", ")", "{", "TestNavigationObserver", "load_observer", "(", "web_contents", ")", ";", "bool", "result", "=", "BeginNavigateIframeToURL", "(", "web_contents", ",", "iframe_id", ",", "url", ")", ";", "load_observer", ".", "Wait", "(", ");", "return", "result", ";", "}", "bool", "BeginNavigateIframeToURL", "(", "WebContents", "*", "web_contents", ",", "const", "std", ":", ":", "string", "&", "iframe_id", ",", "const", "GURL", "&", "url", ")", "{", "std", ":", ":", "string", "script", "=", "base", ":", ":", "StringPrintf", "(", "\"", "setTimeout", "(", "\\\"", "\"", "\"", "var", "iframes", "=", "document", ".", "getElementById", "(", "'%", "s", "'", ");", "iframes", ".", "src", "=", "'%", "s", "'", ";\"", "\"", "\\\"", ",", "0", ")", "\",", "iframe_id", ".", "c_str", "(", "),", "url", ".", "spec", "(", ").", "c_str", "(", "))", ";", "-", "TestNavigationObserver", "load_observer", "(", "web_contents", ")", ";", "-", "bool", "result", "=", "ExecuteScript", "(", "web_contents", ",", "script", ")", ";", "-", "load_observer", ".", "Wait", "(", ");", "-", "return", "result", ";", "return", "ExecuteScript", "(", "web_contents", ",", "script", ")", ";", "}", "void", "NavigateToURLBlockUntilNavigationsComplete", "(", "WebContents", "*", "web_contents", ",", "diff", "-", "-", "git", "a", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "h", "b", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "h", "index", "2861386110a0098104d5cf5456cc7507a2cb0ca7", ".", ".", "21c15c6af4ea0b3a2be1a4ba61c309231e59578c", "100644", "-", "--", "a", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "h", "b", "/", "content", "/", "public", "/", "test", "/", "browser_test_utils", ".", "h", "@", "@", "-", "135", ",", "6", "+", "135", ",", "12", "@", "@", "bool", "NavigateIframeToURL", "(", "WebContents", "*", "web_contents", ",", "std", ":", ":", "string", "iframe_id", ",", "const", "GURL", "&", "url", ")", ";", "/", "/", "Similar", "to", "|", "NavigateIframeToURL", "(", ")|", "but", "returns", "as", "soon", "as", "the", "navigation", "is", "/", "/", "initiated", ".", "bool", "BeginNavigateIframeToURL", "(", "WebContents", "*", "web_contents", ",", "const", "std", ":", ":", "string", "&", "iframe_id", ",", "const", "GURL", "&", "url", ")", ";", "/", "/", "Generate", "a", "URL", "for", "a", "file", "path", "including", "a", "query", "string", ".", "GURL", "GetFileUrlWithQuery", "(", "const", "base", ":", ":", "FilePath", "&", "path", ",", "const", "std", ":", ":", "string", "&", "query_string", ")", ";", "diff", "-", "-", "git", "a", "/", "content", "/", "test", "/", "data", "/", "cross_site_iframe_factory", ".", "html", "b", "/", "content", "/", "test", "/", "data", "/", "cross_site_iframe_factory", ".", "html", "index", "2116189a33566bbd241952d276bb82341fd6ecaf", ".", ".", "43fb6fb6278e5bbc42797b8206b0546351d46e8e", "100644", "-", "--", "a", "/", "content", "/", "test", "/", "data", "/", "cross_site_iframe_factory", ".", "html", "b", "/", "content", "/", "test", "/", "data", "/", "cross_site_iframe_factory", ".", "html", "@", "@", "-", "10", ",", "12", "+", "10", ",", "12", "@", "@", "Example", "usage", "in", "a", "browsertest", ",", "explained", ":", "When", "you", "navigate", "to", "the", "above", "URL", ",", "the", "outer", "document", "(", "on", "a", ".", "com", ")", "will", "create", "a", "single", "iframe", ":", "-", "<", "iframe", "src", "=", "\"", "http", ":", "//", "b", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "b", "(", "c", "(", "),", "d", "(", "))", "\">", "<", "iframe", "id", "=", "\"", "child", "-", "0", "\"", "src", "=", "\"", "http", ":", "//", "b", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "b", "(", "c", "(", "),", "d", "(", "))", "\">", "Inside", "of", "which", ",", "then", ",", "are", "created", "the", "two", "leaf", "iframes", ":", "-", "<", "iframe", "src", "=", "\"", "http", ":", "//", "c", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "c", "(", ")\"", ">", "-", "<", "iframe", "src", "=", "\"", "http", ":", "//", "d", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "d", "(", ")\"", ">", "<", "iframe", "id", "=", "\"", "child", "-", "0", "\"", "src", "=", "\"", "http", ":", "//", "c", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "c", "(", ")\"", ">", "<", "iframe", "id", "=", "\"", "child", "-", "1", "\"", "src", "=", "\"", "http", ":", "//", "d", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "d", "(", ")\"", ">", "Add", "iframe", "options", "by", "enclosing", "them", "in", "'", "{'", "and", "'", "}'", "characters", "after", "the", "hostname", "(", "multiple", "options", "can", "be", "separated", "with", "commas", ")", ":", "@", "@", "-", "24", ",", "8", "+", "24", ",", "8", "@", "@", "hostname", "(", "multiple", "options", "can", "be", "separated", "with", "commas", ")", ":", "Will", "create", "two", "iframes", ":", "-", "<", "iframe", "src", "=", "\"", "http", ":", "//", "a", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "b", "(", ")\"", "allowfullscreen", ">", "-", "<", "iframe", "src", "=", "\"", "http", ":", "//", "c", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "c", "{", "sandbox", "-", "allow", "-", "scripts", "}", "(", "d", "(", "))", "\"", "sandbox", "=", "\"", "allow", "-", "scripts", "\"", ">", "<", "iframe", "id", "=", "\"", "child", "-", "0", "\"", "src", "=", "\"", "http", ":", "//", "a", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "b", "(", ")\"", "allowfullscreen", ">", "<", "iframe", "id", "=", "\"", "child", "-", "1", "\"", "src", "=", "\"", "http", ":", "//", "c", ".", "com", ":", "1234", "/", "cross_site_iframe_factory", ".", "html", "?", "c", "{", "sandbox", "-", "allow", "-", "scripts", "}", "(", "d", "(", "))", "\"", "sandbox", "=", "\"", "allow", "-", "scripts", "\"", ">", "To", "specify", "the", "site", "for", "each", "iframe", ",", "you", "can", "use", "a", "simple", "identifier", "like", "\"", "a", "\"", "or", "\"", "b", "\"", ",", "and", "\"", ".", "com", "\"", "will", "be", "automatically", "appended", ".", "You", "can", "also", "specify", "a", "port"], "docstring_tokens": ["execute", "arbitrary", "code", "or", "cause", "the", "application", "to", "crash", "on", "the", "system"]}
{"contents": ["Fix", "memory", "leak", "from", "zero-length", "DTLS", "fragments.", "The", "|pqueue_insert|", "function", "can", "fail", "if", "one", "attempts", "to", "insert", "a", "duplicate", "sequence", "number.", "When", "handling", "a", "fragment", "of", "an", "out", "of", "sequence", "message,", "|dtls1_process_out_of_seq_message|", "would", "not", "call", "|dtls1_reassemble_fragment|", "if", "the", "fragment's", "length", "was", "zero.", "It", "would", "then", "allocate", "a", "fresh", "fragment", "and", "attempt", "to", "insert", "it,", "but", "ignore", "the", "return", "value,", "leaking", "the", "fragment.", "This", "allows", "an", "attacker", "to", "exhaust", "the", "memory", "of", "a", "DTLS", "peer.", "Fixes", "Reviewed-by:", "Matt", "Caswell", "<matt@openssl.org>", "Reviewed-by:", "Emilia", "K\u00e4sper", "<emilia@openssl.org>"], "code_tokens": ["@", "@", "-", "616", ",", "6", "+", "616", ",", "9", "@", "@", "dtls1_reassemble_fragment", "(", "SSL", "*", "s", ",", "struct", "hm_header_st", "*", "msg_hdr", ",", "int", "*", "ok", ")", "msg_hdr", "-", ">", "msg_len", ">", "dtls1_max_handshake_message_len", "(", "s", ")", ")", "goto", "err", ";", "if", "(", "frag_len", "=", "=", "0", ")", "return", "DTLS1_HM_FRAGMENT_RETRY", ";", "/", "*", "Try", "to", "find", "item", "in", "queue", "*", "/", "memset", "(", "seq64be", ",", "0", ",", "sizeof", "(", "seq64be", ")", ");", "seq64be", "[", "6", "]", "=", "(", "unsigned", "char", ")", "(", "msg_hdr", "-", ">", "seq", ">", ">", "8", ")", ";", "@", "@", "-", "693", ",", "7", "+", "696", ",", "12", "@", "@", "dtls1_reassemble_fragment", "(", "SSL", "*", "s", ",", "struct", "hm_header_st", "*", "msg_hdr", ",", "int", "*", "ok", ")", "goto", "err", ";", "}", "pqueue_insert", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ",", "item", ")", ";", "item", "=", "pqueue_insert", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ",", "item", ")", ";", "/", "*", "pqueue_insert", "fails", "iff", "a", "duplicate", "item", "is", "inserted", ".", "*", "However", ",", "|", "item", "|", "cannot", "be", "a", "duplicate", ".", "If", "it", "were", ",", "*", "|", "pqueue_find", "|", ",", "above", ",", "would", "have", "returned", "it", "and", "control", "*", "would", "never", "have", "reached", "this", "branch", ".", "*", "/", "OPENSSL_assert", "(", "item", "!", "=", "NULL", ")", ";", "}", "return", "DTLS1_HM_FRAGMENT_RETRY", ";", "@", "@", "-", "751", ",", "7", "+", "759", ",", "7", "@", "@", "dtls1_process_out_of_seq_message", "(", "SSL", "*", "s", ",", "struct", "hm_header_st", "*", "msg_hdr", ",", "int", "*", "ok", ")", "}", "else", "{", "if", "(", "frag_len", "&", "&", "frag_len", "<", "msg_hdr", "-", ">", "msg_len", ")", "if", "(", "frag_len", "<", "msg_hdr", "-", ">", "msg_len", ")", "return", "dtls1_reassemble_fragment", "(", "s", ",", "msg_hdr", ",", "ok", ")", ";", "if", "(", "frag_len", ">", "dtls1_max_handshake_message_len", "(", "s", ")", ")", "@", "@", "-", "780", ",", "7", "+", "788", ",", "15", "@", "@", "dtls1_process_out_of_seq_message", "(", "SSL", "*", "s", ",", "struct", "hm_header_st", "*", "msg_hdr", ",", "int", "*", "ok", ")", "if", "(", "item", "=", "=", "NULL", ")", "goto", "err", ";", "pqueue_insert", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ",", "item", ")", ";", "item", "=", "pqueue_insert", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ",", "item", ")", ";", "/", "*", "pqueue_insert", "fails", "iff", "a", "duplicate", "item", "is", "inserted", ".", "*", "However", ",", "|", "item", "|", "cannot", "be", "a", "duplicate", ".", "If", "it", "were", ",", "*", "|", "pqueue_find", "|", ",", "above", ",", "would", "have", "returned", "it", ".", "Then", ",", "either", "*", "|", "frag_len", "|", "!", "=", "|", "msg_hdr", "-", ">", "msg_len", "|", "in", "which", "case", "|", "item", "|", "is", "set", "*", "to", "NULL", "and", "it", "will", "have", "been", "processed", "with", "*", "|", "dtls1_reassemble_fragment", "|", ",", "above", ",", "or", "the", "record", "will", "have", "*", "been", "discarded", ".", "*", "/", "OPENSSL_assert", "(", "item", "!", "=", "NULL", ")", ";", "}", "return", "DTLS1_HM_FRAGMENT_RETRY", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["Merge", "pull", "request", "#347", "from", "tresorit/fix-asn1-decoder-dos", "Fix", "possible", "DoS", "in", "ASN.1", "decoders", "(", ")"], "code_tokens": ["@", "@", "-", "123", ",", "6", "+", "123", ",", "8", "@", "@", "size_t", "BERDecodeOctetString", "(", "BufferedTransformation", "&", "bt", ",", "SecByteBlock", "&", "str", ")", "size_t", "bc", ";", "if", "(", "!", "BERLengthDecode", "(", "bt", ",", "bc", ")", ")", "BERDecodeError", "(", ");", "if", "(", "bc", ">", "bt", ".", "MaxRetrievable", "(", "))", "BERDecodeError", "(", ");", "str", ".", "New", "(", "bc", ")", ";", "if", "(", "bc", "!", "=", "bt", ".", "Get", "(", "str", ",", "bc", ")", ")", "@", "@", "-", "139", ",", "6", "+", "141", ",", "8", "@", "@", "size_t", "BERDecodeOctetString", "(", "BufferedTransformation", "&", "bt", ",", "BufferedTransformation", "&", "size_t", "bc", ";", "if", "(", "!", "BERLengthDecode", "(", "bt", ",", "bc", ")", ")", "BERDecodeError", "(", ");", "if", "(", "bc", ">", "bt", ".", "MaxRetrievable", "(", "))", "BERDecodeError", "(", ");", "bt", ".", "TransferTo", "(", "str", ",", "bc", ")", ";", "return", "bc", ";", "@", "@", "-", "161", ",", "6", "+", "165", ",", "8", "@", "@", "size_t", "BERDecodeTextString", "(", "BufferedTransformation", "&", "bt", ",", "std", ":", ":", "string", "&", "str", ",", "byte", "as", "size_t", "bc", ";", "if", "(", "!", "BERLengthDecode", "(", "bt", ",", "bc", ")", ")", "BERDecodeError", "(", ");", "if", "(", "bc", ">", "bt", ".", "MaxRetrievable", "(", "))", "BERDecodeError", "(", ");", "SecByteBlock", "temp", "(", "bc", ")", ";", "if", "(", "bc", "!", "=", "bt", ".", "Get", "(", "temp", ",", "bc", ")", ")", "@", "@", "-", "188", ",", "6", "+", "194", ",", "10", "@", "@", "size_t", "BERDecodeBitString", "(", "BufferedTransformation", "&", "bt", ",", "SecByteBlock", "&", "str", ",", "unsigne", "size_t", "bc", ";", "if", "(", "!", "BERLengthDecode", "(", "bt", ",", "bc", ")", ")", "BERDecodeError", "(", ");", "if", "(", "bc", "=", "=", "0", ")", "BERDecodeError", "(", ");", "if", "(", "bc", ">", "bt", ".", "MaxRetrievable", "(", "))", "BERDecodeError", "(", ");", "byte", "unused", ";", "if", "(", "!", "bt", ".", "Get", "(", "unused", ")", ")", "@", "@", "-", "498", ",", "6", "+", "498", ",", "8", "@", "@", "void", "BERDecodeUnsigned", "(", "BufferedTransformation", "&", "in", ",", "T", "&", "w", ",", "byte", "asnTag", "=", "INTEGER", ",", "bool", "definite", "=", "BERLengthDecode", "(", "in", ",", "bc", ")", ";", "if", "(", "!", "definite", ")", "BERDecodeError", "(", ");", "if", "(", "bc", ">", "in", ".", "MaxRetrievable", "(", "))", "BERDecodeError", "(", ");", "SecByteBlock", "buf", "(", "bc", ")", ";"], "docstring_tokens": ["the", "memory", "blocks", "wiped", "for", "a", "large", "allocation"]}
{"contents": ["drm/vmwgfx:", "limit", "the", "number", "of", "mip", "levels", "in", "vmw_gb_surface_define_ioctl()", "The", "'req->mip_levels'", "parameter", "in", "vmw_gb_surface_define_ioctl()", "is", "a", "user-controlled", "'uint32_t'", "value", "which", "is", "used", "as", "a", "loop", "count", "limit.", "This", "can", "lead", "to", "a", "kernel", "lockup", "and", "DoS.", "Add", "check", "for", "'req->mip_levels'.", "References:", "https://bugzilla.redhat.com/show_bug.cgi?id=1437431", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Vladis", "Dronov", "<vdronov@redhat.com>", "Reviewed-by:", "Sinclair", "Yeh", "<syeh@vmware.com>"], "code_tokens": ["@", "@", "-", "1279", ",", "6", "+", "1279", ",", "9", "@", "@", "int", "vmw_gb_surface_define_ioctl", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "if", "(", "req", "-", ">", "multisample_count", "!", "=", "0", ")", "return", "-", "EINVAL", ";", "if", "(", "req", "-", ">", "mip_levels", ">", "DRM_VMW_MAX_MIP_LEVELS", ")", "return", "-", "EINVAL", ";", "if", "(", "unlikely", "(", "vmw_user_surface_size", "=", "=", "0", ")", ")", "vmw_user_surface_size", "=", "ttm_round_pot", "(", "sizeof", "(", "*", "user_srf", ")", ")", "+", "128", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "hang", ")"]}
{"contents": ["xfrm:", "policy:", "check", "policy", "direction", "value", "The", "'dir'", "parameter", "in", "xfrm_migrate()", "is", "a", "user-controlled", "byte", "which", "is", "used", "as", "an", "array", "index.", "This", "can", "lead", "to", "an", "out-of-bound", "access,", "kernel", "lockup", "and", "DoS.", "Add", "a", "check", "for", "the", "'dir'", "value.", "This", "fixes", ".", "References:", "https://bugzilla.redhat.com/show_bug.cgi?id=1474928", "Fixes:", "80c9abaabf42", "(\"[XFRM]:", "Extension", "for", "dynamic", "update", "of", "endpoint", "address(es)\")", "Cc:", "<stable@vger.kernel.org>", "#", "v2.6.21-rc1", "Reported-by:", "\"bo", "Zhang\"", "<zhangbo5891001@gmail.com>", "Signed-off-by:", "Vladis", "Dronov", "<vdronov@redhat.com>", "Signed-off-by:", "Steffen", "Klassert", "<steffen.klassert@secunet.com>"], "code_tokens": ["@", "@", "-", "3308", ",", "9", "+", "3308", ",", "15", "@", "@", "int", "xfrm_migrate", "(", "const", "struct", "xfrm_selector", "*", "sel", ",", "u8", "dir", ",", "u8", "type", ",", "struct", "xfrm_state", "*", "x_new", "[", "XFRM_MAX_DEPTH", "]", ";", "struct", "xfrm_migrate", "*", "mp", ";", "/", "*", "Stage", "0", "-", "sanity", "checks", "*", "/", "if", "(", "(", "err", "=", "xfrm_migrate_check", "(", "m", ",", "num_migrate", ")", ")", "<", "0", ")", "goto", "out", ";", "if", "(", "dir", ">", "=", "XFRM_POLICY_MAX", ")", "{", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "/", "*", "Stage", "1", "-", "find", "policy", "*", "/", "if", "(", "(", "pol", "=", "xfrm_migrate_policy_find", "(", "sel", ",", "dir", ",", "type", ",", "net", ")", ")", "=", "=", "NULL", ")", "{", "err", "=", "-", "ENOENT", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(out-of-bounds", "access", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["QPID-8203:", "[Broker-J][AMQP", "0-9]", "Fix", "maximum", "message", "size", "check"], "code_tokens": ["@", "@", "-", "2217", ",", "7", "+", "2217", ",", "10", "@", "@", "public", "void", "receiveMessageHeader", "(", "final", "BasicContentHeaderProperties", "properties", ",", "closeChannel", "(", "ErrorCodes", ".", "MESSAGE_TOO_LARGE", ",", "\"", "Message", "size", "of", "\"", "+", "bodySize", "+", "\"", "greater", "than", "allowed", "maximum", "of", "\"", "+", "_connection", ".", "getMaxMessageSize", "(", "))", ";", "}", "publishContentHeader", "(", "new", "ContentHeaderBody", "(", "properties", ",", "bodySize", ")", ");", "else", "{", "publishContentHeader", "(", "new", "ContentHeaderBody", "(", "properties", ",", "bodySize", ")", ");", "}", "}", "else", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "*", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "/", "package", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "v0_8", ".", "extension", ".", "maxsize", ";", "import", "static", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerAdmin", ".", "KIND_BROKER_J", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "java", ".", "net", ".", "InetSocketAddress", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "java", ".", "util", ".", "stream", ".", "Stream", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "protocol", ".", "v0_8", ".", "transport", ".", "ChannelCloseBody", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "protocol", ".", "v0_8", ".", "transport", ".", "ChannelOpenOkBody", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "protocol", ".", "v0_8", ".", "transport", ".", "ConnectionCloseOkBody", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "ChannelClosedResponse", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "v0_8", ".", "FrameTransport", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "v0_8", ".", "Interaction", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerAdmin", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerAdminUsingTestBase", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerSpecific", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "ConfigItem", ";", "@", "BrokerSpecific", "(", "kind", "=", "KIND_BROKER_J", ")", "@", "ConfigItem", "(", "name", "=", "\"", "qpid", ".", "max_message_size", "\"", ",", "value", "=", "\"", "1000", "\"", ")", "public", "class", "MaximumMessageSize", "extends", "BrokerAdminUsingTestBase", "{", "private", "InetSocketAddress", "_brokerAddress", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "_brokerAddress", "=", "getBrokerAdmin", "(", ").", "getBrokerAddress", "(", "BrokerAdmin", ".", "PortType", ".", "ANONYMOUS_AMQP", ")", ";", "getBrokerAdmin", "(", ").", "createQueue", "(", "BrokerAdmin", ".", "TEST_QUEUE_NAME", ")", ";", "}", "@", "Test", "public", "void", "limitExceeded", "(", ")", "throws", "Exception", "{", "String", "content", "=", "Stream", ".", "generate", "(", "()", "-", ">", "String", ".", "valueOf", "(", "'.", "')", ").", "limit", "(", "1001", ")", ".", "collect", "(", "Collectors", ".", "joining", "(", "))", ";", "try", "(", "FrameTransport", "transport", "=", "new", "FrameTransport", "(", "_brokerAddress", ")", ".", "connect", "(", "))", "{", "final", "Interaction", "interaction", "=", "transport", ".", "newInteraction", "(", ");", "interaction", ".", "openAnonymousConnection", "(", ")", ".", "channel", "(", ").", "open", "(", ").", "consumeResponse", "(", "ChannelOpenOkBody", ".", "class", ")", ".", "basic", "(", ").", "contentHeaderPropertiesContentType", "(", "\"", "text", "/", "plain", "\"", ")", ".", "contentHeaderPropertiesDeliveryMode", "(", "(", "byte", ")", "1", ")", ".", "contentHeaderPropertiesPriority", "(", "(", "byte", ")", "1", ")", ".", "publishExchange", "(", "\"\"", ")", ".", "publishRoutingKey", "(", "BrokerAdmin", ".", "TEST_QUEUE_NAME", ")", ".", "content", "(", "content", ")", ".", "publishMessage", "(", ")", ".", "consumeResponse", "(", "ChannelCloseBody", ".", "class", ")", ".", "channel", "(", ").", "closeOk", "(", ")", ".", "connection", "(", ").", "close", "(", ")", ".", "consumeResponse", "(", "ConnectionCloseOkBody", ".", "class", ",", "ChannelClosedResponse", ".", "class", ")", ";", "assertThat", "(", "getBrokerAdmin", "(", ").", "getQueueDepthMessages", "(", "BrokerAdmin", ".", "TEST_QUEUE_NAME", ")", ",", "is", "(", "equalTo", "(", "0", ")", "))", ";", "}", "}", "}"], "docstring_tokens": ["the", "broker", "to", "crash"]}
{"contents": ["ZOOKEEPER-2935:", "[QP", "MutualAuth]:", "Port", "ZOOKEEPER-1045", "implementation", "from", "branch-3.5", "to", "trunk", "Author:", "Abraham", "Fine", "<afine@apache.org>", "Reviewers:", "phunt@apache.org", "Closes", "#417", "from", "afine/ZOOKEEPER-2935", "and", "squashes", "the", "following", "commits:", "99bfbe94", "[Abraham", "Fine]", "Add", "debugging", "line", "and", "improve", "ivy.xml", "by", "removing", "unnecessary", "excludes", "1d6c7de5", "[Abraham", "Fine]", "Fix", "missing", "test.data.kerberos.dir", "in", "build.xml", "06d0b6fa", "[Abraham", "Fine]", "ZOOKEEPER-2935:", "[QP", "MutualAuth]:", "Port", "ZOOKEEPER-1045", "implementation", "from", "branch-3.5", "to", "trunk.", "Change-Id:", "I2b88221c0006e4336a39f74fd5a87d1aded68c90"], "code_tokens": ["@", "@", "-", "79", ",", "6", "+", "79", ",", "7", "@", "@", "xmlns", ":", "cs", "=", "\"", "antlib", ":", "com", ".", "puppycrawl", ".", "tools", ".", "checkstyle", ".", "ant", "\"", ">", "<", "property", "name", "=", "\"", "test", ".", "data", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "java", ".", "build", ".", "dir", "}", "/", "data", "\"", "/", ">", "<", "property", "name", "=", "\"", "test", ".", "data", ".", "invalid", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "data", ".", "dir", "}", "/", "invalidsnap", "\"", "/", ">", "<", "property", "name", "=", "\"", "test", ".", "data", ".", "buffersize", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "data", ".", "dir", "}", "/", "buffersize", "\"", "/", ">", "<", "property", "name", "=", "\"", "test", ".", "data", ".", "kerberos", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "data", ".", "dir", "}", "/", "kerberos", "\"", "/", ">", "<", "property", "name", "=", "\"", "test", ".", "data", ".", "ssl", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "data", ".", "dir", "}", "/", "ssl", "\"", "/", ">", "<", "property", "name", "=", "\"", "test", ".", "cppunit", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "java", ".", "build", ".", "dir", "}", "/", "test", "-", "cppunit", "\"", "/>", "<", "property", "name", "=", "\"", "test", ".", "tmp", ".", "dir", "\"", "value", "=", "\"$", "{", "test", ".", "java", ".", "build", ".", "dir", "}", "/", "tmp", "\"", "/", ">", "@", "@", "-", "226", ",", "6", "+", "227", ",", "9", "@", "@", "xmlns", ":", "cs", "=", "\"", "antlib", ":", "com", ".", "puppycrawl", ".", "tools", ".", "checkstyle", ".", "ant", "\"", ">", "<", "property", "name", "=", "\"", "jackson", "-", "mapper", "-", "asl", ".", "version", "\"", "value", "=", "\"", "1", ".", "9", ".", "11", "\"", "/>", "<", "property", "name", "=", "\"", "dependency", "-", "check", "-", "ant", ".", "version", "\"", "value", "=", "\"", "2", ".", "1", ".", "0", "\"", "/>", "<", "property", "name", "=", "\"", "commons", "-", "io", ".", "version", "\"", "value", "=", "\"", "2", ".", "4", "\"", "/>", "<", "property", "name", "=", "\"", "kerby", ".", "version", "\"", "value", "=", "\"", "1", ".", "0", ".", "0", "-", "RC2", "\"", "/>", "<", "!-", "-", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "-", "->", "<", "!-", "-", "Macro", "definitions", "-", "->", "<", "!-", "-", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "-", "->", "@", "@", "-", "1165", ",", "6", "+", "1169", ",", "7", "@", "@", "xmlns", ":", "cs", "=", "\"", "antlib", ":", "com", ".", "puppycrawl", ".", "tools", ".", "checkstyle", ".", "ant", "\"", ">", "<", "delete", "dir", "=", "\"$", "{", "test", ".", "tmp", ".", "dir", "}", "\"", "/", ">", "<", "delete", "dir", "=", "\"$", "{", "test", ".", "data", ".", "invalid", ".", "dir", "}", "\"", "/", ">", "<", "delete", "dir", "=", "\"$", "{", "test", ".", "data", ".", "buffersize", ".", "dir", "}", "\"", "/", ">", "<", "delete", "dir", "=", "\"$", "{", "test", ".", "data", ".", "kerberos", ".", "dir", "}", "\"", "/", ">", "<", "delete", "dir", "=", "\"$", "{", "test", ".", "data", ".", "ssl", ".", "dir", "}", "\"", "/", ">", "<", "delete", "dir", "=", "\"$", "{", "test", ".", "data", ".", "dir", "}", "\"", "/", ">", "<", "mkdir", "dir", "=", "\"$", "{", "test", ".", "log", ".", "dir", "}", "\"", "/", ">", "@", "@", "-", "1182", ",", "6", "+", "1187", ",", "10", "@", "@", "xmlns", ":", "cs", "=", "\"", "antlib", ":", "com", ".", "puppycrawl", ".", "tools", ".", "checkstyle", ".", "ant", "\"", ">", "<", "copy", "todir", "=", "\"$", "{", "test", ".", "data", ".", "ssl", ".", "dir", "}", "\">", "<", "fileset", "dir", "=", "\"$", "{", "basedir", "}", "/", "src", "/", "java", "/", "test", "/", "data", "/", "ssl", "\"", "/>", "<", "/", "copy", ">", "<", "mkdir", "dir", "=", "\"$", "{", "test", ".", "data", ".", "kerberos", ".", "dir", "}", "\"", "/", ">", "<", "copy", "todir", "=", "\"$", "{", "test", ".", "data", ".", "kerberos", ".", "dir", "}", "\">", "<", "fileset", "dir", "=", "\"$", "{", "basedir", "}", "/", "src", "/", "java", "/", "test", "/", "data", "/", "kerberos", "\"", "/>", "<", "/", "copy", ">", "<", "/", "target", ">", "<", "target", "name", "=", "\"", "junit", "-", "init", "\"", "depends", "=", "\"", "test", "-", "category", "\"", ">", "@", "@", "-", "90", ",", "6", "+", "90", ",", "39", "@", "@", "<", "dependency", "org", "=", "\"", "org", ".", "owasp", "\"", "name", "=", "\"", "dependency", "-", "check", "-", "ant", "\"", "rev", "=", "\"$", "{", "dependency", "-", "check", "-", "ant", ".", "version", "}", "\"", "conf", "=", "\"", "owasp", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "commons", "-", "io", "\"", "name", "=", "\"", "commons", "-", "io", "\"", "rev", "=", "\"$", "{", "commons", "-", "io", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerby", "-", "config", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", ">", "<", "exclude", "org", "=", "\"", "org", ".", "slf4j", "\"", "module", "=", "\"", "slf4j", "-", "api", "\"", "/>", "<", "exclude", "org", "=", "\"", "org", ".", "slf4j", "\"", "module", "=", "\"", "slf4j", "-", "log4j12", "\"", "/>", "<", "/", "dependency", ">", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "simplekdc", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", ">", "<", "exclude", "org", "=", "\"", "org", ".", "slf4j", "\"", "module", "=", "\"", "slf4j", "-", "api", "\"", "/>", "<", "/", "dependency", ">", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "core", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", ">", "<", "exclude", "org", "=", "\"", "org", ".", "slf4j", "\"", "module", "=", "\"", "slf4j", "-", "api", "\"", "/>", "<", "/", "dependency", ">", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "server", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "common", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "admin", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "identity", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "client", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "util", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerb", "-", "crypto", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerby", "-", "util", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "org", ".", "apache", ".", "kerby", "\"", "name", "=", "\"", "kerby", "-", "asn1", "\"", "rev", "=", "\"$", "{", "kerby", ".", "version", "}", "\"", "conf", "=", "\"", "test", "-", ">", "default", "\"", "/>", "<", "dependency", "org", "=", "\"", "net", ".", "java", ".", "dev", ".", "javacc", "\"", "name", "=", "\"", "javacc", "\"", "rev", "=", "\"$", "{", "javacc", ".", "version", "}", "\"", "conf", "=", "\"", "javacc", "-", ">", "default", "\"", "/", ">", "@", "@", "-", "299", ",", "7", "+", "299", ",", "7", "@", "@", "private", "synchronized", "LoginContext", "login", "(", "final", "String", "loginContextName", ")", "throws", "Lo", "}", "LoginContext", "loginContext", "=", "new", "LoginContext", "(", "loginContextName", ",", "callbackHandler", ")", ";", "loginContext", ".", "login", "(", ");", "LOG", ".", "info", "(", "\"", "successfully", "logged", "in", ".", "\")", ";", "LOG", ".", "info", "(", "\"{", "}", "successfully", "logged", "in", ".", "\",", "loginContextName", ")", ";", "return", "loginContext", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "104", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "Callback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "CallbackHandler", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "NameCallback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "PasswordCallback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "UnsupportedCallbackException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "AuthorizeCallback", ";", "import", "javax", ".", "security", ".", "sasl", ".", "RealmCallback", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "This", "is", "used", "by", "the", "SASL", "mechanisms", "to", "get", "further", "information", "to", "complete", "*", "the", "authentication", ".", "For", "example", ",", "a", "SASL", "mechanism", "might", "use", "this", "callback", "*", "handler", "to", "do", "verification", "operation", ".", "The", "CallbackHandler", "interface", "here", "*", "refers", "to", "javax", ".", "security", ".", "auth", ".", "callback", ".", "CallbackHandler", ".", "It", "should", "not", "be", "*", "confused", "with", "ZooKeeper", "packet", "callbacks", "like", "*", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "SaslServerCallbackHandler", ".", "*", "/", "public", "class", "SaslClientCallbackHandler", "implements", "CallbackHandler", "{", "private", "String", "password", "=", "null", ";", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "SaslClientCallbackHandler", ".", "class", ")", ";", "private", "final", "String", "entity", ";", "public", "SaslClientCallbackHandler", "(", "String", "password", ",", "String", "client", ")", "{", "this", ".", "password", "=", "password", ";", "this", ".", "entity", "=", "client", ";", "}", "public", "void", "handle", "(", "Callback", "[", "]", "callbacks", ")", "throws", "UnsupportedCallbackException", "{", "for", "(", "Callback", "callback", ":", "callbacks", ")", "{", "if", "(", "callback", "instanceof", "NameCallback", ")", "{", "NameCallback", "nc", "=", "(", "NameCallback", ")", "callback", ";", "nc", ".", "setName", "(", "nc", ".", "getDefaultName", "(", "))", ";", "}", "else", "{", "if", "(", "callback", "instanceof", "PasswordCallback", ")", "{", "PasswordCallback", "pc", "=", "(", "PasswordCallback", ")", "callback", ";", "if", "(", "password", "!", "=", "null", ")", "{", "pc", ".", "setPassword", "(", "this", ".", "password", ".", "toCharArray", "(", "))", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "Could", "not", "login", ":", "the", "{", "}", "is", "being", "asked", "for", "a", "password", ",", "but", "the", "ZooKeeper", "{", "}\"", "\"", "code", "does", "not", "currently", "support", "obtaining", "a", "password", "from", "the", "user", ".", "\"", "\"", "Make", "sure", "that", "the", "{", "}", "is", "configured", "to", "use", "a", "ticket", "cache", "(", "using", "\"", "\"", "the", "JAAS", "configuration", "setting", "'", "useTicketCache", "=", "true", ")", "'", "and", "restart", "the", "{", "}.", "If", "\"", "\"", "you", "still", "get", "this", "message", "after", "that", ",", "the", "TGT", "in", "the", "ticket", "cache", "has", "expired", "and", "must", "\"", "\"", "be", "manually", "refreshed", ".", "To", "do", "so", ",", "first", "determine", "if", "you", "are", "using", "a", "password", "or", "a", "\"", "\"", "keytab", ".", "If", "the", "former", ",", "run", "kinit", "in", "a", "Unix", "shell", "in", "the", "environment", "of", "the", "user", "who", "\"", "\"", "is", "running", "this", "Zookeeper", "{", "}", "using", "the", "command", "\"", "\"", "'", "kinit", "<", "princ", ">", "'", "(", "where", "<", "princ", ">", "is", "the", "name", "of", "the", "{", "}'", "s", "Kerberos", "principal", ")", ".\"", "\"", "If", "the", "latter", ",", "do", "\"", "\"", "'", "kinit", "-", "k", "-", "t", "<", "keytab", ">", "<", "princ", ">", "'", "(", "where", "<", "princ", ">", "is", "the", "name", "of", "the", "Kerberos", "principal", ",", "and", "\"", "\"", "<", "keytab", ">", "is", "the", "location", "of", "the", "keytab", "file", ")", ".", "After", "manually", "refreshing", "your", "cache", ",", "\"", "\"", "restart", "this", "{", "}.", "If", "you", "continue", "to", "see", "this", "message", "after", "manually", "refreshing", "\"", "\"", "your", "cache", ",", "ensure", "that", "your", "KDC", "host", "'", "s", "clock", "is", "in", "sync", "with", "this", "host", "'", "s", "clock", ".", "\",", "new", "Object", "[", "]{", "entity", ",", "entity", ",", "entity", ",", "entity", ",", "entity", ",", "entity", ",", "entity", "}", ");", "}", "}", "else", "{", "if", "(", "callback", "instanceof", "RealmCallback", ")", "{", "RealmCallback", "rc", "=", "(", "RealmCallback", ")", "callback", ";", "rc", ".", "setText", "(", "rc", ".", "getDefaultText", "(", "))", ";", "}", "else", "{", "if", "(", "callback", "instanceof", "AuthorizeCallback", ")", "{", "AuthorizeCallback", "ac", "=", "(", "AuthorizeCallback", ")", "callback", ";", "String", "authid", "=", "ac", ".", "getAuthenticationID", "(", ");", "String", "authzid", "=", "ac", ".", "getAuthorizationID", "(", ");", "if", "(", "authid", ".", "equals", "(", "authzid", ")", ")", "{", "ac", ".", "setAuthorized", "(", "true", ")", ";", "}", "else", "{", "ac", ".", "setAuthorized", "(", "false", ")", ";", "}", "if", "(", "ac", ".", "isAuthorized", "(", "))", "{", "ac", ".", "setAuthorizedID", "(", "authzid", ")", ";", "}", "}", "else", "{", "throw", "new", "UnsupportedCallbackException", "(", "callback", ",", "\"", "Unrecognized", "SASL", "\"", "+", "entity", "+", "\"", "Callback", "\"", ");", "}", "}", "}", "}", "}", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "19", ",", "40", "+", "19", ",", "27", "@", "@", "package", "org", ".", "apache", ".", "zookeeper", ".", "client", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "PrivilegedActionException", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "Callback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "CallbackHandler", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "NameCallback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "PasswordCallback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "UnsupportedCallbackException", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "AppConfigurationEntry", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "Configuration", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "LoginException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "AuthorizeCallback", ";", "import", "javax", ".", "security", ".", "sasl", ".", "RealmCallback", ";", "import", "javax", ".", "security", ".", "sasl", ".", "Sasl", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslClient", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "AsyncCallback", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ClientCnxn", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "Login", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "SaslClientCallbackHandler", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "Watcher", ".", "Event", ".", "KeeperState", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "ZKConfig", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "data", ".", "Stat", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "proto", ".", "GetSASLRequest", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "proto", ".", "SetSASLResponse", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "KerberosName", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSContext", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSCredential", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSException", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSManager", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "Oid", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "util", ".", "SecurityUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "259", ",", "84", "+", "246", ",", "14", "@", "@", "private", "SaslClient", "createSaslClient", "(", "final", "String", "servicePrincipal", ",", "final", "String", "}", "/", "/", "note", "that", "the", "login", "object", "is", "static", ":", "it", "'", "s", "shared", "amongst", "all", "zookeeper", "-", "related", "connections", ".", "/", "/", "in", "order", "to", "ensure", "the", "login", "is", "initialized", "only", "once", ",", "it", "must", "be", "synchronized", "the", "code", "snippet", ".", "login", "=", "new", "Login", "(", "loginContext", ",", "new", "ClientCallbackHandler", "(", "null", ")", ",", "clientConfig", ")", ";", "login", "=", "new", "Login", "(", "loginContext", ",", "new", "SaslClientCallbackHandler", "(", "null", ",", "\"", "Client", "\"", "),", "clientConfig", ")", ";", "login", ".", "startThreadIfNeeded", "(", ");", "initializedLogin", "=", "true", ";", "}", "}", "}", "Subject", "subject", "=", "login", ".", "getSubject", "(", ");", "SaslClient", "saslClient", ";", "/", "/", "Use", "subject", ".", "getPrincipals", "(", ").", "isEmpty", "(", ")", "as", "an", "indication", "of", "which", "SASL", "mechanism", "to", "use", ":", "/", "/", "if", "empty", ",", "use", "DIGEST", "-", "MD5", ";", "otherwise", ",", "use", "GSSAPI", ".", "if", "(", "subject", ".", "getPrincipals", "(", ").", "isEmpty", "(", "))", "{", "/", "/", "no", "principals", ":", "must", "not", "be", "GSSAPI", ":", "use", "DIGEST", "-", "MD5", "mechanism", "instead", ".", "LOG", ".", "info", "(", "\"", "Client", "will", "use", "DIGEST", "-", "MD5", "as", "SASL", "mechanism", ".", "\")", ";", "String", "[", "]", "mechs", "=", "{", "\"", "DIGEST", "-", "MD5", "\"", "};", "String", "username", "=", "(", "String", ")", "(", "subject", ".", "getPublicCredentials", "(", ").", "toArray", "(", ")[", "0", "]", ");", "String", "password", "=", "(", "String", ")", "(", "subject", ".", "getPrivateCredentials", "(", ").", "toArray", "(", ")[", "0", "]", ");", "/", "/", "\"", "zk", "-", "sasl", "-", "md5", "\"", "is", "a", "hard", "-", "wired", "'", "domain", "'", "parameter", "shared", "with", "zookeeper", "server", "code", "(", "see", "ServerCnxnFactory", ".", "java", ")", "saslClient", "=", "Sasl", ".", "createSaslClient", "(", "mechs", ",", "username", ",", "\"", "zookeeper", "\"", ",", "\"", "zk", "-", "sasl", "-", "md5", "\"", ",", "null", ",", "new", "ClientCallbackHandler", "(", "password", ")", ");", "return", "saslClient", ";", "}", "else", "{", "/", "/", "GSSAPI", ".", "boolean", "usingNativeJgss", "=", "clientConfig", ".", "getBoolean", "(", "ZKConfig", ".", "JGSS_NATIVE", ")", ";", "if", "(", "usingNativeJgss", ")", "{", "/", "/", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "6", "/", "docs", "/", "technotes", "/", "guides", "/", "security", "/", "jgss", "/", "jgss", "-", "features", ".", "html", "/", "/", "\"", "\"\"", "/", "/", "In", "addition", ",", "when", "performing", "operations", "as", "a", "particular", "/", "/", "Subject", ",", "e", ".", "g", ".", "Subject", ".", "doAs", "(", "..", ".)", "or", "Subject", ".", "doAsPrivileged", "(", "..", ".)", ",", "/", "/", "the", "to", "-", "be", "-", "used", "GSSCredential", "should", "be", "added", "to", "Subject", "'", "s", "/", "/", "private", "credential", "set", ".", "Otherwise", ",", "the", "GSS", "operations", "will", "/", "/", "fail", "since", "no", "credential", "is", "found", ".", "/", "/", "\"", "\"\"", "try", "{", "GSSManager", "manager", "=", "GSSManager", ".", "getInstance", "(", ");", "Oid", "krb5Mechanism", "=", "new", "Oid", "(", "\"", "1", ".", "2", ".", "840", ".", "113554", ".", "1", ".", "2", ".", "2", "\"", ");", "GSSCredential", "cred", "=", "manager", ".", "createCredential", "(", "null", ",", "GSSContext", ".", "DEFAULT_LIFETIME", ",", "krb5Mechanism", ",", "GSSCredential", ".", "INITIATE_ONLY", ")", ";", "subject", ".", "getPrivateCredentials", "(", ").", "add", "(", "cred", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", "))", "{", "LOG", ".", "debug", "(", "\"", "Added", "private", "credential", "to", "subject", ":", "\"", "+", "cred", ")", ";", "}", "}", "catch", "(", "GSSException", "ex", ")", "{", "LOG", ".", "warn", "(", "\"", "Cannot", "add", "private", "credential", "to", "subject", ";", "\"", "+", "\"", "authentication", "at", "the", "server", "may", "fail", "\"", ",", "ex", ")", ";", "}", "}", "final", "Object", "[", "]", "principals", "=", "subject", ".", "getPrincipals", "(", ").", "toArray", "(", ");", "/", "/", "determine", "client", "principal", "from", "subject", ".", "final", "Principal", "clientPrincipal", "=", "(", "Principal", ")", "principals", "[", "0", "]", ";", "final", "KerberosName", "clientKerberosName", "=", "new", "KerberosName", "(", "clientPrincipal", ".", "getName", "(", "))", ";", "/", "/", "assume", "that", "server", "and", "client", "are", "in", "the", "same", "realm", "(", "by", "default", ";", "unless", "the", "system", "property", "/", "/", "\"", "zookeeper", ".", "server", ".", "realm", "\"", "is", "set", ")", ".", "String", "serverRealm", "=", "clientConfig", ".", "getProperty", "(", "ZKClientConfig", ".", "ZOOKEEPER_SERVER_REALM", ",", "clientKerberosName", ".", "getRealm", "(", "))", ";", "KerberosName", "serviceKerberosName", "=", "new", "KerberosName", "(", "servicePrincipal", "+", "\"@", "\"+", "serverRealm", ")", ";", "final", "String", "serviceName", "=", "serviceKerberosName", ".", "getServiceName", "(", ");", "final", "String", "serviceHostname", "=", "serviceKerberosName", ".", "getHostName", "(", ");", "final", "String", "clientPrincipalName", "=", "clientKerberosName", ".", "toString", "(", ");", "try", "{", "saslClient", "=", "Subject", ".", "doAs", "(", "subject", ",", "new", "PrivilegedExceptionAction", "<", "SaslClient", ">", "()", "{", "public", "SaslClient", "run", "(", ")", "throws", "SaslException", "{", "LOG", ".", "info", "(", "\"", "Client", "will", "use", "GSSAPI", "as", "SASL", "mechanism", ".", "\")", ";", "String", "[", "]", "mechs", "=", "{", "\"", "GSSAPI", "\"", "};", "LOG", ".", "debug", "(", "\"", "creating", "sasl", "client", ":", "client", "=", "\"+", "clientPrincipalName", "+", "\";", "service", "=", "\"+", "serviceName", "+", "\";", "serviceHostname", "=", "\"+", "serviceHostname", ")", ";", "SaslClient", "saslClient", "=", "Sasl", ".", "createSaslClient", "(", "mechs", ",", "clientPrincipalName", ",", "serviceName", ",", "serviceHostname", ",", "null", ",", "new", "ClientCallbackHandler", "(", "null", ")", ");", "return", "saslClient", ";", "}", "}", ");", "return", "saslClient", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "while", "trying", "to", "create", "SASL", "client", "\"", ",", "e", ")", ";", "e", ".", "printStackTrace", "(", ");", "return", "null", ";", "}", "}", "return", "SecurityUtils", ".", "createSaslClient", "(", "login", ".", "getSubject", "(", "),", "servicePrincipal", ",", "\"", "zookeeper", "\"", ",", "\"", "zk", "-", "sasl", "-", "md5", "\"", ",", "LOG", ",", "\"", "Client", "\"", ");", "}", "catch", "(", "LoginException", "e", ")", "{", "/", "/", "We", "throw", "LoginExceptions", ".", "..", "throw", "e", ";", "@", "@", "-", "505", ",", "75", "+", "422", ",", "6", "@", "@", "public", "void", "initialize", "(", "ClientCnxn", "cnxn", ")", "throws", "SaslException", "{", "}", "}", "/", "/", "The", "CallbackHandler", "interface", "here", "refers", "to", "/", "/", "javax", ".", "security", ".", "auth", ".", "callback", ".", "CallbackHandler", ".", "/", "/", "It", "should", "not", "be", "confused", "with", "Zookeeper", "packet", "callbacks", "like", "/", "/", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "SaslServerCallbackHandler", ".", "public", "static", "class", "ClientCallbackHandler", "implements", "CallbackHandler", "{", "private", "String", "password", "=", "null", ";", "public", "ClientCallbackHandler", "(", "String", "password", ")", "{", "this", ".", "password", "=", "password", ";", "}", "public", "void", "handle", "(", "Callback", "[", "]", "callbacks", ")", "throws", "UnsupportedCallbackException", "{", "for", "(", "Callback", "callback", ":", "callbacks", ")", "{", "if", "(", "callback", "instanceof", "NameCallback", ")", "{", "NameCallback", "nc", "=", "(", "NameCallback", ")", "callback", ";", "nc", ".", "setName", "(", "nc", ".", "getDefaultName", "(", "))", ";", "}", "else", "{", "if", "(", "callback", "instanceof", "PasswordCallback", ")", "{", "PasswordCallback", "pc", "=", "(", "PasswordCallback", ")", "callback", ";", "if", "(", "password", "!", "=", "null", ")", "{", "pc", ".", "setPassword", "(", "this", ".", "password", ".", "toCharArray", "(", "))", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "Could", "not", "login", ":", "the", "client", "is", "being", "asked", "for", "a", "password", ",", "but", "the", "Zookeeper", "\"", "+", "\"", "client", "code", "does", "not", "currently", "support", "obtaining", "a", "password", "from", "the", "user", ".", "\"", "+", "\"", "Make", "sure", "that", "the", "client", "is", "configured", "to", "use", "a", "ticket", "cache", "(", "using", "\"", "+", "\"", "the", "JAAS", "configuration", "setting", "'", "useTicketCache", "=", "true", ")", "'", "and", "restart", "the", "client", ".", "If", "\"", "+", "\"", "you", "still", "get", "this", "message", "after", "that", ",", "the", "TGT", "in", "the", "ticket", "cache", "has", "expired", "and", "must", "\"", "+", "\"", "be", "manually", "refreshed", ".", "To", "do", "so", ",", "first", "determine", "if", "you", "are", "using", "a", "password", "or", "a", "\"", "+", "\"", "keytab", ".", "If", "the", "former", ",", "run", "kinit", "in", "a", "Unix", "shell", "in", "the", "environment", "of", "the", "user", "who", "\"", "+", "\"", "is", "running", "this", "Zookeeper", "client", "using", "the", "command", "\"", "+", "\"", "'", "kinit", "<", "princ", ">", "'", "(", "where", "<", "princ", ">", "is", "the", "name", "of", "the", "client", "'", "s", "Kerberos", "principal", ")", ".\"", "+", "\"", "If", "the", "latter", ",", "do", "\"", "+", "\"", "'", "kinit", "-", "k", "-", "t", "<", "keytab", ">", "<", "princ", ">", "'", "(", "where", "<", "princ", ">", "is", "the", "name", "of", "the", "Kerberos", "principal", ",", "and", "\"", "+", "\"", "<", "keytab", ">", "is", "the", "location", "of", "the", "keytab", "file", ")", ".", "After", "manually", "refreshing", "your", "cache", ",", "\"", "+", "\"", "restart", "this", "client", ".", "If", "you", "continue", "to", "see", "this", "message", "after", "manually", "refreshing", "\"", "+", "\"", "your", "cache", ",", "ensure", "that", "your", "KDC", "host", "'", "s", "clock", "is", "in", "sync", "with", "this", "host", "'", "s", "clock", ".", "\")", ";", "}", "}", "else", "{", "if", "(", "callback", "instanceof", "RealmCallback", ")", "{", "RealmCallback", "rc", "=", "(", "RealmCallback", ")", "callback", ";", "rc", ".", "setText", "(", "rc", ".", "getDefaultText", "(", "))", ";", "}", "else", "{", "if", "(", "callback", "instanceof", "AuthorizeCallback", ")", "{", "AuthorizeCallback", "ac", "=", "(", "AuthorizeCallback", ")", "callback", ";", "String", "authid", "=", "ac", ".", "getAuthenticationID", "(", ");", "String", "authzid", "=", "ac", ".", "getAuthorizationID", "(", ");", "if", "(", "authid", ".", "equals", "(", "authzid", ")", ")", "{", "ac", ".", "setAuthorized", "(", "true", ")", ";", "}", "else", "{", "ac", ".", "setAuthorized", "(", "false", ")", ";", "}", "if", "(", "ac", ".", "isAuthorized", "(", "))", "{", "ac", ".", "setAuthorizedID", "(", "authzid", ")", ";", "}", "}", "else", "{", "throw", "new", "UnsupportedCallbackException", "(", "callback", ",", "\"", "Unrecognized", "SASL", "ClientCallback", "\"", ");", "}", "}", "}", "}", "}", "}", "}", "public", "boolean", "clientTunneledAuthenticationInProgress", "(", ")", "{", "if", "(", "!", "isSASLConfigured", ")", "{", "return", "false", ";", "@", "@", "-", "24", ",", "7", "+", "24", ",", "13", "@", "@", "import", "java", ".", "net", ".", "InetSocketAddress", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "security", ".", "cert", ".", "Certificate", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicLong", ";", "@", "@", "-", "18", ",", "22", "+", "18", ",", "12", "@", "@", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "PrivilegedActionException", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "javax", ".", "security", ".", "sasl", ".", "Sasl", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "Login", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSContext", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSCredential", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSException", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSManager", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSName", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "Oid", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "util", ".", "SecurityUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "51", ",", "114", "+", "41", ",", "9", "@", "@", "private", "SaslServer", "createSaslServer", "(", "final", "Login", "login", ")", "{", "synchronized", "(", "login", ")", "{", "Subject", "subject", "=", "login", ".", "getSubject", "(", ");", "if", "(", "subject", "!", "=", "null", ")", "{", "/", "/", "server", "is", "using", "a", "JAAS", "-", "authenticated", "subject", ":", "determine", "service", "principal", "name", "and", "hostname", "from", "zk", "server", "'", "s", "subject", ".", "if", "(", "subject", ".", "getPrincipals", "(", ").", "size", "(", ")", ">", "0", ")", "{", "try", "{", "final", "Object", "[", "]", "principals", "=", "subject", ".", "getPrincipals", "(", ").", "toArray", "(", ");", "final", "Principal", "servicePrincipal", "=", "(", "Principal", ")", "principals", "[", "0", "]", ";", "/", "/", "e", ".", "g", ".", "servicePrincipalNameAndHostname", ":", "=", "\"", "zookeeper", "/", "myhost", ".", "foo", ".", "com", "@", "FOO", ".", "COM", "\"", "final", "String", "servicePrincipalNameAndHostname", "=", "servicePrincipal", ".", "getName", "(", ");", "int", "indexOf", "=", "servicePrincipalNameAndHostname", ".", "indexOf", "(", "\"/", "\")", ";", "/", "/", "e", ".", "g", ".", "serviceHostnameAndKerbDomain", ":", "=", "\"", "myhost", ".", "foo", ".", "com", "@", "FOO", ".", "COM", "\"", "final", "String", "serviceHostnameAndKerbDomain", "=", "servicePrincipalNameAndHostname", ".", "substring", "(", "indexOf", "+", "1", ",", "servicePrincipalNameAndHostname", ".", "length", "(", "))", ";", "int", "indexOfAt", "=", "serviceHostnameAndKerbDomain", ".", "indexOf", "(", "\"@", "\")", ";", "/", "/", "Handle", "Kerberos", "Service", "as", "well", "as", "User", "Principal", "Names", "final", "String", "servicePrincipalName", ",", "serviceHostname", ";", "if", "(", "indexOf", ">", "0", ")", "{", "/", "/", "e", ".", "g", ".", "servicePrincipalName", ":", "=", "\"", "zookeeper", "\"", "servicePrincipalName", "=", "servicePrincipalNameAndHostname", ".", "substring", "(", "0", ",", "indexOf", ")", ";", "/", "/", "e", ".", "g", ".", "serviceHostname", ":", "=", "\"", "myhost", ".", "foo", ".", "com", "\"", "serviceHostname", "=", "serviceHostnameAndKerbDomain", ".", "substring", "(", "0", ",", "indexOfAt", ")", ";", "}", "else", "{", "servicePrincipalName", "=", "servicePrincipalNameAndHostname", ".", "substring", "(", "0", ",", "indexOfAt", ")", ";", "serviceHostname", "=", "null", ";", "}", "final", "String", "mech", "=", "\"", "GSSAPI", "\"", ";", "/", "/", "TODO", ":", "should", "depend", "on", "zoo", ".", "cfg", "specified", "mechs", ",", "but", "if", "subject", "is", "non", "-", "null", ",", "it", "can", "be", "assumed", "to", "be", "GSSAPI", ".", "LOG", ".", "debug", "(", "\"", "serviceHostname", "is", "'", "\"+", "serviceHostname", "+", "\"", "'\"", ");", "LOG", ".", "debug", "(", "\"", "servicePrincipalName", "is", "'", "\"+", "servicePrincipalName", "+", "\"", "'\"", ");", "LOG", ".", "debug", "(", "\"", "SASL", "mechanism", "(", "mech", ")", "is", "'", "\"+", "mech", "+", "\"'", "\")", ";", "boolean", "usingNativeJgss", "=", "Boolean", ".", "getBoolean", "(", "\"", "sun", ".", "security", ".", "jgss", ".", "native", "\"", ");", "if", "(", "usingNativeJgss", ")", "{", "/", "/", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "6", "/", "docs", "/", "technotes", "/", "guides", "/", "security", "/", "jgss", "/", "jgss", "-", "features", ".", "html", "/", "/", "\"", "\"\"", "/", "/", "In", "addition", ",", "when", "performing", "operations", "as", "a", "particular", "/", "/", "Subject", ",", "e", ".", "g", ".", "Subject", ".", "doAs", "(", "..", ".)", "or", "/", "/", "Subject", ".", "doAsPrivileged", "(", "..", ".)", ",", "the", "to", "-", "be", "-", "used", "/", "/", "GSSCredential", "should", "be", "added", "to", "Subject", "'", "s", "/", "/", "private", "credential", "set", ".", "Otherwise", ",", "the", "GSS", "operations", "/", "/", "will", "fail", "since", "no", "credential", "is", "found", ".", "/", "/", "\"", "\"\"", "try", "{", "GSSManager", "manager", "=", "GSSManager", ".", "getInstance", "(", ");", "Oid", "krb5Mechanism", "=", "new", "Oid", "(", "\"", "1", ".", "2", ".", "840", ".", "113554", ".", "1", ".", "2", ".", "2", "\"", ");", "GSSName", "gssName", "=", "manager", ".", "createName", "(", "servicePrincipalName", "+", "\"", "@\"", "+", "serviceHostname", ",", "GSSName", ".", "NT_HOSTBASED_SERVICE", ")", ";", "GSSCredential", "cred", "=", "manager", ".", "createCredential", "(", "gssName", ",", "GSSContext", ".", "DEFAULT_LIFETIME", ",", "krb5Mechanism", ",", "GSSCredential", ".", "ACCEPT_ONLY", ")", ";", "subject", ".", "getPrivateCredentials", "(", ").", "add", "(", "cred", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", "))", "{", "LOG", ".", "debug", "(", "\"", "Added", "private", "credential", "to", "subject", ":", "\"", "+", "cred", ")", ";", "}", "}", "catch", "(", "GSSException", "ex", ")", "{", "LOG", ".", "warn", "(", "\"", "Cannot", "add", "private", "credential", "to", "subject", ";", "\"", "+", "\"", "clients", "authentication", "may", "fail", "\"", ",", "ex", ")", ";", "}", "}", "try", "{", "return", "Subject", ".", "doAs", "(", "subject", ",", "new", "PrivilegedExceptionAction", "<", "SaslServer", ">", "()", "{", "public", "SaslServer", "run", "(", ")", "{", "try", "{", "SaslServer", "saslServer", ";", "saslServer", "=", "Sasl", ".", "createSaslServer", "(", "mech", ",", "servicePrincipalName", ",", "serviceHostname", ",", "null", ",", "login", ".", "callbackHandler", ")", ";", "return", "saslServer", ";", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Zookeeper", "Server", "failed", "to", "create", "a", "SaslServer", "to", "interact", "with", "a", "client", "during", "session", "initiation", ":", "\"", "+", "e", ")", ";", "e", ".", "printStackTrace", "(", ");", "return", "null", ";", "}", "}", "}", ")", ";", "}", "catch", "(", "PrivilegedActionException", "e", ")", "{", "/", "/", "TODO", ":", "exit", "server", "at", "this", "point", "(", "?)", "LOG", ".", "error", "(", "\"", "Zookeeper", "Quorum", "member", "experienced", "a", "PrivilegedActionException", "exception", "while", "creating", "a", "SaslServer", "using", "a", "JAAS", "principal", "context", ":", "\"", "+", "e", ")", ";", "e", ".", "printStackTrace", "(", ");", "}", "}", "catch", "(", "IndexOutOfBoundsException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "server", "principal", "name", "/", "hostname", "determination", "error", ":", "\"", ",", "e", ")", ";", "}", "}", "else", "{", "/", "/", "JAAS", "non", "-", "GSSAPI", "authentication", ":", "assuming", "and", "supporting", "only", "DIGEST", "-", "MD5", "mechanism", "for", "now", ".", "/", "/", "TODO", ":", "use", "'", "authMech", "=", "'", "value", "in", "zoo", ".", "cfg", ".", "try", "{", "SaslServer", "saslServer", "=", "Sasl", ".", "createSaslServer", "(", "\"", "DIGEST", "-", "MD5", "\"", ",\"", "zookeeper", "\"", ",\"", "zk", "-", "sasl", "-", "md5", "\"", ",", "null", ",", "login", ".", "callbackHandler", ")", ";", "return", "saslServer", ";", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Zookeeper", "Quorum", "member", "failed", "to", "create", "a", "SaslServer", "to", "interact", "with", "a", "client", "during", "session", "initiation", "\"", ",", "e", ")", ";", "}", "}", "}", "return", "SecurityUtils", ".", "createSaslServer", "(", "subject", ",", "\"", "zookeeper", "\"", ",", "\"", "zk", "-", "sasl", "-", "md5", "\"", ",", "login", ".", "callbackHandler", ",", "LOG", ")", ";", "}", "LOG", ".", "error", "(", "\"", "failed", "to", "create", "saslServer", "object", ".", "\")", ";", "return", "null", ";", "}", "public", "byte", "[", "]", "evaluateResponse", "(", "byte", "[", "]", "response", ")", "throws", "SaslException", "{", "@", "@", "-", "61", ",", "6", "+", "61", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ServerCnxn", ".", "CloseRequestException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "SessionTracker", ".", "Session", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "SessionTracker", ".", "SessionExpirer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "AuthenticationProvider", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "ProviderRegistry", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "ServerAuthenticationProvider", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "persistence", ".", "FileTxnSnapLog", ";", "@", "@", "-", "46", ",", "13", "+", "46", ",", "15", "@", "@", "private", "String", "userName", ";", "private", "final", "Map", "<", "String", ",", "String", ">", "credentials", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "public", "SaslServerCallbackHandler", "(", "Configuration", "configuration", ")", "throws", "IOException", "{", "String", "serverSection", "=", "System", ".", "getProperty", "(", "ZooKeeperSaslServer", ".", "LOGIN_CONTEXT_NAME_KEY", ",", "ZooKeeperSaslServer", ".", "DEFAULT_LOGIN_CONTEXT_NAME", ")", ";", "public", "SaslServerCallbackHandler", "(", "Configuration", "configuration", ")", "throws", "IOException", "{", "String", "serverSection", "=", "System", ".", "getProperty", "(", "ZooKeeperSaslServer", ".", "LOGIN_CONTEXT_NAME_KEY", ",", "ZooKeeperSaslServer", ".", "DEFAULT_LOGIN_CONTEXT_NAME", ")", ";", "AppConfigurationEntry", "configurationEntries", "[", "]", "=", "configuration", ".", "getAppConfigurationEntry", "(", "serverSection", ")", ";", "if", "(", "configurationEntries", "=", "=", "null", ")", "{", "String", "errorMessage", "=", "\"", "Could", "not", "find", "a", "'", "Server", "'", "entry", "in", "this", "configuration", ":", "Server", "cannot", "start", ".", "\";", "String", "errorMessage", "=", "\"", "Could", "not", "find", "a", "'", "\"", "+", "serverSection", "+", "\"", "'", "entry", "in", "this", "configuration", ":", "Server", "cannot", "start", ".", "\";", "LOG", ".", "error", "(", "errorMessage", ")", ";", "throw", "new", "IOException", "(", "errorMessage", ")", ";", "}", "@", "@", "-", "1078", ",", "6", "+", "1078", ",", "8", "@", "@", "else", "if", "(", "self", ".", "getCurrentAndNextConfigVoters", "(", ").", "contains", "(", "n", ".", "sid", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "Failed", "to", "unregister", "with", "JMX", "\"", ",", "e", ")", ";", "}", "self", ".", "jmxLeaderElectionBean", "=", "null", ";", "LOG", ".", "debug", "(", "\"", "Number", "of", "connection", "processing", "threads", ":", "{", "}\"", ",", "manager", ".", "getConnectionThreadCount", "(", "))", ";", "}", "}", "}", "@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "Time", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "Request", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "flexible", ".", "QuorumVerifier", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeer", ".", "QuorumServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "util", ".", "SerializeUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "util", ".", "ZxidUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "txn", ".", "SetDataTxn", ";", "@", "@", "-", "71", ",", "9", "+", "72", ",", "9", "@", "@", "void", "followLeader", "(", ")", "throws", "InterruptedException", "{", "self", ".", "end_fle", "=", "0", ";", "fzk", ".", "registerJMX", "(", "new", "FollowerBean", "(", "this", ",", "zk", ")", ",", "self", ".", "jmxLocalPeerBean", ")", ";", "try", "{", "InetSocketAddress", "addr", "=", "findLeader", "(", ");", "QuorumServer", "leaderServer", "=", "findLeader", "(", ");", "try", "{", "connectToLeader", "(", "addr", ")", ";", "connectToLeader", "(", "leaderServer", ".", "addr", ",", "leaderServer", ".", "hostname", ")", ";", "long", "newEpochZxid", "=", "registerWithLeader", "(", "Leader", ".", "FOLLOWERINFO", ")", ";", "if", "(", "self", ".", "isReconfigStateChange", "(", "))", "throw", "new", "Exception", "(", "\"", "learned", "about", "role", "change", "\"", ");", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "BindException", ";", "import", "java", ".", "net", ".", "ServerSocket", ";", "@", "@", "-", "39", ",", "6", "+", "40", ",", "8", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentLinkedQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryOutputArchive", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ".", "OpCode", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "Time", ";", "@", "@", "-", "367", ",", "7", "+", "370", ",", "10", "@", "@", "public", "void", "run", "(", ")", "{", "/", "/", "in", "LearnerHandler", "switch", "to", "the", "syncLimit", "s", ".", "setSoTimeout", "(", "self", ".", "tickTime", "*", "self", ".", "initLimit", ")", ";", "s", ".", "setTcpNoDelay", "(", "nodelay", ")", ";", "LearnerHandler", "fh", "=", "new", "LearnerHandler", "(", "s", ",", "Leader", ".", "this", ")", ";", "BufferedInputStream", "is", "=", "new", "BufferedInputStream", "(", "s", ".", "getInputStream", "(", "))", ";", "LearnerHandler", "fh", "=", "new", "LearnerHandler", "(", "s", ",", "is", ",", "Leader", ".", "this", ")", ";", "fh", ".", "start", "(", ");", "}", "catch", "(", "SocketException", "e", ")", "{", "if", "(", "stop", ")", "{", "@", "@", "-", "381", ",", "6", "+", "387", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "}", "else", "{", "throw", "e", ";", "}", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "while", "connecting", "to", "quorum", "learner", "\"", ",", "e", ")", ";", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "@", "@", "-", "50", ",", "6", "+", "50", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "util", ".", "ZxidUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "txn", ".", "SetDataTxn", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "txn", ".", "TxnHeader", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "This", "class", "is", "the", "superclass", "of", "two", "of", "the", "three", "main", "actors", "in", "a", "ZK", "@", "@", "-", "193", ",", "21", "+", "195", ",", "21", "@", "@", "void", "request", "(", "Request", "request", ")", "throws", "IOException", "{", "/", "**", "*", "Returns", "the", "address", "of", "the", "node", "we", "think", "is", "the", "leader", ".", "*", "/", "protected", "InetSocketAddress", "findLeader", "(", ")", "{", "InetSocketAddress", "addr", "=", "null", ";", "protected", "QuorumServer", "findLeader", "(", ")", "{", "QuorumServer", "leaderServer", "=", "null", ";", "/", "/", "Find", "the", "leader", "by", "id", "Vote", "current", "=", "self", ".", "getCurrentVote", "(", ");", "for", "(", "QuorumServer", "s", ":", "self", ".", "getView", "(", ").", "values", "(", "))", "{", "if", "(", "s", ".", "id", "=", "=", "current", ".", "getId", "(", "))", "{", "addr", "=", "s", ".", "addr", ";", "leaderServer", "=", "s", ";", "break", ";", "}", "}", "if", "(", "addr", "=", "=", "null", ")", "{", "if", "(", "leaderServer", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "Couldn", "'", "t", "find", "the", "leader", "with", "id", "=", "\"", "+", "current", ".", "getId", "(", "))", ";", "}", "return", "addr", ";", "return", "leaderServer", ";", "}", "/", "**", "@", "@", "-", "232", ",", "10", "+", "234", ",", "11", "@", "@", "protected", "void", "sockConnect", "(", "Socket", "sock", ",", "InetSocketAddress", "addr", ",", "int", "timeout", ")", "*", "until", "either", "initLimit", "time", "has", "elapsed", "or", "5", "tries", "have", "happened", ".", "*", "@", "param", "addr", "-", "the", "address", "of", "the", "Leader", "to", "connect", "to", ".", "*", "@", "throws", "IOException", "-", "if", "the", "socket", "connection", "fails", "on", "the", "5th", "attempt", "*", "<", "li", ">", "if", "there", "is", "an", "authentication", "failure", "while", "connecting", "to", "leader", "<", "/", "li", ">", "*", "@", "throws", "ConnectException", "*", "@", "throws", "InterruptedException", "*", "/", "protected", "void", "connectToLeader", "(", "InetSocketAddress", "addr", ")", "protected", "void", "connectToLeader", "(", "InetSocketAddress", "addr", ",", "String", "hostname", ")", "throws", "IOException", ",", "ConnectException", ",", "InterruptedException", "{", "sock", "=", "new", "Socket", "(", ");", "sock", ".", "setSoTimeout", "(", "self", ".", "tickTime", "*", "self", ".", "initLimit", ")", ";", "@", "@", "-", "279", ",", "6", "+", "282", ",", "9", "@", "@", "protected", "void", "connectToLeader", "(", "InetSocketAddress", "addr", ")", "}", "Thread", ".", "sleep", "(", "1000", ")", ";", "}", "self", ".", "authLearner", ".", "authenticate", "(", "sock", ",", "hostname", ")", ";", "leaderIs", "=", "BinaryInputArchive", ".", "getArchive", "(", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ");", "bufferedOutput", "=", "new", "BufferedOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ";", "@", "@", "-", "33", ",", "6", "+", "33", ",", "8", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantReadWriteLock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantReadWriteLock", ".", "ReadLock", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryInputArchive", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryOutputArchive", ";", "import", "org", ".", "apache", ".", "jute", ".", "Record", ";", "@", "@", "-", "155", ",", "6", "+", "157", ",", "7", "@", "@", "public", "synchronized", "boolean", "check", "(", "long", "time", ")", "{", "private", "BinaryOutputArchive", "oa", ";", "private", "final", "BufferedInputStream", "bufferedInput", ";", "private", "BufferedOutputStream", "bufferedOutput", ";", "/", "**", "@", "@", "-", "179", ",", "11", "+", "182", ",", "27", "@", "@", "public", "synchronized", "boolean", "check", "(", "long", "time", ")", "{", "*", "/", "private", "long", "leaderLastZxid", ";", "LearnerHandler", "(", "Socket", "sock", ",", "Leader", "leader", ")", "throws", "IOException", "{", "LearnerHandler", "(", "Socket", "sock", ",", "BufferedInputStream", "bufferedInput", ",", "Leader", "leader", ")", "throws", "IOException", "{", "super", "(", "\"", "LearnerHandler", "-", "\"", "+", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "this", ".", "sock", "=", "sock", ";", "this", ".", "leader", "=", "leader", ";", "leader", ".", "addLearnerHandler", "(", "this", ")", ";", "this", ".", "bufferedInput", "=", "bufferedInput", ";", "try", "{", "if", "(", "leader", ".", "self", "!", "=", "null", ")", "{", "leader", ".", "self", ".", "authServer", ".", "authenticate", "(", "sock", ",", "new", "DataInputStream", "(", "bufferedInput", ")", ");", "}", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Server", "failed", "to", "authenticate", "quorum", "learner", ",", "addr", ":", "{", "},", "closing", "connection", "\"", ",", "sock", ".", "getRemoteSocketAddress", "(", "),", "e", ")", ";", "try", "{", "sock", ".", "close", "(", ");", "}", "catch", "(", "IOException", "ie", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "while", "closing", "socket", "\"", ",", "ie", ")", ";", "}", "throw", "new", "SaslException", "(", "\"", "Authentication", "failure", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ";", "}", "}", "@", "Override", "@", "@", "-", "343", ",", "11", "+", "362", ",", "11", "@", "@", "static", "public", "String", "packetToString", "(", "QuorumPacket", "p", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "leader", ".", "addLearnerHandler", "(", "this", ")", ";", "tickOfNextAckDeadline", "=", "leader", ".", "self", ".", "tick", ".", "get", "(", ")", "+", "leader", ".", "self", ".", "initLimit", "+", "leader", ".", "self", ".", "syncLimit", ";", "ia", "=", "BinaryInputArchive", ".", "getArchive", "(", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ");", "ia", "=", "BinaryInputArchive", ".", "getArchive", "(", "bufferedInput", ")", ";", "bufferedOutput", "=", "new", "BufferedOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ";", "oa", "=", "BinaryOutputArchive", ".", "getArchive", "(", "bufferedOutput", ")", ";", "@", "@", "-", "19", ",", "12", "+", "19", ",", "12", "@", "@", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "InetSocketAddress", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "org", ".", "apache", ".", "jute", ".", "Record", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ObserverBean", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "Request", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeer", ".", "QuorumServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "flexible", ".", "QuorumVerifier", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "util", ".", "SerializeUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "txn", ".", "SetDataTxn", ";", "@", "@", "-", "63", ",", "10", "+", "63", ",", "10", "@", "@", "void", "observeLeader", "(", ")", "throws", "Exception", "{", "zk", ".", "registerJMX", "(", "new", "ObserverBean", "(", "this", ",", "zk", ")", ",", "self", ".", "jmxLocalPeerBean", ")", ";", "try", "{", "InetSocketAddress", "addr", "=", "findLeader", "(", ");", "LOG", ".", "info", "(", "\"", "Observing", "\"", "+", "addr", ")", ";", "QuorumServer", "leaderServer", "=", "findLeader", "(", ");", "LOG", ".", "info", "(", "\"", "Observing", "\"", "+", "leaderServer", ".", "addr", ")", ";", "try", "{", "connectToLeader", "(", "addr", ")", ";", "connectToLeader", "(", "leaderServer", ".", "addr", ",", "leaderServer", ".", "hostname", ")", ";", "long", "newLeaderZxid", "=", "registerWithLeader", "(", "Leader", ".", "OBSERVERINFO", ")", ";", "if", "(", "self", ".", "isReconfigStateChange", "(", "))", "throw", "new", "Exception", "(", "\"", "learned", "about", "role", "change", "\"", ");", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "io", ".", "DataOutputStream", ";", "@", "@", "-", "30", ",", "15", "+", "31", ",", "24", "@", "@", "import", "java", ".", "nio", ".", "BufferUnderflowException", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "nio", ".", "channels", ".", "UnresolvedAddressException", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ArrayBlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "SynchronousQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ThreadFactory", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ThreadPoolExecutor", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "NoSuchElementException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicLong", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ZooKeeperThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "QuorumAuthLearner", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "QuorumAuthServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "flexible", ".", "QuorumVerifier", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "79", ",", "8", "+", "89", ",", "8", "@", "@", "/", "*", "*", "Negative", "counter", "for", "observer", "server", "ids", ".", "*", "/", "private", "long", "observerCounter", "=", "-", "1", ";", "private", "AtomicLong", "observerCounter", "=", "new", "AtomicLong", "(", "-", "1", ")", ";", "/", "*", "*", "Protocol", "identifier", "used", "among", "peers", "@", "@", "-", "97", ",", "11", "+", "107", ",", "26", "@", "@", "*", "/", "private", "int", "cnxTO", "=", "5000", ";", "final", "QuorumPeer", "self", ";", "/", "*", "*", "Local", "IP", "address", "*", "/", "final", "QuorumPeer", "self", ";", "final", "long", "mySid", ";", "final", "int", "socketTimeout", ";", "final", "Map", "<", "Long", ",", "QuorumPeer", ".", "QuorumServer", ">", "view", ";", "final", "boolean", "listenOnAllIPs", ";", "private", "ThreadPoolExecutor", "connectionExecutor", ";", "private", "final", "Set", "<", "Long", ">", "inprogressConnections", "=", "Collections", ".", "synchronizedSet", "(", "new", "HashSet", "<", "Long", ">", "()", ");", "private", "QuorumAuthServer", "authServer", ";", "private", "QuorumAuthLearner", "authLearner", ";", "private", "boolean", "quorumSaslAuthEnabled", ";", "/", "*", "*", "Counter", "to", "count", "connection", "processing", "threads", ".", "*", "/", "private", "AtomicInteger", "connectionThreadCnt", "=", "new", "AtomicInteger", "(", "0", ")", ";", "/", "*", "*", "Mapping", "from", "Peer", "to", "Thread", "number", "@", "@", "-", "217", ",", "7", "+", "242", ",", "15", "@", "@", "static", "public", "InitialMessage", "parse", "(", "Long", "protocolVersion", ",", "DataInputStream", "din", ")", "}", "}", "public", "QuorumCnxManager", "(", "QuorumPeer", "self", ")", "{", "public", "QuorumCnxManager", "(", "QuorumPeer", "self", ",", "final", "long", "mySid", ",", "Map", "<", "Long", ",", "QuorumPeer", ".", "QuorumServer", ">", "view", ",", "QuorumAuthServer", "authServer", ",", "QuorumAuthLearner", "authLearner", ",", "int", "socketTimeout", ",", "boolean", "listenOnAllIPs", ",", "int", "quorumCnxnThreadsSize", ",", "boolean", "quorumSaslAuthEnabled", ")", "{", "this", ".", "recvQueue", "=", "new", "ArrayBlockingQueue", "<", "Message", ">", "(", "RECV_CAPACITY", ")", ";", "this", ".", "queueSendMap", "=", "new", "ConcurrentHashMap", "<", "Long", ",", "ArrayBlockingQueue", "<", "ByteBuffer", ">", ">(", ");", "this", ".", "senderWorkerMap", "=", "new", "ConcurrentHashMap", "<", "Long", ",", "SendWorker", ">", "()", ";", "@", "@", "-", "230", ",", "11", "+", "263", ",", "54", "@", "@", "public", "QuorumCnxManager", "(", "QuorumPeer", "self", ")", "{", "this", ".", "self", "=", "self", ";", "/", "/", "Starts", "listener", "thread", "that", "waits", "for", "connection", "requests", "this", ".", "mySid", "=", "mySid", ";", "this", ".", "socketTimeout", "=", "socketTimeout", ";", "this", ".", "view", "=", "view", ";", "this", ".", "listenOnAllIPs", "=", "listenOnAllIPs", ";", "initializeAuth", "(", "mySid", ",", "authServer", ",", "authLearner", ",", "quorumCnxnThreadsSize", ",", "quorumSaslAuthEnabled", ")", ";", "/", "/", "Starts", "listener", "thread", "that", "waits", "for", "connection", "requests", "listener", "=", "new", "Listener", "(", ");", "listener", ".", "setName", "(", "\"", "QuorumPeerListener", "\"", ");", "}", "private", "void", "initializeAuth", "(", "final", "long", "mySid", ",", "final", "QuorumAuthServer", "authServer", ",", "final", "QuorumAuthLearner", "authLearner", ",", "final", "int", "quorumCnxnThreadsSize", ",", "final", "boolean", "quorumSaslAuthEnabled", ")", "{", "this", ".", "authServer", "=", "authServer", ";", "this", ".", "authLearner", "=", "authLearner", ";", "this", ".", "quorumSaslAuthEnabled", "=", "quorumSaslAuthEnabled", ";", "if", "(", "!", "this", ".", "quorumSaslAuthEnabled", ")", "{", "LOG", ".", "debug", "(", "\"", "Not", "initializing", "connection", "executor", "as", "quorum", "sasl", "auth", "is", "disabled", "\"", ");", "return", ";", "}", "/", "/", "init", "connection", "executors", "final", "AtomicInteger", "threadIndex", "=", "new", "AtomicInteger", "(", "1", ")", ";", "SecurityManager", "s", "=", "System", ".", "getSecurityManager", "(", ");", "final", "ThreadGroup", "group", "=", "(", "s", "!", "=", "null", ")", "?", "s", ".", "getThreadGroup", "(", ")", ":", "Thread", ".", "currentThread", "(", ").", "getThreadGroup", "(", ");", "ThreadFactory", "daemonThFactory", "=", "new", "ThreadFactory", "(", ")", "{", "@", "Override", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "Thread", "t", "=", "new", "Thread", "(", "group", ",", "r", ",", "\"", "QuorumConnectionThread", "-", "\"", "+", "\"", "[", "myid", "=", "\"", "+", "mySid", "+", "\"", "]-", "\"", "+", "threadIndex", ".", "getAndIncrement", "(", "))", ";", "return", "t", ";", "}", "}", ";", "this", ".", "connectionExecutor", "=", "new", "ThreadPoolExecutor", "(", "3", ",", "quorumCnxnThreadsSize", ",", "60", ",", "TimeUnit", ".", "SECONDS", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "()", ",", "daemonThFactory", ")", ";", "this", ".", "connectionExecutor", ".", "allowCoreThreadTimeOut", "(", "true", ")", ";", "}", "/", "**", "*", "Invokes", "initiateConnection", "for", "testing", "purposes", "*", "@", "@", "-", "247", ",", "17", "+", "323", ",", "80", "@", "@", "public", "void", "testInitiateConnection", "(", "long", "sid", ")", "throws", "Exception", "{", "sock", ".", "connect", "(", "self", ".", "getVotingView", "(", ").", "get", "(", "sid", ")", ".", "electionAddr", ",", "cnxTO", ")", ";", "initiateConnection", "(", "sock", ",", "sid", ")", ";", "}", "/", "**", "*", "If", "this", "server", "has", "initiated", "the", "connection", ",", "then", "it", "gives", "up", "on", "the", "*", "connection", "if", "it", "loses", "challenge", ".", "Otherwise", ",", "it", "keeps", "the", "connection", ".", "*", "/", "public", "boolean", "initiateConnection", "(", "Socket", "sock", ",", "Long", "sid", ")", "{", "public", "void", "initiateConnection", "(", "final", "Socket", "sock", ",", "final", "Long", "sid", ")", "{", "try", "{", "startConnection", "(", "sock", ",", "sid", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "while", "connecting", ",", "id", ":", "{", "},", "addr", ":", "{", "},", "closing", "learner", "connection", "\"", ",", "new", "Object", "[", "]", "{", "sid", ",", "sock", ".", "getRemoteSocketAddress", "(", ")", "}", ",", "e", ")", ";", "closeSocket", "(", "sock", ")", ";", "return", ";", "}", "}", "/", "**", "*", "Server", "will", "initiate", "the", "connection", "request", "to", "its", "peer", "server", "*", "asynchronously", "via", "separate", "connection", "thread", ".", "*", "/", "public", "void", "initiateConnectionAsync", "(", "final", "Socket", "sock", ",", "final", "Long", "sid", ")", "{", "if", "(", "!", "inprogressConnections", ".", "add", "(", "sid", ")", "){", "/", "/", "simply", "return", "as", "there", "is", "a", "connection", "request", "to", "/", "/", "server", "'", "sid", "'", "already", "in", "progress", ".", "LOG", ".", "debug", "(", "\"", "Connection", "request", "to", "server", "id", ":", "{", "}", "is", "already", "in", "progress", ",", "so", "skipping", "this", "request", "\"", ",", "sid", ")", ";", "closeSocket", "(", "sock", ")", ";", "return", ";", "}", "try", "{", "connectionExecutor", ".", "execute", "(", "new", "QuorumConnectionReqThread", "(", "sock", ",", "sid", ")", ");", "connectionThreadCnt", ".", "incrementAndGet", "(", ");", "}", "catch", "(", "Throwable", "e", ")", "{", "/", "/", "Imp", ":", "Safer", "side", "catching", "all", "type", "of", "exceptions", "and", "remove", "'", "sid", "'", "/", "/", "from", "inprogress", "connections", ".", "This", "is", "to", "avoid", "blocking", "further", "/", "/", "connection", "requests", "from", "this", "'", "sid", "'", "in", "case", "of", "errors", ".", "inprogressConnections", ".", "remove", "(", "sid", ")", ";", "LOG", ".", "error", "(", "\"", "Exception", "while", "submitting", "quorum", "connection", "request", "\"", ",", "e", ")", ";", "closeSocket", "(", "sock", ")", ";", "}", "}", "/", "**", "*", "Thread", "to", "send", "connection", "request", "to", "peer", "server", ".", "*", "/", "private", "class", "QuorumConnectionReqThread", "extends", "ZooKeeperThread", "{", "final", "Socket", "sock", ";", "final", "Long", "sid", ";", "QuorumConnectionReqThread", "(", "final", "Socket", "sock", ",", "final", "Long", "sid", ")", "{", "super", "(", "\"", "QuorumConnectionReqThread", "-", "\"", "+", "sid", ")", ";", "this", ".", "sock", "=", "sock", ";", "this", ".", "sid", "=", "sid", ";", "}", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "initiateConnection", "(", "sock", ",", "sid", ")", ";", "}", "finally", "{", "inprogressConnections", ".", "remove", "(", "sid", ")", ";", "}", "}", "}", "private", "boolean", "startConnection", "(", "Socket", "sock", ",", "Long", "sid", ")", "throws", "IOException", "{", "DataOutputStream", "dout", "=", "null", ";", "DataInputStream", "din", "=", "null", ";", "try", "{", "/", "/", "Use", "BufferedOutputStream", "to", "reduce", "the", "number", "of", "IP", "packets", ".", "This", "is", "/", "/", "important", "for", "x", "-", "DC", "scenarios", ".", "BufferedOutputStream", "buf", "=", "new", "BufferedOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ";", "DataOutputStream", "dout", "=", "new", "DataOutputStream", "(", "buf", ")", ";", "dout", "=", "new", "DataOutputStream", "(", "buf", ")", ";", "/", "/", "Sending", "id", "and", "challenge", "@", "@", "-", "269", ",", "12", "+", "408", ",", "22", "@", "@", "public", "boolean", "initiateConnection", "(", "Socket", "sock", ",", "Long", "sid", ")", "{", "dout", ".", "writeInt", "(", "addr_bytes", ".", "length", ")", ";", "dout", ".", "write", "(", "addr_bytes", ")", ";", "dout", ".", "flush", "(", ");", "din", "=", "new", "DataInputStream", "(", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ");", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Ignoring", "exception", "reading", "or", "writing", "challenge", ":", "\"", ",", "e", ")", ";", "closeSocket", "(", "sock", ")", ";", "return", "false", ";", "}", "/", "/", "authenticate", "learner", "QuorumPeer", ".", "QuorumServer", "qps", "=", "self", ".", "getVotingView", "(", ").", "get", "(", "sid", ")", ";", "if", "(", "qps", "!", "=", "null", ")", "{", "/", "/", "TODO", "-", "investigate", "why", "reconfig", "makes", "qps", "null", ".", "authLearner", ".", "authenticate", "(", "sock", ",", "qps", ".", "hostname", ")", ";", "}", "/", "/", "If", "lost", "the", "challenge", ",", "then", "drop", "the", "new", "connection", "if", "(", "sid", ">", "self", ".", "getId", "(", "))", "{", "LOG", ".", "info", "(", "\"", "Have", "smaller", "server", "identifier", ",", "so", "dropping", "the", "\"", "+", "@", "@", "-", "283", ",", "7", "+", "432", ",", "7", "@", "@", "public", "boolean", "initiateConnection", "(", "Socket", "sock", ",", "Long", "sid", ")", "{", "/", "/", "Otherwise", "proceed", "with", "the", "connection", "}", "else", "{", "SendWorker", "sw", "=", "new", "SendWorker", "(", "sock", ",", "sid", ")", ";", "RecvWorker", "rw", "=", "new", "RecvWorker", "(", "sock", ",", "sid", ",", "sw", ")", ";", "RecvWorker", "rw", "=", "new", "RecvWorker", "(", "sock", ",", "din", ",", "sid", ",", "sw", ")", ";", "sw", ".", "setRecv", "(", "rw", ")", ";", "SendWorker", "vsw", "=", "senderWorkerMap", ".", "get", "(", "sid", ")", ";", "@", "@", "-", "312", ",", "13", "+", "461", ",", "58", "@", "@", "public", "boolean", "initiateConnection", "(", "Socket", "sock", ",", "Long", "sid", ")", "{", "*", "possible", "long", "value", "to", "lose", "the", "challenge", ".", "*", "*", "/", "public", "void", "receiveConnection", "(", "Socket", "sock", ")", "{", "public", "void", "receiveConnection", "(", "final", "Socket", "sock", ")", "{", "DataInputStream", "din", "=", "null", ";", "try", "{", "din", "=", "new", "DataInputStream", "(", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ");", "handleConnection", "(", "sock", ",", "din", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "handling", "connection", ",", "addr", ":", "{", "},", "closing", "server", "connection", "\"", ",", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "closeSocket", "(", "sock", ")", ";", "}", "}", "/", "**", "*", "Server", "receives", "a", "connection", "request", "and", "handles", "it", "asynchronously", "via", "*", "separate", "thread", ".", "*", "/", "public", "void", "receiveConnectionAsync", "(", "final", "Socket", "sock", ")", "{", "try", "{", "connectionExecutor", ".", "execute", "(", "new", "QuorumConnectionReceiverThread", "(", "sock", ")", ");", "connectionThreadCnt", ".", "incrementAndGet", "(", ");", "}", "catch", "(", "Throwable", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "handling", "connection", ",", "addr", ":", "{", "},", "closing", "server", "connection", "\"", ",", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "closeSocket", "(", "sock", ")", ";", "}", "}", "/", "**", "*", "Thread", "to", "receive", "connection", "request", "from", "peer", "server", ".", "*", "/", "private", "class", "QuorumConnectionReceiverThread", "extends", "ZooKeeperThread", "{", "private", "final", "Socket", "sock", ";", "QuorumConnectionReceiverThread", "(", "final", "Socket", "sock", ")", "{", "super", "(", "\"", "QuorumConnectionReceiverThread", "-", "\"", "+", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "this", ".", "sock", "=", "sock", ";", "}", "@", "Override", "public", "void", "run", "(", ")", "{", "receiveConnection", "(", "sock", ")", ";", "}", "}", "private", "void", "handleConnection", "(", "Socket", "sock", ",", "DataInputStream", "din", ")", "throws", "IOException", "{", "Long", "sid", "=", "null", ",", "protocolVersion", "=", "null", ";", "InetSocketAddress", "electionAddr", "=", "null", ";", "try", "{", "DataInputStream", "din", "=", "new", "DataInputStream", "(", "sock", ".", "getInputStream", "(", "))", ";", "protocolVersion", "=", "din", ".", "readLong", "(", ");", "if", "(", "protocolVersion", ">", "=", "0", ")", "{", "/", "/", "this", "is", "a", "server", "id", "and", "not", "a", "protocol", "version", "sid", "=", "protocolVersion", ";", "@", "@", "-", "339", ",", "16", "+", "533", ",", "18", "@", "@", "public", "void", "receiveConnection", "(", "Socket", "sock", ")", "{", "*", "Choose", "identifier", "at", "random", ".", "We", "need", "a", "value", "to", "identify", "*", "the", "connection", ".", "*", "/", "sid", "=", "observerCounter", "-", "-;", "LOG", ".", "info", "(", "\"", "Setting", "arbitrary", "identifier", "to", "observer", ":", "{", "}\"", ",", "sid", ")", ";", "sid", "=", "observerCounter", ".", "getAndDecrement", "(", ");", "LOG", ".", "info", "(", "\"", "Setting", "arbitrary", "identifier", "to", "observer", ":", "\"", "+", "sid", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "closeSocket", "(", "sock", ")", ";", "LOG", ".", "warn", "(", "\"", "Exception", "reading", "or", "writing", "challenge", ":", "{", "}\"", ",", "e", ".", "toString", "(", "))", ";", "return", ";", "}", "/", "/", "do", "authenticating", "learner", "authServer", ".", "authenticate", "(", "sock", ",", "din", ")", ";", "/", "/", "If", "wins", "the", "challenge", ",", "then", "close", "the", "new", "connection", ".", "if", "(", "sid", "<", "self", ".", "getId", "(", "))", "{", "/", "*", "@", "@", "-", "375", ",", "7", "+", "571", ",", "7", "@", "@", "public", "void", "receiveConnection", "(", "Socket", "sock", ")", "{", "}", "else", "{", "/", "/", "Otherwise", "start", "worker", "threads", "to", "receive", "data", ".", "SendWorker", "sw", "=", "new", "SendWorker", "(", "sock", ",", "sid", ")", ";", "RecvWorker", "rw", "=", "new", "RecvWorker", "(", "sock", ",", "sid", ",", "sw", ")", ";", "RecvWorker", "rw", "=", "new", "RecvWorker", "(", "sock", ",", "din", ",", "sid", ",", "sw", ")", ";", "sw", ".", "setRecv", "(", "rw", ")", ";", "SendWorker", "vsw", "=", "senderWorkerMap", ".", "get", "(", "sid", ")", ";", "@", "@", "-", "402", ",", "7", "+", "598", ",", "7", "@", "@", "public", "void", "toSend", "(", "Long", "sid", ",", "ByteBuffer", "b", ")", "{", "/", "*", "*", "If", "sending", "message", "to", "myself", ",", "then", "simply", "enqueue", "it", "(", "loopback", ")", ".", "*", "/", "if", "(", "self", ".", "getId", "(", ")", "=", "=", "sid", ")", "{", "if", "(", "this", ".", "mySid", "=", "=", "sid", ")", "{", "b", ".", "position", "(", "0", ")", ";", "addToRecvQueue", "(", "new", "Message", "(", "b", ".", "duplicate", "(", "),", "sid", ")", ");", "/", "*", "@", "@", "-", "444", ",", "7", "+", "640", ",", "15", "@", "@", "synchronized", "private", "boolean", "connectOne", "(", "long", "sid", ",", "InetSocketAddress", "electionAddr", "setSockOpts", "(", "sock", ")", ";", "sock", ".", "connect", "(", "electionAddr", ",", "cnxTO", ")", ";", "LOG", ".", "debug", "(", "\"", "Connected", "to", "server", "\"", "+", "sid", ")", ";", "initiateConnection", "(", "sock", ",", "sid", ")", ";", "/", "/", "Sends", "connection", "request", "asynchronously", "if", "the", "quorum", "/", "/", "sasl", "authentication", "is", "enabled", ".", "This", "is", "required", "because", "/", "/", "sasl", "server", "authentication", "process", "may", "take", "few", "seconds", "to", "/", "/", "finish", ",", "this", "may", "delay", "next", "peer", "connection", "requests", ".", "if", "(", "quorumSaslAuthEnabled", ")", "{", "initiateConnectionAsync", "(", "sock", ",", "sid", ")", ";", "}", "else", "{", "initiateConnection", "(", "sock", ",", "sid", ")", ";", "}", "return", "true", ";", "}", "catch", "(", "UnresolvedAddressException", "e", ")", "{", "/", "/", "Sun", "doesn", "'", "t", "include", "the", "address", "that", "causes", "this", "@", "@", "-", "547", ",", "6", "+", "751", ",", "13", "@", "@", "public", "void", "halt", "(", ")", "{", "LOG", ".", "warn", "(", "\"", "Got", "interrupted", "before", "joining", "the", "listener", "\"", ",", "ex", ")", ";", "}", "softHalt", "(", ");", "/", "/", "clear", "data", "structures", "used", "for", "auth", "if", "(", "connectionExecutor", "!", "=", "null", ")", "{", "connectionExecutor", ".", "shutdown", "(", ");", "}", "inprogressConnections", ".", "clear", "(", ");", "resetConnectionThreadCount", "(", ");", "}", "/", "**", "@", "@", "-", "595", ",", "11", "+", "806", ",", "19", "@", "@", "private", "void", "closeSocket", "(", "Socket", "sock", ")", "{", "public", "long", "getThreadCount", "(", ")", "{", "return", "threadCnt", ".", "get", "(", ");", "}", "/", "**", "*", "Return", "number", "of", "connection", "processing", "threads", ".", "*", "/", "public", "long", "getConnectionThreadCount", "(", ")", "{", "return", "connectionThreadCnt", ".", "get", "(", ");", "}", "/", "**", "*", "Return", "reference", "to", "QuorumPeer", "*", "Reset", "the", "value", "of", "connection", "processing", "threads", "count", "to", "zero", ".", "*", "/", "public", "QuorumPeer", "getQuorumPeer", "(", ")", "{", "return", "self", ";", "private", "void", "resetConnectionThreadCount", "(", ")", "{", "connectionThreadCnt", ".", "set", "(", "0", ")", ";", "}", "/", "**", "@", "@", "-", "645", ",", "7", "+", "864", ",", "16", "@", "@", "public", "void", "run", "(", ")", "{", "setSockOpts", "(", "client", ")", ";", "LOG", ".", "info", "(", "\"", "Received", "connection", "request", "\"", "+", "client", ".", "getRemoteSocketAddress", "(", "))", ";", "receiveConnection", "(", "client", ")", ";", "/", "/", "Receive", "and", "handle", "the", "connection", "request", "/", "/", "asynchronously", "if", "the", "quorum", "sasl", "authentication", "is", "/", "/", "enabled", ".", "This", "is", "required", "because", "sasl", "server", "/", "/", "authentication", "process", "may", "take", "few", "seconds", "to", "finish", ",", "/", "/", "this", "may", "delay", "next", "peer", "connection", "requests", ".", "if", "(", "quorumSaslAuthEnabled", ")", "{", "receiveConnectionAsync", "(", "client", ")", ";", "}", "else", "{", "receiveConnection", "(", "client", ")", ";", "}", "numRetries", "=", "0", ";", "}", "catch", "(", "SocketTimeoutException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "The", "socket", "is", "listening", "for", "the", "election", "accepted", "\"", "@", "@", "-", "695", ",", "7", "+", "923", ",", "8", "@", "@", "void", "halt", "(", "){", "try", "{", "LOG", ".", "debug", "(", "\"", "Trying", "to", "close", "listener", ":", "\"", "+", "ss", ")", ";", "if", "(", "ss", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "Closing", "listener", ":", "\"", "+", "self", ".", "getId", "(", "))", ";", "LOG", ".", "debug", "(", "\"", "Closing", "listener", ":", "\"", "+", "QuorumCnxManager", ".", "this", ".", "mySid", ")", ";", "ss", ".", "close", "(", ");", "}", "}", "catch", "(", "IOException", "e", ")", "{", "@", "@", "-", "847", ",", "8", "+", "1076", ",", "9", "@", "@", "public", "void", "run", "(", ")", "{", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Exception", "when", "using", "channel", ":", "for", "id", "\"", "+", "sid", "+", "\"", "my", "id", "=", "\"", "+", "self", ".", "getId", "(", ")", "+", "\"", "error", "=", "\"", "+", "e", ")", ";", "LOG", ".", "warn", "(", "\"", "Exception", "when", "using", "channel", ":", "for", "id", "\"", "+", "sid", "+", "\"", "my", "id", "=", "\"", "+", "QuorumCnxManager", ".", "this", ".", "mySid", "+", "\"", "error", "=", "\"", "+", "e", ")", ";", "}", "this", ".", "finish", "(", ");", "LOG", ".", "warn", "(", "\"", "Send", "worker", "leaving", "thread", "\"", "+", "\"", "id", "\"", "+", "sid", "+", "\"", "my", "id", "=", "\"", "+", "self", ".", "getId", "(", "))", ";", "@", "@", "-", "863", ",", "16", "+", "1093", ",", "16", "@", "@", "public", "void", "run", "(", ")", "{", "Long", "sid", ";", "Socket", "sock", ";", "volatile", "boolean", "running", "=", "true", ";", "DataInputStream", "din", ";", "final", "DataInputStream", "din", ";", "final", "SendWorker", "sw", ";", "RecvWorker", "(", "Socket", "sock", ",", "Long", "sid", ",", "SendWorker", "sw", ")", "{", "RecvWorker", "(", "Socket", "sock", ",", "DataInputStream", "din", ",", "Long", "sid", ",", "SendWorker", "sw", ")", "{", "super", "(", "\"", "RecvWorker", ":", "\"", "+", "sid", ")", ";", "this", ".", "sid", "=", "sid", ";", "this", ".", "sock", "=", "sock", ";", "this", ".", "sw", "=", "sw", ";", "this", ".", "din", "=", "din", ";", "try", "{", "din", "=", "new", "DataInputStream", "(", "sock", ".", "getInputStream", "(", "))", ";", "/", "/", "OK", "to", "wait", "until", "socket", "disconnects", "while", "reading", ".", "sock", ".", "setSoTimeout", "(", "0", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "@", "@", "-", "925", ",", "8", "+", "1155", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "addToRecvQueue", "(", "new", "Message", "(", "message", ".", "duplicate", "(", "),", "sid", ")", ");", "}", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Connection", "broken", "for", "id", "\"", "+", "sid", "+", "\"", ",", "my", "id", "=", "\"", "+", "self", ".", "getId", "(", ")", "+", "\"", ",", "error", "=", "\"", ",", "e", ")", ";", "LOG", ".", "warn", "(", "\"", "Connection", "broken", "for", "id", "\"", "+", "sid", "+", "\"", ",", "my", "id", "=", "\"", "+", "QuorumCnxManager", ".", "this", ".", "mySid", "+", "\"", ",", "error", "=", "\"", ",", "e", ")", ";", "}", "finally", "{", "LOG", ".", "warn", "(", "\"", "Interrupting", "SendWorker", "\"", ");", "sw", ".", "finish", "(", ");", "@", "@", "-", "1046", ",", "4", "+", "1276", ",", "8", "@", "@", "public", "Message", "pollRecvQueue", "(", "long", "timeout", ",", "TimeUnit", "unit", ")", "throws", "InterruptedException", "{", "return", "recvQueue", ".", "poll", "(", "timeout", ",", "unit", ")", ";", "}", "public", "boolean", "connectedToPeer", "(", "long", "peerSid", ")", "{", "return", "senderWorkerMap", ".", "get", "(", "peerSid", ")", "!", "=", "null", ";", "}", "}", "@", "@", "-", "42", ",", "6", "+", "42", ",", "8", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "KeeperException", ".", "BadArgumentsException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "AtomicFileWritingIdiom", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "AtomicFileWritingIdiom", ".", "WriterStatement", ";", "@", "@", "-", "52", ",", "6", "+", "54", ",", "13", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ZKDatabase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ZooKeeperServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ZooKeeperThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "QuorumAuth", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "QuorumAuthLearner", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "QuorumAuthServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "SaslQuorumAuthLearner", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "SaslQuorumAuthServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "NullQuorumAuthLearner", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "NullQuorumAuthServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "admin", ".", "AdminServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "admin", ".", "AdminServer", ".", "AdminServerException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "admin", ".", "AdminServerFactory", ";", "@", "@", "-", "98", ",", "6", "+", "107", ",", "8", "@", "@", "private", "Map", "<", "Long", ",", "RemotePeerBean", ">", "jmxRemotePeerBean", ";", "LeaderElectionBean", "jmxLeaderElectionBean", ";", "private", "QuorumCnxManager", "qcm", ";", "QuorumAuthServer", "authServer", ";", "QuorumAuthLearner", "authLearner", ";", "/", "**", "*", "ZKDatabase", "is", "a", "top", "level", "member", "of", "quorumpeer", "@", "@", "-", "116", ",", "6", "+", "127", ",", "8", "@", "@", "public", "InetSocketAddress", "clientAddr", "=", "null", ";", "public", "long", "id", ";", "public", "String", "hostname", ";", "public", "LearnerType", "type", "=", "LearnerType", ".", "PARTICIPANT", ";", "@", "@", "-", "131", ",", "6", "+", "144", ",", "7", "@", "@", "public", "QuorumServer", "(", "long", "id", ",", "InetSocketAddress", "addr", ",", "this", "(", "id", ",", "addr", ",", "electionAddr", ",", "(", "InetSocketAddress", ")", "null", ",", "LearnerType", ".", "PARTICIPANT", ")", ";", "}", "/", "/", "VisibleForTesting", "public", "QuorumServer", "(", "long", "id", ",", "InetSocketAddress", "addr", ")", "{", "this", "(", "id", ",", "addr", ",", "(", "InetSocketAddress", ")", "null", ",", "(", "InetSocketAddress", ")", "null", ",", "LearnerType", ".", "PARTICIPANT", ")", ";", "}", "@", "@", "-", "217", ",", "7", "+", "231", ",", "7", "@", "@", "public", "QuorumServer", "(", "long", "sid", ",", "String", "addressStr", ")", "throws", "ConfigException", "{", "}", "/", "/", "is", "client_config", "a", "host", ":", "port", "or", "just", "a", "port", "String", "hostname", "=", "(", "clientParts", ".", "length", "=", "=", "2", ")", "?", "clientParts", "[", "0", "]", ":", "\"", "0", ".", "0", ".", "0", ".", "0", "\"", ";", "hostname", "=", "(", "clientParts", ".", "length", "=", "=", "2", ")", "?", "clientParts", "[", "0", "]", ":", "\"", "0", ".", "0", ".", "0", ".", "0", "\"", ";", "try", "{", "clientAddr", "=", "new", "InetSocketAddress", "(", "hostname", ",", "Integer", ".", "parseInt", "(", "clientParts", "[", "clientParts", ".", "length", "-", "1", "]", "))", ";", "@", "@", "-", "245", ",", "6", "+", "259", ",", "8", "@", "@", "public", "QuorumServer", "(", "long", "sid", ",", "String", "addressStr", ")", "throws", "ConfigException", "{", "setType", "(", "serverParts", "[", "3", "]", ");", "}", "this", ".", "hostname", "=", "serverParts", "[", "0", "]", ";", "setMyAddrs", "(", ");", "}", "@", "@", "-", "528", ",", "6", "+", "544", ",", "50", "@", "@", "public", "synchronized", "void", "setCurrentVote", "(", "Vote", "v", ")", "{", "*", "/", "private", "long", "electionTimeTaken", "=", "-", "1", ";", "/", "**", "*", "Enable", "/", "Disables", "quorum", "authentication", "using", "sasl", ".", "Defaulting", "to", "false", ".", "*", "/", "protected", "boolean", "quorumSaslEnableAuth", ";", "/", "**", "*", "If", "this", "is", "false", ",", "quorum", "peer", "server", "will", "accept", "another", "quorum", "peer", "client", "*", "connection", "even", "if", "the", "authentication", "did", "not", "succeed", ".", "This", "can", "be", "used", "while", "*", "upgrading", "ZooKeeper", "server", ".", "Defaulting", "to", "false", "(", "required", ")", ".", "*", "/", "protected", "boolean", "quorumServerSaslAuthRequired", ";", "/", "**", "*", "If", "this", "is", "false", ",", "quorum", "peer", "learner", "will", "talk", "to", "quorum", "peer", "server", "*", "without", "authentication", ".", "This", "can", "be", "used", "while", "upgrading", "ZooKeeper", "*", "server", ".", "Defaulting", "to", "false", "(", "required", ")", ".", "*", "/", "protected", "boolean", "quorumLearnerSaslAuthRequired", ";", "/", "**", "*", "Kerberos", "quorum", "service", "principal", ".", "Defaulting", "to", "'", "zkquorum", "/", "localhost", "'", ".", "*", "/", "protected", "String", "quorumServicePrincipal", ";", "/", "**", "*", "Quorum", "learner", "login", "context", "name", "in", "jaas", "-", "conf", "file", "to", "read", "the", "kerberos", "*", "security", "details", ".", "Defaulting", "to", "'", "QuorumLearner", "'", ".", "*", "/", "protected", "String", "quorumLearnerLoginContext", ";", "/", "**", "*", "Quorum", "server", "login", "context", "name", "in", "jaas", "-", "conf", "file", "to", "read", "the", "kerberos", "*", "security", "details", ".", "Defaulting", "to", "'", "QuorumServer", "'", ".", "*", "/", "protected", "String", "quorumServerLoginContext", ";", "/", "/", "TODO", ":", "need", "to", "tune", "the", "default", "value", "of", "thread", "size", "private", "static", "final", "int", "QUORUM_CNXN_THREADS_SIZE_DEFAULT_VALUE", "=", "20", ";", "/", "**", "*", "The", "maximum", "number", "of", "threads", "to", "allow", "in", "the", "connectionExecutors", "thread", "*", "pool", "which", "will", "be", "used", "to", "initiate", "quorum", "server", "connections", ".", "*", "/", "protected", "int", "quorumCnxnThreadsSize", "=", "QUORUM_CNXN_THREADS_SIZE_DEFAULT_VALUE", ";", "/", "**", "*", "@", "deprecated", "As", "of", "release", "3", ".", "4", ".", "0", ",", "this", "class", "has", "been", "deprecated", ",", "since", "*", "it", "is", "used", "with", "one", "of", "the", "udp", "-", "based", "versions", "of", "leader", "election", ",", "which", "@", "@", "-", "717", ",", "14", "+", "777", ",", "18", "@", "@", "public", "void", "setClientAddress", "(", "InetSocketAddress", "addr", ")", "{", "AdminServer", "adminServer", ";", "public", "QuorumPeer", "(", ")", "{", "public", "static", "QuorumPeer", "testingQuorumPeer", "(", ")", "throws", "SaslException", "{", "return", "new", "QuorumPeer", "(", ");", "}", "public", "QuorumPeer", "(", ")", "throws", "SaslException", "{", "super", "(", "\"", "QuorumPeer", "\"", ");", "quorumStats", "=", "new", "QuorumStats", "(", "this", ")", ";", "jmxRemotePeerBean", "=", "new", "HashMap", "<", "Long", ",", "RemotePeerBean", ">", "()", ";", "adminServer", "=", "AdminServerFactory", ".", "createAdminServer", "(", ");", "initialize", "(", ");", "}", "/", "**", "*", "For", "backward", "compatibility", "purposes", ",", "we", "instantiate", "QuorumMaj", "by", "default", ".", "*", "/", "@", "@", "-", "759", ",", "6", "+", "823", ",", "23", "@", "@", "public", "QuorumPeer", "(", "Map", "<", "Long", ",", "QuorumServer", ">", "quorumPeers", ",", "File", "dataDir", ",", "adminServer", "=", "AdminServerFactory", ".", "createAdminServer", "(", ");", "}", "public", "void", "initialize", "(", ")", "throws", "SaslException", "{", "/", "/", "init", "quorum", "auth", "server", "&", "learner", "if", "(", "isQuorumSaslAuthEnabled", "(", "))", "{", "Set", "<", "String", ">", "authzHosts", "=", "new", "HashSet", "<", "String", ">", "()", ";", "for", "(", "QuorumServer", "qs", ":", "getView", "(", ").", "values", "(", "))", "{", "authzHosts", ".", "add", "(", "qs", ".", "hostname", ")", ";", "}", "authServer", "=", "new", "SaslQuorumAuthServer", "(", "isQuorumServerSaslAuthRequired", "(", "),", "quorumServerLoginContext", ",", "authzHosts", ")", ";", "authLearner", "=", "new", "SaslQuorumAuthLearner", "(", "isQuorumLearnerSaslAuthRequired", "(", "),", "quorumServicePrincipal", ",", "quorumLearnerLoginContext", ")", ";", "}", "else", "{", "authServer", "=", "new", "NullQuorumAuthServer", "(", ");", "authLearner", "=", "new", "NullQuorumAuthLearner", "(", ");", "}", "}", "QuorumStats", "quorumStats", "(", ")", "{", "return", "quorumStats", ";", "}", "@", "@", "-", "939", ",", "26", "+", "1020", ",", "26", "@", "@", "protected", "Election", "createElectionAlgorithm", "(", "int", "electionAlgorithm", ")", "{", "/", "/", "TODO", ":", "use", "a", "factory", "rather", "than", "a", "switch", "switch", "(", "electionAlgorithm", ")", "{", "case", "1", ":", "le", "=", "new", "AuthFastLeaderElection", "(", "this", ")", ";", "break", ";", "case", "2", ":", "le", "=", "new", "AuthFastLeaderElection", "(", "this", ",", "true", ")", ";", "break", ";", "case", "3", ":", "qcm", "=", "new", "QuorumCnxManager", "(", "this", ")", ";", "QuorumCnxManager", ".", "Listener", "listener", "=", "qcm", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "FastLeaderElection", "fle", "=", "new", "FastLeaderElection", "(", "this", ",", "qcm", ")", ";", "fle", ".", "start", "(", ");", "le", "=", "fle", ";", "}", "else", "{", "LOG", ".", "error", "(", "\"", "Null", "listener", "when", "initializing", "cnx", "manager", "\"", ");", "}", "break", ";", "default", ":", "assert", "false", ";", "case", "1", ":", "le", "=", "new", "AuthFastLeaderElection", "(", "this", ")", ";", "break", ";", "case", "2", ":", "le", "=", "new", "AuthFastLeaderElection", "(", "this", ",", "true", ")", ";", "break", ";", "case", "3", ":", "qcm", "=", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "qcm", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "FastLeaderElection", "fle", "=", "new", "FastLeaderElection", "(", "this", ",", "qcm", ")", ";", "fle", ".", "start", "(", ");", "le", "=", "fle", ";", "}", "else", "{", "LOG", ".", "error", "(", "\"", "Null", "listener", "when", "initializing", "cnx", "manager", "\"", ");", "}", "break", ";", "default", ":", "assert", "false", ";", "}", "return", "le", ";", "}", "@", "@", "-", "1921", ",", "4", "+", "2002", ",", "75", "@", "@", "void", "setElectionTimeTaken", "(", "long", "electionTimeTaken", ")", "{", "long", "getElectionTimeTaken", "(", ")", "{", "return", "electionTimeTaken", ";", "}", "void", "setQuorumServerSaslRequired", "(", "boolean", "serverSaslRequired", ")", "{", "quorumServerSaslAuthRequired", "=", "serverSaslRequired", ";", "LOG", ".", "info", "(", "\"{", "}", "set", "to", "{", "}\"", ",", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "serverSaslRequired", ")", ";", "}", "void", "setQuorumLearnerSaslRequired", "(", "boolean", "learnerSaslRequired", ")", "{", "quorumLearnerSaslAuthRequired", "=", "learnerSaslRequired", ";", "LOG", ".", "info", "(", "\"{", "}", "set", "to", "{", "}\"", ",", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "learnerSaslRequired", ")", ";", "}", "void", "setQuorumSaslEnabled", "(", "boolean", "enableAuth", ")", "{", "quorumSaslEnableAuth", "=", "enableAuth", ";", "if", "(", "!", "quorumSaslEnableAuth", ")", "{", "LOG", ".", "info", "(", "\"", "QuorumPeer", "communication", "is", "not", "secured", "!", "\")", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"{", "}", "set", "to", "{", "}\"", ",", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "enableAuth", ")", ";", "}", "}", "void", "setQuorumServicePrincipal", "(", "String", "servicePrincipal", ")", "{", "quorumServicePrincipal", "=", "servicePrincipal", ";", "LOG", ".", "info", "(", "\"{", "}", "set", "to", "{", "}\"", ",", "QuorumAuth", ".", "QUORUM_KERBEROS_SERVICE_PRINCIPAL", ",", "quorumServicePrincipal", ")", ";", "}", "void", "setQuorumLearnerLoginContext", "(", "String", "learnerContext", ")", "{", "quorumLearnerLoginContext", "=", "learnerContext", ";", "LOG", ".", "info", "(", "\"{", "}", "set", "to", "{", "}\"", ",", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ",", "quorumLearnerLoginContext", ")", ";", "}", "void", "setQuorumServerLoginContext", "(", "String", "serverContext", ")", "{", "quorumServerLoginContext", "=", "serverContext", ";", "LOG", ".", "info", "(", "\"{", "}", "set", "to", "{", "}\"", ",", "QuorumAuth", ".", "QUORUM_SERVER_SASL_LOGIN_CONTEXT", ",", "quorumServerLoginContext", ")", ";", "}", "void", "setQuorumCnxnThreadsSize", "(", "int", "qCnxnThreadsSize", ")", "{", "if", "(", "qCnxnThreadsSize", ">", "QUORUM_CNXN_THREADS_SIZE_DEFAULT_VALUE", ")", "{", "quorumCnxnThreadsSize", "=", "qCnxnThreadsSize", ";", "}", "LOG", ".", "info", "(", "\"", "quorum", ".", "cnxn", ".", "threads", ".", "size", "set", "to", "{", "}\"", ",", "quorumCnxnThreadsSize", ")", ";", "}", "boolean", "isQuorumSaslAuthEnabled", "(", ")", "{", "return", "quorumSaslEnableAuth", ";", "}", "private", "boolean", "isQuorumServerSaslAuthRequired", "(", ")", "{", "return", "quorumServerSaslAuthRequired", ";", "}", "private", "boolean", "isQuorumLearnerSaslAuthRequired", "(", ")", "{", "return", "quorumLearnerSaslAuthRequired", ";", "}", "public", "QuorumCnxManager", "createCnxnManager", "(", ")", "{", "return", "new", "QuorumCnxManager", "(", "this", ",", "this", ".", "getId", "(", "),", "this", ".", "getView", "(", "),", "this", ".", "authServer", ",", "this", ".", "authLearner", ",", "this", ".", "tickTime", "*", "this", ".", "syncLimit", ",", "this", ".", "getQuorumListenOnAllIPs", "(", "),", "this", ".", "quorumCnxnThreadsSize", ",", "this", ".", "isQuorumSaslAuthEnabled", "(", "))", ";", "}", "}", "@", "@", "-", "49", ",", "6", "+", "49", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ZooKeeperServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeer", ".", "LearnerType", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeer", ".", "QuorumServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ".", "QuorumAuth", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "flexible", ".", "QuorumHierarchical", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "flexible", ".", "QuorumMaj", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "flexible", ".", "QuorumVerifier", ";", "@", "@", "-", "93", ",", "6", "+", "94", ",", "17", "@", "@", "protected", "LearnerType", "peerType", "=", "LearnerType", ".", "PARTICIPANT", ";", "/", "**", "*", "Configurations", "for", "the", "quorumpeer", "-", "to", "-", "quorumpeer", "sasl", "authentication", "*", "/", "protected", "boolean", "quorumServerRequireSasl", "=", "false", ";", "protected", "boolean", "quorumLearnerRequireSasl", "=", "false", ";", "protected", "boolean", "quorumEnableSasl", "=", "false", ";", "protected", "String", "quorumServicePrincipal", "=", "QuorumAuth", ".", "QUORUM_KERBEROS_SERVICE_PRINCIPAL_DEFAULT_VALUE", ";", "protected", "String", "quorumLearnerLoginContext", "=", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT_DFAULT_VALUE", ";", "protected", "String", "quorumServerLoginContext", "=", "QuorumAuth", ".", "QUORUM_SERVER_SASL_LOGIN_CONTEXT_DFAULT_VALUE", ";", "protected", "int", "quorumCnxnThreadsSize", ";", "/", "**", "*", "Minimum", "snapshot", "retain", "count", ".", "*", "@", "see", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "PurgeTxnLog", "#", "purge", "(", "File", ",", "File", ",", "int", ")", "@", "@", "-", "296", ",", "11", "+", "308", ",", "47", "@", "@", "public", "void", "parseProperties", "(", "Properties", "zkProp", ")", "}", "}", "else", "if", "(", "(", "key", ".", "startsWith", "(", "\"", "server", ".", "\")", "|", "|", "key", ".", "startsWith", "(", "\"", "group", "\"", ")", "|", "|", "key", ".", "startsWith", "(", "\"", "weight", "\"", "))", "&", "&", "zkProp", ".", "containsKey", "(", "\"", "dynamicConfigFile", "\"", "))", "{", "throw", "new", "ConfigException", "(", "\"", "parameter", ":", "\"", "+", "key", "+", "\"", "must", "be", "in", "a", "separate", "dynamic", "config", "file", "\"", ");", "}", "else", "if", "(", "key", ".", "equals", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ")", ")", "{", "quorumEnableSasl", "=", "Boolean", ".", "parseBoolean", "(", "value", ")", ";", "}", "else", "if", "(", "key", ".", "equals", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ")", ")", "{", "quorumServerRequireSasl", "=", "Boolean", ".", "parseBoolean", "(", "value", ")", ";", "}", "else", "if", "(", "key", ".", "equals", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ")", ")", "{", "quorumLearnerRequireSasl", "=", "Boolean", ".", "parseBoolean", "(", "value", ")", ";", "}", "else", "if", "(", "key", ".", "equals", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ")", ")", "{", "quorumLearnerLoginContext", "=", "value", ";", "}", "else", "if", "(", "key", ".", "equals", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_LOGIN_CONTEXT", ")", ")", "{", "quorumServerLoginContext", "=", "value", ";", "}", "else", "if", "(", "key", ".", "equals", "(", "QuorumAuth", ".", "QUORUM_KERBEROS_SERVICE_PRINCIPAL", ")", ")", "{", "quorumServicePrincipal", "=", "value", ";", "}", "else", "if", "(", "key", ".", "equals", "(", "\"", "quorum", ".", "cnxn", ".", "threads", ".", "size", "\"", "))", "{", "quorumCnxnThreadsSize", "=", "Integer", ".", "parseInt", "(", "value", ")", ";", "}", "else", "{", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "\"", "+", "key", ",", "value", ")", ";", "}", "}", "if", "(", "!", "quorumEnableSasl", "&", "&", "quorumServerRequireSasl", ")", "{", "throw", "new", "IllegalArgumentException", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", "+", "\"", "is", "disabled", ",", "so", "cannot", "enable", "\"", "+", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ")", ";", "}", "if", "(", "!", "quorumEnableSasl", "&", "&", "quorumLearnerRequireSasl", ")", "{", "throw", "new", "IllegalArgumentException", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", "+", "\"", "is", "disabled", ",", "so", "cannot", "enable", "\"", "+", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ")", ";", "}", "/", "/", "If", "quorumpeer", "learner", "is", "not", "auth", "enabled", "then", "self", "won", "'", "t", "be", "able", "to", "/", "/", "join", "quorum", ".", "So", "this", "condition", "is", "ensuring", "that", "the", "quorumpeer", "learner", "/", "/", "is", "also", "auth", "enabled", "while", "enabling", "quorum", "server", "require", "sasl", ".", "if", "(", "!", "quorumLearnerRequireSasl", "&", "&", "quorumServerRequireSasl", ")", "{", "throw", "new", "IllegalArgumentException", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", "+", "\"", "is", "disabled", ",", "so", "cannot", "enable", "\"", "+", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ")", ";", "}", "/", "/", "Reset", "to", "MIN_SNAP_RETAIN_COUNT", "if", "invalid", "(", "less", "than", "3", ")", "/", "/", "PurgeTxnLog", ".", "purge", "(", "File", ",", "File", ",", "int", ")", "will", "not", "allow", "to", "purge", "less", "/", "/", "than", "3", ".", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "management", ".", "JMException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "org", ".", "apache", ".", "yetus", ".", "audience", ".", "InterfaceAudience", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "183", ",", "6", "+", "184", ",", "18", "@", "@", "public", "void", "runFromConfig", "(", "QuorumPeerConfig", "config", ")", "quorumPeer", ".", "setLearnerType", "(", "config", ".", "getPeerType", "(", "))", ";", "quorumPeer", ".", "setSyncEnabled", "(", "config", ".", "getSyncEnabled", "(", "))", ";", "quorumPeer", ".", "setQuorumListenOnAllIPs", "(", "config", ".", "getQuorumListenOnAllIPs", "(", "))", ";", "/", "/", "sets", "quorum", "sasl", "authentication", "configurations", "quorumPeer", ".", "setQuorumSaslEnabled", "(", "config", ".", "quorumEnableSasl", ")", ";", "if", "(", "quorumPeer", ".", "isQuorumSaslAuthEnabled", "(", "))", "{", "quorumPeer", ".", "setQuorumServerSaslRequired", "(", "config", ".", "quorumServerRequireSasl", ")", ";", "quorumPeer", ".", "setQuorumLearnerSaslRequired", "(", "config", ".", "quorumLearnerRequireSasl", ")", ";", "quorumPeer", ".", "setQuorumServicePrincipal", "(", "config", ".", "quorumServicePrincipal", ")", ";", "quorumPeer", ".", "setQuorumServerLoginContext", "(", "config", ".", "quorumServerLoginContext", ")", ";", "quorumPeer", ".", "setQuorumLearnerLoginContext", "(", "config", ".", "quorumLearnerLoginContext", ")", ";", "}", "quorumPeer", ".", "setQuorumCnxnThreadsSize", "(", "config", ".", "quorumCnxnThreadsSize", ")", ";", "quorumPeer", ".", "initialize", "(", ");", "quorumPeer", ".", "start", "(", ");", "quorumPeer", ".", "join", "(", ");", "@", "@", "-", "193", ",", "7", "+", "206", ",", "7", "@", "@", "public", "void", "runFromConfig", "(", "QuorumPeerConfig", "config", ")", "}", "/", "/", "@", "VisibleForTesting", "protected", "QuorumPeer", "getQuorumPeer", "(", ")", "{", "protected", "QuorumPeer", "getQuorumPeer", "(", ")", "throws", "SaslException", "{", "return", "new", "QuorumPeer", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "33", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "net", ".", "Socket", ";", "/", "**", "*", "This", "class", "represents", "no", "authentication", "learner", ",", "it", "just", "return", "*", "without", "performing", "any", "authentication", ".", "*", "/", "public", "class", "NullQuorumAuthLearner", "implements", "QuorumAuthLearner", "{", "@", "Override", "public", "void", "authenticate", "(", "Socket", "sock", ",", "String", "hostname", ")", "{", "return", ";", "/", "/", "simply", "return", "don", "'", "t", "require", "auth", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "34", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "net", ".", "Socket", ";", "/", "**", "*", "This", "class", "represents", "no", "authentication", "server", ",", "it", "just", "return", "*", "without", "performing", "any", "authentication", ".", "*", "/", "public", "class", "NullQuorumAuthServer", "implements", "QuorumAuthServer", "{", "@", "Override", "public", "void", "authenticate", "(", "final", "Socket", "sock", ",", "final", "DataInputStream", "din", ")", "{", "return", ";", "/", "/", "simply", "return", "don", "'", "t", "require", "auth", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "96", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryInputArchive", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumAuthPacket", ";", "public", "class", "QuorumAuth", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "QuorumAuth", ".", "class", ")", ";", "public", "static", "final", "String", "QUORUM_SASL_AUTH_ENABLED", "=", "\"", "quorum", ".", "auth", ".", "enableSasl", "\"", ";", "public", "static", "final", "String", "QUORUM_SERVER_SASL_AUTH_REQUIRED", "=", "\"", "quorum", ".", "auth", ".", "serverRequireSasl", "\"", ";", "public", "static", "final", "String", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", "=", "\"", "quorum", ".", "auth", ".", "learnerRequireSasl", "\"", ";", "public", "static", "final", "String", "QUORUM_KERBEROS_SERVICE_PRINCIPAL", "=", "\"", "quorum", ".", "auth", ".", "kerberos", ".", "servicePrincipal", "\"", ";", "public", "static", "final", "String", "QUORUM_KERBEROS_SERVICE_PRINCIPAL_DEFAULT_VALUE", "=", "\"", "zkquorum", "/", "localhost", "\"", ";", "public", "static", "final", "String", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", "=", "\"", "quorum", ".", "auth", ".", "learner", ".", "saslLoginContext", "\"", ";", "public", "static", "final", "String", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT_DFAULT_VALUE", "=", "\"", "QuorumLearner", "\"", ";", "public", "static", "final", "String", "QUORUM_SERVER_SASL_LOGIN_CONTEXT", "=", "\"", "quorum", ".", "auth", ".", "server", ".", "saslLoginContext", "\"", ";", "public", "static", "final", "String", "QUORUM_SERVER_SASL_LOGIN_CONTEXT_DFAULT_VALUE", "=", "\"", "QuorumServer", "\"", ";", "static", "final", "String", "QUORUM_SERVER_PROTOCOL_NAME", "=", "\"", "zookeeper", "-", "quorum", "\"", ";", "static", "final", "String", "QUORUM_SERVER_SASL_DIGEST", "=", "\"", "zk", "-", "quorum", "-", "sasl", "-", "md5", "\"", ";", "static", "final", "String", "QUORUM_AUTH_MESSAGE_TAG", "=", "\"", "qpconnect", "\"", ";", "/", "/", "this", "is", "negative", ",", "so", "that", "if", "a", "learner", "that", "does", "auth", ",", "connects", "to", "a", "/", "/", "server", ",", "it", "'", "ll", "think", "the", "received", "packet", "is", "an", "authentication", "packet", "public", "static", "final", "long", "QUORUM_AUTH_MAGIC_NUMBER", "=", "-", "0xa0dbcafecafe1234L", ";", "public", "enum", "Status", "{", "IN_PROGRESS", "(", "0", ")", ",", "SUCCESS", "(", "1", ")", ",", "ERROR", "(", "-", "1", ")", ";", "private", "int", "status", ";", "Status", "(", "int", "status", ")", "{", "this", ".", "status", "=", "status", ";", "}", "static", "Status", "getStatus", "(", "int", "status", ")", "{", "switch", "(", "status", ")", "{", "case", "0", ":", "return", "IN_PROGRESS", ";", "case", "1", ":", "return", "SUCCESS", ";", "case", "-", "1", ":", "return", "ERROR", ";", "default", ":", "LOG", ".", "error", "(", "\"", "Unknown", "status", ":", "{}", "!\"", ",", "status", ")", ";", "assert", "false", ":", "\"", "Unknown", "status", "!", "\";", "return", "ERROR", ";", "}", "}", "int", "status", "(", ")", "{", "return", "status", ";", "}", "}", "public", "static", "QuorumAuthPacket", "createPacket", "(", "Status", "status", ",", "byte", "[", "]", "response", ")", "{", "return", "new", "QuorumAuthPacket", "(", "QUORUM_AUTH_MAGIC_NUMBER", ",", "status", ".", "status", "(", "),", "response", ")", ";", "}", "public", "static", "boolean", "nextPacketIsAuth", "(", "DataInputStream", "din", ")", "throws", "IOException", "{", "din", ".", "mark", "(", "32", ")", ";", "BinaryInputArchive", "bia", "=", "new", "BinaryInputArchive", "(", "din", ")", ";", "boolean", "firstIsAuth", "=", "(", "bia", ".", "readLong", "(", "\"", "NO_TAG", "\"", ")", "=", "=", "QuorumAuth", ".", "QUORUM_AUTH_MAGIC_NUMBER", ")", ";", "din", ".", "reset", "(", ");", "return", "firstIsAuth", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "40", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "Socket", ";", "/", "**", "*", "Interface", "for", "quorum", "learner", "authentication", "mechanisms", ".", "*", "/", "public", "interface", "QuorumAuthLearner", "{", "/", "**", "*", "Performs", "an", "authentication", "step", "for", "the", "given", "socket", "connection", ".", "*", "*", "@", "param", "sock", "*", "socket", "connection", "to", "other", "quorum", "peer", "server", "*", "@", "param", "hostname", "*", "host", "name", "of", "other", "quorum", "peer", "server", "*", "@", "throws", "IOException", "*", "if", "there", "is", "an", "authentication", "failure", "*", "/", "public", "void", "authenticate", "(", "Socket", "sock", ",", "String", "hostname", ")", "throws", "IOException", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "Socket", ";", "/", "**", "*", "Interface", "for", "quorum", "server", "authentication", "mechanisms", ".", "*", "/", "public", "interface", "QuorumAuthServer", "{", "/", "**", "*", "Performs", "an", "authentication", "step", "for", "the", "given", "socket", "connection", ".", "*", "*", "@", "param", "sock", "*", "socket", "connection", "to", "other", "quorum", "peer", "*", "@", "param", "din", "*", "stream", "used", "to", "read", "auth", "data", "send", "by", "the", "quorum", "learner", "*", "@", "throws", "IOException", "if", "the", "server", "fails", "to", "authenticate", "connecting", "quorum", "learner", "*", "/", "public", "void", "authenticate", "(", "Socket", "sock", ",", "DataInputStream", "din", ")", "throws", "IOException", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "223", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "io", ".", "DataOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "security", ".", "PrivilegedActionException", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "AppConfigurationEntry", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "Configuration", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "LoginException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslClient", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryInputArchive", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryOutputArchive", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "Login", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "SaslClientCallbackHandler", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "ZKConfig", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumAuthPacket", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "util", ".", "SecurityUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "public", "class", "SaslQuorumAuthLearner", "implements", "QuorumAuthLearner", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "SaslQuorumAuthLearner", ".", "class", ")", ";", "private", "final", "Login", "learnerLogin", ";", "private", "final", "boolean", "quorumRequireSasl", ";", "private", "final", "String", "quorumServicePrincipal", ";", "public", "SaslQuorumAuthLearner", "(", "boolean", "quorumRequireSasl", ",", "String", "quorumServicePrincipal", ",", "String", "loginContext", ")", "throws", "SaslException", "{", "this", ".", "quorumRequireSasl", "=", "quorumRequireSasl", ";", "this", ".", "quorumServicePrincipal", "=", "quorumServicePrincipal", ";", "try", "{", "AppConfigurationEntry", "entries", "[", "]", "=", "Configuration", ".", "getConfiguration", "(", ")", ".", "getAppConfigurationEntry", "(", "loginContext", ")", ";", "if", "(", "entries", "=", "=", "null", "|", "|", "entries", ".", "length", "=", "=", "0", ")", "{", "throw", "new", "LoginException", "(", "\"", "SASL", "-", "authentication", "failed", "because", "\"", "+", "\"", "the", "specified", "JAAS", "configuration", "\"", "+", "\"", "section", "'", "\"", "+", "loginContext", "+", "\"", "'", "could", "not", "be", "found", ".", "\")", ";", "}", "this", ".", "learnerLogin", "=", "new", "Login", "(", "loginContext", ",", "new", "SaslClientCallbackHandler", "(", "null", ",", "\"", "QuorumLearner", "\"", "),", "new", "ZKConfig", "(", "))", ";", "this", ".", "learnerLogin", ".", "startThreadIfNeeded", "(", ");", "}", "catch", "(", "LoginException", "e", ")", "{", "throw", "new", "SaslException", "(", "\"", "Failed", "to", "initialize", "authentication", "mechanism", "using", "SASL", "\"", ",", "e", ")", ";", "}", "}", "@", "Override", "public", "void", "authenticate", "(", "Socket", "sock", ",", "String", "hostName", ")", "throws", "IOException", "{", "if", "(", "!", "quorumRequireSasl", ")", "{", "/", "/", "let", "it", "through", ",", "we", "don", "'", "t", "require", "auth", "LOG", ".", "info", "(", "\"", "Skipping", "SASL", "authentication", "as", "{", "}=", "{}", "\",", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "quorumRequireSasl", ")", ";", "return", ";", "}", "SaslClient", "sc", "=", "null", ";", "String", "principalConfig", "=", "SecurityUtils", ".", "getServerPrincipal", "(", "quorumServicePrincipal", ",", "hostName", ")", ";", "try", "{", "DataOutputStream", "dout", "=", "new", "DataOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ";", "DataInputStream", "din", "=", "new", "DataInputStream", "(", "sock", ".", "getInputStream", "(", "))", ";", "byte", "[", "]", "responseToken", "=", "new", "byte", "[", "0", "]", ";", "sc", "=", "SecurityUtils", ".", "createSaslClient", "(", "learnerLogin", ".", "getSubject", "(", "),", "principalConfig", ",", "QuorumAuth", ".", "QUORUM_SERVER_PROTOCOL_NAME", ",", "QuorumAuth", ".", "QUORUM_SERVER_SASL_DIGEST", ",", "LOG", ",", "\"", "QuorumLearner", "\"", ");", "if", "(", "sc", ".", "hasInitialResponse", "(", "))", "{", "responseToken", "=", "createSaslToken", "(", "new", "byte", "[", "0", "]", ",", "sc", ",", "learnerLogin", ")", ";", "}", "send", "(", "dout", ",", "responseToken", ")", ";", "QuorumAuthPacket", "authPacket", "=", "receive", "(", "din", ")", ";", "QuorumAuth", ".", "Status", "qpStatus", "=", "QuorumAuth", ".", "Status", ".", "getStatus", "(", "authPacket", ".", "getStatus", "(", "))", ";", "while", "(", "!", "sc", ".", "isComplete", "(", "))", "{", "switch", "(", "qpStatus", ")", "{", "case", "SUCCESS", ":", "responseToken", "=", "createSaslToken", "(", "authPacket", ".", "getToken", "(", "),", "sc", ",", "learnerLogin", ")", ";", "/", "/", "we", "'", "re", "done", ";", "don", "'", "t", "expect", "to", "send", "another", "BIND", "if", "(", "responseToken", "!", "=", "null", ")", "{", "throw", "new", "SaslException", "(", "\"", "Protocol", "error", ":", "attempting", "to", "send", "response", "after", "completion", "\"", ");", "}", "break", ";", "case", "IN_PROGRESS", ":", "responseToken", "=", "createSaslToken", "(", "authPacket", ".", "getToken", "(", "),", "sc", ",", "learnerLogin", ")", ";", "send", "(", "dout", ",", "responseToken", ")", ";", "authPacket", "=", "receive", "(", "din", ")", ";", "qpStatus", "=", "QuorumAuth", ".", "Status", ".", "getStatus", "(", "authPacket", ".", "getStatus", "(", "))", ";", "break", ";", "case", "ERROR", ":", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", "against", "server", "addr", ":", "\"", "+", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "default", ":", "LOG", ".", "warn", "(", "\"", "Unknown", "status", ":", "{}", "!\"", ",", "qpStatus", ")", ";", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", "against", "server", "addr", ":", "\"", "+", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "}", "}", "/", "/", "Validate", "status", "code", "at", "the", "end", "of", "authentication", "exchange", ".", "checkAuthStatus", "(", "sock", ",", "qpStatus", ")", ";", "}", "finally", "{", "if", "(", "sc", "!", "=", "null", ")", "{", "try", "{", "sc", ".", "dispose", "(", ");", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "SaslClient", "dispose", "(", ")", "failed", "\"", ",", "e", ")", ";", "}", "}", "}", "return", ";", "}", "private", "void", "checkAuthStatus", "(", "Socket", "sock", ",", "QuorumAuth", ".", "Status", "qpStatus", ")", "throws", "SaslException", "{", "if", "(", "qpStatus", "=", "=", "QuorumAuth", ".", "Status", ".", "SUCCESS", ")", "{", "LOG", ".", "info", "(", "\"", "Successfully", "completed", "the", "authentication", "using", "SASL", ".", "server", "addr", ":", "{", "},", "status", ":", "{", "}\"", ",", "sock", ".", "getRemoteSocketAddress", "(", "),", "qpStatus", ")", ";", "}", "else", "{", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", "against", "server", "addr", ":", "\"", "+", "sock", ".", "getRemoteSocketAddress", "(", ")", "+", "\"", ",", "qpStatus", ":", "\"", "+", "qpStatus", ")", ";", "}", "}", "private", "QuorumAuthPacket", "receive", "(", "DataInputStream", "din", ")", "throws", "IOException", "{", "QuorumAuthPacket", "authPacket", "=", "new", "QuorumAuthPacket", "(", ");", "BinaryInputArchive", "bia", "=", "BinaryInputArchive", ".", "getArchive", "(", "din", ")", ";", "authPacket", ".", "deserialize", "(", "bia", ",", "QuorumAuth", ".", "QUORUM_AUTH_MESSAGE_TAG", ")", ";", "return", "authPacket", ";", "}", "private", "void", "send", "(", "DataOutputStream", "dout", ",", "byte", "[", "]", "response", ")", "throws", "IOException", "{", "QuorumAuthPacket", "authPacket", ";", "BufferedOutputStream", "bufferedOutput", "=", "new", "BufferedOutputStream", "(", "dout", ")", ";", "BinaryOutputArchive", "boa", "=", "BinaryOutputArchive", ".", "getArchive", "(", "bufferedOutput", ")", ";", "authPacket", "=", "QuorumAuth", ".", "createPacket", "(", "QuorumAuth", ".", "Status", ".", "IN_PROGRESS", ",", "response", ")", ";", "boa", ".", "writeRecord", "(", "authPacket", ",", "QuorumAuth", ".", "QUORUM_AUTH_MESSAGE_TAG", ")", ";", "bufferedOutput", ".", "flush", "(", ");", "}", "/", "/", "TODO", ":", "need", "to", "consolidate", "the", "#", "createSaslToken", "(", ")", "implementation", "between", "ZooKeeperSaslClient", "#", "createSaslToken", "(", ").", "private", "byte", "[", "]", "createSaslToken", "(", "final", "byte", "[", "]", "saslToken", ",", "final", "SaslClient", "saslClient", ",", "final", "Login", "login", ")", "throws", "SaslException", "{", "if", "(", "saslToken", "=", "=", "null", ")", "{", "throw", "new", "SaslException", "(", "\"", "Error", "in", "authenticating", "with", "a", "Zookeeper", "Quorum", "member", ":", "the", "quorum", "member", "'", "s", "saslToken", "is", "null", ".", "\")", ";", "}", "if", "(", "login", ".", "getSubject", "(", ")", "!", "=", "null", ")", "{", "synchronized", "(", "login", ")", "{", "try", "{", "final", "byte", "[", "]", "retval", "=", "Subject", ".", "doAs", "(", "login", ".", "getSubject", "(", "),", "new", "PrivilegedExceptionAction", "<", "byte", "[", "]>", "()", "{", "public", "byte", "[", "]", "run", "(", ")", "throws", "SaslException", "{", "LOG", ".", "debug", "(", "\"", "saslClient", ".", "evaluateChallenge", "(", "len", "=", "\"", "+", "saslToken", ".", "length", "+", "\"", ")\"", ");", "return", "saslClient", ".", "evaluateChallenge", "(", "saslToken", ")", ";", "}", "}", ");", "return", "retval", ";", "}", "catch", "(", "PrivilegedActionException", "e", ")", "{", "String", "error", "=", "\"", "An", "error", ":", "(", "\"", "+", "e", "+", "\"", ")", "occurred", "when", "evaluating", "Zookeeper", "Quorum", "Member", "'", "s", "\"", "+", "\"", "received", "SASL", "token", ".", "\";", "/", "/", "Try", "to", "provide", "hints", "to", "use", "about", "what", "went", "wrong", "so", "they", "/", "/", "can", "fix", "their", "configuration", ".", "/", "/", "TODO", ":", "introspect", "about", "e", ":", "look", "for", "GSS", "information", ".", "final", "String", "UNKNOWN_SERVER_ERROR_TEXT", "=", "\"", "(", "Mechanism", "level", ":", "Server", "not", "found", "in", "Kerberos", "database", "(", "7", ")", "-", "UNKNOWN_SERVER", ")", "\";", "if", "(", "e", ".", "toString", "(", ").", "indexOf", "(", "UNKNOWN_SERVER_ERROR_TEXT", ")", ">", "-", "1", ")", "{", "error", "+", "=", "\"", "This", "may", "be", "caused", "by", "Java", "'", "s", "being", "unable", "to", "resolve", "the", "Zookeeper", "Quorum", "Member", "'", "s", "\"", "+", "\"", "hostname", "correctly", ".", "You", "may", "want", "to", "try", "to", "adding", "\"", "+", "\"", "'", "-", "Dsun", ".", "net", ".", "spi", ".", "nameservice", ".", "provider", ".", "1", "=", "dns", ",", "sun", "'", "to", "your", "server", "'", "s", "JVMFLAGS", "environment", ".", "\";", "}", "LOG", ".", "error", "(", "error", ")", ";", "throw", "new", "SaslException", "(", "error", ")", ";", "}", "}", "}", "else", "{", "throw", "new", "SaslException", "(", "\"", "Cannot", "make", "SASL", "token", "without", "subject", "defined", ".", "\"", "+", "\"", "For", "diagnosis", ",", "please", "look", "for", "WARNs", "and", "ERRORs", "in", "your", "log", "related", "to", "the", "Login", "class", ".", "\")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "179", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "io", ".", "DataOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "AppConfigurationEntry", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "Configuration", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "LoginException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslServer", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryInputArchive", ";", "import", "org", ".", "apache", ".", "jute", ".", "BinaryOutputArchive", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "Login", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "ZKConfig", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumAuthPacket", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "util", ".", "SecurityUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "public", "class", "SaslQuorumAuthServer", "implements", "QuorumAuthServer", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "SaslQuorumAuthServer", ".", "class", ")", ";", "private", "final", "static", "int", "MAX_RETRIES", "=", "5", ";", "private", "final", "Login", "serverLogin", ";", "private", "final", "boolean", "quorumRequireSasl", ";", "public", "SaslQuorumAuthServer", "(", "boolean", "quorumRequireSasl", ",", "String", "loginContext", ",", "Set", "<", "String", ">", "authzHosts", ")", "throws", "SaslException", "{", "this", ".", "quorumRequireSasl", "=", "quorumRequireSasl", ";", "try", "{", "AppConfigurationEntry", "entries", "[", "]", "=", "Configuration", ".", "getConfiguration", "(", ")", ".", "getAppConfigurationEntry", "(", "loginContext", ")", ";", "if", "(", "entries", "=", "=", "null", "|", "|", "entries", ".", "length", "=", "=", "0", ")", "{", "throw", "new", "LoginException", "(", "\"", "SASL", "-", "authentication", "failed", "\"", "+", "\"", "because", "the", "specified", "JAAS", "configuration", "\"", "+", "\"", "section", "'", "\"", "+", "loginContext", "+", "\"", "'", "could", "not", "be", "found", ".", "\")", ";", "}", "SaslQuorumServerCallbackHandler", "saslServerCallbackHandler", "=", "new", "SaslQuorumServerCallbackHandler", "(", "Configuration", ".", "getConfiguration", "(", "),", "loginContext", ",", "authzHosts", ")", ";", "serverLogin", "=", "new", "Login", "(", "loginContext", ",", "saslServerCallbackHandler", ",", "new", "ZKConfig", "(", "))", ";", "serverLogin", ".", "startThreadIfNeeded", "(", ");", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "SaslException", "(", "\"", "Failed", "to", "initialize", "authentication", "mechanism", "using", "SASL", "\"", ",", "e", ")", ";", "}", "}", "@", "Override", "public", "void", "authenticate", "(", "Socket", "sock", ",", "DataInputStream", "din", ")", "throws", "SaslException", "{", "DataOutputStream", "dout", "=", "null", ";", "SaslServer", "ss", "=", "null", ";", "try", "{", "if", "(", "!", "QuorumAuth", ".", "nextPacketIsAuth", "(", "din", ")", ")", "{", "if", "(", "quorumRequireSasl", ")", "{", "throw", "new", "SaslException", "(", "\"", "Learner", "not", "trying", "to", "authenticate", "\"", "+", "\"", "and", "authentication", "is", "required", "\"", ");", "}", "else", "{", "/", "/", "let", "it", "through", ",", "we", "don", "'", "t", "require", "auth", "return", ";", "}", "}", "byte", "[", "]", "token", "=", "receive", "(", "din", ")", ";", "int", "tries", "=", "0", ";", "dout", "=", "new", "DataOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ";", "byte", "[", "]", "challenge", "=", "null", ";", "ss", "=", "SecurityUtils", ".", "createSaslServer", "(", "serverLogin", ".", "getSubject", "(", "),", "QuorumAuth", ".", "QUORUM_SERVER_PROTOCOL_NAME", ",", "QuorumAuth", ".", "QUORUM_SERVER_SASL_DIGEST", ",", "serverLogin", ".", "callbackHandler", ",", "LOG", ")", ";", "while", "(", "!", "ss", ".", "isComplete", "(", "))", "{", "challenge", "=", "ss", ".", "evaluateResponse", "(", "token", ")", ";", "if", "(", "!", "ss", ".", "isComplete", "(", "))", "{", "/", "/", "limited", "number", "of", "retries", ".", "if", "(", "++", "tries", ">", "MAX_RETRIES", ")", "{", "send", "(", "dout", ",", "challenge", ",", "QuorumAuth", ".", "Status", ".", "ERROR", ")", ";", "LOG", ".", "warn", "(", "\"", "Failed", "to", "authenticate", "using", "SASL", ",", "server", "addr", ":", "{", "},", "retries", "=", "{}", "exceeded", ".", "\",", "sock", ".", "getRemoteSocketAddress", "(", "),", "tries", ")", ";", "break", ";", "}", "send", "(", "dout", ",", "challenge", ",", "QuorumAuth", ".", "Status", ".", "IN_PROGRESS", ")", ";", "token", "=", "receive", "(", "din", ")", ";", "}", "}", "/", "/", "Authentication", "exchange", "has", "completed", "if", "(", "ss", ".", "isComplete", "(", "))", "{", "send", "(", "dout", ",", "challenge", ",", "QuorumAuth", ".", "Status", ".", "SUCCESS", ")", ";", "LOG", ".", "info", "(", "\"", "Successfully", "completed", "the", "authentication", "using", "SASL", ".", "learner", "addr", ":", "{", "}\"", ",", "sock", ".", "getRemoteSocketAddress", "(", "))", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "try", "{", "if", "(", "dout", "!", "=", "null", ")", "{", "/", "/", "send", "error", "message", "to", "the", "learner", "send", "(", "dout", ",", "new", "byte", "[", "0", "]", ",", "QuorumAuth", ".", "Status", ".", "ERROR", ")", ";", "}", "}", "catch", "(", "IOException", "ioe", ")", "{", "LOG", ".", "warn", "(", "\"", "Exception", "while", "sending", "failed", "status", "\"", ",", "ioe", ")", ";", "}", "/", "/", "If", "sasl", "is", "not", "required", ",", "when", "a", "server", "initializes", "a", "/", "/", "connection", "it", "will", "try", "to", "log", "in", ",", "but", "it", "will", "also", "/", "/", "accept", "connections", "that", "do", "not", "start", "with", "a", "sasl", "/", "/", "handshake", ".", "if", "(", "quorumRequireSasl", ")", "{", "LOG", ".", "error", "(", "\"", "Failed", "to", "authenticate", "using", "SASL", "\"", ",", "e", ")", ";", "throw", "new", "SaslException", "(", "\"", "Failed", "to", "authenticate", "using", "SASL", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "Failed", "to", "authenticate", "using", "SASL", "\"", ",", "e", ")", ";", "LOG", ".", "warn", "(", "\"", "Maintaining", "learner", "connection", "despite", "SASL", "authentication", "failure", ".", "\"", "+", "\"", "server", "addr", ":", "{", "},", "{", "}:", "{", "}\"", ",", "new", "Object", "[", "]", "{", "sock", ".", "getRemoteSocketAddress", "(", "),", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "quorumRequireSasl", "}", ");", "return", ";", "/", "/", "let", "it", "through", ",", "we", "don", "'", "t", "require", "auth", "}", "}", "finally", "{", "if", "(", "ss", "!", "=", "null", ")", "{", "try", "{", "ss", ".", "dispose", "(", ");", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "SaslServer", "dispose", "(", ")", "failed", "\"", ",", "e", ")", ";", "}", "}", "}", "return", ";", "}", "private", "byte", "[", "]", "receive", "(", "DataInputStream", "din", ")", "throws", "IOException", "{", "QuorumAuthPacket", "authPacket", "=", "new", "QuorumAuthPacket", "(", ");", "BinaryInputArchive", "bia", "=", "BinaryInputArchive", ".", "getArchive", "(", "din", ")", ";", "authPacket", ".", "deserialize", "(", "bia", ",", "QuorumAuth", ".", "QUORUM_AUTH_MESSAGE_TAG", ")", ";", "return", "authPacket", ".", "getToken", "(", ");", "}", "private", "void", "send", "(", "DataOutputStream", "dout", ",", "byte", "[", "]", "challenge", ",", "QuorumAuth", ".", "Status", "s", ")", "throws", "IOException", "{", "BufferedOutputStream", "bufferedOutput", "=", "new", "BufferedOutputStream", "(", "dout", ")", ";", "BinaryOutputArchive", "boa", "=", "BinaryOutputArchive", ".", "getArchive", "(", "bufferedOutput", ")", ";", "QuorumAuthPacket", "authPacket", ";", "if", "(", "challenge", "=", "=", "null", "&", "&", "s", "!", "=", "QuorumAuth", ".", "Status", ".", "SUCCESS", ")", "{", "authPacket", "=", "QuorumAuth", ".", "createPacket", "(", "QuorumAuth", ".", "Status", ".", "IN_PROGRESS", ",", "null", ")", ";", "}", "else", "{", "authPacket", "=", "QuorumAuth", ".", "createPacket", "(", "s", ",", "challenge", ")", ";", "}", "boa", ".", "writeRecord", "(", "authPacket", ",", "QuorumAuth", ".", "QUORUM_AUTH_MESSAGE_TAG", ")", ";", "bufferedOutput", ".", "flush", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "148", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "Callback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "CallbackHandler", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "NameCallback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "PasswordCallback", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "UnsupportedCallbackException", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "AppConfigurationEntry", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "Configuration", ";", "import", "javax", ".", "security", ".", "sasl", ".", "AuthorizeCallback", ";", "import", "javax", ".", "security", ".", "sasl", ".", "RealmCallback", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "This", "is", "used", "by", "the", "SASL", "mechanisms", "to", "get", "further", "information", "to", "complete", "*", "the", "authentication", ".", "For", "example", ",", "a", "SASL", "mechanism", "might", "use", "this", "callback", "*", "handler", "to", "do", "verification", "operation", ".", "This", "is", "used", "by", "the", "QuorumServer", "to", "*", "perform", "the", "mutual", "quorum", "peer", "authentication", ".", "*", "/", "public", "class", "SaslQuorumServerCallbackHandler", "implements", "CallbackHandler", "{", "private", "static", "final", "String", "USER_PREFIX", "=", "\"", "user_", "\"", ";", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "SaslQuorumServerCallbackHandler", ".", "class", ")", ";", "private", "String", "userName", ";", "private", "final", "Map", "<", "String", ",", "String", ">", "credentials", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "private", "final", "Set", "<", "String", ">", "authzHosts", ";", "public", "SaslQuorumServerCallbackHandler", "(", "Configuration", "configuration", ",", "String", "serverSection", ",", "Set", "<", "String", ">", "authzHosts", ")", "throws", "IOException", "{", "AppConfigurationEntry", "configurationEntries", "[", "]", "=", "configuration", ".", "getAppConfigurationEntry", "(", "serverSection", ")", ";", "if", "(", "configurationEntries", "=", "=", "null", ")", "{", "String", "errorMessage", "=", "\"", "Could", "not", "find", "a", "'", "\"", "+", "serverSection", "+", "\"", "'", "entry", "in", "this", "configuration", ":", "Server", "cannot", "start", ".", "\";", "LOG", ".", "error", "(", "errorMessage", ")", ";", "throw", "new", "IOException", "(", "errorMessage", ")", ";", "}", "credentials", ".", "clear", "(", ");", "for", "(", "AppConfigurationEntry", "entry", ":", "configurationEntries", ")", "{", "Map", "<", "String", ",", "?>", "options", "=", "entry", ".", "getOptions", "(", ");", "/", "/", "Populate", "DIGEST", "-", "MD5", "user", "-", ">", "password", "map", "with", "JAAS", "configuration", "entries", "from", "the", "\"", "QuorumServer", "\"", "section", ".", "/", "/", "Usernames", "are", "distinguished", "from", "other", "options", "by", "prefixing", "the", "username", "with", "a", "\"", "user_", "\"", "prefix", ".", "for", "(", "Map", ".", "Entry", "<", "String", ",", "?", ">", "pair", ":", "options", ".", "entrySet", "(", "))", "{", "String", "key", "=", "pair", ".", "getKey", "(", ");", "if", "(", "key", ".", "startsWith", "(", "USER_PREFIX", ")", ")", "{", "String", "userName", "=", "key", ".", "substring", "(", "USER_PREFIX", ".", "length", "(", "))", ";", "credentials", ".", "put", "(", "userName", ",", "(", "String", ")", "pair", ".", "getValue", "(", "))", ";", "}", "}", "}", "/", "/", "authorized", "host", "lists", "this", ".", "authzHosts", "=", "authzHosts", ";", "}", "public", "void", "handle", "(", "Callback", "[", "]", "callbacks", ")", "throws", "UnsupportedCallbackException", "{", "for", "(", "Callback", "callback", ":", "callbacks", ")", "{", "if", "(", "callback", "instanceof", "NameCallback", ")", "{", "handleNameCallback", "(", "(", "NameCallback", ")", "callback", ")", ";", "}", "else", "if", "(", "callback", "instanceof", "PasswordCallback", ")", "{", "handlePasswordCallback", "(", "(", "PasswordCallback", ")", "callback", ")", ";", "}", "else", "if", "(", "callback", "instanceof", "RealmCallback", ")", "{", "handleRealmCallback", "(", "(", "RealmCallback", ")", "callback", ")", ";", "}", "else", "if", "(", "callback", "instanceof", "AuthorizeCallback", ")", "{", "handleAuthorizeCallback", "(", "(", "AuthorizeCallback", ")", "callback", ")", ";", "}", "}", "}", "private", "void", "handleNameCallback", "(", "NameCallback", "nc", ")", "{", "/", "/", "check", "to", "see", "if", "this", "user", "is", "in", "the", "user", "password", "database", ".", "if", "(", "credentials", ".", "get", "(", "nc", ".", "getDefaultName", "(", "))", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "User", "'", "{}", "'", "not", "found", "in", "list", "of", "DIGEST", "-", "MD5", "authenticateable", "users", ".", "\",", "nc", ".", "getDefaultName", "(", "))", ";", "return", ";", "}", "nc", ".", "setName", "(", "nc", ".", "getDefaultName", "(", "))", ";", "userName", "=", "nc", ".", "getDefaultName", "(", ");", "}", "private", "void", "handlePasswordCallback", "(", "PasswordCallback", "pc", ")", "{", "if", "(", "credentials", ".", "containsKey", "(", "userName", ")", ")", "{", "pc", ".", "setPassword", "(", "credentials", ".", "get", "(", "userName", ")", ".", "toCharArray", "(", "))", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "No", "password", "found", "for", "user", ":", "{", "}\"", ",", "userName", ")", ";", "}", "}", "private", "void", "handleRealmCallback", "(", "RealmCallback", "rc", ")", "{", "LOG", ".", "debug", "(", "\"", "QuorumLearner", "supplied", "realm", ":", "{", "}\"", ",", "rc", ".", "getDefaultText", "(", "))", ";", "rc", ".", "setText", "(", "rc", ".", "getDefaultText", "(", "))", ";", "}", "private", "void", "handleAuthorizeCallback", "(", "AuthorizeCallback", "ac", ")", "{", "String", "authenticationID", "=", "ac", ".", "getAuthenticationID", "(", ");", "String", "authorizationID", "=", "ac", ".", "getAuthorizationID", "(", ");", "boolean", "authzFlag", "=", "false", ";", "/", "/", "1", ".", "Matches", "authenticationID", "and", "authorizationID", "authzFlag", "=", "authenticationID", ".", "equals", "(", "authorizationID", ")", ";", "/", "/", "2", ".", "Verify", "whether", "the", "connecting", "host", "is", "present", "in", "authorized", "hosts", ".", "/", "/", "If", "not", "exists", ",", "then", "connecting", "peer", "is", "not", "authorized", "to", "join", "the", "/", "/", "ensemble", "and", "will", "reject", "it", ".", "if", "(", "authzFlag", ")", "{", "String", "[", "]", "components", "=", "authorizationID", ".", "split", "(", "\"[", "/@", "]\"", ");", "if", "(", "components", ".", "length", "=", "=", "3", ")", "{", "authzFlag", "=", "authzHosts", ".", "contains", "(", "components", "[", "1", "]", ");", "}", "if", "(", "!", "authzFlag", ")", "{", "LOG", ".", "error", "(", "\"", "SASL", "authorization", "completed", ",", "{", "}", "is", "not", "authorized", "to", "connect", "\"", ",", "components", "[", "1", "]", ");", "}", "}", "/", "/", "Sets", "authorization", "flag", "ac", ".", "setAuthorized", "(", "authzFlag", ")", ";", "if", "(", "ac", ".", "isAuthorized", "(", "))", "{", "ac", ".", "setAuthorizedID", "(", "authorizationID", ")", ";", "LOG", ".", "info", "(", "\"", "Successfully", "authenticated", "learner", ":", "authenticationID", "=", "{}", ";", "authorizationID", "=", "{}", ".\"", ",", "authenticationID", ",", "authorizationID", ")", ";", "}", "LOG", ".", "debug", "(", "\"", "SASL", "authorization", "completed", ",", "authorized", "flag", "set", "to", "{", "}\"", ",", "ac", ".", "isAuthorized", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "298", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "util", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "PrivilegedActionException", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "javax", ".", "security", ".", "auth", ".", "callback", ".", "CallbackHandler", ";", "import", "javax", ".", "security", ".", "sasl", ".", "Sasl", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslClient", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "SaslClientCallbackHandler", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "KerberosName", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSContext", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSCredential", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSException", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSManager", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "GSSName", ";", "import", "org", ".", "ietf", ".", "jgss", ".", "Oid", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "public", "final", "class", "SecurityUtils", "{", "public", "static", "final", "String", "QUORUM_HOSTNAME_PATTERN", "=", "\"", "_HOST", "\"", ";", "/", "**", "*", "Create", "an", "instance", "of", "a", "SaslClient", ".", "It", "will", "return", "null", "if", "there", "is", "an", "exception", ".", "*", "*", "@", "param", "subject", "subject", "*", "@", "param", "servicePrincipal", "principal", "*", "@", "param", "protocol", "name", "of", "the", "protocol", "for", "which", "the", "authentication", "is", "being", "performed", "*", "@", "param", "serverName", "name", "of", "the", "server", "to", "authenticate", "to", "*", "@", "param", "LOG", "logger", "*", "@", "param", "entity", "can", "be", "either", "zookeeper", "client", "or", "quorum", "learner", "*", "*", "@", "return", "saslclient", "object", "*", "@", "throws", "SaslException", "*", "/", "public", "static", "SaslClient", "createSaslClient", "(", "final", "Subject", "subject", ",", "final", "String", "servicePrincipal", ",", "final", "String", "protocol", ",", "final", "String", "serverName", ",", "final", "Logger", "LOG", ",", "final", "String", "entity", ")", "throws", "SaslException", "{", "SaslClient", "saslClient", ";", "/", "/", "Use", "subject", ".", "getPrincipals", "(", ").", "isEmpty", "(", ")", "as", "an", "indication", "of", "which", "SASL", "/", "/", "mechanism", "to", "use", ":", "if", "empty", ",", "use", "DIGEST", "-", "MD5", ";", "otherwise", ",", "use", "GSSAPI", ".", "if", "(", "subject", ".", "getPrincipals", "(", ").", "isEmpty", "(", "))", "{", "/", "/", "no", "principals", ":", "must", "not", "be", "GSSAPI", ":", "use", "DIGEST", "-", "MD5", "mechanism", "/", "/", "instead", ".", "LOG", ".", "info", "(", "\"{", "}", "will", "use", "DIGEST", "-", "MD5", "as", "SASL", "mechanism", ".", "\",", "entity", ")", ";", "String", "[", "]", "mechs", "=", "{", "\"", "DIGEST", "-", "MD5", "\"", "}", ";", "String", "username", "=", "(", "String", ")", "(", "subject", ".", "getPublicCredentials", "(", ")", ".", "toArray", "(", ")[", "0", "]", ");", "String", "password", "=", "(", "String", ")", "(", "subject", ".", "getPrivateCredentials", "(", ")", ".", "toArray", "(", ")[", "0", "]", ");", "/", "/", "'", "domain", "'", "parameter", "is", "hard", "-", "wired", "between", "the", "server", "and", "client", "saslClient", "=", "Sasl", ".", "createSaslClient", "(", "mechs", ",", "username", ",", "protocol", ",", "serverName", ",", "null", ",", "new", "SaslClientCallbackHandler", "(", "password", ",", "entity", ")", ");", "return", "saslClient", ";", "}", "else", "{", "/", "/", "GSSAPI", ".", "final", "Object", "[", "]", "principals", "=", "subject", ".", "getPrincipals", "(", ").", "toArray", "(", ");", "/", "/", "determine", "client", "principal", "from", "subject", ".", "final", "Principal", "clientPrincipal", "=", "(", "Principal", ")", "principals", "[", "0", "]", ";", "boolean", "usingNativeJgss", "=", "Boolean", ".", "getBoolean", "(", "\"", "sun", ".", "security", ".", "jgss", ".", "native", "\"", ");", "if", "(", "usingNativeJgss", ")", "{", "/", "/", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "6", "/", "docs", "/", "technotes", "/", "guides", "/", "security", "/", "jgss", "/", "jgss", "-", "features", ".", "html", "/", "/", "\"", "\"\"", "/", "/", "In", "addition", ",", "when", "performing", "operations", "as", "a", "particular", "/", "/", "Subject", ",", "e", ".", "g", ".", "Subject", ".", "doAs", "(", "..", ".)", "or", "/", "/", "Subject", ".", "doAsPrivileged", "(", "..", ".)", ",", "/", "/", "the", "to", "-", "be", "-", "used", "GSSCredential", "should", "be", "added", "to", "Subject", "'", "s", "/", "/", "private", "credential", "set", ".", "Otherwise", ",", "the", "GSS", "operations", "will", "/", "/", "fail", "since", "no", "credential", "is", "found", ".", "/", "/", "\"", "\"\"", "try", "{", "GSSManager", "manager", "=", "GSSManager", ".", "getInstance", "(", ");", "Oid", "krb5Mechanism", "=", "new", "Oid", "(", "\"", "1", ".", "2", ".", "840", ".", "113554", ".", "1", ".", "2", ".", "2", "\"", ");", "GSSCredential", "cred", "=", "manager", ".", "createCredential", "(", "null", ",", "GSSContext", ".", "DEFAULT_LIFETIME", ",", "krb5Mechanism", ",", "GSSCredential", ".", "INITIATE_ONLY", ")", ";", "subject", ".", "getPrivateCredentials", "(", ").", "add", "(", "cred", ")", ";", "LOG", ".", "debug", "(", "\"", "Added", "private", "credential", "to", "{", "}", "principal", "name", ":", "'", "{}", "'\"", ",", "entity", ",", "clientPrincipal", ")", ";", "}", "catch", "(", "GSSException", "ex", ")", "{", "LOG", ".", "warn", "(", "\"", "Cannot", "add", "private", "credential", "to", "subject", ";", "\"", "+", "\"", "authentication", "at", "the", "server", "may", "fail", "\"", ",", "ex", ")", ";", "}", "}", "final", "KerberosName", "clientKerberosName", "=", "new", "KerberosName", "(", "clientPrincipal", ".", "getName", "(", "))", ";", "/", "/", "assume", "that", "server", "and", "client", "are", "in", "the", "same", "realm", "(", "by", "default", ";", "/", "/", "unless", "the", "system", "property", "/", "/", "\"", "zookeeper", ".", "server", ".", "realm", "\"", "is", "set", ")", ".", "String", "serverRealm", "=", "System", ".", "getProperty", "(", "\"", "zookeeper", ".", "server", ".", "realm", "\"", ",", "clientKerberosName", ".", "getRealm", "(", "))", ";", "KerberosName", "serviceKerberosName", "=", "new", "KerberosName", "(", "servicePrincipal", "+", "\"", "@\"", "+", "serverRealm", ")", ";", "final", "String", "serviceName", "=", "serviceKerberosName", ".", "getServiceName", "(", ");", "final", "String", "serviceHostname", "=", "serviceKerberosName", ".", "getHostName", "(", ");", "final", "String", "clientPrincipalName", "=", "clientKerberosName", ".", "toString", "(", ");", "try", "{", "saslClient", "=", "Subject", ".", "doAs", "(", "subject", ",", "new", "PrivilegedExceptionAction", "<", "SaslClient", ">", "()", "{", "public", "SaslClient", "run", "(", ")", "throws", "SaslException", "{", "LOG", ".", "info", "(", "\"{", "}", "will", "use", "GSSAPI", "as", "SASL", "mechanism", ".", "\",", "entity", ")", ";", "String", "[", "]", "mechs", "=", "{", "\"", "GSSAPI", "\"", "}", ";", "LOG", ".", "debug", "(", "\"", "creating", "sasl", "client", ":", "{", "}=", "{}", ";", "service", "=", "{}", ";", "serviceHostname", "=", "{}", "\",", "new", "Object", "[", "]", "{", "entity", ",", "clientPrincipalName", ",", "serviceName", ",", "serviceHostname", "}", ");", "SaslClient", "saslClient", "=", "Sasl", ".", "createSaslClient", "(", "mechs", ",", "clientPrincipalName", ",", "serviceName", ",", "serviceHostname", ",", "null", ",", "new", "SaslClientCallbackHandler", "(", "null", ",", "entity", ")", ");", "return", "saslClient", ";", "}", "}", ");", "return", "saslClient", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Exception", "while", "trying", "to", "create", "SASL", "client", "\"", ",", "e", ")", ";", "return", "null", ";", "}", "}", "}", "/", "**", "*", "Create", "an", "instance", "of", "a", "SaslServer", ".", "It", "will", "return", "null", "if", "there", "is", "an", "exception", ".", "*", "*", "@", "param", "subject", "subject", "*", "@", "param", "protocol", "protocol", "*", "@", "param", "serverName", "server", "name", "*", "@", "param", "callbackHandler", "login", "callback", "handler", "*", "@", "param", "LOG", "logger", "*", "@", "return", "sasl", "server", "object", "*", "/", "public", "static", "SaslServer", "createSaslServer", "(", "final", "Subject", "subject", ",", "final", "String", "protocol", ",", "final", "String", "serverName", ",", "final", "CallbackHandler", "callbackHandler", ",", "final", "Logger", "LOG", ")", "{", "if", "(", "subject", "!", "=", "null", ")", "{", "/", "/", "server", "is", "using", "a", "JAAS", "-", "authenticated", "subject", ":", "determine", "service", "/", "/", "principal", "name", "and", "hostname", "from", "zk", "server", "'", "s", "subject", ".", "if", "(", "subject", ".", "getPrincipals", "(", ").", "size", "(", ")", ">", "0", ")", "{", "try", "{", "final", "Object", "[", "]", "principals", "=", "subject", ".", "getPrincipals", "(", ")", ".", "toArray", "(", ");", "final", "Principal", "servicePrincipal", "=", "(", "Principal", ")", "principals", "[", "0", "]", ";", "/", "/", "e", ".", "g", ".", "servicePrincipalNameAndHostname", ":", "=", "/", "/", "\"", "zookeeper", "/", "myhost", ".", "foo", ".", "com", "@", "FOO", ".", "COM", "\"", "final", "String", "servicePrincipalNameAndHostname", "=", "servicePrincipal", ".", "getName", "(", ");", "int", "indexOf", "=", "servicePrincipalNameAndHostname", ".", "indexOf", "(", "\"/", "\")", ";", "/", "/", "e", ".", "g", ".", "servicePrincipalName", ":", "=", "\"", "zookeeper", "\"", "final", "String", "servicePrincipalName", "=", "servicePrincipalNameAndHostname", ".", "substring", "(", "0", ",", "indexOf", ")", ";", "/", "/", "e", ".", "g", ".", "serviceHostnameAndKerbDomain", ":", "=", "/", "/", "\"", "myhost", ".", "foo", ".", "com", "@", "FOO", ".", "COM", "\"", "final", "String", "serviceHostnameAndKerbDomain", "=", "servicePrincipalNameAndHostname", ".", "substring", "(", "indexOf", "+", "1", ",", "servicePrincipalNameAndHostname", ".", "length", "(", "))", ";", "indexOf", "=", "serviceHostnameAndKerbDomain", ".", "indexOf", "(", "\"@", "\")", ";", "/", "/", "e", ".", "g", ".", "serviceHostname", ":", "=", "\"", "myhost", ".", "foo", ".", "com", "\"", "final", "String", "serviceHostname", "=", "serviceHostnameAndKerbDomain", ".", "substring", "(", "0", ",", "indexOf", ")", ";", "/", "/", "TODO", ":", "should", "depend", "on", "zoo", ".", "cfg", "specified", "mechs", ",", "but", "if", "/", "/", "subject", "is", "non", "-", "null", ",", "it", "can", "be", "assumed", "to", "be", "GSSAPI", ".", "final", "String", "mech", "=", "\"", "GSSAPI", "\"", ";", "LOG", ".", "debug", "(", "\"", "serviceHostname", "is", "'", "\"", "+", "serviceHostname", "+", "\"", "'\"", ");", "LOG", ".", "debug", "(", "\"", "servicePrincipalName", "is", "'", "\"", "+", "servicePrincipalName", "+", "\"", "'\"", ");", "LOG", ".", "debug", "(", "\"", "SASL", "mechanism", "(", "mech", ")", "is", "'", "\"", "+", "mech", "+", "\"", "'\"", ");", "boolean", "usingNativeJgss", "=", "Boolean", ".", "getBoolean", "(", "\"", "sun", ".", "security", ".", "jgss", ".", "native", "\"", ");", "if", "(", "usingNativeJgss", ")", "{", "/", "/", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "6", "/", "docs", "/", "technotes", "/", "guides", "/", "security", "/", "jgss", "/", "jgss", "-", "features", ".", "html", "/", "/", "\"", "\"\"", "/", "/", "In", "addition", ",", "when", "performing", "operations", "as", "a", "/", "/", "particular", "/", "/", "Subject", ",", "e", ".", "g", ".", "Subject", ".", "doAs", "(", "..", ".)", "or", "/", "/", "Subject", ".", "doAsPrivileged", "(", "..", ".)", ",", "the", "to", "-", "be", "-", "used", "/", "/", "GSSCredential", "should", "be", "added", "to", "Subject", "'", "s", "/", "/", "private", "credential", "set", ".", "Otherwise", ",", "the", "GSS", "operations", "/", "/", "will", "fail", "since", "no", "credential", "is", "found", ".", "/", "/", "\"", "\"\"", "try", "{", "GSSManager", "manager", "=", "GSSManager", ".", "getInstance", "(", ");", "Oid", "krb5Mechanism", "=", "new", "Oid", "(", "\"", "1", ".", "2", ".", "840", ".", "113554", ".", "1", ".", "2", ".", "2", "\"", ");", "GSSName", "gssName", "=", "manager", ".", "createName", "(", "servicePrincipalName", "+", "\"", "@\"", "+", "serviceHostname", ",", "GSSName", ".", "NT_HOSTBASED_SERVICE", ")", ";", "GSSCredential", "cred", "=", "manager", ".", "createCredential", "(", "gssName", ",", "GSSContext", ".", "DEFAULT_LIFETIME", ",", "krb5Mechanism", ",", "GSSCredential", ".", "ACCEPT_ONLY", ")", ";", "subject", ".", "getPrivateCredentials", "(", ").", "add", "(", "cred", ")", ";", "LOG", ".", "debug", "(", "\"", "Added", "private", "credential", "to", "service", "principal", "name", ":", "'", "{}", "',", "\"", "+", "\"", "GSSCredential", "name", ":", "{", "}\"", ",", "servicePrincipalName", ",", "cred", ".", "getName", "(", "))", ";", "}", "catch", "(", "GSSException", "ex", ")", "{", "LOG", ".", "warn", "(", "\"", "Cannot", "add", "private", "credential", "to", "subject", ";", "\"", "+", "\"", "clients", "authentication", "may", "fail", "\"", ",", "ex", ")", ";", "}", "}", "try", "{", "return", "Subject", ".", "doAs", "(", "subject", ",", "new", "PrivilegedExceptionAction", "<", "SaslServer", ">", "()", "{", "public", "SaslServer", "run", "(", ")", "{", "try", "{", "SaslServer", "saslServer", ";", "saslServer", "=", "Sasl", ".", "createSaslServer", "(", "mech", ",", "servicePrincipalName", ",", "serviceHostname", ",", "null", ",", "callbackHandler", ")", ";", "return", "saslServer", ";", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Zookeeper", "Server", "failed", "to", "create", "a", "SaslServer", "to", "interact", "with", "a", "client", "during", "session", "initiation", ":", "\"", ",", "e", ")", ";", "return", "null", ";", "}", "}", "}", ");", "}", "catch", "(", "PrivilegedActionException", "e", ")", "{", "/", "/", "TODO", ":", "exit", "server", "at", "this", "point", "(", "?)", "LOG", ".", "error", "(", "\"", "Zookeeper", "Quorum", "member", "experienced", "a", "PrivilegedActionException", "exception", "while", "creating", "a", "SaslServer", "using", "a", "JAAS", "principal", "context", ":", "\",", "e", ")", ";", "}", "}", "catch", "(", "IndexOutOfBoundsException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "server", "principal", "name", "/", "hostname", "determination", "error", ":", "\"", ",", "e", ")", ";", "}", "}", "else", "{", "/", "/", "JAAS", "non", "-", "GSSAPI", "authentication", ":", "assuming", "and", "supporting", "only", "/", "/", "DIGEST", "-", "MD5", "mechanism", "for", "now", ".", "/", "/", "TODO", ":", "use", "'", "authMech", "=", "'", "value", "in", "zoo", ".", "cfg", ".", "try", "{", "SaslServer", "saslServer", "=", "Sasl", ".", "createSaslServer", "(", "\"", "DIGEST", "-", "MD5", "\"", ",", "protocol", ",", "serverName", ",", "null", ",", "callbackHandler", ")", ";", "return", "saslServer", ";", "}", "catch", "(", "SaslException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Zookeeper", "Quorum", "member", "failed", "to", "create", "a", "SaslServer", "to", "interact", "with", "a", "client", "during", "session", "initiation", "\"", ",", "e", ")", ";", "}", "}", "}", "return", "null", ";", "}", "/", "**", "*", "Convert", "Kerberos", "principal", "name", "pattern", "to", "valid", "Kerberos", "principal", "name", ".", "*", "If", "the", "principal", "name", "contains", "hostname", "pattern", "\"", "_HOST", "\"", "then", "it", "replaces", "*", "with", "the", "given", "hostname", ",", "which", "should", "be", "fully", "-", "qualified", "domain", "name", ".", "*", "*", "@", "param", "principalConfig", "*", "the", "Kerberos", "principal", "name", "conf", "value", "to", "convert", "*", "@", "param", "hostname", "*", "the", "fully", "-", "qualified", "domain", "name", "used", "for", "substitution", "*", "@", "return", "converted", "Kerberos", "principal", "name", "*", "/", "public", "static", "String", "getServerPrincipal", "(", "String", "principalConfig", ",", "String", "hostname", ")", "{", "String", "[", "]", "components", "=", "getComponents", "(", "principalConfig", ")", ";", "if", "(", "components", "=", "=", "null", "|", "|", "components", ".", "length", "!", "=", "2", "|", "|", "!", "components", "[", "1", "]", ".", "equals", "(", "QUORUM_HOSTNAME_PATTERN", ")", ")", "{", "return", "principalConfig", ";", "}", "else", "{", "return", "replacePattern", "(", "components", ",", "hostname", ")", ";", "}", "}", "private", "static", "String", "[", "]", "getComponents", "(", "String", "principalConfig", ")", "{", "if", "(", "principalConfig", "=", "=", "null", ")", "return", "null", ";", "return", "principalConfig", ".", "split", "(", "\"[", "/]", "\")", ";", "}", "private", "static", "String", "replacePattern", "(", "String", "[", "]", "components", ",", "String", "hostname", ")", "{", "return", "components", "[", "0", "]", "+", "\"", "/\"", "+", "hostname", ".", "toLowerCase", "(", ");", "}", "}", "@", "@", "-", "66", ",", "6", "+", "66", ",", "11", "@", "@", "<", "Bug", "code", "=", "\"", "EI2", ",", "EI", "\"", "/", ">", "<", "/", "Match", ">", "<", "Match", ">", "<", "Class", "name", "=", "\"", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumAuthPacket", "\"", "/", ">", "<", "Bug", "code", "=", "\"", "EI2", ",", "EI", "\"", "/", ">", "<", "/", "Match", ">", "<", "Match", ">", "<", "Class", "name", "=", "\"", "org", ".", "apache", ".", "zookeeper", ".", "ClientCnxn", "\"", "/>", "<", "Bug", "code", "=", "\"", "EI", ",", "EI2", "\"", "/", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "30", "@", "@", "#", "#", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "#", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "#", "distributed", "with", "this", "work", "for", "additional", "information", "#", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "#", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "#", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "#", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "#", "#", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "#", "#", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "#", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "#", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "#", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "#", "limitations", "under", "the", "License", ".", "#", "#", "This", "resource", "is", "originally", "from", "HDFS", ",", "see", "the", "similarly", "named", "files", "there", "#", "in", "case", "of", "bug", "fixing", ",", "history", ",", "etc", ".", "#", "Branch", ":", "trunk", "#", "Github", "Revision", ":", "1d1ab587e4e92ce3aea4cb144811f69145cb3b33", "#", "[", "libdefaults", "]", "default_realm", "=", "{", "0", "}", "udp_preference_limit", "=", "1", "[", "realms", "]", "{", "0", "}", "=", "'", "{'", "kdc", "=", "{", "1", "}", ":{", "2", "}", "'", "}'", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "52", "@", "@", "#", "#", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "#", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "#", "distributed", "with", "this", "work", "for", "additional", "information", "#", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "#", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "#", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "#", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "#", "#", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "#", "#", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "#", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "#", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "#", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "#", "limitations", "under", "the", "License", ".", "#", "#", "This", "resource", "is", "originally", "from", "HDFS", ",", "see", "the", "similarly", "named", "files", "there", "#", "in", "case", "of", "bug", "fixing", ",", "history", ",", "etc", ".", "#", "Branch", ":", "trunk", "#", "Github", "Revision", ":", "1d1ab587e4e92ce3aea4cb144811f69145cb3b33", "#", "dn", ":", "ou", "=", "users", ",", "dc", "=", "${", "0", "}", ",", "dc", "=", "${", "1", "}", "objectClass", ":", "organizationalUnit", "objectClass", ":", "top", "ou", ":", "users", "dn", ":", "uid", "=", "krbtgt", ",", "ou", "=", "users", ",", "dc", "=", "${", "0", "}", ",", "dc", "=", "${", "1", "}", "objectClass", ":", "top", "objectClass", ":", "person", "objectClass", ":", "inetOrgPerson", "objectClass", ":", "krb5principal", "objectClass", ":", "krb5kdcentry", "cn", ":", "KDC", "Service", "sn", ":", "Service", "uid", ":", "krbtgt", "userPassword", ":", "secret", "krb5PrincipalName", ":", "krbtgt", "/", "${", "2", "}", ".$", "{", "3", "}", "@$", "{", "2", "}", ".$", "{", "3", "}", "krb5KeyVersionNumber", ":", "0", "dn", ":", "uid", "=", "ldap", ",", "ou", "=", "users", ",", "dc", "=", "${", "0", "}", ",", "dc", "=", "${", "1", "}", "objectClass", ":", "top", "objectClass", ":", "person", "objectClass", ":", "inetOrgPerson", "objectClass", ":", "krb5principal", "objectClass", ":", "krb5kdcentry", "cn", ":", "LDAP", "sn", ":", "Service", "uid", ":", "ldap", "userPassword", ":", "secret", "krb5PrincipalName", ":", "ldap", "/", "${", "4", "}", "@$", "{", "2", "}", ".$", "{", "3", "}", "krb5KeyVersionNumber", ":", "0", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "38", ",", "6", "+", "38", ",", "8", "@", "@", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "public", "class", "EphemeralNodeDeletionTest", "extends", "QuorumPeerTestBase", "{", "private", "static", "int", "SERVER_COUNT", "=", "3", ";", "private", "MainThread", "[", "]", "mt", "=", "new", "MainThread", "[", "SERVER_COUNT", "]", ";", "@", "@", "-", "181", ",", "6", "+", "183", ",", "10", "@", "@", "private", "QuorumPeer", "getByServerState", "(", "MainThread", "[", "]", "mt", ",", "ServerState", "state", ")", "{", "static", "class", "CustomQuorumPeer", "extends", "QuorumPeer", "{", "private", "boolean", "injectError", "=", "false", ";", "public", "CustomQuorumPeer", "(", ")", "throws", "SaslException", "{", "}", "@", "Override", "protected", "Follower", "makeFollower", "(", "FileTxnSnapLog", "logFactory", ")", "throws", "IOException", "{", "@", "@", "-", "215", ",", "7", "+", "221", ",", "7", "@", "@", "public", "void", "setInjectError", "(", "boolean", "injectError", ")", "{", "static", "class", "MockTestQPMain", "extends", "TestQPMain", "{", "@", "Override", "protected", "QuorumPeer", "getQuorumPeer", "(", ")", "{", "protected", "QuorumPeer", "getQuorumPeer", "(", ")", "throws", "SaslException", "{", "return", "new", "CustomQuorumPeer", "(", ");", "}", "}", "@", "@", "-", "115", ",", "7", "+", "115", ",", "7", "@", "@", "public", "void", "testBackwardElectionRound", "(", ")", "throws", "Exception", "{", "*", "Start", "mock", "server", "1", "*", "/", "QuorumPeer", "mockPeer", "=", "new", "QuorumPeer", "(", "peers", ",", "tmpdir", "[", "1", "]", ",", "tmpdir", "[", "1", "]", ",", "port", "[", "1", "]", ",", "3", ",", "1", ",", "1000", ",", "2", ",", "2", ")", ";", "cnxManagers", "[", "0", "]", "=", "new", "QuorumCnxManager", "(", "mockPeer", ")", ";", "cnxManagers", "[", "0", "]", "=", "mockPeer", ".", "createCnxnManager", "(", ");", "cnxManagers", "[", "0", "]", ".", "listener", ".", "start", "(", ");", "cnxManagers", "[", "0", "]", ".", "toSend", "(", "0l", ",", "initialMsg0", ")", ";", "@", "@", "-", "124", ",", "7", "+", "124", ",", "7", "@", "@", "public", "void", "testBackwardElectionRound", "(", ")", "throws", "Exception", "{", "*", "Start", "mock", "server", "2", "*", "/", "mockPeer", "=", "new", "QuorumPeer", "(", "peers", ",", "tmpdir", "[", "2", "]", ",", "tmpdir", "[", "2", "]", ",", "port", "[", "2", "]", ",", "3", ",", "2", ",", "1000", ",", "2", ",", "2", ")", ";", "cnxManagers", "[", "1", "]", "=", "new", "QuorumCnxManager", "(", "mockPeer", ")", ";", "cnxManagers", "[", "1", "]", "=", "mockPeer", ".", "createCnxnManager", "(", ");", "cnxManagers", "[", "1", "]", ".", "listener", ".", "start", "(", ");", "cnxManagers", "[", "1", "]", ".", "toSend", "(", "0l", ",", "initialMsg1", ")", ";", "@", "@", "-", "95", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "testLostMessage", "(", ")", "throws", "Exception", "{", "void", "mockServer", "(", ")", "throws", "InterruptedException", ",", "IOException", "{", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "tmpdir", "[", "0", "]", ",", "tmpdir", "[", "0", "]", ",", "port", "[", "0", "]", ",", "3", ",", "0", ",", "1000", ",", "2", ",", "2", ")", ";", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "cnxManager", ".", "listener", ".", "start", "(", ");", "cnxManager", ".", "toSend", "(", "1l", ",", "FLETestUtils", ".", "createMsg", "(", "ServerState", ".", "LOOKING", ".", "ordinal", "(", "),", "0", ",", "0", ",", "0", ")", ");", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "util", ".", "Iterator", ";", "@", "@", "-", "55", ",", "7", "+", "56", ",", "7", "@", "@", "boolean", "threadStarted", "=", "false", ";", "MockLearnerHandler", "(", "Socket", "sock", ",", "Leader", "leader", ")", "throws", "IOException", "{", "super", "(", "sock", ",", "leader", ")", ";", "super", "(", "sock", ",", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ",", "leader", ")", ";", "}", "protected", "void", "startSendingPackets", "(", ")", "{", "@", "@", "-", "110", ",", "7", "+", "110", ",", "7", "@", "@", "public", "void", "connectionRetryTimeoutTest", "(", ")", "throws", "Exception", "{", "InetSocketAddress", "addr", "=", "new", "InetSocketAddress", "(", "1111", ")", ";", "/", "/", "we", "expect", "this", "to", "throw", "an", "IOException", "since", "we", "'", "re", "faking", "socket", "connect", "errors", "every", "time", "learner", ".", "connectToLeader", "(", "addr", ")", ";", "learner", ".", "connectToLeader", "(", "addr", ",", "\"", "\")", ";", "}", "@", "Test", "public", "void", "connectionInitLimitTimeoutTest", "(", ")", "throws", "Exception", "{", "@", "@", "-", "130", ",", "7", "+", "130", ",", "7", "@", "@", "public", "void", "connectionInitLimitTimeoutTest", "(", ")", "throws", "Exception", "{", "/", "/", "we", "expect", "this", "to", "throw", "an", "IOException", "since", "we", "'", "re", "faking", "socket", "connect", "errors", "every", "time", "try", "{", "learner", ".", "connectToLeader", "(", "addr", ")", ";", "learner", ".", "connectToLeader", "(", "addr", ",", "\"", "\")", ";", "Assert", ".", "fail", "(", "\"", "should", "have", "thrown", "IOException", "!", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "/", "/", "good", ",", "wanted", "to", "see", "that", ",", "let", "'", "s", "make", "sure", "we", "ran", "out", "of", "time", "@", "@", "-", "26", ",", "6", "+", "26", ",", "10", "@", "@", "import", "java", ".", "io", ".", "FileWriter", ";", "import", "java", ".", "io", ".", "FilenameFilter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "47", ",", "7", "+", "51", ",", "7", "@", "@", "protected", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "QuorumPeerTestBase", ".", "class", ")", ";", "public", "static", "final", "int", "TIMEOUT", "=", "3000", ";", "public", "static", "final", "int", "TIMEOUT", "=", "5000", ";", "public", "void", "process", "(", "WatchedEvent", "event", ")", "{", "/", "/", "ignore", "for", "this", "test", "@", "@", "-", "72", ",", "6", "+", "76", ",", "60", "@", "@", "public", "void", "shutdown", "(", ")", "{", "volatile", "TestQPMain", "main", ";", "File", "baseDir", ";", "private", "int", "myid", ";", "private", "int", "clientPort", ";", "private", "String", "quorumCfgSection", ";", "private", "Map", "<", "String", ",", "String", ">", "otherConfigs", ";", "public", "MainThread", "(", "int", "myid", ",", "int", "clientPort", ",", "String", "quorumCfgSection", ",", "Map", "<", "String", ",", "String", ">", "otherConfigs", ")", "throws", "IOException", "{", "baseDir", "=", "ClientBase", ".", "createTmpDir", "(", ");", "this", ".", "myid", "=", "myid", ";", "this", ".", "clientPort", "=", "clientPort", ";", "this", ".", "quorumCfgSection", "=", "quorumCfgSection", ";", "this", ".", "otherConfigs", "=", "otherConfigs", ";", "LOG", ".", "info", "(", "\"", "id", "=", "\"", "+", "myid", "+", "\"", "tmpDir", "=", "\"", "+", "baseDir", "+", "\"", "clientPort", "=", "\"", "+", "clientPort", ")", ";", "confFile", "=", "new", "File", "(", "baseDir", ",", "\"", "zoo", ".", "cfg", "\"", ");", "FileWriter", "fwriter", "=", "new", "FileWriter", "(", "confFile", ")", ";", "fwriter", ".", "write", "(", "\"", "tickTime", "=", "4000", "\\", "n", "\"", ");", "fwriter", ".", "write", "(", "\"", "initLimit", "=", "10", "\\", "n", "\"", ");", "fwriter", ".", "write", "(", "\"", "syncLimit", "=", "5", "\\", "n", "\"", ");", "tmpDir", "=", "new", "File", "(", "baseDir", ",", "\"", "data", "\"", ");", "if", "(", "!", "tmpDir", ".", "mkdir", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "mkdir", "\"", "+", "tmpDir", ")", ";", "}", "/", "/", "Convert", "windows", "path", "to", "UNIX", "to", "avoid", "problems", "with", "\"", "\\\"", "String", "dir", "=", "tmpDir", ".", "toString", "(", ");", "String", "osname", "=", "java", ".", "lang", ".", "System", ".", "getProperty", "(", "\"", "os", ".", "name", "\"", ");", "if", "(", "osname", ".", "toLowerCase", "(", ").", "contains", "(", "\"", "windows", "\"", "))", "{", "dir", "=", "dir", ".", "replace", "(", "'\\", "\\'", ",", "'", "/'", ");", "}", "fwriter", ".", "write", "(", "\"", "dataDir", "=", "\"", "+", "dir", "+", "\"", "\\", "n", "\"", ");", "fwriter", ".", "write", "(", "\"", "clientPort", "=", "\"", "+", "clientPort", "+", "\"", "\\", "n", "\"", ");", "/", "/", "write", "extra", "configurations", "Set", "<", "Entry", "<", "String", ",", "String", ">", ">", "entrySet", "=", "otherConfigs", ".", "entrySet", "(", ");", "for", "(", "Entry", "<", "String", ",", "String", ">", "entry", ":", "entrySet", ")", "{", "fwriter", ".", "write", "(", "entry", ".", "getKey", "(", ")", "+", "\"", "=\"", "+", "entry", ".", "getValue", "(", ")", "+", "\"", "\\", "n", "\"", ");", "}", "fwriter", ".", "write", "(", "quorumCfgSection", "+", "\"", "\\", "n", "\"", ");", "fwriter", ".", "flush", "(", ");", "fwriter", ".", "close", "(", ");", "File", "myidFile", "=", "new", "File", "(", "tmpDir", ",", "\"", "myid", "\"", ");", "fwriter", "=", "new", "FileWriter", "(", "myidFile", ")", ";", "fwriter", ".", "write", "(", "Integer", ".", "toString", "(", "myid", ")", ");", "fwriter", ".", "flush", "(", ");", "fwriter", ".", "close", "(", ");", "}", "public", "MainThread", "(", "int", "myid", ",", "String", "quorumCfgSection", ")", "throws", "IOException", "{", "this", "(", "myid", ",", "quorumCfgSection", ",", "true", ")", ";", "}", "@", "@", "-", "87", ",", "11", "+", "145", ",", "6", "@", "@", "public", "MainThread", "(", "int", "myid", ",", "String", "quorumCfgSection", ",", "boolean", "writeDynamicConfigF", "this", "(", "myid", ",", "UNSET_STATIC_CLIENTPORT", ",", "quorumCfgSection", ",", "writeDynamicConfigFile", ")", ";", "}", "public", "MainThread", "(", "int", "myid", ",", "int", "clientPort", ",", "String", "quorumCfgSection", ")", "throws", "IOException", "{", "this", "(", "myid", ",", "clientPort", ",", "JettyAdminServer", ".", "DEFAULT_PORT", ",", "quorumCfgSection", ",", "null", ",", "null", ",", "true", ")", ";", "}", "public", "MainThread", "(", "int", "myid", ",", "int", "clientPort", ",", "String", "quorumCfgSection", ",", "boolean", "writeDynamicConfigFile", ")", "throws", "IOException", "{", "this", "(", "myid", ",", "clientPort", ",", "JettyAdminServer", ".", "DEFAULT_PORT", ",", "quorumCfgSection", ",", "null", ",", "null", ",", "writeDynamicConfigFile", ")", ";", "@", "@", "-", "237", ",", "6", "+", "290", ",", "12", "@", "@", "public", "void", "writeTempDynamicConfigFile", "(", "String", "nextQuorumCfgSection", ",", "String", "versi", "fwriter", ".", "close", "(", ");", "}", "public", "MainThread", "(", "int", "myid", ",", "int", "clientPort", ",", "String", "quorumCfgSection", ")", "throws", "IOException", "{", "this", "(", "myid", ",", "clientPort", ",", "quorumCfgSection", ",", "new", "HashMap", "<", "String", ",", "String", ">", "()", ");", "}", "Thread", "currentThread", ";", "synchronized", "public", "void", "start", "(", ")", "{", "@", "@", "-", "301", ",", "5", "+", "360", ",", "31", "@", "@", "public", "String", "getPropFromStaticFile", "(", "String", "key", ")", "throws", "IOException", "{", "public", "QuorumPeer", "getQuorumPeer", "(", ")", "{", "return", "main", ".", "quorumPeer", ";", "}", "public", "void", "deleteBaseDir", "(", ")", "{", "ClientBase", ".", "recursiveDelete", "(", "baseDir", ")", ";", "}", "public", "int", "getMyid", "(", ")", "{", "return", "myid", ";", "}", "public", "int", "getClientPort", "(", ")", "{", "return", "clientPort", ";", "}", "public", "String", "getQuorumCfgSection", "(", ")", "{", "return", "quorumCfgSection", ";", "}", "public", "Map", "<", "String", ",", "String", ">", "getOtherConfigs", "(", ")", "{", "return", "otherConfigs", ";", "}", "public", "File", "getConfFile", "(", ")", "{", "return", "confFile", ";", "}", "}", "}", "@", "@", "-", "42", ",", "6", "+", "42", ",", "8", "@", "@", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "/", "**", "*", "This", "test", "class", "contains", "test", "cases", "related", "to", "race", "condition", "in", "complete", "*", "ZooKeeper", "@", "@", "-", "156", ",", "6", "+", "158", ",", "9", "@", "@", "private", "void", "shutdownFollowers", "(", "MainThread", "[", "]", "mt", ")", "{", "private", "static", "class", "CustomQuorumPeer", "extends", "QuorumPeer", "{", "private", "boolean", "stopPing", ";", "public", "CustomQuorumPeer", "(", ")", "throws", "SaslException", "{", "}", "public", "void", "setStopPing", "(", "boolean", "stopPing", ")", "{", "this", ".", "stopPing", "=", "stopPing", ";", "}", "@", "@", "-", "239", ",", "7", "+", "244", ",", "7", "@", "@", "public", "MockProposalRequestProcessor", "(", "LeaderZooKeeperServer", "zks", ",", "RequestProcessor", "private", "static", "class", "MockTestQPMain", "extends", "TestQPMain", "{", "@", "Override", "protected", "QuorumPeer", "getQuorumPeer", "(", ")", "{", "protected", "QuorumPeer", "getQuorumPeer", "(", ")", "throws", "SaslException", "{", "return", "new", "CustomQuorumPeer", "(", ");", "}", "}", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "spy", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "File", ";", "@", "@", "-", "386", ",", "7", "+", "387", ",", "9", "@", "@", "public", "void", "testLeaderConversation", "(", "LeaderConversation", "conversation", ")", "throws", "Excep", "Thread", ".", "sleep", "(", "20", ")", ";", "}", "LearnerHandler", "lh", "=", "new", "LearnerHandler", "(", "leaderSocket", ",", "leader", ")", ";", "LearnerHandler", "lh", "=", "new", "LearnerHandler", "(", "leaderSocket", ",", "new", "BufferedInputStream", "(", "leaderSocket", ".", "getInputStream", "(", "))", ",", "leader", ")", ";", "lh", ".", "start", "(", ");", "leaderSocket", ".", "setSoTimeout", "(", "4000", ")", ";", "@", "@", "-", "454", ",", "8", "+", "457", ",", "10", "@", "@", "public", "void", "testPopulatedLeaderConversation", "(", "PopulatedLeaderConversation", "conversa", "while", "(", "leader", ".", "cnxAcceptor", "=", "=", "null", "|", "|", "!", "leader", ".", "cnxAcceptor", ".", "isAlive", "(", "))", "{", "Thread", ".", "sleep", "(", "20", ")", ";", "}", "LearnerHandler", "lh", "=", "new", "LearnerHandler", "(", "leaderSocket", ",", "leader", ")", ";", "LearnerHandler", "lh", "=", "new", "LearnerHandler", "(", "leaderSocket", ",", "new", "BufferedInputStream", "(", "leaderSocket", ".", "getInputStream", "(", "))", ",", "leader", ")", ";", "lh", ".", "start", "(", ");", "leaderSocket", ".", "setSoTimeout", "(", "4000", ")", ";", "@", "@", "-", "477", ",", "7", "+", "482", ",", "6", "@", "@", "public", "void", "testPopulatedLeaderConversation", "(", "PopulatedLeaderConversation", "conversa", "}", "}", "public", "void", "testFollowerConversation", "(", "FollowerConversation", "conversation", ")", "throws", "Exception", "{", "File", "tmpDir", "=", "File", ".", "createTempFile", "(", "\"", "test", "\"", ",", "\"", "dir", "\"", ",", "testData", ")", ";", "tmpDir", ".", "delete", "(", ");", "@", "@", "-", "491", ",", "8", "+", "495", ",", "10", "@", "@", "public", "void", "testFollowerConversation", "(", "FollowerConversation", "conversation", ")", "throws", "E", "peer", ".", "follower", "=", "follower", ";", "ServerSocket", "ss", "=", "new", "ServerSocket", "(", "0", ",", "50", ",", "InetAddress", ".", "getByName", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", "))", ";", "follower", ".", "setLeaderSocketAddress", "(", "(", "InetSocketAddress", ")", "ss", ".", "getLocalSocketAddress", "(", "))", ";", "new", "ServerSocket", "(", "0", ",", "50", ",", "InetAddress", ".", "getByName", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", "))", ";", "QuorumServer", "leaderQS", "=", "new", "QuorumServer", "(", "1", ",", "(", "InetSocketAddress", ")", "ss", ".", "getLocalSocketAddress", "(", "))", ";", "follower", ".", "setLeaderQuorumServer", "(", "leaderQS", ")", ";", "final", "Follower", "followerForThread", "=", "follower", ";", "followerThread", "=", "new", "Thread", "(", ")", "{", "@", "@", "-", "545", ",", "7", "+", "551", ",", "8", "@", "@", "public", "void", "testObserverConversation", "(", "ObserverConversation", "conversation", ")", "throws", "E", "ServerSocket", "ss", "=", "new", "ServerSocket", "(", "0", ",", "50", ",", "InetAddress", ".", "getByName", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", "))", ";", "observer", ".", "setLeaderSocketAddress", "(", "(", "InetSocketAddress", ")", "ss", ".", "getLocalSocketAddress", "(", "))", ";", "QuorumServer", "leaderQS", "=", "new", "QuorumServer", "(", "1", ",", "(", "InetSocketAddress", ")", "ss", ".", "getLocalSocketAddress", "(", "))", ";", "observer", ".", "setLeaderQuorumServer", "(", "leaderQS", ")", ";", "final", "Observer", "observerForThread", "=", "observer", ";", "observerThread", "=", "new", "Thread", "(", ")", "{", "@", "@", "-", "1272", ",", "14", "+", "1279", ",", "14", "@", "@", "private", "LeaderZooKeeperServer", "prepareLeader", "(", "File", "tmpDir", ",", "QuorumPeer", "peer", ")", "super", "(", "self", ",", "zk", ")", ";", "}", "InetSocketAddress", "leaderAddr", ";", "public", "void", "setLeaderSocketAddress", "(", "InetSocketAddress", "addr", ")", "{", "leaderAddr", "=", "addr", ";", "QuorumServer", "leaderQuorumServer", ";", "public", "void", "setLeaderQuorumServer", "(", "QuorumServer", "quorumServer", ")", "{", "leaderQuorumServer", "=", "quorumServer", ";", "}", "@", "Override", "protected", "InetSocketAddress", "findLeader", "(", ")", "{", "return", "leaderAddr", ";", "protected", "QuorumServer", "findLeader", "(", ")", "{", "return", "leaderQuorumServer", ";", "}", "}", "private", "ConversableFollower", "createFollower", "(", "File", "tmpDir", ",", "QuorumPeer", "peer", ")", "@", "@", "-", "1298", ",", "14", "+", "1305", ",", "14", "@", "@", "private", "ConversableFollower", "createFollower", "(", "File", "tmpDir", ",", "QuorumPeer", "peer", ")", "super", "(", "self", ",", "zk", ")", ";", "}", "InetSocketAddress", "leaderAddr", ";", "public", "void", "setLeaderSocketAddress", "(", "InetSocketAddress", "addr", ")", "{", "leaderAddr", "=", "addr", ";", "QuorumServer", "leaderQuorumServer", ";", "public", "void", "setLeaderQuorumServer", "(", "QuorumServer", "quorumServer", ")", "{", "leaderQuorumServer", "=", "quorumServer", ";", "}", "@", "Override", "protected", "InetSocketAddress", "findLeader", "(", ")", "{", "return", "leaderAddr", ";", "protected", "QuorumServer", "findLeader", "(", ")", "{", "return", "leaderQuorumServer", ";", "}", "}", "@", "@", "-", "1321", ",", "7", "+", "1328", ",", "7", "@", "@", "private", "ConversableObserver", "createObserver", "(", "File", "tmpDir", ",", "QuorumPeer", "peer", ")", "private", "QuorumPeer", "createQuorumPeer", "(", "File", "tmpDir", ")", "throws", "IOException", ",", "FileNotFoundException", "{", "HashMap", "<", "Long", ",", "QuorumServer", ">", "peers", "=", "new", "HashMap", "<", "Long", ",", "QuorumServer", ">", "()", ";", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", ");", "QuorumPeer", "peer", "=", "QuorumPeer", ".", "testingQuorumPeer", "(", ");", "peer", ".", "syncLimit", "=", "SYNC_LIMIT", ";", "peer", ".", "initLimit", "=", "2", ";", "peer", ".", "tickTime", "=", "2000", ";", "@", "@", "-", "1374", ",", "7", "+", "1381", ",", "7", "@", "@", "public", "void", "testInitialAcceptedCurrent", "(", ")", "throws", "Exception", "{", "new", "ErrorTxn", "(", "1", ")", ",", "zxid", ")", ");", "logFactory", ".", "commit", "(", ");", "ZKDatabase", "zkDb", "=", "new", "ZKDatabase", "(", "logFactory", ")", ";", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", ");", "QuorumPeer", "peer", "=", "QuorumPeer", ".", "testingQuorumPeer", "(", ");", "peer", ".", "setZKDatabase", "(", "zkDb", ")", ";", "peer", ".", "setTxnFactory", "(", "logFactory", ")", ";", "peer", ".", "getLastLoggedZxid", "(", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "120", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Properties", ";", "/", "*", "*", "This", "code", "is", "originally", "from", "HDFS", ",", "see", "the", "similarly", "named", "file", "there", "*", "in", "case", "of", "bug", "fixing", ",", "history", ",", "etc", ".", "*", "*", "Branch", ":", "trunk", "*", "Github", "Revision", ":", "1d1ab587e4e92ce3aea4cb144811f69145cb3b33", "*", "/", "/", "**", "*", "KerberosSecurityTestcase", "provides", "a", "base", "class", "for", "using", "MiniKdc", "with", "other", "*", "test", "cases", ".", "KerberosSecurityTestcase", "starts", "the", "MiniKdc", "(", "@", "Before", ")", "before", "*", "running", "tests", ",", "and", "stop", "the", "MiniKdc", "(", "@", "After", ")", "after", "the", "testcases", ",", "using", "*", "default", "settings", "(", "working", "dir", "and", "kdc", "configurations", ")", ".", "*", "<", "p", ">", "*", "Users", "can", "directly", "inherit", "this", "class", "and", "implement", "their", "own", "test", "functions", "*", "using", "the", "default", "settings", ",", "or", "override", "functions", "getTestDir", "(", ")", "and", "*", "createMiniKdcConf", "(", ")", "to", "provide", "new", "settings", ".", "*", "/", "public", "class", "KerberosSecurityTestcase", "extends", "QuorumAuthTestBase", "{", "private", "static", "MiniKdc", "kdc", ";", "private", "static", "File", "workDir", ";", "private", "static", "Properties", "conf", ";", "@", "BeforeClass", "public", "static", "void", "setUpSasl", "(", ")", "throws", "Exception", "{", "startMiniKdc", "(", ");", "}", "@", "AfterClass", "public", "static", "void", "tearDownSasl", "(", ")", "throws", "Exception", "{", "stopMiniKdc", "(", ");", "FileUtils", ".", "deleteQuietly", "(", "workDir", ")", ";", "}", "public", "static", "void", "startMiniKdc", "(", ")", "throws", "Exception", "{", "createTestDir", "(", ");", "createMiniKdcConf", "(", ");", "kdc", "=", "new", "MiniKdc", "(", "conf", ",", "workDir", ")", ";", "kdc", ".", "start", "(", ");", "}", "/", "**", "*", "Create", "a", "working", "directory", ",", "it", "should", "be", "the", "build", "directory", ".", "Under", "this", "*", "directory", "an", "ApacheDS", "working", "directory", "will", "be", "created", ",", "this", "directory", "*", "will", "be", "deleted", "when", "the", "MiniKdc", "stops", ".", "*", "*", "@", "throws", "IOException", "*", "/", "public", "static", "void", "createTestDir", "(", ")", "throws", "IOException", "{", "workDir", "=", "createTmpDir", "(", "new", "File", "(", "System", ".", "getProperty", "(", "\"", "build", ".", "test", ".", "dir", "\"", ",", "\"", "build", "\"", "))", ");", "}", "static", "File", "createTmpDir", "(", "File", "parentDir", ")", "throws", "IOException", "{", "File", "tmpFile", "=", "File", ".", "createTempFile", "(", "\"", "test", "\"", ",", "\"", ".", "junit", "\"", ",", "parentDir", ")", ";", "/", "/", "don", "'", "t", "delete", "tmpFile", "-", "this", "ensures", "we", "don", "'", "t", "attempt", "to", "create", "/", "/", "a", "tmpDir", "with", "a", "duplicate", "name", "File", "tmpDir", "=", "new", "File", "(", "tmpFile", "+", "\"", ".", "dir", "\"", ");", "/", "/", "never", "true", "if", "tmpfile", "does", "it", "'", "s", "job", "Assert", ".", "assertFalse", "(", "tmpDir", ".", "exists", "(", "))", ";", "Assert", ".", "assertTrue", "(", "tmpDir", ".", "mkdirs", "(", "))", ";", "return", "tmpDir", ";", "}", "/", "**", "*", "Create", "a", "Kdc", "configuration", "*", "/", "public", "static", "void", "createMiniKdcConf", "(", ")", "{", "conf", "=", "MiniKdc", ".", "createConf", "(", ");", "}", "public", "static", "void", "stopMiniKdc", "(", ")", "{", "if", "(", "kdc", "!", "=", "null", ")", "{", "kdc", ".", "stop", "(", ");", "}", "}", "public", "static", "MiniKdc", "getKdc", "(", ")", "{", "return", "kdc", ";", "}", "public", "static", "File", "getWorkDir", "(", ")", "{", "return", "workDir", ";", "}", "public", "static", "Properties", "getConf", "(", ")", "{", "return", "conf", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "76", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "util", ".", "SecurityUtils", ";", "public", "class", "KerberosTestUtils", "{", "private", "static", "String", "keytabFile", "=", "new", "File", "(", "System", ".", "getProperty", "(", "\"", "test", ".", "dir", "\"", ",", "\"", "build", "\"", "),", "UUID", ".", "randomUUID", "(", ").", "toString", "(", "))", ".", "getAbsolutePath", "(", ");", "public", "static", "String", "getRealm", "(", ")", "{", "return", "\"", "EXAMPLE", ".", "COM", "\"", ";", "}", "public", "static", "String", "getLearnerPrincipal", "(", ")", "{", "return", "\"", "learner", "@", "EXAMPLE", ".", "COM", "\"", ";", "}", "public", "static", "String", "getServerPrincipal", "(", ")", "{", "return", "\"", "zkquorum", "/", "localhost", "@", "EXAMPLE", ".", "COM", "\"", ";", "}", "public", "static", "String", "getHostLearnerPrincipal", "(", ")", "{", "return", "\"", "learner", "/", "_HOST", "@", "EXAMPLE", ".", "COM", "\"", ";", "}", "public", "static", "String", "getHostServerPrincipal", "(", ")", "{", "return", "\"", "zkquorum", "/", "_HOST", "@", "EXAMPLE", ".", "COM", "\"", ";", "}", "public", "static", "String", "getHostNamedLearnerPrincipal", "(", "String", "myHostname", ")", "{", "return", "\"", "learner", "/", "\"", "+", "myHostname", "+", "\"", "@", "EXAMPLE", ".", "COM", "\"", ";", "}", "public", "static", "String", "getKeytabFile", "(", ")", "{", "return", "keytabFile", ";", "}", "public", "static", "String", "replaceHostPattern", "(", "String", "principal", ")", "{", "String", "[", "]", "components", "=", "principal", ".", "split", "(", "\"[", "/@", "]\"", ");", "if", "(", "components", "=", "=", "null", "|", "|", "components", ".", "length", "<", "2", "|", "|", "!", "components", "[", "1", "]", ".", "equals", "(", "SecurityUtils", ".", "QUORUM_HOSTNAME_PATTERN", ")", ")", "{", "return", "principal", ";", "}", "else", "{", "return", "replacePattern", "(", "components", ",", "\"", "localhost", "\"", ");", "}", "}", "public", "static", "String", "replacePattern", "(", "String", "[", "]", "components", ",", "String", "hostname", ")", "{", "if", "(", "components", ".", "length", "=", "=", "3", ")", "{", "return", "components", "[", "0", "]", "+", "\"", "/\"", "+", "hostname", ".", "toLowerCase", "(", ")", "+", "\"", "@\"", "+", "components", "[", "2", "]", ";", "}", "else", "{", "return", "components", "[", "0", "]", "+", "\"", "/\"", "+", "hostname", ".", "toLowerCase", "(", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "418", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "Charsets", ";", "import", "org", ".", "apache", ".", "kerby", ".", "kerberos", ".", "kerb", ".", "KrbException", ";", "import", "org", ".", "apache", ".", "kerby", ".", "kerberos", ".", "kerb", ".", "server", ".", "KdcConfigKey", ";", "import", "org", ".", "apache", ".", "kerby", ".", "kerberos", ".", "kerb", ".", "server", ".", "SimpleKdcServer", ";", "import", "org", ".", "apache", ".", "kerby", ".", "util", ".", "IOUtil", ";", "import", "org", ".", "apache", ".", "kerby", ".", "util", ".", "NetworkUtil", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "*", "Mini", "KDC", "based", "on", "Apache", "Directory", "Server", "that", "can", "be", "embedded", "in", "testcases", "*", "or", "used", "from", "command", "line", "as", "a", "standalone", "KDC", ".", "*", "<", "p", ">", "*", "<", "b", ">", "From", "within", "testcases", ":", "</", "b", ">", "*", "<", "p", ">", "*", "MiniKdc", "sets", "one", "System", "property", "when", "started", "and", "un", "-", "set", "when", "stopped", ":", "*", "<", "ul", ">", "*", "<", "li", ">", "sun", ".", "security", ".", "krb5", ".", "debug", ":", "set", "to", "the", "debug", "value", "provided", "in", "the", "*", "configuration", "<", "/", "li", ">", "*", "<", "/", "ul", ">", "*", "Because", "of", "this", ",", "multiple", "MiniKdc", "instances", "cannot", "be", "started", "in", "parallel", ".", "*", "For", "example", ",", "running", "testcases", "in", "parallel", "that", "start", "a", "KDC", "each", ".", "To", "*", "accomplish", "this", "a", "single", "MiniKdc", "should", "be", "used", "for", "all", "testcases", "running", "*", "in", "parallel", ".", "*", "<", "p", ">", "*", "MiniKdc", "default", "configuration", "values", "are", ":", "*", "<", "ul", ">", "*", "<", "li", ">", "org", ".", "name", "=", "EXAMPLE", "(", "used", "to", "create", "the", "REALM", ")", "</", "li", ">", "*", "<", "li", ">", "org", ".", "domain", "=", "COM", "(", "used", "to", "create", "the", "REALM", ")", "</", "li", ">", "*", "<", "li", ">", "kdc", ".", "bind", ".", "address", "=", "localhost", "<", "/", "li", ">", "*", "<", "li", ">", "kdc", ".", "port", "=", "0", "(", "ephemeral", "port", ")", "</", "li", ">", "*", "<", "li", ">", "instance", "=", "DefaultKrbServer", "<", "/", "li", ">", "*", "<", "li", ">", "max", ".", "ticket", ".", "lifetime", "=", "86400000", "(", "1", "day", ")", "</", "li", ">", "*", "<", "li", ">", "max", ".", "renewable", ".", "lifetime", "=", "604800000", "(", "7", "days", ")", "</", "li", ">", "*", "<", "li", ">", "transport", "=", "TCP", "<", "/", "li", ">", "*", "<", "li", ">", "debug", "=", "false", "<", "/", "li", ">", "*", "<", "/", "ul", ">", "*", "The", "generated", "krb5", ".", "conf", "forces", "TCP", "connections", ".", "*", "/", "/", "*", "*", "This", "code", "is", "originally", "from", "HDFS", ",", "see", "the", "file", "name", "MiniKdc", "there", "*", "in", "case", "of", "bug", "fixing", ",", "history", ",", "etc", ".", "*", "*", "Branch", ":", "trunk", "*", "Github", "Revision", ":", "916140604ffef59466ba30832478311d3e6249bd", "*", "/", "public", "class", "MiniKdc", "{", "public", "static", "final", "String", "JAVA_SECURITY_KRB5_CONF", "=", "\"", "java", ".", "security", ".", "krb5", ".", "conf", "\"", ";", "public", "static", "final", "String", "SUN_SECURITY_KRB5_DEBUG", "=", "\"", "sun", ".", "security", ".", "krb5", ".", "debug", "\"", ";", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "if", "(", "args", ".", "length", "<", "4", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "Arguments", ":", "<", "WORKDIR", ">", "<", "MINIKDCPROPERTIES", ">", "\"", "\"", "<", "KEYTABFILE", ">", "[", "<", "PRINCIPALS", ">", "]+", "\")", ";", "System", ".", "exit", "(", "1", ")", ";", "}", "File", "workDir", "=", "new", "File", "(", "args", "[", "0", "]", ");", "if", "(", "!", "workDir", ".", "exists", "(", "))", "{", "throw", "new", "RuntimeException", "(", "\"", "Specified", "work", "directory", "does", "not", "exists", ":", "\"", "+", "workDir", ".", "getAbsolutePath", "(", "))", ";", "}", "Properties", "conf", "=", "createConf", "(", ");", "File", "file", "=", "new", "File", "(", "args", "[", "1", "]", ");", "if", "(", "!", "file", ".", "exists", "(", "))", "{", "throw", "new", "RuntimeException", "(", "\"", "Specified", "configuration", "does", "not", "exists", ":", "\"", "+", "file", ".", "getAbsolutePath", "(", "))", ";", "}", "Properties", "userConf", "=", "new", "Properties", "(", ");", "InputStreamReader", "r", "=", "null", ";", "try", "{", "r", "=", "new", "InputStreamReader", "(", "new", "FileInputStream", "(", "file", ")", ",", "Charsets", ".", "UTF_8", ")", ";", "userConf", ".", "load", "(", "r", ")", ";", "}", "finally", "{", "if", "(", "r", "!", "=", "null", ")", "{", "r", ".", "close", "(", ");", "}", "}", "for", "(", "Map", ".", "Entry", "<", "?,", "?", ">", "entry", ":", "userConf", ".", "entrySet", "(", "))", "{", "conf", ".", "put", "(", "entry", ".", "getKey", "(", "),", "entry", ".", "getValue", "(", "))", ";", "}", "final", "MiniKdc", "miniKdc", "=", "new", "MiniKdc", "(", "conf", ",", "workDir", ")", ";", "miniKdc", ".", "start", "(", ");", "File", "krb5conf", "=", "new", "File", "(", "workDir", ",", "\"", "krb5", ".", "conf", "\"", ");", "if", "(", "miniKdc", ".", "getKrb5conf", "(", ").", "renameTo", "(", "krb5conf", ")", ")", "{", "File", "keytabFile", "=", "new", "File", "(", "args", "[", "2", "]", ").", "getAbsoluteFile", "(", ");", "String", "[", "]", "principals", "=", "new", "String", "[", "args", ".", "length", "-", "3", "]", ";", "System", ".", "arraycopy", "(", "args", ",", "3", ",", "principals", ",", "0", ",", "args", ".", "length", "-", "3", ")", ";", "miniKdc", ".", "createPrincipal", "(", "keytabFile", ",", "principals", ")", ";", "System", ".", "out", ".", "println", "(", ");", "System", ".", "out", ".", "println", "(", "\"", "Standalone", "MiniKdc", "Running", "\"", ");", "System", ".", "out", ".", "println", "(", "\"-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "\")", ";", "System", ".", "out", ".", "println", "(", "\"", "Realm", ":", "\"", "+", "miniKdc", ".", "getRealm", "(", "))", ";", "System", ".", "out", ".", "println", "(", "\"", "Running", "at", ":", "\"", "+", "miniKdc", ".", "getHost", "(", ")", "+", "\"", ":\"", "miniKdc", ".", "getHost", "(", "))", ";", "System", ".", "out", ".", "println", "(", "\"", "krb5conf", ":", "\"", "+", "krb5conf", ")", ";", "System", ".", "out", ".", "println", "(", ");", "System", ".", "out", ".", "println", "(", "\"", "created", "keytab", ":", "\"", "+", "keytabFile", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "with", "principals", ":", "\"", "+", "Arrays", ".", "asList", "(", "principals", ")", ");", "System", ".", "out", ".", "println", "(", ");", "System", ".", "out", ".", "println", "(", "\"", "Do", "<", "CTRL", "-", "C", ">", "or", "kill", "<", "PID", ">", "to", "stop", "it", "\"", ");", "System", ".", "out", ".", "println", "(", "\"-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "\")", ";", "System", ".", "out", ".", "println", "(", ");", "Runtime", ".", "getRuntime", "(", ").", "addShutdownHook", "(", "new", "Thread", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "miniKdc", ".", "stop", "(", ");", "}", "}", ");", "}", "else", "{", "throw", "new", "RuntimeException", "(", "\"", "Cannot", "rename", "KDC", "'", "s", "krb5conf", "to", "\"", "+", "krb5conf", ".", "getAbsolutePath", "(", "))", ";", "}", "}", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "MiniKdc", ".", "class", ")", ";", "public", "static", "final", "String", "ORG_NAME", "=", "\"", "org", ".", "name", "\"", ";", "public", "static", "final", "String", "ORG_DOMAIN", "=", "\"", "org", ".", "domain", "\"", ";", "public", "static", "final", "String", "KDC_BIND_ADDRESS", "=", "\"", "kdc", ".", "bind", ".", "address", "\"", ";", "public", "static", "final", "String", "KDC_PORT", "=", "\"", "kdc", ".", "port", "\"", ";", "public", "static", "final", "String", "INSTANCE", "=", "\"", "instance", "\"", ";", "public", "static", "final", "String", "MAX_TICKET_LIFETIME", "=", "\"", "max", ".", "ticket", ".", "lifetime", "\"", ";", "public", "static", "final", "String", "MAX_RENEWABLE_LIFETIME", "=", "\"", "max", ".", "renewable", ".", "lifetime", "\"", ";", "public", "static", "final", "String", "TRANSPORT", "=", "\"", "transport", "\"", ";", "public", "static", "final", "String", "DEBUG", "=", "\"", "debug", "\"", ";", "private", "static", "final", "Set", "<", "String", ">", "PROPERTIES", "=", "new", "HashSet", "<", "String", ">", "()", ";", "private", "static", "final", "Properties", "DEFAULT_CONFIG", "=", "new", "Properties", "(", ");", "static", "{", "PROPERTIES", ".", "add", "(", "ORG_NAME", ")", ";", "PROPERTIES", ".", "add", "(", "ORG_DOMAIN", ")", ";", "PROPERTIES", ".", "add", "(", "KDC_BIND_ADDRESS", ")", ";", "PROPERTIES", ".", "add", "(", "KDC_BIND_ADDRESS", ")", ";", "PROPERTIES", ".", "add", "(", "KDC_PORT", ")", ";", "PROPERTIES", ".", "add", "(", "INSTANCE", ")", ";", "PROPERTIES", ".", "add", "(", "TRANSPORT", ")", ";", "PROPERTIES", ".", "add", "(", "MAX_TICKET_LIFETIME", ")", ";", "PROPERTIES", ".", "add", "(", "MAX_RENEWABLE_LIFETIME", ")", ";", "DEFAULT_CONFIG", ".", "setProperty", "(", "KDC_BIND_ADDRESS", ",", "\"", "localhost", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "KDC_PORT", ",", "\"", "0", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "INSTANCE", ",", "\"", "DefaultKrbServer", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "ORG_NAME", ",", "\"", "EXAMPLE", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "ORG_DOMAIN", ",", "\"", "COM", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "TRANSPORT", ",", "\"", "TCP", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "MAX_TICKET_LIFETIME", ",", "\"", "86400000", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "MAX_RENEWABLE_LIFETIME", ",", "\"", "604800000", "\"", ");", "DEFAULT_CONFIG", ".", "setProperty", "(", "DEBUG", ",", "\"", "false", "\"", ");", "}", "/", "**", "*", "Convenience", "method", "that", "returns", "MiniKdc", "default", "configuration", ".", "*", "<", "p", ">", "*", "The", "returned", "configuration", "is", "a", "copy", ",", "it", "can", "be", "customized", "before", "using", "*", "it", "to", "create", "a", "MiniKdc", ".", "*", "@", "return", "a", "MiniKdc", "default", "configuration", ".", "*", "/", "public", "static", "Properties", "createConf", "(", ")", "{", "return", "(", "Properties", ")", "DEFAULT_CONFIG", ".", "clone", "(", ");", "}", "private", "Properties", "conf", ";", "private", "SimpleKdcServer", "simpleKdc", ";", "private", "int", "port", ";", "private", "String", "realm", ";", "private", "File", "workDir", ";", "private", "File", "krb5conf", ";", "private", "String", "transport", ";", "private", "boolean", "krb5Debug", ";", "public", "void", "setTransport", "(", "String", "transport", ")", "{", "this", ".", "transport", "=", "transport", ";", "}", "/", "**", "*", "Creates", "a", "MiniKdc", ".", "*", "*", "@", "param", "conf", "MiniKdc", "configuration", ".", "*", "@", "param", "workDir", "working", "directory", ",", "it", "should", "be", "the", "build", "directory", ".", "Under", "*", "this", "directory", "an", "ApacheDS", "working", "directory", "will", "be", "created", ",", "this", "*", "directory", "will", "be", "deleted", "when", "the", "MiniKdc", "stops", ".", "*", "@", "throws", "Exception", "thrown", "if", "the", "MiniKdc", "could", "not", "be", "created", ".", "*", "/", "public", "MiniKdc", "(", "Properties", "conf", ",", "File", "workDir", ")", "throws", "Exception", "{", "if", "(", "!", "conf", ".", "keySet", "(", ").", "containsAll", "(", "PROPERTIES", ")", ")", "{", "Set", "<", "String", ">", "missingProperties", "=", "new", "HashSet", "<", "String", ">", "(", "PROPERTIES", ")", ";", "missingProperties", ".", "removeAll", "(", "conf", ".", "keySet", "(", "))", ";", "throw", "new", "IllegalArgumentException", "(", "\"", "Missing", "configuration", "properties", ":", "\"", "+", "missingProperties", ")", ";", "}", "this", ".", "workDir", "=", "new", "File", "(", "workDir", ",", "Long", ".", "toString", "(", "System", ".", "currentTimeMillis", "(", "))", ");", "if", "(", "!", "this", ".", "workDir", ".", "exists", "(", ")", "&", "&", "!", "this", ".", "workDir", ".", "mkdirs", "(", "))", "{", "throw", "new", "RuntimeException", "(", "\"", "Cannot", "create", "directory", "\"", "+", "this", ".", "workDir", ")", ";", "}", "LOG", ".", "info", "(", "\"", "Configuration", ":", "\")", ";", "LOG", ".", "info", "(", "\"-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "\")", ";", "for", "(", "Map", ".", "Entry", "<", "?,", "?", ">", "entry", ":", "conf", ".", "entrySet", "(", "))", "{", "LOG", ".", "info", "(", "\"", "{", "}:", "{", "}\"", ",", "entry", ".", "getKey", "(", "),", "entry", ".", "getValue", "(", "))", ";", "}", "LOG", ".", "info", "(", "\"-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "\")", ";", "this", ".", "conf", "=", "conf", ";", "port", "=", "Integer", ".", "parseInt", "(", "conf", ".", "getProperty", "(", "KDC_PORT", ")", ");", "String", "orgName", "=", "conf", ".", "getProperty", "(", "ORG_NAME", ")", ";", "String", "orgDomain", "=", "conf", ".", "getProperty", "(", "ORG_DOMAIN", ")", ";", "realm", "=", "orgName", ".", "toUpperCase", "(", "Locale", ".", "ENGLISH", ")", "+", "\"", ".\"", "+", "orgDomain", ".", "toUpperCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "/", "**", "*", "Returns", "the", "port", "of", "the", "MiniKdc", ".", "*", "*", "@", "return", "the", "port", "of", "the", "MiniKdc", ".", "*", "/", "public", "int", "getPort", "(", ")", "{", "return", "port", ";", "}", "/", "**", "*", "Returns", "the", "host", "of", "the", "MiniKdc", ".", "*", "*", "@", "return", "the", "host", "of", "the", "MiniKdc", ".", "*", "/", "public", "String", "getHost", "(", ")", "{", "return", "conf", ".", "getProperty", "(", "KDC_BIND_ADDRESS", ")", ";", "}", "/", "**", "*", "Returns", "the", "realm", "of", "the", "MiniKdc", ".", "*", "*", "@", "return", "the", "realm", "of", "the", "MiniKdc", ".", "*", "/", "public", "String", "getRealm", "(", ")", "{", "return", "realm", ";", "}", "public", "File", "getKrb5conf", "(", ")", "{", "krb5conf", "=", "new", "File", "(", "System", ".", "getProperty", "(", "JAVA_SECURITY_KRB5_CONF", ")", ");", "return", "krb5conf", ";", "}", "/", "**", "*", "Starts", "the", "MiniKdc", ".", "*", "*", "@", "throws", "Exception", "thrown", "if", "the", "MiniKdc", "could", "not", "be", "started", ".", "*", "/", "public", "synchronized", "void", "start", "(", ")", "throws", "Exception", "{", "if", "(", "simpleKdc", "!", "=", "null", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Already", "started", "\"", ");", "}", "simpleKdc", "=", "new", "SimpleKdcServer", "(", ");", "prepareKdcServer", "(", ");", "simpleKdc", ".", "init", "(", ");", "resetDefaultRealm", "(", ");", "simpleKdc", ".", "start", "(", ");", "LOG", ".", "info", "(", "\"", "MiniKdc", "stated", ".", "\")", ";", "}", "private", "void", "resetDefaultRealm", "(", ")", "throws", "IOException", "{", "InputStream", "templateResource", "=", "new", "FileInputStream", "(", "getKrb5conf", "(", ").", "getAbsolutePath", "(", "))", ";", "String", "content", "=", "IOUtil", ".", "readInput", "(", "templateResource", ")", ";", "content", "=", "content", ".", "replaceAll", "(", "\"", "default_realm", "=", ".", "*\\", "n", "\"", ",", "\"", "default_realm", "=", "\"", "+", "getRealm", "(", ")", "+", "\"", "\\", "n", "\"", ");", "IOUtil", ".", "writeFile", "(", "content", ",", "getKrb5conf", "(", "))", ";", "}", "private", "void", "prepareKdcServer", "(", ")", "throws", "Exception", "{", "/", "/", "transport", "simpleKdc", ".", "setWorkDir", "(", "workDir", ")", ";", "simpleKdc", ".", "setKdcHost", "(", "getHost", "(", "))", ";", "simpleKdc", ".", "setKdcRealm", "(", "realm", ")", ";", "if", "(", "transport", "=", "=", "null", ")", "{", "transport", "=", "conf", ".", "getProperty", "(", "TRANSPORT", ")", ";", "}", "if", "(", "port", "=", "=", "0", ")", "{", "port", "=", "NetworkUtil", ".", "getServerPort", "(", ");", "}", "if", "(", "transport", "!", "=", "null", ")", "{", "if", "(", "transport", ".", "trim", "(", ").", "equals", "(", "\"", "TCP", "\"", "))", "{", "simpleKdc", ".", "setKdcTcpPort", "(", "port", ")", ";", "simpleKdc", ".", "setAllowUdp", "(", "false", ")", ";", "}", "else", "if", "(", "transport", ".", "trim", "(", ").", "equals", "(", "\"", "UDP", "\"", "))", "{", "simpleKdc", ".", "setKdcUdpPort", "(", "port", ")", ";", "simpleKdc", ".", "setAllowTcp", "(", "false", ")", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Invalid", "transport", ":", "\"", "+", "transport", ")", ";", "}", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Need", "to", "set", "transport", "!", "\")", ";", "}", "simpleKdc", ".", "getKdcConfig", "(", ").", "setString", "(", "KdcConfigKey", ".", "KDC_SERVICE_NAME", ",", "conf", ".", "getProperty", "(", "INSTANCE", ")", ");", "if", "(", "conf", ".", "getProperty", "(", "DEBUG", ")", "!", "=", "null", ")", "{", "krb5Debug", "=", "getAndSet", "(", "SUN_SECURITY_KRB5_DEBUG", ",", "conf", ".", "getProperty", "(", "DEBUG", ")", ");", "}", "}", "/", "**", "*", "Stops", "the", "MiniKdc", "*", "/", "public", "synchronized", "void", "stop", "(", ")", "{", "if", "(", "simpleKdc", "!", "=", "null", ")", "{", "try", "{", "simpleKdc", ".", "stop", "(", ");", "}", "catch", "(", "KrbException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "}", "finally", "{", "if", "(", "conf", ".", "getProperty", "(", "DEBUG", ")", "!", "=", "null", ")", "{", "System", ".", "setProperty", "(", "SUN_SECURITY_KRB5_DEBUG", ",", "Boolean", ".", "toString", "(", "krb5Debug", ")", ");", "}", "}", "}", "delete", "(", "workDir", ")", ";", "try", "{", "/", "/", "Will", "be", "fixed", "in", "next", "Kerby", "version", ".", "Thread", ".", "sleep", "(", "1000", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "}", "LOG", ".", "info", "(", "\"", "MiniKdc", "stopped", ".", "\")", ";", "}", "private", "void", "delete", "(", "File", "f", ")", "{", "if", "(", "f", ".", "isFile", "(", "))", "{", "if", "(", "!", "f", ".", "delete", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "WARNING", ":", "cannot", "delete", "file", "\"", "+", "f", ".", "getAbsolutePath", "(", "))", ";", "}", "}", "else", "{", "for", "(", "File", "c", ":", "f", ".", "listFiles", "(", "))", "{", "delete", "(", "c", ")", ";", "}", "if", "(", "!", "f", ".", "delete", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "WARNING", ":", "cannot", "delete", "directory", "\"", "+", "f", ".", "getAbsolutePath", "(", "))", ";", "}", "}", "}", "/", "**", "*", "Creates", "a", "principal", "in", "the", "KDC", "with", "the", "specified", "user", "and", "password", ".", "*", "*", "@", "param", "principal", "principal", "name", ",", "do", "not", "include", "the", "domain", ".", "*", "@", "param", "password", "password", ".", "*", "@", "throws", "Exception", "thrown", "if", "the", "principal", "could", "not", "be", "created", ".", "*", "/", "public", "synchronized", "void", "createPrincipal", "(", "String", "principal", ",", "String", "password", ")", "throws", "Exception", "{", "simpleKdc", ".", "createPrincipal", "(", "principal", ",", "password", ")", ";", "}", "/", "**", "*", "Creates", "multiple", "principals", "in", "the", "KDC", "and", "adds", "them", "to", "a", "keytab", "file", ".", "*", "*", "@", "param", "keytabFile", "keytab", "file", "to", "add", "the", "created", "principals", ".", "*", "@", "param", "principals", "principals", "to", "add", "to", "the", "KDC", ",", "do", "not", "include", "the", "domain", ".", "*", "@", "throws", "Exception", "thrown", "if", "the", "principals", "or", "the", "keytab", "file", "could", "not", "be", "*", "created", ".", "*", "/", "public", "synchronized", "void", "createPrincipal", "(", "File", "keytabFile", ",", "String", ".", "..", "principals", ")", "throws", "Exception", "{", "simpleKdc", ".", "createPrincipals", "(", "principals", ")", ";", "if", "(", "keytabFile", ".", "exists", "(", ")", "&", "&", "!", "keytabFile", ".", "delete", "(", "))", "{", "LOG", ".", "error", "(", "\"", "Failed", "to", "delete", "keytab", "file", ":", "\"", "+", "keytabFile", ")", ";", "}", "for", "(", "String", "principal", ":", "principals", ")", "{", "simpleKdc", ".", "getKadmin", "(", ").", "exportKeytab", "(", "keytabFile", ",", "principal", ")", ";", "}", "}", "/", "**", "*", "Set", "the", "System", "property", ";", "return", "the", "old", "value", "for", "caching", ".", "*", "*", "@", "param", "sysprop", "property", "*", "@", "param", "debug", "true", "or", "false", "*", "@", "return", "the", "previous", "value", "*", "/", "private", "boolean", "getAndSet", "(", "String", "sysprop", ",", "String", "debug", ")", "{", "boolean", "old", "=", "Boolean", ".", "getBoolean", "(", "sysprop", ")", ";", "System", ".", "setProperty", "(", "sysprop", ",", "debug", ")", ";", "return", "old", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "185", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "org", ".", "apache", ".", "kerby", ".", "kerberos", ".", "kerb", ".", "keytab", ".", "Keytab", ";", "import", "org", ".", "apache", ".", "kerby", ".", "kerberos", ".", "kerb", ".", "type", ".", "base", ".", "PrincipalName", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "javax", ".", "security", ".", "auth", ".", "kerberos", ".", "KerberosPrincipal", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "AppConfigurationEntry", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "Configuration", ";", "import", "javax", ".", "security", ".", "auth", ".", "login", ".", "LoginContext", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Arrays", ";", "/", "*", "*", "This", "code", "is", "originally", "from", "HDFS", ",", "see", "the", "file", "name", "TestMiniKdc", "there", "*", "in", "case", "of", "bug", "fixing", ",", "history", ",", "etc", ".", "*", "*", "Branch", ":", "trunk", "*", "Github", "Revision", ":", "916140604ffef59466ba30832478311d3e6249bd", "*", "/", "public", "class", "MiniKdcTest", "extends", "KerberosSecurityTestcase", "{", "private", "static", "final", "boolean", "IBM_JAVA", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "vendor", "\"", ")", ".", "contains", "(", "\"", "IBM", "\"", ");", "@", "Test", "(", "timeout", "=", "60000", ")", "public", "void", "testMiniKdcStart", "(", ")", "{", "MiniKdc", "kdc", "=", "getKdc", "(", ");", "Assert", ".", "assertNotSame", "(", "0", ",", "kdc", ".", "getPort", "(", "))", ";", "}", "@", "Test", "(", "timeout", "=", "60000", ")", "public", "void", "testKeytabGen", "(", ")", "throws", "Exception", "{", "MiniKdc", "kdc", "=", "getKdc", "(", ");", "File", "workDir", "=", "getWorkDir", "(", ");", "kdc", ".", "createPrincipal", "(", "new", "File", "(", "workDir", ",", "\"", "keytab", "\"", "),", "\"", "foo", "/", "bar", "\"", ",", "\"", "bar", "/", "foo", "\"", ");", "List", "<", "PrincipalName", ">", "principalNameList", "=", "Keytab", ".", "loadKeytab", "(", "new", "File", "(", "workDir", ",", "\"", "keytab", "\"", "))", ".", "getPrincipals", "(", ");", "Set", "<", "String", ">", "principals", "=", "new", "HashSet", "<", "String", ">", "()", ";", "for", "(", "PrincipalName", "principalName", ":", "principalNameList", ")", "{", "principals", ".", "add", "(", "principalName", ".", "getName", "(", "))", ";", "}", "Assert", ".", "assertEquals", "(", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "foo", "/", "bar", "@", "\"", "+", "kdc", ".", "getRealm", "(", "),", "\"", "bar", "/", "foo", "@", "\"", "+", "kdc", ".", "getRealm", "(", "))", "),", "principals", ")", ";", "}", "private", "static", "class", "KerberosConfiguration", "extends", "Configuration", "{", "private", "String", "principal", ";", "private", "String", "keytab", ";", "private", "boolean", "isInitiator", ";", "private", "KerberosConfiguration", "(", "String", "principal", ",", "File", "keytab", ",", "boolean", "client", ")", "{", "this", ".", "principal", "=", "principal", ";", "this", ".", "keytab", "=", "keytab", ".", "getAbsolutePath", "(", ");", "this", ".", "isInitiator", "=", "client", ";", "}", "public", "static", "Configuration", "createClientConfig", "(", "String", "principal", ",", "File", "keytab", ")", "{", "return", "new", "KerberosConfiguration", "(", "principal", ",", "keytab", ",", "true", ")", ";", "}", "public", "static", "Configuration", "createServerConfig", "(", "String", "principal", ",", "File", "keytab", ")", "{", "return", "new", "KerberosConfiguration", "(", "principal", ",", "keytab", ",", "false", ")", ";", "}", "private", "static", "String", "getKrb5LoginModuleName", "(", ")", "{", "return", "System", ".", "getProperty", "(", "\"", "java", ".", "vendor", "\"", ").", "contains", "(", "\"", "IBM", "\"", ")", "?", "\"", "com", ".", "ibm", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "\"", ":", "\"", "com", ".", "sun", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "\"", ";", "}", "@", "Override", "public", "AppConfigurationEntry", "[", "]", "getAppConfigurationEntry", "(", "String", "name", ")", "{", "Map", "<", "String", ",", "String", ">", "options", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "options", ".", "put", "(", "\"", "principal", "\"", ",", "principal", ")", ";", "options", ".", "put", "(", "\"", "refreshKrb5Config", "\"", ",", "\"", "true", "\"", ");", "if", "(", "IBM_JAVA", ")", "{", "options", ".", "put", "(", "\"", "useKeytab", "\"", ",", "keytab", ")", ";", "options", ".", "put", "(", "\"", "credsType", "\"", ",", "\"", "both", "\"", ");", "}", "else", "{", "options", ".", "put", "(", "\"", "keyTab", "\"", ",", "keytab", ")", ";", "options", ".", "put", "(", "\"", "useKeyTab", "\"", ",", "\"", "true", "\"", ");", "options", ".", "put", "(", "\"", "storeKey", "\"", ",", "\"", "true", "\"", ");", "options", ".", "put", "(", "\"", "doNotPrompt", "\"", ",", "\"", "true", "\"", ");", "options", ".", "put", "(", "\"", "useTicketCache", "\"", ",", "\"", "true", "\"", ");", "options", ".", "put", "(", "\"", "renewTGT", "\"", ",", "\"", "true", "\"", ");", "options", ".", "put", "(", "\"", "isInitiator", "\"", ",", "Boolean", ".", "toString", "(", "isInitiator", ")", ");", "}", "String", "ticketCache", "=", "System", ".", "getenv", "(", "\"", "KRB5CCNAME", "\"", ");", "if", "(", "ticketCache", "!", "=", "null", ")", "{", "options", ".", "put", "(", "\"", "ticketCache", "\"", ",", "ticketCache", ")", ";", "}", "options", ".", "put", "(", "\"", "debug", "\"", ",", "\"", "true", "\"", ");", "return", "new", "AppConfigurationEntry", "[", "]", "{", "new", "AppConfigurationEntry", "(", "getKrb5LoginModuleName", "(", "),", "AppConfigurationEntry", ".", "LoginModuleControlFlag", ".", "REQUIRED", ",", "options", ")", "}", ";", "}", "}", "@", "Test", "(", "timeout", "=", "60000", ")", "public", "void", "testKerberosLogin", "(", ")", "throws", "Exception", "{", "MiniKdc", "kdc", "=", "getKdc", "(", ");", "File", "workDir", "=", "getWorkDir", "(", ");", "LoginContext", "loginContext", "=", "null", ";", "try", "{", "String", "principal", "=", "\"", "foo", "\"", ";", "File", "keytab", "=", "new", "File", "(", "workDir", ",", "\"", "foo", ".", "keytab", "\"", ");", "kdc", ".", "createPrincipal", "(", "keytab", ",", "principal", ")", ";", "Set", "<", "Principal", ">", "principals", "=", "new", "HashSet", "<", "Principal", ">", "()", ";", "principals", ".", "add", "(", "new", "KerberosPrincipal", "(", "principal", ")", ");", "/", "/", "client", "login", "Subject", "subject", "=", "new", "Subject", "(", "false", ",", "principals", ",", "new", "HashSet", "<", "Object", ">", "()", ",", "new", "HashSet", "<", "Object", ">", "()", ");", "loginContext", "=", "new", "LoginContext", "(", "\"\"", ",", "subject", ",", "null", ",", "KerberosConfiguration", ".", "createClientConfig", "(", "principal", ",", "keytab", ")", ");", "loginContext", ".", "login", "(", ");", "subject", "=", "loginContext", ".", "getSubject", "(", ");", "Assert", ".", "assertEquals", "(", "1", ",", "subject", ".", "getPrincipals", "(", ").", "size", "(", "))", ";", "Assert", ".", "assertEquals", "(", "KerberosPrincipal", ".", "class", ",", "subject", ".", "getPrincipals", "(", ").", "iterator", "(", ").", "next", "(", ").", "getClass", "(", "))", ";", "Assert", ".", "assertEquals", "(", "principal", "+", "\"", "@\"", "+", "kdc", ".", "getRealm", "(", "),", "subject", ".", "getPrincipals", "(", ").", "iterator", "(", ").", "next", "(", ").", "getName", "(", "))", ";", "loginContext", ".", "logout", "(", ");", "/", "/", "server", "login", "subject", "=", "new", "Subject", "(", "false", ",", "principals", ",", "new", "HashSet", "<", "Object", ">", "()", ",", "new", "HashSet", "<", "Object", ">", "()", ");", "loginContext", "=", "new", "LoginContext", "(", "\"\"", ",", "subject", ",", "null", ",", "KerberosConfiguration", ".", "createServerConfig", "(", "principal", ",", "keytab", ")", ");", "loginContext", ".", "login", "(", ");", "subject", "=", "loginContext", ".", "getSubject", "(", ");", "Assert", ".", "assertEquals", "(", "1", ",", "subject", ".", "getPrincipals", "(", ").", "size", "(", "))", ";", "Assert", ".", "assertEquals", "(", "KerberosPrincipal", ".", "class", ",", "subject", ".", "getPrincipals", "(", ").", "iterator", "(", ").", "next", "(", ").", "getClass", "(", "))", ";", "Assert", ".", "assertEquals", "(", "principal", "+", "\"", "@\"", "+", "kdc", ".", "getRealm", "(", "),", "subject", ".", "getPrincipals", "(", ").", "iterator", "(", ").", "next", "(", ").", "getName", "(", "))", ";", "loginContext", ".", "logout", "(", ");", "}", "finally", "{", "if", "(", "loginContext", "!", "=", "null", "&", "&", "loginContext", ".", "getSubject", "(", ")", "!", "=", "null", "&", "&", "!", "loginContext", ".", "getSubject", "(", ").", "getPrincipals", "(", ").", "isEmpty", "(", "))", "{", "loginContext", ".", "logout", "(", ");", "}", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "146", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileWriter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "PortAssignment", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZKTestCase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerTestBase", ".", "MainThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "QuorumAuthTestBase", "provides", "a", "base", "class", "for", "testing", "quorum", "peer", "mutual", "*", "authentication", "using", "SASL", "mechanisms", ".", "*", "/", "public", "class", "QuorumAuthTestBase", "extends", "ZKTestCase", "{", "protected", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "QuorumAuthTestBase", ".", "class", ")", ";", "protected", "List", "<", "MainThread", ">", "mt", "=", "new", "ArrayList", "<", "MainThread", ">", "()", ";", "protected", "static", "File", "jaasConfigDir", ";", "public", "static", "void", "setupJaasConfig", "(", "String", "jaasEntries", ")", "{", "try", "{", "jaasConfigDir", "=", "ClientBase", ".", "createTmpDir", "(", ");", "File", "saslConfFile", "=", "new", "File", "(", "jaasConfigDir", ",", "\"", "jaas", ".", "conf", "\"", ");", "FileWriter", "fwriter", "=", "new", "FileWriter", "(", "saslConfFile", ")", ";", "fwriter", ".", "write", "(", "jaasEntries", ")", ";", "fwriter", ".", "close", "(", ");", "System", ".", "setProperty", "(", "\"", "java", ".", "security", ".", "auth", ".", "login", ".", "config", "\"", ",", "saslConfFile", ".", "getAbsolutePath", "(", "))", ";", "}", "catch", "(", "IOException", "ioe", ")", "{", "LOG", ".", "error", "(", "\"", "Failed", "to", "create", "tmp", "directory", "to", "hold", "JAAS", "conf", "file", "\"", ",", "ioe", ")", ";", "/", "/", "could", "not", "create", "tmp", "directory", "to", "hold", "JAAS", "conf", "file", ":", "test", "will", "/", "/", "fail", "now", ".", "}", "}", "public", "static", "void", "cleanupJaasConfig", "(", ")", "{", "if", "(", "jaasConfigDir", "!", "=", "null", ")", "{", "FileUtils", ".", "deleteQuietly", "(", "jaasConfigDir", ")", ";", "}", "}", "protected", "String", "startQuorum", "(", "final", "int", "serverCount", ",", "Map", "<", "String", ",", "String", ">", "authConfigs", ",", "int", "authServerCount", ")", "throws", "IOException", "{", "StringBuilder", "connectStr", "=", "new", "StringBuilder", "(", ");", "final", "int", "[", "]", "clientPorts", "=", "startQuorum", "(", "serverCount", ",", "connectStr", ",", "authConfigs", ",", "authServerCount", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "serverCount", ";", "i", "+", "+)", "{", "Assert", ".", "assertTrue", "(", "\"", "waiting", "for", "server", "\"", "+", "i", "+", "\"", "being", "up", "\"", ",", "ClientBase", ".", "waitForServerUp", "(", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "\"", "+", "clientPorts", "[", "i", "]", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ");", "}", "return", "connectStr", ".", "toString", "(", ");", "}", "protected", "int", "[", "]", "startQuorum", "(", "final", "int", "serverCount", ",", "StringBuilder", "connectStr", ",", "Map", "<", "String", ",", "String", ">", "authConfigs", ",", "int", "authServerCount", ")", "throws", "IOException", "{", "final", "int", "clientPorts", "[", "]", "=", "new", "int", "[", "serverCount", "]", ";", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "serverCount", ";", "i", "+", "+)", "{", "clientPorts", "[", "i", "]", "=", "PortAssignment", ".", "unique", "(", ");", "String", "server", "=", "String", ".", "format", "(", "\"", "server", ".", "%", "d", "=", "localhost", ":", "%", "d", ":", "%", "d", ":", "participant", "\"", ",", "i", ",", "PortAssignment", ".", "unique", "(", "),", "PortAssignment", ".", "unique", "(", "))", ";", "sb", ".", "append", "(", "server", "+", "\"", "\\", "n", "\"", ");", "connectStr", ".", "append", "(", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "\"", "+", "clientPorts", "[", "i", "]", ");", "if", "(", "i", "<", "serverCount", "-", "1", ")", "{", "connectStr", ".", "append", "(", "\",", "\")", ";", "}", "}", "String", "quorumCfg", "=", "sb", ".", "toString", "(", ");", "/", "/", "servers", "with", "authentication", "interfaces", "configured", "int", "i", "=", "0", ";", "for", "(", ";", "i", "<", "authServerCount", ";", "i", "+", "+)", "{", "startServer", "(", "authConfigs", ",", "clientPorts", ",", "quorumCfg", ",", "i", ")", ";", "}", "/", "/", "servers", "without", "any", "authentication", "configured", "for", "(", "int", "j", "=", "0", ";", "j", "<", "serverCount", "-", "authServerCount", ";", "j", "+", "+,", "i", "+", "+)", "{", "MainThread", "mthread", "=", "new", "MainThread", "(", "i", ",", "clientPorts", "[", "i", "]", ",", "quorumCfg", ")", ";", "mt", ".", "add", "(", "mthread", ")", ";", "mthread", ".", "start", "(", ");", "}", "return", "clientPorts", ";", "}", "private", "void", "startServer", "(", "Map", "<", "String", ",", "String", ">", "authConfigs", ",", "final", "int", "[", "]", "clientPorts", ",", "String", "quorumCfg", ",", "int", "i", ")", "throws", "IOException", "{", "MainThread", "mthread", "=", "new", "MainThread", "(", "i", ",", "clientPorts", "[", "i", "]", ",", "quorumCfg", ",", "authConfigs", ")", ";", "mt", ".", "add", "(", "mthread", ")", ";", "mthread", ".", "start", "(", ");", "}", "protected", "void", "startServer", "(", "MainThread", "restartPeer", ",", "Map", "<", "String", ",", "String", ">", "authConfigs", ")", "throws", "IOException", "{", "MainThread", "mthread", "=", "new", "MainThread", "(", "restartPeer", ".", "getMyid", "(", "),", "restartPeer", ".", "getClientPort", "(", "),", "restartPeer", ".", "getQuorumCfgSection", "(", "),", "authConfigs", ")", ";", "mt", ".", "add", "(", "mthread", ")", ";", "mthread", ".", "start", "(", ");", "}", "void", "shutdownAll", "(", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "mt", ".", "size", "(", ");", "i", "+", "+)", "{", "shutdown", "(", "i", ")", ";", "}", "}", "MainThread", "shutdown", "(", "int", "index", ")", "{", "MainThread", "mainThread", "=", "mt", ".", "get", "(", "index", ")", ";", "try", "{", "mainThread", ".", "shutdown", "(", ");", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "finally", "{", "mt", ".", "remove", "(", "index", ")", ";", "}", "mainThread", ".", "deleteBaseDir", "(", ");", "return", "mainThread", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "239", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeoutException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "CreateMode", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "KeeperException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ".", "Ids", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooKeeper", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerTestBase", ".", "MainThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientTest", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ".", "CountdownWatcher", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "/", "**", "*", "Rolling", "upgrade", "should", "do", "in", "three", "steps", ":", "*", "*", "step", "-", "1", ")", "Stop", "the", "server", "and", "set", "the", "flags", "and", "restart", "the", "server", ".", "*", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", "and", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "Ensure", "that", "all", "the", "servers", "should", "complete", "this", "step", ".", "Now", ",", "move", "to", "next", "step", ".", "*", "*", "step", "-", "2", ")", "Stop", "the", "server", "one", "by", "one", "and", "change", "the", "flags", "and", "restart", "the", "server", ".", "*", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", "and", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "Ensure", "that", "all", "the", "servers", "should", "complete", "this", "step", ".", "Now", ",", "move", "to", "next", "step", ".", "*", "*", "step", "-", "3", ")", "Stop", "the", "server", "one", "by", "one", "and", "change", "the", "flags", "and", "restart", "the", "server", ".", "*", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", "and", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "true", "*", "Now", ",", "all", "the", "servers", "are", "fully", "upgraded", "and", "running", "in", "secured", "mode", ".", "*", "/", "public", "class", "QuorumAuthUpgradeTest", "extends", "QuorumAuthTestBase", "{", "static", "{", "String", "jaasEntries", "=", "new", "String", "(", "\"\"", "+", "\"", "QuorumServer", "{", "\\", "n", "\"", "+", "\"", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "DigestLoginModule", "required", "\\", "n", "\"", "+", "\"", "user_test", "=", "\\\"", "mypassword", "\\", "\";", "\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", "+", "\"", "QuorumLearner", "{", "\\", "n", "\"", "+", "\"", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "DigestLoginModule", "required", "\\", "n", "\"", "+", "\"", "username", "=", "\\\"", "test", "\\", "\"\\", "n", "\"", "+", "\"", "password", "=", "\\\"", "mypassword", "\\", "\";", "\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", ");", "setupJaasConfig", "(", "jaasEntries", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "shutdownAll", "(", ");", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "cleanupJaasConfig", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "servers", "are", "able", "to", "start", "without", "any", "authentication", ".", "*", "peer0", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "false", "*", "peer1", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "false", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testNullAuthLearnerServer", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "false", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "2", ",", "authConfigs", ",", "0", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "zk", ".", "create", "(", "\"/", "foo", "\"", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "servers", "are", "able", "to", "form", "quorum", ".", "*", "peer0", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "peer1", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "false", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testAuthLearnerAgainstNullAuthServer", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "2", ",", "authConfigs", ",", "1", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "zk", ".", "create", "(", "\"/", "foo", "\"", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "servers", "are", "able", "to", "form", "quorum", ".", "*", "peer0", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "peer1", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testAuthLearnerAgainstNoAuthRequiredServer", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "2", ",", "authConfigs", ",", "2", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "zk", ".", "create", "(", "\"/", "foo", "\"", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "servers", "are", "able", "to", "form", "quorum", ".", "*", "peer0", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "true", "*", "peer1", "-", ">", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "true", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testAuthLearnerServer", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "2", ",", "authConfigs", ",", "2", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "zk", ".", "create", "(", "\"/", "foo", "\"", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Rolling", "upgrade", "should", "do", "in", "three", "steps", ":", "*", "*", "step", "-", "1", ")", "Stop", "the", "server", "and", "set", "the", "flags", "and", "restart", "the", "server", ".", "*", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", "and", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "Ensure", "that", "all", "the", "servers", "should", "complete", "this", "step", ".", "Now", ",", "move", "to", "next", "step", ".", "*", "*", "step", "-", "2", ")", "Stop", "the", "server", "one", "by", "one", "and", "change", "the", "flags", "and", "restart", "the", "server", ".", "*", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", "and", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "*", "Ensure", "that", "all", "the", "servers", "should", "complete", "this", "step", ".", "Now", ",", "move", "to", "next", "step", ".", "*", "*", "step", "-", "3", ")", "Stop", "the", "server", "one", "by", "one", "and", "change", "the", "flags", "and", "restart", "the", "server", ".", "*", "quorum", ".", "auth", ".", "enableSasl", "=", "true", ",", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", "and", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "true", "*", "Now", ",", "all", "the", "servers", "are", "fully", "upgraded", "and", "running", "in", "secured", "mode", ".", "*", "/", "@", "Test", "(", "timeout", "=", "90000", ")", "public", "void", "testRollingUpgrade", "(", ")", "throws", "Exception", "{", "/", "/", "Start", "peer0", ",", "1", ",", "2", "servers", "with", "quorum", ".", "auth", ".", "enableSasl", "=", "false", "and", "/", "/", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "/", "/", "Assume", "this", "is", "an", "existing", "cluster", ".", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "false", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "3", ",", "authConfigs", ",", "0", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "zk", ".", "create", "(", "\"/", "foo", "\"", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT_SEQUENTIAL", ")", ";", "/", "/", "1", ".", "Upgrade", "peer0", ",", "1", ",", "2", "with", "quorum", ".", "auth", ".", "enableSasl", "=", "true", "and", "/", "/", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "false", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "restartServer", "(", "authConfigs", ",", "0", ",", "zk", ",", "watcher", ")", ";", "restartServer", "(", "authConfigs", ",", "1", ",", "zk", ",", "watcher", ")", ";", "restartServer", "(", "authConfigs", ",", "2", ",", "zk", ",", "watcher", ")", ";", "/", "/", "2", ".", "Upgrade", "peer0", ",", "1", ",", "2", "with", "quorum", ".", "auth", ".", "enableSasl", "=", "true", "and", "/", "/", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "restartServer", "(", "authConfigs", ",", "0", ",", "zk", ",", "watcher", ")", ";", "restartServer", "(", "authConfigs", ",", "1", ",", "zk", ",", "watcher", ")", ";", "restartServer", "(", "authConfigs", ",", "2", ",", "zk", ",", "watcher", ")", ";", "/", "/", "3", ".", "Upgrade", "peer0", ",", "1", ",", "2", "with", "quorum", ".", "auth", ".", "enableSasl", "=", "true", "and", "/", "/", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", ",", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "true", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "restartServer", "(", "authConfigs", ",", "0", ",", "zk", ",", "watcher", ")", ";", "restartServer", "(", "authConfigs", ",", "1", ",", "zk", ",", "watcher", ")", ";", "restartServer", "(", "authConfigs", ",", "2", ",", "zk", ",", "watcher", ")", ";", "/", "/", "4", ".", "Restart", "peer2", "with", "quorum", ".", "auth", ".", "learnerEnableSasl", "=", "false", "and", "/", "/", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", ".", "It", "should", "fail", "to", "join", "the", "/", "/", "quorum", "as", "this", "needs", "auth", ".", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "false", "\"", ");", "MainThread", "m", "=", "shutdown", "(", "2", ")", ";", "startServer", "(", "m", ",", "authConfigs", ")", ";", "Assert", ".", "assertFalse", "(", "\"", "waiting", "for", "server", "2", "being", "up", "\"", ",", "ClientBase", ".", "waitForServerUp", "(", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "\"", "+", "m", ".", "getClientPort", "(", "),", "5000", ")", ");", "}", "private", "void", "restartServer", "(", "Map", "<", "String", ",", "String", ">", "authConfigs", ",", "int", "index", ",", "ZooKeeper", "zk", ",", "CountdownWatcher", "watcher", ")", "throws", "IOException", ",", "KeeperException", ",", "InterruptedException", ",", "TimeoutException", "{", "LOG", ".", "info", "(", "\"", "Restarting", "server", "myid", "=", "\"", "+", "index", ")", ";", "MainThread", "m", "=", "shutdown", "(", "index", ")", ";", "startServer", "(", "m", ",", "authConfigs", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "waiting", "for", "server", "\"", "+", "index", "+", "\"", "being", "up", "\"", ",", "ClientBase", ".", "waitForServerUp", "(", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "\"", "+", "m", ".", "getClientPort", "(", "),", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ");", "watcher", ".", "waitForConnected", "(", "ClientTest", ".", "CONNECTION_TIMEOUT", ")", ";", "zk", ".", "create", "(", "\"/", "foo", "\"", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT_SEQUENTIAL", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "222", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "CreateMode", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "PortAssignment", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ".", "Ids", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooKeeper", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "admin", ".", "AdminServer", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerMain", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerTestBase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerConfig", ".", "ConfigException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerTestBase", ".", "MainThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ".", "CountdownWatcher", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "QuorumDigestAuthTest", "extends", "QuorumAuthTestBase", "{", "static", "{", "String", "jaasEntries", "=", "new", "String", "(", "\"\"", "+", "\"", "QuorumServer", "{", "\\", "n", "\"", "+", "\"", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "DigestLoginModule", "required", "\\", "n", "\"", "+", "\"", "user_test", "=", "\\\"", "mypassword", "\\", "\";", "\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", "+", "\"", "QuorumLearner", "{", "\\", "n", "\"", "+", "\"", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "DigestLoginModule", "required", "\\", "n", "\"", "+", "\"", "username", "=", "\\\"", "test", "\\", "\"\\", "n", "\"", "+", "\"", "password", "=", "\\\"", "mypassword", "\\", "\";", "\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", "+", "\"", "QuorumLearnerInvalid", "{", "\\", "n", "\"", "+", "\"", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "DigestLoginModule", "required", "\\", "n", "\"", "+", "\"", "username", "=", "\\\"", "test", "\\", "\"\\", "n", "\"", "+", "\"", "password", "=", "\\\"", "invalid", "\\", "\";", "\\", "n", "\"", "+", "\"", "};", "\"", "+", "\"", "\\", "n", "\"", ");", "setupJaasConfig", "(", "jaasEntries", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "for", "(", "MainThread", "mainThread", ":", "mt", ")", "{", "mainThread", ".", "shutdown", "(", ");", "mainThread", ".", "deleteBaseDir", "(", ");", "}", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", "){", "cleanupJaasConfig", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "server", "is", "able", "to", "start", "with", "valid", "credentials", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testValidCredentials", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "3", ",", "authConfigs", ",", "3", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "10", ";", "i", "+", "+)", "{", "zk", ".", "create", "(", "\"/", "\"", "+", "i", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "}", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "server", "is", "able", "to", "start", "with", "invalid", "credentials", "if", "*", "the", "configuration", "is", "set", "to", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "false", ".", "*", "Quorum", "will", "talk", "each", "other", "even", "if", "the", "authentication", "is", "not", "succeeded", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testSaslNotRequiredWithInvalidCredentials", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ",", "\"", "QuorumLearnerInvalid", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "false", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "String", "connectStr", "=", "startQuorum", "(", "3", ",", "authConfigs", ",", "3", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "10", ";", "i", "+", "+)", "{", "zk", ".", "create", "(", "\"/", "\"", "+", "i", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "}", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "server", "shouldn", "'", "t", "start", "with", "invalid", "credentials", "*", "if", "the", "configuration", "is", "set", "to", "quorum", ".", "auth", ".", "serverRequireSasl", "=", "true", ",", "*", "quorum", ".", "auth", ".", "learnerRequireSasl", "=", "true", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testSaslRequiredInvalidCredentials", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ",", "\"", "QuorumLearnerInvalid", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "int", "serverCount", "=", "2", ";", "final", "int", "[", "]", "clientPorts", "=", "startQuorum", "(", "serverCount", ",", "new", "StringBuilder", "(", "),", "authConfigs", ",", "serverCount", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "serverCount", ";", "i", "+", "+)", "{", "boolean", "waitForServerUp", "=", "ClientBase", ".", "waitForServerUp", "(", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "\"", "+", "clientPorts", "[", "i", "]", ",", "QuorumPeerTestBase", ".", "TIMEOUT", ")", ";", "Assert", ".", "assertFalse", "(", "\"", "Shouldn", "'", "t", "start", "server", "with", "invalid", "credentials", "\"", ",", "waitForServerUp", ")", ";", "}", "}", "/", "**", "*", "If", "quorumpeer", "learner", "is", "not", "auth", "enabled", "then", "self", "won", "'", "t", "be", "able", "to", "join", "*", "quorum", ".", "So", "this", "test", "is", "ensuring", "that", "the", "quorumpeer", "learner", "is", "also", "auth", "*", "enabled", "while", "enabling", "quorum", "server", "require", "sasl", ".", "*", "/", "@", "Test", "(", "timeout", "=", "10000", ")", "public", "void", "testEnableQuorumServerRequireSaslWithoutQuorumLearnerRequireSasl", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ",", "\"", "QuorumLearner", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "MainThread", "mthread", "=", "new", "MainThread", "(", "1", ",", "PortAssignment", ".", "unique", "(", "),", "\"", "\",", "authConfigs", ")", ";", "String", "args", "[", "]", "=", "new", "String", "[", "1", "]", ";", "args", "[", "0", "]", "=", "mthread", ".", "getConfFile", "(", ").", "toString", "(", ");", "try", "{", "new", "QuorumPeerMain", "(", ")", "{", "@", "Override", "protected", "void", "initializeAndRun", "(", "String", "[", "]", "args", ")", "throws", "ConfigException", ",", "IOException", ",", "AdminServer", ".", "AdminServerException", "{", "super", ".", "initializeAndRun", "(", "args", ")", ";", "}", "}", ".", "initializeAndRun", "(", "args", ")", ";", "Assert", ".", "fail", "(", "\"", "Must", "throw", "exception", "as", "quorumpeer", "learner", "is", "not", "enabled", "!", "\")", ";", "}", "catch", "(", "ConfigException", "e", ")", "{", "/", "/", "expected", "}", "}", "/", "**", "*", "If", "quorumpeer", "learner", "is", "not", "auth", "enabled", "then", "self", "won", "'", "t", "be", "able", "to", "join", "*", "quorum", ".", "So", "this", "test", "is", "ensuring", "that", "the", "quorumpeer", "learner", "is", "also", "auth", "*", "enabled", "while", "enabling", "quorum", "server", "require", "sasl", ".", "*", "/", "@", "Test", "(", "timeout", "=", "10000", ")", "public", "void", "testEnableQuorumAuthenticationConfigurations", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ",", "\"", "QuorumLearner", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "false", "\"", ");", "/", "/", "case", "-", "1", ")", "'", "quorum", ".", "auth", ".", "enableSasl", "'", "is", "off", ".", "Tries", "to", "enable", "server", "sasl", ".", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "MainThread", "mthread", "=", "new", "MainThread", "(", "1", ",", "PortAssignment", ".", "unique", "(", "),", "\"", "\",", "authConfigs", ")", ";", "String", "args", "[", "]", "=", "new", "String", "[", "1", "]", ";", "args", "[", "0", "]", "=", "mthread", ".", "getConfFile", "(", ").", "toString", "(", ");", "try", "{", "new", "QuorumPeerMain", "(", ")", "{", "@", "Override", "protected", "void", "initializeAndRun", "(", "String", "[", "]", "args", ")", "throws", "ConfigException", ",", "IOException", ",", "AdminServer", ".", "AdminServerException", "{", "super", ".", "initializeAndRun", "(", "args", ")", ";", "}", "}", ".", "initializeAndRun", "(", "args", ")", ";", "Assert", ".", "fail", "(", "\"", "Must", "throw", "exception", "as", "quorum", "sasl", "is", "not", "enabled", "!", "\")", ";", "}", "catch", "(", "ConfigException", "e", ")", "{", "/", "/", "expected", "}", "/", "/", "case", "-", "1", ")", "'", "quorum", ".", "auth", ".", "enableSasl", "'", "is", "off", ".", "Tries", "to", "enable", "learner", "sasl", ".", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "false", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "try", "{", "new", "QuorumPeerMain", "(", ")", "{", "@", "Override", "protected", "void", "initializeAndRun", "(", "String", "[", "]", "args", ")", "throws", "ConfigException", ",", "IOException", ",", "AdminServer", ".", "AdminServerException", "{", "super", ".", "initializeAndRun", "(", "args", ")", ";", "}", "}", ".", "initializeAndRun", "(", "args", ")", ";", "Assert", ".", "fail", "(", "\"", "Must", "throw", "exception", "as", "quorum", "sasl", "is", "not", "enabled", "!", "\")", ";", "}", "catch", "(", "ConfigException", "e", ")", "{", "/", "/", "expected", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "110", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FilenameUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "CreateMode", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ".", "Ids", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooKeeper", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerTestBase", ".", "MainThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ".", "CountdownWatcher", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "QuorumKerberosAuthTest", "extends", "KerberosSecurityTestcase", "{", "private", "static", "File", "keytabFile", ";", "static", "{", "String", "keytabFilePath", "=", "FilenameUtils", ".", "normalize", "(", "KerberosTestUtils", ".", "getKeytabFile", "(", "),", "true", ")", ";", "String", "jaasEntries", "=", "new", "String", "(", "\"\"", "+", "\"", "QuorumServer", "{", "\\", "n", "\"", "+", "\"", "com", ".", "sun", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "required", "\\", "n", "\"", "+", "\"", "useKeyTab", "=", "true", "\\", "n", "\"", "+", "\"", "keyTab", "=", "\\\"", "\"", "+", "keytabFilePath", "+", "\"", "\\\"", "\\", "n", "\"", "+", "\"", "storeKey", "=", "true", "\\", "n", "\"", "+", "\"", "useTicketCache", "=", "false", "\\", "n", "\"", "+", "\"", "debug", "=", "false", "\\", "n", "\"", "+", "\"", "principal", "=", "\\\"", "\"", "+", "KerberosTestUtils", ".", "getServerPrincipal", "(", ")", "+", "\"", "\\\"", ";\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", "+", "\"", "QuorumLearner", "{", "\\", "n", "\"", "+", "\"", "com", ".", "sun", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "required", "\\", "n", "\"", "+", "\"", "useKeyTab", "=", "true", "\\", "n", "\"", "+", "\"", "keyTab", "=", "\\\"", "\"", "+", "keytabFilePath", "+", "\"", "\\\"", "\\", "n", "\"", "+", "\"", "storeKey", "=", "true", "\\", "n", "\"", "+", "\"", "useTicketCache", "=", "false", "\\", "n", "\"", "+", "\"", "debug", "=", "false", "\\", "n", "\"", "+", "\"", "principal", "=", "\\\"", "\"", "+", "KerberosTestUtils", ".", "getLearnerPrincipal", "(", ")", "+", "\"", "\\\"", ";\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", ");", "setupJaasConfig", "(", "jaasEntries", ")", ";", "}", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "/", "/", "create", "keytab", "keytabFile", "=", "new", "File", "(", "KerberosTestUtils", ".", "getKeytabFile", "(", "))", ";", "String", "learnerPrincipal", "=", "KerberosTestUtils", ".", "getLearnerPrincipal", "(", ");", "String", "serverPrincipal", "=", "KerberosTestUtils", ".", "getServerPrincipal", "(", ");", "learnerPrincipal", "=", "learnerPrincipal", ".", "substring", "(", "0", ",", "learnerPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "serverPrincipal", "=", "serverPrincipal", ".", "substring", "(", "0", ",", "serverPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "getKdc", "(", ").", "createPrincipal", "(", "keytabFile", ",", "learnerPrincipal", ",", "serverPrincipal", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "for", "(", "MainThread", "mainThread", ":", "mt", ")", "{", "mainThread", ".", "shutdown", "(", ");", "mainThread", ".", "deleteBaseDir", "(", ");", "}", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "if", "(", "keytabFile", "!", "=", "null", ")", "{", "FileUtils", ".", "deleteQuietly", "(", "keytabFile", ")", ";", "}", "cleanupJaasConfig", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "server", "is", "able", "to", "start", "with", "valid", "credentials", "*", "/", "@", "Test", "(", "timeout", "=", "120000", ")", "public", "void", "testValidCredentials", "(", ")", "throws", "Exception", "{", "String", "serverPrincipal", "=", "KerberosTestUtils", ".", "getServerPrincipal", "(", ");", "serverPrincipal", "=", "serverPrincipal", ".", "substring", "(", "0", ",", "serverPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_KERBEROS_SERVICE_PRINCIPAL", ",", "serverPrincipal", ")", ";", "String", "connectStr", "=", "startQuorum", "(", "3", ",", "authConfigs", ",", "3", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "10", ";", "i", "+", "+)", "{", "zk", ".", "create", "(", "\"/", "\"", "+", "i", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "}", "zk", ".", "close", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "184", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "auth", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeoutException", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FilenameUtils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "CreateMode", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "PortAssignment", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ".", "Ids", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooKeeper", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", ".", "QuorumPeerTestBase", ".", "MainThread", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "test", ".", "ClientBase", ".", "CountdownWatcher", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "junit", ".", "framework", ".", "Assert", ";", "public", "class", "QuorumKerberosHostBasedAuthTest", "extends", "KerberosSecurityTestcase", "{", "private", "static", "File", "keytabFile", ";", "private", "static", "String", "hostServerPrincipal", "=", "KerberosTestUtils", ".", "getHostServerPrincipal", "(", ");", "private", "static", "String", "hostLearnerPrincipal", "=", "KerberosTestUtils", ".", "getHostLearnerPrincipal", "(", ");", "private", "static", "String", "hostNamedLearnerPrincipal", "=", "KerberosTestUtils", ".", "getHostNamedLearnerPrincipal", "(", "\"", "myHost", "\"", ");", "static", "{", "setupJaasConfigEntries", "(", "hostServerPrincipal", ",", "hostLearnerPrincipal", ",", "hostNamedLearnerPrincipal", ")", ";", "}", "private", "static", "void", "setupJaasConfigEntries", "(", "String", "hostServerPrincipal", ",", "String", "hostLearnerPrincipal", ",", "String", "hostNamedLearnerPrincipal", ")", "{", "String", "keytabFilePath", "=", "FilenameUtils", ".", "normalize", "(", "KerberosTestUtils", ".", "getKeytabFile", "(", "),", "true", ")", ";", "String", "jaasEntries", "=", "new", "String", "(", "\"\"", "+", "\"", "QuorumServer", "{", "\\", "n", "\"", "+", "\"", "com", ".", "sun", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "required", "\\", "n", "\"", "+", "\"", "useKeyTab", "=", "true", "\\", "n", "\"", "+", "\"", "keyTab", "=", "\\\"", "\"", "+", "keytabFilePath", "+", "\"", "\\\"", "\\", "n", "\"", "+", "\"", "storeKey", "=", "true", "\\", "n", "\"", "+", "\"", "useTicketCache", "=", "false", "\\", "n", "\"", "+", "\"", "debug", "=", "false", "\\", "n", "\"", "+", "\"", "principal", "=", "\\\"", "\"", "+", "KerberosTestUtils", ".", "replaceHostPattern", "(", "hostServerPrincipal", ")", "+", "\"", "\\\"", ";\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", "+", "\"", "QuorumLearner", "{", "\\", "n", "\"", "+", "\"", "com", ".", "sun", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "required", "\\", "n", "\"", "+", "\"", "useKeyTab", "=", "true", "\\", "n", "\"", "+", "\"", "keyTab", "=", "\\\"", "\"", "+", "keytabFilePath", "+", "\"", "\\\"", "\\", "n", "\"", "+", "\"", "storeKey", "=", "true", "\\", "n", "\"", "+", "\"", "useTicketCache", "=", "false", "\\", "n", "\"", "+", "\"", "debug", "=", "false", "\\", "n", "\"", "+", "\"", "principal", "=", "\\\"", "\"", "+", "KerberosTestUtils", ".", "replaceHostPattern", "(", "hostLearnerPrincipal", ")", "+", "\"", "\\\"", ";\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", "+", "\"", "QuorumLearnerMyHost", "{", "\\", "n", "\"", "+", "\"", "com", ".", "sun", ".", "security", ".", "auth", ".", "module", ".", "Krb5LoginModule", "required", "\\", "n", "\"", "+", "\"", "useKeyTab", "=", "true", "\\", "n", "\"", "+", "\"", "keyTab", "=", "\\\"", "\"", "+", "keytabFilePath", "+", "\"", "\\\"", "\\", "n", "\"", "+", "\"", "storeKey", "=", "true", "\\", "n", "\"", "+", "\"", "useTicketCache", "=", "false", "\\", "n", "\"", "+", "\"", "debug", "=", "false", "\\", "n", "\"", "+", "\"", "principal", "=", "\\\"", "\"", "+", "hostNamedLearnerPrincipal", "+", "\"", "\\\"", ";\\", "n", "\"", "+", "\"", "};", "\\", "n", "\"", ");", "setupJaasConfig", "(", "jaasEntries", ")", ";", "}", "@", "BeforeClass", "public", "static", "void", "setUp", "(", ")", "throws", "Exception", "{", "/", "/", "create", "keytab", "keytabFile", "=", "new", "File", "(", "KerberosTestUtils", ".", "getKeytabFile", "(", "))", ";", "/", "/", "Creates", "principals", "in", "the", "KDC", "and", "adds", "them", "to", "a", "keytab", "file", ".", "String", "learnerPrincipal", "=", "hostLearnerPrincipal", ".", "substring", "(", "0", ",", "hostLearnerPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "learnerPrincipal", "=", "KerberosTestUtils", ".", "replaceHostPattern", "(", "learnerPrincipal", ")", ";", "String", "serverPrincipal", "=", "hostServerPrincipal", ".", "substring", "(", "0", ",", "hostServerPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "serverPrincipal", "=", "KerberosTestUtils", ".", "replaceHostPattern", "(", "serverPrincipal", ")", ";", "/", "/", "learner", "with", "ipaddress", "in", "principal", "String", "learnerPrincipal2", "=", "hostNamedLearnerPrincipal", ".", "substring", "(", "0", ",", "hostNamedLearnerPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "getKdc", "(", ").", "createPrincipal", "(", "keytabFile", ",", "learnerPrincipal", ",", "learnerPrincipal2", ",", "serverPrincipal", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "for", "(", "MainThread", "mainThread", ":", "mt", ")", "{", "mainThread", ".", "shutdown", "(", ");", "mainThread", ".", "deleteBaseDir", "(", ");", "}", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "if", "(", "keytabFile", "!", "=", "null", ")", "{", "FileUtils", ".", "deleteQuietly", "(", "keytabFile", ")", ";", "}", "cleanupJaasConfig", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "server", "is", "able", "to", "start", "with", "valid", "credentials", "*", "/", "@", "Test", "(", "timeout", "=", "120000", ")", "public", "void", "testValidCredentials", "(", ")", "throws", "Exception", "{", "String", "serverPrincipal", "=", "hostServerPrincipal", ".", "substring", "(", "0", ",", "hostServerPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_KERBEROS_SERVICE_PRINCIPAL", ",", "serverPrincipal", ")", ";", "String", "connectStr", "=", "startQuorum", "(", "3", ",", "authConfigs", ",", "3", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "10", ";", "i", "+", "+)", "{", "zk", ".", "create", "(", "\"/", "\"", "+", "i", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "}", "zk", ".", "close", "(", ");", "}", "/", "**", "*", "Test", "to", "verify", "that", "the", "bad", "server", "connection", "to", "the", "quorum", "should", "be", "rejected", ".", "*", "/", "@", "Test", "(", "timeout", "=", "120000", ")", "public", "void", "testConnectBadServer", "(", ")", "throws", "Exception", "{", "String", "serverPrincipal", "=", "hostServerPrincipal", ".", "substring", "(", "0", ",", "hostServerPrincipal", ".", "lastIndexOf", "(", "\"@", "\")", ");", "Map", "<", "String", ",", "String", ">", "authConfigs", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SASL_AUTH_ENABLED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_SERVER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_AUTH_REQUIRED", ",", "\"", "true", "\"", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_KERBEROS_SERVICE_PRINCIPAL", ",", "serverPrincipal", ")", ";", "String", "connectStr", "=", "startQuorum", "(", "3", ",", "authConfigs", ",", "3", ")", ";", "CountdownWatcher", "watcher", "=", "new", "CountdownWatcher", "(", ");", "ZooKeeper", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "10", ";", "i", "+", "+)", "{", "zk", ".", "create", "(", "\"/", "\"", "+", "i", ",", "new", "byte", "[", "0", "]", ",", "Ids", ".", "OPEN_ACL_UNSAFE", ",", "CreateMode", ".", "PERSISTENT", ")", ";", "}", "zk", ".", "close", "(", ");", "String", "quorumCfgSection", "=", "mt", ".", "get", "(", "0", ")", ".", "getQuorumCfgSection", "(", ");", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "sb", ".", "append", "(", "quorumCfgSection", ")", ";", "int", "myid", "=", "mt", ".", "size", "(", ")", "+", "1", ";", "final", "int", "clientPort", "=", "PortAssignment", ".", "unique", "(", ");", "String", "server", "=", "String", ".", "format", "(", "\"", "server", ".", "%", "d", "=", "localhost", ":", "%", "d", ":", "%", "d", ":", "participant", "\"", ",", "myid", ",", "PortAssignment", ".", "unique", "(", "),", "PortAssignment", ".", "unique", "(", "))", ";", "sb", ".", "append", "(", "server", "+", "\"", "\\", "n", "\"", ");", "quorumCfgSection", "=", "sb", ".", "toString", "(", ");", "authConfigs", ".", "put", "(", "QuorumAuth", ".", "QUORUM_LEARNER_SASL_LOGIN_CONTEXT", ",", "\"", "QuorumLearnerMyHost", "\"", ");", "MainThread", "badServer", "=", "new", "MainThread", "(", "myid", ",", "clientPort", ",", "quorumCfgSection", ",", "authConfigs", ")", ";", "badServer", ".", "start", "(", ");", "watcher", "=", "new", "CountdownWatcher", "(", ");", "connectStr", "=", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "\"", "+", "clientPort", ";", "zk", "=", "new", "ZooKeeper", "(", "connectStr", ",", "ClientBase", ".", "CONNECTION_TIMEOUT", ",", "watcher", ")", ";", "try", "{", "watcher", ".", "waitForConnected", "(", "ClientBase", ".", "CONNECTION_TIMEOUT", "/", "3", ")", ";", "Assert", ".", "fail", "(", "\"", "Must", "throw", "exception", "as", "the", "myHost", "is", "not", "an", "authorized", "one", "!", "\")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "/", "/", "expected", "}", "finally", "{", "zk", ".", "close", "(", ");", "badServer", ".", "shutdown", "(", ");", "badServer", ".", "deleteBaseDir", "(", ");", "}", "}", "}", "@", "@", "-", "110", ",", "7", "+", "110", ",", "7", "@", "@", "ByteBuffer", "createMsg", "(", "int", "state", ",", "long", "leader", ",", "long", "zxid", ",", "long", "epoch", ")", "{", "public", "void", "run", "(", "){", "try", "{", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "peerTmpdir", "[", "0", "]", ",", "peerTmpdir", "[", "0", "]", ",", "peerClientPort", "[", "0", "]", ",", "3", ",", "0", ",", "1000", ",", "2", ",", "2", ")", ";", "QuorumCnxManager", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "QuorumCnxManager", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "cnxManager", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "@", "@", "-", "154", ",", "7", "+", "154", ",", "7", "@", "@", "public", "void", "testCnxManager", "(", ")", "throws", "Exception", "{", "thread", ".", "start", "(", ");", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "peerTmpdir", "[", "1", "]", ",", "peerTmpdir", "[", "1", "]", ",", "peerClientPort", "[", "1", "]", ",", "3", ",", "1", ",", "1000", ",", "2", ",", "2", ")", ";", "QuorumCnxManager", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "QuorumCnxManager", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "cnxManager", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "@", "@", "-", "201", ",", "7", "+", "201", ",", "7", "@", "@", "public", "void", "testCnxManagerTimeout", "(", ")", "throws", "Exception", "{", "peerTmpdir", "[", "2", "]", "=", "ClientBase", ".", "createTmpDir", "(", ");", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "peerTmpdir", "[", "1", "]", ",", "peerTmpdir", "[", "1", "]", ",", "peerClientPort", "[", "1", "]", ",", "3", ",", "1", ",", "1000", ",", "2", ",", "2", ")", ";", "QuorumCnxManager", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "QuorumCnxManager", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "cnxManager", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "@", "@", "-", "229", ",", "7", "+", "229", ",", "7", "@", "@", "public", "void", "testCnxManagerTimeout", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testCnxManagerSpinLock", "(", ")", "throws", "Exception", "{", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "peerTmpdir", "[", "1", "]", ",", "peerTmpdir", "[", "1", "]", ",", "peerClientPort", "[", "1", "]", ",", "3", ",", "1", ",", "1000", ",", "2", ",", "2", ")", ";", "QuorumCnxManager", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "QuorumCnxManager", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "cnxManager", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "@", "@", "-", "294", ",", "7", "+", "294", ",", "7", "@", "@", "public", "void", "testCnxManagerNPE", "(", ")", "throws", "Exception", "{", "peers", ".", "get", "(", "2L", ")", ".", "type", "=", "LearnerType", ".", "OBSERVER", ";", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "peerTmpdir", "[", "1", "]", ",", "peerTmpdir", "[", "1", "]", ",", "peerClientPort", "[", "1", "]", ",", "3", ",", "1", ",", "1000", ",", "2", ",", "2", ")", ";", "QuorumCnxManager", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "QuorumCnxManager", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "cnxManager", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "@", "@", "-", "341", ",", "7", "+", "341", ",", "7", "@", "@", "public", "void", "testCnxManagerNPE", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testSocketTimeout", "(", ")", "throws", "Exception", "{", "QuorumPeer", "peer", "=", "new", "QuorumPeer", "(", "peers", ",", "peerTmpdir", "[", "1", "]", ",", "peerTmpdir", "[", "1", "]", ",", "peerClientPort", "[", "1", "]", ",", "3", ",", "1", ",", "2000", ",", "2", ",", "2", ")", ";", "QuorumCnxManager", "cnxManager", "=", "new", "QuorumCnxManager", "(", "peer", ")", ";", "QuorumCnxManager", "cnxManager", "=", "peer", ".", "createCnxnManager", "(", ");", "QuorumCnxManager", ".", "Listener", "listener", "=", "cnxManager", ".", "listener", ";", "if", "(", "listener", "!", "=", "null", ")", "{", "listener", ".", "start", "(", ");", "@", "@", "-", "41", ",", "7", "+", "41", ",", "7", "@", "@", "class", "MockFLE", "extends", "FastLeaderElection", "{", "MockFLE", "(", "QuorumPeer", "peer", ")", "{", "super", "(", "peer", ",", "new", "QuorumCnxManager", "(", "peer", ")", ");", "super", "(", "peer", ",", "peer", ".", "createCnxnManager", "(", "))", ";", "}", "boolean", "predicate", "(", "long", "newId", ",", "long", "newZxid", ",", "long", "newEpoch", ",", "long", "curId", ",", "long", "curZxid", ",", "long", "curEpoch", ")", "{", "@", "@", "-", "236", ",", "6", "+", "236", ",", "11", "@", "@", "module", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "quorum", "{", "buffer", "data", ";", "/", "/", "Only", "significant", "when", "type", "is", "request", "vector", "<", "org", ".", "apache", ".", "zookeeper", ".", "data", ".", "Id", ">", "authinfo", ";", "}", "class", "QuorumAuthPacket", "{", "long", "magic", ";", "int", "status", ";", "buffer", "token", ";", "}", "}", "module", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "persistence", "{"], "docstring_tokens": ["join", "the", "cluster", "and", "begin", "propagating", "counterfeit", "changes", "to", "the", "leader"]}
{"contents": ["KVM:", "VMX:", "Do", "not", "BUG()", "on", "out-of-bounds", "guest", "IRQ", "The", "value", "of", "the", "guest_irq", "argument", "to", "vmx_update_pi_irte()", "is", "ultimately", "coming", "from", "a", "KVM_IRQFD", "API", "call.", "Do", "not", "BUG()", "in", "vmx_update_pi_irte()", "if", "the", "value", "is", "out-of", "bounds.", "(Especially,", "since", "KVM", "as", "a", "whole", "seems", "to", "hang", "after", "that.)", "Instead,", "print", "a", "message", "only", "once", "if", "we", "find", "that", "we", "don't", "have", "a", "route", "for", "a", "certain", "IRQ", "(which", "can", "be", "out-of-bounds", "or", "within", "the", "array).", "This", "fixes", ".", "Fixes:", "efc644048ecde54", "(\"KVM:", "x86:", "Update", "IRTE", "for", "posted-interrupts\")", "Signed-off-by:", "Jan", "H.", "Sch\u00f6nherr", "<jschoenh@amazon.de>", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["@", "@", "-", "11834", ",", "7", "+", "11834", ",", "7", "@", "@", "static", "int", "vmx_update_pi_irte", "(", "struct", "kvm", "*", "kvm", ",", "unsigned", "int", "host_irq", ",", "struct", "kvm_lapic_irq", "irq", ";", "struct", "kvm_vcpu", "*", "vcpu", ";", "struct", "vcpu_data", "vcpu_info", ";", "int", "idx", ",", "ret", "=", "-", "EINVAL", ";", "int", "idx", ",", "ret", "=", "0", ";", "if", "(", "!", "kvm_arch_has_assigned_device", "(", "kvm", ")", "|", "|", "!", "irq_remapping_cap", "(", "IRQ_POSTING_CAP", ")", "|", "|", "@", "@", "-", "11843", ",", "7", "+", "11843", ",", "12", "@", "@", "static", "int", "vmx_update_pi_irte", "(", "struct", "kvm", "*", "kvm", ",", "unsigned", "int", "host_irq", ",", "idx", "=", "srcu_read_lock", "(", "&", "kvm", "-", ">", "irq_srcu", ")", ";", "irq_rt", "=", "srcu_dereference", "(", "kvm", "-", ">", "irq_routing", ",", "&", "kvm", "-", ">", "irq_srcu", ")", ";", "BUG_ON", "(", "guest_irq", ">", "=", "irq_rt", "-", ">", "nr_rt_entries", ")", ";", "if", "(", "guest_irq", ">", "=", "irq_rt", "-", ">", "nr_rt_entries", "|", "|", "hlist_empty", "(", "&", "irq_rt", "-", ">", "map", "[", "guest_irq", "]", "))", "{", "pr_warn_once", "(", "\"", "no", "route", "for", "guest_irq", "%", "u", "/", "%", "u", "(", "broken", "user", "space", "?", ")\\", "n", "\"", ",", "guest_irq", ",", "irq_rt", "-", ">", "nr_rt_entries", ")", ";", "goto", "out", ";", "}", "hlist_for_each_entry", "(", "e", ",", "&", "irq_rt", "-", ">", "map", "[", "guest_irq", "]", ",", "link", ")", "{", "if", "(", "e", "-", ">", "type", "!", "=", "KVM_IRQ_ROUTING_MSI", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(assertion", "failure"]}
{"contents": ["Use", "format", "string"], "code_tokens": ["@", "@", "-", "218", ",", "7", "+", "218", ",", "7", "@", "@", "static", "void", "zend_throw_or_error", "(", "int", "fetch_type", ",", "zend_class_entry", "*", "exception_ce", ",", "zend_vspprintf", "(", "&", "message", ",", "0", ",", "format", ",", "va", ")", ";", "if", "(", "fetch_type", "&", "ZEND_FETCH_CLASS_EXCEPTION", ")", "{", "zend_throw_error", "(", "exception_ce", ",", "message", ")", ";", "zend_throw_error", "(", "exception_ce", ",", "\"", "%", "s", "\"", ",", "message", ")", ";", "}", "else", "{", "zend_error", "(", "E_ERROR", ",", "\"", "%", "s", "\"", ",", "message", ")", ";", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["Fix", "bug", "#69453", "-", "don't", "try", "to", "cut", "empty", "string"], "code_tokens": ["@", "@", "-", "425", ",", "7", "+", "425", ",", "7", "@", "@", "int", "phar_parse_tarfile", "(", "php_stream", "*", "fp", ",", "char", "*", "fname", ",", "int", "fname_len", ",", "char", "*", "alias", ",", "entry", ".", "filename_len", "=", "i", ";", "entry", ".", "filename", "=", "pestrndup", "(", "hdr", "-", ">", "name", ",", "i", ",", "myphar", "-", ">", "is_persistent", ")", ";", "if", "(", "entry", ".", "filename", "[", "entry", ".", "filename_len", "-", "1", "]", "=", "=", "'", "/'", ")", "{", "if", "(", "i", ">", "0", "&", "&", "entry", ".", "filename", "[", "entry", ".", "filename_len", "-", "1", "]", "=", "=", "'", "/'", ")", "{", "/", "*", "some", "tar", "programs", "store", "directories", "with", "trailing", "slash", "*", "/", "entry", ".", "filename", "[", "entry", ".", "filename_len", "-", "1", "]", "=", "'", "\\", "0", "'", ";", "entry", ".", "filename_len", "-", "-;", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "-", "-", "TEST", "-", "-", "Phar", ":", "bug", "#", "69453", ":", "Memory", "Corruption", "in", "phar_parse_tarfile", "when", "entry", "filename", "starts", "with", "null", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "phar", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "fname", "=", "dirname", "(", "__FILE__", ")", ".", "'", "/", "bug69453", ".", "tar", ".", "phar", "'", ";", "try", "{", "$", "r", "=", "new", "Phar", "(", "$", "fname", ",", "0", ")", ";", "}", "catch", "(", "UnexpectedValueException", "$", "e", ")", "{", "echo", "$", "e", ";", "}", "?", ">", "=", "=", "DONE", "=", "=", "-", "-", "EXPECTF", "-", "-", "exception", "'", "UnexpectedValueException", "'", "with", "message", "'", "phar", "error", ":", "\"", "%", "s", "/", "bug69453", ".", "tar", ".", "phar", "\"", "is", "a", "corrupted", "tar", "file", "(", "checksum", "mismatch", "of", "file", "\"", "\")", "'", "in", "%", "s", ":", "%", "d", "Stack", "trace", ":", "#", "0", "%", "s", "/", "bug69453", ".", "php", "(", "%", "d", ")", ":", "Phar", "-", ">", "__construct", "(", "'%", "s", "'", ",", "0", ")", "#", "1", "{", "main", "}", "=", "=", "DONE", "=", "=", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(integer", "underflow", "and", "memory", "corruption", ")"]}
{"contents": ["media:", "em28xx:", "Fix", "use-after-free", "when", "disconnecting", "Fix", "bug", "by", "moving", "the", "i2c_unregister_device", "calls", "after", "deregistration", "of", "dvb", "frontend.", "The", "new", "style", "i2c", "drivers", "already", "destroys", "the", "frontend", "object", "at", "i2c_unregister_device", "time.", "When", "the", "dvb", "frontend", "is", "unregistered", "afterwards", "it", "leads", "to", "this", "oops:", "[", "6058.866459]", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "00000000000001f8", "[", "6058.866578]", "IP:", "dvb_frontend_stop+0x30/0xd0", "[dvb_core]", "[", "6058.866644]", "PGD", "0", "[", "6058.866646]", "P4D", "0", "[", "6058.866726]", "Oops:", "0000", "[#1]", "SMP", "[", "6058.866768]", "Modules", "linked", "in:", "rc_pinnacle_pctv_hd(O)", "em28xx_rc(O)", "si2157(O)", "si2168(O)", "em28xx_dvb(O)", "em28xx(O)", "si2165(O)", "a8293(O)", "tda10071(O)", "tea5767(O)", "tuner(O)", "cx23885(O)", "tda18271(O)", "videobuf2_dvb(O)", "videobuf2_dma_sg(O)", "m88ds3103(O)", "tveeprom(O)", "cx2341x(O)", "v4l2_common(O)", "dvb_core(O)", "rc_core(O)", "videobuf2_memops(O)", "videobuf2_v4l2(O)", "videobuf2_core(O)", "videodev(O)", "media(O)", "bluetooth", "ecdh_generic", "ums_realtek", "uas", "rtl8192cu", "rtl_usb", "rtl8192c_common", "rtlwifi", "usb_storage", "snd_hda_codec_realtek", "snd_hda_codec_hdmi", "snd_hda_codec_generic", "i2c_mux", "snd_hda_intel", "snd_hda_codec", "snd_hwdep", "x86_pkg_temp_thermal", "snd_hda_core", "kvm_intel", "kvm", "irqbypass", "[last", "unloaded:", "videobuf2_memops]", "[", "6058.867497]", "CPU:", "2", "PID:", "7349", "Comm:", "kworker/2:0", "Tainted:", "G", "W", "O", "4.13.9-gentoo", "#1", "[", "6058.867595]", "Hardware", "name:", "MEDION", "E2050", "2391/H81H3-EM2,", "BIOS", "H81EM2W08.308", "08/25/2014", "[", "6058.867692]", "Workqueue:", "usb_hub_wq", "hub_event", "[", "6058.867746]", "task:", "ffff88011a15e040", "task.stack:", "ffffc90003074000", "[", "6058.867825]", "RIP:", "0010:dvb_frontend_stop+0x30/0xd0", "[dvb_core]", "[", "6058.867896]", "RSP:", "0018:ffffc90003077b58", "EFLAGS:", "00010293", "[", "6058.867964]", "RAX:", "0000000000000000", "RBX:", "0000000000000000", "RCX:", "000000010040001f", "[", "6058.868056]", "RDX:", "ffff88011a15e040", "RSI:", "ffffea000464e400", "RDI:", "ffff88001cbe3028", "[", "6058.868150]", "RBP:", "ffffc90003077b68", "R08:", "ffff880119390380", "R09:", "000000010040001f", "[", "6058.868241]", "R10:", "ffffc90003077b18", "R11:", "000000000001e200", "R12:", "ffff88001cbe3028", "[", "6058.868330]", "R13:", "ffff88001cbe68d0", "R14:", "ffff8800cf734000", "R15:", "ffff8800cf734098", "[", "6058.868419]", "FS:", "0000000000000000(0000)", "GS:ffff88011fb00000(0000)", "knlGS:0000000000000000", "[", "6058.868511]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "6058.868578]", "CR2:", "00000000000001f8", "CR3:", "00000001113c5000", "CR4:", "00000000001406e0", "[", "6058.868662]", "Call", "Trace:", "[", "6058.868705]", "dvb_unregister_frontend+0x2a/0x80", "[dvb_core]", "[", "6058.868774]", "em28xx_dvb_fini+0x132/0x220", "[em28xx_dvb]", "[", "6058.868840]", "em28xx_close_extension+0x34/0x90", "[em28xx]", "[", "6058.868902]", "em28xx_usb_disconnect+0x4e/0x70", "[em28xx]", "[", "6058.868968]", "usb_unbind_interface+0x6d/0x260", "[", "6058.869025]", "device_release_driver_internal+0x150/0x210", "[", "6058.869094]", "device_release_driver+0xd/0x10", "[", "6058.869150]", "bus_remove_device+0xe4/0x160", "[", "6058.869204]", "device_del+0x1ce/0x2f0", "[", "6058.869253]", "usb_disable_device+0x99/0x270", "[", "6058.869306]", "usb_disconnect+0x8d/0x260", "[", "6058.869359]", "hub_event+0x93d/0x1520", "[", "6058.869408]", "?", "dequeue_task_fair+0xae5/0xd20", "[", "6058.869467]", "process_one_work+0x1d9/0x3e0", "[", "6058.869522]", "worker_thread+0x43/0x3e0", "[", "6058.869576]", "kthread+0x104/0x140", "[", "6058.869602]", "?", "trace_event_raw_event_workqueue_work+0x80/0x80", "[", "6058.869640]", "?", "kthread_create_on_node+0x40/0x40", "[", "6058.869673]", "ret_from_fork+0x22/0x30", "[", "6058.869698]", "Code:", "54", "49", "89", "fc", "53", "48", "8b", "9f", "18", "03", "00", "00", "0f", "1f", "44", "00", "00", "41", "83", "bc", "24", "04", "05", "00", "00", "02", "74", "0c", "41", "c7", "84", "24", "04", "05", "00", "00", "01", "00", "00", "00", "0f", "ae", "f0", "<48>", "8b", "bb", "f8", "01", "00", "00", "48", "85", "ff", "74", "5c", "e8", "df", "40", "f0", "e0", "48", "8b", "93", "f8", "[", "6058.869850]", "RIP:", "dvb_frontend_stop+0x30/0xd0", "[dvb_core]", "RSP:", "ffffc90003077b58", "[", "6058.869894]", "CR2:", "00000000000001f8", "[", "6058.875880]", "---[", "end", "trace", "717eecf7193b3fc6", "]---", "Signed-off-by:", "Matthias", "Schwarzott", "<zzam@gentoo.org>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@s-opensource.com>"], "code_tokens": ["@", "@", "-", "2105", ",", "6", "+", "2105", ",", "8", "@", "@", "static", "int", "em28xx_dvb_fini", "(", "struct", "em28xx", "*", "dev", ")", "}", "}", "em28xx_unregister_dvb", "(", "dvb", ")", ";", "/", "*", "remove", "I2C", "SEC", "*", "/", "client", "=", "dvb", "-", ">", "i2c_client_sec", ";", "if", "(", "client", ")", "{", "@", "@", "-", "2126", ",", "7", "+", "2128", ",", "6", "@", "@", "static", "int", "em28xx_dvb_fini", "(", "struct", "em28xx", "*", "dev", ")", "i2c_unregister_device", "(", "client", ")", ";", "}", "em28xx_unregister_dvb", "(", "dvb", ")", ";", "kfree", "(", "dvb", ")", ";", "dev", "-", ">", "dvb", "=", "NULL", ";", "kref_put", "(", "&", "dev", "-", ">", "ref", ",", "em28xx_free_device", ")", ";"], "docstring_tokens": ["execute", "arbitrary", "code", "within", "the", "context", "of", "a", "privileged", "process"]}
{"contents": ["CAMEL-10894:", "Improve", "test", "fix"], "code_tokens": ["@", "@", "-", "173", ",", "7", "+", "173", ",", "7", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "if", "(", "getResourceResolver", "(", ")", "!", "=", "null", ")", "{", "factory", ".", "setResourceResolver", "(", "getResourceResolver", "(", "))", ";", "}", "if", "(", "camelContext", "!", "=", "null", "&", "&", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "if", "(", "camelContext", "=", "=", "null", "|", "|", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{"], "docstring_tokens": ["read", "arbitrary", "files"]}
{"contents": ["ptrace,x86:", "force", "IRET", "path", "after", "a", "ptrace_stop()", "The", "'sysret'", "fastpath", "does", "not", "correctly", "restore", "even", "all", "regular", "registers,", "much", "less", "any", "segment", "registers", "or", "reflags", "values.", "That", "is", "very", "much", "part", "of", "why", "it's", "faster", "than", "'iret'.", "Normally", "that", "isn't", "a", "problem,", "because", "the", "normal", "ptrace()", "interface", "catches", "the", "process", "using", "the", "signal", "handler", "infrastructure,", "which", "always", "returns", "with", "an", "iret.", "However,", "some", "paths", "can", "get", "caught", "using", "ptrace_event()", "instead", "of", "the", "signal", "path,", "and", "for", "those", "we", "need", "to", "make", "sure", "that", "we", "aren't", "going", "to", "return", "to", "user", "space", "using", "'sysret'.", "Otherwise", "the", "modifications", "that", "may", "have", "been", "done", "to", "the", "register", "set", "by", "the", "tracer", "wouldn't", "necessarily", "take", "effect.", "Fix", "it", "by", "forcing", "IRET", "path", "by", "setting", "TIF_NOTIFY_RESUME", "from", "arch_ptrace_stop_needed()", "which", "is", "invoked", "from", "ptrace_stop().", "Signed-off-by:", "Tejun", "Heo", "<tj@kernel.org>", "Reported-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Acked-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Suggested-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "231", ",", "6", "+", "231", ",", "22", "@", "@", "static", "inline", "unsigned", "long", "regs_get_kernel_stack_nth", "(", "struct", "pt_regs", "*", "regs", ",", "#", "define", "ARCH_HAS_USER_SINGLE_STEP_INFO", "/", "*", "*", "When", "hitting", "ptrace_stop", "(", "),", "we", "cannot", "return", "using", "SYSRET", "because", "*", "that", "does", "not", "restore", "the", "full", "CPU", "state", ",", "only", "a", "minimal", "set", ".", "The", "*", "ptracer", "can", "change", "arbitrary", "register", "values", ",", "which", "is", "usually", "okay", "*", "because", "the", "usual", "ptrace", "stops", "run", "off", "the", "signal", "delivery", "path", "which", "*", "forces", "IRET", ";", "however", ",", "ptrace_event", "(", ")", "stops", "happen", "in", "arbitrary", "places", "*", "in", "the", "kernel", "and", "don", "'", "t", "force", "IRET", "path", ".", "*", "*", "So", "force", "IRET", "path", "after", "a", "ptrace", "stop", ".", "*", "/", "#", "define", "arch_ptrace_stop_needed", "(", "code", ",", "info", ")", "\\", "(", "{", "\\", "set_thread_flag", "(", "TIF_NOTIFY_RESUME", ")", ";", "\\", "false", ";", "\\", "}", ")", "struct", "user_desc", ";", "extern", "int", "do_get_thread_area", "(", "struct", "task_struct", "*", "p", ",", "int", "idx", ",", "struct", "user_desc", "__user", "*", "info", ")", ";", "@", "@", "-", "334", ",", "6", "+", "334", ",", "9", "@", "@", "static", "inline", "void", "user_single_step_siginfo", "(", "struct", "task_struct", "*", "tsk", ",", "*", "calling", "arch_ptrace_stop", "(", ")", "when", "it", "would", "be", "superfluous", ".", "For", "example", ",", "*", "if", "the", "thread", "has", "not", "been", "back", "to", "user", "mode", "since", "the", "last", "stop", ",", "the", "*", "thread", "state", "might", "indicate", "that", "nothing", "needs", "to", "be", "done", ".", "*", "*", "This", "is", "guaranteed", "to", "be", "invoked", "once", "before", "a", "task", "stops", "for", "ptrace", "and", "*", "may", "include", "arch", "-", "specific", "operations", "necessary", "prior", "to", "a", "ptrace", "stop", ".", "*", "/", "#", "define", "arch_ptrace_stop_needed", "(", "code", ",", "info", ")", "(", "0", ")", "#", "endif"], "docstring_tokens": ["and", "user", "code", "can", "attempt", "to", "race", "with", "the", "kernel", "to", "take", "over", "the", "system"]}
{"contents": ["CAMEL-12444:", "Improved", "DTD", "handling", "in", "validator", "component."], "code_tokens": ["@", "@", "-", "175", ",", "6", "+", "175", ",", "7", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "}", "if", "(", "camelContext", "=", "=", "null", "|", "|", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getGlobalOptions", "(", ").", "get", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "Configuring", "SchemaFactory", "to", "not", "allow", "access", "to", "external", "DTD", "/", "Schema", "\"", ");", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "LOG", ".", "warn", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "@", "@", "-", "53", ",", "6", "+", "54", ",", "8", "@", "@", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "processor", ".", "validation", ".", "SchemaReader", ".", "ACCESS_EXTERNAL_DTD", ";", "/", "**", "*", "A", "processor", "which", "validates", "the", "XML", "version", "of", "the", "inbound", "message", "body", "*", "against", "some", "schema", "either", "in", "XSD", "or", "RelaxNG", "@", "@", "-", "100", ",", "6", "+", "103", ",", "16", "@", "@", "protected", "void", "doProcess", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "}", "Validator", "validator", "=", "schema", ".", "newValidator", "(", ");", "/", "/", "turn", "off", "access", "to", "external", "schema", "by", "default", "if", "(", "!", "Boolean", ".", "parseBoolean", "(", "exchange", ".", "getContext", "(", ").", "getGlobalOptions", "(", ").", "get", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "Configuring", "Validator", "to", "not", "allow", "access", "to", "external", "DTD", "/", "Schema", "\"", ");", "validator", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "validator", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "LOG", ".", "warn", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "}", "/", "/", "the", "underlying", "input", "stream", ",", "which", "we", "need", "to", "close", "to", "avoid", "locking", "files", "or", "other", "resources", "Source", "source", "=", "null", ";"], "docstring_tokens": ["read", "arbitrary", "files"]}
{"contents": ["Fix", "identity", "zone", "docs", "to", "cater", "for", "new", "requirement", "when", "creating/updating", "a", "zone", "(now", "requires", "a", "signing", "key", "to", "be", "set)", "[#157377568]", "https://www.pivotaltracker.com/story/show/157377568", "Signed-off-by:", "Bruce", "Ricard", "<bruce.ricard@gmail.com>"], "code_tokens": ["@", "@", "-", "10", ",", "6", "+", "10", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneSwitchingFilter", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "JdbcIdentityZoneProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "SamlConfig", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "TokenPolicy", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ";", "@", "@", "-", "19", ",", "6", "+", "20", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "192", ",", "6", "+", "194", ",", "10", "@", "@", "public", "void", "createIdentityZone", "(", ")", "throws", "Exception", "{", "samlConfig", ".", "setEntityID", "(", "SERVICE_PROVIDER_ID", ")", ";", "identityZone", ".", "getConfig", "(", ").", "setIssuer", "(", "DEFAULT_ISSUER_URI", ")", ";", "identityZone", ".", "getConfig", "(", ").", "setSamlConfig", "(", "samlConfig", ")", ";", "TokenPolicy", "tokenPolicy", "=", "new", "TokenPolicy", "(", "3600", ",", "7200", ")", ";", "tokenPolicy", ".", "setActiveKeyId", "(", "\"", "active", "-", "key", "-", "1", "\"", ");", "tokenPolicy", ".", "setKeys", "(", "new", "HashMap", "<", ">(", "Collections", ".", "singletonMap", "(", "\"", "active", "-", "key", "-", "1", "\"", ",", "\"", "key", "\"", "))", ");", "identityZone", ".", "getConfig", "(", ").", "setTokenPolicy", "(", "tokenPolicy", ")", ";", "IdentityZoneConfiguration", "brandingConfig", "=", "setBranding", "(", "identityZone", ".", "getConfig", "(", "))", ";", "identityZone", ".", "setConfig", "(", "brandingConfig", ")", ";", "FieldDescriptor", "[", "]", "fieldDescriptors", "=", "{", "@", "@", "-", "482", ",", "6", "+", "488", ",", "7", "@", "@", "public", "void", "updateIdentityZone", "(", ")", "throws", "Exception", "{", "updatedIdentityZone", ".", "setDescription", "(", "\"", "Like", "the", "Twilight", "Zone", "but", "not", "tastier", ".", "\")", ";", "Map", "<", "String", ",", "String", ">", "keys", "=", "new", "HashMap", "<", ">(", ");", "keys", ".", "put", "(", "\"", "updatedKeyId", "\"", ",", "\"", "upD4t3d", ".", "s1gNiNg", ".", "K3y", "/", "t3XT", "\"", ");", "updatedIdentityZone", ".", "getConfig", "(", ").", "getTokenPolicy", "(", ").", "setActiveKeyId", "(", "\"", "updatedKeyId", "\"", ");", "updatedIdentityZone", ".", "getConfig", "(", ").", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "SamlConfig", "samlConfig", "=", "new", "SamlConfig", "(", ");", "samlConfig", ".", "setPrivateKey", "(", "SERVICE_PROVIDER_KEY", ")", ";", "@", "@", "-", "652", ",", "6", "+", "659", ",", "12", "@", "@", "private", "void", "createIdentityZoneHelper", "(", "String", "id", ")", "throws", "Exception", "{", "samlConfig", ".", "setEntityID", "(", "SERVICE_PROVIDER_ID", ")", ";", "identityZone", ".", "getConfig", "(", ").", "setSamlConfig", "(", "samlConfig", ")", ";", "identityZone", ".", "getConfig", "(", ").", "setIssuer", "(", "DEFAULT_ISSUER_URI", ")", ";", "TokenPolicy", "tokenPolicy", "=", "new", "TokenPolicy", "(", "3600", ",", "7200", ")", ";", "tokenPolicy", ".", "setActiveKeyId", "(", "\"", "active", "-", "key", "-", "1", "\"", ");", "tokenPolicy", ".", "setKeys", "(", "new", "HashMap", "<", ">(", "Collections", ".", "singletonMap", "(", "\"", "active", "-", "key", "-", "1", "\"", ",", "\"", "key", "\"", "))", ");", "identityZone", ".", "getConfig", "(", ").", "setTokenPolicy", "(", "tokenPolicy", ")", ";", "identityZone", ".", "setId", "(", "id", ")", ";", "identityZone", ".", "setSubdomain", "(", "StringUtils", ".", "hasText", "(", "id", ")", "?", "id", ":", "new", "RandomValueStringGenerator", "(", ").", "generate", "(", "))", ";", "identityZone", ".", "setName", "(", "\"", "The", "Twiglet", "Zone", "\"", ");"], "docstring_tokens": ["issue", "tokens", "which", "impersonate", "another", "zone"]}
{"contents": ["Export", "'get_pipe_info()'", "to", "other", "users", "And", "in", "particular,", "use", "it", "in", "'pipe_fcntl()'.", "The", "other", "pipe", "functions", "do", "not", "need", "to", "use", "the", "'careful'", "version,", "since", "they", "are", "only", "ever", "called", "for", "things", "that", "are", "already", "known", "to", "be", "pipes.", "The", "normal", "read/write/ioctl", "functions", "are", "called", "through", "the", "file", "operations", "structures,", "so", "if", "a", "file", "isn't", "a", "pipe,", "they'd", "never", "get", "called.", "But", "pipe_fcntl()", "is", "special,", "and", "called", "directly", "from", "the", "generic", "fcntl", "code,", "and", "needs", "to", "use", "the", "same", "careful", "function", "that", "the", "splice", "code", "is", "using.", "Cc:", "Jens", "Axboe", "<jaxboe@fusionio.com>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Cc:", "Dave", "Jones", "<davej@redhat.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "1204", ",", "7", "+", "1204", ",", "7", "@", "@", "long", "pipe_fcntl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "struct", "pipe_inode_info", "*", "pipe", ";", "long", "ret", ";", "pipe", "=", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", "-", ">", "i_pipe", ";", "pipe", "=", "get_pipe_info", "(", "file", ")", ";", "if", "(", "!", "pipe", ")", "return", "-", "EBADF", ";", "@", "@", "-", "1311", ",", "17", "+", "1311", ",", "6", "@", "@", "long", "do_splice_direct", "(", "struct", "file", "*", "in", ",", "loff_t", "*", "ppos", ",", "struct", "file", "*", "out", ",", "static", "int", "splice_pipe_to_pipe", "(", "struct", "pipe_inode_info", "*", "ipipe", ",", "struct", "pipe_inode_info", "*", "opipe", ",", "size_t", "len", ",", "unsigned", "int", "flags", ")", ";", "/", "*", "*", "After", "the", "inode", "slimming", "patch", ",", "i_pipe", "/", "i_bdev", "/", "i_cdev", "share", "the", "same", "*", "location", ",", "so", "checking", "-", ">", "i_pipe", "is", "not", "enough", "to", "verify", "that", "this", "is", "a", "*", "pipe", ".", "*", "/", "static", "inline", "struct", "pipe_inode_info", "*", "get_pipe_info", "(", "struct", "file", "*", "file", ")", "{", "struct", "inode", "*", "i", "=", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ";", "return", "S_ISFIFO", "(", "i", "-", ">", "i_mode", ")", "?", "i", "-", ">", "i_pipe", ":", "NULL", ";", "}", "/", "*", "*", "Determine", "where", "to", "splice", "to", "/", "from", ".", "@", "@", "-", "161", ",", "4", "+", "161", ",", "16", "@", "@", "void", "generic_pipe_buf_release", "(", "struct", "pipe_inode_info", "*", ",", "struct", "pipe_buffer", "*", ");", "/", "*", "for", "F_SETPIPE_SZ", "and", "F_GETPIPE_SZ", "*", "/", "long", "pipe_fcntl", "(", "struct", "file", "*", ",", "unsigned", "int", ",", "unsigned", "long", "arg", ")", ";", "/", "*", "*", "After", "the", "inode", "slimming", "patch", ",", "i_pipe", "/", "i_bdev", "/", "i_cdev", "share", "the", "same", "*", "location", ",", "so", "checking", "-", ">", "i_pipe", "is", "not", "enough", "to", "verify", "that", "this", "is", "a", "*", "pipe", ".", "*", "/", "static", "inline", "struct", "pipe_inode_info", "*", "get_pipe_info", "(", "struct", "file", "*", "file", ")", "{", "struct", "inode", "*", "i", "=", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ";", "return", "S_ISFIFO", "(", "i", "-", ">", "i_mode", ")", "?", "i", "-", ">", "i_pipe", ":", "NULL", ";", "}", "#", "endif"], "docstring_tokens": ["cause", "a", "denial", "of", "service"]}
{"contents": ["Remove", "unnecessary", "code", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1754901", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "14", ",", "7", "+", "14", ",", "6", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "jasper", ".", "runtime", ";", "import", "java", ".", "beans", ".", "PropertyEditor", ";", "@", "@", "-", "23", ",", "9", "+", "22", ",", "6", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStreamWriter", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedActionException", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "javax", ".", "servlet", ".", "RequestDispatcher", ";", "@", "@", "-", "37", ",", "7", "+", "33", ",", "6", "@", "@", "import", "javax", ".", "servlet", ".", "jsp", ".", "PageContext", ";", "import", "javax", ".", "servlet", ".", "jsp", ".", "tagext", ".", "BodyContent", ";", "import", "org", ".", "apache", ".", "jasper", ".", "Constants", ";", "import", "org", ".", "apache", ".", "jasper", ".", "JasperException", ";", "import", "org", ".", "apache", ".", "jasper", ".", "compiler", ".", "Localizer", ";", "import", "org", ".", "apache", ".", "jasper", ".", "util", ".", "ExceptionUtils", ";", "@", "@", "-", "56", ",", "36", "+", "51", ",", "6", "@", "@", "*", "/", "public", "class", "JspRuntimeLibrary", "{", "protected", "static", "class", "PrivilegedIntrospectHelper", "implements", "PrivilegedExceptionAction", "<", "Void", ">", "{", "private", "final", "Object", "bean", ";", "private", "final", "String", "prop", ";", "private", "final", "String", "value", ";", "private", "final", "ServletRequest", "request", ";", "private", "final", "String", "param", ";", "private", "final", "boolean", "ignoreMethodNF", ";", "PrivilegedIntrospectHelper", "(", "Object", "bean", ",", "String", "prop", ",", "String", "value", ",", "ServletRequest", "request", ",", "String", "param", ",", "boolean", "ignoreMethodNF", ")", "{", "this", ".", "bean", "=", "bean", ";", "this", ".", "prop", "=", "prop", ";", "this", ".", "value", "=", "value", ";", "this", ".", "request", "=", "request", ";", "this", ".", "param", "=", "param", ";", "this", ".", "ignoreMethodNF", "=", "ignoreMethodNF", ";", "}", "@", "Override", "public", "Void", "run", "(", ")", "throws", "JasperException", "{", "internalIntrospecthelper", "(", "bean", ",", "prop", ",", "value", ",", "request", ",", "param", ",", "ignoreMethodNF", ")", ";", "return", "null", ";", "}", "}", "/", "**", "*", "Returns", "the", "value", "of", "the", "javax", ".", "servlet", ".", "error", ".", "exception", "request", "*", "attribute", "value", ",", "if", "present", ",", "otherwise", "the", "value", "of", "the", "@", "@", "-", "292", ",", "29", "+", "257", ",", "7", "@", "@", "public", "static", "void", "introspect", "(", "Object", "bean", ",", "ServletRequest", "request", ")", "public", "static", "void", "introspecthelper", "(", "Object", "bean", ",", "String", "prop", ",", "String", "value", ",", "ServletRequest", "request", ",", "String", "param", ",", "boolean", "ignoreMethodNF", ")", "throws", "JasperException", "{", "if", "(", "Constants", ".", "IS_SECURITY_ENABLED", ")", "{", "try", "{", "PrivilegedIntrospectHelper", "dp", "=", "new", "PrivilegedIntrospectHelper", "(", "bean", ",", "prop", ",", "value", ",", "request", ",", "param", ",", "ignoreMethodNF", ")", ";", "AccessController", ".", "doPrivileged", "(", "dp", ")", ";", "}", "catch", "(", "PrivilegedActionException", "pe", ")", "{", "Exception", "e", "=", "pe", ".", "getException", "(", ");", "throw", "(", "JasperException", ")", "e", ";", "}", "}", "else", "{", "internalIntrospecthelper", "(", "bean", ",", "prop", ",", "value", ",", "request", ",", "param", ",", "ignoreMethodNF", ")", ";", "}", "}", "private", "static", "void", "internalIntrospecthelper", "(", "Object", "bean", ",", "String", "prop", ",", "String", "value", ",", "ServletRequest", "request", ",", "String", "param", ",", "boolean", "ignoreMethodNF", ")", "throws", "JasperException", "{", "throws", "JasperException", "{", "Method", "method", "=", "null", ";", "Class", "<", "?>", "type", "=", "null", ";", "Class", "<", "?>", "propertyEditorClass", "=", "null", ";"], "docstring_tokens": ["bypass", "a", "configured", "SecurityManager"]}
{"contents": ["fix:", "restrict", "sendToFrame", "to", "same-process", "frames", "by", "default", "(#26875)"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "#", "IpcMainEvent", "Object", "extends", "`", "Event", "`", "*", "`", "processId", "`", "Integer", "-", "The", "internal", "ID", "of", "the", "renderer", "process", "that", "sent", "this", "message", "*", "`", "frameId", "`", "Integer", "-", "The", "ID", "of", "the", "renderer", "frame", "that", "sent", "this", "message", "*", "`", "returnValue", "`", "any", "-", "Set", "this", "to", "the", "value", "to", "be", "returned", "in", "a", "synchronous", "message", "*", "`", "sender", "`", "WebContents", "-", "Returns", "the", "`", "webContents", "`", "that", "sent", "the", "message", "@", "@", "-", "1", ",", "4", "+", "1", ",", "5", "@", "@", "#", "IpcMainInvokeEvent", "Object", "extends", "`", "Event", "`", "*", "`", "processId", "`", "Integer", "-", "The", "internal", "ID", "of", "the", "renderer", "process", "that", "sent", "this", "message", "*", "`", "frameId", "`", "Integer", "-", "The", "ID", "of", "the", "renderer", "frame", "that", "sent", "this", "message", "*", "`", "sender", "`", "WebContents", "-", "Returns", "the", "`", "webContents", "`", "that", "sent", "the", "message", "@", "@", "-", "1696", ",", "7", "+", "1696", ",", "7", "@", "@", "app", ".", "whenReady", "(", ").", "then", "(", "()", "=", ">", "{", "#", "##", "#", "`", "contents", ".", "sendToFrame", "(", "frameId", ",", "channel", ",", ".", "..", "args", ")", "`", "*", "`", "frameId", "`", "Integer", "*", "`", "frameId", "`", "Integer", "|", "[", "number", ",", "number", "]", "*", "`", "channel", "`", "String", "*", "`", "..", ".", "args", "`", "any", "[", "]", "@", "@", "-", "148", ",", "23", "+", "148", ",", "23", "@", "@", "WebContents", ".", "prototype", ".", "_sendInternal", "=", "function", "(", "channel", ",", ".", "..", "args", ")", "{", "return", "this", ".", "_send", "(", "true", "/", "*", "internal", "*", "/,", "channel", ",", "args", ")", ";", "}", ";", "WebContents", ".", "prototype", ".", "sendToFrame", "=", "function", "(", "frameId", ",", "channel", ",", ".", "..", "args", ")", "{", "WebContents", ".", "prototype", ".", "sendToFrame", "=", "function", "(", "frame", ",", "channel", ",", ".", "..", "args", ")", "{", "if", "(", "typeof", "channel", "!", "==", "'", "string", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "channel", "argument", "'", ");", "}", "else", "if", "(", "typeof", "frameId", "!", "==", "'", "number", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frameId", "argument", "'", ");", "}", "else", "if", "(", "!(", "typeof", "frame", "=", "==", "'", "number", "'", "|", "|", "Array", ".", "isArray", "(", "frame", ")", "))", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frame", "argument", "(", "must", "be", "number", "or", "array", ")", "')", ";", "}", "return", "this", ".", "_sendToFrame", "(", "false", "/", "*", "internal", "*", "/,", "frameId", ",", "channel", ",", "args", ")", ";", "return", "this", ".", "_sendToFrame", "(", "false", "/", "*", "internal", "*", "/,", "frame", ",", "channel", ",", "args", ")", ";", "}", ";", "WebContents", ".", "prototype", ".", "_sendToFrameInternal", "=", "function", "(", "frameId", ",", "channel", ",", ".", "..", "args", ")", "{", "WebContents", ".", "prototype", ".", "_sendToFrameInternal", "=", "function", "(", "frame", ",", "channel", ",", ".", "..", "args", ")", "{", "if", "(", "typeof", "channel", "!", "==", "'", "string", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "channel", "argument", "'", ");", "}", "else", "if", "(", "typeof", "frameId", "!", "==", "'", "number", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frameId", "argument", "'", ");", "}", "else", "if", "(", "!(", "typeof", "frame", "=", "==", "'", "number", "'", "|", "|", "Array", ".", "isArray", "(", "frame", ")", "))", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frame", "argument", "(", "must", "be", "number", "or", "array", ")", "')", ";", "}", "return", "this", ".", "_sendToFrame", "(", "true", "/", "*", "internal", "*", "/,", "frameId", ",", "channel", ",", "args", ")", ";", "return", "this", ".", "_sendToFrame", "(", "true", "/", "*", "internal", "*", "/,", "frame", ",", "channel", ",", "args", ")", ";", "}", ";", "/", "/", "Following", "methods", "are", "mapped", "to", "webFrame", ".", "@", "@", "-", "456", ",", "8", "+", "456", ",", "9", "@", "@", "WebContents", ".", "prototype", ".", "_callWindowOpenHandler", "=", "function", "(", "event", ":", "any", ",", "url", ":", "string", "}", ";", "const", "addReplyToEvent", "=", "(", "event", ":", "any", ")", "=", ">", "{", "const", "{", "processId", ",", "frameId", "}", "=", "event", ";", "event", ".", "reply", "=", "(", "..", ".", "args", ":", "any", "[", "])", "=", ">", "{", "event", ".", "sender", ".", "sendToFrame", "(", "event", ".", "frameId", ",", ".", "..", "args", ")", ";", "event", ".", "sender", ".", "sendToFrame", "(", "[", "processId", ",", "frameId", "]", ",", ".", "..", "args", ")", ";", "}", ";", "}", ";", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "const", "FUNCTION_PROPERTIES", "=", "[", "]", ";", "type", "RendererFunctionId", "=", "[", "string", ",", "number", "]", "/", "/", "[", "contextId", ",", "funcId", "]", "type", "FinalizerInfo", "=", "{", "id", ":", "RendererFunctionId", ",", "webContents", ":", "electron", ".", "WebContents", ",", "frameId", ":", "number", "}", ";", "type", "FinalizerInfo", "=", "{", "id", ":", "RendererFunctionId", ",", "webContents", ":", "electron", ".", "WebContents", ",", "frameId", ":", "[", "number", ",", "number", "]", "}", ";", "type", "CallIntoRenderer", "=", "(", "..", ".", "args", ":", "any", "[", "])", "=", ">", "void", "/", "/", "The", "remote", "functions", "in", "renderer", "processes", ".", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "function", "getCachedRendererFunction", "(", "id", ":", "RendererFunctionId", ")", ":", "CallIntoRenderer", "|", "if", "(", "deref", "!", "==", "undefined", ")", "return", "deref", ";", "}", "}", "function", "setCachedRendererFunction", "(", "id", ":", "RendererFunctionId", ",", "wc", ":", "electron", ".", "WebContents", ",", "frameId", ":", "number", ",", "value", ":", "CallIntoRenderer", ")", "{", "function", "setCachedRendererFunction", "(", "id", ":", "RendererFunctionId", ",", "wc", ":", "electron", ".", "WebContents", ",", "frameId", ":", "[", "number", ",", "number", "]", ",", "value", ":", "CallIntoRenderer", ")", "{", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "no", "-", "undef", "const", "wr", "=", "new", "WeakRef", "<", "CallIntoRenderer", ">", "(", "value", ")", ";", "const", "mapKey", "=", "id", "[", "0", "]", "+", "'", "~'", "+", "id", "[", "1", "]", ";", "@", "@", "-", "220", ",", "7", "+", "220", ",", "7", "@", "@", "const", "fakeConstructor", "=", "(", "constructor", ":", "Function", ",", "name", ":", "string", ")", "=", ">", "}", ");", "/", "/", "Convert", "array", "of", "meta", "data", "from", "renderer", "into", "array", "of", "real", "values", ".", "const", "unwrapArgs", "=", "function", "(", "sender", ":", "electron", ".", "WebContents", ",", "frameId", ":", "number", ",", "contextId", ":", "string", ",", "args", ":", "any", "[", "])", "{", "const", "unwrapArgs", "=", "function", "(", "sender", ":", "electron", ".", "WebContents", ",", "frameId", ":", "[", "number", ",", "number", "]", ",", "contextId", ":", "string", ",", "args", ":", "any", "[", "])", "{", "const", "metaToValue", "=", "function", "(", "meta", ":", "MetaTypeFromRenderer", ")", ":", "any", "{", "switch", "(", "meta", ".", "type", ")", "{", "case", "'", "nativeimage", "'", ":", "@", "@", "-", "423", ",", "7", "+", "423", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_GET_CURRENT_WEB_CONTENTS", ",", "function", "(", "eve", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_CONSTRUCTOR", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "constructor", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "constructor", "=", "=", "null", ")", "{", "@", "@", "-", "434", ",", "7", "+", "434", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_CONSTRUCTOR", ",", "function", "(", "event", ",", "contextId", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_FUNCTION_CALL", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "func", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "func", "=", "=", "null", ")", "{", "@", "@", "-", "451", ",", "7", "+", "451", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_FUNCTION_CALL", ",", "function", "(", "event", ",", "context", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CONSTRUCTOR", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "method", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "object", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "object", "=", "=", "null", ")", "{", "@", "@", "-", "462", ",", "7", "+", "462", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CONSTRUCTOR", ",", "function", "(", "event", ",", "co", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CALL", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "method", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "object", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "object", "=", "=", "null", ")", "{", "@", "@", "-", "479", ",", "7", "+", "479", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CALL", ",", "function", "(", "event", ",", "contextId", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_SET", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "name", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "obj", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "obj", "=", "=", "null", ")", "{", "@", "@", "-", "2708", ",", "7", "+", "2708", ",", "7", "@", "@", "bool", "WebContents", ":", ":", "SendIPCMessageWithSender", "(", "bool", "internal", ",", "}", "bool", "WebContents", ":", ":", "SendIPCMessageToFrame", "(", "bool", "internal", ",", "int32_t", "frame_id", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "frame", ",", "const", "std", ":", ":", "string", "&", "channel", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "args", ")", "{", "v8", ":", ":", "Isolate", "*", "isolate", "=", "JavascriptEnvironment", ":", ":", "GetIsolate", "(", ");", "@", "@", "-", "2718", ",", "17", "+", "2718", ",", "30", "@", "@", "bool", "WebContents", ":", ":", "SendIPCMessageToFrame", "(", "bool", "internal", ",", "gin", ":", ":", "StringToV8", "(", "isolate", ",", "\"", "Failed", "to", "serialize", "arguments", "\"", "))", ");", "return", "false", ";", "}", "auto", "frames", "=", "web_contents", "(", ")-", ">", "GetAllFrames", "(", ");", "auto", "iter", "=", "std", ":", ":", "find_if", "(", "frames", ".", "begin", "(", "),", "frames", ".", "end", "(", "),", "[", "frame_id", "]", "(", "auto", "*", "f", ")", "{", "return", "f", "-", ">", "GetRoutingID", "(", ")", "=", "=", "frame_id", ";", "}", ");", "if", "(", "iter", "=", "=", "frames", ".", "end", "(", "))", "return", "false", ";", "if", "(", "!(", "*", "iter", ")", "->", "IsRenderFrameLive", "(", "))", "int32_t", "frame_id", ";", "int32_t", "process_id", ";", "if", "(", "gin", ":", ":", "ConvertFromV8", "(", "isolate", ",", "frame", ",", "&", "frame_id", ")", ")", "{", "process_id", "=", "web_contents", "(", ")-", ">", "GetMainFrame", "(", ")-", ">", "GetProcess", "(", ")-", ">", "GetID", "(", ");", "}", "else", "{", "std", ":", ":", "vector", "<", "int32_t", ">", "id_pair", ";", "if", "(", "gin", ":", ":", "ConvertFromV8", "(", "isolate", ",", "frame", ",", "&", "id_pair", ")", "&", "&", "id_pair", ".", "size", "(", ")", "=", "=", "2", ")", "{", "process_id", "=", "id_pair", "[", "0", "]", ";", "frame_id", "=", "id_pair", "[", "1", "]", ";", "}", "else", "{", "isolate", "-", ">", "ThrowException", "(", "v8", ":", ":", "Exception", ":", ":", "Error", "(", "gin", ":", ":", "StringToV8", "(", "isolate", ",", "\"", "frameId", "must", "be", "a", "number", "or", "a", "pair", "of", "[", "processId", ",", "frameId", "]", "\")", "))", ";", "return", "false", ";", "}", "}", "auto", "*", "rfh", "=", "content", ":", ":", "RenderFrameHost", ":", ":", "FromID", "(", "process_id", ",", "frame_id", ")", ";", "if", "(", "!", "rfh", "|", "|", "!", "rfh", "-", ">", "IsRenderFrameLive", "(", ")", "|", "|", "content", ":", ":", "WebContents", ":", ":", "FromRenderFrameHost", "(", "rfh", ")", "!", "=", "web_contents", "(", "))", "return", "false", ";", "mojo", ":", ":", "AssociatedRemote", "<", "mojom", ":", ":", "ElectronRenderer", ">", "electron_renderer", ";", "(", "*", "iter", ")", "->", "GetRemoteAssociatedInterfaces", "(", ")-", ">", "GetInterface", "(", "&", "electron_renderer", ")", ";", "rfh", "-", ">", "GetRemoteAssociatedInterfaces", "(", ")-", ">", "GetInterface", "(", "&", "electron_renderer", ")", ";", "electron_renderer", "-", ">", "Message", "(", "internal", ",", "channel", ",", "std", ":", ":", "move", "(", "message", ")", ",", "0", "/", "*", "sender_id", "*", "/)", ";", "return", "true", ";", "@", "@", "-", "258", ",", "7", "+", "258", ",", "7", "@", "@", "class", "WebContents", ":", "public", "gin", ":", ":", "Wrappable", "<", "WebContents", ">", ",", "int32_t", "sender_id", "=", "0", ")", ";", "bool", "SendIPCMessageToFrame", "(", "bool", "internal", ",", "int32_t", "frame_id", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "frame", ",", "const", "std", ":", ":", "string", "&", "channel", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "args", ")", ";", "@", "@", "-", "5", ",", "6", "+", "5", ",", "7", "@", "@", "#", "include", "\"", "shell", "/", "common", "/", "gin_helper", "/", "event_emitter", ".", "h", "\"", "#", "include", "\"", "content", "/", "public", "/", "browser", "/", "render_frame_host", ".", "h", "\"", "#", "include", "\"", "content", "/", "public", "/", "browser", "/", "render_process_host", ".", "h", "\"", "#", "include", "\"", "shell", "/", "browser", "/", "api", "/", "event", ".", "h", "\"", "#", "include", "\"", "shell", "/", "common", "/", "gin_helper", "/", "dictionary", ".", "h", "\"", "#", "include", "\"", "shell", "/", "common", "/", "gin_helper", "/", "object_template_builder", ".", "h", "\"", "@", "@", "-", "67", ",", "8", "+", "68", ",", "10", "@", "@", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Object", ">", "CreateNativeEvent", "(", "Dictionary", "dict", "(", "isolate", ",", "event", ")", ";", "dict", ".", "Set", "(", "\"", "sender", "\"", ",", "sender", ")", ";", "/", "/", "Should", "always", "set", "frameId", "even", "when", "callback", "is", "null", ".", "if", "(", "frame", ")", "if", "(", "frame", ")", "{", "dict", ".", "Set", "(", "\"", "frameId", "\"", ",", "frame", "-", ">", "GetRoutingID", "(", "))", ";", "dict", ".", "Set", "(", "\"", "processId", "\"", ",", "frame", "-", ">", "GetProcess", "(", ")-", ">", "GetID", "(", "))", ";", "}", "return", "event", ";", "}", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "*", "as", "path", "from", "'", "path", "'", ";", "import", "*", "as", "cp", "from", "'", "child_process", "'", ";", "import", "{", "closeAllWindows", "}", "from", "'", "./", "window", "-", "helpers", "'", ";", "import", "{", "emittedOnce", "}", "from", "'", "./", "events", "-", "helpers", "'", ";", "import", "{", "defer", "}", "from", "'", "./", "spec", "-", "helpers", "'", ";", "import", "{", "ipcMain", ",", "BrowserWindow", "}", "from", "'", "electron", "/", "main", "'", ";", "describe", "(", "'", "ipc", "main", "module", "'", ",", "(", ")", "=", ">", "{", "@", "@", "-", "59", ",", "5", "+", "60", ",", "30", "@", "@", "describe", "(", "'", "ipc", "main", "module", "'", ",", "(", ")", "=", ">", "{", "output", "=", "JSON", ".", "parse", "(", "output", ")", ";", "expect", "(", "output", ")", ".", "to", ".", "deep", ".", "equal", "(", "['", "error", "'", "])", ";", "}", ");", "it", "(", "'", "can", "be", "replied", "to", "'", ",", "async", "(", ")", "=", ">", "{", "ipcMain", ".", "on", "(", "'", "test", "-", "echo", "'", ",", "(", "e", ",", "arg", ")", "=", ">", "{", "e", ".", "reply", "(", "'", "test", "-", "echo", "'", ",", "arg", ")", ";", "}", ");", "defer", "(", "()", "=", ">", "{", "ipcMain", ".", "removeAllListeners", "(", "'", "test", "-", "echo", "'", ");", "}", ");", "const", "w", "=", "new", "BrowserWindow", "(", "{", "show", ":", "false", ",", "webPreferences", ":", "{", "nodeIntegration", ":", "true", "}", "}", ");", "w", ".", "loadURL", "(", "'", "about", ":", "blank", "'", ");", "const", "v", "=", "await", "w", ".", "webContents", ".", "executeJavaScript", "(", "`", "new", "Promise", "(", "(", "resolve", ",", "reject", ")", "=", ">", "{", "const", "{", "ipcRenderer", "}", "=", "require", "(", "'", "electron", "'", ")", "ipcRenderer", ".", "send", "(", "'", "test", "-", "echo", "'", ",", "'", "hello", "'", ")", "ipcRenderer", ".", "on", "(", "'", "test", "-", "echo", "'", ",", "(", "e", ",", "v", ")", "=", ">", "{", "resolve", "(", "v", ")", "}", ")", "}", ")`", ");", "expect", "(", "v", ")", ".", "to", ".", "equal", "(", "'", "hello", "'", ");", "}", ");", "}", ");", "}", ");", "@", "@", "-", "3", ",", "7", "+", "3", ",", "8", "@", "@", "\"", "top", "=", "5", ",", "left", "=", "10", ",", "resizable", "=", "no", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "37", ",", "7", "+", "38", ",", "8", "@", "@", "\"", "zoomFactor", "=", "2", ",", "resizable", "=", "0", ",", "x", "=", "0", ",", "y", "=", "10", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "70", ",", "7", "+", "72", ",", "8", "@", "@", "\"", "backgroundColor", "=", "gray", ",", "webPreferences", "=", "0", ",", "x", "=", "100", ",", "y", "=", "100", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "103", ",", "7", "+", "106", ",", "8", "@", "@", "\"", "x", "=", "50", ",", "y", "=", "20", ",", "title", "=", "sup", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "134", ",", "7", "+", "138", ",", "8", "@", "@", "\"", "show", "=", "false", ",", "top", "=", "1", ",", "left", "=", "1", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "189", ",", "6", "+", "189", ",", "9", "@", "@", "function", "stringifySnapshots", "(", "snapshots", ":", "any", ",", "pretty", "=", "false", ")", "{", "if", "(", "key", "=", "==", "'", "openerId", "'", "&", "&", "typeof", "value", "=", "==", "'", "number", "'", ")", "{", "return", "'", "placeholder", "-", "opener", "-", "id", "'", ";", "}", "if", "(", "key", "=", "==", "'", "processId", "'", "&", "&", "typeof", "value", "=", "==", "'", "number", "'", ")", "{", "return", "'", "placeholder", "-", "process", "-", "id", "'", ";", "}", "if", "(", "key", "=", "==", "'", "returnValue", "'", ")", "{", "return", "'", "placeholder", "-", "guest", "-", "contents", "-", "id", "'", ";", "}", "@", "@", "-", "68", ",", "8", "+", "68", ",", "8", "@", "@", "declare", "namespace", "Electron", "{", "_callWindowOpenHandler", "(", "event", ":", "any", ",", "url", ":", "string", ",", "frameName", ":", "string", ",", "rawFeatures", ":", "string", ")", ":", "Electron", ".", "BrowserWindowConstructorOptions", "|", "null", ";", "_setNextChildWebPreferences", "(", "prefs", ":", "Partial", "<", "Electron", ".", "BrowserWindowConstructorOptions", "[", "'", "webPreferences", "'", "]>", "&", "Pick", "<", "Electron", ".", "BrowserWindowConstructorOptions", ",", "'", "backgroundColor", "'", ">)", ":", "void", ";", "_send", "(", "internal", ":", "boolean", ",", "channel", ":", "string", ",", "args", ":", "any", ")", ":", "boolean", ";", "_sendToFrame", "(", "internal", ":", "boolean", ",", "frameId", ":", "number", ",", "channel", ":", "string", ",", "args", ":", "any", ")", ":", "boolean", ";", "_sendToFrameInternal", "(", "frameId", ":", "number", ",", "channel", ":", "string", ",", ".", "..", "args", ":", "any", "[", "])", ":", "boolean", ";", "_sendToFrame", "(", "internal", ":", "boolean", ",", "frameId", ":", "number", "|", "[", "number", ",", "number", "]", ",", "channel", ":", "string", ",", "args", ":", "any", ")", ":", "boolean", ";", "_sendToFrameInternal", "(", "frameId", ":", "number", "|", "[", "number", ",", "number", "]", ",", "channel", ":", "string", ",", ".", "..", "args", ":", "any", "[", "])", ":", "boolean", ";", "_postMessage", "(", "channel", ":", "string", ",", "message", ":", "any", ",", "transfer", "?", ":", "any", "[", "])", ":", "void", ";", "_sendInternal", "(", "channel", ":", "string", ",", ".", "..", "args", ":", "any", "[", "])", ":", "void", ";", "_printToPDF", "(", "options", ":", "any", ")", ":", "Promise", "<", "Buffer", ">", ";"], "docstring_tokens": ["delivered", "to", "the", "wrong", "frame"]}
{"contents": ["Fix", "#1680"], "code_tokens": ["@", "@", "-", "10", ",", "6", "+", "10", ",", "7", "@", "@", "Project", ":", "jackson", "-", "databind", "(", "reported", "by", "vboulaye", "@", "github", ")", "#", "1628", ":", "Don", "'", "t", "print", "to", "error", "stream", "about", "failure", "to", "load", "JDK", "7", "types", "(", "reported", "by", "Villane", "@", "github", ")", "#", "1680", ":", "Blacklist", "couple", "more", "types", "for", "deserialization", "2", ".", "7", ".", "9", ".", "1", "(", "18", "-", "Apr", "-", "2017", ")", "@", "@", "-", "58", ",", "6", "+", "58", ",", "8", "@", "@", "s", ".", "add", "(", "\"", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "ObjectFactory", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "xalan", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "\"", ");", "/", "/", "[", "databind", "#", "1680", "]", ":", "may", "or", "may", "not", "be", "problem", ",", "take", "no", "chance", "s", ".", "add", "(", "\"", "com", ".", "sun", ".", "rowset", ".", "JdbcRowSetImpl", "\"", ");", "DEFAULT_NO_DESER_CLASS_NAMES", "=", "Collections", ".", "unmodifiableSet", "(", "s", ")", ";", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["Bluetooth:", "SCO", "-", "Fix", "missing", "msg_namelen", "update", "in", "sco_sock_recvmsg()", "If", "the", "socket", "is", "in", "state", "BT_CONNECT2", "and", "BT_SK_DEFER_SETUP", "is", "set", "in", "the", "flags,", "sco_sock_recvmsg()", "returns", "early", "with", "0", "without", "updating", "the", "possibly", "set", "msg_namelen", "member.", "This,", "in", "turn,", "leads", "to", "a", "128", "byte", "kernel", "stack", "leak", "in", "net/socket.c.", "Fix", "this", "by", "updating", "msg_namelen", "in", "this", "case.", "For", "all", "other", "cases", "it", "will", "be", "handled", "in", "bt_sock_recvmsg().", "Cc:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Cc:", "Gustavo", "Padovan", "<gustavo@padovan.org>", "Cc:", "Johan", "Hedberg", "<johan.hedberg@gmail.com>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "665", ",", "6", "+", "665", ",", "7", "@", "@", "static", "int", "sco_sock_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "test_bit", "(", "BT_SK_DEFER_SETUP", ",", "&", "bt_sk", "(", "sk", ")", "->", "flags", ")", ")", "{", "hci_conn_accept", "(", "pi", "-", ">", "conn", "-", ">", "hcon", ",", "0", ")", ";", "sk", "-", ">", "sk_state", "=", "BT_CONFIG", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";", "release_sock", "(", "sk", ")", ";", "return", "0", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "stack", "memory"]}
{"contents": ["DefaultRedirectResolver", "matches", "on", "userinfo", "and", "query", "Fixes", "gh-1585"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "21", ",", "13", "+", "21", ",", "16", "@", "@", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "exceptions", ".", "RedirectMismatchException", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetails", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "MultiValueMap", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UriComponents", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UriComponentsBuilder", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "@", "@", "-", "47", ",", "7", "+", "50", ",", "7", "@", "@", "/", "**", "*", "Flag", "to", "indicate", "that", "requested", "URIs", "will", "match", "if", "they", "are", "a", "subdomain", "of", "the", "registered", "value", ".", "*", "*", "@", "param", "matchSubdomains", "the", "flag", "value", "to", "set", "(", "deafult", "true", ")", "*", "@", "param", "matchSubdomains", "the", "flag", "value", "to", "set", "(", "default", "true", ")", "*", "/", "public", "void", "setMatchSubdomains", "(", "boolean", "matchSubdomains", ")", "{", "this", ".", "matchSubdomains", "=", "matchSubdomains", ";", "@", "@", "-", "105", ",", "7", "+", "108", ",", "8", "@", "@", "private", "boolean", "containsRedirectGrantType", "(", "Set", "<", "String", ">", "grantTypes", ")", "{", "/", "**", "*", "Whether", "the", "requested", "redirect", "URI", "\"", "matches", "\"", "the", "specified", "redirect", "URI", ".", "For", "a", "URL", ",", "this", "implementation", "tests", "if", "*", "the", "user", "requested", "redirect", "starts", "with", "the", "registered", "redirect", ",", "so", "it", "would", "have", "the", "same", "host", "and", "root", "path", "if", "*", "it", "is", "an", "HTTP", "URL", ".", "The", "port", "is", "also", "matched", ".", "*", "it", "is", "an", "HTTP", "URL", ".", "The", "port", ",", "userinfo", ",", "query", "params", "also", "matched", ".", "Request", "redirect", "uri", "path", "can", "include", "*", "additional", "parameters", "which", "are", "ignored", "for", "the", "match", "*", "<", "p", ">", "*", "For", "other", "(", "non", "-", "URL", ")", "cases", ",", "such", "as", "for", "some", "implicit", "clients", ",", "the", "redirect_uri", "must", "be", "an", "exact", "match", ".", "*", "@", "@", "-", "115", ",", "22", "+", "119", ",", "65", "@", "@", "private", "boolean", "containsRedirectGrantType", "(", "Set", "<", "String", ">", "grantTypes", ")", "{", "*", "/", "protected", "boolean", "redirectMatches", "(", "String", "requestedRedirect", ",", "String", "redirectUri", ")", "{", "UriComponents", "requestedRedirectUri", "=", "UriComponentsBuilder", ".", "fromUriString", "(", "requestedRedirect", ")", ".", "build", "(", ");", "String", "requestedRedirectUriScheme", "=", "(", "requestedRedirectUri", ".", "getScheme", "(", ")", "!", "=", "null", "?", "requestedRedirectUri", ".", "getScheme", "(", ")", ":", "\"", "\")", ";", "String", "requestedRedirectUriHost", "=", "(", "requestedRedirectUri", ".", "getHost", "(", ")", "!", "=", "null", "?", "requestedRedirectUri", ".", "getHost", "(", ")", ":", "\"", "\")", ";", "String", "requestedRedirectUriPath", "=", "(", "requestedRedirectUri", ".", "getPath", "(", ")", "!", "=", "null", "?", "requestedRedirectUri", ".", "getPath", "(", ")", ":", "\"", "\")", ";", "UriComponents", "registeredRedirectUri", "=", "UriComponentsBuilder", ".", "fromUriString", "(", "redirectUri", ")", ".", "build", "(", ");", "String", "registeredRedirectUriScheme", "=", "(", "registeredRedirectUri", ".", "getScheme", "(", ")", "!", "=", "null", "?", "registeredRedirectUri", ".", "getScheme", "(", ")", ":", "\"", "\")", ";", "String", "registeredRedirectUriHost", "=", "(", "registeredRedirectUri", ".", "getHost", "(", ")", "!", "=", "null", "?", "registeredRedirectUri", ".", "getHost", "(", ")", ":", "\"", "\")", ";", "String", "registeredRedirectUriPath", "=", "(", "registeredRedirectUri", ".", "getPath", "(", ")", "!", "=", "null", "?", "registeredRedirectUri", ".", "getPath", "(", ")", ":", "\"", "\")", ";", "boolean", "portsMatch", "=", "this", ".", "matchPorts", "?", "(", "registeredRedirectUri", ".", "getPort", "(", ")", "=", "=", "requestedRedirectUri", ".", "getPort", "(", "))", ":", "true", ";", "boolean", "schemeMatch", "=", "isEqual", "(", "registeredRedirectUri", ".", "getScheme", "(", "),", "requestedRedirectUri", ".", "getScheme", "(", "))", ";", "boolean", "userInfoMatch", "=", "isEqual", "(", "registeredRedirectUri", ".", "getUserInfo", "(", "),", "requestedRedirectUri", ".", "getUserInfo", "(", "))", ";", "boolean", "hostMatch", "=", "hostMatches", "(", "registeredRedirectUri", ".", "getHost", "(", "),", "requestedRedirectUri", ".", "getHost", "(", "))", ";", "boolean", "portMatch", "=", "matchPorts", "?", "registeredRedirectUri", ".", "getPort", "(", ")", "=", "=", "requestedRedirectUri", ".", "getPort", "(", ")", ":", "true", ";", "boolean", "pathMatch", "=", "isEqual", "(", "registeredRedirectUri", ".", "getPath", "(", "),", "StringUtils", ".", "cleanPath", "(", "requestedRedirectUri", ".", "getPath", "(", "))", ");", "boolean", "queryParamMatch", "=", "matchQueryParams", "(", "registeredRedirectUri", ".", "getQueryParams", "(", "),", "requestedRedirectUri", ".", "getQueryParams", "(", "))", ";", "return", "schemeMatch", "&", "&", "userInfoMatch", "&", "&", "hostMatch", "&", "&", "portMatch", "&", "&", "pathMatch", "&", "&", "queryParamMatch", ";", "}", "/", "**", "*", "Checks", "whether", "the", "registered", "redirect", "uri", "query", "params", "key", "and", "values", "contains", "match", "the", "requested", "set", "*", "*", "The", "requested", "redirect", "uri", "query", "params", "are", "allowed", "to", "contain", "additional", "params", "which", "will", "be", "retained", "*", "*", "@", "param", "registeredRedirectUriQueryParams", "*", "@", "param", "requestedRedirectUriQueryParams", "*", "@", "return", "whether", "the", "params", "match", "*", "/", "private", "boolean", "matchQueryParams", "(", "MultiValueMap", "<", "String", ",", "String", ">", "registeredRedirectUriQueryParams", ",", "MultiValueMap", "<", "String", ",", "String", ">", "requestedRedirectUriQueryParams", ")", "{", "Iterator", "<", "String", ">", "iter", "=", "registeredRedirectUriQueryParams", ".", "keySet", "(", ").", "iterator", "(", ");", "while", "(", "iter", ".", "hasNext", "(", "))", "{", "String", "key", "=", "iter", ".", "next", "(", ");", "List", "<", "String", ">", "registeredRedirectUriQueryParamsValues", "=", "registeredRedirectUriQueryParams", ".", "get", "(", "key", ")", ";", "List", "<", "String", ">", "requestedRedirectUriQueryParamsValues", "=", "requestedRedirectUriQueryParams", ".", "get", "(", "key", ")", ";", "if", "(", "!", "registeredRedirectUriQueryParamsValues", ".", "equals", "(", "requestedRedirectUriQueryParamsValues", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "return", "registeredRedirectUriScheme", ".", "equals", "(", "requestedRedirectUriScheme", ")", "&", "&", "hostMatches", "(", "registeredRedirectUriHost", ",", "requestedRedirectUriHost", ")", "&", "&", "portsMatch", "&", "&", "/", "/", "Ensure", "exact", "path", "matching", "registeredRedirectUriPath", ".", "equals", "(", "StringUtils", ".", "cleanPath", "(", "requestedRedirectUriPath", ")", ");", "/", "**", "*", "Compares", "two", "strings", "but", "treats", "empty", "string", "or", "null", "equal", "*", "*", "@", "param", "str1", "*", "@", "param", "str2", "*", "@", "return", "true", "if", "strings", "are", "equal", ",", "false", "otherwise", "*", "/", "private", "boolean", "isEqual", "(", "String", "str1", ",", "String", "str2", ")", "{", "if", "(", "StringUtils", ".", "isEmpty", "(", "str1", ")", "&", "&", "StringUtils", ".", "isEmpty", "(", "str2", ")", ")", "{", "return", "true", ";", "}", "else", "if", "(", "!", "StringUtils", ".", "isEmpty", "(", "str1", ")", ")", "{", "return", "str1", ".", "equals", "(", "str2", ")", ";", "}", "else", "{", "return", "false", ";", "}", "}", "/", "**", "@", "@", "-", "152", ",", "7", "+", "199", ",", "7", "@", "@", "protected", "boolean", "hostMatches", "(", "String", "registered", ",", "String", "requested", ")", "{", "*", "*", "@", "param", "redirectUris", "the", "set", "of", "the", "registered", "URIs", "to", "try", "and", "find", "a", "match", ".", "This", "cannot", "be", "null", "or", "empty", ".", "*", "@", "param", "requestedRedirect", "the", "URI", "used", "as", "part", "of", "the", "request", "*", "@", "return", "the", "matching", "URI", "*", "@", "return", "redirect", "uri", "*", "@", "throws", "RedirectMismatchException", "if", "no", "match", "was", "found", "*", "/", "private", "String", "obtainMatchingRedirect", "(", "Set", "<", "String", ">", "redirectUris", ",", "String", "requestedRedirect", ")", "{", "@", "@", "-", "161", ",", "11", "+", "208", ",", "26", "@", "@", "private", "String", "obtainMatchingRedirect", "(", "Set", "<", "String", ">", "redirectUris", ",", "String", "requested", "if", "(", "redirectUris", ".", "size", "(", ")", "=", "=", "1", "&", "&", "requestedRedirect", "=", "=", "null", ")", "{", "return", "redirectUris", ".", "iterator", "(", ").", "next", "(", ");", "}", "for", "(", "String", "redirectUri", ":", "redirectUris", ")", "{", "if", "(", "requestedRedirect", "!", "=", "null", "&", "&", "redirectMatches", "(", "requestedRedirect", ",", "redirectUri", ")", ")", "{", "return", "requestedRedirect", ";", "/", "/", "Initialize", "with", "the", "registered", "redirect", "-", "uri", "UriComponentsBuilder", "redirectUriBuilder", "=", "UriComponentsBuilder", ".", "fromUriString", "(", "redirectUri", ")", ";", "UriComponents", "requestedRedirectUri", "=", "UriComponentsBuilder", ".", "fromUriString", "(", "requestedRedirect", ")", ".", "build", "(", ");", "if", "(", "this", ".", "matchSubdomains", ")", "{", "redirectUriBuilder", ".", "host", "(", "requestedRedirectUri", ".", "getHost", "(", "))", ";", "}", "if", "(", "!", "this", ".", "matchPorts", ")", "{", "redirectUriBuilder", ".", "port", "(", "requestedRedirectUri", ".", "getPort", "(", "))", ";", "}", "redirectUriBuilder", ".", "replaceQuery", "(", "requestedRedirectUri", ".", "getQuery", "(", "))", ";", "/", "/", "retain", "additional", "params", "(", "if", "any", ")", "redirectUriBuilder", ".", "fragment", "(", "null", ")", ";", "return", "redirectUriBuilder", ".", "build", "(", ").", "toUriString", "(", ");", "}", "}", "throw", "new", "RedirectMismatchException", "(", "\"", "Invalid", "redirect", ":", "\"", "+", "requestedRedirect", "+", "\"", "does", "not", "match", "one", "of", "the", "registered", "values", ":", "\"", "+", "redirectUris", ".", "toString", "(", "))", ";", "}", "@", "@", "-", "23", ",", "7", "+", "23", ",", "7", "@", "@", "@", "Test", "public", "void", "testRedirectWatchdox", "(", ")", "throws", "Exception", "public", "void", "testRedirectMatch", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "watchdox", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "@", "@", "-", "32", ",", "9", "+", "32", ",", "9", "@", "@", "public", "void", "testRedirectWatchdox", "(", ")", "throws", "Exception", "}", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectBadWatchdox", "(", ")", "throws", "Exception", "public", "void", "testRedirectNoMatch", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", "/", "/", "watchdox", ".", "com", "\"", "))", ";", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "watchdox", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "google", ".", "com", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "@", "@", "-", "1", ",", "14", "+", "1", ",", "17", "@", "@", "/", "*", "*", "Copyright", "2006", "-", "2011", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "*", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ";", "@", "@", "-", "180", ",", "4", "+", "183", ",", "107", "@", "@", "public", "void", "testRedirectMatchPortsFalse", "(", ")", "throws", "Exception", "{", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "com", ":", "91", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectRegisteredUserInfoNotMatching", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "userinfo", "@", "anywhere", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "http", ":", "//", "otheruserinfo", "@", "anywhere", ".", "com", "\"", ",", "client", ")", ";", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectRegisteredNoUserInfoNotMatching", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "userinfo", "@", "anywhere", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "client", ")", ";", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", ")", "public", "void", "testRedirectRegisteredUserInfoMatching", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "userinfo", "@", "anywhere", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "userinfo", "@", "anywhere", ".", "com", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", ")", "public", "void", "testRedirectRegisteredFragmentIgnoredAndStripped", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "userinfo", "@", "anywhere", ".", "com", "/", "foo", "/", "bar", "#", "baz", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "userinfo", "@", "anywhere", ".", "com", "/", "foo", "/", "bar", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", "+", "\"", "#", "bar", "\"", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", ")", "public", "void", "testRedirectRegisteredQueryParamsMatching", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", ")", "public", "void", "testRedirectRegisteredQueryParamsMatchingIgnoringAdditionalParams", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "&", "p3", "=", "v3", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", ")", "public", "void", "testRedirectRegisteredQueryParamsMatchingDifferentOrder", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p2", "=", "v2", "&", "p1", "=", "v1", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectRegisteredQueryParamsWithDifferentValues", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v3", "\"", ",", "client", ")", ";", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectRegisteredQueryParamsNotMatching", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p2", "=", "v2", "\"", ",", "client", ")", ";", "}", "/", "/", "gh", "-", "1566", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectRegisteredQueryParamsPartiallyMatching", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v1", "&", "p2", "=", "v2", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p2", "=", "v2", "&", "p3", "=", "v3", "\"", ",", "client", ")", ";", "}", "/", "/", "gh", "-", "1566", "@", "Test", "public", "void", "testRedirectRegisteredQueryParamsMatchingWithMultipleValuesInRegistered", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v11", "&", "p1", "=", "v12", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "=", "v11", "&", "p1", "=", "v12", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "/", "/", "gh", "-", "1566", "@", "Test", "public", "void", "testRedirectRegisteredQueryParamsMatchingWithParamWithNoValue", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "&", "p2", "=", "v2", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "?", "p1", "&", "p2", "=", "v2", "\"", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "31", ",", "7", "+", "31", ",", "7", "@", "@", "@", "Test", "@", "OAuth2ContextConfiguration", "(", "resource", "=", "MyClientWithRegisteredRedirect", ".", "class", ",", "initialize", "=", "false", ")", "public", "void", "testPostToProtectedResource", "(", ")", "throws", "Exception", "{", "approveAccessTokenGrant", "(", "\"", "http", ":", "//", "anywhere", "\"", ",", "true", ")", ";", "approveAccessTokenGrant", "(", "\"", "http", ":", "//", "anywhere", "?", "key", "=", "value", "\"", ",", "true", ")", ";", "assertNotNull", "(", "context", ".", "getAccessToken", "(", "))", ";", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "form", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "form", ".", "set", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ");", "@", "@", "-", "31", ",", "7", "+", "31", ",", "7", "@", "@", "@", "Test", "@", "OAuth2ContextConfiguration", "(", "resource", "=", "MyClientWithRegisteredRedirect", ".", "class", ",", "initialize", "=", "false", ")", "public", "void", "testPostToProtectedResource", "(", ")", "throws", "Exception", "{", "approveAccessTokenGrant", "(", "\"", "http", ":", "//", "anywhere", "\"", ",", "true", ")", ";", "approveAccessTokenGrant", "(", "\"", "http", ":", "//", "anywhere", "?", "key", "=", "value", "\"", ",", "true", ")", ";", "assertNotNull", "(", "context", ".", "getAccessToken", "(", "))", ";", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "form", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "form", ".", "set", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ");"], "docstring_tokens": ["leak", "an", "authorization", "code", "."]}
{"contents": ["befs:", "Validate", "length", "of", "long", "symbolic", "links.", "Signed-off-by:", "Timo", "Warns", "<warns@pre-sense.de>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "474", ",", "17", "+", "474", ",", "22", "@", "@", "befs_follow_link", "(", "struct", "dentry", "*", "dentry", ",", "struct", "nameidata", "*", "nd", ")", "befs_data_stream", "*", "data", "=", "&", "befs_ino", "-", ">", "i_data", ".", "ds", ";", "befs_off_t", "len", "=", "data", "-", ">", "size", ";", "befs_debug", "(", "sb", ",", "\"", "Follow", "long", "symlink", "\"", ");", "link", "=", "kmalloc", "(", "len", ",", "GFP_NOFS", ")", ";", "if", "(", "!", "link", ")", "{", "link", "=", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "}", "else", "if", "(", "befs_read_lsymlink", "(", "sb", ",", "data", ",", "link", ",", "len", ")", "!", "=", "len", ")", "{", "kfree", "(", "link", ")", ";", "befs_error", "(", "sb", ",", "\"", "Failed", "to", "read", "entire", "long", "symlink", "\"", ");", "if", "(", "len", "=", "=", "0", ")", "{", "befs_error", "(", "sb", ",", "\"", "Long", "symlink", "with", "illegal", "length", "\"", ");", "link", "=", "ERR_PTR", "(", "-", "EIO", ")", ";", "}", "else", "{", "link", "[", "len", "-", "1", "]", "=", "'", "\\", "0", "'", ";", "befs_debug", "(", "sb", ",", "\"", "Follow", "long", "symlink", "\"", ");", "link", "=", "kmalloc", "(", "len", ",", "GFP_NOFS", ")", ";", "if", "(", "!", "link", ")", "{", "link", "=", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "}", "else", "if", "(", "befs_read_lsymlink", "(", "sb", ",", "data", ",", "link", ",", "len", ")", "!", "=", "len", ")", "{", "kfree", "(", "link", ")", ";", "befs_error", "(", "sb", ",", "\"", "Failed", "to", "read", "entire", "long", "symlink", "\"", ");", "link", "=", "ERR_PTR", "(", "-", "EIO", ")", ";", "}", "else", "{", "link", "[", "len", "-", "1", "]", "=", "'", "\\", "0", "'", ";", "}", "}", "}", "else", "{", "link", "=", "befs_ino", "-", ">", "i_data", ".", "symlink", ";"], "docstring_tokens": ["a", "kernel", "oops", "via", "a", "corrupted", "Be", "file", "system"]}
{"contents": ["Fix", "XXE", "vulnerability", "for", "Dom4JDriver."], "code_tokens": ["@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2004", ",", "2005", ",", "2006", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2014", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "dom4j", ".", "io", ".", "OutputFormat", ";", "import", "org", ".", "dom4j", ".", "io", ".", "SAXReader", ";", "import", "org", ".", "dom4j", ".", "io", ".", "XMLWriter", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamReader", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamWriter", ";", "@", "@", "-", "92", ",", "8", "+", "93", ",", "7", "@", "@", "public", "void", "setOutputFormat", "(", "final", "OutputFormat", "outputFormat", ")", "{", "@", "Override", "public", "HierarchicalStreamReader", "createReader", "(", "final", "Reader", "text", ")", "{", "try", "{", "final", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "final", "Document", "document", "=", "reader", ".", "read", "(", "text", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "text", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "final", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "103", ",", "8", "+", "103", ",", "7", "@", "@", "public", "HierarchicalStreamReader", "createReader", "(", "final", "Reader", "text", ")", "{", "@", "Override", "public", "HierarchicalStreamReader", "createReader", "(", "final", "InputStream", "in", ")", "{", "try", "{", "final", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "final", "Document", "document", "=", "reader", ".", "read", "(", "in", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "in", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "final", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "117", ",", "8", "+", "116", ",", "7", "@", "@", "public", "HierarchicalStreamReader", "createReader", "(", "final", "InputStream", "in", ")", "{", "@", "Override", "public", "HierarchicalStreamReader", "createReader", "(", "final", "URL", "in", ")", "{", "try", "{", "final", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "final", "Document", "document", "=", "reader", ".", "read", "(", "in", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "in", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "final", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "131", ",", "8", "+", "129", ",", "7", "@", "@", "public", "HierarchicalStreamReader", "createReader", "(", "final", "URL", "in", ")", "{", "@", "Override", "public", "HierarchicalStreamReader", "createReader", "(", "final", "File", "in", ")", "{", "try", "{", "final", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "final", "Document", "document", "=", "reader", ".", "read", "(", "in", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "in", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "final", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "157", ",", "4", "+", "154", ",", "21", "@", "@", "public", "HierarchicalStreamWriter", "createWriter", "(", "final", "OutputStream", "out", ")", "{", "final", "Writer", "writer", "=", "new", "OutputStreamWriter", "(", "out", ")", ";", "return", "createWriter", "(", "writer", ")", ";", "}", "/", "**", "*", "Create", "and", "initialize", "the", "SAX", "reader", ".", "*", "*", "@", "return", "the", "SAX", "reader", "instance", ".", "*", "@", "throws", "DocumentException", "if", "DOCTYPE", "processing", "cannot", "be", "disabled", "*", "@", "since", "upcoming", "*", "/", "protected", "SAXReader", "createReader", "(", ")", "throws", "DocumentException", "{", "final", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "try", "{", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "DocumentException", "(", "\"", "Cannot", "disable", "DOCTYPE", "processing", "\"", ",", "e", ")", ";", "}", "return", "reader", ";", "}", "}", "@", "@", "-", "52", ",", "7", "+", "52", ",", "7", "@", "@", "public", "void", "testIsXXEVulnerable", "(", ")", "throws", "Exception", "{", "fail", "(", "\"", "Thrown", "\"", "+", "XStreamException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "final", "String", "message", "=", "e", ".", "getMessage", "(", ");", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "if", "(", "!", "message", ".", "contains", "(", "\"", "DOCTYPE", "\"", "))", "{", "throw", "e", ";", "}", "}"], "docstring_tokens": ["access", "data", "on", "the", "file", "system"]}
{"contents": ["sit:", "Add", "missing", "kfree_skb()", "on", "pskb_may_pull()", "failure.", "Noticed", "by", "Paul", "Marks", "<paul@pmarks.net>.", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "596", ",", "9", "+", "596", ",", "9", "@", "@", "static", "int", "ipip6_rcv", "(", "struct", "sk_buff", "*", "skb", ")", "}", "icmp_send", "(", "skb", ",", "ICMP_DEST_UNREACH", ",", "ICMP_PORT_UNREACH", ",", "0", ")", ";", "kfree_skb", "(", "skb", ")", ";", "read_unlock", "(", "&", "ipip6_lock", ")", ";", "out", ":", "kfree_skb", "(", "skb", ")", ";", "return", "0", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["-", "Fixed", "bug", "#49687", "(utf8_decode", "vulnerabilities", "and", "deficiencies", "in", "the", "number", "of", "reported", "malformed", "sequences).", "(Gustavo)", "#Made", "a", "public", "interface", "for", "get_next_char/utf-8", "in", "trunk", "to", "use", "in", "utf8_decode.", "#In", "PHP", "5.3,", "trunk's", "get_next_char", "was", "copied", "to", "xml.c", "because", "5.3's", "#get_next_char", "is", "different", "and", "is", "not", "prepared", "to", "recover", "appropriately", "from", "#errors."], "code_tokens": ["@", "@", "-", "152", ",", "6", "+", "152", ",", "8", "@", "@", "other", "platforms", ")", ".", "(", "Pierre", ")", "-", "Fixed", "bug", "#", "50345", "(", "nanosleep", "not", "detected", "properly", "on", "some", "solaris", "versions", ")", ".", "(", "Ulf", ",", "Tony", ")", "-", "Fixed", "bug", "#", "49687", "(", "utf8_decode", "vulnerabilities", "and", "deficiencies", "in", "the", "number", "of", "reported", "malformed", "sequences", ")", ".", "(", "Gustavo", ")", "-", "Fixed", "bug", "#", "49407", "(", "get_html_translation_table", "doesn", "'", "t", "handle", "UTF", "-", "8", ")", ".", "(", "Gustavo", ")", "-", "Fixed", "bug", "#", "49215", "(", "make", "fails", "on", "glob_wrapper", ")", ".", "(", "Felipe", ")", "-", "Fixed", "bug", "#", "48831", "(", "php", "-", "i", "has", "different", "output", "to", "php", "-", "-", "ini", ")", ".", "(", "Richard", ",", "@", "@", "-", "0", ",", "0", "+", "1", ",", "24", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "49687", "Several", "utf8_decode", "deficiencies", "and", "vulnerabilities", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "\"", "skipif", ".", "inc", "\"", ");", "if", "(", "!", "extension_loaded", "(", "'", "xml", "'", "))", "die", "(", "\"", "skip", "xml", "extension", "not", "available", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "tests", "=", "array", "(", "\"", "\\", "x41", "\\", "xC2", "\\", "x3E", "\\", "x42", "\"", ",", "\"", "\\", "xE3", "\\", "x80", "\\", "x22", "\"", ",", "\"", "\\", "x41", "\\", "x98", "\\", "xBA", "\\", "x42", "\\", "xE2", "\\", "x98", "\\", "x43", "\\", "xE2", "\\", "x98", "\\", "xBA", "\\", "xE2", "\\", "x98", "\"", ",", ")", ";", "foreach", "(", "$", "tests", "as", "$", "t", ")", "{", "echo", "bin2hex", "(", "utf8_decode", "(", "$", "t", ")", "),", "\"", "\\", "n", "\"", ";", "}", "echo", "\"", "Done", ".", "\\", "n", "\"", ";", "-", "-", "EXPECT", "-", "-", "413f3e42", "3f22", "413f3f423f433f3f", "Done", ".", "@", "@", "-", "659", ",", "10", "+", "659", ",", "111", "@", "@", "PHPAPI", "char", "*", "xml_utf8_encode", "(", "const", "char", "*", "s", ",", "int", "len", ",", "int", "*", "newlen", ",", "const", "XML_Char", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "copied", "from", "trunk", "'", "s", "implementation", "of", "get_next_char", "in", "ext", "/", "standard", "/", "html", ".", "c", "*", "/", "#", "define", "MB_FAILURE", "(", "pos", ",", "advance", ")", "do", "{", "\\", "*", "cursor", "=", "pos", "+", "(", "advance", ")", ";", "\\", "*", "status", "=", "FAILURE", ";", "\\", "return", "0", ";", "\\", "}", "while", "(", "0", ")", "#", "define", "CHECK_LEN", "(", "pos", ",", "chars_need", ")", "(", "(", "str_len", "-", "(", "pos", ")", ")", ">", "=", "(", "chars_need", ")", ")", "#", "define", "utf8_lead", "(", "c", ")", "(", "(", "c", ")", "<", "0x80", "|", "|", "(", "(", "c", ")", ">", "=", "0xC2", "&", "&", "(", "c", ")", "<", "=", "0xF4", ")", ")", "#", "define", "utf8_trail", "(", "c", ")", "(", "(", "c", ")", ">", "=", "0x80", "&", "&", "(", "c", ")", "<", "=", "0xBF", ")", "/", "*", "{", "{{", "php_next_utf8_char", "*", "/", "static", "inline", "unsigned", "int", "php_next_utf8_char", "(", "const", "unsigned", "char", "*", "str", ",", "size_t", "str_len", ",", "size_t", "*", "cursor", ",", "int", "*", "status", ")", "{", "size_t", "pos", "=", "*", "cursor", ";", "unsigned", "int", "this_char", "=", "0", ";", "unsigned", "char", "c", ";", "*", "status", "=", "SUCCESS", ";", "if", "(", "!", "CHECK_LEN", "(", "pos", ",", "1", ")", ")", "MB_FAILURE", "(", "pos", ",", "1", ")", ";", "/", "*", "We", "'", "ll", "follow", "strategy", "2", ".", "from", "section", "3", ".", "6", ".", "1", "of", "UTR", "#", "36", ":", "*", "\"", "In", "a", "reported", "illegal", "byte", "sequence", ",", "do", "not", "include", "any", "*", "non", "-", "initial", "byte", "that", "encodes", "a", "valid", "character", "or", "is", "a", "leading", "*", "byte", "for", "a", "valid", "sequence", ".", "\ufffd", "*", "/", "c", "=", "str", "[", "pos", "]", ";", "if", "(", "c", "<", "0x80", ")", "{", "this_char", "=", "c", ";", "pos", "+", "+;", "}", "else", "if", "(", "c", "<", "0xc2", ")", "{", "MB_FAILURE", "(", "pos", ",", "1", ")", ";", "}", "else", "if", "(", "c", "<", "0xe0", ")", "{", "if", "(", "!", "CHECK_LEN", "(", "pos", ",", "2", ")", ")", "MB_FAILURE", "(", "pos", ",", "1", ")", ";", "if", "(", "!", "utf8_trail", "(", "str", "[", "pos", "+", "1", "]", "))", "{", "MB_FAILURE", "(", "pos", ",", "utf8_lead", "(", "str", "[", "pos", "+", "1", "]", ")", "?", "1", ":", "2", ")", ";", "}", "this_char", "=", "(", "(", "c", "&", "0x1f", ")", "<", "<", "6", ")", "|", "(", "str", "[", "pos", "+", "1", "]", "&", "0x3f", ")", ";", "if", "(", "this_char", "<", "0x80", ")", "{", "/", "*", "non", "-", "shortest", "form", "*", "/", "MB_FAILURE", "(", "pos", ",", "2", ")", ";", "}", "pos", "+", "=", "2", ";", "}", "else", "if", "(", "c", "<", "0xf0", ")", "{", "size_t", "avail", "=", "str_len", "-", "pos", ";", "if", "(", "avail", "<", "3", "|", "|", "!", "utf8_trail", "(", "str", "[", "pos", "+", "1", "]", ")", "|", "|", "!", "utf8_trail", "(", "str", "[", "pos", "+", "2", "]", "))", "{", "if", "(", "avail", "<", "2", "|", "|", "utf8_lead", "(", "str", "[", "pos", "+", "1", "]", "))", "MB_FAILURE", "(", "pos", ",", "1", ")", ";", "else", "if", "(", "avail", "<", "3", "|", "|", "utf8_lead", "(", "str", "[", "pos", "+", "2", "]", "))", "MB_FAILURE", "(", "pos", ",", "2", ")", ";", "else", "MB_FAILURE", "(", "pos", ",", "3", ")", ";", "}", "this_char", "=", "(", "(", "c", "&", "0x0f", ")", "<", "<", "12", ")", "|", "(", "(", "str", "[", "pos", "+", "1", "]", "&", "0x3f", ")", "<", "<", "6", ")", "|", "(", "str", "[", "pos", "+", "2", "]", "&", "0x3f", ")", ";", "if", "(", "this_char", "<", "0x800", ")", "{", "/", "*", "non", "-", "shortest", "form", "*", "/", "MB_FAILURE", "(", "pos", ",", "3", ")", ";", "}", "else", "if", "(", "this_char", ">", "=", "0xd800", "&", "&", "this_char", "<", "=", "0xdfff", ")", "{", "/", "*", "surrogate", "*", "/", "MB_FAILURE", "(", "pos", ",", "3", ")", ";", "}", "pos", "+", "=", "3", ";", "}", "else", "if", "(", "c", "<", "0xf5", ")", "{", "size_t", "avail", "=", "str_len", "-", "pos", ";", "if", "(", "avail", "<", "4", "|", "|", "!", "utf8_trail", "(", "str", "[", "pos", "+", "1", "]", ")", "|", "|", "!", "utf8_trail", "(", "str", "[", "pos", "+", "2", "]", ")", "|", "|", "!", "utf8_trail", "(", "str", "[", "pos", "+", "3", "]", "))", "{", "if", "(", "avail", "<", "2", "|", "|", "utf8_lead", "(", "str", "[", "pos", "+", "1", "]", "))", "MB_FAILURE", "(", "pos", ",", "1", ")", ";", "else", "if", "(", "avail", "<", "3", "|", "|", "utf8_lead", "(", "str", "[", "pos", "+", "2", "]", "))", "MB_FAILURE", "(", "pos", ",", "2", ")", ";", "else", "if", "(", "avail", "<", "4", "|", "|", "utf8_lead", "(", "str", "[", "pos", "+", "3", "]", "))", "MB_FAILURE", "(", "pos", ",", "3", ")", ";", "else", "MB_FAILURE", "(", "pos", ",", "4", ")", ";", "}", "this_char", "=", "(", "(", "c", "&", "0x07", ")", "<", "<", "18", ")", "|", "(", "(", "str", "[", "pos", "+", "1", "]", "&", "0x3f", ")", "<", "<", "12", ")", "|", "(", "(", "str", "[", "pos", "+", "2", "]", "&", "0x3f", ")", "<", "<", "6", ")", "|", "(", "str", "[", "pos", "+", "3", "]", "&", "0x3f", ")", ";", "if", "(", "this_char", "<", "0x10000", "|", "|", "this_char", ">", "0x10FFFF", ")", "{", "/", "*", "non", "-", "shortest", "form", "or", "outside", "range", "*", "/", "MB_FAILURE", "(", "pos", ",", "4", ")", ";", "}", "pos", "+", "=", "4", ";", "}", "else", "{", "MB_FAILURE", "(", "pos", ",", "1", ")", ";", "}", "*", "cursor", "=", "pos", ";", "return", "this_char", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "xml_utf8_decode", "*", "/", "PHPAPI", "char", "*", "xml_utf8_decode", "(", "const", "XML_Char", "*", "s", ",", "int", "len", ",", "int", "*", "newlen", ",", "const", "XML_Char", "*", "encoding", ")", "{", "int", "pos", "=", "len", ";", "size_t", "pos", "=", "0", ";", "char", "*", "newbuf", "=", "emalloc", "(", "len", "+", "1", ")", ";", "unsigned", "int", "c", ";", "char", "(", "*", "decoder", ")", "(", "unsigned", "short", ")", "=", "NULL", ";", "@", "@", "-", "681", ",", "36", "+", "782", ",", "15", "@", "@", "PHPAPI", "char", "*", "xml_utf8_decode", "(", "const", "XML_Char", "*", "s", ",", "int", "len", ",", "int", "*", "newlen", ",", "const", "XML_", "newbuf", "[", "*", "newlen", "]", "=", "'", "\\", "0", "'", ";", "return", "newbuf", ";", "}", "while", "(", "pos", ">", "0", ")", "{", "c", "=", "(", "unsigned", "char", ")", "(*", "s", ")", ";", "if", "(", "c", ">", "=", "0xf0", ")", "{", "/", "*", "four", "bytes", "encoded", ",", "21", "bits", "*", "/", "if", "(", "pos", "-", "4", ">", "=", "0", ")", "{", "c", "=", "(", "(", "s", "[", "0", "]", "&", "7", ")", "<<", "18", ")", "|", "(", "(", "s", "[", "1", "]", "&", "63", ")", "<<", "12", ")", "|", "(", "(", "s", "[", "2", "]", "&", "63", ")", "<<", "6", ")", "|", "(", "s", "[", "3", "]", "&", "63", ")", ";", "}", "else", "{", "c", "=", "'", "?'", ";", "}", "s", "+", "=", "4", ";", "pos", "-", "=", "4", ";", "}", "else", "if", "(", "c", ">", "=", "0xe0", ")", "{", "/", "*", "three", "bytes", "encoded", ",", "16", "bits", "*", "/", "if", "(", "pos", "-", "3", ">", "=", "0", ")", "{", "c", "=", "(", "(", "s", "[", "0", "]", "&", "63", ")", "<<", "12", ")", "|", "(", "(", "s", "[", "1", "]", "&", "63", ")", "<<", "6", ")", "|", "(", "s", "[", "2", "]", "&", "63", ")", ";", "}", "else", "{", "c", "=", "'", "?'", ";", "}", "s", "+", "=", "3", ";", "pos", "-", "=", "3", ";", "}", "else", "if", "(", "c", ">", "=", "0xc0", ")", "{", "/", "*", "two", "bytes", "encoded", ",", "11", "bits", "*", "/", "if", "(", "pos", "-", "2", ">", "=", "0", ")", "{", "c", "=", "(", "(", "s", "[", "0", "]", "&", "63", ")", "<<", "6", ")", "|", "(", "s", "[", "1", "]", "&", "63", ")", ";", "}", "else", "{", "c", "=", "'", "?'", ";", "}", "s", "+", "=", "2", ";", "pos", "-", "=", "2", ";", "}", "else", "{", "s", "+", "+;", "pos", "-", "-;", "while", "(", "pos", "<", "(", "size_t", ")", "len", ")", "{", "int", "status", "=", "FAILURE", ";", "c", "=", "php_next_utf8_char", "(", "(", "const", "unsigned", "char", "*", ")", "s", ",", "(", "size_t", ")", "len", ",", "&", "pos", ",", "&", "status", ")", ";", "if", "(", "status", "=", "=", "FAILURE", "|", "|", "c", ">", "0xFFU", ")", "{", "c", "=", "'", "?'", ";", "}", "newbuf", "[", "*", "newlen", "]", "=", "decoder", "?", "decoder", "(", "c", ")", ":", "c", ";", "+", "+*", "newlen", ";", "}"], "docstring_tokens": ["bypass", "cross-site", "scripting", "and", "SQL", "injection", "protection", "to", "launch", "further", "attacks", "on", "the", "system"]}
{"contents": ["HID:", "pantherlord:", "validate", "output", "report", "details", "A", "HID", "device", "could", "send", "a", "malicious", "output", "report", "that", "would", "cause", "the", "pantherlord", "HID", "driver", "to", "write", "beyond", "the", "output", "report", "allocation", "during", "initialization,", "causing", "a", "heap", "overflow:", "[", "310.939483]", "usb", "1-1:", "New", "USB", "device", "found,", "idVendor=0e8f,", "idProduct=0003", "...", "[", "315.980774]", "BUG", "kmalloc-192", "(Tainted:", "G", "W", "):", "Redzone", "overwritten", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["@", "@", "-", "132", ",", "8", "+", "132", ",", "14", "@", "@", "static", "int", "plff_init", "(", "struct", "hid_device", "*", "hid", ")", "strong", "=", "&", "report", "-", ">", "field", "[", "0", "]", "->", "value", "[", "2", "]", ";", "weak", "=", "&", "report", "-", ">", "field", "[", "0", "]", "->", "value", "[", "3", "]", ";", "debug", "(", "\"", "detected", "single", "-", "field", "device", "\"", ");", "}", "else", "if", "(", "report", "-", ">", "maxfield", ">", "=", "4", "&", "&", "report", "-", ">", "field", "[", "0", "]", "->", "maxusage", "=", "=", "1", "&", "&", "report", "-", ">", "field", "[", "0", "]", "->", "usage", "[", "0", "]", ".", "hid", "=", "=", "(", "HID_UP_LED", "|", "0x43", ")", ")", "{", "}", "else", "if", "(", "report", "-", ">", "field", "[", "0", "]", "->", "maxusage", "=", "=", "1", "&", "&", "report", "-", ">", "field", "[", "0", "]", "->", "usage", "[", "0", "]", ".", "hid", "=", "=", "(", "HID_UP_LED", "|", "0x43", ")", "&", "&", "report", "-", ">", "maxfield", ">", "=", "4", "&", "&", "report", "-", ">", "field", "[", "0", "]", "->", "report_count", ">", "=", "1", "&", "&", "report", "-", ">", "field", "[", "1", "]", "->", "report_count", ">", "=", "1", "&", "&", "report", "-", ">", "field", "[", "2", "]", "->", "report_count", ">", "=", "1", "&", "&", "report", "-", ">", "field", "[", "3", "]", "->", "report_count", ">", "=", "1", ")", "{", "report", "-", ">", "field", "[", "0", "]", "->", "value", "[", "0", "]", "=", "0x00", ";", "report", "-", ">", "field", "[", "1", "]", "->", "value", "[", "0", "]", "=", "0x00", ";", "strong", "=", "&", "report", "-", ">", "field", "[", "2", "]", "->", "value", "[", "0", "]", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["binder:", "replace", "\"%p\"", "with", "\"%pK\"", "The", "format", "specifier", "\"%p\"", "can", "leak", "kernel", "addresses.", "Use", "\"%pK\"", "instead.", "There", "were", "4", "remaining", "cases", "in", "binder.c.", "Signed-off-by:", "Todd", "Kjos", "<tkjos@google.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "2199", ",", "7", "+", "2199", ",", "7", "@", "@", "static", "void", "binder_transaction_buffer_release", "(", "struct", "binder_proc", "*", "proc", ",", "int", "debug_id", "=", "buffer", "-", ">", "debug_id", ";", "binder_debug", "(", "BINDER_DEBUG_TRANSACTION", ",", "\"", "%", "d", "buffer", "release", "%", "d", ",", "size", "%", "zd", "-", "%", "zd", ",", "failed", "at", "%", "p", "\\", "n", "\"", ",", "\"", "%", "d", "buffer", "release", "%", "d", ",", "size", "%", "zd", "-", "%", "zd", ",", "failed", "at", "%", "pK", "\\", "n", "\"", ",", "proc", "-", ">", "pid", ",", "buffer", "-", ">", "debug_id", ",", "buffer", "-", ">", "data_size", ",", "buffer", "-", ">", "offsets_size", ",", "failed_at", ")", ";", "@", "@", "-", "3711", ",", "7", "+", "3711", ",", "7", "@", "@", "static", "int", "binder_thread_write", "(", "struct", "binder_proc", "*", "proc", ",", "}", "}", "binder_debug", "(", "BINDER_DEBUG_DEAD_BINDER", ",", "\"", "%", "d", ":", "%", "d", "BC_DEAD_BINDER_DONE", "%", "016llx", "found", "%", "p", "\\", "n", "\"", ",", "\"", "%", "d", ":", "%", "d", "BC_DEAD_BINDER_DONE", "%", "016llx", "found", "%", "pK", "\\", "n", "\"", ",", "proc", "-", ">", "pid", ",", "thread", "-", ">", "pid", ",", "(", "u64", ")", "cookie", ",", "death", ")", ";", "if", "(", "death", "=", "=", "NULL", ")", "{", "@", "@", "-", "5042", ",", "7", "+", "5042", ",", "7", "@", "@", "static", "void", "print_binder_transaction_ilocked", "(", "struct", "seq_file", "*", "m", ",", "spin_lock", "(", "&", "t", "-", ">", "lock", ")", ";", "to_proc", "=", "t", "-", ">", "to_proc", ";", "seq_printf", "(", "m", ",", "\"", "%", "s", "%", "d", ":", "%", "p", "from", "%", "d", ":", "%", "d", "to", "%", "d", ":", "%", "d", "code", "%", "x", "flags", "%", "x", "pri", "%", "ld", "r", "%", "d", "\"", ",", "\"", "%", "s", "%", "d", ":", "%", "pK", "from", "%", "d", ":", "%", "d", "to", "%", "d", ":", "%", "d", "code", "%", "x", "flags", "%", "x", "pri", "%", "ld", "r", "%", "d", "\"", ",", "prefix", ",", "t", "-", ">", "debug_id", ",", "t", ",", "t", "-", ">", "from", "?", "t", "-", ">", "from", "-", ">", "proc", "-", ">", "pid", ":", "0", ",", "t", "-", ">", "from", "?", "t", "-", ">", "from", "-", ">", "pid", ":", "0", ",", "@", "@", "-", "5066", ",", "7", "+", "5066", ",", "7", "@", "@", "static", "void", "print_binder_transaction_ilocked", "(", "struct", "seq_file", "*", "m", ",", "}", "if", "(", "buffer", "-", ">", "target_node", ")", "seq_printf", "(", "m", ",", "\"", "node", "%", "d", "\"", ",", "buffer", "-", ">", "target_node", "-", ">", "debug_id", ")", ";", "seq_printf", "(", "m", ",", "\"", "size", "%", "zd", ":", "%", "zd", "data", "%", "p", "\\", "n", "\"", ",", "seq_printf", "(", "m", ",", "\"", "size", "%", "zd", ":", "%", "zd", "data", "%", "pK", "\\", "n", "\"", ",", "buffer", "-", ">", "data_size", ",", "buffer", "-", ">", "offsets_size", ",", "buffer", "-", ">", "data", ")", ";", "}"], "docstring_tokens": ["obtain", "sensitive", "address", "information"]}
{"contents": ["tcp:", "make", "connect()", "mem", "charging", "friendly", "While", "working", "on", "sk_forward_alloc", "problems", "reported", "by", "Denys", "Fedoryshchenko,", "we", "found", "that", "tcp", "connect()", "(and", "fastopen)", "do", "not", "call", "sk_wmem_schedule()", "for", "SYN", "packet", "(and/or", "SYN/DATA", "packet),", "so", "sk_forward_alloc", "is", "negative", "while", "connect", "is", "in", "progress.", "We", "can", "fix", "this", "by", "calling", "regular", "sk_stream_alloc_skb()", "both", "for", "the", "SYN", "packet", "(in", "tcp_connect())", "and", "the", "syn_data", "packet", "in", "tcp_send_syn_data()", "Then,", "tcp_send_syn_data()", "can", "avoid", "copying", "syn_data", "as", "we", "simply", "can", "manipulate", "syn_data->cb[]", "to", "remove", "SYN", "flag", "(and", "increment", "seq)", "Instead", "of", "open", "coding", "memcpy_fromiovecend(),", "simply", "use", "this", "helper.", "This", "leaves", "in", "socket", "write", "queue", "clean", "fast", "clone", "skbs.", "This", "was", "tested", "against", "our", "fastopen", "packetdrill", "tests.", "Reported-by:", "Denys", "Fedoryshchenko", "<nuclearcat@nuclearcat.com>", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Acked-by:", "Yuchung", "Cheng", "<ycheng@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "3011", ",", "9", "+", "3011", ",", "9", "@", "@", "static", "int", "tcp_send_syn_data", "(", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "syn", ")", "{", "struct", "tcp_sock", "*", "tp", "=", "tcp_sk", "(", "sk", ")", ";", "struct", "tcp_fastopen_request", "*", "fo", "=", "tp", "-", ">", "fastopen_req", ";", "int", "syn_loss", "=", "0", ",", "space", ",", "i", ",", "err", "=", "0", ",", "iovlen", "=", "fo", "-", ">", "data", "-", ">", "msg_iovlen", ";", "struct", "sk_buff", "*", "syn_data", "=", "NULL", ",", "*", "data", ";", "int", "syn_loss", "=", "0", ",", "space", ",", "err", "=", "0", ";", "unsigned", "long", "last_syn_loss", "=", "0", ";", "struct", "sk_buff", "*", "syn_data", ";", "tp", "-", ">", "rx_opt", ".", "mss_clamp", "=", "tp", "-", ">", "advmss", ";", "/", "*", "If", "MSS", "is", "not", "cached", "*", "/", "tcp_fastopen_cache_get", "(", "sk", ",", "&", "tp", "-", ">", "rx_opt", ".", "mss_clamp", ",", "&", "fo", "-", ">", "cookie", ",", "@", "@", "-", "3044", ",", "48", "+", "3044", ",", "40", "@", "@", "static", "int", "tcp_send_syn_data", "(", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "syn", ")", "/", "*", "limit", "to", "order", "-", "0", "allocations", "*", "/", "space", "=", "min_t", "(", "size_t", ",", "space", ",", "SKB_MAX_HEAD", "(", "MAX_TCP_HEADER", ")", ");", "syn_data", "=", "skb_copy_expand", "(", "syn", ",", "MAX_TCP_HEADER", ",", "space", ",", "sk", "-", ">", "sk_allocation", ")", ";", "if", "(", "syn_data", "=", "=", "NULL", ")", "syn_data", "=", "sk_stream_alloc_skb", "(", "sk", ",", "space", ",", "sk", "-", ">", "sk_allocation", ")", ";", "if", "(", "!", "syn_data", ")", "goto", "fallback", ";", "syn_data", "-", ">", "ip_summed", "=", "CHECKSUM_PARTIAL", ";", "memcpy", "(", "syn_data", "-", ">", "cb", ",", "syn", "-", ">", "cb", ",", "sizeof", "(", "syn", "-", ">", "cb", ")", ");", "if", "(", "unlikely", "(", "memcpy_fromiovecend", "(", "skb_put", "(", "syn_data", ",", "space", ")", ",", "fo", "-", ">", "data", "-", ">", "msg_iov", ",", "0", ",", "space", ")", "))", "{", "kfree_skb", "(", "syn_data", ")", ";", "goto", "fallback", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "iovlen", "&", "&", "syn_data", "-", ">", "len", "<", "space", ";", "+", "+", "i", ")", "{", "struct", "iovec", "*", "iov", "=", "&", "fo", "-", ">", "data", "-", ">", "msg_iov", "[", "i", "]", ";", "unsigned", "char", "__user", "*", "from", "=", "iov", "-", ">", "iov_base", ";", "int", "len", "=", "iov", "-", ">", "iov_len", ";", "/", "*", "No", "more", "data", "pending", "in", "inet_wait_for_connect", "(", ")", "*", "/", "if", "(", "space", "=", "=", "fo", "-", ">", "size", ")", "fo", "-", ">", "data", "=", "NULL", ";", "fo", "-", ">", "copied", "=", "space", ";", "if", "(", "syn_data", "-", ">", "len", "+", "len", ">", "space", ")", "len", "=", "space", "-", "syn_data", "-", ">", "len", ";", "else", "if", "(", "i", "+", "1", "=", "=", "iovlen", ")", "/", "*", "No", "more", "data", "pending", "in", "inet_wait_for_connect", "(", ")", "*", "/", "fo", "-", ">", "data", "=", "NULL", ";", "tcp_connect_queue_skb", "(", "sk", ",", "syn_data", ")", ";", "if", "(", "skb_add_data", "(", "syn_data", ",", "from", ",", "len", ")", ")", "goto", "fallback", ";", "}", "err", "=", "tcp_transmit_skb", "(", "sk", ",", "syn_data", ",", "1", ",", "sk", "-", ">", "sk_allocation", ")", ";", "/", "*", "Queue", "a", "data", "-", "only", "packet", "after", "the", "regular", "SYN", "for", "retransmission", "*", "/", "data", "=", "pskb_copy", "(", "syn_data", ",", "sk", "-", ">", "sk_allocation", ")", ";", "if", "(", "data", "=", "=", "NULL", ")", "goto", "fallback", ";", "TCP_SKB_CB", "(", "data", ")", "->", "seq", "+", "+;", "TCP_SKB_CB", "(", "data", ")", "->", "tcp_flags", "&", "=", "~", "TCPHDR_SYN", ";", "TCP_SKB_CB", "(", "data", ")", "->", "tcp_flags", "=", "(", "TCPHDR_ACK", "|", "TCPHDR_PSH", ")", ";", "tcp_connect_queue_skb", "(", "sk", ",", "data", ")", ";", "fo", "-", ">", "copied", "=", "data", "-", ">", "len", ";", "/", "*", "syn_data", "is", "about", "to", "be", "sent", ",", "we", "need", "to", "take", "current", "time", "stamps", "*", "for", "the", "packets", "that", "are", "in", "write", "queue", ":", "SYN", "packet", "and", "DATA", "*", "/", "skb_mstamp_get", "(", "&", "syn", "-", ">", "skb_mstamp", ")", ";", "data", "-", ">", "skb_mstamp", "=", "syn", "-", ">", "skb_mstamp", ";", "syn", "-", ">", "skb_mstamp", "=", "syn_data", "-", ">", "skb_mstamp", ";", "if", "(", "tcp_transmit_skb", "(", "sk", ",", "syn_data", ",", "0", ",", "sk", "-", ">", "sk_allocation", ")", "=", "=", "0", ")", "{", "/", "*", "Now", "full", "SYN", "+", "DATA", "was", "cloned", "and", "sent", "(", "or", "not", ")", ",", "*", "remove", "the", "SYN", "from", "the", "original", "skb", "(", "syn_data", ")", "*", "we", "keep", "in", "write", "queue", "in", "case", "of", "a", "retransmit", ",", "as", "we", "*", "also", "have", "the", "SYN", "packet", "(", "with", "no", "data", ")", "in", "the", "same", "queue", ".", "*", "/", "TCP_SKB_CB", "(", "syn_data", ")", "->", "seq", "+", "+;", "TCP_SKB_CB", "(", "syn_data", ")", "->", "tcp_flags", "=", "TCPHDR_ACK", "|", "TCPHDR_PSH", ";", "if", "(", "!", "err", ")", "{", "tp", "-", ">", "syn_data", "=", "(", "fo", "-", ">", "copied", ">", "0", ")", ";", "NET_INC_STATS", "(", "sock_net", "(", "sk", ")", ",", "LINUX_MIB_TCPORIGDATASENT", ")", ";", "goto", "done", ";", "}", "syn_data", "=", "NULL", ";", "fallback", ":", "/", "*", "Send", "a", "regular", "SYN", "with", "Fast", "Open", "cookie", "request", "option", "*", "/", "@", "@", "-", "3094", ",", "7", "+", "3086", ",", "6", "@", "@", "static", "int", "tcp_send_syn_data", "(", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "syn", ")", "err", "=", "tcp_transmit_skb", "(", "sk", ",", "syn", ",", "1", ",", "sk", "-", ">", "sk_allocation", ")", ";", "if", "(", "err", ")", "tp", "-", ">", "syn_fastopen", "=", "0", ";", "kfree_skb", "(", "syn_data", ")", ";", "done", ":", "fo", "-", ">", "cookie", ".", "len", "=", "-", "1", ";", "/", "*", "Exclude", "Fast", "Open", "option", "for", "SYN", "retries", "*", "/", "return", "err", ";", "@", "@", "-", "3114", ",", "13", "+", "3105", ",", "10", "@", "@", "int", "tcp_connect", "(", "struct", "sock", "*", "sk", ")", "return", "0", ";", "}", "buff", "=", "alloc_skb_fclone", "(", "MAX_TCP_HEADER", "+", "15", ",", "sk", "-", ">", "sk_allocation", ")", ";", "if", "(", "unlikely", "(", "buff", "=", "=", "NULL", ")", ")", "buff", "=", "sk_stream_alloc_skb", "(", "sk", ",", "0", ",", "sk", "-", ">", "sk_allocation", ")", ";", "if", "(", "unlikely", "(", "!", "buff", ")", ")", "return", "-", "ENOBUFS", ";", "/", "*", "Reserve", "space", "for", "headers", ".", "*", "/", "skb_reserve", "(", "buff", ",", "MAX_TCP_HEADER", ")", ";", "tcp_init_nondata_skb", "(", "buff", ",", "tp", "-", ">", "write_seq", "+", "+,", "TCPHDR_SYN", ")", ";", "tp", "-", ">", "retrans_stamp", "=", "tcp_time_stamp", ";", "tcp_connect_queue_skb", "(", "sk", ",", "buff", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", ")"]}
{"contents": ["Disable", "ext", "entities", "in", "SourceHttpMessageConverter", "This", "change", "disables", "the", "processing", "of", "external", "entities", "in", "SourceHttpMessageConverter", "by", "default", "and", "provides", "an", "option", "to", "enable", "it", "if", "required."], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2011", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2013", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "17", ",", "73", "+", "17", ",", "144", "@", "@", "package", "org", ".", "springframework", ".", "http", ".", "converter", ".", "xml", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stax", ".", "StAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpHeaders", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpInputMessage", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpOutputMessage", ";", "import", "org", ".", "springframework", ".", "http", ".", "MediaType", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "AbstractHttpMessageConverter", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageConversionException", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageNotReadableException", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageNotWritableException", ";", "import", "org", ".", "springframework", ".", "util", ".", "StreamUtils", ";", "/", "**", "*", "Implementation", "of", "{", "@", "link", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageConverter", "}", "that", "can", "read", "and", "write", "{", "@", "link", "*", "Source", "}", "objects", ".", "*", "Implementation", "of", "{", "@", "link", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageConverter", "}", "*", "that", "can", "read", "and", "write", "{", "@", "link", "Source", "}", "objects", ".", "*", "*", "@", "author", "Arjen", "Poutsma", "*", "@", "since", "3", ".", "0", "*", "/", "public", "class", "SourceHttpMessageConverter", "<", "T", "extends", "Source", ">", "extends", "AbstractXmlHttpMessageConverter", "<", "T", ">", "{", "public", "class", "SourceHttpMessageConverter", "<", "T", "extends", "Source", ">", "extends", "AbstractHttpMessageConverter", "<", "T", ">", "{", "private", "final", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "private", "boolean", "processExternalEntities", "=", "false", ";", "/", "**", "*", "Sets", "the", "{", "@", "link", "#", "setSupportedMediaTypes", "(", "java", ".", "util", ".", "List", ")", "supportedMediaTypes", "}", "*", "to", "{", "@", "code", "text", "/", "xml", "}", "and", "{", "@", "code", "application", "/", "xml", "}", ",", "and", "{", "@", "code", "application", "/", "*-", "xml", "}", ".", "*", "/", "public", "SourceHttpMessageConverter", "(", ")", "{", "super", "(", "MediaType", ".", "APPLICATION_XML", ",", "MediaType", ".", "TEXT_XML", ",", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "*+", "xml", "\"", "))", ";", "}", "/", "**", "*", "Indicates", "whether", "external", "XML", "entities", "are", "processed", "when", "converting", "*", "to", "a", "Source", ".", "*", "<", "p", ">", "Default", "is", "{", "@", "code", "false", "}", ",", "meaning", "that", "external", "entities", "are", "not", "resolved", ".", "*", "/", "public", "void", "setProcessExternalEntities", "(", "boolean", "processExternalEntities", ")", "{", "this", ".", "processExternalEntities", "=", "processExternalEntities", ";", "}", "@", "Override", "public", "boolean", "supports", "(", "Class", "<", "?>", "clazz", ")", "{", "return", "DOMSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "SAXSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "StreamSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "Source", ".", "class", ".", "equals", "(", "clazz", ")", ";", "return", "DOMSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "SAXSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "StreamSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "Source", ".", "class", ".", "equals", "(", "clazz", ")", ";", "}", "@", "Override", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "protected", "T", "readFromSource", "(", "Class", "clazz", ",", "HttpHeaders", "headers", ",", "Source", "source", ")", "throws", "IOException", "{", "protected", "T", "readInternal", "(", "Class", "<", "?", "extends", "T", ">", "clazz", ",", "HttpInputMessage", "inputMessage", ")", "throws", "IOException", ",", "HttpMessageNotReadableException", "{", "InputStream", "body", "=", "inputMessage", ".", "getBody", "(", ");", "if", "(", "DOMSource", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "return", "(", "T", ")", "readDOMSource", "(", "body", ")", ";", "}", "else", "if", "(", "SAXSource", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "return", "(", "T", ")", "readSAXSource", "(", "body", ")", ";", "}", "else", "if", "(", "StAXSource", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "return", "(", "T", ")", "readStAXSource", "(", "body", ")", ";", "}", "else", "if", "(", "StreamSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "Source", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "return", "(", "T", ")", "readStreamSource", "(", "body", ")", ";", "}", "else", "{", "throw", "new", "HttpMessageConversionException", "(", "\"", "Could", "not", "read", "class", "[", "\"", "+", "clazz", "\"", "].", "Only", "DOMSource", ",", "SAXSource", ",", "and", "StreamSource", "are", "supported", ".", "\")", ";", "}", "}", "private", "DOMSource", "readDOMSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "try", "{", "if", "(", "DOMSource", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "DOMResult", "domResult", "=", "new", "DOMResult", "(", ");", "transform", "(", "source", ",", "domResult", ")", ";", "return", "(", "T", ")", "new", "DOMSource", "(", "domResult", ".", "getNode", "(", "))", ";", "}", "else", "if", "(", "SAXSource", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "ByteArrayInputStream", "bis", "=", "transformToByteArrayInputStream", "(", "source", ")", ";", "return", "(", "T", ")", "new", "SAXSource", "(", "new", "InputSource", "(", "bis", ")", ");", "}", "else", "if", "(", "StreamSource", ".", "class", ".", "equals", "(", "clazz", ")", "|", "|", "Source", ".", "class", ".", "equals", "(", "clazz", ")", ")", "{", "ByteArrayInputStream", "bis", "=", "transformToByteArrayInputStream", "(", "source", ")", ";", "return", "(", "T", ")", "new", "StreamSource", "(", "bis", ")", ";", "}", "else", "{", "throw", "new", "HttpMessageConversionException", "(", "\"", "Could", "not", "read", "class", "[", "\"", "+", "clazz", "+", "\"", "].", "Only", "DOMSource", ",", "SAXSource", ",", "and", "StreamSource", "are", "supported", ".", "\")", ";", "}", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "processExternalEntities", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "parse", "(", "body", ")", ";", "return", "new", "DOMSource", "(", "document", ")", ";", "}", "catch", "(", "TransformerException", "ex", ")", "{", "throw", "new", "HttpMessageNotReadableException", "(", "\"", "Could", "not", "transform", "from", "[", "\"", "+", "source", "+", "\"", "]", "to", "[", "\"", "+", "clazz", "+", "\"", "]\"", ",", "ex", ")", ";", "catch", "(", "ParserConfigurationException", "ex", ")", "{", "throw", "new", "HttpMessageNotReadableException", "(", "\"", "Could", "not", "set", "feature", ":", "\"", "+", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "throw", "new", "HttpMessageNotReadableException", "(", "\"", "Could", "not", "parse", "document", ":", "\"", "+", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "}", "}", "private", "ByteArrayInputStream", "transformToByteArrayInputStream", "(", "Source", "source", ")", "throws", "TransformerException", "{", "ByteArrayOutputStream", "bos", "=", "new", "ByteArrayOutputStream", "(", ");", "transform", "(", "source", ",", "new", "StreamResult", "(", "bos", ")", ");", "return", "new", "ByteArrayInputStream", "(", "bos", ".", "toByteArray", "(", "))", ";", "private", "SAXSource", "readSAXSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "try", "{", "XMLReader", "reader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "processExternalEntities", ")", ";", "byte", "[", "]", "bytes", "=", "StreamUtils", ".", "copyToByteArray", "(", "body", ")", ";", "return", "new", "SAXSource", "(", "reader", ",", "new", "InputSource", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", "))", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "throw", "new", "HttpMessageNotReadableException", "(", "\"", "Could", "not", "parse", "document", ":", "\"", "+", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "}", "}", "private", "Source", "readStAXSource", "(", "InputStream", "body", ")", "{", "try", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newFactory", "(", ");", "inputFactory", ".", "setProperty", "(", "\"", "javax", ".", "xml", ".", "stream", ".", "isSupportingExternalEntities", "\"", ",", "processExternalEntities", ")", ";", "XMLStreamReader", "streamReader", "=", "inputFactory", ".", "createXMLStreamReader", "(", "body", ")", ";", "return", "new", "StAXSource", "(", "streamReader", ")", ";", "}", "catch", "(", "XMLStreamException", "ex", ")", "{", "throw", "new", "HttpMessageNotReadableException", "(", "\"", "Could", "not", "parse", "document", ":", "\"", "+", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "}", "}", "private", "StreamSource", "readStreamSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "byte", "[", "]", "bytes", "=", "StreamUtils", ".", "copyToByteArray", "(", "body", ")", ";", "return", "new", "StreamSource", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ");", "}", "@", "Override", "@", "@", "-", "102", ",", "15", "+", "173", ",", "22", "@", "@", "protected", "Long", "getContentLength", "(", "T", "t", ",", "MediaType", "contentType", ")", "{", "}", "@", "Override", "protected", "void", "writeToResult", "(", "T", "t", ",", "HttpHeaders", "headers", ",", "Result", "result", ")", "throws", "IOException", "{", "protected", "void", "writeInternal", "(", "T", "t", ",", "HttpOutputMessage", "outputMessage", ")", "throws", "IOException", ",", "HttpMessageNotWritableException", "{", "try", "{", "Result", "result", "=", "new", "StreamResult", "(", "outputMessage", ".", "getBody", "(", "))", ";", "transform", "(", "t", ",", "result", ")", ";", "}", "catch", "(", "TransformerException", "ex", ")", "{", "throw", "new", "HttpMessageNotWritableException", "(", "\"", "Could", "not", "transform", "[", "\"", "+", "t", "+", "\"", "]", "to", "[", "\"", "+", "result", "+", "\"", "]\"", ",", "ex", ")", ";", "throw", "new", "HttpMessageNotWritableException", "(", "\"", "Could", "not", "transform", "[", "\"", "+", "t", "+", "\"", "]", "to", "output", "message", "\"", ",", "ex", ")", ";", "}", "}", "private", "void", "transform", "(", "Source", "source", ",", "Result", "result", ")", "throws", "TransformerException", "{", "this", ".", "transformerFactory", ".", "newTransformer", "(", ").", "transform", "(", "source", ",", "result", ")", ";", "}", "private", "static", "class", "CountingOutputStream", "extends", "OutputStream", "{", "private", "long", "count", "=", "0", ";", "@", "@", "-", "17", ",", "39", "+", "17", ",", "59", "@", "@", "package", "org", ".", "springframework", ".", "http", ".", "converter", ".", "xml", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stax", ".", "StAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "http", ".", "MediaType", ";", "import", "org", ".", "springframework", ".", "http", ".", "MockHttpInputMessage", ";", "import", "org", ".", "springframework", ".", "http", ".", "MockHttpOutputMessage", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "DefaultHandler", ";", "/", "**", "*", "@", "author", "Arjen", "Poutsma", "*", "/", "public", "class", "SourceHttpMessageConverterTests", "{", "private", "static", "final", "String", "BODY", "=", "\"", "<", "root", ">", "Hello", "World", "<", "/", "root", ">", "\";", "private", "SourceHttpMessageConverter", "<", "Source", ">", "converter", ";", "private", "String", "bodyExternal", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "public", "void", "setUp", "(", ")", "throws", "IOException", "{", "converter", "=", "new", "SourceHttpMessageConverter", "<", "Source", ">", "()", ";", "Resource", "external", "=", "new", "ClassPathResource", "(", "\"", "external", ".", "txt", "\"", ",", "getClass", "(", "))", ";", "bodyExternal", "=", "\"", "<!", "DOCTYPE", "root", "[", "\"", "\"", "<", "!", "ELEMENT", "root", "ANY", ">", "\\", "n", "\"", "\"", "<", "!", "ENTITY", "ext", "SYSTEM", "\\", "\"\"", "+", "external", ".", "getURI", "(", ")", "+", "\"", "\\\"", ">", "]>", "<", "root", ">", "&", "ext", ";", "</", "root", ">", "\";", "}", "@", "Test", "@", "@", "-", "67", ",", "39", "+", "87", ",", "94", "@", "@", "public", "void", "canWrite", "(", ")", "{", "@", "Test", "public", "void", "readDOMSource", "(", ")", "throws", "Exception", "{", "String", "body", "=", "\"", "<", "root", ">", "Hello", "World", "<", "/", "root", ">", "\";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "body", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "BODY", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "DOMSource", "result", "=", "(", "DOMSource", ")", "converter", ".", "read", "(", "DOMSource", ".", "class", ",", "inputMessage", ")", ";", "Document", "document", "=", "(", "Document", ")", "result", ".", "getNode", "(", ");", "assertEquals", "(", "\"", "Invalid", "result", "\"", ",", "\"", "root", "\"", ",", "document", ".", "getDocumentElement", "(", ").", "getLocalName", "(", "))", ";", "}", "@", "Test", "public", "void", "readDOMSourceExternal", "(", ")", "throws", "Exception", "{", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "bodyExternal", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "DOMSource", "result", "=", "(", "DOMSource", ")", "converter", ".", "read", "(", "DOMSource", ".", "class", ",", "inputMessage", ")", ";", "Document", "document", "=", "(", "Document", ")", "result", ".", "getNode", "(", ");", "assertEquals", "(", "\"", "Invalid", "result", "\"", ",", "\"", "root", "\"", ",", "document", ".", "getDocumentElement", "(", ").", "getLocalName", "(", "))", ";", "assertNotEquals", "(", "\"", "Invalid", "result", "\"", ",", "\"", "Foo", "Bar", "\"", ",", "document", ".", "getDocumentElement", "(", ").", "getTextContent", "(", "))", ";", "}", "@", "Test", "public", "void", "readSAXSource", "(", ")", "throws", "Exception", "{", "String", "body", "=", "\"", "<", "root", ">", "Hello", "World", "<", "/", "root", ">", "\";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "body", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "BODY", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "SAXSource", "result", "=", "(", "SAXSource", ")", "converter", ".", "read", "(", "SAXSource", ".", "class", ",", "inputMessage", ")", ";", "InputSource", "inputSource", "=", "result", ".", "getInputSource", "(", ");", "String", "s", "=", "FileCopyUtils", ".", "copyToString", "(", "new", "InputStreamReader", "(", "inputSource", ".", "getByteStream", "(", "))", ");", "assertXMLEqual", "(", "\"", "Invalid", "result", "\"", ",", "body", ",", "s", ")", ";", "assertXMLEqual", "(", "\"", "Invalid", "result", "\"", ",", "BODY", ",", "s", ")", ";", "}", "@", "Test", "public", "void", "readSAXSourceExternal", "(", ")", "throws", "Exception", "{", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "bodyExternal", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "SAXSource", "result", "=", "(", "SAXSource", ")", "converter", ".", "read", "(", "SAXSource", ".", "class", ",", "inputMessage", ")", ";", "InputSource", "inputSource", "=", "result", ".", "getInputSource", "(", ");", "XMLReader", "reader", "=", "result", ".", "getXMLReader", "(", ");", "reader", ".", "setContentHandler", "(", "new", "DefaultHandler", "(", ")", "{", "@", "Override", "public", "void", "characters", "(", "char", "[", "]", "ch", ",", "int", "start", ",", "int", "length", ")", "throws", "SAXException", "{", "String", "s", "=", "new", "String", "(", "ch", ",", "start", ",", "length", ")", ";", "assertNotEquals", "(", "\"", "Invalid", "result", "\"", ",", "\"", "Foo", "Bar", "\"", ",", "s", ")", ";", "}", "}", ");", "reader", ".", "parse", "(", "inputSource", ")", ";", "}", "@", "Test", "public", "void", "readStAXSource", "(", ")", "throws", "Exception", "{", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "BODY", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "StAXSource", "result", "=", "(", "StAXSource", ")", "converter", ".", "read", "(", "StAXSource", ".", "class", ",", "inputMessage", ")", ";", "XMLStreamReader", "streamReader", "=", "result", ".", "getXMLStreamReader", "(", ");", "assertTrue", "(", "streamReader", ".", "hasNext", "(", "))", ";", "streamReader", ".", "nextTag", "(", ");", "String", "s", "=", "streamReader", ".", "getLocalName", "(", ");", "assertEquals", "(", "\"", "root", "\"", ",", "s", ")", ";", "s", "=", "streamReader", ".", "getElementText", "(", ");", "assertEquals", "(", "\"", "Hello", "World", "\"", ",", "s", ")", ";", "streamReader", ".", "close", "(", ");", "}", "@", "Test", "public", "void", "readStAXSourceExternal", "(", ")", "throws", "Exception", "{", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "bodyExternal", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "StAXSource", "result", "=", "(", "StAXSource", ")", "converter", ".", "read", "(", "StAXSource", ".", "class", ",", "inputMessage", ")", ";", "XMLStreamReader", "streamReader", "=", "result", ".", "getXMLStreamReader", "(", ");", "assertTrue", "(", "streamReader", ".", "hasNext", "(", "))", ";", "streamReader", ".", "next", "(", ");", "streamReader", ".", "next", "(", ");", "String", "s", "=", "streamReader", ".", "getLocalName", "(", ");", "assertEquals", "(", "\"", "root", "\"", ",", "s", ")", ";", "s", "=", "streamReader", ".", "getElementText", "(", ");", "assertNotEquals", "(", "\"", "Foo", "Bar", "\"", ",", "s", ")", ";", "streamReader", ".", "close", "(", ");", "}", "@", "Test", "public", "void", "readStreamSource", "(", ")", "throws", "Exception", "{", "String", "body", "=", "\"", "<", "root", ">", "Hello", "World", "<", "/", "root", ">", "\";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "body", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "BODY", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "StreamSource", "result", "=", "(", "StreamSource", ")", "converter", ".", "read", "(", "StreamSource", ".", "class", ",", "inputMessage", ")", ";", "String", "s", "=", "FileCopyUtils", ".", "copyToString", "(", "new", "InputStreamReader", "(", "result", ".", "getInputStream", "(", "))", ");", "assertXMLEqual", "(", "\"", "Invalid", "result", "\"", ",", "body", ",", "s", ")", ";", "assertXMLEqual", "(", "\"", "Invalid", "result", "\"", ",", "BODY", ",", "s", ")", ";", "}", "@", "Test", "public", "void", "readSource", "(", ")", "throws", "Exception", "{", "String", "body", "=", "\"", "<", "root", ">", "Hello", "World", "<", "/", "root", ">", "\";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "body", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "MockHttpInputMessage", "inputMessage", "=", "new", "MockHttpInputMessage", "(", "BODY", ".", "getBytes", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "inputMessage", ".", "getHeaders", "(", ").", "setContentType", "(", "new", "MediaType", "(", "\"", "application", "\"", ",", "\"", "xml", "\"", "))", ";", "converter", ".", "read", "(", "Source", ".", "class", ",", "inputMessage", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "Foo", "Bar"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["tracing/syscalls:", "Ignore", "numbers", "outside", "NR_syscalls'", "range", "ARM", "has", "some", "private", "syscalls", "(for", "example,", "set_tls(2))", "which", "lie", "outside", "the", "range", "of", "NR_syscalls.", "If", "any", "of", "these", "are", "called", "while", "syscall", "tracing", "is", "being", "performed,", "out-of-bounds", "array", "access", "will", "occur", "in", "the", "ftrace", "and", "perf", "sys_{enter,exit}", "handlers.", "#", "trace-cmd", "record", "-e", "raw_syscalls:*", "true", "&&", "trace-cmd", "report", "...", "true-653", "[000]", "384.675777:", "sys_enter:", "NR", "192", "(0,", "1000,", "3,", "4000022,", "ffffffff,", "0)", "true-653", "[000]", "384.675812:", "sys_exit:", "NR", "192", "=", "1995915264", "true-653", "[000]", "384.675971:", "sys_enter:", "NR", "983045", "(76f74480,", "76f74000,", "76f74b28,", "76f74480,", "76f76f74,", "1)", "true-653", "[000]", "384.675988:", "sys_exit:", "NR", "983045", "=", "0", "...", "#", "trace-cmd", "record", "-e", "syscalls:*", "true", "[", "17.289329]", "Unable", "to", "handle", "kernel", "paging", "request", "at", "virtual", "address", "aaaaaace", "[", "17.289590]", "pgd", "=", "9e71c000", "[", "17.289696]", "[aaaaaace]", "*pgd=00000000", "[", "17.289985]", "Internal", "error:", "Oops:", "5", "[#1]", "PREEMPT", "SMP", "ARM", "[", "17.290169]", "Modules", "linked", "in:", "[", "17.290391]", "CPU:", "0", "PID:", "704", "Comm:", "true", "Not", "tainted", "3.18.0-rc2+", "#21", "[", "17.290585]", "task:", "9f4dab00", "ti:", "9e710000", "task.ti:", "9e710000", "[", "17.290747]", "PC", "is", "at", "ftrace_syscall_enter+0x48/0x1f8", "[", "17.290866]", "LR", "is", "at", "syscall_trace_enter+0x124/0x184", "Fix", "this", "by", "ignoring", "out-of-NR_syscalls-bounds", "syscall", "numbers.", "Commit", "cd0980fc8add", "\"tracing:", "Check", "invalid", "syscall", "nr", "while", "tracing", "syscalls\"", "added", "the", "check", "for", "less", "than", "zero,", "but", "it", "should", "have", "also", "checked", "for", "greater", "than", "NR_syscalls.", "Link:", "http://lkml.kernel.org/p/1414620418-29472-1-git-send-email-rabin@rab.in", "Fixes:", "cd0980fc8add", "\"tracing:", "Check", "invalid", "syscall", "nr", "while", "tracing", "syscalls\"", "Cc:", "stable@vger.kernel.org", "#", "2.6.33+", "Signed-off-by:", "Rabin", "Vincent", "<rabin@rab.in>", "Signed-off-by:", "Steven", "Rostedt", "<rostedt@goodmis.org>"], "code_tokens": ["@", "@", "-", "313", ",", "7", "+", "313", ",", "7", "@", "@", "static", "void", "ftrace_syscall_enter", "(", "void", "*", "data", ",", "struct", "pt_regs", "*", "regs", ",", "long", "id", ")", "int", "size", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "/", "*", "Here", "we", "'", "re", "inside", "tp", "handler", "'", "s", "rcu_read_lock_sched", "(", "__DO_TRACE", ")", "*", "/", "@", "@", "-", "360", ",", "7", "+", "360", ",", "7", "@", "@", "static", "void", "ftrace_syscall_exit", "(", "void", "*", "data", ",", "struct", "pt_regs", "*", "regs", ",", "long", "ret", ")", "int", "syscall_nr", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "/", "*", "Here", "we", "'", "re", "inside", "tp", "handler", "'", "s", "rcu_read_lock_sched", "(", "__DO_TRACE", "(", "))", "*", "/", "@", "@", "-", "567", ",", "7", "+", "567", ",", "7", "@", "@", "static", "void", "perf_syscall_enter", "(", "void", "*", "ignore", ",", "struct", "pt_regs", "*", "regs", ",", "long", "id", ")", "int", "size", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "if", "(", "!", "test_bit", "(", "syscall_nr", ",", "enabled_perf_enter_syscalls", ")", ")", "return", ";", "@", "@", "-", "641", ",", "7", "+", "641", ",", "7", "@", "@", "static", "void", "perf_syscall_exit", "(", "void", "*", "ignore", ",", "struct", "pt_regs", "*", "regs", ",", "long", "ret", ")", "int", "size", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "if", "(", "!", "test_bit", "(", "syscall_nr", ",", "enabled_perf_exit_syscalls", ")", ")", "return", ";"], "docstring_tokens": ["the", "system", "to", "crash"]}
{"contents": ["MINOR:", "Test", "SASL", "authorization", "id", "Author:", "Rajini", "Sivaram", "<rajinisivaram@googlemail.com>", "Reviewers:", "Ismael", "Juma", "<ismael@juma.me.uk>", "Closes", "#3766", "from", "rajinisivaram/MINOR-sasl", "(cherry", "picked", "from", "commit", "47c2753496875db2849065ad91ee03c7c842c8e9)", "Signed-off-by:", "Rajini", "Sivaram", "<rajinisivaram@googlemail.com>"], "code_tokens": ["@", "@", "-", "50", ",", "7", "+", "50", ",", "7", "@", "@", "private", "static", "final", "String", "JAAS_USER_PREFIX", "=", "\"", "user_", "\"", ";", "private", "boolean", "complete", ";", "private", "String", "authorizationID", ";", "private", "String", "authorizationId", ";", "public", "PlainSaslServer", "(", "CallbackHandler", "callbackHandler", ")", "{", "}", "@", "@", "-", "78", ",", "7", "+", "78", ",", "7", "@", "@", "public", "PlainSaslServer", "(", "CallbackHandler", "callbackHandler", ")", "{", "}", "if", "(", "tokens", ".", "length", "!", "=", "3", ")", "throw", "new", "SaslException", "(", "\"", "Invalid", "SASL", "/", "PLAIN", "response", ":", "expected", "3", "tokens", ",", "got", "\"", "+", "tokens", ".", "length", ")", ";", "authorizationID", "=", "tokens", "[", "0", "]", ";", "String", "authorizationIdFromClient", "=", "tokens", "[", "0", "]", ";", "String", "username", "=", "tokens", "[", "1", "]", ";", "String", "password", "=", "tokens", "[", "2", "]", ";", "@", "@", "-", "88", ",", "8", "+", "88", ",", "6", "@", "@", "public", "PlainSaslServer", "(", "CallbackHandler", "callbackHandler", ")", "{", "if", "(", "password", ".", "isEmpty", "(", "))", "{", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", ":", "password", "not", "specified", "\"", ");", "}", "if", "(", "authorizationID", ".", "isEmpty", "(", "))", "authorizationID", "=", "username", ";", "try", "{", "String", "expectedPassword", "=", "JaasUtils", ".", "defaultServerJaasConfigOption", "(", "JAAS_USER_PREFIX", "+", "username", ",", "PlainLoginModule", ".", "class", ".", "getName", "(", "))", ";", "@", "@", "-", "99", ",", "6", "+", "97", ",", "12", "@", "@", "public", "PlainSaslServer", "(", "CallbackHandler", "callbackHandler", ")", "{", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", ":", "Invalid", "JAAS", "configuration", "\"", ",", "e", ")", ";", "}", "if", "(", "!", "authorizationIdFromClient", ".", "isEmpty", "(", ")", "&", "&", "!", "authorizationIdFromClient", ".", "equals", "(", "username", ")", ")", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", ":", "Client", "requested", "an", "authorization", "id", "that", "is", "different", "from", "username", "\"", ");", "this", ".", "authorizationId", "=", "username", ";", "complete", "=", "true", ";", "return", "new", "byte", "[", "0", "]", ";", "}", "@", "@", "-", "107", ",", "7", "+", "111", ",", "7", "@", "@", "public", "PlainSaslServer", "(", "CallbackHandler", "callbackHandler", ")", "{", "public", "String", "getAuthorizationID", "(", ")", "{", "if", "(", "!", "complete", ")", "throw", "new", "IllegalStateException", "(", "\"", "Authentication", "exchange", "has", "not", "completed", "\"", ");", "return", "authorizationID", ";", "return", "authorizationId", ";", "}", "@", "Override", "@", "@", "-", "66", ",", "7", "+", "66", ",", "6", "@", "@", "private", "String", "username", ";", "private", "ClientFirstMessage", "clientFirstMessage", ";", "private", "ServerFirstMessage", "serverFirstMessage", ";", "private", "String", "serverNonce", ";", "private", "ScramCredential", "scramCredential", ";", "public", "ScramSaslServer", "(", "ScramMechanism", "mechanism", ",", "Map", "<", "String", ",", "?", ">", "props", ",", "CallbackHandler", "callbackHandler", ")", "throws", "NoSuchAlgorithmException", "{", "@", "@", "-", "82", ",", "7", "+", "81", ",", "7", "@", "@", "public", "ScramSaslServer", "(", "ScramMechanism", "mechanism", ",", "Map", "<", "String", ",", "?", ">", "props", ",", "CallbackH", "switch", "(", "state", ")", "{", "case", "RECEIVE_CLIENT_FIRST_MESSAGE", ":", "this", ".", "clientFirstMessage", "=", "new", "ClientFirstMessage", "(", "response", ")", ";", "serverNonce", "=", "formatter", ".", "secureRandomString", "(", ");", "String", "serverNonce", "=", "formatter", ".", "secureRandomString", "(", ");", "try", "{", "String", "saslName", "=", "clientFirstMessage", ".", "saslName", "(", ");", "this", ".", "username", "=", "formatter", ".", "username", "(", "saslName", ")", ";", "@", "@", "-", "92", ",", "6", "+", "91", ",", "10", "@", "@", "public", "ScramSaslServer", "(", "ScramMechanism", "mechanism", ",", "Map", "<", "String", ",", "?", ">", "props", ",", "CallbackH", "this", ".", "scramCredential", "=", "credentialCallback", ".", "scramCredential", "(", ");", "if", "(", "scramCredential", "=", "=", "null", ")", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", ":", "Invalid", "user", "credentials", "\"", ");", "String", "authorizationIdFromClient", "=", "clientFirstMessage", ".", "authorizationId", "(", ");", "if", "(", "!", "authorizationIdFromClient", ".", "isEmpty", "(", ")", "&", "&", "!", "authorizationIdFromClient", ".", "equals", "(", "username", ")", ")", "throw", "new", "SaslException", "(", "\"", "Authentication", "failed", ":", "Client", "requested", "an", "authorization", "id", "that", "is", "different", "from", "username", "\"", ");", "if", "(", "scramCredential", ".", "iterations", "(", ")", "<", "mechanism", ".", "minIterations", "(", "))", "throw", "new", "SaslException", "(", "\"", "Iterations", "\"", "+", "scramCredential", ".", "iterations", "(", ")", "+", "\"", "is", "less", "than", "the", "minimum", "\"", "+", "mechanism", ".", "minIterations", "(", ")", "+", "\"", "for", "\"", "+", "mechanism", ")", ";", "this", ".", "serverFirstMessage", "=", "new", "ServerFirstMessage", "(", "clientFirstMessage", ".", "nonce", "(", "),", "@", "@", "-", "111", ",", "6", "+", "114", ",", "7", "@", "@", "public", "ScramSaslServer", "(", "ScramMechanism", "mechanism", ",", "Map", "<", "String", ",", "?", ">", "props", ",", "CallbackH", "byte", "[", "]", "serverKey", "=", "scramCredential", ".", "serverKey", "(", ");", "byte", "[", "]", "serverSignature", "=", "formatter", ".", "serverSignature", "(", "serverKey", ",", "clientFirstMessage", ",", "serverFirstMessage", ",", "clientFinalMessage", ")", ";", "ServerFinalMessage", "serverFinalMessage", "=", "new", "ServerFinalMessage", "(", "null", ",", "serverSignature", ")", ";", "clearCredentials", "(", ");", "setState", "(", "State", ".", "COMPLETE", ")", ";", "return", "serverFinalMessage", ".", "toBytes", "(", ");", "}", "catch", "(", "InvalidKeyException", "e", ")", "{", "@", "@", "-", "121", ",", "6", "+", "125", ",", "7", "@", "@", "public", "ScramSaslServer", "(", "ScramMechanism", "mechanism", ",", "Map", "<", "String", ",", "?", ">", "props", ",", "CallbackH", "throw", "new", "IllegalSaslStateException", "(", "\"", "Unexpected", "challenge", "in", "Sasl", "server", "state", "\"", "+", "state", ")", ";", "}", "}", "catch", "(", "SaslException", "e", ")", "{", "clearCredentials", "(", ");", "setState", "(", "State", ".", "FAILED", ")", ";", "throw", "e", ";", "}", "@", "@", "-", "130", ",", "8", "+", "135", ",", "7", "@", "@", "public", "ScramSaslServer", "(", "ScramMechanism", "mechanism", ",", "Map", "<", "String", ",", "?", ">", "props", ",", "CallbackH", "public", "String", "getAuthorizationID", "(", ")", "{", "if", "(", "!", "isComplete", "(", "))", "throw", "new", "IllegalStateException", "(", "\"", "Authentication", "exchange", "has", "not", "completed", "\"", ");", "String", "authzId", "=", "clientFirstMessage", ".", "authorizationId", "(", ");", "return", "authzId", "=", "=", "null", "|", "|", "authzId", ".", "length", "(", ")", "=", "=", "0", "?", "username", ":", "authzId", ";", "return", "username", ";", "}", "@", "Override", "@", "@", "-", "186", ",", "6", "+", "190", ",", "12", "@", "@", "private", "void", "verifyClientProof", "(", "ClientFinalMessage", "clientFinalMessage", ")", "throws", "Sas", "}", "}", "private", "void", "clearCredentials", "(", ")", "{", "scramCredential", "=", "null", ";", "clientFirstMessage", "=", "null", ";", "serverFirstMessage", "=", "null", ";", "}", "public", "static", "class", "ScramSaslServerFactory", "implements", "SaslServerFactory", "{", "@", "Override", "@", "@", "-", "0", ",", "0", "+", "1", ",", "75", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "kafka", ".", "common", ".", "security", ".", "plain", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "security", ".", "JaasContext", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "security", ".", "authenticator", ".", "TestJaasConfig", ";", "public", "class", "PlainSaslServerTest", "{", "private", "static", "final", "String", "USER_A", "=", "\"", "userA", "\"", ";", "private", "static", "final", "String", "PASSWORD_A", "=", "\"", "passwordA", "\"", ";", "private", "static", "final", "String", "USER_B", "=", "\"", "userB", "\"", ";", "private", "static", "final", "String", "PASSWORD_B", "=", "\"", "passwordB", "\"", ";", "private", "PlainSaslServer", "saslServer", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "TestJaasConfig", "jaasConfig", "=", "new", "TestJaasConfig", "(", ");", "Map", "<", "String", ",", "Object", ">", "options", "=", "new", "HashMap", "<", ">(", ");", "options", ".", "put", "(", "\"", "user_", "\"", "+", "USER_A", ",", "PASSWORD_A", ")", ";", "options", ".", "put", "(", "\"", "user_", "\"", "+", "USER_B", ",", "PASSWORD_B", ")", ";", "jaasConfig", ".", "addEntry", "(", "\"", "jaasContext", "\"", ",", "PlainLoginModule", ".", "class", ".", "getName", "(", "),", "options", ")", ";", "JaasContext", "jaasContext", "=", "new", "JaasContext", "(", "\"", "jaasContext", "\"", ",", "JaasContext", ".", "Type", ".", "SERVER", ",", "jaasConfig", ")", ";", "saslServer", "=", "new", "PlainSaslServer", "(", "jaasContext", ")", ";", "}", "@", "Test", "public", "void", "noAuthorizationIdSpecified", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "nextChallenge", "=", "saslServer", ".", "evaluateResponse", "(", "saslMessage", "(", "\"\"", ",", "USER_A", ",", "PASSWORD_A", ")", ");", "assertEquals", "(", "0", ",", "nextChallenge", ".", "length", ")", ";", "}", "@", "Test", "public", "void", "authorizatonIdEqualsAuthenticationId", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "nextChallenge", "=", "saslServer", ".", "evaluateResponse", "(", "saslMessage", "(", "USER_A", ",", "USER_A", ",", "PASSWORD_A", ")", ");", "assertEquals", "(", "0", ",", "nextChallenge", ".", "length", ")", ";", "}", "@", "Test", "(", "expected", "=", "SaslException", ".", "class", ")", "public", "void", "authorizatonIdNotEqualsAuthenticationId", "(", ")", "throws", "Exception", "{", "saslServer", ".", "evaluateResponse", "(", "saslMessage", "(", "USER_B", ",", "USER_A", ",", "PASSWORD_A", ")", ");", "}", "private", "byte", "[", "]", "saslMessage", "(", "String", "authorizationId", ",", "String", "userName", ",", "String", "password", ")", "{", "String", "nul", "=", "\"", "\\", "u0000", "\"", ";", "String", "message", "=", "String", ".", "format", "(", "\"%", "s", "%", "s", "%", "s", "%", "s", "%", "s", "\"", ",", "authorizationId", ",", "nul", ",", "userName", ",", "nul", ",", "password", ")", ";", "return", "message", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "74", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "kafka", ".", "common", ".", "security", ".", "scram", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "javax", ".", "security", ".", "sasl", ".", "SaslException", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "security", ".", "authenticator", ".", "CredentialCache", ";", "public", "class", "ScramSaslServerTest", "{", "private", "static", "final", "String", "USER_A", "=", "\"", "userA", "\"", ";", "private", "static", "final", "String", "USER_B", "=", "\"", "userB", "\"", ";", "private", "ScramMechanism", "mechanism", ";", "private", "ScramFormatter", "formatter", ";", "private", "ScramSaslServer", "saslServer", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "mechanism", "=", "ScramMechanism", ".", "SCRAM_SHA_256", ";", "formatter", "=", "new", "ScramFormatter", "(", "mechanism", ")", ";", "CredentialCache", ".", "Cache", "<", "ScramCredential", ">", "credentialCache", "=", "new", "CredentialCache", "(", ").", "createCache", "(", "mechanism", ".", "mechanismName", "(", "),", "ScramCredential", ".", "class", ")", ";", "credentialCache", ".", "put", "(", "USER_A", ",", "formatter", ".", "generateCredential", "(", "\"", "passwordA", "\"", ",", "4096", ")", ");", "credentialCache", ".", "put", "(", "USER_B", ",", "formatter", ".", "generateCredential", "(", "\"", "passwordB", "\"", ",", "4096", ")", ");", "ScramServerCallbackHandler", "callbackHandler", "=", "new", "ScramServerCallbackHandler", "(", "credentialCache", ")", ";", "saslServer", "=", "new", "ScramSaslServer", "(", "mechanism", ",", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ",", "callbackHandler", ")", ";", "}", "@", "Test", "public", "void", "noAuthorizationIdSpecified", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "nextChallenge", "=", "saslServer", ".", "evaluateResponse", "(", "clientFirstMessage", "(", "USER_A", ",", "null", ")", ");", "assertTrue", "(", "\"", "Next", "challenge", "is", "empty", "\"", ",", "nextChallenge", ".", "length", ">", "0", ")", ";", "}", "@", "Test", "public", "void", "authorizatonIdEqualsAuthenticationId", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "nextChallenge", "=", "saslServer", ".", "evaluateResponse", "(", "clientFirstMessage", "(", "USER_A", ",", "USER_A", ")", ");", "assertTrue", "(", "\"", "Next", "challenge", "is", "empty", "\"", ",", "nextChallenge", ".", "length", ">", "0", ")", ";", "}", "@", "Test", "(", "expected", "=", "SaslException", ".", "class", ")", "public", "void", "authorizatonIdNotEqualsAuthenticationId", "(", ")", "throws", "Exception", "{", "saslServer", ".", "evaluateResponse", "(", "clientFirstMessage", "(", "USER_A", ",", "USER_B", ")", ");", "}", "private", "byte", "[", "]", "clientFirstMessage", "(", "String", "userName", ",", "String", "authorizationId", ")", "{", "String", "nonce", "=", "formatter", ".", "secureRandomString", "(", ");", "String", "authorizationField", "=", "authorizationId", "!", "=", "null", "?", "\"", "a", "=", "\"", "+", "authorizationId", ":", "\"", "\";", "String", "firstMessage", "=", "String", ".", "format", "(", "\"", "n", ",", "%", "s", ",", "n", "=", "%", "s", ",", "r", "=", "%", "s", "\"", ",", "authorizationField", ",", "userName", ",", "nonce", ")", ";", "return", "firstMessage", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "}", "}"], "docstring_tokens": ["impersonate", "other", "users"]}
{"contents": ["userns:", "Don't", "allow", "setgroups", "until", "a", "gid", "mapping", "has", "been", "setablished", "setgroups", "is", "unique", "in", "not", "needing", "a", "valid", "mapping", "before", "it", "can", "be", "called,", "in", "the", "case", "of", "setgroups(0,", "NULL)", "which", "drops", "all", "supplemental", "groups.", "The", "design", "of", "the", "user", "namespace", "assumes", "that", "CAP_SETGID", "can", "not", "actually", "be", "used", "until", "a", "gid", "mapping", "is", "established.", "Therefore", "add", "a", "helper", "function", "to", "see", "if", "the", "user", "namespace", "gid", "mapping", "has", "been", "established", "and", "call", "that", "function", "in", "the", "setgroups", "permission", "check.", "This", "is", "part", "of", "the", "fix", "for", ",", "being", "able", "to", "drop", "groups", "without", "privilege", "using", "user", "namespaces.", "Cc:", "stable@vger.kernel.org", "Reviewed-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>"], "code_tokens": ["@", "@", "-", "63", ",", "6", "+", "63", ",", "7", "@", "@", "extern", "const", "struct", "seq_operations", "proc_projid_seq_operations", ";", "extern", "ssize_t", "proc_uid_map_write", "(", "struct", "file", "*", ",", "const", "char", "__user", "*", ",", "size_t", ",", "loff_t", "*", ");", "extern", "ssize_t", "proc_gid_map_write", "(", "struct", "file", "*", ",", "const", "char", "__user", "*", ",", "size_t", ",", "loff_t", "*", ");", "extern", "ssize_t", "proc_projid_map_write", "(", "struct", "file", "*", ",", "const", "char", "__user", "*", ",", "size_t", ",", "loff_t", "*", ");", "extern", "bool", "userns_may_setgroups", "(", "const", "struct", "user_namespace", "*", "ns", ")", ";", "#", "else", "static", "inline", "struct", "user_namespace", "*", "get_user_ns", "(", "struct", "user_namespace", "*", "ns", ")", "@", "@", "-", "87", ",", "6", "+", "88", ",", "10", "@", "@", "static", "inline", "void", "put_user_ns", "(", "struct", "user_namespace", "*", "ns", ")", "{", "}", "static", "inline", "bool", "userns_may_setgroups", "(", "const", "struct", "user_namespace", "*", "ns", ")", "{", "return", "true", ";", "}", "#", "endif", "#", "endif", "/", "*", "_LINUX_USER_H", "*", "/", "@", "@", "-", "6", ",", "6", "+", "6", ",", "7", "@", "@", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "<", "linux", "/", "security", ".", "h", ">", "#", "include", "<", "linux", "/", "syscalls", ".", "h", ">", "#", "include", "<", "linux", "/", "user_namespace", ".", "h", ">", "#", "include", "<", "asm", "/", "uaccess", ".", "h", ">", "/", "*", "init", "to", "2", "-", "one", "for", "init_task", ",", "one", "to", "ensure", "it", "is", "never", "freed", "*", "/", "@", "@", "-", "217", ",", "7", "+", "218", ",", "8", "@", "@", "bool", "may_setgroups", "(", "void", ")", "{", "struct", "user_namespace", "*", "user_ns", "=", "current_user_ns", "(", ");", "return", "ns_capable", "(", "user_ns", ",", "CAP_SETGID", ")", ";", "return", "ns_capable", "(", "user_ns", ",", "CAP_SETGID", ")", "&", "&", "userns_may_setgroups", "(", "user_ns", ")", ";", "}", "/", "*", "@", "@", "-", "843", ",", "6", "+", "843", ",", "20", "@", "@", "static", "bool", "new_idmap_permitted", "(", "const", "struct", "file", "*", "file", ",", "return", "false", ";", "}", "bool", "userns_may_setgroups", "(", "const", "struct", "user_namespace", "*", "ns", ")", "{", "bool", "allowed", ";", "mutex_lock", "(", "&", "id_map_mutex", ")", ";", "/", "*", "It", "is", "not", "safe", "to", "use", "setgroups", "until", "a", "gid", "mapping", "in", "*", "the", "user", "namespace", "has", "been", "established", ".", "*", "/", "allowed", "=", "ns", "-", ">", "gid_map", ".", "nr_extents", "!", "=", "0", ";", "mutex_unlock", "(", "&", "id_map_mutex", ")", ";", "return", "allowed", ";", "}", "static", "void", "*", "userns_get", "(", "struct", "task_struct", "*", "task", ")", "{", "struct", "user_namespace", "*", "user_ns", ";"], "docstring_tokens": ["bypass", "intended", "file", "permissions"]}
{"contents": ["Fix", "https://issues.apache.org/bugzilla/show_bug.cgi?id=51872", "Ensure", "access", "log", "always", "logs", "the", "correct", "remote", "IP.", "Ensure", "requests", "with", "multiple", "errors", "do", "not", "result", "in", "multiple", "access", "log", "entries.", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1176592", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "466", ",", "10", "+", "466", ",", "8", "@", "@", "public", "void", "log", "(", "org", ".", "apache", ".", "coyote", ".", "Request", "req", ",", "Request", "request", "=", "(", "Request", ")", "req", ".", "getNote", "(", "ADAPTER_NOTES", ")", ";", "Response", "response", "=", "(", "Response", ")", "res", ".", "getNote", "(", "ADAPTER_NOTES", ")", ";", "boolean", "create", "=", "false", ";", "if", "(", "request", "=", "=", "null", ")", "{", "create", "=", "true", ";", "/", "/", "Create", "objects", "request", "=", "connector", ".", "createRequest", "(", ");", "request", ".", "setCoyoteRequest", "(", "req", ")", ";", "@", "@", "-", "511", ",", "9", "+", "509", ",", "7", "@", "@", "public", "void", "log", "(", "org", ".", "apache", ".", "coyote", ".", "Request", "req", ",", "}", "catch", "(", "Throwable", "t", ")", "{", "ExceptionUtils", ".", "handleThrowable", "(", "t", ")", ";", "log", ".", "warn", "(", "sm", ".", "getString", "(", "\"", "coyoteAdapter", ".", "accesslogFail", "\"", "),", "t", ")", ";", "}", "if", "(", "create", ")", "{", "}", "finally", "{", "request", ".", "recycle", "(", ");", "response", ".", "recycle", "(", ");", "}", "@", "@", "-", "759", ",", "7", "+", "759", ",", "6", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "secret", "=", "true", ";", "if", "(", "!", "tmpMB", ".", "equals", "(", "requiredSecret", ")", ")", "{", "response", ".", "setStatus", "(", "403", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "error", "=", "true", ";", "}", "}", "@", "@", "-", "776", ",", "7", "+", "775", ",", "6", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "/", "/", "Check", "if", "secret", "was", "submitted", "if", "required", "if", "(", "(", "requiredSecret", "!", "=", "null", ")", "&", "&", "!", "secret", ")", "{", "response", ".", "setStatus", "(", "403", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "error", "=", "true", ";", "}", "@", "@", "-", "810", ",", "6", "+", "808", ",", "9", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "MessageBytes", "valueMB", "=", "request", ".", "getMimeHeaders", "(", ").", "getValue", "(", "\"", "host", "\"", ");", "parseHost", "(", "valueMB", ")", ";", "if", "(", "error", ")", "{", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "}", "@", "@", "-", "825", ",", "7", "+", "826", ",", "6", "@", "@", "protected", "void", "parseHost", "(", "MessageBytes", "valueMB", ")", "{", "request", ".", "serverName", "(", ").", "duplicate", "(", "request", ".", "localName", "(", "))", ";", "}", "catch", "(", "IOException", "e", ")", "{", "response", ".", "setStatus", "(", "400", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "error", "=", "true", ";", "}", "return", ";", "@", "@", "-", "877", ",", "7", "+", "877", ",", "6", "@", "@", "protected", "void", "parseHost", "(", "MessageBytes", "valueMB", ")", "{", "error", "=", "true", ";", "/", "/", "400", "-", "Bad", "request", "response", ".", "setStatus", "(", "400", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "break", ";", "}", "port", "=", "port", "+", "(", "charValue", "*", "mult", ")", ";", "@", "@", "-", "182", ",", "7", "+", "182", ",", "7", "@", "@", "public", "SocketState", "process", "(", "SocketWrapper", "<", "Long", ">", "socket", ")", "}", "}", "if", "(", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "error", "&", "&", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "/", "/", "503", "-", "Service", "unavailable", "response", ".", "setStatus", "(", "503", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "@", "@", "-", "169", ",", "7", "+", "169", ",", "7", "@", "@", "public", "SocketState", "process", "(", "SocketWrapper", "<", "NioChannel", ">", "socket", ")", "}", "}", "if", "(", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "error", "&", "&", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "/", "/", "503", "-", "Service", "unavailable", "response", ".", "setStatus", "(", "503", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "@", "@", "-", "185", ",", "7", "+", "185", ",", "7", "@", "@", "public", "SocketState", "process", "(", "SocketWrapper", "<", "Socket", ">", "socket", ")", "}", "}", "if", "(", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "error", "&", "&", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "/", "/", "503", "-", "Service", "unavailable", "response", ".", "setStatus", "(", "503", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "@", "@", "-", "897", ",", "7", "+", "897", ",", "6", "@", "@", "public", "SocketState", "process", "(", "SocketWrapper", "<", "S", ">", "socketWrapper", ")", "if", "(", "endpoint", ".", "isPaused", "(", "))", "{", "/", "/", "503", "-", "Service", "unavailable", "response", ".", "setStatus", "(", "503", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "error", "=", "true", ";", "}", "else", "{", "request", ".", "setStartTime", "(", "System", ".", "currentTimeMillis", "(", "))", ";", "@", "@", "-", "1087", ",", "7", "+", "1086", ",", "6", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "\"", "Unsupported", "HTTP", "version", "\\", "\"\"", "+", "protocolMB", "+", "\"\\", "\"\"", ");", "}", "response", ".", "setStatus", "(", "505", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "MessageBytes", "methodMB", "=", "request", ".", "method", "(", ");", "@", "@", "-", "1183", ",", "7", "+", "1181", ",", "6", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "error", "=", "true", ";", "/", "/", "501", "-", "Unimplemented", "response", ".", "setStatus", "(", "501", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "startPos", "=", "commaPos", "+", "1", ";", "commaPos", "=", "transferEncodingValue", ".", "indexOf", "(", "',", "',", "startPos", ")", ";", "@", "@", "-", "1199", ",", "7", "+", "1196", ",", "6", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "\"", "Unsupported", "transfer", "encoding", "\\", "\"\"", "+", "encodingName", "+", "\"\\", "\"\"", ");", "}", "response", ".", "setStatus", "(", "501", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "}", "@", "@", "-", "1222", ",", "7", "+", "1218", ",", "6", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "\"", "host", "header", "missing", "\"", ");", "}", "response", ".", "setStatus", "(", "400", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "parseHost", "(", "valueMB", ")", ";", "@", "@", "-", "1252", ",", "6", "+", "1247", ",", "10", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "request", ".", "setAttribute", "(", "\"", "org", ".", "apache", ".", "tomcat", ".", "comet", ".", "timeout", ".", "support", "\"", ",", "Boolean", ".", "TRUE", ")", ";", "}", "if", "(", "error", ")", "{", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "}", "@", "@", "-", "1471", ",", "7", "+", "1470", ",", "6", "@", "@", "protected", "void", "parseHost", "(", "MessageBytes", "valueMB", ")", "{", "error", "=", "true", ";", "/", "/", "400", "-", "Bad", "request", "response", ".", "setStatus", "(", "400", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "break", ";", "}", "port", "=", "port", "+", "(", "charValue", "*", "mult", ")", ";", "@", "@", "-", "1552", ",", "8", "+", "1550", ",", "9", "@", "@", "public", "void", "endRequest", "(", ")", "{", "ExceptionUtils", ".", "handleThrowable", "(", "t", ")", ";", "getLog", "(", ").", "error", "(", "sm", ".", "getString", "(", "\"", "http11processor", ".", "request", ".", "finish", "\"", "),", "t", ")", ";", "/", "/", "500", "-", "Internal", "Server", "Error", "/", "/", "Can", "'", "t", "add", "a", "500", "to", "the", "access", "log", "since", "that", "has", "already", "been", "/", "/", "written", "in", "the", "Adapter", ".", "service", "method", ".", "response", ".", "setStatus", "(", "500", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "error", "=", "true", ";", "}", "try", "{", "@", "@", "-", "133", ",", "6", "+", "133", ",", "11", "@", "@", "Ensure", "Servlets", "that", "implement", "ContainerServlet", "always", "get", "treated", "as", "restricted", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Ensure", "that", "the", "access", "log", "always", "uses", "the", "correct", "value", "for", "the", "remote", "IP", "address", "associated", "with", "the", "request", "and", "that", "requests", "with", "multiple", "errors", "do", "not", "result", "in", "multiple", "entires", "in", "the", "access", "log", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["UNDERTOW-1430", "problem", "with", "renegotiation", "code"], "code_tokens": ["@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "io", ".", "undertow", ".", "UndertowMessages", ";", "import", "io", ".", "undertow", ".", "UndertowOptions", ";", "import", "io", ".", "undertow", ".", "server", ".", "protocol", ".", "http", ".", "HttpServerConnection", ";", "import", "org", ".", "xnio", ".", "ChannelListener", ";", "import", "org", ".", "xnio", ".", "IoUtils", ";", "import", "org", ".", "xnio", ".", "Options", ";", "@", "@", "-", "160", ",", "21", "+", "161", ",", "29", "@", "@", "public", "void", "renegotiateBufferRequest", "(", "HttpServerExchange", "exchange", ",", "SslClientAuthM", "int", "allowedBuffers", "=", "(", "(", "maxSize", "+", "bufferSize", "-", "1", ")", "/", "bufferSize", ")", ";", "poolArray", "=", "new", "PooledByteBuffer", "[", "allowedBuffers", "]", ";", "poolArray", "[", "usedBuffers", "+", "+]", "=", "pooled", ";", "boolean", "overflow", "=", "false", ";", "try", "{", "int", "res", ";", "do", "{", "for", "(", ";;", ")", "{", "final", "ByteBuffer", "buf", "=", "pooled", ".", "getBuffer", "(", ");", "res", "=", "Channels", ".", "readBlocking", "(", "requestChannel", ",", "buf", ")", ";", "if", "(", "!", "buf", ".", "hasRemaining", "(", "))", "{", "buf", ".", "flip", "(", ");", "pooled", "=", "exchange", ".", "getConnection", "(", ").", "getByteBufferPool", "(", ").", "allocate", "(", ");", "poolArray", "[", "usedBuffers", "+", "+]", "=", "pooled", ";", "if", "(", "allowedBuffers", "=", "=", "usedBuffers", ")", "{", "overflow", "=", "true", ";", "break", ";", "}", "else", "{", "pooled", "=", "exchange", ".", "getConnection", "(", ").", "getByteBufferPool", "(", ").", "allocate", "(", ");", "poolArray", "[", "usedBuffers", "+", "+]", "=", "pooled", ";", "}", "}", "else", "if", "(", "res", "=", "=", "-", "1", ")", "{", "buf", ".", "flip", "(", ");", "break", ";", "}", "}", "while", "(", "res", "!", "=", "-", "1", "&", "&", "usedBuffers", "!", "=", "allowedBuffers", ")", ";", "}", "free", "=", "false", ";", "pooled", ".", "getBuffer", "(", ").", "flip", "(", ");", "Connectors", ".", "ungetRequestBytes", "(", "exchange", ",", "poolArray", ")", ";", "if", "(", "usedBuffers", "=", "=", "allowedBuffers", ")", "{", "if", "(", "overflow", ")", "{", "throw", "new", "SSLPeerUnverifiedException", "(", "\"", "Cannot", "renegotiate", "\"", ");", "}", "renegotiateNoRequest", "(", "exchange", ",", "newAuthMode", ")", ";"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["netfilter:", "x_tables:", "check", "for", "size", "overflow", "Ben", "Hawkes", "says:", "integer", "overflow", "in", "xt_alloc_table_info,", "which", "on", "32-bit", "systems", "can", "lead", "to", "small", "structure", "allocation", "and", "a", "copy_from_user", "based", "heap", "corruption.", "Reported-by:", "Ben", "Hawkes", "<hawkes@google.com>", "Signed-off-by:", "Florian", "Westphal", "<fw@strlen.de>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["@", "@", "-", "659", ",", "6", "+", "659", ",", "9", "@", "@", "struct", "xt_table_info", "*", "xt_alloc_table_info", "(", "unsigned", "int", "size", ")", "struct", "xt_table_info", "*", "info", "=", "NULL", ";", "size_t", "sz", "=", "sizeof", "(", "*", "info", ")", "+", "size", ";", "if", "(", "sz", "<", "sizeof", "(", "*", "info", ")", ")", "return", "NULL", ";", "/", "*", "Pedantry", ":", "prevent", "them", "from", "hitting", "BUG", "(", ")", "in", "vmalloc", ".", "c", "-", "-", "RR", "*", "/", "if", "(", "(", "SMP_ALIGN", "(", "size", ")", ">", ">", "PAGE_SHIFT", ")", "+", "2", ">", "totalram_pages", ")", "return", "NULL", ";"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(heap", "memory", "corruption", ")"]}
{"contents": ["drm:", "block", "userspace", "under", "allocating", "buffer", "and", "having", "drivers", "overwrite", "it", "(v2)", "With", "the", "current", "screwed", "but", "its", "ABI,", "ioctls", "for", "the", "drm,", "Linus", "pointed", "out", "that", "we", "could", "allow", "userspace", "to", "specify", "the", "allocation", "size,", "but", "we", "pass", "it", "to", "the", "driver", "which", "then", "uses", "it", "blindly", "to", "store", "a", "struct.", "Now", "if", "userspace", "specifies", "the", "allocation", "size", "as", "smaller", "than", "the", "driver", "needs,", "the", "driver", "can", "possibly", "overwrite", "memory.", "This", "patch", "restructures", "the", "driver", "ioctls", "so", "we", "store", "the", "structure", "size", "we", "are", "expecting,", "and", "make", "sure", "we", "allocate", "at", "least", "that", "size.", "The", "copy", "from/to", "userspace", "are", "still", "restricted", "to", "the", "size", "the", "user", "specifies,", "this", "allows", "ioctl", "structs", "to", "grow", "on", "both", "sides", "of", "the", "equation.", "Up", "until", "now", "we", "didn't", "really", "use", "the", "DRM_IOCTL", "defines", "in", "the", "kernel,", "so", "this", "cleans", "them", "up", "and", "adds", "them", "for", "nouveau.", "v2:", "fix", "nouveau", "pushbuf", "arg", "(thanks", "to", "Ben", "for", "pointing", "it", "out)", "Reported-by:", "Linus", "Torvalds", "<torvalds@linuxfoundation.org>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["@", "@", "-", "55", ",", "6", "+", "55", ",", "9", "@", "@", "static", "int", "drm_version", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "struct", "drm_file", "*", "file_priv", ")", ";", "#", "define", "DRM_IOCTL_DEF", "(", "ioctl", ",", "_func", ",", "_flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "ioctl", ")", "]", "=", "{", ".", "cmd", "=", "ioctl", ",", ".", "func", "=", "_func", ",", ".", "flags", "=", "_flags", ",", ".", "cmd_drv", "=", "0", "}", "/", "**", "Ioctl", "table", "*", "/", "static", "struct", "drm_ioctl_desc", "drm_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_IOCTL_VERSION", ",", "drm_version", ",", "0", ")", ",", "@", "@", "-", "421", ",", "6", "+", "424", ",", "7", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "int", "retcode", "=", "-", "EINVAL", ";", "char", "stack_kdata", "[", "128", "]", ";", "char", "*", "kdata", "=", "NULL", ";", "unsigned", "int", "usize", ",", "asize", ";", "dev", "=", "file_priv", "-", ">", "minor", "-", ">", "dev", ";", "atomic_inc", "(", "&", "dev", "-", ">", "ioctl_count", ")", ";", "@", "@", "-", "436", ",", "11", "+", "440", ",", "18", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "(", "(", "nr", "<", "DRM_COMMAND_BASE", ")", "|", "|", "(", "nr", ">", "=", "DRM_COMMAND_END", ")", "))", "goto", "err_i1", ";", "if", "(", "(", "nr", ">", "=", "DRM_COMMAND_BASE", ")", "&", "&", "(", "nr", "<", "DRM_COMMAND_END", ")", "&", "&", "(", "nr", "<", "DRM_COMMAND_BASE", "+", "dev", "-", ">", "driver", "-", ">", "num_ioctls", ")", ")", "(", "nr", "<", "DRM_COMMAND_BASE", "+", "dev", "-", ">", "driver", "-", ">", "num_ioctls", ")", ")", "{", "u32", "drv_size", ";", "ioctl", "=", "&", "dev", "-", ">", "driver", "-", ">", "ioctls", "[", "nr", "-", "DRM_COMMAND_BASE", "]", ";", "drv_size", "=", "_IOC_SIZE", "(", "ioctl", "-", ">", "cmd_drv", ")", ";", "usize", "=", "asize", "=", "_IOC_SIZE", "(", "cmd", ")", ";", "if", "(", "drv_size", ">", "asize", ")", "asize", "=", "drv_size", ";", "}", "else", "if", "(", "(", "nr", ">", "=", "DRM_COMMAND_END", ")", "|", "|", "(", "nr", "<", "DRM_COMMAND_BASE", ")", ")", "{", "ioctl", "=", "&", "drm_ioctls", "[", "nr", "]", ";", "cmd", "=", "ioctl", "-", ">", "cmd", ";", "usize", "=", "asize", "=", "_IOC_SIZE", "(", "cmd", ")", ";", "}", "else", "goto", "err_i1", ";", "@", "@", "-", "460", ",", "10", "+", "471", ",", "10", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "retcode", "=", "-", "EACCES", ";", "}", "else", "{", "if", "(", "cmd", "&", "(", "IOC_IN", "|", "IOC_OUT", ")", ")", "{", "if", "(", "_IOC_SIZE", "(", "cmd", ")", "<", "=", "sizeof", "(", "stack_kdata", ")", ")", "{", "if", "(", "asize", "<", "=", "sizeof", "(", "stack_kdata", ")", ")", "{", "kdata", "=", "stack_kdata", ";", "}", "else", "{", "kdata", "=", "kmalloc", "(", "_IOC_SIZE", "(", "cmd", ")", ",", "GFP_KERNEL", ")", ";", "kdata", "=", "kmalloc", "(", "asize", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "kdata", ")", "{", "retcode", "=", "-", "ENOMEM", ";", "goto", "err_i1", ";", "@", "@", "-", "473", ",", "12", "+", "484", ",", "12", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "if", "(", "cmd", "&", "IOC_IN", ")", "{", "if", "(", "copy_from_user", "(", "kdata", ",", "(", "void", "__user", "*", ")", "arg", ",", "_IOC_SIZE", "(", "cmd", ")", ")", "!", "=", "0", ")", "{", "usize", ")", "!", "=", "0", ")", "{", "retcode", "=", "-", "EFAULT", ";", "goto", "err_i1", ";", "}", "}", "else", "memset", "(", "kdata", ",", "0", ",", "_IOC_SIZE", "(", "cmd", ")", ");", "memset", "(", "kdata", ",", "0", ",", "usize", ")", ";", "if", "(", "ioctl", "-", ">", "flags", "&", "DRM_UNLOCKED", ")", "retcode", "=", "func", "(", "dev", ",", "kdata", ",", "file_priv", ")", ";", "@", "@", "-", "490", ",", "7", "+", "501", ",", "7", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "if", "(", "cmd", "&", "IOC_OUT", ")", "{", "if", "(", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "kdata", ",", "_IOC_SIZE", "(", "cmd", ")", ")", "!", "=", "0", ")", "usize", ")", "!", "=", "0", ")", "retcode", "=", "-", "EFAULT", ";", "}", "}", "@", "@", "-", "1255", ",", "21", "+", "1255", ",", "21", "@", "@", "long", "i810_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "}", "struct", "drm_ioctl_desc", "i810_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_I810_INIT", ",", "i810_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_VERTEX", ",", "i810_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_CLEAR", ",", "i810_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_FLUSH", ",", "i810_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_GETAGE", ",", "i810_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_GETBUF", ",", "i810_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_SWAP", ",", "i810_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_COPY", ",", "i810_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_DOCOPY", ",", "i810_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_OV0INFO", ",", "i810_ov0_info", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_FSTATUS", ",", "i810_fstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_OV0FLIP", ",", "i810_ov0_flip", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_MC", ",", "i810_dma_mc", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_RSTATUS", ",", "i810_rstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_FLIP", ",", "i810_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_INIT", ",", "i810_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_VERTEX", ",", "i810_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_CLEAR", ",", "i810_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_FLUSH", ",", "i810_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_GETAGE", ",", "i810_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_GETBUF", ",", "i810_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_SWAP", ",", "i810_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_COPY", ",", "i810_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_DOCOPY", ",", "i810_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_OV0INFO", ",", "i810_ov0_info", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_FSTATUS", ",", "i810_fstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_OV0FLIP", ",", "i810_ov0_flip", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_MC", ",", "i810_dma_mc", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_RSTATUS", ",", "i810_rstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_FLIP", ",", "i810_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "i810_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "i810_ioctls", ")", ";", "@", "@", "-", "1524", ",", "20", "+", "1524", ",", "20", "@", "@", "long", "i830_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "}", "struct", "drm_ioctl_desc", "i830_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_I830_INIT", ",", "i830_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_VERTEX", ",", "i830_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_CLEAR", ",", "i830_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_FLUSH", ",", "i830_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_GETAGE", ",", "i830_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_GETBUF", ",", "i830_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_SWAP", ",", "i830_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_COPY", ",", "i830_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_DOCOPY", ",", "i830_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_FLIP", ",", "i830_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_IRQ_EMIT", ",", "i830_irq_emit", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_IRQ_WAIT", ",", "i830_irq_wait", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_GETPARAM", ",", "i830_getparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_SETPARAM", ",", "i830_setparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_INIT", ",", "i830_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_VERTEX", ",", "i830_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_CLEAR", ",", "i830_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_FLUSH", ",", "i830_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_GETAGE", ",", "i830_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_GETBUF", ",", "i830_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_SWAP", ",", "i830_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_COPY", ",", "i830_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_DOCOPY", ",", "i830_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_FLIP", ",", "i830_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_IRQ_EMIT", ",", "i830_irq_emit", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_IRQ_WAIT", ",", "i830_irq_wait", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_GETPARAM", ",", "i830_getparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_SETPARAM", ",", "i830_setparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "i830_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "i830_ioctls", ")", ";", "@", "@", "-", "2360", ",", "46", "+", "2360", ",", "46", "@", "@", "void", "i915_driver_postclose", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "i915_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_I915_INIT", ",", "i915_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_FLUSH", ",", "i915_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_FLIP", ",", "i915_flip_bufs", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_BATCHBUFFER", ",", "i915_batchbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_IRQ_EMIT", ",", "i915_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_IRQ_WAIT", ",", "i915_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GETPARAM", ",", "i915_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_SETPARAM", ",", "i915_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_ALLOC", ",", "i915_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_FREE", ",", "i915_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_INIT_HEAP", ",", "i915_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_CMDBUFFER", ",", "i915_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_DESTROY_HEAP", ",", "i915_mem_destroy_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_SET_VBLANK_PIPE", ",", "i915_vblank_pipe_set", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GET_VBLANK_PIPE", ",", "i915_vblank_pipe_get", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_VBLANK_SWAP", ",", "i915_vblank_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_HWS_ADDR", ",", "i915_set_status_page", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_INIT", ",", "i915_gem_init_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_EXECBUFFER", ",", "i915_gem_execbuffer", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_EXECBUFFER2", ",", "i915_gem_execbuffer2", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_PIN", ",", "i915_gem_pin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_UNPIN", ",", "i915_gem_unpin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_BUSY", ",", "i915_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_THROTTLE", ",", "i915_gem_throttle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_ENTERVT", ",", "i915_gem_entervt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_LEAVEVT", ",", "i915_gem_leavevt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_CREATE", ",", "i915_gem_create_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_PREAD", ",", "i915_gem_pread_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_PWRITE", ",", "i915_gem_pwrite_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_MMAP", ",", "i915_gem_mmap_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_MMAP_GTT", ",", "i915_gem_mmap_gtt_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_SET_DOMAIN", ",", "i915_gem_set_domain_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_SW_FINISH", ",", "i915_gem_sw_finish_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_SET_TILING", ",", "i915_gem_set_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_GET_TILING", ",", "i915_gem_get_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_GET_APERTURE", ",", "i915_gem_get_aperture_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GET_PIPE_FROM_CRTC_ID", ",", "intel_get_pipe_from_crtc_id", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_MADVISE", ",", "i915_gem_madvise_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_OVERLAY_PUT_IMAGE", ",", "intel_overlay_put_image", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_OVERLAY_ATTRS", ",", "intel_overlay_attrs", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_INIT", ",", "i915_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_FLUSH", ",", "i915_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_FLIP", ",", "i915_flip_bufs", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_BATCHBUFFER", ",", "i915_batchbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_IRQ_EMIT", ",", "i915_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_IRQ_WAIT", ",", "i915_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GETPARAM", ",", "i915_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_SETPARAM", ",", "i915_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_ALLOC", ",", "i915_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_FREE", ",", "i915_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_INIT_HEAP", ",", "i915_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_CMDBUFFER", ",", "i915_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_DESTROY_HEAP", ",", "i915_mem_destroy_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_SET_VBLANK_PIPE", ",", "i915_vblank_pipe_set", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GET_VBLANK_PIPE", ",", "i915_vblank_pipe_get", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_VBLANK_SWAP", ",", "i915_vblank_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_HWS_ADDR", ",", "i915_set_status_page", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_INIT", ",", "i915_gem_init_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_EXECBUFFER", ",", "i915_gem_execbuffer", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_EXECBUFFER2", ",", "i915_gem_execbuffer2", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_PIN", ",", "i915_gem_pin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_UNPIN", ",", "i915_gem_unpin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_BUSY", ",", "i915_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_THROTTLE", ",", "i915_gem_throttle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_ENTERVT", ",", "i915_gem_entervt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_LEAVEVT", ",", "i915_gem_leavevt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_CREATE", ",", "i915_gem_create_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_PREAD", ",", "i915_gem_pread_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_PWRITE", ",", "i915_gem_pwrite_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_MMAP", ",", "i915_gem_mmap_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_MMAP_GTT", ",", "i915_gem_mmap_gtt_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_SET_DOMAIN", ",", "i915_gem_set_domain_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_SW_FINISH", ",", "i915_gem_sw_finish_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_SET_TILING", ",", "i915_gem_set_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_GET_TILING", ",", "i915_gem_get_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_GET_APERTURE", ",", "i915_gem_get_aperture_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GET_PIPE_FROM_CRTC_ID", ",", "intel_get_pipe_from_crtc_id", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_MADVISE", ",", "i915_gem_madvise_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_OVERLAY_PUT_IMAGE", ",", "intel_overlay_put_image", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_OVERLAY_ATTRS", ",", "intel_overlay_attrs", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "i915_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "i915_ioctls", ")", ";", "@", "@", "-", "1085", ",", "19", "+", "1085", ",", "19", "@", "@", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "mga_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_MGA_INIT", ",", "mga_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_FLUSH", ",", "mga_dma_flush", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_RESET", ",", "mga_dma_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_SWAP", ",", "mga_dma_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_CLEAR", ",", "mga_dma_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_VERTEX", ",", "mga_dma_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_INDICES", ",", "mga_dma_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_ILOAD", ",", "mga_dma_iload", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_BLIT", ",", "mga_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_GETPARAM", ",", "mga_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_SET_FENCE", ",", "mga_set_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_WAIT_FENCE", ",", "mga_wait_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_DMA_BOOTSTRAP", ",", "mga_dma_bootstrap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_INIT", ",", "mga_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_FLUSH", ",", "mga_dma_flush", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_RESET", ",", "mga_dma_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_SWAP", ",", "mga_dma_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_CLEAR", ",", "mga_dma_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_VERTEX", ",", "mga_dma_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_INDICES", ",", "mga_dma_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_ILOAD", ",", "mga_dma_iload", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_BLIT", ",", "mga_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_GETPARAM", ",", "mga_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_SET_FENCE", ",", "mga_set_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_WAIT_FENCE", ",", "mga_wait_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_DMA_BOOTSTRAP", ",", "mga_dma_bootstrap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "}", ";", "int", "mga_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "mga_ioctls", ")", ";", "@", "@", "-", "426", ",", "18", "+", "426", ",", "18", "@", "@", "nouveau_ioctl_fifo_free", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "struct", "drm_ioctl_desc", "nouveau_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GETPARAM", ",", "nouveau_ioctl_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_SETPARAM", ",", "nouveau_ioctl_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_CHANNEL_ALLOC", ",", "nouveau_ioctl_fifo_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_CHANNEL_FREE", ",", "nouveau_ioctl_fifo_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GROBJ_ALLOC", ",", "nouveau_ioctl_grobj_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_NOTIFIEROBJ_ALLOC", ",", "nouveau_ioctl_notifier_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GPUOBJ_FREE", ",", "nouveau_ioctl_gpuobj_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_NEW", ",", "nouveau_gem_ioctl_new", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_PUSHBUF", ",", "nouveau_gem_ioctl_pushbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_CPU_PREP", ",", "nouveau_gem_ioctl_cpu_prep", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_CPU_FINI", ",", "nouveau_gem_ioctl_cpu_fini", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_INFO", ",", "nouveau_gem_ioctl_info", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GETPARAM", ",", "nouveau_ioctl_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_SETPARAM", ",", "nouveau_ioctl_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_CHANNEL_ALLOC", ",", "nouveau_ioctl_fifo_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_CHANNEL_FREE", ",", "nouveau_ioctl_fifo_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GROBJ_ALLOC", ",", "nouveau_ioctl_grobj_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_NOTIFIEROBJ_ALLOC", ",", "nouveau_ioctl_notifier_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GPUOBJ_FREE", ",", "nouveau_ioctl_gpuobj_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_NEW", ",", "nouveau_gem_ioctl_new", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_PUSHBUF", ",", "nouveau_gem_ioctl_pushbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_CPU_PREP", ",", "nouveau_gem_ioctl_cpu_prep", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_CPU_FINI", ",", "nouveau_gem_ioctl_cpu_fini", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_INFO", ",", "nouveau_gem_ioctl_info", ",", "DRM_AUTH", ")", ",", "}", ";", "int", "nouveau_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "nouveau_ioctls", ")", ";", "@", "@", "-", "1639", ",", "30", "+", "1639", ",", "29", "@", "@", "void", "r128_driver_preclose", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "r128_do_cleanup_pageflip", "(", "dev", ")", ";", "}", "}", "void", "r128_driver_lastclose", "(", "struct", "drm_device", "*", "dev", ")", "{", "r128_do_cleanup_cce", "(", "dev", ")", ";", "}", "struct", "drm_ioctl_desc", "r128_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_R128_INIT", ",", "r128_cce_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_START", ",", "r128_cce_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_STOP", ",", "r128_cce_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_RESET", ",", "r128_cce_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_IDLE", ",", "r128_cce_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_RESET", ",", "r128_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_FULLSCREEN", ",", "r128_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_SWAP", ",", "r128_cce_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_FLIP", ",", "r128_cce_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CLEAR", ",", "r128_cce_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_VERTEX", ",", "r128_cce_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_INDICES", ",", "r128_cce_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_BLIT", ",", "r128_cce_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_DEPTH", ",", "r128_cce_depth", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_STIPPLE", ",", "r128_cce_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_INDIRECT", ",", "r128_cce_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_GETPARAM", ",", "r128_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_INIT", ",", "r128_cce_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_START", ",", "r128_cce_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_STOP", ",", "r128_cce_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_RESET", ",", "r128_cce_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_IDLE", ",", "r128_cce_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_RESET", ",", "r128_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_FULLSCREEN", ",", "r128_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_SWAP", ",", "r128_cce_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_FLIP", ",", "r128_cce_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CLEAR", ",", "r128_cce_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_VERTEX", ",", "r128_cce_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_INDICES", ",", "r128_cce_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_BLIT", ",", "r128_cce_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_DEPTH", ",", "r128_cce_depth", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_STIPPLE", ",", "r128_cce_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_INDIRECT", ",", "r128_cce_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_GETPARAM", ",", "r128_getparam", ",", "DRM_AUTH", ")", ",", "}", ";", "int", "r128_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "r128_ioctls", ")", ";", "@", "@", "-", "323", ",", "45", "+", "323", ",", "45", "@", "@", "KMS_INVALID_IOCTL", "(", "radeon_surface_free_kms", ")", "struct", "drm_ioctl_desc", "radeon_ioctls_kms", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_INIT", ",", "radeon_cp_init_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_START", ",", "radeon_cp_start_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_STOP", ",", "radeon_cp_stop_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESET", ",", "radeon_cp_reset_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_IDLE", ",", "radeon_cp_idle_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESUME", ",", "radeon_cp_resume_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_RESET", ",", "radeon_engine_reset_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FULLSCREEN", ",", "radeon_fullscreen_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SWAP", ",", "radeon_cp_swap_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CLEAR", ",", "radeon_cp_clear_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX", ",", "radeon_cp_vertex_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDICES", ",", "radeon_cp_indices_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_TEXTURE", ",", "radeon_cp_texture_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_STIPPLE", ",", "radeon_cp_stipple_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDIRECT", ",", "radeon_cp_indirect_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX2", ",", "radeon_cp_vertex2_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CMDBUF", ",", "radeon_cp_cmdbuf_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GETPARAM", ",", "radeon_cp_getparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FLIP", ",", "radeon_cp_flip_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_ALLOC", ",", "radeon_mem_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FREE", ",", "radeon_mem_free_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INIT_HEAP", ",", "radeon_mem_init_heap_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_EMIT", ",", "radeon_irq_emit_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_WAIT", ",", "radeon_irq_wait_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SETPARAM", ",", "radeon_cp_setparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_ALLOC", ",", "radeon_surface_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_FREE", ",", "radeon_surface_free_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_INIT", ",", "radeon_cp_init_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_START", ",", "radeon_cp_start_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_STOP", ",", "radeon_cp_stop_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESET", ",", "radeon_cp_reset_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_IDLE", ",", "radeon_cp_idle_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESUME", ",", "radeon_cp_resume_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_RESET", ",", "radeon_engine_reset_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FULLSCREEN", ",", "radeon_fullscreen_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SWAP", ",", "radeon_cp_swap_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CLEAR", ",", "radeon_cp_clear_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX", ",", "radeon_cp_vertex_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDICES", ",", "radeon_cp_indices_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_TEXTURE", ",", "radeon_cp_texture_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_STIPPLE", ",", "radeon_cp_stipple_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDIRECT", ",", "radeon_cp_indirect_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX2", ",", "radeon_cp_vertex2_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CMDBUF", ",", "radeon_cp_cmdbuf_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GETPARAM", ",", "radeon_cp_getparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FLIP", ",", "radeon_cp_flip_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_ALLOC", ",", "radeon_mem_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FREE", ",", "radeon_mem_free_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INIT_HEAP", ",", "radeon_mem_init_heap_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_EMIT", ",", "radeon_irq_emit_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_WAIT", ",", "radeon_irq_wait_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SETPARAM", ",", "radeon_cp_setparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_ALLOC", ",", "radeon_surface_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_FREE", ",", "radeon_surface_free_kms", ",", "DRM_AUTH", ")", ",", "/", "*", "KMS", "*", "/", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_INFO", ",", "radeon_gem_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_CREATE", ",", "radeon_gem_create_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_MMAP", ",", "radeon_gem_mmap_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_SET_DOMAIN", ",", "radeon_gem_set_domain_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_PREAD", ",", "radeon_gem_pread_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_PWRITE", ",", "radeon_gem_pwrite_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_WAIT_IDLE", ",", "radeon_gem_wait_idle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CS", ",", "radeon_cs_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INFO", ",", "radeon_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_SET_TILING", ",", "radeon_gem_set_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_GET_TILING", ",", "radeon_gem_get_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_BUSY", ",", "radeon_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_INFO", ",", "radeon_gem_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_CREATE", ",", "radeon_gem_create_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_MMAP", ",", "radeon_gem_mmap_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_SET_DOMAIN", ",", "radeon_gem_set_domain_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_PREAD", ",", "radeon_gem_pread_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_PWRITE", ",", "radeon_gem_pwrite_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_WAIT_IDLE", ",", "radeon_gem_wait_idle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CS", ",", "radeon_cs_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INFO", ",", "radeon_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_SET_TILING", ",", "radeon_gem_set_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_GET_TILING", ",", "radeon_gem_get_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_BUSY", ",", "radeon_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "radeon_max_kms_ioctl", "=", "DRM_ARRAY_SIZE", "(", "radeon_ioctls_kms", ")", ";", "@", "@", "-", "3228", ",", "34", "+", "3228", ",", "34", "@", "@", "void", "radeon_driver_postclose", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "radeon_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_INIT", ",", "radeon_cp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_START", ",", "radeon_cp_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_STOP", ",", "radeon_cp_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESET", ",", "radeon_cp_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_IDLE", ",", "radeon_cp_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESUME", ",", "radeon_cp_resume", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_RESET", ",", "radeon_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FULLSCREEN", ",", "radeon_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SWAP", ",", "radeon_cp_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CLEAR", ",", "radeon_cp_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX", ",", "radeon_cp_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDICES", ",", "radeon_cp_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_TEXTURE", ",", "radeon_cp_texture", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_STIPPLE", ",", "radeon_cp_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDIRECT", ",", "radeon_cp_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX2", ",", "radeon_cp_vertex2", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CMDBUF", ",", "radeon_cp_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GETPARAM", ",", "radeon_cp_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FLIP", ",", "radeon_cp_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_ALLOC", ",", "radeon_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FREE", ",", "radeon_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INIT_HEAP", ",", "radeon_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_EMIT", ",", "radeon_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_WAIT", ",", "radeon_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SETPARAM", ",", "radeon_cp_setparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_ALLOC", ",", "radeon_surface_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_FREE", ",", "radeon_surface_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CS", ",", "r600_cs_legacy_ioctl", ",", "DRM_AUTH", ")", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_INIT", ",", "radeon_cp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_START", ",", "radeon_cp_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_STOP", ",", "radeon_cp_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESET", ",", "radeon_cp_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_IDLE", ",", "radeon_cp_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESUME", ",", "radeon_cp_resume", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_RESET", ",", "radeon_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FULLSCREEN", ",", "radeon_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SWAP", ",", "radeon_cp_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CLEAR", ",", "radeon_cp_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX", ",", "radeon_cp_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDICES", ",", "radeon_cp_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_TEXTURE", ",", "radeon_cp_texture", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_STIPPLE", ",", "radeon_cp_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDIRECT", ",", "radeon_cp_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX2", ",", "radeon_cp_vertex2", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CMDBUF", ",", "radeon_cp_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GETPARAM", ",", "radeon_cp_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FLIP", ",", "radeon_cp_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_ALLOC", ",", "radeon_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FREE", ",", "radeon_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INIT_HEAP", ",", "radeon_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_EMIT", ",", "radeon_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_WAIT", ",", "radeon_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SETPARAM", ",", "radeon_cp_setparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_ALLOC", ",", "radeon_surface_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_FREE", ",", "radeon_surface_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CS", ",", "r600_cs_legacy_ioctl", ",", "DRM_AUTH", ")", "}", ";", "int", "radeon_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "radeon_ioctls", ")", ";", "@", "@", "-", "1082", ",", "10", "+", "1082", ",", "10", "@", "@", "void", "savage_reclaim_buffers", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "savage_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_INIT", ",", "savage_bci_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_CMDBUF", ",", "savage_bci_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_EVENT_EMIT", ",", "savage_bci_event_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_EVENT_WAIT", ",", "savage_bci_event_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_INIT", ",", "savage_bci_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_CMDBUF", ",", "savage_bci_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_EVENT_EMIT", ",", "savage_bci_event_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_EVENT_WAIT", ",", "savage_bci_event_wait", ",", "DRM_AUTH", ")", ",", "}", ";", "int", "savage_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "savage_ioctls", ")", ";", "@", "@", "-", "320", ",", "12", "+", "320", ",", "12", "@", "@", "void", "sis_reclaim_buffers_locked", "(", "struct", "drm_device", "*", "dev", ",", "}", "struct", "drm_ioctl_desc", "sis_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_SIS_FB_ALLOC", ",", "sis_fb_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_FB_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_AGP_INIT", ",", "sis_ioctl_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_AGP_ALLOC", ",", "sis_ioctl_agp_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_AGP_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_FB_INIT", ",", "sis_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_FB_ALLOC", ",", "sis_fb_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_FB_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_AGP_INIT", ",", "sis_ioctl_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_AGP_ALLOC", ",", "sis_ioctl_agp_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_AGP_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_FB_INIT", ",", "sis_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "}", ";", "int", "sis_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "sis_ioctls", ")", ";", "@", "@", "-", "722", ",", "20", "+", "722", ",", "20", "@", "@", "static", "int", "via_cmdbuf_size", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "struct", "drm_file", "*", "}", "struct", "drm_ioctl_desc", "via_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_VIA_ALLOCMEM", ",", "via_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_FREEMEM", ",", "via_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_AGP_INIT", ",", "via_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_FB_INIT", ",", "via_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_MAP_INIT", ",", "via_map_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_DEC_FUTEX", ",", "via_decoder_futex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_DMA_INIT", ",", "via_dma_init", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_CMDBUFFER", ",", "via_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_FLUSH", ",", "via_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_PCICMD", ",", "via_pci_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_CMDBUF_SIZE", ",", "via_cmdbuf_size", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_WAIT_IRQ", ",", "via_wait_irq", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_DMA_BLIT", ",", "via_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_BLIT_SYNC", ",", "via_dma_blit_sync", ",", "DRM_AUTH", ")", "DRM_IOCTL_DEF_DRV", "(", "VIA_ALLOCMEM", ",", "via_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_FREEMEM", ",", "via_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_AGP_INIT", ",", "via_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_FB_INIT", ",", "via_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_MAP_INIT", ",", "via_map_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_DEC_FUTEX", ",", "via_decoder_futex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_DMA_INIT", ",", "via_dma_init", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_CMDBUFFER", ",", "via_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_FLUSH", ",", "via_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_PCICMD", ",", "via_pci_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_CMDBUF_SIZE", ",", "via_cmdbuf_size", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_WAIT_IRQ", ",", "via_wait_irq", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_DMA_BLIT", ",", "via_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_BLIT_SYNC", ",", "via_dma_blit_sync", ",", "DRM_AUTH", ")", "}", ";", "int", "via_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "via_ioctls", ")", ";", "@", "@", "-", "99", ",", "47", "+", "99", ",", "47", "@", "@", "*", "/", "#", "define", "VMW_IOCTL_DEF", "(", "ioctl", ",", "func", ",", "flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "ioctl", ")", "-", "DRM_COMMAND_BASE", "]", "=", "{", "ioctl", ",", "flags", ",", "func", "}", "[", "DRM_IOCTL_NR", "(", "DRM_IOCTL_", "#", "#", "ioctl", ")", "-", "DRM_COMMAND_BASE", "]", "=", "{", "DRM_", "#", "#", "ioctl", ",", "flags", ",", "func", ",", "DRM_IOCTL_", "#", "#", "ioctl", "}", "/", "**", "*", "Ioctl", "definitions", ".", "*", "/", "static", "struct", "drm_ioctl_desc", "vmw_ioctls", "[", "]", "=", "{", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_GET_PARAM", ",", "vmw_getparam_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_GET_PARAM", ",", "vmw_getparam_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_ALLOC_DMABUF", ",", "vmw_dmabuf_alloc_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_ALLOC_DMABUF", ",", "vmw_dmabuf_alloc_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_DMABUF", ",", "vmw_dmabuf_unref_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_DMABUF", ",", "vmw_dmabuf_unref_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CURSOR_BYPASS", ",", "VMW_IOCTL_DEF", "(", "VMW_CURSOR_BYPASS", ",", "vmw_kms_cursor_bypass_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CONTROL_STREAM", ",", "vmw_overlay_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CONTROL_STREAM", ",", "vmw_overlay_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CLAIM_STREAM", ",", "vmw_stream_claim_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CLAIM_STREAM", ",", "vmw_stream_claim_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_STREAM", ",", "vmw_stream_unref_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_STREAM", ",", "vmw_stream_unref_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CREATE_CONTEXT", ",", "vmw_context_define_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CREATE_CONTEXT", ",", "vmw_context_define_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_CONTEXT", ",", "vmw_context_destroy_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_CONTEXT", ",", "vmw_context_destroy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CREATE_SURFACE", ",", "vmw_surface_define_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CREATE_SURFACE", ",", "vmw_surface_define_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_SURFACE", ",", "vmw_surface_destroy_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_SURFACE", ",", "vmw_surface_destroy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_REF_SURFACE", ",", "vmw_surface_reference_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_REF_SURFACE", ",", "vmw_surface_reference_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_EXECBUF", ",", "vmw_execbuf_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_EXECBUF", ",", "vmw_execbuf_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_FIFO_DEBUG", ",", "vmw_fifo_debug_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_FIFO_DEBUG", ",", "vmw_fifo_debug_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_MASTER", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_FENCE_WAIT", ",", "vmw_fence_wait_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_FENCE_WAIT", ",", "vmw_fence_wait_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UPDATE_LAYOUT", ",", "vmw_kms_update_layout_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UPDATE_LAYOUT", ",", "vmw_kms_update_layout_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", "}", ";", "@", "@", "-", "305", ",", "14", "+", "305", ",", "16", "@", "@", "struct", "drm_ioctl_desc", "{", "unsigned", "int", "cmd", ";", "int", "flags", ";", "drm_ioctl_t", "*", "func", ";", "unsigned", "int", "cmd_drv", ";", "}", ";", "/", "**", "*", "Creates", "a", "driver", "or", "general", "drm_ioctl_desc", "array", "entry", "for", "the", "given", "*", "ioctl", ",", "for", "use", "by", "drm_ioctl", "(", ").", "*", "/", "#", "define", "DRM_IOCTL_DEF", "(", "ioctl", ",", "_func", ",", "_flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "ioctl", ")", "]", "=", "{", ".", "cmd", "=", "ioctl", ",", ".", "func", "=", "_func", ",", ".", "flags", "=", "_flags", "}", "#", "define", "DRM_IOCTL_DEF_DRV", "(", "ioctl", ",", "_func", ",", "_flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "DRM_", "#", "#", "ioctl", ")", "]", "=", "{", ".", "cmd", "=", "DRM_", "#", "#", "ioctl", ",", ".", "func", "=", "_func", ",", ".", "flags", "=", "_flags", ",", ".", "cmd_drv", "=", "DRM_IOCTL_", "#", "#", "ioctl", "}", "struct", "drm_magic_entry", "{", "struct", "list_head", "head", ";", "@", "@", "-", "264", ",", "20", "+", "264", ",", "20", "@", "@", "typedef", "struct", "_drm_i830_sarea", "{", "#", "define", "DRM_I830_GETPARAM", "0x0c", "#", "define", "DRM_I830_SETPARAM", "0x0d", "#", "define", "DRM_IOCTL_I830_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_INIT", ",", "drm_i830_init_t", ")", "#", "define", "DRM_IOCTL_I830_VERTEX", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_VERTEX", ",", "drm_i830_vertex_t", ")", "#", "define", "DRM_IOCTL_I830_CLEAR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_CLEAR", ",", "drm_i830_clear_t", ")", "#", "define", "DRM_IOCTL_I830_FLUSH", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_FLUSH", ")", "#", "define", "DRM_IOCTL_I830_GETAGE", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_GETAGE", ")", "#", "define", "DRM_IOCTL_I830_GETBUF", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_GETBUF", ",", "drm_i830_dma_t", ")", "#", "define", "DRM_IOCTL_I830_SWAP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_SWAP", ")", "#", "define", "DRM_IOCTL_I830_COPY", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_COPY", ",", "drm_i830_copy_t", ")", "#", "define", "DRM_IOCTL_I830_DOCOPY", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_DOCOPY", ")", "#", "define", "DRM_IOCTL_I830_FLIP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_FLIP", ")", "#", "define", "DRM_IOCTL_I830_IRQ_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_IRQ_EMIT", ",", "drm_i830_irq_emit_t", ")", "#", "define", "DRM_IOCTL_I830_IRQ_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_IRQ_WAIT", ",", "drm_i830_irq_wait_t", ")", "#", "define", "DRM_IOCTL_I830_GETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_GETPARAM", ",", "drm_i830_getparam_t", ")", "#", "define", "DRM_IOCTL_I830_SETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_SETPARAM", ",", "drm_i830_setparam_t", ")", "#", "define", "DRM_IOCTL_I830_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_INIT", ",", "drm_i830_init_t", ")", "#", "define", "DRM_IOCTL_I830_VERTEX", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_VERTEX", ",", "drm_i830_vertex_t", ")", "#", "define", "DRM_IOCTL_I830_CLEAR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_CLEAR", ",", "drm_i830_clear_t", ")", "#", "define", "DRM_IOCTL_I830_FLUSH", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_FLUSH", ")", "#", "define", "DRM_IOCTL_I830_GETAGE", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_GETAGE", ")", "#", "define", "DRM_IOCTL_I830_GETBUF", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_GETBUF", ",", "drm_i830_dma_t", ")", "#", "define", "DRM_IOCTL_I830_SWAP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_SWAP", ")", "#", "define", "DRM_IOCTL_I830_COPY", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_COPY", ",", "drm_i830_copy_t", ")", "#", "define", "DRM_IOCTL_I830_DOCOPY", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_DOCOPY", ")", "#", "define", "DRM_IOCTL_I830_FLIP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_FLIP", ")", "#", "define", "DRM_IOCTL_I830_IRQ_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_IRQ_EMIT", ",", "drm_i830_irq_emit_t", ")", "#", "define", "DRM_IOCTL_I830_IRQ_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_IRQ_WAIT", ",", "drm_i830_irq_wait_t", ")", "#", "define", "DRM_IOCTL_I830_GETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_GETPARAM", ",", "drm_i830_getparam_t", ")", "#", "define", "DRM_IOCTL_I830_SETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_SETPARAM", ",", "drm_i830_setparam_t", ")", "typedef", "struct", "_drm_i830_clear", "{", "int", "clear_color", ";", "@", "@", "-", "206", ",", "6", "+", "206", ",", "7", "@", "@", "typedef", "struct", "_drm_i915_sarea", "{", "#", "define", "DRM_IOCTL_I915_SET_VBLANK_PIPE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_SET_VBLANK_PIPE", ",", "drm_i915_vblank_pipe_t", ")", "#", "define", "DRM_IOCTL_I915_GET_VBLANK_PIPE", "DRM_IOR", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GET_VBLANK_PIPE", ",", "drm_i915_vblank_pipe_t", ")", "#", "define", "DRM_IOCTL_I915_VBLANK_SWAP", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_VBLANK_SWAP", ",", "drm_i915_vblank_swap_t", ")", "#", "define", "DRM_IOCTL_I915_HWS_ADDR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_HWS_ADDR", ",", "struct", "drm_i915_gem_init", ")", "#", "define", "DRM_IOCTL_I915_GEM_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GEM_INIT", ",", "struct", "drm_i915_gem_init", ")", "#", "define", "DRM_IOCTL_I915_GEM_EXECBUFFER", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GEM_EXECBUFFER", ",", "struct", "drm_i915_gem_execbuffer", ")", "#", "define", "DRM_IOCTL_I915_GEM_EXECBUFFER2", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GEM_EXECBUFFER2", ",", "struct", "drm_i915_gem_execbuffer2", ")", "@", "@", "-", "248", ",", "7", "+", "248", ",", "7", "@", "@", "typedef", "struct", "_drm_mga_sarea", "{", "#", "define", "DRM_MGA_DMA_BOOTSTRAP", "0x0c", "#", "define", "DRM_IOCTL_MGA_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_INIT", ",", "drm_mga_init_t", ")", "#", "define", "DRM_IOCTL_MGA_FLUSH", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_FLUSH", ",", "drm_lock_t", ")", "#", "define", "DRM_IOCTL_MGA_FLUSH", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_FLUSH", ",", "struct", "drm_lock", ")", "#", "define", "DRM_IOCTL_MGA_RESET", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_RESET", ")", "#", "define", "DRM_IOCTL_MGA_SWAP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_SWAP", ")", "#", "define", "DRM_IOCTL_MGA_CLEAR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_CLEAR", ",", "drm_mga_clear_t", ")", "@", "@", "-", "197", ",", "4", "+", "197", ",", "17", "@", "@", "struct", "drm_nouveau_sarea", "{", "#", "define", "DRM_NOUVEAU_GEM_CPU_FINI", "0x43", "#", "define", "DRM_NOUVEAU_GEM_INFO", "0x44", "#", "define", "DRM_IOCTL_NOUVEAU_GETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GETPARAM", ",", "struct", "drm_nouveau_getparam", ")", "#", "define", "DRM_IOCTL_NOUVEAU_SETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_SETPARAM", ",", "struct", "drm_nouveau_setparam", ")", "#", "define", "DRM_IOCTL_NOUVEAU_CHANNEL_ALLOC", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_CHANNEL_ALLOC", ",", "struct", "drm_nouveau_channel_alloc", ")", "#", "define", "DRM_IOCTL_NOUVEAU_CHANNEL_FREE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_CHANNEL_FREE", ",", "struct", "drm_nouveau_channel_free", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GROBJ_ALLOC", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GROBJ_ALLOC", ",", "struct", "drm_nouveau_grobj_alloc", ")", "#", "define", "DRM_IOCTL_NOUVEAU_NOTIFIEROBJ_ALLOC", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_NOTIFIEROBJ_ALLOC", ",", "struct", "drm_nouveau_notifierobj_alloc", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GPUOBJ_FREE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GPUOBJ_FREE", ",", "struct", "drm_nouveau_gpuobj_free", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_NEW", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_NEW", ",", "struct", "drm_nouveau_gem_new", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_PUSHBUF", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_PUSHBUF", ",", "struct", "drm_nouveau_gem_pushbuf", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_CPU_PREP", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_CPU_PREP", ",", "struct", "drm_nouveau_gem_cpu_prep", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_CPU_FINI", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_CPU_FINI", ",", "struct", "drm_nouveau_gem_cpu_fini", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_INFO", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_INFO", ",", "struct", "drm_nouveau_gem_info", ")", "#", "endif", "/", "*", "__NOUVEAU_DRM_H__", "*", "/", "@", "@", "-", "547", ",", "8", "+", "547", ",", "8", "@", "@", "typedef", "struct", "{", "#", "define", "DRM_IOCTL_RADEON_GEM_WAIT_IDLE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_WAIT_IDLE", ",", "struct", "drm_radeon_gem_wait_idle", ")", "#", "define", "DRM_IOCTL_RADEON_CS", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_CS", ",", "struct", "drm_radeon_cs", ")", "#", "define", "DRM_IOCTL_RADEON_INFO", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_INFO", ",", "struct", "drm_radeon_info", ")", "#", "define", "DRM_IOCTL_RADEON_SET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_SET_TILING", ",", "struct", "drm_radeon_gem_set_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_GET_TILING", ",", "struct", "drm_radeon_gem_get_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GEM_SET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_SET_TILING", ",", "struct", "drm_radeon_gem_set_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GEM_GET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_GET_TILING", ",", "struct", "drm_radeon_gem_get_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GEM_BUSY", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_BUSY", ",", "struct", "drm_radeon_gem_busy", ")", "typedef", "struct", "drm_radeon_init", "{", "@", "@", "-", "63", ",", "10", "+", "63", ",", "10", "@", "@", "typedef", "struct", "_drm_savage_sarea", "{", "#", "define", "DRM_SAVAGE_BCI_EVENT_EMIT", "0x02", "#", "define", "DRM_SAVAGE_BCI_EVENT_WAIT", "0x03", "#", "define", "DRM_IOCTL_SAVAGE_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_INIT", ",", "drm_savage_init_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_CMDBUF", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_CMDBUF", ",", "drm_savage_cmdbuf_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_EVENT_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_EMIT", ",", "drm_savage_event_emit_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_EVENT_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_WAIT", ",", "drm_savage_event_wait_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_INIT", ",", "drm_savage_init_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_CMDBUF", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_CMDBUF", ",", "drm_savage_cmdbuf_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_EVENT_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_EMIT", ",", "drm_savage_event_emit_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_EVENT_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_WAIT", ",", "drm_savage_event_wait_t", ")", "#", "define", "SAVAGE_DMA_PCI", "1", "#", "define", "SAVAGE_DMA_AGP", "3"], "docstring_tokens": ["obtain", "potentially", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["Merge", "pull", "request", "#1287", "from", "restlet/2.3.11_xee_security_issue_in_jaxrs_extension", "XEE", "injection", "security", "fix", "in", "Jax-rs", "extension.", "Issue", "#1286.", "Reported\u2026"], "code_tokens": ["@", "@", "-", "7", ",", "9", "+", "7", ",", "12", "@", "@", "Changes", "log", "-", "Bugs", "fixed", "-", "Fixed", "NPE", "in", "JAX", "-", "RS", "backend", "when", "request", "'", "s", "entity", "has", "no", "media", "type", ".", "Issue", "#", "1271", ".", "Reported", "by", "Thomas", "Mortagne", ".", "-", "XEE", "injection", "security", "fix", "in", "Jax", "-", "rs", "extension", ".", "Issue", "#", "1286", ".", "Reported", "by", "Man", "Yue", "Mo", ".", "-", "Enhancements", "-", "Added", "support", "of", "Header", "Origin", "and", "Origin", "dimension", ".", "Issue", "#", "1275", ".", "Reported", "and", "contributed", "by", "adolski", ".", "-", "2", ".", "3", ".", "10", "(", "05", "/", "28", "/", "2017", ")", "-", "Bugs", "fixed", "-", "Invalid", "max", "-", "age", "value", "for", "cookie", "settings", "replaced", "by", "Integer", ".", "MAX_VALUE", "constant", ".", "Issue", "#", "1251", ".", "@", "@", "-", "9", ",", "9", "+", "9", ",", "9", "@", "@", "<", "package", "name", "=", "\"", "org", ".", "simpleframework", ".", "xml", "\"", ">", "<", "maven", ">", "<", "groupId", ">", "org", ".", "simpleframework", "<", "/", "groupId", ">", "<", "artifactId", ">", "simple", "-", "xml", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "7", ".", "1", "<", "/", "version", ">", "<", "groupId", ">", "org", ".", "restlet", ".", "lib", "<", "/", "groupId", ">", "<", "artifactId", ">", "org", ".", "simpleframework", ".", "simple", "-", "xml", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "7", ".", "2", "<", "/", "version", ">", "<", "/", "maven", ">", "<", "/", "package", ">", "<", "distributions", ">"], "docstring_tokens": ["access", "arbitrary", "files"]}
{"contents": ["Capabilities:", "move", "cap_file_mmap", "to", "commoncap.c", "Currently", "we", "duplicate", "the", "mmap_min_addr", "test", "in", "cap_file_mmap", "and", "in", "security_file_mmap", "if", "!CONFIG_SECURITY.", "This", "patch", "moves", "cap_file_mmap", "into", "commoncap.c", "and", "then", "calls", "that", "function", "directly", "from", "security_file_mmap", "ifndef", "CONFIG_SECURITY", "like", "all", "of", "the", "other", "capability", "checks", "are", "done.", "Signed-off-by:", "Eric", "Paris", "<eparis@redhat.com>", "Acked-by:", "Serge", "Hallyn", "<serue@us.ibm.com>", "Signed-off-by:", "James", "Morris", "<jmorris@namei.org>"], "code_tokens": ["@", "@", "-", "66", ",", "6", "+", "66", ",", "9", "@", "@", "extern", "int", "cap_inode_setxattr", "(", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "name", ",", "extern", "int", "cap_inode_removexattr", "(", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "name", ")", ";", "extern", "int", "cap_inode_need_killpriv", "(", "struct", "dentry", "*", "dentry", ")", ";", "extern", "int", "cap_inode_killpriv", "(", "struct", "dentry", "*", "dentry", ")", ";", "extern", "int", "cap_file_mmap", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "reqprot", ",", "unsigned", "long", "prot", ",", "unsigned", "long", "flags", ",", "unsigned", "long", "addr", ",", "unsigned", "long", "addr_only", ")", ";", "extern", "int", "cap_task_fix_setuid", "(", "struct", "cred", "*", "new", ",", "const", "struct", "cred", "*", "old", ",", "int", "flags", ")", ";", "extern", "int", "cap_task_prctl", "(", "int", "option", ",", "unsigned", "long", "arg2", ",", "unsigned", "long", "arg3", ",", "unsigned", "long", "arg4", ",", "unsigned", "long", "arg5", ")", ";", "@", "@", "-", "2197", ",", "9", "+", "2200", ",", "7", "@", "@", "static", "inline", "int", "security_file_mmap", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "reqprot", ",", "unsigned", "long", "addr", ",", "unsigned", "long", "addr_only", ")", "{", "if", "(", "(", "addr", "<", "mmap_min_addr", ")", "&", "&", "!", "capable", "(", "CAP_SYS_RAWIO", ")", ")", "return", "-", "EACCES", ";", "return", "0", ";", "return", "cap_file_mmap", "(", "file", ",", "reqprot", ",", "prot", ",", "flags", ",", "addr", ",", "addr_only", ")", ";", "}", "static", "inline", "int", "security_file_mprotect", "(", "struct", "vm_area_struct", "*", "vma", ",", "@", "@", "-", "330", ",", "15", "+", "330", ",", "6", "@", "@", "static", "int", "cap_file_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "command", ",", "return", "0", ";", "}", "static", "int", "cap_file_mmap", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "reqprot", ",", "unsigned", "long", "prot", ",", "unsigned", "long", "flags", ",", "unsigned", "long", "addr", ",", "unsigned", "long", "addr_only", ")", "{", "if", "(", "(", "addr", "<", "mmap_min_addr", ")", "&", "&", "!", "capable", "(", "CAP_SYS_RAWIO", ")", ")", "return", "-", "EACCES", ";", "return", "0", ";", "}", "static", "int", "cap_file_mprotect", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "reqprot", ",", "unsigned", "long", "prot", ")", "{", "@", "@", "-", "984", ",", "3", "+", "984", ",", "33", "@", "@", "int", "cap_vm_enough_memory", "(", "struct", "mm_struct", "*", "mm", ",", "long", "pages", ")", "cap_sys_admin", "=", "1", ";", "return", "__vm_enough_memory", "(", "mm", ",", "pages", ",", "cap_sys_admin", ")", ";", "}", "/", "*", "*", "cap_file_mmap", "-", "check", "if", "able", "to", "map", "given", "addr", "*", "@", "file", ":", "unused", "*", "@", "reqprot", ":", "unused", "*", "@", "prot", ":", "unused", "*", "@", "flags", ":", "unused", "*", "@", "addr", ":", "address", "attempting", "to", "be", "mapped", "*", "@", "addr_only", ":", "unused", "*", "*", "If", "the", "process", "is", "attempting", "to", "map", "memory", "below", "mmap_min_addr", "they", "need", "*", "CAP_SYS_RAWIO", ".", "The", "other", "parameters", "to", "this", "function", "are", "unused", "by", "the", "*", "capability", "security", "module", ".", "Returns", "0", "if", "this", "mapping", "should", "be", "allowed", "*", "-", "EPERM", "if", "not", ".", "*", "/", "int", "cap_file_mmap", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "reqprot", ",", "unsigned", "long", "prot", ",", "unsigned", "long", "flags", ",", "unsigned", "long", "addr", ",", "unsigned", "long", "addr_only", ")", "{", "int", "ret", "=", "0", ";", "if", "(", "addr", "<", "mmap_min_addr", ")", "{", "ret", "=", "cap_capable", "(", "current", ",", "current_cred", "(", "),", "CAP_SYS_RAWIO", ",", "SECURITY_CAP_AUDIT", ")", ";", "/", "*", "set", "PF_SUPERPRIV", "if", "it", "turns", "out", "we", "allow", "the", "low", "mmap", "*", "/", "if", "(", "ret", "=", "=", "0", ")", "current", "-", ">", "flags", "|", "=", "PF_SUPERPRIV", ";", "}", "return", "ret", ";", "}"], "docstring_tokens": ["gain", "elevated", "privileges", "on", "the", "system"]}
{"contents": ["Introduce", "acceptAnyCertificate", "config,", "defaulting", "to", "false,", "close", "#526,", "close", "#352"], "code_tokens": ["@", "@", "-", "112", ",", "6", "+", "112", ",", "7", "@", "@", "protected", "int", "spdyInitialWindowSize", ";", "protected", "int", "spdyMaxConcurrentStreams", ";", "protected", "TimeConverter", "timeConverter", ";", "protected", "boolean", "acceptAnyCertificate", ";", "protected", "AsyncHttpClientConfig", "(", ")", "{", "}", "@", "@", "-", "151", ",", "7", "+", "152", ",", "8", "@", "@", "private", "AsyncHttpClientConfig", "(", "int", "maxTotalConnections", ",", "/", "/", "boolean", "spdyEnabled", ",", "/", "/", "int", "spdyInitialWindowSize", ",", "/", "/", "int", "spdyMaxConcurrentStreams", ",", "/", "/", "TimeConverter", "timeConverter", ")", "{", "TimeConverter", "timeConverter", ",", "/", "/", "boolean", "acceptAnyCertificate", ")", "{", "this", ".", "maxTotalConnections", "=", "maxTotalConnections", ";", "this", ".", "maxConnectionPerHost", "=", "maxConnectionPerHost", ";", "@", "@", "-", "187", ",", "6", "+", "189", ",", "7", "@", "@", "private", "AsyncHttpClientConfig", "(", "int", "maxTotalConnections", ",", "/", "/", "this", ".", "spdyInitialWindowSize", "=", "spdyInitialWindowSize", ";", "this", ".", "spdyMaxConcurrentStreams", "=", "spdyMaxConcurrentStreams", ";", "this", ".", "timeConverter", "=", "timeConverter", ";", "this", ".", "acceptAnyCertificate", "=", "acceptAnyCertificate", ";", "}", "@", "@", "-", "533", ",", "6", "+", "536", ",", "10", "@", "@", "public", "TimeConverter", "getTimeConverter", "(", ")", "{", "return", "timeConverter", ";", "}", "public", "boolean", "isAcceptAnyCertificate", "(", ")", "{", "return", "acceptAnyCertificate", ";", "}", "/", "**", "*", "Builder", "for", "an", "{", "@", "link", "AsyncHttpClient", "}", "*", "/", "@", "@", "-", "564", ",", "6", "+", "571", ",", "7", "@", "@", "public", "TimeConverter", "getTimeConverter", "(", ")", "{", "private", "boolean", "spdyEnabled", "=", "defaultSpdyEnabled", "(", ");", "private", "int", "spdyInitialWindowSize", "=", "defaultSpdyInitialWindowSize", "(", ");", "private", "int", "spdyMaxConcurrentStreams", "=", "defaultSpdyMaxConcurrentStreams", "(", ");", "private", "boolean", "acceptAnyCertificate", "=", "defaultAcceptAnyCertificate", "(", ");", "private", "ScheduledExecutorService", "reaper", ";", "private", "ExecutorService", "applicationThreadPool", ";", "@", "@", "-", "1078", ",", "6", "+", "1086", ",", "11", "@", "@", "public", "Builder", "setTimeConverter", "(", "TimeConverter", "timeConverter", ")", "{", "return", "this", ";", "}", "public", "Builder", "setAcceptAnyCertificate", "(", "boolean", "acceptAnyCertificate", ")", "{", "this", ".", "acceptAnyCertificate", "=", "acceptAnyCertificate", ";", "return", "this", ";", "}", "/", "**", "*", "Create", "a", "config", "builder", "with", "values", "taken", "from", "the", "given", "prototype", "configuration", ".", "*", "@", "@", "-", "1186", ",", "7", "+", "1199", ",", "8", "@", "@", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "spdyEnabled", ",", "/", "/", "spdyInitialWindowSize", ",", "/", "/", "spdyMaxConcurrentStreams", ",", "/", "/", "timeConverter", ")", ";", "timeConverter", ",", "/", "/", "acceptAnyCertificate", ")", ";", "}", "}", "}", "@", "@", "-", "70", ",", "6", "+", "70", ",", "7", "@", "@", "void", "configureDefaults", "(", ")", "{", "spdyEnabled", "=", "defaultSpdyEnabled", "(", ");", "spdyInitialWindowSize", "=", "defaultSpdyInitialWindowSize", "(", ");", "spdyMaxConcurrentStreams", "=", "defaultSpdyMaxConcurrentStreams", "(", ");", "acceptAnyCertificate", "=", "defaultAcceptAnyCertificate", "(", ");", "if", "(", "defaultUseProxySelector", "(", "))", "{", "proxyServerSelector", "=", "ProxyUtils", ".", "getJdkDefaultProxyServerSelector", "(", ");", "}", "else", "if", "(", "defaultUseProxyProperties", "(", "))", "{", "@", "@", "-", "234", ",", "4", "+", "235", ",", "9", "@", "@", "public", "AsyncHttpClientConfigBean", "setIoThreadMultiplier", "(", "int", "ioThreadMultiplier", ")", "{", "this", ".", "ioThreadMultiplier", "=", "ioThreadMultiplier", ";", "return", "this", ";", "}", "public", "AsyncHttpClientConfigBean", "setAcceptAnyCertificate", "(", "boolean", "acceptAnyCertificate", ")", "{", "this", ".", "acceptAnyCertificate", "=", "acceptAnyCertificate", ";", "return", "this", ";", "}", "}", "@", "@", "-", "133", ",", "4", "+", "133", ",", "8", "@", "@", "public", "static", "int", "defaultSpdyInitialWindowSize", "(", ")", "{", "public", "static", "int", "defaultSpdyMaxConcurrentStreams", "(", ")", "{", "return", "Integer", ".", "getInteger", "(", "ASYNC_CLIENT", "+", "\"", "spdyMaxConcurrentStreams", "\"", ",", "100", ")", ";", "}", "public", "static", "boolean", "defaultAcceptAnyCertificate", "(", ")", "{", "return", "getBoolean", "(", "ASYNC_CLIENT", "+", "\"", "acceptAnyCertificate", "\"", ",", "false", ")", ";", "}", "}", "@", "@", "-", "678", ",", "6", "+", "678", ",", "11", "@", "@", "public", "Builder", "setProviderClass", "(", "String", "providerClass", ")", "{", "return", "this", ";", "}", "public", "Builder", "setAcceptAnyCertificate", "(", "boolean", "acceptAnyCertificate", ")", "{", "configBuilder", ".", "setAcceptAnyCertificate", "(", "acceptAnyCertificate", ")", ";", "return", "this", ";", "}", "public", "SimpleAsyncHttpClient", "build", "(", ")", "{", "if", "(", "realmBuilder", "!", "=", "null", ")", "{", "@", "@", "-", "44", ",", "4", "+", "44", ",", "8", "@", "@", "public", "static", "boolean", "getBoolean", "(", "String", "systemPropName", ",", "boolean", "defaultValue", ")", "{", "String", "systemPropValue", "=", "System", ".", "getProperty", "(", "systemPropName", ")", ";", "return", "systemPropValue", "!", "=", "null", "?", "systemPropValue", ".", "equalsIgnoreCase", "(", "\"", "true", "\"", ")", ":", "defaultValue", ";", "}", "public", "static", "<", "T", ">", "T", "withDefault", "(", "T", "value", ",", "T", "defaults", ")", "{", "return", "value", "!", "=", "null", "?", "value", ":", "value", ";", "}", "}", "@", "@", "-", "16", ",", "14", "+", "16", ",", "47", "@", "@", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "security", ".", "GeneralSecurityException", ";", "import", "java", ".", "security", ".", "KeyManagementException", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "/", "**", "*", "This", "class", "is", "a", "copy", "of", "http", ":", "//", "github", ".", "com", "/", "sonatype", "/", "wagon", "-", "ning", "/", "raw", "/", "master", "/", "src", "/", "main", "/", "java", "/", "org", "/", "apache", "/", "maven", "/", "wagon", "/", "providers", "/", "http", "/", "SslUtils", ".", "java", "*", "/", "public", "class", "SslUtils", "{", "static", "class", "LooseTrustManager", "implements", "X509TrustManager", "{", "public", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "]", "getAcceptedIssuers", "(", ")", "{", "return", "new", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "0", "]", ";", "}", "public", "void", "checkClientTrusted", "(", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "]", "certs", ",", "String", "authType", ")", "{", "}", "public", "void", "checkServerTrusted", "(", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "]", "certs", ",", "String", "authType", ")", "{", "}", "}", "private", "SSLContext", "looseTrustManagerSSLContext", "=", "looseTrustManagerSSLContext", "(", ");", "private", "SSLContext", "looseTrustManagerSSLContext", "(", ")", "{", "try", "{", "SSLContext", "sslContext", "=", "SSLContext", ".", "getInstance", "(", "\"", "TLS", "\"", ");", "sslContext", ".", "init", "(", "null", ",", "new", "TrustManager", "[", "]", "{", "new", "LooseTrustManager", "(", ")", "}", ",", "new", "SecureRandom", "(", "))", ";", "return", "sslContext", ";", "}", "catch", "(", "NoSuchAlgorithmException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "catch", "(", "KeyManagementException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "}", "private", "static", "class", "SingletonHolder", "{", "public", "static", "final", "SslUtils", "instance", "=", "new", "SslUtils", "(", ");", "}", "@", "@", "-", "32", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "SslUtils", "getInstance", "(", ")", "{", "return", "SingletonHolder", ".", "instance", ";", "}", "public", "SSLContext", "getSSLContext", "(", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "return", "SSLContext", ".", "getDefault", "(", ");", "public", "SSLContext", "getSSLContext", "(", "boolean", "acceptAnyCertificate", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "return", "acceptAnyCertificate", "?", "looseTrustManagerSSLContext", ":", "SSLContext", ".", "getDefault", "(", ");", "}", "}", "@", "@", "-", "96", ",", "7", "+", "96", ",", "11", "@", "@", "public", "void", "runAllSequentiallyBecauseNotThreadSafe", "(", ")", "throws", "Exception", "{", "public", "void", "httpToHttpsRedirect", "(", ")", "throws", "Exception", "{", "redirectDone", ".", "getAndSet", "(", "false", ")", ";", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setMaxRedirects", "(", "5", ")", ".", "setFollowRedirects", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setMaxRedirects", "(", "5", ")", "//", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "c", "=", "getAsyncHttpClient", "(", "cg", ")", ";", "try", "{", "Response", "response", "=", "c", ".", "prepareGet", "(", "getTargetUrl", "(", "))", ".", "setHeader", "(", "\"", "X", "-", "redirect", "\"", ",", "getTargetUrl2", "(", "))", ".", "execute", "(", ").", "get", "(", ");", "@", "@", "-", "112", ",", "7", "+", "116", ",", "11", "@", "@", "public", "void", "httpToHttpsRedirect", "(", ")", "throws", "Exception", "{", "public", "void", "httpToHttpsProperConfig", "(", ")", "throws", "Exception", "{", "redirectDone", ".", "getAndSet", "(", "false", ")", ";", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setMaxRedirects", "(", "5", ")", ".", "setFollowRedirects", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setMaxRedirects", "(", "5", ")", "//", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "c", "=", "getAsyncHttpClient", "(", "cg", ")", ";", "try", "{", "Response", "response", "=", "c", ".", "prepareGet", "(", "getTargetUrl", "(", "))", ".", "setHeader", "(", "\"", "X", "-", "redirect", "\"", ",", "getTargetUrl2", "(", ")", "+", "\"", "/", "test2", "\"", ").", "execute", "(", ").", "get", "(", ");", "@", "@", "-", "134", ",", "7", "+", "142", ",", "11", "@", "@", "public", "void", "httpToHttpsProperConfig", "(", ")", "throws", "Exception", "{", "public", "void", "relativeLocationUrl", "(", ")", "throws", "Exception", "{", "redirectDone", ".", "getAndSet", "(", "false", ")", ";", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setMaxRedirects", "(", "5", ")", ".", "setFollowRedirects", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setMaxRedirects", "(", "5", ")", "//", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "c", "=", "getAsyncHttpClient", "(", "cg", ")", ";", "try", "{", "Response", "response", "=", "c", ".", "prepareGet", "(", "getTargetUrl", "(", "))", ".", "setHeader", "(", "\"", "X", "-", "redirect", "\"", ",", "\"", "/", "foo", "/", "test", "\"", ").", "execute", "(", ").", "get", "(", ");", "@", "@", "-", "74", ",", "12", "+", "74", ",", "14", "@", "@", "public", "void", "tearDownGlobal", "(", ")", "throws", "Exception", "{", "@", "Test", "(", "groups", "=", "{", "\"", "online", "\"", ",", "\"", "default_provider", "\"", "}", ")", "public", "void", "testRequestProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "AsyncHttpClientConfig", ".", "Builder", "b", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ");", "b", ".", "setFollowRedirects", "(", "true", ")", ";", "ProxyServer", "ps", "=", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ";", "AsyncHttpClientConfig", "config", "=", "b", ".", "build", "(", ");", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "asyncHttpClient", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "RequestBuilder", "rb", "=", "new", "RequestBuilder", "(", "\"", "GET", "\"", ").", "setProxyServer", "(", "ps", ")", ".", "setUrl", "(", "getTargetUrl2", "(", "))", ";", "@", "@", "-", "108", ",", "6", "+", "110", ",", "7", "@", "@", "public", "void", "testConfigProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "Executio", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setProxyServer", "(", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ")/", "/", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "asyncHttpClient", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "@", "@", "-", "136", ",", "7", "+", "139", ",", "12", "@", "@", "public", "void", "testSimpleAHCConfigProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "SimpleAsyncHttpClient", "client", "=", "new", "SimpleAsyncHttpClient", ".", "Builder", "(", ")/", "/", ".", "setProviderClass", "(", "getProviderClass", "(", "))", "//", ".", "setProxyProtocol", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ")", ".", "setProxyHost", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ").", "setProxyPort", "(", "port1", ")", ".", "setFollowRedirects", "(", "true", ")", ".", "setUrl", "(", "getTargetUrl2", "(", "))", "//", ".", "setProxyProtocol", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ")", "//", ".", "setProxyHost", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ")/", "/", ".", "setProxyPort", "(", "port1", ")", "//", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setUrl", "(", "getTargetUrl2", "(", "))", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "setHeader", "(", "\"", "Content", "-", "Type", "\"", ",", "\"", "text", "/", "html", "\"", ")/", "/", ".", "build", "(", ");", "try", "{", "@", "@", "-", "78", ",", "7", "+", "78", ",", "7", "@", "@", "protected", "String", "getTargetUrl", "(", ")", "{", "public", "void", "echoText", "(", ")", "throws", "Exception", "{", "ProxyServer", "ps", "=", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ";", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setProxyServer", "(", "ps", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setProxyServer", "(", "ps", ")", ".", "setAcceptAnyCertificate", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClient", "asyncHttpClient", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "@", "@", "-", "253", ",", "7", "+", "253", ",", "7", "@", "@", "public", "void", "onTimeout", "(", "Connection", "connection", ")", "{", "SSLContext", "context", "=", "clientConfig", ".", "getSSLContext", "(", ");", "if", "(", "context", "=", "=", "null", ")", "{", "try", "{", "context", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", ");", "context", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", "clientConfig", ".", "isAcceptAnyCertificate", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "@", "@", "-", "138", ",", "6", "+", "138", ",", "7", "@", "@", "private", "void", "doSimpleFeeder", "(", "final", "boolean", "secure", ")", "{", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")", ".", "setMaxConnectionsPerHost", "(", "60", ")", ".", "setMaxConnectionsTotal", "(", "60", ")", ".", "setAcceptAnyCertificate", "(", "true", ")", ".", "build", "(", ");", "final", "AsyncHttpClient", "client", "=", "new", "DefaultAsyncHttpClient", "(", "new", "GrizzlyAsyncHttpProvider", "(", "config", ")", ",", "config", ")", ";", "@", "@", "-", "240", ",", "6", "+", "241", ",", "7", "@", "@", "private", "void", "doNonBlockingFeeder", "(", "final", "boolean", "secure", ")", "{", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")", ".", "setMaxConnectionsPerHost", "(", "60", ")", ".", "setMaxConnectionsTotal", "(", "60", ")", ".", "setAcceptAnyCertificate", "(", "true", ")", ".", "build", "(", ");", "final", "AsyncHttpClient", "client", "=", "new", "DefaultAsyncHttpClient", "(", "new", "GrizzlyAsyncHttpProvider", "(", "config", ")", ",", "config", ")", ";", "@", "@", "-", "209", ",", "10", "+", "209", ",", "9", "@", "@", "private", "SSLEngine", "createSSLEngine", "(", ")", "throws", "IOException", ",", "GeneralSecurityException", "}", "else", "{", "SSLContext", "sslContext", "=", "config", ".", "getSSLContext", "(", ");", "if", "(", "sslContext", "=", "=", "null", ")", "{", "sslContext", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", ");", "}", "if", "(", "sslContext", "=", "=", "null", ")", "sslContext", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", "config", ".", "isAcceptAnyCertificate", "(", "))", ";", "SSLEngine", "sslEngine", "=", "sslContext", ".", "createSSLEngine", "(", ");", "sslEngine", ".", "setUseClientMode", "(", "true", ")", ";", "return", "sslEngine", ";"], "docstring_tokens": ["launch", "further", "attacks", "against", "a", "vulnerable", "target"]}
{"contents": ["vfs:", "ioctl:", "prevent", "double-fetch", "in", "dedupe", "ioctl", "This", "prevents", "a", "double-fetch", "from", "user", "space", "that", "can", "lead", "to", "to", "an", "undersized", "allocation", "and", "heap", "overflow.", "Fixes:", "54dbc1517237", "(\"vfs:", "hoist", "the", "btrfs", "deduplication", "ioctl", "to", "the", "vfs\")", "Signed-off-by:", "Scott", "Bauer", "<sbauer@plzdonthack.me>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "590", ",", "6", "+", "590", ",", "7", "@", "@", "static", "long", "ioctl_file_dedupe_range", "(", "struct", "file", "*", "file", ",", "void", "__user", "*", "arg", ")", "goto", "out", ";", "}", "same", "-", ">", "dest_count", "=", "count", ";", "ret", "=", "vfs_dedupe_file_range", "(", "file", ",", "same", ")", ";", "if", "(", "ret", ")", "goto", "out", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "with", "elevated", "privileges", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["shm:", "fix", "shmctl(SHM_INFO)", "lockup", "with", "!CONFIG_SHMEM", "shm_get_stat()", "assumes", "that", "the", "inode", "is", "a", "\"struct", "shmem_inode_info\",", "which", "is", "incorrect", "for", "!CONFIG_SHMEM", "(see", "fs/ramfs/inode.c:", "ramfs_get_inode()", "vs.", "mm/shmem.c:", "shmem_get_inode()).", "This", "bad", "assumption", "can", "cause", "shmctl(SHM_INFO)", "to", "lockup", "when", "shm_get_stat()", "tries", "to", "spin_lock(&info->lock).", "Users", "of", "!CONFIG_SHMEM", "may", "encounter", "this", "lockup", "simply", "by", "invoking", "the", "'ipcs'", "command.", "Reported", "by", "Jiri", "Olsa", "back", "in", "February", "2008:", "http://lkml.org/lkml/2008/2/29/74", "Signed-off-by:", "Tony", "Battersby", "<tonyb@cybernetics.com>", "Cc:", "Jiri", "Kosina", "<jkosina@suse.cz>", "Reported-by:", "Jiri", "Olsa", "<olsajiri@gmail.com>", "Cc:", "Hugh", "Dickins", "<hugh@veritas.com>", "Cc:", "<stable@kernel.org>", "[2.6.everything]", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "565", ",", "11", "+", "565", ",", "15", "@", "@", "static", "void", "shm_get_stat", "(", "struct", "ipc_namespace", "*", "ns", ",", "unsigned", "long", "*", "rss", ",", "struct", "hstate", "*", "h", "=", "hstate_file", "(", "shp", "-", ">", "shm_file", ")", ";", "*", "rss", "+", "=", "pages_per_huge_page", "(", "h", ")", "*", "mapping", "-", ">", "nrpages", ";", "}", "else", "{", "#", "ifdef", "CONFIG_SHMEM", "struct", "shmem_inode_info", "*", "info", "=", "SHMEM_I", "(", "inode", ")", ";", "spin_lock", "(", "&", "info", "-", ">", "lock", ")", ";", "*", "rss", "+", "=", "inode", "-", ">", "i_mapping", "-", ">", "nrpages", ";", "*", "swp", "+", "=", "info", "-", ">", "swapped", ";", "spin_unlock", "(", "&", "info", "-", ">", "lock", ")", ";", "#", "else", "*", "rss", "+", "=", "inode", "-", ">", "i_mapping", "-", ">", "nrpages", ";", "#", "endif", "}", "total", "+", "+;"], "docstring_tokens": ["misinterpret", "the", "data", "type", "of", "an", "inode", "and", "cause", "the", "system", "to", "hang"]}
{"contents": ["Fix", "#73869:", "Signed", "Integer", "Overflow", "gd_io.c", "GD2", "stores", "the", "number", "of", "horizontal", "and", "vertical", "chunks", "as", "words", "(i.e.", "2", "byte", "unsigned).", "These", "values", "are", "multiplied", "and", "assigned", "to", "an", "int", "when", "reading", "the", "image,", "what", "can", "cause", "integer", "overflows.", "We", "have", "to", "avoid", "that,", "and", "also", "make", "sure", "that", "either", "chunk", "count", "is", "actually", "greater", "than", "zero.", "If", "illegal", "chunk", "counts", "are", "detected,", "we", "bail", "out", "from", "reading", "the", "image.", "(cherry", "picked", "from", "commit", "5b5d9db3988b829e0b121b74bb3947f01c2796a1)"], "code_tokens": ["@", "@", "-", "136", ",", "6", "+", "136", ",", "10", "@", "@", "static", "int", "_gd2GetHeader", "(", "gdIOCtxPtr", "in", ",", "int", "*", "sx", ",", "int", "*", "sy", ",", "int", "*", "cs", ",", "int", "*", "vers", ",", "in", "GD2_DBG", "(", "php_gd_error", "(", "\"%", "d", "Chunks", "vertically", "\"", ",", "*", "ncy", ")", ");", "if", "(", "gd2_compressed", "(", "*", "fmt", ")", ")", "{", "if", "(", "*", "ncx", "<", "=", "0", "|", "|", "*", "ncy", "<", "=", "0", "|", "|", "*", "ncx", ">", "INT_MAX", "/", "*", "ncy", ")", "{", "GD2_DBG", "(", "printf", "(", "\"", "Illegal", "chunk", "counts", ":", "%", "d", "*", "%", "d", "\\", "n", "\"", ",", "*", "ncx", ",", "*", "ncy", ")", ");", "goto", "fail1", ";", "}", "nc", "=", "(", "*", "ncx", ")", "*", "(", "*", "ncy", ")", ";", "GD2_DBG", "(", "php_gd_error", "(", "\"", "Reading", "%", "d", "chunk", "index", "entries", "\"", ",", "nc", ")", ");", "if", "(", "overflow2", "(", "sizeof", "(", "t_chunk_info", ")", ",", "nc", ")", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "19", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "73869", "(", "Signed", "Integer", "Overflow", "gd_io", ".", "c", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "gd", "'", "))", "die", "(", "'", "skip", "gd", "extension", "not", "available", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "imagecreatefromgd2", "(", "__DIR__", ".", "DIRECTORY_SEPARATOR", ".", "'", "bug73869a", ".", "gd2", "'", "))", ";", "var_dump", "(", "imagecreatefromgd2", "(", "__DIR__", ".", "DIRECTORY_SEPARATOR", ".", "'", "bug73869b", ".", "gd2", "'", "))", ";", "?", ">", "=", "==", "DONE", "=", "==", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "imagecreatefromgd2", "(", "):", "'", "%", "s", "'", "is", "not", "a", "valid", "GD2", "file", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "Warning", ":", "imagecreatefromgd2", "(", "):", "'", "%", "s", "'", "is", "not", "a", "valid", "GD2", "file", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "=", "==", "DONE", "=", "==", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["net:", "Automatically", "allocate", "per", "namespace", "data.", "To", "get", "the", "full", "benefit", "of", "batched", "network", "namespace", "cleanup", "netowrk", "device", "deletion", "needs", "to", "be", "performed", "by", "the", "generic", "code.", "When", "using", "register_pernet_gen_device", "and", "freeing", "the", "data", "in", "exit_net", "it", "is", "impossible", "to", "delay", "allocation", "until", "after", "exit_net", "has", "called", "as", "the", "device", "uninit", "methods", "are", "no", "longer", "safe.", "To", "correct", "this,", "and", "to", "simplify", "working", "with", "per", "network", "namespace", "data", "I", "have", "moved", "allocation", "and", "deletion", "of", "per", "network", "namespace", "data", "into", "the", "network", "namespace", "core.", "The", "core", "now", "frees", "the", "data", "only", "after", "all", "of", "the", "network", "namespace", "exit", "routines", "have", "run.", "Now", "it", "is", "only", "required", "to", "set", "the", "new", "fields", ".id", "and", ".size", "in", "the", "pernet_operations", "structure", "if", "you", "want", "network", "namespace", "data", "to", "be", "managed", "for", "you", "automatically.", "This", "makes", "the", "current", "register_pernet_gen_device", "and", "register_pernet_gen_subsys", "routines", "unnecessary.", "For", "the", "moment", "I", "have", "left", "them", "as", "compatibility", "wrappers", "in", "net_namespace.h", "They", "will", "be", "removed", "once", "all", "of", "the", "users", "have", "been", "updated.", "Signed-off-by:", "Eric", "W.", "Biederman", "<ebiederm@xmission.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "236", ",", "6", "+", "236", ",", "8", "@", "@", "struct", "pernet_operations", "{", "struct", "list_head", "list", ";", "int", "(", "*", "init", ")", "(", "struct", "net", "*", "net", ")", ";", "void", "(", "*", "exit", ")", "(", "struct", "net", "*", "net", ")", ";", "int", "*", "id", ";", "size_t", "size", ";", "}", ";", "/", "*", "@", "@", "-", "259", ",", "12", "+", "261", ",", "30", "@", "@", "struct", "pernet_operations", "{", "*", "/", "extern", "int", "register_pernet_subsys", "(", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_subsys", "(", "struct", "pernet_operations", "*", ");", "extern", "int", "register_pernet_gen_subsys", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_gen_subsys", "(", "int", "id", ",", "struct", "pernet_operations", "*", ");", "extern", "int", "register_pernet_device", "(", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_device", "(", "struct", "pernet_operations", "*", ");", "extern", "int", "register_pernet_gen_device", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_gen_device", "(", "int", "id", ",", "struct", "pernet_operations", "*", ");", "static", "inline", "int", "register_pernet_gen_subsys", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "ops", "-", ">", "id", "=", "id", ";", "return", "register_pernet_subsys", "(", "ops", ")", ";", "}", "static", "inline", "void", "unregister_pernet_gen_subsys", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "return", "unregister_pernet_subsys", "(", "ops", ")", ";", "}", "static", "inline", "int", "register_pernet_gen_device", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "ops", "-", ">", "id", "=", "id", ";", "return", "register_pernet_device", "(", "ops", ")", ";", "}", "static", "inline", "void", "unregister_pernet_gen_device", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "return", "unregister_pernet_device", "(", "ops", ")", ";", "}", "struct", "ctl_path", ";", "struct", "ctl_table", ";", "@", "@", "-", "43", ",", "13", "+", "43", ",", "40", "@", "@", "static", "void", "unregister_netdevices", "(", "struct", "net", "*", "net", ",", "struct", "list_head", "*", "list", ")", "}", "}", "static", "int", "ops_init", "(", "const", "struct", "pernet_operations", "*", "ops", ",", "struct", "net", "*", "net", ")", "{", "int", "err", ";", "if", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", "{", "void", "*", "data", "=", "kzalloc", "(", "ops", "-", ">", "size", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "data", ")", "return", "-", "ENOMEM", ";", "err", "=", "net_assign_generic", "(", "net", ",", "*", "ops", "-", ">", "id", ",", "data", ")", ";", "if", "(", "err", ")", "{", "kfree", "(", "data", ")", ";", "return", "err", ";", "}", "}", "if", "(", "ops", "-", ">", "init", ")", "return", "ops", "-", ">", "init", "(", "net", ")", ";", "return", "0", ";", "}", "static", "void", "ops_free", "(", "const", "struct", "pernet_operations", "*", "ops", ",", "struct", "net", "*", "net", ")", "{", "if", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", "{", "int", "id", "=", "*", "ops", "-", ">", "id", ";", "kfree", "(", "net_generic", "(", "net", ",", "id", ")", ");", "}", "}", "/", "*", "*", "setup_net", "runs", "the", "initializers", "for", "the", "network", "namespace", "object", ".", "*", "/", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "{", "/", "*", "Must", "be", "called", "with", "net_mutex", "held", "*", "/", "struct", "pernet_operations", "*", "ops", ";", "const", "struct", "pernet_operations", "*", "ops", ",", "*", "saved_ops", ";", "int", "error", "=", "0", ";", "atomic_set", "(", "&", "net", "-", ">", "count", ",", "1", ")", ";", "@", "@", "-", "59", ",", "11", "+", "86", ",", "9", "@", "@", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "#", "endif", "list_for_each_entry", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "{", "if", "(", "ops", "-", ">", "init", ")", "{", "error", "=", "ops", "-", ">", "init", "(", "net", ")", ";", "if", "(", "error", "<", "0", ")", "goto", "out_undo", ";", "}", "error", "=", "ops_init", "(", "ops", ",", "net", ")", ";", "if", "(", "error", "<", "0", ")", "goto", "out_undo", ";", "}", "out", ":", "return", "error", ";", "@", "@", "-", "72", ",", "6", "+", "97", ",", "7", "@", "@", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "/", "*", "Walk", "through", "the", "list", "backwards", "calling", "the", "exit", "functions", "*", "for", "the", "pernet", "modules", "whose", "init", "functions", "did", "not", "fail", ".", "*", "/", "saved_ops", "=", "ops", ";", "list_for_each_entry_continue_reverse", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "{", "if", "(", "ops", "-", ">", "exit", ")", "ops", "-", ">", "exit", "(", "net", ")", ";", "@", "@", "-", "83", ",", "6", "+", "109", ",", "9", "@", "@", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "rtnl_unlock", "(", ");", "}", "}", "ops", "=", "saved_ops", ";", "list_for_each_entry_continue_reverse", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "ops_free", "(", "ops", ",", "net", ")", ";", "rcu_barrier", "(", ");", "goto", "out", ";", "@", "@", "-", "175", ",", "7", "+", "204", ",", "7", "@", "@", "static", "LIST_HEAD", "(", "cleanup_list", ")", ";", "/", "*", "Must", "hold", "cleanup_list_lock", "to", "touch", "*", "/", "static", "void", "cleanup_net", "(", "struct", "work_struct", "*", "work", ")", "{", "struct", "pernet_operations", "*", "ops", ";", "const", "struct", "pernet_operations", "*", "ops", ";", "struct", "net", "*", "net", ",", "*", "tmp", ";", "LIST_HEAD", "(", "net_kill_list", ")", ";", "@", "@", "-", "214", ",", "6", "+", "243", ",", "13", "@", "@", "static", "void", "cleanup_net", "(", "struct", "work_struct", "*", "work", ")", "rtnl_unlock", "(", ");", "}", "}", "/", "*", "Free", "the", "net", "generic", "variables", "*", "/", "list_for_each_entry_reverse", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "{", "if", "(", "ops", "-", ">", "size", "&", "&", "ops", "-", ">", "id", ")", "{", "list_for_each_entry", "(", "net", ",", "&", "net_kill_list", ",", "cleanup_list", ")", "ops_free", "(", "ops", ",", "net", ")", ";", "}", "}", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "@", "@", "-", "309", ",", "16", "+", "345", ",", "16", "@", "@", "static", "int", "__init", "net_ns_init", "(", "void", ")", "pure_initcall", "(", "net_ns_init", ")", ";", "#", "ifdef", "CONFIG_NET_NS", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "static", "int", "__register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "struct", "net", "*", "net", ",", "*", "undo_net", ";", "int", "error", ";", "list_add_tail", "(", "&", "ops", "-", ">", "list", ",", "list", ")", ";", "if", "(", "ops", "-", ">", "init", ")", "{", "if", "(", "ops", "-", ">", "init", "|", "|", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", ")", "{", "for_each_net", "(", "net", ")", "{", "error", "=", "ops", "-", ">", "init", "(", "net", ")", ";", "error", "=", "ops_init", "(", "ops", ",", "net", ")", ";", "if", "(", "error", ")", "goto", "out_undo", ";", "}", "@", "@", "-", "336", ",", "38", "+", "372", ",", "85", "@", "@", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "}", "}", "undone", ":", "if", "(", "ops", "-", ">", "size", "&", "&", "ops", "-", ">", "id", ")", "{", "for_each_net", "(", "undo_net", ")", "{", "if", "(", "net_eq", "(", "undo_net", ",", "net", ")", ")", "goto", "freed", ";", "ops_free", "(", "ops", ",", "undo_net", ")", ";", "}", "}", "freed", ":", "return", "error", ";", "}", "static", "void", "unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "static", "void", "__unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "{", "struct", "net", "*", "net", ";", "list_del", "(", "&", "ops", "-", ">", "list", ")", ";", "if", "(", "ops", "-", ">", "exit", ")", "for_each_net", "(", "net", ")", "ops", "-", ">", "exit", "(", "net", ")", ";", "if", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", "for_each_net", "(", "net", ")", "ops_free", "(", "ops", ",", "net", ")", ";", "}", "#", "else", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "static", "int", "__register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "if", "(", "ops", "-", ">", "init", "=", "=", "NULL", ")", "return", "0", ";", "return", "ops", "-", ">", "init", "(", "&", "init_net", ")", ";", "int", "err", "=", "0", ";", "err", "=", "ops_init", "(", "ops", ",", "&", "init_net", ")", ";", "if", "(", "err", ")", "ops_free", "(", "ops", ",", "&", "init_net", ")", ";", "return", "err", ";", "}", "static", "void", "unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "static", "void", "__unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "{", "if", "(", "ops", "-", ">", "exit", ")", "ops", "-", ">", "exit", "(", "&", "init_net", ")", ";", "ops_free", "(", "ops", ",", "&", "init_net", ")", ";", "}", "#", "endif", "#", "endif", "/", "*", "CONFIG_NET_NS", "*", "/", "static", "DEFINE_IDA", "(", "net_generic_ids", ")", ";", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "int", "error", ";", "if", "(", "ops", "-", ">", "id", ")", "{", "again", ":", "error", "=", "ida_get_new_above", "(", "&", "net_generic_ids", ",", "1", ",", "ops", "-", ">", "id", ")", ";", "if", "(", "error", "<", "0", ")", "{", "if", "(", "error", "=", "=", "-", "EAGAIN", ")", "{", "ida_pre_get", "(", "&", "net_generic_ids", ",", "GFP_KERNEL", ")", ";", "goto", "again", ";", "}", "return", "error", ";", "}", "}", "error", "=", "__register_pernet_operations", "(", "list", ",", "ops", ")", ";", "if", "(", "error", "&", "&", "ops", "-", ">", "id", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "ops", "-", ">", "id", ")", ";", "return", "error", ";", "}", "static", "void", "unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "{", "__unregister_pernet_operations", "(", "ops", ")", ";", "if", "(", "ops", "-", ">", "id", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "ops", "-", ">", "id", ")", ";", "}", "/", "**", "*", "register_pernet_subsys", "-", "register", "a", "network", "namespace", "subsystem", "*", "@", "ops", ":", "pernet", "operations", "structure", "for", "the", "subsystem", "@", "@", "-", "414", ",", "38", "+", "497", ",", "6", "@", "@", "void", "unregister_pernet_subsys", "(", "struct", "pernet_operations", "*", "module", ")", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_subsys", ")", ";", "int", "register_pernet_gen_subsys", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "int", "rv", ";", "mutex_lock", "(", "&", "net_mutex", ")", ";", "again", ":", "rv", "=", "ida_get_new_above", "(", "&", "net_generic_ids", ",", "1", ",", "id", ")", ";", "if", "(", "rv", "<", "0", ")", "{", "if", "(", "rv", "=", "=", "-", "EAGAIN", ")", "{", "ida_pre_get", "(", "&", "net_generic_ids", ",", "GFP_KERNEL", ")", ";", "goto", "again", ";", "}", "goto", "out", ";", "}", "rv", "=", "register_pernet_operations", "(", "first_device", ",", "ops", ")", ";", "if", "(", "rv", "<", "0", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "id", ")", ";", "out", ":", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "return", "rv", ";", "}", "EXPORT_SYMBOL_GPL", "(", "register_pernet_gen_subsys", ")", ";", "void", "unregister_pernet_gen_subsys", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "mutex_lock", "(", "&", "net_mutex", ")", ";", "unregister_pernet_operations", "(", "ops", ")", ";", "ida_remove", "(", "&", "net_generic_ids", ",", "id", ")", ";", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_gen_subsys", ")", ";", "/", "**", "*", "register_pernet_device", "-", "register", "a", "network", "namespace", "device", "*", "@", "ops", ":", "pernet", "operations", "structure", "for", "the", "subsystem", "@", "@", "-", "477", ",", "30", "+", "528", ",", "6", "@", "@", "int", "register_pernet_device", "(", "struct", "pernet_operations", "*", "ops", ")", "}", "EXPORT_SYMBOL_GPL", "(", "register_pernet_device", ")", ";", "int", "register_pernet_gen_device", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "int", "error", ";", "mutex_lock", "(", "&", "net_mutex", ")", ";", "again", ":", "error", "=", "ida_get_new_above", "(", "&", "net_generic_ids", ",", "1", ",", "id", ")", ";", "if", "(", "error", ")", "{", "if", "(", "error", "=", "=", "-", "EAGAIN", ")", "{", "ida_pre_get", "(", "&", "net_generic_ids", ",", "GFP_KERNEL", ")", ";", "goto", "again", ";", "}", "goto", "out", ";", "}", "error", "=", "register_pernet_operations", "(", "&", "pernet_list", ",", "ops", ")", ";", "if", "(", "error", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "id", ")", ";", "else", "if", "(", "first_device", "=", "=", "&", "pernet_list", ")", "first_device", "=", "&", "ops", "-", ">", "list", ";", "out", ":", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "return", "error", ";", "}", "EXPORT_SYMBOL_GPL", "(", "register_pernet_gen_device", ")", ";", "/", "**", "*", "unregister_pernet_device", "-", "unregister", "a", "network", "namespace", "netdevice", "*", "@", "ops", ":", "pernet", "operations", "structure", "to", "manipulate", "@", "@", "-", "520", ",", "17", "+", "547", ",", "6", "@", "@", "void", "unregister_pernet_device", "(", "struct", "pernet_operations", "*", "ops", ")", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_device", ")", ";", "void", "unregister_pernet_gen_device", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "mutex_lock", "(", "&", "net_mutex", ")", ";", "if", "(", "&", "ops", "-", ">", "list", "=", "=", "first_device", ")", "first_device", "=", "first_device", "-", ">", "next", ";", "unregister_pernet_operations", "(", "ops", ")", ";", "ida_remove", "(", "&", "net_generic_ids", ",", "id", ")", ";", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_gen_device", ")", ";", "static", "void", "net_generic_release", "(", "struct", "rcu_head", "*", "rcu", ")", "{", "struct", "net_generic", "*", "ng", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["[SECURITY-166]", "Prevent", "the", "creation", "of", "anonymous,", "system", "or", "unknown", "users.", "These", "users", "can", "still", "be", "instantiated,", "as", "would", "happen", "if", "there", "is", "no", "security", "and", "an", "anonymous", "user", "triggers", "a", "build", "--", "the", "anonymous", "user", "would", "correctly", "be", "created", "and", "added", "to", "the", "User", "list.", "This", "fix", "merely", "prevents", "the", "saving", "of", "that", "user,", "and", "therefore", "prevents", "them", "from", "logging", "in.", "There", "may", "be", "some", "plugins", "which", "trigger", "a", "build", "as", "the", "SYSTEM", "user,", "and", "that", "is", "not", "prohibited", "here.", "Also", "prevent", "full", "names", "of", "'anonymous',", "'system'", "or", "'uknown'.", "As", "discussed", "on", "SECURITY-166", "this", "may", "encumber", "auditing", "since", "full", "names", "are", "used", "in", "most", "places", "in", "the", "UI"], "code_tokens": ["@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "security", ".", "SecurityRealm", ";", "import", "hudson", ".", "util", ".", "FormApply", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "RunList", ";", "import", "hudson", ".", "util", ".", "XStream2", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "@", "@", "-", "46", ",", "6", "+", "47", ",", "8", "@", "@", "import", "org", ".", "acegisecurity", ".", "providers", ".", "anonymous", ".", "AnonymousAuthenticationToken", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UserDetails", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UsernameNotFoundException", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "import", "org", ".", "springframework", ".", "dao", ".", "DataAccessException", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "@", "@", "-", "102", ",", "7", "+", "105", ",", "12", "@", "@", "*", "/", "@", "ExportedBean", "public", "class", "User", "extends", "AbstractModelObject", "implements", "AccessControlled", ",", "DescriptorByNameOwner", ",", "Saveable", ",", "Comparable", "<", "User", ">", ",", "ModelObjectWithContextMenu", "{", "/", "**", "*", "These", "usernames", "should", "not", "be", "used", "by", "real", "users", "logging", "into", "Jenkins", ".", "Therefore", ",", "we", "prevent", "*", "users", "with", "these", "names", "from", "being", "saved", ".", "*", "/", "public", "static", "final", "String", "[", "]", "ILLEGAL_PERSISTED_USERNAMES", "=", "new", "String", "[", "]{", "\"", "anonymous", "\"", ",", "\"", "system", "\"", ",", "\"", "unknown", "\"", "};", "private", "transient", "final", "String", "id", ";", "private", "volatile", "String", "fullName", ";", "@", "@", "-", "500", ",", "10", "+", "508", ",", "36", "@", "@", "private", "static", "File", "getRootDir", "(", ")", "{", "return", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "}", "/", "**", "*", "Is", "the", "ID", "allowed", "?", "Some", "are", "prohibited", "for", "security", "reasons", ".", "See", "SECURITY", "-", "166", ".", "*", "<", "p", "/", ">", "*", "Note", "that", "this", "is", "only", "enforced", "when", "saving", ".", "These", "users", "are", "often", "created", "*", "via", "the", "constructor", "(", "and", "even", "listed", "on", "/", "asynchPeople", ")", ",", "but", "our", "goal", "is", "to", "*", "prevent", "anyone", "from", "logging", "in", "as", "these", "users", ".", "Therefore", ",", "we", "prevent", "*", "saving", "a", "User", "with", "one", "of", "these", "ids", ".", "*", "*", "@", "return", "true", "if", "the", "username", "or", "fullname", "is", "valid", "*", "/", "/", "/", "TODO", ":", "Remove", "Restricted", "and", "add", "@", "since", "when", "merging", "to", "stable", "-", "rc", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "boolean", "isIdOrFullnameAllowed", "(", "String", "id", ")", "{", "for", "(", "String", "invalidId", ":", "ILLEGAL_PERSISTED_USERNAMES", ")", "{", "if", "(", "id", ".", "equalsIgnoreCase", "(", "invalidId", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "/", "**", "*", "Save", "the", "settings", "to", "a", "file", ".", "*", "/", "public", "synchronized", "void", "save", "(", ")", "throws", "IOException", "{", "public", "synchronized", "void", "save", "(", ")", "throws", "IOException", ",", "FormValidation", "{", "if", "(", "!", "isIdOrFullnameAllowed", "(", "id", ")", ")", "{", "throw", "FormValidation", ".", "error", "(", "Messages", ".", "User_IllegalUsername", "(", "id", ")", ");", "}", "if", "(", "!", "isIdOrFullnameAllowed", "(", "fullName", ")", ")", "{", "throw", "FormValidation", ".", "error", "(", "Messages", ".", "User_IllegalFullname", "(", "fullName", ")", ");", "}", "if", "(", "BulkChange", ".", "contains", "(", "this", ")", ")", "return", ";", "getConfigFile", "(", ").", "write", "(", "this", ")", ";", "SaveableListener", ".", "fireOnChange", "(", "this", ",", "getConfigFile", "(", "))", ";", "@", "@", "-", "329", ",", "6", "+", "329", ",", "14", "@", "@", "private", "User", "createAccount", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ",", "boolean", "self", "if", "(", "si", ".", "email", "=", "=", "null", "|", "|", "!", "si", ".", "email", ".", "contains", "(", "\"@", "\")", ")", "si", ".", "errorMessage", "=", "Messages", ".", "HudsonPrivateSecurityRealm_CreateAccount_InvalidEmailAddress", "(", ");", "if", "(", "!", "User", ".", "isIdOrFullnameAllowed", "(", "si", ".", "username", ")", ")", "{", "si", ".", "errorMessage", "=", "hudson", ".", "model", ".", "Messages", ".", "User_IllegalUsername", "(", "si", ".", "username", ")", ";", "}", "if", "(", "!", "User", ".", "isIdOrFullnameAllowed", "(", "si", ".", "fullname", ")", ")", "{", "si", ".", "errorMessage", "=", "hudson", ".", "model", ".", "Messages", ".", "User_IllegalFullname", "(", "si", ".", "fullname", ")", ";", "}", "if", "(", "si", ".", "errorMessage", "!", "=", "null", ")", "{", "/", "/", "failed", ".", "ask", "the", "user", "to", "try", "again", ".", "req", ".", "setAttribute", "(", "\"", "data", "\"", ",", "si", ")", ";", "@", "@", "-", "357", ",", "3", "+", "357", ",", "6", "@", "@", "Jenkins", ".", "CheckDisplayName", ".", "NameNotUniqueWarning", "=", "The", "display", "name", ",", "\"", "{", "0", "}", "\",", "is", "used", "a", "Jenkins", ".", "CheckDisplayName", ".", "DisplayNameNotUniqueWarning", "=", "The", "display", "name", ",", "\"", "{", "0", "}", "\",", "is", "already", "in", "use", "by", "another", "job", "and", "could", "cause", "confusion", "and", "delay", ".", "Jenkins", ".", "NotAllowedName", "=", "\"{", "0", "}", "\"", "is", "not", "allowed", "name", "User", ".", "IllegalUsername", "=", "\"{", "0", "}", "\"", "is", "prohibited", "as", "a", "username", "for", "security", "reasons", ".", "User", ".", "IllegalFullname", "=", "\"{", "0", "}", "\"", "is", "prohibited", "as", "a", "full", "name", "for", "security", "reasons", ".", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "93", "@", "@", "package", "hudson", ".", "security", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "security", ".", "pages", ".", "SignupPage", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "Tests", "the", "signup", "page", "of", "{", "@", "link", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "}", "*", "TODO", ":", "Add", "to", "{", "@", "link", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealmTest", "}", "going", "forward", "*", "/", "public", "class", "HudsonPrivateSecurityRealm2Test", "{", "@", "Rule", "public", "JenkinsRule", "rule", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "public", "void", "signup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "alice", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "alice", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "Alice", "User", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "alice", "@", "nowhere", ".", "com", "\"", ");", "HtmlPage", "success", "=", "signup", ".", "submit", "(", "rule", ")", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "\"", "Success", "\"", "))", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "login", "-", "field", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "\"", "Alice", "User", "\"", "))", ";", "assertEquals", "(", "\"", "Alice", "User", "\"", ",", "securityRealm", ".", "getUser", "(", "\"", "alice", "\"", ").", "getDisplayName", "(", "))", ";", "}", "/", "/", "@", "Issue", "(", "\"", "SECURITY", "-", "166", "\"", ")", "@", "Test", "public", "void", "anonymousCantSignup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "anonymous", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "Bob", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "nothing", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "noone", "@", "nowhere", ".", "com", "\"", ");", "signup", "=", "new", "SignupPage", "(", "signup", ".", "submit", "(", "rule", ")", ");", "signup", ".", "assertErrorContains", "(", "\"", "prohibited", "as", "a", "username", "\"", ");", "assertNull", "(", "User", ".", "get", "(", "\"", "anonymous", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ");", "}", "/", "/", "@", "Issue", "(", "\"", "SECURITY", "-", "166", "\"", ")", "@", "Test", "public", "void", "systemCantSignup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "system", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "Bob", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "nothing", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "noone", "@", "nowhere", ".", "com", "\"", ");", "signup", "=", "new", "SignupPage", "(", "signup", ".", "submit", "(", "rule", ")", ");", "signup", ".", "assertErrorContains", "(", "\"", "prohibited", "as", "a", "username", "\"", ");", "assertNull", "(", "User", ".", "get", "(", "\"", "system", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ");", "}", "/", "**", "*", "We", "don", "'", "t", "allow", "prohibited", "fullnames", "since", "this", "may", "encumber", "auditing", ".", "*", "/", "/", "/", "@", "Issue", "(", "\"", "SECURITY", "-", "166", "\"", ")", "@", "Test", "public", "void", "fullNameOfUnknownCantSignup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "unknown2", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "unknown2", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "unknown", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "noone", "@", "nowhere", ".", "com", "\"", ");", "signup", "=", "new", "SignupPage", "(", "signup", ".", "submit", "(", "rule", ")", ");", "signup", ".", "assertErrorContains", "(", "\"", "prohibited", "as", "a", "full", "name", "\"", ");", "assertNull", "(", "User", ".", "get", "(", "\"", "unknown2", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "package", "hudson", ".", "security", ".", "pages", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "The", "the", "signup", "page", "for", "{", "@", "link", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "}", "*", "/", "public", "class", "SignupPage", "{", "public", "HtmlForm", "signupForm", ";", "public", "final", "HtmlPage", "signupPage", ";", "public", "SignupPage", "(", "HtmlPage", "signupPage", ")", "{", "this", ".", "signupPage", "=", "signupPage", ";", "assertNotNull", "(", "\"", "The", "sign", "up", "page", "has", "a", "username", "field", ".", "\",", "this", ".", "signupPage", ".", "getElementById", "(", "\"", "username", "\"", "))", ";", "for", "(", "HtmlForm", "signupForm", ":", "this", ".", "signupPage", ".", "getForms", "(", "))", "{", "if", "(", "signupForm", ".", "getInputsByName", "(", "\"", "username", "\"", ").", "size", "(", ")", "=", "=", "0", ")", "continue", ";", "this", ".", "signupForm", "=", "signupForm", ";", "}", "}", "public", "void", "enterUsername", "(", "String", "username", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "username", "\"", ").", "setValueAttribute", "(", "username", ")", ";", "}", "/", "**", "*", "Enters", "the", "password", "in", "password1", "and", "password2", ".", "*", "You", "can", "then", "call", "{", "@", "link", "#", "enterPassword2", "(", "String", ")", "}", "if", "you", "want", "them", "to", "be", "different", ".", "*", "@", "param", "password", "*", "/", "public", "void", "enterPassword", "(", "String", "password", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "password1", "\"", ").", "setValueAttribute", "(", "password", ")", ";", "signupForm", ".", "getInputByName", "(", "\"", "password2", "\"", ").", "setValueAttribute", "(", "password", ")", ";", "}", "public", "void", "enterPassword2", "(", "String", "password2", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "password2", "\"", ").", "setValueAttribute", "(", "password2", ")", ";", "}", "public", "void", "enterFullName", "(", "String", "fullName", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "fullname", "\"", ").", "setValueAttribute", "(", "fullName", ")", ";", "}", "public", "void", "enterEmail", "(", "String", "email", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "email", "\"", ").", "setValueAttribute", "(", "email", ")", ";", "}", "public", "HtmlPage", "submit", "(", "JenkinsRule", "rule", ")", "throws", "Exception", "{", "return", "rule", ".", "submit", "(", "signupForm", ")", ";", "}", "public", "void", "assertErrorContains", "(", "String", "msg", ")", "{", "assertThat", "(", "signupForm", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "msg", ")", ");", "}", "}"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["RDS:", "null", "pointer", "dereference", "in", "rds_atomic_free_op", "set", "rm->atomic.op_active", "to", "0", "when", "rds_pin_pages()", "fails", "or", "the", "user", "supplied", "address", "is", "invalid,", "this", "prevents", "a", "NULL", "pointer", "usage", "in", "rds_atomic_free_op()", "Signed-off-by:", "Mohamed", "Ghannam", "<simo.ghannam@gmail.com>", "Acked-by:", "Santosh", "Shilimkar", "<santosh.shilimkar@oracle.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "877", ",", "6", "+", "877", ",", "7", "@", "@", "int", "rds_cmsg_atomic", "(", "struct", "rds_sock", "*", "rs", ",", "struct", "rds_message", "*", "rm", ",", "err", ":", "if", "(", "page", ")", "put_page", "(", "page", ")", ";", "rm", "-", ">", "atomic", ".", "op_active", "=", "0", ";", "kfree", "(", "rm", "-", ">", "atomic", ".", "op_notifier", ")", ";", "return", "ret", ";"], "docstring_tokens": ["the", "system", "to", "crash"]}
{"contents": ["xfrm_user:", "validate", "XFRM_MSG_NEWAE", "incoming", "ESN", "size", "harder", "Kees", "Cook", "has", "pointed", "out", "that", "xfrm_replay_state_esn_len()", "is", "subject", "to", "wrapping", "issues.", "To", "ensure", "we", "are", "correctly", "ensuring", "that", "the", "two", "ESN", "structures", "are", "the", "same", "size", "compare", "both", "the", "overall", "size", "as", "reported", "by", "xfrm_replay_state_esn_len()", "and", "the", "internal", "length", "are", "the", "same.", "Signed-off-by:", "Andy", "Whitcroft", "<apw@canonical.com>", "Acked-by:", "Steffen", "Klassert", "<steffen.klassert@secunet.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "412", ",", "7", "+", "412", ",", "11", "@", "@", "static", "inline", "int", "xfrm_replay_verify_len", "(", "struct", "xfrm_replay_state_esn", "*", "replay_es", "up", "=", "nla_data", "(", "rp", ")", ";", "ulen", "=", "xfrm_replay_state_esn_len", "(", "up", ")", ";", "if", "(", "nla_len", "(", "rp", ")", "<", "ulen", "|", "|", "xfrm_replay_state_esn_len", "(", "replay_esn", ")", "!", "=", "ulen", ")", "/", "*", "Check", "the", "overall", "length", "and", "the", "internal", "bitmap", "length", "to", "avoid", "*", "potential", "overflow", ".", "*", "/", "if", "(", "nla_len", "(", "rp", ")", "<", "ulen", "|", "|", "xfrm_replay_state_esn_len", "(", "replay_esn", ")", "!", "=", "ulen", "|", "|", "replay_esn", "-", ">", "bmp_len", "!", "=", "up", "-", ">", "bmp_len", ")", "return", "-", "EINVAL", ";", "if", "(", "up", "-", ">", "replay_window", ">", "up", "-", ">", "bmp_len", "*", "sizeof", "(", "__u32", ")", "*", "8", ")"], "docstring_tokens": ["obtain", "root", "privileges", "or", "cause", "a", "denial", "of", "service", "(heap-based", "out-of-bounds", "access", ")"]}
{"contents": ["tcp:", "Increase", "TCP_MAXSEG", "socket", "option", "minimum.", "As", "noted", "by", "Steve", "Chen,", "since", "commit", "f5fff5dc8a7a3f395b0525c02ba92c95d42b7390", "(\"tcp:", "advertise", "MSS", "requested", "by", "user\")", "we", "can", "end", "up", "with", "a", "situation", "where", "tcp_select_initial_window()", "does", "a", "divide", "by", "a", "zero", "(or", "even", "negative)", "mss", "value.", "The", "problem", "is", "that", "sometimes", "we", "effectively", "subtract", "TCPOLEN_TSTAMP_ALIGNED", "and/or", "TCPOLEN_MD5SIG_ALIGNED", "from", "the", "mss.", "Fix", "this", "by", "increasing", "the", "minimum", "from", "8", "to", "64.", "Reported-by:", "Steve", "Chen", "<schen@mvista.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "2246", ",", "7", "+", "2246", ",", "7", "@", "@", "static", "int", "do_tcp_setsockopt", "(", "struct", "sock", "*", "sk", ",", "int", "level", ",", "/", "*", "Values", "greater", "than", "interface", "MTU", "won", "'", "t", "take", "effect", ".", "However", "*", "at", "the", "point", "when", "this", "call", "is", "done", "we", "typically", "don", "'", "t", "yet", "*", "know", "which", "interface", "is", "going", "to", "be", "used", "*", "/", "if", "(", "val", "<", "8", "|", "|", "val", ">", "MAX_TCP_WINDOW", ")", "{", "if", "(", "val", "<", "64", "|", "|", "val", ">", "MAX_TCP_WINDOW", ")", "{", "err", "=", "-", "EINVAL", ";", "break", ";", "}"], "docstring_tokens": ["denial-of-service", "condition"]}
{"contents": ["Plugins:", "WysiwygEditor,", "replaced", "textarea", "by", "hidden", "input"], "code_tokens": ["@", "@", "-", "16", ",", "15", "+", "16", ",", "8", "@", "@", "limitations", "under", "the", "License", ".", "-", "->", "<", "html", "xmlns", ":", "wicket", "=", "\"", "http", ":", "//", "wicket", ".", "apache", ".", "org", "\"", ">", "<", "wicket", ":", "head", ">", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", ".", "wysiwyg", "-", "editor", "-", "textarea", "{", "display", ":", "none", ";", "}", "<", "/", "style", ">", "<", "/", "wicket", ":", "head", ">", "<", "wicket", ":", "panel", ">", "<", "div", "wicket", ":", "id", "=", "\"", "container", "\"", "class", "=", "\"", "wysiwyg", "-", "editor", "\"", "><", "/", "div", ">", "<", "textarea", "wicket", ":", "id", "=", "\"", "textarea", "\"", "class", "=", "\"", "wysiwyg", "-", "editor", "-", "textarea", "\"", "><", "/", "textarea", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "wicket", ":", "id", "=", "\"", "textarea", "\"", "/>", "<", "/", "wicket", ":", "panel", ">", "<", "/", "html", ">", "@", "@", "-", "22", ",", "7", "+", "22", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "WebMarkupContainer", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "Form", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "FormComponentPanel", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "TextArea", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "HiddenField", ";", "import", "org", ".", "apache", ".", "wicket", ".", "model", ".", "IModel", ";", "import", "org", ".", "owasp", ".", "html", ".", "HtmlPolicyBuilder", ";", "import", "org", ".", "owasp", ".", "html", ".", "PolicyFactory", ";", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "private", "TextArea", "<", "String", ">", "textarea", ";", "private", "HiddenField", "<", "String", ">", "textarea", ";", "private", "final", "WebMarkupContainer", "container", ";", "/", "**", "@", "@", "-", "138", ",", "9", "+", "138", ",", "10", "@", "@", "protected", "void", "onInitialize", "(", ")", "{", "super", ".", "onInitialize", "(", ");", "this", ".", "textarea", "=", "new", "TextArea", "<", "String", ">", "(\"", "textarea", "\"", ",", "this", ".", "getModel", "(", "))", ";", "this", ".", "textarea", "=", "new", "HiddenField", "<", "String", ">", "(\"", "textarea", "\"", ",", "this", ".", "getModel", "(", "))", ";", "this", ".", "textarea", ".", "setOutputMarkupId", "(", "true", ")", ";", "this", ".", "textarea", ".", "setEscapeModelStrings", "(", "false", ")", ";", "this", ".", "add", "(", "this", ".", "textarea", ".", "setOutputMarkupId", "(", "true", ")", ");", "this", ".", "add", "(", "this", ".", "textarea", ")", ";", "this", ".", "add", "(", "JQueryWidget", ".", "newWidgetBehavior", "(", "this", ",", "this", ".", "container", ")", ");", "}"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["USB:", "serial:", "console:", "fix", "use-after-free", "on", "disconnect", "A", "clean-up", "patch", "removing", "two", "redundant", "NULL-checks", "from", "the", "console", "disconnect", "handler", "inadvertently", "also", "removed", "a", "third", "check.", "This", "could", "lead", "to", "the", "struct", "usb_serial", "being", "prematurely", "freed", "by", "the", "console", "code", "when", "a", "driver", "accepts", "but", "does", "not", "register", "any", "ports", "for", "an", "interface", "which", "also", "lacks", "endpoint", "descriptors.", "Fixes:", "0e517c93dc02", "(\"USB:", "serial:", "console:", "clean", "up", "sanity", "checks\")", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "4.11", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Acked-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>"], "code_tokens": ["@", "@", "-", "265", ",", "7", "+", "265", ",", "7", "@", "@", "static", "struct", "console", "usbcons", "=", "{", "void", "usb_serial_console_disconnect", "(", "struct", "usb_serial", "*", "serial", ")", "{", "if", "(", "serial", "-", ">", "port", "[", "0", "]", "=", "=", "usbcons_info", ".", "port", ")", "{", "if", "(", "serial", "-", ">", "port", "[", "0", "]", "&", "&", "serial", "-", ">", "port", "[", "0", "]", "=", "=", "usbcons_info", ".", "port", ")", "{", "usb_serial_console_exit", "(", ");", "usb_serial_put", "(", "serial", ")", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(use-after-free", "and", "system", "crash", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["r8169:", "fix", "crash", "when", "large", "packets", "are", "received", "Michael", "Tokarev", "reported", "receiving", "a", "large", "packet", "could", "crash", "a", "machine", "with", "RTL8169", "NIC.", "(", "original", "thread", "at", "http://lkml.org/lkml/2009/6/8/192", ")", "Problem", "is", "this", "driver", "tells", "that", "NIC", "frames", "up", "to", "16383", "bytes", "can", "be", "received", "but", "provides", "skb", "to", "rx", "ring", "allocated", "with", "smaller", "sizes", "(1536", "bytes", "in", "case", "standard", "1500", "bytes", "MTU", "is", "used)", "When", "a", "frame", "larger", "than", "what", "was", "allocated", "by", "driver", "is", "received,", "dma", "transfert", "can", "occurs", "past", "the", "end", "of", "buffer", "and", "corrupt", "kernel", "memory.", "Fix", "is", "to", "tell", "to", "NIC", "what", "is", "the", "maximum", "size", "a", "frame", "can", "be.", "This", "bug", "is", "very", "old,", "(before", "git", "introduction,", "linux-2.6.10),", "and", "should", "be", "backported", "to", "stable", "versions.", "Reported-by:", "Michael", "Tokarev", "<mjt@tls.msk.ru>", "Signed-off-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Tested-by:", "Michael", "Tokarev", "<mjt@tls.msk.ru>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "66", ",", "7", "+", "66", ",", "6", "@", "@", "static", "const", "int", "multicast_filter_limit", "=", "32", ";", "#", "define", "RX_DMA_BURST", "6", "/", "*", "Maximum", "PCI", "burst", ",", "'", "6", "'", "is", "1024", "*", "/", "#", "define", "TX_DMA_BURST", "6", "/", "*", "Maximum", "PCI", "burst", ",", "'", "6", "'", "is", "1024", "*", "/", "#", "define", "EarlyTxThld", "0x3F", "/", "*", "0x3F", "means", "NO", "early", "transmit", "*", "/", "#", "define", "RxPacketMaxSize", "0x3FE8", "/", "*", "16K", "-", "1", "-", "ETH_HLEN", "-", "VLAN", "-", "CRC", ".", "..", "*", "/", "#", "define", "SafeMtu", "0x1c20", "/", "*", ".", "..", "actually", "life", "sucks", "beyond", "~", "7k", "*", "/", "#", "define", "InterFrameGap", "0x03", "/", "*", "3", "means", "InterFrameGap", "=", "the", "shortest", "one", "*", "/", "@", "@", "-", "2357", ",", "10", "+", "2356", ",", "10", "@", "@", "static", "u16", "rtl_rw_cpluscmd", "(", "void", "__iomem", "*", "ioaddr", ")", "return", "cmd", ";", "}", "static", "void", "rtl_set_rx_max_size", "(", "void", "__iomem", "*", "ioaddr", ")", "static", "void", "rtl_set_rx_max_size", "(", "void", "__iomem", "*", "ioaddr", ",", "unsigned", "int", "rx_buf_sz", ")", "{", "/", "*", "Low", "hurts", ".", "Let", "'", "s", "disable", "the", "filtering", ".", "*", "/", "RTL_W16", "(", "RxMaxSize", ",", "16383", ")", ";", "RTL_W16", "(", "RxMaxSize", ",", "rx_buf_sz", ")", ";", "}", "static", "void", "rtl8169_set_magic_reg", "(", "void", "__iomem", "*", "ioaddr", ",", "unsigned", "mac_version", ")", "@", "@", "-", "2407", ",", "7", "+", "2406", ",", "7", "@", "@", "static", "void", "rtl_hw_start_8169", "(", "struct", "net_device", "*", "dev", ")", "RTL_W8", "(", "EarlyTxThres", ",", "EarlyTxThld", ")", ";", "rtl_set_rx_max_size", "(", "ioaddr", ")", ";", "rtl_set_rx_max_size", "(", "ioaddr", ",", "tp", "-", ">", "rx_buf_sz", ")", ";", "if", "(", "(", "tp", "-", ">", "mac_version", "=", "=", "RTL_GIGA_MAC_VER_01", ")", "|", "|", "(", "tp", "-", ">", "mac_version", "=", "=", "RTL_GIGA_MAC_VER_02", ")", "|", "|", "@", "@", "-", "2668", ",", "7", "+", "2667", ",", "7", "@", "@", "static", "void", "rtl_hw_start_8168", "(", "struct", "net_device", "*", "dev", ")", "RTL_W8", "(", "EarlyTxThres", ",", "EarlyTxThld", ")", ";", "rtl_set_rx_max_size", "(", "ioaddr", ")", ";", "rtl_set_rx_max_size", "(", "ioaddr", ",", "tp", "-", ">", "rx_buf_sz", ")", ";", "tp", "-", ">", "cp_cmd", "|", "=", "RTL_R16", "(", "CPlusCmd", ")", "|", "PktCntrDisable", "|", "INTT_1", ";", "@", "@", "-", "2846", ",", "7", "+", "2845", ",", "7", "@", "@", "static", "void", "rtl_hw_start_8101", "(", "struct", "net_device", "*", "dev", ")", "RTL_W8", "(", "EarlyTxThres", ",", "EarlyTxThld", ")", ";", "rtl_set_rx_max_size", "(", "ioaddr", ")", ";", "rtl_set_rx_max_size", "(", "ioaddr", ",", "tp", "-", ">", "rx_buf_sz", ")", ";", "tp", "-", ">", "cp_cmd", "|", "=", "rtl_rw_cpluscmd", "(", "ioaddr", ")", "|", "PCIMulRW", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(kernel", "memory", "corruption", "and", "crash", ")"]}
{"contents": ["[PATCH]", "skip", "data", "conversion", "in", "compat_sys_mount", "when", "data_page", "is", "NULL", "OpenVZ", "Linux", "kernel", "team", "has", "found", "a", "problem", "with", "mounting", "in", "compat", "mode.", "Simple", "command", "\"mount", "-t", "smbfs", "...\"", "on", "Fedora", "Core", "5", "distro", "in", "32-bit", "mode", "leads", "to", "oops:", "Unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000000", "RIP:", "compat_sys_mount+0xd6/0x290", "Process", "mount", "(pid:", "14656,", "veid=300,", "threadinfo", "ffff810034d30000,", "task", "ffff810034c86bc0)", "Call", "Trace:", "ia32_sysret+0x0/0xa", "The", "problem", "is", "that", "data_page", "pointer", "can", "be", "NULL,", "so", "we", "should", "skip", "data", "conversion", "in", "this", "case.", "Signed-off-by:", "Andrey", "Mirkin", "<amirkin@openvz.org>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "871", ",", "7", "+", "871", ",", "7", "@", "@", "asmlinkage", "long", "compat_sys_mount", "(", "char", "__user", "*", "dev_name", ",", "char", "__user", "*", "dir_name", ",", "retval", "=", "-", "EINVAL", ";", "if", "(", "type_page", ")", "{", "if", "(", "type_page", "&", "&", "data_page", ")", "{", "if", "(", "!", "strcmp", "(", "(", "char", "*", ")", "type_page", ",", "SMBFS_NAME", ")", ")", "{", "do_smb_super_data_conv", "(", "(", "void", "*", ")", "data_page", ")", ";", "}", "else", "if", "(", "!", "strcmp", "(", "(", "char", "*", ")", "type_page", ",", "NCPFS_NAME", ")", ")", "{"], "docstring_tokens": ["a", "denial", "of", "service"]}
{"contents": ["usbip:", "fix", "stub_send_ret_submit()", "vulnerability", "to", "null", "transfer_buffer", "stub_send_ret_submit()", "handles", "urb", "with", "a", "potential", "null", "transfer_buffer,", "when", "it", "replays", "a", "packet", "with", "potential", "malicious", "data", "that", "could", "contain", "a", "null", "buffer.", "Add", "a", "check", "for", "the", "condition", "when", "actual_length", ">", "0", "and", "transfer_buffer", "is", "null.", "Reported-by:", "Secunia", "Research", "<vuln@secunia.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Shuah", "Khan", "<shuahkh@osg.samsung.com>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "167", ",", "6", "+", "167", ",", "13", "@", "@", "static", "int", "stub_send_ret_submit", "(", "struct", "stub_device", "*", "sdev", ")", "memset", "(", "&", "pdu_header", ",", "0", ",", "sizeof", "(", "pdu_header", ")", ");", "memset", "(", "&", "msg", ",", "0", ",", "sizeof", "(", "msg", ")", ");", "if", "(", "urb", "-", ">", "actual_length", ">", "0", "&", "&", "!", "urb", "-", ">", "transfer_buffer", ")", "{", "dev_err", "(", "&", "sdev", "-", ">", "udev", "-", ">", "dev", ",", "\"", "urb", ":", "actual_length", "%", "d", "transfer_buffer", "null", "\\", "n", "\"", ",", "urb", "-", ">", "actual_length", ")", ";", "return", "-", "1", ";", "}", "if", "(", "usb_pipetype", "(", "urb", "-", ">", "pipe", ")", "=", "=", "PIPE_ISOCHRONOUS", ")", "iovnum", "=", "2", "+", "urb", "-", ">", "number_of_packets", ";", "else"], "docstring_tokens": ["the", "kernel", "to", "crash"]}
{"contents": ["uvesafb/connector:", "Disallow", "unpliviged", "users", "to", "send", "netlink", "packets", "Signed-off-by:", "Philipp", "Reisner", "<philipp.reisner@linbit.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "72", ",", "6", "+", "72", ",", "9", "@", "@", "static", "void", "uvesafb_cn_callback", "(", "struct", "cn_msg", "*", "msg", ",", "struct", "netlink_skb_parms", "*", "ns", "struct", "uvesafb_task", "*", "utask", ";", "struct", "uvesafb_ktask", "*", "task", ";", "if", "(", "!", "cap_raised", "(", "nsp", "-", ">", "eff_cap", ",", "CAP_SYS_ADMIN", ")", ")", "return", ";", "if", "(", "msg", "-", ">", "seq", ">", "=", "UVESAFB_TASKS_MAX", ")", "return", ";"], "docstring_tokens": ["bypass", "intended", "access", "restrictions", "and", "gain", "privileges"]}
{"contents": ["Ensure", "HTTP/1.1", "processor", "is", "recycled", "after", "a", "direct", "h2c", "connection"], "code_tokens": ["@", "@", "-", "826", ",", "8", "+", "826", ",", "10", "@", "@", "public", "SocketState", "process", "(", "SocketWrapperBase", "<", "S", ">", "wrapper", ",", "SocketEvent", "status", ")", "{", "/", "/", "Assume", "direct", "HTTP", "/", "2", "connection", "UpgradeProtocol", "upgradeProtocol", "=", "getProtocol", "(", ").", "getUpgradeProtocol", "(", "\"", "h2c", "\"", ");", "if", "(", "upgradeProtocol", "!", "=", "null", ")", "{", "processor", "=", "upgradeProtocol", ".", "getProcessor", "(", "wrapper", ",", "getProtocol", "(", ").", "getAdapter", "(", "))", ";", "/", "/", "Release", "the", "Http11", "processor", "to", "be", "re", "-", "used", "release", "(", "processor", ")", ";", "/", "/", "Create", "the", "upgrade", "processor", "processor", "=", "upgradeProtocol", ".", "getProcessor", "(", "wrapper", ",", "getProtocol", "(", ").", "getAdapter", "(", "))", ";", "wrapper", ".", "unRead", "(", "leftOverInput", ")", ";", "/", "/", "Associate", "with", "the", "processor", "with", "the", "connection", "connections", ".", "put", "(", "socket", ",", "processor", ")", ";", "@", "@", "-", "837", ",", "7", "+", "839", ",", "8", "@", "@", "public", "SocketState", "process", "(", "SocketWrapperBase", "<", "S", ">", "wrapper", ",", "SocketEvent", "status", ")", "{", "\"", "abstractConnectionHandler", ".", "negotiatedProcessor", ".", "fail", "\"", ",", "\"", "h2c", "\"", "))", ";", "}", "return", "SocketState", ".", "CLOSED", ";", "/", "/", "Exit", "loop", "and", "trigger", "appropriate", "clean", "-", "up", "state", "=", "SocketState", ".", "CLOSED", ";", "}", "}", "else", "{", "HttpUpgradeHandler", "httpUpgradeHandler", "=", "upgradeToken", ".", "getHttpUpgradeHandler", "(", ");", "@", "@", "-", "103", ",", "6", "+", "103", ",", "10", "@", "@", "<", "fix", ">", "Reduce", "the", "memory", "footprint", "of", "closed", "HTTP", "/", "2", "streams", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Ensure", "that", "the", "HTTP", "/", "1", ".", "1", "processor", "is", "correctly", "recycled", "when", "a", "direct", "connection", "to", "h2c", "is", "made", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Other", "\"", ">"], "docstring_tokens": ["a", "denial", "of", "service", "."]}
{"contents": ["Fixed", "bug", "#20927", "and", "updated", "the", "test", "case", "for", "the", "bug."], "code_tokens": ["@", "@", "-", "628", ",", "7", "+", "628", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "{", "const", "char", "*", "text", ",", "*", "breakchar", "=", "\"", "\\", "n", "\"", ";", "char", "*", "newtext", ";", "int", "textlen", ",", "breakcharlen", "=", "1", ",", "newtextlen", ";", "int", "textlen", ",", "breakcharlen", "=", "1", ",", "newtextlen", ",", "alloced", ",", "chk", ";", "long", "current", "=", "0", ",", "laststart", "=", "0", ",", "lastspace", "=", "0", ";", "long", "linelength", "=", "75", ";", "zend_bool", "docut", "=", "0", ";", "@", "@", "-", "670", ",", "18", "+", "670", ",", "24", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "}", "else", "{", "/", "*", "Multiple", "character", "line", "break", "or", "forced", "cut", "*", "/", "if", "(", "linelength", ">", "0", ")", "{", "/", "*", "Add", "extra", "10", "%", "to", "accomodate", "strings", "with", "unpredicatable", "number", "of", "breaks", "*", "/", "newtextlen", "=", "textlen", "+", "(", "int", ")", "((", "textlen", "/", "linelength", "+", "1", ")", "*", "breakcharlen", "*", "1", ".", "1", ")", "+", "1", ";", "chk", "=", "(", "int", ")", "(", "textlen", "/", "linelength", "+", "1", ")", ";", "alloced", "=", "textlen", "+", "chk", "*", "breakcharlen", "+", "1", ";", "}", "else", "{", "newtextlen", "=", "textlen", "*", "(", "breakcharlen", "+", "1", ")", "+", "1", ";", "chk", "=", "textlen", ";", "alloced", "=", "textlen", "*", "(", "breakcharlen", "+", "1", ")", "+", "1", ";", "}", "newtext", "=", "emalloc", "(", "newtextlen", ")", ";", "newtext", "=", "emalloc", "(", "alloced", ")", ";", "/", "*", "now", "keep", "track", "of", "the", "actual", "new", "text", "length", "*", "/", "newtextlen", "=", "0", ";", "laststart", "=", "lastspace", "=", "0", ";", "for", "(", "current", "=", "0", ";", "current", "<", "textlen", ";", "current", "+", "+)", "{", "if", "(", "chk", "<", "=", "0", ")", "{", "alloced", "+", "=", "(", "int", ")", "(", "((", "textlen", "-", "current", "+", "1", ")", "/", "linelength", "+", "1", ")", "*", "breakcharlen", ")", "+", "1", ";", "newtext", "=", "erealloc", "(", "newtext", ",", "alloced", ")", ";", "chk", "=", "(", "int", ")", "(", "(", "textlen", "-", "current", ")", "/", "linelength", ")", "+", "1", ";", "}", "/", "*", "when", "we", "hit", "an", "existing", "break", ",", "copy", "to", "new", "buffer", ",", "and", "*", "fix", "up", "laststart", "and", "lastspace", "*", "/", "if", "(", "text", "[", "current", "]", "=", "=", "breakchar", "[", "0", "]", "@", "@", "-", "691", ",", "6", "+", "697", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "newtextlen", "+", "=", "current", "-", "laststart", "+", "breakcharlen", ";", "current", "+", "=", "breakcharlen", "-", "1", ";", "laststart", "=", "lastspace", "=", "current", "+", "1", ";", "chk", "-", "-;", "}", "/", "*", "if", "it", "is", "a", "space", ",", "check", "if", "it", "is", "at", "the", "line", "boundary", ",", "*", "copy", "and", "insert", "a", "break", ",", "or", "just", "keep", "track", "of", "it", "*", "/", "@", "@", "-", "701", ",", "6", "+", "708", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "memcpy", "(", "newtext", "+", "newtextlen", ",", "breakchar", ",", "breakcharlen", ")", ";", "newtextlen", "+", "=", "breakcharlen", ";", "laststart", "=", "current", "+", "1", ";", "chk", "-", "-;", "}", "lastspace", "=", "current", ";", "}", "@", "@", "-", "714", ",", "6", "+", "722", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "memcpy", "(", "newtext", "+", "newtextlen", ",", "breakchar", ",", "breakcharlen", ")", ";", "newtextlen", "+", "=", "breakcharlen", ";", "laststart", "=", "lastspace", "=", "current", ";", "chk", "-", "-;", "}", "/", "*", "if", "the", "current", "word", "puts", "us", "over", "the", "linelength", ",", "copy", "*", "back", "up", "until", "the", "last", "space", ",", "insert", "a", "break", ",", "and", "move", "@", "@", "-", "725", ",", "6", "+", "734", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "memcpy", "(", "newtext", "+", "newtextlen", ",", "breakchar", ",", "breakcharlen", ")", ";", "newtextlen", "+", "=", "breakcharlen", ";", "laststart", "=", "lastspace", "=", "lastspace", "+", "1", ";", "chk", "-", "-;", "}", "}", "@", "@", "-", "3", ",", "17", "+", "3", ",", "16", "@", "@", "Segfault", "on", "wordwrap", "statement", "bug", "#", "20927", "-", "-", "SKIPIF", "-", "-", "FILE", "<", "?", "php", "$", "x", "=", "\"", "ADV", ":", "CLAIM", "YOUR", "FORTUNE", "NOW", "!", "!", "MAKE", "\"", ";", "$", "x", ".", "=", "\"", "xxxxxxxxxxHUNDREDS", "OF", "THOUSANDSxxxxxxxxxxxx", "\"", ";", "$", "b", "=", "\"", "CANITBREAKFOO", "\\", "n", "\"", ";", "$", "x", "=", "wordwrap", "(", "$", "x", ",", "20", ",", "$", "b", ",", "1", ")", ";", "$", "x", "=", "wordwrap", "(", "$", "x", ",", "20", ",", "$", "b", ",", "1", ")", ";", "print", "\"", "$", "x", "\\", "n", "\"", ";", "$", "string", "=", "str_repeat", "(", "\"", "1234567890", "X", "\"", ",", "10", ")", ";", "$", "break", "=", "str_repeat", "(", "\"", "a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap", "\"", ",", "8", ")", ";", "$", "linelength", "=", "10", ";", "echo", "\"", "Length", "of", "original", "string", ":", "\"", ".", "strlen", "(", "$", "string", ")", ".\"", "\\", "n", "\"", ";", "echo", "\"", "Length", "of", "break", "string", ":", "\"", ".", "strlen", "(", "$", "break", ")", ".\"", "\\", "n", "\"", ";", "var_dump", "(", "wordwrap", "(", "$", "string", ",", "$", "linelength", ",", "$", "break", ",", "1", ")", ");", "?", ">", "-", "-", "EXPECT", "ADV", ":", "CLAIM", "YOURCANITBREAKFOO", "FORTUNE", "NOW", "!", "!", "MAKECANITBREAKFOO", "xxxxxxxxxxHUNDREDSCANITBREAKFOO", "OFCANITBREAKFOO", "THOUSANDSxxxxxxxxxxxCANITBREAKFOO", "x", "Length", "of", "original", "string", ":", "130", "Length", "of", "break", "string", ":", "352", "string", "(", "6799", ")", "\"", "1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapX", "\""], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "server", "or", "cause", "the", "Web", "server", "to", "crash"]}
{"contents": ["CAMEL-9309:", "Make", "it", "easier", "to", "turn", "on|off", "java", "transport", "over", "http", "Conflicts:", "components/camel-jetty9/src/test/java/org/apache/camel/component/jetty/javabody/HttpJavaBodyTest.java"], "code_tokens": ["@", "@", "-", "90", ",", "7", "+", "90", ",", "6", "@", "@", "protected", "void", "service", "(", "final", "HttpServletRequest", "request", ",", "final", "HttpServletRespon", "/", "/", "we", "do", "not", "support", "java", "serialized", "objects", "unless", "explicit", "enabled", "String", "contentType", "=", "request", ".", "getContentType", "(", ");", "if", "(", "HttpConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", ".", "equals", "(", "contentType", ")", "&", "&", "!", "consumer", ".", "getEndpoint", "(", ").", "getComponent", "(", ").", "isAllowJavaSerializedObject", "(", "))", "{", "System", ".", "out", ".", "println", "(", "\"", "415", "miser", "!", "!!", "\")", ";", "response", ".", "sendError", "(", "HttpServletResponse", ".", "SC_UNSUPPORTED_MEDIA_TYPE", ")", ";", "return", ";", "}", "@", "@", "-", "26", ",", "7", "+", "26", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "http", ".", "HttpComponent", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "jetty", ".", "BaseJettyTest", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "jetty", ".", "JettyHttpComponent", ";", "import", "org", ".", "junit", ".", "Ignore", ";", "import", "org", ".", "junit", ".", "Test", ";", "/", "**", "@", "@", "-", "40", ",", "7", "+", "39", ",", "6", "@", "@", "public", "boolean", "isUseRouteBuilder", "(", ")", "{", "}", "@", "Test", "@", "Ignore", "public", "void", "testHttpSendJavaBodyAndReceiveString", "(", ")", "throws", "Exception", "{", "JettyHttpComponent", "jetty", "=", "context", ".", "getComponent", "(", "\"", "jetty", "\"", ",", "JettyHttpComponent", ".", "class", ")", ";", "jetty", ".", "setAllowJavaSerializedObject", "(", "true", ")", ";", "@", "@", "-", "78", ",", "7", "+", "76", ",", "6", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "}", "@", "Test", "@", "Ignore", "public", "void", "testHttpSendJavaBodyAndReceiveJavaBody", "(", ")", "throws", "Exception", "{", "JettyHttpComponent", "jetty", "=", "context", ".", "getComponent", "(", "\"", "jetty", "\"", ",", "JettyHttpComponent", ".", "class", ")", ";", "jetty", ".", "setAllowJavaSerializedObject", "(", "true", ")", ";", "@", "@", "-", "117", ",", "7", "+", "114", ",", "6", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "}", "@", "Test", "@", "Ignore", "public", "void", "testHttpSendStringAndReceiveJavaBody", "(", ")", "throws", "Exception", "{", "JettyHttpComponent", "jetty", "=", "context", ".", "getComponent", "(", "\"", "jetty", "\"", ",", "JettyHttpComponent", ".", "class", ")", ";", "jetty", ".", "setAllowJavaSerializedObject", "(", "true", ")", ";", "@", "@", "-", "188", ",", "7", "+", "184", ",", "6", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "}", "@", "Test", "@", "Ignore", "public", "void", "testNotAllowed", "(", ")", "throws", "Exception", "{", "JettyHttpComponent", "jetty", "=", "context", ".", "getComponent", "(", "\"", "jetty", "\"", ",", "JettyHttpComponent", ".", "class", ")", ";", "jetty", ".", "setAllowJavaSerializedObject", "(", "false", ")", ";"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["KVM:", "x86:", "work", "around", "leak", "of", "uninitialized", "stack", "contents", "(", ")", "Bugzilla:", "1671930", "Emulation", "of", "certain", "instructions", "(VMXON,", "VMCLEAR,", "VMPTRLD,", "VMWRITE", "with", "memory", "operand,", "INVEPT,", "INVVPID)", "can", "incorrectly", "inject", "a", "page", "fault", "when", "passed", "an", "operand", "that", "points", "to", "an", "MMIO", "address.", "The", "page", "fault", "will", "use", "uninitialized", "kernel", "stack", "memory", "as", "the", "CR2", "and", "error", "code.", "The", "right", "behavior", "would", "be", "to", "abort", "the", "VM", "with", "a", "KVM_EXIT_INTERNAL_ERROR", "exit", "to", "userspace;", "however,", "it", "is", "not", "an", "easy", "fix,", "so", "for", "now", "just", "ensure", "that", "the", "error", "code", "and", "CR2", "are", "zero.", "Embargoed", "until", "Feb", "7th", "2019.", "Reported-by:", "Felix", "Wilhelm", "<fwilhelm@google.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["@", "@", "-", "5116", ",", "6", "+", "5116", ",", "13", "@", "@", "int", "kvm_read_guest_virt", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "{", "u32", "access", "=", "(", "kvm_x86_ops", "-", ">", "get_cpl", "(", "vcpu", ")", "=", "=", "3", ")", "?", "PFERR_USER_MASK", ":", "0", ";", "/", "*", "*", "FIXME", ":", "this", "should", "call", "handle_emulation_failure", "if", "X86EMUL_IO_NEEDED", "*", "is", "returned", ",", "but", "our", "callers", "are", "not", "ready", "for", "that", "and", "they", "blindly", "*", "call", "kvm_inject_page_fault", ".", "Ensure", "that", "they", "at", "least", "do", "not", "leak", "*", "uninitialized", "kernel", "stack", "memory", "into", "cr2", "and", "error", "code", ".", "*", "/", "memset", "(", "exception", ",", "0", ",", "sizeof", "(", "*", "exception", ")", ");", "return", "kvm_read_guest_virt_helper", "(", "addr", ",", "val", ",", "bytes", ",", "vcpu", ",", "access", ",", "exception", ")", ";", "}"], "docstring_tokens": ["obtain", "host's", "stack", "memory", "contents", "and", "other", "sensitive", "information"]}
{"contents": ["LPS-89188", "Escape", "the", "URL"], "code_tokens": ["@", "@", "-", "18", ",", "7", "+", "18", ",", "8", "@", "@", "<", "%@", "page", "import", "=", "\"", "com", ".", "liferay", ".", "captcha", ".", "configuration", ".", "CaptchaConfiguration", "\"", "%", "><", "%@", "page", "import", "=", "\"", "com", ".", "liferay", ".", "captcha", ".", "util", ".", "CaptchaUtil", "\"", "%", "><", "%@", "page", "import", "=", "\"", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "module", ".", "configuration", ".", "ConfigurationProviderUtil", "\"", "%", ">", "page", "import", "=", "\"", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "module", ".", "configuration", ".", "ConfigurationProviderUtil", "\"", "%", "><", "%@", "page", "import", "=", "\"", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "util", ".", "HtmlUtil", "\"", "%", ">", "<", "%", "CaptchaConfiguration", "captchaConfiguration", "=", "(", "CaptchaConfiguration", ")", "ConfigurationProviderUtil", ".", "getSystemConfiguration", "(", "CaptchaConfiguration", ".", "class", ")", ";", "@", "@", "-", "22", ",", "7", "+", "22", ",", "7", "@", "@", "String", "url", "=", "(", "String", ")", "request", ".", "getAttribute", "(", "\"", "liferay", "-", "captcha", ":", "captcha", ":", "url", "\"", ");", "<", "c", ":", "if", "test", "=", "\"<", "%=", "captchaEnabled", "%", ">\"", ">", "<", "div", "class", "=", "\"", "taglib", "-", "captcha", "\"", ">", "<", "img", "alt", "=", "\"<", "liferay", "-", "ui", ":", "message", "escapeAttribute", "=", "\"<", "%=", "true", "%", ">\"", "key", "=", "\"", "text", "-", "to", "-", "identify", "\"", "/", ">\"", "class", "=", "\"", "captcha", "\"", "id", "=", "\"<", "portlet", ":", "namespace", "/", ">", "captcha", "\"", "src", "=", "\"<", "%=", "HttpUtil", ".", "addParameter", "(", "url", ",", "\"", "t", "\"", ",", "String", ".", "valueOf", "(", "System", ".", "currentTimeMillis", "(", "))", ")", "%", ">\"", "/", ">", "<", "img", "alt", "=", "\"<", "liferay", "-", "ui", ":", "message", "escapeAttribute", "=", "\"<", "%=", "true", "%", ">\"", "key", "=", "\"", "text", "-", "to", "-", "identify", "\"", "/", ">\"", "class", "=", "\"", "captcha", "\"", "id", "=", "\"<", "portlet", ":", "namespace", "/", ">", "captcha", "\"", "src", "=", "\"<", "%=", "HtmlUtil", ".", "escapeAttribute", "(", "HttpUtil", ".", "addParameter", "(", "url", ",", "\"", "t", "\"", ",", "String", ".", "valueOf", "(", "System", ".", "currentTimeMillis", "(", "))", "))", "%", ">\"", "/", ">", "<", "liferay", "-", "ui", ":", "icon", "cssClass", "=", "\"", "refresh", "\"", "@", "@", "-", "46", ",", "7", "+", "46", ",", "7", "@", "@", "String", "url", "=", "(", "String", ")", "request", ".", "getAttribute", "(", "\"", "liferay", "-", "captcha", ":", "captcha", ":", "url", "\"", ");", "refreshCaptcha", ".", "addEventListener", "(", "'", "click", "'", ",", "function", "(", ")", "{", "var", "url", "=", "Liferay", ".", "Util", ".", "addParams", "(", "'", "t", "=", "'", "+", "Date", ".", "now", "(", "),", "'", "<%", "=", "url", "%", ">'", ");", "var", "url", "=", "Liferay", ".", "Util", ".", "addParams", "(", "'", "t", "=", "'", "+", "Date", ".", "now", "(", "),", "'", "<%", "=", "HtmlUtil", ".", "escapeJS", "(", "url", ")", "%", ">'", ");", "var", "captcha", "=", "document", ".", "getElementById", "(", "'<", "portlet", ":", "namespace", "/", ">", "captcha", "'", ");"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["Added", "TLS", "validation", "check", "for", "DH", "keys", "Added", "further", "agreement", "result", "checks"], "code_tokens": ["@", "@", "-", "6", ",", "11", "+", "6", ",", "11", "@", "@", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "AsymmetricCipherKeyPair", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "CipherParameters", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "generators", ".", "DHKeyPairGenerator", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "AsymmetricKeyParameter", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "DHKeyGenerationParameters", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "DHParameters", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "DHPublicKeyParameters", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "DHPrivateKeyParameters", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "AsymmetricKeyParameter", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "DHPublicKeyParameters", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "ParametersWithRandom", ";", "/", "**", "@", "@", "-", "26", ",", "6", "+", "26", ",", "8", "@", "@", "*", "/", "public", "class", "DHAgreement", "{", "private", "static", "final", "BigInteger", "ONE", "=", "BigInteger", ".", "valueOf", "(", "1", ")", ";", "private", "DHPrivateKeyParameters", "key", ";", "private", "DHParameters", "dhParams", ";", "private", "BigInteger", "privateValue", ";", "@", "@", "-", "89", ",", "6", "+", "91", ",", "12", "@", "@", "public", "BigInteger", "calculateAgreement", "(", "BigInteger", "p", "=", "dhParams", ".", "getP", "(", ");", "return", "message", ".", "modPow", "(", "key", ".", "getX", "(", "),", "p", ")", ".", "multiply", "(", "pub", ".", "getY", "(", ").", "modPow", "(", "privateValue", ",", "p", ")", ").", "mod", "(", "p", ")", ";", "BigInteger", "result", "=", "pub", ".", "getY", "(", ").", "modPow", "(", "privateValue", ",", "p", ")", ";", "if", "(", "result", ".", "compareTo", "(", "ONE", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Shared", "key", "can", "'", "t", "be", "1", "\"", ");", "}", "return", "message", ".", "modPow", "(", "key", ".", "getX", "(", "),", "p", ")", ".", "multiply", "(", "result", ")", ".", "mod", "(", "p", ")", ";", "}", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "public", "class", "DHBasicAgreement", "implements", "BasicAgreement", "{", "private", "static", "final", "BigInteger", "ONE", "=", "BigInteger", ".", "valueOf", "(", "1", ")", ";", "private", "DHPrivateKeyParameters", "key", ";", "private", "DHParameters", "dhParams", ";", "@", "@", "-", "66", ",", "6", "+", "68", ",", "12", "@", "@", "public", "BigInteger", "calculateAgreement", "(", "throw", "new", "IllegalArgumentException", "(", "\"", "Diffie", "-", "Hellman", "public", "key", "has", "wrong", "parameters", ".", "\")", ";", "}", "return", "pub", ".", "getY", "(", ").", "modPow", "(", "key", ".", "getX", "(", "),", "dhParams", ".", "getP", "(", "))", ";", "BigInteger", "result", "=", "pub", ".", "getY", "(", ").", "modPow", "(", "key", ".", "getX", "(", "),", "dhParams", ".", "getP", "(", "))", ";", "if", "(", "result", ".", "compareTo", "(", "ONE", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Shared", "key", "can", "'", "t", "be", "1", "\"", ");", "}", "return", "result", ";", "}", "}", "@", "@", "-", "408", ",", "6", "+", "408", ",", "10", "@", "@", "public", "Mac", "getMac", "(", ")", "{", "throw", "new", "InvalidCipherTextException", "(", "\"", "unable", "to", "recover", "ephemeral", "public", "key", ":", "\"", "+", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "InvalidCipherTextException", "(", "\"", "unable", "to", "recover", "ephemeral", "public", "key", ":", "\"", "+", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "int", "encLength", "=", "(", "inLen", "-", "bIn", ".", "available", "(", "))", ";", "this", ".", "V", "=", "Arrays", ".", "copyOfRange", "(", "in", ",", "inOff", ",", "inOff", "+", "encLength", ")", ";", "@", "@", "-", "5", ",", "6", "+", "5", ",", "9", "@", "@", "public", "class", "DHPublicKeyParameters", "extends", "DHKeyParameters", "{", "private", "static", "final", "BigInteger", "ONE", "=", "BigInteger", ".", "valueOf", "(", "1", ")", ";", "private", "static", "final", "BigInteger", "TWO", "=", "BigInteger", ".", "valueOf", "(", "2", ")", ";", "private", "BigInteger", "y", ";", "public", "DHPublicKeyParameters", "(", "@", "@", "-", "18", ",", "9", "+", "21", ",", "14", "@", "@", "public", "DHPublicKeyParameters", "(", "private", "BigInteger", "validate", "(", "BigInteger", "y", ",", "DHParameters", "dhParams", ")", "{", "if", "(", "y", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "y", "value", "cannot", "be", "null", "\"", ");", "}", "if", "(", "dhParams", ".", "getQ", "(", ")", "!", "=", "null", ")", "{", "if", "(", "BigInteger", ".", "ONE", ".", "equals", "(", "y", ".", "modPow", "(", "dhParams", ".", "getQ", "(", "),", "dhParams", ".", "getP", "(", "))", "))", "if", "(", "ONE", ".", "equals", "(", "y", ".", "modPow", "(", "dhParams", ".", "getQ", "(", "),", "dhParams", ".", "getP", "(", "))", "))", "{", "return", "y", ";", "}", "@", "@", "-", "29", ",", "6", "+", "37", ",", "12", "@", "@", "private", "BigInteger", "validate", "(", "BigInteger", "y", ",", "DHParameters", "dhParams", ")", "}", "else", "{", "/", "/", "TLS", "check", "if", "(", "y", ".", "compareTo", "(", "TWO", ")", "<", "0", "|", "|", "y", ".", "compareTo", "(", "dhParams", ".", "getP", "(", ").", "subtract", "(", "TWO", ")", ")", ">", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "invalid", "DH", "public", "key", "\"", ");", "}", "return", "y", ";", "/", "/", "we", "can", "'", "t", "validate", "without", "Q", ".", "}", "}", "@", "@", "-", "29", ",", "6", "+", "29", ",", "9", "@", "@", "public", "class", "KeyAgreementSpi", "extends", "BaseAgreementSpi", "{", "private", "static", "final", "BigInteger", "ONE", "=", "BigInteger", ".", "valueOf", "(", "1", ")", ";", "private", "static", "final", "BigInteger", "TWO", "=", "BigInteger", ".", "valueOf", "(", "2", ")", ";", "private", "BigInteger", "x", ";", "private", "BigInteger", "p", ";", "private", "BigInteger", "g", ";", "@", "@", "-", "101", ",", "14", "+", "104", ",", "22", "@", "@", "protected", "Key", "engineDoPhase", "(", "throw", "new", "InvalidKeyException", "(", "\"", "DHPublicKey", "not", "for", "this", "KeyAgreement", "!", "\")", ";", "}", "if", "(", "lastPhase", ")", "BigInteger", "peerY", "=", "(", "(", "DHPublicKey", ")", "key", ")", ".", "getY", "(", ");", "if", "(", "peerY", "=", "=", "null", "|", "|", "peerY", ".", "compareTo", "(", "TWO", ")", "<", "0", "|", "|", "peerY", ".", "compareTo", "(", "p", ".", "subtract", "(", "ONE", ")", ")", ">", "=", "0", ")", "{", "result", "=", "(", "(", "DHPublicKey", ")", "key", ")", ".", "getY", "(", ").", "modPow", "(", "x", ",", "p", ")", ";", "return", "null", ";", "throw", "new", "InvalidKeyException", "(", "\"", "Invalid", "DH", "PublicKey", "\"", ");", "}", "else", "result", "=", "peerY", ".", "modPow", "(", "x", ",", "p", ")", ";", "if", "(", "result", ".", "compareTo", "(", "ONE", ")", "=", "=", "0", ")", "{", "result", "=", "(", "(", "DHPublicKey", ")", "key", ")", ".", "getY", "(", ").", "modPow", "(", "x", ",", "p", ")", ";", "throw", "new", "InvalidKeyException", "(", "\"", "Shared", "key", "can", "'", "t", "be", "1", "\"", ");", "}", "if", "(", "lastPhase", ")", "{", "return", "null", ";", "}", "return", "new", "BCDHPublicKey", "(", "result", ",", "pubKey", ".", "getParams", "(", "))", ";"], "docstring_tokens": ["reveal", "details", "via", "invalid", "keys"]}
{"contents": ["x86/xen:", "don't", "assume", "%ds", "is", "usable", "in", "xen_iret", "for", "32-bit", "PVOPS.", "This", "fixes", "/", "XSA-42", "Drew", "Jones", "while", "working", "on", "found", "that", "that", "unprivileged", "guest", "user", "in", "32bit", "PV", "guest", "can", "use", "to", "crash", "the", ">", "guest", "with", "the", "panic", "like", "this:", "-------------", "general", "protection", "fault:", "0000", "[#1]", "SMP", "last", "sysfs", "file:", "/sys/devices/vbd-51712/block/xvda/dev", "Modules", "linked", "in:", "sunrpc", "ipt_REJECT", "nf_conntrack_ipv4", "nf_defrag_ipv4", "iptable_filter", "ip_tables", "ip6t_REJECT", "nf_conntrack_ipv6", "nf_defrag_ipv6", "xt_state", "nf_conntrack", "ip6table_filter", "ip6_tables", "ipv6", "xen_netfront", "ext4", "mbcache", "jbd2", "xen_blkfront", "dm_mirror", "dm_region_hash", "dm_log", "dm_mod", "[last", "unloaded:", "scsi_wait_scan]", "Pid:", "1250,", "comm:", "r", "Not", "tainted", "2.6.32-356.el6.i686", "#1", "EIP:", "0061:[<c0407462>]", "EFLAGS:", "00010086", "CPU:", "0", "EIP", "is", "at", "xen_iret+0x12/0x2b", "EAX:", "eb8d0000", "EBX:", "00000001", "ECX:", "08049860", "EDX:", "00000010", "ESI:", "00000000", "EDI:", "003d0f00", "EBP:", "b77f8388", "ESP:", "eb8d1fe0", "DS:", "0000", "ES:", "007b", "FS:", "0000", "GS:", "00e0", "SS:", "0069", "Process", "r", "(pid:", "1250,", "ti=eb8d0000", "task=c2953550", "task.ti=eb8d0000)", "Stack:", "00000000", "0027f416", "00000073", "00000206", "b77f8364", "0000007b", "00000000", "00000000", "Call", "Trace:", "Code:", "c3", "8b", "44", "24", "18", "81", "4c", "24", "38", "00", "02", "00", "00", "8d", "64", "24", "30", "e9", "03", "00", "00", "00", "8d", "76", "00", "f7", "44", "24", "08", "00", "00", "02", "80", "75", "33", "50", "b8", "00", "e0", "ff", "ff", "21", "e0", "<8b>", "40", "10", "8b", "04", "85", "a0", "f6", "ab", "c0", "8b", "80", "0c", "b0", "b3", "c0", "f6", "44", "24", "0d", "02", "EIP:", "[<c0407462>]", "xen_iret+0x12/0x2b", "SS:ESP", "0069:eb8d1fe0", "general", "protection", "fault:", "0000", "[#2]", "---[", "end", "trace", "ab0d29a492dcd330", "]---", "Kernel", "panic", "-", "not", "syncing:", "Fatal", "exception", "Pid:", "1250,", "comm:", "r", "Tainted:", "G", "D", "---------------", "2.6.32-356.el6.i686", "#1", "Call", "Trace:", "[<c08476df>]", "?", "panic+0x6e/0x122", "[<c084b63c>]", "?", "oops_end+0xbc/0xd0", "[<c084b260>]", "?", "do_general_protection+0x0/0x210", "[<c084a9b7>]", "?", "error_code+0x73/", "-------------", "Petr", "says:", "\"", "I've", "analysed", "the", "bug", "and", "I", "think", "that", "xen_iret()", "cannot", "cope", "with", "mangled", "DS,", "in", "this", "case", "zeroed", "out", "(null", "selector/descriptor)", "by", "either", "xen_failsafe_callback()", "or", "RESTORE_REGS", "because", "the", "corresponding", "LDT", "entry", "was", "invalidated", "by", "the", "reproducer.", "\"", "Jan", "took", "a", "look", "at", "the", "preliminary", "patch", "and", "came", "up", "a", "fix", "that", "solves", "this", "problem:", "\"This", "code", "gets", "called", "after", "all", "registers", "other", "than", "those", "handled", "by", "IRET", "got", "already", "restored,", "hence", "a", "null", "selector", "in", "%ds", "or", "a", "non-null", "one", "that", "got", "loaded", "from", "a", "code", "or", "read-only", "data", "descriptor", "would", "cause", "a", "kernel", "mode", "fault", "(with", "the", "potential", "of", "crashing", "the", "kernel", "as", "a", "whole,", "if", "panic_on_oops", "is", "set).\"", "The", "way", "to", "fix", "this", "is", "to", "realize", "that", "the", "we", "can", "only", "relay", "on", "the", "registers", "that", "IRET", "restores.", "The", "two", "that", "are", "guaranteed", "are", "the", "%cs", "and", "%ss", "as", "they", "are", "always", "fixed", "GDT", "selectors.", "Also", "they", "are", "inaccessible", "from", "user", "mode", "-", "so", "they", "cannot", "be", "altered.", "This", "is", "the", "approach", "taken", "in", "this", "patch.", "Another", "alternative", "option", "suggested", "by", "Jan", "would", "be", "to", "relay", "on", "the", "subtle", "realization", "that", "using", "the", "%ebp", "or", "%esp", "relative", "references", "uses", "the", "%ss", "segment.", "In", "which", "case", "we", "could", "switch", "from", "using", "%eax", "to", "%ebp", "and", "would", "not", "need", "the", "%ss", "over-rides.", "That", "would", "also", "require", "one", "extra", "instruction", "to", "compensate", "for", "the", "one", "place", "where", "the", "register", "is", "used", "as", "scaled", "index.", "However", "Andrew", "pointed", "out", "that", "is", "too", "subtle", "and", "if", "further", "work", "was", "to", "be", "done", "in", "this", "code-path", "it", "could", "escape", "folks", "attention", "and", "lead", "to", "accidents.", "Reviewed-by:", "Petr", "Matousek", "<pmatouse@redhat.com>", "Reported-by:", "Petr", "Matousek", "<pmatouse@redhat.com>", "Reviewed-by:", "Andrew", "Cooper", "<andrew.cooper3@citrix.com>", "Signed-off-by:", "Jan", "Beulich", "<jbeulich@suse.com>", "Signed-off-by:", "Konrad", "Rzeszutek", "Wilk", "<konrad.wilk@oracle.com>"], "code_tokens": ["@", "@", "-", "89", ",", "11", "+", "89", ",", "11", "@", "@", "ENTRY", "(", "xen_iret", ")", "*", "/", "#", "ifdef", "CONFIG_SMP", "GET_THREAD_INFO", "(", "%", "eax", ")", "movl", "TI_cpu", "(", "%", "eax", ")", ",", "%", "eax", "movl", "__per_cpu_offset", "(", ",%", "eax", ",", "4", ")", ",", "%", "eax", "mov", "xen_vcpu", "(", "%", "eax", ")", ",", "%", "eax", "movl", "%", "ss", ":", "TI_cpu", "(", "%", "eax", ")", ",", "%", "eax", "movl", "%", "ss", ":", "__per_cpu_offset", "(", ",%", "eax", ",", "4", ")", ",", "%", "eax", "mov", "%", "ss", ":", "xen_vcpu", "(", "%", "eax", ")", ",", "%", "eax", "#", "else", "movl", "xen_vcpu", ",", "%", "eax", "movl", "%", "ss", ":", "xen_vcpu", ",", "%", "eax", "#", "endif", "/", "*", "check", "IF", "state", "we", "'", "re", "restoring", "*", "/", "@", "@", "-", "106", ",", "19", "+", "106", ",", "19", "@", "@", "ENTRY", "(", "xen_iret", ")", "*", "resuming", "the", "code", ",", "so", "we", "don", "'", "t", "have", "to", "be", "worried", "about", "*", "being", "preempted", "to", "another", "CPU", ".", "*", "/", "setz", "XEN_vcpu_info_mask", "(", "%", "eax", ")", "setz", "%", "ss", ":", "XEN_vcpu_info_mask", "(", "%", "eax", ")", "xen_iret_start_crit", ":", "/", "*", "check", "for", "unmasked", "and", "pending", "*", "/", "cmpw", "$", "0x0001", ",", "XEN_vcpu_info_pending", "(", "%", "eax", ")", "cmpw", "$", "0x0001", ",", "%", "ss", ":", "XEN_vcpu_info_pending", "(", "%", "eax", ")", "/", "*", "*", "If", "there", "'", "s", "something", "pending", ",", "mask", "events", "again", "so", "we", "can", "*", "jump", "back", "into", "xen_hypervisor_callback", ".", "Otherwise", "do", "not", "*", "touch", "XEN_vcpu_info_mask", ".", "*", "/", "jne", "1f", "movb", "$", "1", ",", "XEN_vcpu_info_mask", "(", "%", "eax", ")", "movb", "$", "1", ",", "%", "ss", ":", "XEN_vcpu_info_mask", "(", "%", "eax", ")", "1", ":", "popl", "%", "eax"], "docstring_tokens": ["an", "general", "protection", "fault"]}
{"contents": ["DATAJPA-965", "-", "Fix", "potential", "blind", "SQL", "injection", "in", "Sort", "when", "used", "in", "combination", "with", "@Query.", "We", "now", "decline", "sort", "expressions", "that", "contain", "functions", "such", "as", "ORDER", "BY", "LENGTH(name)", "when", "used", "with", "repository", "having", "a", "String", "query", "defined", "via", "the", "@Query", "annotation.", "Think", "of", "a", "query", "method", "as", "follows:", "@Query(\"select", "p", "from", "Person", "p", "where", "LOWER(p.lastname)", "=", "LOWER(:lastname)\")", "List<Person>", "findByLastname(@Param(\"lastname\")", "String", "lastname,", "Sort", "sort);", "Calls", "to", "findByLastname(\"lannister\",", "new", "Sort(\"LENGTH(firstname)\"))", "from", "now", "on", "throw", "an", "Exception", "indicating", "function", "calls", "are", "not", "allowed", "within", "the", "_ORDER", "BY_", "clause.", "However", "you", "still", "can", "use", "JpaSort.unsafe(\"LENGTH(firstname)\")", "to", "restore", "the", "behavior.", "Kudos", "to", "Niklas", "Sa\u0308ro\u0308kaari,", "Joona", "Immonen,", "Arto", "Santala,", "Antti", "Virtanen,", "Michael", "Holopainen", "and", "Antti", "Ahola", "who", "brought", "this", "to", "our", "attention."], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "*", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "class", "JpaSort", "extends", "Sort", "{", "@", "@", "-", "83", ",", "6", "+", "84", ",", "10", "@", "@", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ",", "Direction", "direction", ",", "List", "<", "Path", "<", "?,", "?", ">>", "paths", ")", "super", "(", "combine", "(", "orders", ",", "direction", ",", "paths", ")", ");", "}", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ")", "{", "super", "(", "orders", ")", ";", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "@", "@", "-", "117", ",", "6", "+", "122", ",", "30", "@", "@", "public", "JpaSort", "and", "(", "Direction", "direction", ",", "Path", "<", "?,", "?", ">.", "..", "paths", ")", "{", "return", "new", "JpaSort", "(", "existing", ",", "direction", ",", "Arrays", ".", "asList", "(", "paths", ")", ");", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "JpaSort", "andUnsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "null", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "Order", "order", ":", "this", ")", "{", "orders", ".", "add", "(", "order", ")", ";", "}", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ",", "direction", ",", "Collections", ".", "<", "Path", "<", "?,", "?", ">>", "emptyList", "(", "))", ";", "}", "/", "**", "*", "Turns", "the", "given", "{", "@", "link", "Attribute", "}", "s", "into", "{", "@", "link", "Path", "}", "s", ".", "*", "@", "@", "-", "174", ",", "6", "+", "203", ",", "51", "@", "@", "public", "JpaSort", "and", "(", "Direction", "direction", ",", "Path", "<", "?,", "?", ">.", "..", "paths", ")", "{", "return", "new", "Path", "<", "T", ",", "S", ">", "(", "Arrays", ".", "asList", "(", "attribute", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "properties", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "String", ".", "..", "properties", ")", "{", "return", "unsafe", "(", "Sort", ".", "DEFAULT_DIRECTION", ",", "properties", ")", ";", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notNull", "(", "direction", ",", "\"", "Direction", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "return", "unsafe", "(", "direction", ",", "Arrays", ".", "asList", "(", "properties", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "List", "<", "String", ">", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ")", ";", "}", "/", "**", "*", "Value", "object", "to", "abstract", "a", "collection", "of", "{", "@", "link", "Attribute", "}", "s", ".", "*", "@", "@", "-", "233", ",", "4", "+", "307", ",", "131", "@", "@", "public", "String", "toString", "(", ")", "{", "return", "builder", ".", "length", "(", ")", "=", "=", "0", "?", "\"", "\"", ":", "builder", ".", "substring", "(", "0", ",", "builder", ".", "lastIndexOf", "(", "\".", "\")", ");", "}", "}", "/", "**", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "static", "class", "JpaOrder", "extends", "Order", "{", "private", "final", "boolean", "unsafe", ";", "private", "final", "boolean", "ignoreCase", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaOrder", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ")", "{", "this", "(", "direction", ",", "property", ",", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "Order", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "nullHandlingHint", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "NullHandling", "#", "NATIVE", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandlingHint", ")", "{", "this", "(", "direction", ",", "property", ",", "nullHandlingHint", ",", "false", ",", "true", ")", ";", "}", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandling", ",", "boolean", "ignoreCase", ",", "boolean", "unsafe", ")", "{", "super", "(", "direction", ",", "property", ",", "nullHandling", ")", ";", "this", ".", "ignoreCase", "=", "ignoreCase", ";", "this", ".", "unsafe", "=", "unsafe", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "Direction", "order", ")", "{", "return", "new", "JpaOrder", "(", "order", ",", "getProperty", "(", "),", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "NullHandling", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "NullHandling", "nullHandling", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "nullHandling", ",", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsFirst", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsFirst", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_FIRST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsLast", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsLast", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_LAST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsNative", "(", ")", "*", "/", "public", "JpaOrder", "nullsNative", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "new", "{", "@", "link", "Sort", "}", "with", "potentially", "unsafe", "{", "@", "link", "Order", "}", "instances", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "Sort", "withUnsafe", "(", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "getDirection", "(", "),", "property", ",", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ");", "}", "return", "new", "Sort", "(", "orders", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "ignoreCase", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "ignoreCase", "(", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "getNullHandling", "(", "),", "true", ",", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "isIgnoreCase", "(", ")", "*", "/", "@", "Override", "public", "boolean", "isIgnoreCase", "(", ")", "{", "return", "super", ".", "isIgnoreCase", "(", ")", "|", "|", "ignoreCase", ";", "}", "/", "**", "*", "@", "return", "true", "if", "{", "@", "link", "JpaOrder", "}", "created", "{", "@", "link", "#", "withUnsafe", "(", "String", ".", "..", ")}", ".", "*", "/", "public", "boolean", "isUnsafe", "(", ")", "{", "return", "unsafe", ";", "}", "}", "}", "@", "@", "-", "53", ",", "8", "+", "53", ",", "10", "@", "@", "import", "javax", ".", "persistence", ".", "metamodel", ".", "PluralAttribute", ";", "import", "org", ".", "springframework", ".", "core", ".", "annotation", ".", "AnnotationUtils", ";", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "@", "@", "-", "66", ",", "6", "+", "68", ",", "7", "@", "@", "*", "@", "author", "Kevin", "Raymond", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Komi", "Innocent", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "abstract", "class", "QueryUtils", "{", "@", "@", "-", "102", ",", "6", "+", "105", ",", "10", "@", "@", "private", "static", "final", "int", "QUERY_JOIN_ALIAS_GROUP_INDEX", "=", "2", ";", "private", "static", "final", "int", "VARIABLE_NAME_GROUP_INDEX", "=", "4", ";", "private", "static", "final", "Pattern", "PUNCTATION_PATTERN", "=", "Pattern", ".", "compile", "(", "\".", "*(", "(?", "![", "\\\\", ".", "_", "]", ")[", "\\\\", "p", "{", "Punct", "}", "|\\", "\\", "s", "]", ")\"", ");", "private", "static", "final", "String", "FUNCTION_ALIAS_GROUP_NAME", "=", "\"", "alias", "\"", ";", "private", "static", "final", "Pattern", "FUNCTION_PATTERN", ";", "static", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "@", "@", "-", "145", ",", "6", "+", "152", ",", "13", "@", "@", "builder", ".", "append", "(", "\"\\", "\\)", "\")", ";", "CONSTRUCTOR_EXPRESSION", "=", "compile", "(", "builder", ".", "toString", "(", "),", "CASE_INSENSITIVE", "+", "DOTALL", ")", ";", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "\")", ";", "/", "/", "at", "least", "one", "space", "builder", ".", "append", "(", "\"\\", "\\", "w", "+", "\\\\", "([", "0", "-", "9a", "-", "zA", "-", "z", "\\", "\\.", "_", ",", "\\\\", "s", "'", "]+", "\\\\", ")\"", ");", "/", "/", "any", "function", "call", "including", "parameters", "within", "the", "brackets", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "[", "as", "|", "AS", "]", "+\\", "\\", "s", "+", "(?", "<\"", "+", "FUNCTION_ALIAS_GROUP_NAME", "+", "\"", ">[", "\\\\", "w", "\\", "\\.", "]+", ")\"", ");", "/", "/", "the", "potential", "alias", "FUNCTION_PATTERN", "=", "compile", "(", "builder", ".", "toString", "(", "))", ";", "}", "/", "**", "@", "@", "-", "227", ",", "9", "+", "241", ",", "10", "@", "@", "public", "static", "String", "applySorting", "(", "String", "query", ",", "Sort", "sort", ",", "String", "alias", ")", "{", "}", "Set", "<", "String", ">", "aliases", "=", "getOuterJoinAliases", "(", "query", ")", ";", "Set", "<", "String", ">", "functionAliases", "=", "getFunctionAliases", "(", "query", ")", ";", "for", "(", "Order", "order", ":", "sort", ")", "{", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "functionAliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "}", "builder", ".", "delete", "(", "builder", ".", "length", "(", ")", "-", "2", ",", "builder", ".", "length", "(", "))", ";", "@", "@", "-", "246", ",", "9", "+", "261", ",", "16", "@", "@", "public", "static", "String", "applySorting", "(", "String", "query", ",", "Sort", "sort", ",", "String", "alias", ")", "{", "*", "@", "param", "order", "the", "order", "object", "to", "build", "the", "clause", "for", ".", "*", "@", "return", "*", "/", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Order", "order", ")", "{", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "Set", "<", "String", ">", "functionAlias", ",", "String", "alias", ",", "Order", "order", ")", "{", "String", "property", "=", "order", ".", "getProperty", "(", ");", "checkSortExpression", "(", "order", ")", ";", "if", "(", "functionAlias", ".", "contains", "(", "property", ")", ")", "{", "return", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "property", ",", "toJpaDirection", "(", "order", ")", ");", "}", "boolean", "qualifyReference", "=", "!", "property", ".", "contains", "(", "\"(", "\")", ";", "/", "/", "(", "indicates", "a", "function", "for", "(", "String", "joinAlias", ":", "joinAliases", ")", "{", "@", "@", "-", "287", ",", "6", "+", "309", ",", "28", "@", "@", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Orde", "return", "result", ";", "}", "/", "**", "*", "Returns", "the", "aliases", "used", "for", "aggregate", "functions", "like", "{", "@", "code", "SUM", ",", "COUNT", ",", ".", "..", "}.", "*", "*", "@", "param", "query", "*", "@", "return", "*", "/", "static", "Set", "<", "String", ">", "getFunctionAliases", "(", "String", "query", ")", "{", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", "String", ">", "()", ";", "Matcher", "matcher", "=", "FUNCTION_PATTERN", ".", "matcher", "(", "query", ")", ";", "while", "(", "matcher", ".", "find", "(", "))", "{", "String", "alias", "=", "matcher", ".", "group", "(", "FUNCTION_ALIAS_GROUP_NAME", ")", ";", "if", "(", "StringUtils", ".", "hasText", "(", "alias", ")", ")", "{", "result", ".", "add", "(", "alias", ")", ";", "}", "}", "return", "result", ";", "}", "private", "static", "String", "toJpaDirection", "(", "Order", "order", ")", "{", "return", "order", ".", "getDirection", "(", ").", "name", "(", ").", "toLowerCase", "(", "Locale", ".", "US", ")", ";", "}", "@", "@", "-", "617", ",", "4", "+", "661", ",", "23", "@", "@", "private", "static", "boolean", "isAlreadyFetched", "(", "From", "<", "?,", "?", ">", "from", ",", "String", "attribute", ")", "{", "return", "false", ";", "}", "/", "**", "*", "Check", "any", "given", "{", "@", "link", "JpaOrder", "#", "isUnsafe", "(", ")}", "order", "for", "presence", "of", "at", "least", "one", "property", "offending", "the", "*", "{", "@", "link", "#", "PUNCTATION_PATTERN", "}", "and", "throw", "an", "{", "@", "link", "Exception", "}", "indicating", "potential", "unsafe", "order", "by", "expression", ".", "*", "*", "@", "param", "order", "*", "/", "private", "static", "void", "checkSortExpression", "(", "Order", "order", ")", "{", "if", "(", "order", "instanceof", "JpaOrder", "&", "&", "(", "(", "JpaOrder", ")", "order", ")", ".", "isUnsafe", "(", "))", "{", "return", ";", "}", "if", "(", "PUNCTATION_PATTERN", ".", "matcher", "(", "order", ".", "getProperty", "(", "))", ".", "find", "(", "))", "{", "throw", "new", "InvalidDataAccessApiUsageException", "(", "String", ".", "format", "(", "\"", "Sort", "expression", "'", "%", "s", "'", "must", "not", "contain", "functions", "or", "expressions", ".", "Please", "use", "JpaSort", ".", "unsafe", ".", "\",", "order", ")", ");", "}", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "Path", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "Address_", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "MailMessage_", ";", "@", "@", "-", "47", ",", "6", "+", "48", ",", "7", "@", "@", "*", "@", "see", "DATAJPA", "-", "12", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Christoph", "Strobl", "*", "/", "@", "RunWith", "(", "SpringJUnit4ClassRunner", ".", "class", ")", "@", "ContextConfiguration", "(", "\"", "classpath", ":", "infrastructure", ".", "xml", "\"", ")", "@", "@", "-", "173", ",", "4", "+", "175", ",", "56", "@", "@", "public", "void", "buildsUpPathForPluralAttributesCorrectly", "(", ")", "{", "assertThat", "(", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", "),", "/", "/", "hasItem", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "))", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItem", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortWithMultiplePropertiesCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ",", "\"", "spring", ".", "data", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "spring", ".", "data", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "spring", ".", "data", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesSafeAndUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ").", "andUnsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesUnsafeAndSafeSortCorrectly", "(", ")", "{", "Sort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ").", "and", "(", "ASC", ",", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2008", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2008", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "23", ",", "14", "+", "23", ",", "17", "@", "@", "import", "org", ".", "hamcrest", ".", "Matcher", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "QueryUtils", "}", ".", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Komi", "Innocent", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "class", "QueryUtilsUnitTests", "{", "@", "@", "-", "230", ",", "7", "+", "233", ",", "7", "@", "@", "public", "void", "projectsCOuntQueriesForQueriesWithSubselects", "(", ")", "{", "/", "**", "*", "@", "see", "DATAJPA", "-", "148", "*", "/", "@", "Test", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotPrefixSortsIfFunction", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "@", "@", "-", "361", ",", "6", "+", "364", ",", "134", "@", "@", "public", "void", "doesNotQualifySortIfNoAliasDetected", "(", ")", "{", "endsWith", "(", "\"", "order", "by", "firstname", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotAllowWhitespaceInSort", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "case", "when", "foo", "then", "bar", "\"", ");", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixUnsageJpaSortFunctionCalls", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "assertThat", "(", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", "),", "endsWith", "(", "\"", "order", "by", "sum", "(", "foo", ")", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixMultipleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", ",", "SUM", "(", "m", ".", "stocks", ")", "AS", "sumStocks", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ",", "\"", "sumStocks", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", ",", "sumStocks", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixSingleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesSingleNonAliasedFunctionCallRelatedSortProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "someOtherProperty", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "someOtherProperty", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesNonAliasedFunctionCallRelatedSortPropertyWhenSelectClauseContainesAliasedFunctionForDifferentProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "m", ".", "name", ",", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "name", "\"", ",", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "name", "asc", ",", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleNumericParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "SUBSTRING", "(", "m", ".", "name", ",", "2", ",", "5", ")", "AS", "trimmedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "trimmedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "trimmedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleStringParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "CONCAT", "(", "m", ".", "name", ",", "'", "foo", "'", ")", "AS", "extendedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "extendedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "extendedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithUnderscores", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avg_price", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avg_price", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avg_price", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithDots", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "m", ".", "avg", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "m", ".", "avg", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "avg", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWhenQueryStringContainsMultipleWhiteSpaces", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "private", "static", "void", "assertCountQuery", "(", "String", "originalQuery", ",", "String", "countQuery", ")", "{", "assertThat", "(", "createCountQueryFor", "(", "originalQuery", ")", ",", "is", "(", "countQuery", ")", ");", "}"], "docstring_tokens": ["execute", "arbitrary", "JPQL", "commands", "in", "the", "back-end", "database"]}
{"contents": ["-", "Fix", "bug", "#55776", "(PDORow", "to", "session", "bug)"], "code_tokens": ["@", "@", "-", "2339", ",", "6", "+", "2339", ",", "7", "@", "@", "static", "zend_object_value", "dbstmt_clone_obj", "(", "zval", "*", "zobject", "TSRMLS_DC", ")", "}", "zend_object_handlers", "pdo_dbstmt_object_handlers", ";", "static", "int", "pdo_row_serialize", "(", "zval", "*", "object", ",", "unsigned", "char", "*", "*", "buffer", ",", "zend_uint", "*", "buf_len", ",", "zend_serialize_data", "*", "data", "TSRMLS_DC", ")", ";", "void", "pdo_stmt_init", "(", "TSRMLS_D", ")", "{", "@", "@", "-", "2362", ",", "6", "+", "2363", ",", "7", "@", "@", "void", "pdo_stmt_init", "(", "TSRMLS_D", ")", "pdo_row_ce", "=", "zend_register_internal_class", "(", "&", "ce", "TSRMLS_CC", ")", ";", "pdo_row_ce", "-", ">", "ce_flags", "|", "=", "ZEND_ACC_FINAL_CLASS", ";", "/", "*", "when", "removing", "this", "a", "lot", "of", "handlers", "need", "to", "be", "redone", "*", "/", "pdo_row_ce", "-", ">", "create_object", "=", "pdo_row_new", ";", "pdo_row_ce", "-", ">", "serialize", "=", "pdo_row_serialize", ";", "}", "static", "void", "free_statement", "(", "pdo_stmt_t", "*", "stmt", "TSRMLS_DC", ")", "@", "@", "-", "2802", ",", "6", "+", "2804", ",", "12", "@", "@", "zend_object_value", "pdo_row_new", "(", "zend_class_entry", "*", "ce", "TSRMLS_DC", ")", "return", "retval", ";", "}", "static", "int", "pdo_row_serialize", "(", "zval", "*", "object", ",", "unsigned", "char", "*", "*", "buffer", ",", "zend_uint", "*", "buf_len", ",", "zend_serialize_data", "*", "data", "TSRMLS_DC", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "PDORow", "instances", "may", "not", "be", "serialized", "\"", ");", "return", "FAILURE", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "crash", ")"]}
{"contents": ["ipv6:", "netfilter:", "ip6_tables:", "fix", "infoleak", "to", "userspace", "Structures", "ip6t_replace,", "compat_ip6t_replace,", "and", "xt_get_revision", "are", "copied", "from", "userspace.", "Fields", "of", "these", "structs", "that", "are", "zero-terminated", "strings", "are", "not", "checked.", "When", "they", "are", "used", "as", "argument", "to", "a", "format", "string", "containing", "\"%s\"", "in", "request_module(),", "some", "sensitive", "information", "is", "leaked", "to", "userspace", "via", "argument", "of", "spawned", "modprobe", "process.", "The", "first", "bug", "was", "introduced", "before", "the", "git", "epoch;", "the", "second", "was", "introduced", "in", "3bc3fe5e", "(v2.6.25-rc1);", "the", "third", "is", "introduced", "by", "6b7d31fc", "(v2.6.15-rc1).", "To", "trigger", "the", "bug", "one", "should", "have", "CAP_NET_ADMIN.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segoon@openwall.com>", "Signed-off-by:", "Patrick", "McHardy", "<kaber@trash.net>"], "code_tokens": ["@", "@", "-", "1275", ",", "6", "+", "1275", ",", "7", "@", "@", "do_replace", "(", "struct", "net", "*", "net", ",", "const", "void", "__user", "*", "user", ",", "unsigned", "int", "len", ")", "/", "*", "overflow", "check", "*", "/", "if", "(", "tmp", ".", "num_counters", ">", "=", "INT_MAX", "/", "sizeof", "(", "struct", "xt_counters", ")", ")", "return", "-", "ENOMEM", ";", "tmp", ".", "name", "[", "sizeof", "(", "tmp", ".", "name", ")", "-", "1", "]", "=", "0", ";", "newinfo", "=", "xt_alloc_table_info", "(", "tmp", ".", "size", ")", ";", "if", "(", "!", "newinfo", ")", "@", "@", "-", "1822", ",", "6", "+", "1823", ",", "7", "@", "@", "compat_do_replace", "(", "struct", "net", "*", "net", ",", "void", "__user", "*", "user", ",", "unsigned", "int", "len", ")", "return", "-", "ENOMEM", ";", "if", "(", "tmp", ".", "num_counters", ">", "=", "INT_MAX", "/", "sizeof", "(", "struct", "xt_counters", ")", ")", "return", "-", "ENOMEM", ";", "tmp", ".", "name", "[", "sizeof", "(", "tmp", ".", "name", ")", "-", "1", "]", "=", "0", ";", "newinfo", "=", "xt_alloc_table_info", "(", "tmp", ".", "size", ")", ";", "if", "(", "!", "newinfo", ")", "@", "@", "-", "2051", ",", "6", "+", "2053", ",", "7", "@", "@", "do_ip6t_get_ctl", "(", "struct", "sock", "*", "sk", ",", "int", "cmd", ",", "void", "__user", "*", "user", ",", "int", "*", "len", ")", "ret", "=", "-", "EFAULT", ";", "break", ";", "}", "rev", ".", "name", "[", "sizeof", "(", "rev", ".", "name", ")", "-", "1", "]", "=", "0", ";", "if", "(", "cmd", "=", "=", "IP6T_SO_GET_REVISION_TARGET", ")", "target", "=", "1", ";"], "docstring_tokens": ["obtain", "potentially", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["vfs:", "Test", "for", "and", "handle", "paths", "that", "are", "unreachable", "from", "their", "mnt_root", "In", "rare", "cases", "a", "directory", "can", "be", "renamed", "out", "from", "under", "a", "bind", "mount.", "In", "those", "cases", "without", "special", "handling", "it", "becomes", "possible", "to", "walk", "up", "the", "directory", "tree", "to", "the", "root", "dentry", "of", "the", "filesystem", "and", "down", "from", "the", "root", "dentry", "to", "every", "other", "file", "or", "directory", "on", "the", "filesystem.", "Like", "division", "by", "zero", "..", "from", "an", "unconnected", "path", "can", "not", "be", "given", "a", "useful", "semantic", "as", "there", "is", "no", "predicting", "at", "which", "path", "component", "the", "code", "will", "realize", "it", "is", "unconnected.", "We", "certainly", "can", "not", "match", "the", "current", "behavior", "as", "the", "current", "behavior", "is", "a", "security", "hole.", "Therefore", "when", "encounting", "..", "when", "following", "an", "unconnected", "path", "return", "-ENOENT.", "-", "Add", "a", "function", "path_connected", "to", "verify", "path->dentry", "is", "reachable", "from", "path->mnt.mnt_root.", "AKA", "to", "validate", "that", "rename", "did", "not", "do", "something", "nasty", "to", "the", "bind", "mount.", "To", "avoid", "races", "path_connected", "must", "be", "called", "after", "following", "a", "path", "component", "to", "it's", "next", "path", "component.", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["@", "@", "-", "560", ",", "6", "+", "560", ",", "24", "@", "@", "static", "int", "__nd_alloc_stack", "(", "struct", "nameidata", "*", "nd", ")", "return", "0", ";", "}", "/", "**", "*", "path_connected", "-", "Verify", "that", "a", "path", "-", ">", "dentry", "is", "below", "path", "-", ">", "mnt", ".", "mnt_root", "*", "@", "path", ":", "nameidate", "to", "verify", "*", "*", "Rename", "can", "sometimes", "move", "a", "file", "or", "directory", "outside", "of", "a", "bind", "*", "mount", ",", "path_connected", "allows", "those", "cases", "to", "be", "detected", ".", "*", "/", "static", "bool", "path_connected", "(", "const", "struct", "path", "*", "path", ")", "{", "struct", "vfsmount", "*", "mnt", "=", "path", "-", ">", "mnt", ";", "/", "*", "Only", "bind", "mounts", "can", "have", "disconnected", "paths", "*", "/", "if", "(", "mnt", "-", ">", "mnt_root", "=", "=", "mnt", "-", ">", "mnt_sb", "-", ">", "s_root", ")", "return", "true", ";", "return", "is_subdir", "(", "path", "-", ">", "dentry", ",", "mnt", "-", ">", "mnt_root", ")", ";", "}", "static", "inline", "int", "nd_alloc_stack", "(", "struct", "nameidata", "*", "nd", ")", "{", "if", "(", "likely", "(", "nd", "-", ">", "depth", "!", "=", "EMBEDDED_LEVELS", ")", ")", "@", "@", "-", "1296", ",", "6", "+", "1314", ",", "8", "@", "@", "static", "int", "follow_dotdot_rcu", "(", "struct", "nameidata", "*", "nd", ")", "return", "-", "ECHILD", ";", "nd", "-", ">", "path", ".", "dentry", "=", "parent", ";", "nd", "-", ">", "seq", "=", "seq", ";", "if", "(", "unlikely", "(", "!", "path_connected", "(", "&", "nd", "-", ">", "path", ")", "))", "return", "-", "ENOENT", ";", "break", ";", "}", "else", "{", "struct", "mount", "*", "mnt", "=", "real_mount", "(", "nd", "-", ">", "path", ".", "mnt", ")", ";", "@", "@", "-", "1396", ",", "7", "+", "1416", ",", "7", "@", "@", "static", "void", "follow_mount", "(", "struct", "path", "*", "path", ")", "}", "}", "static", "void", "follow_dotdot", "(", "struct", "nameidata", "*", "nd", ")", "static", "int", "follow_dotdot", "(", "struct", "nameidata", "*", "nd", ")", "{", "if", "(", "!", "nd", "-", ">", "root", ".", "mnt", ")", "set_root", "(", "nd", ")", ";", "@", "@", "-", "1412", ",", "13", "+", "1432", ",", "16", "@", "@", "static", "void", "follow_dotdot", "(", "struct", "nameidata", "*", "nd", ")", "/", "*", "rare", "case", "of", "legitimate", "dget_parent", "(", ").", "..", "*", "/", "nd", "-", ">", "path", ".", "dentry", "=", "dget_parent", "(", "nd", "-", ">", "path", ".", "dentry", ")", ";", "dput", "(", "old", ")", ";", "if", "(", "unlikely", "(", "!", "path_connected", "(", "&", "nd", "-", ">", "path", ")", "))", "return", "-", "ENOENT", ";", "break", ";", "}", "if", "(", "!", "follow_up", "(", "&", "nd", "-", ">", "path", ")", ")", "break", ";", "}", "follow_mount", "(", "&", "nd", "-", ">", "path", ")", ";", "nd", "-", ">", "inode", "=", "nd", "-", ">", "path", ".", "dentry", "-", ">", "d_inode", ";", "return", "0", ";", "}", "/", "*", "@", "@", "-", "1634", ",", "7", "+", "1657", ",", "7", "@", "@", "static", "inline", "int", "handle_dots", "(", "struct", "nameidata", "*", "nd", ",", "int", "type", ")", "if", "(", "nd", "-", ">", "flags", "&", "LOOKUP_RCU", ")", "{", "return", "follow_dotdot_rcu", "(", "nd", ")", ";", "}", "else", "follow_dotdot", "(", "nd", ")", ";", "return", "follow_dotdot", "(", "nd", ")", ";", "}", "return", "0", ";", "}"], "docstring_tokens": ["bypass", "an", "intended", "container", "protection", "mechanism"]}
{"contents": ["[SECURITY-996]"], "code_tokens": ["@", "@", "-", "304", ",", "6", "+", "304", ",", "9", "@", "@", "public", "void", "doLogout", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", "/", "/", "reset", "remember", "-", "me", "cookie", "Cookie", "cookie", "=", "new", "Cookie", "(", "ACEGI_SECURITY_HASHED_REMEMBER_ME_COOKIE_KEY", ",", "\"\"", ");", "cookie", ".", "setMaxAge", "(", "0", ")", ";", "cookie", ".", "setSecure", "(", "req", ".", "isSecure", "(", "))", ";", "cookie", ".", "setHttpOnly", "(", "true", ")", ";", "cookie", ".", "setPath", "(", "req", ".", "getContextPath", "(", ").", "length", "(", ")>", "0", "?", "req", ".", "getContextPath", "(", ")", ":", "\"", "/\"", ");", "rsp", ".", "addCookie", "(", "cookie", ")", ";", "@", "@", "-", "123", ",", "19", "+", "123", ",", "39", "@", "@", "public", "void", "loginSuccess", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "respons", "@", "Override", "public", "Authentication", "autoLogin", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "try", "{", "return", "super", ".", "autoLogin", "(", "request", ",", "response", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "cancelCookie", "(", "request", ",", "response", ",", "\"", "Failed", "to", "handle", "remember", "-", "me", "cookie", ":", "\"", "+", "Functions", ".", "printThrowable", "(", "e", ")", ");", "if", "(", "Jenkins", ".", "getInstance", "(", ").", "isDisableRememberMe", "(", "))", "{", "cancelCookie", "(", "request", ",", "response", ",", "null", ")", ";", "return", "null", ";", "}", "else", "{", "try", "{", "return", "super", ".", "autoLogin", "(", "request", ",", "response", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "cancelCookie", "(", "request", ",", "response", ",", "\"", "Failed", "to", "handle", "remember", "-", "me", "cookie", ":", "\"", "+", "Functions", ".", "printThrowable", "(", "e", ")", ");", "return", "null", ";", "}", "}", "}", "@", "Override", "protected", "Cookie", "makeValidCookie", "(", "String", "tokenValueBase64", ",", "HttpServletRequest", "request", ",", "long", "maxAge", ")", "{", "Cookie", "cookie", "=", "super", ".", "makeValidCookie", "(", "tokenValueBase64", ",", "request", ",", "maxAge", ")", ";", "@", "Override", "protected", "Cookie", "makeValidCookie", "(", "String", "tokenValueBase64", ",", "HttpServletRequest", "request", ",", "long", "maxAge", ")", "{", "Cookie", "cookie", "=", "super", ".", "makeValidCookie", "(", "tokenValueBase64", ",", "request", ",", "maxAge", ")", ";", "secureCookie", "(", "cookie", ",", "request", ")", ";", "return", "cookie", ";", "}", "@", "Override", "protected", "Cookie", "makeCancelCookie", "(", "HttpServletRequest", "request", ")", "{", "Cookie", "cookie", "=", "super", ".", "makeCancelCookie", "(", "request", ")", ";", "secureCookie", "(", "cookie", ",", "request", ")", ";", "return", "cookie", ";", "}", "/", "**", "*", "Force", "always", "the", "http", "-", "only", "flag", "and", "depending", "on", "the", "request", ",", "put", "also", "the", "secure", "flag", ".", "*", "/", "private", "void", "secureCookie", "(", "Cookie", "cookie", ",", "HttpServletRequest", "request", ")", "{", "/", "/", "if", "we", "can", "mark", "the", "cookie", "HTTP", "only", ",", "do", "so", "to", "protect", "this", "cookie", "even", "in", "case", "of", "XSS", "vulnerability", ".", "if", "(", "SET_HTTP_ONLY", "!", "=", "null", ")", "{", "if", "(", "SET_HTTP_ONLY", "!", "=", "null", ")", "{", "try", "{", "SET_HTTP_ONLY", ".", "invoke", "(", "cookie", ",", "true", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "@", "@", "-", "148", ",", "12", "+", "168", ",", "10", "@", "@", "protected", "Cookie", "makeValidCookie", "(", "String", "tokenValueBase64", ",", "HttpServletRequest", "req", "/", "/", "if", "the", "user", "is", "running", "Jenkins", "over", "HTTPS", ",", "we", "also", "want", "to", "prevent", "the", "cookie", "from", "leaking", "in", "HTTP", ".", "/", "/", "whether", "the", "login", "is", "done", "over", "HTTPS", "or", "not", "would", "be", "a", "good", "enough", "approximation", "of", "whether", "Jenkins", "runs", "in", "/", "/", "HTTPS", "or", "not", ",", "so", "use", "that", ".", "if", "(", "request", ".", "isSecure", "(", "))", "cookie", ".", "setSecure", "(", "true", ")", ";", "return", "cookie", ";", "}", "cookie", ".", "setSecure", "(", "request", ".", "isSecure", "(", "))", ";", "}", "/", "**", "/", "**", "*", "Used", "to", "compute", "the", "token", "signature", "securely", ".", "*", "/", "private", "static", "final", "HMACConfidentialKey", "MAC", "=", "new", "HMACConfidentialKey", "(", "TokenBasedRememberMeServices", ".", "class", ",", "\"", "mac", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "88", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "security", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "util", ".", "Cookie", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "xml", ".", "XmlPage", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "text", ".", "IsEmptyString", ".", "isEmptyString", ";", "import", "static", "org", ".", "hamcrest", ".", "xml", ".", "HasXPath", ".", "hasXPath", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "TokenBasedRememberMeServices2Test_SEC996", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "996", "\"", ")", "public", "void", "rememberMeToken_shouldNotBeRead_ifOptionIsDisabled", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setDisableRememberMe", "(", "false", ")", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "Cookie", "rememberMeCookie", "=", "null", ";", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "login", "(", "\"", "alice", "\"", ",", "\"", "alice", "\"", ",", "true", ")", ";", "/", "/", "we", "should", "see", "a", "remember", "me", "cookie", "rememberMeCookie", "=", "getRememberMeCookie", "(", "wc", ")", ";", "assertNotNull", "(", "rememberMeCookie", ")", ";", "assertThat", "(", "rememberMeCookie", ".", "getValue", "(", "),", "not", "(", "isEmptyString", "(", "))", ");", "}", "j", ".", "jenkins", ".", "setDisableRememberMe", "(", "true", ")", ";", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getCookieManager", "(", ").", "addCookie", "(", "rememberMeCookie", ")", ";", "/", "/", "the", "application", "should", "not", "use", "the", "cookie", "to", "connect", "XmlPage", "page", "=", "(", "XmlPage", ")", "wc", ".", "goTo", "(", "\"", "whoAmI", "/", "api", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ");", "assertThat", "(", "page", ",", "hasXPath", "(", "\"/", "/", "name", "\"", ",", "not", "(", "is", "(", "\"", "alice", "\"", "))", "))", ";", "}", "j", ".", "jenkins", ".", "setDisableRememberMe", "(", "false", ")", ";", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getCookieManager", "(", ").", "addCookie", "(", "rememberMeCookie", ")", ";", "/", "/", "if", "we", "reactivate", "the", "remember", "me", "feature", ",", "it", "'", "s", "ok", "XmlPage", "page", "=", "(", "XmlPage", ")", "wc", ".", "goTo", "(", "\"", "whoAmI", "/", "api", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ");", "assertThat", "(", "page", ",", "hasXPath", "(", "\"/", "/", "name", "\"", ",", "is", "(", "\"", "alice", "\"", "))", ");", "}", "}", "private", "Cookie", "getRememberMeCookie", "(", "JenkinsRule", ".", "WebClient", "wc", ")", "{", "return", "wc", ".", "getCookieManager", "(", ").", "getCookie", "(", "TokenBasedRememberMeServices2", ".", "ACEGI_SECURITY_HASHED_REMEMBER_ME_COOKIE_KEY", ")", ";", "}", "}"], "docstring_tokens": ["evaluate", "the", "\\\"Remember", "me\\\"", "cookie", "even", "when", "the", "feature", "has", "been", "disabled"]}
{"contents": ["x86/insn-eval:", "Fix", "use-after-free", "access", "to", "LDT", "entry", "get_desc()", "computes", "a", "pointer", "into", "the", "LDT", "while", "holding", "a", "lock", "that", "protects", "the", "LDT", "from", "being", "freed,", "but", "then", "drops", "the", "lock", "and", "returns", "the", "(now", "potentially", "dangling)", "pointer", "to", "its", "caller.", "Fix", "it", "by", "giving", "the", "caller", "a", "copy", "of", "the", "LDT", "entry", "instead.", "Fixes:", "670f928ba09b", "(\"x86/insn-eval:", "Add", "utility", "function", "to", "get", "segment", "descriptor\")", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "557", ",", "39", "+", "557", ",", "42", "@", "@", "static", "int", "get_reg_offset_16", "(", "struct", "insn", "*", "insn", ",", "struct", "pt_regs", "*", "regs", ",", "}", "/", "**", "*", "get_desc", "(", ")", "-", "Obtain", "pointer", "to", "a", "segment", "descriptor", "*", "get_desc", "(", ")", "-", "Obtain", "contents", "of", "a", "segment", "descriptor", "*", "@", "out", ":", "Segment", "descriptor", "contents", "on", "success", "*", "@", "sel", ":", "Segment", "selector", "*", "*", "Given", "a", "segment", "selector", ",", "obtain", "a", "pointer", "to", "the", "segment", "descriptor", ".", "*", "Both", "global", "and", "local", "descriptor", "tables", "are", "supported", ".", "*", "*", "Returns", ":", "*", "*", "Pointer", "to", "segment", "descriptor", "on", "success", ".", "*", "True", "on", "success", ",", "false", "on", "failure", ".", "*", "*", "NULL", "on", "error", ".", "*", "/", "static", "struct", "desc_struct", "*", "get_desc", "(", "unsigned", "short", "sel", ")", "static", "bool", "get_desc", "(", "struct", "desc_struct", "*", "out", ",", "unsigned", "short", "sel", ")", "{", "struct", "desc_ptr", "gdt_desc", "=", "{", "0", ",", "0", "}", ";", "unsigned", "long", "desc_base", ";", "#", "ifdef", "CONFIG_MODIFY_LDT_SYSCALL", "if", "(", "(", "sel", "&", "SEGMENT_TI_MASK", ")", "=", "=", "SEGMENT_LDT", ")", "{", "struct", "desc_struct", "*", "desc", "=", "NULL", ";", "bool", "success", "=", "false", ";", "struct", "ldt_struct", "*", "ldt", ";", "/", "*", "Bits", "[", "15", ":", "3", "]", "contain", "the", "index", "of", "the", "desired", "entry", ".", "*", "/", "sel", ">", ">=", "3", ";", "mutex_lock", "(", "&", "current", "-", ">", "active_mm", "-", ">", "context", ".", "lock", ")", ";", "ldt", "=", "current", "-", ">", "active_mm", "-", ">", "context", ".", "ldt", ";", "if", "(", "ldt", "&", "&", "sel", "<", "ldt", "-", ">", "nr_entries", ")", "desc", "=", "&", "ldt", "-", ">", "entries", "[", "sel", "]", ";", "if", "(", "ldt", "&", "&", "sel", "<", "ldt", "-", ">", "nr_entries", ")", "{", "*", "out", "=", "ldt", "-", ">", "entries", "[", "sel", "]", ";", "success", "=", "true", ";", "}", "mutex_unlock", "(", "&", "current", "-", ">", "active_mm", "-", ">", "context", ".", "lock", ")", ";", "return", "desc", ";", "return", "success", ";", "}", "#", "endif", "native_store_gdt", "(", "&", "gdt_desc", ")", ";", "@", "@", "-", "604", ",", "9", "+", "607", ",", "10", "@", "@", "static", "struct", "desc_struct", "*", "get_desc", "(", "unsigned", "short", "sel", ")", "desc_base", "=", "sel", "&", "~", "(", "SEGMENT_RPL_MASK", "|", "SEGMENT_TI_MASK", ")", ";", "if", "(", "desc_base", ">", "gdt_desc", ".", "size", ")", "return", "NULL", ";", "return", "false", ";", "return", "(", "struct", "desc_struct", "*", ")(", "gdt_desc", ".", "address", "+", "desc_base", ")", ";", "*", "out", "=", "*", "(", "struct", "desc_struct", "*", ")(", "gdt_desc", ".", "address", "+", "desc_base", ")", ";", "return", "true", ";", "}", "/", "**", "@", "@", "-", "628", ",", "7", "+", "632", ",", "7", "@", "@", "static", "struct", "desc_struct", "*", "get_desc", "(", "unsigned", "short", "sel", ")", "*", "/", "unsigned", "long", "insn_get_seg_base", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "{", "struct", "desc_struct", "*", "desc", ";", "struct", "desc_struct", "desc", ";", "short", "sel", ";", "sel", "=", "get_segment_selector", "(", "regs", ",", "seg_reg_idx", ")", ";", "@", "@", "-", "666", ",", "11", "+", "670", ",", "10", "@", "@", "unsigned", "long", "insn_get_seg_base", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "if", "(", "!", "sel", ")", "return", "-", "1L", ";", "desc", "=", "get_desc", "(", "sel", ")", ";", "if", "(", "!", "desc", ")", "if", "(", "!", "get_desc", "(", "&", "desc", ",", "sel", ")", ")", "return", "-", "1L", ";", "return", "get_desc_base", "(", "desc", ")", ";", "return", "get_desc_base", "(", "&", "desc", ")", ";", "}", "/", "**", "@", "@", "-", "692", ",", "7", "+", "695", ",", "7", "@", "@", "unsigned", "long", "insn_get_seg_base", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "*", "/", "static", "unsigned", "long", "get_seg_limit", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "{", "struct", "desc_struct", "*", "desc", ";", "struct", "desc_struct", "desc", ";", "unsigned", "long", "limit", ";", "short", "sel", ";", "@", "@", "-", "706", ",", "8", "+", "709", ",", "7", "@", "@", "static", "unsigned", "long", "get_seg_limit", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "if", "(", "!", "sel", ")", "return", "0", ";", "desc", "=", "get_desc", "(", "sel", ")", ";", "if", "(", "!", "desc", ")", "if", "(", "!", "get_desc", "(", "&", "desc", ",", "sel", ")", ")", "return", "0", ";", "/", "*", "@", "@", "-", "716", ",", "8", "+", "718", ",", "8", "@", "@", "static", "unsigned", "long", "get_seg_limit", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "*", "not", "tested", "when", "checking", "the", "segment", "limits", ".", "In", "practice", ",", "*", "this", "means", "that", "the", "segment", "ends", "in", "(", "limit", "<", "<", "12", ")", "+", "0xfff", ".", "*", "/", "limit", "=", "get_desc_limit", "(", "desc", ")", ";", "if", "(", "desc", "-", ">", "g", ")", "limit", "=", "get_desc_limit", "(", "&", "desc", ")", ";", "if", "(", "desc", ".", "g", ")", "limit", "=", "(", "limit", "<", "<", "12", ")", "+", "0xfff", ";", "return", "limit", ";", "@", "@", "-", "741", ",", "7", "+", "743", ",", "7", "@", "@", "static", "unsigned", "long", "get_seg_limit", "(", "struct", "pt_regs", "*", "regs", ",", "int", "seg_reg_idx", ")", "*", "/", "int", "insn_get_code_seg_params", "(", "struct", "pt_regs", "*", "regs", ")", "{", "struct", "desc_struct", "*", "desc", ";", "struct", "desc_struct", "desc", ";", "short", "sel", ";", "if", "(", "v8086_mode", "(", "regs", ")", ")", "@", "@", "-", "752", ",", "19", "+", "754", ",", "18", "@", "@", "int", "insn_get_code_seg_params", "(", "struct", "pt_regs", "*", "regs", ")", "if", "(", "sel", "<", "0", ")", "return", "sel", ";", "desc", "=", "get_desc", "(", "sel", ")", ";", "if", "(", "!", "desc", ")", "if", "(", "!", "get_desc", "(", "&", "desc", ",", "sel", ")", ")", "return", "-", "EINVAL", ";", "/", "*", "*", "The", "most", "significant", "byte", "of", "the", "Type", "field", "of", "the", "segment", "descriptor", "*", "determines", "whether", "a", "segment", "contains", "data", "or", "code", ".", "If", "this", "is", "a", "data", "*", "segment", ",", "return", "error", ".", "*", "/", "if", "(", "!(", "desc", "-", ">", "type", "&", "BIT", "(", "3", ")", "))", "if", "(", "!(", "desc", ".", "type", "&", "BIT", "(", "3", ")", "))", "return", "-", "EINVAL", ";", "switch", "(", "(", "desc", "-", ">", "l", "<", "<", "1", ")", "|", "desc", "-", ">", "d", ")", "{", "switch", "(", "(", "desc", ".", "l", "<", "<", "1", ")", "|", "desc", ".", "d", ")", "{", "case", "0", ":", "/", "*", "*", "Legacy", "mode", ".", "CS", ".", "L", "=", "0", ",", "CS", ".", "D", "=", "0", ".", "Address", "and", "operand", "size", "are", "*", "both", "16", "-", "bit", "."], "docstring_tokens": ["a", "denial", "of", "service", "condition"]}
{"contents": ["HV-912", "Removing", "unused", "method", "parameter"], "code_tokens": ["@", "@", "-", "533", ",", "7", "+", "533", ",", "7", "@", "@", "private", "boolean", "validateConstraint", "(", "ValidationContext", "<", "?>", "validationContext", ",", "if", "(", "!", "propertyPathComplete", ")", "{", "valueContext", ".", "appendNode", "(", "propertyMetaData", ")", ";", "}", "setValidatedValueHandlerToValueContextIfPresent", "(", "validationContext", ",", "valueContext", ",", "propertyMetaData", ")", ";", "setValidatedValueHandlerToValueContextIfPresent", "(", "valueContext", ",", "propertyMetaData", ")", ";", "}", "else", "{", "valueContext", ".", "appendBeanNode", "(", ");", "@", "@", "-", "580", ",", "7", "+", "580", ",", "7", "@", "@", "private", "void", "validateCascadedConstraints", "(", "ValidationContext", "<", "?>", "validationContext", ",", "/", "/", "Value", "can", "be", "wrapped", "(", "e", ".", "g", ".", "Optional", "<", "Address", ">", ").", "Try", "to", "unwrap", "it", "ConstraintMetaData", "metaData", "=", "(", "ConstraintMetaData", ")", "cascadable", ";", "if", "(", "metaData", ".", "requiresUnwrapping", "(", ")", ")", "{", "setValidatedValueHandlerToValueContextIfPresent", "(", "validationContext", ",", "valueContext", ",", "metaData", ")", ";", "setValidatedValueHandlerToValueContextIfPresent", "(", "valueContext", ",", "metaData", ")", ";", "valueContext", ".", "setCurrentValidatedValue", "(", "value", ")", ";", "value", "=", "valueContext", ".", "getCurrentValidatedValue", "(", ");", "}", "@", "@", "-", "1094", ",", "7", "+", "1094", ",", "7", "@", "@", "private", "int", "validatePropertyForNonDefaultGroup", "(", "ValueContext", "<", "?,", "Object", ">", "valueCont", "}", "valueContext", ".", "appendNode", "(", "parameterMetaData", ")", ";", "setValidatedValueHandlerToValueContextIfPresent", "(", "validationContext", ",", "valueContext", ",", "parameterMetaData", ")", ";", "setValidatedValueHandlerToValueContextIfPresent", "(", "valueContext", ",", "parameterMetaData", ")", ";", "valueContext", ".", "setCurrentValidatedValue", "(", "value", ")", ";", "numberOfViolationsOfCurrentGroup", "+", "=", "validateConstraintsForGroup", "(", "@", "@", "-", "1250", ",", "7", "+", "1250", ",", "6", "@", "@", "private", "int", "validatePropertyForNonDefaultGroup", "(", "ValueContext", "<", "?,", "Object", ">", "valueCont", "valueContext", ".", "setCurrentValidatedValue", "(", "value", ")", ";", "valueContext", ".", "appendNode", "(", "executableMetaData", ".", "getReturnValueMetaData", "(", ")", ")", ";", "setValidatedValueHandlerToValueContextIfPresent", "(", "validationContext", ",", "valueContext", ",", "executableMetaData", ".", "getReturnValueMetaData", "(", ")", ")", ";", "@", "@", "-", "1487", ",", "8", "+", "1486", ",", "7", "@", "@", "private", "boolean", "shouldFailFast", "(", "ValidationContext", "<", "?>", "context", ")", "{", "return", "null", ";", "}", "private", "<", "T", ">", "void", "setValidatedValueHandlerToValueContextIfPresent", "(", "ValidationContext", "<", "?>", "validationContext", ",", "ValueContext", "<", "?,", "T", ">", "valueContext", ",", "ConstraintMetaData", "metaData", ")", "{", "private", "<", "T", ">", "void", "setValidatedValueHandlerToValueContextIfPresent", "(", "ValueContext", "<", "?,", "T", ">", "valueContext", ",", "ConstraintMetaData", "metaData", ")", "{", "if", "(", "metaData", ".", "requiresUnwrapping", "(", ")", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "/", "/", "we", "know", "the", "handler", "matches", "the", "value", "type", "ValidatedValueUnwrapper", "<", "?", "super", "T", ">", "handler", "=", "(", "ValidatedValueUnwrapper", "<", "T", ">", ")", "getValidatedValueHandler", "("], "docstring_tokens": ["execute", "restricted", "reflection", "calls", "on", "the", "system"]}
{"contents": ["x86:", "bpf_jit:", "fix", "compilation", "of", "large", "bpf", "programs", "x86", "has", "variable", "length", "encoding.", "x86", "JIT", "compiler", "is", "trying", "to", "pick", "the", "shortest", "encoding", "for", "given", "bpf", "instruction.", "While", "doing", "so", "the", "jump", "targets", "are", "changing,", "so", "JIT", "is", "doing", "multiple", "passes", "over", "the", "program.", "Typical", "program", "needs", "3", "passes.", "Some", "very", "short", "programs", "converge", "with", "2", "passes.", "Large", "programs", "may", "need", "4", "or", "5.", "But", "specially", "crafted", "bpf", "programs", "may", "hit", "the", "pass", "limit", "and", "if", "the", "program", "converges", "on", "the", "last", "iteration", "the", "JIT", "compiler", "will", "be", "producing", "an", "image", "full", "of", "'int", "3'", "insns.", "Fix", "this", "corner", "case", "by", "doing", "final", "iteration", "over", "bpf", "program.", "Fixes:", "0a14842f5a3c", "(\"net:", "filter:", "Just", "In", "Time", "compiler", "for", "x86-64\")", "Reported-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@plumgrid.com>", "Tested-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>", "Acked-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "966", ",", "7", "+", "966", ",", "12", "@", "@", "void", "bpf_int_jit_compile", "(", "struct", "bpf_prog", "*", "prog", ")", "}", "ctx", ".", "cleanup_addr", "=", "proglen", ";", "for", "(", "pass", "=", "0", ";", "pass", "<", "10", ";", "pass", "+", "+)", "{", "/", "*", "JITed", "image", "shrinks", "with", "every", "pass", "and", "the", "loop", "iterates", "*", "until", "the", "image", "stops", "shrinking", ".", "Very", "large", "bpf", "programs", "*", "may", "converge", "on", "the", "last", "pass", ".", "In", "such", "case", "do", "one", "more", "*", "pass", "to", "emit", "the", "final", "image", "*", "/", "for", "(", "pass", "=", "0", ";", "pass", "<", "10", "|", "|", "image", ";", "pass", "+", "+)", "{", "proglen", "=", "do_jit", "(", "prog", ",", "addrs", ",", "image", ",", "oldproglen", ",", "&", "ctx", ")", ";", "if", "(", "proglen", "<", "=", "0", ")", "{", "image", "=", "NULL", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", ")"]}
{"contents": ["DATAJPA-965", "-", "Fix", "potential", "blind", "SQL", "injection", "in", "Sort", "when", "used", "in", "combination", "with", "@Query.", "We", "now", "decline", "sort", "expressions", "that", "contain", "functions", "such", "as", "ORDER", "BY", "LENGTH(name)", "when", "used", "with", "repository", "having", "a", "String", "query", "defined", "via", "the", "@Query", "annotation.", "Think", "of", "a", "query", "method", "as", "follows:", "@Query(\"select", "p", "from", "Person", "p", "where", "LOWER(p.lastname)", "=", "LOWER(:lastname)\")", "List<Person>", "findByLastname(@Param(\"lastname\")", "String", "lastname,", "Sort", "sort);", "Calls", "to", "findByLastname(\"lannister\",", "new", "Sort(\"LENGTH(firstname)\"))", "from", "now", "on", "throw", "an", "Exception", "indicating", "function", "calls", "are", "not", "allowed", "within", "the", "_ORDER", "BY_", "clause.", "However", "you", "still", "can", "use", "JpaSort.unsafe(\"LENGTH(firstname)\")", "to", "restore", "the", "behavior.", "Kudos", "to", "Niklas", "Sa\u0308ro\u0308kaari,", "Joona", "Immonen,", "Arto", "Santala,", "Antti", "Virtanen,", "Michael", "Holopainen", "and", "Antti", "Ahola", "who", "brought", "this", "to", "our", "attention."], "code_tokens": ["@", "@", "-", "303", ",", "6", "+", "303", ",", "42", "@", "@", "public", "interface", "UserRepository", "extends", "JpaRepository", "<", "User", ",", "Long", ">", "{", "This", "also", "works", "with", "named", "native", "queries", "by", "adding", "the", "suffix", "`", ".", "count", "`", "to", "a", "copy", "of", "your", "query", ".", "Be", "aware", "that", "you", "probably", "must", "register", "a", "result", "set", "mapping", "for", "your", "count", "query", ",", "though", ".", "[", "[", "jpa", ".", "query", "-", "methods", ".", "sorting", "]", "]", "=", "==", "Using", "Sort", "Sorting", "can", "be", "done", "be", "either", "providing", "a", "`", "PageRequest", "`", "or", "using", "`", "Sort", "`", "directly", ".", "The", "properties", "actually", "used", "within", "the", "`", "Order", "`", "instances", "of", "`", "Sort", "`", "need", "to", "match", "to", "your", "domain", "model", ",", "which", "means", "they", "need", "to", "resolve", "to", "either", "a", "property", "or", "an", "alias", "used", "within", "the", "query", ".", "The", "JPQL", "defines", "this", "as", "a", "_state_field_path_expression_", ".", "[", "NOTE", "]", "=", "==", "=", "Using", "any", "non", "referenceable", "path", "expression", "leads", "to", "an", "Exception", ".", "=", "==", "=", "Using", "`", "Sort", "`", "together", "with", "<", "<", "jpa", ".", "query", "-", "methods", ".", "at", "-", "query", ",", "@", "Query", ">", ">", "however", "allows", "you", "to", "sneak", "in", "non", "path", "checked", "`", "Order", "`", "instances", "containing", "_functions_", "within", "the", "`", "ORDER", "BY", "`", "clause", ".", "This", "is", "possible", "because", "the", "`", "Order", "`", "is", "just", "appended", "to", "the", "given", "query", "string", ".", "By", "default", "we", "will", "reject", "any", "`", "Order", "`", "instance", "containing", "function", "calls", ",", "but", "you", "can", "use", "`", "JpaSort", ".", "unsafe", "`", "to", "add", "potentially", "unsafe", "ordering", ".", ".", "Using", "Sort", "and", "JpaSort", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "public", "interface", "UserRepository", "extends", "JpaRepository", "<", "User", ",", "Long", ">", "{", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "lastname", "like", "?", "1", "%", "\")", "List", "<", "User", ">", "findByAndSort", "(", "String", "lastname", ",", "Sort", "sort", ")", ";", "@", "Query", "(", "\"", "select", "u", ".", "id", ",", "LENGTH", "(", "u", ".", "firstname", ")", "as", "fn_len", "from", "User", "u", "where", "u", ".", "lastname", "like", "?", "1", "%", "\")", "List", "<", "Object", "[", "]>", "findByAsArrayAndSort", "(", "String", "lastname", ",", "Sort", "sort", ")", ";", "}", "repo", ".", "findByAndSort", "(", "\"", "lannister", "\"", ",", "new", "Sort", "(", "\"", "firstname", "\"", "))", ";", "<", "1", ">", "repo", ".", "findByAndSort", "(", "\"", "stark", "\"", ",", "new", "Sort", "(", "\"", "LENGTH", "(", "firstname", ")", "\")", ");", "<", "2", ">", "repo", ".", "findByAndSort", "(", "\"", "targaryen", "\"", ",", "JpaSort", ".", "unsafe", "(", "\"", "LENGTH", "(", "firstname", ")", "\")", ");", "<", "3", ">", "repo", ".", "findByAsArrayAndSort", "(", "\"", "bolton", "\"", ",", "new", "Sort", "(", "\"", "fn_len", "\"", "))", ";", "<", "4", ">", "-", "--", "-", "<", "1", ">", "Valid", "`", "Sort", "`", "expression", "pointing", "to", "property", "in", "domain", "model", ".", "<", "2", ">", "Invalid", "`", "Sort", "`", "containing", "function", "call", ".", "Thows", "Exception", ".", "<", "3", ">", "Valid", "`", "Sort", "`", "containing", "explicitly", "_unsafe_", "`", "Order", "`", ".", "<", "4", ">", "Valid", "`", "Sort", "`", "expression", "pointing", "to", "aliased", "function", ".", "=", "==", "=", "[", "[", "jpa", ".", "named", "-", "parameters", "]", "]", "=", "==", "Using", "named", "parameters", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "*", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "class", "JpaSort", "extends", "Sort", "{", "@", "@", "-", "83", ",", "6", "+", "84", ",", "10", "@", "@", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ",", "Direction", "direction", ",", "List", "<", "Path", "<", "?,", "?", ">>", "paths", ")", "super", "(", "combine", "(", "orders", ",", "direction", ",", "paths", ")", ");", "}", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ")", "{", "super", "(", "orders", ")", ";", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "@", "@", "-", "117", ",", "6", "+", "122", ",", "30", "@", "@", "public", "JpaSort", "and", "(", "Direction", "direction", ",", "Path", "<", "?,", "?", ">.", "..", "paths", ")", "{", "return", "new", "JpaSort", "(", "existing", ",", "direction", ",", "Arrays", ".", "asList", "(", "paths", ")", ");", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "JpaSort", "andUnsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "null", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "Order", "order", ":", "this", ")", "{", "orders", ".", "add", "(", "order", ")", ";", "}", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ",", "direction", ",", "Collections", ".", "<", "Path", "<", "?,", "?", ">>", "emptyList", "(", "))", ";", "}", "/", "**", "*", "Turns", "the", "given", "{", "@", "link", "Attribute", "}", "s", "into", "{", "@", "link", "Path", "}", "s", ".", "*", "@", "@", "-", "174", ",", "6", "+", "203", ",", "51", "@", "@", "public", "JpaSort", "and", "(", "Direction", "direction", ",", "Path", "<", "?,", "?", ">.", "..", "paths", ")", "{", "return", "new", "Path", "<", "T", ",", "S", ">", "(", "Arrays", ".", "asList", "(", "attribute", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "properties", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "String", ".", "..", "properties", ")", "{", "return", "unsafe", "(", "Sort", ".", "DEFAULT_DIRECTION", ",", "properties", ")", ";", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notNull", "(", "direction", ",", "\"", "Direction", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "return", "unsafe", "(", "direction", ",", "Arrays", ".", "asList", "(", "properties", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "List", "<", "String", ">", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ")", ";", "}", "/", "**", "*", "Value", "object", "to", "abstract", "a", "collection", "of", "{", "@", "link", "Attribute", "}", "s", ".", "*", "@", "@", "-", "233", ",", "4", "+", "307", ",", "131", "@", "@", "public", "String", "toString", "(", ")", "{", "return", "builder", ".", "length", "(", ")", "=", "=", "0", "?", "\"", "\"", ":", "builder", ".", "substring", "(", "0", ",", "builder", ".", "lastIndexOf", "(", "\".", "\")", ");", "}", "}", "/", "**", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "static", "class", "JpaOrder", "extends", "Order", "{", "private", "final", "boolean", "unsafe", ";", "private", "final", "boolean", "ignoreCase", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaOrder", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ")", "{", "this", "(", "direction", ",", "property", ",", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "Order", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "nullHandlingHint", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "NullHandling", "#", "NATIVE", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandlingHint", ")", "{", "this", "(", "direction", ",", "property", ",", "nullHandlingHint", ",", "false", ",", "true", ")", ";", "}", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandling", ",", "boolean", "ignoreCase", ",", "boolean", "unsafe", ")", "{", "super", "(", "direction", ",", "property", ",", "nullHandling", ")", ";", "this", ".", "ignoreCase", "=", "ignoreCase", ";", "this", ".", "unsafe", "=", "unsafe", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "Direction", "order", ")", "{", "return", "new", "JpaOrder", "(", "order", ",", "getProperty", "(", "),", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "NullHandling", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "NullHandling", "nullHandling", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "nullHandling", ",", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsFirst", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsFirst", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_FIRST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsLast", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsLast", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_LAST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsNative", "(", ")", "*", "/", "public", "JpaOrder", "nullsNative", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "new", "{", "@", "link", "Sort", "}", "with", "potentially", "unsafe", "{", "@", "link", "Order", "}", "instances", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "Sort", "withUnsafe", "(", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "getDirection", "(", "),", "property", ",", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ");", "}", "return", "new", "Sort", "(", "orders", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "ignoreCase", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "ignoreCase", "(", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "getNullHandling", "(", "),", "true", ",", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "isIgnoreCase", "(", ")", "*", "/", "@", "Override", "public", "boolean", "isIgnoreCase", "(", ")", "{", "return", "super", ".", "isIgnoreCase", "(", ")", "|", "|", "ignoreCase", ";", "}", "/", "**", "*", "@", "return", "true", "if", "{", "@", "link", "JpaOrder", "}", "created", "{", "@", "link", "#", "withUnsafe", "(", "String", ".", "..", ")}", ".", "*", "/", "public", "boolean", "isUnsafe", "(", ")", "{", "return", "unsafe", ";", "}", "}", "}", "@", "@", "-", "53", ",", "8", "+", "53", ",", "10", "@", "@", "import", "javax", ".", "persistence", ".", "metamodel", ".", "PluralAttribute", ";", "import", "org", ".", "springframework", ".", "core", ".", "annotation", ".", "AnnotationUtils", ";", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "@", "@", "-", "66", ",", "6", "+", "68", ",", "7", "@", "@", "*", "@", "author", "Kevin", "Raymond", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Komi", "Innocent", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "abstract", "class", "QueryUtils", "{", "@", "@", "-", "102", ",", "6", "+", "105", ",", "10", "@", "@", "private", "static", "final", "int", "QUERY_JOIN_ALIAS_GROUP_INDEX", "=", "2", ";", "private", "static", "final", "int", "VARIABLE_NAME_GROUP_INDEX", "=", "4", ";", "private", "static", "final", "Pattern", "PUNCTATION_PATTERN", "=", "Pattern", ".", "compile", "(", "\".", "*(", "(?", "![", "\\\\", ".", "_", "]", ")[", "\\\\", "p", "{", "Punct", "}", "|\\", "\\", "s", "]", ")\"", ");", "private", "static", "final", "String", "FUNCTION_ALIAS_GROUP_NAME", "=", "\"", "alias", "\"", ";", "private", "static", "final", "Pattern", "FUNCTION_PATTERN", ";", "static", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "@", "@", "-", "145", ",", "6", "+", "152", ",", "13", "@", "@", "builder", ".", "append", "(", "\"\\", "\\)", "\")", ";", "CONSTRUCTOR_EXPRESSION", "=", "compile", "(", "builder", ".", "toString", "(", "),", "CASE_INSENSITIVE", "+", "DOTALL", ")", ";", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "\")", ";", "/", "/", "at", "least", "one", "space", "builder", ".", "append", "(", "\"\\", "\\", "w", "+", "\\\\", "([", "0", "-", "9a", "-", "zA", "-", "z", "\\", "\\.", "_", ",", "\\\\", "s", "'", "]+", "\\\\", ")\"", ");", "/", "/", "any", "function", "call", "including", "parameters", "within", "the", "brackets", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "[", "as", "|", "AS", "]", "+\\", "\\", "s", "+", "(?", "<\"", "+", "FUNCTION_ALIAS_GROUP_NAME", "+", "\"", ">[", "\\\\", "w", "\\", "\\.", "]+", ")\"", ");", "/", "/", "the", "potential", "alias", "FUNCTION_PATTERN", "=", "compile", "(", "builder", ".", "toString", "(", "))", ";", "}", "/", "**", "@", "@", "-", "227", ",", "9", "+", "241", ",", "10", "@", "@", "public", "static", "String", "applySorting", "(", "String", "query", ",", "Sort", "sort", ",", "String", "alias", ")", "{", "}", "Set", "<", "String", ">", "aliases", "=", "getOuterJoinAliases", "(", "query", ")", ";", "Set", "<", "String", ">", "functionAliases", "=", "getFunctionAliases", "(", "query", ")", ";", "for", "(", "Order", "order", ":", "sort", ")", "{", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "functionAliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "}", "builder", ".", "delete", "(", "builder", ".", "length", "(", ")", "-", "2", ",", "builder", ".", "length", "(", "))", ";", "@", "@", "-", "246", ",", "9", "+", "261", ",", "16", "@", "@", "public", "static", "String", "applySorting", "(", "String", "query", ",", "Sort", "sort", ",", "String", "alias", ")", "{", "*", "@", "param", "order", "the", "order", "object", "to", "build", "the", "clause", "for", ".", "*", "@", "return", "*", "/", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Order", "order", ")", "{", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "Set", "<", "String", ">", "functionAlias", ",", "String", "alias", ",", "Order", "order", ")", "{", "String", "property", "=", "order", ".", "getProperty", "(", ");", "checkSortExpression", "(", "order", ")", ";", "if", "(", "functionAlias", ".", "contains", "(", "property", ")", ")", "{", "return", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "property", ",", "toJpaDirection", "(", "order", ")", ");", "}", "boolean", "qualifyReference", "=", "!", "property", ".", "contains", "(", "\"(", "\")", ";", "/", "/", "(", "indicates", "a", "function", "for", "(", "String", "joinAlias", ":", "joinAliases", ")", "{", "@", "@", "-", "287", ",", "6", "+", "309", ",", "28", "@", "@", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Orde", "return", "result", ";", "}", "/", "**", "*", "Returns", "the", "aliases", "used", "for", "aggregate", "functions", "like", "{", "@", "code", "SUM", ",", "COUNT", ",", ".", "..", "}.", "*", "*", "@", "param", "query", "*", "@", "return", "*", "/", "static", "Set", "<", "String", ">", "getFunctionAliases", "(", "String", "query", ")", "{", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", "String", ">", "()", ";", "Matcher", "matcher", "=", "FUNCTION_PATTERN", ".", "matcher", "(", "query", ")", ";", "while", "(", "matcher", ".", "find", "(", "))", "{", "String", "alias", "=", "matcher", ".", "group", "(", "FUNCTION_ALIAS_GROUP_NAME", ")", ";", "if", "(", "StringUtils", ".", "hasText", "(", "alias", ")", ")", "{", "result", ".", "add", "(", "alias", ")", ";", "}", "}", "return", "result", ";", "}", "private", "static", "String", "toJpaDirection", "(", "Order", "order", ")", "{", "return", "order", ".", "getDirection", "(", ").", "name", "(", ").", "toLowerCase", "(", "Locale", ".", "US", ")", ";", "}", "@", "@", "-", "617", ",", "4", "+", "661", ",", "23", "@", "@", "private", "static", "boolean", "isAlreadyFetched", "(", "From", "<", "?,", "?", ">", "from", ",", "String", "attribute", ")", "{", "return", "false", ";", "}", "/", "**", "*", "Check", "any", "given", "{", "@", "link", "JpaOrder", "#", "isUnsafe", "(", ")}", "order", "for", "presence", "of", "at", "least", "one", "property", "offending", "the", "*", "{", "@", "link", "#", "PUNCTATION_PATTERN", "}", "and", "throw", "an", "{", "@", "link", "Exception", "}", "indicating", "potential", "unsafe", "order", "by", "expression", ".", "*", "*", "@", "param", "order", "*", "/", "private", "static", "void", "checkSortExpression", "(", "Order", "order", ")", "{", "if", "(", "order", "instanceof", "JpaOrder", "&", "&", "(", "(", "JpaOrder", ")", "order", ")", ".", "isUnsafe", "(", "))", "{", "return", ";", "}", "if", "(", "PUNCTATION_PATTERN", ".", "matcher", "(", "order", ".", "getProperty", "(", "))", ".", "find", "(", "))", "{", "throw", "new", "InvalidDataAccessApiUsageException", "(", "String", ".", "format", "(", "\"", "Sort", "expression", "'", "%", "s", "'", "must", "not", "contain", "functions", "or", "expressions", ".", "Please", "use", "JpaSort", ".", "unsafe", ".", "\",", "order", ")", ");", "}", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "Path", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "Address_", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "MailMessage_", ";", "@", "@", "-", "47", ",", "6", "+", "48", ",", "7", "@", "@", "*", "@", "see", "DATAJPA", "-", "12", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Christoph", "Strobl", "*", "/", "@", "RunWith", "(", "SpringJUnit4ClassRunner", ".", "class", ")", "@", "ContextConfiguration", "(", "\"", "classpath", ":", "infrastructure", ".", "xml", "\"", ")", "@", "@", "-", "173", ",", "4", "+", "175", ",", "56", "@", "@", "public", "void", "buildsUpPathForPluralAttributesCorrectly", "(", ")", "{", "assertThat", "(", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", "),", "/", "/", "hasItem", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "))", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItem", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortWithMultiplePropertiesCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ",", "\"", "spring", ".", "data", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "spring", ".", "data", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "spring", ".", "data", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesSafeAndUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ").", "andUnsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesUnsafeAndSafeSortCorrectly", "(", ")", "{", "Sort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ").", "and", "(", "ASC", ",", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2008", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2008", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "23", ",", "14", "+", "23", ",", "17", "@", "@", "import", "org", ".", "hamcrest", ".", "Matcher", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "QueryUtils", "}", ".", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Komi", "Innocent", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "class", "QueryUtilsUnitTests", "{", "@", "@", "-", "230", ",", "7", "+", "233", ",", "7", "@", "@", "public", "void", "projectsCOuntQueriesForQueriesWithSubselects", "(", ")", "{", "/", "**", "*", "@", "see", "DATAJPA", "-", "148", "*", "/", "@", "Test", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotPrefixSortsIfFunction", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "@", "@", "-", "361", ",", "6", "+", "364", ",", "134", "@", "@", "public", "void", "doesNotQualifySortIfNoAliasDetected", "(", ")", "{", "endsWith", "(", "\"", "order", "by", "firstname", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotAllowWhitespaceInSort", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "case", "when", "foo", "then", "bar", "\"", ");", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixUnsageJpaSortFunctionCalls", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "assertThat", "(", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", "),", "endsWith", "(", "\"", "order", "by", "sum", "(", "foo", ")", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixMultipleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", ",", "SUM", "(", "m", ".", "stocks", ")", "AS", "sumStocks", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ",", "\"", "sumStocks", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", ",", "sumStocks", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixSingleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesSingleNonAliasedFunctionCallRelatedSortProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "someOtherProperty", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "someOtherProperty", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesNonAliasedFunctionCallRelatedSortPropertyWhenSelectClauseContainesAliasedFunctionForDifferentProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "m", ".", "name", ",", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "name", "\"", ",", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "name", "asc", ",", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleNumericParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "SUBSTRING", "(", "m", ".", "name", ",", "2", ",", "5", ")", "AS", "trimmedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "trimmedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "trimmedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleStringParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "CONCAT", "(", "m", ".", "name", ",", "'", "foo", "'", ")", "AS", "extendedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "extendedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "extendedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithUnderscores", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avg_price", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avg_price", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avg_price", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithDots", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "m", ".", "avg", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "m", ".", "avg", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "avg", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWhenQueryStringContainsMultipleWhiteSpaces", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "private", "static", "void", "assertCountQuery", "(", "String", "originalQuery", ",", "String", "countQuery", ")", "{", "assertThat", "(", "createCountQueryFor", "(", "originalQuery", ")", ",", "is", "(", "countQuery", ")", ");", "}"], "docstring_tokens": ["execute", "arbitrary", "JPQL", "commands", "in", "the", "back-end", "database"]}
{"contents": ["Fix", "SRP", "buffer", "overrun", "vulnerability.", "Invalid", "parameters", "passed", "to", "the", "SRP", "code", "can", "be", "overrun", "an", "internal", "buffer.", "Add", "sanity", "check", "that", "g,", "A,", "B", "<", "N", "to", "SRP", "code.", "Thanks", "to", "Sean", "Devlin", "and", "Watson", "Ladd", "of", "Cryptography", "Services,", "NCC", "Group", "for", "reporting", "this", "issue."], "code_tokens": ["@", "@", "-", "89", ",", "6", "+", "89", ",", "9", "@", "@", "static", "BIGNUM", "*", "srp_Calc_k", "(", "BIGNUM", "*", "N", ",", "BIGNUM", "*", "g", ")", "int", "longg", ";", "int", "longN", "=", "BN_num_bytes", "(", "N", ")", ";", "if", "(", "BN_ucmp", "(", "g", ",", "N", ")", ">", "=", "0", ")", "return", "NULL", ";", "if", "(", "(", "tmp", "=", "OPENSSL_malloc", "(", "longN", ")", ")", "=", "=", "NULL", ")", "return", "NULL", ";", "BN_bn2bin", "(", "N", ",", "tmp", ")", ";", "@", "@", "-", "121", ",", "6", "+", "124", ",", "9", "@", "@", "BIGNUM", "*", "SRP_Calc_u", "(", "BIGNUM", "*", "A", ",", "BIGNUM", "*", "B", ",", "BIGNUM", "*", "N", ")", "if", "(", "(", "A", "=", "=", "NULL", ")", "|", "|(", "B", "=", "=", "NULL", ")", "|", "|", "(", "N", "=", "=", "NULL", ")", ")", "return", "NULL", ";", "if", "(", "BN_ucmp", "(", "A", ",", "N", ")", ">", "=", "0", "|", "|", "BN_ucmp", "(", "B", ",", "N", ")", ">", "=", "0", ")", "return", "NULL", ";", "longN", "=", "BN_num_bytes", "(", "N", ")", ";", "if", "(", "(", "cAB", "=", "OPENSSL_malloc", "(", "2", "*", "longN", ")", ")", "=", "=", "NULL", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "crash", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["Identity", "zone", "creation", "checks", "for", "signing", "key", "with", "issuer", "[#157376547]", "https://www.pivotaltracker.com/story/show/157376547", "Signed-off-by:", "Jaskanwal", "Pawar", "<jpawar@pivotal.io>"], "code_tokens": ["@", "@", "-", "68", ",", "6", "+", "68", ",", "11", "@", "@", "public", "IdentityZoneConfiguration", "validate", "(", "IdentityZone", "zone", ",", "IdentityZoneValidat", "}", "}", "}", "if", "(", "!", "StringUtils", ".", "isEmpty", "(", "config", ".", "getIssuer", "(", "))", ")", "{", "if", "(", "tokenPolicy", "=", "=", "null", "|", "|", "StringUtils", ".", "isEmpty", "(", "tokenPolicy", ".", "getActiveKeyId", "(", "))", ")", "{", "throw", "new", "InvalidIdentityZoneConfigurationException", "(", "\"", "You", "cannot", "set", "issuer", "value", "unless", "you", "have", "set", "your", "own", "signing", "key", "for", "this", "identity", "zone", ".", "\")", ";", "}", "}", "}", "if", "(", "config", ".", "getBranding", "(", ")", "!", "=", "null", "&", "&", "config", ".", "getBranding", "(", ").", "getBanner", "(", ")", "!", "=", "null", ")", "{", "@", "@", "-", "94", ",", "6", "+", "94", ",", "7", "@", "@", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "get", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "post", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "put", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "header", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "jsonPath", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "status", ";", "@", "@", "-", "1948", ",", "6", "+", "1949", ",", "50", "@", "@", "public", "void", "updateZoneWithInvalidMfaConfig", "(", ")", "throws", "Exception", "{", "updateZone", "(", "identityZone", ",", "HttpStatus", ".", "UNPROCESSABLE_ENTITY", ",", "adminToken", ")", ";", "}", "@", "Test", "public", "void", "testCreateZone_withCustomIssuerAndSigningKeyWorks", "(", ")", "throws", "Exception", "{", "IdentityZoneConfiguration", "identityZoneConfiguration", "=", "new", "IdentityZoneConfiguration", "(", ");", "identityZoneConfiguration", ".", "setIssuer", "(", "\"", "http", ":", "//", "my", "-", "custom", "-", "issuer", ".", "com", "\"", ");", "identityZoneConfiguration", ".", "setTokenPolicy", "(", "new", "TokenPolicy", "(", "))", ";", "createZone", "(", "\"", "should", "-", "not", "-", "exist", "\"", "+", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "),", "HttpStatus", ".", "CREATED", ",", "adminToken", ",", "identityZoneConfiguration", ")", ";", "}", "@", "Test", "public", "void", "testCreateZone_withCustomIssuerAndNoTokenPolicyShouldFail", "(", ")", "throws", "Exception", "{", "IdentityZoneConfiguration", "identityZoneConfiguration", "=", "new", "IdentityZoneConfiguration", "(", ");", "identityZoneConfiguration", ".", "setIssuer", "(", "\"", "http", ":", "//", "my", "-", "custom", "-", "issuer", ".", "com", "\"", ");", "identityZoneConfiguration", ".", "setTokenPolicy", "(", "null", ")", ";", "createZone", "(", "\"", "should", "-", "not", "-", "exist", "\"", "+", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "),", "HttpStatus", ".", "UNPROCESSABLE_ENTITY", ",", "\"", "You", "cannot", "set", "issuer", "value", "unless", "you", "have", "set", "your", "own", "signing", "key", "for", "this", "identity", "zone", ".", "\",", "adminToken", ",", "identityZoneConfiguration", ")", ";", "}", "@", "Test", "public", "void", "testCreateZone_withCustomIssuerAndNoActiveSigningKeyShouldFail", "(", ")", "throws", "Exception", "{", "IdentityZoneConfiguration", "identityZoneConfiguration", "=", "new", "IdentityZoneConfiguration", "(", ");", "identityZoneConfiguration", ".", "setIssuer", "(", "\"", "http", ":", "//", "my", "-", "custom", "-", "issuer", ".", "com", "\"", ");", "identityZoneConfiguration", ".", "setTokenPolicy", "(", "new", "TokenPolicy", "(", "))", ";", "createZone", "(", "\"", "should", "-", "not", "-", "exist", "\"", "+", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "),", "HttpStatus", ".", "UNPROCESSABLE_ENTITY", ",", "\"", "You", "cannot", "set", "issuer", "value", "unless", "you", "have", "set", "your", "own", "signing", "key", "for", "this", "identity", "zone", ".", "\",", "adminToken", ",", "identityZoneConfiguration", ")", ";", "}", "private", "MfaProvider", "<", "GoogleMfaProviderConfig", ">", "createGoogleMfaProvider", "(", "String", "zoneId", ")", "throws", "Exception", "{", "MfaProvider", "<", "GoogleMfaProviderConfig", ">", "mfaProvider", "=", "new", "MfaProvider", "(", ").", "setName", "(", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "))", ";", "MockHttpServletRequestBuilder", "createMfaRequest", "=", "post", "(", "\"/", "mfa", "-", "providers", "\"", ")", "@", "@", "-", "1976", ",", "22", "+", "2021", ",", "29", "@", "@", "private", "IdentityZone", "getIdentityZone", "(", "String", "id", ",", "HttpStatus", "expect", ",", "String", "token", ")", "}", "private", "IdentityZone", "createZone", "(", "String", "id", ",", "HttpStatus", "expect", ",", "String", "token", ",", "IdentityZoneConfiguration", "zoneConfiguration", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "keys", "=", "new", "HashMap", "<", ">(", ");", "keys", ".", "put", "(", "\"", "kid", "\"", ",", "\"", "key", "\"", ");", "zoneConfiguration", ".", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "zoneConfiguration", ".", "getTokenPolicy", "(", ").", "setActiveKeyId", "(", "\"", "kid", "\"", ");", "zoneConfiguration", ".", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "return", "createZone", "(", "id", ",", "expect", ",", "\"", "\"", ",", "token", ",", "zoneConfiguration", ")", ";", "}", "private", "IdentityZone", "createZone", "(", "String", "id", ",", "HttpStatus", "expect", ",", "String", "expectedContent", ",", "String", "token", ",", "IdentityZoneConfiguration", "zoneConfiguration", ")", "throws", "Exception", "{", "IdentityZone", "identityZone", "=", "getIdentityZone", "(", "id", ")", ";", "identityZone", ".", "setConfig", "(", "zoneConfiguration", ")", ";", "identityZone", ".", "getConfig", "(", ").", "getSamlConfig", "(", ").", "setPrivateKey", "(", "serviceProviderKey", ")", ";", "identityZone", ".", "getConfig", "(", ").", "getSamlConfig", "(", ").", "setPrivateKeyPassword", "(", "serviceProviderKeyPassword", ")", ";", "identityZone", ".", "getConfig", "(", ").", "getSamlConfig", "(", ").", "setCertificate", "(", "serviceProviderCertificate", ")", ";", "Map", "<", "String", ",", "String", ">", "keys", "=", "new", "HashMap", "<", ">(", ");", "keys", ".", "put", "(", "\"", "kid", "\"", ",", "\"", "key", "\"", ");", "identityZone", ".", "getConfig", "(", ").", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "identityZone", ".", "getConfig", "(", ").", "getTokenPolicy", "(", ").", "setActiveKeyId", "(", "\"", "kid", "\"", ");", "MvcResult", "result", "=", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "identity", "-", "zones", "\"", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "token", ")", ".", "contentType", "(", "APPLICATION_JSON", ")", ".", "content", "(", "JsonUtils", ".", "writeValueAsString", "(", "identityZone", ")", "))", ".", "andExpect", "(", "status", "(", ").", "is", "(", "expect", ".", "value", "(", "))", ")", ".", "andExpect", "(", "content", "(", ").", "string", "(", "containsString", "(", "expectedContent", ")", "))", ".", "andReturn", "(", ");", "if", "(", "expect", ".", "is2xxSuccessful", "(", "))", "{"], "docstring_tokens": ["issue", "tokens", "which", "impersonate", "another", "zone"]}
{"contents": ["Merge", "pull", "request", "from", "GHSA-269g-pwp5-87pp", "When", "running", "on", "Java", "7", "or", "later,", "temporary", "directories", "are", "now", "created", "Using", "Java\u2019s", "NIO", "API", "which", "restricts", "permissions", "to", "owner-only", "by", "default."], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "9", "@", "@", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Array", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "org", ".", "junit", ".", "Rule", ";", "@", "@", "-", "229", ",", "7", "+", "232", ",", "45", "@", "@", "public", "File", "newFolder", "(", ")", "throws", "IOException", "{", "return", "createTemporaryFolderIn", "(", "getRoot", "(", "))", ";", "}", "private", "File", "createTemporaryFolderIn", "(", "File", "parentFolder", ")", "throws", "IOException", "{", "private", "static", "File", "createTemporaryFolderIn", "(", "File", "parentFolder", ")", "throws", "IOException", "{", "try", "{", "return", "createTemporaryFolderWithNioApi", "(", "parentFolder", ")", ";", "}", "catch", "(", "ClassNotFoundException", "ignore", ")", "{", "/", "/", "Fallback", "for", "Java", "5", "and", "6", "return", "createTemporaryFolderWithFileApi", "(", "parentFolder", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "Throwable", "cause", "=", "e", ".", "getCause", "(", ");", "if", "(", "cause", "instanceof", "IOException", ")", "{", "throw", "(", "IOException", ")", "cause", ";", "}", "if", "(", "cause", "instanceof", "RuntimeException", ")", "{", "throw", "(", "RuntimeException", ")", "cause", ";", "}", "IOException", "exception", "=", "new", "IOException", "(", "\"", "Failed", "to", "create", "temporary", "folder", "in", "\"", "+", "parentFolder", ")", ";", "exception", ".", "initCause", "(", "cause", ")", ";", "throw", "exception", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Failed", "to", "create", "temporary", "folder", "in", "\"", "+", "parentFolder", ",", "e", ")", ";", "}", "}", "private", "static", "File", "createTemporaryFolderWithNioApi", "(", "File", "parentFolder", ")", "throws", "ClassNotFoundException", ",", "NoSuchMethodException", ",", "InvocationTargetException", ",", "IllegalAccessException", "{", "Class", "<", "?>", "filesClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Files", "\"", ");", "Object", "fileAttributeArray", "=", "Array", ".", "newInstance", "(", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "attribute", ".", "FileAttribute", "\"", "),", "0", ")", ";", "Class", "<", "?>", "pathClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Path", "\"", ");", "Object", "tempDir", ";", "if", "(", "parentFolder", "!", "=", "null", ")", "{", "Method", "createTempDirectoryMethod", "=", "filesClass", ".", "getDeclaredMethod", "(", "\"", "createTempDirectory", "\"", ",", "pathClass", ",", "String", ".", "class", ",", "fileAttributeArray", ".", "getClass", "(", "))", ";", "Object", "parentPath", "=", "File", ".", "class", ".", "getDeclaredMethod", "(", "\"", "toPath", "\"", ").", "invoke", "(", "parentFolder", ")", ";", "tempDir", "=", "createTempDirectoryMethod", ".", "invoke", "(", "null", ",", "parentPath", ",", "TMP_PREFIX", ",", "fileAttributeArray", ")", ";", "}", "else", "{", "Method", "createTempDirectoryMethod", "=", "filesClass", ".", "getDeclaredMethod", "(", "\"", "createTempDirectory", "\"", ",", "String", ".", "class", ",", "fileAttributeArray", ".", "getClass", "(", "))", ";", "tempDir", "=", "createTempDirectoryMethod", ".", "invoke", "(", "null", ",", "TMP_PREFIX", ",", "fileAttributeArray", ")", ";", "}", "return", "(", "File", ")", "pathClass", ".", "getDeclaredMethod", "(", "\"", "toFile", "\"", ").", "invoke", "(", "tempDir", ")", ";", "}", "private", "static", "File", "createTemporaryFolderWithFileApi", "(", "File", "parentFolder", ")", "throws", "IOException", "{", "File", "createdFolder", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "TEMP_DIR_ATTEMPTS", ";", "+", "+", "i", ")", "{", "/", "/", "Use", "createTempFile", "to", "get", "a", "suitable", "folder", "name", ".", "@", "@", "-", "3", ",", "21", "+", "3", ",", "28", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "IsNot", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assume", ".", "assumeTrue", ";", "import", "static", "org", ".", "junit", ".", "experimental", ".", "results", ".", "PrintableResult", ".", "testResult", ";", "import", "static", "org", ".", "junit", ".", "experimental", ".", "results", ".", "ResultMatchers", ".", "failureCountIs", ";", "import", "static", "org", ".", "junit", ".", "experimental", ".", "results", ".", "ResultMatchers", ".", "isSuccessful", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Array", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "SortedSet", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AssumptionViolatedException", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "public", "class", "TempFolderRuleTest", "{", "private", "static", "File", "[", "]", "createdFiles", "=", "new", "File", "[", "20", "]", ";", "@", "@", "-", "182", ",", "6", "+", "189", ",", "34", "@", "@", "public", "void", "recursiveDeleteFolderWithZeroElements", "(", ")", "throws", "IOException", "{", "assertFalse", "(", "folder", ".", "getRoot", "(", ").", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "tempFolderIsOnlyAccessibleByOwner", "(", ")", "throws", "IOException", "{", "TemporaryFolder", "folder", "=", "new", "TemporaryFolder", "(", ");", "folder", ".", "create", "(", ");", "Set", "<", "String", ">", "expectedPermissions", "=", "new", "TreeSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "OWNER_READ", "\"", ",", "\"", "OWNER_WRITE", "\"", ",", "\"", "OWNER_EXECUTE", "\"", "))", ";", "Set", "<", "String", ">", "actualPermissions", "=", "getPosixFilePermissions", "(", "folder", ".", "getRoot", "(", "))", ";", "assertEquals", "(", "expectedPermissions", ",", "actualPermissions", ")", ";", "}", "private", "Set", "<", "String", ">", "getPosixFilePermissions", "(", "File", "root", ")", "{", "try", "{", "Class", "<", "?>", "pathClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Path", "\"", ");", "Object", "linkOptionArray", "=", "Array", ".", "newInstance", "(", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "LinkOption", "\"", "),", "0", ")", ";", "Class", "<", "?>", "filesClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Files", "\"", ");", "Object", "path", "=", "File", ".", "class", ".", "getDeclaredMethod", "(", "\"", "toPath", "\"", ").", "invoke", "(", "root", ")", ";", "Method", "posixFilePermissionsMethod", "=", "filesClass", ".", "getDeclaredMethod", "(", "\"", "getPosixFilePermissions", "\"", ",", "pathClass", ",", "linkOptionArray", ".", "getClass", "(", "))", ";", "Set", "<", "?>", "permissions", "=", "(", "Set", "<", "?>", ")", "posixFilePermissionsMethod", ".", "invoke", "(", "null", ",", "path", ",", "linkOptionArray", ")", ";", "SortedSet", "<", "String", ">", "convertedPermissions", "=", "new", "TreeSet", "<", "String", ">", "()", ";", "for", "(", "Object", "item", ":", "permissions", ")", "{", "convertedPermissions", ".", "add", "(", "item", ".", "toString", "(", "))", ";", "}", "return", "convertedPermissions", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "AssumptionViolatedException", "(", "\"", "Test", "requires", "at", "least", "Java", "1", ".", "7", "\"", ",", "e", ")", ";", "}", "}", "public", "static", "class", "NameClashes", "{", "@", "Rule", "public", "TemporaryFolder", "folder", "=", "new", "TemporaryFolder", "(", ");"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["can:", "gw:", "ensure", "DLC", "boundaries", "after", "CAN", "frame", "modification", "Muyu", "Yu", "provided", "a", "POC", "where", "user", "root", "with", "CAP_NET_ADMIN", "can", "create", "a", "CAN", "frame", "modification", "rule", "that", "makes", "the", "data", "length", "code", "a", "higher", "value", "than", "the", "available", "CAN", "frame", "data", "size.", "In", "combination", "with", "a", "configured", "checksum", "calculation", "where", "the", "result", "is", "stored", "relatively", "to", "the", "end", "of", "the", "data", "(e.g.", "cgw_csum_xor_rel)", "the", "tail", "of", "the", "skb", "(e.g.", "frag_list", "pointer", "in", "skb_shared_info)", "can", "be", "rewritten", "which", "finally", "can", "cause", "a", "system", "crash.", "Michael", "Kubecek", "suggested", "to", "drop", "frames", "that", "have", "a", "DLC", "exceeding", "the", "available", "space", "after", "the", "modification", "process", "and", "provided", "a", "patch", "that", "can", "handle", "CAN", "FD", "frames", "too.", "Within", "this", "patch", "we", "also", "limit", "the", "length", "for", "the", "checksum", "calculations", "to", "the", "maximum", "of", "Classic", "CAN", "data", "length", "(8).", "CAN", "frames", "that", "are", "dropped", "by", "these", "additional", "checks", "are", "counted", "with", "the", "CGW_DELETED", "counter", "which", "indicates", "misconfigurations", "in", "can-gw", "rules.", "This", "fixes", ".", "Reported-by:", "Muyu", "Yu", "<ieatmuttonchuan@gmail.com>", "Reported-by:", "Marcus", "Meissner", "<meissner@suse.de>", "Suggested-by:", "Michal", "Kubecek", "<mkubecek@suse.cz>", "Tested-by:", "Muyu", "Yu", "<ieatmuttonchuan@gmail.com>", "Tested-by:", "Oliver", "Hartkopp", "<socketcan@hartkopp.net>", "Signed-off-by:", "Oliver", "Hartkopp", "<socketcan@hartkopp.net>", "Cc:", "linux-stable", "<stable@vger.kernel.org>", "#", ">=", "v3.2", "Signed-off-by:", "Marc", "Kleine-Budde", "<mkl@pengutronix.de>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "416", ",", "13", "+", "416", ",", "29", "@", "@", "static", "void", "can_can_gw_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "void", "*", "data", ")", "while", "(", "modidx", "<", "MAX_MODFUNCTIONS", "&", "&", "gwj", "-", ">", "mod", ".", "modfunc", "[", "modidx", "]", ")", "(", "*", "gwj", "-", ">", "mod", ".", "modfunc", "[", "modidx", "+", "+]", ")(", "cf", ",", "&", "gwj", "-", ">", "mod", ")", ";", "/", "*", "check", "for", "checksum", "updates", "when", "the", "CAN", "frame", "has", "been", "modified", "*", "/", "/", "*", "Has", "the", "CAN", "frame", "been", "modified", "?", "*", "/", "if", "(", "modidx", ")", "{", "if", "(", "gwj", "-", ">", "mod", ".", "csumfunc", ".", "crc8", ")", "/", "*", "get", "available", "space", "for", "the", "processed", "CAN", "frame", "type", "*", "/", "int", "max_len", "=", "nskb", "-", ">", "len", "-", "offsetof", "(", "struct", "can_frame", ",", "data", ")", ";", "/", "*", "dlc", "may", "have", "changed", ",", "make", "sure", "it", "fits", "to", "the", "CAN", "frame", "*", "/", "if", "(", "cf", "-", ">", "can_dlc", ">", "max_len", ")", "goto", "out_delete", ";", "/", "*", "check", "for", "checksum", "updates", "in", "classic", "CAN", "length", "only", "*", "/", "if", "(", "gwj", "-", ">", "mod", ".", "csumfunc", ".", "crc8", ")", "{", "if", "(", "cf", "-", ">", "can_dlc", ">", "8", ")", "goto", "out_delete", ";", "(", "*", "gwj", "-", ">", "mod", ".", "csumfunc", ".", "crc8", ")", "(", "cf", ",", "&", "gwj", "-", ">", "mod", ".", "csum", ".", "crc8", ")", ";", "}", "if", "(", "gwj", "-", ">", "mod", ".", "csumfunc", ".", "xor", ")", "{", "if", "(", "cf", "-", ">", "can_dlc", ">", "8", ")", "goto", "out_delete", ";", "if", "(", "gwj", "-", ">", "mod", ".", "csumfunc", ".", "xor", ")", "(", "*", "gwj", "-", ">", "mod", ".", "csumfunc", ".", "xor", ")", "(", "cf", ",", "&", "gwj", "-", ">", "mod", ".", "csum", ".", "xor", ")", ";", "}", "}", "/", "*", "clear", "the", "skb", "timestamp", "if", "not", "configured", "the", "other", "way", "*", "/", "@", "@", "-", "434", ",", "6", "+", "450", ",", "14", "@", "@", "static", "void", "can_can_gw_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "void", "*", "data", ")", "gwj", "-", ">", "dropped_frames", "+", "+;", "else", "gwj", "-", ">", "handled_frames", "+", "+;", "return", ";", "out_delete", ":", "/", "*", "delete", "frame", "due", "to", "misconfiguration", "*", "/", "gwj", "-", ">", "deleted_frames", "+", "+;", "kfree_skb", "(", "nskb", ")", ";", "return", ";", "}", "static", "inline", "int", "cgw_register_filter", "(", "struct", "net", "*", "net", ",", "struct", "cgw_job", "*", "gwj", ")"], "docstring_tokens": ["cause", "a", "system", "crash", "."]}
{"contents": ["Add", "ShiroUrlHelper", "and", "related", "Spring", "configuration", "and", "related", "tests"], "code_tokens": ["@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "remoting", ".", "SecureRemoteInvocationExecutor", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "DefaultShiroFilterChainDefinition", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "ShiroFilterChainDefinition", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "ShiroRequestMappingConfig", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "ShiroWebConfiguration", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "ShiroWebFilterConfiguration", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Bean", ";", "@", "@", "-", "53", ",", "7", "+", "54", ",", "8", "@", "@", "ShiroWebConfiguration", ".", "class", ",", "ShiroWebFilterConfiguration", ".", "class", ",", "JspViewsConfig", ".", "class", ",", "RemotingServletConfig", ".", "class", "}", ")", "RemotingServletConfig", ".", "class", ",", "ShiroRequestMappingConfig", ".", "class", "}", ")", "@", "ComponentScan", "(", "\"", "org", ".", "apache", ".", "shiro", ".", "samples", ".", "spring", "\"", ")", "public", "class", "ApplicationConfig", "{", "@", "@", "-", "25", ",", "7", "+", "25", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "ViewResolver", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "EnableWebMvc", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "ResourceHandlerRegistry", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "WebMvcConfigurerAdapter", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "WebMvcConfigurer", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "view", ".", "InternalResourceViewResolver", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "view", ".", "JstlView", ";", "@", "@", "-", "35", ",", "7", "+", "35", ",", "7", "@", "@", "@", "Configuration", "@", "ComponentScan", "(", "\"", "org", ".", "apache", ".", "shiro", ".", "samples", ".", "spring", "\"", ")", "@", "EnableWebMvc", "public", "class", "JspViewsConfig", "extends", "WebMvcConfigurerAdapter", "{", "public", "class", "JspViewsConfig", "implements", "WebMvcConfigurer", "{", "@", "Bean", "@", "Order", "(", "1", ")", "@", "@", "-", "33", ",", "9", "+", "33", ",", "11", "@", "@", "import", "org", ".", "apache", ".", "shiro", ".", "session", ".", "mgt", ".", "SessionManager", ";", "import", "org", ".", "apache", ".", "shiro", ".", "session", ".", "mgt", ".", "eis", ".", "SessionDAO", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "boot", ".", "autoconfigure", ".", "ShiroAutoConfiguration", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "ShiroUrlPathHelper", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "AbstractShiroWebConfiguration", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "ShiroFilterChainDefinition", ";", "import", "org", ".", "apache", ".", "shiro", ".", "web", ".", "servlet", ".", "Cookie", ";", "import", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "AutoConfigureAfter", ";", "import", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "AutoConfigureBefore", ";", "import", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "condition", ".", "ConditionalOnMissingBean", ";", "import", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "condition", ".", "ConditionalOnProperty", ";", "@", "@", "-", "47", ",", "6", "+", "49", ",", "7", "@", "@", "*", "/", "@", "Configuration", "@", "AutoConfigureBefore", "(", "ShiroAutoConfiguration", ".", "class", ")", "@", "AutoConfigureAfter", "(", "ShiroWebMvcAutoConfiguration", ".", "class", ")", "@", "ConditionalOnProperty", "(", "name", "=", "\"", "shiro", ".", "web", ".", "enabled", "\"", ",", "matchIfMissing", "=", "true", ")", "public", "class", "ShiroWebAutoConfiguration", "extends", "AbstractShiroWebConfiguration", "{", "@", "@", "-", "147", ",", "4", "+", "150", ",", "11", "@", "@", "protected", "Cookie", "rememberMeCookieTemplate", "(", ")", "{", "protected", "ShiroFilterChainDefinition", "shiroFilterChainDefinition", "(", ")", "{", "return", "super", ".", "shiroFilterChainDefinition", "(", ");", "}", "@", "Bean", "@", "ConditionalOnMissingBean", "@", "Override", "protected", "ShiroUrlPathHelper", "shiroUrlPathHelper", "(", ")", "{", "return", "super", ".", "shiroUrlPathHelper", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "32", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "config", ".", "web", ".", "autoconfigure", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ".", "ShiroRequestMappingConfig", ";", "import", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "condition", ".", "ConditionalOnClass", ";", "import", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "condition", ".", "ConditionalOnProperty", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Configuration", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Import", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "mvc", ".", "method", ".", "annotation", ".", "RequestMappingHandlerMapping", ";", "@", "Configuration", "@", "ConditionalOnClass", "(", "RequestMappingHandlerMapping", ".", "class", ")", "@", "Import", "(", "ShiroRequestMappingConfig", ".", "class", ")", "@", "ConditionalOnProperty", "(", "name", "=", "\"", "shiro", ".", "web", ".", "enabled", "\"", ",", "matchIfMissing", "=", "true", ")", "public", "class", "ShiroWebMvcAutoConfiguration", "{", "}", "@", "@", "-", "1", ",", "3", "+", "1", ",", "4", "@", "@", "org", ".", "springframework", ".", "boot", ".", "autoconfigure", ".", "EnableAutoConfiguration", "=", "\\", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "config", ".", "web", ".", "autoconfigure", ".", "ShiroWebAutoConfiguration", ",", "\\", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "config", ".", "web", ".", "autoconfigure", ".", "ShiroWebFilterConfiguration", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "config", ".", "web", ".", "autoconfigure", ".", "ShiroWebFilterConfiguration", ",", "\\", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "config", ".", "web", ".", "autoconfigure", ".", "ShiroWebMvcAutoConfiguration", "@", "@", "-", "50", ",", "6", "+", "50", ",", "16", "@", "@", "<", "artifactId", ">", "spring", "-", "context", "<", "/", "artifactId", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "springframework", "<", "/", "groupId", ">", "<", "artifactId", ">", "spring", "-", "web", "<", "/", "artifactId", ">", "<", "optional", ">", "true", "<", "/", "optional", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "springframework", "<", "/", "groupId", ">", "<", "artifactId", ">", "spring", "-", "webmvc", "<", "/", "artifactId", ">", "<", "optional", ">", "true", "<", "/", "optional", ">", "<", "/", "dependency", ">", "<", "!-", "-", "Test", "dependencies", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "slf4j", "<", "/", "groupId", ">", "@", "@", "-", "71", ",", "11", "+", "81", ",", "6", "@", "@", "<", "artifactId", ">", "spring", "-", "test", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "springframework", "<", "/", "groupId", ">", "<", "artifactId", ">", "spring", "-", "web", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "shiro", "<", "/", "groupId", ">", "<", "artifactId", ">", "shiro", "-", "aspectj", "<", "/", "artifactId", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ";", "import", "org", ".", "apache", ".", "shiro", ".", "web", ".", "util", ".", "WebUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UrlPathHelper", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "/", "**", "*", "A", "Spring", "UrlPathHelper", "that", "uses", "Shiro", "'", "s", "path", "resolution", "logic", ".", "*", "@", "since", "1", ".", "7", ".", "0", "*", "/", "public", "class", "ShiroUrlPathHelper", "extends", "UrlPathHelper", "{", "@", "Override", "public", "String", "getPathWithinApplication", "(", "HttpServletRequest", "request", ")", "{", "return", "WebUtils", ".", "getPathWithinApplication", "(", "request", ")", ";", "}", "@", "Override", "public", "String", "getPathWithinServletMapping", "(", "HttpServletRequest", "request", ")", "{", "return", "WebUtils", ".", "getPathWithinApplication", "(", "request", ")", ";", "}", "}", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "shiro", ".", "mgt", ".", "SubjectFactory", ";", "import", "org", ".", "apache", ".", "shiro", ".", "session", ".", "mgt", ".", "SessionManager", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "config", ".", "AbstractShiroConfiguration", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "ShiroUrlPathHelper", ";", "import", "org", ".", "apache", ".", "shiro", ".", "web", ".", "mgt", ".", "CookieRememberMeManager", ";", "import", "org", ".", "apache", ".", "shiro", ".", "web", ".", "mgt", ".", "DefaultWebSecurityManager", ";", "import", "org", ".", "apache", ".", "shiro", ".", "web", ".", "mgt", ".", "DefaultWebSessionStorageEvaluator", ";", "@", "@", "-", "181", ",", "4", "+", "182", ",", "8", "@", "@", "protected", "ShiroFilterChainDefinition", "shiroFilterChainDefinition", "(", ")", "{", "chainDefinition", ".", "addPathDefinition", "(", "\"/", "**", "\",", "\"", "authc", "\"", ");", "return", "chainDefinition", ";", "}", "protected", "ShiroUrlPathHelper", "shiroUrlPathHelper", "(", ")", "{", "return", "new", "ShiroUrlPathHelper", "(", ");", "}", "}", "@", "@", "-", "40", ",", "7", "+", "40", ",", "7", "@", "@", "@", "Autowired", "protected", "ShiroFilterChainDefinition", "shiroFilterChainDefinition", ";", "@", "Autowired", "@", "Autowired", "(", "required", "=", "false", ")", "protected", "Map", "<", "String", ",", "Filter", ">", "filterMap", ";", "@", "Value", "(", "\"#", "{", "@", "environment", "[", "'", "shiro", ".", "loginUrl", "'", "]", "?", ":", "'", "/", "login", ".", "jsp", "'", "}", "\")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "config", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "ShiroUrlPathHelper", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Configuration", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "mvc", ".", "method", ".", "annotation", ".", "RequestMappingHandlerMapping", ";", "@", "Configuration", "public", "class", "ShiroRequestMappingConfig", "{", "public", "ShiroRequestMappingConfig", "(", "RequestMappingHandlerMapping", "requestMappingHandlerMapping", ")", "{", "requestMappingHandlerMapping", ".", "setUrlPathHelper", "(", "new", "ShiroUrlPathHelper", "(", "))", ";", "}", "}", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "shiro", ".", "session", ".", "mgt", ".", "SessionFactory", ";", "import", "org", ".", "apache", ".", "shiro", ".", "session", ".", "mgt", ".", "SessionManager", ";", "import", "org", ".", "apache", ".", "shiro", ".", "session", ".", "mgt", ".", "eis", ".", "SessionDAO", ";", "import", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", ".", "ShiroUrlPathHelper", ";", "import", "org", ".", "apache", ".", "shiro", ".", "web", ".", "servlet", ".", "Cookie", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Bean", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Configuration", ";", "@", "@", "-", "122", ",", "4", "+", "123", ",", "10", "@", "@", "protected", "SessionsSecurityManager", "securityManager", "(", "List", "<", "Realm", ">", "realms", ")", "{", "protected", "ShiroFilterChainDefinition", "shiroFilterChainDefinition", "(", ")", "{", "return", "super", ".", "shiroFilterChainDefinition", "(", ");", "}", "@", "Bean", "@", "Override", "protected", "ShiroUrlPathHelper", "shiroUrlPathHelper", "(", ")", "{", "return", "super", ".", "shiroUrlPathHelper", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "46", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "shiro", ".", "spring", ".", "web", "import", "org", ".", "junit", ".", "Test", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UrlPathHelper", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "equalTo", "/", "**", "*", "Tests", "a", "couple", "known", "differences", "between", "the", "stock", "and", "the", "ShiroUrlPathHelper", "*", "/", "class", "ShiroUrlPathHelperTest", "{", "@", "Test", "void", "testGetPathWithinApplication", "(", ")", "{", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "GET", "\"", ",", "\"", "/", "foo", "/", "%", "2e", "%", "2e", "\"", ")", "assertThat", "new", "UrlPathHelper", "(", ").", "getPathWithinApplication", "(", "request", ")", ",", "equalTo", "(", "\"/", "foo", "/", "..", "\")", "assertThat", "new", "ShiroUrlPathHelper", "(", ").", "getPathWithinApplication", "(", "request", ")", ",", "equalTo", "(", "\"/", "\")", "}", "@", "Test", "void", "testGetPathWithinServletMapping", "(", ")", "{", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "GET", "\"", ",", "\"", "/", "foo", "/", "%", "2e", "%", "2e", "\"", ")", "assertThat", "new", "UrlPathHelper", "(", ").", "getPathWithinServletMapping", "(", "request", ")", ",", "equalTo", "(", "\"/", "foo", "/", "..", "\")", "assertThat", "new", "ShiroUrlPathHelper", "(", ").", "getPathWithinServletMapping", "(", "request", ")", ",", "equalTo", "(", "\"/", "\")", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["bypass", "access", "restrictions"]}
{"contents": ["Prevent", "duplicate", "certificates", "in", "TrustedCertificateIndex", "With", "the", "separate", "caching", "of", "intermediate", "certificates", "in", "TrustManagerImpl", "a", "given", "intermediate", "may", "be", "passed", "into", ".index", "multiple", "times.", "Avoid", "adding", "the", "certificate", "to", "the", "list", "each", "time.", "(cherry-picked", "from", "commit", "d080e064abba665e2dde2a8c113f837ba4d9a85e)", "Bug:", "26232830", "Change-Id:", "I6bed2c65d9e42e052b9b1b129200a997e7dca745"], "code_tokens": ["@", "@", "-", "68", ",", "6", "+", "68", ",", "15", "@", "@", "public", "void", "index", "(", "TrustAnchor", "anchor", ")", "{", "if", "(", "anchors", "=", "=", "null", ")", "{", "anchors", "=", "new", "ArrayList", "<", "TrustAnchor", ">", "(", "1", ")", ";", "subjectToTrustAnchors", ".", "put", "(", "subject", ",", "anchors", ")", ";", "}", "else", "{", "/", "/", "Avoid", "indexing", "the", "same", "certificate", "multiple", "times", "if", "(", "cert", "!", "=", "null", ")", "{", "for", "(", "TrustAnchor", "entry", ":", "anchors", ")", "{", "if", "(", "cert", ".", "equals", "(", "entry", ".", "getTrustedCert", "(", "))", ")", "{", "return", ";", "}", "}", "}", "}", "anchors", ".", "add", "(", "anchor", ")", ";", "}"], "docstring_tokens": ["spoof", "servers"]}
{"contents": ["Fix", "bug", "#72241:", "get_icu_value_internal", "out-of-bounds", "read"], "code_tokens": ["@", "@", "-", "65", ",", "26", "+", "65", ",", "26", "@", "@", "ZEND_EXTERN_MODULE_GLOBALS", "(", "intl", ")", "*", "/", "static", "const", "char", "*", "const", "LOC_GRANDFATHERED", "[", "]", "=", "{", "\"", "art", "-", "lojban", "\"", ",", "\"", "i", "-", "klingon", "\"", ",", "\"", "i", "-", "lux", "\"", ",", "\"", "i", "-", "navajo", "\"", ",", "\"", "no", "-", "bok", "\"", ",", "\"", "no", "-", "nyn", "\"", ",", "\"", "cel", "-", "gaulish", "\"", ",", "\"", "en", "-", "GB", "-", "oed", "\"", ",", "\"", "i", "-", "ami", "\"", ",", "\"", "i", "-", "bnn", "\"", ",", "\"", "i", "-", "default", "\"", ",", "\"", "i", "-", "enochian", "\"", ",", "\"", "i", "-", "mingo", "\"", ",", "\"", "i", "-", "pwn", "\"", ",", "\"", "i", "-", "tao", "\"", ",", "\"", "cel", "-", "gaulish", "\"", ",", "\"", "en", "-", "GB", "-", "oed", "\"", ",", "\"", "i", "-", "ami", "\"", ",", "\"", "i", "-", "bnn", "\"", ",", "\"", "i", "-", "default", "\"", ",", "\"", "i", "-", "enochian", "\"", ",", "\"", "i", "-", "mingo", "\"", ",", "\"", "i", "-", "pwn", "\"", ",", "\"", "i", "-", "tao", "\"", ",", "\"", "i", "-", "tay", "\"", ",", "\"", "i", "-", "tsu", "\"", ",", "\"", "sgn", "-", "BE", "-", "fr", "\"", ",", "\"", "sgn", "-", "BE", "-", "nl", "\"", ",", "\"", "sgn", "-", "CH", "-", "de", "\"", ",", "\"", "zh", "-", "cmn", "\"", ",", "\"", "zh", "-", "cmn", "-", "Hans", "\"", ",", "\"", "zh", "-", "cmn", "-", "Hant", "\"", ",", "\"", "zh", "-", "gan", "\"", ",", "\"", "zh", "-", "guoyu", "\"", ",", "\"", "zh", "-", "hakka", "\"", ",", "\"", "zh", "-", "min", "\"", ",", "\"", "zh", "-", "min", "-", "nan", "\"", ",", "\"", "zh", "-", "wuu", "\"", ",", "\"", "zh", "-", "xiang", "\"", ",", "\"", "zh", "-", "min", "-", "nan", "\"", ",", "\"", "zh", "-", "wuu", "\"", ",", "\"", "zh", "-", "xiang", "\"", ",", "\"", "zh", "-", "yue", "\"", ",", "NULL", "}", ";", "/", "*", "Based", "on", "IANA", "registry", "at", "the", "time", "of", "writing", "this", "code", "*", "This", "array", "lists", "the", "preferred", "values", "for", "the", "grandfathered", "tags", "if", "applicable", "*", "This", "is", "in", "sync", "with", "the", "array", "LOC_GRANDFATHERED", "*", "This", "is", "in", "sync", "with", "the", "array", "LOC_GRANDFATHERED", "*", "e", ".", "g", ".", "the", "offsets", "of", "the", "grandfathered", "tags", "match", "the", "offset", "of", "the", "preferred", "value", "*", "/", "static", "const", "int", "LOC_PREFERRED_GRANDFATHERED_LEN", "=", "6", ";", "static", "const", "char", "*", "const", "LOC_PREFERRED_GRANDFATHERED", "[", "]", "=", "{", "\"", "jbo", "\"", ",", "\"", "tlh", "\"", ",", "\"", "lb", "\"", ",", "\"", "nv", "\"", ",", "\"", "nb", "\"", ",", "\"", "nn", "\"", ",", "\"", "nv", "\"", ",", "\"", "nb", "\"", ",", "\"", "nn", "\"", ",", "NULL", "}", ";", "@", "@", "-", "122", ",", "7", "+", "122", ",", "7", "@", "@", "static", "int16_t", "findOffset", "(", "const", "char", "*", "const", "*", "list", ",", "const", "char", "*", "key", ")", "/", "*}", "}}", "*/", "static", "char", "*", "getPreferredTag", "(", "const", "char", "*", "gf_tag", ")", "{", "{", "char", "*", "result", "=", "NULL", ";", "int", "grOffset", "=", "0", ";", "@", "@", "-", "141", ",", "15", "+", "141", ",", "15", "@", "@", "static", "char", "*", "getPreferredTag", "(", "const", "char", "*", "gf_tag", ")", "}", "/", "*", "{", "{{", "*", "returns", "the", "position", "of", "next", "token", "for", "lookup", "*", "returns", "the", "position", "of", "next", "token", "for", "lookup", "*", "or", "-", "1", "if", "no", "token", "*", "strtokr", "equivalent", "search", "for", "token", "in", "reverse", "direction", "*", "strtokr", "equivalent", "search", "for", "token", "in", "reverse", "direction", "*", "/", "static", "int", "getStrrtokenPos", "(", "char", "*", "str", ",", "int", "savedPos", ")", "{", "int", "result", "=", "-", "1", ";", "int", "i", ";", "for", "(", "i", "=", "savedPos", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "{", "if", "(", "isIDSeparator", "(", "*(", "str", "+", "i", ")", ")", ")", "{", "/", "*", "delimiter", "found", ";", "check", "for", "singleton", "*", "/", "@", "@", "-", "171", ",", "7", "+", "171", ",", "7", "@", "@", "static", "int", "getStrrtokenPos", "(", "char", "*", "str", ",", "int", "savedPos", ")", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "*", "returns", "the", "position", "of", "a", "singleton", "if", "present", "*", "returns", "the", "position", "of", "a", "singleton", "if", "present", "*", "returns", "-", "1", "if", "no", "singleton", "*", "strtok", "equivalent", "search", "for", "singleton", "*", "/", "@", "@", "-", "180", ",", "7", "+", "180", ",", "7", "@", "@", "static", "int", "getSingletonPos", "(", "const", "char", "*", "str", ")", "int", "result", "=", "-", "1", ";", "int", "i", "=", "0", ";", "int", "len", "=", "0", ";", "if", "(", "str", "&", "&", "(", "(", "len", "=", "strlen", "(", "str", ")", ")>", "0", ")", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "len", ";", "i", "+", "+)", "{", "if", "(", "isIDSeparator", "(", "*(", "str", "+", "i", ")", ")", ")", "{", "@", "@", "-", "198", ",", "7", "+", "198", ",", "7", "@", "@", "static", "int", "getSingletonPos", "(", "const", "char", "*", "str", ")", "}", "}", "}", "/*", "end", "of", "for", "*", "/", "}", "return", "result", ";", "}", "@", "@", "-", "224", ",", "7", "+", "224", ",", "7", "@", "@", "PHP_NAMED_FUNCTION", "(", "zif_locale_get_default", ")", "PHP_NAMED_FUNCTION", "(", "zif_locale_set_default", ")", "{", "char", "*", "locale_name", "=", "NULL", ";", "int", "len", "=", "0", ";", "int", "len", "=", "0", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "s", "\"", ",", "&", "locale_name", ",", "&", "len", ")", "=", "=", "FAILURE", ")", "@", "@", "-", "240", ",", "14", "+", "240", ",", "14", "@", "@", "PHP_NAMED_FUNCTION", "(", "zif_locale_set_default", ")", "len", "=", "strlen", "(", "locale_name", ")", ";", "}", "zend_alter_ini_entry", "(", "LOCALE_INI_NAME", ",", "sizeof", "(", "LOCALE_INI_NAME", ")", ",", "locale_name", ",", "len", ",", "PHP_INI_USER", ",", "PHP_INI_STAGE_RUNTIME", ")", ";", "zend_alter_ini_entry", "(", "LOCALE_INI_NAME", ",", "sizeof", "(", "LOCALE_INI_NAME", ")", ",", "locale_name", ",", "len", ",", "PHP_INI_USER", ",", "PHP_INI_STAGE_RUNTIME", ")", ";", "RETURN_TRUE", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "*", "Gets", "the", "value", "from", "ICU", "*", "Gets", "the", "value", "from", "ICU", "*", "common", "code", "shared", "by", "get_primary_language", ",", "get_script", "or", "get_region", "or", "get_variant", "*", "result", "=", "0", "if", "error", ",", "1", "if", "successful", ",", "-", "1", "if", "no", "value", "*", "/", "@", "@", "-", "284", ",", "7", "+", "284", ",", "7", "@", "@", "static", "char", "*", "get_icu_value_internal", "(", "const", "char", "*", "loc_name", ",", "char", "*", "tag_name", ",", "int", "*", "}", "}", "singletonPos", "=", "getSingletonPos", "(", "loc_name", ")", ";", "singletonPos", "=", "getSingletonPos", "(", "loc_name", ")", ";", "if", "(", "singletonPos", "=", "=", "0", ")", "{", "/", "*", "singleton", "at", "start", "of", "script", ",", "region", ",", "variant", "etc", ".", "*", "or", "invalid", "singleton", "at", "start", "of", "language", "*", "/", "@", "@", "-", "299", ",", "7", "+", "299", ",", "7", "@", "@", "static", "char", "*", "get_icu_value_internal", "(", "const", "char", "*", "loc_name", ",", "char", "*", "tag_name", ",", "int", "*", "}", "/", "*", "end", "of", "if", "!", "=", "LOC_CANONICAL_TAG", "*", "/", "if", "(", "mod_loc_name", "=", "=", "NULL", ")", "{", "mod_loc_name", "=", "estrdup", "(", "loc_name", ")", ";", "mod_loc_name", "=", "estrdup", "(", "loc_name", ")", ";", "}", "/", "*", "Proceed", "to", "ICU", "*", "/", "@", "@", "-", "326", ",", "6", "+", "326", ",", "7", "@", "@", "static", "char", "*", "get_icu_value_internal", "(", "const", "char", "*", "loc_name", ",", "char", "*", "tag_name", ",", "int", "*", "if", "(", "U_FAILURE", "(", "status", ")", ")", "{", "if", "(", "status", "=", "=", "U_BUFFER_OVERFLOW_ERROR", ")", "{", "status", "=", "U_ZERO_ERROR", ";", "buflen", "+", "+;", "/", "*", "add", "space", "for", "\\", "0", "*", "/", "continue", ";", "}", "@", "@", "-", "366", ",", "7", "+", "367", ",", "7", "@", "@", "static", "char", "*", "get_icu_value_internal", "(", "const", "char", "*", "loc_name", ",", "char", "*", "tag_name", ",", "int", "*", "*", "Gets", "the", "value", "from", "ICU", ",", "called", "when", "PHP", "userspace", "function", "is", "called", "*", "common", "code", "shared", "by", "get_primary_language", ",", "get_script", "or", "get_region", "or", "get_variant", "*", "/", "static", "void", "get_icu_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAMETERS", ")", "static", "void", "get_icu_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAMETERS", ")", "{", "const", "char", "*", "loc_name", "=", "NULL", ";", "@", "@", "-", "422", ",", "47", "+", "423", ",", "47", "@", "@", "static", "void", "get_icu_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAMETERS", ")", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "getScript", "(", "$", "locale", ")", "*", "gets", "the", "script", "for", "the", "$", "locale", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "getScript", "(", "$", "locale", ")", "*", "gets", "the", "script", "for", "the", "$", "locale", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "locale_get_script", "(", "$", "locale", ")", "*", "gets", "the", "script", "for", "the", "$", "locale", "/", "*", "{", "{{", "proto", "static", "string", "locale_get_script", "(", "$", "locale", ")", "*", "gets", "the", "script", "for", "the", "$", "locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_script", ")", "PHP_FUNCTION", "(", "locale_get_script", ")", "{", "get_icu_value_src_php", "(", "LOC_SCRIPT_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "getRegion", "(", "$", "locale", ")", "*", "gets", "the", "region", "for", "the", "$", "locale", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "getRegion", "(", "$", "locale", ")", "*", "gets", "the", "region", "for", "the", "$", "locale", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "locale_get_region", "(", "$", "locale", ")", "*", "gets", "the", "region", "for", "the", "$", "locale", "/", "*", "{", "{{", "proto", "static", "string", "locale_get_region", "(", "$", "locale", ")", "*", "gets", "the", "region", "for", "the", "$", "locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_region", ")", "PHP_FUNCTION", "(", "locale_get_region", ")", "{", "get_icu_value_src_php", "(", "LOC_REGION_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "getPrimaryLanguage", "(", "$", "locale", ")", "*", "gets", "the", "primary", "language", "for", "the", "$", "locale", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "getPrimaryLanguage", "(", "$", "locale", ")", "*", "gets", "the", "primary", "language", "for", "the", "$", "locale", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "locale_get_primary_language", "(", "$", "locale", ")", "*", "gets", "the", "primary", "language", "for", "the", "$", "locale", "/", "*", "{", "{{", "proto", "static", "string", "locale_get_primary_language", "(", "$", "locale", ")", "*", "gets", "the", "primary", "language", "for", "the", "$", "locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_primary_language", ")", "PHP_FUNCTION", "(", "locale_get_primary_language", ")", "{", "get_icu_value_src_php", "(", "LOC_LANG_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "*", "common", "code", "shared", "by", "display_xyz", "functions", "to", "get", "the", "value", "from", "ICU", "*", "common", "code", "shared", "by", "display_xyz", "functions", "to", "get", "the", "value", "from", "ICU", "}", "}}", "*", "/", "static", "void", "get_icu_disp_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAMETERS", ")", "static", "void", "get_icu_disp_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAMETERS", ")", "{", "const", "char", "*", "loc_name", "=", "NULL", ";", "int", "loc_name_len", "=", "0", ";", "@", "@", "-", "488", ",", "7", "+", "489", ",", "7", "@", "@", "static", "void", "get_icu_disp_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAME", "intl_error_reset", "(", "NULL", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "s", "|", "s", "\"", ",", "&", "loc_name", ",", "&", "loc_name_len", ",", "&", "loc_name", ",", "&", "loc_name_len", ",", "&", "disp_loc_name", ",", "&", "disp_loc_name_len", ")", "=", "=", "FAILURE", ")", "{", "spprintf", "(", "&", "msg", ",", "0", ",", "\"", "locale_get_display_", "%", "s", ":", "unable", "to", "parse", "input", "params", "\"", ",", "tag_name", ")", ";", "@", "@", "-", "525", ",", "7", "+", "526", ",", "7", "@", "@", "static", "void", "get_icu_disp_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAME", "if", "(", "mod_loc_name", "=", "=", "NULL", ")", "{", "mod_loc_name", "=", "estrdup", "(", "loc_name", ")", ";", "}", "/", "*", "Check", "if", "disp_loc_name", "passed", ",", "if", "not", "use", "default", "locale", "*", "/", "if", "(", "!", "disp_loc_name", ")", "{", "disp_loc_name", "=", "estrdup", "(", "intl_locale_get_default", "(", "TSRMLS_C", ")", ");", "@", "@", "-", "604", ",", "7", "+", "605", ",", "7", "@", "@", "static", "void", "get_icu_disp_value_src_php", "(", "char", "*", "tag_name", ",", "INTERNAL_FUNCTION_PARAME", "/", "*", "{", "{{", "proto", "static", "string", "get_display_name", "(", "$", "locale", "[", ",", "$", "in_locale", "=", "null", "]", ")", "*", "gets", "the", "name", "for", "the", "$", "locale", "in", "$", "in_locale", "or", "default_locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_display_name", ")", "PHP_FUNCTION", "(", "locale_get_display_name", ")", "{", "get_icu_disp_value_src_php", "(", "DISP_NAME", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "@", "@", "-", "616", ",", "7", "+", "617", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_display_name", ")", "/", "*", "{", "{{", "proto", "static", "string", "get_display_language", "(", "$", "locale", "[", ",", "$", "in_locale", "=", "null", "]", ")", "*", "gets", "the", "language", "for", "the", "$", "locale", "in", "$", "in_locale", "or", "default_locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_display_language", ")", "PHP_FUNCTION", "(", "locale_get_display_language", ")", "{", "get_icu_disp_value_src_php", "(", "LOC_LANG_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "@", "@", "-", "628", ",", "7", "+", "629", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_display_language", ")", "/", "*", "{", "{{", "proto", "static", "string", "get_display_script", "(", "$", "locale", ",", "$", "in_locale", "=", "null", ")", "*", "gets", "the", "script", "for", "the", "$", "locale", "in", "$", "in_locale", "or", "default_locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_display_script", ")", "PHP_FUNCTION", "(", "locale_get_display_script", ")", "{", "get_icu_disp_value_src_php", "(", "LOC_SCRIPT_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "@", "@", "-", "640", ",", "7", "+", "641", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_display_script", ")", "/", "*", "{", "{{", "proto", "static", "string", "get_display_region", "(", "$", "locale", ",", "$", "in_locale", "=", "null", ")", "*", "gets", "the", "region", "for", "the", "$", "locale", "in", "$", "in_locale", "or", "default_locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_display_region", ")", "PHP_FUNCTION", "(", "locale_get_display_region", ")", "{", "get_icu_disp_value_src_php", "(", "LOC_REGION_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "@", "@", "-", "654", ",", "7", "+", "655", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_display_region", ")", "*", "proto", "static", "string", "get_display_variant", "(", "$", "locale", ",", "$", "in_locale", "=", "null", ")", "*", "gets", "the", "variant", "for", "the", "$", "locale", "in", "$", "in_locale", "or", "default_locale", "*", "/", "PHP_FUNCTION", "(", "locale_get_display_variant", ")", "PHP_FUNCTION", "(", "locale_get_display_variant", ")", "{", "get_icu_disp_value_src_php", "(", "LOC_VARIANT_TAG", ",", "INTERNAL_FUNCTION_PARAM_PASSTHRU", ")", ";", "}", "@", "@", "-", "667", ",", "7", "+", "668", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_display_variant", ")", "/", "*", "{", "{{", "proto", "static", "array", "locale_get_keywords", "(", "string", "$", "locale", ")", "{", "*", "return", "an", "associative", "array", "containing", "keyword", "-", "value", "*", "pairs", "for", "this", "locale", ".", "The", "keys", "are", "keys", "to", "the", "array", "(", "doh", "!", ")", "*", "/", "*", "/", "PHP_FUNCTION", "(", "locale_get_keywords", ")", "{", "UEnumeration", "*", "e", "=", "NULL", ";", "@", "@", "-", "679", ",", "10", "+", "680", ",", "10", "@", "@", "PHP_FUNCTION", "(", "locale_get_keywords", ")", "const", "char", "*", "loc_name", "=", "NULL", ";", "int", "loc_name_len", "=", "0", ";", "/", "*", "ICU", "expects", "the", "buffer", "to", "be", "allocated", "before", "calling", "the", "function", "and", "so", "the", "buffer", "size", "has", "been", "explicitly", "specified", "ICU", "uloc", ".", "h", "#", "define", "ULOC_KEYWORD_AND_VALUES_CAPACITY", "100", "/", "*", "ICU", "expects", "the", "buffer", "to", "be", "allocated", "before", "calling", "the", "function", "and", "so", "the", "buffer", "size", "has", "been", "explicitly", "specified", "ICU", "uloc", ".", "h", "#", "define", "ULOC_KEYWORD_AND_VALUES_CAPACITY", "100", "hence", "the", "kw_value", "buffer", "size", "is", "100", "*", "/", "char", "*", "kw_value", "=", "NULL", ";", "@", "@", "-", "721", ",", "7", "+", "722", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_keywords", ")", "kw_value_len", "=", "uloc_getKeywordValue", "(", "loc_name", ",", "kw_key", ",", "kw_value", ",", "kw_value_len", "+", "1", ",", "&", "status", ")", ";", "}", "else", "if", "(", "!", "U_FAILURE", "(", "status", ")", ")", "{", "kw_value", "=", "erealloc", "(", "kw_value", ",", "kw_value_len", "+", "1", ")", ";", "}", "}", "if", "(", "U_FAILURE", "(", "status", ")", ")", "{", "intl_error_set", "(", "NULL", ",", "U_ILLEGAL_ARGUMENT_ERROR", ",", "\"", "locale_get_keywords", ":", "Error", "encountered", "while", "getting", "the", "keyword", "value", "for", "the", "keyword", "\"", ",", "0", "TSRMLS_CC", ")", ";", "if", "(", "kw_value", ")", "{", "@", "@", "-", "740", ",", "10", "+", "741", ",", "10", "@", "@", "PHP_FUNCTION", "(", "locale_get_keywords", ")", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "canonicalize", "(", "$", "locale", ")", "*", "@", "return", "string", "the", "canonicalized", "locale", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "canonicalize", "(", "$", "locale", ")", "*", "@", "return", "string", "the", "canonicalized", "locale", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "locale_canonicalize", "(", "Locale", "$", "loc", ",", "string", "$", "locale", ")", "/", "*", "{", "{{", "proto", "static", "string", "locale_canonicalize", "(", "Locale", "$", "loc", ",", "string", "$", "locale", ")", "*", "@", "param", "string", "$", "locale", "The", "locale", "string", "to", "canonicalize", "*", "/", "PHP_FUNCTION", "(", "locale_canonicalize", ")", "@", "@", "-", "752", ",", "10", "+", "753", ",", "10", "@", "@", "PHP_FUNCTION", "(", "locale_canonicalize", ")", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "append_key_value", "/", "*", "{", "{{", "append_key_value", "*", "Internal", "function", "which", "is", "called", "from", "locale_compose", "*", "gets", "the", "value", "for", "the", "key_name", "and", "appends", "to", "the", "loc_name", "*", "returns", "1", "if", "successful", ",", "-", "1", "if", "not", "found", ",", "*", "returns", "1", "if", "successful", ",", "-", "1", "if", "not", "found", ",", "*", "0", "if", "array", "element", "is", "not", "a", "string", ",", "-", "2", "if", "buffer", "-", "overflow", "*", "/", "static", "int", "append_key_value", "(", "smart_str", "*", "loc_name", ",", "HashTable", "*", "hash_arr", ",", "char", "*", "key_name", ")", "@", "@", "-", "767", ",", "7", "+", "768", ",", "7", "@", "@", "static", "int", "append_key_value", "(", "smart_str", "*", "loc_name", ",", "HashTable", "*", "hash_arr", ",", "char", "*", "key_", "/", "*", "element", "value", "is", "not", "a", "string", "*", "/", "return", "FAILURE", ";", "}", "if", "(", "strcmp", "(", "key_name", ",", "LOC_LANG_TAG", ")", "!", "=", "0", "&", "&", "if", "(", "strcmp", "(", "key_name", ",", "LOC_LANG_TAG", ")", "!", "=", "0", "&", "&", "strcmp", "(", "key_name", ",", "LOC_GRANDFATHERED_LANG_TAG", ")", "!=", "0", ")", "{", "/", "*", "not", "lang", "or", "grandfathered", "tag", "*", "/", "smart_str_appendl", "(", "loc_name", ",", "SEPARATOR", ",", "sizeof", "(", "SEPARATOR", ")", "-", "1", ")", ";", "@", "@", "-", "792", ",", "11", "+", "793", ",", "11", "@", "@", "static", "void", "add_prefix", "(", "smart_str", "*", "loc_name", ",", "char", "*", "key_name", ")", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "append_multiple_key_values", "/", "*", "{", "{{", "append_multiple_key_values", "*", "Internal", "function", "which", "is", "called", "from", "locale_compose", "*", "gets", "the", "multiple", "values", "for", "the", "key_name", "and", "appends", "to", "the", "loc_name", "*", "used", "for", "'", "variant", "'", ",'", "extlang", "'", ",'", "private", "'", "*", "returns", "1", "if", "successful", ",", "-", "1", "if", "not", "found", ",", "*", "used", "for", "'", "variant", "'", ",'", "extlang", "'", ",'", "private", "'", "*", "returns", "1", "if", "successful", ",", "-", "1", "if", "not", "found", ",", "*", "0", "if", "array", "element", "is", "not", "a", "string", ",", "-", "2", "if", "buffer", "-", "overflow", "*", "/", "static", "int", "append_multiple_key_values", "(", "smart_str", "*", "loc_name", ",", "HashTable", "*", "hash_arr", ",", "char", "*", "key_name", "TSRMLS_DC", ")", "@", "@", "-", "850", ",", "8", "+", "851", ",", "8", "@", "@", "static", "int", "append_multiple_key_values", "(", "smart_str", "*", "loc_name", ",", "HashTable", "*", "hash_arr", ",", "/", "*", "Multiple", "variant", "values", "as", "variant0", ",", "variant1", ",", "variant2", "*", "/", "isFirstSubtag", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "max_value", ";", "i", "+", "+", ")", "{", "snprintf", "(", "cur_key_name", ",", "30", ",", "\"", "%", "s", "%", "d", "\"", ",", "key_name", ",", "i", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "max_value", ";", "i", "+", "+", ")", "{", "snprintf", "(", "cur_key_name", ",", "30", ",", "\"", "%", "s", "%", "d", "\"", ",", "key_name", ",", "i", ")", ";", "if", "(", "zend_hash_find", "(", "hash_arr", ",", "cur_key_name", ",", "strlen", "(", "cur_key_name", ")", "+", "1", ",", "(", "void", "*", "*)", "&", "ele_value", ")", "=", "=", "SUCCESS", ")", "{", "if", "(", "Z_TYPE_PP", "(", "ele_value", ")", "!=", "IS_STRING", ")", "{", "/", "*", "variant", "is", "not", "a", "string", "*", "/", "@", "@", "-", "873", ",", "7", "+", "874", ",", "7", "@", "@", "static", "int", "append_multiple_key_values", "(", "smart_str", "*", "loc_name", ",", "HashTable", "*", "hash_arr", ",", "/", "*{", "{{", "*", "If", "applicable", "sets", "error", "message", "and", "aborts", "locale_compose", "gracefully", "*", "returns", "0", "if", "locale_compose", "needs", "to", "be", "aborted", "*", "returns", "0", "if", "locale_compose", "needs", "to", "be", "aborted", "*", "otherwise", "returns", "1", "*", "/", "static", "int", "handleAppendResult", "(", "int", "result", ",", "smart_str", "*", "loc_name", "TSRMLS_DC", ")", "@", "@", "-", "890", ",", "11", "+", "891", ",", "11", "@", "@", "static", "int", "handleAppendResult", "(", "int", "result", ",", "smart_str", "*", "loc_name", "TSRMLS_DC", ")", "/", "*", "}", "}}", "*", "/", "#", "define", "RETURN_SMART_STR", "(", "s", ")", "smart_str_0", "(", "(", "s", ")", ");", "RETURN_STRINGL", "(", "(", "s", ")", "->", "c", ",", "(", "s", ")", "->", "len", ",", "0", ")", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "composeLocale", "(", "$", "array", ")", "*", "Creates", "a", "locale", "by", "combining", "the", "parts", "of", "locale", "-", "ID", "passed", "/", "*", "{", "{{", "proto", "static", "string", "Locale", ":", ":", "composeLocale", "(", "$", "array", ")", "*", "Creates", "a", "locale", "by", "combining", "the", "parts", "of", "locale", "-", "ID", "passed", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "string", "compose_locale", "(", "$", "array", ")", "*", "Creates", "a", "locale", "by", "combining", "the", "parts", "of", "locale", "-", "ID", "passed", "/", "*", "{", "{{", "proto", "static", "string", "compose_locale", "(", "$", "array", ")", "*", "Creates", "a", "locale", "by", "combining", "the", "parts", "of", "locale", "-", "ID", "passed", "*", "}", "}}", "*", "/", "PHP_FUNCTION", "(", "locale_compose", ")", "{", "@", "@", "-", "920", ",", "7", "+", "921", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_compose", ")", "RETURN_FALSE", ";", "/", "*", "Check", "for", "grandfathered", "first", "*", "/", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_GRANDFATHERED_LANG_TAG", ")", ";", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_GRANDFATHERED_LANG_TAG", ")", ";", "if", "(", "result", "=", "=", "SUCCESS", ")", "{", "RETURN_SMART_STR", "(", "loc_name", ")", ";", "}", "@", "@", "-", "929", ",", "7", "+", "930", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_compose", ")", "}", "/", "*", "Not", "grandfathered", "*", "/", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_LANG_TAG", ")", ";", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_LANG_TAG", ")", ";", "if", "(", "result", "=", "=", "LOC_NOT_FOUND", ")", "{", "intl_error_set", "(", "NULL", ",", "U_ILLEGAL_ARGUMENT_ERROR", ",", "\"", "locale_compose", ":", "parameter", "array", "does", "not", "contain", "'", "language", "'", "tag", ".", "\",", "0", "TSRMLS_CC", ")", ";", "@", "@", "-", "947", ",", "19", "+", "948", ",", "19", "@", "@", "PHP_FUNCTION", "(", "locale_compose", ")", "}", "/", "*", "Script", "*", "/", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_SCRIPT_TAG", ")", ";", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_SCRIPT_TAG", ")", ";", "if", "(", "!", "handleAppendResult", "(", "result", ",", "loc_name", "TSRMLS_CC", ")", "){", "RETURN_FALSE", ";", "}", "/", "*", "Region", "*", "/", "result", "=", "append_key_value", "(", "loc_name", ",", "hash_arr", ",", "LOC_REGION_TAG", ")", ";", "if", "(", "!", "handleAppendResult", "(", "result", ",", "loc_name", "TSRMLS_CC", ")", "){", "RETURN_FALSE", ";", "}", "/", "*", "Variant", "*", "/", "result", "=", "append_multiple_key_values", "(", "loc_name", ",", "hash_arr", ",", "LOC_VARIANT_TAG", "TSRMLS_CC", ")", ";", "result", "=", "append_multiple_key_values", "(", "loc_name", ",", "hash_arr", ",", "LOC_VARIANT_TAG", "TSRMLS_CC", ")", ";", "if", "(", "!", "handleAppendResult", "(", "result", ",", "loc_name", "TSRMLS_CC", ")", "){", "RETURN_FALSE", ";", "}", "@", "@", "-", "985", ",", "16", "+", "986", ",", "16", "@", "@", "static", "char", "*", "get_private_subtags", "(", "const", "char", "*", "loc_name", ")", "{", "char", "*", "result", "=", "NULL", ";", "int", "singletonPos", "=", "0", ";", "int", "len", "=", "0", ";", "int", "len", "=", "0", ";", "const", "char", "*", "mod_loc_name", "=", "NULL", ";", "if", "(", "loc_name", "&", "&", "(", "len", "=", "strlen", "(", "loc_name", ")", ">", "0", ")", ")", "{", "mod_loc_name", "=", "loc_name", ";", "mod_loc_name", "=", "loc_name", ";", "len", "=", "strlen", "(", "mod_loc_name", ")", ";", "while", "(", "(", "singletonPos", "=", "getSingletonPos", "(", "mod_loc_name", ")", ")!", "=", "-", "1", ")", "{", "if", "(", "singletonPos", "!", "=-", "1", ")", "{", "if", "(", "(", "*(", "mod_loc_name", "+", "singletonPos", ")", "==", "'", "x", "'", ")", "|", "|", "(", "*(", "mod_loc_name", "+", "singletonPos", ")", "==", "'", "X", "'", ")", ")", "{", "if", "(", "singletonPos", "!", "=-", "1", ")", "{", "if", "(", "(", "*(", "mod_loc_name", "+", "singletonPos", ")", "==", "'", "x", "'", ")", "|", "|", "(", "*(", "mod_loc_name", "+", "singletonPos", ")", "==", "'", "X", "'", ")", ")", "{", "/", "*", "private", "subtag", "start", "found", "*", "/", "if", "(", "singletonPos", "+", "2", "=", "=", "len", ")", "{", "/", "*", "loc_name", "ends", "with", "'", "-", "x", "-", "'", ";", "return", "NULL", "*", "/", "@", "@", "-", "1019", ",", "7", "+", "1020", ",", "7", "@", "@", "static", "char", "*", "get_private_subtags", "(", "const", "char", "*", "loc_name", ")", "}", "/", "*", "end", "of", "while", "*", "/", "}", "return", "result", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1044", ",", "20", "+", "1045", ",", "20", "@", "@", "static", "int", "add_array_entry", "(", "const", "char", "*", "loc_name", ",", "zval", "*", "hash_arr", ",", "char", "*", "key_name", "}", "else", "{", "key_value", "=", "get_icu_value_internal", "(", "loc_name", ",", "key_name", ",", "&", "result", ",", "1", ")", ";", "}", "if", "(", "(", "strcmp", "(", "key_name", ",", "LOC_PRIVATE_TAG", ")", "==", "0", ")", "|", "|", "if", "(", "(", "strcmp", "(", "key_name", ",", "LOC_PRIVATE_TAG", ")", "==", "0", ")", "|", "|", "(", "strcmp", "(", "key_name", ",", "LOC_VARIANT_TAG", ")", "==", "0", ")", ")", "{", "if", "(", "result", ">", "0", "&", "&", "key_value", ")", "{", "/", "*", "Tokenize", "on", "the", "\"", "_", "\"", "or", "\"", "-\"", "*", "/", "token", "=", "php_strtok_r", "(", "key_value", ",", "DELIMITER", ",", "&", "last_ptr", ")", ";", "token", "=", "php_strtok_r", "(", "key_value", ",", "DELIMITER", ",", "&", "last_ptr", ")", ";", "if", "(", "cur_key_name", ")", "{", "efree", "(", "cur_key_name", ")", ";", "}", "cur_key_name", "=", "(", "char", "*", ")", "ecalloc", "(", "25", ",", "25", ")", ";", "sprintf", "(", "cur_key_name", ",", "\"", "%", "s", "%", "d", "\"", ",", "key_name", ",", "cnt", "+", "+)", ";", "sprintf", "(", "cur_key_name", ",", "\"", "%", "s", "%", "d", "\"", ",", "key_name", ",", "cnt", "+", "+)", ";", "add_assoc_string", "(", "hash_arr", ",", "cur_key_name", ",", "token", ",", "TRUE", ")", ";", "/", "*", "tokenize", "on", "the", "\"", "_", "\"", "or", "\"", "-\"", "and", "stop", "at", "singleton", "if", "any", "*", "/", "while", "(", "(", "token", "=", "php_strtok_r", "(", "NULL", ",", "DELIMITER", ",", "&", "last_ptr", ")", ")", "&", "&", "(", "strlen", "(", "token", ")", ">", "1", ")", ")", "{", "sprintf", "(", "cur_key_name", ",", "\"", "%", "s", "%", "d", "\"", ",", "key_name", ",", "cnt", "+", "+)", ";", "sprintf", "(", "cur_key_name", ",", "\"", "%", "s", "%", "d", "\"", ",", "key_name", ",", "cnt", "+", "+)", ";", "add_assoc_string", "(", "hash_arr", ",", "cur_key_name", ",", "token", ",", "TRUE", ")", ";", "}", "/", "*", "@", "@", "-", "1077", ",", "16", "+", "1078", ",", "16", "@", "@", "static", "int", "add_array_entry", "(", "const", "char", "*", "loc_name", ",", "zval", "*", "hash_arr", ",", "char", "*", "key_name", "}", "/", "*", "if", "(", "key_name", "!", "=", "LOC_PRIVATE_TAG", "&", "&", "key_value", ")", "{*", "/", "if", "(", "key_value", ")", "{", "efree", "(", "key_value", ")", ";", "efree", "(", "key_value", ")", ";", "}", "return", "cur_result", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "array", "Locale", ":", ":", "parseLocale", "(", "$", "locale", ")", "/", "*", "{", "{{", "proto", "static", "array", "Locale", ":", ":", "parseLocale", "(", "$", "locale", ")", "*", "parses", "a", "locale", "-", "id", "into", "an", "array", "the", "different", "parts", "of", "it", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "array", "parse_locale", "(", "$", "locale", ")", "/", "*", "{", "{{", "proto", "static", "array", "parse_locale", "(", "$", "locale", ")", "*", "parses", "a", "locale", "-", "id", "into", "an", "array", "the", "different", "parts", "of", "it", "*", "/", "PHP_FUNCTION", "(", "locale_parse", ")", "@", "@", "-", "1144", ",", "7", "+", "1145", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_all_variants", ")", "char", "*", "saved_ptr", "=", "NULL", ";", "intl_error_reset", "(", "NULL", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "s", "\"", ",", "&", "loc_name", ",", "&", "loc_name_len", ")", "=", "=", "FAILURE", ")", "{", "@", "@", "-", "1162", ",", "15", "+", "1163", ",", "15", "@", "@", "PHP_FUNCTION", "(", "locale_get_all_variants", ")", "array_init", "(", "return_value", ")", ";", "/", "*", "If", "the", "locale", "is", "grandfathered", ",", "stop", ",", "no", "variants", "*", "/", "if", "(", "findOffset", "(", "LOC_GRANDFATHERED", ",", "loc_name", ")", ">", "=", "0", ")", "{", "if", "(", "findOffset", "(", "LOC_GRANDFATHERED", ",", "loc_name", ")", ">", "=", "0", ")", "{", "/", "*", "(", "\"", "Grandfathered", "Tag", ".", "No", "variants", ".", "\")", ";", "*", "/", "}", "else", "{", "else", "{", "/", "*", "Call", "ICU", "variant", "*", "/", "variant", "=", "get_icu_value_internal", "(", "loc_name", ",", "LOC_VARIANT_TAG", ",", "&", "result", ",", "0", ")", ";", "if", "(", "result", ">", "0", "&", "&", "variant", ")", "{", "/", "*", "Tokenize", "on", "the", "\"", "_", "\"", "or", "\"", "-\"", "*", "/", "token", "=", "php_strtok_r", "(", "variant", ",", "DELIMITER", ",", "&", "saved_ptr", ")", ";", "token", "=", "php_strtok_r", "(", "variant", ",", "DELIMITER", ",", "&", "saved_ptr", ")", ";", "add_next_index_stringl", "(", "return_value", ",", "token", ",", "strlen", "(", "token", ")", ",", "TRUE", ")", ";", "/", "*", "tokenize", "on", "the", "\"", "_", "\"", "or", "\"", "-\"", "and", "stop", "at", "singleton", "if", "any", "*", "/", "while", "(", "(", "token", "=", "php_strtok_r", "(", "NULL", ",", "DELIMITER", ",", "&", "saved_ptr", ")", ")", "&", "&", "(", "strlen", "(", "token", ")", ">", "1", ")", ")", "{", "@", "@", "-", "1181", ",", "7", "+", "1182", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_get_all_variants", ")", "efree", "(", "variant", ")", ";", "}", "}", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1220", ",", "11", "+", "1221", ",", "11", "@", "@", "static", "int", "strToMatch", "(", "const", "char", "*", "str", ",", "char", "*", "retstr", ")", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "static", "boolean", "Locale", ":", ":", "filterMatches", "(", "string", "$", "langtag", ",", "string", "$", "locale", "[", ",", "bool", "$", "canonicalize", "]", ")", "*", "Checks", "if", "a", "$", "langtag", "filter", "matches", "with", "$", "locale", "according", "to", "RFC", "4647", "'", "s", "basic", "filtering", "algorithm", "*", "Checks", "if", "a", "$", "langtag", "filter", "matches", "with", "$", "locale", "according", "to", "RFC", "4647", "'", "s", "basic", "filtering", "algorithm", "*", "/", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "boolean", "locale_filter_matches", "(", "string", "$", "langtag", ",", "string", "$", "locale", "[", ",", "bool", "$", "canonicalize", "]", ")", "*", "Checks", "if", "a", "$", "langtag", "filter", "matches", "with", "$", "locale", "according", "to", "RFC", "4647", "'", "s", "basic", "filtering", "algorithm", "*", "Checks", "if", "a", "$", "langtag", "filter", "matches", "with", "$", "locale", "according", "to", "RFC", "4647", "'", "s", "basic", "filtering", "algorithm", "*", "/", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "{", "@", "@", "-", "1243", ",", "13", "+", "1244", ",", "13", "@", "@", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "char", "*", "cur_lang_tag", "=", "NULL", ";", "char", "*", "cur_loc_range", "=", "NULL", ";", "zend_bool", "boolCanonical", "=", "0", ";", "zend_bool", "boolCanonical", "=", "0", ";", "UErrorCode", "status", "=", "U_ZERO_ERROR", ";", "intl_error_reset", "(", "NULL", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "|", "b", "\"", ",", "&", "lang_tag", ",", "&", "lang_tag_len", ",", "&", "loc_range", ",", "&", "loc_range_len", ",", "&", "lang_tag", ",", "&", "lang_tag_len", ",", "&", "loc_range", ",", "&", "loc_range_len", ",", "&", "boolCanonical", ")", "=", "=", "FAILURE", ")", "{", "intl_error_set", "(", "NULL", ",", "U_ILLEGAL_ARGUMENT_ERROR", ",", "@", "@", "-", "1270", ",", "15", "+", "1271", ",", "15", "@", "@", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "/", "*", "canonicalize", "loc_range", "*", "/", "can_loc_range", "=", "get_icu_value_internal", "(", "loc_range", ",", "LOC_CANONICALIZE_TAG", ",", "&", "result", ",", "0", ")", ";", "if", "(", "result", "=", "=", "0", ")", "{", "intl_error_set", "(", "NULL", ",", "status", ",", "intl_error_set", "(", "NULL", ",", "status", ",", "\"", "locale_filter_matches", ":", "unable", "to", "canonicalize", "loc_range", "\"", ",", "0", "TSRMLS_CC", ")", ";", "RETURN_FALSE", ";", "}", "/", "*", "canonicalize", "lang_tag", "*", "/", "can_lang_tag", "=", "get_icu_value_internal", "(", "lang_tag", ",", "LOC_CANONICALIZE_TAG", ",", "&", "result", ",", "0", ")", ";", "if", "(", "result", "=", "=", "0", ")", "{", "intl_error_set", "(", "NULL", ",", "status", ",", "intl_error_set", "(", "NULL", ",", "status", ",", "\"", "locale_filter_matches", ":", "unable", "to", "canonicalize", "lang_tag", "\"", ",", "0", "TSRMLS_CC", ")", ";", "RETURN_FALSE", ";", "}", "@", "@", "-", "1306", ",", "11", "+", "1307", ",", "11", "@", "@", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "/", "*", "check", "if", "prefix", "*", "/", "token", "=", "strstr", "(", "cur_lang_tag", ",", "cur_loc_range", ")", ";", "if", "(", "token", "&", "&", "(", "token", "=", "=", "cur_lang_tag", ")", ")", "{", "/", "*", "check", "if", "the", "char", ".", "after", "match", "is", "SEPARATOR", "*", "/", "chrcheck", "=", "token", "+", "(", "strlen", "(", "cur_loc_range", ")", ");", "if", "(", "isIDSeparator", "(", "*", "chrcheck", ")", "|", "|", "isEndOfTag", "(", "*", "chrcheck", ")", ")", "{", "if", "(", "isIDSeparator", "(", "*", "chrcheck", ")", "|", "|", "isEndOfTag", "(", "*", "chrcheck", ")", ")", "{", "if", "(", "cur_lang_tag", ")", "{", "efree", "(", "cur_lang_tag", ")", ";", "}", "@", "@", "-", "1346", ",", "7", "+", "1347", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "else", "{", "/", "*", "Convert", "to", "lower", "case", "for", "case", "-", "insensitive", "comparison", "*", "/", "cur_lang_tag", "=", "ecalloc", "(", "1", ",", "strlen", "(", "lang_tag", ")", "+", "1", ")", ";", "result", "=", "strToMatch", "(", "lang_tag", ",", "cur_lang_tag", ")", ";", "if", "(", "result", "=", "=", "0", ")", "{", "efree", "(", "cur_lang_tag", ")", ";", "@", "@", "-", "1362", ",", "11", "+", "1363", ",", "11", "@", "@", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "/", "*", "check", "if", "prefix", "*", "/", "token", "=", "strstr", "(", "cur_lang_tag", ",", "cur_loc_range", ")", ";", "if", "(", "token", "&", "&", "(", "token", "=", "=", "cur_lang_tag", ")", ")", "{", "/", "*", "check", "if", "the", "char", ".", "after", "match", "is", "SEPARATOR", "*", "/", "chrcheck", "=", "token", "+", "(", "strlen", "(", "cur_loc_range", ")", ");", "if", "(", "isIDSeparator", "(", "*", "chrcheck", ")", "|", "|", "isEndOfTag", "(", "*", "chrcheck", ")", ")", "{", "if", "(", "isIDSeparator", "(", "*", "chrcheck", ")", "|", "|", "isEndOfTag", "(", "*", "chrcheck", ")", ")", "{", "if", "(", "cur_lang_tag", ")", "{", "efree", "(", "cur_lang_tag", ")", ";", "}", "@", "@", "-", "1393", ",", "7", "+", "1394", ",", "7", "@", "@", "PHP_FUNCTION", "(", "locale_filter_matches", ")", "static", "void", "array_cleanup", "(", "char", "*", "arr", "[", "]", ",", "int", "arr_size", ")", "{", "int", "i", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "arr_size", ";", "i", "+", "+", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "arr_size", ";", "i", "+", "+", ")", "{", "if", "(", "arr", "[", "i", "*", "2", "]", ")", "{", "efree", "(", "arr", "[", "i", "*", "2", "]", ");", "}", "@", "@", "-", "1403", ",", "7", "+", "1404", ",", "7", "@", "@", "static", "void", "array_cleanup", "(", "char", "*", "arr", "[", "]", ",", "int", "arr_size", ")", "#", "define", "LOOKUP_CLEAN_RETURN", "(", "value", ")", "array_cleanup", "(", "cur_arr", ",", "cur_arr_len", ")", ";", "return", "(", "value", ")", "/", "*", "{", "{{", "*", "returns", "the", "lookup", "result", "to", "lookup_loc_range_src_php", "*", "returns", "the", "lookup", "result", "to", "lookup_loc_range_src_php", "*", "internal", "function", "*", "/", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "canonicalize", "TSRMLS_DC", ")", "@", "@", "-", "1427", ",", "7", "+", "1428", ",", "7", "@", "@", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "ca", "for", "(", "zend_hash_internal_pointer_reset", "(", "hash_arr", ")", ";", "zend_hash_has_more_elements", "(", "hash_arr", ")", "=", "=", "SUCCESS", ";", "zend_hash_move_forward", "(", "hash_arr", ")", ")", "{", "if", "(", "zend_hash_get_current_data", "(", "hash_arr", ",", "(", "void", "*", "*)", "&", "ele_value", ")", "=", "=", "FAILURE", ")", "{", "/", "*", "Should", "never", "actually", "fail", "since", "the", "key", "is", "known", "to", "exist", ".", "*/", "continue", ";", "@", "@", "-", "1436", ",", "20", "+", "1437", ",", "20", "@", "@", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "ca", "/", "*", "element", "value", "is", "not", "a", "string", "*", "/", "intl_error_set", "(", "NULL", ",", "U_ILLEGAL_ARGUMENT_ERROR", ",", "\"", "lookup_loc_range", ":", "locale", "array", "element", "is", "not", "a", "string", "\"", ",", "0", "TSRMLS_CC", ")", ";", "LOOKUP_CLEAN_RETURN", "(", "NULL", ")", ";", "}", "}", "cur_arr", "[", "cur_arr_len", "*", "2", "]", "=", "estrndup", "(", "Z_STRVAL_PP", "(", "ele_value", ")", ",", "Z_STRLEN_PP", "(", "ele_value", ")", ");", "result", "=", "strToMatch", "(", "Z_STRVAL_PP", "(", "ele_value", ")", ",", "cur_arr", "[", "cur_arr_len", "*", "2", "]", ");", "if", "(", "result", "=", "=", "0", ")", "{", "intl_error_set", "(", "NULL", ",", "U_ILLEGAL_ARGUMENT_ERROR", ",", "\"", "lookup_loc_range", ":", "unable", "to", "canonicalize", "lang_tag", "\"", ",", "0", "TSRMLS_CC", ")", ";", "LOOKUP_CLEAN_RETURN", "(", "NULL", ")", ";", "}", "cur_arr", "[", "cur_arr_len", "*", "2", "+", "1", "]", "=", "Z_STRVAL_PP", "(", "ele_value", ")", ";", "cur_arr_len", "+", "+", ";", "cur_arr_len", "+", "+", ";", "}", "/", "*", "end", "of", "for", "*", "/", "/", "*", "Canonicalize", "array", "elements", "*", "/", "if", "(", "canonicalize", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "cur_arr_len", ";", "i", "+", "+)", "{", "for", "(", "i", "=", "0", ";", "i", "<", "cur_arr_len", ";", "i", "+", "+)", "{", "lang_tag", "=", "get_icu_value_internal", "(", "cur_arr", "[", "i", "*", "2", "]", ",", "LOC_CANONICALIZE_TAG", ",", "&", "result", ",", "0", ")", ";", "if", "(", "result", "!", "=", "1", "|", "|", "lang_tag", "=", "=", "NULL", "|", "|", "!", "lang_tag", "[", "0", "]", ")", "{", "if", "(", "lang_tag", ")", "{", "@", "@", "-", "1459", ",", "7", "+", "1460", ",", "7", "@", "@", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "ca", "LOOKUP_CLEAN_RETURN", "(", "NULL", ")", ";", "}", "cur_arr", "[", "i", "*", "2", "]", "=", "erealloc", "(", "cur_arr", "[", "i", "*", "2", "]", ",", "strlen", "(", "lang_tag", ")", "+", "1", ")", ";", "result", "=", "strToMatch", "(", "lang_tag", ",", "cur_arr", "[", "i", "*", "2", "]", ");", "result", "=", "strToMatch", "(", "lang_tag", ",", "cur_arr", "[", "i", "*", "2", "]", ");", "efree", "(", "lang_tag", ")", ";", "if", "(", "result", "=", "=", "0", ")", "{", "intl_error_set", "(", "NULL", ",", "U_ILLEGAL_ARGUMENT_ERROR", ",", "\"", "lookup_loc_range", ":", "unable", "to", "canonicalize", "lang_tag", "\"", ",", "0", "TSRMLS_CC", ")", ";", "@", "@", "-", "1482", ",", "11", "+", "1483", ",", "11", "@", "@", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "ca", "}", "else", "{", "loc_range", "=", "can_loc_range", ";", "}", "}", "}", "cur_loc_range", "=", "ecalloc", "(", "1", ",", "strlen", "(", "loc_range", ")", "+", "1", ")", ";", "/", "*", "convert", "to", "lower", "and", "replace", "hyphens", "*", "/", "result", "=", "strToMatch", "(", "loc_range", ",", "cur_loc_range", ")", ";", "result", "=", "strToMatch", "(", "loc_range", ",", "cur_loc_range", ")", ";", "if", "(", "can_loc_range", ")", "{", "efree", "(", "can_loc_range", ")", ";", "}", "@", "@", "-", "1498", ",", "8", "+", "1499", ",", "8", "@", "@", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "ca", "/", "*", "Lookup", "for", "the", "lang_tag", "match", "*", "/", "saved_pos", "=", "strlen", "(", "cur_loc_range", ")", ";", "while", "(", "saved_pos", ">", "0", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "cur_arr_len", ";", "i", "+", "+)", "{", "if", "(", "cur_arr", "[", "i", "*", "2", "]", "!", "=", "NULL", "&", "&", "strlen", "(", "cur_arr", "[", "i", "*", "2", "]", ")", "=", "=", "saved_pos", "&", "&", "strncmp", "(", "cur_loc_range", ",", "cur_arr", "[", "i", "*", "2", "]", ",", "saved_pos", ")", "=", "=", "0", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "cur_arr_len", ";", "i", "+", "+)", "{", "if", "(", "cur_arr", "[", "i", "*", "2", "]", "!", "=", "NULL", "&", "&", "strlen", "(", "cur_arr", "[", "i", "*", "2", "]", ")", "=", "=", "saved_pos", "&", "&", "strncmp", "(", "cur_loc_range", ",", "cur_arr", "[", "i", "*", "2", "]", ",", "saved_pos", ")", "=", "=", "0", ")", "{", "/", "*", "Match", "found", "*", "/", "return_value", "=", "estrdup", "(", "canonicalize", "?", "cur_arr", "[", "i", "*", "2", "]", ":", "cur_arr", "[", "i", "*", "2", "+", "1", "]", ");", "efree", "(", "cur_loc_range", ")", ";", "@", "@", "-", "1515", ",", "14", "+", "1516", ",", "14", "@", "@", "static", "char", "*", "lookup_loc_range", "(", "const", "char", "*", "loc_range", ",", "HashTable", "*", "hash_arr", ",", "int", "ca", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "string", "Locale", ":", ":", "lookup", "(", "array", "$", "langtag", ",", "string", "$", "locale", "[", ",", "bool", "$", "canonicalize", "[", ",", "string", "$", "default", "=", "null", "]", "])", "/", "*", "{", "{{", "proto", "string", "Locale", ":", ":", "lookup", "(", "array", "$", "langtag", ",", "string", "$", "locale", "[", ",", "bool", "$", "canonicalize", "[", ",", "string", "$", "default", "=", "null", "]", "])", "*", "Searchs", "the", "items", "in", "$", "langtag", "for", "the", "best", "match", "to", "the", "language", "*", "range", "*", "range", "*", "/", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "string", "locale_lookup", "(", "array", "$", "langtag", ",", "string", "$", "locale", "[", ",", "bool", "$", "canonicalize", "[", ",", "string", "$", "default", "=", "null", "]", "])", "*", "Searchs", "the", "items", "in", "$", "langtag", "for", "the", "best", "match", "to", "the", "language", "*", "range", "*", "range", "*", "/", "PHP_FUNCTION", "(", "locale_lookup", ")", "{", "@", "@", "-", "1552", ",", "8", "+", "1553", ",", "8", "@", "@", "PHP_FUNCTION", "(", "locale_lookup", ")", "if", "(", "!", "hash_arr", "|", "|", "zend_hash_num_elements", "(", "hash_arr", ")", "=", "=", "0", ")", "{", "RETURN_EMPTY_STRING", "(", ");", "}", "}", "result", "=", "lookup_loc_range", "(", "loc_range", ",", "hash_arr", ",", "boolCanonical", "TSRMLS_CC", ")", ";", "if", "(", "result", "=", "=", "NULL", "|", "|", "result", "[", "0", "]", "=", "=", "'", "\\", "0", "'", ")", "{", "if", "(", "fallback_loc", ")", "{", "@", "@", "-", "1590", ",", "10", "+", "1591", ",", "10", "@", "@", "PHP_FUNCTION", "(", "locale_accept_from_http", ")", "\"", "locale_accept_from_http", ":", "unable", "to", "parse", "input", "parameters", "\"", ",", "0", "TSRMLS_CC", ")", ";", "RETURN_FALSE", ";", "}", "available", "=", "ures_openAvailableLocales", "(", "NULL", ",", "&", "status", ")", ";", "INTL_CHECK_STATUS", "(", "status", ",", "\"", "locale_accept_from_http", ":", "failed", "to", "retrieve", "locale", "list", "\"", ");", "len", "=", "uloc_acceptLanguageFromHTTP", "(", "resultLocale", ",", "INTL_MAX_LOCALE_LEN", ",", "len", "=", "uloc_acceptLanguageFromHTTP", "(", "resultLocale", ",", "INTL_MAX_LOCALE_LEN", ",", "&", "outResult", ",", "http_accept", ",", "available", ",", "&", "status", ")", ";", "uenum_close", "(", "available", ")", ";", "INTL_CHECK_STATUS", "(", "status", ",", "\"", "locale_accept_from_http", ":", "failed", "to", "find", "acceptable", "locale", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "14", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72241", ":", "get_icu_value_internal", "out", "-", "of", "-", "bounds", "read", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "intl", "'", ")", ")", "print", "'", "skip", "'", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "var1", "=", "str_repeat", "(", "\"", "A", "\"", ",", "1000", ")", ";", "$", "out", "=", "locale_get_primary_language", "(", "$", "var1", ")", ";", "echo", "strlen", "(", "$", "out", ")", ".", "PHP_EOL", ";", "echo", "unpack", "(", "'", "H", "*", "',", "$", "out", ")", "[", "1", "]", ".", "PHP_EOL", ";", "-", "-", "EXPECT", "-", "-", "1000", "61616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(out-of-bounds", "read", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["Add", "test", "case", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@962871", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "163", "@", "@", "package", "org", ".", "apache", ".", "coyote", ".", "http11", ";", "import", "java", ".", "io", ".", "File", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "SimpleHttpClient", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "Tomcat", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "TomcatBaseTest", ";", "public", "class", "TestAbstractHttp11Processor", "extends", "TomcatBaseTest", "{", "public", "void", "testWithTEVoid", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "void", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "public", "void", "testWithTEBuffered", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "buffered", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "public", "void", "testWithTEIdentity", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "identity", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "\"", "Connection", ":", "close", "\"", "+", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse200", "(", "))", ";", "assertTrue", "(", "client", ".", "getResponseBody", "(", ").", "contains", "(", "\"", "test", "-", "data", "\"", "))", ";", "}", "public", "void", "testWithTESavedRequest", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "savedrequest", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "public", "void", "testWithTEUnsupported", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "unsupported", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "private", "static", "final", "class", "Client", "extends", "SimpleHttpClient", "{", "@", "Override", "public", "boolean", "isResponseBodyOK", "(", ")", "{", "return", "getResponseBody", "(", ").", "contains", "(", "\"", "test", "-", "data", "\"", ");", "}", "}", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "outage", ")", "or", "obtain", "sensitive", "information"]}
{"contents": ["Fix", "potential", "security", "risk", "when", "using", "Spring", "OXM", "Disable", "by", "default", "external", "entity", "resolution", "when", "using", "Spring", "OXM", "with", "jaxb.", "This", "prevents", "a", "XML", "entity", "from", "being", "able", "to", "resolve", "a", "local", "file", "on", "the", "host", "system.", "See:", "https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing", "Issue:", "SPR-10806", "(cherry", "picked", "from", "commit", "7576274)"], "code_tokens": ["@", "@", "-", "224", ",", "7", "+", "224", ",", "9", "@", "@", "protected", "void", "writeToResult", "(", "T", "t", ",", "HttpHeaders", "headers", ",", "Result", "result", ")", "throws", "IOE", "*", "@", "return", "the", "created", "factory", "*", "/", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "return", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_REPLACING_ENTITY_REFERENCES", ",", "false", ")", ";", "return", "inputFactory", ";", "}", "}"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["-", "MFB:", "Fixed", "securities", "issue", "detailed", "in", "and", ".", "(patch", "by", "Christian", "Hoffmann)"], "code_tokens": ["@", "@", "-", "1", ",", "6", "+", "1", ",", "9", "@", "@", "PHP", "NEWS", "|", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "?", "?", "?", "??", "2008", ",", "PHP", "5", ".", "2", ".", "7", "-", "Fixed", "securities", "issue", "detailed", "in", "CVE", "-", "2008", "-", "2665", "and", "CVE", "-", "2008", "-", "2666", ".", "(", "Christian", "Hoffmann", ")", "-", "Reverted", "fix", "for", "bug", "#", "44197", "due", "to", "change", "in", "behaviour", "in", "minor", "version", ".", "(", "Felipe", ")", "@", "@", "-", "73", ",", "14", "+", "73", ",", "6", "@", "@", "PHPAPI", "int", "php_checkuid_ex", "(", "const", "char", "*", "filename", ",", "const", "char", "*", "fopen_mode", ",", "int", "mod", "mode", "=", "CHECKUID_CHECK_FILE_AND_DIR", ";", "}", "}", "/", "*", "*", "If", "given", "filepath", "is", "a", "URL", ",", "allow", "-", "safe", "mode", "stuff", "*", "related", "to", "URL", "'", "s", "is", "checked", "in", "individual", "functions", "*", "/", "wrapper", "=", "php_stream_locate_url_wrapper", "(", "filename", ",", "NULL", ",", "STREAM_LOCATE_WRAPPERS_ONLY", "TSRMLS_CC", ")", ";", "if", "(", "wrapper", "!", "=", "NULL", ")", "return", "1", ";", "/", "*", "First", "we", "see", "if", "the", "file", "is", "owned", "by", "the", "same", "user", ".", "..", "*", "If", "that", "fails", ",", "passthrough", "and", "check", "directory", ".", ".."], "docstring_tokens": ["access", "arbitrary", "files", "outside", "of", "the", "Web", "root", "and", "possibly", "launch", "further", "attacks", "against", "the", "system"]}
{"contents": ["nfsd:", "stricter", "decoding", "of", "write-like", "NFSv2/v3", "ops", "The", "NFSv2/v3", "code", "does", "not", "systematically", "check", "whether", "we", "decode", "past", "the", "end", "of", "the", "buffer.", "This", "generally", "appears", "to", "be", "harmless,", "but", "there", "are", "a", "few", "places", "where", "we", "do", "arithmetic", "on", "the", "pointers", "involved", "and", "don't", "account", "for", "the", "possibility", "that", "a", "length", "could", "be", "negative.", "Add", "checks", "to", "catch", "these.", "Reported-by:", "Tuomas", "Haanp\u00e4\u00e4", "<thaan@synopsys.com>", "Reported-by:", "Ari", "Kauppi", "<ari@synopsys.com>", "Reviewed-by:", "NeilBrown", "<neilb@suse.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "J.", "Bruce", "Fields", "<bfields@redhat.com>"], "code_tokens": ["@", "@", "-", "369", ",", "6", "+", "369", ",", "8", "@", "@", "nfs3svc_decode_writeargs", "(", "struct", "svc_rqst", "*", "rqstp", ",", "__be32", "*", "p", ",", "args", "-", ">", "count", "=", "ntohl", "(", "*", "p", "+", "+)", ";", "args", "-", ">", "stable", "=", "ntohl", "(", "*", "p", "+", "+)", ";", "len", "=", "args", "-", ">", "len", "=", "ntohl", "(", "*", "p", "+", "+)", ";", "if", "(", "(", "void", "*", ")", "p", ">", "head", "-", ">", "iov_base", "+", "head", "-", ">", "iov_len", ")", "return", "0", ";", "/", "*", "*", "The", "count", "must", "equal", "the", "amount", "of", "data", "passed", ".", "*", "/", "@", "@", "-", "472", ",", "6", "+", "474", ",", "8", "@", "@", "nfs3svc_decode_symlinkargs", "(", "struct", "svc_rqst", "*", "rqstp", ",", "__be32", "*", "p", ",", "/", "*", "first", "copy", "and", "check", "from", "the", "first", "page", "*", "/", "old", "=", "(", "char", "*", ")", "p", ";", "vec", "=", "&", "rqstp", "-", ">", "rq_arg", ".", "head", "[", "0", "]", ";", "if", "(", "(", "void", "*", ")", "old", ">", "vec", "-", ">", "iov_base", "+", "vec", "-", ">", "iov_len", ")", "return", "0", ";", "avail", "=", "vec", "-", ">", "iov_len", "-", "(", "old", "-", "(", "char", "*", ")", "vec", "-", ">", "iov_base", ")", ";", "while", "(", "len", "&", "&", "avail", "&", "&", "*", "old", ")", "{", "*", "new", "+", "+", "=", "*", "old", "+", "+;", "@", "@", "-", "302", ",", "6", "+", "302", ",", "8", "@", "@", "nfssvc_decode_writeargs", "(", "struct", "svc_rqst", "*", "rqstp", ",", "__be32", "*", "p", ",", "*", "bytes", ".", "*", "/", "hdr", "=", "(", "void", "*", ")", "p", "-", "head", "-", ">", "iov_base", ";", "if", "(", "hdr", ">", "head", "-", ">", "iov_len", ")", "return", "0", ";", "dlen", "=", "head", "-", ">", "iov_len", "+", "rqstp", "-", ">", "rq_arg", ".", "page_len", "-", "hdr", ";", "/", "*"], "docstring_tokens": ["trigger", "pointer-arithmetic", "errors", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["igmp:", "Avoid", "zero", "delay", "when", "receiving", "odd", "mixture", "of", "IGMP", "queries", "Commit", "5b7c84066733c5dfb0e4016d939757b38de189e4", "('ipv4:", "correct", "IGMP", "behavior", "on", "v3", "query", "during", "v2-compatibility", "mode')", "added", "yet", "another", "case", "for", "query", "parsing,", "which", "can", "result", "in", "max_delay", "=", "0.", "Substitute", "a", "value", "of", "1,", "as", "in", "the", "usual", "v3", "case.", "Reported-by:", "Simon", "McVittie", "<smcv@debian.org>", "References:", "http://bugs.debian.org/654876", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "880", ",", "6", "+", "880", ",", "8", "@", "@", "static", "void", "igmp_heard_query", "(", "struct", "in_device", "*", "in_dev", ",", "struct", "sk_buff", "*", "skb", ",", "*", "to", "be", "intended", "in", "a", "v3", "query", ".", "*", "/", "max_delay", "=", "IGMPV3_MRC", "(", "ih3", "-", ">", "code", ")", "*(", "HZ", "/", "IGMP_TIMER_SCALE", ")", ";", "if", "(", "!", "max_delay", ")", "max_delay", "=", "1", ";", "/", "*", "can", "'", "t", "mod", "w", "/", "0", "*", "/", "}", "else", "{", "/", "*", "v3", "*", "/", "if", "(", "!", "pskb_may_pull", "(", "skb", ",", "sizeof", "(", "struct", "igmpv3_query", ")", "))", "return", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(divide-by-zero", "error", "and", "panic", ")"]}
{"contents": ["flow_dissector:", "Jump", "to", "exit", "code", "in", "__skb_flow_dissect", "Instead", "of", "returning", "immediately", "(on", "a", "parsing", "failure", "for", "instance)", "we", "jump", "to", "cleanup", "code.", "This", "always", "sets", "protocol", "values", "in", "key_control", "(even", "on", "a", "failure", "there", "is", "still", "valid", "information", "in", "the", "key_tags", "that", "was", "set", "before", "the", "problem", "was", "hit).", "Signed-off-by:", "Tom", "Herbert", "<tom@herbertland.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "130", ",", "6", "+", "130", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "struct", "flow_dissector_key_tags", "*", "key_tags", ";", "struct", "flow_dissector_key_keyid", "*", "key_keyid", ";", "u8", "ip_proto", "=", "0", ";", "bool", "ret", "=", "false", ";", "if", "(", "!", "data", ")", "{", "data", "=", "skb", "-", ">", "data", ";", "@", "@", "-", "171", ",", "7", "+", "172", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "ip", ":", "iph", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_iph", ")", ",", "data", ",", "hlen", ",", "&", "_iph", ")", ";", "if", "(", "!", "iph", "|", "|", "iph", "-", ">", "ihl", "<", "5", ")", "return", "false", ";", "goto", "out_bad", ";", "nhoff", "+", "=", "iph", "-", ">", "ihl", "*", "4", ";", "ip_proto", "=", "iph", "-", ">", "protocol", ";", "@", "@", "-", "197", ",", "7", "+", "198", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "ipv6", ":", "iph", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_iph", ")", ",", "data", ",", "hlen", ",", "&", "_iph", ")", ";", "if", "(", "!", "iph", ")", "return", "false", ";", "goto", "out_bad", ";", "ip_proto", "=", "iph", "-", ">", "nexthdr", ";", "nhoff", "+", "=", "sizeof", "(", "struct", "ipv6hdr", ")", ";", "@", "@", "-", "234", ",", "7", "+", "235", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "vlan", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_vlan", ")", ",", "data", ",", "hlen", ",", "&", "_vlan", ")", ";", "if", "(", "!", "vlan", ")", "return", "false", ";", "goto", "out_bad", ";", "if", "(", "skb_flow_dissector_uses_key", "(", "flow_dissector", ",", "FLOW_DISSECTOR_KEY_VLANID", ")", ")", "{", "@", "@", "-", "256", ",", "7", "+", "257", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "}", "*", "hdr", ",", "_hdr", ";", "hdr", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_hdr", ")", ",", "data", ",", "hlen", ",", "&", "_hdr", ")", ";", "if", "(", "!", "hdr", ")", "return", "false", ";", "goto", "out_bad", ";", "proto", "=", "hdr", "-", ">", "proto", ";", "nhoff", "+", "=", "PPPOE_SES_HLEN", ";", "switch", "(", "proto", ")", "{", "@", "@", "-", "265", ",", "7", "+", "266", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "case", "htons", "(", "PPP_IPV6", ")", ":", "goto", "ipv6", ";", "default", ":", "return", "false", ";", "goto", "out_bad", ";", "}", "}", "case", "htons", "(", "ETH_P_TIPC", ")", ":", "{", "@", "@", "-", "275", ",", "9", "+", "276", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "}", "*", "hdr", ",", "_hdr", ";", "hdr", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_hdr", ")", ",", "data", ",", "hlen", ",", "&", "_hdr", ")", ";", "if", "(", "!", "hdr", ")", "return", "false", ";", "key_basic", "-", ">", "n_proto", "=", "proto", ";", "key_control", "-", ">", "thoff", "=", "(", "u16", ")", "nhoff", ";", "goto", "out_bad", ";", "if", "(", "skb_flow_dissector_uses_key", "(", "flow_dissector", ",", "FLOW_DISSECTOR_KEY_TIPC_ADDRS", ")", ")", "{", "@", "@", "-", "287", ",", "7", "+", "286", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "key_addrs", "-", ">", "tipcaddrs", ".", "srcnode", "=", "hdr", "-", ">", "srcnode", ";", "key_control", "-", ">", "addr_type", "=", "FLOW_DISSECTOR_KEY_TIPC_ADDRS", ";", "}", "return", "true", ";", "goto", "out_good", ";", "}", "case", "htons", "(", "ETH_P_MPLS_UC", ")", ":", "@", "@", "-", "297", ",", "7", "+", "296", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "hdr", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_hdr", ")", ",", "data", ",", "hlen", ",", "&", "_hdr", ")", ";", "if", "(", "!", "hdr", ")", "return", "false", ";", "goto", "out_bad", ";", "if", "(", "(", "ntohl", "(", "hdr", "[", "0", "]", ".", "entry", ")", "&", "MPLS_LS_LABEL_MASK", ")", ">", ">", "MPLS_LS_LABEL_SHIFT", "=", "=", "MPLS_LABEL_ENTROPY", ")", "{", "@", "@", "-", "310", ",", "21", "+", "309", ",", "17", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "htonl", "(", "MPLS_LS_LABEL_MASK", ")", ";", "}", "key_basic", "-", ">", "n_proto", "=", "proto", ";", "key_basic", "-", ">", "ip_proto", "=", "ip_proto", ";", "key_control", "-", ">", "thoff", "=", "(", "u16", ")", "nhoff", ";", "return", "true", ";", "goto", "out_good", ";", "}", "return", "true", ";", "goto", "out_good", ";", "}", "case", "htons", "(", "ETH_P_FCOE", ")", ":", "key_control", "-", ">", "thoff", "=", "(", "u16", ")", "(", "nhoff", "+", "FCOE_HEADER_LEN", ")", ";", "/", "*", "fall", "through", "*", "/", "default", ":", "return", "false", ";", "goto", "out_bad", ";", "}", "ip_proto_again", ":", "@", "@", "-", "337", ",", "7", "+", "332", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "hdr", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_hdr", ")", ",", "data", ",", "hlen", ",", "&", "_hdr", ")", ";", "if", "(", "!", "hdr", ")", "return", "false", ";", "goto", "out_bad", ";", "/", "*", "*", "Only", "look", "inside", "GRE", "if", "version", "zero", "and", "no", "*", "routing", "@", "@", "-", "357", ",", "7", "+", "352", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "data", ",", "hlen", ",", "&", "_keyid", ")", ";", "if", "(", "!", "keyid", ")", "return", "false", ";", "goto", "out_bad", ";", "if", "(", "skb_flow_dissector_uses_key", "(", "flow_dissector", ",", "FLOW_DISSECTOR_KEY_GRE_KEYID", ")", ")", "{", "@", "@", "-", "378", ",", "7", "+", "373", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "sizeof", "(", "_eth", ")", ",", "data", ",", "hlen", ",", "&", "_eth", ")", ";", "if", "(", "!", "eth", ")", "return", "false", ";", "goto", "out_bad", ";", "proto", "=", "eth", "-", ">", "h_proto", ";", "nhoff", "+", "=", "sizeof", "(", "*", "eth", ")", ";", "}", "@", "@", "-", "395", ",", "7", "+", "390", ",", "7", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "opthdr", "=", "__skb_header_pointer", "(", "skb", ",", "nhoff", ",", "sizeof", "(", "_opthdr", ")", ",", "data", ",", "hlen", ",", "&", "_opthdr", ")", ";", "if", "(", "!", "opthdr", ")", "return", "false", ";", "goto", "out_bad", ";", "ip_proto", "=", "opthdr", "[", "0", "]", ";", "nhoff", "+", "=", "(", "opthdr", "[", "1", "]", "+", "1", ")", "<", "<", "3", ";", "@", "@", "-", "415", ",", "10", "+", "410", ",", "6", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "break", ";", "}", "key_basic", "-", ">", "n_proto", "=", "proto", ";", "key_basic", "-", ">", "ip_proto", "=", "ip_proto", ";", "key_control", "-", ">", "thoff", "=", "(", "u16", ")", "nhoff", ";", "if", "(", "skb_flow_dissector_uses_key", "(", "flow_dissector", ",", "FLOW_DISSECTOR_KEY_PORTS", ")", ")", "{", "key_ports", "=", "skb_flow_dissector_target", "(", "flow_dissector", ",", "@", "@", "-", "428", ",", "7", "+", "419", ",", "15", "@", "@", "bool", "__skb_flow_dissect", "(", "const", "struct", "sk_buff", "*", "skb", ",", "data", ",", "hlen", ")", ";", "}", "return", "true", ";", "out_good", ":", "ret", "=", "true", ";", "out_bad", ":", "key_basic", "-", ">", "n_proto", "=", "proto", ";", "key_basic", "-", ">", "ip_proto", "=", "ip_proto", ";", "key_control", "-", ">", "thoff", "=", "(", "u16", ")", "nhoff", ";", "return", "ret", ";", "}", "EXPORT_SYMBOL", "(", "__skb_flow_dissect", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", ")", "or", "possibly", "execute", "arbitrary", "code"]}
{"contents": ["Get", "rid", "of", "open-coding", "in", "ia64_brk()", "The", "comment", "in", "there", "used", "to", "be", "true,", "but", "these", "days", "do_brk()", "does", "the", "arch-specific", "check", "that", "covers", "what", "we", "open-coded", "here.", "So", "we", "can", "use", "sys_brk()", "just", "fine,", "only", "need", "to", "do", "force_successful_syscall_return()", "after", "it.", "See", "commit", "3a459756810912d2c2bf188cef566af255936b4d", "-", "that's", "when", "the", "checks", "in", "do_brk()", "had", "been", "originally", "added.", "Acked-by:", "Hugh", "Dickins", "<hugh.dickins@tiscali.co.uk>", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["@", "@", "-", "100", ",", "51", "+", "100", ",", "7", "@", "@", "sys_getpagesize", "(", "void", ")", "asmlinkage", "unsigned", "long", "ia64_brk", "(", "unsigned", "long", "brk", ")", "{", "unsigned", "long", "rlim", ",", "retval", ",", "newbrk", ",", "oldbrk", ";", "struct", "mm_struct", "*", "mm", "=", "current", "-", ">", "mm", ";", "/", "*", "*", "Most", "of", "this", "replicates", "the", "code", "in", "sys_brk", "(", ")", "except", "for", "an", "additional", "safety", "*", "check", "and", "the", "clearing", "of", "r8", ".", "However", ",", "we", "can", "'", "t", "call", "sys_brk", "(", ")", "because", "we", "need", "*", "to", "acquire", "the", "mmap_sem", "before", "we", "can", "do", "the", "test", ".", "..", "*", "/", "down_write", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "if", "(", "brk", "<", "mm", "-", ">", "end_code", ")", "goto", "out", ";", "newbrk", "=", "PAGE_ALIGN", "(", "brk", ")", ";", "oldbrk", "=", "PAGE_ALIGN", "(", "mm", "-", ">", "brk", ")", ";", "if", "(", "oldbrk", "=", "=", "newbrk", ")", "goto", "set_brk", ";", "/", "*", "Always", "allow", "shrinking", "brk", ".", "*", "/", "if", "(", "brk", "<", "=", "mm", "-", ">", "brk", ")", "{", "if", "(", "!", "do_munmap", "(", "mm", ",", "newbrk", ",", "oldbrk", "-", "newbrk", ")", ")", "goto", "set_brk", ";", "goto", "out", ";", "}", "/", "*", "Check", "against", "unimplemented", "/", "unmapped", "addresses", ":", "*", "/", "if", "(", "(", "newbrk", "-", "oldbrk", ")", ">", "RGN_MAP_LIMIT", "|", "|", "REGION_OFFSET", "(", "newbrk", ")", ">", "RGN_MAP_LIMIT", ")", "goto", "out", ";", "/", "*", "Check", "against", "rlimit", ".", ".", "*", "/", "rlim", "=", "current", "-", ">", "signal", "-", ">", "rlim", "[", "RLIMIT_DATA", "]", ".", "rlim_cur", ";", "if", "(", "rlim", "<", "RLIM_INFINITY", "&", "&", "brk", "-", "mm", "-", ">", "start_data", ">", "rlim", ")", "goto", "out", ";", "/", "*", "Check", "against", "existing", "mmap", "mappings", ".", "*", "/", "if", "(", "find_vma_intersection", "(", "mm", ",", "oldbrk", ",", "newbrk", "+", "PAGE_SIZE", ")", ")", "goto", "out", ";", "/", "*", "Ok", ",", "looks", "good", "-", "let", "it", "rip", ".", "*", "/", "if", "(", "do_brk", "(", "oldbrk", ",", "newbrk", "-", "oldbrk", ")", "!", "=", "oldbrk", ")", "goto", "out", ";", "set_brk", ":", "mm", "-", ">", "brk", "=", "brk", ";", "out", ":", "retval", "=", "mm", "-", ">", "brk", ";", "up_write", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "unsigned", "long", "retval", "=", "sys_brk", "(", "brk", ")", ";", "force_successful_syscall_return", "(", ");", "return", "retval", ";", "}"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["#1256", "no", "need", "for", "replace,", "just", "check", "for", "\"/..\"", "in", "path"], "code_tokens": ["@", "@", "-", "390", ",", "6", "+", "390", ",", "15", "@", "@", "public", "void", "getStaticFilePathOperationVulnerability2", "(", ")", "throws", "Exception", "{", "}", "}", "@", "Test", "public", "void", "getStaticFilePathOperationVulnerability3", "(", ")", "throws", "Exception", "{", "HttpGet", "request", "=", "new", "HttpGet", "(", "httpsAdminServerUrl", ".", "replace", "(", "\"", "admin", "\"", ",", "\"", "static", "/", "/.", "..", "//", "..", "./", "/.", "..", "//", "..", "./", "/.", "..", "//", "..", "./", "/.", "..", "//", "..", "./", "/.", "..", "/", "etc", "/", "passwd", "\"", "))", ";", "try", "(", "CloseableHttpResponse", "response", "=", "httpclient", ".", "execute", "(", "request", ")", ")", "{", "assertEquals", "(", "404", ",", "response", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "}", "}", "@", "Test", "public", "void", "testGetFavIconHttp", "(", ")", "throws", "Exception", "{", "HttpGet", "request", "=", "new", "HttpGet", "(", "httpServerUrl", "+", "\"", "favicon", ".", "ico", "\"", ");", "@", "@", "-", "186", ",", "7", "+", "186", ",", "10", "@", "@", "private", "void", "serveStatic", "(", "ChannelHandlerContext", "ctx", ",", "FullHttpRequest", "request", ",", "Sta", "Path", "path", ";", "String", "uri", "=", "request", ".", "uri", "(", ");", "uri", "=", "uri", ".", "replace", "(", "\"/", ".\"", ",", "\"", "\")", ";", "if", "(", "uri", ".", "contains", "(", "\"/", "..", "\")", ")", "{", "sendError", "(", "ctx", ",", "NOT_FOUND", ")", ";", "return", ";", "}", "/", "/", "running", "from", "jar", "if", "(", "isUnpacked", ")", "{", "log", ".", "trace", "(", "\"", "Is", "unpacked", ".", "\")", ";"], "docstring_tokens": ["view", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["WW-4063", "Skipping", "unneeded", "translation", "for", "included", "parameters", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/branches/STRUTS_2_3_14_X@1486076", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "241", ",", "47", "+", "241", ",", "45", "@", "@", "public", "void", "buildParametersString", "(", "Map", "<", "String", ",", "Object", ">", "params", ",", "StringBuilder", "link", "private", "String", "buildParameterSubstring", "(", "String", "name", ",", "String", "value", ")", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "translateAndEncode", "(", "name", ")", ");", "builder", ".", "append", "(", "encode", "(", "name", ")", ");", "builder", ".", "append", "(", "'=", "')", ";", "builder", ".", "append", "(", "translateAndEncode", "(", "value", ")", ");", "builder", ".", "append", "(", "encode", "(", "value", ")", ");", "return", "builder", ".", "toString", "(", ");", "}", "/", "**", "*", "Translates", "any", "script", "expressions", "using", "{", "@", "link", "com", ".", "opensymphony", ".", "xwork2", ".", "util", ".", "TextParseUtil", "#", "translateVariables", "}", "and", "*", "encodes", "the", "URL", "using", "{", "@", "link", "java", ".", "net", ".", "URLEncoder", "#", "encode", "}", "with", "the", "encoding", "specified", "in", "the", "configuration", ".", "*", "*", "@", "param", "input", "*", "@", "return", "the", "translated", "and", "encoded", "string", "*", "/", "public", "String", "translateAndEncode", "(", "String", "input", ")", "{", "String", "translatedInput", "=", "translateVariable", "(", "input", ")", ";", "try", "{", "return", "URLEncoder", ".", "encode", "(", "translatedInput", ",", "encoding", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "if", "(", "LOG", ".", "isWarnEnabled", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "Could", "not", "encode", "URL", "parameter", "'", "#", "0", "'", ",", "returning", "value", "un", "-", "encoded", "\"", ",", "input", ")", ";", "}", "return", "translatedInput", ";", "}", "}", "public", "String", "translateAndDecode", "(", "String", "input", ")", "{", "String", "translatedInput", "=", "translateVariable", "(", "input", ")", ";", "try", "{", "return", "URLDecoder", ".", "decode", "(", "translatedInput", ",", "encoding", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "if", "(", "LOG", ".", "isWarnEnabled", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "Could", "not", "encode", "URL", "parameter", "'", "#", "0", "'", ",", "returning", "value", "un", "-", "encoded", "\"", ",", "input", ")", ";", "}", "return", "translatedInput", ";", "}", "}", "private", "String", "translateVariable", "(", "String", "input", ")", "{", "ValueStack", "valueStack", "=", "ServletActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ");", "return", "TextParseUtil", ".", "translateVariables", "(", "input", ",", "valueStack", ")", ";", "}", "/", "**", "*", "Encodes", "the", "URL", "using", "{", "@", "link", "java", ".", "net", ".", "URLEncoder", "#", "encode", "}", "with", "the", "encoding", "specified", "in", "the", "configuration", ".", "*", "*", "@", "param", "input", "the", "input", "to", "encode", "*", "@", "return", "the", "encoded", "string", "*", "/", "public", "String", "encode", "(", "String", "input", ")", "{", "try", "{", "return", "URLEncoder", ".", "encode", "(", "input", ",", "encoding", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "if", "(", "LOG", ".", "isWarnEnabled", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "Could", "not", "encode", "URL", "parameter", "'", "#", "0", "'", ",", "returning", "value", "un", "-", "encoded", "\"", ",", "input", ")", ";", "}", "return", "input", ";", "}", "}", "/", "**", "*", "Decodes", "the", "URL", "using", "{", "@", "link", "java", ".", "net", ".", "URLDecoder", "#", "decode", "(", "String", ",", "String", ")", "}", "with", "the", "encoding", "specified", "in", "the", "configuration", ".", "*", "*", "@", "param", "input", "the", "input", "to", "decode", "*", "@", "return", "the", "encoded", "string", "*", "/", "public", "String", "decode", "(", "String", "input", ")", "{", "try", "{", "return", "URLDecoder", ".", "decode", "(", "input", ",", "encoding", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "if", "(", "LOG", ".", "isWarnEnabled", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "Could", "not", "decode", "URL", "parameter", "'", "#", "0", "'", ",", "returning", "value", "un", "-", "decoded", "\"", ",", "input", ")", ";", "}", "return", "input", ";", "}", "}", "public", "Map", "<", "String", ",", "Object", ">", "parseQueryString", "(", "String", "queryString", ",", "boolean", "forceValueArray", ")", "{", "Map", "<", "String", ",", "Object", ">", "queryParams", "=", "new", "LinkedHashMap", "<", "String", ",", "Object", ">", "()", ";", "@", "@", "-", "299", ",", "8", "+", "297", ",", "8", "@", "@", "private", "String", "translateVariable", "(", "String", "input", ")", "{", "paramValue", "=", "tmpParams", "[", "1", "]", ";", "}", "if", "(", "paramName", "!", "=", "null", ")", "{", "paramName", "=", "translateAndDecode", "(", "paramName", ")", ";", "String", "translatedParamValue", "=", "translateAndDecode", "(", "paramValue", ")", ";", "paramName", "=", "decode", "(", "paramName", ")", ";", "String", "translatedParamValue", "=", "decode", "(", "paramValue", ")", ";", "if", "(", "queryParams", ".", "containsKey", "(", "paramName", ")", "|", "|", "forceValueArray", ")", "{", "/", "/", "WW", "-", "1619", "append", "new", "param", "value", "to", "existing", "value", "(", "s", ")"], "docstring_tokens": ["modify", "server-side", "objects", "and", "inject", "and", "execute", "arbitrary", "commands", "on", "the", "system"]}
{"contents": ["crypto:", "hmac", "-", "require", "that", "the", "underlying", "hash", "algorithm", "is", "unkeyed", "Because", "the", "HMAC", "template", "didn't", "check", "that", "its", "underlying", "hash", "algorithm", "is", "unkeyed,", "trying", "to", "use", "\"hmac(hmac(sha3-512-generic))\"", "through", "AF_ALG", "or", "through", "KEYCTL_DH_COMPUTE", "resulted", "in", "the", "inner", "HMAC", "being", "used", "without", "having", "been", "keyed,", "resulting", "in", "sha3_update()", "being", "called", "without", "sha3_init(),", "causing", "a", "stack", "buffer", "overflow.", "This", "is", "a", "very", "old", "bug,", "but", "it", "seems", "to", "have", "only", "started", "causing", "real", "problems", "when", "SHA-3", "support", "was", "added", "(requires", "CONFIG_CRYPTO_SHA3)", "because", "the", "innermost", "hash's", "state", "is", "->import()ed", "from", "a", "zeroed", "buffer,", "and", "it", "just", "so", "happens", "that", "other", "hash", "algorithms", "are", "fine", "with", "that,", "but", "SHA-3", "is", "not.", "However,", "there", "could", "be", "arch", "or", "hardware-dependent", "hash", "algorithms", "also", "affected;", "I", "couldn't", "test", "everything.", "Fix", "the", "bug", "by", "introducing", "a", "function", "crypto_shash_alg_has_setkey()", "which", "tests", "whether", "a", "shash", "algorithm", "is", "keyed.", "Then", "update", "the", "HMAC", "template", "to", "require", "that", "its", "underlying", "hash", "algorithm", "is", "unkeyed.", "Here", "is", "a", "reproducer:", "#include", "<linux/if_alg.h>", "#include", "<sys/socket.h>", "int", "main()", "{", "int", "algfd;", "struct", "sockaddr_alg", "addr", "=", "{", ".salg_type", "=", "\"hash\",", ".salg_name", "=", "\"hmac(hmac(sha3-512-generic))\",", "};", "char", "key[4096]", "=", "{", "0", "};", "algfd", "=", "socket(AF_ALG,", "SOCK_SEQPACKET,", "0);", "bind(algfd,", "(const", "struct", "sockaddr", "*)&addr,", "sizeof(addr));", "setsockopt(algfd,", "SOL_ALG,", "ALG_SET_KEY,", "key,", "sizeof(key));", "}", "Here", "was", "the", "KASAN", "report", "from", "syzbot:", "BUG:", "KASAN:", "stack-out-of-bounds", "in", "memcpy", "include/linux/string.h:341", "[inline]", "BUG:", "KASAN:", "stack-out-of-bounds", "in", "sha3_update+0xdf/0x2e0", "crypto/sha3_generic.c:161", "Write", "of", "size", "4096", "at", "addr", "ffff8801cca07c40", "by", "task", "syzkaller076574/3044", "CPU:", "1", "PID:", "3044", "Comm:", "syzkaller076574", "Not", "tainted", "4.14.0-mm1+", "#25", "Hardware", "name:", "Google", "Google", "Compute", "Engine/Google", "Compute", "Engine,", "BIOS", "Google", "01/01/2011", "Call", "Trace:", "__dump_stack", "lib/dump_stack.c:17", "[inline]", "dump_stack+0x194/0x257", "lib/dump_stack.c:53", "print_address_description+0x73/0x250", "mm/kasan/report.c:252", "kasan_report_error", "mm/kasan/report.c:351", "[inline]", "kasan_report+0x25b/0x340", "mm/kasan/report.c:409", "check_memory_region_inline", "mm/kasan/kasan.c:260", "[inline]", "check_memory_region+0x137/0x190", "mm/kasan/kasan.c:267", "memcpy+0x37/0x50", "mm/kasan/kasan.c:303", "memcpy", "include/linux/string.h:341", "[inline]", "sha3_update+0xdf/0x2e0", "crypto/sha3_generic.c:161", "crypto_shash_update+0xcb/0x220", "crypto/shash.c:109", "shash_finup_unaligned+0x2a/0x60", "crypto/shash.c:151", "crypto_shash_finup+0xc4/0x120", "crypto/shash.c:165", "hmac_finup+0x182/0x330", "crypto/hmac.c:152", "crypto_shash_finup+0xc4/0x120", "crypto/shash.c:165", "shash_digest_unaligned+0x9e/0xd0", "crypto/shash.c:172", "crypto_shash_digest+0xc4/0x120", "crypto/shash.c:186", "hmac_setkey+0x36a/0x690", "crypto/hmac.c:66", "crypto_shash_setkey+0xad/0x190", "crypto/shash.c:64", "shash_async_setkey+0x47/0x60", "crypto/shash.c:207", "crypto_ahash_setkey+0xaf/0x180", "crypto/ahash.c:200", "hash_setkey+0x40/0x90", "crypto/algif_hash.c:446", "alg_setkey", "crypto/af_alg.c:221", "[inline]", "alg_setsockopt+0x2a1/0x350", "crypto/af_alg.c:254", "SYSC_setsockopt", "net/socket.c:1851", "[inline]", "SyS_setsockopt+0x189/0x360", "net/socket.c:1830", "entry_SYSCALL_64_fastpath+0x1f/0x96", "Reported-by:", "syzbot", "<syzkaller@googlegroups.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>"], "code_tokens": ["@", "@", "-", "195", ",", "11", "+", "195", ",", "15", "@", "@", "static", "int", "hmac_create", "(", "struct", "crypto_template", "*", "tmpl", ",", "struct", "rtattr", "*", "*", "tb", ")", "salg", "=", "shash_attr_alg", "(", "tb", "[", "1", "]", ",", "0", ",", "0", ")", ";", "if", "(", "IS_ERR", "(", "salg", ")", ")", "return", "PTR_ERR", "(", "salg", ")", ";", "alg", "=", "&", "salg", "-", ">", "base", ";", "/", "*", "The", "underlying", "hash", "algorithm", "must", "be", "unkeyed", "*", "/", "err", "=", "-", "EINVAL", ";", "if", "(", "crypto_shash_alg_has_setkey", "(", "salg", ")", ")", "goto", "out_put_alg", ";", "ds", "=", "salg", "-", ">", "digestsize", ";", "ss", "=", "salg", "-", ">", "statesize", ";", "alg", "=", "&", "salg", "-", ">", "base", ";", "if", "(", "ds", ">", "alg", "-", ">", "cra_blocksize", "|", "|", "ss", "<", "alg", "-", ">", "cra_blocksize", ")", "goto", "out_put_alg", ";", "@", "@", "-", "25", ",", "11", "+", "25", ",", "12", "@", "@", "static", "const", "struct", "crypto_type", "crypto_shash_type", ";", "static", "int", "shash_no_setkey", "(", "struct", "crypto_shash", "*", "tfm", ",", "const", "u8", "*", "key", ",", "unsigned", "int", "keylen", ")", "int", "shash_no_setkey", "(", "struct", "crypto_shash", "*", "tfm", ",", "const", "u8", "*", "key", ",", "unsigned", "int", "keylen", ")", "{", "return", "-", "ENOSYS", ";", "}", "EXPORT_SYMBOL_GPL", "(", "shash_no_setkey", ")", ";", "static", "int", "shash_setkey_unaligned", "(", "struct", "crypto_shash", "*", "tfm", ",", "const", "u8", "*", "key", ",", "unsigned", "int", "keylen", ")", "@", "@", "-", "82", ",", "6", "+", "82", ",", "14", "@", "@", "int", "ahash_register_instance", "(", "struct", "crypto_template", "*", "tmpl", ",", "struct", "ahash_instance", "*", "inst", ")", ";", "void", "ahash_free_instance", "(", "struct", "crypto_instance", "*", "inst", ")", ";", "int", "shash_no_setkey", "(", "struct", "crypto_shash", "*", "tfm", ",", "const", "u8", "*", "key", ",", "unsigned", "int", "keylen", ")", ";", "static", "inline", "bool", "crypto_shash_alg_has_setkey", "(", "struct", "shash_alg", "*", "alg", ")", "{", "return", "alg", "-", ">", "setkey", "!", "=", "shash_no_setkey", ";", "}", "int", "crypto_init_ahash_spawn", "(", "struct", "crypto_ahash_spawn", "*", "spawn", ",", "struct", "hash_alg_common", "*", "alg", ",", "struct", "crypto_instance", "*", "inst", ")", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["61295", "--", "prevent", "potential", "oom", "in", "HPSF", "triggered", "by", "fuzzed", "file", "git-svn-id:", "https://svn.apache.org/repos/asf/poi/trunk@1802879", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "16", ",", "6", "+", "16", ",", "9", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "*", "/", "package", "org", ".", "apache", ".", "poi", ".", "hpsf", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "Internal", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "LittleEndianByteArrayInputStream", ";", "@", "@", "-", "40", ",", "8", "+", "43", ",", "11", "@", "@", "void", "read", "(", "LittleEndianByteArrayInputStream", "lei", ")", "{", "}", "final", "int", "length", "=", "(", "int", ")", "longLength", ";", "_values", "=", "new", "TypedPropertyValue", "[", "length", "]", ";", "/", "/", "BUG", "-", "61295", "-", "-", "avoid", "OOM", "on", "corrupt", "file", ".", "Build", "list", "instead", "/", "/", "of", "allocating", "array", "of", "length", "\"", "length", "\"", ".", "/", "/", "If", "the", "length", "is", "corrupted", "and", "crazily", "big", "but", "<", "Integer", ".", "MAX_VALUE", ",", "/", "/", "this", "will", "trigger", "a", "RuntimeException", "\"", "Buffer", "overrun", "\"", "in", "lei", ".", "checkPosition", "List", "<", "TypedPropertyValue", ">", "values", "=", "new", "ArrayList", "<", "TypedPropertyValue", ">", "()", ";", "int", "paddedType", "=", "(", "_type", "=", "=", "Variant", ".", "VT_VARIANT", ")", "?", "0", ":", "_type", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "length", ";", "i", "+", "+", ")", "{", "TypedPropertyValue", "value", "=", "new", "TypedPropertyValue", "(", "paddedType", ",", "null", ")", ";", "@", "@", "-", "50", ",", "8", "+", "56", ",", "9", "@", "@", "void", "read", "(", "LittleEndianByteArrayInputStream", "lei", ")", "{", "}", "else", "{", "value", ".", "readValue", "(", "lei", ")", ";", "}", "_values", "[", "i", "]", "=", "value", ";", "values", ".", "add", "(", "value", ")", ";", "}", "_values", "=", "values", ".", "toArray", "(", "new", "TypedPropertyValue", "[", "values", ".", "size", "(", ")]", ");", "}", "TypedPropertyValue", "[", "]", "getValues", "(", "){"], "docstring_tokens": ["the", "application", "to", "enter", "into", "an", "infinite", "loop", "or", "an", "out", "of", "memory", "exception"]}
{"contents": ["WW-4834", "fixed", "faulty", "regex"], "code_tokens": ["@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "\"", "@)", "?#", "?\"", "+", "\"", "(?", ":(", "?:", "(?", ":[", "a", "-", "z0", "-", "9", "]", "(?", ":[", "a", "-", "z0", "-", "9", "-", "]*", "[", "a", "-", "z0", "-", "9", "]", ")?", "\\\\", ".)", "*\"", "+", "\"", "[", "a", "-", "z", "]", "[", "a", "-", "z0", "-", "9", "-", "]*", "[", "a", "-", "z0", "-", "9", "]", "\"", "+", "\"", "|(", "?:", "[", "1", "-", "9", "]", "?\\", "\\", "d", "|", "1", "\\", "\\", "d", "{", "2", "}", "|", "2", "[", "0", "-", "4", "]", "\\\\", "d", "|", "25", "[", "0", "-", "5", "]", "\\\\", ".)", "{", "3", "}", "\"", "+", "\"", "|(", "?:", "(?", ":[", "1", "-", "9", "]", "?\\", "\\", "d", "|", "1", "\\", "\\", "d", "{", "2", "}", "|", "2", "[", "0", "-", "4", "]", "\\\\", "d", "|", "25", "[", "0", "-", "5", "]", ")\\", "\\.", "){", "3", "}", "\"", "\"", "[", "1", "-", "9", "]", "?\\", "\\", "d", "|", "1", "\\", "\\", "d", "{", "2", "}", "|", "2", "[", "0", "-", "4", "]", "\\\\", "d", "|", "25", "[", "0", "-", "5", "]", "\"", "+", "\"", ")(", "?:", ":\\", "\\", "d", "+", ")?", "\"", "+", "\"", ")(", "?:", "(?", ":/", "(?", ":[", "a", "-", "z0", "-", "9", "$", "_", ".", "+!", "*'", "()", ",;", ":@", "&=", "\\\\", "-]", "|%", "[", "0", "-", "9a", "-", "f", "]", "{", "2", "}", ")*", ")*", "\"", "+"], "docstring_tokens": ["overload", "server", "process"]}
{"contents": ["FirstSuccessfulStrategy", "now", "detects", "empty", "principal", "correctly", "Fixes:", "SHIRO-747"], "code_tokens": ["@", "@", "-", "64", ",", "7", "+", "64", ",", "7", "@", "@", "public", "AuthenticationInfo", "beforeAllAttempts", "(", "Collection", "<", "?", "extends", "Realm", ">", "realms", ",", "*", "otherwise", ".", "*", "/", "public", "AuthenticationInfo", "beforeAttempt", "(", "Realm", "realm", ",", "AuthenticationToken", "token", ",", "AuthenticationInfo", "aggregate", ")", "throws", "AuthenticationException", "{", "if", "(", "getStopAfterFirstSuccess", "(", ")", "&", "&", "aggregate", "!", "=", "null", "&", "&", "isEmpty", "(", "aggregate", ".", "getPrincipals", "(", "))", ")", "{", "if", "(", "getStopAfterFirstSuccess", "(", ")", "&", "&", "aggregate", "!", "=", "null", "&", "&", "!", "isEmpty", "(", "aggregate", ".", "getPrincipals", "(", "))", ")", "{", "throw", "new", "ShortCircuitIterationException", "(", ");", "}", "return", "aggregate", ";", "@", "@", "-", "98", ",", "10", "+", "98", ",", "22", "@", "@", "public", "void", "testBeforeAttemptNull", "(", ")", "{", "assertNull", "(", "strategy", ".", "beforeAttempt", "(", "null", ",", "null", ",", "null", ")", ");", "}", "@", "Test", "public", "void", "testBeforeAttemptEmptyPrincipal", "(", ")", "{", "AuthenticationInfo", "aggregate", "=", "new", "SimpleAuthenticationInfo", "(", ");", "assertEquals", "(", "strategy", ".", "beforeAttempt", "(", "null", ",", "null", ",", "aggregate", ")", ",", "aggregate", ")", ";", "}", "@", "Test", "public", "void", "testBeforeAttemptEmptyList", "(", ")", "{", "SimplePrincipalCollection", "principalCollection", "=", "new", "SimplePrincipalCollection", "(", ");", "AuthenticationInfo", "aggregate", "=", "new", "SimpleAuthenticationInfo", "(", "principalCollection", ",", "null", ")", ";", "assertEquals", "(", "strategy", ".", "beforeAttempt", "(", "null", ",", "null", ",", "aggregate", ")", ",", "aggregate", ")", ";", "}", "@", "Test", "(", "expected", "=", "ShortCircuitIterationException", ".", "class", ")", "public", "void", "testBeforeAttemptStopAfterFirstSuccess", "(", ")", "{", "AuthenticationInfo", "aggregate", "=", "new", "SimpleAuthenticationInfo", "(", ");", "AuthenticationInfo", "aggregate", "=", "new", "SimpleAuthenticationInfo", "(", "\"", "principal", "\"", ",", "null", ",", "\"", "a", "-", "realm", "-", "name", "\"", ");", "strategy", ".", "beforeAttempt", "(", "null", ",", "null", ",", "aggregate", ")", ";", "}", "}"], "docstring_tokens": ["cause", "an", "authentication", "bypass", "."]}
{"contents": ["STORM-3026:", "Upgrade", "ZK", "instance", "for", "security"], "code_tokens": ["@", "@", "-", "48", ",", "6", "+", "48", ",", "8", "@", "@", "storm", ".", "messaging", ".", "transport", ":", "\"", "org", ".", "apache", ".", "storm", ".", "messaging", ".", "netty", ".", "Context", "\"", "storm", ".", "nimbus", ".", "retry", ".", "times", ":", "5", "storm", ".", "nimbus", ".", "retry", ".", "interval", ".", "millis", ":", "2000", "storm", ".", "nimbus", ".", "retry", ".", "intervalceiling", ".", "millis", ":", "60000", "storm", ".", "nimbus", ".", "zookeeper", ".", "acls", ".", "check", ":", "true", "storm", ".", "nimbus", ".", "zookeeper", ".", "acls", ".", "fixup", ":", "true", "storm", ".", "auth", ".", "simple", "-", "white", "-", "list", ".", "users", ":", "[", "]", "storm", ".", "cluster", ".", "state", ".", "store", ":", "\"", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "ZKStateStorageFactory", "\"", "storm", ".", "meta", ".", "serialization", ".", "delegate", ":", "\"", "org", ".", "apache", ".", "storm", ".", "serialization", ".", "GzipThriftSerializationDelegate", "\"", "@", "@", "-", "46", ",", "7", "+", "46", ",", "6", "@", "@", "public", "static", "final", "String", "ZK_SEPERATOR", "=", "\"", "/\"", ";", "public", "static", "final", "String", "ASSIGNMENTS_ROOT", "=", "\"", "assignments", "\"", ";", "public", "static", "final", "String", "CODE_ROOT", "=", "\"", "code", "\"", ";", "public", "static", "final", "String", "STORMS_ROOT", "=", "\"", "storms", "\"", ";", "public", "static", "final", "String", "SUPERVISORS_ROOT", "=", "\"", "supervisors", "\"", ";", "public", "static", "final", "String", "WORKERBEATS_ROOT", "=", "\"", "workerbeats", "\"", ";", "@", "@", "-", "98", ",", "15", "+", "97", ",", "38", "@", "@", "public", "static", "void", "resetInstance", "(", ")", "{", "_instance", "=", "INSTANCE", ";", "}", "public", "static", "List", "<", "ACL", ">", "mkTopoOnlyAcls", "(", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "throws", "NoSuchAlgorithmException", "{", "/", "**", "*", "Get", "ZK", "ACLs", "for", "a", "topology", "to", "have", "read", "/", "write", "access", ".", "*", "@", "param", "topoConf", "the", "topology", "config", ".", "*", "@", "return", "the", "ACLs", ".", "*", "/", "public", "static", "List", "<", "ACL", ">", "mkTopoReadWriteAcls", "(", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "return", "mkTopoAcls", "(", "topoConf", ",", "ZooDefs", ".", "Perms", ".", "ALL", ")", ";", "}", "/", "**", "*", "Get", "ZK", "ACLs", "for", "a", "topology", "to", "have", "read", "only", "access", ".", "*", "@", "param", "topoConf", "the", "topology", "config", ".", "*", "@", "return", "the", "ACLs", ".", "*", "/", "public", "static", "List", "<", "ACL", ">", "mkTopoReadOnlyAcls", "(", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "return", "mkTopoAcls", "(", "topoConf", ",", "ZooDefs", ".", "Perms", ".", "READ", ")", ";", "}", "private", "static", "List", "<", "ACL", ">", "mkTopoAcls", "(", "Map", "<", "String", ",", "Object", ">", "topoConf", ",", "int", "perms", ")", "{", "List", "<", "ACL", ">", "aclList", "=", "null", ";", "String", "payload", "=", "(", "String", ")", "topoConf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_TOPOLOGY_AUTH_PAYLOAD", ")", ";", "if", "(", "Utils", ".", "isZkAuthenticationConfiguredTopology", "(", "topoConf", ")", ")", "{", "aclList", "=", "new", "ArrayList", "<", ">(", ");", "ACL", "acl1", "=", "ZooDefs", ".", "Ids", ".", "CREATOR_ALL_ACL", ".", "get", "(", "0", ")", ";", "aclList", ".", "add", "(", "acl1", ")", ";", "ACL", "acl2", "=", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "READ", ",", "new", "Id", "(", "\"", "digest", "\"", ",", "DigestAuthenticationProvider", ".", "generateDigest", "(", "payload", ")", "))", ";", "aclList", ".", "add", "(", "acl2", ")", ";", "try", "{", "ACL", "acl2", "=", "new", "ACL", "(", "perms", ",", "new", "Id", "(", "\"", "digest", "\"", ",", "DigestAuthenticationProvider", ".", "generateDigest", "(", "payload", ")", "))", ";", "aclList", ".", "add", "(", "acl2", ")", ";", "}", "catch", "(", "NoSuchAlgorithmException", "e", ")", "{", "/", "/", "Should", "only", "happen", "on", "a", "badly", "configured", "system", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "return", "aclList", ";", "}", "@", "@", "-", "62", ",", "8", "+", "62", ",", "11", "@", "@", "return", "ZooDefs", ".", "Ids", ".", "CREATOR_ALL_ACL", ";", "case", "DRPC", ":", "List", "<", "ACL", ">", "ret", "=", "new", "ArrayList", "<", ">(", "ZooDefs", ".", "Ids", ".", "CREATOR_ALL_ACL", ")", ";", "ret", ".", "add", "(", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "READ", ",", "Utils", ".", "parseZkId", "(", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_DRPC_ACL", ")", ",", "Config", ".", "STORM_ZOOKEEPER_DRPC_ACL", ")", "))", ";", "String", "drpcAcl", "=", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_DRPC_ACL", ")", ";", "if", "(", "drpcAcl", "!", "=", "null", ")", "{", "ret", ".", "add", "(", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "READ", ",", "Utils", ".", "parseZkId", "(", "drpcAcl", ",", "Config", ".", "STORM_ZOOKEEPER_DRPC_ACL", ")", "))", ";", "}", "/", "/", "else", "we", "assume", "it", "is", "the", "same", "as", "teh", "SUPER_ACL", "which", "is", "covered", "by", "CREATOR_ALL", "return", "ret", ";", "default", ":", "throw", "new", "IllegalStateException", "(", "\"", "WorkerTokens", "for", "\"", "+", "type", "+", "\"", "are", "not", "currently", "supported", ".", "\")", ";", "@", "@", "-", "81", ",", "8", "+", "84", ",", "7", "@", "@", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "DaemonType", ".", "class", ")", ";", "@", "VisibleForTesting", "public", "static", "final", "List", "<", "ACL", ">", "NIMBUS_SUPERVISOR_ZK_ACLS", "=", "Arrays", ".", "asList", "(", "ZooDefs", ".", "Ids", ".", "CREATOR_ALL_ACL", ".", "get", "(", "0", ")", ",", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "READ", "|", "ZooDefs", ".", "Perms", ".", "CREATE", ",", "ZooDefs", ".", "Ids", ".", "ANYONE_ID_UNSAFE", ")", ");", "public", "static", "final", "List", "<", "ACL", ">", "NIMBUS_SUPERVISOR_ZK_ACLS", "=", "ZooDefs", ".", "Ids", ".", "CREATOR_ALL_ACL", ";", "private", "static", "List", "<", "ACL", ">", "getDefaultNimbusSupervisorZkAcls", "(", "Map", "<", "String", ",", "Object", ">", "conf", ")", "{", "if", "(", "Utils", ".", "isZkAuthenticationConfiguredStormServer", "(", "conf", ")", ")", "{", "return", "NIMBUS_SUPERVISOR_ZK_ACLS", ";", "@", "@", "-", "131", ",", "7", "+", "131", ",", "7", "@", "@", "SupervisorInfo", "supervisorInfo", "(", "String", "supervisorId", ")", ";", "/", "/", "returns", "nil", "if", "doesn", "'", "t", "exist", "void", "setupHeatbeats", "(", "String", "stormId", ")", ";", "void", "setupHeatbeats", "(", "String", "stormId", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "void", "teardownHeartbeats", "(", "String", "stormId", ")", ";", "@", "@", "-", "154", ",", "7", "+", "154", ",", "7", "@", "@", "*", "/", "NimbusInfo", "getLeader", "(", "Runnable", "callback", ")", ";", "void", "setTopologyLogConfig", "(", "String", "stormId", ",", "LogConfig", "logConfig", ")", ";", "void", "setTopologyLogConfig", "(", "String", "stormId", ",", "LogConfig", "logConfig", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "LogConfig", "topologyLogConfig", "(", "String", "stormId", ",", "Runnable", "cb", ")", ";", "@", "@", "-", "170", ",", "7", "+", "170", ",", "7", "@", "@", "/", "**", "@", "deprecated", ":", "In", "Storm", "2", ".", "0", ".", "Retained", "for", "enabling", "transition", "from", "1", ".", "x", ".", "Will", "be", "removed", "soon", ".", "*", "/", "@", "Deprecated", "void", "setupBackpressure", "(", "String", "stormId", ")", ";", "void", "setupBackpressure", "(", "String", "stormId", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "/", "**", "@", "deprecated", ":", "In", "Storm", "2", ".", "0", ".", "Retained", "for", "enabling", "transition", "from", "1", ".", "x", ".", "Will", "be", "removed", "soon", ".", "*", "/", "@", "Deprecated", "@", "@", "-", "180", ",", "13", "+", "180", ",", "13", "@", "@", "@", "Deprecated", "void", "removeWorkerBackpressure", "(", "String", "stormId", ",", "String", "node", ",", "Long", "port", ")", ";", "void", "activateStorm", "(", "String", "stormId", ",", "StormBase", "stormBase", ")", ";", "void", "activateStorm", "(", "String", "stormId", ",", "StormBase", "stormBase", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "void", "updateStorm", "(", "String", "stormId", ",", "StormBase", "newElems", ")", ";", "void", "removeStormBase", "(", "String", "stormId", ")", ";", "void", "setAssignment", "(", "String", "stormId", ",", "Assignment", "info", ")", ";", "void", "setAssignment", "(", "String", "stormId", ",", "Assignment", "info", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "void", "setupBlobstore", "(", "String", "key", ",", "NimbusInfo", "nimbusInfo", ",", "Integer", "versionInfo", ")", ";", "@", "@", "-", "202", ",", "11", "+", "202", ",", "13", "@", "@", "void", "reportError", "(", "String", "stormId", ",", "String", "componentId", ",", "String", "node", ",", "Long", "port", ",", "Throwable", "error", ")", ";", "void", "setupErrors", "(", "String", "stormId", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "List", "<", "ErrorInfo", ">", "errors", "(", "String", "stormId", ",", "String", "componentId", ")", ";", "ErrorInfo", "lastError", "(", "String", "stormId", ",", "String", "componentId", ")", ";", "void", "setCredentials", "(", "String", "stormId", ",", "Credentials", "creds", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "throws", "NoSuchAlgorithmException", ";", "void", "setCredentials", "(", "String", "stormId", ",", "Credentials", "creds", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", ";", "Credentials", "credentials", "(", "String", "stormId", ",", "Runnable", "callback", ")", ";", "@", "@", "-", "19", ",", "7", "+", "19", ",", "6", "@", "@", "package", "org", ".", "apache", ".", "storm", ".", "cluster", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "@", "@", "-", "294", ",", "7", "+", "293", ",", "6", "@", "@", "public", "void", "stateChanged", "(", "CuratorFramework", "curatorFramework", ",", "ConnectionState", "conn", "stateStorage", ".", "delete_node", "(", "ClusterUtils", ".", "nimbusPath", "(", "nimbusId", ")", ");", "stateStorage", ".", "set_ephemeral_node", "(", "ClusterUtils", ".", "nimbusPath", "(", "nimbusId", ")", ",", "Utils", ".", "serialize", "(", "nimbusSummary", ")", ",", "defaultAcls", ")", ";", "}", "}", "}", ");", "@", "@", "-", "435", ",", "8", "+", "433", ",", "9", "@", "@", "public", "SupervisorInfo", "supervisorInfo", "(", "String", "supervisorId", ")", "{", "}", "@", "Override", "public", "void", "setupHeatbeats", "(", "String", "stormId", ")", "{", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "workerbeatStormRoot", "(", "stormId", ")", ",", "defaultAcls", ")", ";", "public", "void", "setupHeatbeats", "(", "String", "stormId", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "WORKERBEATS_SUBTREE", ",", "defaultAcls", ")", ";", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "workerbeatStormRoot", "(", "stormId", ")", ",", "ClusterUtils", ".", "mkTopoReadWriteAcls", "(", "topoConf", ")", ");", "}", "@", "Override", "@", "@", "-", "491", ",", "8", "+", "490", ",", "9", "@", "@", "public", "NimbusInfo", "getLeader", "(", "Runnable", "callback", ")", "{", "}", "@", "Override", "public", "void", "setTopologyLogConfig", "(", "String", "stormId", ",", "LogConfig", "logConfig", ")", "{", "stateStorage", ".", "set_data", "(", "ClusterUtils", ".", "logConfigPath", "(", "stormId", ")", ",", "Utils", ".", "serialize", "(", "logConfig", ")", ",", "defaultAcls", ")", ";", "public", "void", "setTopologyLogConfig", "(", "String", "stormId", ",", "LogConfig", "logConfig", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "LOGCONFIG_SUBTREE", ",", "defaultAcls", ")", ";", "stateStorage", ".", "set_data", "(", "ClusterUtils", ".", "logConfigPath", "(", "stormId", ")", ",", "Utils", ".", "serialize", "(", "logConfig", ")", ",", "ClusterUtils", ".", "mkTopoReadOnlyAcls", "(", "topoConf", ")", ");", "}", "@", "Override", "@", "@", "-", "555", ",", "8", "+", "555", ",", "9", "@", "@", "public", "boolean", "topologyBackpressure", "(", "String", "stormId", ",", "long", "timeoutMs", ",", "Runnable", "cal", "return", "ret", ";", "}", "@", "Override", "public", "void", "setupBackpressure", "(", "String", "stormId", ")", "{", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "backpressureStormRoot", "(", "stormId", ")", ",", "defaultAcls", ")", ";", "public", "void", "setupBackpressure", "(", "String", "stormId", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "BACKPRESSURE_SUBTREE", ",", "defaultAcls", ")", ";", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "backpressureStormRoot", "(", "stormId", ")", ",", "ClusterUtils", ".", "mkTopoReadWriteAcls", "(", "topoConf", ")", ");", "}", "@", "Override", "@", "@", "-", "582", ",", "9", "+", "583", ",", "10", "@", "@", "public", "void", "removeWorkerBackpressure", "(", "String", "stormId", ",", "String", "node", ",", "Long", "port", ")", "{", "}", "}", "@", "Override", "public", "void", "activateStorm", "(", "String", "stormId", ",", "StormBase", "stormBase", ")", "{", "public", "void", "activateStorm", "(", "String", "stormId", ",", "StormBase", "stormBase", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "String", "path", "=", "ClusterUtils", ".", "stormPath", "(", "stormId", ")", ";", "stateStorage", ".", "set_data", "(", "path", ",", "Utils", ".", "serialize", "(", "stormBase", ")", ",", "defaultAcls", ")", ";", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "STORMS_SUBTREE", ",", "defaultAcls", ")", ";", "stateStorage", ".", "set_data", "(", "path", ",", "Utils", ".", "serialize", "(", "stormBase", ")", ",", "ClusterUtils", ".", "mkTopoReadOnlyAcls", "(", "topoConf", ")", ");", "this", ".", "assignmentsBackend", ".", "keepStormId", "(", "stormBase", ".", "get_name", "(", "),", "stormId", ")", ";", "}", "@", "@", "-", "596", ",", "7", "+", "598", ",", "6", "@", "@", "public", "void", "activateStorm", "(", "String", "stormId", ",", "StormBase", "stormBase", ")", "{", "*", "/", "@", "Override", "public", "void", "updateStorm", "(", "String", "stormId", ",", "StormBase", "newElems", ")", "{", "StormBase", "stormBase", "=", "stormBase", "(", "stormId", ",", "null", ")", ";", "if", "(", "stormBase", ".", "get_component_executors", "(", ")", "!", "=", "null", ")", "{", "@", "@", "-", "683", ",", "9", "+", "684", ",", "10", "@", "@", "public", "void", "removeStormBase", "(", "String", "stormId", ")", "{", "}", "@", "Override", "public", "void", "setAssignment", "(", "String", "stormId", ",", "Assignment", "info", ")", "{", "public", "void", "setAssignment", "(", "String", "stormId", ",", "Assignment", "info", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "byte", "[", "]", "serAssignment", "=", "Utils", ".", "serialize", "(", "info", ")", ";", "stateStorage", ".", "set_data", "(", "ClusterUtils", ".", "assignmentPath", "(", "stormId", ")", ",", "serAssignment", ",", "defaultAcls", ")", ";", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "ASSIGNMENTS_SUBTREE", ",", "defaultAcls", ")", ";", "stateStorage", ".", "set_data", "(", "ClusterUtils", ".", "assignmentPath", "(", "stormId", ")", ",", "Utils", ".", "serialize", "(", "info", ")", ",", "ClusterUtils", ".", "mkTopoReadOnlyAcls", "(", "topoConf", ")", ");", "this", ".", "assignmentsBackend", ".", "keepOrUpdateAssignment", "(", "stormId", ",", "info", ")", ";", "}", "@", "@", "-", "736", ",", "8", "+", "738", ",", "13", "@", "@", "public", "void", "removeKeyVersion", "(", "String", "blobKey", ")", "{", "}", "@", "Override", "public", "void", "reportError", "(", "String", "stormId", ",", "String", "componentId", ",", "String", "node", ",", "Long", "port", ",", "Throwable", "error", ")", "{", "public", "void", "setupErrors", "(", "String", "stormId", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "ERRORS_SUBTREE", ",", "defaultAcls", ")", ";", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "errorStormRoot", "(", "stormId", ")", ",", "ClusterUtils", ".", "mkTopoReadWriteAcls", "(", "topoConf", ")", ");", "}", "@", "Override", "public", "void", "reportError", "(", "String", "stormId", ",", "String", "componentId", ",", "String", "node", ",", "Long", "port", ",", "Throwable", "error", ")", "{", "String", "path", "=", "ClusterUtils", ".", "errorPath", "(", "stormId", ",", "componentId", ")", ";", "String", "lastErrorPath", "=", "ClusterUtils", ".", "lastErrorPath", "(", "stormId", ",", "componentId", ")", ";", "ErrorInfo", "errorInfo", "=", "new", "ErrorInfo", "(", "ClusterUtils", ".", "stringifyError", "(", "error", ")", ",", "Time", ".", "currentTimeSecs", "(", "))", ";", "@", "@", "-", "795", ",", "7", "+", "802", ",", "6", "@", "@", "public", "int", "compare", "(", "ErrorInfo", "arg0", ",", "ErrorInfo", "arg1", ")", "{", "@", "Override", "public", "ErrorInfo", "lastError", "(", "String", "stormId", ",", "String", "componentId", ")", "{", "String", "path", "=", "ClusterUtils", ".", "lastErrorPath", "(", "stormId", ",", "componentId", ")", ";", "if", "(", "stateStorage", ".", "node_exists", "(", "path", ",", "false", ")", ")", "{", "ErrorInfo", "errorInfo", "=", "ClusterUtils", ".", "maybeDeserialize", "(", "stateStorage", ".", "get_data", "(", "path", ",", "false", ")", ",", "ErrorInfo", ".", "class", ")", ";", "@", "@", "-", "806", ",", "11", "+", "812", ",", "10", "@", "@", "public", "ErrorInfo", "lastError", "(", "String", "stormId", ",", "String", "componentId", ")", "{", "}", "@", "Override", "public", "void", "setCredentials", "(", "String", "stormId", ",", "Credentials", "creds", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "throws", "NoSuchAlgorithmException", "{", "List", "<", "ACL", ">", "aclList", "=", "ClusterUtils", ".", "mkTopoOnlyAcls", "(", "topoConf", ")", ";", "public", "void", "setCredentials", "(", "String", "stormId", ",", "Credentials", "creds", ",", "Map", "<", "String", ",", "Object", ">", "topoConf", ")", "{", "List", "<", "ACL", ">", "aclList", "=", "ClusterUtils", ".", "mkTopoReadOnlyAcls", "(", "topoConf", ")", ";", "String", "path", "=", "ClusterUtils", ".", "credentialsPath", "(", "stormId", ")", ";", "stateStorage", ".", "set_data", "(", "path", ",", "Utils", ".", "serialize", "(", "creds", ")", ",", "aclList", ")", ";", "}", "@", "Override", "@", "@", "-", "841", ",", "6", "+", "846", ",", "7", "@", "@", "public", "PrivateWorkerKey", "getPrivateWorkerKey", "(", "WorkerTokenServiceType", "type", ",", "String", "@", "Override", "public", "void", "addPrivateWorkerKey", "(", "WorkerTokenServiceType", "type", ",", "String", "topologyId", ",", "long", "keyVersion", ",", "PrivateWorkerKey", "key", ")", "{", "assert", "context", ".", "getDaemonType", "(", ")", "=", "=", "DaemonType", ".", "NIMBUS", ";", "stateStorage", ".", "mkdirs", "(", "ClusterUtils", ".", "SECRET_KEYS_SUBTREE", ",", "defaultAcls", ")", ";", "List", "<", "ACL", ">", "secretAcls", "=", "context", ".", "getZkSecretAcls", "(", "type", ")", ";", "String", "path", "=", "ClusterUtils", ".", "secretKeysPath", "(", "type", ",", "topologyId", ",", "keyVersion", ")", ";", "LOG", ".", "debug", "(", "\"", "Storing", "private", "key", "for", "{", "}", "connecting", "to", "a", "{", "}", "at", "{", "}", "with", "ACL", "{", "}\\", "n", "\\", "n", "\"", ",", "topologyId", ",", "type", ",", "path", ",", "secretAcls", ")", ";", "@", "@", "-", "77", ",", "35", "+", "77", ",", "36", "@", "@", "public", "void", "execute", "(", "Watcher", ".", "Event", ".", "KeeperState", "state", ",", "Watcher", ".", "Event", ".", "EventType", "typ", "public", "ZKStateStorage", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ",", "ClusterStateContext", "context", ")", "throws", "Exception", "{", "this", ".", "conf", "=", "conf", ";", "this", ".", "authConf", "=", "authConf", ";", "if", "(", "context", ".", "getDaemonType", "(", ").", "equals", "(", "DaemonType", ".", "NIMBUS", ")", ")", "if", "(", "context", ".", "getDaemonType", "(", ").", "equals", "(", "DaemonType", ".", "NIMBUS", ")", ")", "{", "this", ".", "isNimbus", "=", "true", ";", "}", "/", "/", "just", "mkdir", "STORM_ZOOKEEPER_ROOT", "dir", "CuratorFramework", "zkTemp", "=", "mkZk", "(", ");", "CuratorFramework", "zkTemp", "=", "mkZk", "(", "context", ".", "getDaemonType", "(", "))", ";", "String", "rootPath", "=", "String", ".", "valueOf", "(", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", ");", "ClientZookeeper", ".", "mkdirs", "(", "zkTemp", ",", "rootPath", ",", "context", ".", "getDefaultZkAcls", "(", "))", ";", "zkTemp", ".", "close", "(", ");", "active", "=", "new", "AtomicBoolean", "(", "true", ")", ";", "zkWriter", "=", "mkZk", "(", "new", "ZkWatcherCallBack", "(", "))", ";", "zkWriter", "=", "mkZk", "(", "new", "ZkWatcherCallBack", "(", "),", "context", ".", "getDaemonType", "(", "))", ";", "if", "(", "isNimbus", ")", "{", "zkReader", "=", "mkZk", "(", "new", "ZkWatcherCallBack", "(", "))", ";", "zkReader", "=", "mkZk", "(", "new", "ZkWatcherCallBack", "(", "),", "context", ".", "getDaemonType", "(", "))", ";", "}", "else", "{", "zkReader", "=", "zkWriter", ";", "}", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "private", "CuratorFramework", "mkZk", "(", ")", "throws", "IOException", "{", "return", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "(", "List", "<", "String", ">", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ",", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ",", "\"", "\",", "new", "DefaultWatcherCallBack", "(", "),", "authConf", ")", ";", "private", "CuratorFramework", "mkZk", "(", "DaemonType", "type", ")", "{", "return", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "(", "List", "<", "String", ">", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ",", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ",", "\"", "\",", "new", "DefaultWatcherCallBack", "(", "),", "authConf", ",", "type", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "private", "CuratorFramework", "mkZk", "(", "WatcherCallBack", "watcher", ")", "throws", "NumberFormatException", ",", "IOException", "{", "return", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "(", "List", "<", "String", ">", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ",", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ",", "String", ".", "valueOf", "(", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", "),", "watcher", ",", "authConf", ")", ";", "private", "CuratorFramework", "mkZk", "(", "WatcherCallBack", "watcher", ",", "DaemonType", "type", ")", "throws", "NumberFormatException", "{", "return", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "(", "List", "<", "String", ">", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ",", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ",", "String", ".", "valueOf", "(", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", "),", "watcher", ",", "authConf", ",", "type", ")", ";", "}", "@", "Override", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "storm", ".", "transactional", ".", "state", ";", "import", "org", ".", "apache", ".", "storm", ".", "Config", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "apache", ".", "storm", ".", "serialization", ".", "KryoValuesDeserializer", ";", "import", "org", ".", "apache", ".", "storm", ".", "serialization", ".", "KryoValuesSerializer", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "Utils", ";", "@", "@", "-", "65", ",", "7", "+", "66", ",", "7", "@", "@", "protected", "TransactionalState", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "String", "id", ",", "Map", "<", "String", ",", "Ob", "List", "<", "String", ">", "servers", "=", "(", "List", "<", "String", ">", ")", "getWithBackup", "(", "conf", ",", "Config", ".", "TRANSACTIONAL_ZOOKEEPER_SERVERS", ",", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ";", "Object", "port", "=", "getWithBackup", "(", "conf", ",", "Config", ".", "TRANSACTIONAL_ZOOKEEPER_PORT", ",", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ";", "ZookeeperAuthInfo", "auth", "=", "new", "ZookeeperAuthInfo", "(", "conf", ")", ";", "CuratorFramework", "initter", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "auth", ")", ";", "CuratorFramework", "initter", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "auth", ",", "DaemonType", ".", "WORKER", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "_zkAcls", "=", "Utils", ".", "getWorkerACL", "(", "conf", ")", ";", "try", "{", "TransactionalState", ".", "createNode", "(", "initter", ",", "transactionalRoot", ",", "null", ",", "null", ",", "null", ")", ";", "@", "@", "-", "77", ",", "7", "+", "78", ",", "7", "@", "@", "protected", "TransactionalState", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "String", "id", ",", "Map", "<", "String", ",", "Ob", "}", "initter", ".", "close", "(", ");", "_curator", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "rootDir", ",", "auth", ")", ";", "_curator", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "rootDir", ",", "auth", ",", "DaemonType", ".", "WORKER", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "_ser", "=", "new", "KryoValuesSerializer", "(", "conf", ")", ";", "_des", "=", "new", "KryoValuesDeserializer", "(", "conf", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "api", ".", "PathAndBytesable", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "api", ".", "ProtectACLCreateModePathAndBytesable", ";", "import", "org", ".", "apache", ".", "storm", ".", "Config", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "Utils", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "CuratorUtils", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "ZookeeperAuthInfo", ";", "@", "@", "-", "65", ",", "7", "+", "66", ",", "7", "@", "@", "protected", "TransactionalState", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "String", "id", ",", "String", "subroot", "List", "<", "String", ">", "servers", "=", "(", "List", "<", "String", ">", ")", "getWithBackup", "(", "conf", ",", "Config", ".", "TRANSACTIONAL_ZOOKEEPER_SERVERS", ",", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ";", "Object", "port", "=", "getWithBackup", "(", "conf", ",", "Config", ".", "TRANSACTIONAL_ZOOKEEPER_PORT", ",", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ";", "ZookeeperAuthInfo", "auth", "=", "new", "ZookeeperAuthInfo", "(", "conf", ")", ";", "CuratorFramework", "initter", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "auth", ")", ";", "CuratorFramework", "initter", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "auth", ",", "DaemonType", ".", "WORKER", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "_zkAcls", "=", "Utils", ".", "getWorkerACL", "(", "conf", ")", ";", "try", "{", "TransactionalState", ".", "createNode", "(", "initter", ",", "transactionalRoot", ",", "null", ",", "null", ",", "null", ")", ";", "@", "@", "-", "77", ",", "7", "+", "78", ",", "7", "@", "@", "protected", "TransactionalState", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "String", "id", ",", "String", "subroot", "}", "initter", ".", "close", "(", ");", "_curator", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "rootDir", ",", "auth", ")", ";", "_curator", "=", "CuratorUtils", ".", "newCuratorStarted", "(", "conf", ",", "servers", ",", "port", ",", "rootDir", ",", "auth", ",", "DaemonType", ".", "WORKER", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "storm", ".", "utils", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "api", ".", "ACLProvider", ";", "import", "org", ".", "apache", ".", "storm", ".", "Config", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "@", "@", "-", "26", ",", "6", "+", "27", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "curator", ".", "ensemble", ".", "exhibitor", ".", "Exhibitors", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "CuratorFramework", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "CuratorFrameworkFactory", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "data", ".", "ACL", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "36", ",", "15", "+", "38", ",", "18", "@", "@", "public", "class", "CuratorUtils", "{", "public", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "CuratorUtils", ".", "class", ")", ";", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ")", "{", "return", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "null", ")", ";", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "List", "<", "ACL", ">", "defaultAcl", ")", "{", "return", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "null", ",", "defaultAcl", ")", ";", "}", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "ZookeeperAuthInfo", "auth", ")", "{", "return", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "\"", "\",", "auth", ")", ";", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "ZookeeperAuthInfo", "auth", ",", "List", "<", "ACL", ">", "defaultAcl", ")", "{", "return", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "\"", "\",", "auth", ",", "defaultAcl", ")", ";", "}", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "ZookeeperAuthInfo", "auth", ")", "{", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "ZookeeperAuthInfo", "auth", ",", "final", "List", "<", "ACL", ">", "defaultAcl", ")", "{", "List", "<", "String", ">", "serverPorts", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "String", "zkServer", ":", "servers", ")", "{", "serverPorts", ".", "add", "(", "zkServer", "+", "\"", ":\"", "+", "ObjectReader", ".", "getInt", "(", "port", ")", ");", "@", "@", "-", "53", ",", "6", "+", "58", ",", "19", "@", "@", "public", "static", "CuratorFramework", "newCurator", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "CuratorFrameworkFactory", ".", "Builder", "builder", "=", "CuratorFrameworkFactory", ".", "builder", "(", ");", "setupBuilder", "(", "builder", ",", "zkStr", ",", "conf", ",", "auth", ")", ";", "if", "(", "defaultAcl", "!", "=", "null", ")", "{", "builder", ".", "aclProvider", "(", "new", "ACLProvider", "(", ")", "{", "@", "Override", "public", "List", "<", "ACL", ">", "getDefaultAcl", "(", ")", "{", "return", "defaultAcl", ";", "}", "@", "Override", "public", "List", "<", "ACL", ">", "getAclForPath", "(", "String", "s", ")", "{", "return", "null", ";", "}", "}", ");", "}", "return", "builder", ".", "build", "(", ");", "}", "@", "@", "-", "99", ",", "15", "+", "117", ",", "17", "@", "@", "public", "static", "void", "testSetupBuilder", "(", "CuratorFrameworkFactory", ".", "Builder", "setupBuilder", "(", "builder", ",", "zkStr", ",", "conf", ",", "auth", ")", ";", "}", "public", "static", "CuratorFramework", "newCuratorStarted", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "ZookeeperAuthInfo", "auth", ")", "{", "CuratorFramework", "ret", "=", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "auth", ")", ";", "public", "static", "CuratorFramework", "newCuratorStarted", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "ZookeeperAuthInfo", "auth", ",", "List", "<", "ACL", ">", "defaultAcl", ")", "{", "CuratorFramework", "ret", "=", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "auth", ",", "defaultAcl", ")", ";", "LOG", ".", "info", "(", "\"", "Starting", "Utils", "Curator", ".", "..", "\")", ";", "ret", ".", "start", "(", ");", "return", "ret", ";", "}", "public", "static", "CuratorFramework", "newCuratorStarted", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "ZookeeperAuthInfo", "auth", ")", "{", "CuratorFramework", "ret", "=", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "auth", ")", ";", "public", "static", "CuratorFramework", "newCuratorStarted", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "ZookeeperAuthInfo", "auth", ",", "List", "<", "ACL", ">", "defaultAcl", ")", "{", "CuratorFramework", "ret", "=", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "auth", ",", "defaultAcl", ")", ";", "LOG", ".", "info", "(", "\"", "Starting", "Utils", "Curator", "(", "2", ")", "..", ".\"", ");", "ret", ".", "start", "(", ");", "return", "ret", ";", "@", "@", "-", "541", ",", "17", "+", "541", ",", "30", "@", "@", "public", "static", "Id", "parseZkId", "(", "String", "id", ",", "String", "configName", ")", "{", "return", "new", "Id", "(", "split", "[", "0", "]", ",", "split", "[", "1", "]", ");", "}", "public", "static", "List", "<", "ACL", ">", "getWorkerACL", "(", "Map", "<", "String", ",", "Object", ">", "conf", ")", "{", "/", "/", "This", "is", "a", "work", "around", "to", "an", "issue", "with", "ZK", "where", "a", "sasl", "super", "user", "is", "not", "super", "unless", "there", "is", "an", "open", "SASL", "ACL", "so", "we", "are", "trying", "to", "give", "the", "correct", "perms", "if", "(", "!", "isZkAuthenticationConfiguredTopology", "(", "conf", ")", ")", "{", "return", "null", ";", "}", "/", "**", "*", "Get", "the", "ACL", "for", "nimbus", "/", "supervisor", ".", "The", "Super", "User", "ACL", ".", "This", "assumes", "that", "security", "is", "enabled", ".", "*", "@", "param", "conf", "the", "config", "to", "get", "the", "super", "User", "ACL", "from", "*", "@", "return", "the", "super", "user", "ACL", ".", "*", "/", "public", "static", "ACL", "getSuperUserAcl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ")", "{", "String", "stormZKUser", "=", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SUPERACL", ")", ";", "if", "(", "stormZKUser", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Authentication", "is", "enabled", "but", "\"", "+", "Config", ".", "STORM_ZOOKEEPER_SUPERACL", "+", "\"", "is", "not", "set", "\"", ");", "}", "return", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "ALL", ",", "parseZkId", "(", "stormZKUser", ",", "Config", ".", "STORM_ZOOKEEPER_SUPERACL", ")", ");", "}", "/", "**", "*", "Get", "the", "ZK", "ACLs", "that", "a", "worker", "should", "use", "when", "writing", "to", "ZK", ".", "*", "@", "param", "conf", "the", "config", "for", "the", "topology", ".", "*", "@", "return", "the", "ACLs", "*", "/", "public", "static", "List", "<", "ACL", ">", "getWorkerACL", "(", "Map", "<", "String", ",", "Object", ">", "conf", ")", "{", "if", "(", "!", "isZkAuthenticationConfiguredTopology", "(", "conf", ")", ")", "{", "return", "null", ";", "}", "ArrayList", "<", "ACL", ">", "ret", "=", "new", "ArrayList", "<", ">(", "ZooDefs", ".", "Ids", ".", "CREATOR_ALL_ACL", ")", ";", "ret", ".", "add", "(", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "ALL", ",", "parseZkId", "(", "stormZKUser", ",", "Config", ".", "STORM_ZOOKEEPER_SUPERACL", ")", "))", ";", "ret", ".", "add", "(", "getSuperUserAcl", "(", "conf", ")", ");", "return", "ret", ";", "}", "@", "@", "-", "25", ",", "6", "+", "25", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "state", ".", "ConnectionStateListener", ";", "import", "org", ".", "apache", ".", "storm", ".", "callback", ".", "DefaultWatcherCallBack", ";", "import", "org", ".", "apache", ".", "storm", ".", "callback", ".", "WatcherCallBack", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "VersionedData", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "Utils", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "CuratorUtils", ";", "@", "@", "-", "73", ",", "8", "+", "74", ",", "9", "@", "@", "public", "static", "void", "mkdirs", "(", "CuratorFramework", "zk", ",", "String", "path", ",", "List", "<", "ACL", ">", "acls", ")", "{", "_instance", ".", "mkdirsImpl", "(", "zk", ",", "path", ",", "acls", ")", ";", "}", "public", "static", "CuratorFramework", "mkClient", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "final", "WatcherCallBack", "watcher", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ")", "{", "return", "_instance", ".", "mkClientImpl", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "watcher", ",", "authConf", ")", ";", "public", "static", "CuratorFramework", "mkClient", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "final", "WatcherCallBack", "watcher", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ",", "DaemonType", "type", ")", "{", "return", "_instance", ".", "mkClientImpl", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "watcher", ",", "authConf", ",", "type", ")", ";", "}", "/", "/", "Deletes", "the", "state", "inside", "the", "zookeeper", "for", "a", "key", ",", "for", "which", "the", "@", "@", "-", "300", ",", "33", "+", "302", ",", "13", "@", "@", "public", "void", "mkdirsImpl", "(", "CuratorFramework", "zk", ",", "String", "path", ",", "List", "<", "ACL", ">", "acls", ")", "{", "}", "}", "/", "**", "*", "connect", "ZK", ",", "register", "Watch", "/", "unhandle", "Watch", "*", "*", "@", "return", "*", "/", "public", "CuratorFramework", "mkClientImpl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "final", "WatcherCallBack", "watcher", ")", "{", "return", "mkClientImpl", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "watcher", ",", "null", ")", ";", "}", "public", "CuratorFramework", "mkClientImpl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ")", "{", "return", "mkClientImpl", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "new", "DefaultWatcherCallBack", "(", "))", ";", "}", "public", "CuratorFramework", "mkClientImpl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ")", "{", "return", "mkClientImpl", "(", "conf", ",", "servers", ",", "port", ",", "\"", "\",", "new", "DefaultWatcherCallBack", "(", "),", "authConf", ")", ";", "}", "public", "CuratorFramework", "mkClientImpl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ")", "{", "return", "mkClientImpl", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "new", "DefaultWatcherCallBack", "(", "),", "authConf", ")", ";", "}", "public", "CuratorFramework", "mkClientImpl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "final", "WatcherCallBack", "watcher", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ")", "{", "public", "CuratorFramework", "mkClientImpl", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "List", "<", "String", ">", "servers", ",", "Object", "port", ",", "String", "root", ",", "final", "WatcherCallBack", "watcher", ",", "Map", "<", "String", ",", "Object", ">", "authConf", ",", "DaemonType", "type", ")", "{", "CuratorFramework", "fk", ";", "if", "(", "authConf", "!", "=", "null", ")", "{", "fk", "=", "CuratorUtils", ".", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "new", "ZookeeperAuthInfo", "(", "authConf", ")", ");", "fk", "=", "CuratorUtils", ".", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "new", "ZookeeperAuthInfo", "(", "authConf", ")", ",", "type", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "}", "else", "{", "fk", "=", "CuratorUtils", ".", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ")", ";", "fk", "=", "CuratorUtils", ".", "newCurator", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "null", ",", "type", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "}", "fk", ".", "getCuratorListenable", "(", ").", "addListener", "(", "new", "CuratorListener", "(", ")", "{", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "CuratorFramework", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "CuratorFrameworkFactory", ";", "import", "org", ".", "apache", ".", "storm", ".", "Config", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "44", ",", "7", "+", "45", ",", "8", "@", "@", "public", "void", "newCuratorUsesExponentialBackoffTest", "(", ")", "throws", "InterruptedException", "{", "config", ".", "put", "(", "Config", ".", "STORM_ZOOKEEPER_RETRY_TIMES", ",", "expectedRetries", ")", ";", "config", ".", "put", "(", "Config", ".", "STORM_ZOOKEEPER_RETRY_INTERVAL_CEILING", ",", "expectedCeiling", ")", ";", "CuratorFramework", "curator", "=", "CuratorUtils", ".", "newCurator", "(", "config", ",", "Arrays", ".", "asList", "(", "\"", "bogus_server", "\"", "),", "42", "/", "*", "port", "*", "/,", "\"", "\")", ";", "CuratorFramework", "curator", "=", "CuratorUtils", ".", "newCurator", "(", "config", ",", "Arrays", ".", "asList", "(", "\"", "bogus_server", "\"", "),", "42", ",", "\"", "\",", "DaemonType", ".", "WORKER", ".", "getDefaultZkAcls", "(", "config", ")", ");", "StormBoundedExponentialBackoffRetry", "policy", "=", "(", "StormBoundedExponentialBackoffRetry", ")", "curator", ".", "getZookeeperClient", "(", ").", "getRetryPolicy", "(", ");", "Assert", ".", "assertEquals", "(", "policy", ".", "getBaseSleepTimeMs", "(", "),", "expectedInterval", ")", ";", "@", "@", "-", "15", ",", "28", "+", "15", ",", "19", "@", "@", ";", ";", "limitations", "under", "the", "License", ".", "(", "ns", "org", ".", "apache", ".", "storm", ".", "command", ".", "shell", "-", "submission", "(", ":", "import", "[", "org", ".", "apache", ".", "storm", "Config", "StormSubmitter", "]", "[", "org", ".", "apache", ".", "storm", ".", "utils", "ServerUtils", "]", "[", "org", ".", "apache", ".", "storm", ".", "zookeeper", "Zookeeper", "]", ")", "[", "org", ".", "apache", ".", "storm", ".", "utils", "ServerUtils", "]", ")", "(", ":", "use", "[", "org", ".", "apache", ".", "storm", "util", "config", "log", "]", ")", "(", ":", "require", "[", "clojure", ".", "string", ":", "as", "str", "]", ")", "(", ":", "import", "[", "org", ".", "apache", ".", "storm", ".", "callback", "DefaultWatcherCallBack", "]", "[", "org", ".", "apache", ".", "storm", ".", "utils", "ConfigUtils", "]", "[", "org", ".", "apache", ".", "storm", ".", "zookeeper", "Zookeeper", "ClientZookeeper", "]", ")", "(", ":", "import", "[", "org", ".", "apache", ".", "storm", ".", "utils", "ConfigUtils", "NimbusClient", "]", ")", "(", ":", "gen", "-", "class", ")", ")", "(", "defn", "-", "main", "[", "^", "String", "tmpjarpath", "&", "args", "]", "(", "let", "[", "conf", "(", "clojurify", "-", "structure", "(", "ConfigUtils", "/", "readStormConfig", ")", ")", "servers", "(", ".", "get", "conf", "Config", "/", "STORM_ZOOKEEPER_SERVERS", ")", "port", "(", ".", "get", "conf", "Config", "/", "STORM_ZOOKEEPER_PORT", ")", "root", "(", ".", "get", "conf", "Config", "/", "STORM_ZOOKEEPER_ROOT", ")", "zk", "(", "ClientZookeeper", "/", "mkClient", "conf", "servers", "port", "root", "(", "DefaultWatcherCallBack", ".", ")", "conf", ")", ";", "since", "this", "is", "not", "a", "purpose", "to", "add", "to", "leader", "lock", "queue", ",", "passing", "nil", "as", "blob", "-", "store", "and", "topo", "cache", "is", "ok", "zk", "-", "leader", "-", "elector", "(", "Zookeeper", "/", "zkLeaderElector", "conf", "zk", "nil", "nil", "nil", "nil", ")", "leader", "-", "nimbus", "(", ".", "getLeader", "zk", "-", "leader", "-", "elector", ")", "host", "(", ".", "getHost", "leader", "-", "nimbus", ")", "port", "(", ".", "getPort", "leader", "-", "nimbus", ")", "no", "-", "op", "(", ".", "close", "zk", "-", "leader", "-", "elector", ")", "jarpath", "(", "StormSubmitter", "/", "submitJar", "conf", "tmpjarpath", ")", "args", "(", "concat", "args", "[", "host", "port", "jarpath", "]", ")]", "(", "ServerUtils", "/", "execCommand", "args", ")", "))", "(", "let", "[", "conf", "(", "clojurify", "-", "structure", "(", "ConfigUtils", "/", "readStormConfig", ")", ")]", "(", "with", "-", "open", "[", "client", "(", "NimbusClient", "/", "getConfiguredClient", "conf", ")", "]", "(", "let", "[", "c", "(", ".", "getClient", "client", ")", "ns", "(", ".", "getLeader", "c", ")", "host", "(", ".", "get_host", "ns", ")", "port", "(", ".", "get_port", "ns", ")", "jarpath", "(", "StormSubmitter", "/", "submitJar", "conf", "tmpjarpath", ")", "args", "(", "concat", "args", "[", "host", "port", "jarpath", "]", ")]", "(", "ServerUtils", "/", "execCommand", "args", ")", "))", "))", "@", "@", "-", "205", ",", "21", "+", "205", ",", "21", "@", "@", "base1", "(", "mkStormBase", "\"", "/", "tmp", "/", "storm1", "\"", "1", "TopologyStatus", "/", "ACTIVE", "2", ")", "base2", "(", "mkStormBase", "\"", "/", "tmp", "/", "storm2", "\"", "2", "TopologyStatus", "/", "ACTIVE", "2", ")", "]", "(", "is", "(", "=", "[", "]", "(", ".", "assignments", "state", "nil", ")", "))", "(", ".", "setAssignment", "state", "\"", "storm1", "\"", "assignment1", ")", "(", ".", "setAssignment", "state", "\"", "storm1", "\"", "assignment1", "{", "})", "(", "is", "(", "=", "assignment1", "(", ".", "assignmentInfo", "state", "\"", "storm1", "\"", "nil", ")", "))", "(", "is", "(", "=", "nil", "(", ".", "assignmentInfo", "state", "\"", "storm3", "\"", "nil", ")", "))", "(", ".", "setAssignment", "state", "\"", "storm1", "\"", "assignment2", ")", "(", ".", "setAssignment", "state", "\"", "storm3", "\"", "assignment1", ")", "(", ".", "setAssignment", "state", "\"", "storm1", "\"", "assignment2", "{", "})", "(", ".", "setAssignment", "state", "\"", "storm3", "\"", "assignment1", "{", "})", "(", "is", "(", "=", "#", "{\"", "storm1", "\"", "\"", "storm3", "\"", "}", "(", "set", "(", ".", "assignments", "state", "nil", ")", "))", ")", "(", "is", "(", "=", "assignment2", "(", ".", "assignmentInfo", "state", "\"", "storm1", "\"", "nil", ")", "))", "(", "is", "(", "=", "assignment1", "(", ".", "assignmentInfo", "state", "\"", "storm3", "\"", "nil", ")", "))", "(", "is", "(", "=", "[", "]", "(", ".", "activeStorms", "state", ")", "))", "(", ".", "activateStorm", "state", "\"", "storm1", "\"", "base1", ")", "(", ".", "activateStorm", "state", "\"", "storm1", "\"", "base1", "{", "})", "(", "is", "(", "=", "[", "\"", "storm1", "\"", "]", "(", ".", "activeStorms", "state", ")", "))", "(", "is", "(", "=", "base1", "(", ".", "stormBase", "state", "\"", "storm1", "\"", "nil", ")", "))", "(", "is", "(", "=", "nil", "(", ".", "stormBase", "state", "\"", "storm2", "\"", "nil", ")", "))", "(", ".", "activateStorm", "state", "\"", "storm2", "\"", "base2", ")", "(", ".", "activateStorm", "state", "\"", "storm2", "\"", "base2", "{", "})", "(", "is", "(", "=", "base1", "(", ".", "stormBase", "state", "\"", "storm1", "\"", "nil", ")", "))", "(", "is", "(", "=", "base2", "(", ".", "stormBase", "state", "\"", "storm2", "\"", "nil", ")", "))", "(", "is", "(", "=", "#", "{\"", "storm1", "\"", "\"", "storm2", "\"", "}", "(", "set", "(", ".", "activeStorms", "state", ")", "))", ")", "@", "@", "-", "353", ",", "7", "+", "353", ",", "8", "@", "@", "curator", "-", "frameworke", "(", "reify", "CuratorFramework", "(", "^", "void", "close", "[", "this", "]", "nil", ")", ")]", ";", ";", "No", "need", "for", "when", "clauses", "because", "we", "just", "want", "to", "return", "nil", "(", "with", "-", "open", "[", "_", "(", "MockedClientZookeeper", ".", "zk", "-", "mock", ")", "]", "(", ".", "(", "Mockito", "/", "when", "(", ".", "mkClientImpl", "zk", "-", "mock", "(", "Mockito", "/", "anyMap", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "anyString", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "any", ")", "))", "(", "thenReturn", "curator", "-", "frameworke", ")", ")", "(", ".", "(", "Mockito", "/", "when", "(", ".", "mkClientImpl", "zk", "-", "mock", "(", "Mockito", "/", "anyMap", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "anyString", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "any", ")", "))", "(", "thenReturn", "curator", "-", "frameworke", ")", ")", "(", "ClusterUtils", "/", "mkStateStorage", "{", "}", "nil", "(", "ClusterStateContext", ".", "))", "(", ".", "mkdirsImpl", "(", "Mockito", "/", "verify", "zk", "-", "mock", "(", "Mockito", "/", "times", "1", ")", ")", "(", "Mockito", "/", "any", ")", "(", "Mockito", "/", "anyString", ")", "(", "Mockito", "/", "eq", "nil", ")", "))", ")", "(", "let", "[", "distributed", "-", "state", "-", "storage", "(", "reify", "IStateStorage", "@", "@", "-", "1777", ",", "7", "+", "1777", ",", "7", "@", "@", "(", ".", "thenReturn", "(", "Mockito", "/", "when", "(", ".", "topologyLogConfig", "cluster", "-", "state", "(", "Mockito", "/", "any", "String", ")", "(", "Mockito", "/", "anyObject", ")", "))", "previous", "-", "config", ")", "(", ".", "setLogConfig", "nimbus", "\"", "foo", "\"", "mock", "-", "config", ")", "(", ".", "setTopologyLogConfig", "(", "Mockito", "/", "verify", "cluster", "-", "state", ")", "(", "Mockito", "/", "any", "String", ")", "(", "Mockito", "/", "eq", "expected", "-", "config", ")", "))", "))", ")", "(", ".", "setTopologyLogConfig", "(", "Mockito", "/", "verify", "cluster", "-", "state", ")", "(", "Mockito", "/", "any", "String", ")", "(", "Mockito", "/", "eq", "expected", "-", "config", ")", "(", "Mockito", "/", "any", "Map", ")", "))", "))", ")", "(", "deftest", "log", "-", "level", "-", "update", "-", "merges", "-", "and", "-", "flags", "-", "existent", "-", "log", "-", "level", "(", "let", "[", "cluster", "-", "state", "(", "Mockito", "/", "mock", "IStormClusterState", ")", "@", "@", "-", "1826", ",", "7", "+", "1826", ",", "7", "@", "@", "(", ".", "thenReturn", "(", "Mockito", "/", "when", "(", ".", "topologyLogConfig", "cluster", "-", "state", "(", "Mockito", "/", "any", "String", ")", "(", "Mockito", "/", "anyObject", ")", "))", "previous", "-", "config", ")", "(", ".", "setLogConfig", "nimbus", "\"", "foo", "\"", "mock", "-", "config", ")", "(", ".", "setTopologyLogConfig", "(", "Mockito", "/", "verify", "cluster", "-", "state", ")", "(", "Mockito", "/", "any", "String", ")", "(", "Mockito", "/", "eq", "expected", "-", "config", ")", "))", "))", ")", "(", ".", "setTopologyLogConfig", "(", "Mockito", "/", "verify", "cluster", "-", "state", ")", "(", "Mockito", "/", "any", "String", ")", "(", "Mockito", "/", "eq", "expected", "-", "config", ")", "(", "Mockito", "/", "any", "Map", ")", "))", "))", ")", "(", "defn", "teardown", "-", "heartbeats", "[", "id", "]", ")", "(", "defn", "teardown", "-", "topo", "-", "errors", "[", "id", "]", ")", "@", "@", "-", "1094", ",", "6", "+", "1094", ",", "21", "@", "@", "@", "isPositiveNumber", "public", "static", "String", "STORM_WORKER_TOKEN_LIFE_TIME_HOURS", "=", "\"", "storm", ".", "worker", ".", "token", ".", "life", ".", "time", ".", "hours", "\"", ";", "/", "**", "*", "In", "nimbus", "on", "startup", "check", "if", "all", "of", "the", "zookeeper", "ACLs", "are", "correct", "before", "starting", ".", "If", "not", "*", "don", "'", "t", "start", "nimbus", ".", "*", "/", "@", "isBoolean", "public", "static", "final", "String", "STORM_NIMBUS_ZOOKEEPER_ACLS_CHECK", "=", "\"", "storm", ".", "nimbus", ".", "zookeeper", ".", "acls", ".", "check", "\"", ";", "/", "**", "*", "In", "nimbus", "on", "startup", "check", "if", "all", "of", "the", "zookeeper", "ACLs", "are", "correct", "before", "starting", ".", "If", "not", "do", "*", "your", "best", "to", "fix", "them", "before", "nimbus", "starts", ",", "if", "it", "cannot", "fix", "them", "nimbus", "will", "not", "start", ".", "*", "This", "overrides", "any", "value", "set", "for", "storm", ".", "nimbus", ".", "zookeeper", ".", "acls", ".", "check", ".", "*", "/", "@", "isBoolean", "public", "static", "final", "String", "STORM_NIMBUS_ZOOKEEPER_ACLS_FIXUP", "=", "\"", "storm", ".", "nimbus", ".", "zookeeper", ".", "acls", ".", "fixup", "\"", ";", "/", "/", "VALIDATION", "ONLY", "CONFIGS", "/", "/", "Some", "configs", "inside", "Config", ".", "java", "may", "reference", "classes", "we", "don", "'", "t", "want", "to", "expose", "in", "storm", "-", "client", ",", "but", "we", "still", "want", "to", "validate", "/", "/", "That", "they", "reference", "a", "valid", "class", ".", "To", "allow", "this", "to", "happen", "we", "do", "part", "of", "the", "validation", "on", "the", "client", "side", "with", "annotations", "on", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "collections", ".", "CollectionUtils", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "CuratorFramework", ";", "import", "org", ".", "apache", ".", "storm", ".", "Config", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "AuthorizationException", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "KeyAlreadyExistsException", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "KeyNotFoundException", ";", "@", "@", "-", "52", ",", "12", "+", "53", ",", "13", "@", "@", "public", "static", "String", "getBlobStoreSubtree", "(", ")", "{", "return", "BLOBSTORE_SUBTREE", ";", "}", "public", "static", "CuratorFramework", "createZKClient", "(", "Map", "<", "String", ",", "Object", ">", "conf", ")", "{", "public", "static", "CuratorFramework", "createZKClient", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "DaemonType", "type", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "List", "<", "String", ">", "zkServers", "=", "(", "List", "<", "String", ">", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ";", "Object", "port", "=", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ";", "ZookeeperAuthInfo", "zkAuthInfo", "=", "new", "ZookeeperAuthInfo", "(", "conf", ")", ";", "CuratorFramework", "zkClient", "=", "CuratorUtils", ".", "newCurator", "(", "conf", ",", "zkServers", ",", "port", ",", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", ",", "zkAuthInfo", ")", ";", "CuratorFramework", "zkClient", "=", "CuratorUtils", ".", "newCurator", "(", "conf", ",", "zkServers", ",", "port", ",", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", ",", "zkAuthInfo", ",", "type", ".", "getDefaultZkAcls", "(", "conf", ")", ");", "zkClient", ".", "start", "(", ");", "return", "zkClient", ";", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "storm", ".", "blobstore", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "SettableBlobMeta", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "AuthorizationException", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "KeyAlreadyExistsException", ";", "@", "@", "-", "83", ",", "7", "+", "84", ",", "7", "@", "@", "public", "void", "prepare", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "String", "overrideBase", ",", "NimbusInfo", "nimbusInfo", ")", "{", "this", ".", "conf", "=", "conf", ";", "this", ".", "nimbusInfo", "=", "nimbusInfo", ";", "zkClient", "=", "BlobStoreUtils", ".", "createZKClient", "(", "conf", ")", ";", "zkClient", "=", "BlobStoreUtils", ".", "createZKClient", "(", "conf", ",", "DaemonType", ".", "NIMBUS", ")", ";", "if", "(", "overrideBase", "=", "=", "null", ")", "{", "overrideBase", "=", "ConfigUtils", ".", "absoluteStormBlobStoreDir", "(", "conf", ")", ";", "}", "@", "@", "-", "200", ",", "6", "+", "200", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "Utils", ".", "UptimeComputer", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "VersionInfo", ";", "import", "org", ".", "apache", ".", "storm", ".", "validation", ".", "ConfigValidation", ";", "import", "org", ".", "apache", ".", "storm", ".", "zookeeper", ".", "AclEnforcement", ";", "import", "org", ".", "apache", ".", "storm", ".", "zookeeper", ".", "ClientZookeeper", ";", "import", "org", ".", "apache", ".", "storm", ".", "zookeeper", ".", "Zookeeper", ";", "import", "org", ".", "apache", ".", "thrift", ".", "TException", ";", "@", "@", "-", "1056", ",", "6", "+", "1057", ",", "11", "@", "@", "private", "static", "Nimbus", "launchServer", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "INimbus", "inimbus", ")", "th", "public", "static", "Nimbus", "launch", "(", "INimbus", "inimbus", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "Object", ">", "conf", "=", "Utils", ".", "merge", "(", "Utils", ".", "readStormConfig", "(", "),", "ConfigUtils", ".", "readYamlConfig", "(", "\"", "storm", "-", "cluster", "-", "auth", ".", "yaml", "\"", ",", "false", ")", ");", "boolean", "fixupAcl", "=", "(", "boolean", ")", "conf", ".", "get", "(", "DaemonConfig", ".", "STORM_NIMBUS_ZOOKEEPER_ACLS_FIXUP", ")", ";", "boolean", "checkAcl", "=", "fixupAcl", "|", "|", "(", "boolean", ")", "conf", ".", "get", "(", "DaemonConfig", ".", "STORM_NIMBUS_ZOOKEEPER_ACLS_CHECK", ")", ";", "if", "(", "checkAcl", ")", "{", "AclEnforcement", ".", "verifyAcls", "(", "conf", ",", "fixupAcl", ")", ";", "}", "return", "launchServer", "(", "conf", ",", "inimbus", ")", ";", "}", "@", "@", "-", "1121", ",", "7", "+", "1127", ",", "7", "@", "@", "private", "static", "CuratorFramework", "makeZKClient", "(", "Map", "<", "String", ",", "Object", ">", "conf", ")", "{", "String", "root", "=", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", ";", "CuratorFramework", "ret", "=", "null", ";", "if", "(", "servers", "!", "=", "null", "&", "&", "port", "!", "=", "null", ")", "{", "ret", "=", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "new", "DefaultWatcherCallBack", "(", "),", "conf", ")", ";", "ret", "=", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "servers", ",", "port", ",", "root", ",", "new", "DefaultWatcherCallBack", "(", "),", "conf", ",", "DaemonType", ".", "NIMBUS", ")", ";", "}", "return", "ret", ";", "}", "@", "@", "-", "2082", ",", "7", "+", "2088", ",", "7", "@", "@", "private", "void", "mkAssignments", "(", "String", "scratchTopoId", ")", "throws", "Exception", "{", "TopologyDetails", "td", "=", "tds", ".", "get", "(", "id", ")", ";", "if", "(", "td", "!", "=", "null", ")", "{", "currentAssignment", ".", "set_owner", "(", "td", ".", "getTopologySubmitter", "(", "))", ";", "state", ".", "setAssignment", "(", "id", ",", "currentAssignment", ")", ";", "state", ".", "setAssignment", "(", "id", ",", "currentAssignment", ",", "td", ".", "getConf", "(", "))", ";", "}", "}", "existingAssignments", ".", "put", "(", "id", ",", "currentAssignment", ")", ";", "@", "@", "-", "2191", ",", "12", "+", "2197", ",", "12", "@", "@", "private", "void", "mkAssignments", "(", "String", "scratchTopoId", ")", "throws", "Exception", "{", "String", "topoId", "=", "entry", ".", "getKey", "(", ");", "Assignment", "assignment", "=", "entry", ".", "getValue", "(", ");", "Assignment", "existingAssignment", "=", "existingAssignments", ".", "get", "(", "topoId", ")", ";", "/", "/", "NOT", "Used", "TopologyDetails", "topologyDetails", "=", "topologies", ".", "getById", "(", "topoId", ")", ";", "TopologyDetails", "td", "=", "topologies", ".", "getById", "(", "topoId", ")", ";", "if", "(", "assignment", ".", "equals", "(", "existingAssignment", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "Assignment", "for", "{", "}", "hasn", "'", "t", "changed", "\"", ",", "topoId", ")", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"", "Setting", "new", "assignment", "for", "topology", "id", "{", "}:", "{", "}\"", ",", "topoId", ",", "assignment", ")", ";", "state", ".", "setAssignment", "(", "topoId", ",", "assignment", ")", ";", "state", ".", "setAssignment", "(", "topoId", ",", "assignment", ",", "td", ".", "getConf", "(", "))", ";", "}", "}", "@", "@", "-", "2269", ",", "7", "+", "2275", ",", "7", "@", "@", "private", "void", "startTopology", "(", "String", "topoName", ",", "String", "topoId", ",", "TopologyStatus", "initSt", "base", ".", "set_owner", "(", "owner", ")", ";", "base", ".", "set_principal", "(", "principal", ")", ";", "base", ".", "set_component_debug", "(", "new", "HashMap", "<", ">(", "))", ";", "state", ".", "activateStorm", "(", "topoId", ",", "base", ")", ";", "state", ".", "activateStorm", "(", "topoId", ",", "base", ",", "topoConf", ")", ";", "notifyTopologyActionListener", "(", "topoName", ",", "\"", "activate", "\"", ");", "}", "@", "@", "-", "3075", ",", "9", "+", "3081", ",", "10", "@", "@", "public", "void", "submitTopologyWithOpts", "(", "String", "topoName", ",", "String", "uploadedJarLocation", ",", "LOG", ".", "info", "(", "\"", "uploadedJar", "{", "}\"", ",", "uploadedJarLocation", ")", ";", "setupStormCode", "(", "conf", ",", "topoId", ",", "uploadedJarLocation", ",", "totalConfToSave", ",", "topology", ")", ";", "waitForDesiredCodeReplication", "(", "totalConf", ",", "topoId", ")", ";", "state", ".", "setupHeatbeats", "(", "topoId", ")", ";", "state", ".", "setupHeatbeats", "(", "topoId", ",", "topoConf", ")", ";", "state", ".", "setupErrors", "(", "topoId", ",", "topoConf", ")", ";", "if", "(", "ObjectReader", ".", "getBoolean", "(", "totalConf", ".", "get", "(", "Config", ".", "TOPOLOGY_BACKPRESSURE_ENABLE", ")", ",", "false", ")", ")", "{", "state", ".", "setupBackpressure", "(", "topoId", ")", ";", "state", ".", "setupBackpressure", "(", "topoId", ",", "topoConf", ")", ";", "}", "notifyTopologyActionListener", "(", "topoName", ",", "\"", "submitTopology", "\"", ");", "TopologyStatus", "status", "=", "null", ";", "@", "@", "-", "3267", ",", "7", "+", "3274", ",", "7", "@", "@", "public", "void", "setLogConfig", "(", "String", "topoId", ",", "LogConfig", "config", ")", "throws", "TException", "{", "}", "}", "LOG", ".", "info", "(", "\"", "Setting", "log", "config", "for", "{", "}:", "{}", "\",", "topoName", ",", "mergedLogConfig", ")", ";", "state", ".", "setTopologyLogConfig", "(", "topoId", ",", "mergedLogConfig", ")", ";", "state", ".", "setTopologyLogConfig", "(", "topoId", ",", "mergedLogConfig", ",", "topoConf", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "set", "log", "config", "topology", "exception", ".", "(", "topology", "id", "=", "'{", "}'", ")\"", ",", "topoId", ",", "e", ")", ";", "if", "(", "e", "instanceof", "TException", ")", "{", "@", "@", "-", "33", ",", "8", "+", "33", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "Utils", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "ObjectReader", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "LocalState", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "data", ".", "ACL", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "321", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "storm", ".", "zookeeper", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "org", ".", "apache", ".", "curator", ".", "framework", ".", "CuratorFramework", ";", "import", "org", ".", "apache", ".", "storm", ".", "Config", ";", "import", "org", ".", "apache", ".", "storm", ".", "blobstore", ".", "BlobStore", ";", "import", "org", ".", "apache", ".", "storm", ".", "callback", ".", "DefaultWatcherCallBack", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "ClusterUtils", ";", "import", "org", ".", "apache", ".", "storm", ".", "cluster", ".", "DaemonType", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "KeyNotFoundException", ";", "import", "org", ".", "apache", ".", "storm", ".", "generated", ".", "WorkerTokenServiceType", ";", "import", "org", ".", "apache", ".", "storm", ".", "nimbus", ".", "NimbusInfo", ";", "import", "org", ".", "apache", ".", "storm", ".", "security", ".", "auth", ".", "NimbusPrincipal", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "ObjectReader", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "ServerUtils", ";", "import", "org", ".", "apache", ".", "storm", ".", "utils", ".", "Utils", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "KeeperException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "ZooDefs", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "data", ".", "ACL", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "data", ".", "Id", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "auth", ".", "DigestAuthenticationProvider", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "This", "is", "code", "intended", "to", "enforce", "ZK", "ACLs", ".", "*", "/", "public", "class", "AclEnforcement", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "AclEnforcement", ".", "class", ")", ";", "/", "**", "*", "Verify", "the", "ZK", "ACLs", "are", "correct", "and", "optionally", "fix", "them", "if", "needed", ".", "*", "@", "param", "conf", "the", "cluster", "config", ".", "*", "@", "param", "fixUp", "true", "if", "we", "want", "to", "fix", "the", "ACLs", "else", "false", ".", "*", "@", "throws", "Exception", "on", "any", "error", ".", "*", "/", "public", "static", "void", "verifyAcls", "(", "Map", "<", "String", ",", "Object", ">", "conf", ",", "final", "boolean", "fixUp", ")", "throws", "Exception", "{", "if", "(", "!", "Utils", ".", "isZkAuthenticationConfiguredStormServer", "(", "conf", ")", ")", "{", "LOG", ".", "info", "(", "\"", "SECURITY", "IS", "DISABLED", "NO", "FURTHER", "CHECKS", ".", "..", "\")", ";", "/", "/", "There", "is", "no", "security", "so", "we", "are", "done", ".", "return", ";", "}", "ACL", "superUserAcl", "=", "Utils", ".", "getSuperUserAcl", "(", "conf", ")", ";", "List", "<", "ACL", ">", "superAcl", "=", "new", "ArrayList", "<", ">(", "1", ")", ";", "superAcl", ".", "add", "(", "superUserAcl", ")", ";", "List", "<", "ACL", ">", "drpcFullAcl", "=", "new", "ArrayList", "<", ">(", "2", ")", ";", "drpcFullAcl", ".", "add", "(", "superUserAcl", ")", ";", "String", "drpcAclString", "=", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_DRPC_ACL", ")", ";", "if", "(", "drpcAclString", "!", "=", "null", ")", "{", "Id", "drpcAclId", "=", "Utils", ".", "parseZkId", "(", "drpcAclString", ",", "Config", ".", "STORM_ZOOKEEPER_DRPC_ACL", ")", ";", "ACL", "drpcUserAcl", "=", "new", "ACL", "(", "ZooDefs", ".", "Perms", ".", "READ", ",", "drpcAclId", ")", ";", "drpcFullAcl", ".", "add", "(", "drpcUserAcl", ")", ";", "}", "List", "<", "String", ">", "zkServers", "=", "(", "List", "<", "String", ">", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_SERVERS", ")", ";", "int", "port", "=", "ObjectReader", ".", "getInt", "(", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_PORT", ")", ");", "String", "stormRoot", "=", "(", "String", ")", "conf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_ROOT", ")", ";", "try", "(", "CuratorFramework", "zk", "=", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "zkServers", ",", "port", ",", "\"", "\",", "new", "DefaultWatcherCallBack", "(", "),", "conf", ",", "DaemonType", ".", "NIMBUS", ")", ")", "{", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "stormRoot", ")", "!", "=", "null", ")", "{", "/", "/", "First", "off", "we", "want", "to", "verify", "that", "ROOT", "is", "good", "verifyAclStrict", "(", "zk", ",", "superAcl", ",", "stormRoot", ",", "fixUp", ")", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"{", "}", "does", "not", "exist", "no", "need", "to", "check", "any", "more", ".", "..", "\",", "stormRoot", ")", ";", "return", ";", "}", "}", "/", "/", "Now", "that", "the", "root", "is", "fine", "we", "can", "start", "to", "look", "at", "the", "other", "paths", "under", "it", ".", "try", "(", "CuratorFramework", "zk", "=", "ClientZookeeper", ".", "mkClient", "(", "conf", ",", "zkServers", ",", "port", ",", "stormRoot", ",", "new", "DefaultWatcherCallBack", "(", "),", "conf", ",", "DaemonType", ".", "NIMBUS", ")", ")", "{", "/", "/", "Next", "verify", "that", "the", "blob", "store", "is", "correct", "before", "we", "start", "it", "up", ".", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "BLOBSTORE_SUBTREE", ")", "!", "=", "null", ")", "{", "verifyAclStrictRecursive", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "BLOBSTORE_SUBTREE", ",", "fixUp", ")", ";", "}", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "BLOBSTORE_MAX_KEY_SEQUENCE_NUMBER_SUBTREE", ")", "!", "=", "null", ")", "{", "verifyAclStrict", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "BLOBSTORE_MAX_KEY_SEQUENCE_NUMBER_SUBTREE", ",", "fixUp", ")", ";", "}", "/", "/", "The", "blobstore", "is", "good", ",", "now", "lets", "get", "the", "list", "of", "all", "topo", "Ids", "Set", "<", "String", ">", "topoIds", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "STORMS_SUBTREE", ")", "!", "=", "null", ")", "{", "topoIds", ".", "addAll", "(", "zk", ".", "getChildren", "(", ").", "forPath", "(", "ClusterUtils", ".", "STORMS_SUBTREE", ")", ");", "}", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", "=", "new", "HashMap", "<", ">(", ");", "/", "/", "Now", "lets", "get", "the", "creds", "for", "the", "topos", "so", "we", "can", "verify", "those", "as", "well", ".", "BlobStore", "bs", "=", "ServerUtils", ".", "getNimbusBlobStore", "(", "conf", ",", "NimbusInfo", ".", "fromConf", "(", "conf", ")", ");", "try", "{", "Subject", "nimbusSubject", "=", "new", "Subject", "(", ");", "nimbusSubject", ".", "getPrincipals", "(", ").", "add", "(", "new", "NimbusPrincipal", "(", "))", ";", "for", "(", "String", "topoId", ":", "topoIds", ")", "{", "try", "{", "String", "blobKey", "=", "topoId", "+", "\"", "-", "stormconf", ".", "ser", "\"", ";", "Map", "<", "String", ",", "Object", ">", "topoConf", "=", "Utils", ".", "fromCompressedJsonConf", "(", "bs", ".", "readBlob", "(", "blobKey", ",", "nimbusSubject", ")", ");", "String", "payload", "=", "(", "String", ")", "topoConf", ".", "get", "(", "Config", ".", "STORM_ZOOKEEPER_TOPOLOGY_AUTH_PAYLOAD", ")", ";", "try", "{", "topoToZkCreds", ".", "put", "(", "topoId", ",", "new", "Id", "(", "\"", "digest", "\"", ",", "DigestAuthenticationProvider", ".", "generateDigest", "(", "payload", ")", "))", ";", "}", "catch", "(", "NoSuchAlgorithmException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "catch", "(", "KeyNotFoundException", "knf", ")", "{", "LOG", ".", "debug", "(", "\"", "topo", "removed", "{", "}\"", ",", "topoId", ",", "knf", ")", ";", "}", "}", "}", "finally", "{", "if", "(", "bs", "!", "=", "null", ")", "{", "bs", ".", "shutdown", "(", ");", "}", "}", "verifyParentWithReadOnlyTopoChildren", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "STORMS_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "verifyParentWithReadOnlyTopoChildren", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "ASSIGNMENTS_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "/", "/", "There", "is", "a", "race", "on", "credentials", "where", "they", "can", "be", "leaked", "in", "some", "versions", "of", "storm", ".", "verifyParentWithReadOnlyTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "CREDENTIALS_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "/", "/", "There", "is", "a", "race", "on", "logconfig", "where", "they", "can", "be", "leaked", "in", "some", "versions", "of", "storm", ".", "verifyParentWithReadOnlyTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "LOGCONFIG_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "/", "/", "There", "is", "a", "race", "on", "backpressure", "too", ".", "..", "verifyParentWithReadWriteTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "BACKPRESSURE_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "ERRORS_SUBTREE", ")", "!", "=", "null", ")", "{", "/", "/", "errors", "is", "a", "bit", "special", "because", "in", "older", "versions", "of", "storm", "the", "worker", "created", "the", "parent", "directories", "lazily", "/", "/", "because", "of", "this", "it", "means", "we", "need", "to", "auto", "create", "at", "least", "the", "topo", "-", "id", "directory", "for", "all", "running", "topos", ".", "for", "(", "String", "topoId", ":", "topoToZkCreds", ".", "keySet", "(", "))", "{", "String", "path", "=", "ClusterUtils", ".", "errorStormRoot", "(", "topoId", ")", ";", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "path", ")", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "Creating", "missing", "errors", "location", "{", "}\"", ",", "path", ")", ";", "zk", ".", "create", "(", ").", "withACL", "(", "getTopoReadWrite", "(", "path", ",", "topoId", ",", "topoToZkCreds", ",", "superUserAcl", ",", "fixUp", ")", ").", "forPath", "(", "path", ")", ";", "}", "}", "}", "/", "/", "Error", "should", "not", "be", "leaked", "according", "to", "the", "code", ",", "but", "they", "are", "not", "important", "enough", "to", "fail", "the", "build", "if", "/", "/", "for", "some", "odd", "reason", "they", "are", "leaked", ".", "verifyParentWithReadWriteTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "ERRORS_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "SECRET_KEYS_SUBTREE", ")", "!", "=", "null", ")", "{", "verifyAclStrict", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "SECRET_KEYS_SUBTREE", ",", "fixUp", ")", ";", "verifyAclStrictRecursive", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "secretKeysPath", "(", "WorkerTokenServiceType", ".", "NIMBUS", ")", ",", "fixUp", ")", ";", "verifyAclStrictRecursive", "(", "zk", ",", "drpcFullAcl", ",", "ClusterUtils", ".", "secretKeysPath", "(", "WorkerTokenServiceType", ".", "DRPC", ")", ",", "fixUp", ")", ";", "}", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "NIMBUSES_SUBTREE", ")", "!", "=", "null", ")", "{", "verifyAclStrictRecursive", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "NIMBUSES_SUBTREE", ",", "fixUp", ")", ";", "}", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "\"/", "leader", "-", "lock", "\"", ")", "!", "=", "null", ")", "{", "verifyAclStrictRecursive", "(", "zk", ",", "superAcl", ",", "\"", "/", "leader", "-", "lock", "\"", ",", "fixUp", ")", ";", "}", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "PROFILERCONFIG_SUBTREE", ")", "!", "=", "null", ")", "{", "verifyAclStrictRecursive", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "PROFILERCONFIG_SUBTREE", ",", "fixUp", ")", ";", "}", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "ClusterUtils", ".", "SUPERVISORS_SUBTREE", ")", "!", "=", "null", ")", "{", "verifyAclStrictRecursive", "(", "zk", ",", "superAcl", ",", "ClusterUtils", ".", "SUPERVISORS_SUBTREE", ",", "fixUp", ")", ";", "}", "/", "/", "When", "moving", "to", "pacemaker", "workerbeats", "can", "be", "leaked", "too", ".", "..", "verifyParentWithReadWriteTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "ClusterUtils", ".", "WORKERBEATS_SUBTREE", ",", "topoToZkCreds", ",", "fixUp", ")", ";", "}", "}", "private", "static", "List", "<", "ACL", ">", "getTopoAcl", "(", "String", "path", ",", "String", "topoId", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "ACL", "superAcl", ",", "boolean", "fixUp", ",", "int", "perms", ")", "{", "Id", "id", "=", "topoToZkCreds", ".", "get", "(", "topoId", ")", ";", "if", "(", "id", "=", "=", "null", ")", "{", "String", "error", "=", "\"", "Could", "not", "find", "credentials", "for", "topology", "\"", "+", "topoId", "+", "\"", "at", "path", "\"", "+", "path", "+", "\"", ".\"", ";", "if", "(", "fixUp", ")", "{", "error", "+", "=", "\"", "Don", "'", "t", "know", "how", "to", "fix", "this", "automatically", ".", "Please", "add", "needed", "ACLs", ",", "or", "delete", "the", "path", ".", "\";", "}", "throw", "new", "IllegalStateException", "(", "error", ")", ";", "}", "List", "<", "ACL", ">", "ret", "=", "new", "ArrayList", "<", ">(", "2", ")", ";", "ret", ".", "add", "(", "superAcl", ")", ";", "ret", ".", "add", "(", "new", "ACL", "(", "perms", ",", "id", ")", ");", "return", "ret", ";", "}", "private", "static", "List", "<", "ACL", ">", "getTopoReadWrite", "(", "String", "path", ",", "String", "topoId", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "ACL", "superAcl", ",", "boolean", "fixUp", ")", "{", "return", "getTopoAcl", "(", "path", ",", "topoId", ",", "topoToZkCreds", ",", "superAcl", ",", "fixUp", ",", "ZooDefs", ".", "Perms", ".", "ALL", ")", ";", "}", "private", "static", "void", "verifyParentWithTopoChildrenDeleteDead", "(", "CuratorFramework", "zk", ",", "ACL", "superUserAcl", ",", "String", "path", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "boolean", "fixUp", ",", "int", "perms", ")", "throws", "Exception", "{", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "path", ")", "!", "=", "null", ")", "{", "verifyAclStrict", "(", "zk", ",", "Arrays", ".", "asList", "(", "superUserAcl", ")", ",", "path", ",", "fixUp", ")", ";", "Set", "<", "String", ">", "possiblyBadIds", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "String", "topoId", ":", "zk", ".", "getChildren", "(", ").", "forPath", "(", "path", ")", ")", "{", "String", "childPath", "=", "path", "+", "ClusterUtils", ".", "ZK_SEPERATOR", "+", "topoId", ";", "if", "(", "!", "topoToZkCreds", ".", "containsKey", "(", "topoId", ")", ")", "{", "/", "/", "Save", "it", "to", "try", "again", "later", ".", "..", "possiblyBadIds", ".", "add", "(", "topoId", ")", ";", "}", "else", "{", "List", "<", "ACL", ">", "rwAcl", "=", "getTopoAcl", "(", "path", ",", "topoId", ",", "topoToZkCreds", ",", "superUserAcl", ",", "fixUp", ",", "perms", ")", ";", "verifyAclStrictRecursive", "(", "zk", ",", "rwAcl", ",", "childPath", ",", "fixUp", ")", ";", "}", "}", "if", "(", "!", "possiblyBadIds", ".", "isEmpty", "(", "))", "{", "/", "/", "Lets", "reread", "the", "children", "in", "STORMS", "as", "the", "source", "of", "truth", "and", "see", "if", "a", "new", "one", "was", "created", "in", "the", "background", "possiblyBadIds", ".", "removeAll", "(", "zk", ".", "getChildren", "(", ").", "forPath", "(", "ClusterUtils", ".", "STORMS_SUBTREE", ")", ");", "for", "(", "String", "topoId", ":", "possiblyBadIds", ")", "{", "/", "/", "Now", "we", "know", "for", "sure", "that", "this", "is", "a", "bad", "id", "String", "childPath", "=", "path", "+", "ClusterUtils", ".", "ZK_SEPERATOR", "+", "topoId", ";", "zk", ".", "delete", "(", ").", "deletingChildrenIfNeeded", "(", ").", "forPath", "(", "childPath", ")", ";", "}", "}", "}", "}", "private", "static", "void", "verifyParentWithReadOnlyTopoChildrenDeleteDead", "(", "CuratorFramework", "zk", ",", "ACL", "superUserAcl", ",", "String", "path", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "boolean", "fixUp", ")", "throws", "Exception", "{", "verifyParentWithTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "path", ",", "topoToZkCreds", ",", "fixUp", ",", "ZooDefs", ".", "Perms", ".", "READ", ")", ";", "}", "private", "static", "void", "verifyParentWithReadWriteTopoChildrenDeleteDead", "(", "CuratorFramework", "zk", ",", "ACL", "superUserAcl", ",", "String", "path", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "boolean", "fixUp", ")", "throws", "Exception", "{", "verifyParentWithTopoChildrenDeleteDead", "(", "zk", ",", "superUserAcl", ",", "path", ",", "topoToZkCreds", ",", "fixUp", ",", "ZooDefs", ".", "Perms", ".", "ALL", ")", ";", "}", "private", "static", "void", "verifyParentWithTopoChildren", "(", "CuratorFramework", "zk", ",", "ACL", "superUserAcl", ",", "String", "path", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "boolean", "fixUp", ",", "int", "perms", ")", "throws", "Exception", "{", "if", "(", "zk", ".", "checkExists", "(", ").", "forPath", "(", "path", ")", "!", "=", "null", ")", "{", "verifyAclStrict", "(", "zk", ",", "Arrays", ".", "asList", "(", "superUserAcl", ")", ",", "path", ",", "fixUp", ")", ";", "for", "(", "String", "topoId", ":", "zk", ".", "getChildren", "(", ").", "forPath", "(", "path", ")", ")", "{", "String", "childPath", "=", "path", "+", "ClusterUtils", ".", "ZK_SEPERATOR", "+", "topoId", ";", "List", "<", "ACL", ">", "rwAcl", "=", "getTopoAcl", "(", "path", ",", "topoId", ",", "topoToZkCreds", ",", "superUserAcl", ",", "fixUp", ",", "perms", ")", ";", "verifyAclStrictRecursive", "(", "zk", ",", "rwAcl", ",", "childPath", ",", "fixUp", ")", ";", "}", "}", "}", "private", "static", "void", "verifyParentWithReadOnlyTopoChildren", "(", "CuratorFramework", "zk", ",", "ACL", "superUserAcl", ",", "String", "path", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "boolean", "fixUp", ")", "throws", "Exception", "{", "verifyParentWithTopoChildren", "(", "zk", ",", "superUserAcl", ",", "path", ",", "topoToZkCreds", ",", "fixUp", ",", "ZooDefs", ".", "Perms", ".", "READ", ")", ";", "}", "private", "static", "void", "verifyParentWithReadWriteTopoChildren", "(", "CuratorFramework", "zk", ",", "ACL", "superUserAcl", ",", "String", "path", ",", "Map", "<", "String", ",", "Id", ">", "topoToZkCreds", ",", "boolean", "fixUp", ")", "throws", "Exception", "{", "verifyParentWithTopoChildren", "(", "zk", ",", "superUserAcl", ",", "path", ",", "topoToZkCreds", ",", "fixUp", ",", "ZooDefs", ".", "Perms", ".", "ALL", ")", ";", "}", "private", "static", "void", "verifyAclStrictRecursive", "(", "CuratorFramework", "zk", ",", "List", "<", "ACL", ">", "strictAcl", ",", "String", "path", ",", "boolean", "fixUp", ")", "throws", "Exception", "{", "verifyAclStrict", "(", "zk", ",", "strictAcl", ",", "path", ",", "fixUp", ")", ";", "for", "(", "String", "child", ":", "zk", ".", "getChildren", "(", ").", "forPath", "(", "path", ")", ")", "{", "String", "newPath", "=", "path", "+", "ClusterUtils", ".", "ZK_SEPERATOR", "+", "child", ";", "verifyAclStrictRecursive", "(", "zk", ",", "strictAcl", ",", "newPath", ",", "fixUp", ")", ";", "}", "}", "private", "static", "void", "verifyAclStrict", "(", "CuratorFramework", "zk", ",", "List", "<", "ACL", ">", "strictAcl", ",", "String", "path", ",", "boolean", "fixUp", ")", "throws", "Exception", "{", "try", "{", "List", "<", "ACL", ">", "foundAcl", "=", "zk", ".", "getACL", "(", ").", "forPath", "(", "path", ")", ";", "if", "(", "!", "equivalent", "(", "foundAcl", ",", "strictAcl", ")", ")", "{", "if", "(", "fixUp", ")", "{", "LOG", ".", "warn", "(", "\"{", "}", "expected", "to", "have", "ACL", "{", "},", "but", "has", "{", "}.", "Fixing", ".", "..", "\",", "path", ",", "strictAcl", ",", "foundAcl", ")", ";", "zk", ".", "setACL", "(", ").", "withACL", "(", "strictAcl", ")", ".", "forPath", "(", "path", ")", ";", "}", "else", "{", "throw", "new", "IllegalStateException", "(", "path", "+", "\"", "did", "not", "have", "the", "correct", "ACL", "found", "\"", "+", "foundAcl", "+", "\"", "expected", "\"", "+", "strictAcl", ")", ";", "}", "}", "}", "catch", "(", "KeeperException", ".", "NoNodeException", "ne", ")", "{", "LOG", ".", "debug", "(", "\"{", "}", "removed", "in", "the", "middle", "of", "checking", "it", "\"", ",", "ne", ")", ";", "}", "}", "private", "static", "boolean", "equivalent", "(", "List", "<", "ACL", ">", "a", ",", "List", "<", "ACL", ">", "b", ")", "{", "if", "(", "a", ".", "size", "(", ")", "=", "=", "b", ".", "size", "(", "))", "{", "for", "(", "ACL", "aAcl", ":", "a", ")", "{", "if", "(", "!", "b", ".", "contains", "(", "aAcl", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "return", "false", ";", "}", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "Object", ">", "conf", "=", "Utils", ".", "readStormConfig", "(", ");", "boolean", "fixUp", "=", "false", ";", "for", "(", "String", "arg", ":", "args", ")", "{", "String", "a", "=", "arg", ".", "toLowerCase", "(", ");", "if", "(", "\"-", "f", "\"", ".", "equals", "(", "a", ")", "|", "|", "\"", "--", "fixup", "\"", ".", "equals", "(", "a", ")", ")", "{", "fixUp", "=", "true", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Unsupported", "argument", "\"", "+", "arg", "+", "\"", "only", "-", "f", "or", "-", "-", "fixup", "is", "supported", ".", "\")", ";", "}", "}", "verifyAcls", "(", "conf", ",", "fixUp", ")", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["execute", "arbitrary", "code", "as", "a", "different", "user", "on", "the", "system"]}
{"contents": ["xfs:", "validate", "acl", "count", "This", "prevents", "in-memory", "corruption", "and", "possible", "panics", "if", "the", "on-disk", "ACL", "is", "badly", "corrupted.", "Signed-off-by:", "Christoph", "Hellwig", "<hch@lst.de>", "Signed-off-by:", "Ben", "Myers", "<bpm@sgi.com>"], "code_tokens": ["@", "@", "-", "42", ",", "6", "+", "42", ",", "8", "@", "@", "xfs_acl_from_disk", "(", "struct", "xfs_acl", "*", "aclp", ")", "int", "count", ",", "i", ";", "count", "=", "be32_to_cpu", "(", "aclp", "-", ">", "acl_cnt", ")", ";", "if", "(", "count", ">", "XFS_ACL_MAX_ENTRIES", ")", "return", "ERR_PTR", "(", "-", "EFSCORRUPTED", ")", ";", "acl", "=", "posix_acl_alloc", "(", "count", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "acl", ")"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["ALSA:", "rawmidi:", "Change", "resized", "buffers", "atomically", "The", "SNDRV_RAWMIDI_IOCTL_PARAMS", "ioctl", "may", "resize", "the", "buffers", "and", "the", "current", "code", "is", "racy.", "For", "example,", "the", "sequencer", "client", "may", "write", "to", "buffer", "while", "it", "being", "resized.", "As", "a", "simple", "workaround,", "let's", "switch", "to", "the", "resized", "buffer", "inside", "the", "stream", "runtime", "lock.", "Reported-by:", "syzbot+52f83f0ea8df16932f7f@syzkaller.appspotmail.com", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "635", ",", "7", "+", "635", ",", "7", "@", "@", "static", "int", "snd_rawmidi_info_select_user", "(", "struct", "snd_card", "*", "card", ",", "int", "snd_rawmidi_output_params", "(", "struct", "snd_rawmidi_substream", "*", "substream", ",", "struct", "snd_rawmidi_params", "*", "params", ")", "{", "char", "*", "newbuf", ";", "char", "*", "newbuf", ",", "*", "oldbuf", ";", "struct", "snd_rawmidi_runtime", "*", "runtime", "=", "substream", "-", ">", "runtime", ";", "if", "(", "substream", "-", ">", "append", "&", "&", "substream", "-", ">", "use_count", ">", "1", ")", "@", "@", "-", "648", ",", "13", "+", "648", ",", "17", "@", "@", "int", "snd_rawmidi_output_params", "(", "struct", "snd_rawmidi_substream", "*", "substream", ",", "return", "-", "EINVAL", ";", "}", "if", "(", "params", "-", ">", "buffer_size", "!", "=", "runtime", "-", ">", "buffer_size", ")", "{", "newbuf", "=", "krealloc", "(", "runtime", "-", ">", "buffer", ",", "params", "-", ">", "buffer_size", ",", "GFP_KERNEL", ")", ";", "newbuf", "=", "kmalloc", "(", "params", "-", ">", "buffer_size", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "newbuf", ")", "return", "-", "ENOMEM", ";", "spin_lock_irq", "(", "&", "runtime", "-", ">", "lock", ")", ";", "oldbuf", "=", "runtime", "-", ">", "buffer", ";", "runtime", "-", ">", "buffer", "=", "newbuf", ";", "runtime", "-", ">", "buffer_size", "=", "params", "-", ">", "buffer_size", ";", "runtime", "-", ">", "avail", "=", "runtime", "-", ">", "buffer_size", ";", "runtime", "-", ">", "appl_ptr", "=", "runtime", "-", ">", "hw_ptr", "=", "0", ";", "spin_unlock_irq", "(", "&", "runtime", "-", ">", "lock", ")", ";", "kfree", "(", "oldbuf", ")", ";", "}", "runtime", "-", ">", "avail_min", "=", "params", "-", ">", "avail_min", ";", "substream", "-", ">", "active_sensing", "=", "!", "params", "-", ">", "no_active_sensing", ";", "@", "@", "-", "665", ",", "7", "+", "669", ",", "7", "@", "@", "EXPORT_SYMBOL", "(", "snd_rawmidi_output_params", ")", ";", "int", "snd_rawmidi_input_params", "(", "struct", "snd_rawmidi_substream", "*", "substream", ",", "struct", "snd_rawmidi_params", "*", "params", ")", "{", "char", "*", "newbuf", ";", "char", "*", "newbuf", ",", "*", "oldbuf", ";", "struct", "snd_rawmidi_runtime", "*", "runtime", "=", "substream", "-", ">", "runtime", ";", "snd_rawmidi_drain_input", "(", "substream", ")", ";", "@", "@", "-", "676", ",", "12", "+", "680", ",", "16", "@", "@", "int", "snd_rawmidi_input_params", "(", "struct", "snd_rawmidi_substream", "*", "substream", ",", "return", "-", "EINVAL", ";", "}", "if", "(", "params", "-", ">", "buffer_size", "!", "=", "runtime", "-", ">", "buffer_size", ")", "{", "newbuf", "=", "krealloc", "(", "runtime", "-", ">", "buffer", ",", "params", "-", ">", "buffer_size", ",", "GFP_KERNEL", ")", ";", "newbuf", "=", "kmalloc", "(", "params", "-", ">", "buffer_size", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "newbuf", ")", "return", "-", "ENOMEM", ";", "spin_lock_irq", "(", "&", "runtime", "-", ">", "lock", ")", ";", "oldbuf", "=", "runtime", "-", ">", "buffer", ";", "runtime", "-", ">", "buffer", "=", "newbuf", ";", "runtime", "-", ">", "buffer_size", "=", "params", "-", ">", "buffer_size", ";", "runtime", "-", ">", "appl_ptr", "=", "runtime", "-", ">", "hw_ptr", "=", "0", ";", "spin_unlock_irq", "(", "&", "runtime", "-", ">", "lock", ")", ";", "kfree", "(", "oldbuf", ")", ";", "}", "runtime", "-", ">", "avail_min", "=", "params", "-", ">", "avail_min", ";", "return", "0", ";"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["KVM:", "Fix", "stack-out-of-bounds", "read", "in", "write_mmio", "Reported", "by", "syzkaller:", "BUG:", "KASAN:", "stack-out-of-bounds", "in", "write_mmio+0x11e/0x270", "[kvm]", "Read", "of", "size", "8", "at", "addr", "ffff8803259df7f8", "by", "task", "syz-executor/32298", "CPU:", "6", "PID:", "32298", "Comm:", "syz-executor", "Tainted:", "G", "OE", "4.15.0-rc2+", "#18", "Hardware", "name:", "LENOVO", "ThinkCentre", "M8500t-N000/SHARKBAY,", "BIOS", "FBKTC1AUS", "02/16/2016", "Call", "Trace:", "dump_stack+0xab/0xe1", "print_address_description+0x6b/0x290", "kasan_report+0x28a/0x370", "write_mmio+0x11e/0x270", "[kvm]", "emulator_read_write_onepage+0x311/0x600", "[kvm]", "emulator_read_write+0xef/0x240", "[kvm]", "emulator_fix_hypercall+0x105/0x150", "[kvm]", "em_hypercall+0x2b/0x80", "[kvm]", "x86_emulate_insn+0x2b1/0x1640", "[kvm]", "x86_emulate_instruction+0x39a/0xb90", "[kvm]", "handle_exception+0x1b4/0x4d0", "[kvm_intel]", "vcpu_enter_guest+0x15a0/0x2640", "[kvm]", "kvm_arch_vcpu_ioctl_run+0x549/0x7d0", "[kvm]", "kvm_vcpu_ioctl+0x479/0x880", "[kvm]", "do_vfs_ioctl+0x142/0x9a0", "SyS_ioctl+0x74/0x80", "entry_SYSCALL_64_fastpath+0x23/0x9a", "The", "path", "of", "patched", "vmmcall", "will", "patch", "3", "bytes", "opcode", "0F", "01", "C1(vmcall)", "to", "the", "guest", "memory,", "however,", "write_mmio", "tracepoint", "always", "prints", "8", "bytes", "through", "*(u64", "*)val", "since", "kvm", "splits", "the", "mmio", "access", "into", "8", "bytes.", "This", "leaks", "5", "bytes", "from", "the", "kernel", "stack", "(", ").", "This", "patch", "fixes", "it", "by", "just", "accessing", "the", "bytes", "which", "we", "operate", "on.", "Before", "patch:", "syz-executor-5567", "[007]", "....", "51370.561696:", "kvm_mmio:", "mmio", "write", "len", "3", "gpa", "0x10", "val", "0x1ffff10077c1010f", "After", "patch:", "syz-executor-13416", "[002]", "....", "51302.299573:", "kvm_mmio:", "mmio", "write", "len", "3", "gpa", "0x10", "val", "0xc1010f", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Reviewed-by:", "Darren", "Kenny", "<darren.kenny@oracle.com>", "Reviewed-by:", "Marc", "Zyngier", "<marc.zyngier@arm.com>", "Tested-by:", "Marc", "Zyngier", "<marc.zyngier@arm.com>", "Cc:", "Paolo", "Bonzini", "<pbonzini@redhat.com>", "Cc:", "Radim", "Kr\u010dm\u00e1\u0159", "<rkrcmar@redhat.com>", "Cc:", "Marc", "Zyngier", "<marc.zyngier@arm.com>", "Cc:", "Christoffer", "Dall", "<christoffer.dall@linaro.org>", "Signed-off-by:", "Wanpeng", "Li", "<wanpeng.li@hotmail.com>", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["@", "@", "-", "4384", ",", "7", "+", "4384", ",", "7", "@", "@", "static", "int", "vcpu_mmio_read", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "addr", ",", "int", "len", ",", "void", "*", "v", ")", "addr", ",", "n", ",", "v", ")", ")", "&", "&", "kvm_io_bus_read", "(", "vcpu", ",", "KVM_MMIO_BUS", ",", "addr", ",", "n", ",", "v", ")", ")", "break", ";", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ", ",", "n", ",", "addr", ",", "*", "(", "u64", "*", ")", "v", ")", ";", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ", ",", "n", ",", "addr", ",", "v", ")", ";", "handled", "+", "=", "n", ";", "addr", "+", "=", "n", ";", "len", "-", "=", "n", ";", "@", "@", "-", "4643", ",", "7", "+", "4643", ",", "7", "@", "@", "static", "int", "read_prepare", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "void", "*", "val", ",", "int", "bytes", ")", "{", "if", "(", "vcpu", "-", ">", "mmio_read_completed", ")", "{", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ", ",", "bytes", ",", "vcpu", "-", ">", "mmio_fragments", "[", "0", "]", ".", "gpa", ",", "*", "(", "u64", "*", ")", "val", ")", ";", "vcpu", "-", ">", "mmio_fragments", "[", "0", "]", ".", "gpa", ",", "val", ")", ";", "vcpu", "-", ">", "mmio_read_completed", "=", "0", ";", "return", "1", ";", "}", "@", "@", "-", "4665", ",", "14", "+", "4665", ",", "14", "@", "@", "static", "int", "write_emulate", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "gpa", ",", "static", "int", "write_mmio", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "gpa", ",", "int", "bytes", ",", "void", "*", "val", ")", "{", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_WRITE", ",", "bytes", ",", "gpa", ",", "*", "(", "u64", "*", ")", "val", ")", ";", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_WRITE", ",", "bytes", ",", "gpa", ",", "val", ")", ";", "return", "vcpu_mmio_write", "(", "vcpu", ",", "gpa", ",", "bytes", ",", "val", ")", ";", "}", "static", "int", "read_exit_mmio", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "gpa", ",", "void", "*", "val", ",", "int", "bytes", ")", "{", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ_UNSATISFIED", ",", "bytes", ",", "gpa", ",", "0", ")", ";", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ_UNSATISFIED", ",", "bytes", ",", "gpa", ",", "NULL", ")", ";", "return", "X86EMUL_IO_NEEDED", ";", "}", "@", "@", "-", "211", ",", "7", "+", "211", ",", "7", "@", "@", "TRACE_EVENT", "(", "kvm_ack_irq", ",", "{", "KVM_TRACE_MMIO_WRITE", ",", "\"", "write", "\"", "}", "TRACE_EVENT", "(", "kvm_mmio", ",", "TP_PROTO", "(", "int", "type", ",", "int", "len", ",", "u64", "gpa", ",", "u64", "val", ")", ",", "TP_PROTO", "(", "int", "type", ",", "int", "len", ",", "u64", "gpa", ",", "void", "*", "val", ")", ",", "TP_ARGS", "(", "type", ",", "len", ",", "gpa", ",", "val", ")", ",", "TP_STRUCT__entry", "(", "@", "@", "-", "225", ",", "7", "+", "225", ",", "10", "@", "@", "TRACE_EVENT", "(", "kvm_mmio", ",", "__entry", "-", ">", "type", "=", "type", ";", "__entry", "-", ">", "len", "=", "len", ";", "__entry", "-", ">", "gpa", "=", "gpa", ";", "__entry", "-", ">", "val", "=", "val", ";", "__entry", "-", ">", "val", "=", "0", ";", "if", "(", "val", ")", "memcpy", "(", "&", "__entry", "-", ">", "val", ",", "val", ",", "min_t", "(", "u32", ",", "sizeof", "(", "__entry", "-", ">", "val", ")", ",", "len", ")", ");", ")", ",", "TP_printk", "(", "\"", "mmio", "%", "s", "len", "%", "u", "gpa", "0x", "%", "llx", "val", "0x", "%", "llx", "\"", ",", "@", "@", "-", "112", ",", "7", "+", "112", ",", "7", "@", "@", "int", "kvm_handle_mmio_return", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "struct", "kvm_run", "*", "run", ")", "}", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ", ",", "len", ",", "run", "-", ">", "mmio", ".", "phys_addr", ",", "data", ")", ";", "&", "data", ")", ";", "data", "=", "vcpu_data_host_to_guest", "(", "vcpu", ",", "data", ",", "len", ")", ";", "vcpu_set_reg", "(", "vcpu", ",", "vcpu", "-", ">", "arch", ".", "mmio_decode", ".", "rt", ",", "data", ")", ";", "}", "@", "@", "-", "182", ",", "14", "+", "182", ",", "14", "@", "@", "int", "io_mem_abort", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "struct", "kvm_run", "*", "run", ",", "data", "=", "vcpu_data_guest_to_host", "(", "vcpu", ",", "vcpu_get_reg", "(", "vcpu", ",", "rt", ")", ",", "len", ")", ";", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_WRITE", ",", "len", ",", "fault_ipa", ",", "data", ")", ";", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_WRITE", ",", "len", ",", "fault_ipa", ",", "&", "data", ")", ";", "kvm_mmio_write_buf", "(", "data_buf", ",", "len", ",", "data", ")", ";", "ret", "=", "kvm_io_bus_write", "(", "vcpu", ",", "KVM_MMIO_BUS", ",", "fault_ipa", ",", "len", ",", "data_buf", ")", ";", "}", "else", "{", "trace_kvm_mmio", "(", "KVM_TRACE_MMIO_READ_UNSATISFIED", ",", "len", ",", "fault_ipa", ",", "0", ")", ";", "fault_ipa", ",", "NULL", ")", ";", "ret", "=", "kvm_io_bus_read", "(", "vcpu", ",", "KVM_MMIO_BUS", ",", "fault_ipa", ",", "len", ",", "data_buf", ")", ";"], "docstring_tokens": ["obtain", "potentially", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["[SECURITY-85]", "Prevent", "tap-plugin", "from", "reading", "files", "outside", "of", "the", "workspace's", "tap", "directory"], "code_tokens": ["@", "@", "-", "56", ",", "6", "+", "56", ",", "7", "@", "@", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "import", "hudson", ".", "model", ".", "ModelObject", ";", "import", "hudson", ".", "tasks", ".", "test", ".", "TestObject", ";", "/", "**", "*", "@", "author", "Bruno", "P", ".", "Kinoshita", "-", "http", ":", "//", "www", ".", "kinoshita", ".", "eti", ".", "br", "@", "@", "-", "307", ",", "7", "+", "308", ",", "8", "@", "@", "public", "void", "doDownloadAttachment", "(", "StaplerRequest", "request", ",", "StaplerResponse", "respons", "String", "f", "=", "request", ".", "getParameter", "(", "\"", "f", "\"", ");", "String", "key", "=", "request", ".", "getParameter", "(", "\"", "key", "\"", ");", "try", "{", "FilePath", "tapDir", "=", "new", "FilePath", "(", "new", "FilePath", "(", "new", "File", "(", "build", ".", "getRootDir", "(", "),", "Constants", ".", "TAP_DIR_NAME", ")", "),", "f", ")", ";", "FilePath", "parent", "=", "new", "FilePath", "(", "new", "File", "(", "build", ".", "getRootDir", "(", "),", "Constants", ".", "TAP_DIR_NAME", ")", ");", "FilePath", "tapDir", "=", "parent", ".", "child", "(", "TestObject", ".", "safe", "(", "f", ")", ");", "ServletOutputStream", "sos", "=", "response", ".", "getOutputStream", "(", ");", "if", "(", "tapDir", ".", "exists", "(", "))", "{", "String", "tapStream", "=", "tapDir", ".", "readToString", "(", ");"], "docstring_tokens": ["read", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["sctp:", "Fix", "oops", "when", "INIT-ACK", "indicates", "that", "peer", "doesn't", "support", "AUTH", "If", "INIT-ACK", "is", "received", "with", "SupportedExtensions", "parameter", "which", "indicates", "that", "the", "peer", "does", "not", "support", "AUTH,", "the", "packet", "will", "be", "silently", "ignore,", "and", "sctp_process_init()", "do", "cleanup", "all", "of", "the", "transports", "in", "the", "association.", "When", "T1-Init", "timer", "is", "expires,", "OOPS", "happen", "while", "we", "try", "to", "choose", "a", "different", "init", "transport.", "The", "solution", "is", "to", "only", "clean", "up", "the", "non-active", "transports,", "i.e", "the", "ones", "that", "the", "peer", "added.", "However,", "that", "introduces", "a", "problem", "with", "sctp_connectx(),", "because", "we", "don't", "mark", "the", "proper", "state", "for", "the", "transports", "provided", "by", "the", "user.", "So,", "we'll", "simply", "mark", "user-provided", "transports", "as", "ACTIVE.", "That", "will", "allow", "INIT", "retransmissions", "to", "work", "properly", "in", "the", "sctp_connectx()", "context", "and", "prevent", "the", "crash.", "Signed-off-by:", "Vlad", "Yasevich", "<vladislav.yasevich@hp.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "599", ",", "11", "+", "599", ",", "12", "@", "@", "struct", "sctp_transport", "*", "sctp_assoc_add_peer", "(", "struct", "sctp_association", "*", "asoc", ",", "/", "*", "Check", "to", "see", "if", "this", "is", "a", "duplicate", ".", "*", "/", "peer", "=", "sctp_assoc_lookup_paddr", "(", "asoc", ",", "addr", ")", ";", "if", "(", "peer", ")", "{", "/", "*", "An", "UNKNOWN", "state", "is", "only", "set", "on", "transports", "added", "by", "*", "user", "in", "sctp_connectx", "(", ")", "call", ".", "Such", "transports", "should", "be", "*", "considered", "CONFIRMED", "per", "RFC", "4960", ",", "Section", "5", ".", "4", ".", "*", "/", "if", "(", "peer", "-", ">", "state", "=", "=", "SCTP_UNKNOWN", ")", "{", "if", "(", "peer_state", "=", "=", "SCTP_ACTIVE", ")", "peer", "-", ">", "state", "=", "SCTP_ACTIVE", ";", "if", "(", "peer_state", "=", "=", "SCTP_UNCONFIRMED", ")", "peer", "-", ">", "state", "=", "SCTP_UNCONFIRMED", ";", "peer", "-", ">", "state", "=", "SCTP_ACTIVE", ";", "}", "return", "peer", ";", "}", "@", "@", "-", "2321", ",", "12", "+", "2321", ",", "10", "@", "@", "int", "sctp_process_init", "(", "struct", "sctp_association", "*", "asoc", ",", "sctp_cid_t", "cid", ",", "/", "*", "Release", "the", "transport", "structures", ".", "*", "/", "list_for_each_safe", "(", "pos", ",", "temp", ",", "&", "asoc", "-", ">", "peer", ".", "transport_addr_list", ")", "{", "transport", "=", "list_entry", "(", "pos", ",", "struct", "sctp_transport", ",", "transports", ")", ";", "list_del_init", "(", "pos", ")", ";", "sctp_transport_free", "(", "transport", ")", ";", "if", "(", "transport", "-", ">", "state", "!", "=", "SCTP_ACTIVE", ")", "sctp_assoc_rm_peer", "(", "asoc", ",", "transport", ")", ";", "}", "asoc", "-", ">", "peer", ".", "transport_count", "=", "0", ";", "nomem", ":", "return", "0", ";", "}"], "docstring_tokens": ["a", "denial", "of", "service", "(OOPS", ")"]}
{"contents": ["[SECURITY-1901]"], "code_tokens": ["@", "@", "-", "29", ",", "20", "+", "29", ",", "20", "@", "@", "THE", "SOFTWARE", ".", "<", "j", ":", "when", "test", "=", "\"$", "{", "it", ".", "upstreamUrl", "!", "=", "null", "and", "app", ".", "getItemByFullName", "(", "it", ".", "upstreamProject", ")", "!=", "null", "}", "\">", "<", "j", ":", "choose", ">", "<", "j", ":", "when", "test", "=", "\"$", "{", "app", ".", "getItemByFullName", "(", "it", ".", "upstreamProject", ")", ".", "getBuildByNumber", "(", "it", ".", "upstreamBuild", ")", "!=", "null", "}", "\">", "<", "j", ":", "out", "value", "=", "\"$", "{%", "started_by_project", "(", "app", ".", "getItemByFullName", "(", "it", ".", "upstreamProject", ")", ".", "fullDisplayName", ",", "it", ".", "upstreamBuild", ".", "toString", "(", "),", "it", ".", "upstreamUrl", ",", "rootURL", ")", "}\"", "/>", "$", "{%", "started_by_project", "(", "app", ".", "getItemByFullName", "(", "it", ".", "upstreamProject", ")", ".", "fullDisplayName", ",", "it", ".", "upstreamBuild", ".", "toString", "(", "),", "it", ".", "upstreamUrl", ",", "rootURL", ")", "}", "<", "/", "j", ":", "when", ">", "<", "j", ":", "otherwise", ">", "<", "j", ":", "out", "value", "=", "\"$", "{%", "started_by_project_with_deleted_build", "(", "app", ".", "getItemByFullName", "(", "it", ".", "upstreamProject", ")", ".", "fullDisplayName", ",", "it", ".", "upstreamBuild", ".", "toString", "(", "),", "it", ".", "upstreamUrl", ",", "rootURL", ")", "}\"", "/>", "$", "{%", "started_by_project_with_deleted_build", "(", "app", ".", "getItemByFullName", "(", "it", ".", "upstreamProject", ")", ".", "fullDisplayName", ",", "it", ".", "upstreamBuild", ".", "toString", "(", "),", "it", ".", "upstreamUrl", ",", "rootURL", ")", "}", "<", "/", "j", ":", "otherwise", ">", "<", "/", "j", ":", "choose", ">", "<", "/", "j", ":", "when", ">", "<", "j", ":", "otherwise", ">", "<", "j", ":", "out", "value", "=", "\"$", "{", "it", ".", "shortDescription", "}", "\"/", ">", "$", "{", "it", ".", "shortDescription", "}", "<", "/", "j", ":", "otherwise", ">", "<", "/", "j", ":", "choose", ">", "<", "j", ":", "if", "test", "=", "\"$", "{!", "it", ".", "upstreamCauses", ".", "isEmpty", "(", ")}", "\">", "<", "br", "/", "><", "j", ":", "out", "value", "=", "\"$", "{%", "caused_by", "}", "\"", "/", ">", "<", "br", "/", ">$", "{%", "caused_by", "}", "<", "ul", ">", "<", "j", ":", "forEach", "var", "=", "\"", "c", "\"", "items", "=", "\"$", "{", "it", ".", "upstreamCauses", "}", "\">", "<", "li", ">", "<", "st", ":", "include", "page", "=", "\"", "description", ".", "jelly", "\"", "it", "=", "\"$", "{", "c", "}", "\"", "/", "><", "/", "li", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "167", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2020", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "hudson", ".", "tasks", ".", "BuildTrigger", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicBoolean", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "public", "class", "UpstreamCauseSEC1901Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1901", "\"", ")", "public", "void", "preventXssInUpstreamDisplayName", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setQuietPeriod", "(", "0", ")", ";", "FreeStyleProject", "up", "=", "j", ".", "createFreeStyleProject", "(", "\"", "up", "\"", ");", "up", ".", "setDisplayName", "(", "\"", "Up", "<", "script", ">", "alert", "(", "123", ")", "</", "script", ">", "Project", "\"", ");", "FreeStyleProject", "down", "=", "j", ".", "createFreeStyleProject", "(", "\"", "down", "\"", ");", "up", ".", "getPublishersList", "(", ").", "add", "(", "new", "BuildTrigger", "(", "down", ".", "getFullName", "(", "),", "false", ")", ");", "j", ".", "jenkins", ".", "rebuildDependencyGraph", "(", ");", "j", ".", "buildAndAssertSuccess", "(", "up", ")", ";", "FreeStyleBuild", "downBuild", "=", "this", ".", "waitForDownBuild", "(", "down", ")", ";", "ensureXssIsPrevented", "(", "downBuild", ")", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1901", "\"", ")", "public", "void", "preventXssInUpstreamDisplayName_deleted", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setQuietPeriod", "(", "0", ")", ";", "FreeStyleProject", "up", "=", "j", ".", "createFreeStyleProject", "(", "\"", "up", "\"", ");", "up", ".", "setDisplayName", "(", "\"", "Up", "<", "script", ">", "alert", "(", "123", ")", "</", "script", ">", "Project", "\"", ");", "FreeStyleProject", "down", "=", "j", ".", "createFreeStyleProject", "(", "\"", "down", "\"", ");", "up", ".", "getPublishersList", "(", ").", "add", "(", "new", "BuildTrigger", "(", "down", ".", "getFullName", "(", "),", "false", ")", ");", "j", ".", "jenkins", ".", "rebuildDependencyGraph", "(", ");", "FreeStyleBuild", "upBuild", "=", "j", ".", "buildAndAssertSuccess", "(", "up", ")", ";", "FreeStyleBuild", "downBuild", "=", "this", ".", "waitForDownBuild", "(", "down", ")", ";", "/", "/", "that", "will", "display", "a", "different", "part", "upBuild", ".", "delete", "(", ");", "ensureXssIsPrevented", "(", "downBuild", ")", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1901", "\"", ")", "public", "void", "preventXssInUpstreamShortDescription", "(", ")", "throws", "Exception", "{", "FullNameChangingProject", "up", "=", "j", ".", "createProject", "(", "FullNameChangingProject", ".", "class", ",", "\"", "up", "\"", ");", "FreeStyleProject", "down", "=", "j", ".", "createFreeStyleProject", "(", "\"", "down", "\"", ");", "CustomBuild", "upBuild", "=", "j", ".", "buildAndAssertSuccess", "(", "up", ")", ";", "up", ".", "setVirtualName", "(", "\"", "Up", "<", "script", ">", "alert", "(", "123", ")", "</", "script", ">", "Project", "\"", ");", "j", ".", "assertBuildStatusSuccess", "(", "down", ".", "scheduleBuild2", "(", "0", ",", "new", "Cause", ".", "UpstreamCause", "(", "upBuild", ")", "))", ";", "up", ".", "setVirtualName", "(", "null", ")", ";", "FreeStyleBuild", "downBuild", "=", "this", ".", "waitForDownBuild", "(", "down", ")", ";", "ensureXssIsPrevented", "(", "downBuild", ")", ";", "}", "private", "void", "ensureXssIsPrevented", "(", "FreeStyleBuild", "downBuild", ")", "throws", "Exception", "{", "AtomicBoolean", "alertCalled", "=", "new", "AtomicBoolean", "(", "false", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "setAlertHandler", "(", "(", "page", ",", "s", ")", "-", ">", "alertCalled", ".", "set", "(", "true", ")", ");", "wc", ".", "goTo", "(", "downBuild", ".", "getUrl", "(", "))", ";", "assertFalse", "(", "\"", "XSS", "not", "prevented", "\"", ",", "alertCalled", ".", "get", "(", "))", ";", "}", "private", "<", "B", "extends", "Build", "<", "?,", "B", ">", ">", "B", "waitForDownBuild", "(", "Project", "<", "?,", "B", ">", "down", ")", "throws", "Exception", "{", "j", ".", "waitUntilNoActivity", "(", ");", "B", "result", "=", "down", ".", "getBuilds", "(", ").", "getLastBuild", "(", ");", "return", "result", ";", "}", "public", "static", "class", "CustomBuild", "extends", "Build", "<", "FullNameChangingProject", ",", "CustomBuild", ">", "{", "public", "CustomBuild", "(", "FullNameChangingProject", "job", ")", "throws", "IOException", "{", "super", "(", "job", ")", ";", "}", "}", "static", "class", "FullNameChangingProject", "extends", "Project", "<", "FullNameChangingProject", ",", "CustomBuild", ">", "implements", "TopLevelItem", "{", "private", "volatile", "String", "virtualName", ";", "public", "FullNameChangingProject", "(", "ItemGroup", "parent", ",", "String", "name", ")", "{", "super", "(", "parent", ",", "name", ")", ";", "}", "public", "void", "setVirtualName", "(", "String", "virtualName", ")", "{", "this", ".", "virtualName", "=", "virtualName", ";", "}", "@", "Override", "public", "String", "getName", "(", ")", "{", "if", "(", "virtualName", "!", "=", "null", ")", "{", "return", "virtualName", ";", "}", "else", "{", "return", "super", ".", "getName", "(", ");", "}", "}", "@", "Override", "protected", "Class", "<", "CustomBuild", ">", "getBuildClass", "(", ")", "{", "return", "CustomBuild", ".", "class", ";", "}", "@", "Override", "public", "TopLevelItemDescriptor", "getDescriptor", "(", ")", "{", "return", "(", "FreeStyleProject", ".", "DescriptorImpl", ")", "Jenkins", ".", "get", "(", ").", "getDescriptorOrDie", "(", "getClass", "(", "))", ";", "}", "@", "TestExtension", "public", "static", "class", "DescriptorImpl", "extends", "AbstractProjectDescriptor", "{", "@", "Override", "public", "FullNameChangingProject", "newInstance", "(", "ItemGroup", "parent", ",", "String", "name", ")", "{", "return", "new", "FullNameChangingProject", "(", "parent", ",", "name", ")", ";", "}", "}", "}", "}"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["drm/i915:", "fix", "integer", "overflow", "in", "i915_gem_do_execbuffer()", "On", "32-bit", "systems,", "a", "large", "args->num_cliprects", "from", "userspace", "via", "ioctl", "may", "overflow", "the", "allocation", "size,", "leading", "to", "out-of-bounds", "access.", "This", "vulnerability", "was", "introduced", "in", "commit", "432e58ed", "(\"drm/i915:", "Avoid", "allocation", "for", "execbuffer", "object", "list\").", "Signed-off-by:", "Xi", "Wang", "<xi.wang@gmail.com>", "Reviewed-by:", "Chris", "Wilson", "<chris@chris-wilson.co.uk>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Daniel", "Vetter", "<daniel.vetter@ffwll.ch>"], "code_tokens": ["@", "@", "-", "1133", ",", "6", "+", "1133", ",", "11", "@", "@", "i915_gem_do_execbuffer", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "return", "-", "EINVAL", ";", "}", "if", "(", "args", "-", ">", "num_cliprects", ">", "UINT_MAX", "/", "sizeof", "(", "*", "cliprects", ")", ")", "{", "DRM_DEBUG", "(", "\"", "execbuf", "with", "%", "u", "cliprects", "\\", "n", "\"", ",", "args", "-", ">", "num_cliprects", ")", ";", "return", "-", "EINVAL", ";", "}", "cliprects", "=", "kmalloc", "(", "args", "-", ">", "num_cliprects", "*", "sizeof", "(", "*", "cliprects", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "cliprects", "=", "=", "NULL", ")", "{"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(out-of-bounds", "write", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["[SECURITY-944]"], "code_tokens": ["@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "*", "/", "package", "hudson", ".", "model", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "util", ".", "RunList", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "@", "@", "-", "64", ",", "7", "+", "65", ",", "9", "@", "@", "public", "TimelineEventList", "doData", "(", "StaplerRequest", "req", ",", "@", "QueryParameter", "long", "min", ",", "@", "Q", "Event", "e", "=", "new", "Event", "(", ");", "e", ".", "start", "=", "new", "Date", "(", "r", ".", "getStartTimeInMillis", "(", "))", ";", "e", ".", "end", "=", "new", "Date", "(", "r", ".", "getStartTimeInMillis", "(", ")+", "r", ".", "getDuration", "(", "))", ";", "e", ".", "title", "=", "r", ".", "getFullDisplayName", "(", ");", "/", "/", "due", "to", "SimileAjax", ".", "HTML", ".", "deEntify", "(", "in", "simile", "-", "ajax", "-", "bundle", ".", "js", ")", ",", "\"", "&", "lt", ";", "\"", "are", "transformed", "back", "to", "\"", "<\"", ",", "but", "not", "the", "\"", "&#", "60", "\"", ";", "/", "/", "to", "protect", "against", "XSS", "e", ".", "title", "=", "Util", ".", "escape", "(", "r", ".", "getFullDisplayName", "(", "))", ".", "replace", "(", "\"&", "lt", ";", "\",", "\"", "&#", "60", ";", "\")", ";", "/", "/", "what", "to", "put", "in", "the", "description", "?", "/", "/", "e", ".", "description", "=", "\"", "Longish", "description", "of", "event", "\"", "+", "r", ".", "getFullDisplayName", "(", ");", "/", "/", "e", ".", "durationEvent", "=", "true", ";", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "onSuccess", ":", "function", "(", "t", ")", "{", "if", "(", "t", ".", "status", "!", "=", "0", ")", "{", "try", "{", "eventSource1", ".", "loadJSON", "(", "eval", "(", "'(", "'+", "t", ".", "responseText", "+", "')", "')", ",'", ".'", ");", "eventSource1", ".", "loadJSON", "(", "JSON", ".", "parse", "(", "t", ".", "responseText", ")", ",'", ".'", ");", "getData", "(", "eventSource1", ",", "current", "-", "1", ",", "min", ",", "max", ")", ";", "}", "catch", "(", "e", ")", "{", "alert", "(", "e", ")", ";"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["powerpc/mm/64s/hash:", "Reallocate", "context", "ids", "on", "fork", "When", "using", "the", "Hash", "Page", "Table", "(HPT)", "MMU,", "userspace", "memory", "mappings", "are", "managed", "at", "two", "levels.", "Firstly", "in", "the", "Linux", "page", "tables,", "much", "like", "other", "architectures,", "and", "secondly", "in", "the", "SLB", "(Segment", "Lookaside", "Buffer)", "and", "HPT.", "It's", "the", "SLB", "and", "HPT", "that", "are", "actually", "used", "by", "the", "hardware", "to", "do", "translations.", "As", "part", "of", "the", "series", "adding", "support", "for", "4PB", "user", "virtual", "address", "space", "using", "the", "hash", "MMU,", "we", "added", "support", "for", "allocating", "multiple", "\"context", "ids\"", "per", "process,", "one", "for", "each", "512TB", "chunk", "of", "address", "space.", "These", "are", "tracked", "in", "an", "array", "called", "extended_id", "in", "the", "mm_context_t", "of", "a", "process", "that", "has", "done", "a", "mapping", "above", "512TB.", "If", "such", "a", "process", "forks", "(ie.", "clone(2)", "without", "CLONE_VM", "set)", "it's", "mm", "is", "copied,", "including", "the", "mm_context_t,", "and", "then", "init_new_context()", "is", "called", "to", "reinitialise", "parts", "of", "the", "mm_context_t", "as", "appropriate", "to", "separate", "the", "address", "spaces", "of", "the", "two", "processes.", "The", "key", "step", "in", "ensuring", "the", "two", "processes", "have", "separate", "address", "spaces", "is", "to", "allocate", "a", "new", "context", "id", "for", "the", "process,", "this", "is", "done", "at", "the", "beginning", "of", "hash__init_new_context().", "If", "we", "didn't", "allocate", "a", "new", "context", "id", "then", "the", "two", "processes", "would", "share", "mappings", "as", "far", "as", "the", "SLB", "and", "HPT", "are", "concerned,", "even", "though", "their", "Linux", "page", "tables", "would", "be", "separate.", "For", "mappings", "above", "512TB,", "which", "use", "the", "extended_id", "array,", "we", "neglected", "to", "allocate", "new", "context", "ids", "on", "fork,", "meaning", "the", "parent", "and", "child", "use", "the", "same", "ids", "and", "therefore", "share", "those", "mappings", "even", "though", "they're", "supposed", "to", "be", "separate.", "This", "can", "lead", "to", "the", "parent", "seeing", "writes", "done", "by", "the", "child,", "which", "is", "essentially", "memory", "corruption.", "There", "is", "an", "additional", "exposure", "which", "is", "that", "if", "the", "child", "process", "exits,", "all", "its", "context", "ids", "are", "freed,", "including", "the", "context", "ids", "that", "are", "still", "in", "use", "by", "the", "parent", "for", "mappings", "above", "512TB.", "One", "or", "more", "of", "those", "ids", "can", "then", "be", "reallocated", "to", "a", "third", "process,", "that", "process", "can", "then", "read/write", "to", "the", "parent's", "mappings", "above", "512TB.", "Additionally", "if", "the", "freed", "id", "is", "used", "for", "the", "third", "process's", "primary", "context", "id,", "then", "the", "parent", "is", "able", "to", "read/write", "to", "the", "third", "process's", "mappings", "*below*", "512TB.", "All", "of", "these", "are", "fundamental", "failures", "to", "enforce", "separation", "between", "processes.", "The", "only", "mitigating", "factor", "is", "that", "the", "bug", "only", "occurs", "if", "a", "process", "creates", "mappings", "above", "512TB,", "and", "most", "applications", "still", "do", "not", "create", "such", "mappings.", "Only", "machines", "using", "the", "hash", "page", "table", "MMU", "are", "affected,", "eg.", "PowerPC", "970", "(G5),", "PA6T,", "Power5/6/7/8/9.", "By", "default", "Power9", "bare", "metal", "machines", "(powernv)", "use", "the", "Radix", "MMU", "and", "are", "not", "affected,", "unless", "the", "machine", "has", "been", "explicitly", "booted", "in", "HPT", "mode", "(using", "disable_radix", "on", "the", "kernel", "command", "line).", "KVM", "guests", "on", "Power9", "may", "be", "affected", "if", "the", "host", "or", "guest", "is", "configured", "to", "use", "the", "HPT", "MMU.", "LPARs", "under", "PowerVM", "on", "Power9", "are", "affected", "as", "they", "always", "use", "the", "HPT", "MMU.", "Kernels", "built", "with", "PAGE_SIZE=4K", "are", "not", "affected.", "The", "fix", "is", "relatively", "simple,", "we", "need", "to", "reallocate", "context", "ids", "for", "all", "extended", "mappings", "on", "fork.", "Fixes:", "f384796c40dc", "(\"powerpc/mm:", "Add", "support", "for", "handling", ">", "512TB", "address", "in", "SLB", "miss\")", "Cc:", "stable@vger.kernel.org", "#", "v4.17+", "Signed-off-by:", "Michael", "Ellerman", "<mpe@ellerman.id.au>"], "code_tokens": ["@", "@", "-", "55", ",", "14", "+", "55", ",", "48", "@", "@", "EXPORT_SYMBOL_GPL", "(", "hash__alloc_context_id", ")", ";", "void", "slb_setup_new_exec", "(", "void", ")", ";", "static", "int", "realloc_context_ids", "(", "mm_context_t", "*", "ctx", ")", "{", "int", "i", ",", "id", ";", "/", "*", "*", "id", "0", "(", "aka", ".", "ctx", "-", ">", "id", ")", "is", "special", ",", "we", "always", "allocate", "a", "new", "one", ",", "even", "if", "*", "there", "wasn", "'", "t", "one", "allocated", "previously", "(", "which", "happens", "in", "the", "exec", "*", "case", "where", "ctx", "is", "newly", "allocated", ")", ".", "*", "*", "We", "have", "to", "be", "a", "bit", "careful", "here", ".", "We", "must", "keep", "the", "existing", "ids", "in", "*", "the", "array", ",", "so", "that", "we", "can", "test", "if", "they", "'", "re", "non", "-", "zero", "to", "decide", "if", "we", "*", "need", "to", "allocate", "a", "new", "one", ".", "However", "in", "case", "of", "error", "we", "must", "free", "the", "*", "ids", "we", "'", "ve", "allocated", "but", "*", "not", "*", "any", "of", "the", "existing", "ones", "(", "or", "risk", "a", "*", "UAF", ")", ".", "That", "'", "s", "why", "we", "decrement", "i", "at", "the", "start", "of", "the", "error", "handling", "*", "loop", ",", "to", "skip", "the", "id", "that", "we", "just", "tested", "but", "couldn", "'", "t", "reallocate", ".", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "ARRAY_SIZE", "(", "ctx", "-", ">", "extended_id", ")", ";", "i", "+", "+)", "{", "if", "(", "i", "=", "=", "0", "|", "|", "ctx", "-", ">", "extended_id", "[", "i", "]", ")", "{", "id", "=", "hash__alloc_context_id", "(", ");", "if", "(", "id", "<", "0", ")", "goto", "error", ";", "ctx", "-", ">", "extended_id", "[", "i", "]", "=", "id", ";", "}", "}", "/", "*", "The", "caller", "expects", "us", "to", "return", "id", "*", "/", "return", "ctx", "-", ">", "id", ";", "error", ":", "for", "(", "i", "-", "-;", "i", ">", "=", "0", ";", "i", "-", "-)", "{", "if", "(", "ctx", "-", ">", "extended_id", "[", "i", "]", ")", "ida_free", "(", "&", "mmu_context_ida", ",", "ctx", "-", ">", "extended_id", "[", "i", "]", ");", "}", "return", "id", ";", "}", "static", "int", "hash__init_new_context", "(", "struct", "mm_struct", "*", "mm", ")", "{", "int", "index", ";", "index", "=", "hash__alloc_context_id", "(", ");", "if", "(", "index", "<", "0", ")", "return", "index", ";", "/", "*", "*", "The", "old", "code", "would", "re", "-", "promote", "on", "fork", ",", "we", "don", "'", "t", "do", "that", "when", "using", "*", "slices", "as", "it", "could", "cause", "problem", "promoting", "slices", "that", "have", "been", "@", "@", "-", "80", ",", "6", "+", "114", ",", "10", "@", "@", "static", "int", "hash__init_new_context", "(", "struct", "mm_struct", "*", "mm", ")", "if", "(", "mm", "-", ">", "context", ".", "id", "=", "=", "0", ")", "slice_init_new_context_exec", "(", "mm", ")", ";", "index", "=", "realloc_context_ids", "(", "&", "mm", "-", ">", "context", ")", ";", "if", "(", "index", "<", "0", ")", "return", "index", ";", "subpage_prot_init_new_context", "(", "mm", ")", ";", "pkey_mm_init", "(", "mm", ")", ";"], "docstring_tokens": ["read/write", "to", "one", "another's", "virtual", "memory", "under", "certain", "conditions"]}
{"contents": ["CAMEL-9309:", "Make", "it", "easier", "to", "turn", "on|off", "java", "transport", "over", "http"], "code_tokens": ["@", "@", "-", "47", ",", "6", "+", "47", ",", "7", "@", "@", "private", "AsyncHttpClientConfig", "clientConfig", ";", "private", "AhcBinding", "binding", ";", "private", "SSLContextParameters", "sslContextParameters", ";", "private", "boolean", "allowJavaSerializedObject", ";", "public", "AhcComponent", "(", ")", "{", "super", "(", "AhcEndpoint", ".", "class", ")", ";", "@", "@", "-", "164", ",", "6", "+", "165", ",", "20", "@", "@", "public", "void", "setSslContextParameters", "(", "SSLContextParameters", "sslContextParameters", ")", "{", "this", ".", "sslContextParameters", "=", "sslContextParameters", ";", "}", "public", "boolean", "isAllowJavaSerializedObject", "(", ")", "{", "return", "allowJavaSerializedObject", ";", "}", "/", "**", "*", "Whether", "to", "allow", "java", "serialization", "when", "a", "request", "uses", "context", "-", "type", "=", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "*", "<", "p", "/", ">", "*", "This", "is", "by", "default", "turned", "off", ".", "If", "you", "enable", "this", "then", "be", "aware", "that", "Java", "will", "deserialize", "the", "incoming", "*", "data", "from", "the", "request", "to", "Java", "and", "that", "can", "be", "a", "potential", "security", "risk", ".", "*", "/", "public", "void", "setAllowJavaSerializedObject", "(", "boolean", "allowJavaSerializedObject", ")", "{", "this", ".", "allowJavaSerializedObject", "=", "allowJavaSerializedObject", ";", "}", "protected", "String", "createAddressUri", "(", "String", "uri", ",", "String", "remaining", ")", "{", "return", "remaining", ";", "}", "@", "@", "-", "126", ",", "6", "+", "126", ",", "11", "@", "@", "protected", "void", "populateBody", "(", "RequestBuilder", "builder", ",", "AhcEndpoint", "endpoint", ",", "Exchan", "Object", "data", "=", "in", ".", "getBody", "(", ");", "if", "(", "data", "!", "=", "null", ")", "{", "if", "(", "contentType", "!", "=", "null", "&", "&", "AhcConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", ".", "equals", "(", "contentType", ")", ")", "{", "if", "(", "!", "endpoint", ".", "getComponent", "(", ").", "isAllowJavaSerializedObject", "(", "))", "{", "throw", "new", "CamelExchangeException", "(", "\"", "Content", "-", "type", "\"", "+", "AhcConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", "+", "\"", "is", "not", "allowed", "\"", ",", "exchange", ")", ";", "}", "/", "/", "serialized", "java", "object", "Serializable", "obj", "=", "in", ".", "getMandatoryBody", "(", "Serializable", ".", "class", ")", ";", "/", "/", "write", "object", "to", "output", "stream", "@", "@", "-", "228", ",", "9", "+", "233", ",", "12", "@", "@", "public", "void", "onComplete", "(", "AhcEndpoint", "endpoint", ",", "Exchange", "exchange", ",", "String", "url", ",", "Byte", "}", "Object", "body", "=", "is", ";", "/", "/", "if", "content", "type", "is", "a", "serialized", "java", "object", "then", "de", "-", "serialize", "it", "back", "to", "a", "Java", "object", "/", "/", "if", "content", "type", "is", "a", "serialized", "java", "object", "then", "de", "-", "serialize", "it", "back", "to", "a", "Java", "object", "but", "only", "if", "its", "allowed", "/", "/", "an", "exception", "can", "also", "be", "transffered", "as", "java", "object", "if", "(", "contentType", "!", "=", "null", "&", "&", "contentType", ".", "equals", "(", "AhcConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", ")", ")", "{", "body", "=", "AhcHelper", ".", "deserializeJavaObjectFromStream", "(", "is", ")", ";", "if", "(", "endpoint", ".", "getComponent", "(", ").", "isAllowJavaSerializedObject", "(", ")", "|", "|", "endpoint", ".", "isTransferException", "(", "))", "{", "body", "=", "AhcHelper", ".", "deserializeJavaObjectFromStream", "(", "is", ")", ";", "}", "}", "if", "(", "!", "endpoint", ".", "isThrowExceptionOnFailure", "(", "))", "{", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "ahc", ".", "AhcComponent", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "ahc", ".", "AhcConstants", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "ahc", ".", "BaseAhcTest", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "35", ",", "6", "+", "36", ",", "9", "@", "@", "public", "boolean", "isUseRouteBuilder", "(", ")", "{", "@", "Test", "public", "void", "testHttpSendJavaBodyAndReceiveString", "(", ")", "throws", "Exception", "{", "AhcComponent", "ahc", "=", "context", ".", "getComponent", "(", "\"", "ahc", "\"", ",", "AhcComponent", ".", "class", ")", ";", "ahc", ".", "setAllowJavaSerializedObject", "(", "true", ")", ";", "context", ".", "addRoutes", "(", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "@", "@", "-", "66", ",", "6", "+", "70", ",", "9", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testHttpSendJavaBodyAndReceiveJavaBody", "(", ")", "throws", "Exception", "{", "AhcComponent", "ahc", "=", "context", ".", "getComponent", "(", "\"", "ahc", "\"", ",", "AhcComponent", ".", "class", ")", ";", "ahc", ".", "setAllowJavaSerializedObject", "(", "true", ")", ";", "context", ".", "addRoutes", "(", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "@", "@", "-", "98", ",", "6", "+", "105", ",", "9", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testHttpSendStringAndReceiveJavaBody", "(", ")", "throws", "Exception", "{", "AhcComponent", "ahc", "=", "context", ".", "getComponent", "(", "\"", "ahc", "\"", ",", "AhcComponent", ".", "class", ")", ";", "ahc", ".", "setAllowJavaSerializedObject", "(", "true", ")", ";", "context", ".", "addRoutes", "(", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "@", "@", "-", "123", ",", "4", "+", "133", ",", "64", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "Camel", "rocks", "\"", ",", "reply", ".", "getName", "(", "))", ";", "}", "@", "Test", "public", "void", "testNotAllowedReceive", "(", ")", "throws", "Exception", "{", "AhcComponent", "ahc", "=", "context", ".", "getComponent", "(", "\"", "ahc", "\"", ",", "AhcComponent", ".", "class", ")", ";", "ahc", ".", "setAllowJavaSerializedObject", "(", "false", ")", ";", "context", ".", "addRoutes", "(", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "getTestServerEndpointUri", "(", "))", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "String", "body", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ";", "assertNotNull", "(", "body", ")", ";", "assertEquals", "(", "\"", "Hello", "World", "\"", ",", "body", ")", ";", "MyCoolBean", "reply", "=", "new", "MyCoolBean", "(", "456", ",", "\"", "Camel", "rocks", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "reply", ")", ";", "exchange", ".", "getOut", "(", ").", "setHeader", "(", "Exchange", ".", "CONTENT_TYPE", ",", "AhcConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", ")", ";", "}", "}", ");", "}", "}", ");", "context", ".", "start", "(", ");", "MyCoolBean", "reply", "=", "template", ".", "requestBody", "(", "getAhcEndpointUri", "(", "),", "\"", "Hello", "World", "\"", ",", "MyCoolBean", ".", "class", ")", ";", "assertNull", "(", "reply", ")", ";", "}", "@", "Test", "public", "void", "testNotAllowed", "(", ")", "throws", "Exception", "{", "context", ".", "addRoutes", "(", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "getTestServerEndpointUri", "(", "))", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "String", "body", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ";", "assertNotNull", "(", "body", ")", ";", "assertEquals", "(", "\"", "Hello", "World", "\"", ",", "body", ")", ";", "MyCoolBean", "reply", "=", "new", "MyCoolBean", "(", "456", ",", "\"", "Camel", "rocks", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "reply", ")", ";", "exchange", ".", "getOut", "(", ").", "setHeader", "(", "Exchange", ".", "CONTENT_TYPE", ",", "AhcConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", ")", ";", "}", "}", ");", "}", "}", ");", "context", ".", "start", "(", ");", "MyCoolBean", "cool", "=", "new", "MyCoolBean", "(", "123", ",", "\"", "Camel", "\"", ");", "try", "{", "template", ".", "requestBodyAndHeader", "(", "getAhcEndpointUri", "(", "),", "cool", ",", "Exchange", ".", "CONTENT_TYPE", ",", "AhcConstants", ".", "CONTENT_TYPE_JAVA_SERIALIZED_OBJECT", ",", "MyCoolBean", ".", "class", ")", ";", "fail", "(", "\"", "Should", "fail", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "assertTrue", "(", "e", ".", "getCause", "(", ").", "getMessage", "(", ").", "startsWith", "(", "\"", "Content", "-", "type", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "is", "not", "allowed", "\"", "))", ";", "}", "}", "}"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["Fix", "bug", "#72603:", "Out", "of", "bound", "read", "in", "exif_process_IFD_in_MAKERNOTE"], "code_tokens": ["@", "@", "-", "2742", ",", "6", "+", "2742", ",", "12", "@", "@", "static", "int", "exif_process_IFD_in_MAKERNOTE", "(", "image_info_type", "*", "ImageInfo", ",", "char", "*", "valu", "break", ";", "}", "if", "(", "maker_note", "-", ">", "offset", ">", "=", "value_len", ")", "{", "/", "*", "Do", "not", "go", "past", "the", "value", "end", "*", "/", "exif_error_docref", "(", "\"", "exif_read_data", "#", "error_ifd", "\"", "EXIFERR_CC", ",", "ImageInfo", ",", "E_WARNING", ",", "\"", "IFD", "data", "too", "short", ":", "0x", "%", "04X", "offset", "0x", "%", "04X", "\"", ",", "value_len", ",", "maker_note", "-", ">", "offset", ")", ";", "return", "FALSE", ";", "}", "dir_start", "=", "value_ptr", "+", "maker_note", "-", ">", "offset", ";", "#", "ifdef", "EXIF_DEBUG", "@", "@", "-", "2770", ",", "10", "+", "2776", ",", "19", "@", "@", "static", "int", "exif_process_IFD_in_MAKERNOTE", "(", "image_info_type", "*", "ImageInfo", ",", "char", "*", "valu", "offset_base", "=", "value_ptr", ";", "break", ";", "case", "MN_OFFSET_GUESS", ":", "if", "(", "maker_note", "-", ">", "offset", "+", "10", "+", "4", ">", "=", "value_len", ")", "{", "/", "*", "Can", "not", "read", "dir_start", "+", "10", "since", "it", "'", "s", "beyond", "value", "end", "*", "/", "exif_error_docref", "(", "\"", "exif_read_data", "#", "error_ifd", "\"", "EXIFERR_CC", ",", "ImageInfo", ",", "E_WARNING", ",", "\"", "IFD", "data", "too", "short", ":", "0x", "%", "04X", "\"", ",", "value_len", ")", ";", "return", "FALSE", ";", "}", "offset_diff", "=", "2", "+", "NumDirEntries", "*", "12", "+", "4", "-", "php_ifd_get32u", "(", "dir_start", "+", "10", ",", "ImageInfo", "-", ">", "motorola_intel", ")", ";", "#", "ifdef", "EXIF_DEBUG", "exif_error_docref", "(", "NULL", "EXIFERR_CC", ",", "ImageInfo", ",", "E_NOTICE", ",", "\"", "Using", "automatic", "offset", "correction", ":", "0x", "%", "04X", "\"", ",", "(", "(", "int", ")", "dir_start", "-", "(", "int", ")", "offset_base", "+", "maker_note", "-", ">", "offset", "+", "displacement", ")", "+", "offset_diff", ")", ";", "#", "endif", "if", "(", "offset_diff", "<", "0", "|", "|", "offset_diff", ">", "=", "value_len", ")", "{", "exif_error_docref", "(", "\"", "exif_read_data", "#", "error_ifd", "\"", "EXIFERR_CC", ",", "ImageInfo", ",", "E_WARNING", ",", "\"", "IFD", "data", "bad", "offset", ":", "0x", "%", "04X", "length", "0x", "%", "04X", "\"", ",", "offset_diff", ",", "value_len", ")", ";", "return", "FALSE", ";", "}", "offset_base", "=", "value_ptr", "+", "offset_diff", ";", "break", ";", "default", ":", "@", "@", "-", "2782", ",", "7", "+", "2797", ",", "7", "@", "@", "static", "int", "exif_process_IFD_in_MAKERNOTE", "(", "image_info_type", "*", "ImageInfo", ",", "char", "*", "valu", "}", "if", "(", "(", "2", "+", "NumDirEntries", "*", "12", ")", ">", "value_len", ")", "{", "exif_error_docref", "(", "\"", "exif_read_data", "#", "error_ifd", "\"", "EXIFERR_CC", ",", "ImageInfo", ",", "E_WARNING", ",", "\"", "Illegal", "IFD", "size", ":", "2", "+", "x", "%", "04X", "*", "12", "=", "x", "%", "04X", ">", "x", "%", "04X", "\"", ",", "NumDirEntries", ",", "2", "+", "NumDirEntries", "*", "12", ",", "value_len", ")", ";", "exif_error_docref", "(", "\"", "exif_read_data", "#", "error_ifd", "\"", "EXIFERR_CC", ",", "ImageInfo", ",", "E_WARNING", ",", "\"", "Illegal", "IFD", "size", ":", "2", "+", "0x", "%", "04X", "*", "12", "=", "0x", "%", "04X", ">", "0x", "%", "04X", "\"", ",", "NumDirEntries", ",", "2", "+", "NumDirEntries", "*", "12", ",", "value_len", ")", ";", "return", "FALSE", ";", "}", "@", "@", "-", "3068", ",", "7", "+", "3083", ",", "10", "@", "@", "static", "int", "exif_process_IFD_TAG", "(", "image_info_type", "*", "ImageInfo", ",", "char", "*", "dir_entry", ",", "cha", "break", ";", "case", "TAG_MAKER_NOTE", ":", "exif_process_IFD_in_MAKERNOTE", "(", "ImageInfo", ",", "value_ptr", ",", "byte_count", ",", "offset_base", ",", "IFDlength", ",", "displacement", "TSRMLS_CC", ")", ";", "if", "(", "!", "exif_process_IFD_in_MAKERNOTE", "(", "ImageInfo", ",", "value_ptr", ",", "byte_count", ",", "offset_base", ",", "IFDlength", ",", "displacement", "TSRMLS_CC", ")", ")", "{", "EFREE_IF", "(", "outside", ")", ";", "return", "FALSE", ";", "}", "break", ";", "case", "TAG_EXIF_IFD_POINTER", ":", "@", "@", "-", "0", ",", "0", "+", "1", ",", "11", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72603", "(", "Out", "of", "bound", "read", "in", "exif_process_IFD_in_MAKERNOTE", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "exif", "'", "))", "print", "'", "skip", "exif", "extension", "not", "available", "'", ";?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "count", "(", "exif_read_data", "(", "dirname", "(", "__FILE__", ")", ".", "\"", "/", "bug72603", ".", "jpeg", "\"", "))", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "exif_read_data", "(", "bug72603", ".", "jpeg", ")", ":", "IFD", "data", "bad", "offset", ":", "0x058C", "length", "0x001C", "in", "%", "s", "/", "bug72603", ".", "php", "on", "line", "%", "d", "int", "(", "13", ")", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["-", "Fix", "bug", "#53273", "(mb_strcut()", "returns", "garbage", "with", "the", "excessive", "length", "parameter)."], "code_tokens": ["@", "@", "-", "1397", ",", "6", "+", "1397", ",", "10", "@", "@", "mbfl_strcut", "(", "start", "=", "string", "-", ">", "val", "+", "from", ";", "end", "=", "start", "+", "(", "length", "&", "-", "4", ")", ";", "}", "else", "if", "(", "(", "encoding", "-", ">", "flag", "&", "MBFL_ENCTYPE_SBCS", ")", ")", "{", "if", "(", "from", "+", "length", ">", "=", "string", "-", ">", "len", ")", "{", "length", "=", "string", "-", ">", "len", "-", "from", ";", "}", "start", "=", "string", "-", ">", "val", "+", "from", ";", "end", "=", "start", "+", "length", ";", "}", "else", "if", "(", "encoding", "-", ">", "mblen_table", "!", "=", "NULL", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "-", "-", "TEST", "-", "-", "mb_strcut", "(", ")", "missing", "boundary", "check", ".", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "extension_loaded", "(", "'", "mbstring", "'", ")", "or", "die", "(", "'", "skip", "'", ");", "function_exists", "(", "'", "mb_convert_encoding", "'", ")", "or", "die", "(", "\"", "skip", "mb_convert_encoding", "(", ")", "is", "not", "available", "in", "this", "build", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "mb_internal_encoding", "(", "\"", "UCS", "-", "4LE", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"\\", "x61", "\\", "x00", "\\", "x00", "\\", "x00", "\\", "x62", "\\", "x00", "\\", "x00", "\\", "x00", "\\", "x63", "\\", "x00", "\\", "x00", "\\", "x00", "\"", ",", "0", ",", "32", ")", "))", ";", "mb_internal_encoding", "(", "\"", "UCS", "-", "4BE", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"\\", "x00", "\\", "x00", "\\", "x00", "\\", "x61", "\\", "x00", "\\", "x00", "\\", "x00", "\\", "x62", "\\", "x00", "\\", "x00", "\\", "x00", "\\", "x63", "\"", ",", "0", ",", "32", ")", "))", ";", "mb_internal_encoding", "(", "\"", "UCS", "-", "2LE", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"\\", "x61", "\\", "x00", "\\", "x62", "\\", "x00", "\\", "x63", "\\", "x00", "\"", ",", "0", ",", "32", ")", "))", ";", "mb_internal_encoding", "(", "\"", "UCS", "-", "2BE", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"\\", "x00", "\\", "x61", "\\", "x00", "\\", "x62", "\\", "x00", "\\", "x63", "\"", ",", "0", ",", "32", ")", "))", ";", "mb_internal_encoding", "(", "\"", "UTF", "-", "16", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"\\", "x00", "\\", "x61", "\\", "x00", "\\", "x62", "\\", "x00", "\\", "x63", "\"", ",", "0", ",", "32", ")", "))", ";", "mb_internal_encoding", "(", "\"", "UTF", "-", "8", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"", "abc", "\"", ",", "0", ",", "32", ")", "))", ";", "mb_internal_encoding", "(", "\"", "ISO", "-", "8859", "-", "1", "\"", ");", "var_dump", "(", "bin2hex", "(", "mb_strcut", "(", "\"", "abc", "\"", ",", "0", ",", "32", ")", "))", ";", "-", "-", "EXPECT", "-", "-", "string", "(", "24", ")", "\"", "610000006200000063000000", "\"", "string", "(", "24", ")", "\"", "000000610000006200000063", "\"", "string", "(", "12", ")", "\"", "610062006300", "\"", "string", "(", "12", ")", "\"", "006100620063", "\"", "string", "(", "12", ")", "\"", "006100620063", "\"", "string", "(", "6", ")", "\"", "616263", "\"", "string", "(", "6", ")", "\"", "616263", "\""], "docstring_tokens": ["obtain", "sensitive", "information", "that", "may", "lead", "to", "further", "attacks", "."]}
{"contents": ["userfaultfd:", "use", "ENOENT", "instead", "of", "EFAULT", "if", "the", "atomic", "copy", "user", "fails", "Patch", "series", "\"userfaultfd", "shmem", "updates\".", "Jann", "found", "two", "bugs", "in", "the", "userfaultfd", "shmem", "MAP_SHARED", "backend:", "the", "lack", "of", "the", "VM_MAYWRITE", "check", "and", "the", "lack", "of", "i_size", "checks.", "Then", "looking", "into", "the", "above", "we", "also", "fixed", "the", "MAP_PRIVATE", "case.", "Hugh", "by", "source", "review", "also", "found", "a", "data", "loss", "source", "if", "UFFDIO_COPY", "is", "used", "on", "shmem", "MAP_SHARED", "PROT_READ", "mappings", "(the", "production", "usages", "incidentally", "run", "with", "PROT_READ|PROT_WRITE,", "so", "the", "data", "loss", "couldn't", "happen", "in", "those", "production", "usages", "like", "with", "QEMU).", "The", "whole", "patchset", "is", "marked", "for", "stable.", "We", "verified", "QEMU", "postcopy", "live", "migration", "with", "guest", "running", "on", "shmem", "MAP_PRIVATE", "run", "as", "well", "as", "before", "after", "the", "fix", "of", "shmem", "MAP_PRIVATE.", "Regardless", "if", "it's", "shmem", "or", "hugetlbfs", "or", "MAP_PRIVATE", "or", "MAP_SHARED,", "QEMU", "unconditionally", "invokes", "a", "punch", "hole", "if", "the", "guest", "mapping", "is", "filebacked", "and", "a", "MADV_DONTNEED", "too", "(needed", "to", "get", "rid", "of", "the", "MAP_PRIVATE", "COWs", "and", "for", "the", "anon", "backend).", "This", "patch", "(of", "5):", "We", "internally", "used", "EFAULT", "to", "communicate", "with", "the", "caller,", "switch", "to", "ENOENT,", "so", "EFAULT", "can", "be", "used", "as", "a", "non", "internal", "retval.", "Link:", "http://lkml.kernel.org/r/20181126173452.26955-2-aarcange@redhat.com", "Fixes:", "4c27fe4c4c84", "(\"userfaultfd:", "shmem:", "add", "shmem_mcopy_atomic_pte", "for", "userfaultfd", "support\")", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Reviewed-by:", "Mike", "Rapoport", "<rppt@linux.ibm.com>", "Reviewed-by:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "Mike", "Kravetz", "<mike.kravetz@oracle.com>", "Cc:", "Jann", "Horn", "<jannh@google.com>", "Cc:", "Peter", "Xu", "<peterx@redhat.com>", "Cc:", "\"Dr.", "David", "Alan", "Gilbert\"", "<dgilbert@redhat.com>", "Cc:", "<stable@vger.kernel.org>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "4080", ",", "7", "+", "4080", ",", "7", "@", "@", "int", "hugetlb_mcopy_atomic_pte", "(", "struct", "mm_struct", "*", "dst_mm", ",", "/", "*", "fallback", "to", "copy_from_user", "outside", "mmap_sem", "*", "/", "if", "(", "unlikely", "(", "ret", ")", ")", "{", "ret", "=", "-", "EFAULT", ";", "ret", "=", "-", "ENOENT", ";", "*", "pagep", "=", "page", ";", "/", "*", "don", "'", "t", "free", "the", "page", "*", "/", "goto", "out", ";", "@", "@", "-", "2238", ",", "7", "+", "2238", ",", "7", "@", "@", "static", "int", "shmem_mfill_atomic_pte", "(", "struct", "mm_struct", "*", "dst_mm", ",", "*", "pagep", "=", "page", ";", "shmem_inode_unacct_blocks", "(", "inode", ",", "1", ")", ";", "/", "*", "don", "'", "t", "free", "the", "page", "*", "/", "return", "-", "EFAULT", ";", "return", "-", "ENOENT", ";", "}", "}", "else", "{", "/", "*", "mfill_zeropage_atomic", "*", "/", "clear_highpage", "(", "page", ")", ";", "@", "@", "-", "48", ",", "7", "+", "48", ",", "7", "@", "@", "static", "int", "mcopy_atomic_pte", "(", "struct", "mm_struct", "*", "dst_mm", ",", "/", "*", "fallback", "to", "copy_from_user", "outside", "mmap_sem", "*", "/", "if", "(", "unlikely", "(", "ret", ")", ")", "{", "ret", "=", "-", "EFAULT", ";", "ret", "=", "-", "ENOENT", ";", "*", "pagep", "=", "page", ";", "/", "*", "don", "'", "t", "free", "the", "page", "*", "/", "goto", "out", ";", "@", "@", "-", "274", ",", "7", "+", "274", ",", "7", "@", "@", "static", "__always_inline", "ssize_t", "__mcopy_atomic_hugetlb", "(", "struct", "mm_struct", "*", "dst_mm", ",", "cond_resched", "(", ");", "if", "(", "unlikely", "(", "err", "=", "=", "-", "EFAULT", ")", ")", "{", "if", "(", "unlikely", "(", "err", "=", "=", "-", "ENOENT", ")", ")", "{", "up_read", "(", "&", "dst_mm", "-", ">", "mmap_sem", ")", ";", "BUG_ON", "(", "!", "page", ")", ";", "@", "@", "-", "530", ",", "7", "+", "530", ",", "7", "@", "@", "static", "__always_inline", "ssize_t", "__mcopy_atomic", "(", "struct", "mm_struct", "*", "dst_mm", ",", "src_addr", ",", "&", "page", ",", "zeropage", ")", ";", "cond_resched", "(", ");", "if", "(", "unlikely", "(", "err", "=", "=", "-", "EFAULT", ")", ")", "{", "if", "(", "unlikely", "(", "err", "=", "=", "-", "ENOENT", ")", ")", "{", "void", "*", "page_kaddr", ";", "up_read", "(", "&", "dst_mm", "-", ">", "mmap_sem", ")", ";"], "docstring_tokens": ["write", "arbitrary", "data", "into", "holes", "in", "sparse", "tmpfs", "files"]}
{"contents": ["Fix", "prototype", "pollution", "in", "mergeConfig."], "code_tokens": ["@", "@", "-", "1", ",", "6", "+", "1", ",", "8", "@", "@", "import", "isArray", "from", "'", "./", "isArray", "'", ";", "import", "isObject", "from", "'", "./", "isObject", "'", ";", "const", "isLegalKey", "=", "key", "=", ">", "key", "!", "==", "'", "__proto__", "'", ";", "export", "function", "mergeConfig", "(", "..", ".", "configs", ")", "{", "return", "configs", ".", "reduce", "(", "(", "out", ",", "source", ")", "=", ">", "{", "for", "(", "var", "key", "in", "source", ")", "{", "@", "@", "-", "14", ",", "7", "+", "16", ",", "7", "@", "@", "export", "function", "mergeConfig", "(", "..", ".", "configs", ")", "{", "/", "/", "for", "legend", "block", ",", "recurse", "for", "the", "layout", "entry", "only", "/", "/", "for", "style", "block", ",", "recurse", "for", "all", "properties", "/", "/", "otherwise", ",", "no", "recursion", ":", "objects", "overwrite", ",", "no", "merging", "var", "r", "=", "key", "=", "==", "'", "legend", "'", "?", "{", "'", "layout", "'", ":", "1", "}", "var", "r", "=", "key", "=", "==", "'", "legend", "'", "?", "{", "layout", ":", "1", "}", ":", "key", "=", "==", "'", "style", "'", "?", "true", ":", "null", ";", "writeConfig", "(", "out", ",", "key", ",", "source", "[", "key", "]", ",", "r", ")", ";", "@", "@", "-", "25", ",", "13", "+", "27", ",", "15", "@", "@", "export", "function", "mergeConfig", "(", "..", ".", "configs", ")", "{", "}", "export", "function", "writeConfig", "(", "output", ",", "key", ",", "value", ",", "recurse", ")", "{", "if", "(", "!", "isLegalKey", "(", "key", ")", ")", "return", ";", "var", "k", ",", "o", ";", "if", "(", "isObject", "(", "value", ")", "&", "&", "!", "isArray", "(", "value", ")", ")", "{", "o", "=", "isObject", "(", "output", "[", "key", "]", ")", "?", "output", "[", "key", "]", ":", "(", "output", "[", "key", "]", "=", "{", "})", ";", "for", "(", "k", "in", "value", ")", "{", "if", "(", "recurse", "&", "&", "(", "recurse", "=", "==", "true", "|", "|", "recurse", "[", "k", "]", "))", "{", "writeConfig", "(", "o", ",", "k", ",", "value", "[", "k", "]", ");", "}", "else", "{", "}", "else", "if", "(", "isLegalKey", "(", "k", ")", ")", "{", "o", "[", "k", "]", "=", "value", "[", "k", "]", ";", "}", "}", "@", "@", "-", "78", ",", "3", "+", "78", ",", "15", "@", "@", "tape", "(", "'", "mergeConfig", "handles", "empty", "arguments", "'", ",", "function", "(", "t", ")", "{", "t", ".", "deepEqual", "(", "vega", ".", "mergeConfig", "(", "null", ",", "undefined", ",", "c", ")", ",", "c", ")", ";", "t", ".", "end", "(", ");", "}", ");", "tape", "(", "'", "mergeConfig", "must", "not", "allow", "prototype", "pollution", "'", ",", "function", "(", "t", ")", "{", "const", "config", "=", "{", "symbol", ":", "{", "shape", ":", "'", "triangle", "-", "right", "'", "}}", ",", "payload", "=", "JSON", ".", "parse", "(", "'{", "\"", "__proto__", "\"", ":", "{", "\"", "vulnerable", "\"", ":", "\"", "Polluted", "\"", "}}", "')", ",", "merged", "=", "vega", ".", "mergeConfig", "(", "config", ",", "payload", ",", "{", "symbol", ":", "payload", "}", ");", "t", ".", "equal", "(", "merged", ".", "__proto__", ".", "vulnerable", ",", "undefined", ")", ";", "t", ".", "equal", "(", "merged", ".", "symbol", ".", "__proto__", ".", "vulnerable", ",", "undefined", ")", ";", "t", ".", "equal", "(", "Object", ".", "prototype", ".", "vulnerable", ",", "undefined", ")", ";", "t", ".", "end", "(", ");", "}", ");", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["add", "or", "modify", "the", "properties", "of", "Object.prototype"]}
{"contents": ["Implement", "delayed", "__wakeup"], "code_tokens": ["@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "7", ".", "5", "*", "/", "/", "*", "Generated", "by", "re2c", "0", ".", "16", "*", "/", "#", "line", "1", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "/", "*", "+", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "@", "@", "-", "28", ",", "6", "+", "28", ",", "11", "@", "@", "#", "define", "VAR_ENTRIES_MAX", "1024", "#", "define", "VAR_ENTRIES_DBG", "0", "#", "define", "VAR_WAKEUP_FLAG", "1", "#", "define", "WITH_WAKEUP_FLAG", "(", "zv_ptr", ")", "(", "(", "zval", "*", ")", "(", "(", "zend_uintptr_t", ")", "zv_ptr", "|", "VAR_WAKEUP_FLAG", ")", ")", "#", "define", "WITHOUT_WAKEUP_FLAG", "(", "zv_ptr", ")", "(", "(", "zval", "*", ")", "(", "(", "zend_uintptr_t", ")", "zv_ptr", "&", "~", "VAR_WAKEUP_FLAG", ")", ")", "#", "define", "HAS_WAKEUP_FLAG", "(", "zv_ptr", ")", "(", "(", "zend_uintptr_t", ")", "zv_ptr", "&", "VAR_WAKEUP_FLAG", ")", "typedef", "struct", "{", "zval", "*", "data", "[", "VAR_ENTRIES_MAX", "]", ";", "long", "used_slots", ";", "@", "@", "-", "58", ",", "12", "+", "63", ",", "12", "@", "@", "static", "inline", "void", "var_push", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "var_hash", "-", ">", "data", "[", "var_hash", "-", ">", "used_slots", "+", "+]", "=", "*", "rval", ";", "}", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "static", "inline", "zval", "*", "*", "get_var_push_dtor_slot", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "{", "var_entries", "*", "var_hash", ";", "if", "(", "!", "var_hashx", "|", "|", "!", "*", "var_hashx", ")", "{", "return", ";", "return", "NULL", ";", "}", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "last_dtor", ";", "@", "@", "-", "85", ",", "8", "+", "90", ",", "14", "@", "@", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "(", "*", "var_hashx", ")", "->", "last_dtor", "=", "var_hash", ";", "}", "return", "&", "var_hash", "-", ">", "data", "[", "var_hash", "-", ">", "used_slots", "+", "+]", ";", "}", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "{", "zval", "*", "*", "slot", "=", "get_var_push_dtor_slot", "(", "var_hashx", ")", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "var_hash", "-", ">", "data", "[", "var_hash", "-", ">", "used_slots", "+", "+]", "=", "*", "rval", ";", "*", "slot", "=", "*", "rval", ";", "}", "PHPAPI", "void", "var_push_dtor_no_addref", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "@", "@", "-", "164", ",", "6", "+", "175", ",", "9", "@", "@", "PHPAPI", "void", "var_destroy", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "void", "*", "next", ";", "long", "i", ";", "var_entries", "*", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "first", ";", "zend_bool", "wakeup_failed", "=", "0", ";", "TSRMLS_FETCH", "(", ");", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_destroy", "(", "%", "ld", ")", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ")", ";", "#", "endif", "@", "@", "-", "178", ",", "10", "+", "192", ",", "35", "@", "@", "PHPAPI", "void", "var_destroy", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "while", "(", "var_hash", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "var_hash", "-", ">", "used_slots", ";", "i", "+", "+)", "{", "zval", "*", "zv", "=", "var_hash", "-", ">", "data", "[", "i", "]", ";", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_destroy", "dtor", "(", "%", "p", ",", "%", "ld", ")", "\\", "n", "\"", ",", "var_hash", "-", ">", "data", "[", "i", "]", ",", "Z_REFCOUNT_P", "(", "var_hash", "-", ">", "data", "[", "i", "]", "))", ";", "#", "endif", "zval_ptr_dtor", "(", "&", "var_hash", "-", ">", "data", "[", "i", "]", ");", "if", "(", "HAS_WAKEUP_FLAG", "(", "zv", ")", ")", "{", "zv", "=", "WITHOUT_WAKEUP_FLAG", "(", "zv", ")", ";", "if", "(", "!", "wakeup_failed", ")", "{", "zval", "*", "retval_ptr", "=", "NULL", ";", "zval", "wakeup_name", ";", "INIT_PZVAL", "(", "&", "wakeup_name", ")", ";", "ZVAL_STRINGL", "(", "&", "wakeup_name", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", ")", "-", "1", ",", "0", ")", ";", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "call_user_function_ex", "(", "CG", "(", "function_table", ")", ",", "&", "zv", ",", "&", "wakeup_name", ",", "&", "retval_ptr", ",", "0", ",", "0", ",", "1", ",", "NULL", "TSRMLS_CC", ")", "=", "=", "FAILURE", "|", "|", "retval_ptr", "=", "=", "NULL", ")", "{", "wakeup_failed", "=", "1", ";", "zend_object_store_ctor_failed", "(", "zv", "TSRMLS_CC", ")", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "retval_ptr", ")", "{", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "}", "else", "{", "zend_object_store_ctor_failed", "(", "zv", "TSRMLS_CC", ")", ";", "}", "}", "zval_ptr_dtor", "(", "&", "zv", ")", ";", "}", "next", "=", "var_hash", "-", ">", "next", ";", "efree", "(", "var_hash", ")", ";", "@", "@", "-", "241", ",", "7", "+", "280", ",", "7", "@", "@", "static", "char", "*", "unserialize_str", "(", "const", "unsigned", "char", "*", "*", "p", ",", "size_t", "*", "len", ",", "size_t", "maxlen", "#", "define", "YYMARKER", "marker", "#", "line", "249", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "288", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "@", "@", "-", "431", ",", "19", "+", "470", ",", "16", "@", "@", "static", "inline", "long", "object_common1", "(", "UNSERIALIZE_PARAMETER", ",", "zend_class_entry", "*", "ce", ")", "#", "endif", "static", "inline", "int", "object_common2", "(", "UNSERIALIZE_PARAMETER", ",", "long", "elements", ")", "{", "zval", "*", "retval_ptr", "=", "NULL", ";", "zval", "fname", ";", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "!", "=", "IS_OBJECT", ")", "{", "return", "0", ";", "}", "if", "(", "!", "process_nested_data", "(", "UNSERIALIZE_PASSTHRU", ",", "Z_OBJPROP_PP", "(", "rval", ")", ",", "elements", ",", "1", ")", ")", "{", "/", "*", "We", "'", "ve", "got", "partially", "constructed", "object", "on", "our", "hands", "here", ".", "Wipe", "it", ".", "*", "/", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "=", "=", "IS_OBJECT", ")", "{", "zend_hash_clean", "(", "Z_OBJPROP_PP", "(", "rval", ")", ");", "zend_object_store_ctor_failed", "(", "*", "rval", "TSRMLS_CC", ")", ";", "}", "/", "*", "We", "'", "ve", "got", "partially", "constructed", "object", "on", "our", "hands", "here", ".", "Wipe", "it", ".", "*", "/", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "=", "=", "IS_OBJECT", ")", "{", "zend_hash_clean", "(", "Z_OBJPROP_PP", "(", "rval", ")", ");", "zend_object_store_ctor_failed", "(", "*", "rval", "TSRMLS_CC", ")", ";", "}", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "0", ";", "}", "@", "@", "-", "453", ",", "20", "+", "489", ",", "16", "@", "@", "static", "inline", "int", "object_common2", "(", "UNSERIALIZE_PARAMETER", ",", "long", "elements", ")", "}", "if", "(", "Z_OBJCE_PP", "(", "rval", ")", "!", "=", "PHP_IC_ENTRY", "&", "&", "zend_hash_exists", "(", "&", "Z_OBJCE_PP", "(", "rval", ")", "->", "function_table", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", "))", ")", "{", "INIT_PZVAL", "(", "&", "fname", ")", ";", "ZVAL_STRINGL", "(", "&", "fname", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", ")", "-", "1", ",", "0", ")", ";", "BG", "(", "serialize_lock", ")", "++", ";", "call_user_function_ex", "(", "CG", "(", "function_table", ")", ",", "rval", ",", "&", "fname", ",", "&", "retval_ptr", ",", "0", ",", "0", ",", "1", ",", "NULL", "TSRMLS_CC", ")", ";", "BG", "(", "serialize_lock", ")", "--", ";", "}", "if", "(", "retval_ptr", ")", "{", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "if", "(", "EG", "(", "exception", ")", ")", "{", "return", "0", ";", "zend_hash_exists", "(", "&", "Z_OBJCE_PP", "(", "rval", ")", "->", "function_table", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", "))", ")", "{", "/", "*", "Store", "object", "for", "delayed", "__wakeup", "call", ".", "Remove", "references", ".", "*", "/", "zval", "*", "*", "slot", "=", "get_var_push_dtor_slot", "(", "var_hash", ")", ";", "zval", "*", "zv", "=", "*", "rval", ";", "Z_ADDREF_P", "(", "zv", ")", ";", "if", "(", "PZVAL_IS_REF", "(", "zv", ")", ")", "{", "SEPARATE_ZVAL", "(", "&", "zv", ")", ";", "}", "*", "slot", "=", "WITH_WAKEUP_FLAG", "(", "zv", ")", ";", "}", "return", "finish_nested_data", "(", "UNSERIALIZE_PASSTHRU", ")", ";", "@", "@", "-", "497", ",", "7", "+", "529", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "#", "line", "501", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "533", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "{", "YYCTYPE", "yych", ";", "static", "const", "unsigned", "char", "yybm", "[", "]", "=", "{", "@", "@", "-", "534", ",", "544", "+", "566", ",", "411", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "}", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "7", ")", "YYFILL", "(", "7", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "switch", "(", "yych", ")", "{", "case", "'", "C", "'", ":", "case", "'", "O", "'", ":", "goto", "yy13", ";", "case", "'", "O", "'", ":", "goto", "yy4", ";", "case", "'", "N", "'", ":", "goto", "yy5", ";", "case", "'", "R", "'", ":", "goto", "yy2", ";", "case", "'", "S", "'", ":", "goto", "yy10", ";", "case", "'", "a", "'", ":", "goto", "yy11", ";", "case", "'", "b", "'", ":", "goto", "yy6", ";", "case", "'", "d", "'", ":", "goto", "yy8", ";", "case", "'", "i", "'", ":", "goto", "yy7", ";", "case", "'", "R", "'", ":", "goto", "yy6", ";", "case", "'", "S", "'", ":", "goto", "yy7", ";", "case", "'", "a", "'", ":", "goto", "yy8", ";", "case", "'", "b", "'", ":", "goto", "yy9", ";", "case", "'", "d", "'", ":", "goto", "yy10", ";", "case", "'", "i", "'", ":", "goto", "yy11", ";", "case", "'", "o", "'", ":", "goto", "yy12", ";", "case", "'", "r", "'", ":", "goto", "yy4", ";", "case", "'", "s", "'", ":", "goto", "yy9", ";", "case", "'", "}'", ":", "goto", "yy14", ";", "default", ":", "goto", "yy16", ";", "case", "'", "r", "'", ":", "goto", "yy13", ";", "case", "'", "s", "'", ":", "goto", "yy14", ";", "case", "'", "}'", ":", "goto", "yy15", ";", "default", ":", "goto", "yy2", ";", "}", "yy2", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy95", ";", "+", "+", "YYCURSOR", ";", "yy3", ":", "#", "line", "877", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "909", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "return", "0", ";", "}", "#", "line", "563", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "593", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy4", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy89", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy17", ";", "goto", "yy3", ";", "yy5", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy87", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy19", ";", "goto", "yy3", ";", "yy6", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy83", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy21", ";", "goto", "yy3", ";", "yy7", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy77", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy22", ";", "goto", "yy3", ";", "yy8", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy53", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy23", ";", "goto", "yy3", ";", "yy9", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy46", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy24", ";", "goto", "yy3", ";", "yy10", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy39", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy25", ";", "goto", "yy3", ";", "yy11", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy32", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy26", ";", "goto", "yy3", ";", "yy12", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy25", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy27", ";", "goto", "yy3", ";", "yy13", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy17", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy28", ";", "goto", "yy3", ";", "yy14", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy29", ";", "goto", "yy3", ";", "yy15", ":", "+", "+", "YYCURSOR", ";", "#", "line", "871", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "903", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "/", "*", "this", "is", "the", "case", "where", "we", "have", "less", "data", "than", "planned", "*", "/", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_NOTICE", ",", "\"", "Unexpected", "end", "of", "serialized", "data", "\"", ");", "return", "0", ";", "/", "*", "not", "sure", "if", "it", "should", "be", "0", "or", "1", "here", "?", "*", "/", "}", "#", "line", "612", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy16", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "goto", "yy3", ";", "#", "line", "646", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy17", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yybm", "[", "0", "+", "yych", "]", "&", "128", ")", "{", "goto", "yy20", ";", "goto", "yy31", ";", "}", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy19", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy30", ";", "yy18", ":", "YYCURSOR", "=", "YYMARKER", ";", "goto", "yy3", ";", "yy19", ":", "+", "+", "YYCURSOR", ";", "#", "line", "581", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "665", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy21", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yybm", "[", "0", "+", "yych", "]", "&", "128", ")", "{", "goto", "yy20", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy33", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy33", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy34", ";", "goto", "yy18", ";", "}", "yy22", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy36", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy37", ";", "goto", "yy18", ";", "yy20", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "2", ")", "YYFILL", "(", "2", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yybm", "[", "0", "+", "yych", "]", "&", "128", ")", "{", "goto", "yy20", ";", "}", "yy23", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy39", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy40", ";", "goto", "yy18", ";", "yy24", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "717", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "len2", ",", "len3", ",", "maxlen", ";", "long", "elements", ";", "char", "*", "class_name", ";", "zend_class_entry", "*", "ce", ";", "zend_class_entry", "*", "*", "pce", ";", "int", "incomplete_class", "=", "0", ";", "int", "custom_object", "=", "0", ";", "zval", "*", "user_func", ";", "zval", "*", "retval_ptr", ";", "zval", "*", "*", "args", "[", "1", "]", ";", "zval", "*", "arg_func_name", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "if", "(", "*", "start", "=", "=", "'", "C", "'", ")", "{", "custom_object", "=", "1", ";", "}", "INIT_PZVAL", "(", "*", "rval", ")", ";", "len2", "=", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "if", "(", "maxlen", "<", "len", "|", "|", "len", "=", "=", "0", ")", "{", "*", "p", "=", "start", "+", "2", ";", "return", "0", ";", "}", "class_name", "=", "(", "char", "*", ")", "YYCURSOR", ";", "YYCURSOR", "+", "=", "len", ";", "if", "(", "*(", "YYCURSOR", ")", "!", "=", "'", "\"'", ")", "{", "*", "p", "=", "YYCURSOR", ";", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", "+", "1", ")", "!", "=", "'", ":'", ")", "{", "*", "p", "=", "YYCURSOR", "+", "1", ";", "return", "0", ";", "}", "len3", "=", "strspn", "(", "class_name", ",", "\"", "0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ", "\\", "177", "\\", "200", "\\", "201", "\\", "202", "\\", "203", "\\", "204", "\\", "205", "\\", "206", "\\", "207", "\\", "210", "\\", "211", "\\", "212", "\\", "213", "\\", "214", "\\", "215", "\\", "216", "\\", "217", "\\", "220", "\\", "221", "\\", "222", "\\", "223", "\\", "224", "\\", "225", "\\", "226", "\\", "227", "\\", "230", "\\", "231", "\\", "232", "\\", "233", "\\", "234", "\\", "235", "\\", "236", "\\", "237", "\\", "240", "\\", "241", "\\", "242", "\\", "243", "\\", "244", "\\", "245", "\\", "246", "\\", "247", "\\", "250", "\\", "251", "\\", "252", "\\", "253", "\\", "254", "\\", "255", "\\", "256", "\\", "257", "\\", "260", "\\", "261", "\\", "262", "\\", "263", "\\", "264", "\\", "265", "\\", "266", "\\", "267", "\\", "270", "\\", "271", "\\", "272", "\\", "273", "\\", "274", "\\", "275", "\\", "276", "\\", "277", "\\", "300", "\\", "301", "\\", "302", "\\", "303", "\\", "304", "\\", "305", "\\", "306", "\\", "307", "\\", "310", "\\", "311", "\\", "312", "\\", "313", "\\", "314", "\\", "315", "\\", "316", "\\", "317", "\\", "320", "\\", "321", "\\", "322", "\\", "323", "\\", "324", "\\", "325", "\\", "326", "\\", "327", "\\", "330", "\\", "331", "\\", "332", "\\", "333", "\\", "334", "\\", "335", "\\", "336", "\\", "337", "\\", "340", "\\", "341", "\\", "342", "\\", "343", "\\", "344", "\\", "345", "\\", "346", "\\", "347", "\\", "350", "\\", "351", "\\", "352", "\\", "353", "\\", "354", "\\", "355", "\\", "356", "\\", "357", "\\", "360", "\\", "361", "\\", "362", "\\", "363", "\\", "364", "\\", "365", "\\", "366", "\\", "367", "\\", "370", "\\", "371", "\\", "372", "\\", "373", "\\", "374", "\\", "375", "\\", "376", "\\", "377", "\\", "\\\"", ");", "if", "(", "len3", "!", "=", "len", ")", "{", "*", "p", "=", "YYCURSOR", "+", "len3", "-", "len", ";", "return", "0", ";", "}", "class_name", "=", "estrndup", "(", "class_name", ",", "len", ")", ";", "do", "{", "/", "*", "Try", "to", "find", "class", "directly", "*", "/", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "zend_lookup_class", "(", "class_name", ",", "len2", ",", "&", "pce", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "ce", "=", "*", "pce", ";", "break", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "/", "*", "Check", "for", "unserialize", "callback", "*", "/", "if", "(", "(", "PG", "(", "unserialize_callback_func", ")", "=", "=", "NULL", ")", "|", "|", "(", "PG", "(", "unserialize_callback_func", ")", "[", "0", "]", "=", "=", "'", "\\", "0", "'", "))", "{", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "break", ";", "}", "/", "*", "Call", "unserialize", "callback", "*", "/", "MAKE_STD_ZVAL", "(", "user_func", ")", ";", "ZVAL_STRING", "(", "user_func", ",", "PG", "(", "unserialize_callback_func", ")", ",", "1", ")", ";", "args", "[", "0", "]", "=", "&", "arg_func_name", ";", "MAKE_STD_ZVAL", "(", "arg_func_name", ")", ";", "ZVAL_STRING", "(", "arg_func_name", ",", "class_name", ",", "1", ")", ";", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "call_user_function_ex", "(", "CG", "(", "function_table", ")", ",", "NULL", ",", "user_func", ",", "&", "retval_ptr", ",", "1", ",", "args", ",", "0", ",", "NULL", "TSRMLS_CC", ")", "!", "=", "SUCCESS", ")", "{", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "return", "0", ";", "}", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "defined", "(", "%", "s", ")", "but", "not", "found", "\"", ",", "user_func", "-", ">", "value", ".", "str", ".", "val", ")", ";", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "break", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "retval_ptr", ")", "{", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "return", "0", ";", "}", "/", "*", "The", "callback", "function", "may", "have", "defined", "the", "class", "*", "/", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "zend_lookup_class", "(", "class_name", ",", "len2", ",", "&", "pce", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "ce", "=", "*", "pce", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "1", "'", ")", "goto", "yy42", ";", "goto", "yy18", ";", "yy25", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "{", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy43", ";", "goto", "yy18", ";", "}", "else", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Function", "%", "s", "(", ")", "hasn", "'", "t", "defined", "the", "class", "it", "was", "called", "for", "\"", ",", "user_func", "-", ">", "value", ".", "str", ".", "val", ")", ";", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy44", ";", "if", "(", "yych", "<", "=", "'", ".'", ")", "goto", "yy45", ";", "goto", "yy18", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "break", ";", "}", "while", "(", "1", ")", ";", "*", "p", "=", "YYCURSOR", ";", "if", "(", "custom_object", ")", "{", "int", "ret", ";", "ret", "=", "object_custom", "(", "UNSERIALIZE_PASSTHRU", ",", "ce", ")", ";", "if", "(", "ret", "&", "&", "incomplete_class", ")", "{", "php_store_class_name", "(", "*", "rval", ",", "class_name", ",", "len2", ")", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "I", "'", ")", "{", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy46", ";", "if", "(", "yych", "<", "=", "'", "H", "'", ")", "goto", "yy18", ";", "goto", "yy48", ";", "}", "else", "{", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy49", ";", "goto", "yy18", ";", "}", "efree", "(", "class_name", ")", ";", "return", "ret", ";", "}", "elements", "=", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ce", ")", ";", "if", "(", "elements", "<", "0", ")", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "yy26", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy50", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy50", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy51", ";", "goto", "yy18", ";", "}", "if", "(", "incomplete_class", ")", "{", "php_store_class_name", "(", "*", "rval", ",", "class_name", ",", "len2", ")", ";", "yy27", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy53", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy53", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy54", ";", "goto", "yy18", ";", "}", "efree", "(", "class_name", ")", ";", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "elements", ")", ";", "}", "#", "line", "797", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy25", ":", "yy28", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "!", "=", "'", "+'", ")", "goto", "yy18", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy56", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy26", ";", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy56", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy27", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy57", ";", "goto", "yy18", ";", "}", "yy26", ":", "yy29", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy59", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy27", ":", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy60", ";", "goto", "yy18", ";", "yy30", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yybm", "[", "0", "+", "yych", "]", "&", "128", ")", "{", "goto", "yy31", ";", "}", "goto", "yy18", ";", "yy31", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "2", ")", "YYFILL", "(", "2", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yybm", "[", "0", "+", "yych", "]", "&", "128", ")", "{", "goto", "yy31", ";", "}", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy27", ";", "if", "(", "yych", ">", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy62", ";", "goto", "yy18", ";", "yy33", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy34", ":", "+", "+", "YYCURSOR", ";", "#", "line", "704", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "elements", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "elements", "=", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ZEND_STANDARD_CLASS_DEF_PTR", ")", ";", "if", "(", "elements", "<", "0", ")", "{", "return", "0", ";", "}", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "elements", ")", ";", "}", "#", "line", "835", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy32", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy33", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy34", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy63", ";", "goto", "yy18", ";", "yy33", ":", "yy36", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy34", ":", "yy37", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "2", ")", "YYFILL", "(", "2", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy34", ";", "if", "(", "yych", ">", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy37", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy65", ";", "goto", "yy18", ";", "yy39", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "{'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy40", ":", "+", "+", "YYCURSOR", ";", "#", "line", "683", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "elements", "=", "parse_iv", "(", "start", "+", "2", ")", ";", "/", "*", "use", "iv", "(", ")", "not", "uiv", "(", ")", "in", "order", "to", "check", "data", "range", "*", "/", "*", "p", "=", "YYCURSOR", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "if", "(", "elements", "<", "0", ")", "{", "return", "0", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "2", ")", "YYFILL", "(", "2", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy40", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy66", ";", "goto", "yy18", ";", "yy42", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy67", ";", "goto", "yy18", ";", "yy43", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", ".'", ")", "goto", "yy45", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy46", ";", "goto", "yy18", ";", "yy44", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "{", "if", "(", "yych", "!", "=", "'", ".'", ")", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy46", ";", "if", "(", "yych", "=", "=", "'", "I", "'", ")", "goto", "yy48", ";", "goto", "yy18", ";", "}", "INIT_PZVAL", "(", "*", "rval", ")", ";", "array_init_size", "(", "*", "rval", ",", "elements", ")", ";", "if", "(", "!", "process_nested_data", "(", "UNSERIALIZE_PASSTHRU", ",", "Z_ARRVAL_PP", "(", "rval", ")", ",", "elements", ",", "0", ")", ")", "{", "return", "0", ";", "yy45", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy69", ";", "goto", "yy18", ";", "yy46", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "4", ")", "YYFILL", "(", "4", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "{", "if", "(", "yych", "<", "=", "'", ".'", ")", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy18", ";", "goto", "yy69", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy46", ";", "goto", "yy18", ";", "}", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "E", "'", ")", "{", "if", "(", "yych", "<", "=", "'", ";'", ")", "goto", "yy71", ";", "if", "(", "yych", "<", "=", "'", "D", "'", ")", "goto", "yy18", ";", "goto", "yy73", ";", "}", "else", "{", "if", "(", "yych", "=", "=", "'", "e", "'", ")", "goto", "yy73", ";", "goto", "yy18", ";", "}", "}", "return", "finish_nested_data", "(", "UNSERIALIZE_PASSTHRU", ")", ";", "}", "#", "line", "877", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy39", ":", "yy48", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy74", ";", "goto", "yy18", ";", "yy49", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy40", ";", "if", "(", "yych", "=", "=", "'", "A", "'", ")", "goto", "yy75", ";", "goto", "yy18", ";", "yy50", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy51", ":", "+", "+", "YYCURSOR", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy41", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy51", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy76", ";", "goto", "yy18", ";", "yy40", ":", "yy53", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy41", ":", "yy54", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "2", ")", "YYFILL", "(", "2", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy41", ";", "if", "(", "yych", ">", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy54", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy78", ";", "goto", "yy18", ";", "yy56", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy57", ":", "+", "+", "YYCURSOR", ";", "#", "line", "648", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "if", "(", "maxlen", "<", "len", ")", "{", "*", "p", "=", "start", "+", "2", ";", "return", "0", ";", "}", "if", "(", "(", "str", "=", "unserialize_str", "(", "&", "YYCURSOR", ",", "&", "len", ",", "maxlen", ")", ")", "=", "=", "NULL", ")", "{", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", ")", "!", "=", "'", "\"'", ")", "{", "efree", "(", "str", ")", ";", "*", "p", "=", "YYCURSOR", ";", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", "+", "1", ")", "!", "=", "'", ";'", ")", "{", "efree", "(", "str", ")", ";", "*", "p", "=", "YYCURSOR", "+", "1", ";", "return", "0", ";", "}", "YYCURSOR", "+", "=", "2", ";", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "0", ")", ";", "return", "1", ";", "}", "#", "line", "933", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy46", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy47", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy48", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy57", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy79", ";", "goto", "yy18", ";", "yy47", ":", "yy59", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy48", ":", "yy60", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "2", ")", "YYFILL", "(", "2", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy48", ";", "if", "(", "yych", ">", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy60", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy81", ";", "goto", "yy18", ";", "yy62", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "if", "(", "yych", "=", "=", "'", "\"'", ")", "goto", "yy82", ";", "goto", "yy18", ";", "yy63", ":", "+", "+", "YYCURSOR", ";", "#", "line", "615", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "537", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "if", "(", "maxlen", "<", "len", ")", "{", "*", "p", "=", "start", "+", "2", ";", "return", "0", ";", "}", "str", "=", "(", "char", "*", ")", "YYCURSOR", ";", "long", "id", ";", "YYCURSOR", "+", "=", "len", ";", "*", "p", "=", "YYCURSOR", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "if", "(", "*(", "YYCURSOR", ")", "!", "=", "'", "\"'", ")", "{", "*", "p", "=", "YYCURSOR", ";", "id", "=", "parse_iv", "(", "start", "+", "2", ")", "-", "1", ";", "if", "(", "id", "=", "=", "-", "1", "|", "|", "var_access", "(", "var_hash", ",", "id", ",", "&", "rval_ref", ")", "!", "=", "SUCCESS", ")", "{", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", "+", "1", ")", "!", "=", "'", ";'", ")", "{", "*", "p", "=", "YYCURSOR", "+", "1", ";", "return", "0", ";", "if", "(", "*", "rval", "!", "=", "NULL", ")", "{", "var_push_dtor_no_addref", "(", "var_hash", ",", "rval", ")", ";", "}", "*", "rval", "=", "*", "rval_ref", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "Z_SET_ISREF_PP", "(", "rval", ")", ";", "YYCURSOR", "+", "=", "2", ";", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "1", ")", ";", "return", "1", ";", "}", "#", "line", "987", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy53", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "{", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy57", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy55", ";", "if", "(", "yych", "<", "=", "'", ".'", ")", "goto", "yy60", ";", "goto", "yy18", ";", "}", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "I", "'", ")", "{", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy58", ";", "if", "(", "yych", "<", "=", "'", "H", "'", ")", "goto", "yy18", ";", "goto", "yy56", ";", "}", "else", "{", "if", "(", "yych", "!", "=", "'", "N", "'", ")", "goto", "yy18", ";", "}", "}", "#", "line", "936", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy65", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "A", "'", ")", "goto", "yy76", ";", "if", "(", "yych", "=", "=", "'", "\"'", ")", "goto", "yy84", ";", "goto", "yy18", ";", "yy55", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "{", "if", "(", "yych", "=", "=", "'", ".'", ")", "goto", "yy60", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy58", ";", "if", "(", "yych", "!", "=", "'", "I", "'", ")", "goto", "yy18", ";", "}", "yy56", ":", "yy66", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy72", ";", "if", "(", "yych", "=", "=", "'", "{'", ")", "goto", "yy86", ";", "goto", "yy18", ";", "yy57", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", ".'", ")", "goto", "yy60", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy58", ":", "yy67", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "4", ")", "YYFILL", "(", "4", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "{", "if", "(", "yych", "<", "=", "'", ".'", ")", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy18", ";", "goto", "yy70", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy58", ";", "goto", "yy18", ";", "}", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "E", "'", ")", "{", "if", "(", "yych", "<", "=", "'", ";'", ")", "goto", "yy63", ";", "if", "(", "yych", "<", "=", "'", "D", "'", ")", "goto", "yy18", ";", "goto", "yy65", ";", "}", "else", "{", "if", "(", "yych", "=", "=", "'", "e", "'", ")", "goto", "yy65", ";", "goto", "yy18", ";", "}", "}", "yy60", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy61", ":", "#", "line", "588", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_BOOL", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "954", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy69", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "4", ")", "YYFILL", "(", "4", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ";'", ")", "{", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy61", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy69", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "E", "'", ")", "{", "if", "(", "yych", "<", "=", "'", "D", "'", ")", "goto", "yy18", ";", "goto", "yy65", ";", "goto", "yy73", ";", "}", "else", "{", "if", "(", "yych", "=", "=", "'", "e", "'", ")", "goto", "yy65", ";", "if", "(", "yych", "=", "=", "'", "e", "'", ")", "goto", "yy73", ";", "goto", "yy18", ";", "}", "}", "yy63", ":", "yy71", ":", "+", "+", "YYCURSOR", ";", "#", "line", "605", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "637", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "#", "if", "SIZEOF_LONG", "=", "=", "4", "use_double", ":", "@", "@", "-", "1081", ",", "111", "+", "980", ",", "32", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_DOUBLE", "(", "*", "rval", ",", "zend_strtod", "(", "(", "const", "char", "*", ")", "start", "+", "2", ",", "NULL", ")", ");", "return", "1", ";", "}", "#", "line", "1085", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy65", ":", "#", "line", "984", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy73", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "!", "=", "'", "+'", ")", "goto", "yy18", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy88", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy66", ";", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy88", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy67", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy89", ";", "goto", "yy18", ";", "}", "yy66", ":", "yy74", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy69", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy69", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "}", "yy67", ":", "+", "+", "YYCURSOR", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy67", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy63", ";", "if", "(", "yych", "=", "=", "'", "F", "'", ")", "goto", "yy91", ";", "goto", "yy18", ";", "yy69", ":", "yy75", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy67", ";", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy91", ";", "goto", "yy18", ";", "yy70", ":", "+", "+", "YYCURSOR", ";", "if", "(", "(", "YYLIMIT", "-", "YYCURSOR", ")", "<", "4", ")", "YYFILL", "(", "4", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ";'", ")", "{", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy70", ";", "if", "(", "yych", "<", "=", "'", ":'", ")", "goto", "yy18", ";", "goto", "yy63", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "E", "'", ")", "{", "if", "(", "yych", "<", "=", "'", "D", "'", ")", "goto", "yy18", ";", "goto", "yy65", ";", "}", "else", "{", "if", "(", "yych", "=", "=", "'", "e", "'", ")", "goto", "yy65", ";", "goto", "yy18", ";", "}", "}", "yy72", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "F", "'", ")", "goto", "yy18", ";", "yy73", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "yy76", ":", "+", "+", "YYCURSOR", ";", "#", "line", "590", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "595", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "if", "(", "!", "strncmp", "(", "start", "+", "2", ",", "\"", "NAN", "\"", ",", "3", ")", ")", "{", "ZVAL_DOUBLE", "(", "*", "rval", ",", "php_get_nan", "(", "))", ";", "}", "else", "if", "(", "!", "strncmp", "(", "start", "+", "2", ",", "\"", "INF", "\"", ",", "3", ")", ")", "{", "ZVAL_DOUBLE", "(", "*", "rval", ",", "php_get_inf", "(", "))", ";", "}", "else", "if", "(", "!", "strncmp", "(", "start", "+", "2", ",", "\"", "-", "INF", "\"", ",", "4", ")", ")", "{", "ZVAL_DOUBLE", "(", "*", "rval", ",", "-", "php_get_inf", "(", "))", ";", "}", "return", "1", ";", "}", "#", "line", "1159", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy76", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy73", ";", "goto", "yy18", ";", "yy77", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "!", "=", "'", "+'", ")", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy78", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy79", ";", "goto", "yy18", ";", "}", "yy78", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy79", ":", "+", "+", "YYCURSOR", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy79", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "563", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "#", "if", "SIZEOF_LONG", "=", "=", "4", "int", "digits", "=", "YYCURSOR", "-", "start", "-", "3", ";", "#", "if", "SIZEOF_LONG", "=", "=", "4", "int", "digits", "=", "YYCURSOR", "-", "start", "-", "3", ";", "if", "(", "start", "[", "2", "]", "=", "=", "'", "-'", "|", "|", "start", "[", "2", "]", "=", "=", "'", "+'", ")", "{", "digits", "-", "-;", "@", "@", "-", "1209", ",", "55", "+", "1029", ",", "14", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_LONG", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "1213", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy83", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", "2", "'", ")", "goto", "yy18", ";", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "556", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_BOOL", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "1228", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy87", ":", "+", "+", "YYCURSOR", ";", "#", "line", "549", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "1238", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy89", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "!", "=", "'", "+'", ")", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy90", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy91", ";", "goto", "yy18", ";", "}", "yy90", ":", "#", "line", "1033", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy78", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy91", ":", "+", "+", "YYCURSOR", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy91", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "=", "=", "'", "\"'", ")", "goto", "yy92", ";", "goto", "yy18", ";", "yy79", ":", "+", "+", "YYCURSOR", ";", "#", "line", "526", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "558", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "id", ";", "@", "@", "-", "1280", ",", "53", "+", "1059", ",", "329", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1284", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy95", ":", "#", "line", "1063", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy81", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "\"'", ")", "goto", "yy94", ";", "goto", "yy18", ";", "yy82", ":", "+", "+", "YYCURSOR", ";", "#", "line", "749", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "len2", ",", "len3", ",", "maxlen", ";", "long", "elements", ";", "char", "*", "class_name", ";", "zend_class_entry", "*", "ce", ";", "zend_class_entry", "*", "*", "pce", ";", "int", "incomplete_class", "=", "0", ";", "int", "custom_object", "=", "0", ";", "zval", "*", "user_func", ";", "zval", "*", "retval_ptr", ";", "zval", "*", "*", "args", "[", "1", "]", ";", "zval", "*", "arg_func_name", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "if", "(", "*", "start", "=", "=", "'", "C", "'", ")", "{", "custom_object", "=", "1", ";", "}", "INIT_PZVAL", "(", "*", "rval", ")", ";", "len2", "=", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "if", "(", "maxlen", "<", "len", "|", "|", "len", "=", "=", "0", ")", "{", "*", "p", "=", "start", "+", "2", ";", "return", "0", ";", "}", "class_name", "=", "(", "char", "*", ")", "YYCURSOR", ";", "YYCURSOR", "+", "=", "len", ";", "if", "(", "*(", "YYCURSOR", ")", "!", "=", "'", "\"'", ")", "{", "*", "p", "=", "YYCURSOR", ";", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", "+", "1", ")", "!", "=", "'", ":'", ")", "{", "*", "p", "=", "YYCURSOR", "+", "1", ";", "return", "0", ";", "}", "len3", "=", "strspn", "(", "class_name", ",", "\"", "0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ", "\\", "177", "\\", "200", "\\", "201", "\\", "202", "\\", "203", "\\", "204", "\\", "205", "\\", "206", "\\", "207", "\\", "210", "\\", "211", "\\", "212", "\\", "213", "\\", "214", "\\", "215", "\\", "216", "\\", "217", "\\", "220", "\\", "221", "\\", "222", "\\", "223", "\\", "224", "\\", "225", "\\", "226", "\\", "227", "\\", "230", "\\", "231", "\\", "232", "\\", "233", "\\", "234", "\\", "235", "\\", "236", "\\", "237", "\\", "240", "\\", "241", "\\", "242", "\\", "243", "\\", "244", "\\", "245", "\\", "246", "\\", "247", "\\", "250", "\\", "251", "\\", "252", "\\", "253", "\\", "254", "\\", "255", "\\", "256", "\\", "257", "\\", "260", "\\", "261", "\\", "262", "\\", "263", "\\", "264", "\\", "265", "\\", "266", "\\", "267", "\\", "270", "\\", "271", "\\", "272", "\\", "273", "\\", "274", "\\", "275", "\\", "276", "\\", "277", "\\", "300", "\\", "301", "\\", "302", "\\", "303", "\\", "304", "\\", "305", "\\", "306", "\\", "307", "\\", "310", "\\", "311", "\\", "312", "\\", "313", "\\", "314", "\\", "315", "\\", "316", "\\", "317", "\\", "320", "\\", "321", "\\", "322", "\\", "323", "\\", "324", "\\", "325", "\\", "326", "\\", "327", "\\", "330", "\\", "331", "\\", "332", "\\", "333", "\\", "334", "\\", "335", "\\", "336", "\\", "337", "\\", "340", "\\", "341", "\\", "342", "\\", "343", "\\", "344", "\\", "345", "\\", "346", "\\", "347", "\\", "350", "\\", "351", "\\", "352", "\\", "353", "\\", "354", "\\", "355", "\\", "356", "\\", "357", "\\", "360", "\\", "361", "\\", "362", "\\", "363", "\\", "364", "\\", "365", "\\", "366", "\\", "367", "\\", "370", "\\", "371", "\\", "372", "\\", "373", "\\", "374", "\\", "375", "\\", "376", "\\", "377", "\\", "\\\"", ");", "if", "(", "len3", "!", "=", "len", ")", "{", "*", "p", "=", "YYCURSOR", "+", "len3", "-", "len", ";", "return", "0", ";", "}", "class_name", "=", "estrndup", "(", "class_name", ",", "len", ")", ";", "do", "{", "/", "*", "Try", "to", "find", "class", "directly", "*", "/", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "zend_lookup_class", "(", "class_name", ",", "len2", ",", "&", "pce", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "ce", "=", "*", "pce", ";", "break", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "/", "*", "Check", "for", "unserialize", "callback", "*", "/", "if", "(", "(", "PG", "(", "unserialize_callback_func", ")", "=", "=", "NULL", ")", "|", "|", "(", "PG", "(", "unserialize_callback_func", ")", "[", "0", "]", "=", "=", "'", "\\", "0", "'", "))", "{", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "break", ";", "}", "/", "*", "Call", "unserialize", "callback", "*", "/", "MAKE_STD_ZVAL", "(", "user_func", ")", ";", "ZVAL_STRING", "(", "user_func", ",", "PG", "(", "unserialize_callback_func", ")", ",", "1", ")", ";", "args", "[", "0", "]", "=", "&", "arg_func_name", ";", "MAKE_STD_ZVAL", "(", "arg_func_name", ")", ";", "ZVAL_STRING", "(", "arg_func_name", ",", "class_name", ",", "1", ")", ";", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "call_user_function_ex", "(", "CG", "(", "function_table", ")", ",", "NULL", ",", "user_func", ",", "&", "retval_ptr", ",", "1", ",", "args", ",", "0", ",", "NULL", "TSRMLS_CC", ")", "!", "=", "SUCCESS", ")", "{", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "return", "0", ";", "}", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "defined", "(", "%", "s", ")", "but", "not", "found", "\"", ",", "user_func", "-", ">", "value", ".", "str", ".", "val", ")", ";", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "break", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "retval_ptr", ")", "{", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "if", "(", "EG", "(", "exception", ")", ")", "{", "efree", "(", "class_name", ")", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "return", "0", ";", "}", "/", "*", "The", "callback", "function", "may", "have", "defined", "the", "class", "*", "/", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "zend_lookup_class", "(", "class_name", ",", "len2", ",", "&", "pce", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "ce", "=", "*", "pce", ";", "}", "else", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Function", "%", "s", "(", ")", "hasn", "'", "t", "defined", "the", "class", "it", "was", "called", "for", "\"", ",", "user_func", "-", ">", "value", ".", "str", ".", "val", ")", ";", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "zval_ptr_dtor", "(", "&", "user_func", ")", ";", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "break", ";", "}", "while", "(", "1", ")", ";", "*", "p", "=", "YYCURSOR", ";", "if", "(", "custom_object", ")", "{", "int", "ret", ";", "ret", "=", "object_custom", "(", "UNSERIALIZE_PASSTHRU", ",", "ce", ")", ";", "if", "(", "ret", "&", "&", "incomplete_class", ")", "{", "php_store_class_name", "(", "*", "rval", ",", "class_name", ",", "len2", ")", ";", "}", "efree", "(", "class_name", ")", ";", "return", "ret", ";", "}", "elements", "=", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ce", ")", ";", "if", "(", "elements", "<", "0", ")", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "if", "(", "incomplete_class", ")", "{", "php_store_class_name", "(", "*", "rval", ",", "class_name", ",", "len2", ")", ";", "}", "efree", "(", "class_name", ")", ";", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "elements", ")", ";", "}", "#", "line", "1224", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy84", ":", "+", "+", "YYCURSOR", ";", "#", "line", "680", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "if", "(", "maxlen", "<", "len", ")", "{", "*", "p", "=", "start", "+", "2", ";", "return", "0", ";", "}", "if", "(", "(", "str", "=", "unserialize_str", "(", "&", "YYCURSOR", ",", "&", "len", ",", "maxlen", ")", ")", "=", "=", "NULL", ")", "{", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", ")", "!", "=", "'", "\"'", ")", "{", "efree", "(", "str", ")", ";", "*", "p", "=", "YYCURSOR", ";", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", "+", "1", ")", "!", "=", "'", ";'", ")", "{", "efree", "(", "str", ")", ";", "*", "p", "=", "YYCURSOR", "+", "1", ";", "return", "0", ";", "}", "YYCURSOR", "+", "=", "2", ";", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "0", ")", ";", "return", "1", ";", "}", "#", "line", "1262", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy86", ":", "+", "+", "YYCURSOR", ";", "#", "line", "715", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "elements", "=", "parse_iv", "(", "start", "+", "2", ")", ";", "/", "*", "use", "iv", "(", ")", "not", "uiv", "(", ")", "in", "order", "to", "check", "data", "range", "*", "/", "*", "p", "=", "YYCURSOR", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "if", "(", "elements", "<", "0", ")", "{", "return", "0", ";", "}", "INIT_PZVAL", "(", "*", "rval", ")", ";", "array_init_size", "(", "*", "rval", ",", "elements", ")", ";", "if", "(", "!", "process_nested_data", "(", "UNSERIALIZE_PASSTHRU", ",", "Z_ARRVAL_PP", "(", "rval", ")", ",", "elements", ",", "0", ")", ")", "{", "return", "0", ";", "}", "return", "finish_nested_data", "(", "UNSERIALIZE_PASSTHRU", ")", ";", "}", "#", "line", "1286", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy88", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "if", "(", "yych", "!", "=", "'", "+'", ")", "goto", "yy18", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy96", ";", "goto", "yy18", ";", "}", "else", "{", "if", "(", "yych", "<", "=", "'", "-'", ")", "goto", "yy96", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy97", ";", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "}", "yy96", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ":'", ")", "goto", "yy18", ";", "yy97", ":", "yy89", ":", "+", "+", "YYCURSOR", ";", "if", "(", "YYLIMIT", "<", "=", "YYCURSOR", ")", "YYFILL", "(", "1", ")", ";", "yych", "=", "*", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy97", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy89", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy71", ";", "goto", "yy18", ";", "yy91", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", ";'", ")", "goto", "yy97", ";", "goto", "yy18", ";", "yy92", ":", "+", "+", "YYCURSOR", ";", "#", "line", "505", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "736", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "id", ";", "long", "elements", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "*", "p", "=", "YYCURSOR", ";", "if", "(", "!", "var_hash", ")", "return", "0", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "id", "=", "parse_iv", "(", "start", "+", "2", ")", "-", "1", ";", "if", "(", "id", "=", "=", "-", "1", "|", "|", "var_access", "(", "var_hash", ",", "id", ",", "&", "rval_ref", ")", "!", "=", "SUCCESS", ")", "{", "elements", "=", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ZEND_STANDARD_CLASS_DEF_PTR", ")", ";", "if", "(", "elements", "<", "0", ")", "{", "return", "0", ";", "}", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "elements", ")", ";", "}", "#", "line", "1324", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy94", ":", "+", "+", "YYCURSOR", ";", "#", "line", "647", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "if", "(", "*", "rval", "!", "=", "NULL", ")", "{", "var_push_dtor_no_addref", "(", "var_hash", ",", "rval", ")", ";", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "if", "(", "maxlen", "<", "len", ")", "{", "*", "p", "=", "start", "+", "2", ";", "return", "0", ";", "}", "str", "=", "(", "char", "*", ")", "YYCURSOR", ";", "YYCURSOR", "+", "=", "len", ";", "if", "(", "*(", "YYCURSOR", ")", "!", "=", "'", "\"'", ")", "{", "*", "p", "=", "YYCURSOR", ";", "return", "0", ";", "}", "if", "(", "*(", "YYCURSOR", "+", "1", ")", "!", "=", "'", ";'", ")", "{", "*", "p", "=", "YYCURSOR", "+", "1", ";", "return", "0", ";", "}", "YYCURSOR", "+", "=", "2", ";", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "1", ")", ";", "return", "1", ";", "}", "#", "line", "1360", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy96", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy89", ";", "goto", "yy18", ";", "yy97", ":", "+", "+", "YYCURSOR", ";", "#", "line", "622", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "if", "(", "!", "strncmp", "(", "start", "+", "2", ",", "\"", "NAN", "\"", ",", "3", ")", ")", "{", "ZVAL_DOUBLE", "(", "*", "rval", ",", "php_get_nan", "(", "))", ";", "}", "else", "if", "(", "!", "strncmp", "(", "start", "+", "2", ",", "\"", "INF", "\"", ",", "3", ")", ")", "{", "ZVAL_DOUBLE", "(", "*", "rval", ",", "php_get_inf", "(", "))", ";", "}", "else", "if", "(", "!", "strncmp", "(", "start", "+", "2", ",", "\"", "-", "INF", "\"", ",", "4", ")", ")", "{", "ZVAL_DOUBLE", "(", "*", "rval", ",", "-", "php_get_inf", "(", "))", ";", "}", "*", "rval", "=", "*", "rval_ref", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "Z_SET_ISREF_PP", "(", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "1328", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1383", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "}", "#", "line", "879", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "911", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "return", "0", ";", "@", "@", "-", "26", ",", "6", "+", "26", ",", "11", "@", "@", "#", "define", "VAR_ENTRIES_MAX", "1024", "#", "define", "VAR_ENTRIES_DBG", "0", "#", "define", "VAR_WAKEUP_FLAG", "1", "#", "define", "WITH_WAKEUP_FLAG", "(", "zv_ptr", ")", "(", "(", "zval", "*", ")", "(", "(", "zend_uintptr_t", ")", "zv_ptr", "|", "VAR_WAKEUP_FLAG", ")", ")", "#", "define", "WITHOUT_WAKEUP_FLAG", "(", "zv_ptr", ")", "(", "(", "zval", "*", ")", "(", "(", "zend_uintptr_t", ")", "zv_ptr", "&", "~", "VAR_WAKEUP_FLAG", ")", ")", "#", "define", "HAS_WAKEUP_FLAG", "(", "zv_ptr", ")", "(", "(", "zend_uintptr_t", ")", "zv_ptr", "&", "VAR_WAKEUP_FLAG", ")", "typedef", "struct", "{", "zval", "*", "data", "[", "VAR_ENTRIES_MAX", "]", ";", "long", "used_slots", ";", "@", "@", "-", "56", ",", "12", "+", "61", ",", "12", "@", "@", "static", "inline", "void", "var_push", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "var_hash", "-", ">", "data", "[", "var_hash", "-", ">", "used_slots", "+", "+]", "=", "*", "rval", ";", "}", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "static", "inline", "zval", "*", "*", "get_var_push_dtor_slot", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "{", "var_entries", "*", "var_hash", ";", "if", "(", "!", "var_hashx", "|", "|", "!", "*", "var_hashx", ")", "{", "return", ";", "return", "NULL", ";", "}", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "last_dtor", ";", "@", "@", "-", "83", ",", "8", "+", "88", ",", "14", "@", "@", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "(", "*", "var_hashx", ")", "->", "last_dtor", "=", "var_hash", ";", "}", "return", "&", "var_hash", "-", ">", "data", "[", "var_hash", "-", ">", "used_slots", "+", "+]", ";", "}", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "{", "zval", "*", "*", "slot", "=", "get_var_push_dtor_slot", "(", "var_hashx", ")", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "var_hash", "-", ">", "data", "[", "var_hash", "-", ">", "used_slots", "+", "+]", "=", "*", "rval", ";", "*", "slot", "=", "*", "rval", ";", "}", "PHPAPI", "void", "var_push_dtor_no_addref", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "@", "@", "-", "162", ",", "6", "+", "173", ",", "9", "@", "@", "PHPAPI", "void", "var_destroy", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "void", "*", "next", ";", "long", "i", ";", "var_entries", "*", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "first", ";", "zend_bool", "wakeup_failed", "=", "0", ";", "TSRMLS_FETCH", "(", ");", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_destroy", "(", "%", "ld", ")", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ")", ";", "#", "endif", "@", "@", "-", "176", ",", "10", "+", "190", ",", "35", "@", "@", "PHPAPI", "void", "var_destroy", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "while", "(", "var_hash", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "var_hash", "-", ">", "used_slots", ";", "i", "+", "+)", "{", "zval", "*", "zv", "=", "var_hash", "-", ">", "data", "[", "i", "]", ";", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_destroy", "dtor", "(", "%", "p", ",", "%", "ld", ")", "\\", "n", "\"", ",", "var_hash", "-", ">", "data", "[", "i", "]", ",", "Z_REFCOUNT_P", "(", "var_hash", "-", ">", "data", "[", "i", "]", "))", ";", "#", "endif", "zval_ptr_dtor", "(", "&", "var_hash", "-", ">", "data", "[", "i", "]", ");", "if", "(", "HAS_WAKEUP_FLAG", "(", "zv", ")", ")", "{", "zv", "=", "WITHOUT_WAKEUP_FLAG", "(", "zv", ")", ";", "if", "(", "!", "wakeup_failed", ")", "{", "zval", "*", "retval_ptr", "=", "NULL", ";", "zval", "wakeup_name", ";", "INIT_PZVAL", "(", "&", "wakeup_name", ")", ";", "ZVAL_STRINGL", "(", "&", "wakeup_name", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", ")", "-", "1", ",", "0", ")", ";", "BG", "(", "serialize_lock", ")", "++", ";", "if", "(", "call_user_function_ex", "(", "CG", "(", "function_table", ")", ",", "&", "zv", ",", "&", "wakeup_name", ",", "&", "retval_ptr", ",", "0", ",", "0", ",", "1", ",", "NULL", "TSRMLS_CC", ")", "=", "=", "FAILURE", "|", "|", "retval_ptr", "=", "=", "NULL", ")", "{", "wakeup_failed", "=", "1", ";", "zend_object_store_ctor_failed", "(", "zv", "TSRMLS_CC", ")", ";", "}", "BG", "(", "serialize_lock", ")", "--", ";", "if", "(", "retval_ptr", ")", "{", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "}", "else", "{", "zend_object_store_ctor_failed", "(", "zv", "TSRMLS_CC", ")", ";", "}", "}", "zval_ptr_dtor", "(", "&", "zv", ")", ";", "}", "next", "=", "var_hash", "-", ">", "next", ";", "efree", "(", "var_hash", ")", ";", "@", "@", "-", "435", ",", "19", "+", "474", ",", "16", "@", "@", "static", "inline", "long", "object_common1", "(", "UNSERIALIZE_PARAMETER", ",", "zend_class_entry", "*", "ce", ")", "#", "endif", "static", "inline", "int", "object_common2", "(", "UNSERIALIZE_PARAMETER", ",", "long", "elements", ")", "{", "zval", "*", "retval_ptr", "=", "NULL", ";", "zval", "fname", ";", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "!", "=", "IS_OBJECT", ")", "{", "return", "0", ";", "}", "if", "(", "!", "process_nested_data", "(", "UNSERIALIZE_PASSTHRU", ",", "Z_OBJPROP_PP", "(", "rval", ")", ",", "elements", ",", "1", ")", ")", "{", "/", "*", "We", "'", "ve", "got", "partially", "constructed", "object", "on", "our", "hands", "here", ".", "Wipe", "it", ".", "*", "/", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "=", "=", "IS_OBJECT", ")", "{", "zend_hash_clean", "(", "Z_OBJPROP_PP", "(", "rval", ")", ");", "zend_object_store_ctor_failed", "(", "*", "rval", "TSRMLS_CC", ")", ";", "}", "/", "*", "We", "'", "ve", "got", "partially", "constructed", "object", "on", "our", "hands", "here", ".", "Wipe", "it", ".", "*", "/", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "=", "=", "IS_OBJECT", ")", "{", "zend_hash_clean", "(", "Z_OBJPROP_PP", "(", "rval", ")", ");", "zend_object_store_ctor_failed", "(", "*", "rval", "TSRMLS_CC", ")", ";", "}", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "0", ";", "}", "@", "@", "-", "457", ",", "20", "+", "493", ",", "16", "@", "@", "static", "inline", "int", "object_common2", "(", "UNSERIALIZE_PARAMETER", ",", "long", "elements", ")", "}", "if", "(", "Z_OBJCE_PP", "(", "rval", ")", "!", "=", "PHP_IC_ENTRY", "&", "&", "zend_hash_exists", "(", "&", "Z_OBJCE_PP", "(", "rval", ")", "->", "function_table", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", "))", ")", "{", "INIT_PZVAL", "(", "&", "fname", ")", ";", "ZVAL_STRINGL", "(", "&", "fname", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", ")", "-", "1", ",", "0", ")", ";", "BG", "(", "serialize_lock", ")", "++", ";", "call_user_function_ex", "(", "CG", "(", "function_table", ")", ",", "rval", ",", "&", "fname", ",", "&", "retval_ptr", ",", "0", ",", "0", ",", "1", ",", "NULL", "TSRMLS_CC", ")", ";", "BG", "(", "serialize_lock", ")", "--", ";", "}", "if", "(", "retval_ptr", ")", "{", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "if", "(", "EG", "(", "exception", ")", ")", "{", "return", "0", ";", "zend_hash_exists", "(", "&", "Z_OBJCE_PP", "(", "rval", ")", "->", "function_table", ",", "\"", "__wakeup", "\"", ",", "sizeof", "(", "\"", "__wakeup", "\"", "))", ")", "{", "/", "*", "Store", "object", "for", "delayed", "__wakeup", "call", ".", "Remove", "references", ".", "*", "/", "zval", "*", "*", "slot", "=", "get_var_push_dtor_slot", "(", "var_hash", ")", ";", "zval", "*", "zv", "=", "*", "rval", ";", "Z_ADDREF_P", "(", "zv", ")", ";", "if", "(", "PZVAL_IS_REF", "(", "zv", ")", ")", "{", "SEPARATE_ZVAL", "(", "&", "zv", ")", ";", "}", "*", "slot", "=", "WITH_WAKEUP_FLAG", "(", "zv", ")", ";", "}", "return", "finish_nested_data", "(", "UNSERIALIZE_PASSTHRU", ")", ";"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["pohmelfs/connector:", "Disallow", "unpliviged", "users", "to", "configure", "pohmelfs", "Signed-off-by:", "Philipp", "Reisner", "<philipp.reisner@linbit.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "531", ",", "6", "+", "531", ",", "9", "@", "@", "static", "void", "pohmelfs_cn_callback", "(", "struct", "cn_msg", "*", "msg", ",", "struct", "netlink_skb_parms", "*", "n", "{", "int", "err", ";", "if", "(", "!", "cap_raised", "(", "nsp", "-", ">", "eff_cap", ",", "CAP_SYS_ADMIN", ")", ")", "return", ";", "switch", "(", "msg", "-", ">", "flags", ")", "{", "case", "POHMELFS_FLAGS_ADD", ":", "case", "POHMELFS_FLAGS_DEL", ":"], "docstring_tokens": ["bypass", "intended", "access", "restrictions", "and", "gain", "privileges"]}
{"contents": ["irda:", "Fix", "lockdep", "annotations", "in", "hashbin_delete().", "A", "nested", "lock", "depth", "was", "added", "to", "the", "hasbin_delete()", "code", "but", "it", "doesn't", "actually", "work", "some", "well", "and", "results", "in", "tons", "of", "lockdep", "splats.", "Fix", "the", "code", "instead", "to", "properly", "drop", "the", "lock", "around", "the", "operation", "and", "just", "keep", "peeking", "the", "head", "of", "the", "hashbin", "queue.", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Tested-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "383", ",", "9", "+", "383", ",", "6", "@", "@", "EXPORT_SYMBOL", "(", "hashbin_new", ")", ";", "*", "for", "deallocating", "this", "structure", "if", "it", "'", "s", "complex", ".", "If", "not", "the", "user", "can", "*", "just", "supply", "kfree", ",", "which", "should", "take", "care", "of", "the", "job", ".", "*", "/", "#", "ifdef", "CONFIG_LOCKDEP", "static", "int", "hashbin_lock_depth", "=", "0", ";", "#", "endif", "int", "hashbin_delete", "(", "hashbin_t", "*", "hashbin", ",", "FREE_FUNC", "free_func", ")", "{", "irda_queue_t", "*", "queue", ";", "@", "@", "-", "396", ",", "22", "+", "393", ",", "27", "@", "@", "int", "hashbin_delete", "(", "hashbin_t", "*", "hashbin", ",", "FREE_FUNC", "free_func", ")", "IRDA_ASSERT", "(", "hashbin", "-", ">", "magic", "=", "=", "HB_MAGIC", ",", "return", "-", "1", ";", ");", "/", "*", "Synchronize", "*", "/", "if", "(", "hashbin", "-", ">", "hb_type", "&", "HB_LOCK", ")", "{", "spin_lock_irqsave_nested", "(", "&", "hashbin", "-", ">", "hb_spinlock", ",", "flags", ",", "hashbin_lock_depth", "+", "+)", ";", "}", "if", "(", "hashbin", "-", ">", "hb_type", "&", "HB_LOCK", ")", "spin_lock_irqsave", "(", "&", "hashbin", "-", ">", "hb_spinlock", ",", "flags", ")", ";", "/", "*", "*", "Free", "the", "entries", "in", "the", "hashbin", ",", "TODO", ":", "use", "hashbin_clear", "when", "*", "it", "has", "been", "shown", "to", "work", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "HASHBIN_SIZE", ";", "i", "+", "+", ")", "{", "queue", "=", "dequeue_first", "(", "(", "irda_queue_t", "*", "*)", "&", "hashbin", "-", ">", "hb_queue", "[", "i", "]", ");", "while", "(", "queue", ")", "{", "if", "(", "free_func", ")", "(", "*", "free_func", ")", "(", "queue", ")", ";", "queue", "=", "dequeue_first", "(", "(", "irda_queue_t", "*", "*)", "&", "hashbin", "-", ">", "hb_queue", "[", "i", "]", ");", "while", "(", "1", ")", "{", "queue", "=", "dequeue_first", "(", "(", "irda_queue_t", "*", "*)", "&", "hashbin", "-", ">", "hb_queue", "[", "i", "]", ");", "if", "(", "!", "queue", ")", "break", ";", "if", "(", "free_func", ")", "{", "if", "(", "hashbin", "-", ">", "hb_type", "&", "HB_LOCK", ")", "spin_unlock_irqrestore", "(", "&", "hashbin", "-", ">", "hb_spinlock", ",", "flags", ")", ";", "free_func", "(", "queue", ")", ";", "if", "(", "hashbin", "-", ">", "hb_type", "&", "HB_LOCK", ")", "spin_lock_irqsave", "(", "&", "hashbin", "-", ">", "hb_spinlock", ",", "flags", ")", ";", "}", "}", "}", "@", "@", "-", "420", ",", "12", "+", "422", ",", "8", "@", "@", "int", "hashbin_delete", "(", "hashbin_t", "*", "hashbin", ",", "FREE_FUNC", "free_func", ")", "hashbin", "-", ">", "magic", "=", "~", "HB_MAGIC", ";", "/", "*", "Release", "lock", "*", "/", "if", "(", "hashbin", "-", ">", "hb_type", "&", "HB_LOCK", ")", "{", "if", "(", "hashbin", "-", ">", "hb_type", "&", "HB_LOCK", ")", "spin_unlock_irqrestore", "(", "&", "hashbin", "-", ">", "hb_spinlock", ",", "flags", ")", ";", "#", "ifdef", "CONFIG_LOCKDEP", "hashbin_lock_depth", "-", "-;", "#", "endif", "}", "/", "*", "*", "Free", "the", "hashbin", "structure"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(deadlock", ")"]}
{"contents": ["Document", "issue", "with", "default", "installation", "paths", "on", "diverse", "Windows", "targets", "For", "all", "config", "targets", "(except", "VMS,", "because", "it", "has", "a", "completely", "different", "set", "of", "scripts),", "'/usr/local/ssl'", "is", "the", "default", "prefix", "for", "installation", "of", "programs", "and", "libraries,", "as", "well", "as", "the", "path", "for", "OpenSSL", "run-time", "configuration.", "For", "programs", "built", "to", "run", "in", "a", "Windows", "environment,", "this", "default", "is", "unsafe,", "and", "the", "user", "should", "set", "a", "different", "prefix.", "This", "has", "been", "hinted", "at", "in", "some", "documentation", "but", "not", "all,", "and", "the", "danger", "of", "leaving", "the", "default", "as", "is", "hasn't", "been", "documented", "at", "all.", "This", "change", "documents", "the", "issue", "as", "a", "caveat", "lector,", "and", "all", "configuration", "examples", "now", "include", "an", "example", "--prefix.", "Reviewed-by:", "Matt", "Caswell", "<matt@openssl.org>", "(Merged", "from", "https://github.com/openssl/openssl/pull/9456)"], "code_tokens": ["@", "@", "-", "9", ",", "7", "+", "9", ",", "12", "@", "@", "Changes", "between", "1", ".", "0", ".", "2s", "and", "1", ".", "0", ".", "2t", "[", "xx", "XXX", "xxxx", "]", "*", ")", "*", ")", "Document", "issue", "with", "installation", "paths", "in", "diverse", "Windows", "builds", "'", "/", "usr", "/", "local", "/", "ssl", "'", "is", "an", "unsafe", "prefix", "for", "location", "to", "install", "OpenSSL", "binaries", "and", "run", "-", "time", "config", "file", ".", "(", "CVE", "-", "2019", "-", "1552", ")", "[", "Richard", "Levitte", "]", "Changes", "between", "1", ".", "0", ".", "2r", "and", "1", ".", "0", ".", "2s", "[", "28", "May", "2019", "]", "@", "@", "-", "33", ",", "8", "+", "33", ",", "18", "@", "@", "running", "in", "a", "DOS", "box", "under", "Windows", ".", "If", "so", ",", "just", "close", "the", "BASH", "shell", ",", "go", "back", "to", "Windows", ",", "and", "restart", "BASH", ".", "Then", "run", "\"", "make", "\"", "again", ".", "RUN", "-", "TIME", "CAVEAT", "LECTOR", "CAVEAT", "LECTOR", "-", "--", "--", "--", "--", "--", "--", "#", "##", "Default", "install", "and", "config", "paths", ".", "/", "Configure", "defaults", "to", "'", "/", "usr", "/", "local", "/", "ssl", "'", "as", "installation", "top", ".", "This", "is", "suitable", "for", "Unix", ",", "but", "not", "for", "Windows", ",", "where", "this", "usually", "is", "a", "world", "writable", "directory", "and", "therefore", "accessible", "for", "change", "by", "untrusted", "users", ".", "It", "is", "therefore", "recommended", "to", "set", "your", "own", "-", "-", "prefix", "or", "-", "-", "openssldir", "to", "some", "location", "that", "is", "not", "world", "writeable", "(", "see", "the", "example", "above", ")", "#", "##", "Entropy", "Quoting", "FAQ", ":", "@", "@", "-", "34", ",", "6", "+", "34", ",", "17", "@", "@", "get", "it", "all", "to", "work", ".", "See", "the", "trouble", "shooting", "section", "later", "on", "for", "if", "(", "when", "?", ")", "it", "goes", "wrong", ".", "CAVEAT", "LECTOR", "-", "--", "--", "--", "--", "--", "--", "#", "##", "Default", "install", "and", "config", "paths", ".", "/", "Configure", "defaults", "to", "'", "/", "usr", "/", "local", "/", "ssl", "'", "as", "installation", "top", ".", "This", "is", "suitable", "for", "Unix", ",", "but", "not", "for", "Windows", ",", "where", "this", "usually", "is", "a", "world", "writable", "directory", "and", "therefore", "accessible", "for", "change", "by", "untrusted", "users", ".", "It", "is", "therefore", "recommended", "to", "set", "your", "own", "-", "-", "prefix", "or", "-", "-", "openssldir", "to", "some", "location", "that", "is", "not", "world", "writeable", "(", "see", "the", "example", "above", ")", "Visual", "C", "+", "+", "@", "@", "-", "104", ",", "7", "+", "115", ",", "7", "@", "@", "*", "Configure", "for", "building", "with", "Borland", "Builder", ":", ">", "perl", "Configure", "BC", "-", "32", ">", "perl", "Configure", "BC", "-", "32", "-", "-", "prefix", "=", "c", ":", "\\", "some", "\\", "openssl", "\\", "dir", "*", "Create", "the", "appropriate", "makefile", ">", "ms", "\\", "do_nasm", "@", "@", "-", "196", ",", "7", "+", "207", ",", "7", "@", "@", "*", "Compile", "OpenSSL", ":", "$", ".", "/", "config", "$", ".", "/", "config", "-", "-", "prefix", "=", "c", ":", "/", "some", "/", "openssl", "/", "dir", "[", "..", ".]", "$", "make", "[", "..", ".]", "@", "@", "-", "206", ",", "7", "+", "217", ",", "11", "@", "@", "and", "openssl", ".", "exe", "application", "in", "apps", "directory", ".", "It", "is", "also", "possible", "to", "cross", "-", "compile", "it", "on", "Linux", "by", "configuring", "with", "'", "./", "Configure", "-", "-", "cross", "-", "compile", "-", "prefix", "=", "i386", "-", "mingw32", "-", "mingw", ".", "..", "'.", "like", "this", ":", "$", ".", "/", "Configure", "-", "-", "cross", "-", "compile", "-", "prefix", "=", "i386", "-", "mingw32", "-", "\\", "-", "-", "prefix", "=", "c", ":", "/", "some", "/", "openssl", "/", "dir", "mingw", ".", "..", "'", "make", "test", "'", "is", "naturally", "not", "applicable", "then", ".", "libcrypto", ".", "a", "and", "libssl", ".", "a", "are", "the", "static", "libraries", ".", "To", "use", "the", "DLLs", ",", "@", "@", "-", "240", ",", "6", "+", "255", ",", "9", "@", "@", "$", "copy", "/", "b", "out32dll", "\\", "libeay32", ".", "dll", "c", ":", "\\", "openssl", "\\", "bin", "$", "copy", "/", "b", "out32dll", "\\", "openssl", ".", "exe", "c", ":", "\\", "openssl", "\\", "bin", "(", "\"", "c", ":", "\\", "openssl", "\"", "should", "be", "whatever", "you", "specified", "to", "-", "-", "prefix", "when", "configuring", "the", "build", ")", "Of", "course", ",", "you", "can", "choose", "another", "device", "than", "c", ":", ".", "C", ":", "is", "used", "here", "because", "that", "'", "s", "usually", "the", "first", "(", "and", "often", "only", ")", "harddisk", "device", ".", "Note", ":", "in", "the", "modssl", "INSTALL", ".", "Win32", ",", "p", ":", "is", "used", "rather", "than", "c", ":", ".", "@", "@", "-", "30", ",", "6", "+", "30", ",", "14", "@", "@", "Neither", "of", "these", "is", "actually", "big", "deal", "and", "hardly", "encountered", "in", "real", "-", "life", "applications", ".", "#", "##", "Default", "install", "and", "config", "paths", ".", "/", "Configure", "defaults", "to", "'", "/", "usr", "/", "local", "/", "ssl", "'", "as", "installation", "top", ".", "This", "is", "suitable", "for", "Unix", ",", "but", "not", "for", "Windows", ",", "where", "this", "usually", "is", "a", "world", "writable", "directory", "and", "therefore", "accessible", "for", "change", "by", "untrusted", "users", ".", "It", "is", "therefore", "recommended", "to", "set", "your", "own", "-", "-", "prefix", "or", "-", "-", "openssldir", "to", "some", "location", "that", "is", "not", "world", "writeable", "(", "see", "the", "example", "above", ")", "Compiling", "procedure", "@", "@", "-", "43", ",", "15", "+", "51", ",", "15", "@", "@", "To", "build", "for", "Win64", "/", "x64", ":", ">", "perl", "Configure", "VC", "-", "WIN64A", ">", "perl", "Configure", "VC", "-", "WIN64A", "-", "-", "prefix", "=", "c", ":", "\\", "some", "\\", "openssl", "\\", "dir", ">", "ms", "\\", "do_win64a", ">", "nmake", "-", "f", "ms", "\\", "ntdll", ".", "mak", ">", "cd", "out32dll", ">", ".", ".\\", "ms", "\\", "test", "To", "build", "for", "Win64", "/", "IA64", ":", ">", "perl", "Configure", "VC", "-", "WIN64I", ">", "perl", "Configure", "VC", "-", "WIN64I", "-", "-", "prefix", "=", "c", ":", "\\", "some", "\\", "openssl", "\\", "dir", ">", "ms", "\\", "do_win64i", ">", "nmake", "-", "f", "ms", "\\", "ntdll", ".", "mak", ">", "cd", "out32dll", "@", "@", "-", "35", ",", "6", "+", "35", ",", "17", "@", "@", "redirects", "IO", "to", "active", "sync", "link", ",", "while", "PortSDK", "-", "to", "NT", "-", "like", "console", "driver", "on", "the", "handheld", "itself", ".", "CAVEAT", "LECTOR", "-", "--", "--", "--", "--", "--", "--", "#", "##", "Default", "install", "and", "config", "paths", ".", "/", "Configure", "defaults", "to", "'", "/", "usr", "/", "local", "/", "ssl", "'", "as", "installation", "top", ".", "This", "is", "suitable", "for", "Unix", ",", "but", "not", "for", "Windows", ",", "where", "this", "usually", "is", "a", "world", "writable", "directory", "and", "therefore", "accessible", "for", "change", "by", "untrusted", "users", ".", "It", "is", "therefore", "recommended", "to", "set", "your", "own", "-", "-", "prefix", "or", "-", "-", "openssldir", "to", "some", "location", "that", "is", "not", "world", "writeable", "(", "see", "the", "example", "above", ")", "Building", "@", "@", "-", "61", ",", "7", "+", "72", ",", "7", "@", "@", "Next", "you", "should", "run", "Configure", ":", ">", "perl", "Configure", "VC", "-", "CE", ">", "perl", "Configure", "VC", "-", "CE", "-", "-", "prefix", "=", "c", ":", "\\", "some", "\\", "openssl", "\\", "dir", "Next", "you", "need", "to", "build", "the", "Makefiles", ":"], "docstring_tokens": ["modify", "(or", "even", "replace", ")", "existing", "engine", "modules"]}
{"contents": ["fix", "bug", "#54374,", "bug", "#55500", "-", "filter", "file", "names", "better,", "no", "dangling", "[s"], "code_tokens": ["@", "@", "-", "556", ",", "7", "+", "556", ",", "7", "@", "@", "static", "char", "*", "php_ap_basename", "(", "const", "zend_encoding", "*", "encoding", ",", "char", "*", "path", "TSRMLS_DC", "{", "char", "*", "s", "=", "strrchr", "(", "path", ",", "'", "\\\\", "')", ";", "char", "*", "s2", "=", "strrchr", "(", "path", ",", "'", "/'", ");", "if", "(", "s", "&", "&", "s2", ")", "{", "if", "(", "s", ">", "s2", ")", "{", "+", "+", "s", ";", "@", "@", "-", "942", ",", "6", "+", "942", ",", "10", "@", "@", "SAPI_API", "SAPI_POST_HANDLER_FUNC", "(", "rfc1867_post_handler", ")", "/", "*", "{", "{{", "*", "/", "}", "tmp", "+", "+;", "}", "/", "*", "Brackets", "should", "always", "be", "closed", "*", "/", "if", "(", "c", "!", "=", "0", ")", "{", "skip_upload", "=", "1", ";", "}", "}", "total_bytes", "=", "cancel_upload", "=", "0", ";", "@", "@", "-", "977", ",", "7", "+", "981", ",", "7", "@", "@", "SAPI_API", "SAPI_POST_HANDLER_FUNC", "(", "rfc1867_post_handler", ")", "/", "*", "{", "{{", "*", "/", "offset", "=", "0", ";", "end", "=", "0", ";", "if", "(", "!", "cancel_upload", ")", "{", "/", "*", "only", "bother", "to", "open", "temp", "file", "if", "we", "have", "data", "*", "/", "blen", "=", "multipart_buffer_read", "(", "mbuff", ",", "buff", ",", "sizeof", "(", "buff", ")", ",", "&", "end", "TSRMLS_CC", ")", ";", "@", "@", "-", "1275", ",", "7", "+", "1279", ",", "7", "@", "@", "SAPI_API", "void", "php_rfc1867_set_multibyte_callbacks", "(", "php_rfc1867_getword", "=", "getword", ";", "php_rfc1867_getword_conf", "=", "getword_conf", ";", "php_rfc1867_basename", "=", "basename", ";", "}", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "@", "@", "-", "0", ",", "0", "+", "1", ",", "67", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "55500", "(", "Corrupted", "$", "_FILES", "indices", "lead", "to", "security", "concern", ")", "-", "-", "INI", "-", "-", "file_uploads", "=", "1", "error_reporting", "=", "E_ALL", "&", "~", "E_NOTICE", "upload_max_filesize", "=", "1024", "-", "-", "POST_RAW", "-", "-", "Content", "-", "Type", ":", "multipart", "/", "form", "-", "data", ";", "boundary", "=", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "20896060251896012921717172737", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "]\"", ";", "filename", "=", "\"", "file1", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file1", "1", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "[", "type", "]", "\";", "filename", "=", "\"", "file2", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file2", "2", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "[", "name", "]", "\";", "filename", "=", "\"", "file3", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file3", "3", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "name", "]", "[\"", ";", "filename", "=", "\"", "file4", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file3", "4", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "-", "-", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "$", "_FILES", ")", ";", "var_dump", "(", "$", "_POST", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "array", "(", "1", ")", "{", "[", "%", "u", "|", "b", "%", "\"", "file", "\"", "]=", ">", "array", "(", "5", ")", "{", "[", "%", "u", "|", "b", "%", "\"", "name", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "%", "unicode", "|", "string", "%", "(", "9", ")", "\"", "file1", ".", "txt", "\"", "}", "[", "%", "u", "|", "b", "%", "\"", "type", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "%", "unicode", "|", "string", "%", "(", "16", ")", "\"", "text", "/", "plain", "-", "file1", "\"", "}", "[", "%", "u", "|", "b", "%", "\"", "tmp_name", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "%", "unicode", "|", "string", "%", "(%", "d", ")", "\"", "%", "s", "\"", "}", "[", "%", "u", "|", "b", "%", "\"", "error", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "int", "(", "0", ")", "}", "[", "%", "u", "|", "b", "%", "\"", "size", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "}", "}", "}", "array", "(", "0", ")", "{", "}"], "docstring_tokens": ["view", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["[SPARC64]:", "Kill", "compat_sys_clock_settime", "sign", "extension", "stub.", "It's", "wrong", "and", "totally", "unneeded.", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "84", ",", "7", "+", "84", ",", "6", "@", "@", "SIGN2", "(", "sys32_fadvise64_64", ",", "compat_sys_fadvise64_64", ",", "%", "o0", ",", "%", "o5", ")", "SIGN2", "(", "sys32_bdflush", ",", "sys_bdflush", ",", "%", "o0", ",", "%", "o1", ")", "SIGN1", "(", "sys32_mlockall", ",", "sys_mlockall", ",", "%", "o0", ")", "SIGN1", "(", "sys32_nfsservctl", ",", "compat_sys_nfsservctl", ",", "%", "o0", ")", "SIGN1", "(", "sys32_clock_settime", ",", "compat_sys_clock_settime", ",", "%", "o1", ")", "SIGN1", "(", "sys32_clock_nanosleep", ",", "compat_sys_clock_nanosleep", ",", "%", "o1", ")", "SIGN1", "(", "sys32_timer_settime", ",", "compat_sys_timer_settime", ",", "%", "o1", ")", "SIGN1", "(", "sys32_io_submit", ",", "compat_sys_io_submit", ",", "%", "o1", ")", "@", "@", "-", "71", ",", "7", "+", "71", ",", "7", "@", "@", "sys_call_table32", ":", "/", "*", "240", "*", "/", ".", "word", "sys_munlockall", ",", "sys32_sched_setparam", ",", "sys32_sched_getparam", ",", "sys32_sched_setscheduler", ",", "sys32_sched_getscheduler", ".", "word", "sys_sched_yield", ",", "sys32_sched_get_priority_max", ",", "sys32_sched_get_priority_min", ",", "sys32_sched_rr_get_interval", ",", "compat_sys_nanosleep", "/", "*", "250", "*", "/", ".", "word", "sys32_mremap", ",", "sys32_sysctl", ",", "sys32_getsid", ",", "sys_fdatasync", ",", "sys32_nfsservctl", ".", "word", "sys_ni_syscall", ",", "sys32_clock_settime", ",", "compat_sys_clock_gettime", ",", "compat_sys_clock_getres", ",", "sys32_clock_nanosleep", ".", "word", "sys_ni_syscall", ",", "compat_sys_clock_settime", ",", "compat_sys_clock_gettime", ",", "compat_sys_clock_getres", ",", "sys32_clock_nanosleep", "/", "*", "260", "*", "/", ".", "word", "compat_sys_sched_getaffinity", ",", "compat_sys_sched_setaffinity", ",", "sys32_timer_settime", ",", "compat_sys_timer_gettime", ",", "sys_timer_getoverrun", ".", "word", "sys_timer_delete", ",", "compat_sys_timer_create", ",", "sys_ni_syscall", ",", "compat_sys_io_setup", ",", "sys_io_destroy", "/", "*", "270", "*", "/", ".", "word", "sys32_io_submit", ",", "sys_io_cancel", ",", "compat_sys_io_getevents", ",", "sys32_mq_open", ",", "sys_mq_unlink"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(hang", ")"]}
{"contents": ["[SECURITY-663]", "Prevent", "unchecked", "casting", "of", "String", "to", "File"], "code_tokens": ["@", "@", "-", "48", ",", "7", "+", "48", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "kohsuke", "<", "/", "groupId", ">", "<", "artifactId", ">", "groovy", "-", "sandbox", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "15", "<", "/", "version", ">", "<", "version", ">", "1", ".", "16", "<", "/", "version", ">", "<", "exclusions", ">", "<", "exclusion", ">", "<", "groupId", ">", "org", ".", "codehaus", ".", "groovy", "<", "/", "groupId", ">", "@", "@", "-", "969", ",", "4", "+", "969", ",", "12", "@", "@", "public", "void", "varArgsWithOtherArgs", "(", ")", "throws", "Exception", "{", "String", "expected", "=", "\"", "4", "-", "true", "-", "a", "-", "b", "-", "c", "\"", ";", "assertEvaluate", "(", "wl", ",", "expected", ",", "script", ")", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "663", "\"", ")", "@", "Test", "public", "void", "castAsFile", "(", ")", "throws", "Exception", "{", "assertRejected", "(", "new", "GenericWhitelist", "(", "),", "\"", "new", "java", ".", "io", ".", "File", "java", ".", "lang", ".", "String", "\"", ",", "\"", "def", "s", "=", "[", "];", "(", "'/", "tmp", "/", "foo", "'", "as", "File", ")", ".", "each", "{", "s", "<", "<", "it", "}", "\\", "n", "\"", ");", "}", "}"], "docstring_tokens": ["reading", "arbitrary", "files", "on", "the", "Jenkins", "master", "file", "system"]}
{"contents": ["[SECURITY-1046]"], "code_tokens": ["@", "@", "-", "25", ",", "6", "+", "25", ",", "7", "@", "@", "import", "edu", ".", "umd", ".", "cs", ".", "findbugs", ".", "annotations", ".", "NonNull", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "util", ".", "ListBoxModel", ";", "import", "java", ".", "util", ".", "EnumSet", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "286", ",", "7", "+", "287", ",", "7", "@", "@", "public", "TrustContributors", "(", ")", "{", "@", "Override", "protected", "boolean", "checkTrusted", "(", "@", "NonNull", "GiteaSCMSourceRequest", "request", ",", "@", "NonNull", "PullRequestSCMHead", "head", ")", "{", "return", "!", "head", ".", "getOrigin", "(", ").", "equals", "(", "SCMHeadOrigin", ".", "DEFAULT", ")", "&", "&", "request", ".", "getCollaboratorNames", "(", ").", "contains", "(", "head", ".", "getOriginOwner", "(", "))", ";", "&", "&", "Util", ".", "fixNull", "(", "request", ".", "getCollaboratorNames", "(", "))", ".", "contains", "(", "head", ".", "getOriginOwner", "(", "))", ";", "}", "/", "**", "@", "@", "-", "462", ",", "6", "+", "462", ",", "35", "@", "@", "protected", "SCMRevision", "retrieve", "(", "@", "NonNull", "String", "thingName", ",", "@", "NonNull", "TaskListener", "return", "result", ";", "}", "@", "NonNull", "@", "Override", "public", "SCMRevision", "getTrustedRevision", "(", "@", "NonNull", "SCMRevision", "revision", ",", "@", "NonNull", "TaskListener", "listener", ")", "throws", "IOException", ",", "InterruptedException", "{", "if", "(", "revision", "instanceof", "PullRequestSCMRevision", ")", "{", "PullRequestSCMHead", "head", "=", "(", "PullRequestSCMHead", ")", "revision", ".", "getHead", "(", ");", "try", "(", "GiteaConnection", "c", "=", "gitea", "(", ").", "open", "(", "))", "{", "try", "(", "GiteaSCMSourceRequest", "request", "=", "new", "GiteaSCMSourceContext", "(", "null", ",", "SCMHeadObserver", ".", "none", "(", "))", ".", "withTraits", "(", "getTraits", "(", "))", ".", "newRequest", "(", "this", ",", "listener", ")", ")", "{", "request", ".", "setConnection", "(", "c", ")", ";", "Set", "<", "String", ">", "names", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "GiteaUser", "u", ":", "c", ".", "fetchCollaborators", "(", "giteaRepository", ")", ")", "{", "names", ".", "add", "(", "u", ".", "getUsername", "(", "))", ";", "}", "request", ".", "setCollaboratorNames", "(", "names", ")", ";", "if", "(", "request", ".", "isTrusted", "(", "head", ")", ")", "{", "return", "revision", ";", "}", "}", "PullRequestSCMRevision", "rev", "=", "(", "PullRequestSCMRevision", ")", "revision", ";", "listener", ".", "getLogger", "(", ").", "format", "(", "\"", "Loading", "trusted", "files", "from", "base", "branch", "%", "s", "at", "%", "s", "rather", "than", "%", "s", "%", "n", "\"", ",", "head", ".", "getTarget", "(", ").", "getName", "(", "),", "(", "(", "SCMRevisionImpl", ")", "rev", ".", "getTarget", "(", "))", ".", "getHash", "(", "),", "rev", ".", "getOrigin", "(", ").", "getHash", "(", "))", ";", "return", "rev", ".", "getTarget", "(", ");", "}", "}", "return", "revision", ";", "}", "@", "NonNull", "@", "Override", "public", "SCM", "build", "(", "@", "NonNull", "SCMHead", "head", ",", "SCMRevision", "revision", ")", "{"], "docstring_tokens": ["credentials", "could", "be", "viewed", "by", "users", "with", "access", "to", "the", "master", "file", "system"]}
{"contents": ["ext4:", "avoid", "divide", "by", "zero", "when", "trying", "to", "mount", "a", "corrupted", "file", "system", "If", "s_log_groups_per_flex", "is", "greater", "than", "31,", "then", "groups_per_flex", "will", "will", "overflow", "and", "cause", "a", "divide", "by", "zero", "error.", "This", "can", "cause", "kernel", "BUG", "if", "such", "a", "file", "system", "is", "mounted.", "Thanks", "to", "Nageswara", "R", "Sastry", "for", "analyzing", "the", "failure", "and", "providing", "an", "initial", "patch.", "http://bugzilla.kernel.org/show_bug.cgi?id=14287", "Signed-off-by:", "\"Theodore", "Ts'o\"", "<tytso@mit.edu>", "Cc:", "stable@kernel.org"], "code_tokens": ["@", "@", "-", "1673", ",", "14", "+", "1673", ",", "14", "@", "@", "static", "int", "ext4_fill_flex_info", "(", "struct", "super_block", "*", "sb", ")", "size_t", "size", ";", "int", "i", ";", "if", "(", "!", "sbi", "-", ">", "s_es", "-", ">", "s_log_groups_per_flex", ")", "{", "sbi", "-", ">", "s_log_groups_per_flex", "=", "sbi", "-", ">", "s_es", "-", ">", "s_log_groups_per_flex", ";", "groups_per_flex", "=", "1", "<", "<", "sbi", "-", ">", "s_log_groups_per_flex", ";", "if", "(", "groups_per_flex", "<", "2", ")", "{", "sbi", "-", ">", "s_log_groups_per_flex", "=", "0", ";", "return", "1", ";", "}", "sbi", "-", ">", "s_log_groups_per_flex", "=", "sbi", "-", ">", "s_es", "-", ">", "s_log_groups_per_flex", ";", "groups_per_flex", "=", "1", "<", "<", "sbi", "-", ">", "s_log_groups_per_flex", ";", "/", "*", "We", "allocate", "both", "existing", "and", "potentially", "added", "groups", "*", "/", "flex_group_count", "=", "(", "(", "sbi", "-", ">", "s_groups_count", "+", "groups_per_flex", "-", "1", ")", "+", "(", "(", "le16_to_cpu", "(", "sbi", "-", ">", "s_es", "-", ">", "s_reserved_gdt_blocks", ")", "+", "1", ")", "<", "<"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(divide-by-zero", "error", "and", "panic", ")"]}
{"contents": ["net/llc:", "avoid", "BUG_ON()", "in", "skb_orphan()", "It", "seems", "nobody", "used", "LLC", "since", "linux-3.12.", "Fortunately", "fuzzers", "like", "syzkaller", "still", "know", "how", "to", "run", "this", "code,", "otherwise", "it", "would", "be", "no", "fun.", "Setting", "skb->sk", "without", "skb->destructor", "leads", "to", "all", "kinds", "of", "bugs,", "we", "now", "prefer", "to", "be", "very", "strict", "about", "it.", "Ideally", "here", "we", "would", "use", "skb_set_owner()", "but", "this", "helper", "does", "not", "exist", "yet,", "only", "CAN", "seems", "to", "have", "a", "private", "helper", "for", "that.", "Fixes:", "376c7311bdb6", "(\"net:", "add", "a", "temporary", "sanity", "check", "in", "skb_orphan()\")", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "821", ",", "7", "+", "821", ",", "10", "@", "@", "void", "llc_conn_handler", "(", "struct", "llc_sap", "*", "sap", ",", "struct", "sk_buff", "*", "skb", ")", "*", "another", "trick", "required", "to", "cope", "with", "how", "the", "PROCOM", "state", "*", "machine", "works", ".", "-", "acme", "*", "/", "skb_orphan", "(", "skb", ")", ";", "sock_hold", "(", "sk", ")", ";", "skb", "-", ">", "sk", "=", "sk", ";", "skb", "-", ">", "destructor", "=", "sock_efree", ";", "}", "if", "(", "!", "sock_owned_by_user", "(", "sk", ")", ")", "llc_conn_rcv", "(", "sk", ",", "skb", ")", ";", "@", "@", "-", "290", ",", "7", "+", "290", ",", "10", "@", "@", "static", "void", "llc_sap_rcv", "(", "struct", "llc_sap", "*", "sap", ",", "struct", "sk_buff", "*", "skb", ",", "ev", "-", ">", "type", "=", "LLC_SAP_EV_TYPE_PDU", ";", "ev", "-", ">", "reason", "=", "0", ";", "skb_orphan", "(", "skb", ")", ";", "sock_hold", "(", "sk", ")", ";", "skb", "-", ">", "sk", "=", "sk", ";", "skb", "-", ">", "destructor", "=", "sock_efree", ";", "llc_sap_state_process", "(", "sap", ",", "skb", ")", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(BUG_ON", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["Fix", "using", "special", "characters", "in", "format"], "code_tokens": ["@", "@", "-", "1", ",", "6", "+", "1", ",", "7", "@", "@", "unreleased", "=", "==", "==", "==", "==", "=", "*", "Fix", "using", "special", "characters", "in", "format", "*", "deps", ":", "depd", "@", "~", "1", ".", "1", ".", "2", "-", "perf", ":", "remove", "argument", "reassignment", "@", "@", "-", "375", ",", "8", "+", "375", ",", "8", "@", "@", "function", "compile", "(", "format", ")", "{", "throw", "new", "TypeError", "(", "'", "argument", "format", "must", "be", "a", "string", "'", ")", "}", "var", "fmt", "=", "format", ".", "replace", "(", "/\"", "/", "g", ",", "'", "\\\\", "\"'", ")", "var", "js", "=", "'", "\"", "use", "strict", "\"", "\\", "n", "return", "\"", "'", "+", "fmt", ".", "replace", "(", "/:", "([", "-\\", "w", "]", "{", "2", ",", "})", "(?", ":\\", "[(", "[^", "\\]", "]+", ")\\", "])", "?/", "g", ",", "function", "(", "_", ",", "name", ",", "arg", ")", "{", "var", "fmt", "=", "String", "(", "JSON", ".", "stringify", "(", "format", ")", ")", "var", "js", "=", "'", "\"", "use", "strict", "\"", "\\", "n", "return", "'", "+", "fmt", ".", "replace", "(", "/:", "([", "-\\", "w", "]", "{", "2", ",", "})", "(?", ":\\", "[(", "[^", "\\]", "]+", ")\\", "])", "?/", "g", ",", "function", "(", "_", ",", "name", ",", "arg", ")", "{", "var", "tokenArguments", "=", "'", "req", ",", "res", "'", "var", "tokenFunction", "=", "'", "tokens", "[", "'", "+", "String", "(", "JSON", ".", "stringify", "(", "name", ")", ")", "+", "'", "]'", "@", "@", "-", "385", ",", "7", "+", "385", ",", "7", "@", "@", "function", "compile", "(", "format", ")", "{", "}", "return", "'", "\"", "+", "\\", "n", "(", "'", "+", "tokenFunction", "+", "'", "('", "+", "tokenArguments", "+", "'", ")", "|", "|", "\"", "-\"", ")", "+", "\"", "'", "}", ")", "+", "'", "\"'", "}", ")", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "no", "-", "new", "-", "func", "return", "new", "Function", "(", "'", "tokens", ",", "req", ",", "res", "'", ",", "js", ")", "@", "@", "-", "925", ",", "6", "+", "925", ",", "57", "@", "@", "describe", "(", "'", "morgan", "(", ")'", ",", "function", "(", ")", "{", "}", ")", "}", ")", "describe", "(", "'", "a", "string", "'", ",", "function", "(", ")", "{", "it", "(", "'", "should", "accept", "format", "as", "format", "string", "of", "tokens", "'", ",", "function", "(", "done", ")", "{", "var", "cb", "=", "after", "(", "2", ",", "function", "(", "err", ",", "res", ",", "line", ")", "{", "if", "(", "err", ")", "return", "done", "(", "err", ")", "assert", ".", "strictEqual", "(", "line", ",", "'", "GET", "/", "')", "done", "(", ")", "}", ")", "var", "stream", "=", "createLineStream", "(", "function", "(", "line", ")", "{", "cb", "(", "null", ",", "null", ",", "line", ")", "}", ")", "request", "(", "createServer", "(", "':", "method", ":", "url", "'", ",", "{", "stream", ":", "stream", "}", "))", ".", "get", "(", "'/", "')", ".", "expect", "(", "200", ",", "cb", ")", "}", ")", "it", "(", "'", "should", "accept", "text", "mixed", "with", "tokens", "'", ",", "function", "(", "done", ")", "{", "var", "cb", "=", "after", "(", "2", ",", "function", "(", "err", ",", "res", ",", "line", ")", "{", "if", "(", "err", ")", "return", "done", "(", "err", ")", "assert", ".", "strictEqual", "(", "line", ",", "'", "method", "=", "GET", "url", "=", "/'", ")", "done", "(", ")", "}", ")", "var", "stream", "=", "createLineStream", "(", "function", "(", "line", ")", "{", "cb", "(", "null", ",", "null", ",", "line", ")", "}", ")", "request", "(", "createServer", "(", "'", "method", "=", ":", "method", "url", "=", ":", "url", "'", ",", "{", "stream", ":", "stream", "}", "))", ".", "get", "(", "'/", "')", ".", "expect", "(", "200", ",", "cb", ")", "}", ")", "it", "(", "'", "should", "accept", "special", "characters", "'", ",", "function", "(", "done", ")", "{", "var", "cb", "=", "after", "(", "2", ",", "function", "(", "err", ",", "res", ",", "line", ")", "{", "if", "(", "err", ")", "return", "done", "(", "err", ")", "assert", ".", "strictEqual", "(", "line", ",", "'", "LOCAL", "\\", "\\", "tobi", "\"", "GET", "/", "\"", "200", "'", ")", "done", "(", ")", "}", ")", "var", "stream", "=", "createLineStream", "(", "function", "(", "line", ")", "{", "cb", "(", "null", ",", "null", ",", "line", ")", "}", ")", "request", "(", "createServer", "(", "'", "LOCAL", "\\", "\\:", "remote", "-", "user", "\"", ":", "method", ":", "url", "\"", ":", "status", "'", ",", "{", "stream", ":", "stream", "}", "))", ".", "get", "(", "'/", "')", ".", "set", "(", "'", "Authorization", "'", ",", "'", "Basic", "dG9iaTpsb2tp", "'", ")", ".", "expect", "(", "200", ",", "cb", ")", "}", ")", "}", ")", "describe", "(", "'", "combined", "'", ",", "function", "(", ")", "{", "it", "(", "'", "should", "match", "expectations", "'", ",", "function", "(", "done", ")", "{", "var", "cb", "=", "after", "(", "2", ",", "function", "(", "err", ",", "res", ",", "line", ")", "{"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["[SECURITY-402,SECURITY-403]", "Squashed", "commit", "of", "the", "following:", "commit", "0ad3bf0c4a82a47ee183bec085cf1e6537619d1a", "Merge:", "51c33ef", "0c80b27", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Tue", "Feb", "20", "16:38:01", "2018", "+0100", "Merge", "remote-tracking", "branch", "'origin'", "into", "SECURITY-403", "commit", "51c33ef34d46f5fc859d1273eb309a447b821bc7", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Fri", "Feb", "16", "17:50:24", "2018", "+0100", "[SECURITY-403]", "Fixing", "test", "after", "csrf", "commit", "f8c49b7ba45344559e16815f6d5a8ed69856c1f8", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Thu", "Feb", "15", "13:38:00", "2018", "+0100", "[SECURITY-403]", "Also", "try", "to", "prevent", "CSRF", "commit", "aaccb2517cf32accfbc67c1228e19c5cd5cad0dc", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Wed", "Feb", "14", "18:32:23", "2018", "+0100", "[SECURITY-403]", "Fixing", "the", "test", "commit", "8663e69ed5db3d6fb5f0d9e550b47de011570434", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Thu", "Feb", "1", "13:36:32", "2018", "+0100", "[SECURITY-402,SECURITY-403]", "More", "Admin", "checks", "One", "test", "failing", "that", "I", "haven't", "figured", "out", "why", "yet"], "code_tokens": ["@", "@", "-", "41", ",", "6", "+", "41", ",", "7", "@", "@", "import", "hudson", ".", "model", ".", "Hudson", ";", "import", "hudson", ".", "model", ".", "ManagementLink", ";", "import", "hudson", ".", "model", ".", "Saveable", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "jenkins", ".", "model", ".", "ModelObjectWithContextMenu", ";", "@", "@", "-", "52", ",", "6", "+", "53", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "bind", ".", "JavaScriptMethod", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "112", ",", "6", "+", "114", ",", "7", "@", "@", "public", "DescriptorImpl", "getDescriptor", "(", ")", "{", "@", "Override", "public", "ContextMenu", "doContextMenu", "(", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "Exception", "{", "checkPermission", "(", ");", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "assert", "jenkins", "!", "=", "null", ";", "ContextMenu", "menu", "=", "new", "ContextMenu", "(", ");", "@", "@", "-", "189", ",", "6", "+", "192", ",", "7", "@", "@", "public", "AutoCompletionCandidates", "doAutoCompleteCopyNewItemFrom", "(", "@", "QueryParameter", "fi", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "from", "Jelly", "public", "List", "<", "GerritServer", ">", "getServers", "(", ")", "{", "checkPermission", "(", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "if", "(", "plugin", "=", "=", "null", ")", "{", "return", "Collections", ".", "emptyList", "(", ");", "@", "@", "-", "204", ",", "6", "+", "208", ",", "7", "@", "@", "public", "AutoCompletionCandidates", "doAutoCompleteCopyNewItemFrom", "(", "@", "QueryParameter", "fi", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "from", "Jelly", "public", "GerritServer", "getServer", "(", "String", "encodedServerName", ")", "{", "checkPermission", "(", ");", "String", "serverName", ";", "try", "{", "serverName", "=", "URLDecoder", ".", "decode", "(", "encodedServerName", ",", "CharEncoding", ".", "UTF_8", ")", ";", "@", "@", "-", "259", ",", "7", "+", "264", ",", "9", "@", "@", "public", "JSONObject", "getServerStatuses", "(", ")", "{", "*", "@", "return", "the", "new", "GerritServer", "*", "@", "throws", "IOException", "when", "error", "sending", "redirect", "back", "to", "the", "list", "of", "servers", "*", "/", "@", "RequirePOST", "public", "GerritServer", "doAddNewServer", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", "{", "checkPermission", "(", ");", "String", "serverName", "=", "req", ".", "getParameter", "(", "\"", "name", "\"", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "assert", "plugin", "!", "=", "null", ";", "@", "@", "-", "384", ",", "6", "+", "391", ",", "7", "@", "@", "public", "GerritAdministrativeMonitor", "getAdministrativeMonitor", "(", ")", "{", "*", "@", "return", "ok", "or", "error", ".", "*", "/", "public", "FormValidation", "doNameFreeCheck", "(", "@", "QueryParameter", "(", "\"", "value", "\"", ")", "final", "String", "value", ")", "{", "checkPermission", "(", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "assert", "plugin", "!", "=", "null", ";", "if", "(", "plugin", ".", "containsServer", "(", "value", ")", ")", "{", "@", "@", "-", "404", ",", "9", "+", "412", ",", "11", "@", "@", "public", "FormValidation", "doNameFreeCheck", "(", "@", "QueryParameter", "(", "\"", "value", "\"", ")", "final", "String", "valu", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "RequirePOST", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "submit", "{", "}\"", ",", "req", ".", "toString", "(", "))", ";", "}", "@", "@", "-", "422", ",", "4", "+", "432", ",", "26", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "Servl", "rsp", ".", "sendRedirect", "(", "\".", "\")", ";", "}", "/", "**", "*", "Checks", "that", "the", "current", "user", "has", "{", "@", "link", "#", "getRequiredPermission", "(", ")}", "permission", ".", "*", "If", "Jenkins", "is", "currently", "active", ".", "*", "/", "private", "void", "checkPermission", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "if", "(", "jenkins", "!", "=", "null", ")", "{", "jenkins", ".", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "}", "}", "/", "**", "*", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "permission", ".", "*", "Also", "used", "by", "Jelly", "*", "*", "@", "return", "the", "permission", "*", "/", "@", "Override", "public", "Permission", "getRequiredPermission", "(", ")", "{", "return", "Jenkins", ".", "ADMINISTER", ";", "}", "}", "@", "@", "-", "39", ",", "6", "+", "39", ",", "7", "@", "@", "import", "hudson", ".", "model", ".", "Failure", ";", "import", "hudson", ".", "model", ".", "Descriptor", ";", "import", "hudson", ".", "model", ".", "Hudson", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "ListBoxModel", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "@", "@", "-", "88", ",", "6", "+", "89", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "bind", ".", "JavaScriptMethod", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Exported", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "ExportedBean", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "235", ",", "6", "+", "237", ",", "7", "@", "@", "public", "IGerritHudsonTriggerConfig", "getConfig", "(", ")", "{", "*", "@", "param", "config", "the", "config", ".", "*", "/", "public", "void", "setConfig", "(", "IGerritHudsonTriggerConfig", "config", ")", "{", "checkPermission", "(", ");", "this", ".", "config", "=", "config", ";", "}", "@", "@", "-", "394", ",", "11", "+", "397", ",", "33", "@", "@", "public", "boolean", "isLastServer", "(", ")", "{", "return", "PluginImpl", ".", "getServers_", "(", ").", "size", "(", ")", "=", "=", "1", ";", "}", "/", "**", "*", "Checks", "that", "the", "current", "user", "has", "{", "@", "link", "#", "getRequiredPermission", "(", ")}", "permission", ".", "*", "If", "Jenkins", "is", "currently", "active", ".", "*", "/", "private", "void", "checkPermission", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "if", "(", "jenkins", "!", "=", "null", ")", "{", "jenkins", ".", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "}", "}", "/", "**", "*", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "permission", "for", "viewing", "and", "changing", "the", "configuration", ".", "*", "Also", "used", "by", "Jelly", "*", "*", "@", "return", "the", "permission", "*", "/", "public", "final", "Permission", "getRequiredPermission", "(", ")", "{", "return", "Jenkins", ".", "ADMINISTER", ";", "}", "/", "**", "*", "Starts", "the", "server", "'", "s", "project", "list", "updater", ",", "send", "command", "queue", "and", "event", "manager", ".", "*", "*", "/", "public", "void", "start", "(", ")", "{", "checkPermission", "(", ");", "logger", ".", "info", "(", "\"", "Starting", "GerritServer", ":", "\"", "+", "name", ")", ";", "/", "/", "do", "not", "try", "to", "connect", "to", "gerrit", "unless", "there", "is", "a", "URL", "or", "a", "hostname", "in", "the", "text", "fields", "@", "@", "-", "445", ",", "6", "+", "470", ",", "7", "@", "@", "private", "void", "initializeConnectionListener", "(", ")", "{", "*", "*", "/", "public", "void", "stop", "(", ")", "{", "checkPermission", "(", ");", "logger", ".", "info", "(", "\"", "Stopping", "GerritServer", "\"", "+", "name", ")", ";", "if", "(", "projectListUpdater", "!", "=", "null", ")", "{", "@", "@", "-", "521", ",", "6", "+", "547", ",", "7", "@", "@", "public", "GerritConnectionListener", "getGerritConnectionListener", "(", ")", "{", "*", "*", "/", "public", "synchronized", "void", "startConnection", "(", ")", "{", "checkPermission", "(", ");", "if", "(", "!", "config", ".", "hasDefaultValues", "(", "))", "{", "if", "(", "gerritConnection", "=", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "Starting", "Gerrit", "connection", ".", "..", "\")", ";", "@", "@", "-", "545", ",", "6", "+", "572", ",", "7", "@", "@", "public", "synchronized", "void", "startConnection", "(", ")", "{", "*", "*", "/", "public", "synchronized", "void", "stopConnection", "(", ")", "{", "checkPermission", "(", ");", "if", "(", "gerritConnection", "!", "=", "null", ")", "{", "gerritConnection", ".", "shutdown", "(", "true", ")", ";", "gerritConnection", ".", "removeListener", "(", "gerritConnectionListener", ")", ";", "@", "@", "-", "868", ",", "9", "+", "896", ",", "11", "@", "@", "public", "ListBoxModel", "doFillNotificationLevelItems", "(", ")", "{", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "RequirePOST", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "submit", "{", "}\"", ",", "req", ".", "toString", "(", "))", ";", "}", "@", "@", "-", "908", ",", "6", "+", "938", ",", "7", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "Servl", "*", "@", "param", "newName", "the", "new", "name", "*", "/", "private", "void", "rename", "(", "String", "newName", ")", "{", "checkPermission", "(", ");", "if", "(", "isConnected", "(", "))", "{", "stopConnection", "(", ");", "stop", "(", ");", "@", "@", "-", "1002", ",", "7", "+", "1033", ",", "9", "@", "@", "private", "void", "removeGerritTriggerInJobs", "(", ")", "{", "*", "*", "@", "return", "connection", "status", ".", "*", "/", "@", "RequirePOST", "public", "JSONObject", "doWakeup", "(", ")", "{", "checkPermission", "(", ");", "Timer", "timer", "=", "new", "Timer", "(", ");", "try", "{", "startConnection", "(", ");", "@", "@", "-", "1047", ",", "7", "+", "1080", ",", "9", "@", "@", "public", "void", "run", "(", ")", "{", "*", "*", "@", "return", "connection", "status", ".", "*", "/", "@", "RequirePOST", "public", "JSONObject", "doSleep", "(", ")", "{", "checkPermission", "(", ");", "Timer", "timer", "=", "new", "Timer", "(", ");", "try", "{", "stopConnection", "(", ");", "@", "@", "-", "1207", ",", "10", "+", "1242", ",", "12", "@", "@", "private", "void", "setConnectionResponse", "(", "String", "response", ")", "{", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "RequirePOST", "public", "void", "doRemoveConfirm", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "stopConnection", "(", ");", "stop", "(", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "@", "@", "-", "1404", ",", "6", "+", "1441", ",", "7", "@", "@", "public", "FormValidation", "doValidTimeCheck", "(", "public", "FormValidation", "doNameFreeCheck", "(", "@", "QueryParameter", "(", "\"", "value", "\"", ")", "final", "String", "value", ")", "{", "checkPermission", "(", ");", "if", "(", "!", "value", ".", "equals", "(", "name", ")", ")", "{", "if", "(", "PluginImpl", ".", "containsServer_", "(", "value", ")", ")", "{", "return", "FormValidation", ".", "error", "(", "\"", "The", "server", "name", "\"", "+", "value", "+", "\"", "is", "already", "in", "use", "!", "\")", ";", "@", "@", "-", "282", ",", "6", "+", "282", ",", "7", "@", "@", "public", "static", "GerritServer", "getFirstServer_", "(", ")", "{", "*", "@", "param", "servers", "the", "list", "to", "be", "set", ".", "*", "/", "public", "void", "setServers", "(", "List", "<", "GerritServer", ">", "servers", ")", "{", "checkAdmin", "(", ");", "if", "(", "this", ".", "servers", "!", "=", "servers", ")", "{", "this", ".", "servers", ".", "clear", "(", ");", "this", ".", "servers", ".", "addAll", "(", "servers", ")", ";", "@", "@", "-", "295", ",", "6", "+", "296", ",", "7", "@", "@", "public", "void", "setServers", "(", "List", "<", "GerritServer", ">", "servers", ")", "{", "*", "@", "return", "the", "list", "after", "adding", "the", "server", ".", "*", "/", "public", "List", "<", "GerritServer", ">", "addServer", "(", "GerritServer", "s", ")", "{", "checkAdmin", "(", ");", "servers", ".", "add", "(", "s", ")", ";", "return", "servers", ";", "}", "@", "@", "-", "306", ",", "10", "+", "308", ",", "23", "@", "@", "public", "void", "setServers", "(", "List", "<", "GerritServer", ">", "servers", ")", "{", "*", "@", "return", "the", "list", "after", "removing", "the", "server", ".", "*", "/", "public", "List", "<", "GerritServer", ">", "removeServer", "(", "GerritServer", "s", ")", "{", "checkAdmin", "(", ");", "servers", ".", "remove", "(", "s", ")", ";", "return", "servers", ";", "}", "/", "**", "*", "Checks", "that", "the", "current", "user", "has", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "permission", ".", "*", "If", "Jenkins", "is", "currently", "active", ".", "*", "/", "private", "void", "checkAdmin", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "/", "/", "Hoping", "this", "method", "doesn", "'", "t", "change", "meaning", "again", "if", "(", "jenkins", "!", "=", "null", ")", "{", "/", "/", "If", "Jenkins", "is", "not", "alive", "then", "we", "are", "not", "started", ",", "so", "no", "unauthorised", "user", "might", "do", "anything", "jenkins", ".", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "}", "}", "/", "**", "*", "Check", "whether", "the", "list", "of", "servers", "contains", "a", "GerritServer", "object", "of", "a", "specific", "name", ".", "@", "@", "-", "1", ",", "7", "+", "1", ",", "7", "@", "@", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "d", "=", "\"", "jelly", ":", "define", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "t", "=", "\"/", "lib", "/", "hudson", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "i", "=", "\"", "jelly", ":", "fmt", "\"", ">", "<", "l", ":", "layout", "title", "=", "\"$", "{%", "Remove", "Server", "}", "\"", "norefresh", "=", "\"", "true", "\"", ">", "<", "l", ":", "layout", "title", "=", "\"$", "{%", "Remove", "Server", "}", "\"", "norefresh", "=", "\"", "true", "\"", "permission", "=", "\"$", "{", "it", ".", "requiredPermission", "}", "\">", "<", "l", ":", "side", "-", "panel", ">", "<", "l", ":", "tasks", ">", "<", "l", ":", "task", "icon", "=", "\"", "images", "/", "24x24", "/", "up", ".", "gif", "\"", "href", "=", "\"$", "{", "rootURL", "}", "/\"", "title", "=", "\"$", "{%", "Back", "to", "Dashboard", "}", "\"/", ">", "@", "@", "-", "22", ",", "6", "+", "22", ",", "8", "@", "@", "*", "THE", "SOFTWARE", ".", "*", "/", "/", "*", "global", "crumb", "*", "/", "function", "serverTable", "(", ")", "{", "'", "use", "strict", "'", ";", "/", "/", "private", "funcs", "@", "@", "-", "158", ",", "17", "+", "160", ",", "21", "@", "@", "function", "serverTable", "(", ")", "{", "dataTable", ".", "subscribe", "(", "\"", "buttonClickEvent", "\"", ",", "function", "(", "oArgs", ")", "{", "var", "elButton", "=", "oArgs", ".", "target", ";", "var", "oRecord", "=", "this", ".", "getRecord", "(", "elButton", ")", ";", "var", "crumbStr", "=", "\"", "\";", "if", "(", "crumb", ".", "fieldName", "!", "==", "null", ")", "{", "crumbStr", "=", "crumb", ".", "fieldName", "+", "\"", "=\"", "+", "crumb", ".", "value", ";", "}", "if", "(", "elButton", ".", "name", "=", "==", "\"", "server", "\"", ")", "{", "/", "/", "for", "BtnServer", "if", "(", "oRecord", ".", "getData", "(", "\"", "status", "\"", ")", "=", "==", "\"", "up", "\"", ")", "{", "YAHOO", ".", "log", "(", "\"", "Stop", "connection", ".", "\")", ";", "elButton", ".", "firstElementChild", ".", "src", "=", "urlSysImg", "(", "24", ",", "\"", "blue_anime", ".", "gif", "\"", ");", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "GET", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "sleep", "\"", ",", "connectionCallBack", ")", ";", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "POST", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "sleep", "\"", ",", "connectionCallBack", ",", "crumbStr", ")", ";", "}", "else", "if", "(", "oRecord", ".", "getData", "(", "\"", "status", "\"", ")", "=", "==", "\"", "down", "\"", ")", "{", "YAHOO", ".", "log", "(", "\"", "Start", "connection", ".", "\")", ";", "elButton", ".", "firstElementChild", ".", "src", "=", "urlSysImg", "(", "24", ",", "\"", "red_anime", ".", "gif", "\"", ");", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "GET", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "wakeup", "\"", ",", "connectionCallBack", ")", ";", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "POST", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "wakeup", "\"", ",", "connectionCallBack", ",", "crumbStr", ")", ";", "}", "}", "else", "if", "(", "elButton", ".", "name", "=", "==", "\"", "edit", "\"", ")", "{", "/", "/", "for", "btnEdit", "@", "@", "-", "2", ",", "6", "+", "2", ",", "7", "@", "@", "*", "The", "MIT", "License", "*", "*", "Copyright", "2015", "Ericsson", ".", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "@", "@", "-", "24", ",", "20", "+", "25", ",", "34", "@", "@", "package", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ";", "import", "static", "com", ".", "sonymobile", ".", "tools", ".", "gerrit", ".", "gerritevents", ".", "mock", ".", "SshdServerMock", ".", "GERRIT_STREAM_EVENTS", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertSame", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "util", ".", "UrlUtils", ";", "import", "hudson", ".", "model", ".", "FreeStyleBuild", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "Result", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "apache", ".", "sshd", ".", "SshServer", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ".", "config", ".", "Config", ";", "@", "@", "-", "47", ",", "6", "+", "62", ",", "7", "@", "@", "import", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ".", "mock", ".", "Setup", ";", "import", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ".", "mock", ".", "TestUtils", ";", "import", "com", ".", "sonymobile", ".", "tools", ".", "gerrit", ".", "gerritevents", ".", "mock", ".", "SshdServerMock", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "MockAuthorizationStrategy", ";", "/", "**", "*", "Unit", "test", "to", "ensure", "build", "can", "be", "triggered", "even", "if", "@", "@", "-", "145", ",", "4", "+", "161", ",", "110", "@", "@", "public", "void", "testTriggerWithLockedDownInstance", "(", ")", "throws", "Exception", "{", "buildOne", ".", "getCause", "(", "GerritCause", ".", "class", ")", ".", "getEvent", "(", ").", "getProvider", "(", ").", "getName", "(", "))", ";", "}", "/", "**", "*", "Just", "verify", "that", "{", "@", "link", "PluginImpl", "#", "getServer", "(", "String", ")", "}", "et", ".", "al", ".", "hasn", "'", "t", "been", "locked", "down", "too", "tightly", ".", "*", "*", "@", "throws", "Exception", "if", "so", "*", "/", "@", "Test", "@", "Issue", "(", "{\"", "SECURITY", "-", "402", "\"", ",", "\"", "SECURITY", "-", "403", "\"", "}", ")", "public", "void", "testUserCanConfigureAJob", "(", ")", "throws", "Exception", "{", "GerritServer", "gerritServer", "=", "new", "GerritServer", "(", "PluginImpl", ".", "DEFAULT_SERVER_NAME", ")", ";", "SshdServerMock", ".", "configureFor", "(", "sshd", ",", "gerritServer", ")", ";", "PluginImpl", ".", "getInstance", "(", ").", "addServer", "(", "gerritServer", ")", ";", "gerritServer", ".", "getConfig", "(", ").", "setNumberOfSendingWorkerThreads", "(", "NUMBEROFSENDERTHREADS", ")", ";", "(", "(", "Config", ")", "gerritServer", ".", "getConfig", "(", "))", ".", "setGerritAuthKeyFile", "(", "sshKey", ".", "getPrivateKey", "(", "))", ";", "gerritServer", ".", "start", "(", ");", "GerritServer", "otherServer", "=", "new", "GerritServer", "(", "\"", "theOtherServer", "\"", ");", "SshdServerMock", ".", "configureFor", "(", "sshd", ",", "otherServer", ")", ";", "PluginImpl", ".", "getInstance", "(", ").", "addServer", "(", "otherServer", ")", ";", "otherServer", ".", "getConfig", "(", ").", "setNumberOfSendingWorkerThreads", "(", "NUMBEROFSENDERTHREADS", ")", ";", "(", "(", "Config", ")", "otherServer", ".", "getConfig", "(", "))", ".", "setGerritAuthKeyFile", "(", "sshKey", ".", "getPrivateKey", "(", "))", ";", "otherServer", ".", "start", "(", ");", "FreeStyleProject", "project", "=", "new", "TestUtils", ".", "JobBuilder", "(", "j", ")", ".", "name", "(", "projectName", ")", ".", "silentStartMode", "(", "false", ")", ".", "serverName", "(", "\"", "theOtherServer", "\"", ").", "build", "(", ");", "Setup", ".", "lockDown", "(", "j", ")", ";", "j", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "new", "MockAuthorizationStrategy", "(", ").", "grant", "(", "Item", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toAuthenticated", "(", ")", ".", "grant", "(", "Jenkins", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toEveryone", "(", ")", ".", "grant", "(", "Item", ".", "CONFIGURE", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "bob", "\"", "))", ";", "final", "JenkinsRule", ".", "WebClient", "webClient", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", ");", "HtmlPage", "page", "=", "webClient", ".", "getPage", "(", "project", ",", "\"", "configure", "\"", ");", "j", ".", "submit", "(", "page", ".", "getFormByName", "(", "\"", "config", "\"", "))", ";", "final", "FreeStyleProject", "freshJob", "=", "j", ".", "jenkins", ".", "getItem", "(", "projectName", ",", "j", ".", "jenkins", ",", "FreeStyleProject", ".", "class", ")", ";", "final", "String", "serverName", "=", "GerritTrigger", ".", "getTrigger", "(", "freshJob", ")", ".", "getServerName", "(", ");", "assertEquals", "(", "\"", "theOtherServer", "\"", ",", "serverName", ")", ";", "}", "/", "/", "CS", "IGNORE", "MagicNumber", "FOR", "NEXT", "32", "LINES", ".", "REASON", ":", "test", "data", ".", "/", "**", "*", "Tests", "that", "only", "an", "admin", "can", "read", "server", "configuration", "and", "manipulate", "server", "state", ".", "*", "@", "throws", "Exception", "if", "so", "*", "/", "@", "Test", "@", "Issue", "(", "{\"", "SECURITY", "-", "402", "\"", ",", "\"", "SECURITY", "-", "403", "\"", "}", ")", "public", "void", "testOnlyAdminCanPerformServerConfigurationActions", "(", ")", "throws", "Exception", "{", "GerritServer", "gerritServer", "=", "new", "GerritServer", "(", "PluginImpl", ".", "DEFAULT_SERVER_NAME", ")", ";", "SshdServerMock", ".", "configureFor", "(", "sshd", ",", "gerritServer", ")", ";", "PluginImpl", ".", "getInstance", "(", ").", "addServer", "(", "gerritServer", ")", ";", "gerritServer", ".", "getConfig", "(", ").", "setNumberOfSendingWorkerThreads", "(", "NUMBEROFSENDERTHREADS", ")", ";", "(", "(", "Config", ")", "gerritServer", ".", "getConfig", "(", "))", ".", "setGerritAuthKeyFile", "(", "sshKey", ".", "getPrivateKey", "(", "))", ";", "gerritServer", ".", "start", "(", ");", "Setup", ".", "lockDown", "(", "j", ")", ";", "j", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "new", "MockAuthorizationStrategy", "(", ").", "grant", "(", "Item", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toAuthenticated", "(", ")", ".", "grant", "(", "Jenkins", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toEveryone", "(", ")", ".", "grant", "(", "Item", ".", "CONFIGURE", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "bob", "\"", ")", ".", "grant", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "alice", "\"", "))", ";", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "/", "/", "Not", "really", "testing", "csrf", "right", "now", "JenkinsRule", ".", "WebClient", "webClient", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "alice", "\"", ",", "\"", "alice", "\"", ");", "HtmlPage", "page", "=", "webClient", ".", "goTo", "(", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "\")", ";", "HtmlForm", "config", "=", "page", ".", "getFormByName", "(", "\"", "config", "\"", ");", "assertNotNull", "(", "config", ")", ";", "post", "(", "webClient", ",", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "sleep", "\"", ",", "\"", "application", "/", "json", "\"", ",", "null", ")", ";", "webClient", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", ");", "webClient", ".", "assertFails", "(", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "\",", "403", ")", ";", "post", "(", "webClient", ",", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "wakeup", "\"", ",", "null", ",", "403", ")", ";", "}", "/", "**", "*", "Performs", "an", "HTTP", "POST", "request", "to", "the", "relative", "url", ".", "*", "*", "@", "param", "webClient", "the", "client", "*", "@", "param", "relative", "the", "url", "relative", "to", "the", "context", "path", "*", "@", "param", "expectedContentType", "if", "expecting", "specific", "content", "type", "or", "null", "if", "not", "*", "@", "param", "expectedStatus", "if", "expecting", "a", "failing", "http", "status", "code", "or", "null", "if", "not", "*", "@", "throws", "IOException", "if", "so", "*", "/", "private", "static", "void", "post", "(", "JenkinsRule", ".", "WebClient", "webClient", ",", "String", "relative", ",", "String", "expectedContentType", ",", "Integer", "expectedStatus", ")", "throws", "IOException", "{", "WebRequest", "request", "=", "new", "WebRequest", "(", "UrlUtils", ".", "toUrlUnsafe", "(", "webClient", ".", "getContextPath", "(", ")", "+", "relative", ")", ",", "HttpMethod", ".", "POST", ")", ";", "try", "{", "Page", "p", "=", "webClient", ".", "getPage", "(", "request", ")", ";", "if", "(", "expectedContentType", "!", "=", "null", ")", "{", "assertThat", "(", "p", ".", "getWebResponse", "(", ").", "getContentType", "(", "),", "is", "(", "expectedContentType", ")", ");", "}", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "if", "(", "expectedStatus", "!", "=", "null", ")", "{", "assertEquals", "(", "expectedStatus", ".", "intValue", "(", "),", "e", ".", "getStatusCode", "(", "))", ";", "}", "else", "{", "throw", "e", ";", "}", "}", "}", "}"], "docstring_tokens": ["retrieve", "some", "configuration", "information"]}
{"contents": ["[PATCH]", "lost", "fput", "in", "32bit", "ioctl", "on", "x86-64", "This", "adds", "a", "lost", "fput", "in", "32bit", "tiocgdev", "ioctl", "on", "x86-64", "[", "chrisw:", "Updated", "to", "use", "fget_light/fput_light", "]", "Signed-Off-By:", "Kirill", "Korotaev", "<dev@sw.ru>", "Signed-Off-By:", "Maxim", "Giryaev", "<gem@sw.ru>", "Signed-off-by:", "Chris", "Wright", "<chrisw@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "24", ",", "17", "+", "24", ",", "26", "@", "@", "static", "int", "tiocgdev", "(", "unsigned", "fd", ",", "unsigned", "cmd", ",", "unsigned", "int", "__user", "*", "ptr", ")", "{", "struct", "file", "*", "file", "=", "fget", "(", "fd", ")", ";", "struct", "file", "*", "file", ";", "struct", "tty_struct", "*", "real_tty", ";", "int", "fput_needed", ",", "ret", ";", "file", "=", "fget_light", "(", "fd", ",", "&", "fput_needed", ")", ";", "if", "(", "!", "file", ")", "return", "-", "EBADF", ";", "ret", "=", "-", "EINVAL", ";", "if", "(", "file", "-", ">", "f_op", "-", ">", "ioctl", "!", "=", "tty_ioctl", ")", "return", "-", "EINVAL", ";", "goto", "out", ";", "real_tty", "=", "(", "struct", "tty_struct", "*", ")", "file", "-", ">", "private_data", ";", "if", "(", "!", "real_tty", ")", "return", "-", "EINVAL", ";", "return", "put_user", "(", "new_encode_dev", "(", "tty_devnum", "(", "real_tty", ")", "),", "ptr", ")", ";", "goto", "out", ";", "ret", "=", "put_user", "(", "new_encode_dev", "(", "tty_devnum", "(", "real_tty", ")", "),", "ptr", ")", ";", "out", ":", "fput_light", "(", "file", ",", "fput_needed", ")", ";", "return", "ret", ";", "}", "#", "define", "RTC_IRQP_READ32", "_IOR", "(", "'", "p", "'", ",", "0x0b", ",", "unsigned", "int", ")", "/", "*", "Read", "IRQ", "rate", "*", "/"], "docstring_tokens": ["release", "the", "resources", "incorrectly", "and", "cause", "the", "kernel", "to", "crash"]}
{"contents": ["Fix", "bug", "#71860:", "Require", "valid", "paths", "for", "phar", "filenames"], "code_tokens": ["@", "@", "-", "2196", ",", "6", "+", "2196", ",", "10", "@", "@", "int", "phar_split_fname", "(", "const", "char", "*", "filename", ",", "int", "filename_len", ",", "char", "*", "*", "arch", ",", "int", "*", "a", "#", "endif", "int", "ext_len", ";", "if", "(", "CHECK_NULL_PATH", "(", "filename", ",", "filename_len", ")", ")", "{", "return", "FAILURE", ";", "}", "if", "(", "!", "strncasecmp", "(", "filename", ",", "\"", "phar", ":", "//", "\",", "7", ")", ")", "{", "filename", "+", "=", "7", ";", "filename_len", "-", "=", "7", ";", "@", "@", "-", "459", ",", "7", "+", "459", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "mount", ")", "size_t", "path_len", ",", "actual_len", ";", "phar_archive_data", "*", "pphar", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ss", "\"", ",", "&", "path", ",", "&", "path_len", ",", "&", "actual", ",", "&", "actual_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "pp", "\"", ",", "&", "path", ",", "&", "path_len", ",", "&", "actual", ",", "&", "actual_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "938", ",", "7", "+", "938", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "createDefaultStub", ")", "zend_string", "*", "stub", ";", "size_t", "index_len", "=", "0", ",", "webindex_len", "=", "0", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "|", "ss", "\"", ",", "&", "index", ",", "&", "index_len", ",", "&", "webindex", ",", "&", "webindex_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "|", "pp", "\"", ",", "&", "index", ",", "&", "index_len", ",", "&", "webindex", ",", "&", "webindex_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "982", ",", "7", "+", "982", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "loadPhar", ")", "char", "*", "fname", ",", "*", "alias", "=", "NULL", ",", "*", "error", ";", "size_t", "fname_len", ",", "alias_len", "=", "0", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "s", "!", "\",", "&", "fname", ",", "&", "fname_len", ",", "&", "alias", ",", "&", "alias_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "s", "!", "\",", "&", "fname", ",", "&", "fname_len", ",", "&", "alias", ",", "&", "alias_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1062", ",", "7", "+", "1062", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "isValidPharFilename", ")", "int", "ext_len", ",", "is_executable", ";", "zend_bool", "executable", "=", "1", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "b", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "executable", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "b", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "executable", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1134", ",", "11", "+", "1134", ",", "11", "@", "@", "PHP_METHOD", "(", "Phar", ",", "__construct", ")", "is_data", "=", "instanceof_function", "(", "Z_OBJCE_P", "(", "zobj", ")", ",", "phar_ce_data", ")", ";", "if", "(", "is_data", ")", "{", "if", "(", "zend_parse_parameters_throw", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "ls", "!", "l", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "flags", ",", "&", "alias", ",", "&", "alias_len", ",", "&", "format", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters_throw", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "ls", "!", "l", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "flags", ",", "&", "alias", ",", "&", "alias_len", ",", "&", "format", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "}", "else", "{", "if", "(", "zend_parse_parameters_throw", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "ls", "!", "\",", "&", "fname", ",", "&", "fname_len", ",", "&", "flags", ",", "&", "alias", ",", "&", "alias_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters_throw", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "ls", "!", "\",", "&", "fname", ",", "&", "fname_len", ",", "&", "flags", ",", "&", "alias", ",", "&", "alias_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "}", "@", "@", "-", "1307", ",", "7", "+", "1307", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "unlinkArchive", ")", "int", "zname_len", ",", "arch_len", ",", "entry_len", ";", "phar_archive_data", "*", "phar", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "@", "@", "-", "1739", ",", "7", "+", "1739", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "buildFromDirectory", ")", "return", ";", "}", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "s", "\"", ",", "&", "dir", ",", "&", "dir_len", ",", "&", "regex", ",", "&", "regex_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "s", "\"", ",", "&", "dir", ",", "&", "dir_len", ",", "&", "regex", ",", "&", "regex_len", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "@", "@", "-", "2586", ",", "7", "+", "2586", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "delete", ")", "return", ";", "}", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "@", "@", "-", "3400", ",", "7", "+", "3400", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "copy", ")", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ss", "\"", ",", "&", "oldfile", ",", "&", "oldfile_len", ",", "&", "newfile", ",", "&", "newfile_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "pp", "\"", ",", "&", "oldfile", ",", "&", "oldfile_len", ",", "&", "newfile", ",", "&", "newfile_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3500", ",", "7", "+", "3500", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "offsetExists", ")", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3538", ",", "7", "+", "3538", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "offsetGet", ")", "zend_string", "*", "sfname", ";", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3685", ",", "8", "+", "3685", ",", "8", "@", "@", "PHP_METHOD", "(", "Phar", ",", "offsetSet", ")", "return", ";", "}", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", "),", "\"", "sr", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "zresource", ")", "=", "=", "FAILURE", "&", "&", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ss", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "cont_str", ",", "&", "cont_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", "),", "\"", "pr", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "zresource", ")", "=", "=", "FAILURE", "&", "&", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ps", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "cont_str", ",", "&", "cont_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3724", ",", "7", "+", "3724", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "offsetUnset", ")", "return", ";", "}", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3771", ",", "7", "+", "3771", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "addEmptyDir", ")", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "dirname", ",", "&", "dirname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "dirname", ",", "&", "dirname_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3796", ",", "7", "+", "3796", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "addFile", ")", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "localname", ",", "&", "localname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ",", "&", "localname", ",", "&", "localname_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "3838", ",", "7", "+", "3838", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "addFromString", ")", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ss", "\"", ",", "&", "localname", ",", "&", "localname_len", ",", "&", "cont_str", ",", "&", "cont_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ps", "\"", ",", "&", "localname", ",", "&", "localname_len", ",", "&", "cont_str", ",", "&", "cont_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "4264", ",", "7", "+", "4264", ",", "7", "@", "@", "PHP_METHOD", "(", "Phar", ",", "extractTo", ")", "PHAR_ARCHIVE_OBJECT", "(", ");", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "|", "z", "!", "b", "\"", ",", "&", "pathto", ",", "&", "pathto_len", ",", "&", "zval_files", ",", "&", "overwrite", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "|", "z", "!", "b", "\"", ",", "&", "pathto", ",", "&", "pathto_len", ",", "&", "zval_files", ",", "&", "overwrite", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "4396", ",", "7", "+", "4396", ",", "7", "@", "@", "PHP_METHOD", "(", "PharFileInfo", ",", "__construct", ")", "phar_archive_data", "*", "phar_data", ";", "zval", "*", "zobj", "=", "getThis", "(", "),", "arg1", ";", "if", "(", "zend_parse_parameters_throw", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "s", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "if", "(", "zend_parse_parameters_throw", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "p", "\"", ",", "&", "fname", ",", "&", "fname_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "147", ",", "19", "+", "147", ",", "19", "@", "@", "echo", "$", "e", "-", ">", "getMessage", "(", ")", ".", "\"", "\\", "n", "\"", ";", "-", "-", "EXPECTF", "Warning", ":", "Phar", ":", ":", "mungServer", "(", ")", "expects", "parameter", "1", "to", "be", "array", ",", "%", "string", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "createDefaultStub", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "createDefaultStub", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "loadPhar", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "loadPhar", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "canCompress", "(", ")", "expects", "parameter", "1", "to", "be", "integer", ",", "%", "string", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Exception", ":", "Phar", ":", ":", "__construct", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Exception", ":", "Phar", ":", ":", "__construct", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "convertToExecutable", "(", ")", "expects", "parameter", "1", "to", "be", "integer", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "convertToData", "(", ")", "expects", "parameter", "1", "to", "be", "integer", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "PharData", ":", ":", "delete", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "PharData", ":", ":", "delete", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Cannot", "write", "out", "phar", "archive", ",", "phar", "is", "read", "-", "only", "Entry", "oops", "does", "not", "exist", "and", "cannot", "be", "deleted", "%", "sfiles", "/", "frontcontroller10", ".", "phar", "@", "@", "-", "186", ",", "18", "+", "186", ",", "18", "@", "@", "Phar", "is", "readonly", ",", "cannot", "change", "compression", "Warning", ":", "Phar", ":", ":", "copy", "(", ")", "expects", "exactly", "2", "parameters", ",", "1", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Cannot", "copy", "\"", "a", "\"", "to", "\"", "b", "\"", ",", "phar", "is", "read", "-", "only", "Warning", ":", "Phar", ":", ":", "offsetExists", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "offsetExists", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "offsetGet", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "offsetGet", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "offsetSet", "(", ")", "expects", "exactly", "2", "parameters", ",", "1", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "PharData", ":", ":", "offsetUnset", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "PharData", ":", ":", "offsetUnset", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Write", "operations", "disabled", "by", "the", "php", ".", "ini", "setting", "phar", ".", "readonly", "Warning", ":", "Phar", ":", ":", "addEmptyDir", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "addEmptyDir", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "addFile", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "addFile", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "addFromString", "(", ")", "expects", "exactly", "2", "parameters", ",", "1", "given", "in", "%", "sbadparameters", ".", "php", "on", "line", "%", "d", "Write", "operations", "disabled", "by", "the", "php", ".", "ini", "setting", "phar", ".", "readonly", "@", "@", "-", "48", ",", "11", "+", "48", ",", "12", "@", "@", "try", "{", "<", "?", "php", "@", "unlink", "(", "__DIR__", ".", "\"/", "bug64931", ".", "phar", "\"", ");", "?", ">", "EXPECT", "-", "-", "EXPECTF", "-", "-", "Test", "CAUGHT", ":", "Cannot", "create", "any", "files", "in", "magic", "\"", ".", "phar", "\"", "directory", "CAUGHT", ":", "Cannot", "create", "any", "files", "in", "magic", "\"", ".", "phar", "\"", "directory", "CAUGHT", ":", "Cannot", "create", "any", "files", "in", "magic", "\"", ".", "phar", "\"", "directory", "CAUGHT", ":", "Cannot", "create", "any", "files", "in", "magic", "\"", ".", "phar", "\"", "directory", "CAUGHT", ":", "Cannot", "create", "any", "files", "in", "magic", "\"", ".", "phar", "\"", "directory", "Warning", ":", "Phar", ":", ":", "addFromString", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "string", "given", "in", "%", "s", "/", "bug64931", ".", "php", "on", "line", "%", "d", "=", "==", "DONE", "=", "==", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "80", ",", "6", "+", "80", ",", "5", "@", "@", "string", "(", "5", ")", "\"", "query", "\"", "11", ":", "Error", ":", "file_put_contents", "(", "phar", ":", "//", "%", "s", ")", ":", "failed", "to", "open", "stream", ":", "phar", "error", ":", "invalid", "path", "\"", "%", "s", "\"", "contains", "illegal", "character", "12", ":", "Error", ":", "file_put_contents", "(", "phar", ":", "//", "%", "s", ")", ":", "failed", "to", "open", "stream", ":", "phar", "error", ":", "invalid", "path", "\"", "%", "s", "\"", "contains", "illegal", "character", "13", ":", "Error", ":", "file_put_contents", "(", "phar", ":", "//", "%", "s", ")", ":", "failed", "to", "open", "stream", ":", "phar", "error", ":", "invalid", "path", "\"", "%", "s", "\"", "contains", "illegal", "character", "Exception", ":", "Entry", "a", "does", "not", "exist", "and", "cannot", "be", "created", ":", "phar", "error", ":", "invalid", "path", "\"", "a", "\"", "contains", "illegal", "character", "=", "==", "DONE", "=", "==", "Error", ":", "Phar", ":", ":", "offsetSet", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "string", "given", "=", "==", "DONE", "=", "==", "@", "@", "-", "138", ",", "7", "+", "138", ",", "7", "@", "@", "string", "(", "3", ")", "\"", "hi2", "\"", "bool", "(", "false", ")", "Invalid", "argument", ",", "expected", "a", "filename", "(", "string", ")", "or", "array", "of", "filenames", "Warning", ":", "Phar", ":", ":", "extractTo", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sphar_extract", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "extractTo", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sphar_extract", ".", "php", "on", "line", "%", "d", "Invalid", "argument", ",", "extraction", "path", "must", "be", "non", "-", "zero", "length", "Unable", "to", "use", "path", "\"", "%", "soops", "\"", "for", "extraction", ",", "it", "is", "a", "file", ",", "must", "be", "a", "directory", "Invalid", "argument", ",", "array", "of", "filenames", "to", "extract", "contains", "non", "-", "string", "value", "@", "@", "-", "76", ",", "7", "+", "76", ",", "7", "@", "@", "var_dump", "(", "Phar", ":", ":", "isValidPharFilename", "(", "'", "dir", ".", "phar", ".", "php", "'", ",", "false", ")", ");", "<", "?", "php", "rmdir", "(", "dirname", "(", "__FILE__", ")", ".", "'", "/.", "phar", "'", ");", "-", "-", "EXPECTF", "Warning", ":", "Phar", ":", ":", "isValidPharFilename", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sphar_isvalidpharfilename", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "isValidPharFilename", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sphar_isvalidpharfilename", ".", "php", "on", "line", "%", "d", "*", "bool", "(", "false", ")", "bool", "(", "false", ")", "@", "@", "-", "90", ",", "7", "+", "90", ",", "7", "@", "@", "Unknown", "phar", "archive", "\"", "\"", "Unknown", "phar", "archive", "\"", "%", "sphar_unlinkarchive", ".", "phar", "\"", "Unknown", "phar", "archive", "\"", "%", "sphar_unlinkarchive", ".", "phar", ".", "tar", "\"", ":", "internal", "corruption", "of", "phar", "\"", "%", "sphar_unlinkarchive", ".", "phar", ".", "tar", "\"", "(", "truncated", "entry", ")", "Warning", ":", "Phar", ":", ":", "unlinkArchive", "(", ")", "expects", "parameter", "1", "to", "be", "%", "string", ",", "array", "given", "in", "%", "sphar_unlinkarchive", ".", "php", "on", "line", "%", "d", "Warning", ":", "Phar", ":", ":", "unlinkArchive", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "in", "%", "sphar_unlinkarchive", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "string", "(", "48", ")", "\"", "<?", "php", "echo", "\"", "first", "stub", "\\", "n", "\"", ";", "__HALT_COMPILER", "(", ");", "?", ">\"", "phar", "archive", "\"", "%", "sphar_unlinkarchive", ".", "phar", "\"", "has", "open", "file", "handles", "or", "objects", ".", "fclose", "(", ")", "all", "file", "handles", ",", "and", "unset", "(", ")", "all", "objects", "prior", "to", "calling", "unlinkArchive", "(", ")", "@", "@", "-", "50", ",", "7", "+", "50", ",", "7", "@", "@", "echo", "$", "e", "-", ">", "getMessage", "(", ")", ".", "\"", "\\", "n", "\"", ";", "<", "?", "php", "unlink", "(", "dirname", "(", "__FILE__", ")", ".", "'", "/'", ".", "basename", "(", "__FILE__", ",", "'", ".", "clean", ".", "php", "'", ")", ".", "'", ".", "phar", "'", ");", "?", ">", "-", "-", "EXPECTF", "Cannot", "open", "phar", "file", "'", "phar", ":", "//", "%", "spharfileinfo_construct", ".", "phar", "/", "oops", "'", ":", "internal", "corruption", "of", "phar", "\"", "%", "spharfileinfo_construct", ".", "phar", "\"", "(", "truncated", "entry", ")", "PharFileInfo", ":", ":", "__construct", "(", ")", "expects", "parameter", "1", "to", "be", "string", ",", "array", "given", "PharFileInfo", ":", ":", "__construct", "(", ")", "expects", "parameter", "1", "to", "be", "a", "valid", "path", ",", "array", "given", "Cannot", "access", "phar", "file", "entry", "'", "%", "s", "'", "in", "archive", "'", "%", "s", "'", "Cannot", "call", "constructor", "twice", "'", "%", "s", "'", "is", "not", "a", "valid", "phar", "archive", "URL", "(", "must", "have", "at", "least", "phar", ":", "//", "filename", ".", "phar", ")"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/pull/359"], "code_tokens": ["@", "@", "-", "710", ",", "6", "+", "710", ",", "7", "@", "@", "static", "MagickBooleanType", "WriteTGAImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ")", "compression", ";", "const", "char", "*", "comment", ",", "*", "value", ";", "const", "double", "@", "@", "-", "766", ",", "9", "+", "767", ",", "9", "@", "@", "static", "MagickBooleanType", "WriteTGAImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ")", "compression", "=", "image_info", "-", ">", "compression", ";", "range", "=", "GetQuantumRange", "(", "5UL", ")", ";", "tga_info", ".", "id_length", "=", "0", ";", "value", "=", "GetImageProperty", "(", "image", ",", "\"", "comment", "\"", ");", "if", "(", "value", "!", "=", "(", "const", "char", "*", ")", "NULL", ")", "tga_info", ".", "id_length", "=", "(", "unsigned", "char", ")", "MagickMin", "(", "strlen", "(", "value", ")", ",", "255", ")", ";", "comment", "=", "GetImageProperty", "(", "image", ",", "\"", "comment", "\"", ");", "if", "(", "comment", "!", "=", "(", "const", "char", "*", ")", "NULL", ")", "tga_info", ".", "id_length", "=", "(", "unsigned", "char", ")", "MagickMin", "(", "strlen", "(", "comment", ")", ",", "255", ")", ";", "tga_info", ".", "colormap_type", "=", "0", ";", "tga_info", ".", "colormap_index", "=", "0", ";", "tga_info", ".", "colormap_length", "=", "0", ";", "@", "@", "-", "852", ",", "7", "+", "853", ",", "7", "@", "@", "static", "MagickBooleanType", "WriteTGAImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ")", "(", "void", ")", "WriteBlobByte", "(", "image", ",", "tga_info", ".", "bits_per_pixel", ")", ";", "(", "void", ")", "WriteBlobByte", "(", "image", ",", "tga_info", ".", "attributes", ")", ";", "if", "(", "tga_info", ".", "id_length", "!", "=", "0", ")", "(", "void", ")", "WriteBlob", "(", "image", ",", "tga_info", ".", "id_length", ",", "(", "unsigned", "char", "*", ")", "value", ")", ";", "(", "void", ")", "WriteBlob", "(", "image", ",", "tga_info", ".", "id_length", ",", "(", "unsigned", "char", "*", ")", "comment", ")", ";", "if", "(", "tga_info", ".", "colormap_type", "!", "=", "0", ")", "{", "unsigned", "char"], "docstring_tokens": ["the", "application", "to", "crash"]}
{"contents": ["[hotfix][runtime]", "It", "was", "possible", "to", "traverse", "the", "directory", "of", "the", "host", "through", "/jobmanager/logs/<path-to-file>.", "The", "<path-to-file>", "had", "to", "be", "modified", "in", "a", "way", "that", "'../'", "referring", "to", "the", "parent", "folder", "needed", "to", "be", "replaced", "by", "'..%252f'.", "This", "enabled", "traversing", "the", "directory", "structure", "relative", "to", "the", "./logs", "folder,", "e.g.", "/jobmanager/logs/..%252f/README.txt", "would", "return", "the", "content", "of", "the", "README.txt", "located", "in", "the", "FLINK_HOME", "folder", "(assuming", "Flink's", "default", "folder", "structure).", "This", "is", "fixed", "now.", "The", "passed", "path", "is", "ignored", "in", "the", "same", "way", "as", "it's", "already", "done", "for", "the", "TaskManagerCustomLogHandler."], "code_tokens": ["@", "@", "-", "54", ",", "7", "+", "54", ",", "9", "@", "@", "protected", "File", "getFile", "(", "HandlerRequest", "<", "EmptyRequestBody", ",", "FileMessageParameters", ">", "h", "if", "(", "logDir", "=", "=", "null", ")", "{", "return", "null", ";", "}", "String", "filename", "=", "handlerRequest", ".", "getPathParameter", "(", "LogFileNamePathParameter", ".", "class", ")", ";", "/", "/", "wrapping", "around", "another", "File", "instantiation", "is", "a", "simple", "way", "to", "remove", "any", "path", "information", "-", "we", "'", "re", "/", "/", "solely", "interested", "in", "the", "filename", "String", "filename", "=", "new", "File", "(", "handlerRequest", ".", "getPathParameter", "(", "LogFileNamePathParameter", ".", "class", ")", ").", "getName", "(", ");", "return", "new", "File", "(", "logDir", ",", "filename", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "162", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "rest", ".", "handler", ".", "cluster", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "rest", ".", "handler", ".", "HandlerRequest", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "rest", ".", "handler", ".", "HandlerRequestException", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "rest", ".", "messages", ".", "EmptyRequestBody", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "rest", ".", "messages", ".", "cluster", ".", "FileMessageParameters", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "rest", ".", "messages", ".", "cluster", ".", "JobManagerCustomLogHeaders", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "testingUtils", ".", "TestingUtils", ";", "import", "org", ".", "apache", ".", "flink", ".", "runtime", ".", "webmonitor", ".", "TestingDispatcherGateway", ";", "import", "org", ".", "apache", ".", "flink", ".", "util", ".", "TestLogger", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CompletableFuture", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "notNullValue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "/", "**", "*", "Unit", "tests", "for", "{", "@", "link", "JobManagerCustomLogHandler", "}", ".", "*", "/", "public", "class", "JobManagerCustomLogHandlerTest", "extends", "TestLogger", "{", "private", "static", "final", "String", "FORBIDDEN_FILENAME", "=", "\"", "forbidden", "\"", ";", "private", "static", "final", "String", "VALID_LOG_FILENAME", "=", "\"", "valid", ".", "log", "\"", ";", "private", "static", "final", "String", "VALID_LOG_CONTENT", "=", "\"", "logged", "content", "\"", ";", "@", "Rule", "public", "TemporaryFolder", "temporaryFolder", "=", "new", "TemporaryFolder", "(", ");", "private", "File", "logRoot", ";", "private", "JobManagerCustomLogHandler", "testInstance", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "IOException", "{", "initializeFolderStructure", "(", ");", "final", "TestingDispatcherGateway", "dispatcherGateway", "=", "new", "TestingDispatcherGateway", ".", "Builder", "(", ").", "build", "(", ");", "testInstance", "=", "new", "JobManagerCustomLogHandler", "(", "(", ")", "-", ">", "CompletableFuture", ".", "completedFuture", "(", "dispatcherGateway", ")", ",", "TestingUtils", ".", "TIMEOUT", "(", "),", "Collections", ".", "emptyMap", "(", "),", "JobManagerCustomLogHeaders", ".", "getInstance", "(", "),", "logRoot", ")", ";", "}", "private", "void", "initializeFolderStructure", "(", ")", "throws", "IOException", "{", "File", "root", "=", "temporaryFolder", ".", "getRoot", "(", ");", "logRoot", "=", "new", "File", "(", "root", ",", "\"", "logs", "\"", ");", "assertTrue", "(", "logRoot", ".", "mkdir", "(", "))", ";", "createFile", "(", "new", "File", "(", "root", ",", "FORBIDDEN_FILENAME", ")", ",", "\"", "forbidden", "content", "\"", ");", "createFile", "(", "new", "File", "(", "logRoot", ",", "VALID_LOG_FILENAME", ")", ",", "VALID_LOG_CONTENT", ")", ";", "}", "private", "static", "void", "createFile", "(", "File", "file", ",", "String", "content", ")", "throws", "IOException", "{", "FileUtils", ".", "writeStringToFile", "(", "file", ",", "content", ",", "StandardCharsets", ".", "UTF_8", ")", ";", "}", "private", "static", "HandlerRequest", "<", "EmptyRequestBody", ",", "FileMessageParameters", ">", "createHandlerRequest", "(", "String", "path", ")", "throws", "HandlerRequestException", "{", "FileMessageParameters", "messageParameters", "=", "new", "FileMessageParameters", "(", ");", "Map", "<", "String", ",", "String", ">", "pathParameters", "=", "new", "HashMap", "<", ">(", ");", "pathParameters", ".", "put", "(", "messageParameters", ".", "logFileNamePathParameter", ".", "getKey", "(", "),", "path", ")", ";", "return", "new", "HandlerRequest", "<", ">(", "EmptyRequestBody", ".", "getInstance", "(", "),", "messageParameters", ",", "pathParameters", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsValidFilename", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "VALID_LOG_FILENAME", ")", ");", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "String", "actualContent", "=", "String", ".", "join", "(", "\"\"", ",", "Files", ".", "readAllLines", "(", "actualFile", ".", "toPath", "(", "))", ");", "assertThat", "(", "actualContent", ",", "is", "(", "VALID_LOG_CONTENT", ")", ");", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsValidFilenameWithPath", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "String", ".", "format", "(", "\"", "foobar", "/", "%", "s", "\"", ",", "VALID_LOG_FILENAME", ")", "))", ";", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "String", "actualContent", "=", "String", ".", "join", "(", "\"\"", ",", "Files", ".", "readAllLines", "(", "actualFile", ".", "toPath", "(", "))", ");", "assertThat", "(", "actualContent", ",", "is", "(", "VALID_LOG_CONTENT", ")", ");", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsValidFilenameWithInvalidPath", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "String", ".", "format", "(", "\".", "./", "%", "s", "\"", ",", "VALID_LOG_FILENAME", ")", "))", ";", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "String", "actualContent", "=", "String", ".", "join", "(", "\"\"", ",", "Files", ".", "readAllLines", "(", "actualFile", ".", "toPath", "(", "))", ");", "assertThat", "(", "actualContent", ",", "is", "(", "VALID_LOG_CONTENT", ")", ");", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsNotExistingFile", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "\"", "not", "-", "existing", "\"", "))", ";", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "assertFalse", "(", "actualFile", ".", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsExistingButForbiddenFile", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "String", ".", "format", "(", "\".", "./", "%", "s", "\"", ",", "FORBIDDEN_FILENAME", ")", "))", ";", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "assertFalse", "(", "actualFile", ".", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsExistingButForbiddenFileWithObfuscatedPath", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "String", ".", "format", "(", "\".", ".%", "%", "252", "%", "s", "\"", ",", "FORBIDDEN_FILENAME", ")", "))", ";", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "assertFalse", "(", "actualFile", ".", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetJobManagerCustomLogsValidFilenameWithLongInvalidPath", "(", ")", "throws", "Exception", "{", "File", "actualFile", "=", "testInstance", ".", "getFile", "(", "createHandlerRequest", "(", "String", ".", "format", "(", "\"", "foobar", "/", "..", "/.", "./", "%", "s", "\"", ",", "VALID_LOG_FILENAME", ")", "))", ";", "assertThat", "(", "actualFile", ",", "is", "(", "notNullValue", "(", "))", ");", "String", "actualContent", "=", "String", ".", "join", "(", "\"\"", ",", "Files", ".", "readAllLines", "(", "actualFile", ".", "toPath", "(", "))", ");", "assertThat", "(", "actualContent", ",", "is", "(", "VALID_LOG_CONTENT", ")", ");", "}", "}"], "docstring_tokens": ["read", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["[SECURITY-667]", "Ensure", "all", "tasks", "have", "completed", "before", "we", "attain", "COMPLETED."], "code_tokens": ["@", "@", "-", "3097", ",", "7", "+", "3097", ",", "7", "@", "@", "public", "void", "run", "(", "Reactor", "session", ")", "throws", "Exception", "{", "}", ");", "}", "g", ".", "requires", "(", "JOB_LOADED", ")", ".", "add", "(", "\"", "Cleaning", "up", "obsolete", "items", "deleted", "from", "the", "disk", "\"", ",", "new", "Executable", "(", ")", "{", "g", ".", "requires", "(", "JOB_LOADED", ")", ".", "attains", "(", "COMPLETED", ")", ".", "add", "(", "\"", "Cleaning", "up", "obsolete", "items", "deleted", "from", "the", "disk", "\"", ",", "new", "Executable", "(", ")", "{", "public", "void", "run", "(", "Reactor", "reactor", ")", "throws", "Exception", "{", "/", "/", "anything", "we", "didn", "'", "t", "load", "from", "disk", ",", "throw", "them", "away", ".", "/", "/", "doing", "this", "after", "loading", "from", "disk", "allows", "newly", "loaded", "items", "@", "@", "-", "3112", ",", "7", "+", "3112", ",", "7", "@", "@", "public", "void", "run", "(", "Reactor", "reactor", ")", "throws", "Exception", "{", "}", "}", ");", "g", ".", "requires", "(", "JOB_LOADED", ")", ".", "add", "(", "\"", "Finalizing", "set", "up", "\"", ",", "new", "Executable", "(", ")", "{", "g", ".", "requires", "(", "JOB_LOADED", ")", ".", "attains", "(", "COMPLETED", ")", ".", "add", "(", "\"", "Finalizing", "set", "up", "\"", ",", "new", "Executable", "(", ")", "{", "public", "void", "run", "(", "Reactor", "session", ")", "throws", "Exception", "{", "rebuildDependencyGraph", "(", ");"], "docstring_tokens": ["wrong", "order", "of", "execution", "of", "commands", "during", "initialization", "."]}
{"contents": ["Fix", "#77367:", "Negative", "size", "parameter", "in", "mb_split", "When", "adding", "the", "last", "element", "to", "the", "result", "value", "of", "`mb_split`,", "the", "`chunk_pos`", "may", "point", "beyond", "the", "end", "of", "the", "string,", "in", "which", "case", "the", "unsigned", "`n`", "would", "underflow.", "Therefore,", "we", "check", "whether", "this", "is", "the", "case", "in", "the", "first", "place,", "and", "only", "calculate", "`n`", "otherwise.", "Since", "`n`", "is", "no", "longer", "used", "outside", "the", "block,", "we", "move", "its", "declaration", "inside."], "code_tokens": ["@", "@", "-", "1238", ",", "7", "+", "1238", ",", "6", "@", "@", "PHP_FUNCTION", "(", "mb_split", ")", "size_t", "string_len", ";", "int", "err", ";", "size_t", "n", ";", "zend_long", "count", "=", "-", "1", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", "),", "\"", "ss", "|", "l", "\"", ",", "&", "arg_pattern", ",", "&", "arg_pattern_len", ",", "&", "string", ",", "&", "string_len", ",", "&", "count", ")", "=", "=", "FAILURE", ")", "{", "@", "@", "-", "1296", ",", "8", "+", "1295", ",", "8", "@", "@", "PHP_FUNCTION", "(", "mb_split", ")", "}", "/", "*", "otherwise", "we", "just", "have", "one", "last", "element", "to", "add", "to", "the", "array", "*", "/", "n", "=", "(", "(", "OnigUChar", "*", ")(", "string", "+", "string_len", ")", "-", "chunk_pos", ")", ";", "if", "(", "n", ">", "0", ")", "{", "if", "(", "(", "OnigUChar", "*", ")(", "string", "+", "string_len", ")", ">", "chunk_pos", ")", "{", "size_t", "n", "=", "(", "(", "OnigUChar", "*", ")(", "string", "+", "string_len", ")", "-", "chunk_pos", ")", ";", "add_next_index_stringl", "(", "return_value", ",", "(", "char", "*", ")", "chunk_pos", ",", "n", ")", ";", "}", "else", "{", "add_next_index_stringl", "(", "return_value", ",", "\"", "\",", "0", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "77367", "(", "Negative", "size", "parameter", "in", "mb_split", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "mbstring", "'", "))", "die", "(", "'", "mbstring", "extension", "not", "available", "'", ");", "if", "(", "!", "function_exists", "(", "'", "mb_split", "'", "))", "die", "(", "'", "mb_split", "(", ")", "not", "available", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "mb_regex_encoding", "(", "'", "UTF", "-", "8", "'", ");", "var_dump", "(", "mb_split", "(", "\"\\", "\\", "w", "\"", ",", "\"", "\\", "xfc", "\"", "))", ";", "?", ">", "=", "==", "DONE", "=", "==", "-", "-", "EXPECT", "-", "-", "array", "(", "2", ")", "{", "[", "0", "]", "=>", "string", "(", "0", ")", "\"", "\"", "[", "1", "]", "=>", "string", "(", "0", ")", "\"", "\"", "}", "=", "==", "DONE", "=", "=="], "docstring_tokens": ["read", "and", "write", "past", "buffers", "allocated", "for", "the", "data", "."]}
{"contents": ["ALSA:", "hrtimer:", "Fix", "stall", "by", "hrtimer_cancel()", "hrtimer_cancel()", "waits", "for", "the", "completion", "from", "the", "callback,", "thus", "it", "must", "not", "be", "called", "inside", "the", "callback", "itself.", "This", "was", "already", "a", "problem", "in", "the", "past", "with", "ALSA", "hrtimer", "driver,", "and", "the", "early", "commit", "[fcfdebe70759:", "ALSA:", "hrtimer", "-", "Fix", "lock-up]", "tried", "to", "address", "it.", "However,", "the", "previous", "fix", "is", "still", "insufficient:", "it", "may", "still", "cause", "a", "lockup", "when", "the", "ALSA", "timer", "instance", "reprograms", "itself", "in", "its", "callback.", "Then", "it", "invokes", "the", "start", "function", "even", "in", "snd_timer_interrupt()", "that", "is", "called", "in", "hrtimer", "callback", "itself,", "results", "in", "a", "CPU", "stall.", "This", "is", "no", "hypothetical", "problem", "but", "actually", "triggered", "by", "syzkaller", "fuzzer.", "This", "patch", "tries", "to", "fix", "the", "issue", "again.", "Now", "we", "call", "hrtimer_try_to_cancel()", "at", "both", "start", "and", "stop", "functions", "so", "that", "it", "won't", "fall", "into", "a", "deadlock,", "yet", "giving", "some", "chance", "to", "cancel", "the", "queue", "if", "the", "functions", "have", "been", "called", "outside", "the", "callback.", "The", "proper", "hrtimer_cancel()", "is", "called", "in", "anyway", "at", "closing,", "so", "this", "should", "be", "enough.", "Reported-and-tested-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "90", ",", "7", "+", "90", ",", "7", "@", "@", "static", "int", "snd_hrtimer_start", "(", "struct", "snd_timer", "*", "t", ")", "struct", "snd_hrtimer", "*", "stime", "=", "t", "-", ">", "private_data", ";", "atomic_set", "(", "&", "stime", "-", ">", "running", ",", "0", ")", ";", "hrtimer_cancel", "(", "&", "stime", "-", ">", "hrt", ")", ";", "hrtimer_try_to_cancel", "(", "&", "stime", "-", ">", "hrt", ")", ";", "hrtimer_start", "(", "&", "stime", "-", ">", "hrt", ",", "ns_to_ktime", "(", "t", "-", ">", "sticks", "*", "resolution", ")", ",", "HRTIMER_MODE_REL", ")", ";", "atomic_set", "(", "&", "stime", "-", ">", "running", ",", "1", ")", ";", "@", "@", "-", "101", ",", "6", "+", "101", ",", "7", "@", "@", "static", "int", "snd_hrtimer_stop", "(", "struct", "snd_timer", "*", "t", ")", "{", "struct", "snd_hrtimer", "*", "stime", "=", "t", "-", ">", "private_data", ";", "atomic_set", "(", "&", "stime", "-", ">", "running", ",", "0", ")", ";", "hrtimer_try_to_cancel", "(", "&", "stime", "-", ">", "hrt", ")", ";", "return", "0", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(deadlock", ")"]}
{"contents": ["Issue", "#3555", "-", "Applying", "more", "changes", "from", "review", "Signed-off-by:", "Joakim", "Erdfelt", "<joakim.erdfelt@gmail.com>"], "code_tokens": ["@", "@", "-", "35", ",", "6", "+", "35", ",", "7", "@", "@", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Server", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "IO", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "StringUtil", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "UrlEncoded", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "log", ".", "Log", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "log", ".", "Logger", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "resource", ".", "Resource", ";", "@", "@", "-", "148", ",", "13", "+", "149", ",", "11", "@", "@", "public", "void", "handle", "(", "String", "target", ",", "Request", "baseRequest", ",", "HttpServletRequest", "reques", "/", "/", "Context", "Path", "ContextHandler", "context", "=", "(", "ContextHandler", ")", "handlers", "[", "i", "]", ";", "StringBuilder", "href", "=", "new", "StringBuilder", "(", ");", "String", "contextPath", "=", "context", ".", "getContextPath", "(", ");", "href", ".", "append", "(", "contextPath", ")", ";", "String", "href", "=", "UrlEncoded", ".", "encodeString", "(", "contextPath", ".", "substring", "(", "1", ")", ",", "UTF_8", ")", ";", "if", "(", "contextPath", ".", "length", "(", ")", ">", "1", "&", "&", "!", "contextPath", ".", "endsWith", "(", "\"/", "\")", ")", "{", "href", ".", "append", "(", "\"/", "\")", ";", "href", "+", "=", "'", "/'", ";", "}", "if", "(", "context", ".", "isRunning", "(", "))"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["KVM:", "x86:", "fix", "for", "buffer", "overflow", "in", "handling", "of", "MSR_KVM_SYSTEM_TIME", "(", ")", "If", "the", "guest", "sets", "the", "GPA", "of", "the", "time_page", "so", "that", "the", "request", "to", "update", "the", "time", "straddles", "a", "page", "then", "KVM", "will", "write", "onto", "an", "incorrect", "page.", "The", "write", "is", "done", "byusing", "kmap", "atomic", "to", "get", "a", "pointer", "to", "the", "page", "for", "the", "time", "structure", "and", "then", "performing", "a", "memcpy", "to", "that", "page", "starting", "at", "an", "offset", "that", "the", "guest", "controls.", "Well", "behaved", "guests", "always", "provide", "a", "32-byte", "aligned", "address,", "however", "a", "malicious", "guest", "could", "use", "this", "to", "corrupt", "host", "kernel", "memory.", "Tested:", "Tested", "against", "kvmclock", "unit", "test.", "Signed-off-by:", "Andrew", "Honig", "<ahonig@google.com>", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>"], "code_tokens": ["@", "@", "-", "1959", ",", "6", "+", "1959", ",", "11", "@", "@", "int", "kvm_set_msr_common", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "struct", "msr_data", "*", "msr_info", ")", "/", "*", ".", "..", "but", "clean", "it", "before", "doing", "the", "actual", "write", "*", "/", "vcpu", "-", ">", "arch", ".", "time_offset", "=", "data", "&", "~", "(", "PAGE_MASK", "|", "1", ")", ";", "/", "*", "Check", "that", "the", "address", "is", "32", "-", "byte", "aligned", ".", "*", "/", "if", "(", "vcpu", "-", ">", "arch", ".", "time_offset", "&", "(", "sizeof", "(", "struct", "pvclock_vcpu_time_info", ")", "-", "1", ")", ")", "break", ";", "vcpu", "-", ">", "arch", ".", "time_page", "=", "gfn_to_page", "(", "vcpu", "-", ">", "kvm", ",", "data", ">", ">", "PAGE_SHIFT", ")", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["Fix", "#73832", "-", "leave", "the", "table", "in", "a", "safe", "state", "if", "the", "size", "is", "too", "big."], "code_tokens": ["@", "@", "-", "175", ",", "14", "+", "175", ",", "14", "@", "@", "ZEND_API", "void", "ZEND_FASTCALL", "_zend_hash_init", "(", "HashTable", "*", "ht", ",", "uint32_t", "nSize", ",", "dtor_", "GC_REFCOUNT", "(", "ht", ")", "=", "1", ";", "GC_TYPE_INFO", "(", "ht", ")", "=", "IS_ARRAY", ";", "ht", "-", ">", "u", ".", "flags", "=", "(", "persistent", "?", "HASH_FLAG_PERSISTENT", ":", "0", ")", "|", "HASH_FLAG_APPLY_PROTECTION", "|", "HASH_FLAG_STATIC_KEYS", ";", "ht", "-", ">", "nTableSize", "=", "zend_hash_check_size", "(", "nSize", ")", ";", "ht", "-", ">", "nTableMask", "=", "HT_MIN_MASK", ";", "HT_SET_DATA_ADDR", "(", "ht", ",", "&", "uninitialized_bucket", ")", ";", "ht", "-", ">", "nNumUsed", "=", "0", ";", "ht", "-", ">", "nNumOfElements", "=", "0", ";", "ht", "-", ">", "nInternalPointer", "=", "HT_INVALID_IDX", ";", "ht", "-", ">", "nNextFreeElement", "=", "0", ";", "ht", "-", ">", "pDestructor", "=", "pDestructor", ";", "ht", "-", ">", "nTableSize", "=", "zend_hash_check_size", "(", "nSize", ")", ";", "}", "static", "void", "ZEND_FASTCALL", "zend_hash_packed_grow", "(", "HashTable", "*", "ht", ")"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["Merge", "branch", "'releases/3.3.0.1'"], "code_tokens": ["@", "@", "-", "1", "+", "1", "@", "@", "version", "=", "3", ".", "3", ".", "0", "version", "=", "3", ".", "3", ".", "0", ".", "1", "@", "@", "-", "49", ",", "6", "+", "49", ",", "7", "@", "@", "public", "class", "UaaResetPasswordService", "implements", "ResetPasswordService", ",", "ApplicationEventPublisherAware", "{", "public", "static", "final", "int", "PASSWORD_RESET_LIFETIME", "=", "30", "*", "60", "*", "1000", ";", "public", "static", "final", "String", "FORGOT_PASSWORD_INTENT_PREFIX", "=", "\"", "forgot_password_for_id", ":", "\";", "private", "final", "ScimUserProvisioning", "scimUserProvisioning", ";", "private", "final", "ExpiringCodeStore", "expiringCodeStore", ";", "@", "@", "-", "79", ",", "20", "+", "80", ",", "22", "@", "@", "private", "ResetPasswordResponse", "changePasswordCodeAuthenticated", "(", "String", "code", ",", "Strin", "throw", "new", "InvalidCodeException", "(", "\"", "invalid_code", "\"", ",", "\"", "Sorry", ",", "your", "reset", "password", "link", "is", "no", "longer", "valid", ".", "Please", "request", "a", "new", "one", "\"", ",", "422", ")", ";", "}", "String", "userId", ";", "String", "userName", "=", "null", ";", "Date", "passwordLastModified", "=", "null", ";", "String", "clientId", "=", "null", ";", "String", "redirectUri", "=", "null", ";", "String", "userName", ";", "Date", "passwordLastModified", ";", "String", "clientId", ";", "String", "redirectUri", ";", "PasswordChange", "change", ";", "try", "{", "PasswordChange", "change", "=", "JsonUtils", ".", "readValue", "(", "expiringCode", ".", "getData", "(", "),", "PasswordChange", ".", "class", ")", ";", "userId", "=", "change", ".", "getUserId", "(", ");", "userName", "=", "change", ".", "getUsername", "(", ");", "passwordLastModified", "=", "change", ".", "getPasswordModifiedTime", "(", ");", "clientId", "=", "change", ".", "getClientId", "(", ");", "redirectUri", "=", "change", ".", "getRedirectUri", "(", ");", "change", "=", "JsonUtils", ".", "readValue", "(", "expiringCode", ".", "getData", "(", "),", "PasswordChange", ".", "class", ")", ";", "}", "catch", "(", "JsonUtils", ".", "JsonUtilException", "x", ")", "{", "userId", "=", "expiringCode", ".", "getData", "(", ");", "throw", "new", "InvalidCodeException", "(", "\"", "invalid_code", "\"", ",", "\"", "Sorry", ",", "your", "reset", "password", "link", "is", "no", "longer", "valid", ".", "Please", "request", "a", "new", "one", "\"", ",", "422", ")", ";", "}", "userId", "=", "change", ".", "getUserId", "(", ");", "userName", "=", "change", ".", "getUsername", "(", ");", "passwordLastModified", "=", "change", ".", "getPasswordModifiedTime", "(", ");", "clientId", "=", "change", ".", "getClientId", "(", ");", "redirectUri", "=", "change", ".", "getRedirectUri", "(", ");", "ScimUser", "user", "=", "scimUserProvisioning", ".", "retrieve", "(", "userId", ")", ";", "try", "{", "if", "(", "isUserModified", "(", "user", ",", "expiringCode", ".", "getExpiresAt", "(", "),", "userName", ",", "passwordLastModified", ")", ")", "{", "@", "@", "-", "141", ",", "7", "+", "144", ",", "9", "@", "@", "public", "ForgotPasswordInfo", "forgotPassword", "(", "String", "email", ",", "String", "clientId", ",", "String", "r", "ScimUser", "scimUser", "=", "results", ".", "get", "(", "0", ")", ";", "PasswordChange", "change", "=", "new", "PasswordChange", "(", "scimUser", ".", "getId", "(", "),", "scimUser", ".", "getUserName", "(", "),", "scimUser", ".", "getPasswordLastModified", "(", "),", "clientId", ",", "redirectUri", ")", ";", "ExpiringCode", "code", "=", "expiringCodeStore", ".", "generateCode", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "String", "intent", "=", "FORGOT_PASSWORD_INTENT_PREFIX", "+", "scimUser", ".", "getId", "(", ");", "expiringCodeStore", ".", "expireByIntent", "(", "intent", ")", ";", "ExpiringCode", "code", "=", "expiringCodeStore", ".", "generateCode", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "PASSWORD_RESET_LIFETIME", ")", ",", "intent", ")", ";", "publish", "(", "new", "ResetPasswordRequestEvent", "(", "email", ",", "code", ".", "getCode", "(", "),", "SecurityContextHolder", ".", "getContext", "(", ").", "getAuthentication", "(", "))", ");", "return", "new", "ForgotPasswordInfo", "(", "scimUser", ".", "getId", "(", "),", "code", ")", ";", "}", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "private", "Log", "logger", "=", "LogFactory", ".", "getLog", "(", "getClass", "(", "))", ";", "private", "RandomValueStringGenerator", "generator", "=", "new", "RandomValueStringGenerator", "(", "6", ")", ";", "private", "RandomValueStringGenerator", "generator", "=", "new", "RandomValueStringGenerator", "(", "10", ")", ";", "private", "JdbcTemplate", "jdbcTemplate", ";", "@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "public", "AcceptedInvitation", "acceptInvitation", "(", "String", "code", ",", "String", "password", ")", "{", "user", "=", "scimUserProvisioning", ".", "verifyUser", "(", "userId", ",", "user", ".", "getVersion", "(", "))", ";", "if", "(", "OriginKeys", ".", "UAA", ".", "equals", "(", "user", ".", "getOrigin", "(", "))", ")", "{", "if", "(", "OriginKeys", ".", "UAA", ".", "equals", "(", "user", ".", "getOrigin", "(", "))", "&", "&", "StringUtils", ".", "hasText", "(", "password", ")", ")", "{", "PasswordChangeRequest", "request", "=", "new", "PasswordChangeRequest", "(", ");", "request", ".", "setPassword", "(", "password", ")", ";", "scimUserProvisioning", ".", "changePassword", "(", "userId", ",", "null", ",", "password", ")", ";", "@", "@", "-", "1", ",", "11", "+", "1", ",", "9", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "endpoints", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonIgnoreProperties", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonProperty", ";", "import", "java", ".", "util", ".", "Date", ";", "@", "JsonIgnoreProperties", "(", "ignoreUnknown", "=", "true", ")", "public", "class", "PasswordChange", "{", "public", "PasswordChange", "(", ")", "{", "}", "@", "@", "-", "151", ",", "7", "+", "151", ",", "7", "@", "@", "entry", "-", "point", "-", "ref", "=", "\"", "loginEntryPoint", "\"", "use", "-", "expressions", "=", "\"", "false", "\"", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "security", "\"", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"", "IS_AUTHENTICATED_ANONYMOUSLY", "\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"", "IS_AUTHENTICATED_FULLY", "\"", "/", ">", "<", "csrf", "disabled", "=", "\"", "false", "\"", "/>", "<", "access", "-", "denied", "-", "handler", "ref", "=", "\"", "loginEntryPoint", "\"", "/>", "<", "/", "http", ">", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "public", "void", "testGenerateCode", "(", ")", "throws", "Exception", "{", "assertNotNull", "(", "result", ")", ";", "assertNotNull", "(", "result", ".", "getCode", "(", "))", ";", "assertTrue", "(", "result", ".", "getCode", "(", ").", "trim", "(", ").", "length", "(", ")", ">", "0", ")", ";", "assertTrue", "(", "result", ".", "getCode", "(", ").", "trim", "(", ").", "length", "(", ")", "=", "=", "10", ")", ";", "assertEquals", "(", "expiresAt", ",", "result", ".", "getExpiresAt", "(", "))", ";", "@", "@", "-", "306", ",", "7", "+", "306", ",", "7", "@", "@", "public", "void", "acceptInvitePage_for_verifiedUser", "(", ")", "throws", "Exception", "{", "when", "(", "expiringCodeStore", ".", "retrieveCode", "(", "\"", "the_secret_code", "\"", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", "))", ",", "JsonUtils", ".", "writeValueAsString", "(", "codeData", ")", ",", "null", ")", ");", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "anyString", "(", "),", "anyObject", "(", "),", "eq", "(", "null", ")", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", "))", ",", "JsonUtils", ".", "writeValueAsString", "(", "codeData", ")", ",", "null", ")", ");", "when", "(", "invitationsService", ".", "acceptInvitation", "(", "anyString", "(", "),", "anyString", "(", "))", ").", "thenReturn", "(", "new", "InvitationsService", ".", "AcceptedInvitation", "(", "\"", "blah", ".", "test", ".", "com", "\"", ",", "new", "ScimUser", "(", "))", ");", "when", "(", "invitationsService", ".", "acceptInvitation", "(", "anyString", "(", "),", "eq", "(", "\"\"", "))", ").", "thenReturn", "(", "new", "InvitationsService", ".", "AcceptedInvitation", "(", "\"", "blah", ".", "test", ".", "com", "\"", ",", "new", "ScimUser", "(", "))", ");", "IdentityProvider", "provider", "=", "new", "IdentityProvider", "(", ");", "provider", ".", "setType", "(", "OriginKeys", ".", "UAA", ")", ";", "when", "(", "providerProvisioning", ".", "retrieveByOrigin", "(", "anyString", "(", "),", "anyString", "(", "))", ").", "thenReturn", "(", "provider", ")", ";", "@", "@", "-", "14", ",", "7", "+", "14", ",", "6", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Qualifier", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Bean", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Configuration", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Import", ";", "@", "@", "-", "32", ",", "7", "+", "31", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "DefaultServletHandlerConfigurer", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "EnableWebMvc", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "WebMvcConfigurerAdapter", ";", "import", "org", ".", "thymeleaf", ".", "spring4", ".", "SpringTemplateEngine", ";", "import", "java", ".", "sql", ".", "Timestamp", ";", "import", "java", ".", "util", ".", "HashMap", ";", "@", "@", "-", "48", ",", "6", "+", "46", ",", "7", "@", "@", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doThrow", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "never", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "OAuth2Utils", ".", "CLIENT_ID", ";", "@", "@", "-", "108", ",", "6", "+", "107", ",", "23", "@", "@", "public", "void", "acceptInvitationNoClientId", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "home", "\"", ",", "redirectLocation", ")", ";", "}", "@", "Test", "public", "void", "acceptInvitation_withoutPasswordUpdate", "(", ")", "throws", "Exception", "{", "ScimUser", "user", "=", "new", "ScimUser", "(", "\"", "user", "-", "id", "-", "001", "\"", ",", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "first", "\"", ",", "\"", "last", "\"", ");", "user", ".", "setOrigin", "(", "UAA", ")", ";", "when", "(", "scimUserProvisioning", ".", "retrieve", "(", "eq", "(", "\"", "user", "-", "id", "-", "001", "\"", "))", ").", "thenReturn", "(", "user", ")", ";", "when", "(", "scimUserProvisioning", ".", "verifyUser", "(", "anyString", "(", "),", "anyInt", "(", "))", ").", "thenReturn", "(", "user", ")", ";", "Map", "<", "String", ",", "String", ">", "userData", "=", "new", "HashMap", "<", ">(", ");", "userData", ".", "put", "(", "USER_ID", ",", "\"", "user", "-", "id", "-", "001", "\"", ");", "userData", ".", "put", "(", "EMAIL", ",", "\"", "user", "@", "example", ".", "com", "\"", ");", "when", "(", "expiringCodeStore", ".", "retrieveCode", "(", "anyString", "(", "))", ").", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", "))", ",", "JsonUtils", ".", "writeValueAsString", "(", "userData", ")", ",", "null", ")", ");", "emailInvitationsService", ".", "acceptInvitation", "(", "\"", "code", "\"", ",", "\"", "\")", ".", "getRedirectUri", "(", ");", "verify", "(", "scimUserProvisioning", ")", ".", "verifyUser", "(", "user", ".", "getId", "(", "),", "user", ".", "getVersion", "(", "))", ";", "verify", "(", "scimUserProvisioning", ",", "never", "(", "))", ".", "changePassword", "(", "anyString", "(", "),", "anyString", "(", "),", "anyString", "(", "))", ";", "}", "@", "Test", "public", "void", "acceptInvitationWithClientNotFound", "(", ")", "throws", "Exception", "{", "ScimUser", "user", "=", "new", "ScimUser", "(", "\"", "user", "-", "id", "-", "001", "\"", ",", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "first", "\"", ",", "\"", "last", "\"", ");", "@", "@", "-", "12", ",", "15", "+", "12", ",", "15", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "login", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCode", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCodeStore", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "InvalidCodeException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "ConflictException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "ForgotPasswordInfo", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "NotFoundException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "ResetPasswordService", ".", "ResetPasswordResponse", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "UaaResetPasswordService", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "event", ".", "ResetPasswordRequestEvent", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "InvalidCodeException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCode", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCodeStore", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimMeta", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "@", "@", "-", "93", ",", "18", "+", "93", ",", "24", "@", "@", "public", "void", "forgotPassword_ResetCodeIsReturnedSuccessfully", "(", ")", "throws", "Exception", "{", "when", "(", "scimUserProvisioning", ".", "query", "(", "contains", "(", "\"", "origin", "\"", "))", ").", "thenReturn", "(", "Arrays", ".", "asList", "(", "user", ")", ");", "Timestamp", "expiresAt", "=", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", "))", ";", "ArgumentCaptor", "<", "String", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "String", ".", "class", ")", ";", "when", "(", "codeStore", ".", "generateCode", "(", "eq", "(", "\"{", "\\\"", "user_id", "\\", "\":", "\\\"", "user", "-", "id", "-", "001", "\\", "\",", "\\\"", "username", "\\", "\":", "\\\"", "user", "@", "example", ".", "com", "\\", "\",", "\\\"", "passwordModifiedTime", "\\", "\":", "1234", ",", "\\\"", "client_id", "\\", "\":", "\\\"", "example", "\\", "\",", "\\\"", "redirect_uri", "\\", "\":", "\\\"", "redirect", ".", "example", ".", "com", "\\", "\"}", "\")", ",", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "expiresAt", ",", "\"", "user", "-", "id", "-", "001", "\"", ",", "null", ")", ");", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ").", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "expiresAt", ",", "\"", "user", "-", "id", "-", "001", "\"", ",", "null", ")", ");", "ForgotPasswordInfo", "forgotPasswordInfo", "=", "emailResetPasswordService", ".", "forgotPassword", "(", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "example", "\"", ",", "\"", "redirect", ".", "example", ".", "com", "\"", ");", "assertThat", "(", "forgotPasswordInfo", ".", "getUserId", "(", "),", "equalTo", "(", "\"", "user", "-", "id", "-", "001", "\"", "))", ";", "verify", "(", "codeStore", ")", ".", "expireByIntent", "(", "captor", ".", "capture", "(", "))", ";", "assertEquals", "(", "UaaResetPasswordService", ".", "FORGOT_PASSWORD_INTENT_PREFIX", "+", "user", ".", "getId", "(", "),", "captor", ".", "getValue", "(", "))", ";", "assertThat", "(", "forgotPasswordInfo", ".", "getUserId", "(", "),", "equalTo", "(", "\"", "user", "-", "id", "-", "001", "\"", "))", ";", "ExpiringCode", "resetPasswordCode", "=", "forgotPasswordInfo", ".", "getResetPasswordCode", "(", ");", "assertThat", "(", "resetPasswordCode", ".", "getCode", "(", "),", "equalTo", "(", "\"", "code", "\"", "))", ";", "assertThat", "(", "resetPasswordCode", ".", "getExpiresAt", "(", "),", "equalTo", "(", "expiresAt", ")", ");", "assertThat", "(", "resetPasswordCode", ".", "getData", "(", "),", "equalTo", "(", "\"", "user", "-", "id", "-", "001", "\"", "))", ";", "}", "@", "Test", "public", "void", "forgotPassword_PublishesResetPasswordRequestEvent", "(", ")", "throws", "Exception", "{", "ApplicationEventPublisher", "publisher", "=", "mock", "(", "ApplicationEventPublisher", ".", "class", ")", ";", "@", "@", "-", "115", ",", "13", "+", "121", ",", "13", "@", "@", "public", "void", "forgotPassword_PublishesResetPasswordRequestEvent", "(", ")", "throws", "Exception", "user", ".", "setPrimaryEmail", "(", "\"", "user", "@", "example", ".", "com", "\"", ");", "when", "(", "scimUserProvisioning", ".", "query", "(", "contains", "(", "\"", "origin", "\"", "))", ").", "thenReturn", "(", "Arrays", ".", "asList", "(", "user", ")", ");", "Timestamp", "expiresAt", "=", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", "))", ";", "when", "(", "codeStore", ".", "generateCode", "(", "anyString", "(", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "expiresAt", ",", "\"", "user", "-", "id", "-", "001", "\"", ",", "null", ")", ");", "when", "(", "codeStore", ".", "generateCode", "(", "anyString", "(", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ").", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "code", "\"", ",", "expiresAt", ",", "\"", "user", "-", "id", "-", "001", "\"", ",", "null", ")", ");", "emailResetPasswordService", ".", "forgotPassword", "(", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "\",", "\"", "\")", ";", "ArgumentCaptor", "<", "ResetPasswordRequestEvent", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "ResetPasswordRequestEvent", ".", "class", ")", ";", "verify", "(", "publisher", ")", ".", "publishEvent", "(", "captor", ".", "capture", "(", "))", ";", "ResetPasswordRequestEvent", "event", "=", "captor", ".", "getValue", "(", ");", "assertThat", "(", "(", "String", ")", "event", ".", "getSource", "(", "),", "equalTo", "(", "\"", "user", "@", "example", ".", "com", "\"", "))", ";", "assertThat", "(", "event", ".", "getSource", "(", "),", "equalTo", "(", "\"", "user", "@", "example", ".", "com", "\"", "))", ";", "assertThat", "(", "event", ".", "getCode", "(", "),", "equalTo", "(", "\"", "code", "\"", "))", ";", "assertThat", "(", "event", ".", "getAuthentication", "(", "),", "sameInstance", "(", "authentication", ")", ");", "}", "@", "@", "-", "185", ",", "7", "+", "191", ",", "7", "@", "@", "public", "void", "resetPassword_InvalidPasswordException_NewPasswordSameAsOld", "(", ")", "{", "user", ".", "setMeta", "(", "new", "ScimMeta", "(", "new", "Date", "(", "),", "new", "Date", "(", "),", "0", ")", ");", "user", ".", "setPrimaryEmail", "(", "\"", "foo", "@", "example", ".", "com", "\"", ");", "ExpiringCode", "expiringCode", "=", "new", "ExpiringCode", "(", "\"", "good_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "user", "-", "id", "\"", ",", "null", ")", ";", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "{\\", "\"", "user_id", "\\", "\":", "\\\"", "user", "-", "id", "\\", "\",", "\\\"", "username", "\\", "\":", "\\\"", "username", "\\", "\",", "\\\"", "passwordModifiedTime", "\\", "\":", "null", ",", "\\\"", "client_id", "\\", "\":", "\\\"", "\\\"", ",\\", "\"", "redirect_uri", "\\", "\":", "\\\"", "\\\"", "}\"", ",", "null", ")", ";", "when", "(", "codeStore", ".", "retrieveCode", "(", "\"", "good_code", "\"", "))", ".", "thenReturn", "(", "expiringCode", ")", ";", "when", "(", "scimUserProvisioning", ".", "retrieve", "(", "\"", "user", "-", "id", "\"", "))", ".", "thenReturn", "(", "user", ")", ";", "when", "(", "scimUserProvisioning", ".", "checkPasswordMatches", "(", "\"", "user", "-", "id", "\"", ",", "\"", "Passwo3dAsOld", "\"", "))", "@", "@", "-", "202", ",", "6", "+", "208", ",", "22", "@", "@", "public", "void", "resetPassword_InvalidPasswordException_NewPasswordSameAsOld", "(", ")", "{", "}", "}", "@", "Test", "public", "void", "resetPassword_InvalidCodeData", "(", ")", "{", "ExpiringCode", "expiringCode", "=", "new", "ExpiringCode", "(", "\"", "good_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "user", "-", "id", "\"", ",", "null", ")", ";", "when", "(", "codeStore", ".", "retrieveCode", "(", "\"", "good_code", "\"", "))", ".", "thenReturn", "(", "expiringCode", ")", ";", "SecurityContext", "securityContext", "=", "mock", "(", "SecurityContext", ".", "class", ")", ";", "when", "(", "securityContext", ".", "getAuthentication", "(", "))", ".", "thenReturn", "(", "new", "MockAuthentication", "(", "))", ";", "SecurityContextHolder", ".", "setContext", "(", "securityContext", ")", ";", "try", "{", "emailResetPasswordService", ".", "resetPassword", "(", "\"", "good_code", "\"", ",", "\"", "password", "\"", ");", "fail", "(", ");", "}", "catch", "(", "InvalidCodeException", "e", ")", "{", "assertEquals", "(", "\"", "Sorry", ",", "your", "reset", "password", "link", "is", "no", "longer", "valid", ".", "Please", "request", "a", "new", "one", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "}", "@", "Test", "public", "void", "resetPassword_WithInvalidClientId", "(", ")", "{", "setupResetPassword", "(", "\"", "invalid_client", "\"", ",", "\"", "redirect", ".", "example", ".", "com", "\"", ");", "@", "@", "-", "81", ",", "10", "+", "81", ",", "10", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "PasswordChange", "change", "=", "new", "PasswordChange", "(", "\"", "id001", "\"", ",", "\"", "user", "@", "example", ".", "com", "\"", ",", "yesterday", ",", "null", ",", "null", ")", ";", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "eq", "(", "\"", "id001", "\"", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", "))", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "eq", "(", "\"", "id001", "\"", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ")", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "id001", "\"", ",", "null", ")", ");", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", "))", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ")", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", ",", "null", ")", ");", "}", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "public", "void", "password_reset_with_client_id_and_redirect_uri", "(", ")", "throws", "Exception", "{", ".", "thenReturn", "(", "Arrays", ".", "asList", "(", "user", ")", ");", "PasswordChange", "change", "=", "new", "PasswordChange", "(", "\"", "id001", "\"", ",", "email", ",", "yesterday", ",", "clientId", ",", "redirectUri", ")", ";", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "anyString", "(", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", "))", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "anyString", "(", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ")", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", ",", "null", ")", ");", "MockHttpServletRequestBuilder", "post", "=", "post", "(", "\"/", "password_resets", "\"", ")", "@", "@", "-", "113", ",", "7", "+", "113", ",", "7", "@", "@", "public", "void", "password_reset_with_client_id_and_redirect_uri", "(", ")", "throws", "Exception", "{", "mockMvc", ".", "perform", "(", "post", ")", ".", "andExpect", "(", "status", "(", ").", "isCreated", "(", "))", ";", "verify", "(", "expiringCodeStore", ")", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", ");", "verify", "(", "expiringCodeStore", ")", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "137", ",", "7", "+", "137", ",", "7", "@", "@", "public", "void", "password_reset_without_client_id_and_without_redirect_uri", "(", ")", "throws", "E", "mockMvc", ".", "perform", "(", "post", ")", ".", "andExpect", "(", "status", "(", ").", "isCreated", "(", "))", ";", "verify", "(", "expiringCodeStore", ")", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", ");", "verify", "(", "expiringCodeStore", ")", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "206", ",", "7", "+", "206", ",", "7", "@", "@", "public", "void", "testCreatingAPasswordResetWithAUsernameContainingSpecialCharacters", "(", ")", ".", "thenReturn", "(", "Arrays", ".", "asList", "(", "user", ")", ");", "PasswordChange", "change", "=", "new", "PasswordChange", "(", "\"", "id001", "\"", ",", "\"", "user", "\\", "\"'", "@", "example", ".", "com", "\"", ",", "yesterday", ",", "null", ",", "null", ")", ";", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "eq", "(", "null", ")", "))", "when", "(", "expiringCodeStore", ".", "generateCode", "(", "eq", "(", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", "),", "any", "(", "Timestamp", ".", "class", ")", ",", "anyString", "(", "))", ")", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "JsonUtils", ".", "writeValueAsString", "(", "change", ")", ",", "null", ")", ");", "MockHttpServletRequestBuilder", "post", "=", "post", "(", "\"/", "password_resets", "\"", ")", "@", "@", "-", "237", ",", "7", "+", "237", ",", "8", "@", "@", "public", "void", "testCreatingAPasswordResetWithAUsernameContainingSpecialCharacters", "(", ")", "@", "Test", "public", "void", "testChangingAPasswordWithAValidCode", "(", ")", "throws", "Exception", "{", "when", "(", "expiringCodeStore", ".", "retrieveCode", "(", "\"", "secret_code", "\"", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "eyedee", "\"", ",", "null", ")", ");", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "{\\", "\"", "user_id", "\\", "\":", "\\\"", "eyedee", "\\", "\",", "\\\"", "username", "\\", "\":", "\\\"", "user", "@", "example", ".", "com", "\\", "\",", "\\\"", "passwordModifiedTime", "\\", "\":", "null", ",", "\\\"", "client_id", "\\", "\":", "\\\"", "\\\"", ",\\", "\"", "redirect_uri", "\\", "\":", "\\\"", "\\\"", "}\"", ",", "null", ")", ");", "ScimUser", "scimUser", "=", "new", "ScimUser", "(", "\"", "eyedee", "\"", ",", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "User", "\"", ",", "\"", "Man", "\"", ");", "scimUser", ".", "setMeta", "(", "new", "ScimMeta", "(", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "0", ")", ");", "@", "@", "-", "281", ",", "7", "+", "282", ",", "9", "@", "@", "public", "void", "changing_password_with_invalid_code", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testChangingAPasswordForUnverifiedUser", "(", ")", "throws", "Exception", "{", "when", "(", "expiringCodeStore", ".", "retrieveCode", "(", "\"", "secret_code", "\"", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "eyedee", "\"", ",", "null", ")", ");", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "secret_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "{\\", "\"", "user_id", "\\", "\":", "\\\"", "eyedee", "\\", "\",", "\\\"", "username", "\\", "\":", "\\\"", "user", "@", "example", ".", "com", "\\", "\",", "\\\"", "passwordModifiedTime", "\\", "\":", "null", ",", "\\\"", "client_id", "\\", "\":", "\\\"", "\\\"", ",\\", "\"", "redirect_uri", "\\", "\":", "\\\"", "\\\"", "}\"", ",", "null", ")", ");", "ScimUser", "scimUser", "=", "new", "ScimUser", "(", "\"", "eyedee", "\"", ",", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "User", "\"", ",", "\"", "Man", "\"", ");", "scimUser", ".", "setMeta", "(", "new", "ScimMeta", "(", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "0", ")", ");", "@", "@", "-", "338", ",", "7", "+", "341", ",", "9", "@", "@", "public", "void", "changePassword_Returns422UnprocessableEntity_NewPasswordSameAsOld", "(", ")", "Mockito", ".", "reset", "(", "passwordValidator", ")", ";", "when", "(", "expiringCodeStore", ".", "retrieveCode", "(", "\"", "emailed_code", "\"", "))", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "emailed_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "eyedee", "\"", ",", "null", ")", ");", ".", "thenReturn", "(", "new", "ExpiringCode", "(", "\"", "emailed_code", "\"", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "\"", "{\\", "\"", "user_id", "\\", "\":", "\\\"", "eyedee", "\\", "\",", "\\\"", "username", "\\", "\":", "\\\"", "user", "@", "example", ".", "com", "\\", "\",", "\\\"", "passwordModifiedTime", "\\", "\":", "null", ",", "\\\"", "client_id", "\\", "\":", "\\\"", "\\\"", ",\\", "\"", "redirect_uri", "\\", "\":", "\\\"", "\\\"", "}\"", ",", "null", ")", ");", "ScimUser", "scimUser", "=", "new", "ScimUser", "(", "\"", "eyedee", "\"", ",", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "User", "\"", ",", "\"", "Man", "\"", ");", "scimUser", ".", "setMeta", "(", "new", "ScimMeta", "(", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "0", ")", ");", "@", "@", "-", "26", ",", "7", "+", "26", ",", "7", "@", "@", "<", "http", "name", "=", "\"", "codeStoreSecurity", "\"", "pattern", "=", "\"/", "Codes", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "emptyAuthenticationManager", "\"", "entry", "-", "point", "-", "ref", "=", "\"", "oauthAuthenticationEntryPoint", "\"", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "security", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasAnyScope", "(", "'", "scim", ".", "create", "'", ",'", "scim", ".", "write", "'", ",'", "password", ".", "write", "'", ")\"", "/>", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasAnyScope", "(", "'", "oauth", ".", "login", "'", ")\"", "/>", "<", "custom", "-", "filter", "ref", "=", "\"", "resourceAgnosticAuthenticationFilter", "\"", "position", "=", "\"", "PRE_AUTH_FILTER", "\"", "/", ">", "<", "anonymous", "enabled", "=", "\"", "false", "\"", "/", ">", "<", "expression", "-", "handler", "ref", "=", "\"", "oauthWebExpressionHandler", "\"", "/", ">", "@", "@", "-", "249", ",", "7", "+", "249", ",", "7", "@", "@", "public", "void", "testFormEncodedAutologinRequest", "(", ")", "throws", "Exception", "{", "Map", ".", "class", ")", ";", "String", "autologinCode", "=", "(", "String", ")", "autologinResponseEntity", ".", "getBody", "(", ").", "get", "(", "\"", "code", "\"", ");", "assertEquals", "(", "6", ",", "autologinCode", ".", "length", "(", "))", ";", "assertEquals", "(", "10", ",", "autologinCode", ".", "length", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "90", ",", "6", "+", "90", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testChangePassword", "(", ")", "throws", "Exception", "{", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "change_password", "\"", ");", "signIn", "(", "userEmail", ",", "PASSWORD", ")", ";", "changePassword", "(", "PASSWORD", ",", "NEW_PASSWORD", ",", "\"", "new", "\"", ");", "@", "@", "-", "108", ",", "7", "+", "109", ",", "7", "@", "@", "public", "void", "displaysErrorWhenPasswordContravenesPolicy", "(", ")", "{", "/", "/", "the", "only", "policy", "we", "can", "contravene", "by", "default", "is", "the", "length", "String", "newPassword", "=", "new", "RandomValueStringGenerator", "(", "260", ")", ".", "generate", "(", ");", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "change_password", "\"", ");", "signIn", "(", "userEmail", ",", "PASSWORD", ")", ";", "changePassword", "(", "PASSWORD", ",", "newPassword", ",", "newPassword", ")", ";", "@", "@", "-", "134", ",", "11", "+", "135", ",", "8", "@", "@", "private", "void", "signOut", "(", ")", "{", "}", "private", "void", "signIn", "(", "String", "userName", ",", "String", "password", ")", "{", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "logout", ".", "do", "\"", ");", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "login", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "username", "\"", "))", ".", "sendKeys", "(", "userName", ")", ";", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "password", "\"", "))", ".", "sendKeys", "(", "password", ")", ";", "webDriver", ".", "findElement", "(", "By", ".", "xpath", "(", "\"/", "/", "input", "[", "@", "value", "=", "'", "Sign", "in", "'", "]\"", "))", ".", "click", "(", ");", "assertThat", "(", "webDriver", ".", "findElement", "(", "By", ".", "cssSelector", "(", "\"", "h1", "\"", "))", ".", "getText", "(", "),", "containsString", "(", "\"", "Where", "to", "?", "\")", ");", "}", "}", "@", "@", "-", "91", ",", "7", "+", "91", ",", "7", "@", "@", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "scimToken", "=", "testClient", ".", "getOAuthAccessToken", "(", "\"", "admin", "\"", ",", "\"", "adminsecret", "\"", ",", "\"", "client_credentials", "\"", ",", "\"", "scim", ".", "read", ",", "scim", ".", "write", "\"", ");", "loginToken", "=", "testClient", ".", "getOAuthAccessToken", "(", "\"", "login", "\"", ",", "\"", "loginsecret", "\"", ",", "\"", "client_credentials", "\"", ",", "\"", "password", ".", "write", ",", "scim", ".", "write", "\"", ");", "loginToken", "=", "testClient", ".", "getOAuthAccessToken", "(", "\"", "login", "\"", ",", "\"", "loginsecret", "\"", ",", "\"", "client_credentials", "\"", ",", "\"", "oauth", ".", "login", "\"", ");", "screenShootRule", ".", "setWebDriver", "(", "webDriver", ")", ";", "}", "@", "@", "-", "199", ",", "9", "+", "199", ",", "9", "@", "@", "private", "String", "createInvitation", "(", "String", "username", ",", "String", "userEmail", ",", "String", "redire", "return", "createInvitation", "(", "baseUrl", ",", "uaaUrl", ",", "username", ",", "userEmail", ",", "origin", ",", "redirectUri", ",", "loginToken", ",", "scimToken", ")", ";", "}", "public", "static", "String", "createInvitation", "(", "String", "baseUrl", ",", "String", "uaaUrl", ",", "String", "username", ",", "String", "userEmail", ",", "String", "origin", ",", "String", "redirectUri", ",", "String", "scimWriteToken", ",", "String", "scimReadToken", ")", "{", "public", "static", "String", "createInvitation", "(", "String", "baseUrl", ",", "String", "uaaUrl", ",", "String", "username", ",", "String", "userEmail", ",", "String", "origin", ",", "String", "redirectUri", ",", "String", "loginToken", ",", "String", "scimToken", ")", "{", "HttpHeaders", "headers", "=", "new", "HttpHeaders", "(", ");", "headers", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "scimWriteToken", ")", ";", "headers", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "scimToken", ")", ";", "RestTemplate", "uaaTemplate", "=", "new", "RestTemplate", "(", ");", "ScimUser", "scimUser", "=", "new", "ScimUser", "(", ");", "scimUser", ".", "setUserName", "(", "username", ")", ";", "@", "@", "-", "211", ",", "8", "+", "211", ",", "8", "@", "@", "public", "static", "String", "createInvitation", "(", "String", "baseUrl", ",", "String", "uaaUrl", ",", "String", "user", "String", "userId", "=", "null", ";", "try", "{", "userId", "=", "IntegrationTestUtils", ".", "getUserIdByField", "(", "scimReadToken", ",", "baseUrl", ",", "origin", ",", "\"", "email", "\"", ",", "userEmail", ")", ";", "scimUser", "=", "IntegrationTestUtils", ".", "getUser", "(", "scimReadToken", ",", "baseUrl", ",", "userId", ")", ";", "userId", "=", "IntegrationTestUtils", ".", "getUserIdByField", "(", "scimToken", ",", "baseUrl", ",", "origin", ",", "\"", "email", "\"", ",", "userEmail", ")", ";", "scimUser", "=", "IntegrationTestUtils", ".", "getUser", "(", "scimToken", ",", "baseUrl", ",", "userId", ")", ";", "}", "catch", "(", "RuntimeException", "x", ")", "{", "}", "if", "(", "userId", "=", "=", "null", ")", "{", "@", "@", "-", "224", ",", "12", "+", "224", ",", "15", "@", "@", "public", "static", "String", "createInvitation", "(", "String", "baseUrl", ",", "String", "uaaUrl", ",", "String", "user", "userId", "=", "response", ".", "getBody", "(", ").", "getId", "(", ");", "}", "else", "{", "scimUser", ".", "setVerified", "(", "false", ")", ";", "IntegrationTestUtils", ".", "updateUser", "(", "scimWriteToken", ",", "uaaUrl", ",", "scimUser", ")", ";", "IntegrationTestUtils", ".", "updateUser", "(", "scimToken", ",", "uaaUrl", ",", "scimUser", ")", ";", "}", "HttpHeaders", "invitationHeaders", "=", "new", "HttpHeaders", "(", ");", "invitationHeaders", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "loginToken", ")", ";", "Timestamp", "expiry", "=", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "TimeUnit", ".", "MILLISECONDS", ".", "convert", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "24", "*", "3600", ",", "TimeUnit", ".", "MILLISECONDS", ")", ");", "ExpiringCode", "expiringCode", "=", "new", "ExpiringCode", "(", "null", ",", "expiry", ",", "\"", "{\\", "\"", "origin", "\\", "\":", "\\\"", "\"", "+", "origin", "+", "\"", "\\\"", ",", "\\", "\"", "client_id", "\\", "\":", "\\\"", "app", "\\", "\",", "\\", "\"", "redirect_uri", "\\", "\":", "\\\"", "\"", "+", "redirectUri", "+", "\"", "\\\"", ",", "\\", "\"", "user_id", "\\", "\":", "\\\"", "\"", "+", "userId", "+", "\"", "\\\"", ",", "\\", "\"", "email", "\\", "\":", "\\\"", "\"", "+", "userEmail", "+", "\"", "\\\"", "}\"", ",", "null", ")", ";", "HttpEntity", "<", "ExpiringCode", ">", "expiringCodeRequest", "=", "new", "HttpEntity", "<", ">(", "expiringCode", ",", "headers", ")", ";", "HttpEntity", "<", "ExpiringCode", ">", "expiringCodeRequest", "=", "new", "HttpEntity", "<", ">(", "expiringCode", ",", "invitationHeaders", ")", ";", "ResponseEntity", "<", "ExpiringCode", ">", "expiringCodeResponse", "=", "uaaTemplate", ".", "exchange", "(", "uaaUrl", "+", "\"", "/", "Codes", "\"", ",", "HttpMethod", ".", "POST", ",", "expiringCodeRequest", ",", "ExpiringCode", ".", "class", ")", ";", "expiringCode", "=", "expiringCodeResponse", ".", "getBody", "(", ");", "return", "expiringCode", ".", "getCode", "(", ");", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "com", ".", "dumbster", ".", "smtp", ".", "SimpleSmtpServer", ";", "import", "com", ".", "dumbster", ".", "smtp", ".", "SmtpMessage", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "RandomStringUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "EmailAccountCreationService", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaPrincipal", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "JdbcExpiringCodeStore", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "@", "@", "-", "13", ",", "7", "+", "14", ",", "6", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "PredictableGenerator", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "jdbc", ".", "JdbcScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "EmailAccountCreationService", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "TestClient", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "UaaTestAccounts", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "JsonUtils", ";", "@", "@", "-", "99", ",", "6", "+", "99", ",", "12", "@", "@", "public", "void", "restoreMailSender", "(", ")", "{", "getWebApplicationContext", "(", ").", "getBean", "(", "\"", "emailService", "\"", ",", "EmailService", ".", "class", ")", ".", "setMailSender", "(", "originalSender", ")", ";", "}", "@", "After", "public", "void", "resetGenerator", "(", ")", "{", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcExpiringCodeStore", ".", "class", ")", ".", "setGenerator", "(", "new", "RandomValueStringGenerator", "(", "24", ")", ");", "}", "@", "AfterClass", "public", "static", "void", "stopMailServer", "(", ")", "throws", "Exception", "{", "if", "(", "mailServer", "!", "=", "null", ")", "{", "@", "@", "-", "142", ",", "6", "+", "142", ",", "11", "@", "@", "public", "void", "setUpContext", "(", ")", "throws", "Exception", "{", "identityZoneConfiguration", "=", "getWebApplicationContext", "(", ").", "getBean", "(", "IdentityZoneProvisioning", ".", "class", ")", ".", "retrieve", "(", "getUaa", "(", ").", "getId", "(", "))", ".", "getConfig", "(", ");", "}", "@", "After", "public", "void", "resetGenerator", "(", ")", "{", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcExpiringCodeStore", ".", "class", ")", ".", "setGenerator", "(", "new", "RandomValueStringGenerator", "(", "24", ")", ");", "}", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "/", "/", "restore", "all", "properties", "@", "@", "-", "12", ",", "6", "+", "12", ",", "7", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "login", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "UaaResetPasswordService", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaPrincipal", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCode", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "codestore", ".", "ExpiringCodeStore", ";", "@", "@", "-", "20", ",", "14", "+", "21", ",", "15", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "InjectedMockContextTest", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "PredictableGenerator", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ".", "UaaResetPasswordService", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "endpoints", ".", "PasswordChange", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "JsonUtils", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "http", ".", "MediaType", ";", "import", "org", ".", "springframework", ".", "jdbc", ".", "core", ".", "JdbcTemplate", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpSession", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "Authentication", ";", "@", "@", "-", "73", ",", "6", "+", "75", ",", "12", "@", "@", "public", "void", "initResetPasswordTest", "(", ")", "throws", "Exception", "{", "codeStore", "=", "getWebApplicationContext", "(", ").", "getBean", "(", "ExpiringCodeStore", ".", "class", ")", ";", "}", "@", "After", "public", "void", "resetGenerator", "(", ")", "{", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcExpiringCodeStore", ".", "class", ")", ".", "setGenerator", "(", "new", "RandomValueStringGenerator", "(", "24", ")", ");", "}", "@", "Test", "public", "void", "testResettingAPasswordUsingUsernameToEnsureNoModification", "(", ")", "throws", "Exception", "{", "@", "@", "-", "156", ",", "6", "+", "164", ",", "34", "@", "@", "public", "void", "testResettingAPasswordChangesCodeInForm", "(", ")", "throws", "Exception", "{", ".", "andExpect", "(", "redirectedUrl", "(", "\"", "home", "\"", "))", ";", "}", "@", "Test", "public", "void", "create_new_code_for_repeated_request", "(", ")", "throws", "Exception", "{", "String", "username", "=", "new", "RandomValueStringGenerator", "(", ").", "generate", "(", ")", "+", "\"", "@", "test", ".", "org", "\"", ";", "ScimUser", "user", "=", "new", "ScimUser", "(", "null", ",", "username", ",", "\"", "givenname", "\"", ",\"", "familyname", "\"", ");", "user", ".", "setPrimaryEmail", "(", "username", ")", ";", "user", ".", "setPassword", "(", "\"", "secret", "\"", ");", "String", "token", "=", "MockMvcUtils", ".", "utils", "(", ").", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "\"", "admin", "\"", ",", "\"", "adminsecret", "\"", ",", "null", ",", "null", ")", ";", "user", "=", "MockMvcUtils", ".", "utils", "(", ").", "createUser", "(", "getMockMvc", "(", "),", "token", ",", "user", ")", ";", "PredictableGenerator", "generator", "=", "new", "PredictableGenerator", "(", ");", "JdbcExpiringCodeStore", "store", "=", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcExpiringCodeStore", ".", "class", ")", ";", "store", ".", "setGenerator", "(", "generator", ")", ";", "JdbcTemplate", "template", "=", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcTemplate", ".", "class", ")", ";", "String", "intent", "=", "UaaResetPasswordService", ".", "FORGOT_PASSWORD_INTENT_PREFIX", "+", "user", ".", "getId", "(", ");", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "forgot_password", ".", "do", "\"", ")", ".", "param", "(", "\"", "email", "\"", ",", "user", ".", "getUserName", "(", "))", ")", ".", "andExpect", "(", "redirectedUrl", "(", "\"", "email_sent", "?", "code", "=", "reset_password", "\"", "))", ";", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "forgot_password", ".", "do", "\"", ")", ".", "param", "(", "\"", "email", "\"", ",", "user", ".", "getUserName", "(", "))", ")", ".", "andExpect", "(", "redirectedUrl", "(", "\"", "email_sent", "?", "code", "=", "reset_password", "\"", "))", ";", "assertEquals", "(", "1", ",", "(", "int", ")", "template", ".", "queryForObject", "(", "\"", "select", "count", "(", "*)", "from", "expiring_code_store", "where", "intent", "=", "?\"", ",", "new", "Object", "[", "]", "{", "intent", "}", ",", "Integer", ".", "class", ")", ");", "}", "@", "Test", "public", "void", "redirectToSavedRequest_ifPresent", "(", ")", "throws", "Exception", "{", "String", "username", "=", "new", "RandomValueStringGenerator", "(", ").", "generate", "(", ")", "+", "\"", "@", "test", ".", "org", "\"", ";", "@", "@", "-", "239", ",", "7", "+", "275", ",", "8", "@", "@", "public", "void", "testResettingAPasswordUsingTimestampForUserModification", "(", ")", "throws", "Exc", "List", "<", "ScimUser", ">", "users", "=", "getWebApplicationContext", "(", ").", "getBean", "(", "ScimUserProvisioning", ".", "class", ")", ".", "query", "(", "\"", "username", "eq", "\\", "\"", "marissa", "\\", "\"\"", ");", "assertNotNull", "(", "users", ")", ";", "assertEquals", "(", "1", ",", "users", ".", "size", "(", "))", ";", "ExpiringCode", "code", "=", "codeStore", ".", "generateCode", "(", "users", ".", "get", "(", "0", ")", ".", "getId", "(", "),", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "PasswordChange", "passwordChange", "=", "new", "PasswordChange", "(", "users", ".", "get", "(", "0", ")", ".", "getId", "(", "),", "users", ".", "get", "(", "0", ")", ".", "getUserName", "(", "),", "null", ",", "null", ",", "null", ")", ";", "ExpiringCode", "code", "=", "codeStore", ".", "generateCode", "(", "JsonUtils", ".", "writeValueAsString", "(", "passwordChange", ")", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "MockHttpServletRequestBuilder", "post", "=", "createChangePasswordRequest", "(", "users", ".", "get", "(", "0", ")", ",", "code", ",", "true", ",", "\"", "newpassw0rD", "\"", ",", "\"", "newpassw0rD", "\"", ");", "@", "@", "-", "266", ",", "11", "+", "303", ",", "11", "@", "@", "public", "void", "resetPassword_ReturnsUnprocessableEntity_NewPasswordSameAsOld", "(", ")", "thro", "assertNotNull", "(", "users", ")", ";", "assertEquals", "(", "1", ",", "users", ".", "size", "(", "))", ";", "ScimUser", "user", "=", "users", ".", "get", "(", "0", ")", ";", "ExpiringCode", "code", "=", "codeStore", ".", "generateCode", "(", "user", ".", "getId", "(", "),", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "PasswordChange", "passwordChange", "=", "new", "PasswordChange", "(", "user", ".", "getId", "(", "),", "user", ".", "getUserName", "(", "),", "null", ",", "null", ",", "null", ")", ";", "ExpiringCode", "code", "=", "codeStore", ".", "generateCode", "(", "JsonUtils", ".", "writeValueAsString", "(", "passwordChange", ")", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "getMockMvc", "(", ").", "perform", "(", "createChangePasswordRequest", "(", "user", ",", "code", ",", "true", ",", "\"", "d3faultPasswd", "\"", ",", "\"", "d3faultPasswd", "\"", "))", ";", "code", "=", "codeStore", ".", "generateCode", "(", "user", ".", "getId", "(", "),", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "code", "=", "codeStore", ".", "generateCode", "(", "JsonUtils", ".", "writeValueAsString", "(", "passwordChange", ")", ",", "new", "Timestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "UaaResetPasswordService", ".", "PASSWORD_RESET_LIFETIME", ")", ",", "null", ")", ";", "getMockMvc", "(", ").", "perform", "(", "createChangePasswordRequest", "(", "user", ",", "code", ",", "true", ",", "\"", "d3faultPasswd", "\"", ",", "\"", "d3faultPasswd", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isUnprocessableEntity", "(", "))", ".", "andExpect", "(", "view", "(", ").", "name", "(", "\"", "forgot_password", "\"", "))", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "testClient", "=", "new", "TestClient", "(", "getMockMvc", "(", "))", ";", "loginToken", "=", "testClient", ".", "getClientCredentialsOAuthAccessToken", "(", "\"", "login", "\"", ",", "\"", "loginsecret", "\"", ",", "null", ")", ";", "loginToken", "=", "testClient", ".", "getClientCredentialsOAuthAccessToken", "(", "\"", "login", "\"", ",", "\"", "loginsecret", "\"", ",", "\"", "oauth", ".", "login", "\"", ");", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcTemplate", ".", "class", ")", ".", "update", "(", "\"", "DELETE", "FROM", "expiring_code_store", "\"", ");", "}", "@", "@", "-", "351", ",", "8", "+", "351", ",", "14", "@", "@", "public", "void", "changeEmailControllerVerifyEmailNotAllowed", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "changePasswordControllerChangePasswordPageNotAllowed", "(", ")", "throws", "Exception", "{", "MockMvcUtils", ".", "setDisableInternalUserManagement", "(", "false", ",", "getWebApplicationContext", "(", "))", ";", "ResultActions", "result", "=", "createUser", "(", ");", "ScimUser", "createdUser", "=", "JsonUtils", ".", "readValue", "(", "result", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", "),", "ScimUser", ".", "class", ")", ";", "MockMvcUtils", ".", "setDisableInternalUserManagement", "(", "true", ",", "getWebApplicationContext", "(", "))", ";", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "change_password", "\"", "))", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "change_password", "\"", ")", ".", "session", "(", "getUserSession", "(", "createdUser", ".", "getUserName", "(", "),", "PASSWD", ")", "))", ".", "andExpect", "(", "status", "(", ").", "isForbidden", "(", "))", ".", "andExpect", "(", "content", "(", ")", ".", "string", "(", "JsonObjectMatcherUtils", ".", "matchesJsonObject", "(", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "TestClient", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "JsonUtils", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "OAuth2Utils", ";", "@", "@", "-", "53", ",", "6", "+", "54", ",", "7", "@", "@", "private", "String", "loginToken", ";", "private", "ScimUser", "user", ";", "private", "RandomValueStringGenerator", "originalGenerator", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "@", "@", "-", "65", ",", "6", "+", "67", ",", "11", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "user", "=", "MockMvcUtils", ".", "utils", "(", ").", "createUser", "(", "getMockMvc", "(", "),", "adminToken", ",", "user", ")", ";", "}", "@", "After", "public", "void", "resetGenerator", "(", ")", "{", "getWebApplicationContext", "(", ").", "getBean", "(", "JdbcExpiringCodeStore", ".", "class", ")", ".", "setGenerator", "(", "new", "RandomValueStringGenerator", "(", "24", ")", ");", "}", "@", "Test", "public", "void", "changePassword_isSuccessful", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["determine", "and", "reset", "the", "password"]}
{"contents": ["ping:", "implement", "proper", "locking", "We", "got", "a", "report", "of", "yet", "another", "bug", "in", "ping", "http://www.openwall.com/lists/oss-security/2017/03/24/6", "->disconnect()", "is", "not", "called", "with", "socket", "lock", "held.", "Fix", "this", "by", "acquiring", "ping", "rwlock", "earlier.", "Thanks", "to", "Daniel,", "Alexander", "and", "Andrey", "for", "letting", "us", "know", "this", "problem.", "Fixes:", "c319b4d76b9e", "(\"net:", "ipv4:", "add", "IPPROTO_ICMP", "socket", "kind\")", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Reported-by:", "Daniel", "Jiang", "<danieljiang0415@gmail.com>", "Reported-by:", "Solar", "Designer", "<solar@openwall.com>", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "156", ",", "17", "+", "156", ",", "18", "@", "@", "int", "ping_hash", "(", "struct", "sock", "*", "sk", ")", "void", "ping_unhash", "(", "struct", "sock", "*", "sk", ")", "{", "struct", "inet_sock", "*", "isk", "=", "inet_sk", "(", "sk", ")", ";", "pr_debug", "(", "\"", "ping_unhash", "(", "isk", "=", "%", "p", ",", "isk", "-", ">", "num", "=", "%", "u", ")", "\\", "n", "\"", ",", "isk", ",", "isk", "-", ">", "inet_num", ")", ";", "write_lock_bh", "(", "&", "ping_table", ".", "lock", ")", ";", "if", "(", "sk_hashed", "(", "sk", ")", ")", "{", "write_lock_bh", "(", "&", "ping_table", ".", "lock", ")", ";", "hlist_nulls_del", "(", "&", "sk", "-", ">", "sk_nulls_node", ")", ";", "sk_nulls_node_init", "(", "&", "sk", "-", ">", "sk_nulls_node", ")", ";", "sock_put", "(", "sk", ")", ";", "isk", "-", ">", "inet_num", "=", "0", ";", "isk", "-", ">", "inet_sport", "=", "0", ";", "sock_prot_inuse_add", "(", "sock_net", "(", "sk", ")", ",", "sk", "-", ">", "sk_prot", ",", "-", "1", ")", ";", "write_unlock_bh", "(", "&", "ping_table", ".", "lock", ")", ";", "}", "write_unlock_bh", "(", "&", "ping_table", ".", "lock", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "ping_unhash", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["Avoid", "XSS", "vulnerability", "by", "being", "stricter", "about", "how", "the", "script", "element", "is", "created.", "Change-Id:", "I186915ac978fe02fd0bbb93ae8c9a9dd6d8e9d5b", "Review-Link:", "https://gwt-review.googlesource.com/#/c/1250/", "git-svn-id:", "https://google-web-toolkit.googlecode.com/svn/trunk@11385", "8db76d5a-ed1c-0410-87a9-c151d255dfc7"], "code_tokens": ["@", "@", "-", "47", ",", "12", "+", "47", ",", "12", "@", "@", "}", "function", "loadSelectionScript", "(", ")", "{", "var", "moduleName", "=", "document", ".", "location", ".", "href", ";", "var", "moduleName", "=", "location", ".", "pathname", ";", "var", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "0", ",", "pos", ")", ";", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "pos", "+", "1", ")", ";", "document", ".", "write", "(", "\"<", "script", "language", "=", "'", "javascript", "'", "src", "=", "'\"", "+", "moduleName", "+", "\"", ".", "nocache", ".", "js", "'", "><", "\\/", "script", ">", "\")", ";", "document", ".", "write", "(", "'<", "script", "language", "=", "\"", "javascript", "\"", "src", "=", "\"'", "+", "encodeURIComponent", "(", "moduleName", ")", "+", "'", ".", "nocache", ".", "js", "\"", "><", "\\/", "script", ">", "')", ";", "}", "loadSelectionScript", "(", ");", "-", "->", "@", "@", "-", "45", ",", "12", "+", "45", ",", "12", "@", "@", "}", "function", "loadSelectionScript", "(", ")", "{", "var", "moduleName", "=", "document", ".", "location", ".", "href", ";", "var", "moduleName", "=", "location", ".", "pathname", ";", "var", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "0", ",", "pos", ")", ";", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "pos", "+", "1", ")", ";", "document", ".", "write", "(", "\"<", "script", "language", "=", "'", "javascript", "'", "src", "=", "'\"", "+", "moduleName", "+", "\"", ".", "nocache", ".", "js", "'", "><", "/", "script", ">", "\")", ";", "document", ".", "write", "(", "'<", "script", "language", "=", "\"", "javascript", "\"", "src", "=", "\"'", "+", "encodeURIComponent", "(", "moduleName", ")", "+", "'", ".", "nocache", ".", "js", "\"", "><", "\\/", "script", ">", "')", ";", "}", "loadSelectionScript", "(", ");", "-", "->", "@", "@", "-", "53", ",", "12", "+", "53", ",", "12", "@", "@", "}", "function", "loadSelectionScript", "(", ")", "{", "var", "moduleName", "=", "document", ".", "location", ".", "href", ";", "var", "moduleName", "=", "location", ".", "pathname", ";", "var", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "0", ",", "pos", ")", ";", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "pos", "+", "1", ")", ";", "document", ".", "write", "(", "\"<", "script", "language", "=", "'", "javascript", "'", "src", "=", "'\"", "+", "moduleName", "+", "\"", ".", "nocache", ".", "js", "'", "><", "\\/", "script", ">", "\")", ";", "document", ".", "write", "(", "'<", "script", "language", "=", "\"", "javascript", "\"", "src", "=", "\"'", "+", "encodeURIComponent", "(", "moduleName", ")", "+", "'", ".", "nocache", ".", "js", "\"", "><", "\\/", "script", ">", "')", ";", "}", "loadSelectionScript", "(", ");", "-", "->", "@", "@", "-", "52", ",", "12", "+", "52", ",", "12", "@", "@", "}", "function", "loadSelectionScript", "(", ")", "{", "var", "moduleName", "=", "document", ".", "location", ".", "href", ";", "var", "moduleName", "=", "location", ".", "pathname", ";", "var", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "0", ",", "pos", ")", ";", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "pos", "+", "1", ")", ";", "document", ".", "write", "(", "\"<", "script", "language", "=", "'", "javascript", "'", "src", "=", "'\"", "+", "moduleName", "+", "\"", ".", "nocache", ".", "js", "'", "><", "/", "script", ">", "\")", ";", "document", ".", "write", "(", "'<", "script", "language", "=", "\"", "javascript", "\"", "src", "=", "\"'", "+", "encodeURIComponent", "(", "moduleName", ")", "+", "'", ".", "nocache", ".", "js", "\"", "><", "\\/", "script", ">", "')", ";", "}", "loadSelectionScript", "(", ");", "-", "->", "@", "@", "-", "53", ",", "12", "+", "53", ",", "12", "@", "@", "}", "function", "loadSelectionScript", "(", ")", "{", "var", "moduleName", "=", "document", ".", "location", ".", "href", ";", "var", "moduleName", "=", "location", ".", "pathname", ";", "var", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "0", ",", "pos", ")", ";", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "pos", "+", "1", ")", ";", "document", ".", "write", "(", "\"<", "script", "language", "=", "'", "javascript", "'", "src", "=", "'\"", "+", "moduleName", "+", "\"", ".", "nocache", ".", "js", "'", "><", "\\/", "script", ">", "\")", ";", "document", ".", "write", "(", "'<", "script", "language", "=", "\"", "javascript", "\"", "src", "=", "\"'", "+", "encodeURIComponent", "(", "moduleName", ")", "+", "'", ".", "nocache", ".", "js", "\"", "><", "\\/", "script", ">", "')", ";", "}", "loadSelectionScript", "(", ");", "-", "->", "@", "@", "-", "52", ",", "12", "+", "52", ",", "12", "@", "@", "}", "function", "loadSelectionScript", "(", ")", "{", "var", "moduleName", "=", "document", ".", "location", ".", "href", ";", "var", "moduleName", "=", "location", ".", "pathname", ";", "var", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "0", ",", "pos", ")", ";", "pos", "=", "moduleName", ".", "lastIndexOf", "(", "'/", "')", ";", "moduleName", "=", "moduleName", ".", "substr", "(", "pos", "+", "1", ")", ";", "document", ".", "write", "(", "\"<", "script", "language", "=", "'", "javascript", "'", "src", "=", "'\"", "+", "moduleName", "+", "\"", ".", "nocache", ".", "js", "'", "><", "/", "script", ">", "\")", ";", "document", ".", "write", "(", "'<", "script", "language", "=", "\"", "javascript", "\"", "src", "=", "\"'", "+", "encodeURIComponent", "(", "moduleName", ")", "+", "'", ".", "nocache", ".", "js", "\"", "><", "\\/", "script", ">", "')", ";", "}", "loadSelectionScript", "(", ");", "-", "->"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["WW-2414", "-", "followup", "on", "earlier", "commit", "--", "recursively", "replace", "<<<<<script>>>>>", "until", "completely", "sanitized", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/trunk@615103", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "176", ",", "10", "+", "176", ",", "9", "@", "@", "else", "if", "(", "(", "scheme", "!", "=", "null", ")", "&", "&", "!", "scheme", ".", "equals", "(", "request", ".", "getScheme", "(", "))", ")", "{", "String", "result", "=", "link", ".", "toString", "(", ");", "if", "(", "result", ".", "indexOf", "(", "\"<", "script", ">", "\")", ">", "=", "0", ")", "{", "while", "(", "result", ".", "indexOf", "(", "\"<", "script", ">", "\")", ">", "0", ")", "{", "result", "=", "result", ".", "replaceAll", "(", "\"<", "script", ">", "\",", "\"", "script", "\"", ");", "}", "}", "try", "{", "result", "=", "encodeResult", "?", "response", ".", "encodeURL", "(", "result", ")", ":", "result", ";", "}", "catch", "(", "Exception", "ex", ")", "{"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["https://issues.apache.org/activemq/browse/AMQ-2613", "-", "prevent", "CSRF", "attacks", "git-svn-id:", "https://svn.apache.org/repos/asf/activemq/trunk@915384", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "39", ",", "4", "+", "39", ",", "10", "@", "@", "public", "ModelAndView", "handleRequest", "(", "HttpServletRequest", "request", ",", "HttpServletRespons", "return", "redirectToBrowseView", "(", ");", "}", "public", "String", "[", "]", "getSupportedHttpMethods", "(", ")", "{", "return", "new", "String", "[", "]{", "\"", "POST", "\"", "};", "}", "}", "@", "@", "-", "50", ",", "5", "+", "50", ",", "9", "@", "@", "public", "ModelAndView", "handleRequest", "(", "HttpServletRequest", "request", ",", "HttpServletRespons", "getBrokerAdmin", "(", ").", "createDurableSubscriber", "(", "getClientId", "(", "),", "getSubscriberName", "(", "),", "getValidDestination", "(", "),", "selector", ")", ";", "return", "new", "ModelAndView", "(", "\"", "redirect", ":", "subscribers", ".", "jsp", "\"", ");", "}", "public", "String", "[", "]", "getSupportedHttpMethods", "(", ")", "{", "return", "new", "String", "[", "]{", "\"", "POST", "\"", "};", "}", "}", "@", "@", "-", "230", ",", "4", "+", "230", ",", "8", "@", "@", "protected", "boolean", "isValidPropertyName", "(", "String", "name", ")", "{", "/", "/", "allow", "JMSX", "extensions", "or", "non", "JMS", "properties", "return", "name", ".", "startsWith", "(", "\"", "JMSX", "\"", ")", "|", "|", "!", "name", ".", "startsWith", "(", "\"", "JMS", "\"", ");", "}", "public", "String", "[", "]", "getSupportedHttpMethods", "(", ")", "{", "return", "new", "String", "[", "]{", "\"", "POST", "\"", "};", "}", "}", "@", "@", "-", "16", ",", "8", "+", "16", ",", "12", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "activemq", ".", "web", ".", "handler", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "apache", ".", "activemq", ".", "web", ".", "DestinationFacade", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "ServletRequestDataBinder", ";", "@", "@", "-", "41", ",", "8", "+", "45", ",", "21", "@", "@", "protected", "Object", "getHandlerInternal", "(", "HttpServletRequest", "request", ")", "throws", "Exception", "HandlerExecutionChain", "handlerExecutionChain", "=", "(", "HandlerExecutionChain", ")", "object", ";", "object", "=", "handlerExecutionChain", ".", "getHandler", "(", ");", "}", "if", "(", "object", "!", "=", "null", ")", "{", "/", "/", "prevent", "CSRF", "attacks", "if", "(", "object", "instanceof", "DestinationFacade", ")", "{", "/", "/", "check", "supported", "methods", "if", "(", "!", "Arrays", ".", "asList", "(", "((", "DestinationFacade", ")", "object", ")", ".", "getSupportedHttpMethods", "(", "))", ".", "contains", "(", "request", ".", "getMethod", "(", "))", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "Unsupported", "method", "\"", "+", "request", ".", "getMethod", "(", ")", "+", "\"", "for", "path", "\"", "+", "request", ".", "getRequestURI", "(", "))", ";", "}", "/", "/", "check", "the", "'", "secret", "'", "if", "(", "!", "request", ".", "getSession", "(", ").", "getAttribute", "(", "\"", "secret", "\"", ").", "equals", "(", "request", ".", "getParameter", "(", "\"", "secret", "\"", "))", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "Possible", "CSRF", "attack", "\"", ");", "}", "}", "ServletRequestDataBinder", "binder", "=", "new", "ServletRequestDataBinder", "(", "object", ",", "\"", "request", "\"", ");", "try", "{", "binder", ".", "bind", "(", "request", ")", ";", "@", "@", "-", "56", ",", "6", "+", "73", ",", "7", "@", "@", "protected", "Object", "getHandlerInternal", "(", "HttpServletRequest", "request", ")", "throws", "Exception", "throw", "e", ";", "}", "}", "return", "object", ";", "}", "}", "@", "@", "-", "50", ",", "7", "+", "50", ",", "7", "@", "@", "<", "filter", "-", "mapping", ">", "<", "filter", "-", "name", ">", "spring", "<", "/", "filter", "-", "name", ">", "<", "url", "-", "pattern", ">", "/*", "</", "url", "-", "pattern", ">", "<", "url", "-", "pattern", ">", "*.", "jsp", "<", "/", "url", "-", "pattern", ">", "<", "/", "filter", "-", "mapping", ">", "<", "!-", "-", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "-", "->", "@", "@", "-", "101", ",", "7", "+", "101", ",", "7", "@", "@", "<", "filter", "-", "mapping", ">", "<", "filter", "-", "name", ">", "session", "<", "/", "filter", "-", "name", ">", "<", "url", "-", "pattern", ">", "/*", "</", "url", "-", "pattern", ">", "<", "url", "-", "pattern", ">", "*.", "jsp", "<", "/", "url", "-", "pattern", ">", "<", "/", "filter", "-", "mapping", ">", "<", "filter", "-", "mapping", ">", "<", "filter", "-", "name", ">", "spring", "-", "rq", "<", "/", "filter", "-", "name", ">", "@", "@", "-", "49", ",", "7", "+", "49", ",", "7", "@", "@", "<", "td", ">", "<", "jms", ":", "formatTimestamp", "timestamp", "=", "\"$", "{", "row", ".", "JMSTimestamp", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "${", "row", ".", "JMSType", "}", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "deleteMessage", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "\">", "Delete", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteMessage", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "jms", ":", "forEachMessage", ">", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "<", "td", ">", "${", "row", ".", "JMSTimestamp", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "JMSType", "}", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "deleteDestination", ".", "action", "?", "destination", "=", "${", "row", ".", "JMSMessageID", "}", "\">", "Delete", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteDestination", ".", "action", "?", "destination", "=", "${", "row", ".", "JMSMessageID", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "jms", ":", "forEachMessage", ">", "@", "@", "-", "130", ",", "10", "+", "130", ",", "10", "@", "@", "No", "message", "could", "be", "found", "for", "ID", "$", "{", "requestContext", ".", "messageQuery", ".", "id", "}", "<", "/", "thead", ">", "<", "tbody", ">", "<", "tr", ">", "<", "td", "colspan", "=", "\"", "2", "\"", "><", "a", "href", "=", "\"", "deleteMessage", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"", "/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "\">", "Delete", "<", "/", "a", ">", "</", "td", ">", "<", "td", "colspan", "=", "\"", "2", "\"", "><", "a", "href", "=", "\"", "deleteMessage", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"", "/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", "class", "=", "\"", "odd", "\"", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javascript", ":", "confirmAction", "(", "'", "queue", "'", ",", "'", "copyMessage", ".", "action", "?", "destination", "=", "%", "target", "%", "&", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"", "/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "&", "JMSDestinationType", "=", "queue", "'", ")\"", ">", "Copy", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javascript", ":", "confirmAction", "(", "'", "queue", "'", ",", "'", "copyMessage", ".", "action", "?", "destination", "=", "%", "target", "%", "&", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"", "/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "&", "JMSDestinationType", "=", "queue", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">'", ")\"", ">", "Copy", "<", "/", "a", ">", "</", "td", ">", "<", "td", "rowspan", "=", "\"", "2", "\"", ">", "<", "select", "id", "=", "\"", "queue", "\"", ">", "<", "option", "value", "=", "\"\"", ">", "-", "-", "Please", "select", "-", "-<", "/", "option", ">", "@", "@", "-", "147", ",", "7", "+", "147", ",", "7", "@", "@", "No", "message", "could", "be", "found", "for", "ID", "$", "{", "requestContext", ".", "messageQuery", ".", "id", "}", "<", "/", "tr", ">", "<", "tr", "class", "=", "\"", "odd", "\"", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javascript", ":", "confirmAction", "(", "'", "queue", "'", ",", "'", "moveMessage", ".", "action", "?", "destination", "=", "%", "target", "%", "&", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"", "/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "&", "JMSDestinationType", "=", "queue", "'", ")\"", ">", "Move", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javascript", ":", "confirmAction", "(", "'", "queue", "'", ",", "'", "moveMessage", ".", "action", "?", "destination", "=", "%", "target", "%", "&", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "JMSDestination", "}", "\"", "/", ">&", "messageId", "=", "${", "row", ".", "JMSMessageID", "}", "&", "JMSDestinationType", "=", "queue", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">'", ")\"", ">", "Move", "<", "/", "a", ">", "</", "td", ">", "<", "/", "tr", ">", "<", "/", "tbody", ">", "<", "/", "table", ">", "@", "@", "-", "21", ",", "8", "+", "21", ",", "9", "@", "@", "<", "body", ">", "<", "div", ">", "<", "form", "action", "=", "\"", "createDestination", ".", "action", "\"", "method", "=", "\"", "get", "\"", ">", "<", "form", "action", "=", "\"", "createDestination", ".", "action", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "JMSDestinationType", "\"", "value", "=", "\"", "queue", "\"", "/>", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "secret", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", "/>", "<", "label", "name", "=", "\"", "destination", "\"", ">", "Queue", "Name", "<", "/", "label", ">", "<", "input", "type", "=", "\"", "text", "\"", "name", "=", "\"", "JMSDestination", "\"", "value", "=", "\"\"", "/>", "@", "@", "-", "63", ",", "8", "+", "64", ",", "8", "@", "@", "<", "/", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "send", ".", "jsp", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "queue", "\"", ">", "Send", "To", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "purgeDestination", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "queue", "\"", ">", "Purge", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteDestination", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "queue", "\"", ">", "Delete", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "purgeDestination", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "queue", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Purge", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteDestination", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "queue", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "c", ":", "forEach", ">", "@", "@", "-", "45", ",", "7", "+", "45", ",", "7", "@", "@", "<", "td", ">", "${", "row", ".", "period", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "repeat", "}", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "deleteJob", ".", "action", "?", "jobId", "=", "${", "row", ".", "jobId", "}", "\">", "Delete", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteJob", ".", "action", "?", "jobId", "=", "${", "row", ".", "jobId", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "c", ":", "forEach", ">", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "<", "h2", ">", "Send", "a", "JMS", "Message", "<", "/", "h2", ">", "<", "form", "action", "=", "\"", "sendMessage", ".", "action", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "secret", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", "/>", "<", "table", "id", "=", "\"", "headers", "\"", "class", "=", "\"", "autostripe", "\"", ">", "<", "thead", ">", "@", "@", "-", "20", ",", "8", "+", "20", ",", "9", "@", "@", "<", "/", "head", ">", "<", "body", ">", "<", "form", "action", "=", "\"", "createSubscriber", ".", "action", "\"", "method", "=", "\"", "get", "\"", ">", "<", "form", "action", "=", "\"", "createSubscriber", ".", "action", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "JMSDestinationType", "\"", "value", "=", "\"", "topic", "\"", "/>", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "secret", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", "/>", "<", "table", "id", "=", "\"", "createSubscribers", "\"", "class", "=", "\"", "sortable", "autostripe", "\"", ">", "<", "thead", ">", "@", "@", "-", "102", ",", "7", "+", "103", ",", "7", "@", "@", "<", "td", ">", "${", "row", ".", "enqueueCounter", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "dequeueCounter", "}", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "deleteSubscriber", ".", "action", "?", "clientId", "=", "${", "row", ".", "clientId", "}", "&", "subscriberName", "=", "${", "row", ".", "subscriptionName", "}", "\">", "Delete", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteSubscriber", ".", "action", "?", "clientId", "=", "${", "row", ".", "clientId", "}", "&", "subscriberName", "=", "${", "row", ".", "subscriptionName", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "c", ":", "forEach", ">", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "<", "div", ">", "<", "form", "action", "=", "\"", "createDestination", ".", "action", "\"", "method", "=", "\"", "get", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "JMSDestinationType", "\"", "value", "=", "\"", "topic", "\"", "/>", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "secret", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", "/>", "<", "label", "name", "=", "\"", "destination", "\"", ">", "Topic", "Name", "<", "/", "label", ">", "<", "input", "type", "=", "\"", "text", "\"", "name", "=", "\"", "JMSDestination", "\"", "value", "=", "\"\"", "/>", "@", "@", "-", "52", ",", "7", "+", "53", ",", "7", "@", "@", "<", "td", ">", "${", "row", ".", "dequeueCount", "}", "</", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "send", ".", "jsp", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "topic", "\"", ">", "Send", "To", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteDestination", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "topic", "\"", ">", "Delete", "<", "/", "a", ">", "<", "a", "href", "=", "\"", "deleteDestination", ".", "action", "?", "JMSDestination", "=", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "name", "}", "\"", "/", ">&", "JMSDestinationType", "=", "topic", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "c", ":", "forEach", ">", "@", "@", "-", "128", ",", "4", "+", "128", ",", "8", "@", "@", "protected", "ModelAndView", "redirectToBrowseView", "(", ")", "{", "protected", "String", "getPhysicalDestinationName", "(", ")", "{", "return", "createDestination", "(", ").", "getPhysicalName", "(", ");", "}", "public", "String", "[", "]", "getSupportedHttpMethods", "(", ")", "{", "return", "new", "String", "[", "]{", "\"", "GET", "\"", ",", "\"", "POST", "\"", "};", "}", "}", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "activemq", ".", "web", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "@", "@", "-", "39", ",", "7", "+", "40", ",", "8", "@", "@", "public", "void", "init", "(", "FilterConfig", "filterConfig", ")", "throws", "ServletException", "{", "}", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterChain", "chain", ")", "throws", "IOException", ",", "ServletException", "{", "(", "(", "HttpServletRequest", ")", "request", ")", ".", "getSession", "(", "true", ")", ";", "/", "/", "set", "secret", "to", "prevent", "CSRF", "attacks", "(", "(", "HttpServletRequest", ")", "request", ")", ".", "getSession", "(", "true", ")", ".", "setAttribute", "(", "\"", "secret", "\"", ",", "UUID", ".", "randomUUID", "(", ").", "toString", "(", "))", ";;", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["isofs:", "Fix", "unchecked", "printing", "of", "ER", "records", "We", "didn't", "check", "length", "of", "rock", "ridge", "ER", "records", "before", "printing", "them.", "Thus", "corrupted", "isofs", "image", "can", "cause", "us", "to", "access", "and", "print", "some", "memory", "behind", "the", "buffer", "with", "obvious", "consequences.", "Reported-and-tested-by:", "Carl", "Henrik", "Lunde", "<chlunde@ping.uio.no>", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Jan", "Kara", "<jack@suse.cz>"], "code_tokens": ["@", "@", "-", "362", ",", "6", "+", "362", ",", "9", "@", "@", "parse_rock_ridge_inode_internal", "(", "struct", "iso_directory_record", "*", "de", ",", "rs", ".", "cont_size", "=", "isonum_733", "(", "rr", "-", ">", "u", ".", "CE", ".", "size", ")", ";", "break", ";", "case", "SIG", "(", "'", "E", "'", ",", "'", "R", "'", "):", "/", "*", "Invalid", "length", "of", "ER", "tag", "id", "?", "*", "/", "if", "(", "rr", "-", ">", "u", ".", "ER", ".", "len_id", "+", "offsetof", "(", "struct", "rock_ridge", ",", "u", ".", "ER", ".", "data", ")", ">", "rr", "-", ">", "len", ")", "goto", "out", ";", "ISOFS_SB", "(", "inode", "-", ">", "i_sb", ")", "->", "s_rock", "=", "1", ";", "printk", "(", "KERN_DEBUG", "\"", "ISO", "9660", "Extensions", ":", "\"", ");", "{"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["Fix", "SECURITY-96"], "code_tokens": ["@", "@", "-", "110", ",", "7", "+", "110", ",", "7", "@", "@", "l", ".", "layout", "(", "permission", ":", "PluginImpl", ".", "UPDATE_PERMISSION", ")", "{", "text", "(", "cause", ".", "getCategoriesAsString", "(", "))", "}", "td", "{", "raw", "(", "cause", ".", "getDescription", "(", "))", "raw", "(", "app", ".", "markupFormatter", ".", "translate", "(", "cause", ".", "getDescription", "(", "))", ")", "}", "td", "{", "if", "(", "canRemove", ")", "{", "@", "@", "-", "64", ",", "7", "+", "64", ",", "7", "@", "@", "<", "tr", ">", "<", "td", "/", ">", "<", "td", ">", "$", "{", "cause", ".", "description", "}", "$", "{", "app", ".", "markupFormatter", ".", "translate", "(", "cause", ".", "description", ")", "}", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", ">"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["Improved", "SupportingToken", "policy", "validation", "git-svn-id:", "https://svn.apache.org/repos/asf/cxf/trunk@1338219", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "69", ",", "6", "+", "69", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "CryptoCoverageUtil", ".", "CoverageType", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ".", "AsymmetricBindingPolicyValidator", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ".", "BindingPolicyValidator", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ".", "ConcreteSupportingTokenPolicyValidator", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ".", "EncryptedTokenPolicyValidator", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ".", "EndorsingEncryptedTokenPolicyValidator", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ".", "EndorsingTokenPolicyValidator", ";", "@", "@", "-", "562", ",", "9", "+", "563", ",", "6", "@", "@", "protected", "void", "doResults", "(", "LOG", ".", "fine", "(", "\"", "Incoming", "request", "failed", "supporting", "token", "policy", "validation", "\"", ");", "}", "/", "/", "The", "supporting", "tokens", "are", "already", "validated", "assertPolicy", "(", "aim", ",", "SP12Constants", ".", "SUPPORTING_TOKENS", ")", ";", "/", "/", "relatively", "irrelevant", "stuff", "from", "a", "verification", "standpoint", "assertPolicy", "(", "aim", ",", "SP12Constants", ".", "LAYOUT", ")", ";", "assertPolicy", "(", "aim", ",", "SP12Constants", ".", "WSS10", ")", ";", "@", "@", "-", "703", ",", "7", "+", "701", ",", "13", "@", "@", "private", "boolean", "checkSupportingTokenCoverage", "(", "boolean", "check", "=", "true", ";", "SupportingTokenPolicyValidator", "validator", "=", "new", "SignedTokenPolicyValidator", "(", ");", "SupportingTokenPolicyValidator", "validator", "=", "new", "ConcreteSupportingTokenPolicyValidator", "(", ");", "validator", ".", "setUsernameTokenResults", "(", "utResults", ",", "utWithCallbacks", ")", ";", "validator", ".", "setSAMLTokenResults", "(", "samlResults", ")", ";", "validator", ".", "setTimestampElement", "(", "timestamp", ")", ";", "check", "&", "=", "validator", ".", "validatePolicy", "(", "aim", ",", "msg", ",", "results", ",", "signedResults", ",", "encryptedResults", ")", ";", "validator", "=", "new", "SignedTokenPolicyValidator", "(", ");", "validator", ".", "setUsernameTokenResults", "(", "utResults", ",", "utWithCallbacks", ")", ";", "validator", ".", "setSAMLTokenResults", "(", "samlResults", ")", ";", "validator", ".", "setTimestampElement", "(", "timestamp", ")", ";", "@", "@", "-", "23", ",", "14", "+", "23", ",", "30", "@", "@", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "javax", ".", "xml", ".", "namespace", ".", "QName", ";", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPException", ";", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPMessage", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPath", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathConstants", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathExpressionException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "w3c", ".", "dom", ".", "NodeList", ";", "import", "org", ".", "apache", ".", "cxf", ".", "common", ".", "logging", ".", "LogUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "CastUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "DOMUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "MapNamespaceContext", ";", "import", "org", ".", "apache", ".", "cxf", ".", "message", ".", "Message", ";", "import", "org", ".", "apache", ".", "cxf", ".", "security", ".", "transport", ".", "TLSSessionInfo", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "Header", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "SignedEncryptedElements", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "SignedEncryptedParts", ";", "import", "org", ".", "apache", ".", "ws", ".", "security", ".", "WSConstants", ";", "import", "org", ".", "apache", ".", "ws", ".", "security", ".", "WSDataRef", ";", "import", "org", ".", "apache", ".", "ws", ".", "security", ".", "WSSecurityEngine", ";", "@", "@", "-", "48", ",", "6", "+", "64", ",", "8", "@", "@", "public", "abstract", "class", "AbstractSupportingTokenPolicyValidator", "extends", "AbstractTokenPolicyValidator", "implements", "SupportingTokenPolicyValidator", "{", "private", "static", "final", "Logger", "LOG", "=", "LogUtils", ".", "getL7dLogger", "(", "AbstractSupportingTokenPolicyValidator", ".", "class", ")", ";", "private", "Message", "message", ";", "private", "List", "<", "WSSecurityEngineResult", ">", "results", ";", "private", "List", "<", "WSSecurityEngineResult", ">", "signedResults", ";", "@", "@", "-", "59", ",", "7", "+", "77", ",", "11", "@", "@", "private", "boolean", "signed", ";", "private", "boolean", "encrypted", ";", "private", "boolean", "derived", ";", "private", "boolean", "endorsed", ";", "private", "boolean", "endorsed", ";", "private", "SignedEncryptedElements", "signedElements", ";", "private", "SignedEncryptedElements", "encryptedElements", ";", "private", "SignedEncryptedParts", "signedParts", ";", "private", "SignedEncryptedParts", "encryptedParts", ";", "/", "**", "*", "Set", "the", "list", "of", "UsernameToken", "results", "@", "@", "-", "130", ",", "7", "+", "152", ",", "7", "@", "@", "protected", "boolean", "processUsernameTokens", "(", ")", "{", "tokenResults", ".", "addAll", "(", "utResults", ")", ";", "List", "<", "WSSecurityEngineResult", ">", "dktResults", "=", "new", "ArrayList", "<", "WSSecurityEngineResult", ">", "()", ";", "for", "(", "WSSecurityEngineResult", "wser", ":", "utResults", ")", "{", "if", "(", "endorsed", "&", "&", "derived", ")", "{", "if", "(", "derived", ")", "{", "byte", "[", "]", "secret", "=", "(", "byte", "[", "])", "wser", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_SECRET", ")", ";", "WSSecurityEngineResult", "dktResult", "=", "getMatchingDerivedKey", "(", "secret", ")", ";", "if", "(", "dktResult", "!", "=", "null", ")", "{", "@", "@", "-", "150", ",", "9", "+", "172", ",", "10", "@", "@", "protected", "boolean", "processUsernameTokens", "(", ")", "{", "return", "false", ";", "}", "tokenResults", ".", "addAll", "(", "dktResults", ")", ";", "if", "(", "endorsed", "&", "&", "!", "checkEndorsed", "(", "tokenResults", ")", ")", "{", "if", "(", "(", "endorsed", "&", "&", "!", "checkEndorsed", "(", "tokenResults", ")", ")", "|", "|", "!", "validateSignedEncryptedPolicies", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "@", "-", "174", ",", "6", "+", "197", ",", "11", "@", "@", "protected", "boolean", "processSAMLTokens", "(", ")", "{", "if", "(", "endorsed", "&", "&", "!", "checkEndorsed", "(", "samlResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedPolicies", "(", "samlResults", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "@", "-", "190", ",", "7", "+", "218", ",", "7", "@", "@", "protected", "boolean", "processKerberosTokens", "(", ")", "{", "BinarySecurity", "binarySecurity", "=", "(", "BinarySecurity", ")", "wser", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_BINARY_SECURITY_TOKEN", ")", ";", "if", "(", "binarySecurity", "instanceof", "KerberosSecurity", ")", "{", "if", "(", "endorsed", "&", "&", "derived", ")", "{", "if", "(", "derived", ")", "{", "byte", "[", "]", "secret", "=", "(", "byte", "[", "])", "wser", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_SECRET", ")", ";", "WSSecurityEngineResult", "dktResult", "=", "getMatchingDerivedKey", "(", "secret", ")", ";", "if", "(", "dktResult", "!", "=", "null", ")", "{", "@", "@", "-", "216", ",", "6", "+", "244", ",", "11", "@", "@", "protected", "boolean", "processKerberosTokens", "(", ")", "{", "if", "(", "endorsed", "&", "&", "!", "checkEndorsed", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedPolicies", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "@", "-", "233", ",", "7", "+", "266", ",", "7", "@", "@", "protected", "boolean", "processX509Tokens", "(", ")", "{", "(", "BinarySecurity", ")", "wser", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_BINARY_SECURITY_TOKEN", ")", ";", "if", "(", "binarySecurity", "instanceof", "X509Security", "|", "|", "binarySecurity", "instanceof", "PKIPathSecurity", ")", "{", "if", "(", "endorsed", "&", "&", "derived", ")", "{", "if", "(", "derived", ")", "{", "WSSecurityEngineResult", "resultToStore", "=", "processX509DerivedTokenResult", "(", "wser", ")", ";", "if", "(", "resultToStore", "!", "=", "null", ")", "{", "dktResults", ".", "add", "(", "resultToStore", ")", ";", "@", "@", "-", "258", ",", "6", "+", "291", ",", "35", "@", "@", "protected", "boolean", "processX509Tokens", "(", ")", "{", "if", "(", "endorsed", "&", "&", "!", "checkEndorsed", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedPolicies", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "/", "**", "*", "Validate", "(", "SignedParts", "|", "SignedElements", "|", "EncryptedParts", "|", "EncryptedElements", ")", "policies", "of", "this", "*", "SupportingToken", ".", "*", "/", "private", "boolean", "validateSignedEncryptedPolicies", "(", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", ")", "{", "if", "(", "!", "validateSignedEncryptedParts", "(", "signedParts", ",", "false", ",", "signedResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedParts", "(", "encryptedParts", ",", "true", ",", "encryptedResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedElements", "(", "signedElements", ",", "false", ",", "signedResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedElements", "(", "encryptedElements", ",", "false", ",", "encryptedResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "@", "-", "271", ",", "7", "+", "333", ",", "7", "@", "@", "protected", "boolean", "processSCTokens", "(", ")", "{", "for", "(", "WSSecurityEngineResult", "wser", ":", "results", ")", "{", "Integer", "actInt", "=", "(", "Integer", ")", "wser", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_ACTION", ")", ";", "if", "(", "actInt", ".", "intValue", "(", ")", "=", "=", "WSConstants", ".", "SCT", ")", "{", "if", "(", "endorsed", "&", "&", "derived", ")", "{", "if", "(", "derived", ")", "{", "byte", "[", "]", "secret", "=", "(", "byte", "[", "])", "wser", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_SECRET", ")", ";", "WSSecurityEngineResult", "dktResult", "=", "getMatchingDerivedKey", "(", "secret", ")", ";", "if", "(", "dktResult", "!", "=", "null", ")", "{", "@", "@", "-", "296", ",", "6", "+", "358", ",", "11", "@", "@", "protected", "boolean", "processSCTokens", "(", ")", "{", "if", "(", "endorsed", "&", "&", "!", "checkEndorsed", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "validateSignedEncryptedPolicies", "(", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "@", "-", "417", ",", "7", "+", "484", ",", "7", "@", "@", "private", "boolean", "checkTimestampIsSigned", "(", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", "if", "(", "sl", "!", "=", "null", ")", "{", "for", "(", "WSDataRef", "dataRef", ":", "sl", ")", "{", "if", "(", "timestamp", "=", "=", "dataRef", ".", "getProtectedElement", "(", ")", "&", "&", "checkSignature", "(", "signedResult", ",", "tokenResults", ")", ")", "{", "&", "&", "checkSignatureOrEncryptionResult", "(", "signedResult", ",", "tokenResults", ")", ")", "{", "return", "true", ";", "}", "}", "@", "@", "-", "441", ",", "7", "+", "508", ",", "7", "@", "@", "private", "boolean", "checkSignatureIsSigned", "(", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", "for", "(", "WSDataRef", "dataRef", ":", "sl", ")", "{", "QName", "signedQName", "=", "dataRef", ".", "getName", "(", ");", "if", "(", "WSSecurityEngine", ".", "SIGNATURE", ".", "equals", "(", "signedQName", ")", "&", "&", "checkSignature", "(", "signedResult", ",", "tokenResults", ")", ")", "{", "&", "&", "checkSignatureOrEncryptionResult", "(", "signedResult", ",", "tokenResults", ")", ")", "{", "return", "true", ";", "}", "}", "@", "@", "-", "451", ",", "20", "+", "518", ",", "20", "@", "@", "private", "boolean", "checkSignatureIsSigned", "(", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", "}", "/", "**", "*", "Check", "that", "a", "WSSecurityEngineResult", "corresponding", "to", "a", "signature", "uses", "the", "same", "*", "signing", "credential", "as", "one", "of", "the", "tokens", ".", "*", "@", "param", "signatureResult", "a", "WSSecurityEngineResult", "corresponding", "to", "a", "signature", "*", "Check", "that", "a", "WSSecurityEngineResult", "corresponding", "to", "a", "signature", "or", "encryption", "uses", "the", "same", "*", "signing", "/", "encrypting", "credential", "as", "one", "of", "the", "tokens", ".", "*", "@", "param", "signatureResult", "a", "WSSecurityEngineResult", "corresponding", "to", "a", "signature", "or", "encryption", "*", "@", "param", "tokenResult", "A", "list", "of", "WSSecurityEngineResults", "corresponding", "to", "tokens", "*", "@", "return", "*", "/", "private", "boolean", "checkSignature", "(", "WSSecurityEngineResult", "signatureResult", ",", "private", "boolean", "checkSignatureOrEncryptionResult", "(", "WSSecurityEngineResult", "result", ",", "List", "<", "WSSecurityEngineResult", ">", "tokenResult", ")", "{", "/", "/", "See", "what", "was", "used", "to", "sign", "this", "result", "/", "/", "See", "what", "was", "used", "to", "sign", "/", "encrypt", "this", "result", "X509Certificate", "cert", "=", "(", "X509Certificate", ")", "signatureResult", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_X509_CERTIFICATE", ")", ";", "byte", "[", "]", "secret", "=", "(", "byte", "[", "])", "signatureResult", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_SECRET", ")", ";", "(", "X509Certificate", ")", "result", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_X509_CERTIFICATE", ")", ";", "byte", "[", "]", "secret", "=", "(", "byte", "[", "])", "result", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_SECRET", ")", ";", "/", "/", "Now", "see", "if", "the", "same", "credential", "exists", "in", "the", "tokenResult", "list", "for", "(", "WSSecurityEngineResult", "token", ":", "tokenResult", ")", "{", "@", "@", "-", "509", ",", "6", "+", "576", ",", "165", "@", "@", "private", "boolean", "checkSignature", "(", "return", "false", ";", "}", "/", "**", "*", "Validate", "the", "SignedParts", "or", "EncryptedParts", "policies", "*", "/", "private", "boolean", "validateSignedEncryptedParts", "(", "SignedEncryptedParts", "parts", ",", "boolean", "content", ",", "List", "<", "WSSecurityEngineResult", ">", "protResults", ",", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", ")", "{", "if", "(", "parts", "=", "=", "null", ")", "{", "return", "true", ";", "}", "if", "(", "parts", ".", "isBody", "(", "))", "{", "SOAPMessage", "soapMessage", "=", "message", ".", "getContent", "(", "SOAPMessage", ".", "class", ")", ";", "Element", "soapBody", "=", "null", ";", "try", "{", "soapBody", "=", "soapMessage", ".", "getSOAPBody", "(", ");", "}", "catch", "(", "SOAPException", "ex", ")", "{", "LOG", ".", "log", "(", "Level", ".", "FINE", ",", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "return", "false", ";", "}", "if", "(", "!", "checkProtectionResult", "(", "soapBody", ",", "content", ",", "protResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "}", "for", "(", "Header", "h", ":", "parts", ".", "getHeaders", "(", "))", "{", "SOAPMessage", "soapMessage", "=", "message", ".", "getContent", "(", "SOAPMessage", ".", "class", ")", ";", "Element", "soapHeader", "=", "null", ";", "try", "{", "soapHeader", "=", "soapMessage", ".", "getSOAPHeader", "(", ");", "}", "catch", "(", "SOAPException", "ex", ")", "{", "LOG", ".", "log", "(", "Level", ".", "FINE", ",", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "return", "false", ";", "}", "final", "List", "<", "Element", ">", "elements", ";", "if", "(", "h", ".", "getName", "(", ")", "=", "=", "null", ")", "{", "elements", "=", "DOMUtils", ".", "getChildrenWithNamespace", "(", "soapHeader", ",", "h", ".", "getNamespace", "(", "))", ";", "}", "else", "{", "elements", "=", "DOMUtils", ".", "getChildrenWithName", "(", "soapHeader", ",", "h", ".", "getNamespace", "(", "),", "h", ".", "getName", "(", "))", ";", "}", "for", "(", "Element", "el", ":", "elements", ")", "{", "if", "(", "!", "checkProtectionResult", "(", "el", ",", "false", ",", "protResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "}", "}", "return", "true", ";", "}", "/", "**", "*", "Check", "that", "an", "Element", "is", "signed", "or", "encrypted", "by", "one", "of", "the", "token", "results", "*", "/", "private", "boolean", "checkProtectionResult", "(", "Element", "elementToProtect", ",", "boolean", "content", ",", "List", "<", "WSSecurityEngineResult", ">", "protResults", ",", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", ")", "{", "for", "(", "WSSecurityEngineResult", "result", ":", "protResults", ")", "{", "List", "<", "WSDataRef", ">", "dataRefs", "=", "CastUtils", ".", "cast", "(", "(", "List", "<", "?>", ")", "result", ".", "get", "(", "WSSecurityEngineResult", ".", "TAG_DATA_REF_URIS", ")", ");", "if", "(", "dataRefs", "!", "=", "null", ")", "{", "for", "(", "WSDataRef", "dataRef", ":", "dataRefs", ")", "{", "if", "(", "elementToProtect", "=", "=", "dataRef", ".", "getProtectedElement", "(", ")", "&", "&", "content", "=", "=", "dataRef", ".", "isContent", "(", ")", "&", "&", "checkSignatureOrEncryptionResult", "(", "result", ",", "tokenResults", ")", ")", "{", "return", "true", ";", "}", "}", "}", "}", "return", "false", ";", "}", "/", "**", "*", "Validate", "SignedElements", "or", "EncryptedElements", "policies", "*", "/", "private", "boolean", "validateSignedEncryptedElements", "(", "SignedEncryptedElements", "elements", ",", "boolean", "content", ",", "List", "<", "WSSecurityEngineResult", ">", "protResults", ",", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", ")", "{", "if", "(", "elements", "=", "=", "null", ")", "{", "return", "true", ";", "}", "Map", "<", "String", ",", "String", ">", "namespaces", "=", "elements", ".", "getDeclaredNamespaces", "(", ");", "List", "<", "String", ">", "xpaths", "=", "elements", ".", "getXPathExpressions", "(", ");", "if", "(", "xpaths", "!", "=", "null", ")", "{", "SOAPMessage", "soapMessage", "=", "message", ".", "getContent", "(", "SOAPMessage", ".", "class", ")", ";", "Element", "soapEnvelope", "=", "soapMessage", ".", "getSOAPPart", "(", ").", "getDocumentElement", "(", ");", "for", "(", "String", "xPath", ":", "xpaths", ")", "{", "if", "(", "!", "checkXPathResult", "(", "soapEnvelope", ",", "xPath", ",", "namespaces", ",", "protResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "}", "}", "return", "true", ";", "}", "/", "**", "*", "Check", "a", "particular", "XPath", "result", "*", "/", "private", "boolean", "checkXPathResult", "(", "Element", "soapEnvelope", ",", "String", "xPath", ",", "Map", "<", "String", ",", "String", ">", "namespaces", ",", "List", "<", "WSSecurityEngineResult", ">", "protResults", ",", "List", "<", "WSSecurityEngineResult", ">", "tokenResults", ")", "{", "/", "/", "XPathFactory", "and", "XPath", "are", "not", "thread", "-", "safe", "so", "we", "must", "recreate", "them", "/", "/", "each", "request", ".", "final", "XPathFactory", "factory", "=", "XPathFactory", ".", "newInstance", "(", ");", "final", "XPath", "xpath", "=", "factory", ".", "newXPath", "(", ");", "if", "(", "namespaces", "!", "=", "null", ")", "{", "xpath", ".", "setNamespaceContext", "(", "new", "MapNamespaceContext", "(", "namespaces", ")", ");", "}", "/", "/", "For", "each", "XPath", "for", "(", "String", "xpathString", ":", "Arrays", ".", "asList", "(", "xPath", ")", ")", "{", "/", "/", "Get", "the", "matching", "nodes", "NodeList", "list", ";", "try", "{", "list", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "xpathString", ",", "soapEnvelope", ",", "XPathConstants", ".", "NODESET", ")", ";", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "LOG", ".", "log", "(", "Level", ".", "FINE", ",", "e", ".", "getMessage", "(", "),", "e", ")", ";", "return", "false", ";", "}", "/", "/", "If", "we", "found", "nodes", "then", "we", "need", "to", "do", "the", "check", ".", "if", "(", "list", ".", "getLength", "(", ")", "!", "=", "0", ")", "{", "/", "/", "For", "each", "matching", "element", ",", "check", "for", "a", "ref", "that", "/", "/", "covers", "it", ".", "for", "(", "int", "x", "=", "0", ";", "x", "<", "list", ".", "getLength", "(", ");", "x", "+", "+)", "{", "final", "Element", "el", "=", "(", "Element", ")", "list", ".", "item", "(", "x", ")", ";", "if", "(", "!", "checkProtectionResult", "(", "el", ",", "false", ",", "protResults", ",", "tokenResults", ")", ")", "{", "return", "false", ";", "}", "}", "}", "}", "return", "true", ";", "}", "/", "**", "*", "Return", "true", "if", "a", "token", "was", "signed", ",", "false", "otherwise", ".", "*", "/", "@", "@", "-", "543", ",", "5", "+", "769", ",", "33", "@", "@", "private", "boolean", "isTokenEncrypted", "(", "Element", "token", ")", "{", "}", "return", "false", ";", "}", "public", "void", "setUtResults", "(", "List", "<", "WSSecurityEngineResult", ">", "utResults", ")", "{", "this", ".", "utResults", "=", "utResults", ";", "}", "public", "void", "setValidateUsernameToken", "(", "boolean", "validateUsernameToken", ")", "{", "this", ".", "validateUsernameToken", "=", "validateUsernameToken", ";", "}", "public", "void", "setTimestamp", "(", "Element", "timestamp", ")", "{", "this", ".", "timestamp", "=", "timestamp", ";", "}", "public", "void", "setSignedElements", "(", "SignedEncryptedElements", "signedElements", ")", "{", "this", ".", "signedElements", "=", "signedElements", ";", "}", "public", "void", "setEncryptedElements", "(", "SignedEncryptedElements", "encryptedElements", ")", "{", "this", ".", "encryptedElements", "=", "encryptedElements", ";", "}", "public", "void", "setSignedParts", "(", "SignedEncryptedParts", "signedParts", ")", "{", "this", ".", "signedParts", "=", "signedParts", ";", "}", "public", "void", "setEncryptedParts", "(", "SignedEncryptedParts", "encryptedParts", ")", "{", "this", ".", "encryptedParts", "=", "encryptedParts", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "122", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "wss4j", ".", "policyvalidators", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "cxf", ".", "message", ".", "Message", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "policy", ".", "AssertionInfo", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "policy", ".", "AssertionInfoMap", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "SP12Constants", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "SPConstants", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "IssuedToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "KerberosToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "SamlToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "SecurityContextToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "SupportingToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "Token", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "UsernameToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "security", ".", "policy", ".", "model", ".", "X509Token", ";", "import", "org", ".", "apache", ".", "ws", ".", "security", ".", "WSSecurityEngineResult", ";", "/", "**", "*", "Validate", "SupportingToken", "policies", ".", "*", "/", "public", "class", "ConcreteSupportingTokenPolicyValidator", "extends", "AbstractSupportingTokenPolicyValidator", "{", "public", "ConcreteSupportingTokenPolicyValidator", "(", ")", "{", "setSigned", "(", "false", ")", ";", "}", "public", "boolean", "validatePolicy", "(", "AssertionInfoMap", "aim", ",", "Message", "message", ",", "List", "<", "WSSecurityEngineResult", ">", "results", ",", "List", "<", "WSSecurityEngineResult", ">", "signedResults", ",", "List", "<", "WSSecurityEngineResult", ">", "encryptedResults", ")", "{", "Collection", "<", "AssertionInfo", ">", "ais", "=", "aim", ".", "get", "(", "SP12Constants", ".", "SUPPORTING_TOKENS", ")", ";", "if", "(", "ais", "=", "=", "null", "|", "|", "ais", ".", "isEmpty", "(", "))", "{", "return", "true", ";", "}", "setMessage", "(", "message", ")", ";", "setResults", "(", "results", ")", ";", "setSignedResults", "(", "signedResults", ")", ";", "setEncryptedResults", "(", "encryptedResults", ")", ";", "for", "(", "AssertionInfo", "ai", ":", "ais", ")", "{", "SupportingToken", "binding", "=", "(", "SupportingToken", ")", "ai", ".", "getAssertion", "(", ");", "if", "(", "SPConstants", ".", "SupportTokenType", ".", "SUPPORTING_TOKEN_SUPPORTING", "!", "=", "binding", ".", "getTokenType", "(", "))", "{", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "if", "(", "!", "isTokenRequired", "(", "token", ",", "message", ")", ")", "{", "continue", ";", "}", "boolean", "processingFailed", "=", "false", ";", "if", "(", "token", "instanceof", "UsernameToken", ")", "{", "if", "(", "!", "processUsernameTokens", "(", "))", "{", "processingFailed", "=", "true", ";", "}", "}", "else", "if", "(", "token", "instanceof", "SamlToken", ")", "{", "if", "(", "!", "processSAMLTokens", "(", "))", "{", "processingFailed", "=", "true", ";", "}", "}", "else", "if", "(", "token", "instanceof", "KerberosToken", ")", "{", "if", "(", "!", "processKerberosTokens", "(", "))", "{", "processingFailed", "=", "true", ";", "}", "}", "else", "if", "(", "token", "instanceof", "X509Token", ")", "{", "if", "(", "!", "processX509Tokens", "(", "))", "{", "processingFailed", "=", "true", ";", "}", "}", "else", "if", "(", "token", "instanceof", "SecurityContextToken", ")", "{", "if", "(", "!", "processSCTokens", "(", "))", "{", "processingFailed", "=", "true", ";", "}", "}", "else", "if", "(", "!(", "token", "instanceof", "IssuedToken", ")", ")", "{", "processingFailed", "=", "true", ";", "}", "if", "(", "processingFailed", ")", "{", "ai", ".", "setNotAsserted", "(", "\"", "The", "received", "token", "does", "not", "match", "the", "supporting", "token", "requirement", "\"", ")", ";", "return", "false", ";", "}", "}", "}", "return", "true", ";", "}", "}", "@", "@", "-", "69", ",", "6", "+", "69", ",", "11", "@", "@", "public", "boolean", "validatePolicy", "(", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "@", "@", "-", "71", ",", "6", "+", "71", ",", "11", "@", "@", "public", "boolean", "validatePolicy", "(", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "@", "@", "-", "70", ",", "7", "+", "70", ",", "12", "@", "@", "public", "boolean", "validatePolicy", "(", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "if", "(", "!", "isTokenRequired", "(", "token", ",", "message", ")", ")", "{", "@", "@", "-", "70", ",", "6", "+", "70", ",", "11", "@", "@", "public", "boolean", "validatePolicy", "(", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "@", "@", "-", "72", ",", "6", "+", "72", ",", "11", "@", "@", "public", "boolean", "validatePolicy", "(", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "@", "@", "-", "70", ",", "6", "+", "70", ",", "11", "@", "@", "public", "boolean", "validatePolicy", "(", "continue", ";", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "@", "@", "-", "70", ",", "6", "+", "70", ",", "11", "@", "@", "public", "boolean", "validatePolicy", "(", "}", "ai", ".", "setAsserted", "(", "true", ")", ";", "setSignedParts", "(", "binding", ".", "getSignedParts", "(", "))", ";", "setEncryptedParts", "(", "binding", ".", "getEncryptedParts", "(", "))", ";", "setSignedElements", "(", "binding", ".", "getSignedElements", "(", "))", ";", "setEncryptedElements", "(", "binding", ".", "getEncryptedElements", "(", "))", ";", "List", "<", "Token", ">", "tokens", "=", "binding", ".", "getTokens", "(", ");", "for", "(", "Token", "token", ":", "tokens", ")", "{", "if", "(", "!", "isTokenRequired", "(", "token", ",", "message", ")", ")", "{", "@", "@", "-", "79", ",", "7", "+", "79", ",", "7", "@", "@", "public", "void", "testAsymmetric", "(", ")", "throws", "Exception", "{", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItAsymmetricPort", "\"", ");", "DoubleItPortType", "utPort", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "utPort", ",", "PORT2", ")", ";", "updateAddressPort", "(", "utPort", ",", "PORT", ")", ";", "utPort", ".", "doubleIt", "(", "25", ")", ";", "@", "@", "-", "104", ",", "7", "+", "104", ",", "7", "@", "@", "public", "void", "testNoSecurity", "(", ")", "throws", "Exception", "{", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItNoSecurityPort", "\"", ");", "DoubleItPortType", "utPort", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "utPort", ",", "PORT2", ")", ";", "updateAddressPort", "(", "utPort", ",", "PORT", ")", ";", "try", "{", "utPort", ".", "doubleIt", "(", "25", ")", ";", "@", "@", "-", "134", ",", "11", "+", "134", ",", "70", "@", "@", "public", "void", "testUsernameToken", "(", ")", "throws", "Exception", "{", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItUsernameTokenPort", "\"", ");", "DoubleItPortType", "utPort", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "utPort", ",", "PORT2", ")", ";", "updateAddressPort", "(", "utPort", ",", "PORT", ")", ";", "utPort", ".", "doubleIt", "(", "25", ")", ";", "bus", ".", "shutdown", "(", "true", ")", ";", "}", "/", "**", "*", "The", "client", "uses", "a", "Transport", "binding", "policy", "with", "a", "Endorsing", "Supporting", "X509", "Token", ".", "The", "client", "does", "*", "not", "sign", "part", "of", "the", "WSA", "header", "though", "and", "so", "the", "invocation", "should", "fail", ".", "*", "/", "@", "org", ".", "junit", ".", "Test", "public", "void", "testTransportSupportingSigned", "(", ")", "throws", "Exception", "{", "SpringBusFactory", "bf", "=", "new", "SpringBusFactory", "(", ");", "URL", "busFile", "=", "PolicyAlternativeTest", ".", "class", ".", "getResource", "(", "\"", "client", "/", "client", ".", "xml", "\"", ");", "Bus", "bus", "=", "bf", ".", "createBus", "(", "busFile", ".", "toString", "(", "))", ";", "SpringBusFactory", ".", "setDefaultBus", "(", "bus", ")", ";", "SpringBusFactory", ".", "setThreadDefaultBus", "(", "bus", ")", ";", "URL", "wsdl", "=", "PolicyAlternativeTest", ".", "class", ".", "getResource", "(", "\"", "DoubleItPolicy", ".", "wsdl", "\"", ");", "Service", "service", "=", "Service", ".", "create", "(", "wsdl", ",", "SERVICE_QNAME", ")", ";", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItTransportSupportingSignedPort", "\"", ");", "DoubleItPortType", "transportPort", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "transportPort", ",", "PORT2", ")", ";", "try", "{", "transportPort", ".", "doubleIt", "(", "25", ")", ";", "fail", "(", "\"", "Failure", "expected", "on", "not", "signing", "a", "wsa", "header", "\"", ");", "}", "catch", "(", "javax", ".", "xml", ".", "ws", ".", "soap", ".", "SOAPFaultException", "ex", ")", "{", "/", "/", "expected", "}", "}", "/", "**", "*", "The", "client", "uses", "a", "Transport", "binding", "policy", "with", "a", "Endorsing", "Supporting", "X509", "Token", "as", "well", "as", "a", "*", "Signed", "Endorsing", "UsernameToken", ".", "Here", "the", "client", "is", "trying", "to", "trick", "the", "Service", "Provider", "as", "*", "the", "UsernameToken", "signs", "the", "wsa", ":", "To", "Header", ",", "not", "the", "X", ".", "509", "Token", ".", "*", "/", "@", "org", ".", "junit", ".", "Test", "public", "void", "testTransportUTSupportingSigned", "(", ")", "throws", "Exception", "{", "SpringBusFactory", "bf", "=", "new", "SpringBusFactory", "(", ");", "URL", "busFile", "=", "PolicyAlternativeTest", ".", "class", ".", "getResource", "(", "\"", "client", "/", "client", ".", "xml", "\"", ");", "Bus", "bus", "=", "bf", ".", "createBus", "(", "busFile", ".", "toString", "(", "))", ";", "SpringBusFactory", ".", "setDefaultBus", "(", "bus", ")", ";", "SpringBusFactory", ".", "setThreadDefaultBus", "(", "bus", ")", ";", "URL", "wsdl", "=", "PolicyAlternativeTest", ".", "class", ".", "getResource", "(", "\"", "DoubleItPolicy", ".", "wsdl", "\"", ");", "Service", "service", "=", "Service", ".", "create", "(", "wsdl", ",", "SERVICE_QNAME", ")", ";", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItTransportUTSupportingSignedPort", "\"", ");", "DoubleItPortType", "transportPort", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "transportPort", ",", "PORT2", ")", ";", "try", "{", "transportPort", ".", "doubleIt", "(", "25", ")", ";", "fail", "(", "\"", "Failure", "expected", "on", "not", "signing", "a", "wsa", "header", "\"", ");", "}", "catch", "(", "javax", ".", "xml", ".", "ws", ".", "soap", ".", "SOAPFaultException", "ex", ")", "{", "/", "/", "expected", "}", "}", "}", "@", "@", "-", "466", ",", "6", "+", "466", ",", "28", "@", "@", "public", "void", "testAsymmetricSignatureReplay", "(", ")", "throws", "Exception", "{", "bus", ".", "shutdown", "(", "true", ")", ";", "}", "@", "org", ".", "junit", ".", "Test", "public", "void", "testTransportSupportingSigned", "(", ")", "throws", "Exception", "{", "if", "(", "!", "unrestrictedPoliciesInstalled", ")", "{", "return", ";", "}", "SpringBusFactory", "bf", "=", "new", "SpringBusFactory", "(", ");", "URL", "busFile", "=", "X509TokenTest", ".", "class", ".", "getResource", "(", "\"", "client", "/", "client", ".", "xml", "\"", ");", "Bus", "bus", "=", "bf", ".", "createBus", "(", "busFile", ".", "toString", "(", "))", ";", "SpringBusFactory", ".", "setDefaultBus", "(", "bus", ")", ";", "SpringBusFactory", ".", "setThreadDefaultBus", "(", "bus", ")", ";", "URL", "wsdl", "=", "X509TokenTest", ".", "class", ".", "getResource", "(", "\"", "DoubleItX509", ".", "wsdl", "\"", ");", "Service", "service", "=", "Service", ".", "create", "(", "wsdl", ",", "SERVICE_QNAME", ")", ";", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItTransportSupportingSignedPort", "\"", ");", "DoubleItPortType", "x509Port", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "x509Port", ",", "PORT2", ")", ";", "x509Port", ".", "doubleIt", "(", "25", ")", ";", "}", "private", "boolean", "checkUnrestrictedPoliciesInstalled", "(", ")", "{", "try", "{", "byte", "[", "]", "data", "=", "{", "0x00", ",", "0x01", ",", "0x02", ",", "0x03", ",", "0x04", ",", "0x05", ",", "0x06", ",", "0x07", "}", ";", "@", "@", "-", "57", ",", "6", "+", "57", ",", "12", "@", "@", "<", "wsdl", ":", "port", "name", "=", "\"", "DoubleItNoSecurityPort", "\"", "binding", "=", "\"", "tns", ":", "DoubleItInlinePolicyBinding", "\"", ">", "<", "soap", ":", "address", "location", "=", "\"", "http", ":", "//", "localhost", ":", "9010", "/", "DoubleItNoSecurity", "\"", "/", ">", "<", "/", "wsdl", ":", "port", ">", "<", "wsdl", ":", "port", "name", "=", "\"", "DoubleItTransportSupportingSignedPort", "\"", "binding", "=", "\"", "tns", ":", "DoubleItInlinePolicyBinding", "\"", ">", "<", "soap", ":", "address", "location", "=", "\"", "https", ":", "//", "localhost", ":", "9011", "/", "DoubleItTransportSupportingSigned", "\"", "/", ">", "<", "/", "wsdl", ":", "port", ">", "<", "wsdl", ":", "port", "name", "=", "\"", "DoubleItTransportUTSupportingSignedPort", "\"", "binding", "=", "\"", "tns", ":", "DoubleItInlinePolicyBinding", "\"", ">", "<", "soap", ":", "address", "location", "=", "\"", "https", ":", "//", "localhost", ":", "9011", "/", "DoubleItTransportUTSupportingSigned", "\"", "/", ">", "<", "/", "wsdl", ":", "port", ">", "<", "/", "wsdl", ":", "service", ">", "<", "/", "wsdl", ":", "definitions", ">", "@", "@", "-", "98", ",", "8", "+", "98", ",", "51", "@", "@", "<", "/", "jaxws", ":", "features", ">", "<", "/", "jaxws", ":", "client", ">", "<", "jaxws", ":", "client", "name", "=", "\"{", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "}", "DoubleItTransportSupportingSignedPort", "\"", "createdFromAPI", "=", "\"", "true", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "properties", "\"", "value", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "wssec10", "/", "client", "/", "alice", ".", "properties", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "username", "\"", "value", "=", "\"", "alice", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "wssec10", ".", "client", ".", "KeystorePasswordCallback", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "jaxws", ":", "features", ">", "<", "p", ":", "policies", ">", "<", "wsp", ":", "PolicyReference", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", "URI", "=", "\"#", "DoubleItTransportSupportingSignedPolicy", "\"", "/", ">", "<", "/", "p", ":", "policies", ">", "<", "/", "jaxws", ":", "features", ">", "<", "/", "jaxws", ":", "client", ">", "<", "jaxws", ":", "client", "name", "=", "\"{", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "}", "DoubleItTransportUTSupportingSignedPort", "\"", "createdFromAPI", "=", "\"", "true", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "username", "\"", "value", "=", "\"", "alice", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "properties", "\"", "value", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "wssec10", "/", "client", "/", "alice", ".", "properties", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "username", "\"", "value", "=", "\"", "alice", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "wssec10", ".", "client", ".", "KeystorePasswordCallback", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "jaxws", ":", "features", ">", "<", "p", ":", "policies", ">", "<", "wsp", ":", "PolicyReference", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", "URI", "=", "\"#", "DoubleItTransportUTSupportingSignedPolicy", "\"", "/", ">", "<", "/", "p", ":", "policies", ">", "<", "/", "jaxws", ":", "features", ">", "<", "/", "jaxws", ":", "client", ">", "<", "http", ":", "conduit", "name", "=", "\"", "https", ":", "//", "localhost", ":", ".*", "\">", "<", "http", ":", "tlsClientParameters", "disableCNCheck", "=", "\"", "true", "\"", ">", "<", "sec", ":", "trustManagers", ">", "<", "sec", ":", "keyStore", "type", "=", "\"", "jks", "\"", "password", "=", "\"", "password", "\"", "resource", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "security", "/", "Truststore", ".", "jks", "\"", "/>", "<", "/", "sec", ":", "trustManagers", ">", "<", "/", "http", ":", "tlsClientParameters", ">", "<", "/", "http", ":", "conduit", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "UsernameToken", "\"", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "UsernameToken", "\"", "xmlns", ":", "wsu", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "wss", "/", "2004", "/", "01", "/", "oasis", "-", "200401", "-", "wss", "-", "wssecurity", "-", "utility", "-", "1", ".", "0", ".", "xsd", "\"", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "@", "@", "-", "164", ",", "4", "+", "207", ",", "107", "@", "@", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItTransportSupportingSignedPolicy", "\"", "xmlns", ":", "wsu", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "wss", "/", "2004", "/", "01", "/", "oasis", "-", "200401", "-", "wss", "-", "wssecurity", "-", "utility", "-", "1", ".", "0", ".", "xsd", "\"", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "<", "wsp", ":", "All", ">", "<", "wsaws", ":", "UsingAddressing", "xmlns", ":", "wsaws", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2006", "/", "05", "/", "addressing", "/", "wsdl", "\"", "/", ">", "<", "sp", ":", "TransportBinding", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "TransportToken", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "HttpsToken", ">", "<", "wsp", ":", "Policy", "/", ">", "<", "/", "sp", ":", "HttpsToken", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportToken", ">", "<", "sp", ":", "Layout", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Lax", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "Layout", ">", "<", "sp", ":", "IncludeTimestamp", "/", ">", "<", "sp", ":", "AlgorithmSuite", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Basic128", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "AlgorithmSuite", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportBinding", ">", "<", "sp", ":", "EndorsingSupportingTokens", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "X509Token", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "AlwaysToRecipient", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "WssX509V3Token10", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "X509Token", ">", "<", "sp", ":", "SignedParts", ">", "<", "sp", ":", "Body", "/", ">", "<", "!-", "-", "<", "sp", ":", "Header", "Name", "=", "\"", "To", "\"", "Namespace", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2005", "/", "08", "/", "addressing", "\"", "/>", "-", "->", "<", "/", "sp", ":", "SignedParts", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "EndorsingSupportingTokens", ">", "<", "/", "wsp", ":", "All", ">", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItTransportUTSupportingSignedPolicy", "\"", "xmlns", ":", "wsu", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "wss", "/", "2004", "/", "01", "/", "oasis", "-", "200401", "-", "wss", "-", "wssecurity", "-", "utility", "-", "1", ".", "0", ".", "xsd", "\"", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "<", "wsp", ":", "All", ">", "<", "wsaws", ":", "UsingAddressing", "xmlns", ":", "wsaws", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2006", "/", "05", "/", "addressing", "/", "wsdl", "\"", "/", ">", "<", "sp", ":", "TransportBinding", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "TransportToken", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "HttpsToken", ">", "<", "wsp", ":", "Policy", "/", ">", "<", "/", "sp", ":", "HttpsToken", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportToken", ">", "<", "sp", ":", "Layout", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Lax", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "Layout", ">", "<", "sp", ":", "IncludeTimestamp", "/", ">", "<", "sp", ":", "AlgorithmSuite", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Basic128", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "AlgorithmSuite", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportBinding", ">", "<", "sp", ":", "EndorsingSupportingTokens", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "X509Token", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "AlwaysToRecipient", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "WssX509V3Token10", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "X509Token", ">", "<", "sp", ":", "SignedParts", ">", "<", "sp", ":", "Body", "/", ">", "<", "/", "sp", ":", "SignedParts", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "EndorsingSupportingTokens", ">", "<", "sp", ":", "SignedEndorsingSupportingTokens", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "UsernameToken", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "AlwaysToRecipient", "\"", ">", "<", "wsp", ":", "Policy", "/", ">", "<", "/", "sp", ":", "UsernameToken", ">", "<", "sp", ":", "SignedParts", ">", "<", "sp", ":", "Body", "/", ">", "<", "sp", ":", "Header", "Name", "=", "\"", "To", "\"", "Namespace", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2005", "/", "08", "/", "addressing", "\"", "/>", "<", "/", "sp", ":", "SignedParts", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "SignedEndorsingSupportingTokens", ">", "<", "/", "wsp", ":", "All", ">", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "beans", ">", "@", "@", "-", "44", ",", "8", "+", "44", ",", "32", "@", "@", "<", "/", "cxf", ":", "features", ">", "<", "/", "cxf", ":", "bus", ">", "<", "!-", "-", "-", "->", "<", "!-", "-", "Any", "services", "listening", "on", "port", "9009", "must", "use", "the", "following", "-", "->", "<", "!-", "-", "Transport", "Layer", "Security", "(", "TLS", ")", "settings", "-", "->", "<", "!-", "-", "-", "->", "<", "httpj", ":", "engine", "-", "factory", "id", "=", "\"", "tls", "-", "settings", "\"", ">", "<", "httpj", ":", "engine", "port", "=", "\"$", "{", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "\">", "<", "httpj", ":", "tlsServerParameters", ">", "<", "sec", ":", "keyManagers", "keyPassword", "=", "\"", "password", "\"", ">", "<", "sec", ":", "keyStore", "type", "=", "\"", "jks", "\"", "password", "=", "\"", "password", "\"", "resource", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "security", "/", "Bethal", ".", "jks", "\"", "/>", "<", "/", "sec", ":", "keyManagers", ">", "<", "sec", ":", "cipherSuitesFilter", ">", "<", "sec", ":", "include", ">", ".*", "_EXPORT_", ".", "*<", "/", "sec", ":", "include", ">", "<", "sec", ":", "include", ">", ".*", "_EXPORT1024_", ".", "*<", "/", "sec", ":", "include", ">", "<", "sec", ":", "include", ">", ".*", "_WITH_DES_", ".", "*<", "/", "sec", ":", "include", ">", "<", "sec", ":", "include", ">", ".*", "_WITH_AES_", ".", "*<", "/", "sec", ":", "include", ">", "<", "sec", ":", "include", ">", ".*", "_WITH_NULL_", ".", "*<", "/", "sec", ":", "include", ">", "<", "sec", ":", "exclude", ">", ".*", "_DH_anon_", ".", "*<", "/", "sec", ":", "exclude", ">", "<", "/", "sec", ":", "cipherSuitesFilter", ">", "<", "sec", ":", "clientAuthentication", "want", "=", "\"", "true", "\"", "required", "=", "\"", "false", "\"", "/>", "<", "/", "httpj", ":", "tlsServerParameters", ">", "<", "/", "httpj", ":", "engine", ">", "<", "/", "httpj", ":", "engine", "-", "factory", ">", "<", "jaxws", ":", "endpoint", "id", "=", "\"", "AsymmetricEndpoint", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "/", "DoubleItAsymmetric", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", "}", "/", "DoubleItAsymmetric", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItAsymmetricPort", "\"", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItPortTypeImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "policy", "/", "DoubleItPolicy", ".", "wsdl", "\"", ">", "@", "@", "-", "68", ",", "7", "+", "92", ",", "7", "@", "@", "<", "/", "jaxws", ":", "endpoint", ">", "<", "jaxws", ":", "endpoint", "id", "=", "\"", "NoSecurityEndpoint", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "/", "DoubleItNoSecurity", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", "}", "/", "DoubleItNoSecurity", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItNoSecurityPort", "\"", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItPortTypeImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "policy", "/", "DoubleItPolicy", ".", "wsdl", "\"", ">", "@", "@", "-", "91", ",", "7", "+", "115", ",", "7", "@", "@", "<", "/", "jaxws", ":", "endpoint", ">", "<", "jaxws", ":", "endpoint", "id", "=", "\"", "UsernameTokenEndpoint", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "/", "DoubleItUsernameToken", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", "}", "/", "DoubleItUsernameToken", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItUsernameTokenPort", "\"", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItPortTypeImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "policy", "/", "DoubleItPolicy", ".", "wsdl", "\"", ">", "@", "@", "-", "112", ",", "6", "+", "136", ",", "54", "@", "@", "<", "/", "jaxws", ":", "features", ">", "<", "/", "jaxws", ":", "endpoint", ">", "<", "jaxws", ":", "endpoint", "id", "=", "\"", "TransportSupportingSigned", "\"", "address", "=", "\"", "https", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "/", "DoubleItTransportSupportingSigned", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItTransportSupportingSignedPort", "\"", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "policy", "/", "DoubleItPolicy", ".", "wsdl", "\"", "depends", "-", "on", "=", "\"", "tls", "-", "settings", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "encryption", ".", "properties", "\"", "value", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "wssec10", "/", "client", "/", "alice", ".", "properties", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "jaxws", ":", "features", ">", "<", "p", ":", "policies", ">", "<", "wsp", ":", "PolicyReference", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", "URI", "=", "\"#", "DoubleItTransportSupportingSignedPolicy", "\"", "/", ">", "<", "/", "p", ":", "policies", ">", "<", "/", "jaxws", ":", "features", ">", "<", "/", "jaxws", ":", "endpoint", ">", "<", "jaxws", ":", "endpoint", "id", "=", "\"", "TransportUTSupportingSigned", "\"", "address", "=", "\"", "https", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "/", "DoubleItTransportUTSupportingSigned", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItTransportUTSupportingSignedPort", "\"", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "policy", "/", "DoubleItPolicy", ".", "wsdl", "\"", "depends", "-", "on", "=", "\"", "tls", "-", "settings", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "encryption", ".", "properties", "\"", "value", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "wssec10", "/", "client", "/", "alice", ".", "properties", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "wssec10", ".", "client", ".", "UTPasswordCallback", "\"", "/", ">", "<", "/", "jaxws", ":", "properties", ">", "<", "jaxws", ":", "features", ">", "<", "p", ":", "policies", ">", "<", "wsp", ":", "PolicyReference", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", "URI", "=", "\"#", "DoubleItTransportSupportingSignedPolicy", "\"", "/", ">", "<", "/", "p", ":", "policies", ">", "<", "/", "jaxws", ":", "features", ">", "<", "/", "jaxws", ":", "endpoint", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "Combined", "\"", "@", "@", "-", "189", ",", "6", "+", "261", ",", "52", "@", "@", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItTransportSupportingSignedPolicy", "\"", "xmlns", ":", "wsu", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "wss", "/", "2004", "/", "01", "/", "oasis", "-", "200401", "-", "wss", "-", "wssecurity", "-", "utility", "-", "1", ".", "0", ".", "xsd", "\"", "xmlns", ":", "wsp", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "ns", "/", "ws", "-", "policy", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "<", "wsp", ":", "All", ">", "<", "wsaws", ":", "UsingAddressing", "xmlns", ":", "wsaws", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2006", "/", "05", "/", "addressing", "/", "wsdl", "\"", "/", ">", "<", "sp", ":", "TransportBinding", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "TransportToken", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "HttpsToken", ">", "<", "wsp", ":", "Policy", "/", ">", "<", "/", "sp", ":", "HttpsToken", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportToken", ">", "<", "sp", ":", "Layout", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Lax", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "Layout", ">", "<", "sp", ":", "IncludeTimestamp", "/", ">", "<", "sp", ":", "AlgorithmSuite", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Basic128", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "AlgorithmSuite", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportBinding", ">", "<", "sp", ":", "EndorsingSupportingTokens", "xmlns", ":", "sp", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "X509Token", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "AlwaysToRecipient", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "WssX509V3Token10", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "X509Token", ">", "<", "sp", ":", "SignedParts", ">", "<", "sp", ":", "Body", "/", ">", "<", "sp", ":", "Header", "Name", "=", "\"", "To", "\"", "Namespace", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2005", "/", "08", "/", "addressing", "\"", "/>", "<", "/", "sp", ":", "SignedParts", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "EndorsingSupportingTokens", ">", "<", "/", "wsp", ":", "All", ">", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "beans", ">", "@", "@", "-", "258", ",", "6", "+", "258", ",", "23", "@", "@", "<", "/", "wsdl", ":", "fault", ">", "<", "/", "wsdl", ":", "operation", ">", "<", "/", "wsdl", ":", "binding", ">", "<", "wsdl", ":", "binding", "name", "=", "\"", "DoubleItTransportSupportingSignedBinding", "\"", "type", "=", "\"", "tns", ":", "DoubleItPortType", "\"", ">", "<", "wsp", ":", "PolicyReference", "URI", "=", "\"#", "DoubleItTransportSupportingSignedPolicy", "\"", "/", ">", "<", "soap", ":", "binding", "style", "=", "\"", "document", "\"", "transport", "=", "\"", "http", ":", "//", "schemas", ".", "xmlsoap", ".", "org", "/", "soap", "/", "http", "\"", "/", ">", "<", "wsdl", ":", "operation", "name", "=", "\"", "DoubleIt", "\"", ">", "<", "soap", ":", "operation", "soapAction", "=", "\"\"", "/", ">", "<", "wsdl", ":", "input", ">", "<", "soap", ":", "body", "use", "=", "\"", "literal", "\"", "/", ">", "<", "/", "wsdl", ":", "input", ">", "<", "wsdl", ":", "output", ">", "<", "soap", ":", "body", "use", "=", "\"", "literal", "\"", "/", ">", "<", "/", "wsdl", ":", "output", ">", "<", "wsdl", ":", "fault", "name", "=", "\"", "DoubleItFault", "\"", ">", "<", "soap", ":", "body", "use", "=", "\"", "literal", "\"", "name", "=", "\"", "DoubleItFault", "\"", "/", ">", "<", "/", "wsdl", ":", "fault", ">", "<", "/", "wsdl", ":", "operation", ">", "<", "/", "wsdl", ":", "binding", ">", "<", "wsdl", ":", "service", "name", "=", "\"", "DoubleItService", "\"", ">", "<", "wsdl", ":", "port", "name", "=", "\"", "DoubleItKeyIdentifierPort", "\"", "binding", "=", "\"", "tns", ":", "DoubleItKeyIdentifierBinding", "\"", ">", "@", "@", "-", "305", ",", "6", "+", "322", ",", "10", "@", "@", "binding", "=", "\"", "tns", ":", "DoubleItTransportSignedEndorsingEncryptedBinding", "\"", ">", "<", "soap", ":", "address", "location", "=", "\"", "https", ":", "//", "localhost", ":", "9002", "/", "DoubleItX509TransportSignedEndorsingEncrypted", "\"", "/", ">", "<", "/", "wsdl", ":", "port", ">", "<", "wsdl", ":", "port", "name", "=", "\"", "DoubleItTransportSupportingSignedPort", "\"", "binding", "=", "\"", "tns", ":", "DoubleItTransportSupportingSignedBinding", "\"", ">", "<", "soap", ":", "address", "location", "=", "\"", "https", ":", "//", "localhost", ":", "9002", "/", "DoubleItX509TransportSupportingSigned", "\"", "/", ">", "<", "/", "wsdl", ":", "port", ">", "<", "/", "wsdl", ":", "service", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItKeyIdentifierPolicy", "\"", ">", "@", "@", "-", "778", ",", "6", "+", "799", ",", "55", "@", "@", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItTransportSupportingSignedPolicy", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "<", "wsp", ":", "All", ">", "<", "wsaws", ":", "UsingAddressing", "xmlns", ":", "wsaws", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2006", "/", "05", "/", "addressing", "/", "wsdl", "\"", "/", ">", "<", "sp", ":", "TransportBinding", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "TransportToken", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "HttpsToken", ">", "<", "wsp", ":", "Policy", "/", ">", "<", "/", "sp", ":", "HttpsToken", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportToken", ">", "<", "sp", ":", "Layout", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Lax", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "Layout", ">", "<", "sp", ":", "IncludeTimestamp", "/", ">", "<", "sp", ":", "AlgorithmSuite", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Basic128", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "AlgorithmSuite", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "TransportBinding", ">", "<", "sp", ":", "EndorsingSupportingTokens", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "X509Token", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "AlwaysToRecipient", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "WssX509V3Token10", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "X509Token", ">", "<", "sp", ":", "SignedParts", ">", "<", "sp", ":", "Body", "/", ">", "<", "sp", ":", "Header", "Name", "=", "\"", "To", "\"", "Namespace", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2005", "/", "08", "/", "addressing", "\"", "/>", "<", "/", "sp", ":", "SignedParts", ">", "<", "!-", "-", "<", "sp", ":", "SignedElements", ">", "<", "sp", ":", "XPath", ">", "//", "ReplyTo", "<", "/", "sp", ":", "XPath", ">", "<", "/", "sp", ":", "SignedElements", ">", "-", "->", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "EndorsingSupportingTokens", ">", "<", "/", "wsp", ":", "All", ">", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItBinding_DoubleIt_Input_Policy", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "@", "@", "-", "211", ",", "6", "+", "211", ",", "17", "@", "@", "<", "/", "jaxws", ":", "properties", ">", "<", "/", "jaxws", ":", "client", ">", "<", "jaxws", ":", "client", "name", "=", "\"{", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "}", "DoubleItTransportSupportingSignedPort", "\"", "createdFromAPI", "=", "\"", "true", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "properties", "\"", "value", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "wssec10", "/", "client", "/", "alice", ".", "properties", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "username", "\"", "value", "=", "\"", "alice", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "wssec10", ".", "client", ".", "KeystorePasswordCallback", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "/", "jaxws", ":", "client", ">", "<", "http", ":", "conduit", "name", "=", "\"", "https", ":", "//", "localhost", ":", ".*", "\">", "<", "http", ":", "tlsClientParameters", "disableCNCheck", "=", "\"", "true", "\"", ">", "<", "sec", ":", "trustManagers", ">", "@", "@", "-", "347", ",", "4", "+", "347", ",", "21", "@", "@", "<", "/", "jaxws", ":", "endpoint", ">", "<", "jaxws", ":", "endpoint", "id", "=", "\"", "TransportSupportingSigned", "\"", "address", "=", "\"", "https", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", ".", "2", "}", "/", "DoubleItX509TransportSupportingSigned", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItTransportSupportingSignedPort", "\"", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "x509", "/", "DoubleItX509", ".", "wsdl", "\"", "depends", "-", "on", "=", "\"", "tls", "-", "settings", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "encryption", ".", "properties", "\"", "value", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "wssec10", "/", "client", "/", "alice", ".", "properties", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "/", "jaxws", ":", "endpoint", ">", "<", "/", "beans", ">"], "docstring_tokens": ["bypass", "security", "restrictions"]}
{"contents": ["NFS:", "Fix", "an", "O_DIRECT", "Oops...", "We", "can't", "call", "nfs_readdata_release()/nfs_writedata_release()", "without", "first", "initialising", "and", "referencing", "args.context.", "Doing", "so", "inside", "nfs_direct_read_schedule_segment()/nfs_direct_write_schedule_segment()", "causes", "an", "Oops.", "We", "should", "rather", "be", "calling", "nfs_readdata_free()/nfs_writedata_free()", "in", "those", "cases.", "Looking", "at", "the", "O_DIRECT", "code,", "the", "\"struct", "nfs_direct_req\"", "is", "already", "referencing", "the", "nfs_open_context", "for", "us.", "Since", "the", "readdata", "and", "writedata", "structures", "carry", "a", "reference", "to", "that,", "we", "can", "simplify", "things", "by", "getting", "rid", "of", "the", "extra", "nfs_open_context", "references,", "so", "that", "we", "can", "replace", "all", "instances", "of", "nfs_readdata_release()/nfs_writedata_release().", "Reported-by:", "Catalin", "Marinas", "<catalin.marinas@arm.com>", "Signed-off-by:", "Trond", "Myklebust", "<Trond.Myklebust@netapp.com>", "Tested-by:", "Catalin", "Marinas", "<catalin.marinas@arm.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "255", ",", "7", "+", "255", ",", "7", "@", "@", "static", "void", "nfs_direct_read_release", "(", "void", "*", "calldata", ")", "if", "(", "put_dreq", "(", "dreq", ")", ")", "nfs_direct_complete", "(", "dreq", ")", ";", "nfs_readdata_release", "(", "calldata", ")", ";", "nfs_readdata_free", "(", "data", ")", ";", "}", "static", "const", "struct", "rpc_call_ops", "nfs_read_direct_ops", "=", "{", "@", "@", "-", "314", ",", "14", "+", "314", ",", "14", "@", "@", "static", "ssize_t", "nfs_direct_read_schedule_segment", "(", "struct", "nfs_direct_req", "*", "dreq", ",", "data", "-", ">", "npages", ",", "1", ",", "0", ",", "data", "-", ">", "pagevec", ",", "NULL", ")", ";", "up_read", "(", "&", "current", "-", ">", "mm", "-", ">", "mmap_sem", ")", ";", "if", "(", "result", "<", "0", ")", "{", "nfs_readdata_release", "(", "data", ")", ";", "nfs_readdata_free", "(", "data", ")", ";", "break", ";", "}", "if", "(", "(", "unsigned", ")", "result", "<", "data", "-", ">", "npages", ")", "{", "bytes", "=", "result", "*", "PAGE_SIZE", ";", "if", "(", "bytes", "<", "=", "pgbase", ")", "{", "nfs_direct_release_pages", "(", "data", "-", ">", "pagevec", ",", "result", ")", ";", "nfs_readdata_release", "(", "data", ")", ";", "nfs_readdata_free", "(", "data", ")", ";", "break", ";", "}", "bytes", "-", "=", "pgbase", ";", "@", "@", "-", "334", ",", "7", "+", "334", ",", "7", "@", "@", "static", "ssize_t", "nfs_direct_read_schedule_segment", "(", "struct", "nfs_direct_req", "*", "dreq", ",", "data", "-", ">", "inode", "=", "inode", ";", "data", "-", ">", "cred", "=", "msg", ".", "rpc_cred", ";", "data", "-", ">", "args", ".", "fh", "=", "NFS_FH", "(", "inode", ")", ";", "data", "-", ">", "args", ".", "context", "=", "get_nfs_open_context", "(", "ctx", ")", ";", "data", "-", ">", "args", ".", "context", "=", "ctx", ";", "data", "-", ">", "args", ".", "offset", "=", "pos", ";", "data", "-", ">", "args", ".", "pgbase", "=", "pgbase", ";", "data", "-", ">", "args", ".", "pages", "=", "data", "-", ">", "pagevec", ";", "@", "@", "-", "441", ",", "7", "+", "441", ",", "7", "@", "@", "static", "void", "nfs_direct_free_writedata", "(", "struct", "nfs_direct_req", "*", "dreq", ")", "struct", "nfs_write_data", "*", "data", "=", "list_entry", "(", "dreq", "-", ">", "rewrite_list", ".", "next", ",", "struct", "nfs_write_data", ",", "pages", ")", ";", "list_del", "(", "&", "data", "-", ">", "pages", ")", ";", "nfs_direct_release_pages", "(", "data", "-", ">", "pagevec", ",", "data", "-", ">", "npages", ")", ";", "nfs_writedata_release", "(", "data", ")", ";", "nfs_writedata_free", "(", "data", ")", ";", "}", "}", "@", "@", "-", "534", ",", "7", "+", "534", ",", "7", "@", "@", "static", "void", "nfs_direct_commit_release", "(", "void", "*", "calldata", ")", "dprintk", "(", "\"", "NFS", ":", "%", "5u", "commit", "returned", "%", "d", "\\", "n", "\"", ",", "data", "-", ">", "task", ".", "tk_pid", ",", "status", ")", ";", "nfs_direct_write_complete", "(", "dreq", ",", "data", "-", ">", "inode", ")", ";", "nfs_commitdata_release", "(", "calldata", ")", ";", "nfs_commit_free", "(", "data", ")", ";", "}", "static", "const", "struct", "rpc_call_ops", "nfs_commit_direct_ops", "=", "{", "@", "@", "-", "570", ",", "7", "+", "570", ",", "7", "@", "@", "static", "void", "nfs_direct_commit_schedule", "(", "struct", "nfs_direct_req", "*", "dreq", ")", "data", "-", ">", "args", ".", "fh", "=", "NFS_FH", "(", "data", "-", ">", "inode", ")", ";", "data", "-", ">", "args", ".", "offset", "=", "0", ";", "data", "-", ">", "args", ".", "count", "=", "0", ";", "data", "-", ">", "args", ".", "context", "=", "get_nfs_open_context", "(", "dreq", "-", ">", "ctx", ")", ";", "data", "-", ">", "args", ".", "context", "=", "dreq", "-", ">", "ctx", ";", "data", "-", ">", "res", ".", "count", "=", "0", ";", "data", "-", ">", "res", ".", "fattr", "=", "&", "data", "-", ">", "fattr", ";", "data", "-", ">", "res", ".", "verf", "=", "&", "data", "-", ">", "verf", ";", "@", "@", "-", "734", ",", "14", "+", "734", ",", "14", "@", "@", "static", "ssize_t", "nfs_direct_write_schedule_segment", "(", "struct", "nfs_direct_req", "*", "dreq", ",", "data", "-", ">", "npages", ",", "0", ",", "0", ",", "data", "-", ">", "pagevec", ",", "NULL", ")", ";", "up_read", "(", "&", "current", "-", ">", "mm", "-", ">", "mmap_sem", ")", ";", "if", "(", "result", "<", "0", ")", "{", "nfs_writedata_release", "(", "data", ")", ";", "nfs_writedata_free", "(", "data", ")", ";", "break", ";", "}", "if", "(", "(", "unsigned", ")", "result", "<", "data", "-", ">", "npages", ")", "{", "bytes", "=", "result", "*", "PAGE_SIZE", ";", "if", "(", "bytes", "<", "=", "pgbase", ")", "{", "nfs_direct_release_pages", "(", "data", "-", ">", "pagevec", ",", "result", ")", ";", "nfs_writedata_release", "(", "data", ")", ";", "nfs_writedata_free", "(", "data", ")", ";", "break", ";", "}", "bytes", "-", "=", "pgbase", ";", "@", "@", "-", "756", ",", "7", "+", "756", ",", "7", "@", "@", "static", "ssize_t", "nfs_direct_write_schedule_segment", "(", "struct", "nfs_direct_req", "*", "dreq", ",", "data", "-", ">", "inode", "=", "inode", ";", "data", "-", ">", "cred", "=", "msg", ".", "rpc_cred", ";", "data", "-", ">", "args", ".", "fh", "=", "NFS_FH", "(", "inode", ")", ";", "data", "-", ">", "args", ".", "context", "=", "get_nfs_open_context", "(", "ctx", ")", ";", "data", "-", ">", "args", ".", "context", "=", "ctx", ";", "data", "-", ">", "args", ".", "offset", "=", "pos", ";", "data", "-", ">", "args", ".", "pgbase", "=", "pgbase", ";", "data", "-", ">", "args", ".", "pages", "=", "data", "-", ">", "pagevec", ";", "@", "@", "-", "60", ",", "17", "+", "60", ",", "15", "@", "@", "struct", "nfs_read_data", "*", "nfs_readdata_alloc", "(", "unsigned", "int", "pagecount", ")", "return", "p", ";", "}", "static", "void", "nfs_readdata_free", "(", "struct", "nfs_read_data", "*", "p", ")", "void", "nfs_readdata_free", "(", "struct", "nfs_read_data", "*", "p", ")", "{", "if", "(", "p", "&", "&", "(", "p", "-", ">", "pagevec", "!", "=", "&", "p", "-", ">", "page_array", "[", "0", "]", "))", "kfree", "(", "p", "-", ">", "pagevec", ")", ";", "mempool_free", "(", "p", ",", "nfs_rdata_mempool", ")", ";", "}", "void", "nfs_readdata_release", "(", "void", "*", "data", ")", "static", "void", "nfs_readdata_release", "(", "struct", "nfs_read_data", "*", "rdata", ")", "{", "struct", "nfs_read_data", "*", "rdata", "=", "data", ";", "put_nfs_open_context", "(", "rdata", "-", ">", "args", ".", "context", ")", ";", "nfs_readdata_free", "(", "rdata", ")", ";", "}", "@", "@", "-", "87", ",", "17", "+", "87", ",", "15", "@", "@", "struct", "nfs_write_data", "*", "nfs_writedata_alloc", "(", "unsigned", "int", "pagecount", ")", "return", "p", ";", "}", "static", "void", "nfs_writedata_free", "(", "struct", "nfs_write_data", "*", "p", ")", "void", "nfs_writedata_free", "(", "struct", "nfs_write_data", "*", "p", ")", "{", "if", "(", "p", "&", "&", "(", "p", "-", ">", "pagevec", "!", "=", "&", "p", "-", ">", "page_array", "[", "0", "]", "))", "kfree", "(", "p", "-", ">", "pagevec", ")", ";", "mempool_free", "(", "p", ",", "nfs_wdata_mempool", ")", ";", "}", "void", "nfs_writedata_release", "(", "void", "*", "data", ")", "static", "void", "nfs_writedata_release", "(", "struct", "nfs_write_data", "*", "wdata", ")", "{", "struct", "nfs_write_data", "*", "wdata", "=", "data", ";", "put_nfs_open_context", "(", "wdata", "-", ">", "args", ".", "context", ")", ";", "nfs_writedata_free", "(", "wdata", ")", ";", "}", "@", "@", "-", "473", ",", "7", "+", "473", ",", "6", "@", "@", "extern", "int", "nfs_writepages", "(", "struct", "address_space", "*", ",", "struct", "writeback_control", "*", ");", "extern", "int", "nfs_flush_incompatible", "(", "struct", "file", "*", "file", ",", "struct", "page", "*", "page", ")", ";", "extern", "int", "nfs_updatepage", "(", "struct", "file", "*", ",", "struct", "page", "*", ",", "unsigned", "int", ",", "unsigned", "int", ")", ";", "extern", "int", "nfs_writeback_done", "(", "struct", "rpc_task", "*", ",", "struct", "nfs_write_data", "*", ");", "extern", "void", "nfs_writedata_release", "(", "void", "*", ");", "/", "*", "*", "Try", "to", "write", "back", "everything", "synchronously", "(", "but", "check", "the", "@", "@", "-", "488", ",", "7", "+", "487", ",", "6", "@", "@", "extern", "int", "nfs_wb_page_cancel", "(", "struct", "inode", "*", "inode", ",", "struct", "page", "*", "page", ")", ";", "extern", "int", "nfs_commit_inode", "(", "struct", "inode", "*", ",", "int", ")", ";", "extern", "struct", "nfs_write_data", "*", "nfs_commitdata_alloc", "(", "void", ")", ";", "extern", "void", "nfs_commit_free", "(", "struct", "nfs_write_data", "*", "wdata", ")", ";", "extern", "void", "nfs_commitdata_release", "(", "void", "*", "wdata", ")", ";", "#", "else", "static", "inline", "int", "nfs_commit_inode", "(", "struct", "inode", "*", "inode", ",", "int", "how", ")", "@", "@", "-", "507", ",", "6", "+", "505", ",", "7", "@", "@", "nfs_have_writebacks", "(", "struct", "inode", "*", "inode", ")", "*", "Allocate", "nfs_write_data", "structures", "*", "/", "extern", "struct", "nfs_write_data", "*", "nfs_writedata_alloc", "(", "unsigned", "int", "npages", ")", ";", "extern", "void", "nfs_writedata_free", "(", "struct", "nfs_write_data", "*", ");", "/", "*", "*", "linux", "/", "fs", "/", "nfs", "/", "read", ".", "c", "@", "@", "-", "515", ",", "14", "+", "514", ",", "14", "@", "@", "extern", "int", "nfs_readpage", "(", "struct", "file", "*", ",", "struct", "page", "*", ");", "extern", "int", "nfs_readpages", "(", "struct", "file", "*", ",", "struct", "address_space", "*", ",", "struct", "list_head", "*", ",", "unsigned", ")", ";", "extern", "int", "nfs_readpage_result", "(", "struct", "rpc_task", "*", ",", "struct", "nfs_read_data", "*", ");", "extern", "void", "nfs_readdata_release", "(", "void", "*", "data", ")", ";", "extern", "int", "nfs_readpage_async", "(", "struct", "nfs_open_context", "*", ",", "struct", "inode", "*", ",", "struct", "page", "*", ");", "/", "*", "*", "Allocate", "nfs_read_data", "structures", "*", "/", "extern", "struct", "nfs_read_data", "*", "nfs_readdata_alloc", "(", "unsigned", "int", "npages", ")", ";", "extern", "void", "nfs_readdata_free", "(", "struct", "nfs_read_data", "*", ");", "/", "*", "*", "linux", "/", "fs", "/", "nfs3proc", ".", "c"], "docstring_tokens": ["the", "kernel", "to", "crash"]}
{"contents": ["fix(shared-ini-file-loader):", "ignore", "prohibited", "profile", "name", "(#1764)", "*", "fix(shared-ini-file-loader):", "ignore", "prohibited", "profile", "name", "*", "fix:", "address", "feedbacks"], "code_tokens": ["@", "@", "-", "289", ",", "6", "+", "289", ",", "20", "@", "@", "aws_session_token", "=", "$", "{", "FOO_CREDS", ".", "sessionToken", "}", "`.", "trim", "(", ")", "}", ",", "}", ");", "}", ");", "it", "(", "\"", "should", "ignore", "profile", "name", "in", "block", "list", "\"", ",", "async", "(", ")", "=", ">", "{", "__addMatcher", "(", "DEFAULT_PATH", ",", "`", "[", "__proto__", "]", "foo", "=", "not_exist", "`", ".", "trim", "(", ")", ")", ";", "expect", "(", "await", "loadSharedConfigFiles", "(", "))", ".", "toEqual", "(", "{", "configFile", ":", "{", "},", "credentialsFile", ":", "{", "},", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "shared", "config", "file", "\"", ",", "(", ")", "=", ">", "{", "@", "@", "-", "527", ",", "5", "+", "541", ",", "19", "@", "@", "aws_session_token", "=", "$", "{", "FOO_CREDS", ".", "sessionToken", "}", "`.", "trim", "(", ")", "configFile", ":", "{", "default", ":", "parsed", ".", "default", "}", ",", "}", ");", "}", ");", "it", "(", "\"", "should", "ignore", "profile", "name", "in", "block", "list", "\"", ",", "async", "(", ")", "=", ">", "{", "__addMatcher", "(", "DEFAULT_PATH", ",", "`", "[", "profile", "__proto__", "]", "foo", "=", "not_exist", "`", ".", "trim", "(", ")", ")", ";", "expect", "(", "await", "loadSharedConfigFiles", "(", "))", ".", "toEqual", "(", "{", "configFile", ":", "{", "},", "credentialsFile", ":", "{", "},", "}", ");", "}", ");", "}", ");", "}", ");", "@", "@", "-", "36", ",", "7", "+", "36", ",", "7", "@", "@", "export", "interface", "SharedConfigFiles", "{", "const", "swallowError", "=", "(", ")", "=", ">", "(", "{}", ");", "export", "function", "loadSharedConfigFiles", "(", "init", ":", "SharedConfigInit", "=", "{", "})", ":", "Promise", "<", "SharedConfigFiles", ">", "{", "export", "const", "loadSharedConfigFiles", "=", "(", "init", ":", "SharedConfigInit", "=", "{", "})", ":", "Promise", "<", "SharedConfigFiles", ">", "=", ">", "{", "const", "{", "filepath", "=", "process", ".", "env", "[", "ENV_CREDENTIALS_PATH", "]", "|", "|", "join", "(", "getHomeDir", "(", "),", "\"", ".", "aws", "\"", ",", "\"", "credentials", "\"", "),", "configFilepath", "=", "process", ".", "env", "[", "ENV_CONFIG_PATH", "]", "|", "|", "join", "(", "getHomeDir", "(", "),", "\"", ".", "aws", "\"", ",", "\"", "config", "\"", "),", "@", "@", "-", "52", ",", "10", "+", "52", ",", "10", "@", "@", "export", "function", "loadSharedConfigFiles", "(", "init", ":", "SharedConfigInit", "=", "{", "})", ":", "Promise", "<", "Shar", "credentialsFile", ",", "}", ";", "}", ");", "}", "}", ";", "const", "profileKeyRegex", "=", "/", "^", "profile", "\\", "s", "(", "[\"", "']", ")?", "([", "^\\", "1", "]", "+)", "\\", "1", "$", "/;", "function", "normalizeConfigFile", "(", "data", ":", "ParsedIniData", ")", ":", "ParsedIniData", "{", "const", "normalizeConfigFile", "=", "(", "data", ":", "ParsedIniData", ")", ":", "ParsedIniData", "=", ">", "{", "const", "map", ":", "ParsedIniData", "=", "{", "};", "for", "(", "const", "key", "of", "Object", ".", "keys", "(", "data", ")", ")", "{", "let", "matches", ":", "Array", "<", "string", ">", "|", "null", ";", "@", "@", "-", "71", ",", "16", "+", "71", ",", "20", "@", "@", "function", "normalizeConfigFile", "(", "data", ":", "ParsedIniData", ")", ":", "ParsedIniData", "{", "}", "return", "map", ";", "}", "}", ";", "function", "parseIni", "(", "iniData", ":", "string", ")", ":", "ParsedIniData", "{", "const", "profileNameBlockList", "=", "[", "\"", "__proto__", "\"", ",", "\"", "profile", "__proto__", "\"", "];", "const", "parseIni", "=", "(", "iniData", ":", "string", ")", ":", "ParsedIniData", "=", ">", "{", "const", "map", ":", "ParsedIniData", "=", "{", "};", "let", "currentSection", ":", "string", "|", "undefined", ";", "for", "(", "let", "line", "of", "iniData", ".", "split", "(", "/\\", "r", "?", "\\", "n", "/", "))", "{", "line", "=", "line", ".", "split", "(", "/(", "^|", "\\", "s", ")", "[;", "#]", "/)", "[", "0", "]", ";", "/", "/", "remove", "comments", "const", "section", "=", "line", ".", "match", "(", "/^", "\\", "s", "*", "\\[", "([", "^\\", "[\\", "]]", "+)", "]\\", "s", "*", "$/", ");", "if", "(", "section", ")", "{", "currentSection", "=", "section", "[", "1", "]", ";", "if", "(", "profileNameBlockList", ".", "includes", "(", "currentSection", ")", ")", "{", "throw", "new", "Error", "(", "`", "Found", "invalid", "profile", "name", "\"", "${", "currentSection", "}", "\"`", ");", "}", "}", "else", "if", "(", "currentSection", ")", "{", "const", "item", "=", "line", ".", "match", "(", "/^", "\\", "s", "*", "(.", "+?", ")\\", "s", "*", "=\\", "s", "*", "(.", "+?", ")\\", "s", "*", "$/", ");", "if", "(", "item", ")", "{", "@", "@", "-", "91", ",", "10", "+", "95", ",", "10", "@", "@", "function", "parseIni", "(", "iniData", ":", "string", ")", ":", "ParsedIniData", "{", "}", "return", "map", ";", "}", "}", ";", "function", "slurpFile", "(", "path", ":", "string", ")", ":", "Promise", "<", "string", ">", "{", "return", "new", "Promise", "(", "(", "resolve", ",", "reject", ")", "=", ">", "{", "const", "slurpFile", "=", "(", "path", ":", "string", ")", ":", "Promise", "<", "string", ">", "=", ">", "new", "Promise", "(", "(", "resolve", ",", "reject", ")", "=", ">", "{", "readFile", "(", "path", ",", "\"", "utf8", "\"", ",", "(", "err", ",", "data", ")", "=", ">", "{", "if", "(", "err", ")", "{", "reject", "(", "err", ")", ";", "@", "@", "-", "103", ",", "14", "+", "107", ",", "13", "@", "@", "function", "slurpFile", "(", "path", ":", "string", ")", ":", "Promise", "<", "string", ">", "{", "}", "}", ");", "}", ");", "}", "function", "getHomeDir", "(", "):", "string", "{", "const", "getHomeDir", "=", "(", "):", "string", "=", ">", "{", "const", "{", "HOME", ",", "USERPROFILE", ",", "HOMEPATH", ",", "HOMEDRIVE", "=", "`", "C", ":", "${", "sep", "}", "`", "}", "=", "process", ".", "env", ";", "if", "(", "HOME", ")", "return", "HOME", ";", "if", "(", "USERPROFILE", ")", "return", "USERPROFILE", ";", "if", "(", "HOMEPATH", ")", "return", "`", "${", "HOMEDRIVE", "}", "${", "HOMEPATH", "}", "`;", "return", "homedir", "(", ");", "}", "}", ";"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["rtl8150:", "Use", "heap", "buffers", "for", "all", "register", "access", "Allocating", "USB", "buffers", "on", "the", "stack", "is", "not", "portable,", "and", "no", "longer", "works", "on", "x86_64", "(with", "VMAP_STACK", "enabled", "as", "per", "default).", "Fixes:", "1da177e4c3f4", "(\"Linux-2.6.12-rc2\")", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "155", ",", "16", "+", "155", ",", "36", "@", "@", "static", "const", "char", "driver_name", "[", "]", "=", "\"", "rtl8150", "\"", ";", "*", "/", "static", "int", "get_registers", "(", "rtl8150_t", "*", "dev", ",", "u16", "indx", ",", "u16", "size", ",", "void", "*", "data", ")", "{", "return", "usb_control_msg", "(", "dev", "-", ">", "udev", ",", "usb_rcvctrlpipe", "(", "dev", "-", ">", "udev", ",", "0", ")", ",", "RTL8150_REQ_GET_REGS", ",", "RTL8150_REQT_READ", ",", "indx", ",", "0", ",", "data", ",", "size", ",", "500", ")", ";", "void", "*", "buf", ";", "int", "ret", ";", "buf", "=", "kmalloc", "(", "size", ",", "GFP_NOIO", ")", ";", "if", "(", "!", "buf", ")", "return", "-", "ENOMEM", ";", "ret", "=", "usb_control_msg", "(", "dev", "-", ">", "udev", ",", "usb_rcvctrlpipe", "(", "dev", "-", ">", "udev", ",", "0", ")", ",", "RTL8150_REQ_GET_REGS", ",", "RTL8150_REQT_READ", ",", "indx", ",", "0", ",", "buf", ",", "size", ",", "500", ")", ";", "if", "(", "ret", ">", "0", "&", "&", "ret", "<", "=", "size", ")", "memcpy", "(", "data", ",", "buf", ",", "ret", ")", ";", "kfree", "(", "buf", ")", ";", "return", "ret", ";", "}", "static", "int", "set_registers", "(", "rtl8150_t", "*", "dev", ",", "u16", "indx", ",", "u16", "size", ",", "void", "*", "data", ")", "static", "int", "set_registers", "(", "rtl8150_t", "*", "dev", ",", "u16", "indx", ",", "u16", "size", ",", "const", "void", "*", "data", ")", "{", "return", "usb_control_msg", "(", "dev", "-", ">", "udev", ",", "usb_sndctrlpipe", "(", "dev", "-", ">", "udev", ",", "0", ")", ",", "RTL8150_REQ_SET_REGS", ",", "RTL8150_REQT_WRITE", ",", "indx", ",", "0", ",", "data", ",", "size", ",", "500", ")", ";", "void", "*", "buf", ";", "int", "ret", ";", "buf", "=", "kmemdup", "(", "data", ",", "size", ",", "GFP_NOIO", ")", ";", "if", "(", "!", "buf", ")", "return", "-", "ENOMEM", ";", "ret", "=", "usb_control_msg", "(", "dev", "-", ">", "udev", ",", "usb_sndctrlpipe", "(", "dev", "-", ">", "udev", ",", "0", ")", ",", "RTL8150_REQ_SET_REGS", ",", "RTL8150_REQT_WRITE", ",", "indx", ",", "0", ",", "buf", ",", "size", ",", "500", ")", ";", "kfree", "(", "buf", ")", ";", "return", "ret", ";", "}", "static", "void", "async_set_reg_cb", "(", "struct", "urb", "*", "urb", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", "or", "memory", "corruption", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["x86/dumpstack:", "Don't", "dump", "kernel", "memory", "based", "on", "usermode", "RIP", "show_opcodes()", "is", "used", "both", "for", "dumping", "kernel", "instructions", "and", "for", "dumping", "user", "instructions.", "If", "userspace", "causes", "#PF", "by", "jumping", "to", "a", "kernel", "address,", "show_opcodes()", "can", "be", "reached", "with", "regs->ip", "controlled", "by", "the", "user,", "pointing", "to", "kernel", "code.", "Make", "sure", "that", "userspace", "can't", "trick", "us", "into", "dumping", "kernel", "memory", "into", "dmesg.", "Fixes:", "7cccf0725cf7", "(\"x86/dumpstack:", "Add", "a", "show_ip()", "function\")", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Reviewed-by:", "Kees", "Cook", "<keescook@chromium.org>", "Reviewed-by:", "Borislav", "Petkov", "<bp@suse.de>", "Cc:", "\"H.", "Peter", "Anvin\"", "<hpa@zytor.com>", "Cc:", "Andy", "Lutomirski", "<luto@kernel.org>", "Cc:", "security@kernel.org", "Cc:", "stable@vger.kernel.org", "Link:", "https://lkml.kernel.org/r/20180828154901.112726-1-jannh@google.com"], "code_tokens": ["@", "@", "-", "111", ",", "6", "+", "111", ",", "6", "@", "@", "static", "inline", "unsigned", "long", "caller_frame_pointer", "(", "void", ")", "return", "(", "unsigned", "long", ")", "frame", ";", "}", "void", "show_opcodes", "(", "u8", "*", "rip", ",", "const", "char", "*", "loglvl", ")", ";", "void", "show_opcodes", "(", "struct", "pt_regs", "*", "regs", ",", "const", "char", "*", "loglvl", ")", ";", "void", "show_ip", "(", "struct", "pt_regs", "*", "regs", ",", "const", "char", "*", "loglvl", ")", ";", "#", "endif", "/", "*", "_ASM_X86_STACKTRACE_H", "*", "/", "@", "@", "-", "90", ",", "14", "+", "90", ",", "24", "@", "@", "static", "void", "printk_stack_address", "(", "unsigned", "long", "address", ",", "int", "reliable", ",", "*", "Thus", ",", "the", "2", "/", "3rds", "prologue", "and", "64", "byte", "OPCODE_BUFSIZE", "is", "just", "a", "random", "*", "guesstimate", "in", "attempt", "to", "achieve", "all", "of", "the", "above", ".", "*", "/", "void", "show_opcodes", "(", "u8", "*", "rip", ",", "const", "char", "*", "loglvl", ")", "void", "show_opcodes", "(", "struct", "pt_regs", "*", "regs", ",", "const", "char", "*", "loglvl", ")", "{", "#", "define", "PROLOGUE_SIZE", "42", "#", "define", "EPILOGUE_SIZE", "21", "#", "define", "OPCODE_BUFSIZE", "(", "PROLOGUE_SIZE", "+", "1", "+", "EPILOGUE_SIZE", ")", "u8", "opcodes", "[", "OPCODE_BUFSIZE", "]", ";", "unsigned", "long", "prologue", "=", "regs", "-", ">", "ip", "-", "PROLOGUE_SIZE", ";", "bool", "bad_ip", ";", "if", "(", "probe_kernel_read", "(", "opcodes", ",", "rip", "-", "PROLOGUE_SIZE", ",", "OPCODE_BUFSIZE", ")", ")", "{", "/", "*", "*", "Make", "sure", "userspace", "isn", "'", "t", "trying", "to", "trick", "us", "into", "dumping", "kernel", "*", "memory", "by", "pointing", "the", "userspace", "instruction", "pointer", "at", "it", ".", "*", "/", "bad_ip", "=", "user_mode", "(", "regs", ")", "&", "&", "__chk_range_not_ok", "(", "prologue", ",", "OPCODE_BUFSIZE", ",", "TASK_SIZE_MAX", ")", ";", "if", "(", "bad_ip", "|", "|", "probe_kernel_read", "(", "opcodes", ",", "(", "u8", "*", ")", "prologue", ",", "OPCODE_BUFSIZE", ")", ")", "{", "printk", "(", "\"%", "sCode", ":", "Bad", "RIP", "value", ".", "\\", "n", "\"", ",", "loglvl", ")", ";", "}", "else", "{", "printk", "(", "\"%", "sCode", ":", "%", "\"", "__stringify", "(", "PROLOGUE_SIZE", ")", "\"", "ph", "<", "%", "02x", ">", "%", "\"", "@", "@", "-", "113", ",", "7", "+", "123", ",", "7", "@", "@", "void", "show_ip", "(", "struct", "pt_regs", "*", "regs", ",", "const", "char", "*", "loglvl", ")", "#", "else", "printk", "(", "\"%", "sRIP", ":", "%", "04x", ":", "%", "pS", "\\", "n", "\"", ",", "loglvl", ",", "(", "int", ")", "regs", "-", ">", "cs", ",", "(", "void", "*", ")", "regs", "-", ">", "ip", ")", ";", "#", "endif", "show_opcodes", "(", "(", "u8", "*", ")", "regs", "-", ">", "ip", ",", "loglvl", ")", ";", "show_opcodes", "(", "regs", ",", "loglvl", ")", ";", "}", "void", "show_iret_regs", "(", "struct", "pt_regs", "*", "regs", ")", "@", "@", "-", "837", ",", "7", "+", "837", ",", "7", "@", "@", "show_signal_msg", "(", "struct", "pt_regs", "*", "regs", ",", "unsigned", "long", "error_code", ",", "printk", "(", "KERN_CONT", "\"", "\\", "n", "\"", ");", "show_opcodes", "(", "(", "u8", "*", ")", "regs", "-", ">", "ip", ",", "loglvl", ")", ";", "show_opcodes", "(", "regs", ",", "loglvl", ")", ";", "}", "static", "void"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["net/packet:", "fix", "overflow", "in", "check", "for", "priv", "area", "size", "Subtracting", "tp_sizeof_priv", "from", "tp_block_size", "and", "casting", "to", "int", "to", "check", "whether", "one", "is", "less", "then", "the", "other", "doesn't", "always", "work", "(both", "of", "them", "are", "unsigned", "ints).", "Compare", "them", "as", "is", "instead.", "Also", "cast", "tp_sizeof_priv", "to", "u64", "before", "using", "BLK_PLUS_PRIV,", "as", "it", "can", "overflow", "inside", "BLK_PLUS_PRIV", "otherwise.", "Signed-off-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Acked-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "4193", ",", "8", "+", "4193", ",", "8", "@", "@", "static", "int", "packet_set_ring", "(", "struct", "sock", "*", "sk", ",", "union", "tpacket_req_u", "*", "req_u", ",", "if", "(", "unlikely", "(", "!", "PAGE_ALIGNED", "(", "req", "-", ">", "tp_block_size", ")", "))", "goto", "out", ";", "if", "(", "po", "-", ">", "tp_version", ">", "=", "TPACKET_V3", "&", "&", "(", "int", ")", "(", "req", "-", ">", "tp_block_size", "BLK_PLUS_PRIV", "(", "req_u", "-", ">", "req3", ".", "tp_sizeof_priv", ")", ")", "<", "=", "0", ")", "req", "-", ">", "tp_block_size", "<", "=", "BLK_PLUS_PRIV", "(", "(", "u64", ")", "req_u", "-", ">", "req3", ".", "tp_sizeof_priv", ")", ")", "goto", "out", ";", "if", "(", "unlikely", "(", "req", "-", ">", "tp_frame_size", "<", "po", "-", ">", "tp_hdrlen", "+", "po", "-", ">", "tp_reserve", ")", ")"], "docstring_tokens": ["a", "denial", "of", "service", "(overflow", ")"]}
{"contents": ["fs:", "pipe.c", "null", "pointer", "dereference", "This", "patch", "fixes", "a", "null", "pointer", "exception", "in", "pipe_rdwr_open()", "which", "generates", "the", "stack", "trace:", ">", "Unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000028", "RIP:", ">", "[<ffffffff802899a5>]", "pipe_rdwr_open+0x35/0x70", ">", "[<ffffffff8028125c>]", "__dentry_open+0x13c/0x230", ">", "[<ffffffff8028143d>]", "do_filp_open+0x2d/0x40", ">", "[<ffffffff802814aa>]", "do_sys_open+0x5a/0x100", ">", "[<ffffffff8021faf3>]", "sysenter_do_call+0x1b/0x67", "The", "failure", "mode", "is", "triggered", "by", "an", "attempt", "to", "open", "an", "anonymous", "pipe", "via", "/proc/pid/fd/*", "as", "exemplified", "by", "this", "script:", "=============================================================", "while", ":", ";", "do", "{", "echo", "y", ";", "sleep", "1", ";", "}", "|", "{", "while", "read", ";", "do", "echo", "z$REPLY;", "done", ";", "}", "&", "PID=$!", "OUT=$(ps", "-efl", "|", "grep", "'sleep", "1'", "|", "grep", "-v", "grep", "|", "{", "read", "PID", "REST", ";", "echo", "$PID;", "}", ")", "OUT=\"${OUT%%", "*}\"", "DELAY=$((RANDOM", "*", "1000", "/", "32768))", "usleep", "$((DELAY", "*", "1000", "+", "RANDOM", "%", "1000", "))", "echo", "n", ">", "/proc/$OUT/fd/1", "#", "Trigger", "defect", "done", "=============================================================", "Note", "that", "the", "failure", "window", "is", "quite", "small", "and", "I", "could", "only", "reliably", "reproduce", "the", "defect", "by", "inserting", "a", "small", "delay", "in", "pipe_rdwr_open().", "For", "example:", "static", "int", "pipe_rdwr_open(struct", "inode", "*inode,", "struct", "file", "*filp)", "{", "msleep(100);", "mutex_lock(&inode->i_mutex);", "Although", "the", "defect", "was", "observed", "in", "pipe_rdwr_open(),", "I", "think", "it", "makes", "sense", "to", "replicate", "the", "change", "through", "all", "the", "pipe_*_open()", "functions.", "The", "core", "of", "the", "change", "is", "to", "verify", "that", "inode->i_pipe", "has", "not", "been", "released", "before", "attempting", "to", "manipulate", "it.", "If", "inode->i_pipe", "is", "no", "longer", "present,", "return", "ENOENT", "to", "indicate", "so.", "The", "comment", "about", "potentially", "using", "atomic_t", "for", "i_pipe->readers", "and", "i_pipe->writers", "has", "also", "been", "removed", "because", "it", "is", "no", "longer", "relevant", "in", "this", "context.", "The", "inode->i_mutex", "lock", "must", "be", "used", "so", "that", "inode->i_pipe", "can", "be", "dealt", "with", "correctly.", "Signed-off-by:", "Earl", "Chew", "<earl_chew@agilent.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "777", ",", "36", "+", "777", ",", "55", "@", "@", "pipe_rdwr_release", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ")", "static", "int", "pipe_read_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ")", "{", "/", "*", "We", "could", "have", "perhaps", "used", "atomic_t", ",", "but", "this", "and", "friends", "below", "are", "the", "only", "places", ".", "So", "it", "doesn", "'", "t", "seem", "worthwhile", ".", "*", "/", "int", "ret", "=", "-", "ENOENT", ";", "mutex_lock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "inode", "-", ">", "i_pipe", "-", ">", "readers", "+", "+;", "if", "(", "inode", "-", ">", "i_pipe", ")", "{", "ret", "=", "0", ";", "inode", "-", ">", "i_pipe", "-", ">", "readers", "+", "+;", "}", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "return", "0", ";", "return", "ret", ";", "}", "static", "int", "pipe_write_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ")", "{", "int", "ret", "=", "-", "ENOENT", ";", "mutex_lock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "inode", "-", ">", "i_pipe", "-", ">", "writers", "+", "+;", "if", "(", "inode", "-", ">", "i_pipe", ")", "{", "ret", "=", "0", ";", "inode", "-", ">", "i_pipe", "-", ">", "writers", "+", "+;", "}", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "return", "0", ";", "return", "ret", ";", "}", "static", "int", "pipe_rdwr_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ")", "{", "int", "ret", "=", "-", "ENOENT", ";", "mutex_lock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "if", "(", "filp", "-", ">", "f_mode", "&", "FMODE_READ", ")", "inode", "-", ">", "i_pipe", "-", ">", "readers", "+", "+;", "if", "(", "filp", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "inode", "-", ">", "i_pipe", "-", ">", "writers", "+", "+;", "if", "(", "inode", "-", ">", "i_pipe", ")", "{", "ret", "=", "0", ";", "if", "(", "filp", "-", ">", "f_mode", "&", "FMODE_READ", ")", "inode", "-", ">", "i_pipe", "-", ">", "readers", "+", "+;", "if", "(", "filp", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "inode", "-", ">", "i_pipe", "-", ">", "writers", "+", "+;", "}", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "return", "0", ";", "return", "ret", ";", "}", "/", "*"], "docstring_tokens": ["gain", "elevated", "privileges", "on", "the", "system", "or", "cause", "a", "kernel", "panic"]}
{"contents": ["Merge", "pull", "request", "#87", "from", "toddjonker/latency-fix", "Prevent", "unbounded", "latency", "converting", "decimals", "to", "time"], "code_tokens": ["@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "com", ".", "fasterxml", ".", "jackson", ".", "datatype", ".", "jsr310", ";", "import", "java", ".", "math", ".", "BigDecimal", ";", "import", "java", ".", "util", ".", "function", ".", "BiFunction", ";", "/", "**", "*", "Utilities", "to", "aid", "in", "the", "translation", "of", "decimal", "types", "to", "/", "from", "multiple", "parts", ".", "@", "@", "-", "39", ",", "14", "+", "40", ",", "14", "@", "@", "public", "static", "String", "toDecimal", "(", "long", "seconds", ",", "int", "nanoseconds", ")", ".", "append", "(", "seconds", ")", ".", "append", "(", "'.", "')", ";", "/", "/", "14", "-", "Mar", "-", "2016", ",", "tatu", ":", "Although", "we", "do", "not", "yet", "(", "with", "2", ".", "7", ")", "trim", "trailing", "zeroes", ",", "/", "/", "for", "general", "case", ",", "/", "/", "for", "general", "case", ",", "if", "(", "nanoseconds", "=", "=", "0L", ")", "{", "/", "/", "!", "!!", "TODO", ":", "14", "-", "Mar", "-", "2016", ",", "tatu", ":", "as", "per", "[", "datatype", "-", "jsr310", "]", ",", "should", "trim", "/", "/", "trailing", "zeroes", "if", "(", "seconds", "=", "=", "0L", ")", "{", "return", "\"", "0", ".", "0", "\"", ";", "}", "/", "/", "sb", ".", "append", "(", "'", "0", "'", ");", "sb", ".", "append", "(", "\"", "000000000", "\"", ");", "}", "else", "{", "@", "@", "-", "92", ",", "12", "+", "93", ",", "51", "@", "@", "public", "static", "BigDecimal", "toBigDecimal", "(", "long", "seconds", ",", "int", "nanoseconds", ")", "}", "return", "new", "BigDecimal", "(", "toDecimal", "(", "seconds", ",", "nanoseconds", ")", ");", "}", "/", "**", "*", "@", "Deprecated", "due", "to", "potential", "unbounded", "latency", "on", "some", "JRE", "releases", ".", "*", "/", "public", "static", "int", "extractNanosecondDecimal", "(", "BigDecimal", "value", ",", "long", "integer", ")", "{", "/", "/", "!", "!!", "14", "-", "Mar", "-", "2016", ",", "tatu", ":", "Somewhat", "inefficient", ";", "should", "replace", "with", "functionally", "/", "/", "equivalent", "code", "that", "just", "subtracts", "integral", "part", "?", "(", "or", ",", "measure", "and", "show", "/", "/", "there", "'", "s", "no", "difference", "and", "do", "nothing", ".", "..", ")", "return", "value", ".", "subtract", "(", "new", "BigDecimal", "(", "integer", ")", ").", "multiply", "(", "ONE_BILLION", ")", ".", "intValue", "(", ");", "}", "/", "**", "*", "Extracts", "the", "seconds", "and", "nanoseconds", "component", "of", "{", "@", "code", "seconds", "}", "as", "{", "@", "code", "long", "}", "and", "{", "@", "code", "int", "}", "*", "values", ",", "passing", "them", "to", "the", "given", "converter", ".", "The", "implementation", "avoids", "latency", "issues", "present", "*", "on", "some", "JRE", "releases", ".", "*", "*", "@", "since", "2", ".", "9", ".", "8", "*", "/", "public", "static", "<", "T", ">", "T", "extractSecondsAndNanos", "(", "BigDecimal", "seconds", ",", "BiFunction", "<", "Long", ",", "Integer", ",", "T", ">", "convert", ")", "{", "/", "/", "Complexity", "is", "here", "to", "workaround", "unbounded", "latency", "in", "some", "BigDecimal", "operations", ".", "/", "/", "https", ":", "//", "github", ".", "com", "/", "FasterXML", "/", "jackson", "-", "databind", "/", "issues", "/", "2141", "long", "secondsOnly", ";", "int", "nanosOnly", ";", "BigDecimal", "nanoseconds", "=", "seconds", ".", "scaleByPowerOfTen", "(", "9", ")", ";", "if", "(", "nanoseconds", ".", "precision", "(", ")", "-", "nanoseconds", ".", "scale", "(", ")", "<", "=", "0", ")", "{", "/", "/", "There", "are", "no", "non", "-", "zero", "digits", "to", "the", "left", "of", "the", "decimal", "point", ".", "/", "/", "This", "protects", "against", "very", "negative", "exponents", ".", "secondsOnly", "=", "nanosOnly", "=", "0", ";", "}", "else", "if", "(", "seconds", ".", "scale", "(", ")", "<", "-", "63", ")", "{", "/", "/", "There", "would", "be", "no", "low", "-", "order", "bits", "once", "we", "chop", "to", "a", "long", ".", "/", "/", "This", "protects", "against", "very", "positive", "exponents", ".", "secondsOnly", "=", "nanosOnly", "=", "0", ";", "}", "else", "{", "/", "/", "Now", "we", "know", "that", "seconds", "has", "reasonable", "scale", ",", "we", "can", "safely", "chop", "it", "apart", ".", "secondsOnly", "=", "seconds", ".", "longValue", "(", ");", "nanosOnly", "=", "nanoseconds", ".", "subtract", "(", "new", "BigDecimal", "(", "secondsOnly", ")", ".", "scaleByPowerOfTen", "(", "9", ")", ").", "intValue", "(", ");", "}", "return", "convert", ".", "apply", "(", "secondsOnly", ",", "nanosOnly", ")", ";", "}", "}", "@", "@", "-", "52", ",", "9", "+", "52", ",", "7", "@", "@", "public", "Duration", "deserialize", "(", "JsonParser", "parser", ",", "DeserializationContext", "context", ")", "t", "{", "case", "JsonTokenId", ".", "ID_NUMBER_FLOAT", ":", "BigDecimal", "value", "=", "parser", ".", "getDecimalValue", "(", ");", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "return", "Duration", ".", "ofSeconds", "(", "seconds", ",", "nanoseconds", ")", ";", "return", "DecimalUtils", ".", "extractSecondsAndNanos", "(", "value", ",", "Duration", ":", ":", "ofSeconds", ")", ";", "case", "JsonTokenId", ".", "ID_NUMBER_INT", ":", "if", "(", "context", ".", "isEnabled", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ")", "{", "@", "@", "-", "91", ",", "7", "+", "91", ",", "7", "@", "@", "protected", "final", "Function", "<", "FromDecimalArguments", ",", "T", ">", "fromNanoseconds", ";", "protected", "final", "Function", "<", "TemporalAccessor", ",", "T", ">", "parsedToValue", ";", "protected", "final", "BiFunction", "<", "T", ",", "ZoneId", ",", "T", ">", "adjust", ";", "/", "**", "@", "@", "-", "150", ",", "7", "+", "150", ",", "7", "@", "@", "protected", "InstantDeserializer", "(", "InstantDeserializer", "<", "T", ">", "base", ",", "Boolean", "adjustToConte", "replaceZeroOffsetAsZ", "=", "base", ".", "replaceZeroOffsetAsZ", ";", "_adjustToContextTZOverride", "=", "adjustToContextTimezoneOverride", ";", "}", "@", "Override", "protected", "JsonDeserializer", "<", "T", ">", "withDateFormat", "(", "DateTimeFormatter", "dtf", ")", "{", "if", "(", "dtf", "=", "=", "_formatter", ")", "{", "@", "@", "-", "218", ",", "7", "+", "218", ",", "7", "@", "@", "public", "T", "deserialize", "(", "JsonParser", "parser", ",", "DeserializationContext", "context", ")", "throws", "I", "/", "/", "20", "-", "Apr", "-", "2016", ",", "tatu", ":", "Related", "to", "[", "databind", "#", "1208", "]", ",", "can", "try", "supporting", "embedded", "/", "/", "values", "quite", "easily", "return", "(", "T", ")", "parser", ".", "getEmbeddedObject", "(", ");", "case", "JsonTokenId", ".", "ID_START_ARRAY", ":", "return", "_deserializeFromArray", "(", "parser", ",", "context", ")", ";", "}", "@", "@", "-", "265", ",", "7", "+", "265", ",", "7", "@", "@", "protected", "int", "_countPeriods", "(", "String", "str", ")", "}", "return", "commas", ";", "}", "protected", "T", "_fromLong", "(", "DeserializationContext", "context", ",", "long", "timestamp", ")", "{", "if", "(", "context", ".", "isEnabled", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", "){", "@", "@", "-", "276", ",", "15", "+", "276", ",", "14", "@", "@", "protected", "T", "_fromLong", "(", "DeserializationContext", "context", ",", "long", "timestamp", ")", "return", "fromMilliseconds", ".", "apply", "(", "new", "FromIntegerArguments", "(", "timestamp", ",", "this", ".", "getZone", "(", "context", ")", "))", ";", "}", "protected", "T", "_fromDecimal", "(", "DeserializationContext", "context", ",", "BigDecimal", "value", ")", "{", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "return", "fromNanoseconds", ".", "apply", "(", "new", "FromDecimalArguments", "(", "seconds", ",", "nanoseconds", ",", "getZone", "(", "context", ")", "))", ";", "FromDecimalArguments", "args", "=", "DecimalUtils", ".", "extractSecondsAndNanos", "(", "value", ",", "(", "s", ",", "ns", ")", "-", ">", "new", "FromDecimalArguments", "(", "s", ",", "ns", ",", "getZone", "(", "context", ")", "))", ";", "return", "fromNanoseconds", ".", "apply", "(", "args", ")", ";", "}", "private", "ZoneId", "getZone", "(", "DeserializationContext", "context", ")", "{", "/", "/", "Instants", "are", "always", "in", "UTC", ",", "so", "don", "'", "t", "waste", "compute", "cycles", "@", "@", "-", "29", ",", "75", "+", "29", ",", "115", "@", "@", "public", "void", "testToDecimal01", "(", ")", "\"", "19827342231", ".", "999888000", "\"", ",", "decimal", ")", ";", "}", "private", "void", "checkExtractNanos", "(", "long", "expectedSeconds", ",", "int", "expectedNanos", ",", "BigDecimal", "decimal", ")", "{", "long", "seconds", "=", "decimal", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "expectedSeconds", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "decimal", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "expectedNanos", ",", "nanoseconds", ")", ";", "}", "@", "Test", "public", "void", "testExtractNanosecondDecimal01", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "0", "\"", ");", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "0L", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "0", ",", "nanoseconds", ")", ";", "checkExtractNanos", "(", "0L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractNanosecondDecimal02", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "15", ".", "000000072", "\"", ");", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "15L", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "72", ",", "nanoseconds", ")", ";", "checkExtractNanos", "(", "15L", ",", "72", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractNanosecondDecimal03", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "15", ".", "72", "\"", ");", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "15L", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "720000000", ",", "nanoseconds", ")", ";", "checkExtractNanos", "(", "15L", ",", "720000000", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractNanosecondDecimal04", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", ".", "192837465", "\"", ");", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "19827342231L", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "192837465", ",", "nanoseconds", ")", ";", "checkExtractNanos", "(", "19827342231L", ",", "192837465", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractNanosecondDecimal05", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", "\"", ");", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "19827342231L", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "0", ",", "nanoseconds", ")", ";", "checkExtractNanos", "(", "19827342231L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractNanosecondDecimal06", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", ".", "999999999", "\"", ");", "checkExtractNanos", "(", "19827342231L", ",", "999999999", ",", "value", ")", ";", "}", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "19827342231L", ",", "seconds", ")", ";", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "999999999", ",", "nanoseconds", ")", ";", "private", "void", "checkExtractSecondsAndNanos", "(", "long", "expectedSeconds", ",", "int", "expectedNanos", ",", "BigDecimal", "decimal", ")", "{", "DecimalUtils", ".", "extractSecondsAndNanos", "(", "decimal", ",", "(", "Long", "s", ",", "Integer", "ns", ")", "-", ">", "{", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "expectedSeconds", ",", "s", ".", "longValue", "(", "))", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "expectedNanos", ",", "ns", ".", "intValue", "(", "))", ";", "return", "null", ";", "}", ");", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos01", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "0", "\"", ");", "checkExtractSecondsAndNanos", "(", "0L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos02", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "15", ".", "000000072", "\"", ");", "checkExtractSecondsAndNanos", "(", "15L", ",", "72", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos03", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "15", ".", "72", "\"", ");", "checkExtractSecondsAndNanos", "(", "15L", ",", "720000000", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos04", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", ".", "192837465", "\"", ");", "checkExtractSecondsAndNanos", "(", "19827342231L", ",", "192837465", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos05", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", "\"", ");", "checkExtractSecondsAndNanos", "(", "19827342231L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos06", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", ".", "999999999", "\"", ");", "checkExtractSecondsAndNanos", "(", "19827342231L", ",", "999999999", ",", "value", ")", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testExtractSecondsAndNanos07", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "1e10000000", "\"", ");", "checkExtractSecondsAndNanos", "(", "0L", ",", "0", ",", "value", ")", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "com", ".", "fasterxml", ".", "jackson", ".", "datatype", ".", "jsr310", ";", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "time", ".", "Duration", ";", "import", "java", ".", "time", ".", "temporal", ".", "TemporalAmount", ";", "@", "@", "-", "61", ",", "6", "+", "62", ",", "130", "@", "@", "public", "void", "testDeserializationAsFloat04", "(", ")", "throws", "Exception", "assertEquals", "(", "\"", "The", "value", "is", "not", "correct", ".", "\",", "Duration", ".", "ofSeconds", "(", "13498L", ",", "8374", ")", ",", "value", ")", ";", "}", "/", "**", "*", "Test", "the", "upper", "-", "bound", "of", "Duration", ".", "*", "/", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase01", "(", ")", "throws", "Exception", "{", "String", "input", "=", "Long", ".", "MAX_VALUE", "+", "\"", ".", "999999999", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "Long", ".", "MAX_VALUE", ",", "value", ".", "getSeconds", "(", "))", ";", "assertEquals", "(", "999999999", ",", "value", ".", "getNano", "(", "))", ";", "}", "/", "**", "*", "Test", "the", "lower", "-", "bound", "of", "Duration", ".", "*", "/", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase02", "(", ")", "throws", "Exception", "{", "String", "input", "=", "Long", ".", "MIN_VALUE", "+", "\"", ".", "0", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "Long", ".", "MIN_VALUE", ",", "value", ".", "getSeconds", "(", "))", ";", "assertEquals", "(", "0", ",", "value", ".", "getNano", "(", "))", ";", "}", "@", "Test", "(", "expected", "=", "ArithmeticException", ".", "class", ")", "public", "void", "testDeserializationAsFloatEdgeCase03", "(", ")", "throws", "Exception", "{", "/", "/", "Duration", "can", "'", "t", "go", "this", "low", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "Long", ".", "MIN_VALUE", "+", "\"", ".", "1", "\"", ");", "}", "/", "*", "*", "DurationDeserializer", "currently", "uses", "BigDecimal", ".", "longValue", "(", ")", "which", "has", "surprising", "behavior", "*", "for", "numbers", "outside", "the", "range", "of", "Long", ".", "Numbers", "less", "than", "1e64", "will", "result", "in", "the", "lower", "64", "bits", ".", "*", "Numbers", "at", "or", "above", "1e64", "will", "always", "result", "in", "zero", ".", "*", "/", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase04", "(", ")", "throws", "Exception", "{", "/", "/", "Just", "beyond", "the", "upper", "-", "bound", "of", "Duration", ".", "String", "input", "=", "new", "BigInteger", "(", "Long", ".", "toString", "(", "Long", ".", "MAX_VALUE", ")", ").", "add", "(", "BigInteger", ".", "ONE", ")", "+", "\"", ".", "0", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "Long", ".", "MIN_VALUE", ",", "value", ".", "getSeconds", "(", "))", ";", "/", "/", "We", "'", "ve", "turned", "a", "positive", "number", "into", "negative", "duration", "!", "}", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase05", "(", ")", "throws", "Exception", "{", "/", "/", "Just", "beyond", "the", "lower", "-", "bound", "of", "Duration", ".", "String", "input", "=", "new", "BigInteger", "(", "Long", ".", "toString", "(", "Long", ".", "MIN_VALUE", ")", ").", "subtract", "(", "BigInteger", ".", "ONE", ")", "+", "\"", ".", "0", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "Long", ".", "MAX_VALUE", ",", "value", ".", "getSeconds", "(", "))", ";", "/", "/", "We", "'", "ve", "turned", "a", "negative", "number", "into", "positive", "duration", "!", "}", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase06", "(", ")", "throws", "Exception", "{", "/", "/", "Into", "the", "positive", "zone", "where", "everything", "becomes", "zero", ".", "String", "input", "=", "\"", "1e64", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getSeconds", "(", "))", ";", "}", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase07", "(", ")", "throws", "Exception", "{", "/", "/", "Into", "the", "negative", "zone", "where", "everything", "becomes", "zero", ".", "String", "input", "=", "\"", "-", "1e64", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getSeconds", "(", "))", ";", "}", "/", "**", "*", "Numbers", "with", "very", "large", "exponents", "can", "take", "a", "long", "time", ",", "but", "still", "result", "in", "zero", ".", "*", "https", ":", "//", "github", ".", "com", "/", "FasterXML", "/", "jackson", "-", "databind", "/", "issues", "/", "2141", "*", "/", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase08", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "1e10000000", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getSeconds", "(", "))", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase09", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "-", "1e10000000", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getSeconds", "(", "))", ";", "}", "/", "**", "*", "Same", "for", "large", "negative", "exponents", ".", "*", "/", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase10", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "1e", "-", "10000000", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getSeconds", "(", "))", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase11", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "-", "1e", "-", "10000000", "\"", ";", "Duration", "value", "=", "READER", ".", "without", "(", "DeserializationFeature", ".", "READ_DATE_TIMESTAMPS_AS_NANOSECONDS", ")", ".", "readValue", "(", "input", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getSeconds", "(", "))", ";", "}", "@", "Test", "public", "void", "testDeserializationAsInt01", "(", ")", "throws", "Exception", "{", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "time", ".", "DateTimeException", ";", "import", "java", ".", "time", ".", "Instant", ";", "import", "java", ".", "time", ".", "LocalDate", ";", "import", "java", ".", "time", ".", "ZoneId", ";", "@", "@", "-", "232", ",", "6", "+", "233", ",", "120", "@", "@", "public", "void", "testDeserializationAsFloat03", "(", ")", "throws", "Exception", "assertEquals", "(", "\"", "The", "value", "is", "not", "correct", ".", "\",", "date", ",", "value", ")", ";", "}", "/", "**", "*", "Test", "the", "upper", "-", "bound", "of", "Instant", ".", "*", "/", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase01", "(", ")", "throws", "Exception", "{", "String", "input", "=", "Instant", ".", "MAX", ".", "getEpochSecond", "(", ")", "+", "\"", ".", "999999999", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "value", ",", "Instant", ".", "MAX", ")", ";", "assertEquals", "(", "Instant", ".", "MAX", ".", "getEpochSecond", "(", "),", "value", ".", "getEpochSecond", "(", "))", ";", "assertEquals", "(", "999999999", ",", "value", ".", "getNano", "(", "))", ";", "}", "/", "**", "*", "Test", "the", "lower", "-", "bound", "of", "Instant", ".", "*", "/", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase02", "(", ")", "throws", "Exception", "{", "String", "input", "=", "Instant", ".", "MIN", ".", "getEpochSecond", "(", ")", "+", "\"", ".", "0", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "value", ",", "Instant", ".", "MIN", ")", ";", "assertEquals", "(", "Instant", ".", "MIN", ".", "getEpochSecond", "(", "),", "value", ".", "getEpochSecond", "(", "))", ";", "assertEquals", "(", "0", ",", "value", ".", "getNano", "(", "))", ";", "}", "@", "Test", "(", "expected", "=", "DateTimeException", ".", "class", ")", "public", "void", "testDeserializationAsFloatEdgeCase03", "(", ")", "throws", "Exception", "{", "/", "/", "Instant", "can", "'", "t", "go", "this", "low", "String", "input", "=", "Instant", ".", "MIN", ".", "getEpochSecond", "(", ")", "+", "\"", ".", "1", "\"", ";", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "}", "/", "*", "*", "InstantDeserializer", "currently", "uses", "BigDecimal", ".", "longValue", "(", ")", "which", "has", "surprising", "behavior", "*", "for", "numbers", "outside", "the", "range", "of", "Long", ".", "Numbers", "less", "than", "1e64", "will", "result", "in", "the", "lower", "64", "bits", ".", "*", "Numbers", "at", "or", "above", "1e64", "will", "always", "result", "in", "zero", ".", "*", "/", "@", "Test", "(", "expected", "=", "DateTimeException", ".", "class", ")", "public", "void", "testDeserializationAsFloatEdgeCase04", "(", ")", "throws", "Exception", "{", "/", "/", "1ns", "beyond", "the", "upper", "-", "bound", "of", "Instant", ".", "String", "input", "=", "(", "Instant", ".", "MAX", ".", "getEpochSecond", "(", ")", "+", "1", ")", "+", "\"", ".", "0", "\"", ";", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "}", "@", "Test", "(", "expected", "=", "DateTimeException", ".", "class", ")", "public", "void", "testDeserializationAsFloatEdgeCase05", "(", ")", "throws", "Exception", "{", "/", "/", "1ns", "beyond", "the", "lower", "-", "bound", "of", "Instant", ".", "String", "input", "=", "(", "Instant", ".", "MIN", ".", "getEpochSecond", "(", ")", "-", "1", ")", "+", "\"", ".", "0", "\"", ";", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "}", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase06", "(", ")", "throws", "Exception", "{", "/", "/", "Into", "the", "positive", "zone", "where", "everything", "becomes", "zero", ".", "String", "input", "=", "\"", "1e64", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getEpochSecond", "(", "))", ";", "}", "@", "Test", "public", "void", "testDeserializationAsFloatEdgeCase07", "(", ")", "throws", "Exception", "{", "/", "/", "Into", "the", "negative", "zone", "where", "everything", "becomes", "zero", ".", "String", "input", "=", "\"", "-", "1e64", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getEpochSecond", "(", "))", ";", "}", "/", "**", "*", "Numbers", "with", "very", "large", "exponents", "can", "take", "a", "long", "time", ",", "but", "still", "result", "in", "zero", ".", "*", "https", ":", "//", "github", ".", "com", "/", "FasterXML", "/", "jackson", "-", "databind", "/", "issues", "/", "2141", "*", "/", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase08", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "1e10000000", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getEpochSecond", "(", "))", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase09", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "-", "1e10000000", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getEpochSecond", "(", "))", ";", "}", "/", "**", "*", "Same", "for", "large", "negative", "exponents", ".", "*", "/", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase10", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "1e", "-", "10000000", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getEpochSecond", "(", "))", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testDeserializationAsFloatEdgeCase11", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "-", "1e", "-", "10000000", "\"", ";", "Instant", "value", "=", "MAPPER", ".", "readValue", "(", "input", ",", "Instant", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "value", ".", "getEpochSecond", "(", "))", ";", "}", "@", "Test", "public", "void", "testDeserializationAsInt01Nanoseconds", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["the", "application", "to", "crash"]}
{"contents": ["RESTEASY-637"], "code_tokens": ["@", "@", "-", "1", ",", "12", "+", "1", ",", "18", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "providers", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "core", ".", "request", ".", "AcceptHeaders", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "logging", ".", "Logger", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ReaderException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "WriterException", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "javax", ".", "servlet", ".", "ServletConfig", ";", "import", "javax", ".", "servlet", ".", "ServletContext", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Consumes", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Produces", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Context", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MediaType", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MultivaluedMap", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "Provider", ";", "@", "@", "-", "32", ",", "13", "+", "38", ",", "26", "@", "@", "@", "Consumes", "(", "{\"", "text", "/", "*+", "xml", "\"", ",", "\"", "application", "/", "*+", "xml", "\"", "})", "public", "class", "DocumentProvider", "extends", "AbstractEntityProvider", "<", "Document", ">", "{", "private", "static", "final", "Logger", "logger", "=", "Logger", ".", "getLogger", "(", "DocumentProvider", ".", "class", ")", ";", "private", "final", "TransformerFactory", "transformerFactory", ";", "private", "final", "DocumentBuilderFactory", "documentBuilder", ";", "private", "boolean", "expandEntityReferences", "=", "true", ";", "public", "DocumentProvider", "(", ")", "public", "DocumentProvider", "(", "@", "Context", "ServletConfig", "servletConfig", ")", "{", "this", ".", "documentBuilder", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "this", ".", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "try", "{", "ServletContext", "context", "=", "servletConfig", ".", "getServletContext", "(", ");", "String", "s", "=", "context", ".", "getInitParameter", "(", "ResteasyContextParameters", ".", "RESTEASY_EXPAND_ENTITY_REFERENCES", ")", ";", "expandEntityReferences", "=", "(", "s", "=", "=", "null", "?", "true", ":", "Boolean", ".", "parseBoolean", "(", "s", ")", ");", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Unable", "to", "retrieve", "ServletContext", ":", "expandEntityReferences", "defaults", "to", "true", "\"", ");", "}", "}", "public", "boolean", "isReadable", "(", "Class", "<", "?>", "clazz", ",", "Type", "type", ",", "@", "@", "-", "54", ",", "6", "+", "73", ",", "7", "@", "@", "public", "Document", "readFrom", "(", "Class", "<", "Document", ">", "clazz", ",", "Type", "type", ",", "{", "try", "{", "documentBuilder", ".", "setExpandEntityReferences", "(", "expandEntityReferences", ")", ";", "return", "documentBuilder", ".", "newDocumentBuilder", "(", ").", "parse", "(", "input", ")", ";", "}", "catch", "(", "Exception", "e", ")", "@", "@", "-", "31", ",", "6", "+", "31", ",", "7", "@", "@", "String", "RESTEASY_SCANNED_BY_DEPLOYER", "=", "\"", "resteasy", ".", "scanned", ".", "by", ".", "deployer", "\"", ";", "String", "RESTEASY_JNDI_COMPONENT_RESOURCES", "=", "\"", "resteasy", ".", "jndi", ".", "component", ".", "resources", "\"", ";", "String", "RESTEASY_UNWRAPPED_EXCEPTIONS", "=", "\"", "resteasy", ".", "unwrapped", ".", "exceptions", "\"", ";", "String", "RESTEASY_EXPAND_ENTITY_REFERENCES", "=", "\"", "resteasy", ".", "document", ".", "expand", ".", "entity", ".", "references", "\"", ";", "/", "/", "these", "scanned", "variables", "are", "provided", "by", "a", "deployer", "String", "RESTEASY_SCANNED_RESOURCES", "=", "\"", "resteasy", ".", "scanned", ".", "resources", "\"", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "8", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "tjws", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "Acme", ".", "Serve", ".", "Serve", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "embedded", ".", "EmbeddedJaxrsServer", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "embedded", ".", "SecurityDomain", ";", "@", "@", "-", "15", ",", "6", "+", "18", ",", "8", "@", "@", "protected", "TJWSServletDispatcher", "servlet", "=", "new", "TJWSServletDispatcher", "(", ");", "protected", "String", "rootResourcePath", "=", "\"", "\";", "protected", "Hashtable", "<", "String", ",", "String", ">", "initParameters", ";", "protected", "Hashtable", "<", "String", ",", "String", ">", "contextParameters", ";", "public", "void", "setRootResourcePath", "(", "String", "rootResourcePath", ")", "{", "@", "@", "-", "35", ",", "11", "+", "40", ",", "21", "@", "@", "public", "void", "setDeployment", "(", "ResteasyDeployment", "deployment", ")", "this", ".", "deployment", "=", "deployment", ";", "}", "public", "void", "setInitParameters", "(", "Hashtable", "<", "String", ",", "String", ">", "initParameters", ")", "{", "this", ".", "initParameters", "=", "initParameters", ";", "}", "public", "void", "setContextParameters", "(", "Hashtable", "<", "String", ",", "String", ">", "contextParameters", ")", "{", "this", ".", "contextParameters", "=", "contextParameters", ";", "}", "@", "Override", "public", "void", "start", "(", ")", "{", "server", ".", "setAttribute", "(", "ResteasyDeployment", ".", "class", ".", "getName", "(", "),", "deployment", ")", ";", "addServlet", "(", "rootResourcePath", ",", "servlet", ")", ";", "addServlet", "(", "rootResourcePath", ",", "servlet", ",", "initParameters", ",", "contextParameters", ")", ";", "servlet", ".", "setContextPath", "(", "rootResourcePath", ")", ";", "super", ".", "start", "(", ");", "}", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "5031104686755790970L", ";", "private", "PathTreeDictionary", "mappingTable", "=", "null", ";", "private", "Hashtable", "<", "String", ",", "String", ">", "initParams", "=", "null", ";", "public", "void", "initFileMappings", "(", ")", "{", "@", "@", "-", "46", ",", "6", "+", "47", ",", "25", "@", "@", "public", "void", "addFileMapping", "(", "String", "context", ",", "File", "directory", ")", "}", "mappingTable", ".", "put", "(", "context", ",", "directory", ")", ";", "}", "public", "String", "getInitParameter", "(", "String", "param", ")", "{", "if", "(", "initParams", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "initParams", ".", "get", "(", "param", ")", ";", "}", "public", "Hashtable", "<", "String", ",", "String", ">", "getInitParams", "(", ")", "{", "return", "initParams", ";", "}", "public", "void", "setInitParams", "(", "Hashtable", "<", "String", ",", "String", ">", "initParams", ")", "{", "this", ".", "initParams", "=", "initParams", ";", "}", "}", "protected", "FileMappingServe", "server", "=", "new", "FileMappingServe", "(", ");", "@", "@", "-", "61", ",", "7", "+", "81", ",", "13", "@", "@", "public", "void", "addServlet", "(", "String", "bindPath", ",", "HttpServlet", "servlet", ",", "Hashtable", "initParam", "{", "server", ".", "addServlet", "(", "bindPath", ",", "servlet", ",", "initParams", ")", ";", "}", "public", "void", "addServlet", "(", "String", "bindPath", ",", "HttpServlet", "servlet", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ",", "Hashtable", "<", "String", ",", "String", ">", "contextParams", ")", "{", "server", ".", "setInitParams", "(", "contextParams", ")", ";", "server", ".", "addServlet", "(", "bindPath", ",", "servlet", ",", "initParams", ")", ";", "}", "public", "void", "setProps", "(", "Properties", "props", ")", "{", "this", ".", "props", ".", "putAll", "(", "props", ")", ";", "@", "@", "-", "4", ",", "14", "+", "4", ",", "16", "@", "@", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ResteasyDeployment", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "bill", "@", "burkecentral", ".", "com", "\"", ">", "Bill", "Burke", "<", "/", "a", ">", "*", "@", "version", "$", "Revision", ":", "1", "$", "*", "/", "public", "class", "EmbeddedContainer", "{", "private", "static", "Class", "bootstrap", "=", "TJWSServletContainer", ".", "class", ";", "private", "static", "Class", "<", "?>", "bootstrap", "=", "TJWSServletContainer", ".", "class", ";", "public", "static", "Class", "getBootstrap", "(", ")", "{", "@", "@", "-", "51", ",", "29", "+", "53", ",", "49", "@", "@", "public", "static", "void", "setBootstrap", "(", "Class", "bootstrap", ")", "public", "static", "ResteasyDeployment", "start", "(", ")", "throws", "Exception", "{", "return", "start", "(", "\"/", "\")", ";", "return", "start", "(", "\"/", "\",", "(", "Hashtable", "<", "String", ",", "String", ">", ")", "null", ")", ";", "}", "public", "static", "void", "start", "(", "ResteasyDeployment", "deployment", ")", "throws", "Exception", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ")", "throws", "Exception", "{", "Method", "start", "=", "bootstrap", ".", "getMethod", "(", "\"", "start", "\"", ",", "ResteasyDeployment", ".", "class", ")", ";", "start", ".", "invoke", "(", "null", ",", "deployment", ")", ";", "return", "start", "(", "bindPath", ",", "null", ",", "null", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "Hashtable", "<", "String", ",", "String", ">", "initParams", ")", "throws", "Exception", "{", "return", "start", "(", "\"/", "\",", "initParams", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ")", "throws", "Exception", "public", "static", "ResteasyDeployment", "start", "(", "Hashtable", "<", "String", ",", "String", ">", "initParams", ",", "Hashtable", "<", "String", ",", "String", ">", "contextParams", ")", "throws", "Exception", "{", "Method", "start", "=", "bootstrap", ".", "getMethod", "(", "\"", "start", "\"", ",", "String", ".", "class", ")", ";", "return", "(", "ResteasyDeployment", ")", "start", ".", "invoke", "(", "null", ",", "bindPath", ")", ";", "return", "start", "(", "\"/", "\",", "initParams", ",", "contextParams", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ")", "throws", "Exception", "{", "Method", "start", "=", "bootstrap", ".", "getMethod", "(", "\"", "start", "\"", ",", "String", ".", "class", ",", "Hashtable", ".", "class", ")", ";", "return", "(", "ResteasyDeployment", ")", "start", ".", "invoke", "(", "null", ",", "bindPath", ",", "initParams", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ",", "Hashtable", "<", "String", ",", "String", ">", "contextParams", ")", "throws", "Exception", "{", "Method", "start", "=", "bootstrap", ".", "getMethod", "(", "\"", "start", "\"", ",", "String", ".", "class", ",", "Hashtable", ".", "class", ",", "Hashtable", ".", "class", ")", ";", "return", "(", "ResteasyDeployment", ")", "start", ".", "invoke", "(", "null", ",", "bindPath", ",", "initParams", ",", "contextParams", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "SecurityDomain", "domain", ")", "throws", "Exception", "{", "Method", "start", "=", "bootstrap", ".", "getMethod", "(", "\"", "start", "\"", ",", "String", ".", "class", ",", "SecurityDomain", ".", "class", ")", ";", "return", "(", "ResteasyDeployment", ")", "start", ".", "invoke", "(", "null", ",", "bindPath", ",", "domain", ")", ";", "}", "public", "static", "void", "start", "(", "ResteasyDeployment", "deployment", ")", "throws", "Exception", "{", "Method", "start", "=", "bootstrap", ".", "getMethod", "(", "\"", "start", "\"", ",", "ResteasyDeployment", ".", "class", ")", ";", "start", ".", "invoke", "(", "null", ",", "deployment", ")", ";", "}", "public", "static", "void", "stop", "(", ")", "throws", "Exception", "{", "@", "@", "-", "1", ",", "5", "+", "1", ",", "8", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "embedded", ".", "SecurityDomain", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "tjws", ".", "TJWSEmbeddedJaxrsServer", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ResteasyDeployment", ";", "@", "@", "-", "19", ",", "9", "+", "22", ",", "19", "@", "@", "public", "static", "ResteasyDeployment", "start", "(", ")", "throws", "Exception", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ")", "throws", "Exception", "{", "return", "start", "(", "bindPath", ",", "null", ")", ";", "return", "start", "(", "bindPath", ",", "null", ",", "null", ",", "null", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ")", "throws", "Exception", "{", "return", "start", "(", "bindPath", ",", "null", ",", "initParams", ",", "null", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ",", "Hashtable", "<", "String", ",", "String", ">", "contextParams", ")", "throws", "Exception", "{", "return", "start", "(", "bindPath", ",", "null", ",", "initParams", ",", "contextParams", ")", ";", "}", "public", "static", "void", "start", "(", "ResteasyDeployment", "deployment", ")", "throws", "Exception", "{", "System", ".", "out", ".", "println", "(", "\"[", "Embedded", "Container", "Start", "]", "\")", ";", "@", "@", "-", "34", ",", "19", "+", "47", ",", "26", "@", "@", "public", "static", "void", "start", "(", "ResteasyDeployment", "deployment", ")", "throws", "Exception", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "SecurityDomain", "domain", ")", "throws", "Exception", "{", "return", "start", "(", "bindPath", ",", "domain", ",", "null", ",", "null", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "SecurityDomain", "domain", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ",", "Hashtable", "<", "String", ",", "String", ">", "contextParams", ")", "throws", "Exception", "{", "ResteasyDeployment", "deployment", "=", "new", "ResteasyDeployment", "(", ");", "deployment", ".", "setSecurityEnabled", "(", "true", ")", ";", "return", "start", "(", "bindPath", ",", "domain", ",", "deployment", ")", ";", "return", "start", "(", "bindPath", ",", "domain", ",", "deployment", ",", "initParams", ",", "contextParams", ")", ";", "}", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "SecurityDomain", "domain", ",", "ResteasyDeployment", "deployment", ")", "throws", "Exception", "public", "static", "ResteasyDeployment", "start", "(", "String", "bindPath", ",", "SecurityDomain", "domain", ",", "ResteasyDeployment", "deployment", ",", "Hashtable", "<", "String", ",", "String", ">", "initParams", ",", "Hashtable", "<", "String", ",", "String", ">", "contextParams", ")", "throws", "Exception", "{", "tjws", "=", "new", "TJWSEmbeddedJaxrsServer", "(", ");", "tjws", ".", "setDeployment", "(", "deployment", ")", ";", "tjws", ".", "setPort", "(", "TestPortProvider", ".", "getPort", "(", "))", ";", "tjws", ".", "setRootResourcePath", "(", "bindPath", ")", ";", "tjws", ".", "setSecurityDomain", "(", "domain", ")", ";", "tjws", ".", "setInitParameters", "(", "initParams", ")", ";", "tjws", ".", "setContextParameters", "(", "contextParams", ")", ";", "tjws", ".", "start", "(", ");", "return", "tjws", ".", "getDeployment", "(", ");", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "115", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "xxe", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "TestPortProvider", ".", "generateURL", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Consumes", ";", "import", "javax", ".", "ws", ".", "rs", ".", "POST", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "junit", ".", "framework", ".", "Assert", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "ClientRequest", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "ClientResponse", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "core", ".", "Dispatcher", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ResteasyDeployment", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "EmbeddedContainer", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "w3c", ".", "dom", ".", "NodeList", ";", "/", "**", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "ron", ".", "sigal", "@", "jboss", ".", "com", "\"", ">", "Ron", "Sigal", "<", "/", "a", ">", "*", "@", "date", "Jan", "6", ",", "2012", "*", "/", "public", "class", "TestXXE", "{", "protected", "static", "ResteasyDeployment", "deployment", ";", "protected", "static", "Dispatcher", "dispatcher", ";", "@", "Path", "(", "\"/", "\")", "public", "static", "class", "TestResource", "{", "@", "Consumes", "(", "\"", "application", "/", "xml", "\"", ")", "@", "POST", "public", "String", "doPost", "(", "Document", "doc", ")", "{", "Node", "node", "=", "doc", ".", "getDocumentElement", "(", ");", "System", ".", "out", ".", "println", "(", "\"", "name", ":", "\"", "+", "node", ".", "getNodeName", "(", "))", ";", "NodeList", "children", "=", "doc", ".", "getDocumentElement", "(", ").", "getChildNodes", "(", ");", "node", "=", "children", ".", "item", "(", "0", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "name", ":", "\"", "+", "node", ".", "getNodeName", "(", "))", ";", "children", "=", "node", ".", "getChildNodes", "(", ");", "node", "=", "children", ".", "item", "(", "0", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "name", ":", "\"", "+", "node", ".", "getNodeName", "(", "))", ";", "children", "=", "node", ".", "getChildNodes", "(", ");", "System", ".", "out", ".", "println", "(", "node", ".", "getNodeValue", "(", "))", ";", "return", "node", ".", "getNodeValue", "(", ");", "}", "}", "public", "static", "void", "before", "(", "String", "expandEntityReferences", ")", "throws", "Exception", "{", "Hashtable", "<", "String", ",", "String", ">", "initParams", "=", "new", "Hashtable", "<", "String", ",", "String", ">", "()", ";", "Hashtable", "<", "String", ",", "String", ">", "contextParams", "=", "new", "Hashtable", "<", "String", ",", "String", ">", "()", ";", "contextParams", ".", "put", "(", "ResteasyContextParameters", ".", "RESTEASY_EXPAND_ENTITY_REFERENCES", ",", "expandEntityReferences", ")", ";", "deployment", "=", "EmbeddedContainer", ".", "start", "(", "initParams", ",", "contextParams", ")", ";", "dispatcher", "=", "deployment", ".", "getDispatcher", "(", ");", "deployment", ".", "getRegistry", "(", ").", "addPerRequestResource", "(", "TestResource", ".", "class", ")", ";", "}", "public", "static", "void", "after", "(", ")", "throws", "Exception", "{", "EmbeddedContainer", ".", "stop", "(", ");", "dispatcher", "=", "null", ";", "deployment", "=", "null", ";", "}", "@", "Test", "public", "void", "testXXEWithoutExpansion", "(", ")", "throws", "Exception", "{", "before", "(", "\"", "false", "\"", ");", "ClientRequest", "request", "=", "new", "ClientRequest", "(", "generateURL", "(", "\"/", "\")", ");", "String", "filename", "=", "\"", "src", "/", "test", "/", "java", "/", "org", "/", "jboss", "/", "resteasy", "/", "test", "/", "xxe", "/", "testpasswd", "\"", ";", "String", "str", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"?", ">\\", "r", "\"", "+", "\"", "<!", "DOCTYPE", "foo", "\\", "r", "\"", "+", "\"", "[<", "!", "ENTITY", "xxe", "SYSTEM", "\\", "\"\"", "+", "filename", "+", "\"", "\\\"", ">\\", "r", "\"", "+", "\"", "]>", "\\", "r", "\"", "+", "\"", "<", "search", ">", "<", "user", ">", "&", "xxe", ";", "</", "user", ">", "</", "search", ">", "\";", "System", ".", "out", ".", "println", "(", "str", ")", ";", "request", ".", "body", "(", "\"", "application", "/", "xml", "\"", ",", "str", ")", ";", "ClientResponse", "<", "?>", "response", "=", "request", ".", "post", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "response", ".", "getStatus", "(", "))", ";", "String", "entity", "=", "response", ".", "getEntity", "(", "String", ".", "class", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "result", ":", "\"", "+", "entity", ")", ";", "Assert", ".", "assertEquals", "(", "entity", ",", "null", ")", ";", "after", "(", ");", "}", "@", "Test", "public", "void", "testXXEWithExpansion", "(", ")", "throws", "Exception", "{", "before", "(", "\"", "true", "\"", ");", "ClientRequest", "request", "=", "new", "ClientRequest", "(", "generateURL", "(", "\"/", "\")", ");", "String", "filename", "=", "\"", "src", "/", "test", "/", "java", "/", "org", "/", "jboss", "/", "resteasy", "/", "test", "/", "xxe", "/", "testpasswd", "\"", ";", "String", "str", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"?", ">\\", "r", "\"", "+", "\"", "<!", "DOCTYPE", "foo", "\\", "r", "\"", "+", "\"", "[<", "!", "ENTITY", "xxe", "SYSTEM", "\\", "\"\"", "+", "filename", "+", "\"", "\\\"", ">\\", "r", "\"", "+", "\"", "]>", "\\", "r", "\"", "+", "\"", "<", "search", ">", "<", "user", ">", "&", "xxe", ";", "</", "user", ">", "</", "search", ">", "\";", "System", ".", "out", ".", "println", "(", "str", ")", ";", "request", ".", "body", "(", "\"", "application", "/", "xml", "\"", ",", "str", ")", ";", "ClientResponse", "<", "?>", "response", "=", "request", ".", "post", "(", ");", "Assert", ".", "assertEquals", "(", "200", ",", "response", ".", "getStatus", "(", "))", ";", "String", "entity", "=", "response", ".", "getEntity", "(", "String", ".", "class", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "result", ":", "\"", "+", "entity", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "xx", ":", "xx", ":", "xx", ":", "xx", ":", "xx", ":", "xx", ":", "xx", "\"", ",", "entity", ")", ";", "after", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "xx", ":", "xx", ":", "xx", ":", "xx", ":", "xx", ":", "xx", ":", "xx", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["read", "arbitrary", "files"]}
{"contents": ["xfs:", "don't", "fail", "when", "converting", "shortform", "attr", "to", "long", "form", "during", "ATTR_REPLACE", "Kanda", "Motohiro", "reported", "that", "expanding", "a", "tiny", "xattr", "into", "a", "large", "xattr", "fails", "on", "XFS", "because", "we", "remove", "the", "tiny", "xattr", "from", "a", "shortform", "fork", "and", "then", "try", "to", "re-add", "it", "after", "converting", "the", "fork", "to", "extents", "format", "having", "not", "removed", "the", "ATTR_REPLACE", "flag.", "This", "fails", "because", "the", "attr", "is", "no", "longer", "present,", "causing", "a", "fs", "shutdown.", "This", "is", "derived", "from", "the", "patch", "in", "his", "bug", "report,", "but", "we", "really", "shouldn't", "ignore", "a", "nonzero", "retval", "from", "the", "remove", "call.", "Bugzilla:", "https://bugzilla.kernel.org/show_bug.cgi?id=199119", "Reported-by:", "kanda.motohiro@gmail.com", "Reviewed-by:", "Dave", "Chinner", "<dchinner@redhat.com>", "Reviewed-by:", "Christoph", "Hellwig", "<hch@lst.de>", "Signed-off-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>"], "code_tokens": ["@", "@", "-", "511", ",", "7", "+", "511", ",", "14", "@", "@", "xfs_attr_shortform_addname", "(", "xfs_da_args_t", "*", "args", ")", "if", "(", "args", "-", ">", "flags", "&", "ATTR_CREATE", ")", "return", "retval", ";", "retval", "=", "xfs_attr_shortform_remove", "(", "args", ")", ";", "ASSERT", "(", "retval", "=", "=", "0", ")", ";", "if", "(", "retval", ")", "return", "retval", ";", "/", "*", "*", "Since", "we", "have", "removed", "the", "old", "attr", ",", "clear", "ATTR_REPLACE", "so", "*", "that", "the", "leaf", "format", "add", "routine", "won", "'", "t", "trip", "over", "the", "attr", "*", "not", "being", "around", ".", "*", "/", "args", "-", ">", "flags", "&", "=", "~", "ATTR_REPLACE", ";", "}", "if", "(", "args", "-", ">", "namelen", ">", "=", "XFS_ATTR_SF_ENTSIZE_MAX", "|", "|"], "docstring_tokens": ["the", "system", "to", "become", "non-operational"]}
{"contents": ["Enforce", "hidden", "and", "extensions", "restrictions", "when", "moving", "and", "copying", "files", "in", "uploaders", "Fixes", "#433"], "code_tokens": ["@", "@", "-", "358", ",", "9", "+", "358", ",", "14", "@", "@", "-", "(", "GCDWebServerResponse", "*", ")", "performCOPY", ":", "(", "GCDWebServerRequest", "*", ")", "request", "isMove", ":", "(", "BOOL", ")", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Conflict", "message", ":", "@\"", "Invalid", "destination", "\\", "\"%", "@\\", "\"\"", ",", "dstRelativePath", "]", ";", "}", "NSString", "*", "itemName", "=", "[", "dstAbsolutePath", "lastPathComponent", "]", ";", "if", "(", "(!", "_allowHiddenItems", "&", "&", "[", "itemName", "hasPrefix", ":", "@\"", ".\"", "])", "|", "|", "(", "!", "isDirectory", "&", "&", "!", "[", "self", "_checkFileExtension", ":", "itemName", "]", "))", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Forbidden", "message", ":", "@\"", "%@", "to", "item", "name", "\\", "\"%", "@\\", "\"", "is", "not", "allowed", "\"", ",", "isMove", "?", "@", "\"", "Moving", "\"", ":", "@", "\"", "Copying", "\"", ",", "itemName", "]", ";", "NSString", "*", "srcName", "=", "[", "srcAbsolutePath", "lastPathComponent", "]", ";", "if", "(", "(!", "_allowHiddenItems", "&", "&", "[", "srcName", "hasPrefix", ":", "@\"", ".\"", "])", "|", "|", "(", "!", "isDirectory", "&", "&", "!", "[", "self", "_checkFileExtension", ":", "srcName", "]", "))", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Forbidden", "message", ":", "@\"", "%@", "from", "item", "name", "\\", "\"%", "@\\", "\"", "is", "not", "allowed", "\"", ",", "isMove", "?", "@", "\"", "Moving", "\"", ":", "@", "\"", "Copying", "\"", ",", "srcName", "]", ";", "}", "NSString", "*", "dstName", "=", "[", "dstAbsolutePath", "lastPathComponent", "]", ";", "if", "(", "(!", "_allowHiddenItems", "&", "&", "[", "dstName", "hasPrefix", ":", "@\"", ".\"", "])", "|", "|", "(", "!", "isDirectory", "&", "&", "!", "[", "self", "_checkFileExtension", ":", "dstName", "]", "))", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Forbidden", "message", ":", "@\"", "%@", "to", "item", "name", "\\", "\"%", "@\\", "\"", "is", "not", "allowed", "\"", ",", "isMove", "?", "@", "\"", "Moving", "\"", ":", "@", "\"", "Copying", "\"", ",", "dstName", "]", ";", "}", "NSString", "*", "overwriteHeader", "=", "[", "request", ".", "headers", "objectForKey", ":", "@\"", "Overwrite", "\"", "];", "@", "@", "-", "325", ",", "12", "+", "325", ",", "17", "@", "@", "-", "(", "GCDWebServerResponse", "*", ")", "moveItem", ":", "(", "GCDWebServerURLEncodedFormRequest", "*", ")", "request", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_NotFound", "message", ":", "@\"", "\\\"", "%@", "\\\"", "does", "not", "exist", "\"", ",", "oldRelativePath", "]", ";", "}", "NSString", "*", "oldItemName", "=", "[", "oldAbsolutePath", "lastPathComponent", "]", ";", "if", "(", "(!", "_allowHiddenItems", "&", "&", "[", "oldItemName", "hasPrefix", ":", "@\"", ".\"", "])", "|", "|", "(", "!", "isDirectory", "&", "&", "!", "[", "self", "_checkFileExtension", ":", "oldItemName", "]", "))", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Forbidden", "message", ":", "@\"", "Moving", "from", "item", "name", "\\", "\"%", "@\\", "\"", "is", "not", "allowed", "\"", ",", "oldItemName", "]", ";", "}", "NSString", "*", "newRelativePath", "=", "[", "request", ".", "arguments", "objectForKey", ":", "@\"", "newPath", "\"", "];", "NSString", "*", "newAbsolutePath", "=", "[", "self", "_uniquePathForPath", ":", "[", "_uploadDirectory", "stringByAppendingPathComponent", ":", "GCDWebServerNormalizePath", "(", "newRelativePath", ")", "]]", ";", "NSString", "*", "itemName", "=", "[", "newAbsolutePath", "lastPathComponent", "]", ";", "if", "(", "(!", "_allowHiddenItems", "&", "&", "[", "itemName", "hasPrefix", ":", "@\"", ".\"", "])", "|", "|", "(", "!", "isDirectory", "&", "&", "!", "[", "self", "_checkFileExtension", ":", "itemName", "]", "))", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Forbidden", "message", ":", "@\"", "Moving", "to", "item", "name", "\\", "\"%", "@\\", "\"", "is", "not", "allowed", "\"", ",", "itemName", "]", ";", "NSString", "*", "newItemName", "=", "[", "newAbsolutePath", "lastPathComponent", "]", ";", "if", "(", "(!", "_allowHiddenItems", "&", "&", "[", "newItemName", "hasPrefix", ":", "@\"", ".\"", "])", "|", "|", "(", "!", "isDirectory", "&", "&", "!", "[", "self", "_checkFileExtension", ":", "newItemName", "]", "))", "{", "return", "[", "GCDWebServerErrorResponse", "responseWithClientError", ":", "kGCDWebServerHTTPStatusCode_Forbidden", "message", ":", "@\"", "Moving", "to", "item", "name", "\\", "\"%", "@\\", "\"", "is", "not", "allowed", "\"", ",", "newItemName", "]", ";", "}", "if", "(", "![", "self", "shouldMoveItemFromPath", ":", "oldAbsolutePath", "toPath", ":", "newAbsolutePath", "]", ")", "{"], "docstring_tokens": ["make", "an", "inaccessible", "file", "become", "available"]}
{"contents": ["WW-3597", "-", "XSS", "vulnerability", "in", "javatemplates", "plugin", "(thanks", "Gareth", "Faires)", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/trunk@1084872", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "35", ",", "7", "+", "35", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "a", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "file", "\"", ")", ".", "addIfExists", "(", "\"", "size", "\"", ",", "params", ".", "get", "(", "\"", "size", "\"", "))", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfExists", "(", "\"", "accept", "\"", ",", "params", ".", "get", "(", "\"", "accept", "\"", "))", ".", "addIfExists", "(", "\"", "tabindex", "\"", ",", "params", ".", "get", "(", "\"", "tabindex", "\"", "))", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "a", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "hidden", "\"", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfExists", "(", "\"", "id", "\"", ",", "params", ".", "get", "(", "\"", "id", "\"", "))", ".", "addIfExists", "(", "\"", "class", "\"", ",", "params", ".", "get", "(", "\"", "cssClass", "\"", "))", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "Boolean", "showPassword", "=", "(", "Boolean", ")", "params", ".", "get", "(", "\"", "showPassword", "\"", ");", "if", "(", "showPassword", "!", "=", "null", "&", "&", "showPassword", ")", "attrs", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ";", "attrs", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ";", "attrs", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "password", "\"", ")", "@", "@", "-", "79", ",", "7", "+", "79", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "a", ".", "add", "(", "\"", "type", "\"", ",", "\"", "radio", "\"", ")", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "addIfTrue", "(", "\"", "checked", "\"", ",", "checked", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "itemKeyStr", ",", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "itemKeyStr", ")", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfExists", "(", "\"", "tabindex", "\"", ",", "params", ".", "get", "(", "\"", "tabindex", "\"", "))", ".", "addIfExists", "(", "\"", "id", "\"", ",", "id", ")", ";", "@", "@", "-", "37", ",", "7", "+", "37", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "attrs", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "reset", "\"", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ".", "addIfExists", "(", "\"", "tabindex", "\"", ",", "params", ".", "get", "(", "\"", "tabindex", "\"", "))", ".", "addIfExists", "(", "\"", "id", "\"", ",", "params", ".", "get", "(", "\"", "id", "\"", "))", ".", "addIfExists", "(", "\"", "class", "\"", ",", "params", ".", "get", "(", "\"", "cssClass", "\"", "))", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "a", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "addIfExists", "(", "\"", "size", "\"", ",", "params", ".", "get", "(", "\"", "size", "\"", "))", ".", "addIfExists", "(", "\"", "value", "\"", ",", "value", ",", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "value", ")", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfTrue", "(", "\"", "readonly", "\"", ",", "params", ".", "get", "(", "\"", "readonly", "\"", "))", ".", "addIfTrue", "(", "\"", "multiple", "\"", ",", "params", ".", "get", "(", "\"", "multiple", "\"", "))", "@", "@", "-", "38", ",", "7", "+", "38", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "if", "(", "\"", "button", "\"", ".", "equals", "(", "type", ")", ")", "{", "attrs", ".", "addIfExists", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "submit", "\"", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfExists", "(", "\"", "tabindex", "\"", ",", "params", ".", "get", "(", "\"", "tabindex", "\"", "))", ".", "addIfExists", "(", "\"", "id", "\"", ",", "params", ".", "get", "(", "\"", "id", "\"", "))", "@", "@", "-", "47", ",", "7", "+", "47", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "start", "(", "\"", "button", "\"", ",", "attrs", ")", ";", "}", "else", "if", "(", "\"", "image", "\"", ".", "equals", "(", "type", ")", ")", "{", "attrs", ".", "addIfExists", "(", "\"", "src", "\"", ",", "params", ".", "get", "(", "\"", "src", "\"", "),", "false", ")", "attrs", ".", "addIfExists", "(", "\"", "src", "\"", ",", "params", ".", "get", "(", "\"", "src", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "image", "\"", ")", ".", "addIfExists", "(", "\"", "alt", "\"", ",", "params", ".", "get", "(", "\"", "label", "\"", "))", ".", "addIfExists", "(", "\"", "id", "\"", ",", "params", ".", "get", "(", "\"", "id", "\"", "))", "@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", "}", "else", "{", "attrs", ".", "addIfExists", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "add", "(", "\"", "type", "\"", ",", "\"", "submit", "\"", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfExists", "(", "\"", "tabindex", "\"", ",", "params", ".", "get", "(", "\"", "tabindex", "\"", "))", ".", "addIfExists", "(", "\"", "id", "\"", ",", "params", ".", "get", "(", "\"", "id", "\"", "))", "@", "@", "-", "36", ",", "7", "+", "36", ",", "7", "@", "@", "public", "void", "generate", "(", ")", "throws", "IOException", "{", ".", "addDefaultToEmpty", "(", "\"", "name", "\"", ",", "params", ".", "get", "(", "\"", "name", "\"", "))", ".", "addIfExists", "(", "\"", "size", "\"", ",", "params", ".", "get", "(", "\"", "size", "\"", "))", ".", "addIfExists", "(", "\"", "maxlength", "\"", ",", "params", ".", "get", "(", "\"", "maxlength", "\"", "))", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "),", "false", ")", ".", "addIfExists", "(", "\"", "value", "\"", ",", "params", ".", "get", "(", "\"", "nameValue", "\"", "))", ".", "addIfTrue", "(", "\"", "disabled", "\"", ",", "params", ".", "get", "(", "\"", "disabled", "\"", "))", ".", "addIfTrue", "(", "\"", "readonly", "\"", ",", "params", ".", "get", "(", "\"", "readonly", "\"", "))", ".", "addIfExists", "(", "\"", "tabindex", "\"", ",", "params", ".", "get", "(", "\"", "tabindex", "\"", "))"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["apply", "changes", "for", "2.14.15", "release"], "code_tokens": ["@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "assemblies", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "assemblies", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "bundle", "-", "template", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "assemblies", "<", "/", "groupId", ">", "@", "@", "-", "41", ",", "15", "+", "41", ",", "15", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "@", "@", "-", "35", ",", "159", "+", "35", ",", "159", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "commons", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "db", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "gwt", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "httpclient", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "insight", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "maven", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "messaging", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "shiro", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "bouncycastle", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "jetty", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "goodies", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "groovy", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "guice", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "logging", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "osgi", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "other", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "plexus", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "rest", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "testing", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "metrics", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "bouncycastle", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "commons", "<", "/", "artifactId", ">", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "commons", "<", "/", "groupId", ">", "<", "artifactId", ">", "commons", "-", "compress", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "18", "<", "/", "version", ">", "<", "version", ">", "1", ".", "19", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "db", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "goodies", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "groovy", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "guice", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "gwt", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "httpclient", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "15", "+", "20", ",", "15", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "insight", "<", "/", "artifactId", ">", "<", "name", ">", "${", "project", ".", "groupId", "}", ":$", "{", "project", ".", "artifactId", "}", "</", "name", ">", "<", "packaging", ">", "pom", "<", "/", "packaging", ">", "<", "properties", ">", "<", "sonatype", "-", "licensing", ".", "version", ">", "1", ".", "4", "<", "/", "sonatype", "-", "licensing", ".", "version", ">", "<", "sonatype", "-", "licensing", ".", "version", ">", "1", ".", "5", ".", "0", "<", "/", "sonatype", "-", "licensing", ".", "version", ">", "<", "insight", "-", "brain", ".", "version", ">", "1", ".", "33", ".", "0", "-", "04", "<", "/", "insight", "-", "brain", ".", "version", ">", "<", "insight", "-", "scanner", ".", "version", ">", "2", ".", "4", ".", "5", "-", "01", "<", "/", "insight", "-", "scanner", ".", "version", ">", "<", "/", "properties", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "jetty", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "logging", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "maven", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "messaging", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "metrics", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "osgi", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "other", "<", "/", "artifactId", ">", "@", "@", "-", "92", ",", "7", "+", "92", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "tika", "<", "/", "groupId", ">", "<", "artifactId", ">", "tika", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "20", "<", "/", "version", ">", "<", "version", ">", "1", ".", "22", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "plexus", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "rest", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "scripts", "<", "/", "artifactId", ">", "@", "@", "-", "36", ",", "7", "+", "36", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "shiro", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "testing", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "base", "-", "configuration", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "bootstrap", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "client", "-", "core", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "core", "<", "/", "artifactId", ">", "@", "@", "-", "313", ",", "6", "+", "313", ",", "16", "@", "@", "public", "StorageFileItem", "retrieveArtifact", "(", "ArtifactStoreRequest", "gavRequest", ")", "}", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "storeArtifactPom", "(", "gavRequest", ",", "is", ",", "attributes", ",", "true", ")", ";", "}", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ",", "boolean", "withChecksums", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "@", "@", "-", "324", ",", "7", "+", "334", ",", "12", "@", "@", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Ma", "gavRequest", ".", "setRequestPath", "(", "repository", ".", "getGavCalculator", "(", ").", "gavToPath", "(", "gav", ")", ");", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "try", "{", "repository", ".", "getMetadataManager", "(", ").", "deployArtifact", "(", "gavRequest", ")", ";", "@", "@", "-", "335", ",", "6", "+", "350", ",", "13", "@", "@", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Ma", "}", "public", "void", "storeArtifact", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "storeArtifact", "(", "gavRequest", ",", "is", ",", "attributes", ",", "true", ")", ";", "}", "public", "void", "storeArtifact", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ",", "boolean", "withChecksums", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "@", "@", "-", "346", ",", "11", "+", "368", ",", "24", "@", "@", "public", "void", "storeArtifact", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "S", "gavRequest", ".", "setRequestPath", "(", "repository", ".", "getGavCalculator", "(", ").", "gavToPath", "(", "gav", ")", ");", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "}", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "String", "packaging", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "storeArtifactWithGeneratedPom", "(", "gavRequest", ",", "packaging", ",", "is", ",", "attributes", ",", "true", ")", ";", "}", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "String", "packaging", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ",", "boolean", "withChecksums", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "@", "@", "-", "394", ",", "8", "+", "429", ",", "12", "@", "@", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "Strin", "/", "/", "writing", "to", "string", ",", "not", "to", "happen", "}", "repository", ".", "storeItemWithChecksums", "(", "pomRequest", ",", "new", "ByteArrayInputStream", "(", "sw", ".", "toString", "(", ").", "getBytes", "(", "))", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "pomRequest", ",", "new", "ByteArrayInputStream", "(", "sw", ".", "toString", "(", ").", "getBytes", "(", "))", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "pomRequest", ",", "new", "ByteArrayInputStream", "(", "sw", ".", "toString", "(", ").", "getBytes", "(", "))", ",", "attributes", ")", ";", "}", "try", "{", "repository", ".", "getMetadataManager", "(", ").", "deployArtifact", "(", "pomRequest", ")", ";", "@", "@", "-", "408", ",", "7", "+", "447", ",", "13", "@", "@", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "Strin", "/", "/", "reset", "path", "if", "anything", "changed", "it", "gavRequest", ".", "setRequestPath", "(", "repository", ".", "getGavCalculator", "(", ").", "gavToPath", "(", "gavRequest", ".", "getGav", "(", "))", ");", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "}", "/", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "@", "@", "-", "0", ",", "0", "+", "1", ",", "79", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "javax", ".", "inject", ".", "Singleton", ";", "import", "static", "java", ".", "util", ".", "Arrays", ".", "stream", ";", "import", "static", "java", ".", "util", ".", "stream", ".", "Collectors", ".", "toSet", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isBlank", ";", "/", "**", "*", "Simple", "Path", "-", "based", "whitelist", "to", "validate", "allowed", "storage", "locations", "for", "repositories", ".", "Locations", "are", "whitelisted", "*", "by", "adding", "them", "as", "comma", "-", "separated", "values", "to", "the", "{", "@", "code", "nexus", ".", "override", ".", "local", ".", "storage", ".", "whitelist", "}", "property", "in", "*", "{", "@", "code", "nexus", ".", "properties", "}", ".", "*", "*", "A", "whitelisted", "path", "has", "its", "subdirectories", "included", ".", "For", "example", ",", "whitelisting", "the", "directory", "{", "@", "code", "/", "foo", "/", "bar", "}", "would", "*", "allow", "repositories", "to", "set", "their", "storage", "to", "{", "@", "code", "/", "foo", "/", "bar", "/", "baz", "}", ".", "*", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "@", "Named", "@", "Singleton", "public", "class", "StorageWhitelist", "{", "public", "static", "final", "String", "PROP_NAME", "=", "\"", "nexus", ".", "override", ".", "local", ".", "storage", ".", "whitelist", "\"", ";", "private", "static", "final", "String", "INJECTED_PROP", "=", "\"", "${", "\"", "+", "PROP_NAME", "+", "\"", ":-", "}\"", ";", "private", "final", "Set", "<", "Path", ">", "whitelistPaths", ";", "@", "Inject", "public", "StorageWhitelist", "(", "@", "Named", "(", "INJECTED_PROP", ")", "final", "String", "whitelistPaths", ")", "{", "this", ".", "whitelistPaths", "=", "isBlank", "(", "whitelistPaths", ")", "?", "new", "HashSet", "<", ">(", ")", ":", "stream", "(", "whitelistPaths", ".", "split", "(", "\",", "\")", ").", "map", "(", "this", ":", ":", "parse", ")", ".", "map", "(", "Path", ":", ":", "normalize", ")", ".", "collect", "(", "toSet", "(", "))", ";", "}", "void", "addWhitelistPath", "(", "final", "String", "whitelistPath", ")", "{", "this", ".", "whitelistPaths", ".", "add", "(", "parse", "(", "whitelistPath", ")", ".", "normalize", "(", "))", ";", "}", "public", "boolean", "isApproved", "(", "final", "String", "path", ")", "{", "Path", "targetPath", "=", "parse", "(", "path", ")", ".", "normalize", "(", ");", "return", "whitelistPaths", ".", "stream", "(", ").", "anyMatch", "(", "targetPath", ":", ":", "startsWith", ")", ";", "}", "/", "**", "*", "Attempts", "to", "generate", "a", "{", "@", "link", "Path", "}", "from", "a", "string", "first", "assuming", "the", "string", "is", "formatted", "as", "a", "{", "@", "link", "URI", "}", "and", "*", "subsequently", "as", "a", "direct", "path", "if", "not", "*", "*", "@", "param", "pathString", "A", "path", "string", "*", "@", "return", "the", "{", "@", "link", "Path", "}", "resulting", "from", "{", "@", "code", "pathString", "}", "*", "/", "private", "Path", "parse", "(", "final", "String", "pathString", ")", "{", "try", "{", "return", "Paths", ".", "get", "(", "URI", ".", "create", "(", "pathString", ")", ");", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "return", "Paths", ".", "get", "(", "pathString", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "144", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "StringJoiner", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "javax", ".", "inject", ".", "Singleton", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "ApplicationStatusSource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "SystemStatus", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "events", ".", "EventSubscriber", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "events", ".", "NexusStartedEvent", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "registry", ".", "RepositoryRegistry", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "AbstractRepository", ";", "import", "org", ".", "sonatype", ".", "sisu", ".", "goodies", ".", "common", ".", "ComponentSupport", ";", "import", "com", ".", "google", ".", "common", ".", "eventbus", ".", "Subscribe", ";", "import", "static", "java", ".", "lang", ".", "System", ".", "lineSeparator", ";", "import", "static", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ".", "UTF_8", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "createFile", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "newInputStream", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "notExists", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "write", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "APPEND", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "CREATE", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "READ", ";", "import", "static", "java", ".", "util", ".", "Objects", ".", "requireNonNull", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isNotBlank", ";", "import", "static", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ".", "PROP_NAME", ";", "/", "**", "*", "On", "upgrade", "this", "will", "populate", "the", "{", "@", "code", "nexus", ".", "override", ".", "local", ".", "storage", ".", "whitelist", "}", "property", "in", "{", "@", "code", "nexus", ".", "properties", "}", "*", "if", "it", "is", "not", "found", ".", "Its", "value", "will", "be", "created", "from", "all", "existing", "repositories", "which", "have", "a", "value", "set", "for", "*", "{", "@", "code", "overrideLocalStorageUrl", "}", "*", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "@", "Singleton", "@", "Named", "(", "\"", "StorageWhitelistUpgradeEvent", "\"", ")", "public", "class", "StorageWhitelistUpgradeEvent", "extends", "ComponentSupport", "implements", "EventSubscriber", "{", "private", "final", "ApplicationStatusSource", "applicationStatusSource", ";", "private", "final", "ApplicationDirectories", "applicationDirectories", ";", "private", "final", "RepositoryRegistry", "repositoryRegistry", ";", "private", "final", "StorageWhitelist", "storageWhitelist", ";", "@", "Inject", "public", "StorageWhitelistUpgradeEvent", "(", "final", "ApplicationStatusSource", "applicationStatusSource", ",", "final", "ApplicationDirectories", "applicationDirectories", ",", "final", "RepositoryRegistry", "repositoryRegistry", ",", "final", "StorageWhitelist", "storageWhitelist", ")", "{", "this", ".", "applicationStatusSource", "=", "requireNonNull", "(", "applicationStatusSource", ")", ";", "this", ".", "applicationDirectories", "=", "requireNonNull", "(", "applicationDirectories", ")", ";", "this", ".", "repositoryRegistry", "=", "requireNonNull", "(", "repositoryRegistry", ")", ";", "this", ".", "storageWhitelist", "=", "requireNonNull", "(", "storageWhitelist", ")", ";", "}", "@", "Subscribe", "public", "void", "inspect", "(", "final", "NexusStartedEvent", "startedEvent", ")", "{", "final", "SystemStatus", "systemStatus", "=", "applicationStatusSource", ".", "getSystemStatus", "(", ");", "if", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", "{", "try", "{", "if", "(", "notExists", "(", "nexusPropertiesPath", "(", "))", ")", "{", "createFile", "(", "nexusPropertiesPath", "(", "))", ";", "}", "try", "(", "InputStream", "nexusPropsIn", "=", "newInputStream", "(", "nexusPropertiesPath", "(", "),", "READ", ")", ")", "{", "Properties", "nexusProps", "=", "new", "Properties", "(", ");", "nexusProps", ".", "load", "(", "nexusPropsIn", ")", ";", "if", "(", "!", "nexusProps", ".", "containsKey", "(", "PROP_NAME", ")", ")", "{", "log", ".", "info", "(", "\"", "System", "upgrade", "detected", ":", "creating", "repo", "storage", "whitelist", "property", ":", "'", "{}", "'\"", ",", "PROP_NAME", ")", ";", "StringJoiner", "whitelistValue", "=", "new", "StringJoiner", "(", "\",", "\")", ";", "repositoryRegistry", ".", "getRepositories", "(", ").", "forEach", "(", "repo", "-", ">", "{", "String", "overrideLocalStorageUrl", "=", "(", "(", "AbstractRepository", ")", "repo", ")", ".", "getCurrentCoreConfiguration", "(", ").", "getConfiguration", "(", "false", ")", ".", "getLocalStorage", "(", ").", "getUrl", "(", ");", "if", "(", "isNotBlank", "(", "overrideLocalStorageUrl", ")", ")", "{", "log", ".", "info", "(", "\"", "Adding", "existing", "configured", "location", "'", "{}", "'", "to", "whitelisted", "storage", "locations", "\"", ",", "overrideLocalStorageUrl", ")", ";", "whitelistValue", ".", "add", "(", "overrideLocalStorageUrl", ")", ";", "storageWhitelist", ".", "addWhitelistPath", "(", "overrideLocalStorageUrl", ")", ";", "}", "}", ");", "write", "(", "nexusPropertiesPath", "(", "),", "createSection", "(", "whitelistValue", ".", "toString", "(", "))", ".", "getBytes", "(", "UTF_8", ")", ",", "CREATE", ",", "APPEND", ")", ";", "log", ".", "info", "(", "\"", "nexus", ".", "properties", "updated", "with", "'", "{}", "'", "property", "\"", ",", "PROP_NAME", ")", ";", "}", "}", "}", "catch", "(", "IOException", "e", ")", "{", "log", ".", "error", "(", "\"", "Unable", "to", "upgrade", "nexus", ".", "properties", "with", "whitelisted", "storage", "\"", ",", "e", ")", ";", "}", "}", "}", "private", "Path", "nexusPropertiesPath", "(", ")", "{", "return", "Paths", ".", "get", "(", "applicationDirectories", ".", "getInstallDirectory", "(", ").", "getAbsolutePath", "(", "),", "\"", "/", "conf", "/", "nexus", ".", "properties", "\"", ");", "}", "private", "String", "createSection", "(", "final", "String", "propValues", ")", "{", "StringBuilder", "propBuilder", "=", "new", "StringBuilder", "(", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "Storage", "whitelist", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "Generated", "using", "existing", "configured", "values", "from", "all", "repositories", "if", "not", "found", "on", "upgrade", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "Comma", "-", "separated", "list", "of", "allowed", "override", "storage", "locations", "for", "repositories", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "See", "https", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nxrm2", "/", "configuring", "-", "repositories", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "PROP_NAME", ")", ".", "append", "(", "\"=", "\")", ".", "append", "(", "propValues", ")", ";", "return", "propBuilder", ".", "toString", "(", ");", "}", "}", "@", "@", "-", "13", ",", "15", "+", "13", ",", "18", "@", "@", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "ItemNotFoundException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "ResourceStoreRequest", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "gav", ".", "Gav", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "gav", ".", "GavCalculator", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "gav", ".", "M2GavCalculator", ";", "import", "org", ".", "sonatype", ".", "sisu", ".", "litmus", ".", "testsupport", ".", "TestSupport", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Charsets", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mockito", ".", "ArgumentCaptor", ";", "@", "@", "-", "31", ",", "6", "+", "34", ",", "8", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "nullValue", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "never", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "@", "-", "40", ",", "6", "+", "45", ",", "26", "@", "@", "public", "class", "ArtifactStoreHelperTest", "extends", "TestSupport", "{", "private", "MavenRepository", "mavenRepository", ";", "private", "MetadataManager", "metadataManager", ";", "private", "GavCalculator", "gavCalculator", "=", "new", "M2GavCalculator", "(", ");", "private", "ArtifactStoreHelper", "underTest", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "mavenRepository", "=", "mock", "(", "MavenRepository", ".", "class", ")", ";", "metadataManager", "=", "mock", "(", "MetadataManager", ".", "class", ")", ";", "when", "(", "mavenRepository", ".", "getGavCalculator", "(", "))", ".", "thenReturn", "(", "gavCalculator", ")", ";", "when", "(", "mavenRepository", ".", "getMetadataManager", "(", "))", ".", "thenReturn", "(", "metadataManager", ")", ";", "when", "(", "mavenRepository", ".", "getName", "(", "))", ".", "thenReturn", "(", "\"", "repo", "\"", ");", "when", "(", "mavenRepository", ".", "getId", "(", "))", ".", "thenReturn", "(", "\"", "repo", "\"", ");", "when", "(", "mavenRepository", ".", "retrieveItem", "(", "any", "(", "Boolean", ".", "class", ")", ",", "any", "(", "ResourceStoreRequest", ".", "class", ")", "))", ".", "thenThrow", "(", "ItemNotFoundException", ".", "class", ")", ";", "underTest", "=", "new", "ArtifactStoreHelper", "(", "mavenRepository", ")", ";", "}", "/", "**", "*", "Test", "that", "verifies", "that", "classifier", "is", "not", "present", "in", "the", "artifact", "store", "request", "used", "to", "maintain", "metadata", ",", "even", "if", "*", "classified", "artifact", "is", "being", "deployed", "with", "POM", ".", "@", "@", "-", "48", ",", "20", "+", "73", ",", "11", "@", "@", "*", "/", "@", "Test", "public", "void", "classifierNotPassedOnGeneratedPomAndClassifiedArtifactDeploy", "(", ")", "throws", "Exception", "{", "final", "M2GavCalculator", "gavCalculator", "=", "new", "M2GavCalculator", "(", ");", "final", "MetadataManager", "metadataManager", "=", "mock", "(", "MetadataManager", ".", "class", ")", ";", "final", "MavenRepository", "mavenRepository", "=", "mock", "(", "MavenRepository", ".", "class", ")", ";", "when", "(", "mavenRepository", ".", "getGavCalculator", "(", "))", ".", "thenReturn", "(", "gavCalculator", ")", ";", "when", "(", "mavenRepository", ".", "getMetadataManager", "(", "))", ".", "thenReturn", "(", "metadataManager", ")", ";", "when", "(", "mavenRepository", ".", "retrieveItem", "(", "any", "(", "Boolean", ".", "class", ")", ",", "any", "(", "ResourceStoreRequest", ".", "class", ")", "))", ".", "thenThrow", "(", "ItemNotFoundException", ".", "class", ")", ";", "final", "ArtifactStoreHelper", "artifactStoreHelper", "=", "new", "ArtifactStoreHelper", "(", "mavenRepository", ")", ";", "final", "Gav", "gav", "=", "gavCalculator", ".", "pathToGav", "(", "\"/", "org", "/", "test", "/", "artifact", "/", "1", ".", "0", "/", "artifact", "-", "1", ".", "0", "-", "classifier", ".", "jar", "\"", ");", "assertThat", "(", "gav", ".", "getClassifier", "(", "),", "equalTo", "(", "\"", "classifier", "\"", "))", ";", "final", "ArtifactStoreRequest", "request", "=", "new", "ArtifactStoreRequest", "(", "mavenRepository", ",", "gav", ",", "false", ")", ";", "artifactStoreHelper", ".", "storeArtifactWithGeneratedPom", "(", "underTest", ".", "storeArtifactWithGeneratedPom", "(", "request", ",", "\"", "pom", "\"", ",", "new", "ByteArrayInputStream", "(", "\"", "Content", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", "),", "null", ")", ";", "final", "ArgumentCaptor", "<", "ArtifactStoreRequest", ">", "requestArgumentCaptor", "=", "ArgumentCaptor", "@", "@", "-", "72", ",", "4", "+", "88", ",", "62", "@", "@", "public", "void", "classifierNotPassedOnGeneratedPomAndClassifiedArtifactDeploy", "(", ")", "throw", "assertThat", "(", "requestsPassed", ",", "hasSize", "(", "1", ")", ");", "assertThat", "(", "requestsPassed", ".", "get", "(", "0", ")", ".", "getGav", "(", ").", "getClassifier", "(", "),", "nullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifact_withChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifact", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "buildInputStream", "(", "),", "null", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifact_withNoChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifact", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "buildInputStream", "(", "),", "null", ",", "false", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactPom_withChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactPom", "(", "buildRequest", "(", "\"", "pom", "\"", "),", "buildInputStream", "(", "),", "null", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactPom_withNoChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactPom", "(", "buildRequest", "(", "\"", "pom", "\"", "),", "buildInputStream", "(", "),", "null", ",", "false", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactWithGeneratedPom_withChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactWithGeneratedPom", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "\"", "jar", "\"", ",", "buildInputStream", "(", "),", "null", ")", ";", "verify", "(", "mavenRepository", ",", "times", "(", "2", ")", ").", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactWithGeneratedPom_withNoChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactWithGeneratedPom", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "\"", "jar", "\"", ",", "buildInputStream", "(", "),", "null", ",", "false", ")", ";", "verify", "(", "mavenRepository", ",", "times", "(", "2", ")", ").", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "private", "ArtifactStoreRequest", "buildRequest", "(", "String", "extension", ")", "{", "final", "Gav", "gav", "=", "gavCalculator", ".", "pathToGav", "(", "\"/", "org", "/", "test", "/", "artifact", "/", "1", ".", "0", "/", "artifact", "-", "1", ".", "0", ".", "\"", "+", "extension", ")", ";", "return", "new", "ArtifactStoreRequest", "(", "mavenRepository", ",", "gav", ",", "false", ")", ";", "}", "private", "InputStream", "buildInputStream", "(", ")", "{", "return", "new", "ByteArrayInputStream", "(", "\"", "Content", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "79", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "/", "**", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "public", "class", "StorageWhitelistTest", "{", "private", "static", "final", "String", "ALLOWED_PATH", "=", "\"", "/", "dir1", "/", "dir2", "/", "dir3", "\"", ";", "private", "StorageWhitelist", "underTest", ";", "@", "Before", "public", "void", "setup", "(", ")", "{", "underTest", "=", "new", "StorageWhitelist", "(", "ALLOWED_PATH", ")", ";", "}", "@", "Test", "public", "void", "testIsApproved", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", ")", ",", "is", "(", "true", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "foo", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "\")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testAddWhitelistPath", "(", ")", "{", "String", "path", "=", "\"", "/", "foo", "/", "bar", "/", "baz", "\"", ";", "assertThat", "(", "underTest", ".", "isApproved", "(", "path", ")", ",", "is", "(", "false", ")", ");", "underTest", ".", "addWhitelistPath", "(", "path", ")", ";", "assertThat", "(", "underTest", ".", "isApproved", "(", "path", ")", ",", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "trailingSlashIgnored", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", "+", "\"/", "\")", ",", "is", "(", "true", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "foldera", "/", "folderb", "/", "folderd", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "foldera", "/", "folderb", "/", "folderd", "/", "\")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "subdirectoriesAreAllowed", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", "+", "\"", "/", "subfolder", "\"", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "intermediarySubdirectoriesNotAllowed", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "dir1", "/", "subdir", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "dir1", "/", "dir2", "/", "subdir", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "dir1", "/", "dir10", "/", "subdir", "\"", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "reverseTraversalNotAllowed", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", "+", "\"", "/.", "./", "..", "/.", "./", "usr", "/", "local", "\"", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testWindowsPathParsing", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"", "file", ":", "/", "C", ":", "/", "temp", "\"", "),", "is", "(", "false", ")", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "225", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "ApplicationStatusSource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "SystemStatus", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CLocalStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepositoryCoreConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "events", ".", "NexusStartedEvent", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "registry", ".", "RepositoryRegistry", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "AbstractRepository", ";", "import", "org", ".", "sonatype", ".", "sisu", ".", "litmus", ".", "testsupport", ".", "TestSupport", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TestName", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "createDirectory", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "createTempDirectory", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "exists", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "newInputStream", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "newOutputStream", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "readAllLines", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "CREATE_NEW", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "READ", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ".", "deleteDirectory", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "EMPTY", ";", "import", "static", "org", ".", "fest", ".", "util", ".", "Lists", ".", "newArrayList", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyBoolean", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyZeroInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "static", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ".", "PROP_NAME", ";", "/", "**", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "public", "class", "StorageWhitelistUpgradeEventTest", "extends", "TestSupport", "{", "@", "Rule", "public", "final", "TestName", "testName", "=", "new", "TestName", "(", ");", "@", "Mock", "private", "ApplicationStatusSource", "applicationStatusSource", ";", "@", "Mock", "private", "SystemStatus", "systemStatus", ";", "@", "Mock", "private", "ApplicationDirectories", "applicationDirectories", ";", "@", "Mock", "private", "File", "installDir", ";", "@", "Mock", "private", "RepositoryRegistry", "repositoryRegistry", ";", "@", "Mock", "private", "AbstractRepository", "repository", ";", "@", "Mock", "private", "CRepositoryCoreConfiguration", "coreConfig", ";", "@", "Mock", "private", "CRepository", "repositoryConfig", ";", "@", "Mock", "private", "CLocalStorage", "localStorage", ";", "@", "Mock", "private", "StorageWhitelist", "storageWhitelist", ";", "@", "Mock", "private", "NexusStartedEvent", "nexusStartedEvent", ";", "private", "Path", "testTempDir", ";", "private", "Path", "nexusPropPath", ";", "private", "StorageWhitelistUpgradeEvent", "underTest", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "underTest", "=", "new", "StorageWhitelistUpgradeEvent", "(", "applicationStatusSource", ",", "applicationDirectories", ",", "repositoryRegistry", ",", "storageWhitelist", ")", ";", "when", "(", "applicationStatusSource", ".", "getSystemStatus", "(", "))", ".", "thenReturn", "(", "systemStatus", ")", ";", "when", "(", "applicationDirectories", ".", "getInstallDirectory", "(", "))", ".", "thenReturn", "(", "installDir", ")", ";", "when", "(", "repositoryRegistry", ".", "getRepositories", "(", "))", ".", "thenReturn", "(", "newArrayList", "(", "repository", ")", ");", "when", "(", "repository", ".", "getCurrentCoreConfiguration", "(", "))", ".", "thenReturn", "(", "coreConfig", ")", ";", "when", "(", "coreConfig", ".", "getConfiguration", "(", "anyBoolean", "(", "))", ").", "thenReturn", "(", "repositoryConfig", ")", ";", "when", "(", "repositoryConfig", ".", "getLocalStorage", "(", "))", ".", "thenReturn", "(", "localStorage", ")", ";", "testTempDir", "=", "createTempDirectory", "(", "testName", ".", "getMethodName", "(", "))", ";", "createDirectory", "(", "testTempDir", ".", "resolve", "(", "\"", "conf", "\"", "))", ";", "nexusPropPath", "=", "testTempDir", ".", "resolve", "(", "\"", "conf", "/", "nexus", ".", "properties", "\"", ");", "when", "(", "installDir", ".", "getAbsolutePath", "(", "))", ".", "thenReturn", "(", "testTempDir", ".", "toAbsolutePath", "(", ").", "toString", "(", "))", ";", "}", "@", "After", "public", "void", "cleanup", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "testTempDir", ".", "toFile", "(", "))", ";", "}", "@", "Test", "public", "void", "doesNothingOnNonUpgradeStartup", "(", ")", "{", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "false", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "verifyZeroInteractions", "(", "storageWhitelist", ",", "applicationDirectories", ",", "repositoryRegistry", ")", ";", "}", "@", "Test", "public", "void", "createsWhitelistIfNotPresentOnUpgrade", "(", ")", "throws", "Exception", "{", "String", "storageUrl", "=", "\"", "/", "foo", "/", "bar", "\"", ";", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "storageUrl", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "1", ",", "storageUrl", ")", ";", "}", "@", "Test", "public", "void", "addsMultipleLocations", "(", ")", "throws", "Exception", "{", "when", "(", "repositoryRegistry", ".", "getRepositories", "(", "))", ".", "thenReturn", "(", "newArrayList", "(", "repository", ",", "repository", ",", "repository", ")", ");", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "\"/", "foo", "\"", ",", "\"", "/", "bar", "\"", ",", "\"", "/", "baz", "\"", ");", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "3", ",", "\"", "/", "foo", ",", "/", "bar", ",", "/", "baz", "\"", ");", "}", "@", "Test", "public", "void", "doesNotOverridePropertyIfExists", "(", ")", "throws", "Exception", "{", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "setProperty", "(", "PROP_NAME", ",", "\"", "/", "foo", "\"", ");", "try", "(", "OutputStream", "os", "=", "newOutputStream", "(", "nexusPropPath", ",", "CREATE_NEW", ")", ")", "{", "props", ".", "store", "(", "os", ",", "EMPTY", ")", ";", "}", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "\"/", "bar", "\"", ");", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "verifyZeroInteractions", "(", "storageWhitelist", ",", "repositoryRegistry", ")", ";", "validateProps", "(", "0", ",", "\"", "/", "foo", "\"", ");", "}", "@", "Test", "public", "void", "doesNotIncludeBlankLocations", "(", ")", "throws", "Exception", "{", "when", "(", "repositoryRegistry", ".", "getRepositories", "(", "))", ".", "thenReturn", "(", "newArrayList", "(", "repository", ",", "repository", ",", "repository", ")", ");", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "EMPTY", ",", "null", ",", "\"", "\"", ");", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "0", ",", "EMPTY", ")", ";", "}", "@", "Test", "public", "void", "preservesExistingPropertyFileFormat", "(", ")", "throws", "Exception", "{", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "setProperty", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ");", "try", "(", "OutputStream", "os", "=", "newOutputStream", "(", "nexusPropPath", ",", "CREATE_NEW", ")", ")", "{", "props", ".", "store", "(", "os", ",", "\"", "pre", "-", "existing", "-", "comment", "\"", ");", "}", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "\"/", "baz", "\"", ");", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "1", ",", "\"", "/", "baz", "\"", ");", "props", ".", "load", "(", "newInputStream", "(", "nexusPropPath", ",", "READ", ")", ");", "assertThat", "(", "\"", "Existing", "properties", "should", "still", "be", "present", "\"", ",", "props", ".", "get", "(", "\"", "foo", "\"", "),", "is", "(", "\"", "bar", "\"", "))", ";", "assertThat", "(", "\"", "Existing", "comments", "should", "still", "be", "present", "\"", ",", "readAllLines", "(", "nexusPropPath", ")", ",", "hasItem", "(", "\"#", "pre", "-", "existing", "-", "comment", "\"", "))", ";", "}", "private", "void", "validateProps", "(", "final", "int", "numWhitelistAdd", ",", "final", "String", "expectedValue", ")", "throws", "Exception", "{", "verify", "(", "storageWhitelist", ",", "times", "(", "numWhitelistAdd", ")", ").", "addWhitelistPath", "(", "anyString", "(", "))", ";", "assertThat", "(", "\"", "nexus", ".", "properties", "file", "should", "have", "been", "created", "\"", ",", "exists", "(", "nexusPropPath", ")", ",", "is", "(", "true", ")", ");", "Properties", "props", "=", "new", "Properties", "(", ");", "try", "(", "InputStream", "is", "=", "newInputStream", "(", "nexusPropPath", ",", "READ", ")", ")", "{", "props", ".", "load", "(", "is", ")", ";", "}", "assertThat", "(", "\"", "Whitelist", "property", "should", "have", "been", "written", "to", "nexus", ".", "properties", "\"", ",", "props", ".", "containsKey", "(", "PROP_NAME", ")", ");", "assertThat", "(", "\"", "Whitelist", "property", "did", "not", "have", "the", "expected", "value", "\"", ",", "props", ".", "getProperty", "(", "PROP_NAME", ")", ",", "is", "(", "expectedValue", ")", ");", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "csrfguard", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ehcache", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "launcher", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "common", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "locks", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "oss", "-", "edition", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "api", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "api", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "scheduler", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "security", "-", "realms", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "security", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "webapp", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "content", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "crypto", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "groovy", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "h2", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "logging", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "lvo", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "console", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "rrb", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "siesta", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "timeline", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ui", "-", "extjs3", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "unpack", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "webresources", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "testsuite", "-", "helper", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "atlas", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "kazuki", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plexusplugin", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "maven", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "archetype", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "maven", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "maven", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "maven", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "npm", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "npm", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "npm", "<", "/", "artifactId", ">", "@", "@", "-", "73", ",", "13", "+", "73", ",", "13", "@", "@", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "osgi", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "osgi", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "osgi", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "@", "@", "-", "68", ",", "7", "+", "68", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "85", ",", "27", "+", "85", ",", "27", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "120", ",", "14", "+", "120", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "testsuite", "-", "helper", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "testsuite", "-", "helper", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "logging", "-", "->", "@", "@", "-", "136", ",", "14", "+", "136", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "logging", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "logging", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "content", "-", "->", "@", "@", "-", "152", ",", "14", "+", "152", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "content", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "content", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "webresources", "-", "->", "@", "@", "-", "168", ",", "14", "+", "168", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webresources", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webresources", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "crypto", "-", "->", "@", "@", "-", "184", ",", "14", "+", "184", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "crypto", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "crypto", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "groovy", "-", "->", "@", "@", "-", "200", ",", "14", "+", "200", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovy", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovy", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "plexusplugin", "-", "->", "@", "@", "-", "216", ",", "14", "+", "216", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plexusplugin", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plexusplugin", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "h2", "-", "->", "@", "@", "-", "232", ",", "42", "+", "232", ",", "42", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "h2", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "h2", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "indexer", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "internal", "-", "->", "@", "@", "-", "276", ",", "20", "+", "276", ",", "20", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "kazuki", "-", "->", "@", "@", "-", "298", ",", "14", "+", "298", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kazuki", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kazuki", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "orient", "-", "->", "@", "@", "-", "314", ",", "22", "+", "314", ",", "22", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "kenai", "-", "->", "@", "@", "-", "338", ",", "14", "+", "338", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kenai", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kenai", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "ldap", "-", "->", "@", "@", "-", "354", ",", "22", "+", "354", ",", "22", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "realm", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "realm", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "realm", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "rutauth", "-", "->", "@", "@", "-", "378", ",", "14", "+", "378", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rutauth", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rutauth", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "402", ",", "14", "+", "402", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "lvo", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "lvo", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "maven", "-", "->", "@", "@", "-", "418", ",", "28", "+", "418", ",", "28", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "archetype", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "archetype", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "maven", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "maven", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "npm", "-", "->", "@", "@", "-", "448", ",", "14", "+", "448", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "469", ",", "29", "+", "469", ",", "29", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "obr", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "507", ",", "21", "+", "507", ",", "21", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "536", ",", "14", "+", "536", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "560", ",", "56", "+", "560", ",", "56", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "console", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "console", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "restlet", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet", "-", "bridge", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "testsupport", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "testsupport", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "rubygems", "-", "->", "@", "@", "-", "618", ",", "21", "+", "618", ",", "21", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "client", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "tools", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "656", ",", "14", "+", "656", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rrb", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rrb", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "siesta", "-", "->", "@", "@", "-", "672", ",", "14", "+", "672", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "siesta", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "siesta", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "site", "-", "->", "@", "@", "-", "688", ",", "14", "+", "688", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "709", ",", "7", "+", "709", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "atlas", "-", "->", "@", "@", "-", "718", ",", "14", "+", "718", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "atlas", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "atlas", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "timeline", "-", "->", "@", "@", "-", "734", ",", "14", "+", "734", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "timeline", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "timeline", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "ui", "-", "->", "@", "@", "-", "750", ",", "14", "+", "750", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ui", "-", "extjs3", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ui", "-", "extjs3", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "unpack", "-", "->", "@", "@", "-", "766", ",", "14", "+", "766", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "unpack", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "unpack", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "790", ",", "20", "+", "790", ",", "20", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "819", ",", "21", "+", "819", ",", "21", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet", "-", "bridge", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "380", ",", "15", "+", "380", ",", "15", "@", "@", "public", "Object", "upload", "(", "Context", "context", ",", "Request", "request", ",", "Response", "response", ",", "List", "<", "F", "}", "if", "(", "isPom", ")", "{", "helper", ".", "storeArtifactPom", "(", "gavRequest", ",", "is", ",", "null", ")", ";", "helper", ".", "storeArtifactPom", "(", "gavRequest", ",", "is", ",", "null", ",", "withChecksums", "(", "))", ";", "isPom", "=", "false", ";", "}", "else", "{", "if", "(", "uploadContext", ".", "isPomAvailable", "(", "))", "{", "helper", ".", "storeArtifact", "(", "gavRequest", ",", "is", ",", "null", ")", ";", "helper", ".", "storeArtifact", "(", "gavRequest", ",", "is", ",", "null", ",", "withChecksums", "(", "))", ";", "}", "else", "{", "helper", ".", "storeArtifactWithGeneratedPom", "(", "gavRequest", ",", "uploadContext", ".", "getPackaging", "(", "),", "is", ",", "null", ")", ";", "helper", ".", "storeArtifactWithGeneratedPom", "(", "gavRequest", ",", "uploadContext", ".", "getPackaging", "(", "),", "is", ",", "null", ",", "withChecksums", "(", "))", ";", "}", "}", "}", "@", "@", "-", "668", ",", "4", "+", "668", ",", "8", "@", "@", "protected", "boolean", "versionMatchesPolicy", "(", "String", "version", ",", "RepositoryPolicy", "policy", ")", "return", "result", ";", "}", "protected", "boolean", "withChecksums", "(", ")", "{", "return", "true", ";", "}", "}", "@", "@", "-", "17", ",", "12", "+", "17", ",", "15", "@", "@", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "InvalidConfigurationException", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "ValidationMessage", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "ValidationResponse", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "AuthenticationInfoConverter", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "GlobalRemoteConnectionSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRemoteAuthentication", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRemoteConnectionSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepositoryCoreConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "validator", ".", "ApplicationValidationResponse", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "NoSuchRepositoryException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "ResourceStoreRequest", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "item", ".", "RepositoryItemUid", ";", "@", "@", "-", "37", ",", "6", "+", "40", ",", "7", "@", "@", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "RemoteStatus", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "Repository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "ShadowRepository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "AbstractNexusPlexusResource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "NexusCompat", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "NoSuchRepositoryAccessException", ";", "@", "@", "-", "60", ",", "6", "+", "64", ",", "8", "@", "@", "import", "org", ".", "restlet", ".", "data", ".", "Status", ";", "import", "org", ".", "restlet", ".", "resource", ".", "ResourceException", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isNotEmpty", ";", "public", "abstract", "class", "AbstractRepositoryPlexusResource", "extends", "AbstractNexusPlexusResource", "{", "@", "@", "-", "76", ",", "6", "+", "82", ",", "8", "@", "@", "private", "RepositoryURLBuilder", "repositoryURLBuilder", ";", "private", "StorageWhitelist", "storageWhitelist", ";", "@", "Inject", "public", "void", "setAuthenticationInfoConverter", "(", "final", "AuthenticationInfoConverter", "authenticationInfoConverter", ")", "{", "this", ".", "authenticationInfoConverter", "=", "authenticationInfoConverter", ";", "@", "@", "-", "96", ",", "6", "+", "104", ",", "11", "@", "@", "public", "void", "setRepositoryURLBuilder", "(", "final", "RepositoryURLBuilder", "repositoryURLBuil", "this", ".", "repositoryURLBuilder", "=", "repositoryURLBuilder", ";", "}", "@", "Inject", "public", "void", "setStorageWhitelist", "(", "final", "StorageWhitelist", "storageWhitelist", ")", "{", "this", ".", "storageWhitelist", "=", "storageWhitelist", ";", "}", "protected", "AuthenticationInfoConverter", "getAuthenticationInfoConverter", "(", ")", "{", "return", "authenticationInfoConverter", ";", "}", "@", "@", "-", "448", ",", "4", "+", "461", ",", "30", "@", "@", "protected", "CRemoteConnectionSettings", "convertRemoteConnectionSettings", "(", "return", "cRemoteConnectionSettings", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "/", "**", "*", "Validates", "the", "specified", "{", "@", "code", "storageLocationUrl", "}", "as", "an", "allowed", "URL", "for", "the", "'", "overrideLocalStorageUrl", "'", "property", "*", "of", "a", "repository", "configuration", ".", "Valid", "values", "are", "based", "on", "the", "configured", "{", "@", "link", "StorageWhitelist", "}", "*", "*", "@", "param", "storageLocationUrl", "the", "requested", "local", "storage", "url", "*", "@", "return", "the", "{", "@", "code", "storageLocationUrl", "}", "if", "valid", "*", "@", "throws", "InvalidConfigurationException", "if", "{", "@", "code", "storageLocationUrl", "}", "is", "not", "whitelisted", "*", "/", "protected", "String", "validOverrideLocalStorageUrl", "(", "final", "String", "storageLocationUrl", ")", "throws", "InvalidConfigurationException", "{", "if", "(", "isNotEmpty", "(", "storageLocationUrl", ")", "&", "&", "!", "storageWhitelist", ".", "isApproved", "(", "storageLocationUrl", ")", ")", "{", "getLogger", "(", ").", "warn", "(", "\"", "The", "location", "'", "{}", "'", "has", "not", "been", "whitelisted", "for", "use", "as", "repository", "storage", ".", "Add", "the", "value", "to", "the", "'", "{}", "'", "property", "in", "nexus", ".", "properties", ".", "See", "'", "Override", "Storage", "Location", "'", "under", "{", "}", "for", "details", "\"", ",", "storageLocationUrl", ",", "StorageWhitelist", ".", "PROP_NAME", ",", "\"", "https", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nxrm2", "/", "configuring", "-", "repositories", "\"", ");", "String", "message", "=", "\"", "Specified", "location", "is", "not", "approved", "for", "storage", ".", "See", "nexus", ".", "log", "for", "details", ".", "\";", "ValidationResponse", "vr", "=", "new", "ApplicationValidationResponse", "(", ");", "ValidationMessage", "error", "=", "new", "ValidationMessage", "(", "\"", "overrideLocalStorageUrl", "\"", ",", "message", ",", "message", ")", ";", "vr", ".", "addValidationError", "(", "error", ")", ";", "throw", "new", "InvalidConfigurationException", "(", "vr", ")", ";", "}", "return", "storageLocationUrl", ";", "}", "}", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "javax", ".", "ws", ".", "rs", ".", "Produces", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "ConfigurationException", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "InvalidConfigurationException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CLocalStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRemoteStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepository", ";", "@", "@", "-", "48", ",", "7", "+", "49", ",", "6", "@", "@", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PathProtectionDescriptor", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PlexusResourceException", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "codehaus", ".", "enunciate", ".", "contract", ".", "jaxrs", ".", "ResourceMethodSignature", ";", "import", "org", ".", "codehaus", ".", "plexus", ".", "util", ".", "xml", ".", "Xpp3Dom", ";", "import", "org", ".", "restlet", ".", "Context", ";", "@", "@", "-", "58", ",", "6", "+", "58", ",", "8", "@", "@", "import", "org", ".", "restlet", ".", "resource", ".", "ResourceException", ";", "import", "org", ".", "restlet", ".", "resource", ".", "Variant", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isNotEmpty", ";", "/", "**", "*", "A", "resource", "list", "for", "Repository", "list", ".", "*", "@", "@", "-", "172", ",", "90", "+", "174", ",", "95", "@", "@", "public", "CRepository", "getRepositoryAppModel", "(", "RepositoryBaseResource", "resource", ",", "CRepos", "{", "CRepository", "appModel", "=", "new", "DefaultCRepository", "(", ");", "Xpp3Dom", "ex", "=", "null", ";", "appModel", ".", "setLocalStatus", "(", "LocalStatus", ".", "IN_SERVICE", ".", "name", "(", "))", ";", "if", "(", "target", "!", "=", "null", ")", "{", "appModel", ".", "setLocalStatus", "(", "target", ".", "getLocalStatus", "(", "))", ";", "try", "{", "Xpp3Dom", "ex", "=", "null", ";", "ex", "=", "(", "Xpp3Dom", ")", "target", ".", "getExternalConfiguration", "(", ");", "}", "else", "{", "ex", "=", "new", "Xpp3Dom", "(", "DefaultCRepository", ".", "EXTERNAL_CONFIGURATION_NODE_NAME", ")", ";", "}", "appModel", ".", "setLocalStatus", "(", "LocalStatus", ".", "IN_SERVICE", ".", "name", "(", "))", ";", "if", "(", "target", "!", "=", "null", ")", "{", "appModel", ".", "setLocalStatus", "(", "target", ".", "getLocalStatus", "(", "))", ";", "appModel", ".", "setId", "(", "resource", ".", "getId", "(", "))", ";", "ex", "=", "(", "Xpp3Dom", ")", "target", ".", "getExternalConfiguration", "(", ");", "}", "else", "{", "ex", "=", "new", "Xpp3Dom", "(", "DefaultCRepository", ".", "EXTERNAL_CONFIGURATION_NODE_NAME", ")", ";", "}", "appModel", ".", "setName", "(", "resource", ".", "getName", "(", "))", ";", "appModel", ".", "setId", "(", "resource", ".", "getId", "(", "))", ";", "appModel", ".", "setExposed", "(", "resource", ".", "isExposed", "(", "))", ";", "appModel", ".", "setName", "(", "resource", ".", "getName", "(", "))", ";", "appModel", ".", "setProviderRole", "(", "resource", ".", "getProviderRole", "(", "))", ";", "appModel", ".", "setExposed", "(", "resource", ".", "isExposed", "(", "))", ";", "if", "(", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_VIRTUAL", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "appModel", ".", "setProviderRole", "(", "resource", ".", "getProviderRole", "(", "))", ";", "/", "/", "indexer", "is", "unaware", "of", "the", "m2", "layout", "conversion", "appModel", ".", "setIndexable", "(", "false", ")", ";", "if", "(", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_VIRTUAL", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "RepositoryShadowResource", "repoResource", "=", "(", "RepositoryShadowResource", ")", "resource", ";", "/", "/", "indexer", "is", "unaware", "of", "the", "m2", "layout", "conversion", "appModel", ".", "setIndexable", "(", "false", ")", ";", "M2LayoutedM1ShadowRepositoryConfiguration", "exConf", "=", "new", "M2LayoutedM1ShadowRepositoryConfiguration", "(", "ex", ")", ";", "RepositoryShadowResource", "repoResource", "=", "(", "RepositoryShadowResource", ")", "resource", ";", "exConf", ".", "setMasterRepositoryId", "(", "repoResource", ".", "getShadowOf", "(", "))", ";", "M2LayoutedM1ShadowRepositoryConfiguration", "exConf", "=", "new", "M2LayoutedM1ShadowRepositoryConfiguration", "(", "ex", ")", ";", "exConf", ".", "setSynchronizeAtStartup", "(", "repoResource", ".", "isSyncAtStartup", "(", "))", ";", "exConf", ".", "setMasterRepositoryId", "(", "repoResource", ".", "getShadowOf", "(", "))", ";", "}", "else", "if", "(", "!", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_GROUP", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "RepositoryResource", "repoResource", "=", "(", "RepositoryResource", ")", "resource", ";", "exConf", ".", "setSynchronizeAtStartup", "(", "repoResource", ".", "isSyncAtStartup", "(", "))", ";", "/", "/", "we", "can", "use", "the", "default", "if", "the", "value", "is", "empty", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "repoResource", ".", "getWritePolicy", "(", "))", ")", "{", "appModel", ".", "setWritePolicy", "(", "repoResource", ".", "getWritePolicy", "(", "))", ";", "}", "else", "if", "(", "!", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_GROUP", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "RepositoryResource", "repoResource", "=", "(", "RepositoryResource", ")", "resource", ";", "appModel", ".", "setBrowseable", "(", "repoResource", ".", "isBrowseable", "(", "))", ";", "/", "/", "we", "can", "use", "the", "default", "if", "the", "value", "is", "empty", "if", "(", "isNotEmpty", "(", "repoResource", ".", "getWritePolicy", "(", "))", ")", "{", "appModel", ".", "setWritePolicy", "(", "repoResource", ".", "getWritePolicy", "(", "))", ";", "}", "appModel", ".", "setIndexable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setSearchable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setBrowseable", "(", "repoResource", ".", "isBrowseable", "(", "))", ";", "appModel", ".", "setNotFoundCacheTTL", "(", "repoResource", ".", "getNotFoundCacheTTL", "(", "))", ";", "appModel", ".", "setIndexable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setSearchable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "appModel", ".", "setNotFoundCacheTTL", "(", "repoResource", ".", "getNotFoundCacheTTL", "(", "))", ";", "M2RepositoryConfiguration", "exConf", "=", "new", "M2RepositoryConfiguration", "(", "ex", ")", ";", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "exConf", ".", "setRepositoryPolicy", "(", "EnumUtil", ".", "valueOf", "(", "repoResource", ".", "getRepoPolicy", "(", "),", "RepositoryPolicy", ".", "class", ")", ");", "M2RepositoryConfiguration", "exConf", "=", "new", "M2RepositoryConfiguration", "(", "ex", ")", ";", "if", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", ")", "!", "=", "null", ")", "{", "appModel", ".", "setLocalStorage", "(", "new", "CLocalStorage", "(", "))", ";", "exConf", ".", "setRepositoryPolicy", "(", "EnumUtil", ".", "valueOf", "(", "repoResource", ".", "getRepoPolicy", "(", "),", "RepositoryPolicy", ".", "class", ")", ");", "appModel", ".", "getLocalStorage", "(", ").", "setUrl", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", "))", ";", "if", "(", "isNotEmpty", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", "))", ")", "{", "appModel", ".", "setLocalStorage", "(", "new", "CLocalStorage", "(", "))", ";", "appModel", ".", "getLocalStorage", "(", ").", "setProvider", "(", "\"", "file", "\"", ");", "}", "else", "{", "appModel", ".", "setLocalStorage", "(", "null", ")", ";", "}", "appModel", ".", "getLocalStorage", "(", ").", "setUrl", "(", "validOverrideLocalStorageUrl", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", "))", ");", "appModel", ".", "getLocalStorage", "(", ").", "setProvider", "(", "\"", "file", "\"", ");", "}", "else", "{", "appModel", ".", "setLocalStorage", "(", "null", ")", ";", "}", "RepositoryResourceRemoteStorage", "remoteStorage", "=", "repoResource", ".", "getRemoteStorage", "(", ");", "if", "(", "remoteStorage", "!", "=", "null", ")", "{", "appModel", ".", "setNotFoundCacheActive", "(", "true", ")", ";", "RepositoryResourceRemoteStorage", "remoteStorage", "=", "repoResource", ".", "getRemoteStorage", "(", ");", "if", "(", "remoteStorage", "!", "=", "null", ")", "{", "appModel", ".", "setNotFoundCacheActive", "(", "true", ")", ";", "appModel", ".", "setRemoteStorage", "(", "new", "CRemoteStorage", "(", "))", ";", "appModel", ".", "setRemoteStorage", "(", "new", "CRemoteStorage", "(", "))", ";", "appModel", ".", "getRemoteStorage", "(", ").", "setUrl", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ";", "appModel", ".", "getRemoteStorage", "(", ").", "setUrl", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ";", "appModel", ".", "getRemoteStorage", "(", ").", "setProvider", "(", "remoteProviderHintFactory", ".", "getDefaultRoleHint", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ");", "appModel", ".", "getRemoteStorage", "(", ").", "setProvider", "(", "remoteProviderHintFactory", ".", "getDefaultRoleHint", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ");", "}", "}", "}", "appModel", ".", "setProviderHint", "(", "resource", ".", "getProvider", "(", "))", ";", "appModel", ".", "setProviderHint", "(", "resource", ".", "getProvider", "(", "))", ";", "if", "(", "RepositoryProxyResource", ".", "class", ".", "isAssignableFrom", "(", "resource", ".", "getClass", "(", "))", ")", "{", "appModel", "=", "getRepositoryProxyAppModel", "(", "(", "RepositoryProxyResource", ")", "resource", ",", "appModel", ")", ";", "if", "(", "RepositoryProxyResource", ".", "class", ".", "isAssignableFrom", "(", "resource", ".", "getClass", "(", "))", ")", "{", "appModel", "=", "getRepositoryProxyAppModel", "(", "(", "RepositoryProxyResource", ")", "resource", ",", "appModel", ")", ";", "}", "}", "catch", "(", "InvalidConfigurationException", "e", ")", "{", "handleConfigurationException", "(", "e", ")", ";", "}", "return", "appModel", ";", "@", "@", "-", "297", ",", "7", "+", "297", ",", "7", "@", "@", "public", "Object", "put", "(", "Context", "context", ",", "Request", "request", ",", "Response", "response", ",", "Object", "pa", "}", "}", "repository", ".", "setLocalUrl", "(", "model", ".", "getOverrideLocalStorageUrl", "(", "))", ";", "repository", ".", "setLocalUrl", "(", "validOverrideLocalStorageUrl", "(", "model", ".", "getOverrideLocalStorageUrl", "(", "))", ");", "getNexusConfiguration", "(", ").", "saveConfiguration", "(", ");", "}", "@", "@", "-", "12", ",", "21", "+", "12", ",", "27", "@", "@", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "repositories", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "NexusAppTestSupport", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "NexusConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "ChecksumPolicy", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "RepositoryPolicy", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "Repository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "RepositoryWritePolicy", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "AbstractNexusPlexusResource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "AuthenticationSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RemoteConnectionSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RepositoryProxyResource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RepositoryResourceRemoteStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RepositoryResourceResponse", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PlexusResource", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PlexusResourceException", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "error", ".", "ErrorMessage", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "error", ".", "ErrorResponse", ";", "import", "junit", ".", "framework", ".", "Assert", ";", "import", "org", ".", "codehaus", ".", "plexus", ".", "context", ".", "Context", ";", "import", "org", ".", "codehaus", ".", "plexus", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "37", ",", "6", "+", "43", ",", "7", "@", "@", "public", "class", "RepositoryCreateUpdateTest", "extends", "NexusAppTestSupport", "{", "private", "static", "final", "String", "OVERRIDE_LOCAL_STORAGE_PATH", "=", "\"", "storage", "/", "foo", "/", "bar", "\"", ";", "@", "Before", "public", "void", "prepare", "(", ")", "@", "@", "-", "45", ",", "6", "+", "52", ",", "12", "@", "@", "public", "void", "prepare", "(", ")", "startNx", "(", ");", "}", "@", "Override", "protected", "void", "customizeContext", "(", "final", "Context", "ctx", ")", "{", "super", ".", "customizeContext", "(", "ctx", ")", ";", "ctx", ".", "put", "(", "StorageWhitelist", ".", "PROP_NAME", ",", "Paths", ".", "get", "(", "getWorkHomeDir", "(", ").", "getAbsolutePath", "(", "),", "OVERRIDE_LOCAL_STORAGE_PATH", ")", ");", "}", "@", "Test", "public", "void", "testCreate", "(", ")", "throws", "Exception", "@", "@", "-", "304", ",", "10", "+", "317", ",", "9", "@", "@", "public", "void", "testCreateAuthNoProxy", "(", ")", "public", "void", "testUpdateLocalStorage", "(", ")", "throws", "Exception", "{", "RepositoryProxyResource", "originalResource", "=", "this", ".", "sendAndGetResponse", "(", ");", "String", "newlocalStorage", "=", "originalResource", ".", "getDefaultLocalStorageUrl", "(", ").", "replaceAll", "(", "originalResource", ".", "getId", "(", "),", "\"", "foo", "/", "bar", "\"", ");", "originalResource", ".", "getDefaultLocalStorageUrl", "(", ").", "replaceAll", "(", "originalResource", ".", "getId", "(", "),", "\"", "foo", "/", "baz", "\"", ");", "originalResource", ".", "setOverrideLocalStorageUrl", "(", "newlocalStorage", ")", ";", "RepositoryPlexusResource", "plexusResource", "=", "@", "@", "-", "321", ",", "6", "+", "333", ",", "24", "@", "@", "public", "void", "testUpdateLocalStorage", "(", ")", "RepositoryResourceResponse", "repoRequest", "=", "new", "RepositoryResourceResponse", "(", ");", "repoRequest", ".", "setData", "(", "originalResource", ")", ";", "/", "/", "request", "should", "fail", "as", "the", "storage", "location", "is", "not", "whitelisted", "try", "{", "plexusResource", ".", "put", "(", "null", ",", "request", ",", "response", ",", "repoRequest", ")", ";", "org", ".", "junit", ".", "Assert", ".", "fail", "(", "\"", "Expected", "update", "to", "fail", "due", "to", "non", "-", "whitelisted", "storage", "location", "\"", ");", "}", "catch", "(", "PlexusResourceException", "e", ")", "{", "ErrorResponse", "errorResponse", "=", "(", "ErrorResponse", ")", "e", ".", "getResultObject", "(", ");", "assert", "errorResponse", "!", "=", "null", "&", "&", "errorResponse", ".", "getErrors", "(", ").", "size", "(", ")", "=", "=", "1", ";", "ErrorMessage", "errorMessage", "=", "(", "ErrorMessage", ")", "errorResponse", ".", "getErrors", "(", ").", "get", "(", "0", ")", ";", "assert", "errorMessage", "!", "=", "null", "&", "&", "errorMessage", ".", "getId", "(", ").", "equals", "(", "\"", "overrideLocalStorageUrl", "\"", ")", "&", "&", "errorMessage", ".", "getMsg", "(", ").", "equals", "(", "\"", "Specified", "location", "is", "not", "approved", "for", "storage", ".", "See", "nexus", ".", "log", "for", "details", ".", "\")", ";", "}", "/", "/", "use", "a", "whitelisted", "storage", "location", "newlocalStorage", "=", "Paths", ".", "get", "(", "getWorkHomeDir", "(", ").", "getAbsolutePath", "(", "),", "OVERRIDE_LOCAL_STORAGE_PATH", ",", "originalResource", ".", "getId", "(", "))", ".", "toString", "(", ");", "originalResource", ".", "setOverrideLocalStorageUrl", "(", "newlocalStorage", ")", ";", "repoRequest", ".", "setData", "(", "originalResource", ")", ";", "RepositoryResourceResponse", "repoResponse", "=", "(", "RepositoryResourceResponse", ")", "plexusResource", ".", "put", "(", "null", ",", "request", ",", "response", ",", "repoRequest", ")", ";", "RepositoryProxyResource", "result", "=", "(", "RepositoryProxyResource", ")", "repoResponse", ".", "getData", "(", ");", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "testsupport", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "tools", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "kenai", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "rutauth", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "yum", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "yum", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "sonatype", ".", "gossip", ".", "support", ".", "LoggingOutputStream", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "com", ".", "google", ".", "common", ".", "annotations", ".", "VisibleForTesting", ";", "import", "org", ".", "apache", ".", "commons", ".", "exec", ".", "CommandLine", ";", "import", "org", ".", "apache", ".", "commons", ".", "exec", ".", "DefaultExecutor", ";", "import", "org", ".", "apache", ".", "commons", ".", "exec", ".", "PumpStreamHandler", ";", "@", "@", "-", "99", ",", "13", "+", "100", ",", "19", "@", "@", "public", "int", "exec", "(", "final", "String", "command", ",", "String", "params", ",", "OutputStream", "out", ",", "OutputStr", "return", "exitValue", ";", "}", "private", "String", "getCleanCommand", "(", "String", "command", ",", "String", "params", ")", "{", "@", "VisibleForTesting", "String", "getCleanCommand", "(", "String", "command", ",", "String", "params", ")", "{", "if", "(", "allowedExecutables", ".", "contains", "(", "command", ")", ")", "{", "return", "command", "+", "\"", "\"", "+", "params", ";", "}", "File", "file", "=", "new", "File", "(", "command", ")", ";", "if", "(", "!", "file", ".", "exists", "(", "))", "{", "LOG", ".", "debug", "(", "\"", "Attempt", "to", "execute", "command", "that", "doesn", "'", "t", "exist", "{", "}\"", ",", "file", ".", "getAbsolutePath", "(", "))", ";", "return", "null", ";", "}", "if", "(", "file", ".", "getAbsolutePath", "(", ").", "startsWith", "(", "applicationDirectories", ".", "getWorkDirectory", "(", ").", "getAbsolutePath", "(", "))", ")", "{", "LOG", ".", "debug", "(", "\"", "Attempt", "to", "execute", "command", "with", "illegal", "path", "{", "}\"", ",", "file", ".", "getAbsolutePath", "(", "))", ";", "return", "null", ";", "@", "@", "-", "13", ",", "14", "+", "13", ",", "19", "@", "@", "package", "org", ".", "sonatype", ".", "nexus", ".", "yum", ".", "internal", ".", "task", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "yum", ".", "internal", ".", "support", ".", "YumNexusTestSupport", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "nullValue", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "@", "-", "29", ",", "62", "+", "34", ",", "65", "@", "@", "{", "private", "CommandLineExecutor", "underTest", ";", "private", "ApplicationDirectories", "applicationDirectories", ";", "@", "Rule", "public", "TemporaryFolder", "tmp", "=", "new", "TemporaryFolder", "(", ");", "@", "Before", "public", "void", "setup", "(", ")", "{", "applicationDirectories", "=", "mock", "(", "ApplicationDirectories", ".", "class", ")", ";", "when", "(", "applicationDirectories", ".", "getWorkDirectory", "(", "))", ".", "thenReturn", "(", "new", "File", "(", "\"/", "a", "/", "dir", "\"", "))", ";", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createrepo", ",", "mergerepo", "\"", ");", "}", "private", "File", "work", ";", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_createRepo", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "createrepo", "\"", ",", "\"", "--", "version", "\"", ");", "}", "private", "File", "bin", ";", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_createRepoNoPath", "(", ")", "throws", "Exception", "{", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createreposhouldntexist", ",", "mergereposhouldntexist", "\"", ");", "underTest", ".", "exec", "(", "\"", "createreposhouldntexist", "\"", ",", "\"", "--", "version", "\"", ");", "}", "private", "File", "createrepo", ";", "private", "File", "notcreaterepo", ";", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_mergeRepo", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "mergerepo", "\"", ",", "\"", "--", "version", "\"", ");", "private", "File", "workcreaterepo", ";", "private", "File", "mergerepo", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "work", "=", "tmp", ".", "newFolder", "(", "\"", "work", "\"", ");", "bin", "=", "tmp", ".", "newFolder", "(", "\"", "bin", "\"", ");", "createrepo", "=", "tmp", ".", "newFile", "(", "\"", "bin", "\"", "+", "File", ".", "separator", "+", "\"", "createrepo", "\"", ");", "notcreaterepo", "=", "tmp", ".", "newFile", "(", "\"", "bin", "\"", "+", "File", ".", "separator", "+", "\"", "notcreaterepo", "\"", ");", "workcreaterepo", "=", "tmp", ".", "newFile", "(", "\"", "work", "\"", "+", "File", ".", "separator", "+", "\"", "createrepo", "\"", ");", "mergerepo", "=", "tmp", ".", "newFile", "(", "\"", "bin", "\"", "+", "File", ".", "separator", "+", "\"", "mergerepo", "\"", ");", "ApplicationDirectories", "applicationDirectories", "=", "mock", "(", "ApplicationDirectories", ".", "class", ")", ";", "when", "(", "applicationDirectories", ".", "getWorkDirectory", "(", "))", ".", "thenReturn", "(", "work", ")", ";", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createrepo", ",", "mergerepo", "\"", ");", "}", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_mergeRepoNoPath", "(", ")", "throws", "Exception", "{", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createreposhouldntexist", ",", "mergereposhouldntexist", "\"", ");", "underTest", ".", "exec", "(", "\"", "mergereposhouldntexist", "\"", ",", "\"", "--", "version", "\"", ");", "@", "Test", "public", "void", "getCleanCommand_legalAccess", "(", ")", "{", "assertCleanCommand", "(", "\"", "createrepo", "\"", ");", "assertCleanCommand", "(", "\"", "mergerepo", "\"", ");", "assertCleanCommand", "(", "createrepo", ".", "getAbsolutePath", "(", "))", ";", "assertCleanCommand", "(", "mergerepo", ".", "getAbsolutePath", "(", "))", ";", "}", "/", "/", "IllegalAccessException", "should", "be", "thrown", "as", "this", "executable", "isn", "'", "t", "allowed", "@", "Test", "(", "expected", "=", "IllegalAccessException", ".", "class", ")", "public", "void", "exec_notAllowed", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "somethingelse", "\"", ",", "\"", "--", "someotherflag", "\"", ");", "@", "Test", "public", "void", "getCleanCommand_illegalAccess", "(", ")", "{", "assertNotCleanCommand", "(", "\"/", "fake", "/", "path", "/", "createrepo", "\"", ");", "assertNotCleanCommand", "(", "\"/", "fake", "/", "path", "/", "mergerepo", "\"", ");", "assertNotCleanCommand", "(", "\"/", "fake", "/", "path", "/", "somethingelse", "\"", ");", "assertNotCleanCommand", "(", "bin", ".", "getAbsolutePath", "(", ")", "+", "File", ".", "separator", "+", "\"", "createreposhouldntexist", "\"", ");", "/", "/", "exists", "but", "isn", "'", "t", "in", "allowed", "executables", "assertNotCleanCommand", "(", "notcreaterepo", ".", "getAbsolutePath", "(", "))", ";", "/", "/", "extra", "command", "args", "are", "not", "allowed", "assertNotCleanCommand", "(", "bin", ".", "getAbsolutePath", "(", ")", "+", "File", ".", "separator", "+", "\"", "createrepo", "-", "-", "somethingbad", "\"", ");", "/", "/", "commands", "launching", "things", "inside", "nexus", "are", "not", "allowed", "assertNotCleanCommand", "(", "workcreaterepo", ".", "getAbsolutePath", "(", "))", ";", "/", "/", "this", "will", "trick", "weak", "validation", "logic", "into", "thinking", "it", "'", "s", "a", "path", "to", "a", "createrepo", "executable", "assertNotCleanCommand", "(", "\"/", "bin", "/", "bash", "-", "c", "curl", "$", "{", "IFS", "}", "http", ":", "//", "192", ".", "168", ".", "88", ".", "1", ":", "8000", "/", "|", "|", "\"", "+", "createrepo", ".", "getAbsolutePath", "(", "))", ";", "}", "/", "/", "IllegalAccessException", "should", "be", "thrown", "as", "commands", "launching", "things", "inside", "nexus", "are", "not", "allowed", "@", "Test", "(", "expected", "=", "IllegalAccessException", ".", "class", ")", "public", "void", "exec_pathNotAllowed", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "a", "/", "dir", "/", "createrepo", "\"", ",", "\"", "--", "someotherflag", "\"", ");", "private", "void", "assertCleanCommand", "(", "String", "command", ")", "{", "assertThat", "(", "underTest", ".", "getCleanCommand", "(", "command", ",", "\"", "--", "version", "\"", "),", "is", "(", "not", "(", "nullValue", "(", "))", "))", ";", "}", "@", "Test", "(", "expected", "=", "IllegalAccessException", ".", "class", ")", "public", "void", "exec_extraConfigNotAllowed", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "createrepo", "-", "-", "somethingbad", "\"", ",", "\"", "--", "someotherflag", "\"", ");", "private", "void", "assertNotCleanCommand", "(", "String", "command", ")", "{", "assertThat", "(", "underTest", ".", "getCleanCommand", "(", "command", ",", "\"", "--", "version", "\"", "),", "is", "(", "nullValue", "(", "))", ");", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "yum", "<", "/", "artifactId", ">", "@", "@", "-", "28", ",", "7", "+", "28", ",", "7", "@", "@", "<", "name", ">", "${", "project", ".", "groupId", "}", ":$", "{", "project", ".", "artifactId", "}", "</", "name", ">", "<", "packaging", ">", "pom", "<", "/", "packaging", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "inceptionYear", ">", "2008", "<", "/", "inceptionYear", ">", "<", "url", ">", "http", ":", "//", "nexus", ".", "sonatype", ".", "org", "/", "</", "url", ">", "@", "@", "-", "92", ",", "7", "+", "92", ",", "7", "@", "@", "Define", "nexus", "versions", ".", "The", "'", "nexus", ".", "version", "'", "property", "always", "refers", "to", "the", "version", "of", "the", "current", "project", ".", "These", "values", "must", "always", "be", "constants", ";", "'", "nexus", ".", "version", "'", "will", "get", "update", "automatically", "by", "set", "-", "version", ".", "-", "->", "<", "nexus", ".", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "nexus", ".", "version", ">", "<", "nexus", ".", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "nexus", ".", "version", ">", "<", "!-", "-", "FIXME", ":", "WTF", "is", "this", "for", ",", "part", "of", "the", "http", "proxy", "changes", ",", "used", "in", "subst", "in", "test", "files", ":", "-(", "-", "->", "<", "nexus", ".", "configuration", ".", "version", ">", "2", ".", "8", ".", "0", "<", "/", "nexus", ".", "configuration", ".", "version", ">", "@", "@", "-", "164", ",", "123", "+", "164", ",", "123", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "base", "-", "configuration", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "bootstrap", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "client", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "configuration", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "classifier", ">", "tests", "<", "/", "classifier", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "csrfguard", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ehcache", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "launcher", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "locks", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "oss", "-", "edition", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "api", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "api", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "scheduler", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "security", "-", "realms", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webapp", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webapp", "<", "/", "artifactId", ">", "<", "type", ">", "war", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "testsupport", "-", "->", "@", "@", "-", "290", ",", "45", "+", "290", ",", "45", "@", "@", "<", "artifactId", ">", "nexus", "-", "it", "-", "helper", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "harness", "-", "launcher", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "support", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "assemblies", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "assemblies", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "bundle", "-", "template", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "/", "dependency", ">", "@", "@", "-", "651", ",", "7", "+", "651", ",", "7", "@", "@", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "environment", "-", "maven", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "pluginManagement", ">", "@", "@", "-", "734", ",", "9", "+", "734", ",", "9", "@", "@", "<", "exclude", ">", "commons", "-", "vfs", ":", "commons", "-", "vfs", "<", "/", "exclude", ">", "<", "!-", "-", "Ban", "beanutils", "which", "includes", "commons", "-", "collections", ".", "Ban", "beanutils", "pre", "-", "1", ".", "9", "which", "includes", "embedded", "commons", "-", "collections", ".", "-", "->", "<", "exclude", ">", "commons", "-", "beanutils", ":", "commons", "-", "beanutils", "<", "/", "exclude", ">", "<", "exclude", ">", "commons", "-", "beanutils", ":", "commons", "-", "beanutils", ":", "(,", "1", ".", "9", "]", "</", "exclude", ">", "<", "!-", "-", "Security", "hazard", ":", "osvdb", "-", "68314", "@", "@", "-", "1", "+", "1", "@", "@", "b", "=", "release", "-", "2", ".", "14", ".", "14", ",", "r", "=", "37c24494ded9b6ce64d4bef5d2f81e8187d370a6", ",", "t", "=", "2019", "-", "08", "-", "07", "-", "1118", "-", "4244", "\\", "No", "newline", "at", "end", "of", "file", "b", "=", "release", "-", "2", ".", "14", ".", "15", ",", "r", "=", "68bc0271bf58b1bcd452d85022a385cfca949727", ",", "t", "=", "2019", "-", "10", "-", "08", "-", "1119", "-", "3412", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "testsuite", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "legacy", "-", "testsuite", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "testsuite", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "modern", "-", "testsuite", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "testsuite", "<", "/", "groupId", ">", "@", "@", "-", "53", ",", "15", "+", "53", ",", "15", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "it", "-", "helper", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "common", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "environment", "-", "maven", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "support", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "@", "@", "-", "46", ",", "7", "+", "46", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">"], "docstring_tokens": ["execute", "arbitrary", "commands", "on", "the", "system"]}
{"contents": ["#57031", "-", "Out", "of", "Memory", "when", "extracting", "text", "from", "attached", "files", "git-svn-id:", "https://svn.apache.org/repos/asf/poi/trunk@1734182", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "18", ",", "24", "+", "18", ",", "30", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "package", "org", ".", "apache", ".", "poi", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "SchemaType", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlBeans", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlException", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlObject", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlOptions", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "xml", ".", "stream", ".", "XMLInputStream", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "public", "class", "POIXMLTypeLoader", "{", "@", "@", "-", "77", ",", "27", "+", "83", ",", "51", "@", "@", "public", "static", "XmlObject", "newInstance", "(", "SchemaType", "type", ",", "XmlOptions", "options", ")", "{", "}", "public", "static", "XmlObject", "parse", "(", "String", "xmlText", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", "{", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "xmlText", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "try", "{", "return", "parse", "(", "new", "StringReader", "(", "xmlText", ")", ",", "type", ",", "options", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "XmlException", "(", "\"", "Unable", "to", "parse", "xml", "bean", "\"", ",", "e", ")", ";", "}", "}", "public", "static", "XmlObject", "parse", "(", "File", "file", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", ",", "IOException", "{", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "file", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "InputStream", "is", "=", "new", "FileInputStream", "(", "file", ")", ";", "try", "{", "return", "parse", "(", "is", ",", "type", ",", "options", ")", ";", "}", "finally", "{", "is", ".", "close", "(", ");", "}", "}", "public", "static", "XmlObject", "parse", "(", "URL", "file", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", ",", "IOException", "{", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "file", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "InputStream", "is", "=", "file", ".", "openStream", "(", ");", "try", "{", "return", "parse", "(", "is", ",", "type", ",", "options", ")", ";", "}", "finally", "{", "is", ".", "close", "(", ");", "}", "}", "public", "static", "XmlObject", "parse", "(", "InputStream", "jiois", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", ",", "IOException", "{", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "jiois", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "try", "{", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "jiois", ")", ";", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "doc", ".", "getDocumentElement", "(", "),", "type", ",", "getXmlOptions", "(", "options", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "parse", "xml", "bean", "\"", ",", "e", ")", ";", "}", "}", "public", "static", "XmlObject", "parse", "(", "XMLStreamReader", "xsr", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", "{", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "xsr", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "}", "public", "static", "XmlObject", "parse", "(", "Reader", "jior", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", ",", "IOException", "{", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "jior", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "try", "{", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "new", "InputSource", "(", "jior", ")", ");", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "doc", ".", "getDocumentElement", "(", "),", "type", ",", "getXmlOptions", "(", "options", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "XmlException", "(", "\"", "Unable", "to", "parse", "xml", "bean", "\"", ",", "e", ")", ";", "}", "}", "public", "static", "XmlObject", "parse", "(", "Node", "node", ",", "SchemaType", "type", ",", "XmlOptions", "options", ")", "throws", "XmlException", "{", "@", "@", "-", "29", ",", "20", "+", "29", ",", "61", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "xml", ".", "sax", ".", "ErrorHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "public", "final", "class", "DocumentHelper", "{", "private", "static", "POILogger", "logger", "=", "POILogFactory", ".", "getLogger", "(", "DocumentHelper", ".", "class", ")", ";", "private", "DocumentHelper", "(", ")", "{", "}", "private", "static", "class", "DocHelperErrorHandler", "implements", "ErrorHandler", "{", "public", "void", "warning", "(", "SAXParseException", "exception", ")", "throws", "SAXException", "{", "printError", "(", "POILogger", ".", "WARN", ",", "exception", ")", ";", "}", "public", "void", "error", "(", "SAXParseException", "exception", ")", "throws", "SAXException", "{", "printError", "(", "POILogger", ".", "ERROR", ",", "exception", ")", ";", "}", "public", "void", "fatalError", "(", "SAXParseException", "exception", ")", "throws", "SAXException", "{", "printError", "(", "POILogger", ".", "FATAL", ",", "exception", ")", ";", "throw", "exception", ";", "}", "/", "**", "Prints", "the", "error", "message", ".", "*", "/", "private", "void", "printError", "(", "int", "type", ",", "SAXParseException", "ex", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "String", "systemId", "=", "ex", ".", "getSystemId", "(", ");", "if", "(", "systemId", "!", "=", "null", ")", "{", "int", "index", "=", "systemId", ".", "lastIndexOf", "(", "'/", "')", ";", "if", "(", "index", "!", "=", "-", "1", ")", "systemId", "=", "systemId", ".", "substring", "(", "index", "+", "1", ")", ";", "sb", ".", "append", "(", "systemId", ")", ";", "}", "sb", ".", "append", "(", "':", "')", ";", "sb", ".", "append", "(", "ex", ".", "getLineNumber", "(", "))", ";", "sb", ".", "append", "(", "':", "')", ";", "sb", ".", "append", "(", "ex", ".", "getColumnNumber", "(", "))", ";", "sb", ".", "append", "(", "\":", "\"", ");", "sb", ".", "append", "(", "ex", ".", "getMessage", "(", "))", ";", "logger", ".", "log", "(", "type", ",", "sb", ".", "toString", "(", "),", "ex", ")", ";", "}", "}", "/", "**", "*", "Creates", "a", "new", "document", "builder", ",", "with", "sensible", "defaults", "*", "/", "public", "static", "synchronized", "DocumentBuilder", "newDocumentBuilder", "(", ")", "{", "try", "{", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "documentBuilder", ".", "setEntityResolver", "(", "SAXHelper", ".", "IGNORING_ENTITY_RESOLVER", ")", ";", "documentBuilder", ".", "setErrorHandler", "(", "new", "DocHelperErrorHandler", "(", "))", ";", "return", "documentBuilder", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "cannot", "create", "a", "DocumentBuilder", "\"", ",", "e", ")", ";", "@", "@", "-", "57", ",", "17", "+", "98", ",", "17", "@", "@", "public", "static", "synchronized", "DocumentBuilder", "newDocumentBuilder", "(", ")", "{", "trySetXercesSecurityManager", "(", "documentBuilderFactory", ")", ";", "}", "private", "static", "void", "trySetSAXFeature", "(", "DocumentBuilderFactory", "documentBuilderFactory", ",", "String", "feature", ",", "boolean", "enabled", ")", "{", "private", "static", "void", "trySetSAXFeature", "(", "DocumentBuilderFactory", "dbf", ",", "String", "feature", ",", "boolean", "enabled", ")", "{", "try", "{", "documentBuilderFactory", ".", "setFeature", "(", "feature", ",", "enabled", ")", ";", "dbf", ".", "setFeature", "(", "feature", ",", "enabled", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "log", "(", "POILogger", ".", "WARN", ",", "\"", "SAX", "Feature", "unsupported", "\"", ",", "feature", ",", "e", ")", ";", "}", "catch", "(", "AbstractMethodError", "ame", ")", "{", "logger", ".", "log", "(", "POILogger", ".", "WARN", ",", "\"", "Cannot", "set", "SAX", "feature", "because", "outdated", "XML", "parser", "in", "classpath", "\"", ",", "feature", ",", "ame", ")", ";", "}", "}", "private", "static", "void", "trySetXercesSecurityManager", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "private", "static", "void", "trySetXercesSecurityManager", "(", "DocumentBuilderFactory", "dbf", ")", "{", "/", "/", "Try", "built", "-", "in", "JVM", "one", "first", ",", "standalone", "if", "not", "for", "(", "String", "securityManagerClassName", ":", "new", "String", "[", "]", "{", "\"", "com", ".", "sun", ".", "org", ".", "apache", ".", "xerces", ".", "internal", ".", "util", ".", "SecurityManager", "\"", ",", "@", "@", "-", "77", ",", "7", "+", "118", ",", "7", "@", "@", "private", "static", "void", "trySetXercesSecurityManager", "(", "DocumentBuilderFactory", "documentB", "Object", "mgr", "=", "Class", ".", "forName", "(", "securityManagerClassName", ")", ".", "newInstance", "(", ");", "Method", "setLimit", "=", "mgr", ".", "getClass", "(", ").", "getMethod", "(", "\"", "setEntityExpansionLimit", "\"", ",", "Integer", ".", "TYPE", ")", ";", "setLimit", ".", "invoke", "(", "mgr", ",", "4096", ")", ";", "documentBuilderFactory", ".", "setAttribute", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "properties", "/", "security", "-", "manager", "\"", ",", "mgr", ")", ";", "dbf", ".", "setAttribute", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "properties", "/", "security", "-", "manager", "\"", ",", "mgr", ")", ";", "/", "/", "Stop", "once", "one", "can", "be", "setup", "without", "error", "return", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "@", "@", "-", "96", ",", "6", "+", "137", ",", "16", "@", "@", "public", "static", "Document", "readDocument", "(", "InputStream", "inp", ")", "throws", "IOException", ",", "SAXExce", "return", "newDocumentBuilder", "(", ").", "parse", "(", "inp", ")", ";", "}", "/", "**", "*", "Parses", "the", "given", "stream", "via", "the", "default", "(", "sensible", ")", "*", "DocumentBuilder", "*", "@", "param", "inp", "sax", "source", "to", "read", "the", "XML", "data", "from", "*", "@", "return", "the", "parsed", "Document", "*", "/", "public", "static", "Document", "readDocument", "(", "InputSource", "inp", ")", "throws", "IOException", ",", "SAXException", "{", "return", "newDocumentBuilder", "(", ").", "parse", "(", "inp", ")", ";", "}", "/", "/", "must", "only", "be", "used", "to", "create", "empty", "documents", ",", "do", "not", "use", "it", "for", "parsing", "!", "private", "static", "final", "DocumentBuilder", "documentBuilderSingleton", "=", "newDocumentBuilder", "(", ");", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "org", ".", "apache", ".", "poi", ".", "sl", ".", "usermodel", ".", "Placeholder", ";", "import", "org", ".", "apache", ".", "poi", ".", "sl", ".", "usermodel", ".", "Slide", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "Beta", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlException", ";", "import", "org", ".", "openxmlformats", ".", "schemas", ".", "drawingml", ".", "x2006", ".", "main", ".", "CTBlip", ";", "import", "org", ".", "openxmlformats", ".", "schemas", ".", "drawingml", ".", "x2006", ".", "main", ".", "CTGroupShapeProperties", ";", "@", "@", "-", "43", ",", "6", "+", "44", ",", "8", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "org", ".", "openxmlformats", ".", "schemas", ".", "presentationml", ".", "x2006", ".", "main", ".", "CTGroupShapeNonVisual", ";", "import", "org", ".", "openxmlformats", ".", "schemas", ".", "presentationml", ".", "x2006", ".", "main", ".", "CTSlide", ";", "import", "org", ".", "openxmlformats", ".", "schemas", ".", "presentationml", ".", "x2006", ".", "main", ".", "SldDocument", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "@", "Beta", "public", "final", "class", "XSLFSlide", "extends", "XSLFSheet", "@", "@", "-", "72", ",", "8", "+", "75", ",", "14", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "XSLFSlide", "(", "PackagePart", "part", ")", "throws", "IOException", ",", "XmlException", "{", "super", "(", "part", ")", ";", "SldDocument", "doc", "=", "SldDocument", ".", "Factory", ".", "parse", "(", "getPackagePart", "(", ").", "getInputStream", "(", "),", "DEFAULT_XML_OPTIONS", ")", ";", "Document", "_doc", ";", "try", "{", "_doc", "=", "DocumentHelper", ".", "readDocument", "(", "getPackagePart", "(", ").", "getInputStream", "(", "))", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "SldDocument", "doc", "=", "SldDocument", ".", "Factory", ".", "parse", "(", "_doc", ",", "DEFAULT_XML_OPTIONS", ")", ";", "_slide", "=", "doc", ".", "getSld", "(", ");", "setCommonSlideData", "(", "_slide", ".", "getCSld", "(", "))", ";", "}", "@", "@", "-", "21", ",", "17", "+", "21", ",", "18", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipEntry", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipFile", ";", "import", "org", ".", "apache", ".", "poi", ".", "openxml4j", ".", "opc", ".", "internal", ".", "ZipHelper", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlException", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlObject", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlOptions", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "/", "**", "*", "Utility", "class", "which", "dumps", "the", "contents", "of", "a", "*", ".", "xlsx", "file", "into", "file", "system", ".", "@", "@", "-", "93", ",", "7", "+", "94", ",", "8", "@", "@", "public", "static", "void", "dump", "(", "ZipFile", "zip", ")", "throws", "Exception", "{", "try", "{", "if", "(", "entry", ".", "getName", "(", ").", "endsWith", "(", "\".", "xml", "\"", ")", "|", "|", "entry", ".", "getName", "(", ").", "endsWith", "(", "\".", "vml", "\"", ")", "|", "|", "entry", ".", "getName", "(", ").", "endsWith", "(", "\".", "rels", "\"", "))", "{", "try", "{", "XmlObject", "xml", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "zip", ".", "getInputStream", "(", "entry", ")", ",", "DEFAULT_XML_OPTIONS", ")", ";", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "zip", ".", "getInputStream", "(", "entry", ")", ");", "XmlObject", "xml", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "doc", ",", "DEFAULT_XML_OPTIONS", ")", ";", "XmlOptions", "options", "=", "new", "XmlOptions", "(", ");", "options", ".", "setSavePrettyPrint", "(", ");", "xml", ".", "save", "(", "out", ",", "options", ")", ";", "@", "@", "-", "134", ",", "7", "+", "134", ",", "7", "@", "@", "public", "void", "readFrom", "(", "InputStream", "is", ")", "throws", "IOException", "{", "cnt", "+", "+;", "}", "}", "catch", "(", "XmlException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "throw", "new", "IOException", "(", "\"", "unable", "to", "parse", "shared", "strings", "table", "\"", ",", "e", ")", ";", "}", "}", "@", "@", "-", "216", ",", "18", "+", "216", ",", "18", "@", "@", "public", "int", "addEntry", "(", "CTRst", "st", ")", "{", "*", "@", "throws", "IOException", "if", "an", "error", "occurs", "while", "writing", ".", "*", "/", "public", "void", "writeTo", "(", "OutputStream", "out", ")", "throws", "IOException", "{", "XmlOptions", "options", "=", "new", "XmlOptions", "(", "DEFAULT_XML_OPTIONS", ")", ";", "XmlOptions", "xmlOptions", "=", "new", "XmlOptions", "(", "DEFAULT_XML_OPTIONS", ")", ";", "/", "/", "the", "following", "two", "lines", "turn", "off", "writing", "CDATA", "/", "/", "see", "Bugzilla", "48936", "options", ".", "setSaveCDataLengthThreshold", "(", "1000000", ")", ";", "options", ".", "setSaveCDataEntityCountThreshold", "(", "-", "1", ")", ";", "xmlOptions", ".", "setSaveCDataLengthThreshold", "(", "1000000", ")", ";", "xmlOptions", ".", "setSaveCDataEntityCountThreshold", "(", "-", "1", ")", ";", "/", "/", "re", "-", "create", "the", "sst", "table", "every", "time", "saving", "a", "workbook", "CTSst", "sst", "=", "_sstDoc", ".", "getSst", "(", ");", "sst", ".", "setCount", "(", "count", ")", ";", "sst", ".", "setUniqueCount", "(", "uniqueCount", ")", ";", "_sstDoc", ".", "save", "(", "out", ",", "options", ")", ";", "_sstDoc", ".", "save", "(", "out", ",", "xmlOptions", ")", ";", "}", "@", "Override", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "33", ",", "11", "+", "34", ",", "15", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "org", ".", "apache", ".", "poi", ".", "POIXMLDocumentPart", ";", "import", "org", ".", "apache", ".", "poi", ".", "openxml4j", ".", "opc", ".", "PackagePart", ";", "import", "org", ".", "apache", ".", "poi", ".", "openxml4j", ".", "opc", ".", "PackageRelationship", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "apache", ".", "poi", ".", "xssf", ".", "util", ".", "EvilUnclosedBRFixingInputStream", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlCursor", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlException", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlObject", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "com", ".", "microsoft", ".", "schemas", ".", "office", ".", "excel", ".", "CTClientData", ";", "import", "com", ".", "microsoft", ".", "schemas", ".", "office", ".", "excel", ".", "STObjectType", ";", "@", "@", "-", "124", ",", "10", "+", "129", ",", "15", "@", "@", "protected", "XSSFVMLDrawing", "(", "PackagePart", "part", ",", "PackageRelationship", "rel", ")", "throws", "IOExc", "this", "(", "part", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "resource", "\"", ")", "protected", "void", "read", "(", "InputStream", "is", ")", "throws", "IOException", ",", "XmlException", "{", "XmlObject", "root", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "new", "EvilUnclosedBRFixingInputStream", "(", "is", ")", ",", "DEFAULT_XML_OPTIONS", ")", ";", "Document", "doc", ";", "try", "{", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "new", "EvilUnclosedBRFixingInputStream", "(", "is", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "XmlException", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "XmlObject", "root", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "doc", ",", "DEFAULT_XML_OPTIONS", ")", ";", "_qnames", "=", "new", "ArrayList", "<", "QName", ">", "()", ";", "_items", "=", "new", "ArrayList", "<", "XmlObject", ">", "()", ";", "@", "@", "-", "149", ",", "7", "+", "159", ",", "15", "@", "@", "protected", "void", "read", "(", "InputStream", "is", ")", "throws", "IOException", ",", "XmlException", "{", "}", "_items", ".", "add", "(", "shape", ")", ";", "}", "else", "{", "_items", ".", "add", "(", "XmlObject", ".", "Factory", ".", "parse", "(", "obj", ".", "xmlText", "(", "),", "DEFAULT_XML_OPTIONS", ")", ");", "Document", "doc2", ";", "try", "{", "InputSource", "is2", "=", "new", "InputSource", "(", "new", "StringReader", "(", "obj", ".", "xmlText", "(", "))", ");", "doc2", "=", "DocumentHelper", ".", "readDocument", "(", "is2", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "XmlException", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "_items", ".", "add", "(", "XmlObject", ".", "Factory", ".", "parse", "(", "doc2", ",", "DEFAULT_XML_OPTIONS", ")", ");", "}", "_qnames", ".", "add", "(", "qname", ")", ";", "}", "@", "@", "-", "63", ",", "6", "+", "63", ",", "9", "@", "@", "public", "int", "read", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "/", "/", "Figure", "out", "how", "much", "we", "'", "ve", "done", "int", "read", ";", "if", "(", "readB", "=", "=", "-", "1", "|", "|", "readB", "=", "=", "0", ")", "{", "if", "(", "readA", "=", "=", "0", ")", "{", "return", "readB", ";", "}", "read", "=", "readA", ";", "}", "else", "{", "read", "=", "readA", "+", "readB", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "@", "@", "-", "29", ",", "6", "+", "30", ",", "7", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "org", ".", "apache", ".", "poi", ".", "POIXMLException", ";", "import", "org", ".", "apache", ".", "poi", ".", "openxml4j", ".", "exceptions", ".", "InvalidFormatException", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "Internal", ";", "import", "org", ".", "apache", ".", "poi", ".", "wp", ".", "usermodel", ".", "CharacterRun", ";", "import", "org", ".", "apache", ".", "xmlbeans", ".", "XmlCursor", ";", "@", "@", "-", "80", ",", "6", "+", "82", ",", "8", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "import", "org", ".", "openxmlformats", ".", "schemas", ".", "wordprocessingml", ".", "x2006", ".", "main", ".", "STVerticalAlignRun", ";", "import", "org", ".", "w3c", ".", "dom", ".", "NodeList", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Text", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "/", "**", "*", "XWPFRun", "object", "defines", "a", "region", "of", "text", "with", "a", "common", "set", "of", "properties", "@", "@", "-", "171", ",", "7", "+", "175", ",", "7", "@", "@", "static", "void", "preserveSpaces", "(", "XmlString", "xs", ")", "{", "}", "private", "List", "<", "CTPicture", ">", "getCTPictures", "(", "XmlObject", "o", ")", "{", "List", "<", "CTPicture", ">", "pictures", "=", "new", "ArrayList", "<", "CTPicture", ">", "()", ";", "List", "<", "CTPicture", ">", "pics", "=", "new", "ArrayList", "<", "CTPicture", ">", "()", ";", "XmlObject", "[", "]", "picts", "=", "o", ".", "selectPath", "(", "\"", "declare", "namespace", "pic", "=", "'\"", "+", "CTPicture", ".", "type", ".", "getName", "(", ").", "getNamespaceURI", "(", ")", "+", "\"", "'", ".", "//", "pic", ":", "pic", "\"", ");", "for", "(", "XmlObject", "pict", ":", "picts", ")", "{", "if", "(", "pict", "instanceof", "XmlAnyTypeImpl", ")", "{", "@", "@", "-", "183", ",", "10", "+", "187", ",", "10", "@", "@", "static", "void", "preserveSpaces", "(", "XmlString", "xs", ")", "{", "}", "}", "if", "(", "pict", "instanceof", "CTPicture", ")", "{", "pictures", ".", "add", "(", "(", "CTPicture", ")", "pict", ")", ";", "pics", ".", "add", "(", "(", "CTPicture", ")", "pict", ")", ";", "}", "}", "return", "pictures", ";", "return", "pics", ";", "}", "/", "**", "@", "@", "-", "940", ",", "6", "+", "944", ",", "7", "@", "@", "public", "XWPFPicture", "addPicture", "(", "InputStream", "pictureData", ",", "int", "pictureType", ",", "String", "f", "relationId", "=", "headerFooter", ".", "addPictureData", "(", "pictureData", ",", "pictureType", ")", ";", "picData", "=", "(", "XWPFPictureData", ")", "headerFooter", ".", "getRelationById", "(", "relationId", ")", ";", "}", "else", "{", "@", "SuppressWarnings", "(", "\"", "resource", "\"", ")", "XWPFDocument", "doc", "=", "parent", ".", "getDocument", "(", ");", "relationId", "=", "doc", ".", "addPictureData", "(", "pictureData", ",", "pictureType", ")", ";", "picData", "=", "(", "XWPFPictureData", ")", "doc", ".", "getRelationById", "(", "relationId", ")", ";", "@", "@", "-", "957", ",", "8", "+", "962", ",", "10", "@", "@", "public", "XWPFPicture", "addPicture", "(", "InputStream", "pictureData", ",", "int", "pictureType", ",", "String", "f", "\"", "<", "a", ":", "graphicData", "uri", "=", "\\\"", "\"", "+", "CTPicture", ".", "type", ".", "getName", "(", ").", "getNamespaceURI", "(", ")", "+", "\"", "\\\"", ">\"", "+", "\"", "<", "pic", ":", "pic", "xmlns", ":", "pic", "=", "\\\"", "\"", "+", "CTPicture", ".", "type", ".", "getName", "(", ").", "getNamespaceURI", "(", ")", "+", "\"", "\\\"", "/", ">\"", "+", "\"", "</", "a", ":", "graphicData", ">", "\"", "+", "\"", "</", "a", ":", "graphic", ">", "\";", "inline", ".", "set", "(", "XmlToken", ".", "Factory", ".", "parse", "(", "xml", ",", "DEFAULT_XML_OPTIONS", ")", ");", "\"", "</", "a", ":", "graphic", ">", "\";", "InputSource", "is", "=", "new", "InputSource", "(", "new", "StringReader", "(", "xml", ")", ");", "org", ".", "w3c", ".", "dom", ".", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "is", ")", ";", "inline", ".", "set", "(", "XmlToken", ".", "Factory", ".", "parse", "(", "doc", ".", "getDocumentElement", "(", "),", "DEFAULT_XML_OPTIONS", ")", ");", "/", "/", "Setup", "the", "inline", "inline", ".", "setDistT", "(", "0", ")", ";", "@", "@", "-", "1021", ",", "6", "+", "1028", ",", "8", "@", "@", "public", "XWPFPicture", "addPicture", "(", "InputStream", "pictureData", ",", "int", "pictureType", ",", "String", "f", "return", "xwpfPicture", ";", "}", "catch", "(", "XmlException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "@", "@", "-", "781", ",", "7", "+", "781", ",", "8", "@", "@", "private", "void", "checkForZipBombException", "(", "Throwable", "e", ")", "{", "}", "}", "if", "(", "e", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "Zip", "bomb", "detected", "!", "\")", ")", "{", "String", "msg", "=", "e", ".", "getMessage", "(", ");", "if", "(", "msg", "!", "=", "null", "&", "&", "msg", ".", "startsWith", "(", "\"", "Zip", "bomb", "detected", "!", "\")", ")", "{", "return", ";", "}", "@", "@", "-", "67", ",", "6", "+", "67", ",", "8", "@", "@", "public", "void", "testBug56479", "(", ")", "throws", "Exception", "{", "assertTrue", "(", "\"", "Core", "not", "found", "in", "\"", "+", "p", ".", "getParts", "(", "),", "foundCoreProps", ")", ";", "assertFalse", "(", "\"", "Document", "should", "not", "be", "found", "in", "\"", "+", "p", ".", "getParts", "(", "),", "foundDocument", ")", ";", "assertFalse", "(", "\"", "Theme1", "should", "not", "found", "in", "\"", "+", "p", ".", "getParts", "(", "),", "foundTheme1", ")", ";", "p", ".", "close", "(", ");", "is", ".", "close", "(", ");", "}", "@", "Test", "@", "@", "-", "89", ",", "7", "+", "91", ",", "7", "@", "@", "private", "void", "assertEntityLimitReached", "(", "Exception", "e", ")", "throws", "UnsupportedEncodingExc", "writer", ".", "close", "(", ");", "}", "String", "string", "=", "new", "String", "(", "str", ".", "toByteArray", "(", "),", "\"", "UTF", "-", "8", "\"", ");", "assertTrue", "(", "\"", "Had", ":", "\"", "+", "string", ",", "string", ".", "contains", "(", "\"", "Exceeded", "Entity", "dereference", "bytes", "limit", "\"", "))", ";", "assertTrue", "(", "\"", "Had", ":", "\"", "+", "string", ",", "string", ".", "contains", "(", "\"", "The", "parser", "has", "encountered", "more", "than", "\"", "))", ";", "}", "@", "Test"], "docstring_tokens": ["a", "denial", "of", "service", "(CPU", "consumption", ")"]}
{"contents": ["[AMQ-7400]", "This", "closes", "#443"], "code_tokens": ["@", "@", "-", "17", ",", "11", "+", "17", ",", "17", "@", "@", "package", "org", ".", "apache", ".", "activemq", ".", "broker", ".", "jmx", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "management", ".", "ManagementFactory", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "rmi", ".", "AccessException", ";", "import", "java", ".", "rmi", ".", "AlreadyBoundException", ";", "import", "java", ".", "rmi", ".", "NoSuchObjectException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "42", ",", "8", "+", "48", ",", "9", "@", "@", "import", "javax", ".", "management", ".", "ObjectName", ";", "import", "javax", ".", "management", ".", "QueryExp", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServerFactory", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXServiceURL", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIJRMPServerImpl", ";", "import", "org", ".", "apache", ".", "activemq", ".", "Service", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "98", ",", "6", "+", "105", ",", "8", "@", "@", "private", "String", "brokerName", ";", "private", "String", "suppressMBean", ";", "private", "List", "<", "ObjectName", ">", "suppressMBeanList", ";", "private", "Remote", "serverStub", ";", "private", "RMIJRMPServerImpl", "server", ";", "public", "ManagementContext", "(", ")", "{", "this", "(", "null", ")", ";", "@", "@", "-", "140", ",", "20", "+", "149", ",", "20", "@", "@", "public", "void", "run", "(", ")", "{", "MDC", ".", "put", "(", "\"", "activemq", ".", "broker", "\"", ",", "brokerName", ")", ";", "}", "try", "{", "JMXConnectorServer", "server", "=", "connectorServer", ";", "if", "(", "started", ".", "get", "(", ")", "&", "&", "server", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "Starting", "JMXConnectorServer", ".", "..", "\")", ";", "try", "{", "/", "/", "need", "to", "remove", "MDC", "as", "we", "must", "not", "inherit", "MDC", "in", "child", "threads", "causing", "leaks", "MDC", ".", "remove", "(", "\"", "activemq", ".", "broker", "\"", ");", "server", ".", "start", "(", ");", "connectorServer", ".", "start", "(", ");", "serverStub", "=", "server", ".", "toStub", "(", ");", "}", "finally", "{", "if", "(", "brokerName", "!", "=", "null", ")", "{", "MDC", ".", "put", "(", "\"", "activemq", ".", "broker", "\"", ",", "brokerName", ")", ";", "}", "connectorStarted", ".", "countDown", "(", ");", "}", "LOG", ".", "info", "(", "\"", "JMX", "consoles", "can", "connect", "to", "{", "}\"", ",", "server", ".", "getAddress", "(", "))", ";", "LOG", ".", "info", "(", "\"", "JMX", "consoles", "can", "connect", "to", "{", "}\"", ",", "connectorServer", ".", "getAddress", "(", "))", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Failed", "to", "start", "JMX", "connector", "{", "}.", "Will", "restart", "management", "to", "re", "-", "create", "JMX", "connector", ",", "trying", "to", "remedy", "this", "issue", ".", "\",", "e", ".", "getMessage", "(", "))", ";", "@", "@", "-", "546", ",", "8", "+", "555", ",", "9", "@", "@", "private", "void", "createConnector", "(", "MBeanServer", "mbeanServer", ")", "throws", "MalformedObjectName", "try", "{", "if", "(", "registry", "=", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "Creating", "RMIRegistry", "on", "port", "{", "}\"", ",", "connectorPort", ")", ";", "registry", "=", "LocateRegistry", ".", "createRegistry", "(", "connectorPort", ")", ";", "registry", "=", "new", "JmxRegistry", "(", "connectorPort", ")", ";", "}", "namingServiceObjectName", "=", "ObjectName", ".", "getInstance", "(", "\"", "naming", ":", "type", "=", "rmiregistry", "\"", ");", "/", "/", "Do", "not", "use", "the", "createMBean", "as", "the", "mx4j", "jar", "may", "not", "be", "in", "the", "@", "@", "-", "570", ",", "10", "+", "580", ",", "14", "@", "@", "private", "void", "createConnector", "(", "MBeanServer", "mbeanServer", ")", "throws", "MalformedObjectName", "/", "/", "This", "is", "handy", "to", "use", "if", "you", "have", "a", "firewall", "and", "need", "to", "force", "JMX", "to", "use", "fixed", "ports", ".", "rmiServer", "=", "\"", "\"+", "getConnectorHost", "(", ")+", "\":", "\"", "+", "rmiServerPort", ";", "}", "String", "serviceURL", "=", "\"", "service", ":", "jmx", ":", "rmi", ":", "//", "\"", "+", "rmiServer", "+", "\"", "/", "jndi", "/", "rmi", ":", "//", "\"", "+", "getConnectorHost", "(", ")+", "\":", "\"", "+", "connectorPort", "+", "connectorPath", ";", "JMXServiceURL", "url", "=", "new", "JMXServiceURL", "(", "serviceURL", ")", ";", "connectorServer", "=", "JMXConnectorServerFactory", ".", "newJMXConnectorServer", "(", "url", ",", "environment", ",", "mbeanServer", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "env", "=", "new", "HashMap", "<", ">(", ");", "server", "=", "new", "RMIJRMPServerImpl", "(", "connectorPort", ",", "null", ",", "null", ",", "environment", ")", ";", "final", "String", "serviceURL", "=", "\"", "service", ":", "jmx", ":", "rmi", ":", "//", "\"", "+", "rmiServer", "+", "\"", "/", "jndi", "/", "rmi", ":", "//", "\"", "+", "getConnectorHost", "(", ")+", "\":", "\"", "+", "connectorPort", "+", "connectorPath", ";", "final", "JMXServiceURL", "url", "=", "new", "JMXServiceURL", "(", "serviceURL", ")", ";", "connectorServer", "=", "new", "RMIConnectorServer", "(", "url", ",", "env", ",", "server", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "LOG", ".", "debug", "(", "\"", "Created", "JMXConnectorServer", "{", "}\"", ",", "connectorServer", ")", ";", "}", "@", "@", "-", "664", ",", "4", "+", "678", ",", "39", "@", "@", "public", "void", "setSuppressMBean", "(", "String", "commaListOfAttributeKeyValuePairs", ")", "{", "public", "String", "getSuppressMBean", "(", ")", "{", "return", "suppressMBean", ";", "}", "/", "*", "*", "Better", "to", "use", "the", "internal", "API", "than", "re", "-", "invent", "the", "wheel", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "restriction", "\"", ")", "private", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "public", "static", "final", "String", "LOOKUP_NAME", "=", "\"", "jmxrmi", "\"", ";", "public", "JmxRegistry", "(", "int", "port", ")", "throws", "RemoteException", "{", "super", "(", "port", ")", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "s", ")", "throws", "RemoteException", ",", "NotBoundException", "{", "return", "LOOKUP_NAME", ".", "equals", "(", "s", ")", "?", "serverStub", ":", "null", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "s", ",", "Remote", "remote", ")", "throws", "RemoteException", ",", "AlreadyBoundException", ",", "AccessException", "{", "}", "@", "Override", "public", "void", "unbind", "(", "String", "s", ")", "throws", "RemoteException", ",", "NotBoundException", ",", "AccessException", "{", "}", "@", "Override", "public", "void", "rebind", "(", "String", "s", ",", "Remote", "remote", ")", "throws", "RemoteException", ",", "AccessException", "{", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "throws", "RemoteException", "{", "return", "new", "String", "[", "]", "{", "LOOKUP_NAME", "}", ";", "}", "}", "}", "@", "@", "-", "41", ",", "6", "+", "41", ",", "7", "@", "@", "!", "com", ".", "google", ".", "j2objc", ".", "annotations", ",", "sun", ".", "misc", "*", ";", "resolution", ":", "=", "optional", ",", "sun", ".", "nio", "*", ";", "resolution", ":", "=", "optional", ",", "sun", ".", "rmi", "*", ";", "resolution", ":", "=", "optional", ",", "javax", ".", "jmdns", "*", ";", "resolution", ":", "=", "optional", ",", "javax", ".", "resource", "*", ";", "resolution", ":", "=", "optional", ",", "javax", ".", "servlet", "*", ";", "resolution", ":", "=", "optional", ","], "docstring_tokens": ["obtain", "user", "credentials", "or", "further", "compromise", "the", "system"]}
{"contents": ["tun/tap:", "Fix", "crashes", "if", "open()", "/dev/net/tun", "and", "then", "poll()", "it.", "Fix", "NULL", "pointer", "dereference", "in", "tun_chr_pool()", "introduced", "by", "commit", "33dccbb050bbe35b88ca8cf1228dcf3e4d4b3554", "(\"tun:", "Limit", "amount", "of", "queued", "packets", "per", "device\")", "and", "triggered", "by", "this", "code:", "int", "fd;", "struct", "pollfd", "pfd;", "fd", "=", "open(\"/dev/net/tun\",", "O_RDWR);", "pfd.fd", "=", "fd;", "pfd.events", "=", "POLLIN", "|", "POLLOUT;", "poll(&pfd,", "1,", "0);", "Reported-by:", "Eugene", "Kapun", "<abacabadabacaba@gmail.com>", "Signed-off-by:", "Mariusz", "Kozlowski", "<m.kozlowski@tuxland.pl>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "486", ",", "12", "+", "486", ",", "14", "@", "@", "static", "unsigned", "int", "tun_chr_poll", "(", "struct", "file", "*", "file", ",", "poll_table", "*", "wait", ")", "{", "struct", "tun_file", "*", "tfile", "=", "file", "-", ">", "private_data", ";", "struct", "tun_struct", "*", "tun", "=", "__tun_get", "(", "tfile", ")", ";", "struct", "sock", "*", "sk", "=", "tun", "-", ">", "sk", ";", "struct", "sock", "*", "sk", ";", "unsigned", "int", "mask", "=", "0", ";", "if", "(", "!", "tun", ")", "return", "POLLERR", ";", "sk", "=", "tun", "-", ">", "sk", ";", "DBG", "(", "KERN_INFO", "\"", "%", "s", ":", "tun_chr_poll", "\\", "n", "\"", ",", "tun", "-", ">", "dev", "-", ">", "name", ")", ";", "poll_wait", "(", "file", ",", "&", "tun", "-", ">", "socket", ".", "wait", ",", "wait", ")", ";"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system", "with", "root", "privileges", "or", "cause", "the", "system", "to", "crash"]}
{"contents": ["Merge", "pull", "request", "#1497", "from", "guusdk/OF-1885_SSRF-guard-favicon", "OF-1885:", "SSRF", "guard", "favicon"], "code_tokens": ["@", "@", "-", "182", ",", "22", "+", "182", ",", "29", "@", "@", "private", "void", "writeBytesToStream", "(", "byte", "[", "]", "bytes", ",", "HttpServletResponse", "response", ")", "{", "}", "private", "byte", "[", "]", "getImage", "(", "String", "url", ")", "{", "/", "/", "Try", "to", "get", "the", "fiveicon", "from", "the", "url", "using", "an", "HTTP", "connection", "from", "the", "pool", "/", "/", "Try", "to", "get", "the", "favicon", "from", "the", "url", "using", "an", "HTTP", "connection", "from", "the", "pool", "/", "/", "that", "also", "allows", "to", "configure", "timeout", "values", "(", "e", ".", "g", ".", "connect", "and", "get", "data", ")", "final", "RequestConfig", "requestConfig", "=", "RequestConfig", ".", "custom", "(", ")", ".", "setConnectTimeout", "(", "2000", ")", ".", "setSocketTimeout", "(", "2000", ")", ".", "setConnectTimeout", "(", "5000", ")", ".", "setSocketTimeout", "(", "5000", ")", ".", "build", "(", ");", "final", "HttpUriRequest", "getRequest", "=", "RequestBuilder", ".", "get", "(", "url", ")", ".", "setConfig", "(", "requestConfig", ")", ".", "build", "(", ");", "try", "(", "final", "CloseableHttpResponse", "response", "=", "client", ".", "execute", "(", "getRequest", ")", ")", "{", "if", "(", "response", ".", "getStatusLine", "(", ").", "getStatusCode", "(", ")", "=", "=", "HttpStatus", ".", "SC_OK", ")", "{", "return", "EntityUtils", ".", "toByteArray", "(", "response", ".", "getEntity", "(", "))", ";", "final", "byte", "[", "]", "result", "=", "EntityUtils", ".", "toByteArray", "(", "response", ".", "getEntity", "(", "))", ";", "/", "/", "Prevent", "SSRF", "by", "checking", "result", "(", "OF", "-", "1885", ")", "if", "(", "!", "GraphicsUtils", ".", "isImage", "(", "result", ")", ")", "{", "LOGGER", ".", "info", "(", "\"", "Ignoring", "response", "to", "an", "HTTP", "request", "that", "should", "have", "returned", "an", "image", "(", "but", "returned", "something", "else", ")", ":", "{", "}\"", ",", "url", ")", ";", "return", "null", ";", "}", "return", "result", ";", "}", "}", "catch", "(", "final", "IOException", "ignored", ")", "{", "/", "/", "Do", "nothing", "}", "catch", "(", "final", "IOException", "ex", ")", "{", "LOGGER", ".", "debug", "(", "\"", "An", "exception", "occurred", "while", "trying", "to", "obtain", "an", "image", "from", ":", "{", "}\"", ",", "url", ",", "ex", ")", ";", "}", "return", "null", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "69", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2019", "Ignite", "Realtime", "Foundation", ".", "All", "rights", "reserved", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "jivesoftware", ".", "util", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "javax", ".", "imageio", ".", "ImageIO", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "/", "**", "*", "Utilities", "for", "working", "with", "graphics", "-", "related", "data", ".", "*", "*", "@", "author", "Guus", "der", "Kinderen", ",", "guus", ".", "der", ".", "kinderen", "@", "gmail", ".", "com", "*", "/", "public", "class", "GraphicsUtils", "{", "private", "static", "final", "Logger", "Log", "=", "LoggerFactory", ".", "getLogger", "(", "GraphicsUtils", ".", "class", ")", ";", "/", "**", "*", "Checks", "if", "the", "provided", "input", "stream", "represents", "an", "image", ".", "*", "*", "@", "param", "stream", "The", "data", "to", "be", "parsed", ".", "Cannot", "be", "null", ".", "*", "@", "return", "true", "if", "the", "provided", "data", "is", "successfully", "identified", "as", "an", "image", ",", "otherwise", "false", ".", "*", "/", "public", "static", "boolean", "isImage", "(", "final", "InputStream", "stream", ")", "{", "try", "{", "/", "/", "This", "attempts", "to", "read", "the", "bytes", "as", "an", "image", ",", "returning", "null", "if", "it", "cannot", "parse", "the", "bytes", "as", "an", "image", ".", "return", "null", "!", "=", "ImageIO", ".", "read", "(", "stream", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "Log", ".", "debug", "(", "\"", "An", "exception", "occurred", "while", "determining", "if", "data", "represents", "an", "image", ".", "\",", "e", ")", ";", "return", "false", ";", "}", "}", "/", "**", "*", "Checks", "if", "the", "provided", "byte", "array", "represents", "an", "image", ".", "*", "*", "@", "param", "bytes", "The", "data", "to", "be", "parsed", ".", "Cannot", "be", "null", ".", "*", "@", "return", "true", "if", "the", "provided", "data", "is", "successfully", "identified", "as", "an", "image", ",", "otherwise", "false", ".", "*", "/", "public", "static", "boolean", "isImage", "(", "final", "byte", "[", "]", "bytes", ")", "{", "if", "(", "bytes", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Argument", "'", "bytes", "'", "cannot", "be", "null", ".", "\"", ")", ";", "}", "return", "isImage", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "63", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2019", "Ignite", "Realtime", "Foundation", ".", "All", "rights", "reserved", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "jivesoftware", ".", "util", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "/", "**", "*", "Unit", "tests", "for", "{", "@", "link", "GraphicsUtils", "}", "*", "*", "@", "author", "Guus", "der", "Kinderen", ",", "guus", ".", "der", ".", "kinderen", "@", "gmail", ".", "com", "*", "/", "public", "class", "GraphicsUtilsTest", "{", "/", "**", "*", "Verifies", "that", "{", "@", "link", "GraphicsUtils", "#", "isImage", "(", "InputStream", ")", "}", "correctly", "identifies", "an", "image", ".", "*", "/", "@", "Test", "public", "void", "testIsImageWithImage", "(", ")", "throws", "Exception", "{", "/", "/", "Setup", "test", "fixture", ".", "final", "InputStream", "input", "=", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "/", "images", "/", "ant_logo_large", ".", "gif", "\"", ")", ";", "/", "/", "Execute", "system", "under", "test", ".", "final", "boolean", "result", "=", "GraphicsUtils", ".", "isImage", "(", "input", ")", ";", "/", "/", "Verify", "result", ".", "assertTrue", "(", "result", ")", ";", "}", "/", "**", "*", "Verifies", "that", "{", "@", "link", "GraphicsUtils", "#", "isImage", "(", "InputStream", ")", "}", "rejects", "data", "that", "'", "s", "not", "an", "image", ".", "*", "/", "@", "Test", "public", "void", "testIsImageWithNonImage", "(", ")", "throws", "Exception", "{", "/", "/", "Setup", "test", "fixture", ".", "final", "InputStream", "input", "=", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "/", "privatekey", ".", "pem", "\"", ")", ";", "/", "/", "Execute", "system", "under", "test", ".", "final", "boolean", "result", "=", "GraphicsUtils", ".", "isImage", "(", "input", ")", ";", "/", "/", "Verify", "result", ".", "assertFalse", "(", "result", ")", ";", "}", "}"], "docstring_tokens": ["obtain", "sensitive", "data"]}
{"contents": ["Fix", "issues", "identified", "by", "CSW", "(#1561)"], "code_tokens": ["@", "@", "-", "45", ",", "7", "+", "45", ",", "7", "@", "@", "protected", "void", "doGet", "(", "final", "HttpServletRequest", "request", ",", "final", "HttpServletResponse", ".", "map", "(", "cache", "-", ">", "(", "Cache", "<", "?,", "?", ">)", "cache", ")", ";", "if", "(", "!", "optionalCache", ".", "isPresent", "(", "))", "{", "request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "cacheName", ")", "))", ";", "request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "StringUtils", ".", "escapeHTMLTags", "(", "cacheName", ")", "))", ");", "}", "final", "boolean", "secretKey", "=", "optionalCache", ".", "map", "(", "Cache", ":", ":", "isKeySecret", ")", ".", "orElse", "(", "Boolean", ".", "FALSE", ")", ";", "@", "@", "-", "150", ",", "7", "+", "150", ",", "7", "@", "@", "<", "label", "for", "=", "\"", "alias", "\"", "><", "fmt", ":", "message", "key", "=", "\"", "ssl", ".", "signing", "-", "request", ".", "alias", "\"", "/>", "</", "label", ">", "<", "/", "td", ">", "<", "td", "width", "=", "\"", "99", "%", "\">", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"$", "{", "param", ".", "alias", "}", "\">", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "alias", "}", "'/", ">\"", "\">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", "valign", "=", "\"", "top", "\"", ">", "@", "@", "-", "490", ",", "7", "+", "490", ",", "7", "@", "@", "<", "form", "action", "=", "\"", "security", "-", "certificate", "-", "details", ".", "jsp", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "connectionType", "\"", "value", "=", "\"$", "{", "connectionType", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"$", "{", "param", ".", "isTrustStore", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "isTrustStore", "}", "'/", ">\"", "/>", "<", "div", "style", "=", "\"", "text", "-", "align", ":", "center", ";", "\">", "<", "input", "type", "=", "\"", "submit", "\"", "name", "=", "\"", "back", "\"", "value", "=", "\"<", "fmt", ":", "message", "key", "=", "\"", "session", ".", "details", ".", "back_button", "\"", "/>", "\">", "<", "/", "div", ">", "@", "@", "-", "9", ",", "7", "+", "9", ",", "8", "@", "@", "<", "jsp", ":", "useBean", "scope", "=", "\"", "request", "\"", "id", "=", "\"", "search", "\"", "type", "=", "\"", "org", ".", "jivesoftware", ".", "admin", ".", "servlet", ".", "SystemCacheDetailsServlet", ".", "Search", "\"", "/>", "<", "%@", "page", "contentType", "=", "\"", "text", "/", "html", ";", "charset", "=", "UTF", "-", "8", "\"", "%", ">", "<", "head", ">", "<", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "</", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "var", "=", "\"", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "<", "title", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "title", "}", "\"/", "><", "/", "title", ">", "<", "meta", "name", "=", "\"", "pageID", "\"", "content", "=", "\"", "system", "-", "cache", "\"", "/>", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "img", ".", "clickable", "{", "@", "@", "-", "235", ",", "7", "+", "235", ",", "7", "@", "@", "<", "td", "align", "=", "\"", "right", "\"", "valign", "=", "\"", "bottom", "\"", "><", "fmt", ":", "message", "key", "=", "\"", "group", ".", "summary", ".", "search", "\"", "/", ">:", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "150", "\"", "name", "=", "\"", "search", "\"", "value", "=", "\"<", "%=", "((", "search", "!", "=", "null", ")", "?", "search", ":", "\"", "\")", "%>", "\">", "</", "td", ">", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "search", "}", "'/", ">\"", "><", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "username", "\""], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["GUACAMOLE-549:", "Store", "auth", "token", "within", "localStorage", "rather", "than", "cookie."], "code_tokens": ["@", "@", "-", "327", ",", "12", "+", "327", ",", "6", "@", "@", "<", "version", ">", "1", ".", "3", ".", "16", "<", "/", "version", ">", "<", "scope", ">", "runtime", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "webjars", ".", "bower", "<", "/", "groupId", ">", "<", "artifactId", ">", "angular", "-", "cookies", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "3", ".", "16", "<", "/", "version", ">", "<", "scope", ">", "runtime", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "webjars", ".", "bower", "<", "/", "groupId", ">", "<", "artifactId", ">", "angular", "-", "route", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "4", "+", "20", ",", "6", "@", "@", "/", "**", "*", "The", "module", "for", "authentication", "and", "management", "of", "tokens", ".", "*", "/", "angular", ".", "module", "(", "'", "auth", "'", ",", "[", "'", "ngCookies", "'", "])", ";", "angular", ".", "module", "(", "'", "auth", "'", ",", "[", "'", "storage", "'", "]", ");", "@", "@", "-", "46", ",", "10", "+", "46", ",", "10", "@", "@", "angular", ".", "module", "(", "'", "auth", "'", ").", "factory", "(", "'", "authenticationService", "'", ",", "[", "'$", "injector", "'", ",", "var", "Error", "=", "$", "injector", ".", "get", "(", "'", "Error", "'", ");", "/", "/", "Required", "services", "var", "$", "cookieStore", "=", "$", "injector", ".", "get", "(", "'$", "cookieStore", "'", ");", "var", "$", "http", "=", "$", "injector", ".", "get", "(", "'$", "http", "'", ");", "var", "$", "q", "=", "$", "injector", ".", "get", "(", "'$", "q", "'", ");", "var", "$", "rootScope", "=", "$", "injector", ".", "get", "(", "'$", "rootScope", "'", ");", "var", "$", "http", "=", "$", "injector", ".", "get", "(", "'$", "http", "'", ");", "var", "$", "q", "=", "$", "injector", ".", "get", "(", "'$", "q", "'", ");", "var", "$", "rootScope", "=", "$", "injector", ".", "get", "(", "'$", "rootScope", "'", ");", "var", "localStorageService", "=", "$", "injector", ".", "get", "(", "'", "localStorageService", "'", ");", "var", "service", "=", "{", "};", "@", "@", "-", "62", ",", "12", "+", "62", ",", "12", "@", "@", "angular", ".", "module", "(", "'", "auth", "'", ").", "factory", "(", "'", "authenticationService", "'", ",", "[", "'$", "injector", "'", ",", "var", "cachedResult", "=", "null", ";", "/", "**", "*", "The", "unique", "identifier", "of", "the", "local", "cookie", "which", "stores", "the", "result", "of", "the", "*", "last", "authentication", "attempt", ".", "*", "The", "unique", "identifier", "of", "the", "local", "storage", "key", "which", "stores", "the", "result", "*", "of", "the", "last", "authentication", "attempt", ".", "*", "*", "@", "type", "String", "*", "/", "var", "AUTH_COOKIE_ID", "=", "\"", "GUAC_AUTH", "\"", ";", "var", "AUTH_STORAGE_KEY", "=", "'", "GUAC_AUTH", "'", ";", "/", "**", "*", "Retrieves", "the", "last", "successful", "authentication", "result", ".", "If", "the", "user", "has", "not", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "angular", ".", "module", "(", "'", "auth", "'", ").", "factory", "(", "'", "authenticationService", "'", ",", "[", "'$", "injector", "'", ",", "return", "cachedResult", ";", "/", "/", "Return", "explicit", "null", "if", "no", "auth", "data", "is", "currently", "stored", "var", "data", "=", "$", "cookieStore", ".", "get", "(", "AUTH_COOKIE_ID", ")", ";", "var", "data", "=", "localStorageService", ".", "getItem", "(", "AUTH_STORAGE_KEY", ")", ";", "if", "(", "!", "data", ")", "return", "null", ";", "@", "@", "-", "107", ",", "7", "+", "107", ",", "7", "@", "@", "angular", ".", "module", "(", "'", "auth", "'", ").", "factory", "(", "'", "authenticationService", "'", ",", "[", "'$", "injector", "'", ",", "/", "/", "Clear", "the", "currently", "-", "stored", "result", "if", "the", "last", "attempt", "failed", "if", "(", "!", "data", ")", "{", "cachedResult", "=", "null", ";", "$", "cookieStore", ".", "remove", "(", "AUTH_COOKIE_ID", ")", ";", "localStorageService", ".", "removeItem", "(", "AUTH_STORAGE_KEY", ")", ";", "}", "/", "/", "Otherwise", "store", "the", "authentication", "attempt", "directly", "@", "@", "-", "116", ",", "9", "+", "116", ",", "9", "@", "@", "angular", ".", "module", "(", "'", "auth", "'", ").", "factory", "(", "'", "authenticationService", "'", ",", "[", "'$", "injector", "'", ",", "/", "/", "Always", "store", "in", "cache", "cachedResult", "=", "data", ";", "/", "/", "Store", "cookie", "ONLY", "if", "not", "anonymous", "/", "/", "Persist", "result", "past", "tab", "/", "window", "closure", "ONLY", "if", "not", "anonymous", "if", "(", "data", ".", "username", "!", "==", "AuthenticationResult", ".", "ANONYMOUS_USERNAME", ")", "$", "cookieStore", ".", "put", "(", "AUTH_COOKIE_ID", ",", "data", ")", ";", "localStorageService", ".", "setItem", "(", "AUTH_STORAGE_KEY", ",", "data", ")", ";", "}", "@", "@", "-", "62", ",", "7", "+", "62", ",", "6", "@", "@", "<", "!-", "-", "AngularJS", "-", "->", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "webjars", "/", "angular", "/", "1", ".", "3", ".", "16", "/", "angular", ".", "min", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "webjars", "/", "angular", "-", "cookies", "/", "1", ".", "3", ".", "16", "/", "angular", "-", "cookies", ".", "min", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "webjars", "/", "angular", "-", "route", "/", "1", ".", "3", ".", "16", "/", "angular", "-", "route", ".", "min", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "webjars", "/", "angular", "-", "touch", "/", "1", ".", "3", ".", "16", "/", "angular", "-", "touch", ".", "min", ".", "js", "\"", "><", "/", "script", ">"], "docstring_tokens": ["eavesdropping", "on", "the", "network", "to", ">", "intercept", "the", "user's", "session", "token"]}
{"contents": ["HTTPCLIENT-1478:", "deprecated", "SSLSocketFactory", "ignores", "socket", "timeout", "parameter", "during", "SSL", "handshake", "git-svn-id:", "https://svn.apache.org/repos/asf/httpcomponents/httpclient/trunk@1576362", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "397", ",", "7", "+", "397", ",", "9", "@", "@", "public", "Socket", "connectSocket", "(", "}", "else", "{", "host", "=", "new", "HttpHost", "(", "remoteAddress", ".", "getHostName", "(", "),", "remoteAddress", ".", "getPort", "(", "),", "\"", "https", "\"", ");", "}", "final", "int", "socketTimeout", "=", "HttpConnectionParams", ".", "getSoTimeout", "(", "params", ")", ";", "final", "int", "connectTimeout", "=", "HttpConnectionParams", ".", "getConnectionTimeout", "(", "params", ")", ";", "socket", ".", "setSoTimeout", "(", "socketTimeout", ")", ";", "return", "connectSocket", "(", "connectTimeout", ",", "socket", ",", "host", ",", "remoteAddress", ",", "localAddress", ",", "null", ")", ";", "}"], "docstring_tokens": ["accumulate", "multiple", "connections", "and", "exhaust", "all", "available", "resources"]}
{"contents": ["Make", "sure", "to", "escape", "URLs", "returned", "in", "the", "services", "listing", "(cherry", "picked", "from", "commit", "4ca5f7b92175edab46d1f1ea4e829a3ac4e9c7f2)"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "70", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "Executes", "a", "sequence", "of", "translators", "one", "after", "the", "other", ".", "Execution", "ends", "whenever", "*", "the", "first", "translator", "consumes", "codepoints", "from", "the", "input", ".", "*", "*", "@", "since", "1", ".", "0", "*", "/", "class", "AggregateTranslator", "extends", "CharSequenceTranslator", "{", "/", "**", "*", "Translator", "list", ".", "*", "/", "private", "final", "List", "<", "CharSequenceTranslator", ">", "translators", "=", "new", "ArrayList", "<", ">(", ");", "/", "**", "*", "Specify", "the", "translators", "to", "be", "used", "at", "creation", "time", ".", "*", "*", "@", "param", "translators", "CharSequenceTranslator", "array", "to", "aggregate", "*", "/", "AggregateTranslator", "(", "final", "CharSequenceTranslator", ".", "..", "translators", ")", "{", "if", "(", "translators", "!", "=", "null", ")", "{", "for", "(", "final", "CharSequenceTranslator", "translator", ":", "translators", ")", "{", "if", "(", "translator", "!", "=", "null", ")", "{", "this", ".", "translators", ".", "add", "(", "translator", ")", ";", "}", "}", "}", "}", "/", "**", "*", "The", "first", "translator", "to", "consume", "codepoints", "from", "the", "input", "is", "the", "'", "winner", "'", ".", "*", "Execution", "stops", "with", "the", "number", "of", "consumed", "codepoints", "being", "returned", ".", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "int", "translate", "(", "final", "CharSequence", "input", ",", "final", "int", "index", ",", "final", "Writer", "out", ")", "throws", "IOException", "{", "for", "(", "final", "CharSequenceTranslator", "translator", ":", "translators", ")", "{", "final", "int", "consumed", "=", "translator", ".", "translate", "(", "input", ",", "index", ",", "out", ")", ";", "if", "(", "consumed", "!", "=", "0", ")", "{", "return", "consumed", ";", "}", "}", "return", "0", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "140", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "java", ".", "util", ".", "Locale", ";", "/", "**", "*", "An", "API", "for", "translating", "text", ".", "*", "Its", "core", "use", "is", "to", "escape", "and", "unescape", "text", ".", "Because", "escaping", "and", "unescaping", "*", "is", "completely", "contextual", ",", "the", "API", "does", "not", "present", "two", "separate", "signatures", ".", "*", "*", "@", "since", "1", ".", "0", "*", "/", "abstract", "class", "CharSequenceTranslator", "{", "/", "**", "*", "Array", "containing", "the", "hexadecimal", "alphabet", ".", "*", "/", "static", "final", "char", "[", "]", "HEX_DIGITS", "=", "new", "char", "[", "]", "{", "'", "0", "'", ",", "'", "1", "'", ",", "'", "2", "'", ",", "'", "3", "'", ",", "'", "4", "'", ",", "'", "5", "'", ",", "'", "6", "'", ",", "'", "7", "'", ",", "'", "8", "'", ",", "'", "9", "'", ",", "'", "A", "'", ",", "'", "B", "'", ",", "'", "C", "'", ",", "'", "D", "'", ",", "'", "E", "'", ",", "'", "F", "'", "};", "/", "**", "*", "Translate", "a", "set", "of", "codepoints", ",", "represented", "by", "an", "int", "index", "into", "a", "CharSequence", ",", "*", "into", "another", "set", "of", "codepoints", ".", "The", "number", "of", "codepoints", "consumed", "must", "be", "returned", ",", "*", "and", "the", "only", "IOExceptions", "thrown", "must", "be", "from", "interacting", "with", "the", "Writer", "so", "that", "*", "the", "top", "level", "API", "may", "reliably", "ignore", "StringWriter", "IOExceptions", ".", "*", "*", "@", "param", "input", "CharSequence", "that", "is", "being", "translated", "*", "@", "param", "index", "int", "representing", "the", "current", "point", "of", "translation", "*", "@", "param", "out", "Writer", "to", "translate", "the", "text", "to", "*", "@", "return", "int", "count", "of", "codepoints", "consumed", "*", "@", "throws", "IOException", "if", "and", "only", "if", "the", "Writer", "produces", "an", "IOException", "*", "/", "public", "abstract", "int", "translate", "(", "CharSequence", "input", ",", "int", "index", ",", "Writer", "out", ")", "throws", "IOException", ";", "/", "**", "*", "Helper", "for", "non", "-", "Writer", "usage", ".", "*", "@", "param", "input", "CharSequence", "to", "be", "translated", "*", "@", "return", "String", "output", "of", "translation", "*", "/", "public", "final", "String", "translate", "(", "final", "CharSequence", "input", ")", "{", "if", "(", "input", "=", "=", "null", ")", "{", "return", "null", ";", "}", "try", "{", "final", "StringWriter", "writer", "=", "new", "StringWriter", "(", "input", ".", "length", "(", ")", "*", "2", ")", ";", "translate", "(", "input", ",", "writer", ")", ";", "return", "writer", ".", "toString", "(", ");", "}", "catch", "(", "final", "IOException", "ioe", ")", "{", "/", "/", "this", "should", "never", "ever", "happen", "while", "writing", "to", "a", "StringWriter", "throw", "new", "RuntimeException", "(", "ioe", ")", ";", "}", "}", "/", "**", "*", "Translate", "an", "input", "onto", "a", "Writer", ".", "This", "is", "intentionally", "final", "as", "its", "algorithm", "is", "*", "tightly", "coupled", "with", "the", "abstract", "method", "of", "this", "class", ".", "*", "*", "@", "param", "input", "CharSequence", "that", "is", "being", "translated", "*", "@", "param", "out", "Writer", "to", "translate", "the", "text", "to", "*", "@", "throws", "IOException", "if", "and", "only", "if", "the", "Writer", "produces", "an", "IOException", "*", "/", "public", "final", "void", "translate", "(", "final", "CharSequence", "input", ",", "final", "Writer", "out", ")", "throws", "IOException", "{", "if", "(", "input", "=", "=", "null", ")", "{", "return", ";", "}", "int", "pos", "=", "0", ";", "final", "int", "len", "=", "input", ".", "length", "(", ");", "while", "(", "pos", "<", "len", ")", "{", "final", "int", "consumed", "=", "translate", "(", "input", ",", "pos", ",", "out", ")", ";", "if", "(", "consumed", "=", "=", "0", ")", "{", "/", "/", "inlined", "implementation", "of", "Character", ".", "toChars", "(", "Character", ".", "codePointAt", "(", "input", ",", "pos", ")", ")", "/", "/", "avoids", "allocating", "temp", "char", "arrays", "and", "duplicate", "checks", "final", "char", "c1", "=", "input", ".", "charAt", "(", "pos", ")", ";", "out", ".", "write", "(", "c1", ")", ";", "pos", "+", "+;", "if", "(", "Character", ".", "isHighSurrogate", "(", "c1", ")", "&", "&", "pos", "<", "len", ")", "{", "final", "char", "c2", "=", "input", ".", "charAt", "(", "pos", ")", ";", "if", "(", "Character", ".", "isLowSurrogate", "(", "c2", ")", ")", "{", "out", ".", "write", "(", "c2", ")", ";", "pos", "+", "+;", "}", "}", "continue", ";", "}", "/", "/", "contract", "with", "translators", "is", "that", "they", "have", "to", "understand", "codepoints", "/", "/", "and", "they", "just", "took", "care", "of", "a", "surrogate", "pair", "for", "(", "int", "pt", "=", "0", ";", "pt", "<", "consumed", ";", "pt", "+", "+)", "{", "pos", "+", "=", "Character", ".", "charCount", "(", "Character", ".", "codePointAt", "(", "input", ",", "pos", ")", ");", "}", "}", "}", "/", "**", "*", "Helper", "method", "to", "create", "a", "merger", "of", "this", "translator", "with", "another", "set", "of", "*", "translators", ".", "Useful", "in", "customizing", "the", "standard", "functionality", ".", "*", "*", "@", "param", "translators", "CharSequenceTranslator", "array", "of", "translators", "to", "merge", "with", "this", "one", "*", "@", "return", "CharSequenceTranslator", "merging", "this", "translator", "with", "the", "others", "*", "/", "public", "final", "CharSequenceTranslator", "with", "(", "final", "CharSequenceTranslator", ".", "..", "translators", ")", "{", "final", "CharSequenceTranslator", "[", "]", "newArray", "=", "new", "CharSequenceTranslator", "[", "translators", ".", "length", "+", "1", "]", ";", "newArray", "[", "0", "]", "=", "this", ";", "System", ".", "arraycopy", "(", "translators", ",", "0", ",", "newArray", ",", "1", ",", "translators", ".", "length", ")", ";", "return", "new", "AggregateTranslator", "(", "newArray", ")", ";", "}", "/", "**", "*", "<", "p", ">", "Returns", "an", "upper", "case", "hexadecimal", "{", "@", "code", "String", "}", "for", "the", "given", "*", "character", ".", "</", "p", ">", "*", "*", "@", "param", "codepoint", "The", "codepoint", "to", "convert", ".", "*", "@", "return", "An", "upper", "case", "hexadecimal", "{", "@", "code", "String", "}", "*", "/", "public", "static", "String", "hex", "(", "final", "int", "codepoint", ")", "{", "return", "Integer", ".", "toHexString", "(", "codepoint", ")", ".", "toUpperCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "449", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "Class", "holding", "various", "entity", "data", "for", "HTML", "and", "XML", "-", "generally", "for", "use", "with", "*", "the", "LookupTranslator", ".", "*", "All", "Maps", "are", "generated", "using", "{", "@", "code", "java", ".", "util", ".", "Collections", ".", "unmodifiableMap", "(", ")}", ".", "*", "*", "@", "since", "1", ".", "0", "*", "/", "/", "/", "CHECKSTYLE", ":", "OFF", "final", "class", "EntityArrays", "{", "/", "**", "*", "A", "Map", "&", "lt", ";", "CharSequence", ",", "CharSequence", "&", "gt", ";", "to", "to", "escape", "*", "<", "a", "href", "=", "\"", "https", ":", "//", "secure", ".", "wikimedia", ".", "org", "/", "wikipedia", "/", "en", "/", "wiki", "/", "ISO", "/", "IEC_8859", "-", "1", "\"", ">", "ISO", "-", "8859", "-", "1", "<", "/", "a", ">", "*", "characters", "to", "their", "named", "HTML", "3", ".", "x", "equivalents", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "ISO8859_1_ESCAPE", ";", "static", "{", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "initialMap", "=", "new", "HashMap", "<", ">(", ");", "initialMap", ".", "put", "(", "\"\\", "u00A0", "\"", ",", "\"", "&", "nbsp", ";", "\")", ";", "/", "/", "non", "-", "breaking", "space", "initialMap", ".", "put", "(", "\"\\", "u00A1", "\"", ",", "\"", "&", "iexcl", ";", "\")", ";", "/", "/", "inverted", "exclamation", "mark", "initialMap", ".", "put", "(", "\"\\", "u00A2", "\"", ",", "\"", "&", "cent", ";", "\")", ";", "/", "/", "cent", "sign", "initialMap", ".", "put", "(", "\"\\", "u00A3", "\"", ",", "\"", "&", "pound", ";", "\")", ";", "/", "/", "pound", "sign", "initialMap", ".", "put", "(", "\"\\", "u00A4", "\"", ",", "\"", "&", "curren", ";", "\")", ";", "/", "/", "currency", "sign", "initialMap", ".", "put", "(", "\"\\", "u00A5", "\"", ",", "\"", "&", "yen", ";", "\")", ";", "/", "/", "yen", "sign", "=", "yuan", "sign", "initialMap", ".", "put", "(", "\"\\", "u00A6", "\"", ",", "\"", "&", "brvbar", ";", "\")", ";", "/", "/", "broken", "bar", "=", "broken", "vertical", "bar", "initialMap", ".", "put", "(", "\"\\", "u00A7", "\"", ",", "\"", "&", "sect", ";", "\")", ";", "/", "/", "section", "sign", "initialMap", ".", "put", "(", "\"\\", "u00A8", "\"", ",", "\"", "&", "uml", ";", "\")", ";", "/", "/", "diaeresis", "=", "spacing", "diaeresis", "initialMap", ".", "put", "(", "\"\\", "u00A9", "\"", ",", "\"", "&", "copy", ";", "\")", ";", "/", "/", "\u00a9", "-", "copyright", "sign", "initialMap", ".", "put", "(", "\"\\", "u00AA", "\"", ",", "\"", "&", "ordf", ";", "\")", ";", "/", "/", "feminine", "ordinal", "indicator", "initialMap", ".", "put", "(", "\"\\", "u00AB", "\"", ",", "\"", "&", "laquo", ";", "\")", ";", "/", "/", "left", "-", "pointing", "double", "angle", "quotation", "mark", "=", "left", "pointing", "guillemet", "initialMap", ".", "put", "(", "\"\\", "u00AC", "\"", ",", "\"", "&", "not", ";", "\")", ";", "/", "/", "not", "sign", "initialMap", ".", "put", "(", "\"\\", "u00AD", "\"", ",", "\"", "&", "shy", ";", "\")", ";", "/", "/", "soft", "hyphen", "=", "discretionary", "hyphen", "initialMap", ".", "put", "(", "\"\\", "u00AE", "\"", ",", "\"", "&", "reg", ";", "\")", ";", "/", "/", "\u00ae", "-", "registered", "trademark", "sign", "initialMap", ".", "put", "(", "\"\\", "u00AF", "\"", ",", "\"", "&", "macr", ";", "\")", ";", "/", "/", "macron", "=", "spacing", "macron", "=", "overline", "=", "APL", "overbar", "initialMap", ".", "put", "(", "\"\\", "u00B0", "\"", ",", "\"", "&", "deg", ";", "\")", ";", "/", "/", "degree", "sign", "initialMap", ".", "put", "(", "\"\\", "u00B1", "\"", ",", "\"", "&", "plusmn", ";", "\")", ";", "/", "/", "plus", "-", "minus", "sign", "=", "plus", "-", "or", "-", "minus", "sign", "initialMap", ".", "put", "(", "\"\\", "u00B2", "\"", ",", "\"", "&", "sup2", ";", "\")", ";", "/", "/", "superscript", "two", "=", "superscript", "digit", "two", "=", "squared", "initialMap", ".", "put", "(", "\"\\", "u00B3", "\"", ",", "\"", "&", "sup3", ";", "\")", ";", "/", "/", "superscript", "three", "=", "superscript", "digit", "three", "=", "cubed", "initialMap", ".", "put", "(", "\"\\", "u00B4", "\"", ",", "\"", "&", "acute", ";", "\")", ";", "/", "/", "acute", "accent", "=", "spacing", "acute", "initialMap", ".", "put", "(", "\"\\", "u00B5", "\"", ",", "\"", "&", "micro", ";", "\")", ";", "/", "/", "micro", "sign", "initialMap", ".", "put", "(", "\"\\", "u00B6", "\"", ",", "\"", "&", "para", ";", "\")", ";", "/", "/", "pilcrow", "sign", "=", "paragraph", "sign", "initialMap", ".", "put", "(", "\"\\", "u00B7", "\"", ",", "\"", "&", "middot", ";", "\")", ";", "/", "/", "middle", "dot", "=", "Georgian", "comma", "=", "Greek", "middle", "dot", "initialMap", ".", "put", "(", "\"\\", "u00B8", "\"", ",", "\"", "&", "cedil", ";", "\")", ";", "/", "/", "cedilla", "=", "spacing", "cedilla", "initialMap", ".", "put", "(", "\"\\", "u00B9", "\"", ",", "\"", "&", "sup1", ";", "\")", ";", "/", "/", "superscript", "one", "=", "superscript", "digit", "one", "initialMap", ".", "put", "(", "\"\\", "u00BA", "\"", ",", "\"", "&", "ordm", ";", "\")", ";", "/", "/", "masculine", "ordinal", "indicator", "initialMap", ".", "put", "(", "\"\\", "u00BB", "\"", ",", "\"", "&", "raquo", ";", "\")", ";", "/", "/", "right", "-", "pointing", "double", "angle", "quotation", "mark", "=", "right", "pointing", "guillemet", "initialMap", ".", "put", "(", "\"\\", "u00BC", "\"", ",", "\"", "&", "frac14", ";", "\")", ";", "/", "/", "vulgar", "fraction", "one", "quarter", "=", "fraction", "one", "quarter", "initialMap", ".", "put", "(", "\"\\", "u00BD", "\"", ",", "\"", "&", "frac12", ";", "\")", ";", "/", "/", "vulgar", "fraction", "one", "half", "=", "fraction", "one", "half", "initialMap", ".", "put", "(", "\"\\", "u00BE", "\"", ",", "\"", "&", "frac34", ";", "\")", ";", "/", "/", "vulgar", "fraction", "three", "quarters", "=", "fraction", "three", "quarters", "initialMap", ".", "put", "(", "\"\\", "u00BF", "\"", ",", "\"", "&", "iquest", ";", "\")", ";", "/", "/", "inverted", "question", "mark", "=", "turned", "question", "mark", "initialMap", ".", "put", "(", "\"\\", "u00C0", "\"", ",", "\"", "&", "Agrave", ";", "\")", ";", "/", "/", "\u00c0", "-", "uppercase", "A", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00C1", "\"", ",", "\"", "&", "Aacute", ";", "\")", ";", "/", "/", "\u00c1", "-", "uppercase", "A", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00C2", "\"", ",", "\"", "&", "Acirc", ";", "\")", ";", "/", "/", "\u00c2", "-", "uppercase", "A", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00C3", "\"", ",", "\"", "&", "Atilde", ";", "\")", ";", "/", "/", "\u00c3", "-", "uppercase", "A", ",", "tilde", "initialMap", ".", "put", "(", "\"\\", "u00C4", "\"", ",", "\"", "&", "Auml", ";", "\")", ";", "/", "/", "\u00c4", "-", "uppercase", "A", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00C5", "\"", ",", "\"", "&", "Aring", ";", "\")", ";", "/", "/", "\u00c5", "-", "uppercase", "A", ",", "ring", "initialMap", ".", "put", "(", "\"\\", "u00C6", "\"", ",", "\"", "&", "AElig", ";", "\")", ";", "/", "/", "\u00c6", "-", "uppercase", "AE", "initialMap", ".", "put", "(", "\"\\", "u00C7", "\"", ",", "\"", "&", "Ccedil", ";", "\")", ";", "/", "/", "\u00c7", "-", "uppercase", "C", ",", "cedilla", "initialMap", ".", "put", "(", "\"\\", "u00C8", "\"", ",", "\"", "&", "Egrave", ";", "\")", ";", "/", "/", "\u00c8", "-", "uppercase", "E", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00C9", "\"", ",", "\"", "&", "Eacute", ";", "\")", ";", "/", "/", "\u00c9", "-", "uppercase", "E", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00CA", "\"", ",", "\"", "&", "Ecirc", ";", "\")", ";", "/", "/", "\u00ca", "-", "uppercase", "E", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00CB", "\"", ",", "\"", "&", "Euml", ";", "\")", ";", "/", "/", "\u00cb", "-", "uppercase", "E", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00CC", "\"", ",", "\"", "&", "Igrave", ";", "\")", ";", "/", "/", "\u00cc", "-", "uppercase", "I", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00CD", "\"", ",", "\"", "&", "Iacute", ";", "\")", ";", "/", "/", "\u00cd", "-", "uppercase", "I", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00CE", "\"", ",", "\"", "&", "Icirc", ";", "\")", ";", "/", "/", "\u00ce", "-", "uppercase", "I", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00CF", "\"", ",", "\"", "&", "Iuml", ";", "\")", ";", "/", "/", "\u00cf", "-", "uppercase", "I", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00D0", "\"", ",", "\"", "&", "ETH", ";", "\")", ";", "/", "/", "\u00d0", "-", "uppercase", "Eth", ",", "Icelandic", "initialMap", ".", "put", "(", "\"\\", "u00D1", "\"", ",", "\"", "&", "Ntilde", ";", "\")", ";", "/", "/", "\u00d1", "-", "uppercase", "N", ",", "tilde", "initialMap", ".", "put", "(", "\"\\", "u00D2", "\"", ",", "\"", "&", "Ograve", ";", "\")", ";", "/", "/", "\u00d2", "-", "uppercase", "O", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00D3", "\"", ",", "\"", "&", "Oacute", ";", "\")", ";", "/", "/", "\u00d3", "-", "uppercase", "O", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00D4", "\"", ",", "\"", "&", "Ocirc", ";", "\")", ";", "/", "/", "\u00d4", "-", "uppercase", "O", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00D5", "\"", ",", "\"", "&", "Otilde", ";", "\")", ";", "/", "/", "\u00d5", "-", "uppercase", "O", ",", "tilde", "initialMap", ".", "put", "(", "\"\\", "u00D6", "\"", ",", "\"", "&", "Ouml", ";", "\")", ";", "/", "/", "\u00d6", "-", "uppercase", "O", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00D7", "\"", ",", "\"", "&", "times", ";", "\")", ";", "/", "/", "multiplication", "sign", "initialMap", ".", "put", "(", "\"\\", "u00D8", "\"", ",", "\"", "&", "Oslash", ";", "\")", ";", "/", "/", "\u00d8", "-", "uppercase", "O", ",", "slash", "initialMap", ".", "put", "(", "\"\\", "u00D9", "\"", ",", "\"", "&", "Ugrave", ";", "\")", ";", "/", "/", "\u00d9", "-", "uppercase", "U", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00DA", "\"", ",", "\"", "&", "Uacute", ";", "\")", ";", "/", "/", "\u00da", "-", "uppercase", "U", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00DB", "\"", ",", "\"", "&", "Ucirc", ";", "\")", ";", "/", "/", "\u00db", "-", "uppercase", "U", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00DC", "\"", ",", "\"", "&", "Uuml", ";", "\")", ";", "/", "/", "\u00dc", "-", "uppercase", "U", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00DD", "\"", ",", "\"", "&", "Yacute", ";", "\")", ";", "/", "/", "\u00dd", "-", "uppercase", "Y", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00DE", "\"", ",", "\"", "&", "THORN", ";", "\")", ";", "/", "/", "\u00de", "-", "uppercase", "THORN", ",", "Icelandic", "initialMap", ".", "put", "(", "\"\\", "u00DF", "\"", ",", "\"", "&", "szlig", ";", "\")", ";", "/", "/", "\u00df", "-", "lowercase", "sharps", ",", "German", "initialMap", ".", "put", "(", "\"\\", "u00E0", "\"", ",", "\"", "&", "agrave", ";", "\")", ";", "/", "/", "\u00e0", "-", "lowercase", "a", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00E1", "\"", ",", "\"", "&", "aacute", ";", "\")", ";", "/", "/", "\u00e1", "-", "lowercase", "a", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00E2", "\"", ",", "\"", "&", "acirc", ";", "\")", ";", "/", "/", "\u00e2", "-", "lowercase", "a", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00E3", "\"", ",", "\"", "&", "atilde", ";", "\")", ";", "/", "/", "\u00e3", "-", "lowercase", "a", ",", "tilde", "initialMap", ".", "put", "(", "\"\\", "u00E4", "\"", ",", "\"", "&", "auml", ";", "\")", ";", "/", "/", "\u00e4", "-", "lowercase", "a", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00E5", "\"", ",", "\"", "&", "aring", ";", "\")", ";", "/", "/", "\u00e5", "-", "lowercase", "a", ",", "ring", "initialMap", ".", "put", "(", "\"\\", "u00E6", "\"", ",", "\"", "&", "aelig", ";", "\")", ";", "/", "/", "\u00e6", "-", "lowercase", "ae", "initialMap", ".", "put", "(", "\"\\", "u00E7", "\"", ",", "\"", "&", "ccedil", ";", "\")", ";", "/", "/", "\u00e7", "-", "lowercase", "c", ",", "cedilla", "initialMap", ".", "put", "(", "\"\\", "u00E8", "\"", ",", "\"", "&", "egrave", ";", "\")", ";", "/", "/", "\u00e8", "-", "lowercase", "e", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00E9", "\"", ",", "\"", "&", "eacute", ";", "\")", ";", "/", "/", "\u00e9", "-", "lowercase", "e", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00EA", "\"", ",", "\"", "&", "ecirc", ";", "\")", ";", "/", "/", "\u00ea", "-", "lowercase", "e", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00EB", "\"", ",", "\"", "&", "euml", ";", "\")", ";", "/", "/", "\u00eb", "-", "lowercase", "e", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00EC", "\"", ",", "\"", "&", "igrave", ";", "\")", ";", "/", "/", "\u00ec", "-", "lowercase", "i", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00ED", "\"", ",", "\"", "&", "iacute", ";", "\")", ";", "/", "/", "\u00ed", "-", "lowercase", "i", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00EE", "\"", ",", "\"", "&", "icirc", ";", "\")", ";", "/", "/", "\u00ee", "-", "lowercase", "i", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00EF", "\"", ",", "\"", "&", "iuml", ";", "\")", ";", "/", "/", "\u00ef", "-", "lowercase", "i", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00F0", "\"", ",", "\"", "&", "eth", ";", "\")", ";", "/", "/", "\u00f0", "-", "lowercase", "eth", ",", "Icelandic", "initialMap", ".", "put", "(", "\"\\", "u00F1", "\"", ",", "\"", "&", "ntilde", ";", "\")", ";", "/", "/", "\u00f1", "-", "lowercase", "n", ",", "tilde", "initialMap", ".", "put", "(", "\"\\", "u00F2", "\"", ",", "\"", "&", "ograve", ";", "\")", ";", "/", "/", "\u00f2", "-", "lowercase", "o", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00F3", "\"", ",", "\"", "&", "oacute", ";", "\")", ";", "/", "/", "\u00f3", "-", "lowercase", "o", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00F4", "\"", ",", "\"", "&", "ocirc", ";", "\")", ";", "/", "/", "\u00f4", "-", "lowercase", "o", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00F5", "\"", ",", "\"", "&", "otilde", ";", "\")", ";", "/", "/", "\u00f5", "-", "lowercase", "o", ",", "tilde", "initialMap", ".", "put", "(", "\"\\", "u00F6", "\"", ",", "\"", "&", "ouml", ";", "\")", ";", "/", "/", "\u00f6", "-", "lowercase", "o", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00F7", "\"", ",", "\"", "&", "divide", ";", "\")", ";", "/", "/", "division", "sign", "initialMap", ".", "put", "(", "\"\\", "u00F8", "\"", ",", "\"", "&", "oslash", ";", "\")", ";", "/", "/", "\u00f8", "-", "lowercase", "o", ",", "slash", "initialMap", ".", "put", "(", "\"\\", "u00F9", "\"", ",", "\"", "&", "ugrave", ";", "\")", ";", "/", "/", "\u00f9", "-", "lowercase", "u", ",", "grave", "accent", "initialMap", ".", "put", "(", "\"\\", "u00FA", "\"", ",", "\"", "&", "uacute", ";", "\")", ";", "/", "/", "\u00fa", "-", "lowercase", "u", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00FB", "\"", ",", "\"", "&", "ucirc", ";", "\")", ";", "/", "/", "\u00fb", "-", "lowercase", "u", ",", "circumflex", "accent", "initialMap", ".", "put", "(", "\"\\", "u00FC", "\"", ",", "\"", "&", "uuml", ";", "\")", ";", "/", "/", "\u00fc", "-", "lowercase", "u", ",", "umlaut", "initialMap", ".", "put", "(", "\"\\", "u00FD", "\"", ",", "\"", "&", "yacute", ";", "\")", ";", "/", "/", "\u00fd", "-", "lowercase", "y", ",", "acute", "accent", "initialMap", ".", "put", "(", "\"\\", "u00FE", "\"", ",", "\"", "&", "thorn", ";", "\")", ";", "/", "/", "\u00fe", "-", "lowercase", "thorn", ",", "Icelandic", "initialMap", ".", "put", "(", "\"\\", "u00FF", "\"", ",", "\"", "&", "yuml", ";", "\")", ";", "/", "/", "\u00ff", "-", "lowercase", "y", ",", "umlaut", "ISO8859_1_ESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "initialMap", ")", ";", "}", "/", "**", "*", "Reverse", "of", "{", "@", "link", "#", "ISO8859_1_ESCAPE", "}", "for", "unescaping", "purposes", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "ISO8859_1_UNESCAPE", ";", "static", "{", "ISO8859_1_UNESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "invert", "(", "ISO8859_1_ESCAPE", ")", ");", "}", "/", "**", "*", "A", "Map", "&", "lt", ";", "CharSequence", ",", "CharSequence", "&", "gt", ";", "to", "escape", "additional", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "REC", "-", "html40", "/", "sgml", "/", "entities", ".", "html", "\"", ">", "character", "entity", "*", "references", "<", "/", "a", ">", ".", "Note", "that", "this", "must", "be", "used", "with", "{", "@", "link", "#", "ISO8859_1_ESCAPE", "}", "to", "get", "the", "full", "list", "of", "*", "HTML", "4", ".", "0", "character", "entities", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "HTML40_EXTENDED_ESCAPE", ";", "static", "{", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "initialMap", "=", "new", "HashMap", "<", ">(", ");", "/", "/", "<", "!-", "-", "Latin", "Extended", "-", "B", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0192", "\"", ",", "\"", "&", "fnof", ";", "\")", ";", "/", "/", "latin", "small", "f", "with", "hook", "=", "function", "=", "florin", ",", "U", "+", "0192", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "Greek", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0391", "\"", ",", "\"", "&", "Alpha", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "alpha", ",", "U", "+", "0391", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0392", "\"", ",", "\"", "&", "Beta", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "beta", ",", "U", "+", "0392", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0393", "\"", ",", "\"", "&", "Gamma", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "gamma", ",", "U", "+", "0393", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0394", "\"", ",", "\"", "&", "Delta", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "delta", ",", "U", "+", "0394", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0395", "\"", ",", "\"", "&", "Epsilon", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "epsilon", ",", "U", "+", "0395", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0396", "\"", ",", "\"", "&", "Zeta", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "zeta", ",", "U", "+", "0396", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0397", "\"", ",", "\"", "&", "Eta", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "eta", ",", "U", "+", "0397", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0398", "\"", ",", "\"", "&", "Theta", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "theta", ",", "U", "+", "0398", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0399", "\"", ",", "\"", "&", "Iota", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "iota", ",", "U", "+", "0399", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u039A", "\"", ",", "\"", "&", "Kappa", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "kappa", ",", "U", "+", "039A", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u039B", "\"", ",", "\"", "&", "Lambda", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "lambda", ",", "U", "+", "039B", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u039C", "\"", ",", "\"", "&", "Mu", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "mu", ",", "U", "+", "039C", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u039D", "\"", ",", "\"", "&", "Nu", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "nu", ",", "U", "+", "039D", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u039E", "\"", ",", "\"", "&", "Xi", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "xi", ",", "U", "+", "039E", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u039F", "\"", ",", "\"", "&", "Omicron", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "omicron", ",", "U", "+", "039F", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A0", "\"", ",", "\"", "&", "Pi", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "pi", ",", "U", "+", "03A0", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A1", "\"", ",", "\"", "&", "Rho", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "rho", ",", "U", "+", "03A1", "-", "->", "/", "/", "<", "!-", "-", "there", "is", "no", "Sigmaf", ",", "and", "no", "U", "+", "03A2", "character", "either", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A3", "\"", ",", "\"", "&", "Sigma", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "sigma", ",", "U", "+", "03A3", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A4", "\"", ",", "\"", "&", "Tau", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "tau", ",", "U", "+", "03A4", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A5", "\"", ",", "\"", "&", "Upsilon", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "upsilon", ",", "U", "+", "03A5", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A6", "\"", ",", "\"", "&", "Phi", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "phi", ",", "U", "+", "03A6", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A7", "\"", ",", "\"", "&", "Chi", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "chi", ",", "U", "+", "03A7", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A8", "\"", ",", "\"", "&", "Psi", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "psi", ",", "U", "+", "03A8", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03A9", "\"", ",", "\"", "&", "Omega", ";", "\")", ";", "/", "/", "greek", "capital", "letter", "omega", ",", "U", "+", "03A9", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B1", "\"", ",", "\"", "&", "alpha", ";", "\")", ";", "/", "/", "greek", "small", "letter", "alpha", ",", "U", "+", "03B1", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B2", "\"", ",", "\"", "&", "beta", ";", "\")", ";", "/", "/", "greek", "small", "letter", "beta", ",", "U", "+", "03B2", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B3", "\"", ",", "\"", "&", "gamma", ";", "\")", ";", "/", "/", "greek", "small", "letter", "gamma", ",", "U", "+", "03B3", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B4", "\"", ",", "\"", "&", "delta", ";", "\")", ";", "/", "/", "greek", "small", "letter", "delta", ",", "U", "+", "03B4", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B5", "\"", ",", "\"", "&", "epsilon", ";", "\")", ";", "/", "/", "greek", "small", "letter", "epsilon", ",", "U", "+", "03B5", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B6", "\"", ",", "\"", "&", "zeta", ";", "\")", ";", "/", "/", "greek", "small", "letter", "zeta", ",", "U", "+", "03B6", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B7", "\"", ",", "\"", "&", "eta", ";", "\")", ";", "/", "/", "greek", "small", "letter", "eta", ",", "U", "+", "03B7", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B8", "\"", ",", "\"", "&", "theta", ";", "\")", ";", "/", "/", "greek", "small", "letter", "theta", ",", "U", "+", "03B8", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03B9", "\"", ",", "\"", "&", "iota", ";", "\")", ";", "/", "/", "greek", "small", "letter", "iota", ",", "U", "+", "03B9", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03BA", "\"", ",", "\"", "&", "kappa", ";", "\")", ";", "/", "/", "greek", "small", "letter", "kappa", ",", "U", "+", "03BA", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03BB", "\"", ",", "\"", "&", "lambda", ";", "\")", ";", "/", "/", "greek", "small", "letter", "lambda", ",", "U", "+", "03BB", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03BC", "\"", ",", "\"", "&", "mu", ";", "\")", ";", "/", "/", "greek", "small", "letter", "mu", ",", "U", "+", "03BC", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03BD", "\"", ",", "\"", "&", "nu", ";", "\")", ";", "/", "/", "greek", "small", "letter", "nu", ",", "U", "+", "03BD", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03BE", "\"", ",", "\"", "&", "xi", ";", "\")", ";", "/", "/", "greek", "small", "letter", "xi", ",", "U", "+", "03BE", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03BF", "\"", ",", "\"", "&", "omicron", ";", "\")", ";", "/", "/", "greek", "small", "letter", "omicron", ",", "U", "+", "03BF", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C0", "\"", ",", "\"", "&", "pi", ";", "\")", ";", "/", "/", "greek", "small", "letter", "pi", ",", "U", "+", "03C0", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C1", "\"", ",", "\"", "&", "rho", ";", "\")", ";", "/", "/", "greek", "small", "letter", "rho", ",", "U", "+", "03C1", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C2", "\"", ",", "\"", "&", "sigmaf", ";", "\")", ";", "/", "/", "greek", "small", "letter", "final", "sigma", ",", "U", "+", "03C2", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C3", "\"", ",", "\"", "&", "sigma", ";", "\")", ";", "/", "/", "greek", "small", "letter", "sigma", ",", "U", "+", "03C3", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C4", "\"", ",", "\"", "&", "tau", ";", "\")", ";", "/", "/", "greek", "small", "letter", "tau", ",", "U", "+", "03C4", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C5", "\"", ",", "\"", "&", "upsilon", ";", "\")", ";", "/", "/", "greek", "small", "letter", "upsilon", ",", "U", "+", "03C5", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C6", "\"", ",", "\"", "&", "phi", ";", "\")", ";", "/", "/", "greek", "small", "letter", "phi", ",", "U", "+", "03C6", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C7", "\"", ",", "\"", "&", "chi", ";", "\")", ";", "/", "/", "greek", "small", "letter", "chi", ",", "U", "+", "03C7", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C8", "\"", ",", "\"", "&", "psi", ";", "\")", ";", "/", "/", "greek", "small", "letter", "psi", ",", "U", "+", "03C8", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03C9", "\"", ",", "\"", "&", "omega", ";", "\")", ";", "/", "/", "greek", "small", "letter", "omega", ",", "U", "+", "03C9", "ISOgrk3", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03D1", "\"", ",", "\"", "&", "thetasym", ";", "\")", ";", "/", "/", "greek", "small", "letter", "theta", "symbol", ",", "U", "+", "03D1", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03D2", "\"", ",", "\"", "&", "upsih", ";", "\")", ";", "/", "/", "greek", "upsilon", "with", "hook", "symbol", ",", "U", "+", "03D2", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u03D6", "\"", ",", "\"", "&", "piv", ";", "\")", ";", "/", "/", "greek", "pi", "symbol", ",", "U", "+", "03D6", "ISOgrk3", "-", "->", "/", "/", "<", "!-", "-", "General", "Punctuation", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2022", "\"", ",", "\"", "&", "bull", ";", "\")", ";", "/", "/", "bullet", "=", "black", "small", "circle", ",", "U", "+", "2022", "ISOpub", "-", "->", "/", "/", "<", "!-", "-", "bullet", "is", "NOT", "the", "same", "as", "bullet", "operator", ",", "U", "+", "2219", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2026", "\"", ",", "\"", "&", "hellip", ";", "\")", ";", "/", "/", "horizontal", "ellipsis", "=", "three", "dot", "leader", ",", "U", "+", "2026", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2032", "\"", ",", "\"", "&", "prime", ";", "\")", ";", "/", "/", "prime", "=", "minutes", "=", "feet", ",", "U", "+", "2032", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2033", "\"", ",", "\"", "&", "Prime", ";", "\")", ";", "/", "/", "double", "prime", "=", "seconds", "=", "inches", ",", "U", "+", "2033", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u203E", "\"", ",", "\"", "&", "oline", ";", "\")", ";", "/", "/", "overline", "=", "spacing", "overscore", ",", "U", "+", "203E", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2044", "\"", ",", "\"", "&", "frasl", ";", "\")", ";", "/", "/", "fraction", "slash", ",", "U", "+", "2044", "NEW", "-", "->", "/", "/", "<", "!-", "-", "Letterlike", "Symbols", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2118", "\"", ",", "\"", "&", "weierp", ";", "\")", ";", "/", "/", "script", "capital", "P", "=", "power", "set", "=", "Weierstrass", "p", ",", "U", "+", "2118", "ISOamso", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2111", "\"", ",", "\"", "&", "image", ";", "\")", ";", "/", "/", "blackletter", "capital", "I", "=", "imaginary", "part", ",", "U", "+", "2111", "ISOamso", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u211C", "\"", ",", "\"", "&", "real", ";", "\")", ";", "/", "/", "blackletter", "capital", "R", "=", "real", "part", "symbol", ",", "U", "+", "211C", "ISOamso", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2122", "\"", ",", "\"", "&", "trade", ";", "\")", ";", "/", "/", "trade", "mark", "sign", ",", "U", "+", "2122", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2135", "\"", ",", "\"", "&", "alefsym", ";", "\")", ";", "/", "/", "alef", "symbol", "=", "first", "transfinite", "cardinal", ",", "U", "+", "2135", "NEW", "-", "->", "/", "/", "<", "!-", "-", "alef", "symbol", "is", "NOT", "the", "same", "as", "hebrew", "letter", "alef", ",", "U", "+", "05D0", "although", "the", "/", "/", "same", "glyph", "could", "be", "used", "to", "depict", "both", "characters", "-", "->", "/", "/", "<", "!-", "-", "Arrows", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2190", "\"", ",", "\"", "&", "larr", ";", "\")", ";", "/", "/", "leftwards", "arrow", ",", "U", "+", "2190", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2191", "\"", ",", "\"", "&", "uarr", ";", "\")", ";", "/", "/", "upwards", "arrow", ",", "U", "+", "2191", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2192", "\"", ",", "\"", "&", "rarr", ";", "\")", ";", "/", "/", "rightwards", "arrow", ",", "U", "+", "2192", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2193", "\"", ",", "\"", "&", "darr", ";", "\")", ";", "/", "/", "downwards", "arrow", ",", "U", "+", "2193", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2194", "\"", ",", "\"", "&", "harr", ";", "\")", ";", "/", "/", "left", "right", "arrow", ",", "U", "+", "2194", "ISOamsa", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u21B5", "\"", ",", "\"", "&", "crarr", ";", "\")", ";", "/", "/", "downwards", "arrow", "with", "corner", "leftwards", "=", "carriage", "return", ",", "U", "+", "21B5", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u21D0", "\"", ",", "\"", "&", "lArr", ";", "\")", ";", "/", "/", "leftwards", "double", "arrow", ",", "U", "+", "21D0", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "ISO", "10646", "does", "not", "say", "that", "lArr", "is", "the", "same", "as", "the", "'", "is", "implied", "by", "'", "/", "/", "arrow", "but", "also", "does", "not", "have", "any", "other", "character", "for", "that", "function", ".", "/", "/", "So", "?", "lArr", "canbe", "used", "for", "'", "is", "implied", "by", "'", "as", "ISOtech", "suggests", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u21D1", "\"", ",", "\"", "&", "uArr", ";", "\")", ";", "/", "/", "upwards", "double", "arrow", ",", "U", "+", "21D1", "ISOamsa", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u21D2", "\"", ",", "\"", "&", "rArr", ";", "\")", ";", "/", "/", "rightwards", "double", "arrow", ",", "U", "+", "21D2", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "ISO", "10646", "does", "not", "say", "this", "is", "the", "'", "implies", "'", "character", "but", "does", "not", "/", "/", "have", "another", "character", "with", "this", "function", "so", "?", "rArr", "can", "be", "used", "for", "/", "/", "'", "implies", "'", "as", "ISOtech", "suggests", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u21D3", "\"", ",", "\"", "&", "dArr", ";", "\")", ";", "/", "/", "downwards", "double", "arrow", ",", "U", "+", "21D3", "ISOamsa", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u21D4", "\"", ",", "\"", "&", "hArr", ";", "\")", ";", "/", "/", "left", "right", "double", "arrow", ",", "U", "+", "21D4", "ISOamsa", "-", "->", "/", "/", "<", "!-", "-", "Mathematical", "Operators", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2200", "\"", ",", "\"", "&", "forall", ";", "\")", ";", "/", "/", "for", "all", ",", "U", "+", "2200", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2202", "\"", ",", "\"", "&", "part", ";", "\")", ";", "/", "/", "partial", "differential", ",", "U", "+", "2202", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2203", "\"", ",", "\"", "&", "exist", ";", "\")", ";", "/", "/", "there", "exists", ",", "U", "+", "2203", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2205", "\"", ",", "\"", "&", "empty", ";", "\")", ";", "/", "/", "empty", "set", "=", "null", "set", "=", "diameter", ",", "U", "+", "2205", "ISOamso", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2207", "\"", ",", "\"", "&", "nabla", ";", "\")", ";", "/", "/", "nabla", "=", "backward", "difference", ",", "U", "+", "2207", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2208", "\"", ",", "\"", "&", "isin", ";", "\")", ";", "/", "/", "element", "of", ",", "U", "+", "2208", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2209", "\"", ",", "\"", "&", "notin", ";", "\")", ";", "/", "/", "not", "an", "element", "of", ",", "U", "+", "2209", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u220B", "\"", ",", "\"", "&", "ni", ";", "\")", ";", "/", "/", "contains", "as", "member", ",", "U", "+", "220B", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "should", "there", "be", "a", "more", "memorable", "name", "than", "'", "ni", "'", "?", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u220F", "\"", ",", "\"", "&", "prod", ";", "\")", ";", "/", "/", "n", "-", "ary", "product", "=", "product", "sign", ",", "U", "+", "220F", "ISOamsb", "-", "->", "/", "/", "<", "!-", "-", "prod", "is", "NOT", "the", "same", "character", "as", "U", "+", "03A0", "'", "greek", "capital", "letter", "pi", "'", "/", "/", "though", "the", "same", "glyph", "might", "be", "used", "for", "both", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2211", "\"", ",", "\"", "&", "sum", ";", "\")", ";", "/", "/", "n", "-", "ary", "summation", ",", "U", "+", "2211", "ISOamsb", "-", "->", "/", "/", "<", "!-", "-", "sum", "is", "NOT", "the", "same", "character", "as", "U", "+", "03A3", "'", "greek", "capital", "letter", "sigma", "'", "/", "/", "though", "the", "same", "glyph", "might", "be", "used", "for", "both", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2212", "\"", ",", "\"", "&", "minus", ";", "\")", ";", "/", "/", "minus", "sign", ",", "U", "+", "2212", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2217", "\"", ",", "\"", "&", "lowast", ";", "\")", ";", "/", "/", "asterisk", "operator", ",", "U", "+", "2217", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u221A", "\"", ",", "\"", "&", "radic", ";", "\")", ";", "/", "/", "square", "root", "=", "radical", "sign", ",", "U", "+", "221A", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u221D", "\"", ",", "\"", "&", "prop", ";", "\")", ";", "/", "/", "proportional", "to", ",", "U", "+", "221D", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u221E", "\"", ",", "\"", "&", "infin", ";", "\")", ";", "/", "/", "infinity", ",", "U", "+", "221E", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2220", "\"", ",", "\"", "&", "ang", ";", "\")", ";", "/", "/", "angle", ",", "U", "+", "2220", "ISOamso", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2227", "\"", ",", "\"", "&", "and", ";", "\")", ";", "/", "/", "logical", "and", "=", "wedge", ",", "U", "+", "2227", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2228", "\"", ",", "\"", "&", "or", ";", "\")", ";", "/", "/", "logical", "or", "=", "vee", ",", "U", "+", "2228", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2229", "\"", ",", "\"", "&", "cap", ";", "\")", ";", "/", "/", "intersection", "=", "cap", ",", "U", "+", "2229", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u222A", "\"", ",", "\"", "&", "cup", ";", "\")", ";", "/", "/", "union", "=", "cup", ",", "U", "+", "222A", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u222B", "\"", ",", "\"", "&", "int", ";", "\")", ";", "/", "/", "integral", ",", "U", "+", "222B", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2234", "\"", ",", "\"", "&", "there4", ";", "\")", ";", "/", "/", "therefore", ",", "U", "+", "2234", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u223C", "\"", ",", "\"", "&", "sim", ";", "\")", ";", "/", "/", "tilde", "operator", "=", "varies", "with", "=", "similar", "to", ",", "U", "+", "223C", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "tilde", "operator", "is", "NOT", "the", "same", "character", "as", "the", "tilde", ",", "U", "+", "007E", ",", "although", "/", "/", "the", "same", "glyph", "might", "be", "used", "to", "represent", "both", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2245", "\"", ",", "\"", "&", "cong", ";", "\")", ";", "/", "/", "approximately", "equal", "to", ",", "U", "+", "2245", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2248", "\"", ",", "\"", "&", "asymp", ";", "\")", ";", "/", "/", "almost", "equal", "to", "=", "asymptotic", "to", ",", "U", "+", "2248", "ISOamsr", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2260", "\"", ",", "\"", "&", "ne", ";", "\")", ";", "/", "/", "not", "equal", "to", ",", "U", "+", "2260", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2261", "\"", ",", "\"", "&", "equiv", ";", "\")", ";", "/", "/", "identical", "to", ",", "U", "+", "2261", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2264", "\"", ",", "\"", "&", "le", ";", "\")", ";", "/", "/", "less", "-", "than", "or", "equal", "to", ",", "U", "+", "2264", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2265", "\"", ",", "\"", "&", "ge", ";", "\")", ";", "/", "/", "greater", "-", "than", "or", "equal", "to", ",", "U", "+", "2265", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2282", "\"", ",", "\"", "&", "sub", ";", "\")", ";", "/", "/", "subset", "of", ",", "U", "+", "2282", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2283", "\"", ",", "\"", "&", "sup", ";", "\")", ";", "/", "/", "superset", "of", ",", "U", "+", "2283", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "note", "that", "nsup", ",", "'", "not", "a", "superset", "of", ",", "U", "+", "2283", "'", "is", "not", "covered", "by", "the", "/", "/", "Symbol", "font", "encoding", "and", "is", "not", "included", ".", "Should", "it", "be", ",", "for", "symmetry", "?", "/", "/", "It", "is", "in", "ISOamsn", "-", "->", ",", "initialMap", ".", "put", "(", "\"\\", "u2284", "\"", ",", "\"", "&", "nsub", ";", "\")", ";", "/", "/", "not", "a", "subset", "of", ",", "U", "+", "2284", "ISOamsn", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2286", "\"", ",", "\"", "&", "sube", ";", "\")", ";", "/", "/", "subset", "of", "or", "equal", "to", ",", "U", "+", "2286", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2287", "\"", ",", "\"", "&", "supe", ";", "\")", ";", "/", "/", "superset", "of", "or", "equal", "to", ",", "U", "+", "2287", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2295", "\"", ",", "\"", "&", "oplus", ";", "\")", ";", "/", "/", "circled", "plus", "=", "direct", "sum", ",", "U", "+", "2295", "ISOamsb", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2297", "\"", ",", "\"", "&", "otimes", ";", "\")", ";", "/", "/", "circled", "times", "=", "vector", "product", ",", "U", "+", "2297", "ISOamsb", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u22A5", "\"", ",", "\"", "&", "perp", ";", "\")", ";", "/", "/", "up", "tack", "=", "orthogonal", "to", "=", "perpendicular", ",", "U", "+", "22A5", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u22C5", "\"", ",", "\"", "&", "sdot", ";", "\")", ";", "/", "/", "dot", "operator", ",", "U", "+", "22C5", "ISOamsb", "-", "->", "/", "/", "<", "!-", "-", "dot", "operator", "is", "NOT", "the", "same", "character", "as", "U", "+", "00B7", "middle", "dot", "-", "->", "/", "/", "<", "!-", "-", "Miscellaneous", "Technical", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2308", "\"", ",", "\"", "&", "lceil", ";", "\")", ";", "/", "/", "left", "ceiling", "=", "apl", "upstile", ",", "U", "+", "2308", "ISOamsc", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2309", "\"", ",", "\"", "&", "rceil", ";", "\")", ";", "/", "/", "right", "ceiling", ",", "U", "+", "2309", "ISOamsc", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u230A", "\"", ",", "\"", "&", "lfloor", ";", "\")", ";", "/", "/", "left", "floor", "=", "apl", "downstile", ",", "U", "+", "230A", "ISOamsc", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u230B", "\"", ",", "\"", "&", "rfloor", ";", "\")", ";", "/", "/", "right", "floor", ",", "U", "+", "230B", "ISOamsc", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2329", "\"", ",", "\"", "&", "lang", ";", "\")", ";", "/", "/", "left", "-", "pointing", "angle", "bracket", "=", "bra", ",", "U", "+", "2329", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "lang", "is", "NOT", "the", "same", "character", "as", "U", "+", "003C", "'", "less", "than", "'", "or", "U", "+", "2039", "'", "single", "left", "-", "pointing", "angle", "quotation", "/", "/", "mark", "'", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u232A", "\"", ",", "\"", "&", "rang", ";", "\")", ";", "/", "/", "right", "-", "pointing", "angle", "bracket", "=", "ket", ",", "U", "+", "232A", "ISOtech", "-", "->", "/", "/", "<", "!-", "-", "rang", "is", "NOT", "the", "same", "character", "as", "U", "+", "003E", "'", "greater", "than", "'", "or", "U", "+", "203A", "/", "/", "'", "single", "right", "-", "pointing", "angle", "quotation", "mark", "'", "-", "->", "/", "/", "<", "!-", "-", "Geometric", "Shapes", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u25CA", "\"", ",", "\"", "&", "loz", ";", "\")", ";", "/", "/", "lozenge", ",", "U", "+", "25CA", "ISOpub", "-", "->", "/", "/", "<", "!-", "-", "Miscellaneous", "Symbols", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2660", "\"", ",", "\"", "&", "spades", ";", "\")", ";", "/", "/", "black", "spade", "suit", ",", "U", "+", "2660", "ISOpub", "-", "->", "/", "/", "<", "!-", "-", "black", "here", "seems", "to", "mean", "filled", "as", "opposed", "to", "hollow", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2663", "\"", ",", "\"", "&", "clubs", ";", "\")", ";", "/", "/", "black", "club", "suit", "=", "shamrock", ",", "U", "+", "2663", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2665", "\"", ",", "\"", "&", "hearts", ";", "\")", ";", "/", "/", "black", "heart", "suit", "=", "valentine", ",", "U", "+", "2665", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2666", "\"", ",", "\"", "&", "diams", ";", "\")", ";", "/", "/", "black", "diamond", "suit", ",", "U", "+", "2666", "ISOpub", "-", "->", "/", "/", "<", "!-", "-", "Latin", "Extended", "-", "A", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0152", "\"", ",", "\"", "&", "OElig", ";", "\")", ";", "/", "/", "-", "-", "latin", "capital", "ligature", "OE", ",", "U", "+", "0152", "ISOlat2", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0153", "\"", ",", "\"", "&", "oelig", ";", "\")", ";", "/", "/", "-", "-", "latin", "small", "ligature", "oe", ",", "U", "+", "0153", "ISOlat2", "-", "->", "/", "/", "<", "!-", "-", "ligature", "is", "a", "misnomer", ",", "this", "is", "a", "separate", "character", "in", "some", "languages", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0160", "\"", ",", "\"", "&", "Scaron", ";", "\")", ";", "/", "/", "-", "-", "latin", "capital", "letter", "S", "with", "caron", ",", "U", "+", "0160", "ISOlat2", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0161", "\"", ",", "\"", "&", "scaron", ";", "\")", ";", "/", "/", "-", "-", "latin", "small", "letter", "s", "with", "caron", ",", "U", "+", "0161", "ISOlat2", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u0178", "\"", ",", "\"", "&", "Yuml", ";", "\")", ";", "/", "/", "-", "-", "latin", "capital", "letter", "Y", "with", "diaeresis", ",", "U", "+", "0178", "ISOlat2", "-", "->", "/", "/", "<", "!-", "-", "Spacing", "Modifier", "Letters", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u02C6", "\"", ",", "\"", "&", "circ", ";", "\")", ";", "/", "/", "-", "-", "modifier", "letter", "circumflex", "accent", ",", "U", "+", "02C6", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u02DC", "\"", ",", "\"", "&", "tilde", ";", "\")", ";", "/", "/", "small", "tilde", ",", "U", "+", "02DC", "ISOdia", "-", "->", "/", "/", "<", "!-", "-", "General", "Punctuation", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2002", "\"", ",", "\"", "&", "ensp", ";", "\")", ";", "/", "/", "en", "space", ",", "U", "+", "2002", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2003", "\"", ",", "\"", "&", "emsp", ";", "\")", ";", "/", "/", "em", "space", ",", "U", "+", "2003", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2009", "\"", ",", "\"", "&", "thinsp", ";", "\")", ";", "/", "/", "thin", "space", ",", "U", "+", "2009", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u200C", "\"", ",", "\"", "&", "zwnj", ";", "\")", ";", "/", "/", "zero", "width", "non", "-", "joiner", ",", "U", "+", "200C", "NEW", "RFC", "2070", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u200D", "\"", ",", "\"", "&", "zwj", ";", "\")", ";", "/", "/", "zero", "width", "joiner", ",", "U", "+", "200D", "NEW", "RFC", "2070", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u200E", "\"", ",", "\"", "&", "lrm", ";", "\")", ";", "/", "/", "left", "-", "to", "-", "right", "mark", ",", "U", "+", "200E", "NEW", "RFC", "2070", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u200F", "\"", ",", "\"", "&", "rlm", ";", "\")", ";", "/", "/", "right", "-", "to", "-", "left", "mark", ",", "U", "+", "200F", "NEW", "RFC", "2070", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2013", "\"", ",", "\"", "&", "ndash", ";", "\")", ";", "/", "/", "en", "dash", ",", "U", "+", "2013", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2014", "\"", ",", "\"", "&", "mdash", ";", "\")", ";", "/", "/", "em", "dash", ",", "U", "+", "2014", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2018", "\"", ",", "\"", "&", "lsquo", ";", "\")", ";", "/", "/", "left", "single", "quotation", "mark", ",", "U", "+", "2018", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2019", "\"", ",", "\"", "&", "rsquo", ";", "\")", ";", "/", "/", "right", "single", "quotation", "mark", ",", "U", "+", "2019", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u201A", "\"", ",", "\"", "&", "sbquo", ";", "\")", ";", "/", "/", "single", "low", "-", "9", "quotation", "mark", ",", "U", "+", "201A", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u201C", "\"", ",", "\"", "&", "ldquo", ";", "\")", ";", "/", "/", "left", "double", "quotation", "mark", ",", "U", "+", "201C", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u201D", "\"", ",", "\"", "&", "rdquo", ";", "\")", ";", "/", "/", "right", "double", "quotation", "mark", ",", "U", "+", "201D", "ISOnum", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u201E", "\"", ",", "\"", "&", "bdquo", ";", "\")", ";", "/", "/", "double", "low", "-", "9", "quotation", "mark", ",", "U", "+", "201E", "NEW", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2020", "\"", ",", "\"", "&", "dagger", ";", "\")", ";", "/", "/", "dagger", ",", "U", "+", "2020", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2021", "\"", ",", "\"", "&", "Dagger", ";", "\")", ";", "/", "/", "double", "dagger", ",", "U", "+", "2021", "ISOpub", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2030", "\"", ",", "\"", "&", "permil", ";", "\")", ";", "/", "/", "per", "mille", "sign", ",", "U", "+", "2030", "ISOtech", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u2039", "\"", ",", "\"", "&", "lsaquo", ";", "\")", ";", "/", "/", "single", "left", "-", "pointing", "angle", "quotation", "mark", ",", "U", "+", "2039", "ISO", "proposed", "-", "->", "/", "/", "<", "!-", "-", "lsaquo", "is", "proposed", "but", "not", "yet", "ISO", "standardized", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u203A", "\"", ",", "\"", "&", "rsaquo", ";", "\")", ";", "/", "/", "single", "right", "-", "pointing", "angle", "quotation", "mark", ",", "U", "+", "203A", "ISO", "proposed", "-", "->", "/", "/", "<", "!-", "-", "rsaquo", "is", "proposed", "but", "not", "yet", "ISO", "standardized", "-", "->", "initialMap", ".", "put", "(", "\"\\", "u20AC", "\"", ",", "\"", "&", "euro", ";", "\")", ";", "/", "/", "-", "-", "euro", "sign", ",", "U", "+", "20AC", "NEW", "-", "->", "HTML40_EXTENDED_ESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "initialMap", ")", ";", "}", "/", "**", "*", "Reverse", "of", "{", "@", "link", "#", "HTML40_EXTENDED_ESCAPE", "}", "for", "unescaping", "purposes", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "HTML40_EXTENDED_UNESCAPE", ";", "static", "{", "HTML40_EXTENDED_UNESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "invert", "(", "HTML40_EXTENDED_ESCAPE", ")", ");", "}", "/", "**", "*", "A", "Map", "&", "lt", ";", "CharSequence", ",", "CharSequence", "&", "gt", ";", "to", "escape", "the", "basic", "XML", "and", "HTML", "*", "character", "entities", ".", "*", "*", "Namely", ":", "{", "@", "code", "\"", "&", "<", ">", "}", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "BASIC_ESCAPE", ";", "static", "{", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "initialMap", "=", "new", "HashMap", "<", ">(", ");", "initialMap", ".", "put", "(", "\"\\", "\"\"", ",", "\"", "&", "quot", ";", "\")", ";", "/", "/", "\"", "-", "double", "-", "quote", "initialMap", ".", "put", "(", "\"&", "\",", "\"", "&", "amp", ";", "\")", ";", "/", "/", "&", "-", "ampersand", "initialMap", ".", "put", "(", "\"<", "\",", "\"", "&", "lt", ";", "\")", ";", "/", "/", "<", "-", "less", "-", "than", "initialMap", ".", "put", "(", "\">", "\",", "\"", "&", "gt", ";", "\")", ";", "/", "/", ">", "-", "greater", "-", "than", "BASIC_ESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "initialMap", ")", ";", "}", "/", "**", "*", "Reverse", "of", "{", "@", "link", "#", "BASIC_ESCAPE", "}", "for", "unescaping", "purposes", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "BASIC_UNESCAPE", ";", "static", "{", "BASIC_UNESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "invert", "(", "BASIC_ESCAPE", ")", ");", "}", "/", "**", "*", "A", "Map", "&", "lt", ";", "CharSequence", ",", "CharSequence", "&", "gt", ";", "to", "escape", "the", "apostrophe", "character", "to", "*", "its", "XML", "character", "entity", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "APOS_ESCAPE", ";", "static", "{", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "initialMap", "=", "new", "HashMap", "<", ">(", ");", "initialMap", ".", "put", "(", "\"'", "\",", "\"", "&", "apos", ";", "\")", ";", "/", "/", "XML", "apostrophe", "APOS_ESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "initialMap", ")", ";", "}", "/", "**", "*", "Reverse", "of", "{", "@", "link", "#", "APOS_ESCAPE", "}", "for", "unescaping", "purposes", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "APOS_UNESCAPE", ";", "static", "{", "APOS_UNESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "invert", "(", "APOS_ESCAPE", ")", ");", "}", "/", "**", "*", "A", "Map", "&", "lt", ";", "CharSequence", ",", "CharSequence", "&", "gt", ";", "to", "escape", "the", "Java", "*", "control", "characters", ".", "*", "*", "Namely", ":", "{", "@", "code", "\\", "b", "\\", "n", "\\", "t", "\\", "f", "\\", "r", "}", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "JAVA_CTRL_CHARS_ESCAPE", ";", "static", "{", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "initialMap", "=", "new", "HashMap", "<", ">(", ");", "initialMap", ".", "put", "(", "\"\\", "b", "\"", ",", "\"", "\\\\", "b", "\"", ");", "initialMap", ".", "put", "(", "\"\\", "n", "\"", ",", "\"", "\\\\", "n", "\"", ");", "initialMap", ".", "put", "(", "\"\\", "t", "\"", ",", "\"", "\\\\", "t", "\"", ");", "initialMap", ".", "put", "(", "\"\\", "f", "\"", ",", "\"", "\\\\", "f", "\"", ");", "initialMap", ".", "put", "(", "\"\\", "r", "\"", ",", "\"", "\\\\", "r", "\"", ");", "JAVA_CTRL_CHARS_ESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "initialMap", ")", ";", "}", "/", "**", "*", "Reverse", "of", "{", "@", "link", "#", "JAVA_CTRL_CHARS_ESCAPE", "}", "for", "unescaping", "purposes", ".", "*", "/", "public", "static", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "JAVA_CTRL_CHARS_UNESCAPE", ";", "static", "{", "JAVA_CTRL_CHARS_UNESCAPE", "=", "Collections", ".", "unmodifiableMap", "(", "invert", "(", "JAVA_CTRL_CHARS_ESCAPE", ")", ");", "}", "private", "EntityArrays", "(", ")", "{", "/", "/", "complete", "}", "/", "**", "*", "Used", "to", "invert", "an", "escape", "Map", "into", "an", "unescape", "Map", ".", "*", "@", "param", "map", "Map", "&", "lt", ";", "String", ",", "String", "&", "gt", ";", "to", "be", "inverted", "*", "@", "return", "Map", "&", "lt", ";", "String", ",", "String", "&", "gt", ";", "inverted", "array", "*", "/", "public", "static", "Map", "<", "CharSequence", ",", "CharSequence", ">", "invert", "(", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "map", ")", "{", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "newMap", "=", "new", "HashMap", "<", ">(", ");", "for", "(", "final", "Map", ".", "Entry", "<", "CharSequence", ",", "CharSequence", ">", "pair", ":", "map", ".", "entrySet", "(", "))", "{", "newMap", ".", "put", "(", "pair", ".", "getValue", "(", "),", "pair", ".", "getKey", "(", "))", ";", "}", "return", "newMap", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "103", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "java", ".", "security", ".", "InvalidParameterException", ";", "import", "java", ".", "util", ".", "BitSet", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "Translates", "a", "value", "using", "a", "lookup", "table", ".", "*", "*", "@", "since", "1", ".", "0", "*", "/", "class", "LookupTranslator", "extends", "CharSequenceTranslator", "{", "/", "**", "The", "mapping", "to", "be", "used", "in", "translation", ".", "*", "/", "private", "final", "Map", "<", "String", ",", "String", ">", "lookupMap", ";", "/", "**", "The", "first", "character", "of", "each", "key", "in", "the", "lookupMap", ".", "*", "/", "private", "final", "BitSet", "prefixSet", ";", "/", "**", "The", "length", "of", "the", "shortest", "key", "in", "the", "lookupMap", ".", "*", "/", "private", "final", "int", "shortest", ";", "/", "**", "The", "length", "of", "the", "longest", "key", "in", "the", "lookupMap", ".", "*", "/", "private", "final", "int", "longest", ";", "/", "**", "*", "Define", "the", "lookup", "table", "to", "be", "used", "in", "translation", "*", "*", "Note", "that", ",", "as", "of", "Lang", "3", ".", "1", "(", "the", "origin", "of", "this", "code", ")", ",", "the", "key", "to", "the", "lookup", "*", "table", "is", "converted", "to", "a", "java", ".", "lang", ".", "String", ".", "This", "is", "because", "we", "need", "the", "key", "*", "to", "support", "hashCode", "and", "equals", "(", "Object", ")", ",", "allowing", "it", "to", "be", "the", "key", "for", "a", "*", "HashMap", ".", "See", "LANG", "-", "882", ".", "*", "*", "@", "param", "lookupMap", "Map", "&", "lt", ";", "CharSequence", ",", "CharSequence", "&", "gt", ";", "table", "of", "translator", "*", "mappings", "*", "/", "LookupTranslator", "(", "final", "Map", "<", "CharSequence", ",", "CharSequence", ">", "lookupMap", ")", "{", "if", "(", "lookupMap", "=", "=", "null", ")", "{", "throw", "new", "InvalidParameterException", "(", "\"", "lookupMap", "cannot", "be", "null", "\"", ");", "}", "this", ".", "lookupMap", "=", "new", "HashMap", "<", ">(", ");", "this", ".", "prefixSet", "=", "new", "BitSet", "(", ");", "int", "currentShortest", "=", "Integer", ".", "MAX_VALUE", ";", "int", "currentLongest", "=", "0", ";", "for", "(", "final", "Map", ".", "Entry", "<", "CharSequence", ",", "CharSequence", ">", "pair", ":", "lookupMap", ".", "entrySet", "(", "))", "{", "this", ".", "lookupMap", ".", "put", "(", "pair", ".", "getKey", "(", ").", "toString", "(", "),", "pair", ".", "getValue", "(", ").", "toString", "(", "))", ";", "this", ".", "prefixSet", ".", "set", "(", "pair", ".", "getKey", "(", ").", "charAt", "(", "0", ")", ");", "final", "int", "sz", "=", "pair", ".", "getKey", "(", ").", "length", "(", ");", "if", "(", "sz", "<", "currentShortest", ")", "{", "currentShortest", "=", "sz", ";", "}", "if", "(", "sz", ">", "currentLongest", ")", "{", "currentLongest", "=", "sz", ";", "}", "}", "this", ".", "shortest", "=", "currentShortest", ";", "this", ".", "longest", "=", "currentLongest", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "int", "translate", "(", "final", "CharSequence", "input", ",", "final", "int", "index", ",", "final", "Writer", "out", ")", "throws", "IOException", "{", "/", "/", "check", "if", "translation", "exists", "for", "the", "input", "at", "position", "index", "if", "(", "prefixSet", ".", "get", "(", "input", ".", "charAt", "(", "index", ")", "))", "{", "int", "max", "=", "longest", ";", "if", "(", "index", "+", "longest", ">", "input", ".", "length", "(", "))", "{", "max", "=", "input", ".", "length", "(", ")", "-", "index", ";", "}", "/", "/", "implement", "greedy", "algorithm", "by", "trying", "maximum", "match", "first", "for", "(", "int", "i", "=", "max", ";", "i", ">", "=", "shortest", ";", "i", "-", "-)", "{", "final", "CharSequence", "subSeq", "=", "input", ".", "subSequence", "(", "index", ",", "index", "+", "i", ")", ";", "final", "String", "result", "=", "lookupMap", ".", "get", "(", "subSeq", ".", "toString", "(", "))", ";", "if", "(", "result", "!", "=", "null", ")", "{", "out", ".", "write", "(", "result", ")", ";", "return", "i", ";", "}", "}", "}", "return", "0", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "87", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ";", "/", "**", "*", "<", "p", ">", "Escapes", "and", "unescapes", "{", "@", "code", "String", "}", "s", "for", "*", "Java", ",", "Java", "Script", ",", "HTML", "and", "XML", ".", "</", "p", ">", "*", "*", "<", "p", ">", "#", "ThreadSafe", "#", "</", "p", ">", "*", "*", "*", "<", "p", ">", "*", "This", "code", "has", "been", "adapted", "from", "Apache", "Commons", "Lang", "3", ".", "5", ".", "*", "<", "/", "p", ">", "*", "*", "@", "since", "1", ".", "0", "*", "/", "public", "final", "class", "StringEscapeUtils", "{", "/", "*", "ESCAPE", "TRANSLATORS", "*", "/", "/", "**", "*", "Translator", "object", "for", "escaping", "HTML", "version", "4", ".", "0", ".", "*", "*", "While", "{", "@", "link", "#", "escapeHtml4", "(", "String", ")", "}", "is", "the", "expected", "method", "of", "use", ",", "this", "*", "object", "allows", "the", "HTML", "escaping", "functionality", "to", "be", "used", "*", "as", "the", "foundation", "for", "a", "custom", "translator", ".", "*", "/", "public", "static", "final", "CharSequenceTranslator", "ESCAPE_HTML4", "=", "new", "AggregateTranslator", "(", "new", "LookupTranslator", "(", "EntityArrays", ".", "BASIC_ESCAPE", ")", ",", "new", "LookupTranslator", "(", "EntityArrays", ".", "ISO8859_1_ESCAPE", ")", ",", "new", "LookupTranslator", "(", "EntityArrays", ".", "HTML40_EXTENDED_ESCAPE", ")", ")", ";", "private", "StringEscapeUtils", "(", ")", "{", "/", "/", "complete", "}", "/", "/", "HTML", "and", "XML", "/", "/-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "/", "**", "*", "<", "p", ">", "Escapes", "the", "characters", "in", "a", "{", "@", "code", "String", "}", "using", "HTML", "entities", ".", "</", "p", ">", "*", "*", "<", "p", ">", "*", "For", "example", ":", "*", "<", "/", "p", ">", "*", "<", "p", ">", "{@", "code", "\"", "bread", "\"", "&", "amp", ";", "\"", "butter", "\"", "}<", "/", "p", ">", "*", "becomes", ":", "*", "<", "p", ">", "*", "{", "@", "code", "&", "amp", ";", "quot", ";", "bread", "&", "amp", ";", "quot", ";", "&", "amp", ";", "amp", ";", "&", "amp", ";", "quot", ";", "butter", "&", "amp", ";", "quot", ";", "}.", "*", "<", "/", "p", ">", "*", "*", "<", "p", ">", "Supports", "all", "known", "HTML", "4", ".", "0", "entities", ",", "including", "funky", "accents", ".", "*", "Note", "that", "the", "commonly", "used", "apostrophe", "escape", "character", "(", "&", "amp", ";", "apos", ";", ")", "*", "is", "not", "a", "legal", "entity", "and", "so", "is", "not", "supported", ")", ".", "<", "/", "p", ">", "*", "*", "@", "param", "input", "the", "{", "@", "code", "String", "}", "to", "escape", ",", "may", "be", "null", "*", "@", "return", "a", "new", "escaped", "{", "@", "code", "String", "}", ",", "{", "@", "code", "null", "}", "if", "null", "string", "input", "*", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "hotwired", ".", "lycos", ".", "com", "/", "webmonkey", "/", "reference", "/", "special_characters", "/", "\">", "ISO", "Entities", "<", "/", "a", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "REC", "-", "html32", "#", "latin1", "\"", ">", "HTML", "3", ".", "2", "Character", "Entities", "for", "ISO", "Latin", "-", "1", "<", "/", "a", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "REC", "-", "html40", "/", "sgml", "/", "entities", ".", "html", "\"", ">", "HTML", "4", ".", "0", "Character", "entity", "references", "<", "/", "a", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "html401", "/", "charset", ".", "html", "#", "h", "-", "5", ".", "3", "\"", ">", "HTML", "4", ".", "01", "Character", "References", "<", "/", "a", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "html401", "/", "charset", ".", "html", "#", "code", "-", "position", "\"", ">", "HTML", "4", ".", "01", "Code", "positions", "<", "/", "a", ">", "*", "/", "public", "static", "String", "escapeHtml4", "(", "final", "String", "input", ")", "{", "return", "ESCAPE_HTML4", ".", "translate", "(", "input", ")", ";", "}", "}", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "CastUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "service", ".", "model", ".", "OperationInfo", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "AbstractDestination", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ".", "StringEscapeUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "http", ".", "AbstractHTTPDestination", ";", "public", "class", "FormattedServiceListWriter", "implements", "ServiceListWriter", "{", "@", "@", "-", "118", ",", "7", "+", "119", ",", "7", "@", "@", "private", "void", "writerSoapEndpoint", "(", "PrintWriter", "writer", ",", "writer", ".", "write", "(", "\"<", "/", "ul", ">", "\")", ";", "writer", ".", "write", "(", "\"<", "/", "td", ">", "<", "td", ">", "\")", ";", "absoluteURL", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "absoluteURL", ")", ";", "writer", ".", "write", "(", "\"<", "span", "class", "=", "\\\"", "field", "\\", "\">", "Endpoint", "address", ":", "</", "span", ">", "\"", "+", "\"", "<", "span", "class", "=", "\\\"", "value", "\\", "\">", "\"", "+", "absoluteURL", "+", "\"", "</", "span", ">", "\")", ";", "writer", ".", "write", "(", "\"<", "br", "/", "><", "span", "class", "=", "\\\"", "field", "\\", "\">", "WSDL", ":", "</", "span", ">", "\"", "+", "\"", "<", "a", "href", "=", "\\\"", "\"", "+", "absoluteURL", "@", "@", "-", "169", ",", "16", "+", "170", ",", "17", "@", "@", "private", "void", "writeRESTfulEndpoint", "(", "PrintWriter", "writer", ",", "if", "(", "absoluteURL", "=", "=", "null", ")", "{", "return", ";", "}", "absoluteURL", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "absoluteURL", ")", ";", "writer", ".", "write", "(", "\"<", "tr", ">", "<", "td", ">", "\")", ";", "writer", ".", "write", "(", "\"<", "span", "class", "=", "\\\"", "field", "\\", "\">", "Endpoint", "address", ":", "</", "span", ">", "\"", "+", "\"", "<", "span", "class", "=", "\\\"", "value", "\\", "\">", "\"", "+", "absoluteURL", "+", "\"", "</", "span", ">", "\")", ";", "Bus", "sb", "=", "bus", ";", "if", "(", "sd", "instanceof", "AbstractHTTPDestination", ")", "{", "sb", "=", "(", "(", "AbstractHTTPDestination", ")", "sd", ")", ".", "getBus", "(", ");", "}", "}", "addWadlIfNeeded", "(", "absoluteURL", ",", "sb", ",", "writer", ")", ";", "addOpenApiIfNeeded", "(", "absoluteURL", ",", "sb", ",", "writer", ")", ";", "addSwaggerIfNeeded", "(", "absoluteURL", ",", "sb", ",", "writer", ")", ";", "@", "@", "-", "205", ",", "7", "+", "207", ",", "7", "@", "@", "private", "static", "void", "addOpenApiIfNeeded", "(", "String", "absoluteURL", ",", "Bus", "sb", ",", "PrintWriter", "w", "}", "}", "private", "static", "void", "writeApiSpec", "(", "String", "absoluteURL", ",", "Bus", "sb", ",", "PrintWriter", "writer", ",", "private", "static", "void", "writeApiSpec", "(", "String", "absoluteURL", ",", "Bus", "sb", ",", "PrintWriter", "writer", ",", "String", "specPath", ",", "String", "specName", ")", "{", "if", "(", "PropertyUtils", ".", "isTrue", "(", "sb", ".", "getProperty", "(", "\"", "swagger", ".", "service", ".", "ui", ".", "available", "\"", "))", ")", "{", "URI", "uri", "=", "URI", ".", "create", "(", "absoluteURL", ")", ";", "@", "@", "-", "220", ",", "13", "+", "222", ",", "15", "@", "@", "private", "static", "void", "writeApiSpec", "(", "String", "absoluteURL", ",", "Bus", "sb", ",", "PrintWriter", "writer", ",", "if", "(", "!", "absoluteURL", ".", "endsWith", "(", "\"/", "\")", ")", "{", "specPath", "=", "\"", "/\"", "+", "specPath", ";", "}", "specPath", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "specPath", ")", ";", "writer", ".", "write", "(", "\"<", "br", "/", "><", "span", "class", "=", "\\\"", "field", "\\", "\">", "\"", "+", "specName", "+", "\"", ":", "</", "span", ">", "\"", "+", "\"", "<", "a", "href", "=", "\\\"", "\"", "+", "absoluteURL", "+", "specPath", "+", "\"", "\\\"", ">\"", "+", "absoluteURL", "+", "specPath", "+", "\"", "</", "a", ">", "\")", ";", "}", "private", "static", "void", "addAtomLinkIfNeeded", "(", "String", "address", ",", "Map", "<", "String", ",", "String", ">", "extMap", ",", "PrintWriter", "pw", ")", "{", "String", "atomAddress", "=", "getExtensionEndpointAddress", "(", "address", ",", "extMap", ")", ";", "if", "(", "atomAddress", "!", "=", "null", ")", "{", "atomAddress", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "atomAddress", ")", ";", "pw", ".", "write", "(", "\"<", "br", "/", "><", "span", "class", "=", "\\\"", "field", "\\", "\">", "Atom", "Log", "Feed", ":", "</", "span", ">", "\"", "+", "\"", "<", "a", "href", "=", "\\\"", "\"", "+", "atomAddress", "+", "\"", "\\\"", ">\"", "+", "atomAddress", "+", "\"", "</", "a", ">", "\")", ";", "}", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "cxf", ".", "Bus", ";", "import", "org", ".", "apache", ".", "cxf", ".", "common", ".", "util", ".", "PropertyUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "AbstractDestination", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "commons_text", ".", "StringEscapeUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "servlet", ".", "ServletDestination", ";", "public", "class", "UnformattedServiceListWriter", "implements", "ServiceListWriter", "{", "@", "@", "-", "59", ",", "6", "+", "60", ",", "8", "@", "@", "private", "void", "writeUnformattedSOAPEndpoints", "(", "PrintWriter", "writer", ",", "AbstractDestination", "[", "]", "destinations", ")", "throws", "IOException", "{", "for", "(", "AbstractDestination", "sd", ":", "destinations", ")", "{", "String", "address", "=", "getAbsoluteAddress", "(", "baseAddress", ",", "sd", ")", ";", "address", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "address", ")", ";", "writer", ".", "write", "(", "address", ")", ";", "if", "(", "renderWsdlList", ")", "{", "@", "@", "-", "74", ",", "6", "+", "77", ",", "8", "@", "@", "private", "void", "writeUnformattedRESTfulEndpoints", "(", "PrintWriter", "writer", ",", "AbstractDestination", "[", "]", "destinations", ")", "throws", "IOException", "{", "for", "(", "AbstractDestination", "sd", ":", "destinations", ")", "{", "String", "address", "=", "getAbsoluteAddress", "(", "baseAddress", ",", "sd", ")", ";", "address", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "address", ")", ";", "boolean", "wadlAvailable", "=", "bus", "!", "=", "null", "&", "&", "PropertyUtils", ".", "isTrue", "(", "bus", ".", "getProperty", "(", "\"", "wadl", ".", "service", ".", "descrition", ".", "available", "\"", "))", ";", "boolean", "swaggerAvailable", "=", "bus", "!", "=", "null", "@", "@", "-", "0", ",", "0", "+", "1", ",", "42", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "jaxrs", ";", "public", "class", "BookServerServiceListing", "extends", "AbstractSpringServer", "{", "public", "static", "final", "String", "PORT", "=", "allocatePort", "(", "BookServerServiceListing", ".", "class", ")", ";", "public", "BookServerServiceListing", "(", ")", "{", "super", "(", "\"/", "service_listing", "\"", ",", "\"", "/", "service_listing", "\"", ",", "Integer", ".", "parseInt", "(", "PORT", ")", ");", "}", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "{", "try", "{", "BookServerServiceListing", "s", "=", "new", "BookServerServiceListing", "(", ");", "s", ".", "start", "(", ");", "}", "catch", "(", "Exception", "ex", ")", "{", "ex", ".", "printStackTrace", "(", ");", "System", ".", "exit", "(", "-", "1", ")", ";", "}", "finally", "{", "System", ".", "out", ".", "println", "(", "\"", "done", "!", "\")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "101", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "jaxrs", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "jaxrs", ".", "model", ".", "AbstractResourceInfo", ";", "import", "org", ".", "apache", ".", "cxf", ".", "testutil", ".", "common", ".", "AbstractBusClientServerTestBase", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "public", "class", "JAXRSServicesListingTest", "extends", "AbstractBusClientServerTestBase", "{", "public", "static", "final", "String", "PORT", "=", "BookServerServiceListing", ".", "PORT", ";", "@", "BeforeClass", "public", "static", "void", "startServers", "(", ")", "throws", "Exception", "{", "AbstractResourceInfo", ".", "clearAllMaps", "(", ");", "assertTrue", "(", "\"", "server", "did", "not", "launch", "correctly", "\"", ",", "launchServer", "(", "BookServerServiceListing", ".", "class", ",", "true", ")", ");", "createStaticBus", "(", ");", "}", "@", "Test", "public", "void", "testServiceListing", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "\"", ";", "String", "expectedResult", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "resources", "\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertTrue", "(", "result", ".", "contains", "(", "expectedResult", ")", ");", "}", "}", "@", "Test", "public", "void", "testServiceListingUnformatted", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "?", "formatted", "=", "false", "\"", ";", "String", "expectedResult", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "resources", "\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertTrue", "(", "result", ".", "contains", "(", "expectedResult", ")", ");", "}", "}", "@", "Test", "public", "void", "testEscapeHTML", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "<", "script", ">", "alert", "(", "1", ")", "</", "script", ">", "/.", "./", "..", "/\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertFalse", "(", "result", ".", "contains", "(", "\"<", "script", ">", "\")", ");", "}", "}", "@", "Test", "public", "void", "testEscapeHTMLUnformatted", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "<", "script", ">", "alert", "(", "1", ")", "</", "script", ">", "/.", "./", "..", "/?", "formatted", "=", "false", "\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertFalse", "(", "result", ".", "contains", "(", "\"<", "script", ">", "\")", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "beans", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xmlns", ":", "jaxrs", "=", "\"", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "jaxrs", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "/", "spring", "-", "beans", ".", "xsd", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "jaxrs", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "schemas", "/", "jaxrs", ".", "xsd", "\"", ">", "<", "import", "resource", "=", "\"", "classpath", ":", "/", "META", "-", "INF", "/", "cxf", "/", "cxf", ".", "xml", "\"", "/>", "<", "jaxrs", ":", "server", "id", "=", "\"", "bookservice", "\"", "address", "=", "\"/", "resources", "\"", ">", "<", "jaxrs", ":", "serviceBeans", ">", "<", "ref", "bean", "=", "\"", "servletconfigstore", "\"", "/>", "<", "/", "jaxrs", ":", "serviceBeans", ">", "<", "/", "jaxrs", ":", "server", ">", "<", "bean", "id", "=", "\"", "servletconfigstore", "\"", "class", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "jaxrs", ".", "SpringServletConfigStore", "\"", "/>", "<", "/", "beans", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "46", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "!-", "-", "START", "SNIPPET", ":", "webxml", "-", "->", "<", "web", "-", "app", "xmlns", "=", "\"", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "version", "=", "\"", "2", ".", "5", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "/", "web", "-", "app_2_5", ".", "xsd", "\"", ">", "<", "display", "-", "name", ">", "cxf", "<", "/", "display", "-", "name", ">", "<", "context", "-", "param", ">", "<", "param", "-", "name", ">", "contextConfigLocation", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "WEB", "-", "INF", "/", "beans", ".", "xml", "<", "/", "param", "-", "value", ">", "<", "/", "context", "-", "param", ">", "<", "listener", ">", "<", "listener", "-", "class", ">", "org", ".", "springframework", ".", "web", ".", "context", ".", "ContextLoaderListener", "<", "/", "listener", "-", "class", ">", "<", "/", "listener", ">", "<", "servlet", ">", "<", "description", ">", "Apache", "CXF", "Endpoint", "<", "/", "description", ">", "<", "display", "-", "name", ">", "cxf", "<", "/", "display", "-", "name", ">", "<", "servlet", "-", "name", ">", "cxf", "<", "/", "servlet", "-", "name", ">", "<", "servlet", "-", "class", ">", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "servlet", ".", "CXFServlet", "<", "/", "servlet", "-", "class", ">", "<", "load", "-", "on", "-", "startup", ">", "1", "<", "/", "load", "-", "on", "-", "startup", ">", "<", "/", "servlet", ">", "<", "servlet", "-", "mapping", ">", "<", "servlet", "-", "name", ">", "cxf", "<", "/", "servlet", "-", "name", ">", "<", "url", "-", "pattern", ">", "/", "services", "/", "*<", "/", "url", "-", "pattern", ">", "<", "/", "servlet", "-", "mapping", ">", "<", "session", "-", "config", ">", "<", "session", "-", "timeout", ">", "60", "<", "/", "session", "-", "timeout", ">", "<", "/", "session", "-", "config", ">", "<", "/", "web", "-", "app", ">", "<", "!-", "-", "END", "SNIPPET", ":", "webxml", "-", "->", "@", "@", "-", "193", ",", "11", "+", "193", ",", "21", "@", "@", "<", "artifactId", ">", "spring", "-", "context", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "springframework", "<", "/", "groupId", ">", "<", "artifactId", ">", "spring", "-", "web", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "eclipse", ".", "jetty", "<", "/", "groupId", ">", "<", "artifactId", ">", "jetty", "-", "webapp", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "profiles", ">", "<", "profile", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "74", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ";", "import", "org", ".", "apache", ".", "cxf", ".", "testutil", ".", "common", ".", "AbstractBusTestServerBase", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "handler", ".", "DefaultHandler", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "handler", ".", "HandlerCollection", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "resource", ".", "Resource", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "webapp", ".", "WebAppContext", ";", "public", "abstract", "class", "AbstractSpringServer", "extends", "AbstractBusTestServerBase", "{", "private", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Server", "server", ";", "private", "String", "resourcePath", ";", "private", "String", "contextPath", ";", "private", "int", "port", ";", "protected", "AbstractSpringServer", "(", "String", "path", ",", "int", "portNumber", ")", "{", "this", "(", "path", ",", "\"", "/\"", ",", "portNumber", ")", ";", "}", "protected", "AbstractSpringServer", "(", "String", "path", ",", "String", "cPath", ",", "int", "portNumber", ")", "{", "resourcePath", "=", "path", ";", "contextPath", "=", "cPath", ";", "port", "=", "portNumber", ";", "}", "protected", "void", "run", "(", ")", "{", "server", "=", "new", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Server", "(", "port", ")", ";", "WebAppContext", "webappcontext", "=", "new", "WebAppContext", "(", ");", "webappcontext", ".", "setContextPath", "(", "contextPath", ")", ";", "webappcontext", ".", "setBaseResource", "(", "Resource", ".", "newClassPathResource", "(", "resourcePath", ")", ");", "server", ".", "setHandler", "(", "new", "HandlerCollection", "(", "webappcontext", ",", "new", "DefaultHandler", "(", "))", ");", "try", "{", "configureServer", "(", "server", ")", ";", "server", ".", "start", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "}", "}", "protected", "void", "configureServer", "(", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Server", "theserver", ")", "throws", "Exception", "{", "}", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "super", ".", "tearDown", "(", ");", "if", "(", "server", "!", "=", "null", ")", "{", "server", ".", "stop", "(", ");", "server", ".", "destroy", "(", ");", "server", "=", "null", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "44", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "servicelisting", ";", "import", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "AbstractSpringServer", ";", "public", "class", "GreeterServiceListing", "extends", "AbstractSpringServer", "{", "public", "static", "final", "String", "PORT", "=", "allocatePort", "(", "GreeterServiceListing", ".", "class", ")", ";", "public", "GreeterServiceListing", "(", ")", "{", "super", "(", "\"/", "service_listing", "\"", ",", "\"", "/", "service_listing", "\"", ",", "Integer", ".", "parseInt", "(", "PORT", ")", ");", "}", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "{", "try", "{", "GreeterServiceListing", "s", "=", "new", "GreeterServiceListing", "(", ");", "s", ".", "start", "(", ");", "}", "catch", "(", "Exception", "ex", ")", "{", "ex", ".", "printStackTrace", "(", ");", "System", ".", "exit", "(", "-", "1", ")", ";", "}", "finally", "{", "System", ".", "out", ".", "println", "(", "\"", "done", "!", "\")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "100", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "servicelisting", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "testutil", ".", "common", ".", "AbstractBusClientServerTestBase", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "public", "class", "JAXWSServicesListingTest", "extends", "AbstractBusClientServerTestBase", "{", "public", "static", "final", "String", "PORT", "=", "GreeterServiceListing", ".", "PORT", ";", "@", "BeforeClass", "public", "static", "void", "startServers", "(", ")", "throws", "Exception", "{", "assertTrue", "(", "\"", "server", "did", "not", "launch", "correctly", "\"", ",", "launchServer", "(", "GreeterServiceListing", ".", "class", ",", "true", ")", ");", "createStaticBus", "(", ");", "}", "@", "Test", "public", "void", "testServiceListing", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "\"", ";", "String", "expectedResult", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "SoapContext", "/", "GreeterPort", "\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertTrue", "(", "result", ".", "contains", "(", "expectedResult", ")", ");", "}", "}", "@", "Test", "public", "void", "testServiceListingUnformatted", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "?", "formatted", "=", "false", "\"", ";", "String", "expectedResult", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "SoapContext", "/", "GreeterPort", "\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertTrue", "(", "result", ".", "contains", "(", "expectedResult", ")", ");", "}", "}", "@", "Test", "public", "void", "testEscapeHTML", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "<", "script", ">", "alert", "(", "1", ")", "</", "script", ">", "/.", "./", "..", "/\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertFalse", "(", "result", ".", "contains", "(", "\"<", "script", ">", "\")", ");", "}", "}", "@", "Test", "public", "void", "testEscapeHTMLUnformatted", "(", ")", "throws", "Exception", "{", "String", "endpointAddress", "=", "\"", "http", ":", "//", "localhost", ":", "\"", "+", "PORT", "+", "\"", "/", "service_listing", "/", "services", "/", "<", "script", ">", "alert", "(", "1", ")", "</", "script", ">", "/.", "./", "..", "/?", "formatted", "=", "false", "\"", ";", "URL", "url", "=", "new", "URL", "(", "endpointAddress", ")", ";", "try", "(", "InputStream", "input", "=", "url", ".", "openStream", "(", "))", "{", "String", "result", "=", "IOUtils", ".", "readStringFromStream", "(", "input", ")", ";", "assertFalse", "(", "result", ".", "contains", "(", "\"<", "script", ">", "\")", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "36", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "beans", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "\"", "xmlns", ":", "jaxws", "=", "\"", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "jaxws", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xmlns", ":", "cxf", "=", "\"", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "core", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "/", "spring", "-", "beans", ".", "xsd", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "jaxws", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "schemas", "/", "jaxws", ".", "xsd", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "core", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "schemas", "/", "core", ".", "xsd", "\"", ">", "<", "cxf", ":", "bus", ">", "<", "cxf", ":", "features", ">", "<", "cxf", ":", "logging", "/", ">", "<", "/", "cxf", ":", "features", ">", "<", "/", "cxf", ":", "bus", ">", "<", "bean", "id", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "policy", ".", "PolicyEngine", "\"", "class", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "ws", ".", "policy", ".", "PolicyEngineImpl", "\"", ">", "<", "property", "name", "=", "\"", "bus", "\"", "ref", "=", "\"", "cxf", "\"", "/>", "<", "property", "name", "=", "\"", "enabled", "\"", "value", "=", "\"", "true", "\"", "/>", "<", "/", "bean", ">", "<", "jaxws", ":", "endpoint", "name", "=", "\"{", "http", ":", "//", "cxf", ".", "apache", ".", "org", "/", "greeter_control", "}", "GreeterPort", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "policy", ".", "GreeterImpl", "\"", "address", "=", "\"/", "SoapContext", "/", "GreeterPort", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "policy", "/", "http_server_greeter", ".", "wsdl", "\"", ">", "<", "/", "jaxws", ":", "endpoint", ">", "<", "/", "beans", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "46", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "!-", "-", "START", "SNIPPET", ":", "webxml", "-", "->", "<", "web", "-", "app", "xmlns", "=", "\"", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "version", "=", "\"", "2", ".", "5", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "/", "web", "-", "app_2_5", ".", "xsd", "\"", ">", "<", "display", "-", "name", ">", "cxf", "<", "/", "display", "-", "name", ">", "<", "context", "-", "param", ">", "<", "param", "-", "name", ">", "contextConfigLocation", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "WEB", "-", "INF", "/", "beans", ".", "xml", "<", "/", "param", "-", "value", ">", "<", "/", "context", "-", "param", ">", "<", "listener", ">", "<", "listener", "-", "class", ">", "org", ".", "springframework", ".", "web", ".", "context", ".", "ContextLoaderListener", "<", "/", "listener", "-", "class", ">", "<", "/", "listener", ">", "<", "servlet", ">", "<", "description", ">", "Apache", "CXF", "Endpoint", "<", "/", "description", ">", "<", "display", "-", "name", ">", "cxf", "<", "/", "display", "-", "name", ">", "<", "servlet", "-", "name", ">", "cxf", "<", "/", "servlet", "-", "name", ">", "<", "servlet", "-", "class", ">", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "servlet", ".", "CXFServlet", "<", "/", "servlet", "-", "class", ">", "<", "load", "-", "on", "-", "startup", ">", "1", "<", "/", "load", "-", "on", "-", "startup", ">", "<", "/", "servlet", ">", "<", "servlet", "-", "mapping", ">", "<", "servlet", "-", "name", ">", "cxf", "<", "/", "servlet", "-", "name", ">", "<", "url", "-", "pattern", ">", "/", "services", "/", "*<", "/", "url", "-", "pattern", ">", "<", "/", "servlet", "-", "mapping", ">", "<", "session", "-", "config", ">", "<", "session", "-", "timeout", ">", "60", "<", "/", "session", "-", "timeout", ">", "<", "/", "session", "-", "config", ">", "<", "/", "web", "-", "app", ">", "<", "!-", "-", "END", "SNIPPET", ":", "webxml", "-", "->"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["[IPV6]:", "Fix", "for", "ipv6_setsockopt", "NULL", "dereference", "I", "came", "across", "this", "bug", "in", "http://bugzilla.kernel.org/show_bug.cgi?id=8155", "Signed-off-by:", "Olaf", "Kirch", "<olaf.kirch@oracle.com>", "Acked-by:", "YOSHIFUJI", "Hideaki", "<yoshfuji@linux-ipv6.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "413", ",", "7", "+", "413", ",", "7", "@", "@", "static", "int", "do_ipv6_setsockopt", "(", "struct", "sock", "*", "sk", ",", "int", "level", ",", "int", "optname", ",", "}", "/", "*", "routing", "header", "option", "needs", "extra", "check", "*", "/", "if", "(", "optname", "=", "=", "IPV6_RTHDR", "&", "&", "opt", "-", ">", "srcrt", ")", "{", "if", "(", "optname", "=", "=", "IPV6_RTHDR", "&", "&", "opt", "&", "&", "opt", "-", ">", "srcrt", ")", "{", "struct", "ipv6_rt_hdr", "*", "rthdr", "=", "opt", "-", ">", "srcrt", ";", "switch", "(", "rthdr", "-", ">", "type", ")", "{", "case", "IPV6_SRCRT_TYPE_0", ":"], "docstring_tokens": ["a", "NULL", "pointer", "dereference", "and", "crash", "the", "system"]}
{"contents": ["[FG-VD-19-136]", "ImageMagick", "Convert", "SVG", "MacOS", "Denial", "Of", "Service"], "code_tokens": ["@", "@", "-", "65", ",", "9", "+", "65", ",", "10", "@", "@", "#", "include", "\"", "MagickCore", "/", "module", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "monitor", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "monitor", "-", "private", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "quantum", "-", "private", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "option", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "pixel", "-", "accessor", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "property", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "quantum", "-", "private", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "resource_", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "static", ".", "h", "\"", "#", "include", "\"", "MagickCore", "/", "string_", ".", "h", "\"", "@", "@", "-", "3579", ",", "9", "+", "3580", ",", "14", "@", "@", "static", "Image", "*", "ReadSVGImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "message", "[", "n", "]", "='", "\\", "0", "'", ";", "if", "(", "n", ">", "0", ")", "{", "const", "char", "*", "value", ";", "svg_info", "-", ">", "parser", "=", "xmlCreatePushParserCtxt", "(", "sax_handler", ",", "svg_info", ",", "(", "char", "*", ")", "message", ",", "n", ",", "image", "-", ">", "filename", ")", ";", "(", "void", ")", "xmlCtxtUseOptions", "(", "svg_info", "-", ">", "parser", ",", "XML_PARSE_HUGE", ")", ";", "value", "=", "GetImageOption", "(", "image_info", ",", "\"", "svg", ":", "xml", "-", "parse", "-", "huge", "\"", ");", "if", "(", "(", "value", "!", "=", "(", "char", "*", ")", "NULL", ")", "&", "&", "(", "IsStringTrue", "(", "value", ")", "!", "=", "MagickFalse", ")", ")", "(", "void", ")", "xmlCtxtUseOptions", "(", "svg_info", "-", ">", "parser", ",", "XML_PARSE_HUGE", ")", ";", "while", "(", "(", "n", "=", "ReadBlob", "(", "image", ",", "MagickPathExtent", "-", "1", ",", "message", ")", ")", "!", "=", "0", ")", "{", "message", "[", "n", "]", "='", "\\", "0", "'", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service"]}
{"contents": ["tun:", "call", "dev_get_valid_name()", "before", "register_netdevice()", "register_netdevice()", "could", "fail", "early", "when", "we", "have", "an", "invalid", "dev", "name,", "in", "which", "case", "->ndo_uninit()", "is", "not", "called.", "For", "tun", "device,", "this", "is", "a", "problem", "because", "a", "timer", "etc.", "are", "already", "initialized", "and", "it", "expects", "->ndo_uninit()", "to", "clean", "them", "up.", "We", "could", "move", "these", "initializations", "into", "a", "->ndo_init()", "so", "that", "register_netdevice()", "knows", "better,", "however", "this", "is", "still", "complicated", "due", "to", "the", "logic", "in", "tun_detach().", "Therefore,", "I", "choose", "to", "just", "call", "dev_get_valid_name()", "before", "register_netdevice(),", "which", "is", "quicker", "and", "much", "easier", "to", "audit.", "And", "for", "this", "specific", "case,", "it", "is", "already", "enough.", "Fixes:", "96442e42429e", "(\"tuntap:", "choose", "the", "txq", "based", "on", "rxq\")", "Reported-by:", "Dmitry", "Alexeev", "<avekceeb@gmail.com>", "Cc:", "Jason", "Wang", "<jasowang@redhat.com>", "Cc:", "\"Michael", "S.", "Tsirkin\"", "<mst@redhat.com>", "Signed-off-by:", "Cong", "Wang", "<xiyou.wangcong@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "2027", ",", "6", "+", "2027", ",", "9", "@", "@", "static", "int", "tun_set_iff", "(", "struct", "net", "*", "net", ",", "struct", "file", "*", "file", ",", "struct", "ifreq", "*", "ifr", ")", "if", "(", "!", "dev", ")", "return", "-", "ENOMEM", ";", "err", "=", "dev_get_valid_name", "(", "net", ",", "dev", ",", "name", ")", ";", "if", "(", "err", ")", "goto", "err_free_dev", ";", "dev_net_set", "(", "dev", ",", "net", ")", ";", "dev", "-", ">", "rtnl_link_ops", "=", "&", "tun_link_ops", ";", "@", "@", "-", "3694", ",", "6", "+", "3694", ",", "9", "@", "@", "struct", "net_device", "*", "alloc_netdev_mqs", "(", "int", "sizeof_priv", ",", "const", "char", "*", "name", ",", "unsigned", "char", "name_assign_type", ",", "void", "(", "*", "setup", ")", "(", "struct", "net_device", "*", "),", "unsigned", "int", "txqs", ",", "unsigned", "int", "rxqs", ")", ";", "int", "dev_get_valid_name", "(", "struct", "net", "*", "net", ",", "struct", "net_device", "*", "dev", ",", "const", "char", "*", "name", ")", ";", "#", "define", "alloc_netdev", "(", "sizeof_priv", ",", "name", ",", "name_assign_type", ",", "setup", ")", "\\", "alloc_netdev_mqs", "(", "sizeof_priv", ",", "name", ",", "name_assign_type", ",", "setup", ",", "1", ",", "1", ")", "@", "@", "-", "1147", ",", "9", "+", "1147", ",", "8", "@", "@", "static", "int", "dev_alloc_name_ns", "(", "struct", "net", "*", "net", ",", "return", "ret", ";", "}", "static", "int", "dev_get_valid_name", "(", "struct", "net", "*", "net", ",", "struct", "net_device", "*", "dev", ",", "const", "char", "*", "name", ")", "int", "dev_get_valid_name", "(", "struct", "net", "*", "net", ",", "struct", "net_device", "*", "dev", ",", "const", "char", "*", "name", ")", "{", "BUG_ON", "(", "!", "net", ")", ";", "@", "@", "-", "1165", ",", "6", "+", "1164", ",", "7", "@", "@", "static", "int", "dev_get_valid_name", "(", "struct", "net", "*", "net", ",", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "dev_get_valid_name", ")", ";", "/", "**", "*", "dev_change_name", "-", "change", "name", "of", "a", "device"], "docstring_tokens": ["a", "system", "panic"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/501"], "code_tokens": ["@", "@", "-", "393", ",", "7", "+", "393", ",", "7", "@", "@", "static", "Image", "*", "ReadJP2Image", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "(", "jp2_image", "-", ">", "comps", "[", "0", "]", ".", "dy", "!", "=", "jp2_image", "-", ">", "comps", "[", "i", "]", ".", "dy", ")", "|", "|", "(", "jp2_image", "-", ">", "comps", "[", "0", "]", ".", "prec", "!", "=", "jp2_image", "-", ">", "comps", "[", "i", "]", ".", "prec", ")", "|", "|", "(", "jp2_image", "-", ">", "comps", "[", "0", "]", ".", "sgnd", "!", "=", "jp2_image", "-", ">", "comps", "[", "i", "]", ".", "sgnd", ")", "|", "|", "(", "jp2_image", "-", ">", "comps", "[", "i", "]", ".", "data", "=", "=", "NULL", ")", ")", "(", "(", "image", "-", ">", "ping", "=", "=", "MagickFalse", ")", "&", "&", "(", "jp2_image", "-", ">", "comps", "[", "i", "]", ".", "data", "=", "=", "NULL", ")", "))", "{", "opj_destroy_codec", "(", "jp2_codec", ")", ";", "opj_image_destroy", "(", "jp2_image", ")", ";"], "docstring_tokens": ["the", "application", "to", "crash"]}
{"contents": ["SOLR-4881:", "Fix", "DocumentAnalysisRequestHandler", "to", "correctly", "use", "EmptyEntityResolver", "to", "prevent", "loading", "of", "external", "entities", "like", "UpdateRequestHandler", "does", "git-svn-id:", "https://svn.apache.org/repos/asf/lucene/dev/trunk@1487976", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "216", ",", "6", "+", "216", ",", "10", "@", "@", "Bug", "Fixes", "case", "for", "handling", "TermQuery", "to", "prevent", "NullPointerException", "if", "reader", "does", "not", "have", "fields", ".", "(", "Bao", "Yang", "Yang", ",", "Uwe", "Schindler", ")", "*", "SOLR", "-", "4881", ":", "Fix", "DocumentAnalysisRequestHandler", "to", "correctly", "use", "EmptyEntityResolver", "to", "prevent", "loading", "of", "external", "entities", "like", "UpdateRequestHandler", "does", ".", "(", "Hossman", ",", "Uwe", "Schindler", ")", "Other", "Changes", "@", "@", "-", "35", ",", "6", "+", "35", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "solr", ".", "schema", ".", "FieldType", ";", "import", "org", ".", "apache", ".", "solr", ".", "schema", ".", "IndexSchema", ";", "import", "org", ".", "apache", ".", "solr", ".", "schema", ".", "SchemaField", ";", "import", "org", ".", "apache", ".", "solr", ".", "util", ".", "EmptyEntityResolver", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "90", ",", "6", "+", "91", ",", "8", "@", "@", "public", "void", "init", "(", "NamedList", "args", ")", "{", "super", ".", "init", "(", "args", ")", ";", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "EmptyEntityResolver", ".", "configureXMLInputFactory", "(", "inputFactory", ")", ";", "inputFactory", ".", "setXMLReporter", "(", "xmllog", ")", ";", "try", "{", "/", "/", "The", "java", "1", ".", "6", "bundled", "stax", "parser", "(", "sjsxp", ")", "does", "not", "currently", "have", "a", "thread", "-", "safe", "/", "/", "XMLInputFactory", ",", "as", "that", "implementation", "tries", "to", "cache", "and", "reuse", "the", "@", "@", "-", "103", ",", "7", "+", "106", ",", "6", "@", "@", "public", "void", "init", "(", "NamedList", "args", ")", "{", "/", "/", "isimplementation", "specific", ".", "log", ".", "debug", "(", "\"", "Unable", "to", "set", "the", "'", "reuse", "-", "instance", "'", "property", "for", "the", "input", "factory", ":", "\"", "+", "inputFactory", ")", ";", "}", "inputFactory", ".", "setXMLReporter", "(", "xmllog", ")", ";", "}", "/", "**"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["Merge", "pull", "request", "#80", "from", "jenkinsci-cert/SECURITY-362", "[SECURITY-362]", "Do", "not", "persist", "User", "in", "OfflineCause.UserCause"], "code_tokens": ["@", "@", "-", "24", ",", "7", "+", "24", ",", "6", "@", "@", "package", "hudson", ".", "slaves", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "hudson", ".", "Functions", ";", "import", "hudson", ".", "model", ".", "Computer", ";", "import", "hudson", ".", "model", ".", "User", ";", "@", "@", "-", "33", ",", "7", "+", "32", ",", "10", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "ExportedBean", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Exported", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "java", ".", "io", ".", "ObjectStreamException", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "/", "**", "@", "@", "-", "128", ",", "21", "+", "130", ",", "49", "@", "@", "public", "String", "toString", "(", ")", "{", "/", "**", "*", "Taken", "offline", "by", "user", ".", "*", "*", "@", "since", "1", ".", "551", "*", "/", "public", "static", "class", "UserCause", "extends", "SimpleOfflineCause", "{", "private", "final", "User", "user", ";", "public", "UserCause", "(", "User", "user", ",", "String", "message", ")", "{", "super", "(", "hudson", ".", "slaves", ".", "Messages", ".", "_SlaveComputer_DisconnectedBy", "(", "user", "!", "=", "null", "?", "user", ".", "getId", "(", ")", ":", "Jenkins", ".", "ANONYMOUS", ".", "getName", "(", "),", "@", "Deprecated", "private", "transient", "User", "user", ";", "/", "/", "null", "when", "unknown", "private", "/", "*", "final", "*", "/", "@", "CheckForNull", "String", "userId", ";", "public", "UserCause", "(", "@", "CheckForNull", "User", "user", ",", "@", "CheckForNull", "String", "message", ")", "{", "this", "(", "user", "!", "=", "null", "?", "user", ".", "getId", "(", ")", ":", "null", ",", "message", "!", "=", "null", "?", "\"", ":", "\"", "+", "message", ":", "\"", "\"", ")", ");", "this", ".", "user", "=", "user", ";", ")", ";", "}", "private", "UserCause", "(", "String", "userId", ",", "String", "message", ")", "{", "super", "(", "hudson", ".", "slaves", ".", "Messages", ".", "_SlaveComputer_DisconnectedBy", "(", "userId", ",", "message", ")", ");", "this", ".", "userId", "=", "userId", ";", "}", "public", "User", "getUser", "(", ")", "{", "return", "user", ";", "return", "userId", "=", "=", "null", "?", "User", ".", "getUnknown", "(", ")", ":", "User", ".", "getById", "(", "userId", ",", "true", ")", ";", "}", "/", "/", "Storing", "the", "User", "in", "a", "filed", "was", "a", "mistake", ",", "switch", "to", "userId", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "private", "Object", "readResolve", "(", ")", "throws", "ObjectStreamException", "{", "if", "(", "user", "!", "=", "null", ")", "{", "String", "id", "=", "user", ".", "getId", "(", ");", "if", "(", "id", "!", "=", "null", ")", "{", "userId", "=", "id", ";", "}", "else", "{", "/", "/", "The", "user", "field", "is", "not", "properly", "deserialized", "so", "id", "may", "be", "missing", ".", "Look", "the", "user", "up", "by", "fullname", "User", "user", "=", "User", ".", "get", "(", "this", ".", "user", ".", "getFullName", "(", "),", "true", ",", "Collections", ".", "emptyMap", "(", "))", ";", "userId", "=", "user", ".", "getId", "(", ");", "}", "this", ".", "user", "=", "null", ";", "}", "return", "this", ";", "}", "}", "@", "@", "-", "23", ",", "16", "+", "23", ",", "22", "@", "@", "*", "/", "package", "hudson", ".", "model", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "java", ".", "io", ".", "File", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "xml", ".", "XmlPage", ";", "import", "hudson", ".", "slaves", ".", "OfflineCause", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "hudson", ".", "slaves", ".", "DumbSlave", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "public", "class", "ComputerTest", "{", "@", "@", "-", "52", ",", "4", "+", "58", ",", "27", "@", "@", "public", "void", "discardLogsAfterDeletion", "(", ")", "throws", "Exception", "{", "assertTrue", "(", "\"", "Slave", "log", "should", "be", "kept", "\"", ",", "keep", ".", "toComputer", "(", ").", "getLogFile", "(", ").", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "doNotShowUserDetailsInOfflineCause", "(", ")", "throws", "Exception", "{", "DumbSlave", "slave", "=", "j", ".", "createOnlineSlave", "(", ");", "final", "Computer", "computer", "=", "slave", ".", "toComputer", "(", ");", "computer", ".", "setTemporarilyOffline", "(", "true", ",", "new", "OfflineCause", ".", "UserCause", "(", "User", ".", "get", "(", "\"", "username", "\"", "),", "\"", "msg", "\"", "))", ";", "verifyOfflineCause", "(", "computer", ")", ";", "}", "@", "Test", "@", "LocalData", "public", "void", "removeUserDetailsFromOfflineCause", "(", ")", "throws", "Exception", "{", "Computer", "computer", "=", "j", ".", "jenkins", ".", "getComputer", "(", "\"", "deserialized", "\"", ");", "verifyOfflineCause", "(", "computer", ")", ";", "}", "private", "void", "verifyOfflineCause", "(", "Computer", "computer", ")", "throws", "Exception", "{", "XmlPage", "page", "=", "j", ".", "createWebClient", "(", ").", "goToXml", "(", "\"", "computer", "/", "\"", "+", "computer", ".", "getName", "(", ")", "+", "\"", "/", "config", ".", "xml", "\"", ");", "String", "content", "=", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", "\"", "UTF", "-", "8", "\"", ");", "assertThat", "(", "content", ",", "containsString", "(", "\"", "temporaryOfflineCause", "\"", "))", ";", "assertThat", "(", "content", ",", "containsString", "(", "\"<", "userId", ">", "username", "<", "/", "userId", ">", "\")", ");", "assertThat", "(", "content", ",", "not", "(", "containsString", "(", "\"", "ApiTokenProperty", "\"", "))", ");", "assertThat", "(", "content", ",", "not", "(", "containsString", "(", "\"", "apiToken", "\"", "))", ");", "}", "}"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["HV-912", "Removing", "methods", "from", "ReflectionHelper", "which", "make", "privileged", "operations", "publicly", "accessible"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "71", "@", "@", "/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", "*", "Copyright", "2014", ",", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", ",", "and", "individual", "contributors", "*", "by", "the", "@", "authors", "tag", ".", "See", "the", "copyright", ".", "txt", "in", "the", "distribution", "for", "a", "*", "full", "listing", "of", "individual", "contributors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cdi", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Contracts", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "classhierarchy", ".", "ClassHierarchyHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethods", ";", "/", "**", "*", "Deals", "with", "methods", "of", "types", "in", "inheritance", "hierarchies", ".", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "@", "author", "Gunnar", "Morling", "*", "*", "/", "class", "InheritedMethodsHelper", "{", "/", "**", "*", "Get", "a", "list", "of", "all", "methods", "wich", "the", "given", "class", "declares", ",", "implements", ",", "*", "overrides", "or", "inherits", ".", "Methods", "are", "added", "by", "adding", "first", "all", "methods", "of", "*", "the", "class", "itself", "and", "its", "implemented", "interfaces", ",", "then", "the", "super", "class", "and", "*", "its", "interfaces", ",", "etc", ".", "*", "*", "@", "param", "clazz", "the", "class", "for", "which", "to", "retrieve", "the", "methods", "*", "*", "@", "return", "set", "of", "all", "methods", "of", "the", "given", "class", "*", "/", "static", "List", "<", "Method", ">", "getAllMethods", "(", "Class", "<", "?>", "clazz", ")", "{", "Contracts", ".", "assertNotNull", "(", "clazz", ")", ";", "List", "<", "Method", ">", "methods", "=", "newArrayList", "(", ");", "for", "(", "Class", "<", "?>", "hierarchyClass", ":", "ClassHierarchyHelper", ".", "getHierarchy", "(", "clazz", ")", ")", "{", "Collections", ".", "addAll", "(", "methods", ",", "run", "(", "GetMethods", ".", "action", "(", "hierarchyClass", ")", ")", ")", ";", "}", "return", "methods", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "enterprise", ".", "event", ".", "Observes", ";", "import", "javax", ".", "enterprise", ".", "inject", ".", "Default", ";", "import", "javax", ".", "enterprise", ".", "inject", ".", "spi", ".", "AfterBeanDiscovery", ";", "@", "@", "-", "60", ",", "7", "+", "61", ",", "6", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ExecutableHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "TypeResolutionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "classhierarchy", ".", "ClassHierarchyHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "@", "@", "-", "268", ",", "7", "+", "268", ",", "7", "@", "@", "else", "if", "(", "bean", ".", "getTypes", "(", ").", "contains", "(", "Validator", ".", "class", ")", "|", "|", "bean", "instanceof", "Validat", "private", "<", "T", ">", "void", "determineConstrainedMethod", "(", "AnnotatedType", "<", "T", ">", "type", ",", "BeanDescriptor", "beanDescriptor", ",", "Set", "<", "AnnotatedCallable", "<", "?", "super", "T", ">", ">", "callables", ")", "{", "List", "<", "Method", ">", "overriddenAndImplementedMethods", "=", "ClassHierarchyHelper", ".", "getAllMethods", "(", "type", ".", "getJavaClass", "(", ")", ")", ";", "List", "<", "Method", ">", "overriddenAndImplementedMethods", "=", "InheritedMethodsHelper", ".", "getAllMethods", "(", "type", ".", "getJavaClass", "(", ")", ")", ";", "for", "(", "AnnotatedMethod", "<", "?", "super", "T", ">", "annotatedMethod", ":", "type", ".", "getMethods", "(", ")", ")", "{", "Method", "method", "=", "annotatedMethod", ".", "getJavaMember", "(", ");", "@", "@", "-", "18", ",", "8", "+", "18", ",", "11", "@", "@", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Type", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "enterprise", ".", "context", ".", "ApplicationScoped", ";", "import", "javax", ".", "enterprise", ".", "context", ".", "spi", ".", "CreationalContext", ";", "import", "javax", ".", "enterprise", ".", "inject", ".", "spi", ".", "Bean", ";", "@", "@", "-", "36", ",", "8", "+", "39", ",", "8", "@", "@", "import", "javax", ".", "validation", ".", "ValidatorFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "classhierarchy", ".", "ClassHierarchyHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "141", ",", "9", "+", "144", ",", "11", "@", "@", "private", "MessageInterpolator", "createMessageInterpolator", "(", "Configuration", "<", "?>", "config", ")", "{", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "MessageInterpolator", ">", "messageInterpolatorClass", "=", "(", "Class", "<", "MessageInterpolator", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "messageInterpolatorFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "MessageInterpolator", ">", "messageInterpolatorClass", "=", "(", "Class", "<", "MessageInterpolator", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "messageInterpolatorFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "return", "createInstance", "(", "messageInterpolatorClass", ")", ";", "@", "@", "-", "158", ",", "9", "+", "163", ",", "11", "@", "@", "private", "TraversableResolver", "createTraversableResolver", "(", "Configuration", "<", "?>", "config", ")", "{", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "TraversableResolver", ">", "traversableResolverClass", "=", "(", "Class", "<", "TraversableResolver", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "traversableResolverFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "TraversableResolver", ">", "traversableResolverClass", "=", "(", "Class", "<", "TraversableResolver", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "traversableResolverFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "return", "createInstance", "(", "traversableResolverClass", ")", ";", "@", "@", "-", "175", ",", "9", "+", "182", ",", "11", "@", "@", "private", "ParameterNameProvider", "createParameterNameProvider", "(", "Configuration", "<", "?>", "confi", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "ParameterNameProvider", ">", "parameterNameProviderClass", "=", "(", "Class", "<", "ParameterNameProvider", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "parameterNameProviderFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "ParameterNameProvider", ">", "parameterNameProviderClass", "=", "(", "Class", "<", "ParameterNameProvider", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "parameterNameProviderFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "return", "createInstance", "(", "parameterNameProviderClass", ")", ";", "@", "@", "-", "193", ",", "11", "+", "202", ",", "12", "@", "@", "private", "ConstraintValidatorFactory", "createConstraintValidatorFactory", "(", "Configuratio", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "ConstraintValidatorFactory", ">", "constraintValidatorFactoryClass", "=", "(", "Class", "<", "ConstraintValidatorFactory", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "Class", "<", "ConstraintValidatorFactory", ">", "constraintValidatorFactoryClass", "=", "(", "Class", "<", "ConstraintValidatorFactory", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "constraintValidatorFactoryFqcn", ",", "this", ".", "getClass", "(", ")", ")", ";", ")", ")", ";", "return", "createInstance", "(", "constraintValidatorFactoryClass", ")", ";", "}", "@", "@", "-", "214", ",", "6", "+", "224", ",", "16", "@", "@", "private", "ConstraintValidatorFactory", "createConstraintValidatorFactory", "(", "Configuratio", "Validation", ".", "byProvider", "(", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidator", ".", "class", ")", ".", "configure", "(", ");", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "@", "Override", "public", "String", "getId", "(", ")", "{", "return", "ValidatorFactoryBean", ".", "class", ".", "getName", "(", ")", "+", "\"", "_", "\"", "+", "(", "validationProviderHelper", ".", "isDefaultProvider", "(", ")", "?", "\"", "default", "\"", ":", "\"", "hv", "\"", ")", ";", "@", "@", "-", "20", ",", "9", "+", "20", ",", "12", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Member", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "ParameterNameProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "ConstraintDef", ";", "@", "@", "-", "44", ",", "6", "+", "47", ",", "11", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "StringHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredConstructor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredField", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "spi", ".", "group", ".", "DefaultGroupSequenceProvider", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "114", ",", "7", "+", "122", ",", "7", "@", "@", "public", "PropertyConstraintMappingContext", "property", "(", "String", "property", ",", "ElementType", "el", "Contracts", ".", "assertNotNull", "(", "elementType", ",", "\"", "The", "element", "type", "must", "not", "be", "null", ".", "\"", ")", ";", "Contracts", ".", "assertNotEmpty", "(", "property", ",", "MESSAGES", ".", "propertyNameMustNotBeEmpty", "(", ")", ")", ";", "Member", "member", "=", "ReflectionHelper", ".", "getMember", "(", "Member", "member", "=", "getMember", "(", "beanClass", ",", "property", ",", "elementType", ")", ";", "@", "@", "-", "140", ",", "7", "+", "148", ",", "7", "@", "@", "public", "PropertyConstraintMappingContext", "property", "(", "String", "property", ",", "ElementType", "el", "public", "MethodConstraintMappingContext", "method", "(", "String", "name", ",", "Class", "<", "?>", "..", ".", "parameterTypes", ")", "{", "Contracts", ".", "assertNotNull", "(", "name", ",", "MESSAGES", ".", "methodNameMustNotBeNull", "(", ")", ")", ";", "Method", "method", "=", "ReflectionHelper", ".", "getDeclaredMethod", "(", "beanClass", ",", "name", ",", "parameterTypes", ")", ";", "Method", "method", "=", "run", "(", "GetDeclaredMethod", ".", "action", "(", "beanClass", ",", "name", ",", "parameterTypes", ")", ")", ";", "if", "(", "method", "=", "=", "null", "|", "|", "method", ".", "getDeclaringClass", "(", ")", "!", "=", "beanClass", ")", "{", "throw", "log", ".", "getUnableToFindMethodException", "(", "@", "@", "-", "165", ",", "7", "+", "173", ",", "7", "@", "@", "public", "MethodConstraintMappingContext", "method", "(", "String", "name", ",", "Class", "<", "?>", "..", ".", "parameterT", "@", "Override", "public", "ConstructorConstraintMappingContext", "constructor", "(", "Class", "<", "?>", "..", ".", "parameterTypes", ")", "{", "Constructor", "<", "C", ">", "constructor", "=", "ReflectionHelper", ".", "getDeclaredConstructor", "(", "beanClass", ",", "parameterTypes", ")", ";", "Constructor", "<", "C", ">", "constructor", "=", "run", "(", "GetDeclaredConstructor", ".", "action", "(", "beanClass", ",", "parameterTypes", ")", ")", ";", "if", "(", "constructor", "=", "=", "null", "|", "|", "constructor", ".", "getDeclaringClass", "(", ")", "!", "=", "beanClass", ")", "{", "throw", "log", ".", "getBeanDoesNotContainConstructorException", "(", "@", "@", "-", "227", ",", "9", "+", "235", ",", "11", "@", "@", "public", "ConstructorConstraintMappingContext", "constructor", "(", "Class", "<", "?>", "..", ".", "parameterType", "}", "private", "DefaultGroupSequenceProvider", "<", "?", "super", "C", ">", "getDefaultGroupSequenceProvider", "(", ")", "{", "return", "defaultGroupSequenceProviderClass", "!", "=", "null", "?", "ReflectionHelper", ".", "newInstance", "(", "defaultGroupSequenceProviderClass", ",", "\"", "default", "group", "sequence", "provider", "\"", "return", "defaultGroupSequenceProviderClass", "!", "=", "null", "?", "run", "(", "NewInstance", ".", "action", "(", "defaultGroupSequenceProviderClass", ",", "\"", "default", "group", "sequence", "provider", "\"", ")", ")", ":", "null", ";", "}", "@", "@", "-", "241", ",", "4", "+", "251", ",", "50", "@", "@", "public", "ConstructorConstraintMappingContext", "constructor", "(", "Class", "<", "?>", "..", ".", "parameterType", "protected", "ConstraintType", "getConstraintType", "(", ")", "{", "return", "ConstraintType", ".", "GENERIC", ";", "}", "/", "**", "*", "Returns", "the", "member", "with", "the", "given", "name", "and", "type", ".", "*", "*", "@", "param", "clazz", "The", "class", "from", "which", "to", "retrieve", "the", "member", ".", "Cannot", "be", "{", "@", "code", "null", "}", ".", "*", "@", "param", "property", "The", "property", "name", "without", "\"", "is", "\"", ",", "\"", "get", "\"", "or", "\"", "has", "\"", ".", "Cannot", "be", "{", "@", "code", "null", "}", "or", "empty", ".", "*", "@", "param", "elementType", "The", "element", "type", ".", "Either", "{", "@", "code", "ElementType", ".", "FIELD", "}", "or", "{", "@", "code", "ElementType", "METHOD", "}", ".", "*", "*", "@", "return", "the", "member", "which", "matching", "the", "name", "and", "type", "or", "{", "@", "code", "null", "}", "if", "no", "such", "member", "exists", ".", "*", "/", "private", "Member", "getMember", "(", "Class", "<", "?>", "clazz", ",", "String", "property", ",", "ElementType", "elementType", ")", "{", "Contracts", ".", "assertNotNull", "(", "clazz", ",", "MESSAGES", ".", "classCannotBeNull", "(", ")", ")", ";", "if", "(", "property", "=", "=", "null", "|", "|", "property", ".", "length", "(", ")", "=", "=", "0", ")", "{", "throw", "log", ".", "getPropertyNameCannotBeNullOrEmptyException", "(", ");", "}", "if", "(", "!", "(", "ElementType", ".", "FIELD", ".", "equals", "(", "elementType", ")", "|", "|", "ElementType", ".", "METHOD", ".", "equals", "(", "elementType", ")", ")", ")", "{", "throw", "log", ".", "getElementTypeHasToBeFieldOrMethodException", "(", ");", "}", "Member", "member", "=", "null", ";", "if", "(", "ElementType", ".", "FIELD", ".", "equals", "(", "elementType", ")", ")", "{", "member", "=", "run", "(", "GetDeclaredField", ".", "action", "(", "clazz", ",", "property", ")", ")", ";", "}", "else", "{", "String", "methodName", "=", "property", ".", "substring", "(", "0", ",", "1", ")", ".", "toUpperCase", "(", ")", "+", "property", ".", "substring", "(", "1", ")", ";", "for", "(", "String", "prefix", ":", "ReflectionHelper", ".", "PROPERTY_ACCESSOR_PREFIXES", ")", "{", "member", "=", "run", "(", "GetMethod", ".", "action", "(", "clazz", ",", "prefix", "+", "methodName", ")", ")", ";", "if", "(", "member", "!", "=", "null", ")", "{", "break", ";", "}", "}", "}", "return", "member", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "19", ",", "6", "+", "19", ",", "8", "@", "@", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "28", ",", "6", "+", "30", ",", "7", "@", "@", "import", "javax", ".", "validation", ".", "MessageInterpolator", ";", "import", "javax", ".", "validation", ".", "ParameterNameProvider", ";", "import", "javax", ".", "validation", ".", "TraversableResolver", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "validation", ".", "ValidationProviderResolver", ";", "import", "javax", ".", "validation", ".", "ValidatorFactory", ";", "import", "javax", ".", "validation", ".", "spi", ".", "BootstrapState", ";", "@", "@", "-", "43", ",", "11", "+", "46", ",", "11", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "valuehandling", ".", "OptionalValueUnwrapper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Contracts", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "TypeResolutionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Version", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ".", "ValidationBootstrapParameters", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ".", "ValidationXmlParser", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "messageinterpolation", ".", "ResourceBundleMessageInterpolator", ";", "@", "@", "-", "433", ",", "6", "+", "436", ",", "26", "@", "@", "private", "void", "applyXmlSettings", "(", "ValidationBootstrapParameters", "xmlParameters", ")", "{", "}", "private", "boolean", "isJavaFxInClasspath", "(", ")", "{", "return", "ReflectionHelper", ".", "isClassPresent", "(", "\"", "javafx", ".", "application", ".", "Application", "\"", ",", "this", ".", "getClass", "(", ")", ")", ";", "return", "isClassPresent", "(", "\"", "javafx", ".", "application", ".", "Application", "\"", ")", ";", "}", "private", "boolean", "isClassPresent", "(", "String", "className", ")", "{", "try", "{", "run", "(", "LoadClass", ".", "action", "(", "className", ",", "getClass", "(", ")", ")", ")", ";", "return", "true", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "return", "false", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "16", ",", "6", "+", "16", ",", "8", "@", "@", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "IdentityHashMap", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "40", ",", "10", "+", "42", ",", "11", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "provider", ".", "ProgrammaticMetaDataProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "provider", ".", "XmlMetaDataProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ExecutableHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "TypeResolutionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "messageinterpolation", ".", "ResourceBundleMessageInterpolator", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "spi", ".", "valuehandling", ".", "ValidatedValueUnwrapper", ";", "@", "@", "-", "257", ",", "7", "+", "260", ",", "7", "@", "@", "Validator", "createValidator", "(", "ConstraintValidatorFactory", "constraintValidatorFactory", ",", "throw", "log", ".", "getMissingELDependenciesException", "(", ");", "}", "}", "BeanMetaDataManager", "beanMetaDataManager", ";", "if", "(", "!", "beanMetaDataManagerMap", ".", "containsKey", "(", "parameterNameProvider", ")", ")", "{", "beanMetaDataManager", "=", "new", "BeanMetaDataManager", "(", "@", "@", "-", "337", ",", "12", "+", "340", ",", "21", "@", "@", "private", "boolean", "checkPropertiesForFailFast", "(", "Map", "<", "String", ",", "String", ">", "properties", ",", "boole", "for", "(", "String", "handlerName", ":", "handlerNames", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "?", "extends", "ValidatedValueUnwrapper", "<", "?>", ">", "handlerType", "=", "(", "Class", "<", "?", "extends", "ValidatedValueUnwrapper", "<", "?>", ">)", "ReflectionHelper", ".", "loadClass", "(", "handlerName", ",", "ValidatorFactoryImpl", ".", "class", ")", ";", "handlers", ".", "add", "(", "ReflectionHelper", ".", "newInstance", "(", "handlerType", ",", "\"", "validated", "value", "handler", "class", "\"", ")", ")", ";", "Class", "<", "?", "extends", "ValidatedValueUnwrapper", "<", "?>", ">", "handlerType", "=", "(", "Class", "<", "?", "extends", "ValidatedValueUnwrapper", "<", "?>", ">)", "run", "(", "LoadClass", ".", "action", "(", "handlerName", ",", "ValidatorFactoryImpl", ".", "class", ")", ")", ";", "handlers", ".", "add", "(", "run", "(", "NewInstance", ".", "action", "(", "handlerType", ",", "\"", "validated", "value", "handler", "class", "\"", ")", ")", ")", ";", "}", "return", "handlers", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "16", ",", "26", "+", "16", ",", "40", "@", "@", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "constraintvalidation", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "javax", ".", "validation", ".", "ConstraintValidator", ";", "import", "javax", ".", "validation", ".", "ConstraintValidatorFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "/", "**", "*", "Default", "{", "@", "code", "ConstraintValidatorFactory", "}", "using", "a", "no", "-", "arg", "constructor", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "/", "/", "TODO", "Can", "we", "make", "the", "constructor", "non", "-", "public", "?", "public", "class", "ConstraintValidatorFactoryImpl", "implements", "ConstraintValidatorFactory", "{", "@", "Override", "public", "final", "<", "T", "extends", "ConstraintValidator", "<", "?,", "?", ">>", "T", "getInstance", "(", "Class", "<", "T", ">", "key", ")", "{", "return", "ReflectionHelper", ".", "newInstance", "(", "key", ",", "\"", "ConstraintValidator", "\"", ")", ";", "return", "run", "(", "NewInstance", ".", "action", "(", "key", ",", "\"", "ConstraintValidator", "\"", ")", ")", ";", "}", "@", "Override", "public", "void", "releaseInstance", "(", "ConstraintValidator", "<", "?,", "?", ">", "instance", ")", "{", "/", "/", "noop", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "18", ",", "13", "+", "18", ",", "19", "@", "@", "import", "java", ".", "lang", ".", "annotation", ".", "ElementType", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "javax", ".", "validation", ".", "Path", ";", "import", "javax", ".", "validation", ".", "TraversableResolver", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "/", "**", "*", "A", "JPA", "2", "aware", "{", "@", "code", "TraversableResolver", "}", ".", "@", "@", "-", "68", ",", "7", "+", "74", ",", "7", "@", "@", "private", "void", "detectJPA", "(", ")", "{", "/", "/", "check", "whether", "we", "have", "Persistence", "on", "the", "classpath", "Class", "<", "?>", "persistenceClass", ";", "try", "{", "persistenceClass", "=", "ReflectionHelper", ".", "loadClass", "(", "PERSISTENCE_CLASS_NAME", ",", "this", ".", "getClass", "(", ")", ")", ";", "persistenceClass", "=", "run", "(", "LoadClass", ".", "action", "(", "PERSISTENCE_CLASS_NAME", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "log", ".", "debugf", "(", "@", "@", "-", "79", ",", "7", "+", "85", ",", "7", "@", "@", "private", "void", "detectJPA", "(", ")", "{", "}", "/", "/", "check", "whether", "Persistence", "contains", "getPersistenceUtil", "Method", "persistenceUtilGetter", "=", "ReflectionHelper", ".", "getMethod", "(", "persistenceClass", ",", "PERSISTENCE_UTIL_METHOD", ")", ";", "Method", "persistenceUtilGetter", "=", "run", "(", "GetMethod", ".", "action", "(", "persistenceClass", ",", "PERSISTENCE_UTIL_METHOD", ")", ")", ";", "if", "(", "persistenceUtilGetter", "=", "=", "null", ")", "{", "log", ".", "debugf", "(", "\"", "Found", "%", "s", "on", "classpath", ",", "but", "no", "method", "'", "%", "s", "'", ".", "Assuming", "JPA", "1", "environment", ".", "All", "properties", "will", "per", "default", "be", "traversable", ".", "\",", "@", "@", "-", "92", ",", "7", "+", "98", ",", "7", "@", "@", "private", "void", "detectJPA", "(", ")", "{", "/", "/", "try", "to", "invoke", "the", "method", "to", "make", "sure", "that", "we", "are", "dealing", "with", "a", "complete", "JPA2", "implementation", "/", "/", "unfortunately", "there", "are", "several", "incomplete", "implementations", "out", "there", "(", "see", "HV", "-", "374", ")", "try", "{", "Object", "persistence", "=", "ReflectionHelper", ".", "newInstance", "(", "persistenceClass", ",", "\"", "persistence", "provider", "\"", ")", ";", "Object", "persistence", "=", "run", "(", "NewInstance", ".", "action", "(", "persistenceClass", ",", "\"", "persistence", "provider", "\"", ")", ")", ";", "ReflectionHelper", ".", "getValue", "(", "persistenceUtilGetter", ",", "persistence", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "@", "@", "-", "112", ",", "8", "+", "118", ",", "8", "@", "@", "private", "void", "detectJPA", "(", ")", "{", "try", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "?", "extends", "TraversableResolver", ">", "jpaAwareResolverClass", "=", "(", "Class", "<", "?", "extends", "TraversableResolver", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "JPA_AWARE_TRAVERSABLE_RESOLVER_CLASS_NAME", ",", "this", ".", "getClass", "(", ")", ")", ";", "jpaTraversableResolver", "=", "ReflectionHelper", ".", "newInstance", "(", "jpaAwareResolverClass", ",", "\"", "\"", ")", ";", "run", "(", "LoadClass", ".", "action", "(", "JPA_AWARE_TRAVERSABLE_RESOLVER_CLASS_NAME", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "jpaTraversableResolver", "=", "run", "(", "NewInstance", ".", "action", "(", "jpaAwareResolverClass", ",", "\"", "\"", ")", ")", ";", "log", ".", "debugf", "(", "\"", "Instantiated", "JPA", "aware", "TraversableResolver", "of", "type", "%", "s", ".", "\",", "JPA_AWARE_TRAVERSABLE_RESOLVER_CLASS_NAME", ")", ";", "@", "@", "-", "126", ",", "15", "+", "132", ",", "27", "@", "@", "private", "void", "detectJPA", "(", ")", "{", "}", "}", "@", "Override", "public", "boolean", "isReachable", "(", "Object", "traversableObject", ",", "Path", ".", "Node", "traversableProperty", ",", "Class", "<", "?>", "rootBeanType", ",", "Path", "pathToTraversableObject", ",", "ElementType", "elementType", ")", "{", "return", "jpaTraversableResolver", "=", "=", "null", "|", "|", "jpaTraversableResolver", ".", "isReachable", "(", "traversableObject", ",", "traversableProperty", ",", "rootBeanType", ",", "pathToTraversableObject", ",", "elementType", ")", ";", "}", "@", "Override", "public", "boolean", "isCascadable", "(", "Object", "traversableObject", ",", "Path", ".", "Node", "traversableProperty", ",", "Class", "<", "?>", "rootBeanType", ",", "Path", "pathToTraversableObject", ",", "ElementType", "elementType", ")", "{", "return", "jpaTraversableResolver", "=", "=", "null", "|", "|", "jpaTraversableResolver", ".", "isCascadable", "(", "traversableObject", ",", "traversableProperty", ",", "rootBeanType", ",", "pathToTraversableObject", ",", "elementType", ")", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "18", ",", "13", "+", "18", ",", "17", "@", "@", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "javax", ".", "validation", ".", "Constraint", ";", "import", "javax", ".", "validation", ".", "ConstraintTarget", ";", "import", "javax", ".", "validation", ".", "ConstraintValidator", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "validation", ".", "constraints", ".", "AssertFalse", ";", "import", "javax", ".", "validation", ".", "constraints", ".", "AssertTrue", ";", "import", "javax", ".", "validation", ".", "constraints", ".", "DecimalMax", ";", "@", "@", "-", "115", ",", "10", "+", "119", ",", "13", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "constraintvalidators", ".", "bv", ".", "size", ".", "SizeValidatorForMap", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "constraintvalidators", ".", "hv", ".", "URLValidator", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Contracts", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Version", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetAnnotationParameter", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethods", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newConcurrentHashMap", ";", "@", "@", "-", "415", ",", "7", "+", "422", ",", "7", "@", "@", "private", "boolean", "supportsValidationTarget", "(", "Class", "<", "?", "extends", "ConstraintValidator", "<", "?,", "*", "/", "public", "boolean", "isMultiValueConstraint", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", ")", "{", "boolean", "isMultiValueConstraint", "=", "false", ";", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "annotationType", ",", "\"", "value", "\"", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethod", ".", "action", "(", "annotationType", ",", "\"", "value", "\"", ")", ")", ";", "if", "(", "method", "!", "=", "null", ")", "{", "Class", "<", "?>", "returnType", "=", "method", ".", "getReturnType", "(", ");", "if", "(", "returnType", ".", "isArray", "(", ")", "&", "&", "returnType", ".", "getComponentType", "(", ").", "isAnnotation", "(", ")", ")", "{", "@", "@", "-", "444", ",", "10", "+", "451", ",", "12", "@", "@", "public", "boolean", "isMultiValueConstraint", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", "*", "@", "return", "A", "list", "of", "constraint", "annotations", ",", "may", "be", "empty", "but", "never", "{", "@", "code", "null", "}", ".", "*", "/", "public", "<", "A", "extends", "Annotation", ">", "List", "<", "Annotation", ">", "getConstraintsFromMultiValueConstraint", "(", "A", "multiValueConstraint", ")", "{", "Annotation", "[", "]", "annotations", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "multiValueConstraint", ",", "\"", "value", "\"", ",", "Annotation", "[", "].", "class", "Annotation", "[", "]", "annotations", "=", "run", "(", "GetAnnotationParameter", ".", "action", "(", "multiValueConstraint", ",", "\"", "value", "\"", ",", "Annotation", "[", "].", "class", ")", ")", ";", "return", "Arrays", ".", "asList", "(", "annotations", ")", ";", "}", "@", "@", "-", "481", ",", "7", "+", "490", ",", "7", "@", "@", "public", "boolean", "isConstraintAnnotation", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", "}", "private", "void", "assertNoParameterStartsWithValid", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", ")", "{", "final", "Method", "[", "]", "methods", "=", "ReflectionHelper", ".", "getDeclaredMethods", "(", "annotationType", ")", ";", "final", "Method", "[", "]", "methods", "=", "run", "(", "GetDeclaredMethods", ".", "action", "(", "annotationType", ")", ")", ";", "for", "(", "Method", "m", ":", "methods", ")", "{", "if", "(", "m", ".", "getName", "(", ").", "startsWith", "(", "\"", "valid", "\"", ")", "&", "&", "!", "m", ".", "getName", "(", ").", "equals", "(", "VALIDATION_APPLIES_TO", ")", ")", "{", "throw", "log", ".", "getConstraintParametersCannotStartWithValidException", "(", ");", "@", "@", "-", "491", ",", "7", "+", "500", ",", "7", "@", "@", "private", "void", "assertNoParameterStartsWithValid", "(", "Class", "<", "?", "extends", "Annotation", ">", "annota", "private", "void", "assertPayloadParameterExists", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", ")", "{", "try", "{", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "annotationType", ",", "PAYLOAD", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethod", ".", "action", "(", "annotationType", ",", "PAYLOAD", ")", ")", ";", "if", "(", "method", "=", "=", "null", ")", "{", "throw", "log", ".", "getConstraintWithoutMandatoryParameterException", "(", "PAYLOAD", ",", "annotationType", ".", "getName", "(", ")", ")", ";", "}", "@", "@", "-", "507", ",", "7", "+", "516", ",", "7", "@", "@", "private", "void", "assertPayloadParameterExists", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotation", "private", "void", "assertGroupsParameterExists", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", ")", "{", "try", "{", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "annotationType", ",", "GROUPS", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethod", ".", "action", "(", "annotationType", ",", "GROUPS", ")", ")", ";", "if", "(", "method", "=", "=", "null", ")", "{", "throw", "log", ".", "getConstraintWithoutMandatoryParameterException", "(", "GROUPS", ",", "annotationType", ".", "getName", "(", ")", ")", ";", "}", "@", "@", "-", "522", ",", "7", "+", "531", ",", "7", "@", "@", "private", "void", "assertGroupsParameterExists", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationT", "}", "private", "void", "assertMessageParameterExists", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", ")", "{", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "annotationType", ",", "MESSAGE", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethod", ".", "action", "(", "annotationType", ",", "MESSAGE", ")", ")", ";", "if", "(", "method", "=", "=", "null", ")", "{", "throw", "log", ".", "getConstraintWithoutMandatoryParameterException", "(", "MESSAGE", ",", "annotationType", ".", "getName", "(", ")", ")", ";", "}", "@", "@", "-", "540", ",", "7", "+", "549", ",", "7", "@", "@", "private", "void", "assertValidationAppliesToParameterSetUpCorrectly", "(", "Class", "<", "?", "extends", "An", "annotationType", ",", "ValidationTarget", ".", "PARAMETERS", ")", ".", "isEmpty", "(", ");", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "annotationType", ",", "VALIDATION_APPLIES_TO", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethod", ".", "action", "(", "annotationType", ",", "VALIDATION_APPLIES_TO", ")", ")", ";", "if", "(", "hasGenericValidators", "&", "&", "hasCrossParameterValidator", ")", "{", "if", "(", "method", "=", "=", "null", ")", "{", "@", "@", "-", "567", ",", "8", "+", "576", ",", "8", "@", "@", "public", "boolean", "isConstraintComposition", "(", "Class", "<", "?", "extends", "Annotation", ">", "annotationTyp", "return", "annotationType", "=", "=", "ConstraintComposition", ".", "class", ";", "}", "private", "boolean", "isJodaTimeInClasspath", "(", ")", "{", "return", "ReflectionHelper", ".", "isClassPresent", "(", "JODA_TIME_CLASS_NAME", ",", "this", ".", "getClass", "(", ")", ")", ";", "private", "static", "boolean", "isJodaTimeInClasspath", "(", ")", "{", "return", "isClassPresent", "(", "JODA_TIME_CLASS_NAME", ")", ";", "}", "/", "**", "@", "@", "-", "593", ",", "6", "+", "602", ",", "26", "@", "@", "private", "boolean", "isJodaTimeInClasspath", "(", ")", "{", "}", "}", "private", "static", "boolean", "isClassPresent", "(", "String", "className", ")", "{", "try", "{", "run", "(", "LoadClass", ".", "action", "(", "className", ",", "ConstraintHelper", ".", "class", ")", ")", ";", "return", "true", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "return", "false", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "/", "**", "*", "A", "type", "-", "safe", "wrapper", "around", "a", "concurrent", "map", "from", "constraint", "types", "to", "*", "associated", "validator", "classes", ".", "The", "casts", "are", "safe", "as", "data", "is", "added", "trough", "@", "@", "-", "26", ",", "11", "+", "26", ",", "14", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Member", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "Constraint", ";", "import", "javax", ".", "validation", ".", "ConstraintTarget", ";", "import", "javax", ".", "validation", ".", "ConstraintValidator", ";", "@", "@", "-", "46", ",", "11", "+", "49", ",", "13", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "constraints", ".", "ConstraintComposition", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintOrigin", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "annotationfactory", ".", "AnnotationDescriptor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "annotationfactory", ".", "AnnotationFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetAnnotationParameter", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethods", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "505", ",", "10", "+", "510", ",", "8", "@", "@", "private", "boolean", "isExecutable", "(", "ElementType", "elementType", ")", "{", "Class", "<", "Payload", ">", "[]", "payloadFromAnnotation", ";", "try", "{", "/", "/", "TODO", "be", "extra", "safe", "and", "make", "sure", "this", "is", "an", "array", "of", "Payload", "payloadFromAnnotation", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "annotation", ",", "ConstraintHelper", ".", "PAYLOAD", ",", "Class", "[", "].", "class", "payloadFromAnnotation", "=", "run", "(", "GetAnnotationParameter", ".", "action", "(", "annotation", ",", "ConstraintHelper", ".", "PAYLOAD", ",", "Class", "[", "].", "class", ")", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "@", "@", "-", "523", ",", "8", "+", "526", ",", "8", "@", "@", "private", "boolean", "isExecutable", "(", "ElementType", "elementType", ")", "{", "private", "Set", "<", "Class", "<", "?>", ">", "buildGroupSet", "(", "Class", "<", "?>", "implicitGroup", ")", "{", "Set", "<", "Class", "<", "?>", ">", "groupSet", "=", "newHashSet", "(", ");", "final", "Class", "<", "?>", "[]", "groupsFromAnnotation", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "annotation", ",", "ConstraintHelper", ".", "GROUPS", ",", "Class", "[", "].", "class", "final", "Class", "<", "?>", "[]", "groupsFromAnnotation", "=", "run", "(", "GetAnnotationParameter", ".", "action", "(", "annotation", ",", "ConstraintHelper", ".", "GROUPS", ",", "Class", "[", "].", "class", ")", ")", ";", "if", "(", "groupsFromAnnotation", ".", "length", "=", "=", "0", ")", "{", "groupSet", ".", "add", "(", "Default", ".", "class", ")", ";", "@", "@", "-", "541", ",", "18", "+", "544", ",", "18", "@", "@", "private", "boolean", "isExecutable", "(", "ElementType", "elementType", ")", "{", "}", "private", "Map", "<", "String", ",", "Object", ">", "buildAnnotationParameterMap", "(", "Annotation", "annotation", ")", "{", "final", "Method", "[", "]", "declaredMethods", "=", "ReflectionHelper", ".", "getDeclaredMethods", "(", "annotation", ".", "annotationType", "(", ")", ")", ";", "final", "Method", "[", "]", "declaredMethods", "=", "run", "(", "GetDeclaredMethods", ".", "action", "(", "annotation", ".", "annotationType", "(", ")", ")", ")", ";", "Map", "<", "String", ",", "Object", ">", "parameters", "=", "newHashMap", "(", "declaredMethods", ".", "length", ")", ";", "for", "(", "Method", "m", ":", "declaredMethods", ")", "{", "Object", "value", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "annotation", ",", "m", ".", "getName", "(", "),", "Object", ".", "class", ")", ";", "Object", "value", "=", "run", "(", "GetAnnotationParameter", ".", "action", "(", "annotation", ",", "m", ".", "getName", "(", "),", "Object", ".", "class", ")", ")", ";", "parameters", ".", "put", "(", "m", ".", "getName", "(", "),", "value", ")", ";", "}", "return", "Collections", ".", "unmodifiableMap", "(", "parameters", ")", ";", "}", "private", "Map", "<", "ClassIndexWrapper", ",", "Map", "<", "String", ",", "Object", ">", ">", "parseOverrideParameters", "(", ")", "{", "Map", "<", "ClassIndexWrapper", ",", "Map", "<", "String", ",", "Object", ">", ">", "overrideParameters", "=", "newHashMap", "(", ");", "final", "Method", "[", "]", "methods", "=", "ReflectionHelper", ".", "getDeclaredMethods", "(", "annotationType", ")", ";", "final", "Method", "[", "]", "methods", "=", "run", "(", "GetDeclaredMethods", ".", "action", "(", "annotationType", ")", ")", ";", "for", "(", "Method", "m", ":", "methods", ")", "{", "if", "(", "m", ".", "getAnnotation", "(", "OverridesAttribute", ".", "class", ")", "!", "=", "null", ")", "{", "addOverrideAttributes", "(", "@", "@", "-", "571", ",", "7", "+", "574", ",", "7", "@", "@", "else", "if", "(", "m", ".", "getAnnotation", "(", "OverridesAttribute", ".", "List", ".", "class", ")", "!", "=", "null", ")", "{", "}", "private", "void", "addOverrideAttributes", "(", "Map", "<", "ClassIndexWrapper", ",", "Map", "<", "String", ",", "Object", ">", ">", "overrideParameters", ",", "Method", "m", ",", "OverridesAttribute", ".", "..", "attributes", ")", "{", "Object", "value", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "annotation", ",", "m", ".", "getName", "(", "),", "Object", ".", "class", ")", ";", "Object", "value", "=", "run", "(", "GetAnnotationParameter", ".", "action", "(", "annotation", ",", "m", ".", "getName", "(", "),", "Object", ".", "class", ")", ")", ";", "for", "(", "OverridesAttribute", "overridesAttribute", ":", "attributes", ")", "{", "ensureAttributeIsOverridable", "(", "m", ",", "overridesAttribute", ")", ";", "@", "@", "-", "588", ",", "7", "+", "591", ",", "7", "@", "@", "private", "void", "addOverrideAttributes", "(", "Map", "<", "ClassIndexWrapper", ",", "Map", "<", "String", ",", "Object", ">", ">", "o", "}", "private", "void", "ensureAttributeIsOverridable", "(", "Method", "m", ",", "OverridesAttribute", "overridesAttribute", ")", "{", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "overridesAttribute", ".", "constraint", "(", "),", "overridesAttribute", ".", "name", "(", ")", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethod", ".", "action", "(", "overridesAttribute", ".", "constraint", "(", "),", "overridesAttribute", ".", "name", "(", ")", ")", ")", ";", "if", "(", "method", "=", "=", "null", ")", "{", "throw", "log", ".", "getOverriddenConstraintAttributeNotFoundException", "(", "overridesAttribute", ".", "name", "(", ")", ")", ";", "}", "@", "@", "-", "704", ",", "6", "+", "707", ",", "16", "@", "@", "private", "CompositionType", "parseCompositionType", "(", "ConstraintHelper", "constraintHelper", ")", ")", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "P", ">", "P", "run", "(", "PrivilegedAction", "<", "P", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "/", "**", "*", "@", "return", "the", "compositionType", "*", "/", "@", "@", "-", "23", ",", "6", "+", "23", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Member", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Modifier", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "57", ",", "6", "+", "59", ",", "11", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "classhierarchy", ".", "ClassHierarchyHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredConstructors", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredFields", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethods", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethods", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "spi", ".", "group", ".", "DefaultGroupSequenceProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "valuehandling", ".", "UnwrapValidatedValue", ";", "@", "@", "-", "65", ",", "8", "+", "72", ",", "6", "@", "@", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "partition", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ConcurrentReferenceHashMap", ".", "ReferenceType", ".", "SOFT", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ".", "getMethods", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ".", "newInstance", ";", "/", "**", "*", "{", "@", "code", "MetaDataProvider", "}", "which", "reads", "the", "metadata", "from", "annotations", "which", "is", "the", "default", "configuration", "source", ".", "@", "@", "-", "184", ",", "14", "+", "189", ",", "14", "@", "@", "public", "AnnotationProcessingOptions", "getAnnotationProcessingOptions", "(", ")", "{", "private", "<", "T", ">", "DefaultGroupSequenceProvider", "<", "?", "super", "T", ">", "newGroupSequenceProviderClassInstance", "(", "Class", "<", "T", ">", "beanClass", ",", "Class", "<", "?", "extends", "DefaultGroupSequenceProvider", "<", "?", "super", "T", ">", ">", "providerClass", ")", "{", "Method", "[", "]", "providerMethods", "=", "getMethods", "(", "providerClass", ")", ";", "Method", "[", "]", "providerMethods", "=", "run", "(", "GetMethods", ".", "action", "(", "providerClass", ")", ")", ";", "for", "(", "Method", "method", ":", "providerMethods", ")", "{", "Class", "<", "?>", "[]", "paramTypes", "=", "method", ".", "getParameterTypes", "(", ");", "if", "(", "\"", "getValidationGroups", "\"", ".", "equals", "(", "method", ".", "getName", "(", ")", ")", "&", "&", "!", "method", ".", "isBridge", "(", ")", "&", "&", "paramTypes", ".", "length", "=", "=", "1", "&", "&", "paramTypes", "[", "0", "]", ".", "isAssignableFrom", "(", "beanClass", ")", ")", "{", "return", "newInstance", "(", "providerClass", ",", "\"", "the", "default", "group", "sequence", "provider", "\"", "return", "run", "(", "NewInstance", ".", "action", "(", "providerClass", ",", "\"", "the", "default", "group", "sequence", "provider", "\"", ")", ")", ";", "}", "}", "@", "@", "-", "219", ",", "7", "+", "224", ",", "7", "@", "@", "public", "AnnotationProcessingOptions", "getAnnotationProcessingOptions", "(", ")", "{", "private", "Set", "<", "ConstrainedElement", ">", "getFieldMetaData", "(", "Class", "<", "?>", "beanClass", ")", "{", "Set", "<", "ConstrainedElement", ">", "propertyMetaData", "=", "newHashSet", "(", ");", "for", "(", "Field", "field", ":", "ReflectionHelper", ".", "getDeclaredFields", "(", "beanClass", ")", ")", "{", "for", "(", "Field", "field", ":", "run", "(", "GetDeclaredFields", ".", "action", "(", "beanClass", ")", ")", ")", "{", "/", "/", "HV", "-", "172", "if", "(", "Modifier", ".", "isStatic", "(", "field", ".", "getModifiers", "(", ")", ")", "|", "|", "annotationProcessingOptions", ".", "areMemberConstraintsIgnoredFor", "(", "field", ")", "|", "|", "@", "@", "-", "268", ",", "15", "+", "273", ",", "15", "@", "@", "private", "ConstrainedField", "findPropertyMetaData", "(", "Field", "field", ")", "{", "private", "Set", "<", "ConstrainedExecutable", ">", "getConstructorMetaData", "(", "Class", "<", "?>", "clazz", ")", "{", "List", "<", "ExecutableElement", ">", "declaredConstructors", "=", "ExecutableElement", ".", "forConstructors", "(", "ReflectionHelper", ".", "getDeclaredConstructors", "(", "clazz", ")", "run", "(", "GetDeclaredConstructors", ".", "action", "(", "clazz", ")", ")", ")", ";", "return", "getMetaData", "(", "declaredConstructors", ")", ";", "}", "private", "Set", "<", "ConstrainedExecutable", ">", "getMethodMetaData", "(", "Class", "<", "?>", "clazz", ")", "{", "List", "<", "ExecutableElement", ">", "declaredMethods", "=", "ExecutableElement", ".", "forMethods", "(", "ReflectionHelper", ".", "getDeclaredMethods", "(", "clazz", ")", "run", "(", "GetDeclaredMethods", ".", "action", "(", "clazz", ")", ")", ")", ";", "return", "getMetaData", "(", "declaredMethods", ")", ";", "@", "@", "-", "608", ",", "4", "+", "613", ",", "14", "@", "@", "public", "ConstraintType", "getPartition", "(", "ConstraintDescriptorImpl", "<", "?>", "v", ")", "{", "type", ")", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "18", ",", "17", "+", "18", ",", "20", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "metadata", ".", "ConstraintDescriptor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "MetaConstraint", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "location", ".", "ConstraintLocation", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "SetAccessibility", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "@", "@", "-", "142", ",", "7", "+", "145", ",", "7", "@", "@", "public", "ConstrainedExecutable", "(", "this", ".", "hasParameterConstraints", "=", "hasParameterConstraints", "(", "parameterMetaData", ")", "|", "|", "!", "crossParameterConstraints", ".", "isEmpty", "(", ");", "if", "(", "isConstrained", "(", ")", ")", "{", "ReflectionHelper", ".", "setAccessibility", "(", "location", ".", "getMember", "(", ")", ")", ";", "run", "(", "SetAccessibility", ".", "action", "(", "location", ".", "getMember", "(", ")", ")", ")", ";", "}", "}", "@", "@", "-", "350", ",", "4", "+", "353", ",", "8", "@", "@", "else", "if", "(", "!", "executable", ".", "equals", "(", "other", ".", "executable", ")", ")", "{", "}", "return", "true", ";", "}", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "17", ",", "12", "+", "17", ",", "14", "@", "@", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Member", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "MetaConstraint", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "location", ".", "ConstraintLocation", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "SetAccessibility", ";", "/", "**", "*", "Represents", "a", "field", "of", "a", "Java", "type", "and", "all", "its", "associated", "meta", "-", "data", "relevant", "@", "@", "-", "54", ",", "7", "+", "56", ",", "7", "@", "@", "public", "ConstrainedField", "(", "ConfigurationSource", "source", ",", "Member", "member", "=", "location", ".", "getMember", "(", ");", "if", "(", "member", "!", "=", "null", "&", "&", "isConstrained", "(", ")", ")", "{", "ReflectionHelper", ".", "setAccessibility", "(", "member", ")", ";", "run", "(", "SetAccessibility", ".", "action", "(", "member", ")", ")", ";", "}", "}", "@", "@", "-", "88", ",", "4", "+", "90", ",", "8", "@", "@", "else", "if", "(", "!", "getLocation", "(", ").", "getMember", "(", ").", "equals", "(", "other", ".", "getLocation", "(", ").", "getMember", "(", ")", ")", ")", "}", "return", "true", ";", "}", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "16", ",", "8", "+", "16", ",", "6", "@", "@", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "lang", ".", "annotation", ".", "ElementType", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "@", "@", "-", "27", ",", "37", "+", "25", ",", "17", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Type", ";", "import", "java", ".", "lang", ".", "reflect", ".", "TypeVariable", ";", "import", "java", ".", "lang", ".", "reflect", ".", "WildcardType", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ExecutableElement", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "ConstructorInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetAnnotationParameter", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetClassLoader", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredConstructor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredConstructors", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredField", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredFields", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethods", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethodFromPropertyName", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethods", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "SetAccessibility", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Messages", ".", "MESSAGES", ";", "/", "**", "*", "Some", "reflection", "utility", "methods", ".", "Where", "necessary", "calls", "will", "be", "performed", "as", "{", "@", "code", "PrivilegedAction", "}", "which", "is", "necessary", "@", "@", "-", "69", ",", "39", "+", "47", ",", "17", "@", "@", "*", "/", "public", "final", "class", "ReflectionHelper", "{", "private", "static", "final", "String", "PACKAGE_SEPARATOR", "=", "\"", ".\"", ";", "private", "static", "final", "String", "ARRAY_CLASS_NAME_PREFIX", "=", "\"", "[", "L", "\"", ";", "private", "static", "final", "String", "ARRAY_CLASS_NAME_SUFFIX", "=", "\"", ";\"", ";", "private", "static", "final", "String", "PROPERTY_ACCESSOR_PREFIX_GET", "=", "\"", "get", "\"", ";", "private", "static", "final", "String", "PROPERTY_ACCESSOR_PREFIX_IS", "=", "\"", "is", "\"", ";", "private", "static", "final", "String", "PROPERTY_ACCESSOR_PREFIX_HAS", "=", "\"", "has", "\"", ";", "private", "static", "final", "String", "[", "]", "PROPERTY_ACCESSOR_PREFIXES", "=", "{", "public", "static", "final", "String", "[", "]", "PROPERTY_ACCESSOR_PREFIXES", "=", "{", "PROPERTY_ACCESSOR_PREFIX_GET", ",", "PROPERTY_ACCESSOR_PREFIX_IS", ",", "PROPERTY_ACCESSOR_PREFIX_HAS", "}", ";", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "private", "static", "final", "Map", "<", "String", ",", "Class", "<", "?>", ">", "PRIMITIVE_NAME_TO_PRIMITIVE", ";", "static", "{", "Map", "<", "String", ",", "Class", "<", "?>", ">", "tmpMap", "=", "newHashMap", "(", "9", ")", ";", "tmpMap", ".", "put", "(", "boolean", ".", "class", ".", "getName", "(", "),", "boolean", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "char", ".", "class", ".", "getName", "(", "),", "char", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "double", ".", "class", ".", "getName", "(", "),", "double", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "float", ".", "class", ".", "getName", "(", "),", "float", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "long", ".", "class", ".", "getName", "(", "),", "long", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "int", ".", "class", ".", "getName", "(", "),", "int", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "short", ".", "class", ".", "getName", "(", "),", "short", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "byte", ".", "class", ".", "getName", "(", "),", "byte", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "Void", ".", "TYPE", ".", "getName", "(", "),", "Void", ".", "TYPE", ")", ";", "PRIMITIVE_NAME_TO_PRIMITIVE", "=", "Collections", ".", "unmodifiableMap", "(", "tmpMap", ")", ";", "}", "private", "static", "final", "Map", "<", "Class", "<", "?>", ",", "Class", "<", "?>", ">", "PRIMITIVE_TO_WRAPPER_TYPES", ";", "static", "{", "@", "@", "-", "144", ",", "84", "+", "100", ",", "6", "@", "@", "private", "ReflectionHelper", "(", ")", "{", "}", "public", "static", "ClassLoader", "getClassLoaderFromContext", "(", ")", "{", "return", "run", "(", "GetClassLoader", ".", "fromContext", "(", ")", ")", ";", "}", "public", "static", "ClassLoader", "getClassLoaderFromClass", "(", "Class", "<", "?>", "clazz", ")", "{", "return", "run", "(", "GetClassLoader", ".", "fromClass", "(", "clazz", ")", ")", ";", "}", "public", "static", "Class", "<", "?>", "loadClass", "(", "String", "className", ",", "Class", "<", "?>", "caller", ")", "{", "return", "run", "(", "LoadClass", ".", "action", "(", "className", ",", "caller", ")", ")", ";", "}", "public", "static", "Class", "<", "?>", "loadClass", "(", "String", "className", ",", "String", "defaultPackage", ")", "{", "return", "loadClass", "(", "className", ",", "defaultPackage", ",", "ReflectionHelper", ".", "class", ")", ";", "}", "public", "static", "boolean", "isClassPresent", "(", "String", "className", ",", "Class", "<", "?>", "caller", ")", "{", "try", "{", "ReflectionHelper", ".", "loadClass", "(", "className", ",", "caller", ")", ";", "return", "true", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "return", "false", ";", "}", "}", "public", "static", "Class", "<", "?>", "loadClass", "(", "String", "className", ",", "String", "defaultPackage", ",", "Class", "<", "?>", "caller", ")", "{", "if", "(", "PRIMITIVE_NAME_TO_PRIMITIVE", ".", "containsKey", "(", "className", ")", ")", "{", "return", "PRIMITIVE_NAME_TO_PRIMITIVE", ".", "get", "(", "className", ")", ";", "}", "StringBuilder", "fullyQualifiedClass", "=", "new", "StringBuilder", "(", ");", "String", "tmpClassName", "=", "className", ";", "if", "(", "isArrayClassName", "(", "className", ")", ")", "{", "fullyQualifiedClass", ".", "append", "(", "ARRAY_CLASS_NAME_PREFIX", ")", ";", "tmpClassName", "=", "getArrayElementClassName", "(", "className", ")", ";", "}", "if", "(", "isQualifiedClass", "(", "tmpClassName", ")", ")", "{", "fullyQualifiedClass", ".", "append", "(", "tmpClassName", ")", ";", "}", "else", "{", "fullyQualifiedClass", ".", "append", "(", "defaultPackage", ")", ";", "fullyQualifiedClass", ".", "append", "(", "PACKAGE_SEPARATOR", ")", ";", "fullyQualifiedClass", ".", "append", "(", "tmpClassName", ")", ";", "}", "if", "(", "isArrayClassName", "(", "className", ")", ")", "{", "fullyQualifiedClass", ".", "append", "(", "ARRAY_CLASS_NAME_SUFFIX", ")", ";", "}", "return", "loadClass", "(", "fullyQualifiedClass", ".", "toString", "(", "),", "caller", ")", ";", "}", "private", "static", "boolean", "isArrayClassName", "(", "String", "className", ")", "{", "return", "className", ".", "startsWith", "(", "ARRAY_CLASS_NAME_PREFIX", ")", "&", "&", "className", ".", "endsWith", "(", "ARRAY_CLASS_NAME_SUFFIX", ")", ";", "}", "private", "static", "String", "getArrayElementClassName", "(", "String", "className", ")", "{", "return", "className", ".", "substring", "(", "2", ",", "className", ".", "length", "(", ")", "-", "1", ")", ";", "}", "private", "static", "boolean", "isQualifiedClass", "(", "String", "clazz", ")", "{", "return", "clazz", ".", "contains", "(", "PACKAGE_SEPARATOR", ")", ";", "}", "public", "static", "<", "T", ">", "T", "newInstance", "(", "Class", "<", "T", ">", "clazz", ",", "String", "message", ")", "{", "return", "run", "(", "NewInstance", ".", "action", "(", "clazz", ",", "message", ")", ")", ";", "}", "public", "static", "<", "T", ">", "T", "newConstructorInstance", "(", "Constructor", "<", "T", ">", "constructor", ",", "Object", ".", "..", "initArgs", ")", "{", "return", "run", "(", "ConstructorInstance", ".", "action", "(", "constructor", ",", "initArgs", ")", ")", ";", "}", "public", "static", "<", "T", ">", "T", "getAnnotationParameter", "(", "Annotation", "annotation", ",", "String", "parameterName", ",", "Class", "<", "T", ">", "type", ")", "{", "return", "run", "(", "GetAnnotationParameter", ".", "action", "(", "annotation", ",", "parameterName", ",", "type", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "JavaBeans", "property", "name", "of", "the", "given", "member", ".", "*", "<", "p", ">", "@", "@", "-", "301", ",", "42", "+", "179", ",", "6", "@", "@", "else", "if", "(", "methodName", ".", "startsWith", "(", "PROPERTY_ACCESSOR_PREFIX_HAS", ")", "&", "&", "method", ".", "getRet", "return", "false", ";", "}", "/", "**", "*", "Returns", "the", "member", "with", "the", "given", "name", "and", "type", ".", "*", "*", "@", "param", "clazz", "The", "class", "from", "which", "to", "retrieve", "the", "member", ".", "Cannot", "be", "{", "@", "code", "null", "}", ".", "*", "@", "param", "property", "The", "property", "name", "without", "\"", "is", "\"", ",", "\"", "get", "\"", "or", "\"", "has", "\"", ".", "Cannot", "be", "{", "@", "code", "null", "}", "or", "empty", ".", "*", "@", "param", "elementType", "The", "element", "type", ".", "Either", "{", "@", "code", "ElementType", ".", "FIELD", "}", "or", "{", "@", "code", "ElementType", "METHOD", "}", ".", "*", "*", "@", "return", "the", "member", "which", "matching", "the", "name", "and", "type", "or", "{", "@", "code", "null", "}", "if", "no", "such", "member", "exists", ".", "*", "/", "public", "static", "Member", "getMember", "(", "Class", "<", "?>", "clazz", ",", "String", "property", ",", "ElementType", "elementType", ")", "{", "Contracts", ".", "assertNotNull", "(", "clazz", ",", "MESSAGES", ".", "classCannotBeNull", "(", ")", ")", ";", "if", "(", "property", "=", "=", "null", "|", "|", "property", ".", "length", "(", ")", "=", "=", "0", ")", "{", "throw", "log", ".", "getPropertyNameCannotBeNullOrEmptyException", "(", ");", "}", "if", "(", "!", "(", "ElementType", ".", "FIELD", ".", "equals", "(", "elementType", ")", "|", "|", "ElementType", ".", "METHOD", ".", "equals", "(", "elementType", ")", ")", ")", "{", "throw", "log", ".", "getElementTypeHasToBeFieldOrMethodException", "(", ");", "}", "Member", "member", "=", "null", ";", "if", "(", "ElementType", ".", "FIELD", ".", "equals", "(", "elementType", ")", ")", "{", "member", "=", "run", "(", "GetDeclaredField", ".", "action", "(", "clazz", ",", "property", ")", ")", ";", "}", "else", "{", "String", "methodName", "=", "property", ".", "substring", "(", "0", ",", "1", ")", ".", "toUpperCase", "(", ")", "+", "property", ".", "substring", "(", "1", ")", ";", "for", "(", "String", "prefix", ":", "PROPERTY_ACCESSOR_PREFIXES", ")", "{", "member", "=", "run", "(", "GetMethod", ".", "action", "(", "clazz", ",", "prefix", "+", "methodName", ")", ")", ";", "if", "(", "member", "!", "=", "null", ")", "{", "break", ";", "}", "}", "}", "return", "member", ";", "}", "/", "**", "*", "@", "param", "member", "The", "<", "code", ">", "Member", "<", "/", "code", ">", "instance", "for", "which", "to", "retrieve", "the", "type", ".", "*", "@", "@", "-", "420", ",", "10", "+", "262", ",", "6", "@", "@", "public", "static", "Object", "getValue", "(", "Method", "method", ",", "Object", "object", ")", "{", "}", "}", "public", "static", "void", "setAccessibility", "(", "Member", "member", ")", "{", "run", "(", "SetAccessibility", ".", "action", "(", "member", ")", ")", ";", "}", "/", "**", "*", "Determines", "the", "type", "of", "elements", "of", "an", "<", "code", ">", "Iterable", "<", "/", "code", ">", ",", "array", "or", "the", "value", "of", "a", "<", "code", ">", "Map", "<", "/", "code", ">", ".", "*", "@", "@", "-", "565", ",", "128", "+", "403", ",", "6", "@", "@", "public", "static", "Object", "getMappedValue", "(", "Object", "value", ",", "Object", "key", ")", "{", "return", "map", ".", "get", "(", "key", ")", ";", "}", "/", "**", "*", "Returns", "the", "declared", "field", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "*", "@", "param", "clazz", "The", "class", "to", "check", ".", "*", "@", "param", "fieldName", "The", "field", "name", ".", "*", "*", "@", "return", "Returns", "the", "declared", "field", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "/", "public", "static", "Field", "getDeclaredField", "(", "Class", "<", "?>", "clazz", ",", "String", "fieldName", ")", "{", "return", "run", "(", "GetDeclaredField", ".", "action", "(", "clazz", ",", "fieldName", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "fields", "of", "the", "specified", "class", ".", "*", "*", "@", "param", "clazz", "The", "class", "for", "which", "to", "retrieve", "the", "fields", ".", "*", "*", "@", "return", "Returns", "the", "fields", "for", "this", "class", ".", "*", "/", "public", "static", "Field", "[", "]", "getDeclaredFields", "(", "Class", "<", "?>", "clazz", ")", "{", "return", "run", "(", "GetDeclaredFields", ".", "action", "(", "clazz", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "method", "with", "the", "specified", "property", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "This", "method", "will", "*", "prepend", "'", "is", "'", "and", "'", "get", "'", "to", "the", "property", "name", "and", "capitalize", "the", "first", "letter", ".", "*", "*", "@", "param", "clazz", "The", "class", "to", "check", ".", "*", "@", "param", "methodName", "The", "property", "name", ".", "*", "*", "@", "return", "Returns", "the", "method", "with", "the", "specified", "property", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "/", "public", "static", "Method", "getMethodFromPropertyName", "(", "Class", "<", "?>", "clazz", ",", "String", "methodName", ")", "{", "return", "run", "(", "GetMethodFromPropertyName", ".", "action", "(", "clazz", ",", "methodName", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "method", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "*", "@", "param", "clazz", "The", "class", "to", "check", ".", "*", "@", "param", "methodName", "The", "method", "name", ".", "*", "*", "@", "return", "Returns", "the", "method", "with", "the", "specified", "property", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "/", "public", "static", "Method", "getMethod", "(", "Class", "<", "?>", "clazz", ",", "String", "methodName", ")", "{", "return", "run", "(", "GetMethod", ".", "action", "(", "clazz", ",", "methodName", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "declared", "method", "with", "the", "specified", "name", "and", "parameter", "types", "or", "{", "@", "code", "null", "}", "if", "*", "it", "does", "not", "exist", ".", "*", "*", "@", "param", "clazz", "The", "class", "to", "check", ".", "*", "@", "param", "methodName", "The", "method", "name", ".", "*", "@", "param", "parameterTypes", "The", "method", "parameter", "types", ".", "*", "*", "@", "return", "Returns", "the", "declared", "method", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "/", "public", "static", "Method", "getDeclaredMethod", "(", "Class", "<", "?>", "clazz", ",", "String", "methodName", ",", "Class", "<", "?>", "..", ".", "parameterTypes", ")", "{", "return", "run", "(", "GetDeclaredMethod", ".", "action", "(", "clazz", ",", "methodName", ",", "parameterTypes", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "declared", "methods", "of", "the", "specified", "class", ".", "*", "*", "@", "param", "clazz", "The", "class", "for", "which", "to", "retrieve", "the", "methods", ".", "*", "*", "@", "return", "Returns", "the", "declared", "methods", "for", "this", "class", ".", "*", "/", "public", "static", "Method", "[", "]", "getDeclaredMethods", "(", "Class", "<", "?>", "clazz", ")", "{", "return", "run", "(", "GetDeclaredMethods", ".", "action", "(", "clazz", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "methods", "of", "the", "specified", "class", "(", "include", "inherited", "methods", ")", ".", "*", "*", "@", "param", "clazz", "The", "class", "for", "which", "to", "retrieve", "the", "methods", ".", "*", "*", "@", "return", "Returns", "the", "methods", "for", "this", "class", ".", "*", "/", "public", "static", "Method", "[", "]", "getMethods", "(", "Class", "<", "?>", "clazz", ")", "{", "return", "run", "(", "GetMethods", ".", "action", "(", "clazz", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "declared", "constructors", "of", "the", "specified", "class", ".", "*", "*", "@", "param", "clazz", "The", "class", "for", "which", "to", "retrieve", "the", "constructors", ".", "*", "*", "@", "return", "Returns", "the", "declared", "constructors", "for", "this", "class", ".", "*", "/", "public", "static", "Constructor", "<", "?>", "[]", "getDeclaredConstructors", "(", "Class", "<", "?>", "clazz", ")", "{", "return", "run", "(", "GetDeclaredConstructors", ".", "action", "(", "clazz", ")", ")", ";", "}", "/", "**", "*", "Returns", "the", "declared", "constructor", "with", "the", "specified", "parameter", "types", "or", "{", "@", "code", "null", "}", "if", "*", "it", "does", "not", "exist", ".", "*", "*", "@", "param", "clazz", "The", "class", "to", "check", ".", "*", "@", "param", "params", "The", "constructor", "parameter", "types", ".", "*", "@", "param", "<", "T", ">", "The", "type", "of", "class", "to", "get", "the", "constructor", "for", ".", "*", "*", "@", "return", "Returns", "the", "declared", "constructor", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "/", "public", "static", "<", "T", ">", "Constructor", "<", "T", ">", "getDeclaredConstructor", "(", "Class", "<", "T", ">", "clazz", ",", "Class", "<", "?>", "..", ".", "params", ")", "{", "return", "run", "(", "GetDeclaredConstructor", ".", "action", "(", "clazz", ",", "params", ")", ")", ";", "}", "/", "**", "*", "Executes", "the", "given", "privileged", "action", "either", "directly", "or", "with", "privileges", "*", "enabled", ",", "depending", "on", "whether", "a", "security", "manager", "is", "around", "or", "not", ".", "*", "*", "@", "param", "<", "T", ">", "The", "return", "type", "of", "the", "privileged", "action", "to", "run", ".", "*", "@", "param", "action", "The", "action", "to", "run", ".", "*", "*", "@", "return", "The", "result", "of", "the", "privileged", "action", "'", "s", "execution", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "/", "**", "*", "Returns", "the", "auto", "-", "boxed", "type", "of", "a", "primitive", "type", ".", "*", "@", "@", "-", "9", ",", "7", "+", "9", ",", "7", "@", "@", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "@", "@", "-", "18", ",", "9", "+", "18", ",", "12", "@", "@", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetClassLoader", ";", "/", "**", "*", "Helper", "methods", "for", "loading", "resource", "files", "@", "@", "-", "50", ",", "18", "+", "53", ",", "18", "@", "@", "public", "static", "InputStream", "getResettableInputStreamForPath", "(", "String", "path", ")", "{", "boolean", "isContextCL", "=", "true", ";", "/", "/", "try", "the", "context", "class", "loader", "first", "ClassLoader", "loader", "=", "ReflectionHelper", ".", "getClassLoaderFromContext", "(", ");", "ClassLoader", "loader", "=", "run", "(", "GetClassLoader", ".", "fromContext", "(", ")", ")", ";", "if", "(", "loader", "=", "=", "null", ")", "{", "log", ".", "debug", "(", "\"", "No", "default", "context", "class", "loader", ",", "fall", "back", "to", "Bean", "Validation", "'", "s", "loader", "\"", ")", ";", "loader", "=", "ReflectionHelper", ".", "getClassLoaderFromClass", "(", "ResourceLoaderHelper", ".", "class", ")", ";", "loader", "=", "run", "(", "GetClassLoader", ".", "fromClass", "(", "ResourceLoaderHelper", ".", "class", ")", ")", ";", "isContextCL", "=", "false", ";", "}", "InputStream", "inputStream", "=", "loader", ".", "getResourceAsStream", "(", "inputPath", ")", ";", "/", "/", "try", "the", "current", "class", "loader", "if", "(", "isContextCL", "&", "&", "inputStream", "=", "=", "null", ")", "{", "loader", "=", "ReflectionHelper", ".", "getClassLoaderFromClass", "(", "ResourceLoaderHelper", ".", "class", ")", ";", "loader", "=", "run", "(", "GetClassLoader", ".", "fromClass", "(", "ResourceLoaderHelper", ".", "class", ")", ")", ";", "inputStream", "=", "loader", ".", "getResourceAsStream", "(", "inputPath", ")", ";", "}", "@", "@", "-", "75", ",", "4", "+", "78", ",", "14", "@", "@", "else", "if", "(", "inputStream", ".", "markSupported", "(", ")", ")", "{", "return", "new", "BufferedInputStream", "(", "inputStream", ")", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "21", ",", "8", "+", "21", ",", "12", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationHandler", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Proxy", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "ConstructorInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetClassLoader", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredConstructor", ";", "/", "**", "*", "Creates", "live", "annotations", "(", "actually", "{", "@", "link", "AnnotationProxy", "}", "instances", ")", "from", "{", "@", "code", "AnnotationDescriptor", "}", "s", ".", "@", "@", "-", "37", ",", "7", "+", "41", ",", "7", "@", "@", "public", "static", "<", "T", "extends", "Annotation", ">", "T", "create", "(", "AnnotationDescriptor", "<", "T", ">", "descriptor", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "T", ">", "proxyClass", "=", "(", "Class", "<", "T", ">", ")", "Proxy", ".", "getProxyClass", "(", "ReflectionHelper", ".", "getClassLoaderFromClass", "(", "descriptor", ".", "type", "(", ")", ")", ",", "run", "(", "GetClassLoader", ".", "fromClass", "(", "descriptor", ".", "type", "(", ")", ")", ")", ",", "descriptor", ".", "type", "(", ")", ")", ";", "InvocationHandler", "handler", "=", "new", "AnnotationProxy", "(", "descriptor", ")", ";", "@", "@", "-", "55", ",", "10", "+", "59", ",", "20", "@", "@", "private", "static", "<", "T", "extends", "Annotation", ">", "T", "getProxyInstance", "(", "Class", "<", "T", ">", "proxyClass", ",", "InvocationHandler", "handler", ")", "throws", "SecurityException", ",", "NoSuchMethodException", ",", "IllegalArgumentException", ",", "InstantiationException", ",", "IllegalAccessException", ",", "InvocationTargetException", "{", "final", "Constructor", "<", "T", ">", "constructor", "=", "ReflectionHelper", ".", "getDeclaredConstructor", "(", "final", "Constructor", "<", "T", ">", "constructor", "=", "run", "(", "GetDeclaredConstructor", ".", "action", "(", "proxyClass", ",", "InvocationHandler", ".", "class", ")", ";", "return", "ReflectionHelper", ".", "newConstructorInstance", "(", "constructor", ",", "handler", ")", ";", ")", ")", ";", "return", "run", "(", "ConstructorInstance", ".", "action", "(", "constructor", ",", "handler", ")", ")", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "21", ",", "6", "+", "21", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationHandler", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "29", ",", "9", "+", "31", ",", "10", "@", "@", "import", "java", ".", "util", ".", "SortedSet", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethods", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "@", "@", "-", "154", ",", "7", "+", "157", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "private", "Map", "<", "String", ",", "Object", ">", "getAnnotationValues", "(", "AnnotationDescriptor", "<", "?>", "descriptor", ")", "{", "Map", "<", "String", ",", "Object", ">", "result", "=", "newHashMap", "(", ");", "int", "processedValuesFromDescriptor", "=", "0", ";", "final", "Method", "[", "]", "declaredMethods", "=", "ReflectionHelper", ".", "getDeclaredMethods", "(", "annotationType", ")", ";", "final", "Method", "[", "]", "declaredMethods", "=", "run", "(", "GetDeclaredMethods", ".", "action", "(", "annotationType", ")", ")", ";", "for", "(", "Method", "m", ":", "declaredMethods", ")", "{", "if", "(", "descriptor", ".", "containsElement", "(", "m", ".", "getName", "(", ")", ")", ")", "{", "result", ".", "put", "(", "m", ".", "getName", "(", "),", "descriptor", ".", "valueOf", "(", "m", ".", "getName", "(", ")", ")", ")", ";", "@", "@", "-", "252", ",", "8", "+", "255", ",", "7", "@", "@", "private", "boolean", "areEqual", "(", "Object", "o1", ",", "Object", "o2", ")", "{", "private", "Object", "getAnnotationMemberValue", "(", "Annotation", "annotation", ",", "String", "name", ")", "{", "try", "{", "return", "ReflectionHelper", ".", "getDeclaredMethod", "(", "annotation", ".", "annotationType", "(", "),", "name", ")", ".", "invoke", "(", "annotation", ")", ";", "return", "run", "(", "GetDeclaredMethod", ".", "action", "(", "annotation", ".", "annotationType", "(", "),", "name", ")", ")", ".", "invoke", "(", "annotation", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "log", ".", "getUnableToRetrieveAnnotationParameterValueException", "(", "e", ")", ";", "@", "@", "-", "265", ",", "4", "+", "267", ",", "14", "@", "@", "private", "Object", "getAnnotationMemberValue", "(", "Annotation", "annotation", ",", "String", "name", ")", "{", "throw", "log", ".", "getUnableToRetrieveAnnotationParameterValueException", "(", "e", ")", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "16", ",", "14", "+", "16", ",", "11", "@", "@", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "classhierarchy", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Contracts", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "130", ",", "26", "+", "127", ",", "4", "@", "@", "private", "static", "boolean", "acceptedByAllFilters", "(", "Class", "<", "?>", "clazz", ",", "Iterable", "<", "Filter", ">", "fil", "getImplementedInterfaces", "(", "currentInterfaceCasted", ",", "classes", ")", ";", "}", "}", "/", "**", "*", "Get", "a", "list", "of", "all", "methods", "wich", "the", "given", "class", "declares", ",", "implements", ",", "*", "overrides", "or", "inherits", ".", "Methods", "are", "added", "by", "adding", "first", "all", "methods", "of", "*", "the", "class", "itself", "and", "its", "implemented", "interfaces", ",", "then", "the", "super", "class", "and", "*", "its", "interfaces", ",", "etc", ".", "*", "*", "@", "param", "clazz", "the", "class", "for", "which", "to", "retrieve", "the", "methods", "*", "*", "@", "return", "set", "of", "all", "methods", "of", "the", "given", "class", "*", "/", "public", "static", "List", "<", "Method", ">", "getAllMethods", "(", "Class", "<", "?>", "clazz", ")", "{", "Contracts", ".", "assertNotNull", "(", "clazz", ")", ";", "List", "<", "Method", ">", "methods", "=", "newArrayList", "(", ");", "for", "(", "Class", "<", "?>", "hierarchyClass", ":", "getHierarchy", "(", "clazz", ")", ")", "{", "Collections", ".", "addAll", "(", "methods", ",", "ReflectionHelper", ".", "getMethods", "(", "hierarchyClass", ")", ")", ";", "}", "return", "methods", ";", "}", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Returns", "the", "declared", "constructor", "with", "the", "specified", "parameter", "types", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "/", "public", "final", "class", "GetDeclaredConstructor", "<", "T", ">", "implements", "PrivilegedAction", "<", "Constructor", "<", "T", ">", ">", "{", "@", "@", "-", "35", ",", "6", "+", "37", ",", "7", "@", "@", "private", "GetDeclaredConstructor", "(", "Class", "<", "T", ">", "clazz", ",", "Class", "<", "?>", "..", ".", "params", ")", "{", "this", ".", "params", "=", "params", ";", "}", "@", "Override", "public", "Constructor", "<", "T", ">", "run", "(", ")", "{", "try", "{", "return", "clazz", ".", "getDeclaredConstructor", "(", "params", ")", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Returns", "the", "declared", "constructors", "of", "the", "specified", "class", ".", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "final", "class", "GetDeclaredConstructors", "implements", "PrivilegedAction", "<", "Constructor", "<", "?>", "[]", ">", "{", "@", "@", "-", "33", ",", "6", "+", "35", ",", "7", "@", "@", "private", "GetDeclaredConstructors", "(", "Class", "<", "?>", "clazz", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "}", "@", "Override", "public", "Constructor", "<", "?>", "[]", "run", "(", ")", "{", "return", "clazz", ".", "getDeclaredConstructors", "(", ");", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Returns", "the", "declared", "field", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "/", "public", "final", "class", "GetDeclaredField", "implements", "PrivilegedAction", "<", "Field", ">", "{", "@", "@", "-", "35", ",", "6", "+", "37", ",", "7", "@", "@", "private", "GetDeclaredField", "(", "Class", "<", "?>", "clazz", ",", "String", "fieldName", ")", "{", "this", ".", "fieldName", "=", "fieldName", ";", "}", "@", "Override", "public", "Field", "run", "(", ")", "{", "try", "{", "final", "Field", "field", "=", "clazz", ".", "getDeclaredField", "(", "fieldName", ")", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "/", "**", "*", "Returns", "the", "fields", "of", "the", "specified", "class", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "/", "public", "final", "class", "GetDeclaredFields", "implements", "PrivilegedAction", "<", "Field", "[", "]>", "{", "@", "@", "-", "33", ",", "6", "+", "35", ",", "7", "@", "@", "private", "GetDeclaredFields", "(", "Class", "<", "?>", "clazz", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "}", "@", "Override", "public", "Field", "[", "]", "run", "(", ")", "{", "return", "clazz", ".", "getDeclaredFields", "(", ");", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Returns", "the", "declared", "method", "with", "the", "specified", "name", "and", "parameter", "types", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "*", "@", "author", "Kevin", "Pollet", "&", "lt", ";", "kevin", ".", "pollet", "@", "serli", ".", "com", "&", "gt", ";", "(", "C", ")", "2011", "SERLI", "*", "/", "public", "final", "class", "GetDeclaredMethod", "implements", "PrivilegedAction", "<", "Method", ">", "{", "@", "@", "-", "37", ",", "6", "+", "39", ",", "7", "@", "@", "private", "GetDeclaredMethod", "(", "Class", "<", "?>", "clazz", ",", "String", "methodName", ",", "Class", "<", "?>", "..", ".", "paramet", "this", ".", "parameterTypes", "=", "parameterTypes", ";", "}", "@", "Override", "public", "Method", "run", "(", ")", "{", "try", "{", "return", "clazz", ".", "getDeclaredMethod", "(", "methodName", ",", "parameterTypes", ")", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "/", "**", "*", "Returns", "the", "declared", "methods", "of", "the", "specified", "class", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "/", "public", "final", "class", "GetDeclaredMethods", "implements", "PrivilegedAction", "<", "Method", "[", "]>", "{", "@", "@", "-", "33", ",", "6", "+", "35", ",", "7", "@", "@", "private", "GetDeclaredMethods", "(", "Class", "<", "?>", "clazz", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "}", "@", "Override", "public", "Method", "[", "]", "run", "(", ")", "{", "return", "clazz", ".", "getDeclaredMethods", "(", ");", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Returns", "the", "method", "with", "the", "specified", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "/", "public", "final", "class", "GetMethod", "implements", "PrivilegedAction", "<", "Method", ">", "{", "@", "@", "-", "35", ",", "6", "+", "37", ",", "7", "@", "@", "private", "GetMethod", "(", "Class", "<", "?>", "clazz", ",", "String", "methodName", ")", "{", "this", ".", "methodName", "=", "methodName", ";", "}", "@", "Override", "public", "Method", "run", "(", ")", "{", "try", "{", "return", "clazz", ".", "getMethod", "(", "methodName", ")", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "9", "@", "@", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Returns", "the", "method", "with", "the", "specified", "property", "name", "or", "{", "@", "code", "null", "}", "if", "it", "does", "not", "exist", ".", "This", "method", "will", "prepend", "*", "'", "is", "'", "and", "'", "get", "'", "to", "the", "property", "name", "and", "capitalize", "the", "first", "letter", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "@", "@", "-", "36", ",", "6", "+", "39", ",", "7", "@", "@", "private", "GetMethodFromPropertyName", "(", "Class", "<", "?>", "clazz", ",", "String", "property", ")", "{", "this", ".", "property", "=", "property", ";", "}", "@", "Override", "public", "Method", "run", "(", ")", "{", "try", "{", "char", "[", "]", "string", "=", "property", ".", "toCharArray", "(", ");", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "/", "**", "*", "Returns", "the", "methods", "of", "the", "specified", "class", "(", "include", "inherited", "methods", ")", ".", "*", "*", "@", "author", "Emmanuel", "Bernard", "*", "/", "public", "final", "class", "GetMethods", "implements", "PrivilegedAction", "<", "Method", "[", "]>", "{", "@", "@", "-", "33", ",", "6", "+", "35", ",", "7", "@", "@", "private", "GetMethods", "(", "Class", "<", "?>", "clazz", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "}", "@", "Override", "public", "Method", "[", "]", "run", "(", ")", "{", "return", "clazz", ".", "getMethods", "(", ");", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "119", "@", "@", "/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", "*", "Copyright", "2014", ",", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", ",", "and", "individual", "contributors", "*", "by", "the", "@", "authors", "tag", ".", "See", "the", "copyright", ".", "txt", "in", "the", "distribution", "for", "a", "*", "full", "listing", "of", "individual", "contributors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "/", "**", "*", "A", "helper", "for", "loading", "classes", "by", "names", ",", "as", "given", "in", "XML", "constraint", "mappings", ".", "Given", "names", "can", "be", "the", "names", "of", "primitive", "*", "types", ",", "qualified", "names", "or", "unqualified", "names", "(", "in", "which", "case", "a", "given", "default", "package", "will", "be", "assumed", ")", ".", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "/", "*", "package", "*", "/", "class", "ClassLoadingHelper", "{", "private", "static", "final", "String", "PACKAGE_SEPARATOR", "=", "\"", ".\"", ";", "private", "static", "final", "String", "ARRAY_CLASS_NAME_PREFIX", "=", "\"", "[", "L", "\"", ";", "private", "static", "final", "String", "ARRAY_CLASS_NAME_SUFFIX", "=", "\"", ";\"", ";", "private", "static", "final", "Map", "<", "String", ",", "Class", "<", "?>", ">", "PRIMITIVE_NAME_TO_PRIMITIVE", ";", "static", "{", "Map", "<", "String", ",", "Class", "<", "?>", ">", "tmpMap", "=", "newHashMap", "(", "9", ")", ";", "tmpMap", ".", "put", "(", "boolean", ".", "class", ".", "getName", "(", "),", "boolean", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "char", ".", "class", ".", "getName", "(", "),", "char", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "double", ".", "class", ".", "getName", "(", "),", "double", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "float", ".", "class", ".", "getName", "(", "),", "float", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "long", ".", "class", ".", "getName", "(", "),", "long", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "int", ".", "class", ".", "getName", "(", "),", "int", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "short", ".", "class", ".", "getName", "(", "),", "short", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "byte", ".", "class", ".", "getName", "(", "),", "byte", ".", "class", ")", ";", "tmpMap", ".", "put", "(", "Void", ".", "TYPE", ".", "getName", "(", "),", "Void", ".", "TYPE", ")", ";", "PRIMITIVE_NAME_TO_PRIMITIVE", "=", "Collections", ".", "unmodifiableMap", "(", "tmpMap", ")", ";", "}", "private", "ClassLoadingHelper", "(", ")", "{", "}", "/", "*", "package", "*", "/", "static", "Class", "<", "?>", "loadClass", "(", "String", "className", ",", "String", "defaultPackage", ")", "{", "return", "loadClass", "(", "className", ",", "defaultPackage", ",", "ReflectionHelper", ".", "class", ")", ";", "}", "/", "*", "package", "*", "/", "static", "Class", "<", "?>", "loadClass", "(", "String", "className", ",", "String", "defaultPackage", ",", "Class", "<", "?>", "caller", ")", "{", "if", "(", "PRIMITIVE_NAME_TO_PRIMITIVE", ".", "containsKey", "(", "className", ")", ")", "{", "return", "PRIMITIVE_NAME_TO_PRIMITIVE", ".", "get", "(", "className", ")", ";", "}", "StringBuilder", "fullyQualifiedClass", "=", "new", "StringBuilder", "(", ");", "String", "tmpClassName", "=", "className", ";", "if", "(", "isArrayClassName", "(", "className", ")", ")", "{", "fullyQualifiedClass", ".", "append", "(", "ARRAY_CLASS_NAME_PREFIX", ")", ";", "tmpClassName", "=", "getArrayElementClassName", "(", "className", ")", ";", "}", "if", "(", "isQualifiedClass", "(", "tmpClassName", ")", ")", "{", "fullyQualifiedClass", ".", "append", "(", "tmpClassName", ")", ";", "}", "else", "{", "fullyQualifiedClass", ".", "append", "(", "defaultPackage", ")", ";", "fullyQualifiedClass", ".", "append", "(", "PACKAGE_SEPARATOR", ")", ";", "fullyQualifiedClass", ".", "append", "(", "tmpClassName", ")", ";", "}", "if", "(", "isArrayClassName", "(", "className", ")", ")", "{", "fullyQualifiedClass", ".", "append", "(", "ARRAY_CLASS_NAME_SUFFIX", ")", ";", "}", "return", "loadClass", "(", "fullyQualifiedClass", ".", "toString", "(", "),", "caller", ")", ";", "}", "private", "static", "Class", "<", "?>", "loadClass", "(", "String", "className", ",", "Class", "<", "?>", "caller", ")", "{", "return", "run", "(", "LoadClass", ".", "action", "(", "className", ",", "caller", ")", ")", ";", "}", "private", "static", "boolean", "isArrayClassName", "(", "String", "className", ")", "{", "return", "className", ".", "startsWith", "(", "ARRAY_CLASS_NAME_PREFIX", ")", "&", "&", "className", ".", "endsWith", "(", "ARRAY_CLASS_NAME_SUFFIX", ")", ";", "}", "private", "static", "String", "getArrayElementClassName", "(", "String", "className", ")", "{", "return", "className", ".", "substring", "(", "2", ",", "className", ".", "length", "(", ")", "-", "1", ")", ";", "}", "private", "static", "boolean", "isQualifiedClass", "(", "String", "clazz", ")", "{", "return", "clazz", ".", "contains", "(", "PACKAGE_SEPARATOR", ")", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "18", ",", "6", "+", "18", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "34", ",", "10", "+", "36", ",", "11", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedExecutable", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedParameter", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ExecutableElement", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "StringHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredConstructor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethod", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "@", "@", "-", "73", ",", "10", "+", "76", ",", "12", "@", "@", "private", "ConstrainedExecutableBuilder", "(", ")", "{", "String", "methodName", "=", "methodType", ".", "getName", "(", ");", "final", "Method", "method", "=", "ReflectionHelper", ".", "getDeclaredMethod", "(", "beanClass", ",", "methodName", ",", "parameterTypes", ".", "toArray", "(", "new", "Class", "[", "parameterTypes", ".", "size", "(", ")]", ")", "final", "Method", "method", "=", "run", "(", "GetDeclaredMethod", ".", "action", "(", "beanClass", ",", "methodName", ",", "parameterTypes", ".", "toArray", "(", "new", "Class", "[", "parameterTypes", ".", "size", "(", ")]", ")", ")", ")", ";", "if", "(", "method", "=", "=", "null", ")", "{", "@", "@", "-", "136", ",", "9", "+", "141", ",", "11", "@", "@", "private", "ConstrainedExecutableBuilder", "(", ")", "{", "defaultPackage", ")", ";", "final", "Constructor", "<", "?>", "constructor", "=", "ReflectionHelper", ".", "getDeclaredConstructor", "(", "beanClass", ",", "constructorParameterTypes", ".", "toArray", "(", "new", "Class", "[", "constructorParameterTypes", ".", "size", "(", ")]", ")", "final", "Constructor", "<", "?>", "constructor", "=", "run", "(", "GetDeclaredConstructor", ".", "action", "(", "beanClass", ",", "constructorParameterTypes", ".", "toArray", "(", "new", "Class", "[", "constructorParameterTypes", ".", "size", "(", ")]", ")", ")", ")", ";", "if", "(", "constructor", "=", "=", "null", ")", "{", "@", "@", "-", "317", ",", "7", "+", "324", ",", "7", "@", "@", "private", "static", "boolean", "parseReturnValueType", "(", "ReturnValueType", "returnValueType", ",", "String", "type", "=", "null", ";", "try", "{", "type", "=", "parameterType", ".", "getType", "(", ");", "Class", "<", "?>", "parameterClass", "=", "ReflectionHelper", ".", "loadClass", "(", "type", ",", "defaultPackage", ")", ";", "Class", "<", "?>", "parameterClass", "=", "ClassLoadingHelper", ".", "loadClass", "(", "type", ",", "defaultPackage", ")", ";", "parameterTypes", ".", "add", "(", "parameterClass", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "@", "@", "-", "327", ",", "4", "+", "334", ",", "14", "@", "@", "private", "static", "boolean", "parseReturnValueType", "(", "ReturnValueType", "returnValueType", ",", "return", "parameterTypes", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "27", ",", "9", "+", "29", ",", "9", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "location", ".", "ConstraintLocation", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConfigurationSource", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedField", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredField", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "103", ",", "12", "+", "105", ",", "20", "@", "@", "private", "static", "Field", "findField", "(", "Class", "<", "?>", "beanClass", ",", "String", "fieldName", ",", "List", "<", "String", "alreadyProcessedFieldNames", ".", "add", "(", "fieldName", ")", ";", "}", "final", "Field", "field", "=", "ReflectionHelper", ".", "getDeclaredField", "(", "beanClass", ",", "fieldName", ")", ";", "final", "Field", "field", "=", "run", "(", "GetDeclaredField", ".", "action", "(", "beanClass", ",", "fieldName", ")", ")", ";", "if", "(", "field", "=", "=", "null", ")", "{", "throw", "log", ".", "getBeanDoesNotContainTheFieldException", "(", "beanClass", ".", "getName", "(", "),", "fieldName", ")", ";", "}", "return", "field", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "29", ",", "9", "+", "31", ",", "9", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConfigurationSource", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedExecutable", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedParameter", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethodFromPropertyName", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "108", ",", "13", "+", "110", ",", "21", "@", "@", "private", "static", "Method", "findGetter", "(", "Class", "<", "?>", "beanClass", ",", "String", "getterName", ",", "List", "<", "Str", "alreadyProcessedGetterNames", ".", "add", "(", "getterName", ")", ";", "}", "final", "Method", "method", "=", "ReflectionHelper", ".", "getMethodFromPropertyName", "(", "beanClass", ",", "getterName", ")", ";", "final", "Method", "method", "=", "run", "(", "GetMethodFromPropertyName", ".", "action", "(", "beanClass", ",", "getterName", ")", ")", ";", "if", "(", "method", "=", "=", "null", ")", "{", "throw", "log", ".", "getBeanDoesNotContainThePropertyException", "(", "beanClass", ".", "getName", "(", "),", "getterName", ")", ";", "}", "return", "method", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "26", ",", "7", "+", "26", ",", "6", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "location", ".", "ConstraintLocation", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConfigurationSource", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedType", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashSet", ";", "@", "@", "-", "91", ",", "7", "+", "90", ",", "7", "@", "@", "public", "static", "ConstrainedType", "buildConstrainedType", "(", "ClassType", "classType", ",", "List", "<", "Class", "<", "?>", ">", "groupSequence", "=", "newArrayList", "(", ");", "if", "(", "groupSequenceType", "!", "=", "null", ")", "{", "for", "(", "String", "groupName", ":", "groupSequenceType", ".", "getValue", "(", ")", ")", "{", "Class", "<", "?>", "group", "=", "ReflectionHelper", ".", "loadClass", "(", "groupName", ",", "defaultPackage", ")", ";", "Class", "<", "?>", "group", "=", "ClassLoadingHelper", ".", "loadClass", "(", "groupName", ",", "defaultPackage", ")", ";", "groupSequence", ".", "add", "(", "group", ")", ";", "}", "}", "@", "@", "-", "19", ",", "8", "+", "19", ",", "6", "@", "@", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "/", "**", "@", "@", "-", "37", ",", "13", "+", "35", ",", "11", "@", "@", "private", "GroupConversionBuilder", "(", ")", "{", "String", "defaultPackage", ")", "{", "Map", "<", "Class", "<", "?>", ",", "Class", "<", "?>", ">", "groupConversionMap", "=", "newHashMap", "(", ");", "for", "(", "GroupConversionType", "groupConversionType", ":", "groupConversionTypes", ")", "{", "Class", "<", "?>", "fromClass", "=", "ReflectionHelper", ".", "loadClass", "(", "groupConversionType", ".", "getFrom", "(", "),", "defaultPackage", ")", ";", "Class", "<", "?>", "toClass", "=", "ReflectionHelper", ".", "loadClass", "(", "groupConversionType", ".", "getTo", "(", "),", "defaultPackage", ")", ";", "Class", "<", "?>", "fromClass", "=", "ClassLoadingHelper", ".", "loadClass", "(", "groupConversionType", ".", "getFrom", "(", "),", "defaultPackage", ")", ";", "Class", "<", "?>", "toClass", "=", "ClassLoadingHelper", ".", "loadClass", "(", "groupConversionType", ".", "getTo", "(", "),", "defaultPackage", ")", ";", "groupConversionMap", ".", "put", "(", "fromClass", ",", "toClass", ")", ";", "}", "return", "groupConversionMap", ";", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "10", "@", "@", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Array", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "validation", ".", "Payload", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "@", "@", "-", "29", ",", "11", "+", "32", ",", "11", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "MetaConstraint", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "descriptor", ".", "ConstraintDescriptorImpl", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "location", ".", "ConstraintLocation", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "annotationfactory", ".", "AnnotationDescriptor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "annotationfactory", ".", "AnnotationFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "@", "@", "-", "61", ",", "7", "+", "64", ",", "7", "@", "@", "private", "MetaConstraintBuilder", "(", ")", "{", "ConstraintDescriptorImpl", ".", "ConstraintType", "constraintType", ")", "{", "Class", "<", "A", ">", "annotationClass", ";", "try", "{", "annotationClass", "=", "(", "Class", "<", "A", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "constraint", ".", "getAnnotation", "(", "),", "defaultPackage", ")", ";", "annotationClass", "=", "(", "Class", "<", "A", ">", ")", "ClassLoadingHelper", ".", "loadClass", "(", "constraint", ".", "getAnnotation", "(", "),", "defaultPackage", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "throw", "log", ".", "getUnableToLoadConstraintAnnotationClassException", "(", "constraint", ".", "getAnnotation", "(", "),", "e", ")", ";", "@", "@", "-", "117", ",", "7", "+", "120", ",", "7", "@", "@", "private", "static", "void", "checkNameIsValid", "(", "String", "name", ")", "{", "}", "private", "static", "<", "A", "extends", "Annotation", ">", "Class", "<", "?>", "getAnnotationParameterType", "(", "Class", "<", "A", ">", "annotationClass", ",", "String", "name", ")", "{", "Method", "m", "=", "ReflectionHelper", ".", "getMethod", "(", "annotationClass", ",", "name", ")", ";", "Method", "m", "=", "run", "(", "GetMethod", ".", "action", "(", "annotationClass", ",", "name", ")", ")", ";", "if", "(", "m", "=", "=", "null", ")", "{", "throw", "log", ".", "getAnnotationDoesNotContainAParameterException", "(", "annotationClass", ".", "getName", "(", "),", "name", ")", ";", "}", "@", "@", "-", "249", ",", "7", "+", "252", ",", "7", "@", "@", "else", "if", "(", "returnType", ".", "getName", "(", ").", "equals", "(", "String", ".", "class", ".", "getName", "(", ")", ")", ")", "{", "returnValue", "=", "value", ";", "}", "else", "if", "(", "returnType", ".", "getName", "(", ").", "equals", "(", "Class", ".", "class", ".", "getName", "(", ")", ")", ")", "{", "returnValue", "=", "ReflectionHelper", ".", "loadClass", "(", "value", ",", "defaultPackage", ",", "MetaConstraintBuilder", ".", "class", ")", ";", "returnValue", "=", "ClassLoadingHelper", ".", "loadClass", "(", "value", ",", "defaultPackage", ",", "MetaConstraintBuilder", ".", "class", ")", ";", "}", "else", "{", "try", "{", "@", "@", "-", "271", ",", "7", "+", "274", ",", "7", "@", "@", "else", "if", "(", "returnType", ".", "getName", "(", ").", "equals", "(", "Class", ".", "class", ".", "getName", "(", ")", ")", ")", "{", "List", "<", "Class", "<", "?>", ">", "groupList", "=", "newArrayList", "(", ");", "for", "(", "String", "groupClass", ":", "groupsType", ".", "getValue", "(", ")", ")", "{", "groupList", ".", "add", "(", "ReflectionHelper", ".", "loadClass", "(", "groupClass", ",", "defaultPackage", ")", ")", ";", "groupList", ".", "add", "(", "ClassLoadingHelper", ".", "loadClass", "(", "groupClass", ",", "defaultPackage", ")", ")", ";", "}", "return", "groupList", ".", "toArray", "(", "new", "Class", "[", "groupList", ".", "size", "(", ")]", ")", ";", "}", "@", "@", "-", "284", ",", "7", "+", "287", ",", "7", "@", "@", "else", "if", "(", "returnType", ".", "getName", "(", ").", "equals", "(", "Class", ".", "class", ".", "getName", "(", ")", ")", ")", "{", "List", "<", "Class", "<", "?", "extends", "Payload", ">", ">", "payloadList", "=", "newArrayList", "(", ");", "for", "(", "String", "groupClass", ":", "payloadType", ".", "getValue", "(", ")", ")", "{", "Class", "<", "?>", "payload", "=", "ReflectionHelper", ".", "loadClass", "(", "groupClass", ",", "defaultPackage", ")", ";", "Class", "<", "?>", "payload", "=", "ClassLoadingHelper", ".", "loadClass", "(", "groupClass", ",", "defaultPackage", ")", ";", "if", "(", "!", "Payload", ".", "class", ".", "isAssignableFrom", "(", "payload", ")", ")", "{", "throw", "log", ".", "getWrongPayloadClassException", "(", "payload", ".", "getName", "(", ")", ")", ";", "}", "@", "@", "-", "294", ",", "6", "+", "297", ",", "14", "@", "@", "else", "if", "(", "returnType", ".", "getName", "(", ").", "equals", "(", "Class", ".", "class", ".", "getName", "(", ")", ")", ")", "{", "}", "return", "payloadList", ".", "toArray", "(", "new", "Class", "[", "payloadList", ".", "size", "(", ")]", ")", ";", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "static", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "30", ",", "10", "+", "32", ",", "11", "@", "@", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "validation", ".", "spi", ".", "ValidationProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ResourceLoaderHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewInstance", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "spi", ".", "valuehandling", ".", "ValidatedValueUnwrapper", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "@", "@", "-", "141", ",", "9", "+", "144", ",", "8", "@", "@", "public", "void", "setParameterNameProvider", "(", "ParameterNameProvider", "parameterNameProvider", "private", "void", "setProviderClass", "(", "String", "providerFqcn", ")", "{", "if", "(", "providerFqcn", "!", "=", "null", ")", "{", "try", "{", "providerClass", "=", "(", "Class", "<", "?", "extends", "ValidationProvider", "<", "?>", ">)", "ReflectionHelper", ".", "loadClass", "(", "providerFqcn", ",", "this", ".", "getClass", "(", ")", "providerClass", "=", "(", "Class", "<", "?", "extends", "ValidationProvider", "<", "?>", ">)", "run", "(", "LoadClass", ".", "action", "(", "providerFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "log", ".", "usingValidationProvider", "(", "providerFqcn", ")", ";", "}", "@", "@", "-", "157", ",", "10", "+", "159", ",", "10", "@", "@", "private", "void", "setMessageInterpolator", "(", "String", "messageInterpolatorFqcn", ")", "{", "if", "(", "messageInterpolatorFqcn", "!", "=", "null", ")", "{", "try", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "MessageInterpolator", ">", "messageInterpolatorClass", "=", "(", "Class", "<", "MessageInterpolator", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "messageInterpolatorFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "MessageInterpolator", ">", "messageInterpolatorClass", "=", "(", "Class", "<", "MessageInterpolator", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "messageInterpolatorFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "messageInterpolator", "=", "ReflectionHelper", ".", "newInstance", "(", "messageInterpolatorClass", ",", "\"", "message", "interpolator", "\"", ")", ";", "messageInterpolator", "=", "run", "(", "NewInstance", ".", "action", "(", "messageInterpolatorClass", ",", "\"", "message", "interpolator", "\"", ")", ")", ";", "log", ".", "usingMessageInterpolator", "(", "messageInterpolatorFqcn", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "@", "@", "-", "173", ",", "10", "+", "175", ",", "10", "@", "@", "private", "void", "setTraversableResolver", "(", "String", "traversableResolverFqcn", ")", "{", "if", "(", "traversableResolverFqcn", "!", "=", "null", ")", "{", "try", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "TraversableResolver", ">", "clazz", "=", "(", "Class", "<", "TraversableResolver", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "traversableResolverFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "TraversableResolver", ">", "clazz", "=", "(", "Class", "<", "TraversableResolver", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "traversableResolverFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "traversableResolver", "=", "ReflectionHelper", ".", "newInstance", "(", "clazz", ",", "\"", "traversable", "resolver", "\"", ")", ";", "traversableResolver", "=", "run", "(", "NewInstance", ".", "action", "(", "clazz", ",", "\"", "traversable", "resolver", "\"", ")", ")", ";", "log", ".", "usingTraversableResolver", "(", "traversableResolverFqcn", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "@", "@", "-", "189", ",", "10", "+", "191", ",", "10", "@", "@", "private", "void", "setConstraintFactory", "(", "String", "constraintFactoryFqcn", ")", "{", "if", "(", "constraintFactoryFqcn", "!", "=", "null", ")", "{", "try", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "ConstraintValidatorFactory", ">", "clazz", "=", "(", "Class", "<", "ConstraintValidatorFactory", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "constraintFactoryFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "ConstraintValidatorFactory", ">", "clazz", "=", "(", "Class", "<", "ConstraintValidatorFactory", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "constraintFactoryFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "constraintValidatorFactory", "=", "ReflectionHelper", ".", "newInstance", "(", "clazz", ",", "\"", "constraint", "factory", "class", "\"", ")", ";", "constraintValidatorFactory", "=", "run", "(", "NewInstance", ".", "action", "(", "clazz", ",", "\"", "constraint", "factory", "class", "\"", ")", ")", ";", "log", ".", "usingConstraintFactory", "(", "constraintFactoryFqcn", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "@", "@", "-", "205", ",", "10", "+", "207", ",", "10", "@", "@", "private", "void", "setParameterNameProvider", "(", "String", "parameterNameProviderFqcn", ")", "{", "if", "(", "parameterNameProviderFqcn", "!", "=", "null", ")", "{", "try", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "ParameterNameProvider", ">", "clazz", "=", "(", "Class", "<", "ParameterNameProvider", ">", ")", "ReflectionHelper", ".", "loadClass", "(", "parameterNameProviderFqcn", ",", "this", ".", "getClass", "(", ")", "Class", "<", "ParameterNameProvider", ">", "clazz", "=", "(", "Class", "<", "ParameterNameProvider", ">", ")", "run", "(", "LoadClass", ".", "action", "(", "parameterNameProviderFqcn", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "parameterNameProvider", "=", "ReflectionHelper", ".", "newInstance", "(", "clazz", ",", "\"", "parameter", "name", "provider", "class", "\"", ")", ";", "parameterNameProvider", "=", "run", "(", "NewInstance", ".", "action", "(", "clazz", ",", "\"", "parameter", "name", "provider", "class", "\"", ")", ")", ";", "log", ".", "usingParameterNameProvider", "(", "parameterNameProviderFqcn", ")", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "@", "@", "-", "235", ",", "6", "+", "237", ",", "16", "@", "@", "private", "void", "setConfigProperties", "(", "Map", "<", "String", ",", "String", ">", "properties", ")", "{", "}", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "public", "void", "addValidatedValueHandler", "(", "ValidatedValueUnwrapper", "<", "?>", "handler", ")", "{", "validatedValueHandlers", ".", "add", "(", "handler", ")", ";", "}", "@", "@", "-", "20", ",", "12", "+", "20", ",", "15", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "javax", ".", "validation", ".", "ConstraintValidator", ";", "import", "javax", ".", "validation", ".", "ParameterNameProvider", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "@", "@", "-", "43", ",", "9", "+", "46", ",", "9", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedExecutable", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedField", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "ConstrainedType", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "@", "@", "-", "118", ",", "7", "+", "121", ",", "7", "@", "@", "public", "final", "void", "parse", "(", "Set", "<", "InputStream", ">", "mappingStreams", ")", "{", ")", ";", "for", "(", "BeanType", "bean", ":", "mapping", ".", "getBean", "(", ")", ")", "{", "Class", "<", "?>", "beanClass", "=", "ReflectionHelper", ".", "loadClass", "(", "bean", ".", "getClazz", "(", "),", "defaultPackage", ")", ";", "Class", "<", "?>", "beanClass", "=", "ClassLoadingHelper", ".", "loadClass", "(", "bean", ".", "getClazz", "(", "),", "defaultPackage", ")", ";", "checkClassHasNotBeenProcessed", "(", "processedClasses", ",", "beanClass", ")", ";", "/", "/", "update", "annotation", "ignores", "@", "@", "-", "220", ",", "7", "+", "223", ",", "7", "@", "@", "private", "void", "parseConstraintDefinitions", "(", "List", "<", "ConstraintDefinitionType", ">", "constrain", "alreadyProcessedConstraintDefinitions", ".", "add", "(", "annotationClassName", ")", ";", "}", "Class", "<", "?>", "clazz", "=", "ReflectionHelper", ".", "loadClass", "(", "annotationClassName", ",", "defaultPackage", ")", ";", "Class", "<", "?>", "clazz", "=", "ClassLoadingHelper", ".", "loadClass", "(", "annotationClassName", ",", "defaultPackage", ")", ";", "if", "(", "!", "clazz", ".", "isAnnotation", "(", ")", ")", "{", "throw", "log", ".", "getIsNotAnAnnotationException", "(", "annotationClassName", ")", ";", "}", "@", "@", "-", "235", ",", "11", "+", "238", ",", "9", "@", "@", "private", "void", "parseConstraintDefinitions", "(", "List", "<", "ConstraintDefinitionType", ">", "constrain", "for", "(", "String", "validatorClassName", ":", "validatedByType", ".", "getValue", "(", ")", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "?", "extends", "ConstraintValidator", "<", "A", ",", "?", ">>", "validatorClass", "=", "(", "Class", "<", "?", "extends", "ConstraintValidator", "<", "A", ",", "?", ">>", ")", "ReflectionHelper", ".", "loadClass", "(", "validatorClassName", ",", "this", ".", "getClass", "(", ")", ")", ";", "Class", "<", "?", "extends", "ConstraintValidator", "<", "A", ",", "?", ">>", "validatorClass", "=", "(", "Class", "<", "?", "extends", "ConstraintValidator", "<", "A", ",", "?", ">>", ")", "run", "(", "LoadClass", ".", "action", "(", "validatorClassName", ",", "this", ".", "getClass", "(", ")", ")", ")", ";", "if", "(", "!", "ConstraintValidator", ".", "class", ".", "isAssignableFrom", "(", "validatorClass", ")", ")", "{", "@", "@", "-", "335", ",", "6", "+", "336", ",", "16", "@", "@", "private", "String", "getSchemaResourceName", "(", "String", "schemaVersion", ")", "{", "return", "schemaResource", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "/", "/", "JAXB", "closes", "the", "underlying", "input", "stream", "private", "static", "class", "CloseIgnoringInputStream", "extends", "FilterInputStream", "{", "public", "CloseIgnoringInputStream", "(", "InputStream", "in", ")", "{", "@", "@", "-", "19", ",", "8", "+", "19", ",", "11", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "javax", ".", "xml", ".", "namespace", ".", "QName", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLEventReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "@", "@", "-", "32", ",", "11", "+", "35", ",", "10", "@", "@", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Contracts", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetClassLoader", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Messages", ".", "MESSAGES", ";", "@", "@", "-", "148", ",", "7", "+", "150", ",", "7", "@", "@", "public", "Schema", "getSchema", "(", "String", "schemaResource", ")", "{", "}", "private", "Schema", "loadSchema", "(", "String", "schemaResource", ")", "{", "ClassLoader", "loader", "=", "ReflectionHelper", ".", "getClassLoaderFromClass", "(", "XmlParserHelper", ".", "class", ")", ";", "ClassLoader", "loader", "=", "run", "(", "GetClassLoader", ".", "fromClass", "(", "XmlParserHelper", ".", "class", ")", ")", ";", "URL", "schemaUrl", "=", "loader", ".", "getResource", "(", "schemaResource", ")", ";", "SchemaFactory", "sf", "=", "SchemaFactory", ".", "newInstance", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "W3C_XML_SCHEMA_NS_URI", ")", ";", "@", "@", "-", "161", ",", "4", "+", "163", ",", "14", "@", "@", "private", "Schema", "loadSchema", "(", "String", "schemaResource", ")", "{", "}", "return", "schema", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}", "@", "@", "-", "19", ",", "17", "+", "19", ",", "17", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "ConstraintViolation", ";", "import", "javax", ".", "validation", ".", "Validator", ";", "import", "org", ".", "testng", ".", "annotations", ".", "BeforeMethod", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidator", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidatorConfiguration", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "ConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "defs", ".", "NotNullDef", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "testutil", ".", "TestForIssue", ";", "import", "static", "java", ".", "lang", ".", "annotation", ".", "ElementType", ".", "FIELD", ";", "@", "@", "-", "108", ",", "7", "+", "108", ",", "7", "@", "@", "public", "void", "testProgrammaticCascadingMethodValidation", "(", ")", "{", "B", "b", "=", "new", "B", "(", ");", "b", ".", "c", "=", "new", "C", "(", ");", "Method", "method", "=", "ReflectionHelper", ".", "getMethod", "(", "B", ".", "class", ",", "\"", "getC", "\"", ")", ";", "Method", "method", "=", "GetMethod", ".", "action", "(", "B", ".", "class", ",", "\"", "getC", "\"", ")", ".", "run", "(", ");", "Set", "<", "ConstraintViolation", "<", "B", ">", ">", "violations", "=", "validator", ".", "forExecutables", "(", ").", "validateReturnValue", "(", "b", ",", "method", ",", "b", ".", "getC", "(", ")", "@", "@", "-", "16", ",", "7", "+", "16", ",", "6", "@", "@", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "test", ".", "internal", ".", "util", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Type", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "@", "@", "-", "27", ",", "10", "+", "26", ",", "6", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "SortedMap", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "javax", ".", "validation", ".", "Payload", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "validation", ".", "constraints", ".", "NotNull", ";", "import", "javax", ".", "validation", ".", "groups", ".", "Default", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "@", "@", "-", "41", ",", "7", "+", "36", ",", "6", "@", "@", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "fail", ";", "/", "**", "*", "Tests", "for", "the", "{", "@", "code", "ReflectionHelper", "}", ".", "@", "@", "-", "126", ",", "57", "+", "120", ",", "6", "@", "@", "public", "void", "testGetIndexedValueForNull", "(", ")", "{", "assertNull", "(", "value", ")", ";", "}", "@", "Test", "public", "void", "testGetMessageParameter", "(", ")", "{", "NotNull", "testAnnotation", "=", "new", "NotNull", "(", ")", "{", "@", "Override", "public", "String", "message", "(", ")", "{", "return", "\"", "test", "\"", ";", "}", "@", "Override", "public", "Class", "<", "?>", "[]", "groups", "(", ")", "{", "return", "new", "Class", "<", "?>", "[]", "{", "Default", ".", "class", "}", ";", "}", "@", "Override", "public", "Class", "<", "?", "extends", "Payload", ">", "[]", "payload", "(", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "?", "extends", "Payload", ">", "[]", "classes", "=", "new", "Class", "[", "]", "{", "}", ";", "return", "classes", ";", "}", "@", "Override", "public", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", "(", ")", "{", "return", "this", ".", "getClass", "(", ");", "}", "}", ";", "String", "message", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "testAnnotation", ",", "\"", "message", "\"", ",", "String", ".", "class", ")", ";", "assertEquals", "(", "\"", "test", "\"", ",", "message", ",", "\"", "Wrong", "message", "\"", ")", ";", "Class", "<", "?>", "[]", "group", "=", "ReflectionHelper", ".", "getAnnotationParameter", "(", "testAnnotation", ",", "\"", "groups", "\"", ",", "Class", "[", "].", "class", ")", ";", "assertEquals", "(", "group", "[", "0", "]", ",", "Default", ".", "class", ",", "\"", "Wrong", "message", "\"", ")", ";", "try", "{", "ReflectionHelper", ".", "getAnnotationParameter", "(", "testAnnotation", ",", "\"", "message", "\"", ",", "Integer", ".", "class", ")", ";", "fail", "(", ");", "}", "catch", "(", "ValidationException", "e", ")", "{", "assertTrue", "(", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "Wrong", "parameter", "type", ".", "\"", ")", ",", "\"", "Wrong", "exception", "message", "\"", ")", ";", "}", "try", "{", "ReflectionHelper", ".", "getAnnotationParameter", "(", "testAnnotation", ",", "\"", "foo", "\"", ",", "Integer", ".", "class", ")", ";", "fail", "(", ");", "}", "catch", "(", "ValidationException", "e", ")", "{", "assertTrue", "(", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "The", "specified", "annotation", "defines", "no", "parameter", "\"", ")", ",", "\"", "Wrong", "exception", "message", "\"", ")", ";", "}", "}", "@", "Test", "@", "TestForIssue", "(", "jiraKey", "=", "\"", "HV", "-", "622", "\"", ")", "public", "void", "testIsGetterMethod", "(", ")", "throws", "Exception", "{", "@", "@", "-", "9", ",", "7", "+", "9", ",", "7", "@", "@", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "@", "@", "-", "25", ",", "10", "+", "25", ",", "9", "@", "@", "import", "org", ".", "testng", ".", "annotations", ".", "BeforeMethod", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "annotationfactory", ".", "AnnotationDescriptor", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "annotationfactory", ".", "AnnotationFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethods", ";", "/", "**", "*", "@", "author", "Gunnar", "Morling", "@", "@", "-", "273", ",", "7", "+", "272", ",", "7", "@", "@", "public", "void", "testHashCode", "(", ")", "{", "AnnotationDescriptor", "<", "A", ">", "descriptor", "=", "new", "AnnotationDescriptor", "<", "A", ">", "(", "annotationType", ")", ";", "for", "(", "Method", "method", ":", "ReflectionHelper", ".", "getDeclaredMethods", "(", "annotationType", ")", ")", "{", "for", "(", "Method", "method", ":", "GetDeclaredMethods", ".", "action", "(", "annotationType", ")", ".", "run", "(", ")", ")", "{", "try", "{", "descriptor", ".", "setValue", "(", "method", ".", "getName", "(", "),", "method", ".", "invoke", "(", "annotation", ")", ")", ";", "}", "@", "@", "-", "16", ",", "7", "+", "16", ",", "6", "@", "@", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "test", ".", "internal", ".", "util", ".", "classhierarchy", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "@", "@", "-", "25", ",", "7", "+", "24", ",", "6", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "classhierarchy", ".", "Filters", ";", "import", "static", "org", ".", "fest", ".", "assertions", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertTrue", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "ClassHierarchyHelper", "}", ".", "@", "@", "-", "35", ",", "13", "+", "33", ",", "6", "@", "@", "*", "/", "public", "class", "ClassHierarchyHelperTest", "{", "@", "Test", "public", "void", "testGetAllMethods", "(", ")", "throws", "Exception", "{", "List", "<", "Method", ">", "methods", "=", "ClassHierarchyHelper", ".", "getAllMethods", "(", "Fubar", ".", "class", ")", ";", "assertTrue", "(", "methods", ".", "contains", "(", "Snafu", ".", "class", ".", "getMethod", "(", "\"", "snafu", "\"", ")", ")", ")", ";", "assertTrue", "(", "methods", ".", "contains", "(", "Susfu", ".", "class", ".", "getMethod", "(", "\"", "susfu", "\"", ")", ")", ")", ";", "}", "@", "Test", "public", "void", "testGetHierarchy", "(", ")", "{", "List", "<", "Class", "<", "?", "super", "Fubar", ">", ">", "hierarchy", "=", "ClassHierarchyHelper", ".", "getHierarchy", "(", "Fubar", ".", "class", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "91", "@", "@", "/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", "*", "Copyright", "2014", ",", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", ",", "and", "individual", "contributors", "*", "by", "the", "@", "authors", "tag", ".", "See", "the", "copyright", ".", "txt", "in", "the", "distribution", "for", "a", "*", "full", "listing", "of", "individual", "contributors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "test", ".", "internal", ".", "util", ".", "privilegedactions", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "fail", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "javax", ".", "validation", ".", "Payload", ";", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "validation", ".", "constraints", ".", "NotNull", ";", "import", "javax", ".", "validation", ".", "groups", ".", "Default", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetAnnotationParameter", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "GetAnnotationsParameter", "}", ".", "*", "*", "@", "author", "Gunnar", "Morling", "*", "*", "/", "public", "class", "GetAnnotationsParameterTest", "{", "@", "Test", "public", "void", "testGetMessageParameter", "(", ")", "{", "NotNull", "testAnnotation", "=", "new", "NotNull", "(", ")", "{", "@", "Override", "public", "String", "message", "(", ")", "{", "return", "\"", "test", "\"", ";", "}", "@", "Override", "public", "Class", "<", "?>", "[]", "groups", "(", ")", "{", "return", "new", "Class", "<", "?>", "[]", "{", "Default", ".", "class", "}", ";", "}", "@", "Override", "public", "Class", "<", "?", "extends", "Payload", ">", "[]", "payload", "(", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Class", "<", "?", "extends", "Payload", ">", "[]", "classes", "=", "new", "Class", "[", "]", "{", "}", ";", "return", "classes", ";", "}", "@", "Override", "public", "Class", "<", "?", "extends", "Annotation", ">", "annotationType", "(", ")", "{", "return", "this", ".", "getClass", "(", ");", "}", "}", ";", "String", "message", "=", "GetAnnotationParameter", ".", "action", "(", "testAnnotation", ",", "\"", "message", "\"", ",", "String", ".", "class", ")", ".", "run", "(", ");", "assertEquals", "(", "\"", "test", "\"", ",", "message", ",", "\"", "Wrong", "message", "\"", ")", ";", "Class", "<", "?>", "[]", "group", "=", "GetAnnotationParameter", ".", "action", "(", "testAnnotation", ",", "\"", "groups", "\"", ",", "Class", "[", "].", "class", ")", ".", "run", "(", ");", "assertEquals", "(", "group", "[", "0", "]", ",", "Default", ".", "class", ",", "\"", "Wrong", "message", "\"", ")", ";", "try", "{", "GetAnnotationParameter", ".", "action", "(", "testAnnotation", ",", "\"", "message", "\"", ",", "Integer", ".", "class", ")", ".", "run", "(", ");", "fail", "(", ");", "}", "catch", "(", "ValidationException", "e", ")", "{", "assertTrue", "(", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "Wrong", "parameter", "type", ".", "\"", ")", ",", "\"", "Wrong", "exception", "message", "\"", ")", ";", "}", "try", "{", "GetAnnotationParameter", ".", "action", "(", "testAnnotation", ",", "\"", "foo", "\"", ",", "Integer", ".", "class", ")", ".", "run", "(", ");", "fail", "(", ");", "}", "catch", "(", "ValidationException", "e", ")", "{", "assertTrue", "(", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "The", "specified", "annotation", "defines", "no", "parameter", "\"", ")", ",", "\"", "Wrong", "exception", "message", "\"", ")", ";", "}", "}", "}"], "docstring_tokens": ["execute", "restricted", "reflection", "calls", "on", "the", "system"]}
{"contents": ["vhost-net:", "fix", "use-after-free", "in", "vhost_net_flush", "vhost_net_ubuf_put_and_wait", "has", "a", "confusing", "name:", "it", "will", "actually", "also", "free", "it's", "argument.", "Thus", "since", "commit", "1280c27f8e29acf4af2da914e80ec27c3dbd5c01", "\"vhost-net:", "flush", "outstanding", "DMAs", "on", "memory", "change\"", "vhost_net_flush", "tries", "to", "use", "the", "argument", "after", "passing", "it", "to", "vhost_net_ubuf_put_and_wait,", "this", "results", "in", "use", "after", "free.", "To", "fix,", "don't", "free", "the", "argument", "in", "vhost_net_ubuf_put_and_wait,", "add", "an", "new", "API", "for", "callers", "that", "want", "to", "free", "ubufs.", "Acked-by:", "Asias", "He", "<asias@redhat.com>", "Acked-by:", "Jason", "Wang", "<jasowang@redhat.com>", "Signed-off-by:", "Michael", "S.", "Tsirkin", "<mst@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "150", ",", "6", "+", "150", ",", "11", "@", "@", "static", "void", "vhost_net_ubuf_put_and_wait", "(", "struct", "vhost_net_ubuf_ref", "*", "ubufs", ")", "{", "kref_put", "(", "&", "ubufs", "-", ">", "kref", ",", "vhost_net_zerocopy_done_signal", ")", ";", "wait_event", "(", "ubufs", "-", ">", "wait", ",", "!", "atomic_read", "(", "&", "ubufs", "-", ">", "kref", ".", "refcount", ")", ");", "}", "static", "void", "vhost_net_ubuf_put_wait_and_free", "(", "struct", "vhost_net_ubuf_ref", "*", "ubufs", ")", "{", "vhost_net_ubuf_put_and_wait", "(", "ubufs", ")", ";", "kfree", "(", "ubufs", ")", ";", "}", "@", "@", "-", "948", ",", "7", "+", "953", ",", "7", "@", "@", "static", "long", "vhost_net_set_backend", "(", "struct", "vhost_net", "*", "n", ",", "unsigned", "index", ",", "int", "fd", ")", "mutex_unlock", "(", "&", "vq", "-", ">", "mutex", ")", ";", "if", "(", "oldubufs", ")", "{", "vhost_net_ubuf_put_and_wait", "(", "oldubufs", ")", ";", "vhost_net_ubuf_put_wait_and_free", "(", "oldubufs", ")", ";", "mutex_lock", "(", "&", "vq", "-", ">", "mutex", ")", ";", "vhost_zerocopy_signal_used", "(", "n", ",", "vq", ")", ";", "mutex_unlock", "(", "&", "vq", "-", ">", "mutex", ")", ";", "@", "@", "-", "966", ",", "7", "+", "971", ",", "7", "@", "@", "static", "long", "vhost_net_set_backend", "(", "struct", "vhost_net", "*", "n", ",", "unsigned", "index", ",", "int", "fd", ")", "rcu_assign_pointer", "(", "vq", "-", ">", "private_data", ",", "oldsock", ")", ";", "vhost_net_enable_vq", "(", "n", ",", "vq", ")", ";", "if", "(", "ubufs", ")", "vhost_net_ubuf_put_and_wait", "(", "ubufs", ")", ";", "vhost_net_ubuf_put_wait_and_free", "(", "ubufs", ")", ";", "err_ubufs", ":", "fput", "(", "sock", "-", ">", "file", ")", ";", "err_vq", ":"], "docstring_tokens": ["corrupt", "the", "kernel", "memory", "and", "execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["NIFI-7079", "Cleaned", "up", "formatting", "and", "comments."], "code_tokens": ["@", "@", "-", "42", ",", "7", "+", "42", ",", "6", "@", "@", "public", "class", "Argon2SecureHasher", "implements", "SecureHasher", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "Argon2SecureHasher", ".", "class", ")", ";", "private", "static", "final", "int", "DEFAULT_SALT_LENGTH", "=", "16", ";", "private", "static", "final", "int", "DEFAULT_HASH_LENGTH", "=", "32", ";", "private", "static", "final", "int", "DEFAULT_PARALLELISM", "=", "1", ";", "private", "static", "final", "int", "DEFAULT_MEMORY", "=", "1", "<", "<", "12", ";", "@", "@", "-", "74", ",", "7", "+", "73", ",", "7", "@", "@", "public", "Argon2SecureHasher", "(", ")", "{", "*", "Instantiates", "an", "Argon2", "secure", "hasher", "using", "the", "provided", "cost", "parameters", ".", "A", "unique", "*", "{", "@", "link", "#", "DEFAULT_SALT_LENGTH", "}", "byte", "salt", "will", "be", "generated", "on", "every", "hash", "request", ".", "*", "*", "@", "param", "hashLength", "the", "output", "length", "in", "bytes", "(", "{@", "code", "4", "to", "2", "^", "32", "-", "1", "}", ")", "*", "@", "param", "hashLength", "the", "output", "length", "in", "bytes", "(", "{@", "code", "4", "to", "2", "^", "32", "-", "1", "}", ")", "*", "@", "param", "memory", "the", "integer", "number", "of", "KB", "used", "(", "{@", "code", "8p", "to", "2", "^", "32", "-", "1", "}", ")", "*", "@", "param", "parallelism", "degree", "of", "parallelism", "(", "{@", "code", "1", "to", "2", "^", "24", "-", "1", "}", ")", "*", "@", "param", "iterations", "number", "of", "iterations", "(", "{@", "code", "1", "to", "2", "^", "32", "-", "1", "}", ")", "@", "@", "-", "87", ",", "7", "+", "86", ",", "7", "@", "@", "public", "Argon2SecureHasher", "(", "int", "hashLength", ",", "int", "memory", ",", "int", "parallelism", ",", "int", "itera", "*", "Instantiates", "an", "Argon2", "secure", "hasher", "using", "the", "provided", "cost", "parameters", ".", "A", "unique", "*", "salt", "of", "the", "specified", "length", "will", "be", "generated", "on", "every", "hash", "request", ".", "*", "*", "@", "param", "hashLength", "the", "output", "length", "in", "bytes", "(", "{@", "code", "4", "to", "2", "^", "32", "-", "1", "}", ")", "*", "@", "param", "hashLength", "the", "output", "length", "in", "bytes", "(", "{@", "code", "4", "to", "2", "^", "32", "-", "1", "}", ")", "*", "@", "param", "memory", "the", "integer", "number", "of", "KB", "used", "(", "{@", "code", "8p", "to", "2", "^", "32", "-", "1", "}", ")", "*", "@", "param", "parallelism", "degree", "of", "parallelism", "(", "{@", "code", "1", "to", "2", "^", "24", "-", "1", "}", ")", "*", "@", "param", "iterations", "number", "of", "iterations", "(", "{@", "code", "1", "to", "2", "^", "32", "-", "1", "}", ")", "@", "@", "-", "137", ",", "7", "+", "136", ",", "7", "@", "@", "public", "boolean", "isUsingStaticSalt", "(", ")", "{", "}", "/", "**", "*", "Returns", "a", "String", "representation", "of", "{", "@", "code", "CHF", "(", "input", ")", "}", "in", "hex", "-", "encoded", "format", ".", "*", "Returns", "a", "String", "representation", "of", "{", "@", "code", "Argon2", "(", "input", ")", "}", "in", "hex", "-", "encoded", "format", ".", "*", "*", "@", "param", "input", "the", "input", "*", "@", "return", "the", "hex", "-", "encoded", "hash", "@", "@", "-", "153", ",", "7", "+", "152", ",", "7", "@", "@", "public", "String", "hashHex", "(", "String", "input", ")", "{", "}", "/", "**", "*", "Returns", "a", "String", "representation", "of", "{", "@", "code", "CHF", "(", "input", ")", "}", "in", "Base", "64", "-", "encoded", "format", ".", "*", "Returns", "a", "String", "representation", "of", "{", "@", "code", "Argon2", "(", "input", ")", "}", "in", "Base", "64", "-", "encoded", "format", ".", "*", "*", "@", "param", "input", "the", "input", "*", "@", "return", "the", "Base", "64", "-", "encoded", "hash", "@", "@", "-", "169", ",", "7", "+", "168", ",", "7", "@", "@", "public", "String", "hashBase64", "(", "String", "input", ")", "{", "}", "/", "**", "*", "Returns", "a", "byte", "[", "]", "representation", "of", "{", "@", "code", "CHF", "(", "input", ")", "}.", "*", "Returns", "a", "byte", "[", "]", "representation", "of", "{", "@", "code", "Argon2", "(", "input", ")", "}.", "*", "*", "@", "param", "input", "the", "input", "*", "@", "return", "the", "hash", "@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "<", "logger", "name", "=", "\"", "org", ".", "apache", ".", "nifi", "\"", "level", "=", "\"", "INFO", "\"", "/>", "<", "logger", "name", "=", "\"", "org", ".", "apache", ".", "nifi", ".", "security", ".", "util", ".", "crypto", "\"", "level", "=", "\"", "DEBUG", "\"", "/>", "<", "root", "level", "=", "\"", "DEBUG", "\"", ">", "<", "root", "level", "=", "\"", "INFO", "\"", ">", "<", "appender", "-", "ref", "ref", "=", "\"", "CONSOLE", "\"", "/>", "<", "/", "root", ">", "@", "@", "-", "342", ",", "7", "+", "342", ",", "7", "@", "@", "private", "void", "addParameter", "(", "final", "StringBuilder", "builder", ",", "final", "Element", "parameterEl", "/", "/", "append", "value", "if", "(", "isEncrypted", "(", "value", ")", ")", "{", "/", "/", "propValue", "is", "non", "null", ",", "no", "need", "to", "use", "getValue", "/", "/", "Get", "a", "secure", ",", "deterministic", ",", "loggable", "representation", "of", "this", "value", "builder", ".", "append", "(", "getLoggableRepresentationOfSensitiveValue", "(", "value", ")", ");", "}", "else", "{", "builder", ".", "append", "(", "getValue", "(", "value", ",", "NO_VALUE", ")", ");", "@", "@", "-", "557", ",", "15", "+", "557", ",", "12", "@", "@", "private", "StringBuilder", "addPropertyFingerprint", "(", "final", "StringBuilder", "builder", ",", "final", "*", "@", "return", "a", "deterministic", "string", "value", "which", "represents", "this", "input", "but", "is", "safe", "to", "print", "in", "a", "log", "*", "/", "private", "String", "getLoggableRepresentationOfSensitiveValue", "(", "String", "encryptedPropertyValue", ")", "{", "/", "/", "TODO", ":", "Implement", "Scrypt", "or", "Argon2", "secure", "hash", "of", "decrypted", "value", "/", "/", "TODO", ":", "Use", "DI", "/", "IoC", "to", "inject", "this", "implementation", "in", "the", "constructor", "of", "the", "FingerprintFactory", "/", "/", "There", "is", "little", "initialization", "cost", ",", "so", "it", "doesn", "'", "t", "make", "sense", "to", "cache", "this", "as", "a", "field", "SecureHasher", "secureHasher", "=", "new", "Argon2SecureHasher", "(", ");", "/", "/", "TODO", ":", "Extend", "{", "@", "link", "StringEncryptor", "}", "with", "secure", "hashing", "capability", "and", "inject", "?", "String", "hexEncodedHash", "=", "secureHasher", ".", "hashHex", "(", "decrypt", "(", "encryptedPropertyValue", ")", ");", "return", "hexEncodedHash", ";", "return", "secureHasher", ".", "hashHex", "(", "decrypt", "(", "encryptedPropertyValue", ")", ");", "}", "private", "StringBuilder", "addPortFingerprint", "(", "final", "StringBuilder", "builder", ",", "final", "Element", "portElem", ")", "throws", "FingerprintException", "{"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["[FIXED", "SECURITY-281]", "MasterComputer.doConfigDotXml", "should", "be", "rejected."], "code_tokens": ["@", "@", "-", "298", ",", "6", "+", "298", ",", "7", "@", "@", "import", "hudson", ".", "util", ".", "LogTaskListener", ";", "import", "static", "java", ".", "util", ".", "logging", ".", "Level", ".", "*;", "import", "static", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ".", "*;", "import", "org", ".", "kohsuke", ".", "stapler", ".", "WebMethod", ";", "/", "**", "*", "Root", "object", "of", "the", "system", ".", "@", "@", "-", "3996", ",", "6", "+", "3997", ",", "12", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOExc", "Jenkins", ".", "getInstance", "(", ").", "doConfigExecutorsSubmit", "(", "req", ",", "rsp", ")", ";", "}", "@", "WebMethod", "(", "name", "=", "\"", "config", ".", "xml", "\"", ")", "@", "Override", "public", "void", "doConfigDotXml", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", "{", "throw", "HttpResponses", ".", "status", "(", "SC_BAD_REQUEST", ")", ";", "}", "@", "Override", "public", "boolean", "hasPermission", "(", "Permission", "permission", ")", "{", "/", "/", "no", "one", "should", "be", "allowed", "to", "delete", "the", "master", ".", "@", "@", "-", "23", ",", "6", "+", "23", ",", "10", "@", "@", "*", "/", "package", "hudson", ".", "model", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequestSettings", ";", "import", "hudson", ".", "EnvVars", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "maven", ".", "MavenModuleSet", ";", "@", "@", "-", "41", ",", "6", "+", "45", ",", "7", "@", "@", "import", "hudson", ".", "slaves", ".", "OfflineCause", ".", "ByCLI", ";", "import", "hudson", ".", "slaves", ".", "OfflineCause", ".", "UserCause", ";", "import", "hudson", ".", "util", ".", "TagCloud", ";", "import", "java", ".", "net", ".", "HttpURLConnection", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "concurrent", ".", "Callable", ";", "@", "@", "-", "400", ",", "6", "+", "405", ",", "22", "@", "@", "public", "void", "testGetAssignedLabelWithSpaceOnly", "(", ")", "throws", "Exception", "{", "assertThatCloudLabelDoesNotContain", "(", "cloud", ",", "\"", "label1", "label2", "\"", ",", "0", ")", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "281", "\"", ")", "@", "Test", "public", "void", "masterComputerConfigDotXml", "(", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "assertFails", "(", "\"", "computer", "/", "(", "master", ")", "/", "config", ".", "xml", "\"", ",", "HttpURLConnection", ".", "HTTP_BAD_REQUEST", ")", ";", "WebRequestSettings", "settings", "=", "new", "WebRequestSettings", "(", "wc", ".", "createCrumbedUrl", "(", "\"", "computer", "/", "(", "master", ")", "/", "config", ".", "xml", "\"", "))", ";", "settings", ".", "setHttpMethod", "(", "HttpMethod", ".", "POST", ")", ";", "settings", ".", "setRequestBody", "(", "\"<", "hudson", "/", ">\"", ");", "try", "{", "Page", "page", "=", "wc", ".", "getPage", "(", "settings", ")", ";", "fail", "(", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", "))", ";", "}", "catch", "(", "FailingHttpStatusCodeException", "x", ")", "{", "assertEquals", "(", "HttpURLConnection", ".", "HTTP_BAD_REQUEST", ",", "x", ".", "getStatusCode", "(", "))", ";", "}", "}", "/", "**", "*", "Assert", "that", "a", "tag", "cloud", "contains", "label", "name", "and", "weight", ".", "*", "/"], "docstring_tokens": ["obtain", "sensitive", "information", "about", "the", "global", "configuration"]}
{"contents": ["Adds", "additional", "method", "to", "check", "if", "value", "of", "param", "isn't", "excluded"], "code_tokens": ["@", "@", "-", "273", ",", "7", "+", "273", ",", "8", "@", "@", "protected", "void", "setParameters", "(", "final", "Object", "action", ",", "ValueStack", "stack", ",", "final", "Map", "<", "St", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "params", ".", "entrySet", "(", "))", "{", "String", "name", "=", "entry", ".", "getKey", "(", ");", "if", "(", "isAcceptableParameter", "(", "name", ",", "action", ")", ")", "{", "Object", "value", "=", "entry", ".", "getValue", "(", ");", "if", "(", "isAcceptableParameter", "(", "name", ",", "action", ")", "&", "&", "isAcceptableValue", "(", "value", ")", ")", "{", "acceptableParameters", ".", "put", "(", "name", ",", "entry", ".", "getValue", "(", "))", ";", "}", "}", "@", "@", "-", "348", ",", "6", "+", "349", ",", "33", "@", "@", "protected", "boolean", "isAcceptableParameter", "(", "String", "name", ",", "Object", "action", ")", "{", "return", "acceptableName", "(", "name", ")", "&", "&", "(", "parameterNameAware", "=", "=", "null", "|", "|", "parameterNameAware", ".", "acceptableParameterName", "(", "name", ")", ");", "}", "/", "**", "*", "Checks", "if", "given", "value", "doesn", "'", "t", "match", "global", "excluded", "patterns", "to", "avoid", "passing", "malicious", "code", "*", "*", "@", "param", "value", "incoming", "parameter", "'", "s", "value", "*", "@", "return", "true", "if", "value", "is", "safe", "*", "*", "FIXME", ":", "can", "be", "removed", "when", "parameters", "won", "'", "t", "be", "represented", "as", "simple", "Strings", "*", "/", "protected", "boolean", "isAcceptableValue", "(", "Object", "value", ")", "{", "if", "(", "value", "=", "=", "null", ")", "{", "return", "true", ";", "}", "Object", "[", "]", "values", ";", "if", "(", "value", ".", "getClass", "(", ").", "isArray", "(", "))", "{", "values", "=", "(", "Object", "[", "])", "value", ";", "}", "else", "{", "values", "=", "new", "Object", "[", "]", "{", "value", "}", ";", "}", "boolean", "result", "=", "true", ";", "for", "(", "Object", "obj", ":", "values", ")", "{", "if", "(", "isExcluded", "(", "obj", ".", "toString", "(", "))", ")", "{", "result", "=", "false", ";", "}", "}", "return", "result", ";", "}", "/", "**", "*", "Gets", "an", "instance", "of", "the", "comparator", "to", "use", "for", "the", "ordered", "sorting", ".", "Override", "this", "*", "method", "to", "customize", "the", "ordering", "of", "the", "parameters", "as", "they", "are", "set", "to", "the"], "docstring_tokens": ["\"compromise", "internal", "state", "of", "an", "application", "\""]}
{"contents": ["ipv4:", "Don't", "do", "expensive", "useless", "work", "during", "inetdev", "destroy.", "When", "an", "inetdev", "is", "destroyed,", "every", "address", "assigned", "to", "the", "interface", "is", "removed.", "And", "in", "this", "scenerio", "we", "do", "two", "pointless", "things", "which", "can", "be", "very", "expensive", "if", "the", "number", "of", "assigned", "interfaces", "is", "large:", "1)", "Address", "promotion.", "We", "are", "deleting", "all", "addresses,", "so", "there", "is", "no", "point", "in", "doing", "this.", "2)", "A", "full", "nf", "conntrack", "table", "purge", "for", "every", "address.", "We", "only", "need", "to", "do", "this", "once,", "as", "is", "already", "caught", "by", "the", "existing", "masq_dev_notifier", "so", "masq_inet_event()", "can", "skip", "this.", "Reported-by:", "Solar", "Designer", "<solar@openwall.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>", "Tested-by:", "Cyrill", "Gorcunov", "<gorcunov@openvz.org>"], "code_tokens": ["@", "@", "-", "334", ",", "6", "+", "334", ",", "9", "@", "@", "static", "void", "__inet_del_ifa", "(", "struct", "in_device", "*", "in_dev", ",", "struct", "in_ifaddr", "*", "*", "ifap", ",", "ASSERT_RTNL", "(", ");", "if", "(", "in_dev", "-", ">", "dead", ")", "goto", "no_promotions", ";", "/", "*", "1", ".", "Deleting", "primary", "ifaddr", "forces", "deletion", "all", "secondaries", "*", "unless", "alias", "promotion", "is", "set", "*", "*/", "@", "@", "-", "380", ",", "6", "+", "383", ",", "7", "@", "@", "static", "void", "__inet_del_ifa", "(", "struct", "in_device", "*", "in_dev", ",", "struct", "in_ifaddr", "*", "*", "ifap", ",", "fib_del_ifaddr", "(", "ifa", ",", "ifa1", ")", ";", "}", "no_promotions", ":", "/", "*", "2", ".", "Unlink", "it", "*", "/", "*", "ifap", "=", "ifa1", "-", ">", "ifa_next", ";", "@", "@", "-", "922", ",", "6", "+", "922", ",", "9", "@", "@", "void", "fib_del_ifaddr", "(", "struct", "in_ifaddr", "*", "ifa", ",", "struct", "in_ifaddr", "*", "iprim", ")", "subnet", "=", "1", ";", "}", "if", "(", "in_dev", "-", ">", "dead", ")", "goto", "no_promotions", ";", "/", "*", "Deletion", "is", "more", "complicated", "than", "add", ".", "*", "We", "should", "take", "care", "of", "not", "to", "delete", "too", "much", ":", "-)", "*", "@", "@", "-", "997", ",", "6", "+", "1000", ",", "7", "@", "@", "void", "fib_del_ifaddr", "(", "struct", "in_ifaddr", "*", "ifa", ",", "struct", "in_ifaddr", "*", "iprim", ")", "}", "}", "no_promotions", ":", "if", "(", "!(", "ok", "&", "BRD_OK", ")", ")", "fib_magic", "(", "RTM_DELROUTE", ",", "RTN_BROADCAST", ",", "ifa", "-", ">", "ifa_broadcast", ",", "32", ",", "prim", ")", ";", "if", "(", "subnet", "&", "&", "ifa", "-", ">", "ifa_prefixlen", "<", "31", ")", "{", "@", "@", "-", "108", ",", "10", "+", "108", ",", "18", "@", "@", "static", "int", "masq_inet_event", "(", "struct", "notifier_block", "*", "this", ",", "unsigned", "long", "event", ",", "void", "*", "ptr", ")", "{", "struct", "net_device", "*", "dev", "=", "(", "(", "struct", "in_ifaddr", "*", ")", "ptr", ")", "->", "ifa_dev", "-", ">", "dev", ";", "struct", "in_device", "*", "idev", "=", "(", "(", "struct", "in_ifaddr", "*", ")", "ptr", ")", "->", "ifa_dev", ";", "struct", "netdev_notifier_info", "info", ";", "netdev_notifier_info_init", "(", "&", "info", ",", "dev", ")", ";", "/", "*", "The", "masq_dev_notifier", "will", "catch", "the", "case", "of", "the", "device", "going", "*", "down", ".", "So", "if", "the", "inetdev", "is", "dead", "and", "being", "destroyed", "we", "have", "*", "no", "work", "to", "do", ".", "Otherwise", "this", "is", "an", "individual", "address", "removal", "*", "and", "we", "have", "to", "perform", "the", "flush", ".", "*", "/", "if", "(", "idev", "-", ">", "dead", ")", "return", "NOTIFY_DONE", ";", "netdev_notifier_info_init", "(", "&", "info", ",", "idev", "-", ">", "dev", ")", ";", "return", "masq_device_event", "(", "this", ",", "event", ",", "&", "info", ")", ";", "}"], "docstring_tokens": ["a", "very", "long", "time", "and", "block", "network", "related", "operations"]}
{"contents": ["SOLR-12450:", "Don't", "allow", "referal", "to", "external", "resources", "in", "various", "config", "files"], "code_tokens": ["@", "@", "-", "382", ",", "6", "+", "382", ",", "9", "@", "@", "Bug", "Fixes", "*", "SOLR", "-", "12416", ":", "When", "creating", "a", "time", "routed", "alias", ",", "the", "router", ".", "autoDeleteAge", "option", "wasn", "'", "t", "considered", ".", "(", "Joachim", "Sauer", "via", "David", "Smiley", ")", "*", "SOLR", "-", "12450", ":", "Don", "'", "t", "allow", "referal", "to", "external", "resources", "in", "various", "config", "files", ".", "(", "Yuyang", "Xiao", ",", "Uwe", "Schindler", ")", "Optimizations", "@", "@", "-", "16", ",", "27", "+", "16", ",", "31", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "handler", ".", "extraction", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "java", ".", "beans", ".", "BeanInfo", ";", "import", "java", ".", "beans", ".", "Introspector", ";", "import", "java", ".", "beans", ".", "PropertyDescriptor", ";", "import", "java", ".", "beans", ".", "PropertyEditor", ";", "import", "java", ".", "beans", ".", "PropertyEditorManager", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "solr", ".", "core", ".", "SolrResourceLoader", ";", "import", "org", ".", "apache", ".", "solr", ".", "util", ".", "SafeXMLParsing", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParseContext", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "w3c", ".", "dom", ".", "NamedNodeMap", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "w3c", ".", "dom", ".", "NodeList", ";", "public", "class", "ParseContextConfig", "{", "private", "static", "final", "Logger", "log", "=", "LoggerFactory", ".", "getLogger", "(", "MethodHandles", ".", "lookup", "(", ").", "lookupClass", "(", "))", ";", "private", "final", "Map", "<", "Class", "<", "?>", ",", "Object", ">", "entries", "=", "new", "HashMap", "<", ">(", ");", "/", "**", "Creates", "an", "empty", "Config", "without", "any", "settings", "(", "used", "as", "placeholder", ")", ".", "*", "/", "@", "@", "-", "54", ",", "9", "+", "58", ",", "7", "@", "@", "public", "ParseContextConfig", "(", "SolrResourceLoader", "resourceLoader", ",", "String", "parseContext", "}", "private", "static", "Document", "loadConfigFile", "(", "SolrResourceLoader", "resourceLoader", ",", "String", "parseContextConfigLoc", ")", "throws", "Exception", "{", "try", "(", "InputStream", "in", "=", "resourceLoader", ".", "openResource", "(", "parseContextConfigLoc", ")", ")", "{", "return", "DocumentBuilderFactory", ".", "newInstance", "(", ").", "newDocumentBuilder", "(", ").", "parse", "(", "in", ",", "parseContextConfigLoc", ")", ";", "}", "return", "SafeXMLParsing", ".", "parseConfigXML", "(", "log", ",", "resourceLoader", ",", "parseContextConfigLoc", ")", ";", "}", "private", "void", "extract", "(", "Element", "element", ",", "SolrResourceLoader", "loader", ")", "throws", "Exception", "{", "@", "@", "-", "18", ",", "14", "+", "18", ",", "12", "@", "@", "package", "org", ".", "apache", ".", "solr", ".", "schema", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPath", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathConstants", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathExpressionException", ";", "@", "@", "-", "38", ",", "8", "+", "36", ",", "10", "@", "@", "import", "org", ".", "apache", ".", "lucene", ".", "util", ".", "BytesRefBuilder", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "EnumFieldValue", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "core", ".", "SolrResourceLoader", ";", "import", "org", ".", "apache", ".", "solr", ".", "response", ".", "TextResponseWriter", ";", "import", "org", ".", "apache", ".", "solr", ".", "search", ".", "QParser", ";", "import", "org", ".", "apache", ".", "solr", ".", "util", ".", "SafeXMLParsing", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "@", "@", "-", "51", ",", "7", "+", "51", ",", "6", "@", "@", "*", "Abstract", "Field", "type", "for", "support", "of", "string", "values", "with", "custom", "sort", "order", ".", "*", "/", "public", "abstract", "class", "AbstractEnumField", "extends", "PrimitiveFieldType", "{", "private", "static", "final", "Logger", "log", "=", "LoggerFactory", ".", "getLogger", "(", "MethodHandles", ".", "lookup", "(", ").", "lookupClass", "(", "))", ";", "protected", "EnumMapping", "enumMapping", ";", "@", "Override", "@", "@", "-", "69", ",", "6", "+", "68", ",", "8", "@", "@", "public", "EnumMapping", "getEnumMapping", "(", ")", "{", "*", "@", "lucene", ".", "internal", "*", "/", "public", "static", "final", "class", "EnumMapping", "{", "private", "static", "final", "Logger", "log", "=", "LoggerFactory", ".", "getLogger", "(", "MethodHandles", ".", "lookup", "(", ").", "lookupClass", "(", "))", ";", "public", "static", "final", "String", "PARAM_ENUMS_CONFIG", "=", "\"", "enumsConfig", "\"", ";", "public", "static", "final", "String", "PARAM_ENUM_NAME", "=", "\"", "enumName", "\"", ";", "public", "static", "final", "Integer", "DEFAULT_VALUE", "=", "-", "1", ";", "@", "@", "-", "105", ",", "67", "+", "106", ",", "49", "@", "@", "public", "EnumMapping", "(", "IndexSchema", "schema", ",", "FieldType", "fieldType", ",", "Map", "<", "String", ",", "String", ">", "ftName", "+", "\"", ":", "No", "enum", "name", "was", "configured", ".", "\")", ";", "}", "InputStream", "is", "=", "null", ";", "final", "SolrResourceLoader", "loader", "=", "schema", ".", "getResourceLoader", "(", ");", "try", "{", "is", "=", "schema", ".", "getResourceLoader", "(", ").", "openResource", "(", "enumsConfigFile", ")", ";", "final", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "try", "{", "final", "Document", "doc", "=", "dbf", ".", "newDocumentBuilder", "(", ").", "parse", "(", "is", ")", ";", "final", "XPathFactory", "xpathFactory", "=", "XPathFactory", ".", "newInstance", "(", ");", "final", "XPath", "xpath", "=", "xpathFactory", ".", "newXPath", "(", ");", "final", "String", "xpathStr", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "\"", "/", "enumsConfig", "/", "enum", "[", "@", "name", "=", "'%", "s", "'", "]\"", ",", "enumName", ")", ";", "final", "NodeList", "nodes", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "xpathStr", ",", "doc", ",", "XPathConstants", ".", "NODESET", ")", ";", "final", "int", "nodesLength", "=", "nodes", ".", "getLength", "(", ");", "if", "(", "nodesLength", "=", "=", "0", ")", "{", "String", "exceptionMessage", "=", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "%", "s", ":", "No", "enum", "configuration", "found", "for", "enum", "'", "%", "s", "'", "in", "%", "s", ".", "\",", "log", ".", "debug", "(", "\"", "Reloading", "enums", "config", "file", "from", "{", "}\"", ",", "enumsConfigFile", ")", ";", "Document", "doc", "=", "SafeXMLParsing", ".", "parseConfigXML", "(", "log", ",", "loader", ",", "enumsConfigFile", ")", ";", "final", "XPathFactory", "xpathFactory", "=", "XPathFactory", ".", "newInstance", "(", ");", "final", "XPath", "xpath", "=", "xpathFactory", ".", "newXPath", "(", ");", "final", "String", "xpathStr", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "\"", "/", "enumsConfig", "/", "enum", "[", "@", "name", "=", "'%", "s", "'", "]\"", ",", "enumName", ")", ";", "final", "NodeList", "nodes", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "xpathStr", ",", "doc", ",", "XPathConstants", ".", "NODESET", ")", ";", "final", "int", "nodesLength", "=", "nodes", ".", "getLength", "(", ");", "if", "(", "nodesLength", "=", "=", "0", ")", "{", "String", "exceptionMessage", "=", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "%", "s", ":", "No", "enum", "configuration", "found", "for", "enum", "'", "%", "s", "'", "in", "%", "s", ".", "\",", "ftName", ",", "enumName", ",", "enumsConfigFile", ")", ";", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "NOT_FOUND", ",", "exceptionMessage", ")", ";", "}", "if", "(", "nodesLength", ">", "1", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "log", ".", "warn", "(", "\"{", "}:", "More", "than", "one", "enum", "configuration", "found", "for", "enum", "'", "{}", "'", "in", "{", "}.", "The", "last", "one", "was", "taken", ".", "\",", "ftName", ",", "enumName", ",", "enumsConfigFile", ")", ";", "}", "final", "Node", "enumNode", "=", "nodes", ".", "item", "(", "nodesLength", "-", "1", ")", ";", "final", "NodeList", "valueNodes", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "\"", "value", "\"", ",", "enumNode", ",", "XPathConstants", ".", "NODESET", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "valueNodes", ".", "getLength", "(", ");", "i", "+", "+)", "{", "final", "Node", "valueNode", "=", "valueNodes", ".", "item", "(", "i", ")", ";", "final", "String", "valueStr", "=", "valueNode", ".", "getTextContent", "(", ");", "if", "(", "(", "valueStr", "=", "=", "null", ")", "|", "|", "(", "valueStr", ".", "length", "(", ")", "=", "=", "0", ")", ")", "{", "final", "String", "exceptionMessage", "=", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "%", "s", ":", "A", "value", "was", "defined", "with", "an", "no", "value", "in", "enum", "'", "%", "s", "'", "in", "%", "s", ".", "\",", "ftName", ",", "enumName", ",", "enumsConfigFile", ")", ";", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "NOT_FOUND", ",", "exceptionMessage", ")", ";", "}", "if", "(", "nodesLength", ">", "1", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "log", ".", "warn", "(", "\"{", "}:", "More", "than", "one", "enum", "configuration", "found", "for", "enum", "'", "{}", "'", "in", "{", "}.", "The", "last", "one", "was", "taken", ".", "\",", "ftName", ",", "enumName", ",", "enumsConfigFile", ")", ";", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "exceptionMessage", ")", ";", "}", "final", "Node", "enumNode", "=", "nodes", ".", "item", "(", "nodesLength", "-", "1", ")", ";", "final", "NodeList", "valueNodes", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "\"", "value", "\"", ",", "enumNode", ",", "XPathConstants", ".", "NODESET", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "valueNodes", ".", "getLength", "(", ");", "i", "+", "+)", "{", "final", "Node", "valueNode", "=", "valueNodes", ".", "item", "(", "i", ")", ";", "final", "String", "valueStr", "=", "valueNode", ".", "getTextContent", "(", ");", "if", "(", "(", "valueStr", "=", "=", "null", ")", "|", "|", "(", "valueStr", ".", "length", "(", ")", "=", "=", "0", ")", ")", "{", "final", "String", "exceptionMessage", "=", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "%", "s", ":", "A", "value", "was", "defined", "with", "an", "no", "value", "in", "enum", "'", "%", "s", "'", "in", "%", "s", ".", "\",", "ftName", ",", "enumName", ",", "enumsConfigFile", ")", ";", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "exceptionMessage", ")", ";", "}", "if", "(", "enumStringToIntMap", ".", "containsKey", "(", "valueStr", ")", ")", "{", "final", "String", "exceptionMessage", "=", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "%", "s", ":", "A", "duplicated", "definition", "was", "found", "for", "value", "'", "%", "s", "'", "in", "enum", "'", "%", "s", "'", "in", "%", "s", ".", "\",", "ftName", ",", "valueStr", ",", "enumName", ",", "enumsConfigFile", ")", ";", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "exceptionMessage", ")", ";", "}", "enumIntToStringMap", ".", "put", "(", "i", ",", "valueStr", ")", ";", "enumStringToIntMap", ".", "put", "(", "valueStr", ",", "i", ")", ";", "if", "(", "enumStringToIntMap", ".", "containsKey", "(", "valueStr", ")", ")", "{", "final", "String", "exceptionMessage", "=", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "%", "s", ":", "A", "duplicated", "definition", "was", "found", "for", "value", "'", "%", "s", "'", "in", "enum", "'", "%", "s", "'", "in", "%", "s", ".", "\",", "ftName", ",", "valueStr", ",", "enumName", ",", "enumsConfigFile", ")", ";", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "exceptionMessage", ")", ";", "}", "enumIntToStringMap", ".", "put", "(", "i", ",", "valueStr", ")", ";", "enumStringToIntMap", ".", "put", "(", "valueStr", ",", "i", ")", ";", "}", "catch", "(", "ParserConfigurationException", "|", "XPathExpressionException", "|", "SAXException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "ftName", "+", "\"", ":", "Error", "parsing", "enums", "config", ".", "\",", "e", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "}", "catch", "(", "IOException", "|", "SAXException", "|", "XPathExpressionException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "ftName", "+", "\"", ":", "Error", "while", "opening", "enums", "config", ".", "\",", "e", ")", ";", "}", "finally", "{", "try", "{", "if", "(", "is", "!", "=", "null", ")", "{", "is", ".", "close", "(", ");", "}", "}", "catch", "(", "IOException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "}", "ftName", "+", "\"", ":", "Error", "while", "parsing", "enums", "config", ".", "\",", "e", ")", ";", "}", "if", "(", "(", "enumStringToIntMap", ".", "size", "(", ")", "=", "=", "0", ")", "|", "|", "(", "enumIntToStringMap", ".", "size", "(", ")", "=", "=", "0", ")", ")", "{", "@", "@", "-", "17", ",", "22", "+", "17", ",", "21", "@", "@", "package", "org", ".", "apache", ".", "solr", ".", "schema", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPath", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathConstants", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathExpressionException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathFactory", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPath", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathConstants", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathExpressionException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathFactory", ";", "import", "org", ".", "apache", ".", "lucene", ".", "analysis", ".", "util", ".", "ResourceLoader", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "util", ".", "SafeXMLParsing", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "@", "@", "-", "46", ",", "6", "+", "45", ",", "7", "@", "@", "*", "/", "class", "FileExchangeRateProvider", "implements", "ExchangeRateProvider", "{", "private", "static", "final", "Logger", "log", "=", "LoggerFactory", ".", "getLogger", "(", "MethodHandles", ".", "lookup", "(", ").", "lookupClass", "(", "))", ";", "protected", "static", "final", "String", "PARAM_CURRENCY_CONFIG", "=", "\"", "currencyConfig", "\"", ";", "/", "/", "Exchange", "rate", "map", ",", "maps", "Currency", "Code", "-", ">", "Currency", "Code", "-", ">", "Rate", "@", "@", "-", "159", ",", "71", "+", "159", ",", "49", "@", "@", "public", "String", "toString", "(", ")", "{", "@", "Override", "public", "boolean", "reload", "(", ")", "throws", "SolrException", "{", "InputStream", "is", "=", "null", ";", "Map", "<", "String", ",", "Map", "<", "String", ",", "Double", ">", ">", "tmpRates", "=", "new", "HashMap", "<", ">(", ");", "log", ".", "debug", "(", "\"", "Reloading", "exchange", "rates", "from", "file", "{", "}\"", ",", "currencyConfigFile", ")", ";", "try", "{", "log", ".", "debug", "(", "\"", "Reloading", "exchange", "rates", "from", "file", "\"", "+", "this", ".", "currencyConfigFile", ")", ";", "is", "=", "loader", ".", "openResource", "(", "currencyConfigFile", ")", ";", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "try", "{", "dbf", ".", "setXIncludeAware", "(", "true", ")", ";", "dbf", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "XML", "parser", "doesn", "'", "t", "support", "XInclude", "option", "\"", ",", "e", ")", ";", "}", "Document", "doc", "=", "SafeXMLParsing", ".", "parseConfigXML", "(", "log", ",", "loader", ",", "currencyConfigFile", ")", ";", "XPathFactory", "xpathFactory", "=", "XPathFactory", ".", "newInstance", "(", ");", "XPath", "xpath", "=", "xpathFactory", ".", "newXPath", "(", ");", "/", "/", "Parse", "exchange", "rates", ".", "NodeList", "nodes", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "\"/", "currencyConfig", "/", "rates", "/", "rate", "\"", ",", "doc", ",", "XPathConstants", ".", "NODESET", ")", ";", "try", "{", "Document", "doc", "=", "dbf", ".", "newDocumentBuilder", "(", ").", "parse", "(", "is", ")", ";", "XPathFactory", "xpathFactory", "=", "XPathFactory", ".", "newInstance", "(", ");", "XPath", "xpath", "=", "xpathFactory", ".", "newXPath", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "nodes", ".", "getLength", "(", ");", "i", "+", "+)", "{", "Node", "rateNode", "=", "nodes", ".", "item", "(", "i", ")", ";", "NamedNodeMap", "attributes", "=", "rateNode", ".", "getAttributes", "(", ");", "Node", "from", "=", "attributes", ".", "getNamedItem", "(", "\"", "from", "\"", ");", "Node", "to", "=", "attributes", ".", "getNamedItem", "(", "\"", "to", "\"", ");", "Node", "rate", "=", "attributes", ".", "getNamedItem", "(", "\"", "rate", "\"", ");", "if", "(", "from", "=", "=", "null", "|", "|", "to", "=", "=", "null", "|", "|", "rate", "=", "=", "null", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Exchange", "rate", "missing", "attributes", "(", "required", ":", "from", ",", "to", ",", "rate", ")", "\"", "+", "rateNode", ")", ";", "}", "/", "/", "Parse", "exchange", "rates", ".", "NodeList", "nodes", "=", "(", "NodeList", ")", "xpath", ".", "evaluate", "(", "\"/", "currencyConfig", "/", "rates", "/", "rate", "\"", ",", "doc", ",", "XPathConstants", ".", "NODESET", ")", ";", "String", "fromCurrency", "=", "from", ".", "getNodeValue", "(", ");", "String", "toCurrency", "=", "to", ".", "getNodeValue", "(", ");", "Double", "exchangeRate", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "nodes", ".", "getLength", "(", ");", "i", "+", "+)", "{", "Node", "rateNode", "=", "nodes", ".", "item", "(", "i", ")", ";", "NamedNodeMap", "attributes", "=", "rateNode", ".", "getAttributes", "(", ");", "Node", "from", "=", "attributes", ".", "getNamedItem", "(", "\"", "from", "\"", ");", "Node", "to", "=", "attributes", ".", "getNamedItem", "(", "\"", "to", "\"", ");", "Node", "rate", "=", "attributes", ".", "getNamedItem", "(", "\"", "rate", "\"", ");", "if", "(", "from", "=", "=", "null", "|", "|", "to", "=", "=", "null", "|", "|", "rate", "=", "=", "null", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Exchange", "rate", "missing", "attributes", "(", "required", ":", "from", ",", "to", ",", "rate", ")", "\"", "+", "rateNode", ")", ";", "}", "String", "fromCurrency", "=", "from", ".", "getNodeValue", "(", ");", "String", "toCurrency", "=", "to", ".", "getNodeValue", "(", ");", "Double", "exchangeRate", ";", "if", "(", "null", "=", "=", "CurrencyFieldType", ".", "getCurrency", "(", "fromCurrency", ")", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Specified", "'", "from", "'", "currency", "not", "supported", "in", "this", "JVM", ":", "\"", "+", "fromCurrency", ")", ";", "}", "if", "(", "null", "=", "=", "CurrencyFieldType", ".", "getCurrency", "(", "toCurrency", ")", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Specified", "'", "to", "'", "currency", "not", "supported", "in", "this", "JVM", ":", "\"", "+", "toCurrency", ")", ";", "}", "try", "{", "exchangeRate", "=", "Double", ".", "parseDouble", "(", "rate", ".", "getNodeValue", "(", "))", ";", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Could", "not", "parse", "exchange", "rate", ":", "\"", "+", "rateNode", ",", "e", ")", ";", "}", "addRate", "(", "tmpRates", ",", "fromCurrency", ",", "toCurrency", ",", "exchangeRate", ")", ";", "if", "(", "null", "=", "=", "CurrencyFieldType", ".", "getCurrency", "(", "fromCurrency", ")", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Specified", "'", "from", "'", "currency", "not", "supported", "in", "this", "JVM", ":", "\"", "+", "fromCurrency", ")", ";", "}", "}", "catch", "(", "SAXException", "|", "XPathExpressionException", "|", "ParserConfigurationException", "|", "IOException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Error", "parsing", "currency", "config", ".", "\",", "e", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Error", "while", "opening", "Currency", "configuration", "file", "\"", "+", "currencyConfigFile", ",", "e", ")", ";", "}", "finally", "{", "try", "{", "if", "(", "is", "!", "=", "null", ")", "{", "is", ".", "close", "(", ");", "if", "(", "null", "=", "=", "CurrencyFieldType", ".", "getCurrency", "(", "toCurrency", ")", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Specified", "'", "to", "'", "currency", "not", "supported", "in", "this", "JVM", ":", "\"", "+", "toCurrency", ")", ";", "}", "try", "{", "exchangeRate", "=", "Double", ".", "parseDouble", "(", "rate", ".", "getNodeValue", "(", "))", ";", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Could", "not", "parse", "exchange", "rate", ":", "\"", "+", "rateNode", ",", "e", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "addRate", "(", "tmpRates", ",", "fromCurrency", ",", "toCurrency", ",", "exchangeRate", ")", ";", "}", "}", "catch", "(", "SAXException", "|", "IOException", "|", "XPathExpressionException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Error", "while", "parsing", "currency", "configuration", "file", "\"", "+", "currencyConfigFile", ",", "e", ")", ";", "}", "/", "/", "Atomically", "swap", "in", "the", "new", "rates", "map", ",", "if", "it", "loaded", "successfully", "this", ".", "rates", "=", "tmpRates", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "120", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "util", ";", "import", "java", ".", "io", ".", "FilterReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "input", ".", "CloseShieldInputStream", ";", "import", "org", ".", "apache", ".", "lucene", ".", "analysis", ".", "util", ".", "ResourceLoader", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "EmptyEntityResolver", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "util", ".", "SuppressForbidden", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "util", ".", "XMLErrorLogger", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "/", "**", "*", "Some", "utility", "methods", "for", "parsing", "XML", "in", "a", "safe", "way", ".", "This", "class", "can", "be", "used", "to", "parse", "XML", "*", "coming", "from", "network", "(", "completely", "untrusted", ")", "or", "it", "can", "load", "a", "config", "file", "from", "a", "*", "{", "@", "link", "ResourceLoader", "}", ".", "In", "this", "case", "it", "allows", "external", "entities", "and", "xincludes", ",", "but", "only", "*", "referring", "to", "files", "reachable", "by", "the", "loader", ".", "*", "/", "@", "SuppressForbidden", "(", "reason", "=", "\"", "This", "class", "uses", "XML", "APIs", "directly", "that", "should", "not", "be", "used", "anywhere", "else", "in", "Solr", "code", "\"", ")", "public", "final", "class", "SafeXMLParsing", "{", "public", "static", "final", "String", "SYSTEMID_UNTRUSTED", "=", "\"", "untrusted", ":", "//", "stream", "\"", ";", "private", "SafeXMLParsing", "(", ")", "{", "}", "/", "**", "Parses", "a", "config", "file", "from", "ResourceLoader", ".", "Xinclude", "and", "external", "entities", "are", "enabled", ",", "but", "cannot", "escape", "the", "resource", "loader", ".", "*", "/", "public", "static", "Document", "parseConfigXML", "(", "Logger", "log", ",", "ResourceLoader", "loader", ",", "String", "file", ")", "throws", "SAXException", ",", "IOException", "{", "try", "(", "InputStream", "in", "=", "loader", ".", "openResource", "(", "file", ")", ")", "{", "final", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setValidating", "(", "false", ")", ";", "dbf", ".", "setNamespaceAware", "(", "true", ")", ";", "trySetDOMFeature", "(", "dbf", ",", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "try", "{", "dbf", ".", "setXIncludeAware", "(", "true", ")", ";", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "XML", "parser", "doesn", "'", "t", "support", "XInclude", "option", "\"", ",", "e", ")", ";", "}", "final", "DocumentBuilder", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "db", ".", "setEntityResolver", "(", "new", "SystemIdResolver", "(", "loader", ")", ");", "db", ".", "setErrorHandler", "(", "new", "XMLErrorLogger", "(", "log", ")", ");", "return", "db", ".", "parse", "(", "in", ",", "SystemIdResolver", ".", "createSystemIdFromResourceName", "(", "file", ")", ");", "}", "catch", "(", "ParserConfigurationException", "pce", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "XML", "parser", "cannot", "be", "configured", "\"", ",", "pce", ")", ";", "}", "}", "/", "**", "Parses", "the", "given", "InputStream", "as", "XML", ",", "disabling", "any", "external", "entities", "with", "secure", "processing", "enabled", ".", "*", "The", "given", "InputStream", "is", "not", "closed", ".", "*", "/", "public", "static", "Document", "parseUntrustedXML", "(", "Logger", "log", ",", "InputStream", "in", ")", "throws", "SAXException", ",", "IOException", "{", "return", "getUntrustedDocumentBuilder", "(", "log", ")", ".", "parse", "(", "new", "CloseShieldInputStream", "(", "in", ")", ",", "SYSTEMID_UNTRUSTED", ")", ";", "}", "/", "**", "Parses", "the", "given", "InputStream", "as", "XML", ",", "disabling", "any", "external", "entities", "with", "secure", "processing", "enabled", ".", "*", "The", "given", "Reader", "is", "not", "closed", ".", "*", "/", "public", "static", "Document", "parseUntrustedXML", "(", "Logger", "log", ",", "Reader", "reader", ")", "throws", "SAXException", ",", "IOException", "{", "final", "InputSource", "is", "=", "new", "InputSource", "(", "new", "FilterReader", "(", "reader", ")", "{", "@", "Override", "public", "void", "close", "(", ")", "{", "}", "}", ");", "is", ".", "setSystemId", "(", "SYSTEMID_UNTRUSTED", ")", ";", "return", "getUntrustedDocumentBuilder", "(", "log", ")", ".", "parse", "(", "is", ")", ";", "}", "public", "static", "Document", "parseUntrustedXML", "(", "Logger", "log", ",", "String", "xml", ")", "throws", "SAXException", ",", "IOException", "{", "return", "parseUntrustedXML", "(", "log", ",", "new", "StringReader", "(", "xml", ")", ");", "}", "private", "static", "DocumentBuilder", "getUntrustedDocumentBuilder", "(", "Logger", "log", ")", "{", "try", "{", "final", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setValidating", "(", "false", ")", ";", "dbf", ".", "setNamespaceAware", "(", "true", ")", ";", "trySetDOMFeature", "(", "dbf", ",", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "final", "DocumentBuilder", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "db", ".", "setEntityResolver", "(", "EmptyEntityResolver", ".", "SAX_INSTANCE", ")", ";", "db", ".", "setErrorHandler", "(", "new", "XMLErrorLogger", "(", "log", ")", ");", "return", "db", ";", "}", "catch", "(", "ParserConfigurationException", "pce", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "XML", "parser", "cannot", "be", "configured", "\"", ",", "pce", ")", ";", "}", "}", "private", "static", "void", "trySetDOMFeature", "(", "DocumentBuilderFactory", "factory", ",", "String", "feature", ",", "boolean", "enabled", ")", "{", "try", "{", "factory", ".", "setFeature", "(", "feature", ",", "enabled", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "/", "/", "ignore", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "99", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "util", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "lucene", ".", "analysis", ".", "util", ".", "ResourceLoader", ";", "import", "org", ".", "apache", ".", "lucene", ".", "util", ".", "LuceneTestCase", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "public", "class", "TestSafeXMLParsing", "extends", "LuceneTestCase", "{", "private", "static", "final", "Logger", "log", "=", "LoggerFactory", ".", "getLogger", "(", "MethodHandles", ".", "lookup", "(", ").", "lookupClass", "(", "))", ";", "public", "void", "testUntrusted", "(", ")", "throws", "Exception", "{", "/", "/", "TODO", ":", "Fix", "the", "underlying", "EmptyEntityResolver", "to", "not", "replace", "external", "entities", "by", "nothing", "and", "instead", "throw", "exception", ":", "Document", "doc", "=", "SafeXMLParsing", ".", "parseUntrustedXML", "(", "log", ",", "\"", "<!", "DOCTYPE", "test", "[", "\\", "n", "\"", "+", "\"", "<!", "ENTITY", "internalTerm", "\\", "\"", "foobar", "\\", "\">", "\\", "n", "\"", "+", "\"", "<!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "\\", "n", "\"", "+", "\"", "<", "test", ">", "&", "internalTerm", ";", "&", "externalTerm", ";", "</", "test", ">", "\")", ";", "assertEquals", "(", "\"", "foobar", "\"", ",", "doc", ".", "getDocumentElement", "(", ").", "getTextContent", "(", "))", ";", "}", "InputStream", "getStringStream", "(", "String", "xml", ")", "{", "return", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "}", "public", "void", "testConfig", "(", ")", "throws", "Exception", "{", "final", "ResourceLoader", "loader", "=", "new", "ResourceLoader", "(", ")", "{", "@", "Override", "public", "InputStream", "openResource", "(", "String", "resource", ")", "throws", "IOException", "{", "switch", "(", "resource", ")", "{", "case", "\"", "source1", ".", "xml", "\"", ":", "return", "getStringStream", "(", "\"<", "!", "DOCTYPE", "test", "[", "\\", "n", "\"", "+", "\"", "<!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "\\", "n", "\"", "+", "\"", "<", "test", ">", "&", "externalTerm", ";", "</", "test", ">", "\")", ";", "case", "\"", "source2", ".", "xml", "\"", ":", "return", "getStringStream", "(", "\"<", "!", "DOCTYPE", "test", "[", "\\", "n", "\"", "+", "\"", "<!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\".", "/", "include1", ".", "xml", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "\\", "n", "\"", "+", "\"", "<", "test", ">", "&", "externalTerm", ";", "</", "test", ">", "\")", ";", "case", "\"", "source3", ".", "xml", "\"", ":", "return", "getStringStream", "(", "\"<", "foo", "xmlns", ":", "xi", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XInclude", "\\", "\">", "\\", "n", "\"", "+", "\"", "<", "xi", ":", "include", "href", "=", "\\\"", "./", "include2", ".", "xml", "\\", "\"/", ">\\", "n", "\"", "+", "\"", "</", "foo", ">", "\")", ";", "case", "\"", "include1", ".", "xml", "\"", ":", "return", "getStringStream", "(", "\"", "Make", "XML", "Great", "Again", "!", "\u2122\"", ");", "case", "\"", "include2", ".", "xml", "\"", ":", "return", "getStringStream", "(", "\"<", "bar", ">", "Make", "XML", "Great", "Again", "!", "\u2122<", "/", "bar", ">", "\")", ";", "}", "throw", "new", "IOException", "(", "\"", "Resource", "not", "found", ":", "\"", "+", "resource", ")", ";", "}", "@", "Override", "public", "<", "T", ">", "Class", "<", "?", "extends", "T", ">", "findClass", "(", "String", "cname", ",", "Class", "<", "T", ">", "expectedType", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ");", "}", "@", "Override", "public", "<", "T", ">", "T", "newInstance", "(", "String", "cname", ",", "Class", "<", "T", ">", "expectedType", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ");", "}", "}", ";", "IOException", "ioe", "=", "expectThrows", "(", "IOException", ".", "class", ",", "(", ")", "-", ">", "{", "SafeXMLParsing", ".", "parseConfigXML", "(", "log", ",", "loader", ",", "\"", "source1", ".", "xml", "\"", ");", "}", ");", "assertTrue", "(", "ioe", ".", "getMessage", "(", ").", "contains", "(", "\"", "Cannot", "resolve", "absolute", "systemIDs", "\"", "))", ";", "Document", "doc", "=", "SafeXMLParsing", ".", "parseConfigXML", "(", "log", ",", "loader", ",", "\"", "source2", ".", "xml", "\"", ");", "assertEquals", "(", "\"", "Make", "XML", "Great", "Again", "!", "\u2122\"", ",", "doc", ".", "getDocumentElement", "(", ").", "getTextContent", "(", "))", ";", "doc", "=", "SafeXMLParsing", ".", "parseConfigXML", "(", "log", ",", "loader", ",", "\"", "source3", ".", "xml", "\"", ");", "assertEquals", "(", "\"", "Make", "XML", "Great", "Again", "!", "\u2122\"", ",", "doc", ".", "getDocumentElement", "(", ").", "getTextContent", "(", ").", "trim", "(", "))", ";", "}", "}"], "docstring_tokens": ["read", "arbitrary", "local", "files", "from", "the", "Solr", "server", "or", "the", "internal", "network"]}
{"contents": ["Plugins:", "WysiwygEditor,", "replaced", "textarea", "by", "hidden", "input"], "code_tokens": ["@", "@", "-", "16", ",", "15", "+", "16", ",", "8", "@", "@", "limitations", "under", "the", "License", ".", "-", "->", "<", "html", "xmlns", ":", "wicket", "=", "\"", "http", ":", "//", "wicket", ".", "apache", ".", "org", "\"", ">", "<", "wicket", ":", "head", ">", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", ".", "wysiwyg", "-", "editor", "-", "textarea", "{", "display", ":", "none", ";", "}", "<", "/", "style", ">", "<", "/", "wicket", ":", "head", ">", "<", "wicket", ":", "panel", ">", "<", "div", "wicket", ":", "id", "=", "\"", "container", "\"", "class", "=", "\"", "wysiwyg", "-", "editor", "\"", "><", "/", "div", ">", "<", "textarea", "wicket", ":", "id", "=", "\"", "textarea", "\"", "class", "=", "\"", "wysiwyg", "-", "editor", "-", "textarea", "\"", "><", "/", "textarea", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "wicket", ":", "id", "=", "\"", "textarea", "\"", "/>", "<", "/", "wicket", ":", "panel", ">", "<", "/", "html", ">", "@", "@", "-", "22", ",", "9", "+", "22", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "WebMarkupContainer", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "Form", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "FormComponentPanel", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "TextArea", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "form", ".", "HiddenField", ";", "import", "org", ".", "apache", ".", "wicket", ".", "model", ".", "IModel", ";", "import", "org", ".", "apache", ".", "wicket", ".", "util", ".", "string", ".", "Strings", ";", "import", "org", ".", "owasp", ".", "html", ".", "HtmlPolicyBuilder", ";", "import", "org", ".", "owasp", ".", "html", ".", "PolicyFactory", ";", "@", "@", "-", "44", ",", "7", "+", "43", ",", "7", "@", "@", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "private", "TextArea", "<", "String", ">", "textarea", ";", "private", "HiddenField", "<", "String", ">", "textarea", ";", "private", "final", "WebMarkupContainer", "container", ";", "/", "**", "@", "@", "-", "120", ",", "13", "+", "119", ",", "8", "@", "@", "public", "void", "convertInput", "(", ")", "{", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "textarea", ".", "getConvertedInput", "(", ");", "final", "String", "clean", "=", "policy", ".", "sanitize", "(", "input", ")", ";", "final", "String", "check", "=", "policy", ".", "sanitize", "(", "Strings", ".", "unescapeMarkup", "(", "clean", ")", ".", "toString", "(", "))", ";", "if", "(", "check", ".", "equals", "(", "clean", ")", ")", "{", "this", ".", "setConvertedInput", "(", "clean", ")", ";", "}", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "}", "@", "Override", "@", "@", "-", "144", ",", "7", "+", "138", ",", "7", "@", "@", "protected", "void", "onInitialize", "(", ")", "{", "super", ".", "onInitialize", "(", ");", "this", ".", "textarea", "=", "new", "TextArea", "<", "String", ">", "(\"", "textarea", "\"", ",", "this", ".", "getModel", "(", "))", ";", "this", ".", "textarea", "=", "new", "HiddenField", "<", "String", ">", "(\"", "textarea", "\"", ",", "this", ".", "getModel", "(", "))", ";", "this", ".", "textarea", ".", "setOutputMarkupId", "(", "true", ")", ";", "this", ".", "textarea", ".", "setEscapeModelStrings", "(", "false", ")", ";", "this", ".", "add", "(", "this", ".", "textarea", ")", ";"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["Merge", "pull", "request", "#366", "from", "Tblue/JENKINS-55203", "[JENKINS-55203]", "Do", "not", "log", "private", "key", "material"], "code_tokens": ["@", "@", "-", "322", ",", "8", "+", "322", ",", "8", "@", "@", "private", "boolean", "bootstrap", "(", "EC2Computer", "computer", ",", "TaskListener", "listener", ")", "throws", "IO", "boolean", "isAuthenticated", "=", "false", ";", "logInfo", "(", "computer", ",", "listener", ",", "\"", "Getting", "keypair", ".", "..", "\")", ";", "KeyPair", "key", "=", "computer", ".", "getCloud", "(", ").", "getKeyPair", "(", ");", "logInfo", "(", "computer", ",", "listener", ",", "\"", "Using", "key", ":", "\"", "+", "key", ".", "getKeyName", "(", ")", "+", "\"", "\\", "n", "\"", "+", "key", ".", "getKeyFingerprint", "(", ")", "+", "\"", "\\", "n", "\"", "+", "key", ".", "getKeyMaterial", "(", ").", "substring", "(", "0", ",", "160", ")", ");", "logInfo", "(", "computer", ",", "listener", ",", "String", ".", "format", "(", "\"", "Using", "private", "key", "%", "s", "(", "SHA", "-", "1", "fingerprint", "%", "s", ")", "\",", "key", ".", "getKeyName", "(", "),", "key", ".", "getKeyFingerprint", "(", "))", ");", "while", "(", "tries", "-", "-", ">", "0", ")", "{", "logInfo", "(", "computer", ",", "listener", ",", "\"", "Authenticating", "as", "\"", "+", "computer", ".", "getRemoteAdmin", "(", "))", ";", "try", "{"], "docstring_tokens": ["credentials", "could", "be", "viewed", "by", "users", "with", "access", "to", "the", "master", "file", "system"]}
{"contents": ["KEYCLOAK-9629", "Update", "cookie", "type"], "code_tokens": ["@", "@", "-", "38", ",", "6", "+", "38", ",", "8", "@", "@", "public", "static", "final", "String", "TOKEN_TYPE_BEARER", "=", "\"", "Bearer", "\"", ";", "public", "static", "final", "String", "TOKEN_TYPE_KEYCLOAK_ID", "=", "\"", "Serialized", "-", "ID", "\"", ";", "public", "static", "final", "String", "TOKEN_TYPE_ID", "=", "\"", "ID", "\"", ";", "public", "static", "final", "String", "TOKEN_TYPE_REFRESH", "=", "\"", "Refresh", "\"", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "HttpRequest", ";", "import", "org", ".", "keycloak", ".", "OAuth2Constants", ";", "import", "org", ".", "keycloak", ".", "TokenVerifier", ";", "import", "org", ".", "keycloak", ".", "TokenVerifier", ".", "Predicate", ";", "import", "org", ".", "keycloak", ".", "TokenVerifier", ".", "TokenTypeCheck", ";", "import", "org", ".", "keycloak", ".", "authentication", ".", "AuthenticationFlowError", ";", "import", "org", ".", "keycloak", ".", "authentication", ".", "AuthenticationFlowException", ";", "import", "org", ".", "keycloak", ".", "authentication", ".", "AuthenticationProcessor", ";", "@", "@", "-", "123", ",", "6", "+", "125", ",", "7", "@", "@", "public", "static", "final", "String", "KEYCLOAK_SESSION_COOKIE", "=", "\"", "KEYCLOAK_SESSION", "\"", ";", "public", "static", "final", "String", "KEYCLOAK_REMEMBER_ME", "=", "\"", "KEYCLOAK_REMEMBER_ME", "\"", ";", "public", "static", "final", "String", "KEYCLOAK_LOGOUT_PROTOCOL", "=", "\"", "KEYCLOAK_LOGOUT_PROTOCOL", "\"", ";", "private", "static", "final", "TokenTypeCheck", "VALIDATE_IDENTITY_COOKIE", "=", "new", "TokenTypeCheck", "(", "TokenUtil", ".", "TOKEN_TYPE_KEYCLOAK_ID", ")", ";", "public", "static", "boolean", "isSessionValid", "(", "RealmModel", "realm", ",", "UserSessionModel", "userSession", ")", "{", "if", "(", "userSession", "=", "=", "null", ")", "{", "@", "@", "-", "170", ",", "7", "+", "173", ",", "8", "@", "@", "public", "static", "void", "expireUserSessionCookie", "(", "KeycloakSession", "session", ",", "UserSessionM", "TokenVerifier", "<", "AccessToken", ">", "verifier", "=", "TokenVerifier", ".", "create", "(", "tokenString", ",", "AccessToken", ".", "class", ")", ".", "realmUrl", "(", "Urls", ".", "realmIssuer", "(", "uriInfo", ".", "getBaseUri", "(", "),", "realm", ".", "getName", "(", "))", ")", ".", "checkActive", "(", "false", ")", ".", "checkTokenType", "(", "false", ")", ";", ".", "checkTokenType", "(", "false", ")", ".", "withChecks", "(", "VALIDATE_IDENTITY_COOKIE", ")", ";", "String", "kid", "=", "verifier", ".", "getHeader", "(", ").", "getKeyId", "(", ");", "String", "algorithm", "=", "verifier", ".", "getHeader", "(", ").", "getAlgorithm", "(", ").", "name", "(", ");", "@", "@", "-", "580", ",", "6", "+", "584", ",", "7", "@", "@", "public", "static", "IdentityCookieToken", "createIdentityToken", "(", "KeycloakSession", "keycloakSe", "token", ".", "issuedNow", "(", ");", "token", ".", "subject", "(", "user", ".", "getId", "(", "))", ";", "token", ".", "issuer", "(", "issuer", ")", ";", "token", ".", "type", "(", "TokenUtil", ".", "TOKEN_TYPE_KEYCLOAK_ID", ")", ";", "if", "(", "session", "!", "=", "null", ")", "{", "token", ".", "setSessionState", "(", "session", ".", "getId", "(", "))", ";", "@", "@", "-", "719", ",", "7", "+", "724", ",", "7", "@", "@", "public", "static", "AuthResult", "authenticateIdentityCookie", "(", "KeycloakSession", "session", ",", "Rea", "}", "String", "tokenString", "=", "cookie", ".", "getValue", "(", ");", "AuthResult", "authResult", "=", "verifyIdentityToken", "(", "session", ",", "realm", ",", "session", ".", "getContext", "(", ").", "getUri", "(", "),", "session", ".", "getContext", "(", ").", "getConnection", "(", "),", "checkActive", ",", "false", ",", "true", ",", "tokenString", ",", "session", ".", "getContext", "(", ").", "getRequestHeaders", "(", "))", ";", "AuthResult", "authResult", "=", "verifyIdentityToken", "(", "session", ",", "realm", ",", "session", ".", "getContext", "(", ").", "getUri", "(", "),", "session", ".", "getContext", "(", ").", "getConnection", "(", "),", "checkActive", ",", "false", ",", "true", ",", "tokenString", ",", "session", ".", "getContext", "(", ").", "getRequestHeaders", "(", "),", "VALIDATE_IDENTITY_COOKIE", ")", ";", "if", "(", "authResult", "=", "=", "null", ")", "{", "expireIdentityCookie", "(", "realm", ",", "session", ".", "getContext", "(", ").", "getUri", "(", "),", "session", ".", "getContext", "(", ").", "getConnection", "(", "))", ";", "expireOldIdentityCookie", "(", "realm", ",", "session", ".", "getContext", "(", ").", "getUri", "(", "),", "session", ".", "getContext", "(", ").", "getConnection", "(", "))", ";", "@", "@", "-", "1140", ",", "13", "+", "1145", ",", "14", "@", "@", "public", "void", "ignore", "(", ")", "{", "public", "static", "AuthResult", "verifyIdentityToken", "(", "KeycloakSession", "session", ",", "RealmModel", "realm", ",", "UriInfo", "uriInfo", ",", "ClientConnection", "connection", ",", "boolean", "checkActive", ",", "boolean", "checkTokenType", ",", "boolean", "isCookie", ",", "String", "tokenString", ",", "HttpHeaders", "headers", ")", "{", "boolean", "isCookie", ",", "String", "tokenString", ",", "HttpHeaders", "headers", ",", "Predicate", "<", "?", "super", "AccessToken", ">", "..", ".", "additionalChecks", ")", "{", "try", "{", "TokenVerifier", "<", "AccessToken", ">", "verifier", "=", "TokenVerifier", ".", "create", "(", "tokenString", ",", "AccessToken", ".", "class", ")", ".", "withDefaultChecks", "(", ")", ".", "realmUrl", "(", "Urls", ".", "realmIssuer", "(", "uriInfo", ".", "getBaseUri", "(", "),", "realm", ".", "getName", "(", "))", ")", ".", "checkActive", "(", "checkActive", ")", ".", "checkTokenType", "(", "checkTokenType", ")", ";", ".", "checkTokenType", "(", "checkTokenType", ")", ".", "withChecks", "(", "additionalChecks", ")", ";", "String", "kid", "=", "verifier", ".", "getHeader", "(", ").", "getKeyId", "(", ");", "String", "algorithm", "=", "verifier", ".", "getHeader", "(", ").", "getAlgorithm", "(", ").", "name", "(", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "140", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "testsuite", ".", "cookies", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "RealmRepresentation", ";", "import", "org", ".", "keycloak", ".", "services", ".", "managers", ".", "AuthenticationManager", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "AbstractKeycloakTest", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "auth", ".", "page", ".", "AuthRealm", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "pages", ".", "LoginPage", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "OAuthClient", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "OAuthClient", ".", "AuthorizationEndpointResponse", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "RealmBuilder", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "CloseableHttpResponse", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "HttpGet", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "protocol", ".", "HttpClientContext", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "BasicCookieStore", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "CloseableHttpClient", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "cookie", ".", "BasicClientCookie", ";", "import", "org", ".", "apache", ".", "http", ".", "protocol", ".", "BasicHttpContext", ";", "import", "org", ".", "apache", ".", "http", ".", "protocol", ".", "HttpContext", ";", "import", "org", ".", "apache", ".", "http", ".", "util", ".", "EntityUtils", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "graphene", ".", "page", ".", "Page", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "keycloak", ".", "testsuite", ".", "admin", ".", "AbstractAdminTest", ".", "loadJson", ";", "/", "**", "*", "*", "@", "author", "hmlnarik", "*", "/", "public", "class", "CookieTest", "extends", "AbstractKeycloakTest", "{", "@", "Page", "protected", "LoginPage", "loginPage", ";", "@", "Override", "public", "void", "addTestRealms", "(", "List", "<", "RealmRepresentation", ">", "testRealms", ")", "{", "RealmRepresentation", "realmRepresentation", "=", "loadJson", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "testrealm", ".", "json", "\"", "),", "RealmRepresentation", ".", "class", ")", ";", "RealmBuilder", "realm", "=", "RealmBuilder", ".", "edit", "(", "realmRepresentation", ")", ".", "testEventListener", "(", ");", "RealmRepresentation", "testRealm", "=", "realm", ".", "build", "(", ");", "testRealms", ".", "add", "(", "testRealm", ")", ";", "}", "@", "Test", "public", "void", "testCookieValue", "(", ")", "throws", "Exception", "{", "accountPage", ".", "setAuthRealm", "(", "AuthRealm", ".", "TEST", ")", ";", "final", "String", "accountClientId", "=", "realmsResouce", "(", ").", "realm", "(", "\"", "test", "\"", ").", "clients", "(", ").", "findByClientId", "(", "\"", "account", "\"", ").", "get", "(", "0", ")", ".", "getId", "(", ");", "final", "String", "clientSecret", "=", "realmsResouce", "(", ").", "realm", "(", "\"", "test", "\"", ").", "clients", "(", ").", "get", "(", "accountClientId", ")", ".", "getSecret", "(", ").", "getValue", "(", ");", "AuthorizationEndpointResponse", "codeResponse", "=", "oauth", ".", "clientId", "(", "\"", "account", "\"", ").", "redirectUri", "(", "accountPage", ".", "buildUri", "(", ").", "toString", "(", "))", ".", "doLogin", "(", "\"", "test", "-", "user", "@", "localhost", "\"", ",", "\"", "password", "\"", ");", "OAuthClient", ".", "AccessTokenResponse", "accTokenResp", "=", "oauth", ".", "doAccessTokenRequest", "(", "codeResponse", ".", "getCode", "(", "),", "clientSecret", ")", ";", "String", "accessToken", "=", "accTokenResp", ".", "getAccessToken", "(", ");", "accountPage", ".", "navigateTo", "(", ");", "accountPage", ".", "assertCurrent", "(", ");", "try", "(", "CloseableHttpClient", "hc", "=", "OAuthClient", ".", "newCloseableHttpClient", "(", "))", "{", "BasicCookieStore", "cookieStore", "=", "new", "BasicCookieStore", "(", ");", "BasicClientCookie", "cookie", "=", "new", "BasicClientCookie", "(", "AuthenticationManager", ".", "KEYCLOAK_IDENTITY_COOKIE", ",", "accessToken", ")", ";", "cookie", ".", "setDomain", "(", "\"", "localhost", "\"", ");", "cookie", ".", "setPath", "(", "\"/", "\")", ";", "cookieStore", ".", "addCookie", "(", "cookie", ")", ";", "HttpContext", "localContext", "=", "new", "BasicHttpContext", "(", ");", "localContext", ".", "setAttribute", "(", "HttpClientContext", ".", "COOKIE_STORE", ",", "cookieStore", ")", ";", "HttpGet", "get", "=", "new", "HttpGet", "(", "oauth", ".", "clientId", "(", "\"", "account", "\"", ").", "redirectUri", "(", "accountPage", ".", "buildUri", "(", ").", "toString", "(", "))", ".", "getLoginFormUrl", "(", "))", ";", "try", "(", "CloseableHttpResponse", "resp", "=", "hc", ".", "execute", "(", "get", ",", "localContext", ")", ")", "{", "final", "String", "pageContent", "=", "EntityUtils", ".", "toString", "(", "resp", ".", "getEntity", "(", "))", ";", "/", "/", "Ensure", "that", "we", "did", "not", "get", "to", "the", "account", "page", ".", "..", "assertThat", "(", "pageContent", ",", "not", "(", "containsString", "(", "\"", "First", "name", "\"", "))", ");", "assertThat", "(", "pageContent", ",", "not", "(", "containsString", "(", "\"", "Last", "name", "\"", "))", ");", "/", "/", ".", "..", "but", "were", "redirected", "to", "login", "page", "assertThat", "(", "pageContent", ",", "containsString", "(", "\"", "Log", "In", "\"", "))", ";", "assertThat", "(", "pageContent", ",", "containsString", "(", "\"", "Forgot", "Password", "?", "\")", ");", "}", "}", "}", "@", "Test", "public", "void", "testCookieValueLoggedOut", "(", ")", "throws", "Exception", "{", "accountPage", ".", "setAuthRealm", "(", "AuthRealm", ".", "TEST", ")", ";", "final", "String", "accountClientId", "=", "realmsResouce", "(", ").", "realm", "(", "\"", "test", "\"", ").", "clients", "(", ").", "findByClientId", "(", "\"", "account", "\"", ").", "get", "(", "0", ")", ".", "getId", "(", ");", "final", "String", "clientSecret", "=", "realmsResouce", "(", ").", "realm", "(", "\"", "test", "\"", ").", "clients", "(", ").", "get", "(", "accountClientId", ")", ".", "getSecret", "(", ").", "getValue", "(", ");", "AuthorizationEndpointResponse", "codeResponse", "=", "oauth", ".", "clientId", "(", "\"", "account", "\"", ").", "redirectUri", "(", "accountPage", ".", "buildUri", "(", ").", "toString", "(", "))", ".", "doLogin", "(", "\"", "test", "-", "user", "@", "localhost", "\"", ",", "\"", "password", "\"", ");", "OAuthClient", ".", "AccessTokenResponse", "accTokenResp", "=", "oauth", ".", "doAccessTokenRequest", "(", "codeResponse", ".", "getCode", "(", "),", "clientSecret", ")", ";", "String", "accessToken", "=", "accTokenResp", ".", "getAccessToken", "(", ");", "accountPage", ".", "navigateTo", "(", ");", "accountPage", ".", "assertCurrent", "(", ");", "accountPage", ".", "logOut", "(", ");", "try", "(", "CloseableHttpClient", "hc", "=", "OAuthClient", ".", "newCloseableHttpClient", "(", "))", "{", "BasicCookieStore", "cookieStore", "=", "new", "BasicCookieStore", "(", ");", "BasicClientCookie", "cookie", "=", "new", "BasicClientCookie", "(", "AuthenticationManager", ".", "KEYCLOAK_IDENTITY_COOKIE", ",", "accessToken", ")", ";", "cookie", ".", "setDomain", "(", "\"", "localhost", "\"", ");", "cookie", ".", "setPath", "(", "\"/", "\")", ";", "cookieStore", ".", "addCookie", "(", "cookie", ")", ";", "HttpContext", "localContext", "=", "new", "BasicHttpContext", "(", ");", "localContext", ".", "setAttribute", "(", "HttpClientContext", ".", "COOKIE_STORE", ",", "cookieStore", ")", ";", "HttpGet", "get", "=", "new", "HttpGet", "(", "oauth", ".", "clientId", "(", "\"", "account", "\"", ").", "redirectUri", "(", "accountPage", ".", "buildUri", "(", ").", "toString", "(", "))", ".", "getLoginFormUrl", "(", "))", ";", "try", "(", "CloseableHttpResponse", "resp", "=", "hc", ".", "execute", "(", "get", ",", "localContext", ")", ")", "{", "final", "String", "pageContent", "=", "EntityUtils", ".", "toString", "(", "resp", ".", "getEntity", "(", "))", ";", "/", "/", "Ensure", "that", "we", "did", "not", "get", "to", "the", "account", "page", ".", "..", "assertThat", "(", "pageContent", ",", "not", "(", "containsString", "(", "\"", "First", "name", "\"", "))", ");", "assertThat", "(", "pageContent", ",", "not", "(", "containsString", "(", "\"", "Last", "name", "\"", "))", ");", "/", "/", ".", "..", "but", "were", "redirected", "to", "login", "page", "assertThat", "(", "pageContent", ",", "containsString", "(", "\"", "Log", "In", "\"", "))", ";", "assertThat", "(", "pageContent", ",", "containsString", "(", "\"", "Forgot", "Password", "?", "\")", ");", "}", "}", "}", "}"], "docstring_tokens": ["gain", "access", "to", "another", "user's", "session"]}
{"contents": ["USB:", "cypress_m8:", "add", "endpoint", "sanity", "check", "An", "attack", "using", "missing", "endpoints", "exists.", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "447", ",", "6", "+", "447", ",", "11", "@", "@", "static", "int", "cypress_generic_port_probe", "(", "struct", "usb_serial_port", "*", "port", ")", "struct", "usb_serial", "*", "serial", "=", "port", "-", ">", "serial", ";", "struct", "cypress_private", "*", "priv", ";", "if", "(", "!", "port", "-", ">", "interrupt_out_urb", "|", "|", "!", "port", "-", ">", "interrupt_in_urb", ")", "{", "dev_err", "(", "&", "port", "-", ">", "dev", ",", "\"", "required", "endpoint", "is", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "priv", "=", "kzalloc", "(", "sizeof", "(", "struct", "cypress_private", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "priv", ")", "return", "-", "ENOMEM", ";", "@", "@", "-", "606", ",", "12", "+", "611", ",", "6", "@", "@", "static", "int", "cypress_open", "(", "struct", "tty_struct", "*", "tty", ",", "struct", "usb_serial_port", "*", "port", ")", "cypress_set_termios", "(", "tty", ",", "port", ",", "&", "priv", "-", ">", "tmp_termios", ")", ";", "/", "*", "setup", "the", "port", "and", "start", "reading", "from", "the", "device", "*", "/", "if", "(", "!", "port", "-", ">", "interrupt_in_urb", ")", "{", "dev_err", "(", "&", "port", "-", ">", "dev", ",", "\"", "%", "s", "-", "interrupt_in_urb", "is", "empty", "!", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "-", "1", ";", "}", "usb_fill_int_urb", "(", "port", "-", ">", "interrupt_in_urb", ",", "serial", "-", ">", "dev", ",", "usb_rcvintpipe", "(", "serial", "-", ">", "dev", ",", "port", "-", ">", "interrupt_in_endpointAddress", ")", ",", "port", "-", ">", "interrupt_in_urb", "-", ">", "transfer_buffer", ","], "docstring_tokens": ["the", "system", "to", "crash"]}
{"contents": ["Fix", "bug", "#72321", "-", "use", "efree()", "for", "emalloc", "allocation"], "code_tokens": ["@", "@", "-", "4217", ",", "14", "+", "4217", ",", "14", "@", "@", "static", "int", "phar_extract_file", "(", "zend_bool", "overwrite", ",", "phar_entry_info", "*", "entry", ",", "char", "*", "if", "(", "!", "php_stream_mkdir", "(", "fullpath", ",", "entry", "-", ">", "flags", "&", "PHAR_ENT_PERM_MASK", ",", "PHP_STREAM_MKDIR_RECURSIVE", ",", "NULL", ")", ")", "{", "spprintf", "(", "error", ",", "4096", ",", "\"", "Cannot", "extract", "\\", "\"%", "s", "\\", "\",", "could", "not", "create", "directory", "\\", "\"%", "s", "\\", "\"\"", ",", "entry", "-", ">", "filename", ",", "fullpath", ")", ";", "efree", "(", "fullpath", ")", ";", "free", "(", "new_state", ".", "cwd", ")", ";", "efree", "(", "new_state", ".", "cwd", ")", ";", "return", "FAILURE", ";", "}", "}", "else", "{", "if", "(", "!", "php_stream_mkdir", "(", "fullpath", ",", "0777", ",", "PHP_STREAM_MKDIR_RECURSIVE", ",", "NULL", ")", ")", "{", "spprintf", "(", "error", ",", "4096", ",", "\"", "Cannot", "extract", "\\", "\"%", "s", "\\", "\",", "could", "not", "create", "directory", "\\", "\"%", "s", "\\", "\"\"", ",", "entry", "-", ">", "filename", ",", "fullpath", ")", ";", "efree", "(", "fullpath", ")", ";", "free", "(", "new_state", ".", "cwd", ")", ";", "efree", "(", "new_state", ".", "cwd", ")", ";", "return", "FAILURE", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "26", "@", "@", "-", "-", "TEST", "-", "-", "Phar", ":", "PHP", "bug", "#", "72321", ":", "invalid", "free", "in", "phar_extract_file", "(", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "phar", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "chdir", "(", "__DIR__", ")", ";", "mkdir", "(", "\"", "test72321", "\"", ");", "$", "phar", "=", "new", "PharData", "(", "\"", "72321_1", ".", "zip", "\"", ");", "$", "phar", "-", ">", "extractTo", "(", "\"", "test72321", "\"", ");", "$", "phar", "=", "new", "PharData", "(", "\"", "72321_2", ".", "zip", "\"", ");", "try", "{", "$", "phar", "-", ">", "extractTo", "(", "\"", "test72321", "\"", ");", "}", "catch", "(", "PharException", "$", "e", ")", "{", "print", "$", "e", "-", ">", "getMessage", "(", ").", "\"\\", "n", "\"", ";", "}", "?", ">", "DONE", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "unlink", "(", "__DIR__", ".", "\"/", "test72321", "/", "AAAAAAAAxxxxBBBBCCCCCCCCxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", "\"", ");", "rmdir", "(", "__DIR__", ".", "\"/", "test72321", "\"", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "PharData", ":", ":", "extractTo", "(", "):", "Not", "a", "directory", "in", "%", "s", "/", "bug72321", ".", "php", "on", "line", "%", "d", "Extraction", "from", "phar", "\"", "%", "s", "/", "72321_2", ".", "zip", "\"", "failed", ":", "Cannot", "extract", "\"", "AAAAAAAAxxxxBBBBCCCCCCCCxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", "/", "b", "/", "c", "\"", ",", "could", "not", "create", "directory", "\"", "test72321", "/", "AAAAAAAAxxxxBBBBCCCCCCCCxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", "/", "b", "\"", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["x86/microcode:", "Allow", "late", "microcode", "loading", "with", "SMT", "disabled", "The", "kernel", "unnecessarily", "prevents", "late", "microcode", "loading", "when", "SMT", "is", "disabled.", "It", "should", "be", "safe", "to", "allow", "it", "if", "all", "the", "primary", "threads", "are", "online.", "Signed-off-by:", "Josh", "Poimboeuf", "<jpoimboe@redhat.com>", "Acked-by:", "Borislav", "Petkov", "<bp@suse.de>", "Signed-off-by:", "David", "Woodhouse", "<dwmw@amazon.co.uk>"], "code_tokens": ["@", "@", "-", "509", ",", "12", "+", "509", ",", "20", "@", "@", "static", "struct", "platform_device", "*", "microcode_pdev", ";", "static", "int", "check_online_cpus", "(", "void", ")", "{", "if", "(", "num_online_cpus", "(", ")", "=", "=", "num_present_cpus", "(", "))", "return", "0", ";", "unsigned", "int", "cpu", ";", "pr_err", "(", "\"", "Not", "all", "CPUs", "online", ",", "aborting", "microcode", "update", ".", "\\", "n", "\"", ");", "/", "*", "*", "Make", "sure", "all", "CPUs", "are", "online", ".", "It", "'", "s", "fine", "for", "SMT", "to", "be", "disabled", "if", "*", "all", "the", "primary", "threads", "are", "still", "online", ".", "*", "/", "for_each_present_cpu", "(", "cpu", ")", "{", "if", "(", "topology_is_primary_thread", "(", "cpu", ")", "&", "&", "!", "cpu_online", "(", "cpu", ")", ")", "{", "pr_err", "(", "\"", "Not", "all", "CPUs", "online", ",", "aborting", "microcode", "update", ".", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "}", "return", "-", "EINVAL", ";", "return", "0", ";", "}", "static", "atomic_t", "late_cpus_in", ";"], "docstring_tokens": ["leak", "information", "residing", "in", "the", "L1", "data", "cache", "and", "read", "data", "belonging", "to", "different", "security", "contexts"]}
{"contents": ["driver", "core:", "platform:", "fix", "race", "condition", "with", "driver_override", "The", "driver_override", "implementation", "is", "susceptible", "to", "race", "condition", "when", "different", "threads", "are", "reading", "vs", "storing", "a", "different", "driver", "override.", "Add", "locking", "to", "avoid", "race", "condition.", "Fixes:", "3d713e0e382e", "(\"driver", "core:", "platform:", "add", "device", "binding", "path", "'driver_override'\")", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Adrian", "Salido", "<salidoa@google.com>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "866", ",", "7", "+", "866", ",", "7", "@", "@", "static", "ssize_t", "driver_override_store", "(", "struct", "device", "*", "dev", ",", "const", "char", "*", "buf", ",", "size_t", "count", ")", "{", "struct", "platform_device", "*", "pdev", "=", "to_platform_device", "(", "dev", ")", ";", "char", "*", "driver_override", ",", "*", "old", "=", "pdev", "-", ">", "driver_override", ",", "*", "cp", ";", "char", "*", "driver_override", ",", "*", "old", ",", "*", "cp", ";", "if", "(", "count", ">", "PATH_MAX", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "879", ",", "12", "+", "879", ",", "15", "@", "@", "static", "ssize_t", "driver_override_store", "(", "struct", "device", "*", "dev", ",", "if", "(", "cp", ")", "*", "cp", "=", "'", "\\", "0", "'", ";", "device_lock", "(", "dev", ")", ";", "old", "=", "pdev", "-", ">", "driver_override", ";", "if", "(", "strlen", "(", "driver_override", ")", ")", "{", "pdev", "-", ">", "driver_override", "=", "driver_override", ";", "}", "else", "{", "kfree", "(", "driver_override", ")", ";", "pdev", "-", ">", "driver_override", "=", "NULL", ";", "}", "device_unlock", "(", "dev", ")", ";", "kfree", "(", "old", ")", ";", "@", "@", "-", "895", ",", "8", "+", "898", ",", "12", "@", "@", "static", "ssize_t", "driver_override_show", "(", "struct", "device", "*", "dev", ",", "struct", "device_attribute", "*", "attr", ",", "char", "*", "buf", ")", "{", "struct", "platform_device", "*", "pdev", "=", "to_platform_device", "(", "dev", ")", ";", "ssize_t", "len", ";", "return", "sprintf", "(", "buf", ",", "\"", "%", "s", "\\", "n", "\"", ",", "pdev", "-", ">", "driver_override", ")", ";", "device_lock", "(", "dev", ")", ";", "len", "=", "sprintf", "(", "buf", ",", "\"", "%", "s", "\\", "n", "\"", ",", "pdev", "-", ">", "driver_override", ")", ";", "device_unlock", "(", "dev", ")", ";", "return", "len", ";", "}", "static", "DEVICE_ATTR_RW", "(", "driver_override", ")", ";"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["\u4fee\u590dsql\u6ce8\u5165bug"], "code_tokens": ["@", "@", "-", "1", ",", "12", "+", "1", ",", "11", "@", "@", "package", "org", ".", "marker", ".", "mushroom", ".", "core", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "beans", ".", "Channel", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "context", ".", "ActionContext", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "core", ".", "config", ".", "impl", ".", "SystemConfig", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "holder", ".", "SpringContextHolder", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "/", "**", "@", "@", "-", "39", ",", "7", "+", "38", ",", "7", "@", "@", "public", "String", "modelType", "=", "\"", "\";", "/", "**", "\u5185", "\u5bb9", "ID", "*", "/", "public", "String", "contentId", "=", "\"", "0", "\"", ";", "public", "Integer", "contentId", "=", "0", ";", "/", "**", "\u9875", "\u7801\uff08", "\u9ed8\u8ba4", "\u4e3a", "1", "\uff09", "*", "/", "public", "String", "page", "=", "\"", "1", "\"", ";/", "/\u9875", "\u7801", "contentId", "@", "@", "-", "88", ",", "7", "+", "87", ",", "9", "@", "@", "private", "WebParam", "(", "HttpServletRequest", "req", ")", "{", "if", "(", "!(", "this", ".", "pageName", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "this", ".", "pageName", ")", "))", "{", "this", ".", "pageName", "=", "config", ".", "get", "(", "\"", "index_page", "\"", ");", "//", "\u83b7", "\u53d6\u9ed8", "\u8ba4\u4e3b", "\u9875\u5730", "\u5740", "}", "this", ".", "contentId", "=", "req", ".", "getParameter", "(", "FIELD_ID", ")", ";/", "/", "\u5185", "\u5bb9", "ID", "String", "contentId", "=", "req", ".", "getParameter", "(", "FIELD_ID", ")", ";", "this", ".", "contentId", "=", "contentId", "=", "=", "null", "?", "0", ":", "Integer", ".", "valueOf", "(", "contentId", ")", ";/", "/", "\u5185", "\u5bb9", "ID", "this", ".", "page", "=", "req", ".", "getParameter", "(", "FIELD_PAGE", ")", ";/", "/", "\u9875", "\u7801", "try", "{", "@", "@", "-", "82", ",", "20", "+", "82", ",", "17", "@", "@", "public", "void", "doDataReplace", "(", "MatchRule", "mr", ")", "throws", "SystemException", "{", "datasource", ".", "setType", "(", "\"", "page", "\"", ");", "datasource", ".", "setVarAndItems", "(", "var", ",", "items", ")", ";", "String", "contentId", "=", "WebParam", ".", "get", "(", ").", "contentId", ";", "Integer", "contentId", "=", "WebParam", ".", "get", "(", ").", "contentId", ";", "/", "/", "TODO", "\u5360", "\u65f6\u5199", "\u6b7b\u7684", "\u4ee3\u7801", "\uff0c\u9700", "\u8981\u8c03", "\u6574", "if", "(", "sql", ".", "indexOf", "(", "\"", "thematic_article", "\"", ")", "!", "=-", "1", ")", "{", "datasource", ".", "setSql", "(", "sql", "+", "\"", "and", "b", ".", "tid", "=", "\"", "+", "contentId", ")", ";", "datasource", ".", "setSql", "(", "sql", "+", "\"", "and", "b", ".", "tid", "=", "\"", "+", "contentId", ")", ";", "}", "else", "{", "datasource", ".", "setSql", "(", "sql", ")", ";", "}", "String", "re", "=", "\"", "<#", "list", "\"", ".", "concat", "(", "items", ")", ".", "concat", "(", "\".", "data", "as", "\"", ").", "concat", "(", "var", ")", ".", "concat", "(", "\">", "\")", ";", "@", "@", "-", "1", ",", "9", "+", "1", ",", "7", "@", "@", "package", "org", ".", "marker", ".", "mushroom", ".", "service", ".", "impl", ";", "import", "com", ".", "alibaba", ".", "fastjson", ".", "JSONObject", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "alias", ".", "Core", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "alias", ".", "Services", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "beans", ".", "Category", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "beans", ".", "Channel", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "core", ".", "channel", ".", "TreeUtils", ";", "import", "org", ".", "marker", ".", "mushroom", ".", "dao", ".", "IChannelDao", ";", "@", "@", "-", "15", ",", "7", "+", "13", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "jdbc", ".", "core", ".", "JdbcTemplate", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Service", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "64", ",", "10", "+", "61", ",", "17", "@", "@", "public", "Channel", "getByUrl", "(", "String", "pageName", ")", "{", "return", "channelDao", ".", "findByUrl", "(", "pageName", ")", ";", "}", "public", "Channel", "getChannel", "(", "String", "tableName", ",", "String", "contentId", ")", "{", "/", "**", "*", "\u83b7", "\u53d6\u680f", "\u76ee", "*", "@", "param", "tableName", "\u8868", "\u540d\u79f0", "*", "@", "param", "contentId", "\u5185", "\u5bb9", "Id", "*", "@", "return", "*", "/", "public", "Channel", "getChannel", "(", "String", "tableName", ",", "Integer", "contentId", ")", "{", "String", "prefix", "=", "channelDao", ".", "getPreFix", "(", ");", "JdbcTemplate", "jdbcTemplate", "=", "SpringContextHolder", ".", "getBean", "(", "\"", "jdbcTemplate", "\"", ");", "String", "sql", "=", "\"", "select", "a", ".", "*", "from", "\"", "+", "prefix", "+", "\"", "channel", "a", "join", "\"", "+", "tableName", "+", "\"", "b", "on", "b", ".", "cid", "=", "a", ".", "id", "WHERE", "b", ".", "id", "=", "\"", "+", "contentId", "+", "\"", "limit", "1", "\"", ";", "String", "sql", "=", "\"", "select", "a", ".", "*", "from", "\"", "+", "prefix", "+", "\"", "channel", "a", "join", "\"", "+", "tableName", "+", "\"", "b", "on", "b", ".", "cid", "=", "a", ".", "id", "WHERE", "b", ".", "id", "=", "\"", "+", "contentId", "+", "\"", "limit", "1", "\"", ";", "return", "jdbcTemplate", ".", "queryForObject", "(", "sql", ",", "new", "ObjectRowMapper", ".", "RowMapperChannel", "(", "))", ";", "}"], "docstring_tokens": ["modify", "or", "delete", "information", "in", "the", "back-end", "database"]}
{"contents": ["Refactor", "JMX", "remote", "RMI", "registry", "creation"], "code_tokens": ["@", "@", "-", "25", ",", "10", "+", "25", ",", "11", "@", "@", "import", "java", ".", "net", ".", "ServerSocket", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "java", ".", "rmi", ".", "AccessException", ";", "import", "java", ".", "rmi", ".", "AlreadyBoundException", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "RMIClientSocketFactory", ";", "import", "java", ".", "rmi", ".", "server", ".", "RMIServerSocketFactory", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "@", "@", "-", "300", ",", "18", "+", "301", ",", "6", "@", "@", "private", "JMXConnectorServer", "createServer", "(", "String", "serverName", ",", "RMIClientSocketFactory", "registryCsf", ",", "RMIServerSocketFactory", "registrySsf", ",", "RMIClientSocketFactory", "serverCsf", ",", "RMIServerSocketFactory", "serverSsf", ")", "{", "/", "/", "Create", "the", "RMI", "registry", "Registry", "registry", ";", "try", "{", "registry", "=", "LocateRegistry", ".", "createRegistry", "(", "theRmiRegistryPort", ",", "registryCsf", ",", "registrySsf", ")", ";", "}", "catch", "(", "RemoteException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createRegistryFailed", "\"", ",", "serverName", ",", "Integer", ".", "toString", "(", "theRmiRegistryPort", ")", "),", "e", ")", ";", "return", "null", ";", "}", "if", "(", "bindAddress", "=", "=", "null", ")", "{", "bindAddress", "=", "\"", "localhost", "\"", ";", "}", "@", "@", "-", "332", ",", "18", "+", "321", ",", "23", "@", "@", "private", "JMXConnectorServer", "createServer", "(", "String", "serverName", ",", "cs", "=", "new", "RMIConnectorServer", "(", "serviceUrl", ",", "theEnv", ",", "server", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "cs", ".", "start", "(", ");", "registry", ".", "bind", "(", "\"", "jmxrmi", "\"", ",", "server", ".", "toStub", "(", "))", ";", "Remote", "jmxServer", "=", "server", ".", "toStub", "(", ");", "/", "/", "Create", "the", "RMI", "registry", "try", "{", "new", "JmxRegistry", "(", "theRmiRegistryPort", ",", "registryCsf", ",", "registrySsf", ",", "\"", "jmxrmi", "\"", ",", "jmxServer", ")", ";", "}", "catch", "(", "RemoteException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createRegistryFailed", "\"", ",", "serverName", ",", "Integer", ".", "toString", "(", "theRmiRegistryPort", ")", "),", "e", ")", ";", "return", "null", ";", "}", "log", ".", "info", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "start", "\"", ",", "Integer", ".", "toString", "(", "theRmiRegistryPort", ")", ",", "Integer", ".", "toString", "(", "theRmiServerPort", ")", ",", "serverName", ")", ");", "}", "catch", "(", "IOException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createServerFailed", "\"", ",", "serverName", ")", ",", "e", ")", ";", "}", "catch", "(", "AlreadyBoundException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createServerFailed", "\"", ",", "serverName", ")", ",", "e", ")", ";", "}", "return", "cs", ";", "}", "@", "@", "-", "496", ",", "4", "+", "490", ",", "39", "@", "@", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "true", ";", "}", "}", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "3772054804656428217L", ";", "private", "final", "String", "jmxName", ";", "private", "final", "Remote", "jmxServer", ";", "public", "JmxRegistry", "(", "int", "port", ",", "RMIClientSocketFactory", "csf", ",", "RMIServerSocketFactory", "ssf", ",", "String", "jmxName", ",", "Remote", "jmxServer", ")", "throws", "RemoteException", "{", "super", "(", "port", ",", "csf", ",", "ssf", ")", ";", "this", ".", "jmxName", "=", "jmxName", ";", "this", ".", "jmxServer", "=", "jmxServer", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "name", ")", "throws", "RemoteException", ",", "NotBoundException", "{", "return", "(", "jmxName", ".", "equals", "(", "name", ")", ")", "?", "jmxServer", ":", "null", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "name", ",", "Remote", "obj", ")", "throws", "RemoteException", ",", "AlreadyBoundException", ",", "AccessException", "{", "}", "@", "Override", "public", "void", "unbind", "(", "String", "name", ")", "throws", "RemoteException", ",", "NotBoundException", ",", "AccessException", "{", "}", "@", "Override", "public", "void", "rebind", "(", "String", "name", ",", "Remote", "obj", ")", "throws", "RemoteException", ",", "AccessException", "{", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "throws", "RemoteException", "{", "return", "new", "String", "[", "]", "{", "jmxName", "}", ";", "}", "}", "}", "@", "@", "-", "73", ",", "6", "+", "73", ",", "9", "@", "@", "<", "update", ">", "<", "bug", ">", "63905", "<", "/", "bug", ">", "Clean", "up", "Tomcat", "CSS", ".", "(", "michaelo", ")", "<", "/", "update", ">", "<", "fix", ">", "Refactor", "JMX", "remote", "RMI", "registry", "creation", ".", "(", "remm", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["ZOOKEEPER-2693:", "DOS", "attack", "on", "wchp/wchc", "four", "letter", "words", "(4lw)", "The", "previous", "patch", "is", "not", "valid", "anymore", "as", "design", "has", "changed.", "Update", "patch", "based", "on", "phunt", "'s", "feedback.", "See", "ZOOKEEPER-2693", "JIRA", "for", "details.", "This", "patch", "is", "still", "targeting", "for", "branch-3.5", "/", "master.", "Patch", "for", "branch-3.4", "will", "be", "created", "shortly.", "The", "gist", "of", "the", "patch", "is:", "*", "Introduced", "a", "new", "configuration", "option", "which", "encodes", "a", "white", "list", "of", "4lw", "commands.", "A", "4lw", "command", "that", "is", "not", "on", "the", "white", "list", "will", "not", "be", "enabled", "on", "server", "side.", "*", "For", "branch-3.5,", "the", "default", "value", "of", "the", "configuration", "option", "is", "empty.", "We", "want", "users", "to", "use", "the", "alternative", "AdminServer", "anyway.", "Author:", "Michael", "Han", "<hanm@apache.org>", "Reviewers:", "Rakesh", "Radhakrishnan", "<rakeshrapache.org>,", "Mohammad", "Arshad", "<arshad@apache.org>,", "Flavio", "Junqueira", "<fpj@apache.org>,", "Edward", "Ribeiro", "<edward.ribeiro@gmail.com>,", "Abraham", "Fine", "<afine@apache.org>", "Closes", "#179", "from", "hanm/ZOOKEEPER-2693", "and", "squashes", "the", "following", "commits:", "1ffd114", "[Michael", "Han]", "Tweak", "tests.", "b4c421d", "[Michael", "Han]", "ZOOKEEPER-2693:", "DOS", "attack", "on", "wchp/wchc", "four", "letter", "words", "(4lw).", "Introduce", "a", "new", "configuration", "option", "4lw.commands.whitelist", "that", "disables", "all", "4lw", "(except", "srvr)", "by", "default", "to", "avoid", "the", "exploits", "reported", "on", "wchp/wchc", "commands.", "(cherry", "picked", "from", "commit", "5fe68506f217246c7ebd96803f9c78e13ec2f11a)", "Signed-off-by:", "Michael", "Han", "<hanm@apache.org>"], "code_tokens": ["@", "@", "-", "1145", ",", "6", "+", "1145", ",", "40", "@", "@", "server", ".", "3", "=", "zoo3", ":", "2888", ":", "3888", "<", "/", "programlisting", ">", "<", "/", "listitem", ">", "<", "/", "varlistentry", ">", "<", "varlistentry", ">", "<", "term", ">", "4lw", ".", "commands", ".", "whitelist", "<", "/", "term", ">", "<", "listitem", ">", "<", "para", ">", "(", "Java", "system", "property", ":", "<", "emphasis", "role", "=", "\"", "bold", "\"", ">", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "<", "/", "emphasis", ">", ")<", "/", "para", ">", "<", "para", ">", "<", "emphasis", "role", "=", "\"", "bold", "\"", ">", "New", "in", "3", ".", "5", ".", "3", ":", "</", "emphasis", ">", "A", "list", "of", "comma", "separated", "<", "ulink", "url", "=", "\"#", "sc_4lw", "\"", ">", "Four", "Letter", "Words", "<", "/", "ulink", ">", "commands", "that", "user", "wants", "to", "use", ".", "A", "valid", "Four", "Letter", "Words", "command", "must", "be", "put", "in", "this", "list", "else", "ZooKeeper", "server", "will", "not", "enable", "the", "command", ".", "By", "default", "the", "whitelist", "only", "contains", "\"", "srvr", "\"", "command", "which", "zkServer", ".", "sh", "uses", ".", "The", "rest", "of", "four", "letter", "word", "commands", "are", "disabled", "by", "default", ".", "<", "/", "para", ">", "<", "para", ">", "Here", "'", "s", "an", "example", "of", "the", "configuration", "that", "enables", "stat", ",", "ruok", ",", "conf", ",", "and", "isro", "command", "while", "disabling", "the", "rest", "of", "Four", "Letter", "Words", "command", ":", "</", "para", ">", "<", "programlisting", ">", "4lw", ".", "commands", ".", "whitelist", "=", "stat", ",", "ruok", ",", "conf", ",", "isro", "<", "/", "programlisting", ">", "<", "para", ">", "If", "you", "really", "need", "enable", "all", "four", "letter", "word", "commands", "by", "default", ",", "you", "can", "use", "the", "asterisk", "option", "so", "you", "don", "'", "t", "have", "to", "include", "every", "command", "one", "by", "one", "in", "the", "list", ".", "As", "an", "example", ",", "this", "will", "enable", "all", "four", "letter", "word", "commands", ":", "<", "/", "para", ">", "<", "programlisting", ">", "4lw", ".", "commands", ".", "whitelist", "=", "*", "<", "/", "programlisting", ">", "<", "/", "listitem", ">", "<", "/", "varlistentry", ">", "<", "/", "variablelist", ">", "<", "para", ">", "</", "para", ">", "<", "/", "section", ">", "@", "@", "-", "1600", ",", "7", "+", "1634", ",", "7", "@", "@", "server", ".", "3", "=", "zoo3", ":", "2888", ":", "3888", "<", "/", "programlisting", ">", "<", "section", "id", "=", "\"", "sc_zkCommands", "\"", ">", "<", "title", ">", "ZooKeeper", "Commands", "<", "/", "title", ">", "<", "section", ">", "<", "section", "id", "=", "\"", "sc_4lw", "\"", ">", "<", "title", ">", "The", "Four", "Letter", "Words", "<", "/", "title", ">", "<", "para", ">", "ZooKeeper", "responds", "to", "a", "small", "set", "of", "commands", ".", "Each", "command", "is", "composed", "of", "four", "letters", ".", "You", "issue", "the", "commands", "to", "ZooKeeper", "via", "telnet", "@", "@", "-", "1611", ",", "7", "+", "1645", ",", "16", "@", "@", "server", ".", "3", "=", "zoo3", ":", "2888", ":", "3888", "<", "/", "programlisting", ">", "while", "\"", "srvr", "\"", "and", "\"", "cons", "\"", "give", "extended", "details", "on", "server", "and", "connections", "respectively", ".", "</", "para", ">", "<", "variablelist", ">", "<", "para", ">", "<", "emphasis", "role", "=", "\"", "bold", "\"", ">", "New", "in", "3", ".", "5", ".", "3", ":", "</", "emphasis", ">", "Four", "Letter", "Words", "need", "to", "be", "explicitly", "white", "listed", "before", "using", ".", "Please", "refer", "<", "emphasis", "role", "=", "\"", "bold", "\"", ">", "4lw", ".", "commands", ".", "whitelist", "<", "/", "emphasis", ">", "described", "in", "<", "ulink", "url", "=", "\"#", "sc_clusterOptions", "\"", ">", "cluster", "configuration", "section", "<", "/", "ulink", ">", "for", "details", ".", "Moving", "forward", ",", "Four", "Letter", "Words", "will", "be", "deprecated", ",", "please", "use", "<", "ulink", "url", "=", "\"#", "sc_adminserver", "\"", ">", "AdminServer", "<", "/", "ulink", ">", "instead", ".", "<", "/", "para", ">", "<", "variablelist", ">", "<", "varlistentry", ">", "<", "term", ">", "conf", "<", "/", "term", ">", "@", "@", "-", "2081", ",", "6", "+", "2124", ",", "16", "@", "@", "server", ".", "3", "=", "zoo3", ":", "2888", ":", "3888", "<", "/", "programlisting", ">", "usage", "limit", "that", "would", "cause", "the", "system", "to", "swap", ".", "</", "para", ">", "<", "/", "listitem", ">", "<", "/", "varlistentry", ">", "<", "varlistentry", ">", "<", "term", ">", "Publicly", "accessible", "deployment", "<", "/", "term", ">", "<", "listitem", ">", "<", "para", ">", "A", "ZooKeeper", "ensemble", "is", "expected", "to", "operate", "in", "a", "trusted", "computing", "environment", ".", "It", "is", "thus", "recommended", "to", "deploy", "ZooKeeper", "behind", "a", "firewall", ".", "<", "/", "para", ">", "<", "/", "listitem", ">", "<", "/", "varlistentry", ">", "<", "/", "variablelist", ">", "<", "/", "section", ">", "@", "@", "-", "47", ",", "6", "+", "47", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "CommandExecutor", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "FourLetterCommands", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "SetTraceMaskCommand", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "NopCommand", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "478", ",", "12", "+", "479", ",", "11", "@", "@", "private", "boolean", "checkFourLetterWord", "(", "final", "SelectionKey", "k", ",", "final", "int", "len", ")", "{", "/", "/", "We", "take", "advantage", "of", "the", "limited", "size", "of", "the", "length", "to", "look", "/", "/", "for", "cmds", ".", "They", "are", "all", "4", "-", "bytes", "which", "fits", "inside", "of", "an", "int", "String", "cmd", "=", "FourLetterCommands", ".", "getCmdMapView", "(", ").", "get", "(", "len", ")", ";", "if", "(", "cmd", "=", "=", "null", ")", "{", "if", "(", "!", "FourLetterCommands", ".", "isKnown", "(", "len", ")", ")", "{", "return", "false", ";", "}", "LOG", ".", "info", "(", "\"", "Processing", "\"", "+", "cmd", "+", "\"", "command", "from", "\"", "+", "sock", ".", "socket", "(", ").", "getRemoteSocketAddress", "(", "))", ";", "String", "cmd", "=", "FourLetterCommands", ".", "getCommandString", "(", "len", ")", ";", "packetReceived", "(", ");", "/", "**", "cancel", "the", "selection", "key", "to", "remove", "the", "socket", "handling", "@", "@", "-", "505", ",", "6", "+", "505", ",", "19", "@", "@", "private", "boolean", "checkFourLetterWord", "(", "final", "SelectionKey", "k", ",", "final", "int", "len", ")", "final", "PrintWriter", "pwriter", "=", "new", "PrintWriter", "(", "new", "BufferedWriter", "(", "new", "SendBufferWriter", "(", "))", ");", "/", "/", "ZOOKEEPER", "-", "2693", ":", "don", "'", "t", "execute", "4lw", "if", "it", "'", "s", "not", "enabled", ".", "if", "(", "!", "FourLetterCommands", ".", "isEnabled", "(", "cmd", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "Command", "{", "}", "is", "not", "executed", "because", "it", "is", "not", "in", "the", "whitelist", ".", "\",", "cmd", ")", ";", "NopCommand", "nopCmd", "=", "new", "NopCommand", "(", "pwriter", ",", "this", ",", "cmd", "\"", "is", "not", "executed", "because", "it", "is", "not", "in", "the", "whitelist", ".", "\")", ";", "nopCmd", ".", "start", "(", ");", "return", "true", ";", "}", "LOG", ".", "info", "(", "\"", "Processing", "\"", "+", "cmd", "+", "\"", "command", "from", "\"", "+", "sock", ".", "socket", "(", ").", "getRemoteSocketAddress", "(", "))", ";", "if", "(", "len", "=", "=", "FourLetterCommands", ".", "setTraceMaskCmd", ")", "{", "incomingBuffer", "=", "ByteBuffer", ".", "allocate", "(", "8", ")", ";", "int", "rc", "=", "sock", ".", "read", "(", "incomingBuffer", ")", ";", "@", "@", "-", "41", ",", "6", "+", "41", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "zookeeper", ".", "proto", ".", "WatcherEvent", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "CommandExecutor", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "FourLetterCommands", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "NopCommand", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "SetTraceMaskCommand", ";", "import", "org", ".", "jboss", ".", "netty", ".", "buffer", ".", "ChannelBuffer", ";", "import", "org", ".", "jboss", ".", "netty", ".", "buffer", ".", "ChannelBuffers", ";", "@", "@", "-", "267", ",", "17", "+", "268", ",", "30", "@", "@", "private", "boolean", "checkFourLetterWord", "(", "final", "Channel", "channel", ",", "{", "/", "/", "We", "take", "advantage", "of", "the", "limited", "size", "of", "the", "length", "to", "look", "/", "/", "for", "cmds", ".", "They", "are", "all", "4", "-", "bytes", "which", "fits", "inside", "of", "an", "int", "String", "cmd", "=", "FourLetterCommands", ".", "getCmdMapView", "(", ").", "get", "(", "len", ")", ";", "if", "(", "cmd", "=", "=", "null", ")", "{", "if", "(", "!", "FourLetterCommands", ".", "isKnown", "(", "len", ")", ")", "{", "return", "false", ";", "}", "String", "cmd", "=", "FourLetterCommands", ".", "getCommandString", "(", "len", ")", ";", "channel", ".", "setInterestOps", "(", "0", ")", ".", "awaitUninterruptibly", "(", ");", "LOG", ".", "info", "(", "\"", "Processing", "\"", "+", "cmd", "+", "\"", "command", "from", "\"", "+", "channel", ".", "getRemoteAddress", "(", "))", ";", "packetReceived", "(", ");", "final", "PrintWriter", "pwriter", "=", "new", "PrintWriter", "(", "new", "BufferedWriter", "(", "new", "SendBufferWriter", "(", "))", ");", "/", "/", "ZOOKEEPER", "-", "2693", ":", "don", "'", "t", "execute", "4lw", "if", "it", "'", "s", "not", "enabled", ".", "if", "(", "!", "FourLetterCommands", ".", "isEnabled", "(", "cmd", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "Command", "{", "}", "is", "not", "executed", "because", "it", "is", "not", "in", "the", "whitelist", ".", "\",", "cmd", ")", ";", "NopCommand", "nopCmd", "=", "new", "NopCommand", "(", "pwriter", ",", "this", ",", "cmd", "\"", "is", "not", "executed", "because", "it", "is", "not", "in", "the", "whitelist", ".", "\")", ";", "nopCmd", ".", "start", "(", ");", "return", "true", ";", "}", "LOG", ".", "info", "(", "\"", "Processing", "\"", "+", "cmd", "+", "\"", "command", "from", "\"", "+", "channel", ".", "getRemoteAddress", "(", "))", ";", "if", "(", "len", "=", "=", "FourLetterCommands", ".", "setTraceMaskCmd", ")", "{", "ByteBuffer", "mask", "=", "ByteBuffer", ".", "allocate", "(", "8", ")", ";", "message", ".", "readBytes", "(", "mask", ")", ";", "@", "@", "-", "18", ",", "10", "+", "18", ",", "15", "@", "@", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "Arrays", ";", "/", "**", "*", "This", "class", "contains", "constants", "for", "all", "the", "four", "letter", "commands", "@", "@", "-", "153", ",", "11", "+", "158", ",", "82", "@", "@", "*", "/", "public", "final", "static", "int", "telnetCloseCmd", "=", "0xfff4fffd", ";", "final", "static", "HashMap", "<", "Integer", ",", "String", ">", "cmd2String", "=", "new", "HashMap", "<", "Integer", ",", "String", ">", "()", ";", "private", "static", "final", "String", "ZOOKEEPER_4LW_COMMANDS_WHITELIST", "=", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ";", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "FourLetterCommands", ".", "class", ")", ";", "private", "static", "final", "Map", "<", "Integer", ",", "String", ">", "cmd2String", "=", "new", "HashMap", "<", "Integer", ",", "String", ">", "()", ";", "private", "static", "final", "Set", "<", "String", ">", "whiteListedCommands", "=", "new", "HashSet", "<", "String", ">", "()", ";", "private", "static", "boolean", "whiteListInitialized", "=", "false", ";", "/", "/", "@", "VisibleForTesting", "public", "static", "void", "resetWhiteList", "(", ")", "{", "whiteListInitialized", "=", "false", ";", "whiteListedCommands", ".", "clear", "(", ");", "}", "/", "**", "*", "Return", "the", "string", "representation", "of", "the", "specified", "command", "code", ".", "*", "/", "public", "static", "String", "getCommandString", "(", "int", "command", ")", "{", "return", "cmd2String", ".", "get", "(", "command", ")", ";", "}", "/", "**", "*", "Check", "if", "the", "specified", "command", "code", "is", "from", "a", "known", "command", ".", "*", "*", "@", "param", "command", "The", "integer", "code", "of", "command", ".", "*", "@", "return", "true", "if", "the", "specified", "command", "is", "known", ",", "false", "otherwise", ".", "*", "/", "public", "static", "boolean", "isKnown", "(", "int", "command", ")", "{", "return", "cmd2String", ".", "containsKey", "(", "command", ")", ";", "}", "/", "**", "*", "Check", "if", "the", "specified", "command", "is", "enabled", ".", "*", "*", "In", "ZOOKEEPER", "-", "2693", "we", "introduce", "a", "configuration", "option", "to", "only", "*", "allow", "a", "specific", "set", "of", "white", "listed", "commands", "to", "execute", ".", "*", "A", "command", "will", "only", "be", "executed", "if", "it", "is", "also", "configured", "*", "in", "the", "white", "list", ".", "*", "*", "@", "param", "command", "The", "command", "string", ".", "*", "@", "return", "true", "if", "the", "specified", "command", "is", "enabled", "*", "/", "public", "static", "boolean", "isEnabled", "(", "String", "command", ")", "{", "if", "(", "whiteListInitialized", ")", "{", "return", "whiteListedCommands", ".", "contains", "(", "command", ")", ";", "}", "String", "commands", "=", "System", ".", "getProperty", "(", "ZOOKEEPER_4LW_COMMANDS_WHITELIST", ")", ";", "if", "(", "commands", "!", "=", "null", ")", "{", "String", "[", "]", "list", "=", "commands", ".", "split", "(", "\",", "\")", ";", "for", "(", "String", "cmd", ":", "list", ")", "{", "if", "(", "cmd", ".", "trim", "(", ").", "equals", "(", "\"*", "\")", ")", "{", "for", "(", "Map", ".", "Entry", "<", "Integer", ",", "String", ">", "entry", ":", "cmd2String", ".", "entrySet", "(", "))", "{", "whiteListedCommands", ".", "add", "(", "entry", ".", "getValue", "(", "))", ";", "}", "break", ";", "}", "if", "(", "!", "cmd", ".", "trim", "(", ").", "isEmpty", "(", "))", "{", "whiteListedCommands", ".", "add", "(", "cmd", ".", "trim", "(", "))", ";", "}", "}", "}", "public", "static", "Map", "<", "Integer", ",", "String", ">", "getCmdMapView", "(", ")", "{", "return", "Collections", ".", "unmodifiableMap", "(", "cmd2String", ")", ";", "/", "/", "It", "is", "sad", "that", "isro", "and", "srvr", "are", "used", "by", "ZooKeeper", "itself", ".", "Need", "fix", "this", "/", "/", "before", "deprecating", "4lw", ".", "if", "(", "System", ".", "getProperty", "(", "\"", "readonlymode", ".", "enabled", "\"", ",", "\"", "false", "\"", ").", "equals", "(", "\"", "true", "\"", "))", "{", "whiteListedCommands", ".", "add", "(", "\"", "isro", "\"", ");", "}", "/", "/", "zkServer", ".", "sh", "depends", "on", "\"", "srvr", "\"", ".", "whiteListedCommands", ".", "add", "(", "\"", "srvr", "\"", ");", "whiteListInitialized", "=", "true", ";", "LOG", ".", "info", "(", "\"", "The", "list", "of", "known", "four", "letter", "word", "commands", "is", ":", "{", "}\"", ",", "Arrays", ".", "asList", "(", "cmd2String", ")", ");", "LOG", ".", "info", "(", "\"", "The", "list", "of", "enabled", "four", "letter", "word", "commands", "is", ":", "{", "}\"", ",", "Arrays", ".", "asList", "(", "whiteListedCommands", ")", ");", "return", "whiteListedCommands", ".", "contains", "(", "command", ")", ";", "}", "/", "/", "specify", "all", "of", "the", "commands", "that", "are", "available", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "ServerCnxn", ";", "/", "**", "*", "A", "command", "that", "does", "not", "do", "anything", "except", "reply", "to", "client", "with", "predefined", "message", ".", "*", "It", "is", "used", "to", "inform", "clients", "who", "execute", "none", "white", "listed", "four", "letter", "word", "commands", ".", "*", "/", "public", "class", "NopCommand", "extends", "AbstractFourLetterCommand", "{", "private", "String", "msg", ";", "public", "NopCommand", "(", "PrintWriter", "pw", ",", "ServerCnxn", "serverCnxn", ",", "String", "msg", ")", "{", "super", "(", "pw", ",", "serverCnxn", ")", ";", "this", ".", "msg", "=", "msg", ";", "}", "@", "Override", "public", "void", "commandRun", "(", ")", "{", "pw", ".", "println", "(", "msg", ")", ";", "}", "}", "@", "@", "-", "51", ",", "6", "+", "51", ",", "9", "@", "@", "public", "void", "starting", "(", "FrameworkMethod", "method", ")", "{", "/", "/", "accidentally", "attempting", "to", "start", "multiple", "admin", "servers", "on", "the", "/", "/", "same", "port", ".", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "admin", ".", "enableServer", "\"", ",", "\"", "false", "\"", ");", "/", "/", "ZOOKEEPER", "-", "2693", "disables", "all", "4lw", "by", "default", ".", "/", "/", "Here", "we", "enable", "the", "4lw", "which", "ZooKeeper", "tests", "depends", ".", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "*\"", ");", "testName", "=", "method", ".", "getName", "(", ");", "LOG", ".", "info", "(", "\"", "STARTING", "\"", "+", "testName", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "251", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "zookeeper", ".", "test", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "TestableZooKeeper", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "common", ".", "X509Exception", ".", "SSLContextException", ";", "import", "static", "org", ".", "apache", ".", "zookeeper", ".", "client", ".", "FourLetterWordMain", ".", "send4LetterWord", ";", "import", "org", ".", "apache", ".", "zookeeper", ".", "server", ".", "command", ".", "FourLetterCommands", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "public", "class", "FourLetterWordsWhiteListTest", "extends", "ClientBase", "{", "protected", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "FourLetterWordsWhiteListTest", ".", "class", ")", ";", "/", "*", "*", "ZOOKEEPER", "-", "2693", ":", "test", "white", "list", "of", "four", "letter", "words", ".", "*", "For", "3", ".", "5", ".", "x", "default", "white", "list", "is", "empty", ".", "Verify", "that", "is", "*", "the", "case", "(", "except", "'", "stat", "'", "command", "which", "is", "enabled", "in", "ClientBase", "*", "which", "other", "tests", "depend", "on", ".", ").", "*", "/", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testFourLetterWordsAllDisabledByDefault", "(", ")", "throws", "Exception", "{", "stopServer", "(", ");", "FourLetterCommands", ".", "resetWhiteList", "(", ");", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "stat", "\"", ");", "startServer", "(", ");", "/", "/", "Default", "white", "list", "for", "3", ".", "5", ".", "x", "is", "empty", ",", "so", "all", "command", "should", "fail", ".", "verifyAllCommandsFail", "(", ");", "TestableZooKeeper", "zk", "=", "createClient", "(", ");", "verifyAllCommandsFail", "(", ");", "zk", ".", "getData", "(", "\"/", "\",", "true", ",", "null", ")", ";", "verifyAllCommandsFail", "(", ");", "zk", ".", "close", "(", ");", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyAllCommandsFail", "(", ");", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testFourLetterWordsEnableSomeCommands", "(", ")", "throws", "Exception", "{", "stopServer", "(", ");", "FourLetterCommands", ".", "resetWhiteList", "(", ");", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "stat", ",", "ruok", ",", "isro", "\"", ");", "startServer", "(", ");", "/", "/", "stat", ",", "ruok", "and", "isro", "are", "white", "listed", ".", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyExactMatch", "(", "\"", "ruok", "\"", ",", "\"", "imok", "\"", ");", "verifyExactMatch", "(", "\"", "isro", "\"", ",", "\"", "rw", "\"", ");", "/", "/", "Rest", "of", "commands", "fail", ".", "verifyExactMatch", "(", "\"", "conf", "\"", ",", "generateExpectedMessage", "(", "\"", "conf", "\"", "))", ";", "verifyExactMatch", "(", "\"", "cons", "\"", ",", "generateExpectedMessage", "(", "\"", "cons", "\"", "))", ";", "verifyExactMatch", "(", "\"", "crst", "\"", ",", "generateExpectedMessage", "(", "\"", "crst", "\"", "))", ";", "verifyExactMatch", "(", "\"", "dirs", "\"", ",", "generateExpectedMessage", "(", "\"", "dirs", "\"", "))", ";", "verifyExactMatch", "(", "\"", "dump", "\"", ",", "generateExpectedMessage", "(", "\"", "dump", "\"", "))", ";", "verifyExactMatch", "(", "\"", "envi", "\"", ",", "generateExpectedMessage", "(", "\"", "envi", "\"", "))", ";", "verifyExactMatch", "(", "\"", "gtmk", "\"", ",", "generateExpectedMessage", "(", "\"", "gtmk", "\"", "))", ";", "verifyExactMatch", "(", "\"", "stmk", "\"", ",", "generateExpectedMessage", "(", "\"", "stmk", "\"", "))", ";", "verifyExactMatch", "(", "\"", "srst", "\"", ",", "generateExpectedMessage", "(", "\"", "srst", "\"", "))", ";", "verifyExactMatch", "(", "\"", "wchc", "\"", ",", "generateExpectedMessage", "(", "\"", "wchc", "\"", "))", ";", "verifyExactMatch", "(", "\"", "wchp", "\"", ",", "generateExpectedMessage", "(", "\"", "wchp", "\"", "))", ";", "verifyExactMatch", "(", "\"", "wchs", "\"", ",", "generateExpectedMessage", "(", "\"", "wchs", "\"", "))", ";", "verifyExactMatch", "(", "\"", "mntr", "\"", ",", "generateExpectedMessage", "(", "\"", "mntr", "\"", "))", ";", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testISROEnabledWhenReadOnlyModeEnabled", "(", ")", "throws", "Exception", "{", "stopServer", "(", ");", "FourLetterCommands", ".", "resetWhiteList", "(", ");", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "stat", "\"", ");", "System", ".", "setProperty", "(", "\"", "readonlymode", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "startServer", "(", ");", "verifyExactMatch", "(", "\"", "isro", "\"", ",", "\"", "rw", "\"", ");", "System", ".", "clearProperty", "(", "\"", "readonlymode", ".", "enabled", "\"", ");", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testFourLetterWordsInvalidConfiguration", "(", ")", "throws", "Exception", "{", "stopServer", "(", ");", "FourLetterCommands", ".", "resetWhiteList", "(", ");", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "foo", "bar", "\"", "\"", "foo", ",", ",,", "\"", "\"", "bar", ":", ".,", "@#", "$%", "^&", "*(", ")", ",", ",", ",", ",", "bar", ",", "bar", ",", "stat", ",", "\"", ");", "startServer", "(", ");", "/", "/", "Just", "make", "sure", "we", "are", "good", "when", "admin", "made", "some", "mistakes", "in", "config", "file", ".", "verifyAllCommandsFail", "(", ");", "/", "/", "But", "still", ",", "what", "'", "s", "valid", "in", "white", "list", "will", "get", "through", ".", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testFourLetterWordsEnableAllCommandsThroughAsterisk", "(", ")", "throws", "Exception", "{", "stopServer", "(", ");", "FourLetterCommands", ".", "resetWhiteList", "(", ");", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "*\"", ");", "startServer", "(", ");", "verifyAllCommandsSuccess", "(", ");", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testFourLetterWordsEnableAllCommandsThroughExplicitList", "(", ")", "throws", "Exception", "{", "stopServer", "(", ");", "FourLetterCommands", ".", "resetWhiteList", "(", ");", "System", ".", "setProperty", "(", "\"", "zookeeper", ".", "4lw", ".", "commands", ".", "whitelist", "\"", ",", "\"", "ruok", ",", "envi", ",", "conf", ",", "stat", ",", "srvr", ",", "cons", ",", "dump", ",", "\"", "\"", "wchs", ",", "wchp", ",", "wchc", ",", "srst", ",", "crst", ",", "\"", "\"", "dirs", ",", "mntr", ",", "gtmk", ",", "isro", ",", "stmk", "\"", ");", "startServer", "(", ");", "verifyAllCommandsSuccess", "(", ");", "}", "private", "void", "verifyAllCommandsSuccess", "(", ")", "throws", "Exception", "{", "verifyExactMatch", "(", "\"", "ruok", "\"", ",", "\"", "imok", "\"", ");", "verifyFuzzyMatch", "(", "\"", "envi", "\"", ",", "\"", "java", ".", "version", "\"", ");", "verifyFuzzyMatch", "(", "\"", "conf", "\"", ",", "\"", "clientPort", "\"", ");", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "cons", "\"", ",", "\"", "queued", "\"", ");", "verifyFuzzyMatch", "(", "\"", "dump", "\"", ",", "\"", "Session", "\"", ");", "verifyFuzzyMatch", "(", "\"", "wchs", "\"", ",", "\"", "watches", "\"", ");", "verifyFuzzyMatch", "(", "\"", "wchp", "\"", ",", "\"", "\")", ";", "verifyFuzzyMatch", "(", "\"", "wchc", "\"", ",", "\"", "\")", ";", "verifyFuzzyMatch", "(", "\"", "srst", "\"", ",", "\"", "reset", "\"", ");", "verifyFuzzyMatch", "(", "\"", "crst", "\"", ",", "\"", "reset", "\"", ");", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "cons", "\"", ",", "\"", "queued", "\"", ");", "verifyFuzzyMatch", "(", "\"", "gtmk", "\"", ",", "\"", "306", "\"", ");", "verifyFuzzyMatch", "(", "\"", "isro", "\"", ",", "\"", "rw", "\"", ");", "TestableZooKeeper", "zk", "=", "createClient", "(", ");", "String", "sid", "=", "getHexSessionId", "(", "zk", ".", "getSessionId", "(", "))", ";", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "queued", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "cons", "\"", ",", "sid", ")", ";", "verifyFuzzyMatch", "(", "\"", "dump", "\"", ",", "sid", ")", ";", "verifyFuzzyMatch", "(", "\"", "dirs", "\"", ",", "\"", "size", "\"", ");", "zk", ".", "getData", "(", "\"/", "\",", "true", ",", "null", ")", ";", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "queued", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "cons", "\"", ",", "sid", ")", ";", "verifyFuzzyMatch", "(", "\"", "dump", "\"", ",", "sid", ")", ";", "verifyFuzzyMatch", "(", "\"", "wchs", "\"", ",", "\"", "watching", "1", "\"", ");", "verifyFuzzyMatch", "(", "\"", "wchp", "\"", ",", "sid", ")", ";", "verifyFuzzyMatch", "(", "\"", "wchc", "\"", ",", "sid", ")", ";", "verifyFuzzyMatch", "(", "\"", "dirs", "\"", ",", "\"", "size", "\"", ");", "zk", ".", "close", "(", ");", "verifyExactMatch", "(", "\"", "ruok", "\"", ",", "\"", "imok", "\"", ");", "verifyFuzzyMatch", "(", "\"", "envi", "\"", ",", "\"", "java", ".", "version", "\"", ");", "verifyFuzzyMatch", "(", "\"", "conf", "\"", ",", "\"", "clientPort", "\"", ");", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "cons", "\"", ",", "\"", "queued", "\"", ");", "verifyFuzzyMatch", "(", "\"", "dump", "\"", ",", "\"", "Session", "\"", ");", "verifyFuzzyMatch", "(", "\"", "wchs", "\"", ",", "\"", "watch", "\"", ");", "verifyFuzzyMatch", "(", "\"", "wchp", "\"", ",", "\"", "\")", ";", "verifyFuzzyMatch", "(", "\"", "wchc", "\"", ",", "\"", "\")", ";", "verifyFuzzyMatch", "(", "\"", "srst", "\"", ",", "\"", "reset", "\"", ");", "verifyFuzzyMatch", "(", "\"", "crst", "\"", ",", "\"", "reset", "\"", ");", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "verifyFuzzyMatch", "(", "\"", "cons", "\"", ",", "\"", "queued", "\"", ");", "verifyFuzzyMatch", "(", "\"", "mntr", "\"", ",", "\"", "zk_server_state", "\\", "tstandalone", "\"", ");", "verifyFuzzyMatch", "(", "\"", "mntr", "\"", ",", "\"", "num_alive_connections", "\"", ");", "verifyFuzzyMatch", "(", "\"", "stat", "\"", ",", "\"", "Connections", "\"", ");", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Connections", "\"", ");", "verifyFuzzyMatch", "(", "\"", "dirs", "\"", ",", "\"", "size", "\"", ");", "}", "private", "void", "verifyAllCommandsFail", "(", ")", "throws", "Exception", "{", "verifyExactMatch", "(", "\"", "ruok", "\"", ",", "generateExpectedMessage", "(", "\"", "ruok", "\"", "))", ";", "verifyExactMatch", "(", "\"", "conf", "\"", ",", "generateExpectedMessage", "(", "\"", "conf", "\"", "))", ";", "verifyExactMatch", "(", "\"", "cons", "\"", ",", "generateExpectedMessage", "(", "\"", "cons", "\"", "))", ";", "verifyExactMatch", "(", "\"", "crst", "\"", ",", "generateExpectedMessage", "(", "\"", "crst", "\"", "))", ";", "verifyExactMatch", "(", "\"", "dirs", "\"", ",", "generateExpectedMessage", "(", "\"", "dirs", "\"", "))", ";", "verifyExactMatch", "(", "\"", "dump", "\"", ",", "generateExpectedMessage", "(", "\"", "dump", "\"", "))", ";", "verifyExactMatch", "(", "\"", "envi", "\"", ",", "generateExpectedMessage", "(", "\"", "envi", "\"", "))", ";", "verifyExactMatch", "(", "\"", "gtmk", "\"", ",", "generateExpectedMessage", "(", "\"", "gtmk", "\"", "))", ";", "verifyExactMatch", "(", "\"", "stmk", "\"", ",", "generateExpectedMessage", "(", "\"", "stmk", "\"", "))", ";", "verifyExactMatch", "(", "\"", "srst", "\"", ",", "generateExpectedMessage", "(", "\"", "srst", "\"", "))", ";", "verifyExactMatch", "(", "\"", "wchc", "\"", ",", "generateExpectedMessage", "(", "\"", "wchc", "\"", "))", ";", "verifyExactMatch", "(", "\"", "wchp", "\"", ",", "generateExpectedMessage", "(", "\"", "wchp", "\"", "))", ";", "verifyExactMatch", "(", "\"", "wchs", "\"", ",", "generateExpectedMessage", "(", "\"", "wchs", "\"", "))", ";", "verifyExactMatch", "(", "\"", "mntr", "\"", ",", "generateExpectedMessage", "(", "\"", "mntr", "\"", "))", ";", "verifyExactMatch", "(", "\"", "isro", "\"", ",", "generateExpectedMessage", "(", "\"", "isro", "\"", "))", ";", "/", "/", "srvr", "is", "enabled", "by", "default", "due", "to", "the", "sad", "fact", "zkServer", ".", "sh", "uses", "it", ".", "verifyFuzzyMatch", "(", "\"", "srvr", "\"", ",", "\"", "Outstanding", "\"", ");", "}", "private", "String", "sendRequest", "(", "String", "cmd", ")", "throws", "IOException", ",", "SSLContextException", "{", "HostPort", "hpobj", "=", "ClientBase", ".", "parseHostPortList", "(", "hostPort", ")", ".", "get", "(", "0", ")", ";", "return", "send4LetterWord", "(", "hpobj", ".", "host", ",", "hpobj", ".", "port", ",", "cmd", ")", ";", "}", "private", "void", "verifyFuzzyMatch", "(", "String", "cmd", ",", "String", "expected", ")", "throws", "IOException", ",", "SSLContextException", "{", "String", "resp", "=", "sendRequest", "(", "cmd", ")", ";", "LOG", ".", "info", "(", "\"", "cmd", "\"", "+", "cmd", "+", "\"", "expected", "\"", "+", "expected", "+", "\"", "got", "\"", "+", "resp", ")", ";", "Assert", ".", "assertTrue", "(", "resp", ".", "contains", "(", "expected", ")", ");", "}", "private", "String", "generateExpectedMessage", "(", "String", "command", ")", "{", "return", "command", "+", "\"", "is", "not", "executed", "because", "it", "is", "not", "in", "the", "whitelist", ".", "\";", "}", "private", "void", "verifyExactMatch", "(", "String", "cmd", ",", "String", "expected", ")", "throws", "IOException", ",", "SSLContextException", "{", "String", "resp", "=", "sendRequest", "(", "cmd", ")", ";", "LOG", ".", "info", "(", "\"", "cmd", "\"", "+", "cmd", "+", "\"", "expected", "an", "exact", "match", "of", "\"", "+", "expected", "+", "\"", ";", "got", "\"", "+", "resp", ")", ";", "Assert", ".", "assertTrue", "(", "resp", ".", "trim", "(", ").", "equals", "(", "expected", ")", ");", "}", "}"], "docstring_tokens": ["the", "application", "to", "crash"]}
{"contents": ["SOAPUIOS-374", "-", "Making", "the", "regex", "to", "be", "non-greedy"], "code_tokens": ["@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "private", "static", "final", "Pattern", "PROPERTY_EXPANSION_EQUALS_PATTERN", "=", "Pattern", ".", "compile", "(", "\"^", "\\\\", "$\\", "\\{", "(.", "*)", "\\\\", "}$", "\")", ";", "private", "static", "final", "Pattern", "PROPERTY_EXPANSION_CONTAINS_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "\\\\", "$\\", "\\{", "(.", "*)", "\\\\", "})", "|(", "%", "24", "%", "7B", ".", "*%", "7D", ")", "|(", "%", "2524", "%", "257B", ".", "*%", "257D", ")", "|(", "%", "252524", "%", "25257B", ".", "*%", "25257D", ")", "\")", ";", "Pattern", ".", "compile", "(", "\"(", "\\\\", "$\\", "\\{", "(.", "*?", ")\\", "\\}", ")|", "(%", "24", "%", "7B", ".", "*?", "%", "7D", ")", "|(", "%", "2524", "%", "257B", ".", "*?", "%", "257D", ")", "|(", "%", "252524", "%", "25257B", ".", "*?", "%", "25257D", ")", "\")", ";", "public", "static", "String", "[", "]", "tokenizeArgs", "(", "String", "args", ")", "{", "if", "(", "args", "=", "=", "null", "|", "|", "args", ".", "trim", "(", ").", "length", "(", ")", "=", "=", "0", ")", "{"], "docstring_tokens": ["executing", "malicious", "code", "in", "the", "victim's", "machine", "and", "take", "it", "over", "."]}
{"contents": ["evm:", "checking", "if", "removexattr", "is", "not", "a", "NULL", "The", "following", "lines", "of", "code", "produce", "a", "kernel", "oops.", "fd", "=", "socket(PF_FILE,", "SOCK_STREAM|SOCK_CLOEXEC|SOCK_NONBLOCK,", "0);", "fchmod(fd,", "0666);", "[", "139.922364]", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "(null)", "[", "139.924982]", "IP:", "[<", "(null)>]", "(null)", "[", "139.924982]", "*pde", "=", "00000000", "[", "139.924982]", "Oops:", "0000", "[#5]", "SMP", "[", "139.924982]", "Modules", "linked", "in:", "fuse", "dm_crypt", "dm_mod", "i2c_piix4", "serio_raw", "evdev", "binfmt_misc", "button", "[", "139.924982]", "Pid:", "3070,", "comm:", "acpid", "Tainted:", "G", "D", "3.8.0-rc2-kds+", "#465", "Bochs", "Bochs", "[", "139.924982]", "EIP:", "0060:[<00000000>]", "EFLAGS:", "00010246", "CPU:", "0", "[", "139.924982]", "EIP", "is", "at", "0x0", "[", "139.924982]", "EAX:", "cf5ef000", "EBX:", "cf5ef000", "ECX:", "c143d600", "EDX:", "c15225f2", "[", "139.924982]", "ESI:", "cf4d2a1c", "EDI:", "cf4d2a1c", "EBP:", "cc02df10", "ESP:", "cc02dee4", "[", "139.924982]", "DS:", "007b", "ES:", "007b", "FS:", "00d8", "GS:", "0033", "SS:", "0068", "[", "139.924982]", "CR0:", "80050033", "CR2:", "00000000", "CR3:", "0c059000", "CR4:", "000006d0", "[", "139.924982]", "DR0:", "00000000", "DR1:", "00000000", "DR2:", "00000000", "DR3:", "00000000", "[", "139.924982]", "DR6:", "ffff0ff0", "DR7:", "00000400", "[", "139.924982]", "Process", "acpid", "(pid:", "3070,", "ti=cc02c000", "task=d7705340", "task.ti=cc02c000)", "[", "139.924982]", "Stack:", "[", "139.924982]", "c1203c88", "00000000", "cc02def4", "cf4d2a1c", "ae21eefa", "471b60d5", "1083c1ba", "c26a5940", "[", "139.924982]", "e891fb5e", "00000041", "00000004", "cc02df1c", "c1203964", "00000000", "cc02df4c", "c10e20c3", "[", "139.924982]", "00000002", "00000000", "00000000", "22222222", "c1ff2222", "cf5ef000", "00000000", "d76efb08", "[", "139.924982]", "Call", "Trace:", "[", "139.924982]", "[<c1203c88>]", "?", "evm_update_evmxattr+0x5b/0x62", "[", "139.924982]", "[<c1203964>]", "evm_inode_post_setattr+0x22/0x26", "[", "139.924982]", "[<c10e20c3>]", "notify_change+0x25f/0x281", "[", "139.924982]", "[<c10cbf56>]", "chmod_common+0x59/0x76", "[", "139.924982]", "[<c10e27a1>]", "?", "put_unused_fd+0x33/0x33", "[", "139.924982]", "[<c10cca09>]", "sys_fchmod+0x39/0x5c", "[", "139.924982]", "[<c13f4f30>]", "syscall_call+0x7/0xb", "[", "139.924982]", "Code:", "Bad", "EIP", "value.", "This", "happens", "because", "sockets", "do", "not", "define", "the", "removexattr", "operation.", "Before", "removing", "the", "xattr,", "verify", "the", "removexattr", "function", "pointer", "is", "not", "NULL.", "Signed-off-by:", "Dmitry", "Kasatkin", "<dmitry.kasatkin@intel.com>", "Signed-off-by:", "Mimi", "Zohar", "<zohar@linux.vnet.ibm.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "James", "Morris", "<james.l.morris@oracle.com>"], "code_tokens": ["@", "@", "-", "205", ",", "9", "+", "205", ",", "9", "@", "@", "int", "evm_update_evmxattr", "(", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "xattr_name", ",", "rc", "=", "__vfs_setxattr_noperm", "(", "dentry", ",", "XATTR_NAME_EVM", ",", "&", "xattr_data", ",", "sizeof", "(", "xattr_data", ")", ",", "0", ")", ";", "}", "else", "if", "(", "rc", "=", "=", "-", "ENODATA", ")", "}", "else", "if", "(", "rc", "=", "=", "-", "ENODATA", "&", "&", "inode", "-", ">", "i_op", "-", ">", "removexattr", ")", "{", "rc", "=", "inode", "-", ">", "i_op", "-", ">", "removexattr", "(", "dentry", ",", "XATTR_NAME_EVM", ")", ";", "}", "return", "rc", ";", "}"], "docstring_tokens": ["the", "application", "to", "crash"]}
{"contents": ["CAMEL-7123", "Enable", "the", "xml", "transformer", "security", "processing", "feature", "by", "default"], "code_tokens": ["@", "@", "-", "974", ",", "6", "+", "974", ",", "12", "@", "@", "public", "Transformer", "createTransformer", "(", ")", "throws", "TransformerConfigurationException", "public", "TransformerFactory", "createTransformerFactory", "(", ")", "{", "TransformerFactory", "factory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "/", "/", "Enable", "the", "Security", "feature", "by", "default", "try", "{", "factory", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "TransformerFactory", "doesn", "'", "t", "support", "the", "feature", "{", "}", "with", "value", "{", "},", "due", "to", "{", "}.", "\",", "new", "Object", "[", "]{", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "\"", "true", "\"", ",", "e", "}", ");", "}", "factory", ".", "setErrorListener", "(", "new", "XmlErrorListener", "(", "))", ";", "return", "factory", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "62", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "xslt", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExecutionException", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "public", "class", "XsltFeatureRouteTest", "extends", "ContextTestSupport", "{", "public", "void", "testSendMessage", "(", ")", "throws", "Exception", "{", "String", "message", "=", "\"", "<", "hello", "/", ">\"", ";", "sendXmlMessage", "(", "\"", "direct", ":", "start1", "\"", ",", "message", ")", ";", "sendXmlMessage", "(", "\"", "direct", ":", "start2", "\"", ",", "message", ")", ";", "}", "public", "void", "sendXmlMessage", "(", "String", "uri", ",", "String", "message", ")", "{", "try", "{", "template", ".", "sendBody", "(", "\"", "direct", ":", "start1", "\"", ",", "message", ")", ";", "fail", "(", "\"", "expect", "an", "exception", "here", "\"", ");", "}", "catch", "(", "Exception", "ex", ")", "{", "/", "/", "expect", "an", "exception", "here", "assertTrue", "(", "\"", "Get", "a", "wrong", "exception", "\"", ",", "ex", "instanceof", "CamelExecutionException", ")", ";", "assertTrue", "(", "\"", "Get", "a", "wrong", "exception", "cause", "\"", ",", "ex", ".", "getCause", "(", ")", "instanceof", "TransformerException", ")", ";", "}", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start1", "\"", ")", ".", "to", "(", "\"", "xslt", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "xslt", "/", "transform_text_imported", ".", "xsl", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "from", "(", "\"", "direct", ":", "start2", "\"", ")", ".", "to", "(", "\"", "xslt", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "xslt", "/", "transform_text", ".", "xsl", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "22", ",", "16", "+", "22", ",", "36", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "converter", ".", "jaxp", ".", "XmlConverter", ";", "import", "org", ".", "apache", ".", "camel", ".", "impl", ".", "JndiRegistry", ";", "public", "class", "XsltRouteTest", "extends", "ContextTestSupport", "{", "public", "void", "testSendStringMessage", "(", ")", "throws", "Exception", "{", "sendMessageAndHaveItTransformed", "(", "\"<", "mail", ">", "<", "subject", ">", "Hey", "<", "/", "subject", ">", "<", "body", ">", "Hello", "world", "!", "</", "body", ">", "</", "mail", ">", "\")", ";", "}", "public", "void", "testSendBytesMessage", "(", ")", "throws", "Exception", "{", "sendMessageAndHaveItTransformed", "(", "\"<", "mail", ">", "<", "subject", ">", "Hey", "<", "/", "subject", ">", "<", "body", ">", "Hello", "world", "!", "</", "body", ">", "</", "mail", ">", "\".", "getBytes", "(", "))", ";", "}", "public", "void", "testSendEntityMessage", "(", ")", "throws", "Exception", "{", "MockEndpoint", "endpoint", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "endpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "/", "/", "String", "message", "=", "\"", "<!", "DOCTYPE", "foo", "[", "<!", "ENTITY", "xxe", "SYSTEM", "\\", "\"", "file", ":", "//", "/", "Users", "/", "/", "jiangning", "/", "/.", "CFUserTextEncoding", "\\", "\">", "]>", "<", "task", ">", "<", "name", ">", "&", "xxe", ";", "</", "name", ">", "</", "task", ">", "\";", "String", "message", "=", "\"", "<", "hello", "/", ">\"", ";", "template", ".", "sendBody", "(", "\"", "direct", ":", "start2", "\"", ",", "message", ")", ";", "assertMockEndpointsSatisfied", "(", ");", "List", "<", "Exchange", ">", "list", "=", "endpoint", ".", "getReceivedExchanges", "(", ");", "Exchange", "exchange", "=", "list", ".", "get", "(", "0", ")", ";", "String", "xml", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ";", "System", ".", "out", ".", "println", "(", "xml", ")", ";", "}", "private", "void", "sendMessageAndHaveItTransformed", "(", "Object", "body", ")", "throws", "Exception", "{", "MockEndpoint", "endpoint", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "@", "@", "-", "44", ",", "7", "+", "64", ",", "8", "@", "@", "private", "void", "sendMessageAndHaveItTransformed", "(", "Object", "body", ")", "throws", "Exception", "{", "List", "<", "Exchange", ">", "list", "=", "endpoint", ".", "getReceivedExchanges", "(", ");", "Exchange", "exchange", "=", "list", ".", "get", "(", "0", ")", ";", "String", "xml", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ";", "System", ".", "out", ".", "println", "(", "xml", ")", ";", "assertNotNull", "(", "\"", "The", "transformed", "XML", "should", "not", "be", "null", "\"", ",", "xml", ")", ";", "assertTrue", "(", "xml", ".", "indexOf", "(", "\"", "transformed", "\"", ")", ">", "-", "1", ")", ";", "/", "/", "the", "cheese", "tag", "is", "in", "the", "transform", ".", "xsl", "@", "@", "-", "62", ",", "11", "+", "83", ",", "16", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "to", "(", "\"", "xslt", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "xslt", "/", "transform", ".", "xsl", "\"", ")", ".", "multicast", "(", ")", ".", "beanRef", "(", "\"", "testBean", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "from", "(", "\"", "direct", ":", "start2", "\"", ")", ".", "to", "(", "\"", "xslt", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "xslt", "/", "transform_text_imported", ".", "xsl", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "xsl", ":", "stylesheet", "version", "=", "\"", "1", ".", "0", "\"", "xmlns", ":", "xsl", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\"", "xmlns", ":", "date", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "util", ".", "Date", "\"", "xmlns", ":", "rt", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "lang", ".", "Runtime", "\"", "xmlns", ":", "str", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "lang", ".", "String", "\"", "exclude", "-", "result", "-", "prefixes", "=", "\"", "date", "\"", ">", "<", "xsl", ":", "output", "method", "=", "\"", "text", "\"", "/>", "<", "xsl", ":", "template", "match", "=", "\"/", "\">", "<", "xsl", ":", "variable", "name", "=", "\"", "cmd", "\"", "><", "![", "CDATA", "[", "/", "usr", "/", "bin", "/", "test", "]", "]>", "</", "xsl", ":", "variable", ">", "<", "xsl", ":", "variable", "name", "=", "\"", "rtObj", "\"", "select", "=", "\"", "rt", ":", "getRuntime", "(", ")\"", "/>", "<", "xsl", ":", "variable", "name", "=", "\"", "process", "\"", "select", "=", "\"", "rt", ":", "exec", "(", "$", "rtObj", ",", "$", "cmd", ")", "\"/", ">", "<", "xsl", ":", "text", ">", "Process", ":", "<", "/", "xsl", ":", "text", ">", "<", "xsl", ":", "value", "-", "of", "select", "=", "\"$", "process", "\"", "/>", "<", "/", "xsl", ":", "template", ">", "<", "/", "xsl", ":", "stylesheet", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "25", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "xsl", ":", "stylesheet", "version", "=", "\"", "1", ".", "0", "\"", "xmlns", ":", "xsl", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\"", ">", "<", "xsl", ":", "import", "href", "=", "\"", "transform_text", ".", "xsl", "\"", "/>", "<", "xsl", ":", "template", "match", "=", "\"/", "\">", "<", "xsl", ":", "apply", "-", "imports", "/", ">", "<", "/", "xsl", ":", "template", ">", "<", "/", "xsl", ":", "stylesheet", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "66", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "xslt", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExecutionException", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "SaxonXsltFeatureRouteTest", "extends", "CamelTestSupport", "{", "@", "Test", "public", "void", "testSendMessage", "(", ")", "throws", "Exception", "{", "String", "message", "=", "\"", "<", "hello", "/", ">\"", ";", "sendXmlMessage", "(", "\"", "direct", ":", "start1", "\"", ",", "message", ")", ";", "sendXmlMessage", "(", "\"", "direct", ":", "start2", "\"", ",", "message", ")", ";", "}", "public", "void", "sendXmlMessage", "(", "String", "uri", ",", "String", "message", ")", "{", "try", "{", "template", ".", "sendBody", "(", "\"", "direct", ":", "start1", "\"", ",", "message", ")", ";", "fail", "(", "\"", "expect", "an", "exception", "here", "\"", ");", "}", "catch", "(", "Exception", "ex", ")", "{", "/", "/", "expect", "an", "exception", "here", "assertTrue", "(", "\"", "Get", "a", "wrong", "exception", "\"", ",", "ex", "instanceof", "CamelExecutionException", ")", ";", "assertTrue", "(", "\"", "Get", "a", "wrong", "exception", "cause", "\"", ",", "ex", ".", "getCause", "(", ")", "instanceof", "TransformerException", ")", ";", "}", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start1", "\"", ")", ".", "to", "(", "\"", "xslt", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "xslt", "/", "transform_text_imported", ".", "xsl", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "from", "(", "\"", "direct", ":", "start2", "\"", ")", ".", "to", "(", "\"", "xslt", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "xslt", "/", "transform_text", ".", "xsl", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "xsl", ":", "stylesheet", "version", "=", "\"", "1", ".", "0", "\"", "xmlns", ":", "xsl", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\"", "xmlns", ":", "date", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "util", ".", "Date", "\"", "xmlns", ":", "rt", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "lang", ".", "Runtime", "\"", "xmlns", ":", "str", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "lang", ".", "String", "\"", "exclude", "-", "result", "-", "prefixes", "=", "\"", "date", "\"", ">", "<", "xsl", ":", "output", "method", "=", "\"", "text", "\"", "/>", "<", "xsl", ":", "template", "match", "=", "\"/", "\">", "<", "xsl", ":", "variable", "name", "=", "\"", "cmd", "\"", "><", "![", "CDATA", "[", "/", "usr", "/", "bin", "/", "test", "]", "]>", "</", "xsl", ":", "variable", ">", "<", "xsl", ":", "variable", "name", "=", "\"", "rtObj", "\"", "select", "=", "\"", "rt", ":", "getRuntime", "(", ")\"", "/>", "<", "xsl", ":", "variable", "name", "=", "\"", "process", "\"", "select", "=", "\"", "rt", ":", "exec", "(", "$", "rtObj", ",", "$", "cmd", ")", "\"/", ">", "<", "xsl", ":", "text", ">", "Process", ":", "<", "/", "xsl", ":", "text", ">", "<", "xsl", ":", "value", "-", "of", "select", "=", "\"$", "process", "\"", "/>", "<", "/", "xsl", ":", "template", ">", "<", "/", "xsl", ":", "stylesheet", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "25", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "xsl", ":", "stylesheet", "version", "=", "\"", "1", ".", "0", "\"", "xmlns", ":", "xsl", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\"", ">", "<", "xsl", ":", "import", "href", "=", "\"", "transform_text", ".", "xsl", "\"", "/>", "<", "xsl", ":", "template", "match", "=", "\"/", "\">", "<", "xsl", ":", "apply", "-", "imports", "/", "><", "/", "xsl", ":", "template", ">", "<", "/", "xsl", ":", "stylesheet", ">", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["[OPENMEETINGS-1355]", "random", "UUID", "is", "used", "to", "generate", "password", "reset", "hash"], "code_tokens": ["@", "@", "-", "22", ",", "15", "+", "22", ",", "14", "@", "@", "import", "static", "org", ".", "apache", ".", "openmeetings", ".", "web", ".", "app", ".", "Application", ".", "getBean", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "core", ".", "mail", ".", "MailHandler", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "db", ".", "dao", ".", "basic", ".", "ConfigurationDao", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "db", ".", "dao", ".", "user", ".", "UserDao", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "db", ".", "entity", ".", "user", ".", "User", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "service", ".", "mail", ".", "template", ".", "ResetPasswordTemplate", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "util", ".", "crypt", ".", "ManageCryptStyle", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "web", ".", "app", ".", "Application", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "web", ".", "pages", ".", "ResetPage", ";", "import", "org", ".", "apache", ".", "wicket", ".", "ajax", ".", "AjaxRequestTarget", ";", "@", "@", "-", "239", ",", "9", "+", "238", ",", "8", "@", "@", "private", "Long", "resetUser", "(", "String", "email", ",", "String", "username", ",", "String", "appLink", ")", "{", "}", "private", "void", "sendHashByUser", "(", "User", "us", ",", "String", "appLink", ",", "UserDao", "userDao", ")", "throws", "Exception", "{", "String", "loginData", "=", "us", ".", "getLogin", "(", ")", "+", "new", "Date", "(", ");", "log", ".", "debug", "(", "\"", "User", ":", "\"", "+", "us", ".", "getLogin", "(", "))", ";", "us", ".", "setResethash", "(", "ManageCryptStyle", ".", "getInstanceOfCrypt", "(", ").", "createPassPhrase", "(", "loginData", ")", ");", "us", ".", "setResethash", "(", "UUID", ".", "randomUUID", "(", ").", "toString", "(", "))", ";", "userDao", ".", "update", "(", "us", ",", "-", "1L", ")", ";", "String", "reset_link", "=", "appLink", "+", "\"", "?", "hash", "=", "\"", "+", "us", ".", "getResethash", "(", ");"], "docstring_tokens": ["launch", "further", "attacks", "on", "the", "system"]}
{"contents": ["MimeTypeUtils", "uses", "SecureRandom", "The", "prevailing", "current", "wisdom", "is", "to", "use", "the", "default", "constructor", "for", "secure", "and", "let", "it", "pick", "the", "best", "algorithm", "for", "the", "OS.", "On", "Java", "8", "(Oracle),", "Linux", "this", "results", "in", "\"NativePRNG\"", "which", "uses", "/dev/random", "(potentially", "blocking)", "for", "the", "initial", "seed,", "and", "/dev/urandom", "(non-blocking)", "for", "subsequent", "calls", "to", "nextInt.", "Issue:", "SPR-16635"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "java", ".", "nio", ".", "charset", ".", "UnsupportedCharsetException", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "@", "@", "-", "46", ",", "7", "+", "47", ",", "7", "@", "@", "'", "B", "'", ",", "'", "C", "'", ",", "'", "D", "'", ",", "'", "E", "'", ",", "'", "F", "'", ",", "'", "G", "'", ",", "'", "H", "'", ",", "'", "I", "'", ",", "'", "J", "'", ",", "'", "K", "'", ",", "'", "L", "'", ",", "'", "M", "'", ",", "'", "N", "'", ",", "'", "O", "'", ",", "'", "P", "'", ",", "'", "Q", "'", ",", "'", "R", "'", ",", "'", "S", "'", ",", "'", "T", "'", ",", "'", "U", "'", ",", "'", "V", "'", ",", "'", "W", "'", ",", "'", "X", "'", ",", "'", "Y", "'", ",", "'", "Z", "'", "};", "private", "static", "final", "Random", "RND", "=", "new", "Random", "(", ");", "private", "static", "final", "Random", "RND", "=", "new", "SecureRandom", "(", ");", "private", "static", "Charset", "US_ASCII", "=", "Charset", ".", "forName", "(", "\"", "US", "-", "ASCII", "\"", ");"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["[media]", "cx231xx-cards:", "fix", "NULL-deref", "on", "missing", "association", "descriptor", "Make", "sure", "to", "check", "that", "we", "actually", "have", "an", "Interface", "Association", "Descriptor", "before", "dereferencing", "it", "during", "probe", "to", "avoid", "dereferencing", "a", "NULL-pointer.", "Fixes:", "e0d3bafd0258", "(\"V4L/DVB", "(10954):", "Add", "cx231xx", "USB", "driver\")", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "2.6.30", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Tested-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Hans", "Verkuil", "<hans.verkuil@cisco.com>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@osg.samsung.com>"], "code_tokens": ["@", "@", "-", "1684", ",", "7", "+", "1684", ",", "7", "@", "@", "static", "int", "cx231xx_usb_probe", "(", "struct", "usb_interface", "*", "interface", ",", "nr", "=", "dev", "-", ">", "devno", ";", "assoc_desc", "=", "udev", "-", ">", "actconfig", "-", ">", "intf_assoc", "[", "0", "]", ";", "if", "(", "assoc_desc", "-", ">", "bFirstInterface", "!", "=", "ifnum", ")", "{", "if", "(", "!", "assoc_desc", "|", "|", "assoc_desc", "-", ">", "bFirstInterface", "!", "=", "ifnum", ")", "{", "dev_err", "(", "d", ",", "\"", "Not", "found", "matching", "IAD", "interface", "\\", "n", "\"", ");", "retval", "=", "-", "ENODEV", ";", "goto", "err_if", ";"], "docstring_tokens": ["the", "system", "crash"]}
{"contents": ["SELinux:", "call", "cap_file_mmap", "in", "selinux_file_mmap", "Currently", "SELinux", "does", "not", "check", "CAP_SYS_RAWIO", "in", "the", "file_mmap", "hook.", "This", "means", "there", "is", "no", "DAC", "check", "on", "the", "ability", "to", "mmap", "low", "addresses", "in", "the", "memory", "space.", "This", "function", "adds", "the", "DAC", "check", "for", "CAP_SYS_RAWIO", "while", "maintaining", "the", "selinux", "check", "on", "mmap_zero.", "This", "means", "that", "processes", "which", "need", "to", "mmap", "low", "memory", "will", "need", "CAP_SYS_RAWIO", "and", "mmap_zero", "but", "will", "NOT", "need", "the", "SELinux", "sys_rawio", "capability.", "Signed-off-by:", "Eric", "Paris", "<eparis@redhat.com>", "Signed-off-by:", "James", "Morris", "<jmorris@namei.org>"], "code_tokens": ["@", "@", "-", "3034", ",", "9", "+", "3034", ",", "21", "@", "@", "static", "int", "selinux_file_mmap", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "reqprot", ",", "int", "rc", "=", "0", ";", "u32", "sid", "=", "current_sid", "(", ");", "if", "(", "addr", "<", "mmap_min_addr", ")", "/", "*", "*", "notice", "that", "we", "are", "intentionally", "putting", "the", "SELinux", "check", "before", "*", "the", "secondary", "cap_file_mmap", "check", ".", "This", "is", "such", "a", "likely", "attempt", "*", "at", "bad", "behaviour", "/", "exploit", "that", "we", "always", "want", "to", "get", "the", "AVC", ",", "even", "*", "if", "DAC", "would", "have", "also", "denied", "the", "operation", ".", "*", "/", "if", "(", "addr", "<", "mmap_min_addr", ")", "{", "rc", "=", "avc_has_perm", "(", "sid", ",", "sid", ",", "SECCLASS_MEMPROTECT", ",", "MEMPROTECT__MMAP_ZERO", ",", "NULL", ")", ";", "if", "(", "rc", ")", "return", "rc", ";", "}", "/", "*", "do", "DAC", "check", "on", "address", "space", "usage", "*", "/", "rc", "=", "cap_file_mmap", "(", "file", ",", "reqprot", ",", "prot", ",", "flags", ",", "addr", ",", "addr_only", ")", ";", "if", "(", "rc", "|", "|", "addr_only", ")", "return", "rc", ";"], "docstring_tokens": ["gain", "elevated", "privileges", "on", "the", "system"]}
{"contents": ["netfilter:", "ebtables:", "CONFIG_COMPAT:", "don't", "trust", "userland", "offsets", "We", "need", "to", "make", "sure", "the", "offsets", "are", "not", "out", "of", "range", "of", "the", "total", "size.", "Also", "check", "that", "they", "are", "in", "ascending", "order.", "The", "WARN_ON", "triggered", "by", "syzkaller", "(it", "sets", "panic_on_warn)", "is", "changed", "to", "also", "bail", "out,", "no", "point", "in", "continuing", "parsing.", "Briefly", "tested", "with", "simple", "ruleset", "of", "-A", "INPUT", "--limit", "1/s'", "--log", "plus", "jump", "to", "custom", "chains", "using", "32bit", "ebtables", "binary.", "Reported-by:", "<syzbot+845a53d13171abf8bf29@syzkaller.appspotmail.com>", "Signed-off-by:", "Florian", "Westphal", "<fw@strlen.de>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["@", "@", "-", "2060", ",", "7", "+", "2060", ",", "9", "@", "@", "static", "int", "ebt_size_mwt", "(", "struct", "compat_ebt_entry_mwt", "*", "match32", ",", "if", "(", "match_kern", ")", "match_kern", "-", ">", "match_size", "=", "ret", ";", "WARN_ON", "(", "type", "=", "=", "EBT_COMPAT_TARGET", "&", "&", "size_left", ")", ";", "if", "(", "WARN_ON", "(", "type", "=", "=", "EBT_COMPAT_TARGET", "&", "&", "size_left", ")", ")", "return", "-", "EINVAL", ";", "match32", "=", "(", "struct", "compat_ebt_entry_mwt", "*", ")", "buf", ";", "}", "@", "@", "-", "2116", ",", "6", "+", "2118", ",", "15", "@", "@", "static", "int", "size_entry_mwt", "(", "struct", "ebt_entry", "*", "entry", ",", "const", "unsigned", "char", "*", "base", ",", "*", "*", "offsets", "are", "relative", "to", "beginning", "of", "struct", "ebt_entry", "(", "i", ".", "e", ".", ",", "0", ")", ".", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "+", "+", "i", ")", "{", "if", "(", "offsets", "[", "i", "]", ">", "=", "*", "total", ")", "return", "-", "EINVAL", ";", "if", "(", "i", "=", "=", "0", ")", "continue", ";", "if", "(", "offsets", "[", "i", "-", "1", "]", ">", "offsets", "[", "i", "]", ")", "return", "-", "EINVAL", ";", "}", "for", "(", "i", "=", "0", ",", "j", "=", "1", ";", "j", "<", "4", ";", "j", "+", "+,", "i", "+", "+)", "{", "struct", "compat_ebt_entry_mwt", "*", "match32", ";", "unsigned", "int", "size", ";"], "docstring_tokens": ["arbitrarily", "write", "to", "a", "limited", "range", "of", "kernel", "memory", "."]}
{"contents": ["[SECURITY-499]", "Sanitize", "user", "id", "<->", "filename", "conversion"], "code_tokens": ["@", "@", "-", "575", ",", "7", "+", "575", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "kohsuke", "<", "/", "groupId", ">", "<", "artifactId", ">", "access", "-", "modifier", "-", "annotation", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "4", "<", "/", "version", ">", "<", "version", ">", "1", ".", "11", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "48", ",", "6", "+", "48", ",", "10", "@", "@", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileFilter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "DirectoryStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "InvalidPathException", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "@", "@", "-", "464", ",", "6", "+", "468", ",", "44", "@", "@", "public", "synchronized", "void", "doSubmitDescription", "(", "StaplerRequest", "req", ",", "StaplerRespons", "}", "}", "}", "File", "unsanitizedLegacyConfigFile", "=", "getUnsanitizedLegacyConfigFileFor", "(", "id", ")", ";", "if", "(", "unsanitizedLegacyConfigFile", ".", "exists", "(", ")", "&", "&", "!", "unsanitizedLegacyConfigFile", ".", "equals", "(", "configFile", ")", ")", "{", "File", "ancestor", "=", "unsanitizedLegacyConfigFile", ".", "getParentFile", "(", ");", "if", "(", "!", "configFile", ".", "exists", "(", "))", "{", "try", "{", "Files", ".", "createDirectory", "(", "configFile", ".", "getParentFile", "(", ").", "toPath", "(", "))", ";", "Files", ".", "move", "(", "unsanitizedLegacyConfigFile", ".", "toPath", "(", "),", "configFile", ".", "toPath", "(", "))", ";", "}", "catch", "(", "IOException", "|", "InvalidPathException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "String", ".", "format", "(", "\"", "Failed", "to", "migrate", "user", "record", "from", "%", "s", "to", "%", "s", ",", "see", "SECURITY", "-", "499", "for", "more", "information", "\"", ",", "idStrategy", "(", ").", "legacyFilenameOf", "(", "id", ")", ",", "idStrategy", "(", ").", "filenameOf", "(", "id", ")", "),", "e", ")", ";", "}", "}", "/", "/", "Don", "'", "t", "clean", "up", "ancestors", "with", "other", "children", ";", "the", "directories", "should", "be", "cleaned", "up", "when", "the", "last", "child", "/", "/", "is", "migrated", "File", "tmp", "=", "ancestor", ";", "try", "{", "while", "(", "!", "ancestor", ".", "equals", "(", "getRootDir", "(", "))", ")", "{", "try", "(", "DirectoryStream", "<", "Path", ">", "stream", "=", "Files", ".", "newDirectoryStream", "(", "ancestor", ".", "toPath", "(", "))", ")", "{", "if", "(", "!", "stream", ".", "iterator", "(", ").", "hasNext", "(", "))", "{", "tmp", "=", "ancestor", ";", "ancestor", "=", "tmp", ".", "getParentFile", "(", ");", "Files", ".", "deleteIfExists", "(", "tmp", ".", "toPath", "(", "))", ";", "}", "else", "{", "break", ";", "}", "}", "}", "}", "catch", "(", "IOException", "|", "InvalidPathException", "e", ")", "{", "if", "(", "LOGGER", ".", "isLoggable", "(", "Level", ".", "FINE", ")", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Could", "not", "delete", "\"", "+", "tmp", "+", "\"", "when", "cleaning", "up", "legacy", "user", "directories", "\"", ",", "e", ")", ";", "}", "}", "}", "if", "(", "u", "=", "=", "null", "&", "&", "(", "create", "|", "|", "configFile", ".", "exists", "(", "))", ")", "{", "User", "tmp", "=", "new", "User", "(", "id", ",", "fullName", ")", ";", "User", "prev", ";", "@", "@", "-", "704", ",", "6", "+", "746", ",", "10", "@", "@", "public", "boolean", "accept", "(", "File", "pathname", ")", "{", "}", ");", "}", "private", "static", "File", "getUnsanitizedLegacyConfigFileFor", "(", "String", "id", ")", "{", "return", "new", "File", "(", "getRootDir", "(", "),", "idStrategy", "(", ").", "legacyFilenameOf", "(", "id", ")", "+", "\"", "/", "config", ".", "xml", "\"", ");", "}", "/", "**", "*", "Gets", "the", "directory", "where", "Hudson", "stores", "user", "information", ".", "*", "/", "@", "@", "-", "30", ",", "6", "+", "30", ",", "8", "@", "@", "import", "hudson", ".", "util", ".", "CaseInsensitiveComparator", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "jenkinsci", ".", "Symbol", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "ProtectedExternally", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "DataBoundConstructor", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "@", "@", "-", "50", ",", "16", "+", "52", ",", "32", "@", "@", "public", "static", "IdStrategy", "CASE_INSENSITIVE", "=", "new", "CaseInsensitive", "(", ");", "/", "**", "*", "Converts", "an", "ID", "into", "a", "name", "that", "for", "use", "as", "a", "filename", ".", "*", "Converts", "an", "ID", "into", "a", "name", "for", "use", "as", "a", "filename", ".", "The", "return", "value", "must", "not", "contain", "any", "filesystem", "unsafe", "*", "characters", "or", "names", ".", "See", "https", ":", "//", "msdn", ".", "microsoft", ".", "com", "/", "en", "-", "us", "/", "library", "/", "aa365247", ".", "aspx", "for", "information", "on", "reserved", "*", "names", ".", "*", "*", "@", "param", "id", "the", "id", ".", "Note", ",", "this", "method", "assumes", "that", "the", "id", "does", "not", "contain", "any", "filesystem", "unsafe", "characters", ".", "*", "@", "return", "the", "name", ".", "*", "@", "param", "id", "the", "id", ".", "*", "@", "return", "the", "name", ".", "Must", "be", "filesystem", "safe", ".", "*", "/", "@", "Nonnull", "public", "abstract", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", ";", "/", "**", "*", "Converts", "a", "filename", "into", "the", "corresponding", "id", ".", "*", "Converts", "an", "ID", "into", "a", "name", "for", "use", "as", "a", "filename", ".", "*", "*", "Legacy", "implementation", "used", "only", "for", "migrating", "old", "style", "config", "files", "to", "the", "new", "implementation", ".", "*", "@", "param", "id", "the", "id", "*", "@", "return", "the", "name", "*", "/", "@", "Nonnull", "@", "Restricted", "(", "ProtectedExternally", ".", "class", ")", "public", "String", "legacyFilenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "filenameOf", "(", "id", ")", ";", "}", "/", "**", "*", "Converts", "a", "filename", "into", "the", "corresponding", "id", ".", "This", "may", "contain", "filesystem", "unsafe", "characters", ".", "*", "@", "param", "filename", "the", "filename", ".", "*", "@", "return", "the", "corresponding", "id", ".", "*", "@", "since", "1", ".", "577", "@", "@", "-", "156", ",", "9", "+", "174", ",", "142", "@", "@", "public", "CaseInsensitive", "(", ")", "{", "}", "@", "Override", "@", "Nonnull", "public", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "if", "(", "id", ".", "isEmpty", "(", ")", "|", "|", "id", ".", "matches", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "id", "=", "id", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "switch", "(", "id", ")", "{", "case", "\"", "\":", "case", "\"", ".\"", ":", "return", "\"", "$", "002f", "\"", ";", "case", "\"", "..", "\":", "return", "\"", "$", "002e", "$", "002e", "\"", ";", "case", "\"", "con", "\"", ":", "return", "\"", "$", "0063on", "\"", ";", "case", "\"", "prn", "\"", ":", "return", "\"", "$", "0070rn", "\"", ";", "case", "\"", "aux", "\"", ":", "return", "\"", "$", "0061ux", "\"", ";", "case", "\"", "nul", "\"", ":", "return", "\"", "$", "006eul", "\"", ";", "case", "\"", "com1", "\"", ":", "return", "\"", "$", "0063om1", "\"", ";", "case", "\"", "com2", "\"", ":", "return", "\"", "$", "0063om2", "\"", ";", "case", "\"", "com3", "\"", ":", "return", "\"", "$", "0063om3", "\"", ";", "case", "\"", "com4", "\"", ":", "return", "\"", "$", "0063om4", "\"", ";", "case", "\"", "com5", "\"", ":", "return", "\"", "$", "0063om5", "\"", ";", "case", "\"", "com6", "\"", ":", "return", "\"", "$", "0063om6", "\"", ";", "case", "\"", "com7", "\"", ":", "return", "\"", "$", "0063om7", "\"", ";", "case", "\"", "com8", "\"", ":", "return", "\"", "$", "0063om8", "\"", ";", "case", "\"", "com9", "\"", ":", "return", "\"", "$", "0063om9", "\"", ";", "case", "\"", "lpt1", "\"", ":", "return", "\"", "$", "006cpt1", "\"", ";", "case", "\"", "lpt2", "\"", ":", "return", "\"", "$", "006cpt2", "\"", ";", "case", "\"", "lpt3", "\"", ":", "return", "\"", "$", "006cpt3", "\"", ";", "case", "\"", "lpt4", "\"", ":", "return", "\"", "$", "006cpt4", "\"", ";", "case", "\"", "lpt5", "\"", ":", "return", "\"", "$", "006cpt5", "\"", ";", "case", "\"", "lpt6", "\"", ":", "return", "\"", "$", "006cpt6", "\"", ";", "case", "\"", "lpt7", "\"", ":", "return", "\"", "$", "006cpt7", "\"", ";", "case", "\"", "lpt8", "\"", ":", "return", "\"", "$", "006cpt8", "\"", ";", "case", "\"", "lpt9", "\"", ":", "return", "\"", "$", "006cpt9", "\"", ";", "default", ":", "if", "(", "id", ".", "endsWith", "(", "\".", "\")", ")", "{", "return", "id", ".", "substring", "(", "0", ",", "id", ".", "length", "(", ")-", "1", ")", "+\"", "$", "002e", "\"", ";", "}", "else", "if", "(", "id", ".", "startsWith", "(", "\"-", "\")", ")", "{", "return", "\"", "$", "002d", "\"", "+", "id", ".", "substring", "(", "1", ")", ";", "}", "return", "id", ";", "}", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "id", ".", "length", "(", ")", "+", "16", ")", ";", "for", "(", "char", "c", ":", "id", ".", "toCharArray", "(", "))", "{", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "Z", "'", ")", "{", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "{", "buf", ".", "append", "(", "'$", "')", ";", "buf", ".", "append", "(", "StringUtils", ".", "leftPad", "(", "Integer", ".", "toHexString", "(", "c", "&", "0xffff", ")", ",", "4", ",", "'", "0", "'", "))", ";", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "}", "@", "Nonnull", "@", "Override", "public", "String", "legacyFilenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "id", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "@", "Override", "public", "String", "idFromFilename", "(", "@", "Nonnull", "String", "filename", ")", "{", "if", "(", "filename", ".", "matches", "(", "\"[", "A", "-", "Za", "-", "z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "return", "filename", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "filename", ".", "length", "(", "))", ";", "final", "char", "[", "]", "chars", "=", "filename", ".", "toCharArray", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "chars", ".", "length", ";", "i", "+", "+)", "{", "char", "c", "=", "chars", "[", "i", "]", ";", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "a", "'", ")", "{", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "c", "=", "=", "'", "$'", ")", "{", "StringBuilder", "hex", "=", "new", "StringBuilder", "(", "4", ")", ";", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "buf", ".", "append", "(", "Character", ".", "valueOf", "(", "(", "char", ")", "Integer", ".", "parseInt", "(", "hex", ".", "toString", "(", "),", "16", ")", "))", ";", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "@", "-", "203", ",", "7", "+", "354", ",", "93", "@", "@", "public", "CaseSensitive", "(", ")", "{", "}", "@", "Override", "@", "Nonnull", "public", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "if", "(", "id", ".", "matches", "(", "\"[", "a", "-", "z0", "-", "9_", ".", "-", "]+", "\")", ")", "{", "if", "(", "id", ".", "isEmpty", "(", ")", "|", "|", "id", ".", "matches", "(", "\"[", "a", "-", "z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "switch", "(", "id", ")", "{", "case", "\"", "\":", "case", "\"", ".\"", ":", "return", "\"", "$", "002f", "\"", ";", "case", "\"", "..", "\":", "return", "\"", "$", "002e", "$", "002e", "\"", ";", "case", "\"", "con", "\"", ":", "return", "\"", "$", "0063on", "\"", ";", "case", "\"", "prn", "\"", ":", "return", "\"", "$", "0070rn", "\"", ";", "case", "\"", "aux", "\"", ":", "return", "\"", "$", "0061ux", "\"", ";", "case", "\"", "nul", "\"", ":", "return", "\"", "$", "006eul", "\"", ";", "case", "\"", "com1", "\"", ":", "return", "\"", "$", "0063om1", "\"", ";", "case", "\"", "com2", "\"", ":", "return", "\"", "$", "0063om2", "\"", ";", "case", "\"", "com3", "\"", ":", "return", "\"", "$", "0063om3", "\"", ";", "case", "\"", "com4", "\"", ":", "return", "\"", "$", "0063om4", "\"", ";", "case", "\"", "com5", "\"", ":", "return", "\"", "$", "0063om5", "\"", ";", "case", "\"", "com6", "\"", ":", "return", "\"", "$", "0063om6", "\"", ";", "case", "\"", "com7", "\"", ":", "return", "\"", "$", "0063om7", "\"", ";", "case", "\"", "com8", "\"", ":", "return", "\"", "$", "0063om8", "\"", ";", "case", "\"", "com9", "\"", ":", "return", "\"", "$", "0063om9", "\"", ";", "case", "\"", "lpt1", "\"", ":", "return", "\"", "$", "006cpt1", "\"", ";", "case", "\"", "lpt2", "\"", ":", "return", "\"", "$", "006cpt2", "\"", ";", "case", "\"", "lpt3", "\"", ":", "return", "\"", "$", "006cpt3", "\"", ";", "case", "\"", "lpt4", "\"", ":", "return", "\"", "$", "006cpt4", "\"", ";", "case", "\"", "lpt5", "\"", ":", "return", "\"", "$", "006cpt5", "\"", ";", "case", "\"", "lpt6", "\"", ":", "return", "\"", "$", "006cpt6", "\"", ";", "case", "\"", "lpt7", "\"", ":", "return", "\"", "$", "006cpt7", "\"", ";", "case", "\"", "lpt8", "\"", ":", "return", "\"", "$", "006cpt8", "\"", ";", "case", "\"", "lpt9", "\"", ":", "return", "\"", "$", "006cpt9", "\"", ";", "default", ":", "if", "(", "id", ".", "endsWith", "(", "\".", "\")", ")", "{", "return", "id", ".", "substring", "(", "0", ",", "id", ".", "length", "(", ")-", "1", ")", "+\"", "$", "002e", "\"", ";", "}", "else", "if", "(", "id", ".", "startsWith", "(", "\"-", "\")", ")", "{", "return", "\"", "$", "002d", "\"", "+", "id", ".", "substring", "(", "1", ")", ";", "}", "return", "id", ";", "}", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "id", ".", "length", "(", ")", "+", "16", ")", ";", "for", "(", "char", "c", ":", "id", ".", "toCharArray", "(", "))", "{", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "Z", "'", ")", "{", "buf", ".", "append", "(", "'~", "')", ";", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "{", "buf", ".", "append", "(", "'$", "')", ";", "buf", ".", "append", "(", "StringUtils", ".", "leftPad", "(", "Integer", ".", "toHexString", "(", "c", "&", "0xffff", ")", ",", "4", ",", "'", "0", "'", "))", ";", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Nonnull", "@", "Override", "public", "String", "legacyFilenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "if", "(", "id", ".", "matches", "(", "\"[", "a", "-", "z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "return", "id", ";", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "id", ".", "length", "(", ")", "+", "16", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "101", "@", "@", "package", "jenkins", ".", "model", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "IdStrategyTest", "{", "private", "IdStrategy", "idStrategy", ";", "@", "Test", "public", "void", "caseInsensitive", "(", ")", "{", "idStrategy", "=", "new", "IdStrategy", ".", "CaseInsensitive", "(", ");", "assertRestrictedNames", "(", ");", "assertRoundTrip", "(", "\"", "foo", "\"", ",", "\"", "foo", "\"", ");", "assertRoundTrip", "(", "\"", "foo", "/", "bar", "\"", ",", "\"", "foo", "$", "002fbar", "\"", ");", "assertRoundTrip", "(", "\".", "./", "test", "\"", ",", "\"", "..", "$", "002ftest", "\"", ");", "assertRoundTrip", "(", "\"", "0123", "_", "-", "@~", "a", "\"", ",", "\"", "0123", "_", "-", "@$", "007ea", "\"", ");", "assertRoundTrip", "(", "\"", "foo", ".", "\",", "\"", "foo", "$", "002e", "\"", ");", "assertRoundTrip", "(", "\"-", "foo", "\"", ",", "\"", "$", "002dfoo", "\"", ");", "/", "/", "Should", "not", "return", "the", "same", "username", "due", "to", "case", "insensitivity", "assertCaseInsensitiveRoundTrip", "(", "\"", "Foo", "\"", ",", "\"", "foo", "\"", ");", "assertCaseInsensitiveRoundTrip", "(", "\"", "Foo", "/", "Bar", "\"", ",", "\"", "foo", "$", "002fbar", "\"", ");", "assertCaseInsensitiveRoundTrip", "(", "\".", "./", "Test", "\"", ",", "\"", "..", "$", "002ftest", "\"", ");", "assertCaseInsensitiveRoundTrip", "(", "\"", "NUL", "\"", ",", "\"", "$", "006eul", "\"", ");", "assertEquals", "(", "\"", "foo", "\"", ",", "idStrategy", ".", "idFromFilename", "(", "\"~", "foo", "\"", "))", ";", "assertEquals", "(", "\"", "0123", "_", "-", "@", "a", "\"", ",", "idStrategy", ".", "idFromFilename", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "))", ";", "}", "@", "Test", "public", "void", "caseSensitive", "(", ")", "{", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertRestrictedNames", "(", ");", "assertRoundTrip", "(", "\"", "foo", "\"", ",", "\"", "foo", "\"", ");", "assertRoundTrip", "(", "\"", "Foo", "\"", ",", "\"", "~", "foo", "\"", ");", "assertRoundTrip", "(", "\"", "foo", "/", "bar", "\"", ",", "\"", "foo", "$", "002fbar", "\"", ");", "assertRoundTrip", "(", "\"", "Foo", "/", "Bar", "\"", ",", "\"", "~", "foo", "$", "002f", "~", "bar", "\"", ");", "assertRoundTrip", "(", "\".", "./", "test", "\"", ",", "\"", "..", "$", "002ftest", "\"", ");", "assertRoundTrip", "(", "\".", "./", "Test", "\"", ",", "\"", "..", "$", "002f", "~", "test", "\"", ");", "assertRoundTrip", "(", "\"", "0123", "_", "-", "@~", "a", "\"", ",", "\"", "0123", "_", "-", "@$", "007ea", "\"", ");", "assertRoundTrip", "(", "\"", "0123", "_", "-", "@", "A", "\"", ",", "\"", "0123", "_", "-", "@~", "a", "\"", ");", "assertRoundTrip", "(", "\"", "foo", ".", "\",", "\"", "foo", "$", "002e", "\"", ");", "assertRoundTrip", "(", "\"-", "foo", "\"", ",", "\"", "$", "002dfoo", "\"", ");", "assertRoundTrip", "(", "\"", "Con", "\"", ",", "\"", "~", "con", "\"", ");", "assertRoundTrip", "(", "\"", "Prn", "\"", ",", "\"", "~", "prn", "\"", ");", "assertRoundTrip", "(", "\"", "Aux", "\"", ",", "\"", "~", "aux", "\"", ");", "assertRoundTrip", "(", "\"", "Nul", "\"", ",", "\"", "~", "nul", "\"", ");", "assertRoundTrip", "(", "\"", "Com1", "\"", ",", "\"", "~", "com1", "\"", ");", "assertRoundTrip", "(", "\"", "Lpt1", "\"", ",", "\"", "~", "lpt1", "\"", ");", "}", "private", "void", "assertRestrictedNames", "(", ")", "{", "assertEquals", "(", "\"$", "002f", "\"", ",", "idStrategy", ".", "filenameOf", "(", "\".", "\")", ");", "/", "/", "\"", ".\"", "and", "\"", "/\"", "are", "equivalent", "from", "an", "implementation", "standpoint", ",", "but", "both", "should", "return", "\"", "/\"", "assertEquals", "(", "\"/", "\",", "idStrategy", ".", "idFromFilename", "(", "idStrategy", ".", "filenameOf", "(", "\".", "\")", "))", ";", "assertEquals", "(", "\"$", "002f", "\"", ",", "idStrategy", ".", "filenameOf", "(", "\"\"", "))", ";", "/", "/", "\"", "\"", "and", "\"", "/\"", "are", "equivalent", "from", "an", "implementation", "standpoint", ",", "but", "both", "should", "return", "\"", "/\"", "assertEquals", "(", "\"/", "\",", "idStrategy", ".", "idFromFilename", "(", "idStrategy", ".", "filenameOf", "(", "\"\"", "))", ");", "assertRoundTrip", "(", "\"/", "\",", "\"", "$", "002f", "\"", ");", "assertRoundTrip", "(", "\".", ".\"", ",", "\"", "$", "002e", "$", "002e", "\"", ");", "assertRoundTrip", "(", "\"", "con", "\"", ",", "\"", "$", "0063on", "\"", ");", "assertRoundTrip", "(", "\"", "prn", "\"", ",", "\"", "$", "0070rn", "\"", ");", "assertRoundTrip", "(", "\"", "aux", "\"", ",", "\"", "$", "0061ux", "\"", ");", "assertRoundTrip", "(", "\"", "nul", "\"", ",", "\"", "$", "006eul", "\"", ");", "assertRoundTrip", "(", "\"", "com1", "\"", ",", "\"", "$", "0063om1", "\"", ");", "assertRoundTrip", "(", "\"", "com2", "\"", ",", "\"", "$", "0063om2", "\"", ");", "assertRoundTrip", "(", "\"", "com3", "\"", ",", "\"", "$", "0063om3", "\"", ");", "assertRoundTrip", "(", "\"", "com4", "\"", ",", "\"", "$", "0063om4", "\"", ");", "assertRoundTrip", "(", "\"", "com5", "\"", ",", "\"", "$", "0063om5", "\"", ");", "assertRoundTrip", "(", "\"", "com6", "\"", ",", "\"", "$", "0063om6", "\"", ");", "assertRoundTrip", "(", "\"", "com7", "\"", ",", "\"", "$", "0063om7", "\"", ");", "assertRoundTrip", "(", "\"", "com8", "\"", ",", "\"", "$", "0063om8", "\"", ");", "assertRoundTrip", "(", "\"", "com9", "\"", ",", "\"", "$", "0063om9", "\"", ");", "assertRoundTrip", "(", "\"", "lpt1", "\"", ",", "\"", "$", "006cpt1", "\"", ");", "assertRoundTrip", "(", "\"", "lpt2", "\"", ",", "\"", "$", "006cpt2", "\"", ");", "assertRoundTrip", "(", "\"", "lpt3", "\"", ",", "\"", "$", "006cpt3", "\"", ");", "assertRoundTrip", "(", "\"", "lpt4", "\"", ",", "\"", "$", "006cpt4", "\"", ");", "assertRoundTrip", "(", "\"", "lpt5", "\"", ",", "\"", "$", "006cpt5", "\"", ");", "assertRoundTrip", "(", "\"", "lpt6", "\"", ",", "\"", "$", "006cpt6", "\"", ");", "assertRoundTrip", "(", "\"", "lpt7", "\"", ",", "\"", "$", "006cpt7", "\"", ");", "assertRoundTrip", "(", "\"", "lpt8", "\"", ",", "\"", "$", "006cpt8", "\"", ");", "assertRoundTrip", "(", "\"", "lpt9", "\"", ",", "\"", "$", "006cpt9", "\"", ");", "}", "private", "void", "assertRoundTrip", "(", "String", "username", ",", "String", "filename", ")", "{", "assertEquals", "(", "filename", ",", "idStrategy", ".", "filenameOf", "(", "username", ")", ");", "assertEquals", "(", "username", ",", "idStrategy", ".", "idFromFilename", "(", "filename", ")", ");", "}", "private", "void", "assertCaseInsensitiveRoundTrip", "(", "String", "username", ",", "String", "filename", ")", "{", "assertEquals", "(", "filename", ",", "idStrategy", ".", "filenameOf", "(", "username", ")", ");", "assertEquals", "(", "username", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ",", "idStrategy", ".", "idFromFilename", "(", "filename", ")", ");", "}", "}", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "Functions", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "hudson", ".", "security", ".", "ACLContext", ";", "import", "hudson", ".", "security", ".", "AbstractPasswordBasedSecurityRealm", ";", "@", "@", "-", "59", ",", "12", "+", "60", ",", "17", "@", "@", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UserDetails", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UsernameNotFoundException", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "collection", ".", "IsEmptyCollection", ".", "empty", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "StringEndsWith", ".", "endsWith", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assume", ".", "*;", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "hamcrest", ".", "collection", ".", "IsEmptyCollection", ";", "import", "org", ".", "hamcrest", ".", "core", ".", "IsEqual", ";", "import", "org", ".", "hamcrest", ".", "core", ".", "StringEndsWith", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "714", ",", "6", "+", "720", ",", "95", "@", "@", "public", "void", "getAllPropertiesRequiresAdmin", "(", ")", "{", "}", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "499", "\"", ")", "public", "void", "createdUsersHaveCorrectConfigLocation", "(", ")", "{", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "admin", "\"", ",", "true", ")", ",", "\"", "users", "/", "admin", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "foo", "\"", ",", "true", ")", ",", "\"", "users", "/", "foo", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "\"", ",", "true", ")", ",", "\"", "users", "/", "foo", "$", "002fbar", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "/", "baz", "\"", ",", "true", ")", ",", "\"", "users", "/", "foo", "$", "002fbar", "$", "002fbaz", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"/", "\",", "true", ")", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\".", "\",", "true", ")", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\".", ".\"", ",", "true", ")", ",", "\"", "users", "/", "$", "002e", "$", "002e", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\".", "./", "config", ".", "xml", "\"", ",", "true", ")", ",", "\"", "users", "/", "..", "$", "002fconfig", ".", "xml", "/", "config", ".", "xml", "\"", ");", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "499", "\"", ")", "@", "LocalData", "public", "void", "legacyUserConfigDirsMigrated", "(", ")", "{", "File", "rootDir", "=", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "User", "admin", "=", "User", ".", "getById", "(", "\"", "admin", "\"", ",", "false", ")", ";", "assertCorrectConfig", "(", "admin", ",", "\"", "users", "/", "admin", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "admin", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertThat", "(", "admin", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Admin", "\"", "))", ";", "User", "foo", "=", "User", ".", "getById", "(", "\"", "foo", "\"", ",", "false", ")", ";", "File", "fooDir", "=", "new", "File", "(", "rootDir", ",", "\"", "foo", "\"", ");", "assertCorrectConfig", "(", "foo", ",", "\"", "users", "/", "foo", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "foo", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertThat", "(", "foo", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "\"", "))", ";", "User", "fooBar", "=", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "\"", ",", "false", ")", ";", "File", "fooBarDir", "=", "new", "File", "(", "fooDir", ",", "\"", "bar", "\"", ");", "assertCorrectConfig", "(", "fooBar", ",", "\"", "users", "/", "foo", "$", "002fbar", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "fooBar", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertTrue", "(", "fooBarDir", ".", "exists", "(", "))", ";", "assertThat", "(", "fooBar", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "Bar", "\"", "))", ";", "User", "fooBaz", "=", "User", ".", "getById", "(", "\"", "foo", "/", "baz", "\"", ",", "false", ")", ";", "File", "fooBazDir", "=", "new", "File", "(", "fooDir", ",", "\"", "baz", "\"", ");", "assertCorrectConfig", "(", "fooBaz", ",", "\"", "users", "/", "foo", "$", "002fbaz", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "fooBaz", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "fooBazDir", ".", "exists", "(", "))", ";", "assertThat", "(", "fooBaz", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "Baz", "\"", "))", ";", "User", "fooBarBaz", "=", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "/", "baz", "\"", ",", "false", ")", ";", "File", "fooBarBazDir", "=", "new", "File", "(", "fooBarDir", ",", "\"", "baz", "\"", ");", "assertCorrectConfig", "(", "fooBarBaz", ",", "\"", "users", "/", "foo", "$", "002fbar", "$", "002fbaz", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "fooBarBaz", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "fooBarBazDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "fooBarDir", ".", "exists", "(", "))", ";", "assertThat", "(", "fooBarBaz", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "Bar", "Baz", "\"", "))", ";", "User", "slash", "=", "User", ".", "getById", "(", "\"/", "\",", "false", ")", ";", "File", "slashDir", "=", "new", "File", "(", "rootDir", ",", "\"", "$", "002f", "\"", ");", "assertCorrectConfig", "(", "slash", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "slash", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "slashDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "new", "File", "(", "rootDir", ",", "\"", "config", ".", "xml", "\"", ").", "exists", "(", "))", ";", "assertThat", "(", "slash", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Slash", "\"", "))", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "499", "\"", ")", "@", "LocalData", "public", "void", "emptyUsernameConfigMigrated", "(", ")", "{", "File", "rootDir", "=", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "User", "admin", "=", "User", ".", "getById", "(", "\"", "admin", "\"", ",", "false", ")", ";", "assertCorrectConfig", "(", "admin", ",", "\"", "users", "/", "admin", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "admin", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertThat", "(", "admin", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Admin", "\"", "))", ";", "User", "empty", "=", "User", ".", "getById", "(", "\"\"", ",", "false", ")", ";", "File", "emptyDir", "=", "new", "File", "(", "rootDir", ",", "\"", "$", "002f", "\"", ");", "assertCorrectConfig", "(", "empty", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "empty", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "emptyDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "new", "File", "(", "rootDir", ",", "\"", "config", ".", "xml", "\"", ").", "exists", "(", "))", ";", "assertThat", "(", "empty", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Empty", "\"", "))", ";", "}", "private", "static", "void", "assertCorrectConfig", "(", "User", "user", ",", "String", "unixPath", ")", "{", "assertThat", "(", "user", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "getPath", "(", "),", "endsWith", "(", "unixPath", ".", "replace", "(", "'/", "',", "File", ".", "separatorChar", ")", "))", ";", "}", "public", "static", "class", "SomeUserProperty", "extends", "UserProperty", "{", "@", "TestExtension", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ">", "<", "disabledAdministrativeMonitors", "/", ">", "<", "version", ">", "1", ".", "0", "<", "/", "version", ">", "<", "numExecutors", ">", "2", "<", "/", "numExecutors", ">", "<", "mode", ">", "NORMAL", "<", "/", "mode", ">", "<", "useSecurity", ">", "true", "<", "/", "useSecurity", ">", "<", "authorizationStrategy", "class", "=", "\"", "hudson", ".", "security", ".", "FullControlOnceLoggedInAuthorizationStrategy", "\"", ">", "<", "denyAnonymousReadAccess", ">", "true", "<", "/", "denyAnonymousReadAccess", ">", "<", "/", "authorizationStrategy", ">", "<", "securityRealm", "class", "=", "\"", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "\"", ">", "<", "disableSignup", ">", "true", "<", "/", "disableSignup", ">", "<", "enableCaptcha", ">", "false", "<", "/", "enableCaptcha", ">", "<", "/", "securityRealm", ">", "<", "disableRememberMe", ">", "false", "<", "/", "disableRememberMe", ">", "<", "projectNamingStrategy", "class", "=", "\"", "jenkins", ".", "model", ".", "ProjectNamingStrategy", "$", "DefaultProjectNamingStrategy", "\"", "/>", "<", "workspaceDir", ">", "${", "JENKINS_HOME", "}", "/", "workspace", "/", "${", "ITEM_FULLNAME", "}", "</", "workspaceDir", ">", "<", "buildsDir", ">", "${", "ITEM_ROOTDIR", "}", "/", "builds", "<", "/", "buildsDir", ">", "<", "jdks", "/", ">", "<", "viewsTabBar", "class", "=", "\"", "hudson", ".", "views", ".", "DefaultViewsTabBar", "\"", "/>", "<", "myViewsTabBar", "class", "=", "\"", "hudson", ".", "views", ".", "DefaultMyViewsTabBar", "\"", "/>", "<", "clouds", "/", ">", "<", "scmCheckoutRetryCount", ">", "0", "<", "/", "scmCheckoutRetryCount", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "primaryView", ">", "all", "<", "/", "primaryView", ">", "<", "slaveAgentPort", ">", "-", "1", "<", "/", "slaveAgentPort", ">", "<", "label", ">", "</", "label", ">", "<", "crumbIssuer", "class", "=", "\"", "hudson", ".", "security", ".", "csrf", ".", "DefaultCrumbIssuer", "\"", ">", "<", "excludeClientIPFromCrumb", ">", "false", "<", "/", "excludeClientIPFromCrumb", ">", "<", "/", "crumbIssuer", ">", "<", "nodeProperties", "/", ">", "<", "globalNodeProperties", "/", ">", "<", "/", "hudson", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Admin", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwu9tm9n3SIC", "+", "bkaGz5WfsKwJz", "+", "a04aUUWiq4hACNLemh6f62j2cgIT9KuyMGtXvr7ab6GWBQGzThOrJfK1etETQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "eDQD3w", "/", "iXX0VWWKb3Kv5QOKjFg0Yj3Hk9Z", ".", "Y43iFHJQOUYmHdvVuS", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Empty", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwkYgvFl7YHG1866pnHDawvcy2VQ0jlbQd85vu9WWI22SjmLmJS0TMMS4w", "+", "3XqvEt8nHx9", "/", "0U06huIcMj3XuDPuQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "dTn2EpIBa2E0T6R", ".", "2XK", "/", "HucVkyqdu9qGQ6FmBOYdZlpeN2mtv", ".", "Ez2", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ">", "<", "disabledAdministrativeMonitors", "/", ">", "<", "version", ">", "1", ".", "0", "<", "/", "version", ">", "<", "numExecutors", ">", "2", "<", "/", "numExecutors", ">", "<", "mode", ">", "NORMAL", "<", "/", "mode", ">", "<", "useSecurity", ">", "true", "<", "/", "useSecurity", ">", "<", "authorizationStrategy", "class", "=", "\"", "hudson", ".", "security", ".", "FullControlOnceLoggedInAuthorizationStrategy", "\"", ">", "<", "denyAnonymousReadAccess", ">", "true", "<", "/", "denyAnonymousReadAccess", ">", "<", "/", "authorizationStrategy", ">", "<", "securityRealm", "class", "=", "\"", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "\"", ">", "<", "disableSignup", ">", "true", "<", "/", "disableSignup", ">", "<", "enableCaptcha", ">", "false", "<", "/", "enableCaptcha", ">", "<", "/", "securityRealm", ">", "<", "disableRememberMe", ">", "false", "<", "/", "disableRememberMe", ">", "<", "projectNamingStrategy", "class", "=", "\"", "jenkins", ".", "model", ".", "ProjectNamingStrategy", "$", "DefaultProjectNamingStrategy", "\"", "/>", "<", "workspaceDir", ">", "${", "JENKINS_HOME", "}", "/", "workspace", "/", "${", "ITEM_FULLNAME", "}", "</", "workspaceDir", ">", "<", "buildsDir", ">", "${", "ITEM_ROOTDIR", "}", "/", "builds", "<", "/", "buildsDir", ">", "<", "jdks", "/", ">", "<", "viewsTabBar", "class", "=", "\"", "hudson", ".", "views", ".", "DefaultViewsTabBar", "\"", "/>", "<", "myViewsTabBar", "class", "=", "\"", "hudson", ".", "views", ".", "DefaultMyViewsTabBar", "\"", "/>", "<", "clouds", "/", ">", "<", "scmCheckoutRetryCount", ">", "0", "<", "/", "scmCheckoutRetryCount", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "primaryView", ">", "all", "<", "/", "primaryView", ">", "<", "slaveAgentPort", ">", "-", "1", "<", "/", "slaveAgentPort", ">", "<", "label", ">", "</", "label", ">", "<", "crumbIssuer", "class", "=", "\"", "hudson", ".", "security", ".", "csrf", ".", "DefaultCrumbIssuer", "\"", ">", "<", "excludeClientIPFromCrumb", ">", "false", "<", "/", "excludeClientIPFromCrumb", ">", "<", "/", "crumbIssuer", ">", "<", "nodeProperties", "/", ">", "<", "globalNodeProperties", "/", ">", "<", "/", "hudson", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Admin", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwu9tm9n3SIC", "+", "bkaGz5WfsKwJz", "+", "a04aUUWiq4hACNLemh6f62j2cgIT9KuyMGtXvr7ab6GWBQGzThOrJfK1etETQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "eDQD3w", "/", "iXX0VWWKb3Kv5QOKjFg0Yj3Hk9Z", ".", "Y43iFHJQOUYmHdvVuS", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Slash", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwkYgvFl7YHG1866pnHDawvcy2VQ0jlbQd85vu9WWI22SjmLmJS0TMMS4w", "+", "3XqvEt8nHx9", "/", "0U06huIcMj3XuDPuQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "dTn2EpIBa2E0T6R", ".", "2XK", "/", "HucVkyqdu9qGQ6FmBOYdZlpeN2mtv", ".", "Ez2", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Bar", "Baz", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwykg9OxsaVN4tRz33o0I7RoexPAcg52", "/", "IhBfyoRqKMNNMjFH3SREdkGrpde49dhP1Otr6wbrbG8dE", "+", "E", "/", "bsd", "+", "fZQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "9FVRXp7wUK4VFULhuZqBguHtsqGa9KRmJzfe6FPTjE8Ve0D", "/", "Bca", ".", "a", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Bar", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwqrNFnYtDmkxAb5Qs1j0lciURihCOMJ7xMp4fI279OIBsfW3WtxiigLfOzn", "+", "3yPU5v2d0", "/", "hY1ABrz", "/", "elzhs7xFA", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "1D8djmPHEmDX9TxJ4DG4eud936OUb8dB3rp9hTFStx5fIZ4", ".", "ZdRGO", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Baz", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwkxG8Z1KYPi1", "+", "vDNVMpTlAypMDOGQJFjr75hA", "+", "SUXdcohXsDRsi2L1OTrRvbmFlK02pYleeogvPoblSUuQsJOSA", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "RSZgsv46gLn5LJhpagbilOC", "/", "Pkc", ".", "74scxNbw6RqONsjc9fF3X4vry", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwre0RkJCk2SvcRB7Lce", "+", "95AQodPejQb5rJMjuyd6yrSB", "/", "hQeJZzPkW4lbT9ueJO0Ui5CpYeRPEVHQMxvvvgy6dQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "1sYZ", ".", "uQWbRqioql2bqLkfOjuORvXD2b42HMwLhU", "/", "9EB2TVfjvSpAG", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">"], "docstring_tokens": ["bypass", "access", "restrictions", "and", "perform", "multiple", "unauthorized", "actions"]}
{"contents": ["[PATCH]", "bridge:", "fix", "possible", "overflow", "in", "get_fdb_entries", "Make", "sure", "to", "properly", "clamp", "maxnum", "to", "avoid", "overflow", "Signed-off-by:", "Chris", "Wright", "<chrisw@sous-sol.org>", "Acked-by:", "Eugene", "Teo", "<eteo@redhat.com>", "Acked-by:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "58", ",", "12", "+", "58", ",", "13", "@", "@", "static", "int", "get_fdb_entries", "(", "struct", "net_bridge", "*", "br", ",", "void", "__user", "*", "userbuf", ",", "{", "int", "num", ";", "void", "*", "buf", ";", "size_t", "size", "=", "maxnum", "*", "sizeof", "(", "struct", "__fdb_entry", ")", ";", "size_t", "size", ";", "if", "(", "size", ">", "PAGE_SIZE", ")", "{", "size", "=", "PAGE_SIZE", ";", "/", "*", "Clamp", "size", "to", "PAGE_SIZE", ",", "test", "maxnum", "to", "avoid", "overflow", "*", "/", "if", "(", "maxnum", ">", "PAGE_SIZE", "/", "sizeof", "(", "struct", "__fdb_entry", ")", ")", "maxnum", "=", "PAGE_SIZE", "/", "sizeof", "(", "struct", "__fdb_entry", ")", ";", "}", "size", "=", "maxnum", "*", "sizeof", "(", "struct", "__fdb_entry", ")", ";", "buf", "=", "kmalloc", "(", "size", ",", "GFP_USER", ")", ";", "if", "(", "!", "buf", ")"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "with", "elevated", "privileges"]}
{"contents": ["tuntap:", "correctly", "handle", "error", "in", "tun_set_iff()", "Commit", "c8d68e6be1c3b242f1c598595830890b65cea64a", "(tuntap:", "multiqueue", "support)", "only", "call", "free_netdev()", "on", "error", "in", "tun_set_iff().", "This", "causes", "several", "issues:", "-", "memory", "of", "tun", "security", "were", "leaked", "-", "use", "after", "free", "since", "the", "flow", "gc", "timer", "was", "not", "deleted", "and", "the", "tfile", "were", "not", "detached", "This", "patch", "solves", "the", "above", "issues.", "Reported-by:", "Wannes", "Rombouts", "<wannes.rombouts@epitech.eu>", "Cc:", "Michael", "S.", "Tsirkin", "<mst@redhat.com>", "Signed-off-by:", "Jason", "Wang", "<jasowang@redhat.com>", "Acked-by:", "Michael", "S.", "Tsirkin", "<mst@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1641", ",", "11", "+", "1641", ",", "11", "@", "@", "static", "int", "tun_set_iff", "(", "struct", "net", "*", "net", ",", "struct", "file", "*", "file", ",", "struct", "ifreq", "*", "ifr", ")", "INIT_LIST_HEAD", "(", "&", "tun", "-", ">", "disabled", ")", ";", "err", "=", "tun_attach", "(", "tun", ",", "file", ",", "false", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "err_free_dev", ";", "goto", "err_free_flow", ";", "err", "=", "register_netdevice", "(", "tun", "-", ">", "dev", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "err_free_dev", ";", "goto", "err_detach", ";", "if", "(", "device_create_file", "(", "&", "tun", "-", ">", "dev", "-", ">", "dev", ",", "&", "dev_attr_tun_flags", ")", "|", "|", "device_create_file", "(", "&", "tun", "-", ">", "dev", "-", ">", "dev", ",", "&", "dev_attr_owner", ")", "|", "|", "@", "@", "-", "1689", ",", "7", "+", "1689", ",", "12", "@", "@", "static", "int", "tun_set_iff", "(", "struct", "net", "*", "net", ",", "struct", "file", "*", "file", ",", "struct", "ifreq", "*", "ifr", ")", "strcpy", "(", "ifr", "-", ">", "ifr_name", ",", "tun", "-", ">", "dev", "-", ">", "name", ")", ";", "return", "0", ";", "err_free_dev", ":", "err_detach", ":", "tun_detach_all", "(", "dev", ")", ";", "err_free_flow", ":", "tun_flow_uninit", "(", "tun", ")", ";", "security_tun_dev_free_security", "(", "tun", "-", ">", "security", ")", ";", "err_free_dev", ":", "free_netdev", "(", "dev", ")", ";", "return", "err", ";", "}"], "docstring_tokens": ["privilege", "escalation"]}
{"contents": ["-", "fix", "bug", "#54061,", "memory", "leak", "in", "openssl_decrypt"], "code_tokens": ["@", "@", "-", "8", ",", "8", "+", "8", ",", "10", "@", "@", "-", "Exif", "extension", ":", ".", "Fixed", "bug", "#", "54002", "(", "crash", "on", "crafted", "tag", ",", "reported", "by", "Luca", "Carettoni", ")", ".", "(", "Pierre", ")", "(", "CVE", "-", "2011", "-", "0708", ")", "-", "OpenSSL", "extension", ":", ".", "Fixed", "bug", "#", "54060", "(", "Memory", "leaks", "when", "openssl_encrypt", ")", ".", "(", "Pierre", ")", ".", "Fixed", "bug", "#", "54061", "(", "Memory", "leaks", "when", "openssl_decrypt", ")", ".", "(", "Pierre", ")", "-", "SPL", "extension", ":", ".", "Fixed", "memory", "leak", "in", "DirectoryIterator", ":", ":", "getExtension", "(", ")", "and", "@", "@", "-", "4804", ",", "6", "+", "4804", ",", "7", "@", "@", "PHP_FUNCTION", "(", "openssl_decrypt", ")", "if", "(", "base64_str", ")", "{", "efree", "(", "base64_str", ")", ";", "}", "EVP_CIPHER_CTX_cleanup", "(", "&", "cipher_ctx", ")", ";", "}", "/", "*", "}", "}}", "*", "/"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["mm:", "Hold", "a", "file", "reference", "in", "madvise_remove", "Otherwise", "the", "code", "races", "with", "munmap", "(causing", "a", "use-after-free", "of", "the", "vma)", "or", "with", "close", "(causing", "a", "use-after-free", "of", "the", "struct", "file).", "The", "bug", "was", "introduced", "by", "commit", "90ed52ebe481", "(\"[PATCH]", "holepunch:", "fix", "mmap_sem", "i_mutex", "deadlock\")", "Cc:", "Hugh", "Dickins", "<hugh@veritas.com>", "Cc:", "Miklos", "Szeredi", "<mszeredi@suse.cz>", "Cc:", "Badari", "Pulavarty", "<pbadari@us.ibm.com>", "Cc:", "Nick", "Piggin", "<npiggin@suse.de>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "15", ",", "6", "+", "15", ",", "7", "@", "@", "#", "include", "<", "linux", "/", "sched", ".", "h", ">", "#", "include", "<", "linux", "/", "ksm", ".", "h", ">", "#", "include", "<", "linux", "/", "fs", ".", "h", ">", "#", "include", "<", "linux", "/", "file", ".", "h", ">", "/", "*", "*", "Any", "behaviour", "which", "results", "in", "changes", "to", "the", "vma", "-", ">", "vm_flags", "needs", "to", "@", "@", "-", "204", ",", "14", "+", "205", ",", "16", "@", "@", "static", "long", "madvise_remove", "(", "struct", "vm_area_struct", "*", "vma", ",", "{", "loff_t", "offset", ";", "int", "error", ";", "struct", "file", "*", "f", ";", "*", "prev", "=", "NULL", ";", "/", "*", "tell", "sys_madvise", "we", "drop", "mmap_sem", "*", "/", "if", "(", "vma", "-", ">", "vm_flags", "&", "(", "VM_LOCKED", "|", "VM_NONLINEAR", "|", "VM_HUGETLB", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "!", "vma", "-", ">", "vm_file", "|", "|", "!", "vma", "-", ">", "vm_file", "-", ">", "f_mapping", "|", "|", "!", "vma", "-", ">", "vm_file", "-", ">", "f_mapping", "-", ">", "host", ")", "{", "f", "=", "vma", "-", ">", "vm_file", ";", "if", "(", "!", "f", "|", "|", "!", "f", "-", ">", "f_mapping", "|", "|", "!", "f", "-", ">", "f_mapping", "-", ">", "host", ")", "{", "return", "-", "EINVAL", ";", "}", "@", "@", "-", "221", ",", "11", "+", "224", ",", "18", "@", "@", "static", "long", "madvise_remove", "(", "struct", "vm_area_struct", "*", "vma", ",", "offset", "=", "(", "loff_t", ")", "(", "start", "-", "vma", "-", ">", "vm_start", ")", "+", "(", "(", "loff_t", ")", "vma", "-", ">", "vm_pgoff", "<", "<", "PAGE_SHIFT", ")", ";", "/", "*", "filesystem", "'", "s", "fallocate", "may", "need", "to", "take", "i_mutex", "*", "/", "/", "*", "*", "Filesystem", "'", "s", "fallocate", "may", "need", "to", "take", "i_mutex", ".", "We", "need", "to", "*", "explicitly", "grab", "a", "reference", "because", "the", "vma", "(", "and", "hence", "the", "*", "vma", "'", "s", "reference", "to", "the", "file", ")", "can", "go", "away", "as", "soon", "as", "we", "drop", "*", "mmap_sem", ".", "*", "/", "get_file", "(", "f", ")", ";", "up_read", "(", "&", "current", "-", ">", "mm", "-", ">", "mmap_sem", ")", ";", "error", "=", "do_fallocate", "(", "vma", "-", ">", "vm_file", ",", "error", "=", "do_fallocate", "(", "f", ",", "FALLOC_FL_PUNCH_HOLE", "|", "FALLOC_FL_KEEP_SIZE", ",", "offset", ",", "end", "-", "start", ")", ";", "fput", "(", "f", ")", ";", "down_read", "(", "&", "current", "-", ">", "mm", "-", ">", "mmap_sem", ")", ";", "return", "error", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(use-after-free", "and", "system", "crash", ")"]}
{"contents": ["batman-adv:", "Calculate", "extra", "tail", "size", "based", "on", "queued", "fragments", "The", "fragmentation", "code", "was", "replaced", "in", "610bfc6bc99bc83680d190ebc69359a05fc7f605", "(\"batman-adv:", "Receive", "fragmented", "packets", "and", "merge\").", "The", "new", "code", "provided", "a", "mostly", "unused", "parameter", "skb", "for", "the", "merging", "function.", "It", "is", "used", "inside", "the", "function", "to", "calculate", "the", "additionally", "needed", "skb", "tailroom.", "But", "instead", "of", "increasing", "its", "own", "tailroom,", "it", "is", "only", "increasing", "the", "tailroom", "of", "the", "first", "queued", "skb.", "This", "is", "not", "correct", "in", "some", "situations", "because", "the", "first", "queued", "entry", "can", "be", "a", "different", "one", "than", "the", "parameter.", "An", "observed", "problem", "was:", "1.", "packet", "with", "size", "104,", "total_size", "1464,", "fragno", "1", "was", "received", "-", "packet", "is", "queued", "2.", "packet", "with", "size", "1400,", "total_size", "1464,", "fragno", "0", "was", "received", "-", "packet", "is", "queued", "at", "the", "end", "of", "the", "list", "3.", "enough", "data", "was", "received", "and", "can", "be", "given", "to", "the", "merge", "function", "(1464", "==", "(1400", "-", "20)", "+", "(104", "-", "20))", "-", "merge", "functions", "gets", "1400", "byte", "large", "packet", "as", "skb", "argument", "4.", "merge", "function", "gets", "first", "entry", "in", "queue", "(104", "byte)", "-", "stored", "as", "skb_out", "5.", "merge", "function", "calculates", "the", "required", "extra", "tail", "as", "total_size", "-", "skb->len", "-", "pskb_expand_head", "tail", "of", "skb_out", "with", "64", "bytes", "6.", "merge", "function", "tries", "to", "squeeze", "the", "extra", "1380", "bytes", "from", "the", "second", "queued", "skb", "(1400", "byte", "aka", "skb", "parameter)", "in", "the", "64", "extra", "tail", "bytes", "of", "skb_out", "Instead", "calculate", "the", "extra", "required", "tail", "bytes", "for", "skb_out", "also", "using", "skb_out", "instead", "of", "using", "the", "parameter", "skb.", "The", "skb", "parameter", "is", "only", "used", "to", "get", "the", "total_size", "from", "the", "last", "received", "packet.", "This", "is", "also", "the", "total_size", "used", "to", "decide", "that", "all", "fragments", "were", "received.", "Reported-by:", "Philipp", "Psurek", "<philipp.psurek@gmail.com>", "Signed-off-by:", "Sven", "Eckelmann", "<sven@narfation.org>", "Acked-by:", "Martin", "Hundeb\u00f8ll", "<martin@hundeboll.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "251", ",", "7", "+", "251", ",", "7", "@", "@", "batadv_frag_merge_packets", "(", "struct", "hlist_head", "*", "chain", ",", "struct", "sk_buff", "*", "skb", ")", "kfree", "(", "entry", ")", ";", "/", "*", "Make", "room", "for", "the", "rest", "of", "the", "fragments", ".", "*", "/", "if", "(", "pskb_expand_head", "(", "skb_out", ",", "0", ",", "size", "-", "skb", "-", ">", "len", ",", "GFP_ATOMIC", ")", "<", "0", ")", "{", "if", "(", "pskb_expand_head", "(", "skb_out", ",", "0", ",", "size", "-", "skb_out", "-", ">", "len", ",", "GFP_ATOMIC", ")", "<", "0", ")", "{", "kfree_skb", "(", "skb_out", ")", ";", "skb_out", "=", "NULL", ";", "goto", "free", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(mesh-node", "system", "crash", ")"]}
