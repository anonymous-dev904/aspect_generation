{"contents": ["cifs:", "ensure", "that", "uncached", "writes", "handle", "unmapped", "areas", "correctly", "It's", "possible", "for", "userland", "to", "pass", "down", "an", "iovec", "via", "writev()", "that", "has", "a", "bogus", "user", "pointer", "in", "it.", "If", "that", "happens", "and", "we're", "doing", "an", "uncached", "write,", "then", "we", "can", "end", "up", "getting", "less", "bytes", "than", "we", "expect", "from", "the", "call", "to", "iov_iter_copy_from_user.", "This", "is", "cifs_iovec_write", "isn't", "set", "up", "to", "handle", "that", "situation", "however.", "It'll", "blindly", "keep", "chugging", "through", "the", "page", "array", "and", "not", "filling", "those", "pages", "with", "anything", "useful.", "Worse", "yet,", "we'll", "later", "end", "up", "with", "a", "negative", "number", "in", "wdata->tailsz,", "which", "will", "confuse", "the", "sending", "routines", "and", "cause", "an", "oops", "at", "the", "very", "least.", "Fix", "this", "by", "having", "the", "copy", "phase", "of", "cifs_iovec_write", "stop", "copying", "data", "in", "this", "situation", "and", "send", "the", "last", "write", "as", "a", "short", "one.", "At", "the", "same", "time,", "we", "want", "to", "avoid", "sending", "a", "zero-length", "write", "to", "the", "server,", "so", "break", "out", "of", "the", "loop", "and", "set", "rc", "to", "-EFAULT", "if", "that", "happens.", "This", "also", "allows", "us", "to", "handle", "the", "case", "where", "no", "address", "in", "the", "iovec", "is", "valid.", "[Note:", "Marking", "this", "for", "stable", "on", "v3.4+", "kernels,", "but", "kernels", "as", "old", "as", "v2.6.38", "may", "have", "a", "similar", "problem", "and", "may", "need", "similar", "fix]", "Cc:", "<stable@vger.kernel.org>", "#", "v3.4+", "Reviewed-by:", "Pavel", "Shilovsky", "<piastry@etersoft.ru>", "Reported-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "Signed-off-by:", "Steve", "French", "<smfrench@gmail.com>"], "code_tokens": ["@", "@", "-", "2389", ",", "7", "+", "2389", ",", "7", "@", "@", "cifs_iovec_write", "(", "struct", "file", "*", "file", ",", "const", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "nr_segs", ",", "loff_t", "*", "poffset", ")", "{", "unsigned", "long", "nr_pages", ",", "i", ";", "size_t", "copied", ",", "len", ",", "cur_len", ";", "size_t", "bytes", ",", "copied", ",", "len", ",", "cur_len", ";", "ssize_t", "total_written", "=", "0", ";", "loff_t", "offset", ";", "struct", "iov_iter", "it", ";", "@", "@", "-", "2444", ",", "14", "+", "2444", ",", "45", "@", "@", "cifs_iovec_write", "(", "struct", "file", "*", "file", ",", "const", "struct", "iovec", "*", "iov", ",", "save_len", "=", "cur_len", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nr_pages", ";", "i", "+", "+)", "{", "copied", "=", "min_t", "(", "const", "size_t", ",", "cur_len", ",", "PAGE_SIZE", ")", ";", "bytes", "=", "min_t", "(", "const", "size_t", ",", "cur_len", ",", "PAGE_SIZE", ")", ";", "copied", "=", "iov_iter_copy_from_user", "(", "wdata", "-", ">", "pages", "[", "i", "]", ",", "&", "it", ",", "0", ",", "copied", ")", ";", "0", ",", "bytes", ")", ";", "cur_len", "-", "=", "copied", ";", "iov_iter_advance", "(", "&", "it", ",", "copied", ")", ";", "/", "*", "*", "If", "we", "didn", "'", "t", "copy", "as", "much", "as", "we", "expected", ",", "then", "that", "*", "may", "mean", "we", "trod", "into", "an", "unmapped", "area", ".", "Stop", "copying", "*", "at", "that", "point", ".", "On", "the", "next", "pass", "through", "the", "big", "*", "loop", ",", "we", "'", "ll", "likely", "end", "up", "getting", "a", "zero", "-", "length", "*", "write", "and", "bailing", "out", "of", "it", ".", "*", "/", "if", "(", "copied", "<", "bytes", ")", "break", ";", "}", "cur_len", "=", "save_len", "-", "cur_len", ";", "/", "*", "*", "If", "we", "have", "no", "data", "to", "send", ",", "then", "that", "probably", "means", "that", "*", "the", "copy", "above", "failed", "altogether", ".", "That", "'", "s", "most", "likely", "because", "*", "the", "address", "in", "the", "iovec", "was", "bogus", ".", "Set", "the", "rc", "to", "-", "EFAULT", ",", "*", "free", "anything", "we", "allocated", "and", "bail", "out", ".", "*", "/", "if", "(", "!", "cur_len", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "nr_pages", ";", "i", "+", "+)", "put_page", "(", "wdata", "-", ">", "pages", "[", "i", "]", ");", "kfree", "(", "wdata", ")", ";", "rc", "=", "-", "EFAULT", ";", "break", ";", "}", "/", "*", "*", "i", "+", "1", "now", "represents", "the", "number", "of", "pages", "we", "actually", "used", "in", "*", "the", "copy", "phase", "above", ".", "Bring", "nr_pages", "down", "to", "that", ",", "and", "free", "*", "any", "pages", "that", "we", "didn", "'", "t", "use", ".", "*", "/", "for", "(", ";", "nr_pages", ">", "i", "+", "1", ";", "nr_pages", "-", "-)", "put_page", "(", "wdata", "-", ">", "pages", "[", "nr_pages", "-", "1", "]", ");", "wdata", "-", ">", "sync_mode", "=", "WB_SYNC_ALL", ";", "wdata", "-", ">", "nr_pages", "=", "nr_pages", ";", "wdata", "-", ">", "offset", "=", "(", "__u64", ")", "offset", ";"], "docstring_tokens": ["adding", "extra", "protection"]}
{"contents": ["libertas:", "potential", "oops", "in", "debugfs", "If", "we", "do", "a", "zero", "size", "allocation", "then", "it", "will", "oops.", "Also", "we", "can't", "be", "sure", "the", "user", "passes", "us", "a", "NUL", "terminated", "string", "so", "I've", "added", "a", "terminator.", "This", "code", "can", "only", "be", "triggered", "by", "root.", "Reported-by:", "Nico", "Golde", "<nico@ngolde.de>", "Reported-by:", "Fabian", "Yamaguchi", "<fabs@goesec.de>", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Acked-by:", "Dan", "Williams", "<dcbw@redhat.com>", "Signed-off-by:", "John", "W.", "Linville", "<linville@tuxdriver.com>"], "code_tokens": ["@", "@", "-", "913", ",", "7", "+", "913", ",", "10", "@", "@", "static", "ssize_t", "lbs_debugfs_write", "(", "struct", "file", "*", "f", ",", "const", "char", "__user", "*", "buf", ",", "char", "*", "p2", ";", "struct", "debug_data", "*", "d", "=", "f", "-", ">", "private_data", ";", "pdata", "=", "kmalloc", "(", "cnt", ",", "GFP_KERNEL", ")", ";", "if", "(", "cnt", "=", "=", "0", ")", "return", "0", ";", "pdata", "=", "kmalloc", "(", "cnt", "+", "1", ",", "GFP_KERNEL", ")", ";", "if", "(", "pdata", "=", "=", "NULL", ")", "return", "0", ";", "@", "@", "-", "922", ",", "6", "+", "925", ",", "7", "@", "@", "static", "ssize_t", "lbs_debugfs_write", "(", "struct", "file", "*", "f", ",", "const", "char", "__user", "*", "buf", ",", "kfree", "(", "pdata", ")", ";", "return", "0", ";", "}", "pdata", "[", "cnt", "]", "=", "'", "\\", "0", "'", ";", "p0", "=", "pdata", ";", "for", "(", "i", "=", "0", ";", "i", "<", "num_of_items", ";", "i", "+", "+)", "{"], "docstring_tokens": ["by", "leveraging", "root", "privileges", "for", "a", "zero-length", "write", "operation", "."]}
{"contents": ["Update", "utfcpp", "to", "v2.3.6", "Fixes", "#2657", "Incorporates", "the", "following", "utfcpp", "patches:", "1.", "Sass", "addition", "of", "`retreat`.", "https://github.com/nemtrif/utfcpp/pull/20", "2.", "Fix", "for", "`replace_invalid`", "throwing", "on", "incomplete", "sequence", "at", "the", "end", "of", "the", "input.", "https://github.com/nemtrif/utfcpp/pull/21"], "code_tokens": ["@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "/", "Copyright", "2006", "Nemanja", "Trifunovic", "/", "/", "Copyright", "2006", "-", "2016", "Nemanja", "Trifunovic", "/", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "or", "organization", "@", "@", "-", "41", ",", "7", "+", "41", ",", "7", "@", "@", "namespace", "utf8", "class", "invalid_code_point", ":", "public", "exception", "{", "uint32_t", "cp", ";", "public", ":", "invalid_code_point", "(", "uint32_t", "cp", ")", ":", "cp", "(", "cp", ")", "{", "}", "invalid_code_point", "(", "uint32_t", "codepoint", ")", ":", "cp", "(", "codepoint", ")", "{", "}", "virtual", "const", "char", "*", "what", "(", ")", "const", "throw", "(", ")", "{", "return", "\"", "Invalid", "code", "point", "\"", ";", "}", "uint32_t", "code_point", "(", ")", "const", "{", "return", "cp", ";", "}", "}", ";", "@", "@", "-", "107", ",", "7", "+", "107", ",", "9", "@", "@", "namespace", "utf8", "*", "out", "+", "+", "=", "*", "it", ";", "break", ";", "case", "internal", ":", ":", "NOT_ENOUGH_ROOM", ":", "throw", "not_enough_room", "(", ");", "out", "=", "utf8", ":", ":", "append", "(", "replacement", ",", "out", ")", ";", "start", "=", "end", ";", "break", ";", "case", "internal", ":", ":", "INVALID_LEAD", ":", "out", "=", "utf8", ":", ":", "append", "(", "replacement", ",", "out", ")", ";", "+", "+", "start", ";", "@", "@", "-", "194", ",", "10", "+", "196", ",", "10", "@", "@", "namespace", "utf8", "}", "template", "<", "typename", "octet_iterator", ",", "typename", "distance_type", ">", "void", "retreat", "(", "octet_iterator", "&", "it", ",", "distance_type", "n", ",", "octet_iterator", "start", ")", "void", "retreat", "(", "octet_iterator", "&", "it", ",", "distance_type", "n", ",", "octet_iterator", "end", ")", "{", "for", "(", "distance_type", "i", "=", "0", ";", "i", "<", "n", ";", "+", "+", "i", ")", "utf8", ":", ":", "prior", "(", "it", ",", "start", ")", ";", "utf8", ":", ":", "prior", "(", "it", ",", "end", ")", ";", "}", "template", "<", "typename", "octet_iterator", ">", "@", "@", "-", "240", ",", "7", "+", "242", ",", "7", "@", "@", "namespace", "utf8", "template", "<", "typename", "u16bit_iterator", ",", "typename", "octet_iterator", ">", "u16bit_iterator", "utf8to16", "(", "octet_iterator", "start", ",", "octet_iterator", "end", ",", "u16bit_iterator", "result", ")", "{", "while", "(", "start", "!", "=", "end", ")", "{", "while", "(", "start", "<", "end", ")", "{", "uint32_t", "cp", "=", "utf8", ":", ":", "next", "(", "start", ",", "end", ")", ";", "if", "(", "cp", ">", "0xffff", ")", "{", "/", "/", "make", "a", "surrogate", "pair", "*", "result", "+", "+", "=", "static_cast", "<", "uint16_t", ">", "((", "cp", ">", ">", "10", ")", "+", "internal", ":", ":", "LEAD_OFFSET", ")", ";", "@", "@", "-", "264", ",", "7", "+", "266", ",", "7", "@", "@", "namespace", "utf8", "template", "<", "typename", "octet_iterator", ",", "typename", "u32bit_iterator", ">", "u32bit_iterator", "utf8to32", "(", "octet_iterator", "start", ",", "octet_iterator", "end", ",", "u32bit_iterator", "result", ")", "{", "while", "(", "start", "!", "=", "end", ")", "while", "(", "start", "<", "end", ")", "(", "*", "result", "+", "+)", "=", "utf8", ":", ":", "next", "(", "start", ",", "end", ")", ";", "return", "result", ";", "@", "@", "-", "279", ",", "9", "+", "281", ",", "9", "@", "@", "namespace", "utf8", "public", ":", "iterator", "(", ")", "{", "}", "explicit", "iterator", "(", "const", "octet_iterator", "&", "octet_it", ",", "const", "octet_iterator", "&", "range_start", ",", "const", "octet_iterator", "&", "range_end", ")", ":", "it", "(", "octet_it", ")", ",", "range_start", "(", "range_start", ")", ",", "range_end", "(", "range_end", ")", "const", "octet_iterator", "&", "rangestart", ",", "const", "octet_iterator", "&", "rangeend", ")", ":", "it", "(", "octet_it", ")", ",", "range_start", "(", "rangestart", ")", ",", "range_end", "(", "rangeend", ")", "{", "if", "(", "it", "<", "range_start", "|", "|", "it", ">", "range_end", ")", "throw", "std", ":", ":", "out_of_range", "(", "\"", "Invalid", "utf", "-", "8", "iterator", "position", "\"", ");", "@", "@", "-", "222", ",", "6", "+", "222", ",", "9", "@", "@", "namespace", "internal", "template", "<", "typename", "octet_iterator", ">", "utf_error", "validate_next", "(", "octet_iterator", "&", "it", ",", "octet_iterator", "end", ",", "uint32_t", "&", "code_point", ")", "{", "if", "(", "it", "=", "=", "end", ")", "return", "NOT_ENOUGH_ROOM", ";", "/", "/", "Save", "the", "original", "value", "of", "it", "so", "we", "can", "go", "back", "in", "case", "of", "failure", "/", "/", "Of", "course", ",", "it", "does", "not", "make", "much", "sense", "with", "i", ".", "e", ".", "stream", "iterators", "octet_iterator", "original_it", "=", "it", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["SOLR-12514:", "Rule-base", "Authorization", "plugin", "skips", "authorization", "if", "querying", "node", "does", "not", "have", "collection", "replica"], "code_tokens": ["@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "public", "void", "tearDownCluster", "(", ")", "throws", "Exception", "{", "@", "Test", "/", "/", "commented", "9", "-", "Aug", "-", "2018", "@", "BadApple", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "12028", "\"", ")", "/", "/", "21", "-", "May", "-", "2018", "/", "/", "@", "BadApple", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "12028", "\"", ")", "/", "/", "annotated", "on", ":", "24", "-", "Dec", "-", "2018", "@", "BadApple", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "12028", "\"", ")", "/", "/", "annotated", "on", ":", "24", "-", "Dec", "-", "2018", "public", "void", "testBasicAuth", "(", ")", "throws", "Exception", "{", "boolean", "isUseV2Api", "=", "random", "(", ").", "nextBoolean", "(", ");", "String", "authcPrefix", "=", "\"", "/", "admin", "/", "authentication", "\"", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["avcodec/utils:", "Check", "close", "before", "calling", "it", "Fixes:", "NULL", "pointer", "dereference", "Fixes:", "15733/clusterfuzz-testcase-minimized-ffmpeg_AV_CODEC_ID_IDF_fuzzer-5658616977162240", "Reviewed-by:", "Paul", "B", "Mahol", "<onemda@gmail.com>", "Found-by:", "continuous", "fuzzing", "process", "https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["@", "@", "-", "1024", ",", "7", "+", "1024", ",", "7", "@", "@", "FF_ENABLE_DEPRECATION_WARNINGS", "return", "ret", ";", "free_and_end", ":", "if", "(", "avctx", "-", ">", "codec", "&", "&", "if", "(", "avctx", "-", ">", "codec", "&", "&", "avctx", "-", ">", "codec", "-", ">", "close", "&", "&", "(", "codec_init_ok", "|", "|", "(", "avctx", "-", ">", "codec", "-", ">", "caps_internal", "&", "FF_CODEC_CAP_INIT_CLEANUP", ")", "))", "avctx", "-", ">", "codec", "-", ">", "close", "(", "avctx", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["tcp:", "implement", "RFC", "5961", "3.2", "Implement", "the", "RFC", "5691", "mitigation", "against", "Blind", "Reset", "attack", "using", "RST", "bit.", "Idea", "is", "to", "validate", "incoming", "RST", "sequence,", "to", "match", "RCV.NXT", "value,", "instead", "of", "previouly", "accepted", "window", ":", "(RCV.NXT", "<=", "SEG.SEQ", "<", "RCV.NXT+RCV.WND)", "If", "sequence", "is", "in", "window", "but", "not", "an", "exact", "match,", "send", "a", "\"challenge", "ACK\",", "so", "that", "the", "other", "part", "can", "resend", "an", "RST", "with", "the", "appropriate", "sequence.", "Add", "a", "new", "sysctl,", "tcp_challenge_ack_limit,", "to", "limit", "number", "of", "challenge", "ACK", "sent", "per", "second.", "Add", "a", "new", "SNMP", "counter", "to", "count", "number", "of", "challenge", "acks", "sent.", "(netstat", "-s", "|", "grep", "TCPChallengeACK)", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Cc:", "Kiran", "Kumar", "Kella", "<kkiran@broadcom.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "565", ",", "6", "+", "565", ",", "11", "@", "@", "tcp_limit_output_bytes", "-", "INTEGER", "reduce", "the", "size", "of", "individual", "GSO", "packet", "(", "64KB", "being", "the", "max", ")", "Default", ":", "131072", "tcp_challenge_ack_limit", "-", "INTEGER", "Limits", "number", "of", "Challenge", "ACK", "sent", "per", "second", ",", "as", "recommended", "in", "RFC", "5961", "(", "Improving", "TCP", "'", "s", "Robustness", "to", "Blind", "In", "-", "Window", "Attacks", ")", "Default", ":", "100", "UDP", "variables", ":", "udp_mem", "-", "vector", "of", "3", "INTEGERs", ":", "min", ",", "pressure", ",", "max", "@", "@", "-", "237", ",", "6", "+", "237", ",", "7", "@", "@", "enum", "LINUX_MIB_TCPOFOQUEUE", ",", "/", "*", "TCPOFOQueue", "*", "/", "LINUX_MIB_TCPOFODROP", ",", "/", "*", "TCPOFODrop", "*", "/", "LINUX_MIB_TCPOFOMERGE", ",", "/", "*", "TCPOFOMerge", "*", "/", "LINUX_MIB_TCPCHALLENGEACK", ",", "/", "*", "TCPChallengeACK", "*", "/", "__LINUX_MIB_MAX", "}", ";", "@", "@", "-", "254", ",", "6", "+", "254", ",", "7", "@", "@", "extern", "int", "sysctl_tcp_thin_linear_timeouts", ";", "extern", "int", "sysctl_tcp_thin_dupack", ";", "extern", "int", "sysctl_tcp_early_retrans", ";", "extern", "int", "sysctl_tcp_limit_output_bytes", ";", "extern", "int", "sysctl_tcp_challenge_ack_limit", ";", "extern", "atomic_long_t", "tcp_memory_allocated", ";", "extern", "struct", "percpu_counter", "tcp_sockets_allocated", ";", "@", "@", "-", "261", ",", "6", "+", "261", ",", "7", "@", "@", "static", "const", "struct", "snmp_mib", "snmp4_net_list", "[", "]", "=", "{", "SNMP_MIB_ITEM", "(", "\"", "TCPOFOQueue", "\"", ",", "LINUX_MIB_TCPOFOQUEUE", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPOFODrop", "\"", ",", "LINUX_MIB_TCPOFODROP", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPOFOMerge", "\"", ",", "LINUX_MIB_TCPOFOMERGE", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPChallengeACK", "\"", ",", "LINUX_MIB_TCPCHALLENGEACK", ")", ",", "SNMP_MIB_SENTINEL", "}", ";", "@", "@", "-", "605", ",", "6", "+", "605", ",", "13", "@", "@", "static", "struct", "ctl_table", "ipv4_table", "[", "]", "=", "{", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec", "}", ",", "{", ".", "procname", "=", "\"", "tcp_challenge_ack_limit", "\"", ",", ".", "data", "=", "&", "sysctl_tcp_challenge_ack_limit", ",", ".", "maxlen", "=", "sizeof", "(", "int", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec", "}", ",", "#", "ifdef", "CONFIG_NET_DMA", "{", ".", "procname", "=", "\"", "tcp_dma_copybreak", "\"", ",", "@", "@", "-", "88", ",", "6", "+", "88", ",", "9", "@", "@", "int", "sysctl_tcp_app_win", "__read_mostly", "=", "31", ";", "int", "sysctl_tcp_adv_win_scale", "__read_mostly", "=", "1", ";", "EXPORT_SYMBOL", "(", "sysctl_tcp_adv_win_scale", ")", ";", "/", "*", "rfc5961", "challenge", "ack", "rate", "limiting", "*", "/", "int", "sysctl_tcp_challenge_ack_limit", "=", "100", ";", "int", "sysctl_tcp_stdurg", "__read_mostly", ";", "int", "sysctl_tcp_rfc1337", "__read_mostly", ";", "int", "sysctl_tcp_max_orphans", "__read_mostly", "=", "NR_FILE", ";", "@", "@", "-", "5247", ",", "6", "+", "5250", ",", "23", "@", "@", "static", "bool", "tcp_dma_try_early_copy", "(", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "skb", ",", "}", "#", "endif", "/", "*", "CONFIG_NET_DMA", "*", "/", "static", "void", "tcp_send_challenge_ack", "(", "struct", "sock", "*", "sk", ")", "{", "/", "*", "unprotected", "vars", ",", "we", "dont", "care", "of", "overwrites", "*", "/", "static", "u32", "challenge_timestamp", ";", "static", "unsigned", "int", "challenge_count", ";", "u32", "now", "=", "jiffies", "/", "HZ", ";", "if", "(", "now", "!", "=", "challenge_timestamp", ")", "{", "challenge_timestamp", "=", "now", ";", "challenge_count", "=", "0", ";", "}", "if", "(", "++", "challenge_count", "<", "=", "sysctl_tcp_challenge_ack_limit", ")", "{", "NET_INC_STATS_BH", "(", "sock_net", "(", "sk", ")", ",", "LINUX_MIB_TCPCHALLENGEACK", ")", ";", "tcp_send_ack", "(", "sk", ")", ";", "}", "}", "/", "*", "Does", "PAWS", "and", "seqno", "based", "validation", "of", "an", "incoming", "segment", ",", "flags", "will", "*", "play", "significant", "role", "here", ".", "*", "/", "@", "@", "-", "5283", ",", "7", "+", "5303", ",", "16", "@", "@", "static", "int", "tcp_validate_incoming", "(", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "skb", ",", "/", "*", "Step", "2", ":", "check", "RST", "bit", "*", "/", "if", "(", "th", "-", ">", "rst", ")", "{", "tcp_reset", "(", "sk", ")", ";", "/", "*", "RFC", "5961", "3", ".", "2", ":", "*", "If", "sequence", "number", "exactly", "matches", "RCV", ".", "NXT", ",", "then", "*", "RESET", "the", "connection", "*", "else", "*", "Send", "a", "challenge", "ACK", "*", "/", "if", "(", "TCP_SKB_CB", "(", "skb", ")", "->", "seq", "=", "=", "tp", "-", ">", "rcv_nxt", ")", "tcp_reset", "(", "sk", ")", ";", "else", "tcp_send_challenge_ack", "(", "sk", ")", ";", "goto", "discard", ";", "}"], "docstring_tokens": ["cover", "every", "sequence", "RANGE", "of", "a", "given", "port", "using", "a", "given", "window", "size"]}
{"contents": ["sparc64:", "Fix", "crash", "with", "/proc/iomem", "When", "you", "compile", "kernel", "on", "Sparc64", "with", "heap", "memory", "checking", "and", "type", "\"cat", "/proc/iomem\",", "you", "get", "a", "crash,", "because", "pointers", "in", "struct", "resource", "are", "uninitialized.", "Most", "code", "fills", "struct", "resource", "with", "zeros,", "so", "I", "assume", "that", "it", "is", "responsibility", "of", "the", "caller", "of", "request_resource", "to", "initialized", "it,", "not", "the", "responsibility", "of", "request_resource", "functuion.", "After", "2.6.29", "is", "out,", "there", "could", "be", "a", "check", "for", "uninitialized", "fields", "added", "to", "request_resource", "to", "avoid", "crashes", "like", "this.", "Signed-off-by:", "Mikulas", "Patocka", "<mpatocka@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "368", ",", "7", "+", "368", ",", "7", "@", "@", "static", "void", "pci_register_iommu_region", "(", "struct", "pci_pbm_info", "*", "pbm", ")", "const", "u32", "*", "vdma", "=", "of_get_property", "(", "pbm", "-", ">", "op", "-", ">", "node", ",", "\"", "virtual", "-", "dma", "\"", ",", "NULL", ")", ";", "if", "(", "vdma", ")", "{", "struct", "resource", "*", "rp", "=", "kmalloc", "(", "sizeof", "(", "*", "rp", ")", ",", "GFP_KERNEL", ")", ";", "struct", "resource", "*", "rp", "=", "kzalloc", "(", "sizeof", "(", "*", "rp", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "rp", ")", "{", "prom_printf", "(", "\"", "Cannot", "allocate", "IOMMU", "resource", ".", "\\", "n", "\"", ");"], "docstring_tokens": ["related", "to", "uninitialized", "pointers", "and", "the", "request_resource", "function", "."]}
{"contents": ["Security:", "prevent", "Rhinos", "access", "to", "Java", "resources;", "e.g.", "call", "java", "methods"], "code_tokens": ["@", "@", "-", "8", ",", "6", "+", "8", ",", "9", "@", "@", "<", "body", ">", "<", "release", "version", "=", "\"", "2", ".", "37", ".", "0", "\"", "date", "=", "\"", "xxxx", ",", "2020", "\"", "description", "=", "\"", "Bugfixes", ",", "CHROME", "79", ",", "FF52", "removed", ",", "FF68", "added", "\"", ">", "<", "action", "type", "=", "\"", "fix", "\"", "dev", "=", "\"", "rbri", "\"", ">", "Security", ":", "prevent", "Rhinos", "access", "to", "Java", "resources", ";", "e", ".", "g", ".", "call", "java", "methods", ".", "<", "/", "action", ">", "<", "action", "type", "=", "\"", "update", "\"", "dev", "=", "\"", "rbri", "\"", ">", "Upgrade", "Apache", "HttpComponents", "to", "4", ".", "5", ".", "11", ".", "<", "/", "action", ">", "@", "@", "-", "16", ",", "6", "+", "16", ",", "8", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "openqa", ".", "selenium", ".", "By", ";", "@", "@", "-", "891", ",", "4", "+", "893", ",", "52", "@", "@", "public", "void", "ctorBooleanDocumentAll", "(", ")", "throws", "Exception", "{", "loadPageWithAlerts2", "(", "html", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "if", "the", "test", "fails", "*", "/", "@", "Test", "@", "Alerts", "(", "\"", "exception", "\"", ")", "public", "void", "javaNotAccessable", "(", ")", "throws", "Exception", "{", "final", "String", "html", "=", "\"", "<", "html", ">", "<", "head", ">", "\\", "n", "\"", "+", "\"", "<", "script", ">", "\\", "n", "\"", "+", "\"", "function", "test", "(", ")", "{", "\\", "n", "\"", "+", "\"", "try", "{", "\\", "n", "\"", "+", "\"", "alert", "(", "java", ".", "lang", ".", "Math", ".", "PI", ")", ";\\", "n", "\"", "+", "\"", "}", "catch", "(", "e", ")", "{", "alert", "(", "'", "exception", "'", ");", "}", "\\", "n", "\"", "+", "\"", "}\\", "n", "\"", "+", "\"", "</", "script", ">", "\\", "n", "\"", "+", "\"", "</", "head", ">", "\\", "n", "\"", "+", "\"", "<", "body", "onload", "=", "'", "test", "(", ")'", ">\\", "n", "\"", "+", "\"", "</", "body", ">", "</", "html", ">", "\";", "loadPageWithAlerts2", "(", "html", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "if", "the", "test", "fails", "*", "/", "@", "Test", "@", "Alerts", "(", "\"", "Received", ":", "from", "worker", "-", "exception", "\"", ")", "public", "void", "javaNotAccessableFromWorker", "(", ")", "throws", "Exception", "{", "final", "String", "html", "=", "\"", "<", "html", ">", "<", "body", ">", "\\", "n", "\"", "+", "\"", "<", "script", "async", ">", "\\", "n", "\"", "+", "\"", "try", "{", "\\", "n", "\"", "+", "\"", "var", "myWorker", "=", "new", "Worker", "(", "'", "worker", ".", "js", "'", ");", "\\", "n", "\"", "+", "\"", "myWorker", ".", "onmessage", "=", "function", "(", "e", ")", "{", "\\", "n", "\"", "+", "\"", "alert", "(", "'", "Received", ":", "'", "+", "e", ".", "data", ")", ";\\", "n", "\"", "+", "\"", "}", ";\\", "n", "\"", "+", "\"", "}", "catch", "(", "e", ")", "{", "alert", "(", "'", "exception", "'", "+", "e", ")", ";", "}", "\\", "n", "\"", "+", "\"", "</", "script", ">", "</", "body", ">", "</", "html", ">", "\\", "n", "\"", ";", "final", "String", "workerJs", "=", "\"", "var", "pi", "=", "'", "from", "worker", "'", ";\\", "n", "\"", "+", "\"", "try", "{", "\\", "n", "\"", "+", "\"", "pi", "=", "pi", "+", "'", "-", "'", "+", "java", ".", "lang", ".", "Math", ".", "PI", "\\", "n", "\"", "+", "\"", "}", "catch", "(", "e", ")", "{", "pi", "=", "pi", "+", "'", "-", "'", "+", "'", "exception", "'", ";", "}", "\\", "n", "\"", "+", "\"", "postMessage", "(", "pi", ")", ";\\", "n", "\"", ";", "getMockWebConnection", "(", ").", "setResponse", "(", "new", "URL", "(", "URL_FIRST", ",", "\"", "worker", ".", "js", "\"", "),", "workerJs", ")", ";", "loadPageWithAlerts2", "(", "html", ",", "2000", ")", ";", "}", "}"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request"]}
{"contents": ["drm:", "block", "userspace", "under", "allocating", "buffer", "and", "having", "drivers", "overwrite", "it", "(v2)", "With", "the", "current", "screwed", "but", "its", "ABI,", "ioctls", "for", "the", "drm,", "Linus", "pointed", "out", "that", "we", "could", "allow", "userspace", "to", "specify", "the", "allocation", "size,", "but", "we", "pass", "it", "to", "the", "driver", "which", "then", "uses", "it", "blindly", "to", "store", "a", "struct.", "Now", "if", "userspace", "specifies", "the", "allocation", "size", "as", "smaller", "than", "the", "driver", "needs,", "the", "driver", "can", "possibly", "overwrite", "memory.", "This", "patch", "restructures", "the", "driver", "ioctls", "so", "we", "store", "the", "structure", "size", "we", "are", "expecting,", "and", "make", "sure", "we", "allocate", "at", "least", "that", "size.", "The", "copy", "from/to", "userspace", "are", "still", "restricted", "to", "the", "size", "the", "user", "specifies,", "this", "allows", "ioctl", "structs", "to", "grow", "on", "both", "sides", "of", "the", "equation.", "Up", "until", "now", "we", "didn't", "really", "use", "the", "DRM_IOCTL", "defines", "in", "the", "kernel,", "so", "this", "cleans", "them", "up", "and", "adds", "them", "for", "nouveau.", "v2:", "fix", "nouveau", "pushbuf", "arg", "(thanks", "to", "Ben", "for", "pointing", "it", "out)", "Reported-by:", "Linus", "Torvalds", "<torvalds@linuxfoundation.org>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["@", "@", "-", "55", ",", "6", "+", "55", ",", "9", "@", "@", "static", "int", "drm_version", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "struct", "drm_file", "*", "file_priv", ")", ";", "#", "define", "DRM_IOCTL_DEF", "(", "ioctl", ",", "_func", ",", "_flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "ioctl", ")", "]", "=", "{", ".", "cmd", "=", "ioctl", ",", ".", "func", "=", "_func", ",", ".", "flags", "=", "_flags", ",", ".", "cmd_drv", "=", "0", "}", "/", "**", "Ioctl", "table", "*", "/", "static", "struct", "drm_ioctl_desc", "drm_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_IOCTL_VERSION", ",", "drm_version", ",", "0", ")", ",", "@", "@", "-", "421", ",", "6", "+", "424", ",", "7", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "int", "retcode", "=", "-", "EINVAL", ";", "char", "stack_kdata", "[", "128", "]", ";", "char", "*", "kdata", "=", "NULL", ";", "unsigned", "int", "usize", ",", "asize", ";", "dev", "=", "file_priv", "-", ">", "minor", "-", ">", "dev", ";", "atomic_inc", "(", "&", "dev", "-", ">", "ioctl_count", ")", ";", "@", "@", "-", "436", ",", "11", "+", "440", ",", "18", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "(", "(", "nr", "<", "DRM_COMMAND_BASE", ")", "|", "|", "(", "nr", ">", "=", "DRM_COMMAND_END", ")", "))", "goto", "err_i1", ";", "if", "(", "(", "nr", ">", "=", "DRM_COMMAND_BASE", ")", "&", "&", "(", "nr", "<", "DRM_COMMAND_END", ")", "&", "&", "(", "nr", "<", "DRM_COMMAND_BASE", "+", "dev", "-", ">", "driver", "-", ">", "num_ioctls", ")", ")", "(", "nr", "<", "DRM_COMMAND_BASE", "+", "dev", "-", ">", "driver", "-", ">", "num_ioctls", ")", ")", "{", "u32", "drv_size", ";", "ioctl", "=", "&", "dev", "-", ">", "driver", "-", ">", "ioctls", "[", "nr", "-", "DRM_COMMAND_BASE", "]", ";", "drv_size", "=", "_IOC_SIZE", "(", "ioctl", "-", ">", "cmd_drv", ")", ";", "usize", "=", "asize", "=", "_IOC_SIZE", "(", "cmd", ")", ";", "if", "(", "drv_size", ">", "asize", ")", "asize", "=", "drv_size", ";", "}", "else", "if", "(", "(", "nr", ">", "=", "DRM_COMMAND_END", ")", "|", "|", "(", "nr", "<", "DRM_COMMAND_BASE", ")", ")", "{", "ioctl", "=", "&", "drm_ioctls", "[", "nr", "]", ";", "cmd", "=", "ioctl", "-", ">", "cmd", ";", "usize", "=", "asize", "=", "_IOC_SIZE", "(", "cmd", ")", ";", "}", "else", "goto", "err_i1", ";", "@", "@", "-", "460", ",", "10", "+", "471", ",", "10", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "retcode", "=", "-", "EACCES", ";", "}", "else", "{", "if", "(", "cmd", "&", "(", "IOC_IN", "|", "IOC_OUT", ")", ")", "{", "if", "(", "_IOC_SIZE", "(", "cmd", ")", "<", "=", "sizeof", "(", "stack_kdata", ")", ")", "{", "if", "(", "asize", "<", "=", "sizeof", "(", "stack_kdata", ")", ")", "{", "kdata", "=", "stack_kdata", ";", "}", "else", "{", "kdata", "=", "kmalloc", "(", "_IOC_SIZE", "(", "cmd", ")", ",", "GFP_KERNEL", ")", ";", "kdata", "=", "kmalloc", "(", "asize", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "kdata", ")", "{", "retcode", "=", "-", "ENOMEM", ";", "goto", "err_i1", ";", "@", "@", "-", "473", ",", "12", "+", "484", ",", "12", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "if", "(", "cmd", "&", "IOC_IN", ")", "{", "if", "(", "copy_from_user", "(", "kdata", ",", "(", "void", "__user", "*", ")", "arg", ",", "_IOC_SIZE", "(", "cmd", ")", ")", "!", "=", "0", ")", "{", "usize", ")", "!", "=", "0", ")", "{", "retcode", "=", "-", "EFAULT", ";", "goto", "err_i1", ";", "}", "}", "else", "memset", "(", "kdata", ",", "0", ",", "_IOC_SIZE", "(", "cmd", ")", ");", "memset", "(", "kdata", ",", "0", ",", "usize", ")", ";", "if", "(", "ioctl", "-", ">", "flags", "&", "DRM_UNLOCKED", ")", "retcode", "=", "func", "(", "dev", ",", "kdata", ",", "file_priv", ")", ";", "@", "@", "-", "490", ",", "7", "+", "501", ",", "7", "@", "@", "long", "drm_ioctl", "(", "struct", "file", "*", "filp", ",", "if", "(", "cmd", "&", "IOC_OUT", ")", "{", "if", "(", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "kdata", ",", "_IOC_SIZE", "(", "cmd", ")", ")", "!", "=", "0", ")", "usize", ")", "!", "=", "0", ")", "retcode", "=", "-", "EFAULT", ";", "}", "}", "@", "@", "-", "1255", ",", "21", "+", "1255", ",", "21", "@", "@", "long", "i810_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "}", "struct", "drm_ioctl_desc", "i810_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_I810_INIT", ",", "i810_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_VERTEX", ",", "i810_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_CLEAR", ",", "i810_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_FLUSH", ",", "i810_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_GETAGE", ",", "i810_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_GETBUF", ",", "i810_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_SWAP", ",", "i810_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_COPY", ",", "i810_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_DOCOPY", ",", "i810_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_OV0INFO", ",", "i810_ov0_info", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_FSTATUS", ",", "i810_fstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_OV0FLIP", ",", "i810_ov0_flip", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_MC", ",", "i810_dma_mc", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_RSTATUS", ",", "i810_rstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I810_FLIP", ",", "i810_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_INIT", ",", "i810_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_VERTEX", ",", "i810_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_CLEAR", ",", "i810_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_FLUSH", ",", "i810_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_GETAGE", ",", "i810_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_GETBUF", ",", "i810_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_SWAP", ",", "i810_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_COPY", ",", "i810_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_DOCOPY", ",", "i810_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_OV0INFO", ",", "i810_ov0_info", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_FSTATUS", ",", "i810_fstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_OV0FLIP", ",", "i810_ov0_flip", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_MC", ",", "i810_dma_mc", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_RSTATUS", ",", "i810_rstatus", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I810_FLIP", ",", "i810_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "i810_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "i810_ioctls", ")", ";", "@", "@", "-", "1524", ",", "20", "+", "1524", ",", "20", "@", "@", "long", "i830_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "}", "struct", "drm_ioctl_desc", "i830_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_I830_INIT", ",", "i830_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_VERTEX", ",", "i830_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_CLEAR", ",", "i830_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_FLUSH", ",", "i830_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_GETAGE", ",", "i830_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_GETBUF", ",", "i830_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_SWAP", ",", "i830_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_COPY", ",", "i830_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_DOCOPY", ",", "i830_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_FLIP", ",", "i830_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_IRQ_EMIT", ",", "i830_irq_emit", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_IRQ_WAIT", ",", "i830_irq_wait", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_GETPARAM", ",", "i830_getparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I830_SETPARAM", ",", "i830_setparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_INIT", ",", "i830_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_VERTEX", ",", "i830_dma_vertex", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_CLEAR", ",", "i830_clear_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_FLUSH", ",", "i830_flush_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_GETAGE", ",", "i830_getage", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_GETBUF", ",", "i830_getbuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_SWAP", ",", "i830_swap_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_COPY", ",", "i830_copybuf", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_DOCOPY", ",", "i830_docopy", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_FLIP", ",", "i830_flip_bufs", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_IRQ_EMIT", ",", "i830_irq_emit", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_IRQ_WAIT", ",", "i830_irq_wait", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_GETPARAM", ",", "i830_getparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I830_SETPARAM", ",", "i830_setparam", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "i830_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "i830_ioctls", ")", ";", "@", "@", "-", "2360", ",", "46", "+", "2360", ",", "46", "@", "@", "void", "i915_driver_postclose", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "i915_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_I915_INIT", ",", "i915_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_FLUSH", ",", "i915_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_FLIP", ",", "i915_flip_bufs", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_BATCHBUFFER", ",", "i915_batchbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_IRQ_EMIT", ",", "i915_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_IRQ_WAIT", ",", "i915_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GETPARAM", ",", "i915_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_SETPARAM", ",", "i915_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_ALLOC", ",", "i915_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_FREE", ",", "i915_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_INIT_HEAP", ",", "i915_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_CMDBUFFER", ",", "i915_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_DESTROY_HEAP", ",", "i915_mem_destroy_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_SET_VBLANK_PIPE", ",", "i915_vblank_pipe_set", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GET_VBLANK_PIPE", ",", "i915_vblank_pipe_get", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_VBLANK_SWAP", ",", "i915_vblank_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_HWS_ADDR", ",", "i915_set_status_page", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_INIT", ",", "i915_gem_init_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_EXECBUFFER", ",", "i915_gem_execbuffer", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_EXECBUFFER2", ",", "i915_gem_execbuffer2", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_PIN", ",", "i915_gem_pin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_UNPIN", ",", "i915_gem_unpin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_BUSY", ",", "i915_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_THROTTLE", ",", "i915_gem_throttle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_ENTERVT", ",", "i915_gem_entervt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_LEAVEVT", ",", "i915_gem_leavevt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_CREATE", ",", "i915_gem_create_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_PREAD", ",", "i915_gem_pread_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_PWRITE", ",", "i915_gem_pwrite_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_MMAP", ",", "i915_gem_mmap_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_MMAP_GTT", ",", "i915_gem_mmap_gtt_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_SET_DOMAIN", ",", "i915_gem_set_domain_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_SW_FINISH", ",", "i915_gem_sw_finish_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_SET_TILING", ",", "i915_gem_set_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_GET_TILING", ",", "i915_gem_get_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_GET_APERTURE", ",", "i915_gem_get_aperture_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GET_PIPE_FROM_CRTC_ID", ",", "intel_get_pipe_from_crtc_id", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_GEM_MADVISE", ",", "i915_gem_madvise_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_OVERLAY_PUT_IMAGE", ",", "intel_overlay_put_image", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_I915_OVERLAY_ATTRS", ",", "intel_overlay_attrs", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_INIT", ",", "i915_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_FLUSH", ",", "i915_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_FLIP", ",", "i915_flip_bufs", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_BATCHBUFFER", ",", "i915_batchbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_IRQ_EMIT", ",", "i915_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_IRQ_WAIT", ",", "i915_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GETPARAM", ",", "i915_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_SETPARAM", ",", "i915_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_ALLOC", ",", "i915_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_FREE", ",", "i915_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_INIT_HEAP", ",", "i915_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_CMDBUFFER", ",", "i915_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_DESTROY_HEAP", ",", "i915_mem_destroy_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_SET_VBLANK_PIPE", ",", "i915_vblank_pipe_set", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GET_VBLANK_PIPE", ",", "i915_vblank_pipe_get", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_VBLANK_SWAP", ",", "i915_vblank_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_HWS_ADDR", ",", "i915_set_status_page", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_INIT", ",", "i915_gem_init_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_EXECBUFFER", ",", "i915_gem_execbuffer", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_EXECBUFFER2", ",", "i915_gem_execbuffer2", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_PIN", ",", "i915_gem_pin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_UNPIN", ",", "i915_gem_unpin_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_BUSY", ",", "i915_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_THROTTLE", ",", "i915_gem_throttle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_ENTERVT", ",", "i915_gem_entervt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_LEAVEVT", ",", "i915_gem_leavevt_ioctl", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_CREATE", ",", "i915_gem_create_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_PREAD", ",", "i915_gem_pread_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_PWRITE", ",", "i915_gem_pwrite_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_MMAP", ",", "i915_gem_mmap_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_MMAP_GTT", ",", "i915_gem_mmap_gtt_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_SET_DOMAIN", ",", "i915_gem_set_domain_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_SW_FINISH", ",", "i915_gem_sw_finish_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_SET_TILING", ",", "i915_gem_set_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_GET_TILING", ",", "i915_gem_get_tiling", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_GET_APERTURE", ",", "i915_gem_get_aperture_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GET_PIPE_FROM_CRTC_ID", ",", "intel_get_pipe_from_crtc_id", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_GEM_MADVISE", ",", "i915_gem_madvise_ioctl", ",", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_OVERLAY_PUT_IMAGE", ",", "intel_overlay_put_image", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "I915_OVERLAY_ATTRS", ",", "intel_overlay_attrs", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "i915_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "i915_ioctls", ")", ";", "@", "@", "-", "1085", ",", "19", "+", "1085", ",", "19", "@", "@", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "mga_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_MGA_INIT", ",", "mga_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_FLUSH", ",", "mga_dma_flush", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_RESET", ",", "mga_dma_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_SWAP", ",", "mga_dma_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_CLEAR", ",", "mga_dma_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_VERTEX", ",", "mga_dma_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_INDICES", ",", "mga_dma_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_ILOAD", ",", "mga_dma_iload", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_BLIT", ",", "mga_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_GETPARAM", ",", "mga_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_SET_FENCE", ",", "mga_set_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_WAIT_FENCE", ",", "mga_wait_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_MGA_DMA_BOOTSTRAP", ",", "mga_dma_bootstrap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_INIT", ",", "mga_dma_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_FLUSH", ",", "mga_dma_flush", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_RESET", ",", "mga_dma_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_SWAP", ",", "mga_dma_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_CLEAR", ",", "mga_dma_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_VERTEX", ",", "mga_dma_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_INDICES", ",", "mga_dma_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_ILOAD", ",", "mga_dma_iload", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_BLIT", ",", "mga_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_GETPARAM", ",", "mga_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_SET_FENCE", ",", "mga_set_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_WAIT_FENCE", ",", "mga_wait_fence", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "MGA_DMA_BOOTSTRAP", ",", "mga_dma_bootstrap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "}", ";", "int", "mga_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "mga_ioctls", ")", ";", "@", "@", "-", "426", ",", "18", "+", "426", ",", "18", "@", "@", "nouveau_ioctl_fifo_free", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "struct", "drm_ioctl_desc", "nouveau_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GETPARAM", ",", "nouveau_ioctl_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_SETPARAM", ",", "nouveau_ioctl_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_CHANNEL_ALLOC", ",", "nouveau_ioctl_fifo_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_CHANNEL_FREE", ",", "nouveau_ioctl_fifo_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GROBJ_ALLOC", ",", "nouveau_ioctl_grobj_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_NOTIFIEROBJ_ALLOC", ",", "nouveau_ioctl_notifier_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GPUOBJ_FREE", ",", "nouveau_ioctl_gpuobj_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_NEW", ",", "nouveau_gem_ioctl_new", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_PUSHBUF", ",", "nouveau_gem_ioctl_pushbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_CPU_PREP", ",", "nouveau_gem_ioctl_cpu_prep", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_CPU_FINI", ",", "nouveau_gem_ioctl_cpu_fini", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_NOUVEAU_GEM_INFO", ",", "nouveau_gem_ioctl_info", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GETPARAM", ",", "nouveau_ioctl_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_SETPARAM", ",", "nouveau_ioctl_setparam", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_CHANNEL_ALLOC", ",", "nouveau_ioctl_fifo_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_CHANNEL_FREE", ",", "nouveau_ioctl_fifo_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GROBJ_ALLOC", ",", "nouveau_ioctl_grobj_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_NOTIFIEROBJ_ALLOC", ",", "nouveau_ioctl_notifier_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GPUOBJ_FREE", ",", "nouveau_ioctl_gpuobj_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_NEW", ",", "nouveau_gem_ioctl_new", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_PUSHBUF", ",", "nouveau_gem_ioctl_pushbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_CPU_PREP", ",", "nouveau_gem_ioctl_cpu_prep", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_CPU_FINI", ",", "nouveau_gem_ioctl_cpu_fini", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "NOUVEAU_GEM_INFO", ",", "nouveau_gem_ioctl_info", ",", "DRM_AUTH", ")", ",", "}", ";", "int", "nouveau_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "nouveau_ioctls", ")", ";", "@", "@", "-", "1639", ",", "30", "+", "1639", ",", "29", "@", "@", "void", "r128_driver_preclose", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "r128_do_cleanup_pageflip", "(", "dev", ")", ";", "}", "}", "void", "r128_driver_lastclose", "(", "struct", "drm_device", "*", "dev", ")", "{", "r128_do_cleanup_cce", "(", "dev", ")", ";", "}", "struct", "drm_ioctl_desc", "r128_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_R128_INIT", ",", "r128_cce_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_START", ",", "r128_cce_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_STOP", ",", "r128_cce_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_RESET", ",", "r128_cce_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CCE_IDLE", ",", "r128_cce_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_RESET", ",", "r128_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_FULLSCREEN", ",", "r128_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_SWAP", ",", "r128_cce_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_FLIP", ",", "r128_cce_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_CLEAR", ",", "r128_cce_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_VERTEX", ",", "r128_cce_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_INDICES", ",", "r128_cce_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_BLIT", ",", "r128_cce_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_DEPTH", ",", "r128_cce_depth", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_STIPPLE", ",", "r128_cce_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_INDIRECT", ",", "r128_cce_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_R128_GETPARAM", ",", "r128_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_INIT", ",", "r128_cce_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_START", ",", "r128_cce_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_STOP", ",", "r128_cce_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_RESET", ",", "r128_cce_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CCE_IDLE", ",", "r128_cce_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_RESET", ",", "r128_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_FULLSCREEN", ",", "r128_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_SWAP", ",", "r128_cce_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_FLIP", ",", "r128_cce_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_CLEAR", ",", "r128_cce_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_VERTEX", ",", "r128_cce_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_INDICES", ",", "r128_cce_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_BLIT", ",", "r128_cce_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_DEPTH", ",", "r128_cce_depth", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_STIPPLE", ",", "r128_cce_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_INDIRECT", ",", "r128_cce_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "R128_GETPARAM", ",", "r128_getparam", ",", "DRM_AUTH", ")", ",", "}", ";", "int", "r128_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "r128_ioctls", ")", ";", "@", "@", "-", "323", ",", "45", "+", "323", ",", "45", "@", "@", "KMS_INVALID_IOCTL", "(", "radeon_surface_free_kms", ")", "struct", "drm_ioctl_desc", "radeon_ioctls_kms", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_INIT", ",", "radeon_cp_init_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_START", ",", "radeon_cp_start_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_STOP", ",", "radeon_cp_stop_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESET", ",", "radeon_cp_reset_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_IDLE", ",", "radeon_cp_idle_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESUME", ",", "radeon_cp_resume_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_RESET", ",", "radeon_engine_reset_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FULLSCREEN", ",", "radeon_fullscreen_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SWAP", ",", "radeon_cp_swap_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CLEAR", ",", "radeon_cp_clear_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX", ",", "radeon_cp_vertex_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDICES", ",", "radeon_cp_indices_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_TEXTURE", ",", "radeon_cp_texture_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_STIPPLE", ",", "radeon_cp_stipple_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDIRECT", ",", "radeon_cp_indirect_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX2", ",", "radeon_cp_vertex2_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CMDBUF", ",", "radeon_cp_cmdbuf_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GETPARAM", ",", "radeon_cp_getparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FLIP", ",", "radeon_cp_flip_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_ALLOC", ",", "radeon_mem_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FREE", ",", "radeon_mem_free_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INIT_HEAP", ",", "radeon_mem_init_heap_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_EMIT", ",", "radeon_irq_emit_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_WAIT", ",", "radeon_irq_wait_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SETPARAM", ",", "radeon_cp_setparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_ALLOC", ",", "radeon_surface_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_FREE", ",", "radeon_surface_free_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_INIT", ",", "radeon_cp_init_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_START", ",", "radeon_cp_start_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_STOP", ",", "radeon_cp_stop_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESET", ",", "radeon_cp_reset_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_IDLE", ",", "radeon_cp_idle_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESUME", ",", "radeon_cp_resume_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_RESET", ",", "radeon_engine_reset_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FULLSCREEN", ",", "radeon_fullscreen_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SWAP", ",", "radeon_cp_swap_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CLEAR", ",", "radeon_cp_clear_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX", ",", "radeon_cp_vertex_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDICES", ",", "radeon_cp_indices_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_TEXTURE", ",", "radeon_cp_texture_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_STIPPLE", ",", "radeon_cp_stipple_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDIRECT", ",", "radeon_cp_indirect_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX2", ",", "radeon_cp_vertex2_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CMDBUF", ",", "radeon_cp_cmdbuf_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GETPARAM", ",", "radeon_cp_getparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FLIP", ",", "radeon_cp_flip_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_ALLOC", ",", "radeon_mem_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FREE", ",", "radeon_mem_free_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INIT_HEAP", ",", "radeon_mem_init_heap_kms", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_EMIT", ",", "radeon_irq_emit_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_WAIT", ",", "radeon_irq_wait_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SETPARAM", ",", "radeon_cp_setparam_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_ALLOC", ",", "radeon_surface_alloc_kms", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_FREE", ",", "radeon_surface_free_kms", ",", "DRM_AUTH", ")", ",", "/", "*", "KMS", "*", "/", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_INFO", ",", "radeon_gem_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_CREATE", ",", "radeon_gem_create_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_MMAP", ",", "radeon_gem_mmap_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_SET_DOMAIN", ",", "radeon_gem_set_domain_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_PREAD", ",", "radeon_gem_pread_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_PWRITE", ",", "radeon_gem_pwrite_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_WAIT_IDLE", ",", "radeon_gem_wait_idle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CS", ",", "radeon_cs_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INFO", ",", "radeon_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_SET_TILING", ",", "radeon_gem_set_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_GET_TILING", ",", "radeon_gem_get_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GEM_BUSY", ",", "radeon_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_INFO", ",", "radeon_gem_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_CREATE", ",", "radeon_gem_create_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_MMAP", ",", "radeon_gem_mmap_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_SET_DOMAIN", ",", "radeon_gem_set_domain_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_PREAD", ",", "radeon_gem_pread_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_PWRITE", ",", "radeon_gem_pwrite_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_WAIT_IDLE", ",", "radeon_gem_wait_idle_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CS", ",", "radeon_cs_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INFO", ",", "radeon_info_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_SET_TILING", ",", "radeon_gem_set_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_GET_TILING", ",", "radeon_gem_get_tiling_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GEM_BUSY", ",", "radeon_gem_busy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "}", ";", "int", "radeon_max_kms_ioctl", "=", "DRM_ARRAY_SIZE", "(", "radeon_ioctls_kms", ")", ";", "@", "@", "-", "3228", ",", "34", "+", "3228", ",", "34", "@", "@", "void", "radeon_driver_postclose", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "radeon_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_INIT", ",", "radeon_cp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_START", ",", "radeon_cp_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_STOP", ",", "radeon_cp_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESET", ",", "radeon_cp_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_IDLE", ",", "radeon_cp_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CP_RESUME", ",", "radeon_cp_resume", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_RESET", ",", "radeon_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FULLSCREEN", ",", "radeon_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SWAP", ",", "radeon_cp_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CLEAR", ",", "radeon_cp_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX", ",", "radeon_cp_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDICES", ",", "radeon_cp_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_TEXTURE", ",", "radeon_cp_texture", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_STIPPLE", ",", "radeon_cp_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INDIRECT", ",", "radeon_cp_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_VERTEX2", ",", "radeon_cp_vertex2", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CMDBUF", ",", "radeon_cp_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_GETPARAM", ",", "radeon_cp_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FLIP", ",", "radeon_cp_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_ALLOC", ",", "radeon_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_FREE", ",", "radeon_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_INIT_HEAP", ",", "radeon_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_EMIT", ",", "radeon_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_IRQ_WAIT", ",", "radeon_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SETPARAM", ",", "radeon_cp_setparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_ALLOC", ",", "radeon_surface_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_SURF_FREE", ",", "radeon_surface_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_RADEON_CS", ",", "r600_cs_legacy_ioctl", ",", "DRM_AUTH", ")", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_INIT", ",", "radeon_cp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_START", ",", "radeon_cp_start", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_STOP", ",", "radeon_cp_stop", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESET", ",", "radeon_cp_reset", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_IDLE", ",", "radeon_cp_idle", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CP_RESUME", ",", "radeon_cp_resume", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_RESET", ",", "radeon_engine_reset", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FULLSCREEN", ",", "radeon_fullscreen", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SWAP", ",", "radeon_cp_swap", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CLEAR", ",", "radeon_cp_clear", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX", ",", "radeon_cp_vertex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDICES", ",", "radeon_cp_indices", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_TEXTURE", ",", "radeon_cp_texture", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_STIPPLE", ",", "radeon_cp_stipple", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INDIRECT", ",", "radeon_cp_indirect", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_VERTEX2", ",", "radeon_cp_vertex2", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CMDBUF", ",", "radeon_cp_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_GETPARAM", ",", "radeon_cp_getparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FLIP", ",", "radeon_cp_flip", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_ALLOC", ",", "radeon_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_FREE", ",", "radeon_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_INIT_HEAP", ",", "radeon_mem_init_heap", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_EMIT", ",", "radeon_irq_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_IRQ_WAIT", ",", "radeon_irq_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SETPARAM", ",", "radeon_cp_setparam", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_ALLOC", ",", "radeon_surface_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_SURF_FREE", ",", "radeon_surface_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "RADEON_CS", ",", "r600_cs_legacy_ioctl", ",", "DRM_AUTH", ")", "}", ";", "int", "radeon_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "radeon_ioctls", ")", ";", "@", "@", "-", "1082", ",", "10", "+", "1082", ",", "10", "@", "@", "void", "savage_reclaim_buffers", "(", "struct", "drm_device", "*", "dev", ",", "struct", "drm_file", "*", "file_priv", ")", "}", "struct", "drm_ioctl_desc", "savage_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_INIT", ",", "savage_bci_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_CMDBUF", ",", "savage_bci_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_EVENT_EMIT", ",", "savage_bci_event_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SAVAGE_BCI_EVENT_WAIT", ",", "savage_bci_event_wait", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_INIT", ",", "savage_bci_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_CMDBUF", ",", "savage_bci_cmdbuf", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_EVENT_EMIT", ",", "savage_bci_event_emit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SAVAGE_BCI_EVENT_WAIT", ",", "savage_bci_event_wait", ",", "DRM_AUTH", ")", ",", "}", ";", "int", "savage_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "savage_ioctls", ")", ";", "@", "@", "-", "320", ",", "12", "+", "320", ",", "12", "@", "@", "void", "sis_reclaim_buffers_locked", "(", "struct", "drm_device", "*", "dev", ",", "}", "struct", "drm_ioctl_desc", "sis_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_SIS_FB_ALLOC", ",", "sis_fb_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_FB_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_AGP_INIT", ",", "sis_ioctl_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_AGP_ALLOC", ",", "sis_ioctl_agp_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_AGP_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_SIS_FB_INIT", ",", "sis_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_FB_ALLOC", ",", "sis_fb_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_FB_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_AGP_INIT", ",", "sis_ioctl_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_AGP_ALLOC", ",", "sis_ioctl_agp_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_AGP_FREE", ",", "sis_drm_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "SIS_FB_INIT", ",", "sis_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", "|", "DRM_ROOT_ONLY", ")", ",", "}", ";", "int", "sis_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "sis_ioctls", ")", ";", "@", "@", "-", "722", ",", "20", "+", "722", ",", "20", "@", "@", "static", "int", "via_cmdbuf_size", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "struct", "drm_file", "*", "}", "struct", "drm_ioctl_desc", "via_ioctls", "[", "]", "=", "{", "DRM_IOCTL_DEF", "(", "DRM_VIA_ALLOCMEM", ",", "via_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_FREEMEM", ",", "via_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_AGP_INIT", ",", "via_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_FB_INIT", ",", "via_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_MAP_INIT", ",", "via_map_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_DEC_FUTEX", ",", "via_decoder_futex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_DMA_INIT", ",", "via_dma_init", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_CMDBUFFER", ",", "via_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_FLUSH", ",", "via_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_PCICMD", ",", "via_pci_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_CMDBUF_SIZE", ",", "via_cmdbuf_size", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_WAIT_IRQ", ",", "via_wait_irq", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_DMA_BLIT", ",", "via_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF", "(", "DRM_VIA_BLIT_SYNC", ",", "via_dma_blit_sync", ",", "DRM_AUTH", ")", "DRM_IOCTL_DEF_DRV", "(", "VIA_ALLOCMEM", ",", "via_mem_alloc", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_FREEMEM", ",", "via_mem_free", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_AGP_INIT", ",", "via_agp_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_FB_INIT", ",", "via_fb_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_MAP_INIT", ",", "via_map_init", ",", "DRM_AUTH", "|", "DRM_MASTER", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_DEC_FUTEX", ",", "via_decoder_futex", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_DMA_INIT", ",", "via_dma_init", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_CMDBUFFER", ",", "via_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_FLUSH", ",", "via_flush_ioctl", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_PCICMD", ",", "via_pci_cmdbuffer", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_CMDBUF_SIZE", ",", "via_cmdbuf_size", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_WAIT_IRQ", ",", "via_wait_irq", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_DMA_BLIT", ",", "via_dma_blit", ",", "DRM_AUTH", ")", ",", "DRM_IOCTL_DEF_DRV", "(", "VIA_BLIT_SYNC", ",", "via_dma_blit_sync", ",", "DRM_AUTH", ")", "}", ";", "int", "via_max_ioctl", "=", "DRM_ARRAY_SIZE", "(", "via_ioctls", ")", ";", "@", "@", "-", "99", ",", "47", "+", "99", ",", "47", "@", "@", "*", "/", "#", "define", "VMW_IOCTL_DEF", "(", "ioctl", ",", "func", ",", "flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "ioctl", ")", "-", "DRM_COMMAND_BASE", "]", "=", "{", "ioctl", ",", "flags", ",", "func", "}", "[", "DRM_IOCTL_NR", "(", "DRM_IOCTL_", "#", "#", "ioctl", ")", "-", "DRM_COMMAND_BASE", "]", "=", "{", "DRM_", "#", "#", "ioctl", ",", "flags", ",", "func", ",", "DRM_IOCTL_", "#", "#", "ioctl", "}", "/", "**", "*", "Ioctl", "definitions", ".", "*", "/", "static", "struct", "drm_ioctl_desc", "vmw_ioctls", "[", "]", "=", "{", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_GET_PARAM", ",", "vmw_getparam_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_GET_PARAM", ",", "vmw_getparam_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_ALLOC_DMABUF", ",", "vmw_dmabuf_alloc_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_ALLOC_DMABUF", ",", "vmw_dmabuf_alloc_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_DMABUF", ",", "vmw_dmabuf_unref_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_DMABUF", ",", "vmw_dmabuf_unref_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CURSOR_BYPASS", ",", "VMW_IOCTL_DEF", "(", "VMW_CURSOR_BYPASS", ",", "vmw_kms_cursor_bypass_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CONTROL_STREAM", ",", "vmw_overlay_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CONTROL_STREAM", ",", "vmw_overlay_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CLAIM_STREAM", ",", "vmw_stream_claim_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CLAIM_STREAM", ",", "vmw_stream_claim_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_STREAM", ",", "vmw_stream_unref_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_STREAM", ",", "vmw_stream_unref_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CREATE_CONTEXT", ",", "vmw_context_define_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CREATE_CONTEXT", ",", "vmw_context_define_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_CONTEXT", ",", "vmw_context_destroy_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_CONTEXT", ",", "vmw_context_destroy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_CREATE_SURFACE", ",", "vmw_surface_define_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_CREATE_SURFACE", ",", "vmw_surface_define_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UNREF_SURFACE", ",", "vmw_surface_destroy_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UNREF_SURFACE", ",", "vmw_surface_destroy_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_REF_SURFACE", ",", "vmw_surface_reference_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_REF_SURFACE", ",", "vmw_surface_reference_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_EXECBUF", ",", "vmw_execbuf_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_EXECBUF", ",", "vmw_execbuf_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_FIFO_DEBUG", ",", "vmw_fifo_debug_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_FIFO_DEBUG", ",", "vmw_fifo_debug_ioctl", ",", "DRM_AUTH", "|", "DRM_ROOT_ONLY", "|", "DRM_MASTER", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_FENCE_WAIT", ",", "vmw_fence_wait_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_FENCE_WAIT", ",", "vmw_fence_wait_ioctl", ",", "DRM_AUTH", "|", "DRM_UNLOCKED", ")", ",", "VMW_IOCTL_DEF", "(", "DRM_IOCTL_VMW_UPDATE_LAYOUT", ",", "vmw_kms_update_layout_ioctl", ",", "VMW_IOCTL_DEF", "(", "VMW_UPDATE_LAYOUT", ",", "vmw_kms_update_layout_ioctl", ",", "DRM_MASTER", "|", "DRM_CONTROL_ALLOW", "|", "DRM_UNLOCKED", ")", "}", ";", "@", "@", "-", "305", ",", "14", "+", "305", ",", "16", "@", "@", "struct", "drm_ioctl_desc", "{", "unsigned", "int", "cmd", ";", "int", "flags", ";", "drm_ioctl_t", "*", "func", ";", "unsigned", "int", "cmd_drv", ";", "}", ";", "/", "**", "*", "Creates", "a", "driver", "or", "general", "drm_ioctl_desc", "array", "entry", "for", "the", "given", "*", "ioctl", ",", "for", "use", "by", "drm_ioctl", "(", ").", "*", "/", "#", "define", "DRM_IOCTL_DEF", "(", "ioctl", ",", "_func", ",", "_flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "ioctl", ")", "]", "=", "{", ".", "cmd", "=", "ioctl", ",", ".", "func", "=", "_func", ",", ".", "flags", "=", "_flags", "}", "#", "define", "DRM_IOCTL_DEF_DRV", "(", "ioctl", ",", "_func", ",", "_flags", ")", "\\", "[", "DRM_IOCTL_NR", "(", "DRM_", "#", "#", "ioctl", ")", "]", "=", "{", ".", "cmd", "=", "DRM_", "#", "#", "ioctl", ",", ".", "func", "=", "_func", ",", ".", "flags", "=", "_flags", ",", ".", "cmd_drv", "=", "DRM_IOCTL_", "#", "#", "ioctl", "}", "struct", "drm_magic_entry", "{", "struct", "list_head", "head", ";", "@", "@", "-", "264", ",", "20", "+", "264", ",", "20", "@", "@", "typedef", "struct", "_drm_i830_sarea", "{", "#", "define", "DRM_I830_GETPARAM", "0x0c", "#", "define", "DRM_I830_SETPARAM", "0x0d", "#", "define", "DRM_IOCTL_I830_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_INIT", ",", "drm_i830_init_t", ")", "#", "define", "DRM_IOCTL_I830_VERTEX", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_VERTEX", ",", "drm_i830_vertex_t", ")", "#", "define", "DRM_IOCTL_I830_CLEAR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_CLEAR", ",", "drm_i830_clear_t", ")", "#", "define", "DRM_IOCTL_I830_FLUSH", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_FLUSH", ")", "#", "define", "DRM_IOCTL_I830_GETAGE", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_GETAGE", ")", "#", "define", "DRM_IOCTL_I830_GETBUF", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_GETBUF", ",", "drm_i830_dma_t", ")", "#", "define", "DRM_IOCTL_I830_SWAP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_SWAP", ")", "#", "define", "DRM_IOCTL_I830_COPY", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_COPY", ",", "drm_i830_copy_t", ")", "#", "define", "DRM_IOCTL_I830_DOCOPY", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_DOCOPY", ")", "#", "define", "DRM_IOCTL_I830_FLIP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_FLIP", ")", "#", "define", "DRM_IOCTL_I830_IRQ_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_IRQ_EMIT", ",", "drm_i830_irq_emit_t", ")", "#", "define", "DRM_IOCTL_I830_IRQ_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_IRQ_WAIT", ",", "drm_i830_irq_wait_t", ")", "#", "define", "DRM_IOCTL_I830_GETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_GETPARAM", ",", "drm_i830_getparam_t", ")", "#", "define", "DRM_IOCTL_I830_SETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_IOCTL_I830_SETPARAM", ",", "drm_i830_setparam_t", ")", "#", "define", "DRM_IOCTL_I830_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_INIT", ",", "drm_i830_init_t", ")", "#", "define", "DRM_IOCTL_I830_VERTEX", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_VERTEX", ",", "drm_i830_vertex_t", ")", "#", "define", "DRM_IOCTL_I830_CLEAR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_CLEAR", ",", "drm_i830_clear_t", ")", "#", "define", "DRM_IOCTL_I830_FLUSH", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_FLUSH", ")", "#", "define", "DRM_IOCTL_I830_GETAGE", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_GETAGE", ")", "#", "define", "DRM_IOCTL_I830_GETBUF", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_GETBUF", ",", "drm_i830_dma_t", ")", "#", "define", "DRM_IOCTL_I830_SWAP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_SWAP", ")", "#", "define", "DRM_IOCTL_I830_COPY", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_COPY", ",", "drm_i830_copy_t", ")", "#", "define", "DRM_IOCTL_I830_DOCOPY", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_DOCOPY", ")", "#", "define", "DRM_IOCTL_I830_FLIP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_FLIP", ")", "#", "define", "DRM_IOCTL_I830_IRQ_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_IRQ_EMIT", ",", "drm_i830_irq_emit_t", ")", "#", "define", "DRM_IOCTL_I830_IRQ_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_IRQ_WAIT", ",", "drm_i830_irq_wait_t", ")", "#", "define", "DRM_IOCTL_I830_GETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_GETPARAM", ",", "drm_i830_getparam_t", ")", "#", "define", "DRM_IOCTL_I830_SETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I830_SETPARAM", ",", "drm_i830_setparam_t", ")", "typedef", "struct", "_drm_i830_clear", "{", "int", "clear_color", ";", "@", "@", "-", "206", ",", "6", "+", "206", ",", "7", "@", "@", "typedef", "struct", "_drm_i915_sarea", "{", "#", "define", "DRM_IOCTL_I915_SET_VBLANK_PIPE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_SET_VBLANK_PIPE", ",", "drm_i915_vblank_pipe_t", ")", "#", "define", "DRM_IOCTL_I915_GET_VBLANK_PIPE", "DRM_IOR", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GET_VBLANK_PIPE", ",", "drm_i915_vblank_pipe_t", ")", "#", "define", "DRM_IOCTL_I915_VBLANK_SWAP", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_VBLANK_SWAP", ",", "drm_i915_vblank_swap_t", ")", "#", "define", "DRM_IOCTL_I915_HWS_ADDR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_HWS_ADDR", ",", "struct", "drm_i915_gem_init", ")", "#", "define", "DRM_IOCTL_I915_GEM_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GEM_INIT", ",", "struct", "drm_i915_gem_init", ")", "#", "define", "DRM_IOCTL_I915_GEM_EXECBUFFER", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GEM_EXECBUFFER", ",", "struct", "drm_i915_gem_execbuffer", ")", "#", "define", "DRM_IOCTL_I915_GEM_EXECBUFFER2", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_I915_GEM_EXECBUFFER2", ",", "struct", "drm_i915_gem_execbuffer2", ")", "@", "@", "-", "248", ",", "7", "+", "248", ",", "7", "@", "@", "typedef", "struct", "_drm_mga_sarea", "{", "#", "define", "DRM_MGA_DMA_BOOTSTRAP", "0x0c", "#", "define", "DRM_IOCTL_MGA_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_INIT", ",", "drm_mga_init_t", ")", "#", "define", "DRM_IOCTL_MGA_FLUSH", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_FLUSH", ",", "drm_lock_t", ")", "#", "define", "DRM_IOCTL_MGA_FLUSH", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_FLUSH", ",", "struct", "drm_lock", ")", "#", "define", "DRM_IOCTL_MGA_RESET", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_RESET", ")", "#", "define", "DRM_IOCTL_MGA_SWAP", "DRM_IO", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_SWAP", ")", "#", "define", "DRM_IOCTL_MGA_CLEAR", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_MGA_CLEAR", ",", "drm_mga_clear_t", ")", "@", "@", "-", "197", ",", "4", "+", "197", ",", "17", "@", "@", "struct", "drm_nouveau_sarea", "{", "#", "define", "DRM_NOUVEAU_GEM_CPU_FINI", "0x43", "#", "define", "DRM_NOUVEAU_GEM_INFO", "0x44", "#", "define", "DRM_IOCTL_NOUVEAU_GETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GETPARAM", ",", "struct", "drm_nouveau_getparam", ")", "#", "define", "DRM_IOCTL_NOUVEAU_SETPARAM", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_SETPARAM", ",", "struct", "drm_nouveau_setparam", ")", "#", "define", "DRM_IOCTL_NOUVEAU_CHANNEL_ALLOC", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_CHANNEL_ALLOC", ",", "struct", "drm_nouveau_channel_alloc", ")", "#", "define", "DRM_IOCTL_NOUVEAU_CHANNEL_FREE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_CHANNEL_FREE", ",", "struct", "drm_nouveau_channel_free", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GROBJ_ALLOC", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GROBJ_ALLOC", ",", "struct", "drm_nouveau_grobj_alloc", ")", "#", "define", "DRM_IOCTL_NOUVEAU_NOTIFIEROBJ_ALLOC", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_NOTIFIEROBJ_ALLOC", ",", "struct", "drm_nouveau_notifierobj_alloc", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GPUOBJ_FREE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GPUOBJ_FREE", ",", "struct", "drm_nouveau_gpuobj_free", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_NEW", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_NEW", ",", "struct", "drm_nouveau_gem_new", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_PUSHBUF", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_PUSHBUF", ",", "struct", "drm_nouveau_gem_pushbuf", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_CPU_PREP", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_CPU_PREP", ",", "struct", "drm_nouveau_gem_cpu_prep", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_CPU_FINI", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_CPU_FINI", ",", "struct", "drm_nouveau_gem_cpu_fini", ")", "#", "define", "DRM_IOCTL_NOUVEAU_GEM_INFO", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_NOUVEAU_GEM_INFO", ",", "struct", "drm_nouveau_gem_info", ")", "#", "endif", "/", "*", "__NOUVEAU_DRM_H__", "*", "/", "@", "@", "-", "547", ",", "8", "+", "547", ",", "8", "@", "@", "typedef", "struct", "{", "#", "define", "DRM_IOCTL_RADEON_GEM_WAIT_IDLE", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_WAIT_IDLE", ",", "struct", "drm_radeon_gem_wait_idle", ")", "#", "define", "DRM_IOCTL_RADEON_CS", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_CS", ",", "struct", "drm_radeon_cs", ")", "#", "define", "DRM_IOCTL_RADEON_INFO", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_INFO", ",", "struct", "drm_radeon_info", ")", "#", "define", "DRM_IOCTL_RADEON_SET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_SET_TILING", ",", "struct", "drm_radeon_gem_set_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_GET_TILING", ",", "struct", "drm_radeon_gem_get_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GEM_SET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_SET_TILING", ",", "struct", "drm_radeon_gem_set_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GEM_GET_TILING", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_GET_TILING", ",", "struct", "drm_radeon_gem_get_tiling", ")", "#", "define", "DRM_IOCTL_RADEON_GEM_BUSY", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_RADEON_GEM_BUSY", ",", "struct", "drm_radeon_gem_busy", ")", "typedef", "struct", "drm_radeon_init", "{", "@", "@", "-", "63", ",", "10", "+", "63", ",", "10", "@", "@", "typedef", "struct", "_drm_savage_sarea", "{", "#", "define", "DRM_SAVAGE_BCI_EVENT_EMIT", "0x02", "#", "define", "DRM_SAVAGE_BCI_EVENT_WAIT", "0x03", "#", "define", "DRM_IOCTL_SAVAGE_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_INIT", ",", "drm_savage_init_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_CMDBUF", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_CMDBUF", ",", "drm_savage_cmdbuf_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_EVENT_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_EMIT", ",", "drm_savage_event_emit_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_EVENT_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_WAIT", ",", "drm_savage_event_wait_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_INIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_INIT", ",", "drm_savage_init_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_CMDBUF", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_CMDBUF", ",", "drm_savage_cmdbuf_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_EVENT_EMIT", "DRM_IOWR", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_EMIT", ",", "drm_savage_event_emit_t", ")", "#", "define", "DRM_IOCTL_SAVAGE_BCI_EVENT_WAIT", "DRM_IOW", "(", "DRM_COMMAND_BASE", "+", "DRM_SAVAGE_BCI_EVENT_WAIT", ",", "drm_savage_event_wait_t", ")", "#", "define", "SAVAGE_DMA_PCI", "1", "#", "define", "SAVAGE_DMA_AGP", "3"], "docstring_tokens": ["by", "requesting", "a", "large", "memory-allocation", "amount", "."]}
{"contents": ["rose:", "fix", "info", "leak", "via", "msg_name", "in", "rose_recvmsg()", "The", "code", "in", "rose_recvmsg()", "does", "not", "initialize", "all", "of", "the", "members", "of", "struct", "sockaddr_rose/full_sockaddr_rose", "when", "filling", "the", "sockaddr", "info.", "Nor", "does", "it", "initialize", "the", "padding", "bytes", "of", "the", "structure", "inserted", "by", "the", "compiler", "for", "alignment.", "This", "will", "lead", "to", "leaking", "uninitialized", "kernel", "stack", "bytes", "in", "net/socket.c.", "Fix", "the", "issue", "by", "initializing", "the", "memory", "used", "for", "sockaddr", "info", "with", "memset(0).", "Cc:", "Ralf", "Baechle", "<ralf@linux-mips.org>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1253", ",", "6", "+", "1253", ",", "7", "@", "@", "static", "int", "rose_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "skb_copy_datagram_iovec", "(", "skb", ",", "0", ",", "msg", "-", ">", "msg_iov", ",", "copied", ")", ";", "if", "(", "srose", "!", "=", "NULL", ")", "{", "memset", "(", "srose", ",", "0", ",", "msg", "-", ">", "msg_namelen", ")", ";", "srose", "-", ">", "srose_family", "=", "AF_ROSE", ";", "srose", "-", ">", "srose_addr", "=", "rose", "-", ">", "dest_addr", ";", "srose", "-", ">", "srose_call", "=", "rose", "-", ">", "dest_call", ";"], "docstring_tokens": ["using", "recvmsg(2)/recvfrom(2)"]}
{"contents": ["drm/vmwgfx:", "fix", "integer", "overflow", "in", "vmw_surface_define_ioctl()", "In", "vmw_surface_define_ioctl(),", "the", "'num_sizes'", "is", "the", "sum", "of", "the", "'req->mip_levels'", "array.", "This", "array", "can", "be", "assigned", "any", "value", "from", "the", "user", "space.", "As", "both", "the", "'num_sizes'", "and", "the", "array", "is", "uint32_t,", "it", "is", "easy", "to", "make", "'num_sizes'", "overflow.", "The", "later", "'mip_levels'", "is", "used", "as", "the", "loop", "count.", "This", "can", "lead", "an", "oob", "write.", "Add", "the", "check", "of", "'req->mip_levels'", "to", "avoid", "this.", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Li", "Qiang", "<liqiang6-s@360.cn>", "Reviewed-by:", "Thomas", "Hellstrom", "<thellstrom@vmware.com>"], "code_tokens": ["@", "@", "-", "713", ",", "8", "+", "713", ",", "11", "@", "@", "int", "vmw_surface_define_ioctl", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "128", ";", "num_sizes", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "DRM_VMW_MAX_SURFACE_FACES", ";", "+", "+", "i", ")", "for", "(", "i", "=", "0", ";", "i", "<", "DRM_VMW_MAX_SURFACE_FACES", ";", "+", "+", "i", ")", "{", "if", "(", "req", "-", ">", "mip_levels", "[", "i", "]", ">", "DRM_VMW_MAX_MIP_LEVELS", ")", "return", "-", "EINVAL", ";", "num_sizes", "+", "=", "req", "-", ">", "mip_levels", "[", "i", "]", ";", "}", "if", "(", "num_sizes", ">", "DRM_VMW_MAX_SURFACE_FACES", "*", "DRM_VMW_MAX_MIP_LEVELS", "|", "|", "num_sizes", "=", "=", "0", ")"], "docstring_tokens": ["run", "a", "binary"]}
{"contents": ["[Fix]", "ensure", "that", "`allowPrototypes:", "false`", "does", "not", "ever", "shadow", "Object.prototype", "properties."], "code_tokens": ["@", "@", "-", "55", ",", "7", "+", "55", ",", "7", "@", "@", "var", "parseObject", "=", "function", "parseObjectRecursive", "(", "chain", ",", "val", ",", "options", ")", "{", "obj", "=", "obj", ".", "concat", "(", "parseObject", "(", "chain", ",", "val", ",", "options", ")", ");", "}", "else", "{", "obj", "=", "options", ".", "plainObjects", "?", "Object", ".", "create", "(", "null", ")", ":", "{", "};", "var", "cleanRoot", "=", "root", "[", "0", "]", "=", "==", "'", "['", "&", "&", "root", "[", "root", ".", "length", "-", "1", "]", "=", "==", "'", "]'", "?", "root", ".", "slice", "(", "1", ",", "root", ".", "length", "-", "1", ")", ":", "root", ";", "var", "cleanRoot", "=", "root", ".", "charAt", "(", "0", ")", "=", "==", "'", "['", "&", "&", "root", ".", "charAt", "(", "root", ".", "length", "-", "1", ")", "=", "==", "'", "]'", "?", "root", ".", "slice", "(", "1", ",", "-", "1", ")", ":", "root", ";", "var", "index", "=", "parseInt", "(", "cleanRoot", ",", "10", ")", ";", "if", "(", "!", "isNaN", "(", "index", ")", "&", "&", "@", "@", "-", "84", ",", "7", "+", "84", ",", "7", "@", "@", "var", "parseKeys", "=", "function", "parseQueryStringKeys", "(", "givenKey", ",", "val", ",", "options", ")", "{", "/", "/", "The", "regex", "chunks", "var", "parent", "=", "/", "^(", "[^", "[\\", "]]", "*)", "/;", "var", "parent", "=", "/", "^(", "[^", "[]", "*)", "/;", "var", "child", "=", "/", "(\\", "[[", "^[", "\\]", "]*", "])", "/", "g", ";", "/", "/", "Get", "the", "parent", "@", "@", "-", "111", ",", "9", "+", "111", ",", "9", "@", "@", "var", "parseKeys", "=", "function", "parseQueryStringKeys", "(", "givenKey", ",", "val", ",", "options", ")", "{", "var", "i", "=", "0", ";", "while", "(", "(", "segment", "=", "child", ".", "exec", "(", "key", ")", ")", "!", "==", "null", "&", "&", "i", "<", "options", ".", "depth", ")", "{", "i", "+", "=", "1", ";", "if", "(", "!", "options", ".", "plainObjects", "&", "&", "has", ".", "call", "(", "Object", ".", "prototype", ",", "segment", "[", "1", "]", ".", "replace", "(", "/\\", "[|", "]/", "g", ",", "'", "')", "))", "{", "if", "(", "!", "options", ".", "plainObjects", "&", "&", "has", ".", "call", "(", "Object", ".", "prototype", ",", "segment", "[", "1", "]", ".", "slice", "(", "1", ",", "-", "1", ")", "))", "{", "if", "(", "!", "options", ".", "allowPrototypes", ")", "{", "continue", ";", "return", ";", "}", "}", "keys", ".", "push", "(", "segment", "[", "1", "]", ");", "@", "@", "-", "131", ",", "9", "+", "131", ",", "9", "@", "@", "test", "(", "'", "parse", "(", ")'", ",", "function", "(", "t", ")", "{", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "foo", "[", "bad", "]", "=", "baz", "&", "foo", "[", "]=", "bar", "&", "foo", "[", "]=", "foo", "'", "),", "{", "foo", ":", "{", "bad", ":", "'", "baz", "'", ",", "0", ":", "'", "bar", "'", ",", "1", ":", "'", "foo", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "foo", "[", "0", "]", "[", "a", "]", "=", "a", "&", "foo", "[", "0", "]", "[", "b", "]", "=", "b", "&", "foo", "[", "1", "]", "[", "a", "]", "=", "aa", "&", "foo", "[", "1", "]", "[", "b", "]", "=", "bb", "'", "),", "{", "foo", ":", "[", "{", "a", ":", "'", "a", "'", ",", "b", ":", "'", "b", "'", "}", ",", "{", "a", ":", "'", "aa", "'", ",", "b", ":", "'", "bb", "'", "}", "]", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "]=", "b", "&", "a", "[", "t", "]", "=", "u", "&", "a", "[", "hasOwnProperty", "]", "=", "c", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "a", ":", "{", "0", ":", "'", "b", "'", ",", "c", ":", "true", ",", "t", ":", "'", "u", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "]=", "b", "&", "a", "[", "t", "]", "=", "u", "&", "a", "[", "hasOwnProperty", "]", "=", "c", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "a", ":", "{", "0", ":", "'", "b", "'", ",", "t", ":", "'", "u", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "]=", "b", "&", "a", "[", "t", "]", "=", "u", "&", "a", "[", "hasOwnProperty", "]", "=", "c", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "a", ":", "{", "0", ":", "'", "b", "'", ",", "t", ":", "'", "u", "'", ",", "hasOwnProperty", ":", "'", "c", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "]=", "b", "&", "a", "[", "hasOwnProperty", "]", "=", "c", "&", "a", "[", "x", "]", "=", "y", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "a", ":", "{", "0", ":", "'", "b", "'", ",", "1", ":", "'", "c", "'", ",", "x", ":", "'", "y", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "]=", "b", "&", "a", "[", "hasOwnProperty", "]", "=", "c", "&", "a", "[", "x", "]", "=", "y", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "a", ":", "{", "0", ":", "'", "b", "'", ",", "x", ":", "'", "y", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "]=", "b", "&", "a", "[", "hasOwnProperty", "]", "=", "c", "&", "a", "[", "x", "]", "=", "y", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "a", ":", "{", "0", ":", "'", "b", "'", ",", "hasOwnProperty", ":", "'", "c", "'", ",", "x", ":", "'", "y", "'", "}", "}", ");", "st", ".", "end", "(", ");", "}", ");", "@", "@", "-", "413", ",", "9", "+", "413", ",", "34", "@", "@", "test", "(", "'", "parse", "(", ")'", ",", "function", "(", "t", ")", "{", "st", ".", "end", "(", ");", "}", ");", "t", ".", "test", "(", "'", "does", "not", "allow", "overwriting", "prototype", "properties", "'", ",", "function", "(", "st", ")", "{", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "hasOwnProperty", "]", "=", "b", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "})", ";", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "hasOwnProperty", "=", "b", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "})", ";", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "toString", "'", ",", "{", "allowPrototypes", ":", "false", "}", "),", "{", "},", "'", "bare", "\"", "toString", "\"", "results", "in", "{", "}'", ")", ";", "st", ".", "end", "(", ");", "}", ");", "t", ".", "test", "(", "'", "can", "allow", "overwriting", "prototype", "properties", "'", ",", "function", "(", "st", ")", "{", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "hasOwnProperty", "]", "=", "b", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "a", ":", "{", "hasOwnProperty", ":", "'", "b", "'", "}", "}", ",", "{", "prototype", ":", "false", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "hasOwnProperty", "=", "b", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "hasOwnProperty", ":", "'", "b", "'", "}", ",", "{", "prototype", ":", "false", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "a", "[", "hasOwnProperty", "]", "=", "b", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "a", ":", "{", "hasOwnProperty", ":", "'", "b", "'", "}", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "hasOwnProperty", "=", "b", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "hasOwnProperty", ":", "'", "b", "'", "}", ");", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "'", "toString", "'", ",", "{", "allowPrototypes", ":", "true", "}", "),", "{", "toString", ":", "'", "'", "}", ",", "'", "bare", "\"", "toString", "\"", "results", "in", "{", "toString", ":", "\"", "\"", "}", "'", ")", ";", "st", ".", "end", "(", ");", "}", ");", "t", ".", "test", "(", "'", "params", "starting", "with", "a", "closing", "bracket", "'", ",", "function", "(", "st", ")", "{", "st", ".", "deepEqual", "(", "qs", ".", "parse", "(", "']", "=", "toString", "'", "),", "{", "'", "]'", ":", "'", "toString", "'", "}", ");", "st", ".", "end", "(", ");", "}", ");"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["ALSA:", "seq/oss", "-", "Fix", "double-free", "at", "error", "path", "of", "snd_seq_oss_open()", "The", "error", "handling", "in", "snd_seq_oss_open()", "has", "several", "bad", "codes", "that", "do", "dereferecing", "released", "pointers", "and", "double-free", "of", "kmalloc'ed", "data.", "The", "object", "dp", "is", "release", "in", "free_devinfo()", "that", "is", "called", "via", "private_free", "callback.", "The", "rest", "shouldn't", "touch", "this", "object", "any", "more.", "The", "patch", "changes", "delete_port()", "to", "call", "kfree()", "in", "any", "case,", "and", "gets", "rid", "of", "unnecessary", "calls", "of", "destructors", "in", "snd_seq_oss_open().", "Fixes", ".", "Reported-and-tested-by:", "Tavis", "Ormandy", "<taviso@cmpxchg8b.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "281", ",", "13", "+", "281", ",", "10", "@", "@", "snd_seq_oss_open", "(", "struct", "file", "*", "file", ",", "int", "level", ")", "return", "0", ";", "_error", ":", "snd_seq_oss_writeq_delete", "(", "dp", "-", ">", "writeq", ")", ";", "snd_seq_oss_readq_delete", "(", "dp", "-", ">", "readq", ")", ";", "snd_seq_oss_synth_cleanup", "(", "dp", ")", ";", "snd_seq_oss_midi_cleanup", "(", "dp", ")", ";", "delete_port", "(", "dp", ")", ";", "delete_seq_queue", "(", "dp", "-", ">", "queue", ")", ";", "kfree", "(", "dp", ")", ";", "delete_port", "(", "dp", ")", ";", "return", "rc", ";", "}", "@", "@", "-", "350", ",", "8", "+", "347", ",", "10", "@", "@", "create_port", "(", "struct", "seq_oss_devinfo", "*", "dp", ")", "static", "int", "delete_port", "(", "struct", "seq_oss_devinfo", "*", "dp", ")", "{", "if", "(", "dp", "-", ">", "port", "<", "0", ")", "if", "(", "dp", "-", ">", "port", "<", "0", ")", "{", "kfree", "(", "dp", ")", ";", "return", "0", ";", "}", "debug_printk", "(", "(\"", "delete_port", "%", "i", "\\", "n", "\"", ",", "dp", "-", ">", "port", ")", ");", "return", "snd_seq_event_port_detach", "(", "dp", "-", ">", "cseq", ",", "dp", "-", ">", "port", ")", ";"], "docstring_tokens": ["via", "an", "unsuccessful", "attempt", "to", "open", "the", "/dev/sequencer", "device", "."]}
{"contents": ["fix", "potential", "resource", "leak"], "code_tokens": ["@", "@", "-", "16", ",", "14", "+", "16", ",", "17", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ocr", ";", "import", "java", ".", "io", ".", "File", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FilenameUtils", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "Configuration", "for", "TesseractOCRParser", ".", "@", "@", "-", "43", ",", "6", "+", "46", ",", "12", "@", "@", "private", "static", "final", "long", "serialVersionUID", "=", "-", "4861942486845757891L", ";", "private", "static", "Pattern", "ALLOWABLE_PAGE_SEPARATORS_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "?", "i", ")", "^[", "-", "_", "<", ">", "A", "-", "Z0", "-", "9", "\\", "n", "\\", "r", "]", "+$", "\")", ";", "private", "static", "Pattern", "ALLOWABLE_OTHER_PARAMS_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "?", "i", ")", "^[", "-/", "_", "<", ">", "A", "-", "Z0", "-", "9", "]", "+$", "\")", ";", "public", "enum", "OUTPUT_TYPE", "{", "TXT", ",", "HOCR", "@", "@", "-", "157", ",", "12", "+", "166", ",", "7", "@", "@", "private", "void", "init", "(", "InputStream", "is", ")", "{", "getProp", "(", "props", ",", "\"", "maxFileSizeToOcr", "\"", ",", "getMaxFileSizeToOcr", "(", "))", ");", "setTimeout", "(", "getProp", "(", "props", ",", "\"", "timeout", "\"", ",", "getTimeout", "(", "))", ");", "String", "outputTypeString", "=", "props", ".", "getProperty", "(", "\"", "outputType", "\"", ");", "if", "(", "\"", "txt", "\"", ".", "equals", "(", "outputTypeString", ")", ")", "{", "setOutputType", "(", "OUTPUT_TYPE", ".", "TXT", ")", ";", "}", "else", "if", "(", "\"", "hocr", "\"", ".", "equals", "(", "outputTypeString", ")", ")", "{", "setOutputType", "(", "OUTPUT_TYPE", ".", "HOCR", ")", ";", "}", "setOutputType", "(", "getProp", "(", "props", ",", "\"", "outputType", "\"", ",", "getOutputType", "(", ").", "toString", "(", "))", ");", "setPreserveInterwordSpacing", "(", "getProp", "(", "props", ",", "\"", "preserveInterwordSpacing", "\"", ",", "false", ")", ");", "/", "/", "set", "parameters", "for", "ImageMagick", "@", "@", "-", "201", ",", "10", "+", "205", ",", "7", "@", "@", "public", "String", "getTesseractPath", "(", ")", "{", "*", "<", "/", "p", ">", "*", "/", "public", "void", "setTesseractPath", "(", "String", "tesseractPath", ")", "{", "if", "(", "!", "tesseractPath", ".", "isEmpty", "(", ")", "&", "&", "!", "tesseractPath", ".", "endsWith", "(", "File", ".", "separator", ")", ")", "tesseractPath", "+", "=", "File", ".", "separator", ";", "this", ".", "tesseractPath", "=", "tesseractPath", ";", "this", ".", "tesseractPath", "=", "FilenameUtils", ".", "normalize", "(", "tesseractPath", ")", ";", "}", "/", "**", "@", "@", "-", "220", ",", "10", "+", "221", ",", "7", "@", "@", "public", "String", "getTessdataPath", "(", ")", "{", "*", "(", "such", "as", "when", "Tesseract", "is", "built", "from", "source", ")", ",", "it", "may", "be", "located", "elsewhere", ".", "*", "/", "public", "void", "setTessdataPath", "(", "String", "tessdataPath", ")", "{", "if", "(", "!", "tessdataPath", ".", "isEmpty", "(", ")", "&", "&", "!", "tessdataPath", ".", "endsWith", "(", "File", ".", "separator", ")", ")", "tessdataPath", "+", "=", "File", ".", "separator", ";", "this", ".", "tessdataPath", "=", "tessdataPath", ";", "this", ".", "tessdataPath", "=", "FilenameUtils", ".", "normalize", "(", "tessdataPath", ")", ";", "}", "/", "**", "@", "@", "-", "280", ",", "6", "+", "278", ",", "20", "@", "@", "public", "String", "getPageSeparator", "(", ")", "{", "*", "@", "param", "pageSeparator", "*", "/", "public", "void", "setPageSeparator", "(", "String", "pageSeparator", ")", "{", "Matcher", "m", "=", "ALLOWABLE_PAGE_SEPARATORS_PATTERN", ".", "matcher", "(", "pageSeparator", ")", ";", "if", "(", "!", "m", ".", "find", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "pageSeparator", "+", "\"", "contains", "illegal", "characters", ".", "\\", "n", "\"", "\"", "If", "you", "trust", "this", "value", ",", "set", "it", "with", "setTrustedPageSeparator", "\"", ");", "}", "this", ".", "pageSeparator", "=", "pageSeparator", ";", "}", "/", "**", "*", "Same", "as", "{", "@", "link", "#", "setPageSeparator", "(", "String", ")", "}", "but", "does", "not", "perform", "*", "any", "checks", "on", "the", "string", ".", "*", "@", "param", "pageSeparator", "*", "/", "public", "void", "setTrustedPageSeparator", "(", "String", "pageSeparator", ")", "{", "this", ".", "pageSeparator", "=", "pageSeparator", ";", "}", "@", "@", "-", "353", ",", "6", "+", "365", ",", "22", "@", "@", "public", "void", "setOutputType", "(", "OUTPUT_TYPE", "outputType", ")", "{", "this", ".", "outputType", "=", "outputType", ";", "}", "public", "void", "setOutputType", "(", "String", "outputType", ")", "{", "if", "(", "outputType", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "outputType", "must", "not", "be", "null", "\"", ");", "}", "String", "lc", "=", "outputType", ".", "toLowerCase", "(", "Locale", ".", "US", ")", ";", "if", "(", "\"", "txt", "\"", ".", "equals", "(", "lc", ")", ")", "{", "setOutputType", "(", "OUTPUT_TYPE", ".", "TXT", ")", ";", "}", "else", "if", "(", "\"", "hocr", "\"", ".", "equals", "(", "lc", ")", ")", "{", "setOutputType", "(", "OUTPUT_TYPE", ".", "HOCR", ")", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "outputType", "must", "be", "either", "'", "txt", "'", "or", "'", "hocr", "'", "\")", ";", "}", "}", "/", "**", "*", "@", "see", "#", "setOutputType", "(", "OUTPUT_TYPE", "outputType", ")", "*", "/", "@", "@", "-", "499", ",", "10", "+", "527", ",", "7", "@", "@", "public", "String", "getImageMagickPath", "(", ")", "{", "*", "@", "param", "ImageMagickPath", "to", "ImageMagick", "file", ".", "*", "/", "public", "void", "setImageMagickPath", "(", "String", "ImageMagickPath", ")", "{", "if", "(", "!", "ImageMagickPath", ".", "isEmpty", "(", ")", "&", "&", "!", "ImageMagickPath", ".", "endsWith", "(", "File", ".", "separator", ")", ")", "ImageMagickPath", "+", "=", "File", ".", "separator", ";", "this", ".", "ImageMagickPath", "=", "ImageMagickPath", ";", "this", ".", "ImageMagickPath", "=", "FilenameUtils", ".", "normalize", "(", "ImageMagickPath", ")", ";", "}", "/", "**", "@", "@", "-", "541", ",", "7", "+", "566", ",", "23", "@", "@", "public", "void", "setApplyRotation", "(", "boolean", "applyRotation", ")", "{", "*", "@", "param", "value", "*", "/", "public", "void", "addOtherTesseractConfig", "(", "String", "key", ",", "String", "value", ")", "{", "otherTesseractConfig", ".", "put", "(", "key", ",", "value", ")", ";", "if", "(", "key", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "key", "must", "not", "be", "null", "\"", ");", "}", "if", "(", "value", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "value", "must", "not", "be", "null", "\"", ");", "}", "Matcher", "m", "=", "ALLOWABLE_OTHER_PARAMS_PATTERN", ".", "matcher", "(", "key", ")", ";", "if", "(", "!", "m", ".", "find", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Value", "contains", "illegal", "characters", ":", "\"", "+", "key", ")", ";", "}", "m", ".", "reset", "(", "value", ")", ";", "if", "(", "!", "m", ".", "find", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Value", "contains", "illegal", "characters", ":", "\"", "+", "value", ")", ";", "}", "otherTesseractConfig", ".", "put", "(", "key", ".", "trim", "(", "),", "value", ".", "trim", "(", "))", ";", "}", "/", "**", "@", "@", "-", "603", ",", "7", "+", "644", ",", "7", "@", "@", "private", "boolean", "getProp", "(", "Properties", "properties", ",", "String", "property", ",", "boolean", "defaultM", "private", "void", "loadOtherTesseractConfig", "(", "Properties", "properties", ")", "{", "for", "(", "String", "k", ":", "properties", ".", "stringPropertyNames", "(", "))", "{", "if", "(", "k", ".", "contains", "(", "\"", "_", "\"", "))", "{", "otherTesseractConfig", ".", "put", "(", "k", ",", "properties", ".", "getProperty", "(", "k", ")", ");", "addOtherTesseractConfig", "(", "k", ",", "properties", ".", "getProperty", "(", "k", ")", ");", "}", "}", "}", "@", "@", "-", "33", ",", "6", "+", "33", ",", "7", "@", "@", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "nio", ".", "file", ".", "StandardCopyOption", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "@", "@", "-", "111", ",", "6", "+", "112", ",", "7", "@", "@", "MediaType", ".", "image", "(", "\"", "jpx", "\"", "),", "MediaType", ".", "image", "(", "\"", "x", "-", "portable", "-", "pixmap", "\"", ")", "}", "))", ");", "private", "static", "Map", "<", "String", ",", "Boolean", ">", "TESSERACT_PRESENT", "=", "new", "HashMap", "<", ">(", ");", "private", "static", "Map", "<", "String", ",", "Boolean", ">", "IMAGE_MAGICK_PRESENT", "=", "new", "HashMap", "<", ">(", ");", "@", "Override", "@", "@", "-", "145", ",", "6", "+", "147", ",", "16", "@", "@", "public", "boolean", "hasTesseract", "(", "TesseractOCRConfig", "config", ")", "{", "if", "(", "TESSERACT_PRESENT", ".", "containsKey", "(", "tesseract", ")", ")", "{", "return", "TESSERACT_PRESENT", ".", "get", "(", "tesseract", ")", ";", "}", "/", "/", "prevent", "memory", "bloat", "if", "(", "TESSERACT_PRESENT", ".", "size", "(", ")", ">", "100", ")", "{", "TESSERACT_PRESENT", ".", "clear", "(", ");", "}", "/", "/", "check", "that", "the", "parent", "directory", "exists", "if", "(", "!", "Files", ".", "isDirectory", "(", "Paths", ".", "get", "(", "config", ".", "getTesseractPath", "(", "))", "))", "{", "TESSERACT_PRESENT", ".", "put", "(", "tesseract", ",", "false", ")", ";", "return", "false", ";", "}", "/", "/", "Try", "running", "Tesseract", "from", "there", ",", "and", "see", "if", "it", "exists", "+", "works", "String", "[", "]", "checkCmd", "=", "{", "tesseract", "}", ";", "boolean", "hasTesseract", "=", "ExternalParser", ".", "check", "(", "checkCmd", ")", ";", "@", "@", "-", "158", ",", "14", "+", "170", ",", "22", "@", "@", "private", "boolean", "hasImageMagick", "(", "TesseractOCRConfig", "config", ")", "{", "String", "ImageMagick", "=", "getImageMagickPath", "(", "config", ")", ";", "/", "/", "Have", "we", "already", "checked", "for", "a", "copy", "of", "ImageMagick", "Program", "there", "?", "if", "(", "TESSERACT_PRESENT", ".", "containsKey", "(", "ImageMagick", ")", ")", "{", "return", "TESSERACT_PRESENT", ".", "get", "(", "ImageMagick", ")", ";", "if", "(", "IMAGE_MAGICK_PRESENT", ".", "containsKey", "(", "ImageMagick", ")", ")", "{", "return", "IMAGE_MAGICK_PRESENT", ".", "get", "(", "ImageMagick", ")", ";", "}", "/", "/", "prevent", "memory", "bloat", "if", "(", "IMAGE_MAGICK_PRESENT", ".", "size", "(", ")", ">", "100", ")", "{", "IMAGE_MAGICK_PRESENT", ".", "clear", "(", ");", "}", "/", "/", "check", "that", "directory", "exists", "if", "(", "!", "Files", ".", "isDirectory", "(", "Paths", ".", "get", "(", "config", ".", "getImageMagickPath", "(", "))", "))", "{", "IMAGE_MAGICK_PRESENT", ".", "put", "(", "ImageMagick", ",", "false", ")", ";", "return", "false", ";", "}", "/", "/", "Try", "running", "ImageMagick", "program", "from", "there", ",", "and", "see", "if", "it", "exists", "+", "works", "String", "[", "]", "checkCmd", "=", "{", "ImageMagick", "}", ";", "boolean", "hasImageMagick", "=", "ExternalParser", ".", "check", "(", "checkCmd", ")", ";", "TESSERACT_PRESENT", ".", "put", "(", "ImageMagick", ",", "hasImageMagick", ")", ";", "IMAGE_MAGICK_PRESENT", ".", "put", "(", "ImageMagick", ",", "hasImageMagick", ")", ";", "return", "hasImageMagick", ";", "@", "@", "-", "178", ",", "9", "+", "198", ",", "9", "@", "@", "private", "String", "getImageMagickPath", "(", "TesseractOCRConfig", "config", ")", "{", "static", "boolean", "hasPython", "(", ")", "{", "/", "/", "check", "if", "python", "is", "installed", "and", "it", "has", "the", "required", "dependencies", "for", "the", "rotation", "program", "to", "run", "boolean", "hasPython", "=", "false", ";", "TemporaryResources", "tmp", "=", "null", ";", "try", "{", "TemporaryResources", "tmp", "=", "new", "TemporaryResources", "(", ");", "tmp", "=", "new", "TemporaryResources", "(", ");", "File", "importCheck", "=", "tmp", ".", "createTemporaryFile", "(", ");", "String", "prg", "=", "\"", "import", "numpy", ",", "matplotlib", ",", "skimage", "\"", ";", "OutputStreamWriter", "out", "=", "new", "OutputStreamWriter", "(", "new", "FileOutputStream", "(", "importCheck", ")", ",", "Charset", ".", "forName", "(", "\"", "UTF", "-", "8", "\"", "))", ";", "@", "@", "-", "192", ",", "10", "+", "212", ",", "11", "@", "@", "static", "boolean", "hasPython", "(", ")", "{", "hasPython", "=", "true", ";", "}", "tmp", ".", "close", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "}", "finally", "{", "IOUtils", ".", "closeQuietly", "(", "tmp", ")", ";", "}", "return", "hasPython", ";", "@", "@", "-", "311", ",", "20", "+", "332", ",", "26", "@", "@", "public", "void", "parseInline", "(", "InputStream", "stream", ",", "XHTMLContentHandler", "xhtml", ",", "ParseCont", "/", "**", "*", "This", "method", "is", "used", "to", "process", "the", "image", "to", "an", "OCR", "-", "friendly", "format", ".", "*", "@", "param", "streamingObject", "input", "image", "to", "be", "processed", "*", "@", "param", "scratchFile", "input", "image", "to", "be", "processed", "*", "@", "param", "config", "TesseractOCRconfig", "class", "to", "get", "ImageMagick", "properties", "*", "@", "throws", "IOException", "if", "an", "input", "error", "occurred", "*", "@", "throws", "TikaException", "if", "an", "exception", "timed", "out", "*", "/", "private", "void", "processImage", "(", "File", "streamingObject", ",", "TesseractOCRConfig", "config", ")", "throws", "IOException", ",", "TikaException", "{", "private", "void", "processImage", "(", "File", "scratchFile", ",", "TesseractOCRConfig", "config", ")", "throws", "IOException", ",", "TikaException", "{", "/", "/", "fetch", "rotation", "script", "from", "resources", "InputStream", "in", "=", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "rotation", ".", "py", "\"", ");", "TemporaryResources", "tmp", "=", "new", "TemporaryResources", "(", ");", "File", "rotationScript", "=", "tmp", ".", "createTemporaryFile", "(", ");", "Files", ".", "copy", "(", "in", ",", "rotationScript", ".", "toPath", "(", "),", "StandardCopyOption", ".", "REPLACE_EXISTING", ")", ";", "String", "cmd", "=", "\"", "python", "-", "W", "ignore", "\"", "+", "rotationScript", ".", "getAbsolutePath", "(", ")", "+", "\"", "-", "f", "\"", "+", "streamingObject", ".", "getAbsolutePath", "(", ");", "CommandLine", "commandLine", "=", "new", "CommandLine", "(", "\"", "python", "\"", ");", "String", "[", "]", "args", "=", "{", "\"-", "W", "\"", ",", "\"", "ignore", "\"", ",", "rotationScript", ".", "getAbsolutePath", "(", "),", "\"", "-", "f", "\"", ",", "scratchFile", ".", "getAbsolutePath", "(", ")}", ";", "commandLine", ".", "addArguments", "(", "args", ",", "true", ")", ";", "String", "angle", "=", "\"", "0", "\"", ";", "DefaultExecutor", "executor", "=", "new", "DefaultExecutor", "(", ");", "@", "@", "-", "333", ",", "24", "+", "360", ",", "33", "@", "@", "private", "void", "processImage", "(", "File", "streamingObject", ",", "TesseractOCRConfig", "config", ")", "throw", "executor", ".", "setStreamHandler", "(", "streamHandler", ")", ";", "/", "/", "determine", "the", "angle", "of", "rotation", "required", "to", "make", "the", "text", "horizontal", "CommandLine", "cmdLine", "=", "CommandLine", ".", "parse", "(", "cmd", ")", ";", "if", "(", "config", ".", "getApplyRotation", "(", ")", "&", "&", "hasPython", "(", "))", "{", "try", "{", "executor", ".", "execute", "(", "cmdLine", ")", ";", "angle", "=", "outputStream", ".", "toString", "(", "\"", "UTF", "-", "8", "\"", ").", "trim", "(", ");", "executor", ".", "execute", "(", "commandLine", ")", ";", "String", "tmpAngle", "=", "outputStream", ".", "toString", "(", "\"", "UTF", "-", "8", "\"", ").", "trim", "(", ");", "/", "/", "verify", "that", "you", "'", "ve", "gotten", "a", "numeric", "value", "out", "Double", ".", "parseDouble", "(", "tmpAngle", ")", ";", "angle", "=", "tmpAngle", ";", "}", "catch", "(", "Exception", "e", ")", "{", "}", "}", "/", "/", "process", "the", "image", "-", "parameter", "values", "can", "be", "set", "in", "TesseractOCRConfig", ".", "properties", "String", "line", "=", "getImageMagickPath", "(", "config", ")", "+", "\"", "-", "density", "\"", "+", "config", ".", "getDensity", "(", ")", "+", "\"", "-", "depth", "\"", "+", "config", ".", "getDepth", "(", ")", "+", "\"", "-", "colorspace", "\"", "+", "config", ".", "getColorspace", "(", ")", "+", "\"", "-", "filter", "\"", "+", "config", ".", "getFilter", "(", ")", "+", "\"", "-", "resize", "\"", "+", "config", ".", "getResize", "(", ")", "+", "\"", "%", "-", "rotate", "\"", "+", "angle", "+", "\"", "\"", "+", "streamingObject", ".", "getAbsolutePath", "(", ")", "+", "\"", "\"", "+", "streamingObject", ".", "getAbsolutePath", "(", ");", "cmdLine", "=", "CommandLine", ".", "parse", "(", "line", ")", ";", "commandLine", "=", "new", "CommandLine", "(", "getImageMagickPath", "(", "config", ")", ");", "args", "=", "new", "String", "[", "]{", "\"", "-", "density", "\"", ",", "Integer", ".", "toString", "(", "config", ".", "getDensity", "(", "))", ",", "\"", "-", "depth", "\"", ",", "Integer", ".", "toString", "(", "config", ".", "getDepth", "(", "))", ",", "\"", "-", "colorspace", "\"", ",", "config", ".", "getColorspace", "(", "),", "\"", "-", "filter", "\"", ",", "config", ".", "getFilter", "(", "),", "\"", "-", "resize", "\"", ",", "config", ".", "getResize", "(", ")", "+", "\"", "%\"", ",", "\"", "-", "rotate", "\"", ",", "angle", ",", "scratchFile", ".", "getAbsolutePath", "(", "),", "scratchFile", ".", "getAbsolutePath", "(", ")", "}", ";", "commandLine", ".", "addArguments", "(", "args", ",", "true", ")", ";", "try", "{", "executor", ".", "execute", "(", "cmdLine", ")", ";", "executor", ".", "execute", "(", "commandLine", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "}", "@", "@", "-", "171", ",", "4", "+", "171", ",", "55", "@", "@", "public", "void", "testValidateResize", "(", ")", "{", "config", ".", "setResize", "(", "1000", ")", ";", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testDataPathCheck", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "setTessdataPath", "(", "\"", "blah", "\\", "u0000deblah", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testPathCheck", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "setTesseractPath", "(", "\"", "blah", "\\", "u0000deblah", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testBadOtherKey", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "addOtherTesseractConfig", "(", "\"", "bad", "bad", "\"", ",", "\"", "bad", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testBadOtherValue", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "addOtherTesseractConfig", "(", "\"", "bad", "\"", ",", "\"", "bad", "bad", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testBadOtherValueSlash", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "addOtherTesseractConfig", "(", "\"", "bad", "\"", ",", "\"", "bad", "\\", "\\", "bad", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testBadOtherValueControl", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "addOtherTesseractConfig", "(", "\"", "bad", "\"", ",", "\"", "bad", "\\", "u0001bad", "\"", ");", "}", "@", "Test", "public", "void", "testGoodOtherParameters", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "addOtherTesseractConfig", "(", "\"", "good", "\"", ",", "\"", "good", "\"", ");", "}", "@", "Test", "public", "void", "testBogusPathCheck", "(", ")", "{", "TesseractOCRConfig", "config", "=", "new", "TesseractOCRConfig", "(", ");", "config", ".", "setTesseractPath", "(", "\"", "blahdeblahblah", "\"", ");", "assertEquals", "(", "\"", "blahdeblahblah", "\"", ",", "config", ".", "getTesseractPath", "(", "))", ";", "}", "}", "@", "@", "-", "47", ",", "8", "+", "47", ",", "9", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "jaxrs", ".", "ext", ".", "multipart", ".", "Attachment", ";", "@", "@", "-", "67", ",", "7", "+", "68", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParserDecorator", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "PasswordProvider", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "html", ".", "BoilerpipeContentHandler", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "html", ".", "HtmlParser", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ocr", ".", "TesseractOCRConfig", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "pdf", ".", "PDFParserConfig", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "BodyContentHandler", ";", "@", "@", "-", "82", ",", "6", "+", "82", ",", "9", "@", "@", "@", "Path", "(", "\"/", "tika", "\"", ")", "public", "class", "TikaResource", "{", "private", "static", "Pattern", "ALLOWABLE_HEADER_CHARS", "=", "Pattern", ".", "compile", "(", "\"(", "?", "i", ")", "^[", "-", "_", "<", ">", "A", "-", "Z0", "-", "9", "]", "+$", "\")", ";", "public", "static", "final", "String", "GREETING", "=", "\"", "This", "is", "Tika", "Server", "(", "\"", "+", "new", "Tika", "(", ").", "toString", "(", ")", "+", "\"", ").", "Please", "PUT", "\\", "n", "\"", ";", "public", "static", "final", "String", "X_TIKA_OCR_HEADER_PREFIX", "=", "\"", "X", "-", "Tika", "-", "OCR", "\"", ";", "public", "static", "final", "String", "X_TIKA_PDF_HEADER_PREFIX", "=", "\"", "X", "-", "Tika", "-", "PDF", "\"", ";", "@", "@", "-", "190", ",", "40", "+", "193", ",", "88", "@", "@", "public", "static", "InputStream", "getInputStream", "(", "InputStream", "is", ",", "HttpHeaders", "headers", ")", "{", "*", "@", "throws", "WebApplicationException", "thrown", "when", "field", "cannot", "be", "found", ".", "*", "/", "private", "static", "void", "processHeaderConfig", "(", "MultivaluedMap", "<", "String", ",", "String", ">", "httpHeaders", ",", "Object", "object", ",", "String", "key", ",", "String", "prefix", ")", "{", "try", "{", "String", "property", "=", "StringUtils", ".", "removeStart", "(", "key", ",", "prefix", ")", ";", "String", "setter", "=", "property", ";", "setter", "=", "\"", "set", "\"", "+", "setter", ".", "substring", "(", "0", ",", "1", ")", ".", "toUpperCase", "(", "Locale", ".", "US", ")", "+", "setter", ".", "substring", "(", "1", ")", ";", "Field", "field", "=", "object", ".", "getClass", "(", ").", "getDeclaredField", "(", "StringUtils", ".", "uncapitalize", "(", "property", ")", ");", "/", "/", "default", "assume", "string", "class", "/", "/", "if", "there", "'", "s", "a", "more", "specific", "type", ",", "e", ".", "g", ".", "double", ",", "int", ",", "boolean", "/", "/", "try", "that", ".", "Class", "clazz", "=", "String", ".", "class", ";", "field", ".", "setAccessible", "(", "true", ")", ";", "if", "(", "field", ".", "getType", "(", ")", "=", "=", "String", ".", "class", ")", "{", "field", ".", "set", "(", "object", ",", "httpHeaders", ".", "getFirst", "(", "key", ")", ");", "}", "else", "if", "(", "field", ".", "getType", "(", ")", "=", "=", "int", ".", "class", ")", "{", "field", ".", "setInt", "(", "object", ",", "Integer", ".", "parseInt", "(", "httpHeaders", ".", "getFirst", "(", "key", ")", "))", ";", "if", "(", "field", ".", "getType", "(", ")", "=", "=", "int", ".", "class", ")", "{", "clazz", "=", "int", ".", "class", ";", "}", "else", "if", "(", "field", ".", "getType", "(", ")", "=", "=", "double", ".", "class", ")", "{", "field", ".", "setDouble", "(", "object", ",", "Double", ".", "parseDouble", "(", "httpHeaders", ".", "getFirst", "(", "key", ")", "))", ";", "clazz", "=", "double", ".", "class", ";", "}", "else", "if", "(", "field", ".", "getType", "(", ")", "=", "=", "boolean", ".", "class", ")", "{", "field", ".", "setBoolean", "(", "object", ",", "Boolean", ".", "parseBoolean", "(", "httpHeaders", ".", "getFirst", "(", "key", ")", "))", ";", "}", "else", "{", "/", "/", "couldn", "'", "t", "find", "a", "directly", "accessible", "field", "/", "/", "try", "for", "setX", "(", "String", "s", ")", "String", "setter", "=", "StringUtils", ".", "uncapitalize", "(", "property", ")", ";", "setter", "=", "\"", "set", "\"", "+", "setter", ".", "substring", "(", "0", ",", "1", ")", ".", "toUpperCase", "(", "Locale", ".", "US", ")", "+", "setter", ".", "substring", "(", "1", ")", ";", "Method", "m", "=", "null", ";", "try", "{", "m", "=", "object", ".", "getClass", "(", ").", "getMethod", "(", "setter", ",", "String", ".", "class", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "/", "/", "swallow", "}", "if", "(", "m", "!", "=", "null", ")", "{", "m", ".", "invoke", "(", "object", ",", "httpHeaders", ".", "getFirst", "(", "key", ")", ");", "clazz", "=", "boolean", ".", "class", ";", "}", "Method", "m", "=", "tryToGetMethod", "(", "object", ",", "setter", ",", "clazz", ")", ";", "/", "/", "if", "you", "couldn", "'", "t", "find", "more", "specific", "setter", ",", "back", "off", "/", "/", "to", "string", "setter", "and", "try", "that", ".", "if", "(", "m", "=", "=", "null", "&", "&", "clazz", "!", "=", "String", ".", "class", ")", "{", "m", "=", "tryToGetMethod", "(", "object", ",", "setter", ",", "String", ".", "class", ")", ";", "}", "if", "(", "m", "!", "=", "null", ")", "{", "String", "val", "=", "httpHeaders", ".", "getFirst", "(", "key", ")", ";", "val", "=", "val", ".", "trim", "(", ");", "if", "(", "clazz", "=", "=", "String", ".", "class", ")", "{", "checkTrustWorthy", "(", "setter", ",", "val", ")", ";", "m", ".", "invoke", "(", "object", ",", "val", ")", ";", "}", "else", "if", "(", "clazz", "=", "=", "int", ".", "class", ")", "{", "m", ".", "invoke", "(", "object", ",", "Integer", ".", "parseInt", "(", "val", ")", ");", "}", "else", "if", "(", "clazz", "=", "=", "double", ".", "class", ")", "{", "m", ".", "invoke", "(", "object", ",", "Double", ".", "parseDouble", "(", "val", ")", ");", "}", "else", "if", "(", "clazz", "=", "=", "boolean", ".", "class", ")", "{", "m", ".", "invoke", "(", "object", ",", "Boolean", ".", "parseBoolean", "(", "val", ")", ");", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "setter", "must", "be", "String", ",", "int", ",", "double", "or", "boolean", ".", "..", "for", "now", "\"", ");", "}", "}", "else", "{", "throw", "new", "NoSuchMethodException", "(", "\"", "Couldn", "'", "t", "find", ":", "\"", "+", "setter", ")", ";", "}", "}", "catch", "(", "Throwable", "ex", ")", "{", "throw", "new", "WebApplicationException", "(", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "\"", "%", "s", "is", "an", "invalid", "%", "s", "header", "\"", ",", "key", ",", "X_TIKA_OCR_HEADER_PREFIX", ")", ");", "}", "}", "private", "static", "void", "checkTrustWorthy", "(", "String", "setter", ",", "String", "val", ")", "{", "if", "(", "setter", "=", "=", "null", "|", "|", "val", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "setter", "and", "val", "must", "not", "be", "null", "\"", ");", "}", "if", "(", "setter", ".", "toLowerCase", "(", "Locale", ".", "US", ")", ".", "contains", "(", "\"", "trusted", "\"", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Can", "'", "t", "call", "a", "trusted", "method", "via", "tika", "-", "server", "headers", "\"", ");", "}", "Matcher", "m", "=", "ALLOWABLE_HEADER_CHARS", ".", "matcher", "(", "val", ")", ";", "if", "(", "!", "m", ".", "find", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Header", "val", ":", "\"", "+", "val", "+", "\"", "contains", "illegal", "characters", ".", "\"", "\"", "Must", "contain", ":", "TikaResource", ".", "ALLOWABLE_HEADER_CHARS", "\"", ");", "}", "}", "/", "**", "*", "Tries", "to", "get", "method", ".", "Silently", "swallows", "NoMethodException", "and", "returns", "*", "<", "code", ">", "null", "<", "/", "code", ">", "if", "not", "found", ".", "*", "@", "param", "object", "*", "@", "param", "method", "*", "@", "param", "clazz", "*", "@", "return", "*", "/", "private", "static", "Method", "tryToGetMethod", "(", "Object", "object", ",", "String", "method", ",", "Class", "clazz", ")", "{", "try", "{", "return", "object", ".", "getClass", "(", ").", "getMethod", "(", "method", ",", "clazz", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "/", "/", "swallow", "}", "return", "null", ";", "}", "@", "SuppressWarnings", "(", "\"", "serial", "\"", ")", "public", "static", "void", "fillMetadata", "(", "Parser", "parser", ",", "Metadata", "metadata", ",", "ParseContext", "context", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "httpHeaders", ")", "{", "String", "fileName", "=", "detectFilename", "(", "httpHeaders", ")", ";", "@", "@", "-", "279", ",", "4", "+", "279", ",", "26", "@", "@", "public", "void", "testExtractTextAcceptPlainText", "(", ")", "throws", "Exception", "{", "responseMsg", ")", ";", "}", "@", "Test", "public", "void", "testDataIntegrityCheck", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "WebClient", ".", "create", "(", "endPoint", "+", "TIKA_PATH", ")", ".", "type", "(", "\"", "application", "/", "pdf", "\"", ")", ".", "accept", "(", "\"", "text", "/", "plain", "\"", ")", ".", "header", "(", "TikaResource", ".", "X_TIKA_OCR_HEADER_PREFIX", "\"", "tesseractPath", "\"", ",", "\"", "C", ":", "//", "tmp", "/", "/", "hello", ".", "bat", "\\", "u0000", "\"", ")", ".", "put", "(", "ClassLoader", ".", "getSystemResourceAsStream", "(", "\"", "testOCR", ".", "pdf", "\"", "))", ";", "assertEquals", "(", "500", ",", "response", ".", "getStatus", "(", "))", ";", "response", "=", "WebClient", ".", "create", "(", "endPoint", "+", "TIKA_PATH", ")", ".", "type", "(", "\"", "application", "/", "pdf", "\"", ")", ".", "accept", "(", "\"", "text", "/", "plain", "\"", ")", ".", "header", "(", "TikaResource", ".", "X_TIKA_OCR_HEADER_PREFIX", "\"", "tesseractPath", "\"", ",", "\"", "bogus", "path", "\"", ")", ".", "put", "(", "ClassLoader", ".", "getSystemResourceAsStream", "(", "\"", "testOCR", ".", "pdf", "\"", "))", ";", "assertEquals", "(", "200", ",", "response", ".", "getStatus", "(", "))", ";", "}", "}"], "docstring_tokens": ["sending", "specially", "crafted", "headers"]}
{"contents": ["x86:", "save/restore", "eflags", "in", "context", "switch", "(And", "reset", "it", "on", "new", "thread", "creation)", "It", "turns", "out", "that", "eflags", "is", "important", "to", "save", "and", "restore", "not", "just", "because", "of", "iopl,", "but", "due", "to", "the", "magic", "bits", "like", "the", "NT", "bit,", "which", "we", "don't", "want", "leaking", "between", "different", "threads.", "Tested-by:", "Mike", "Galbraith", "<efault@gmx.de>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "209", ",", "6", "+", "209", ",", "10", "@", "@", "ENTRY", "(", "ret_from_fork", ")", "GET_THREAD_INFO", "(", "%", "ebp", ")", "popl", "%", "eax", "CFI_ADJUST_CFA_OFFSET", "-", "4", "pushl", "$", "0x0202", "#", "Reset", "kernel", "eflags", "CFI_ADJUST_CFA_OFFSET", "4", "popfl", "CFI_ADJUST_CFA_OFFSET", "-", "4", "jmp", "syscall_exit", "CFI_ENDPROC", "@", "@", "-", "11", ",", "16", "+", "11", ",", "22", "@", "@", "struct", "task_struct", ";", "/", "*", "one", "of", "the", "stranger", "aspects", "of", "C", "forward", "declarations", ".", ".", "*", "/", "extern", "struct", "task_struct", "*", "FASTCALL", "(", "__switch_to", "(", "struct", "task_struct", "*", "prev", ",", "struct", "task_struct", "*", "next", ")", ");", "/", "*", "*", "Saving", "eflags", "is", "important", ".", "It", "switches", "not", "only", "IOPL", "between", "tasks", ",", "*", "it", "also", "protects", "other", "tasks", "from", "NT", "leaking", "through", "sysenter", "etc", ".", "*", "/", "#", "define", "switch_to", "(", "prev", ",", "next", ",", "last", ")", "do", "{", "\\", "unsigned", "long", "esi", ",", "edi", ";", "\\", "asm", "volatile", "(", "\"", "pushl", "%", "%", "ebp", "\\", "n", "\\", "t", "\"", "\\", "asm", "volatile", "(", "\"", "pushfl", "\\", "n", "\\", "t", "\"", "/", "*", "Save", "flags", "*", "/", "\\", "\"", "pushl", "%", "%", "ebp", "\\", "n", "\\", "t", "\"", "\\", "\"", "movl", "%", "%", "esp", ",", "%", "0", "\\", "n", "\\", "t", "\"", "/", "*", "save", "ESP", "*", "/", "\\", "\"", "movl", "%", "5", ",", "%%", "esp", "\\", "n", "\\", "t", "\"", "/", "*", "restore", "ESP", "*", "/", "\\", "\"", "movl", "$", "1f", ",", "%", "1", "\\", "n", "\\", "t", "\"", "/", "*", "save", "EIP", "*", "/", "\\", "\"", "pushl", "%", "6", "\\", "n", "\\", "t", "\"", "/", "*", "restore", "EIP", "*", "/", "\\", "\"", "jmp", "__switch_to", "\\", "n", "\"", "\\", "\"", "1", ":", "\\", "t", "\"", "\\", "\"", "popl", "%", "%", "ebp", "\\", "n", "\\", "t", "\"", "\\", "\"", "popfl", "\"", "\\", ":", "\"=", "m", "\"", "(", "prev", "-", ">", "thread", ".", "esp", ")", ",\"", "=", "m", "\"", "(", "prev", "-", ">", "thread", ".", "eip", ")", ",", "\\", "\"", "=", "a", "\"", "(", "last", ")", ",\"", "=", "S", "\"", "(", "esi", ")", ",\"", "=", "D", "\"", "(", "edi", ")", "\\", ":", "\"", "m", "\"", "(", "next", "-", ">", "thread", ".", "esp", ")", ",\"", "m", "\"", "(", "next", "-", ">", "thread", ".", "eip", ")", ",", "\\"], "docstring_tokens": ["initiating", "a", "specially-crafted", "executable"]}
{"contents": ["bridge:", "netfilter:", "fix", "information", "leak", "Struct", "tmp", "is", "copied", "from", "userspace.", "It", "is", "not", "checked", "whether", "the", "\"name\"", "field", "is", "NULL", "terminated.", "This", "may", "lead", "to", "buffer", "overflow", "and", "passing", "contents", "of", "kernel", "stack", "as", "a", "module", "name", "to", "try_then_request_module()", "and,", "consequently,", "to", "modprobe", "commandline.", "It", "would", "be", "seen", "by", "all", "userspace", "processes.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segoon@openwall.com>", "Signed-off-by:", "Patrick", "McHardy", "<kaber@trash.net>"], "code_tokens": ["@", "@", "-", "1107", ",", "6", "+", "1107", ",", "8", "@", "@", "static", "int", "do_replace", "(", "struct", "net", "*", "net", ",", "const", "void", "__user", "*", "user", ",", "if", "(", "tmp", ".", "num_counters", ">", "=", "INT_MAX", "/", "sizeof", "(", "struct", "ebt_counter", ")", ")", "return", "-", "ENOMEM", ";", "tmp", ".", "name", "[", "sizeof", "(", "tmp", ".", "name", ")", "-", "1", "]", "=", "0", ";", "countersize", "=", "COUNTER_OFFSET", "(", "tmp", ".", "nentries", ")", "*", "nr_cpu_ids", ";", "newinfo", "=", "vmalloc", "(", "sizeof", "(", "*", "newinfo", ")", "+", "countersize", ")", ";", "if", "(", "!", "newinfo", ")"], "docstring_tokens": ["creating", "a", "device", "with", "a", "name", "made", "of", "contents", "of", "kernel", "stack"]}
{"contents": ["[SECURITY-1266]", "Block", "problematic", "AST", "transforms", "from", "sandbox"], "code_tokens": ["@", "@", "-", "25", ",", "9", "+", "25", ",", "12", "@", "@", "package", "org", ".", "jenkinsci", ".", "plugins", ".", "scriptsecurity", ".", "sandbox", ".", "groovy", ";", "import", "edu", ".", "umd", ".", "cs", ".", "findbugs", ".", "annotations", ".", "SuppressFBWarnings", ";", "import", "groovy", ".", "grape", ".", "GrabAnnotationTransformation", ";", "import", "groovy", ".", "lang", ".", "GroovyShell", ";", "import", "groovy", ".", "lang", ".", "Script", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Callable", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilerConfiguration", ";", "@", "@", "-", "58", ",", "11", "+", "61", ",", "21", "@", "@", "*", "@", "return", "a", "compiler", "configuration", "set", "up", "to", "use", "the", "sandbox", "*", "/", "public", "static", "@", "Nonnull", "CompilerConfiguration", "createSecureCompilerConfiguration", "(", ")", "{", "CompilerConfiguration", "cc", "=", "new", "CompilerConfiguration", "(", ");", "CompilerConfiguration", "cc", "=", "createBaseCompilerConfiguration", "(", ");", "cc", ".", "addCompilationCustomizers", "(", "new", "SandboxTransformer", "(", "))", ";", "return", "cc", ";", "}", "/", "**", "*", "Prepares", "a", "compiler", "configuration", "that", "rejects", "certain", "AST", "transformations", ".", "Used", "by", "{", "@", "link", "#", "createSecureCompilerConfiguration", "(", ")}", ".", "*", "/", "public", "static", "@", "Nonnull", "CompilerConfiguration", "createBaseCompilerConfiguration", "(", ")", "{", "CompilerConfiguration", "cc", "=", "new", "CompilerConfiguration", "(", ");", "cc", ".", "addCompilationCustomizers", "(", "new", "RejectASTTransformsCustomizer", "(", "))", ";", "cc", ".", "setDisabledGlobalASTTransformations", "(", "new", "HashSet", "<", ">(", "Collections", ".", "singletonList", "(", "GrabAnnotationTransformation", ".", "class", ".", "getName", "(", "))", "))", ";", "return", "cc", ";", "}", "/", "**", "*", "Prepares", "a", "classloader", "for", "Groovy", "shell", "for", "sandboxing", ".", "*", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "org", ".", "jenkinsci", ".", "plugins", ".", "scriptsecurity", ".", "sandbox", ".", "groovy", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableList", ";", "import", "groovy", ".", "lang", ".", "Grab", ";", "import", "groovy", ".", "transform", ".", "ASTTest", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "AnnotatedNode", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "AnnotationNode", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "ClassCodeVisitorSupport", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "ClassNode", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "classgen", ".", "GeneratorContext", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilationFailedException", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilePhase", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "SourceUnit", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "customizers", ".", "CompilationCustomizer", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "util", ".", "List", ";", "public", "class", "RejectASTTransformsCustomizer", "extends", "CompilationCustomizer", "{", "private", "static", "final", "List", "<", "Class", "<", "?", "extends", "Annotation", ">", ">", "BLOCKED_TRANSFORMS", "=", "ImmutableList", ".", "of", "(", "ASTTest", ".", "class", ",", "Grab", ".", "class", ")", ";", "public", "RejectASTTransformsCustomizer", "(", ")", "{", "super", "(", "CompilePhase", ".", "CONVERSION", ")", ";", "}", "@", "Override", "public", "void", "call", "(", "final", "SourceUnit", "source", ",", "GeneratorContext", "context", ",", "ClassNode", "classNode", ")", "throws", "CompilationFailedException", "{", "new", "RejectASTTransformsVisitor", "(", "source", ")", ".", "visitClass", "(", "classNode", ")", ";", "}", "private", "static", "class", "RejectASTTransformsVisitor", "extends", "ClassCodeVisitorSupport", "{", "private", "SourceUnit", "source", ";", "public", "RejectASTTransformsVisitor", "(", "SourceUnit", "source", ")", "{", "this", ".", "source", "=", "source", ";", "}", "@", "Override", "protected", "SourceUnit", "getSourceUnit", "(", ")", "{", "return", "source", ";", "}", "/", "**", "*", "If", "the", "node", "is", "annotated", "with", "one", "of", "the", "blocked", "transform", "annotations", ",", "throw", "a", "security", "exception", ".", "*", "*", "@", "param", "node", "the", "node", "to", "process", "*", "/", "@", "Override", "public", "void", "visitAnnotations", "(", "AnnotatedNode", "node", ")", "{", "for", "(", "AnnotationNode", "an", ":", "node", ".", "getAnnotations", "(", "))", "{", "for", "(", "Class", "<", "?", "extends", "Annotation", ">", "blockedAnnotation", ":", "BLOCKED_TRANSFORMS", ")", "{", "if", "(", "blockedAnnotation", ".", "getSimpleName", "(", ").", "equals", "(", "an", ".", "getClassNode", "(", ").", "getName", "(", "))", ")", "{", "throw", "new", "SecurityException", "(", "\"", "Annotation", "\"", "+", "blockedAnnotation", ".", "getSimpleName", "(", ")", "+", "\"", "cannot", "be", "used", "in", "the", "sandbox", ".", "\")", ";", "}", "}", "}", "}", "}", "}", "@", "@", "-", "74", ",", "12", "+", "74", ",", "15", "@", "@", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "ErrorCollector", ";", "import", "org", ".", "junit", ".", "rules", ".", "ExpectedException", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "public", "class", "SandboxInterceptorTest", "{", "@", "Rule", "public", "ErrorCollector", "errors", "=", "new", "ErrorCollector", "(", ");", "@", "Rule", "public", "ExpectedException", "thrown", "=", "ExpectedException", ".", "none", "(", ");", "@", "Test", "public", "void", "genericWhitelist", "(", ")", "throws", "Exception", "{", "assertEvaluate", "(", "new", "GenericWhitelist", "(", "),", "3", ",", "\"", "'", "foo", "bar", "baz", "'", ".", "split", "(", "'", "'", ").", "length", "\"", ");", "assertEvaluate", "(", "new", "GenericWhitelist", "(", "),", "false", ",", "\"", "def", "x", "=", "null", ";", "x", "!", "=", "null", "\"", ");", "@", "@", "-", "818", ",", "6", "+", "821", ",", "30", "@", "@", "public", "void", "explode", "(", ")", "{", "}", "assertRejected", "(", "new", "StaticWhitelist", "(", "),", "\"", "staticMethod", "hudson", ".", "model", ".", "Hudson", "getInstance", "\"", ",", "\"", "hudson", ".", "model", ".", "Hudson", ".", "instance", "\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1266", "\"", ")", "@", "Test", "public", "void", "blockedASTTransformsASTTest", "(", ")", "throws", "Exception", "{", "GroovyShell", "shell", "=", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ";", "thrown", ".", "expect", "(", "MultipleCompilationErrorsException", ".", "class", ")", ";", "thrown", ".", "expectMessage", "(", "\"", "Annotation", "ASTTest", "cannot", "be", "used", "in", "the", "sandbox", "\"", ");", "shell", ".", "parse", "(", "\"", "import", "groovy", ".", "transform", ".", "*\\", "n", "\"", "\"", "@", "ASTTest", "(", "value", "=", "{", "assert", "true", "}", ")\\", "n", "\"", "\"", "@", "Field", "int", "x", "\\", "n", "\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1266", "\"", ")", "@", "Test", "public", "void", "blockedASTTransformsGrab", "(", ")", "throws", "Exception", "{", "GroovyShell", "shell", "=", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ";", "thrown", ".", "expect", "(", "MultipleCompilationErrorsException", ".", "class", ")", ";", "thrown", ".", "expectMessage", "(", "\"", "Annotation", "Grab", "cannot", "be", "used", "in", "the", "sandbox", "\"", ");", "shell", ".", "parse", "(", "\"@", "Grab", "(", "group", "=", "'", "foo", "'", ",", "module", "=", "'", "bar", "'", ",", "version", "=", "'", "1", ".", "0", "'", ")\\", "n", "\"", "\"", "def", "foo", "\\", "n", "\"", ");", "}", "private", "static", "Object", "evaluate", "(", "Whitelist", "whitelist", ",", "String", "script", ")", "{", "GroovyShell", "shell", "=", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ";", "Object", "actual", "=", "GroovySandbox", ".", "run", "(", "shell", ".", "parse", "(", "script", ")", ",", "whitelist", ")", ";"], "docstring_tokens": ["applying", "AST", "transforming", "annotations", "such", "as", "@Grab", "to", "source", "code", "elements"]}
{"contents": ["[SECURITY-1902]"], "code_tokens": ["@", "@", "-", "23", ",", "4", "+", "23", ",", "4", "@", "@", "THE", "SOFTWARE", ".", "-", "->", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "l", ":", "icon", "class", "=", "\"", "icon", "-", "lock", "icon", "-", "sm", "\"", "tooltip", "=", "\"$", "{%", "Keep", "this", "build", "forever", "}", ":&", "lt", ";", "br", "/", "&", "gt", ";", "${", "build", ".", "whyKeepLog", "}", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "/>", "<", "l", ":", "icon", "class", "=", "\"", "icon", "-", "lock", "icon", "-", "sm", "\"", "tooltip", "=", "\"$", "{%", "Keep", "this", "build", "forever", "}", ":&", "lt", ";", "br", "/", "&", "gt", ";", "${", "h", ".", "xmlEscape", "(", "build", ".", "whyKeepLog", ")", "}\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "/>", "@", "@", "-", "0", ",", "0", "+", "1", ",", "160", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2004", "-", "2009", ",", "Sun", "Microsystems", ",", "Inc", ".", ",", "Kohsuke", "Kawaguchi", ",", "Jorg", "Heymans", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "ScriptResult", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "Launcher", ";", "import", "hudson", ".", "tasks", ".", "BuildTrigger", ";", "import", "hudson", ".", "tasks", ".", "Builder", ";", "import", "hudson", ".", "tasks", ".", "Fingerprinter", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "instanceOf", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "RunSEC1902Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "1902", "\"", ")", "@", "Test", "public", "void", "preventXssInBadgeTooltip", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setQuietPeriod", "(", "0", ")", ";", "/", "*", "*", "The", "scenario", "to", "trigger", "is", "to", "have", "a", "build", "protected", "from", "deletion", "because", "of", "an", "upstream", "protected", "build", ".", "*", "Once", "we", "have", "that", "condition", ",", "we", "need", "to", "ensure", "the", "upstream", "project", "has", "a", "dangerous", "name", "*", "/", "FreeStyleProject", "up", "=", "j", ".", "createFreeStyleProject", "(", "\"", "up", "\"", ");", "up", ".", "getBuildersList", "(", ").", "add", "(", "new", "WriteFileStep", "(", "))", ";", "up", ".", "getPublishersList", "(", ").", "add", "(", "new", "Fingerprinter", "(", "\"*", "*/", "*\"", "))", ";", "FullNameChangingProject", "down", "=", "j", ".", "createProject", "(", "FullNameChangingProject", ".", "class", ",", "\"", "down", "\"", ");", "down", ".", "getBuildersList", "(", ").", "add", "(", "new", "WriteFileStep", "(", "))", ";", "down", ".", "getPublishersList", "(", ").", "add", "(", "new", "Fingerprinter", "(", "\"*", "*/", "*\"", "))", ";", "/", "/", "protected", "field", ",", "we", "are", "in", "the", "same", "package", "down", ".", "keepDependencies", "=", "true", ";", "up", ".", "getPublishersList", "(", ").", "add", "(", "new", "BuildTrigger", "(", "down", ".", "getFullName", "(", "),", "false", ")", ");", "j", ".", "jenkins", ".", "rebuildDependencyGraph", "(", ");", "FreeStyleBuild", "upBuild", "=", "j", ".", "buildAndAssertSuccess", "(", "up", ")", ";", "j", ".", "waitUntilNoActivity", "(", ");", "CustomBuild", "downBuild", "=", "down", ".", "getBuilds", "(", ").", "getLastBuild", "(", ");", "assertNotNull", "(", "\"", "The", "down", "build", "must", "exist", ",", "otherwise", "the", "up", "'", "s", "one", "is", "not", "protected", ".", "\",", "downBuild", ")", ";", "/", "/", "updating", "the", "name", "before", "the", "build", "is", "problematic", "under", "Windows", "/", "/", "so", "we", "are", "updating", "internal", "stuff", "manually", "String", "newName", "=", "\"", "Down", "<", "img", "src", "=", "x", "onerror", "=", "alert", "(", "123", ")", ">", "Project", "\"", ";", "down", ".", "setVirtualName", "(", "newName", ")", ";", "Fingerprint", "f", "=", "upBuild", ".", "getAction", "(", "Fingerprinter", ".", "FingerprintAction", ".", "class", ")", ".", "getFingerprints", "(", ").", "get", "(", "\"", "test", ".", "txt", "\"", ");", "f", ".", "add", "(", "newName", ",", "1", ")", ";", "/", "/", "keeping", "the", "minimum", "to", "validate", "it", "'", "s", "working", "and", "it", "'", "s", "not", "exploitable", "as", "there", "are", "some", "modifications", "/", "/", "like", "adding", "double", "quotes", "ensureXssIsPrevented", "(", "up", ",", "\"", "Down", "\"", ",", "\"", "<", "img", "\"", ");", "}", "private", "void", "ensureXssIsPrevented", "(", "FreeStyleProject", "upProject", ",", "String", "validationPart", ",", "String", "dangerousPart", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "HtmlPage", "htmlPage", "=", "wc", ".", "goTo", "(", "upProject", ".", "getUrl", "(", "))", ";", "/", "/", "trigger", "the", "tooltip", "display", "htmlPage", ".", "executeJavaScript", "(", "\"", "document", ".", "querySelector", "(", "'#", "buildHistory", "table", ".", "build", "-", "badge", "img", "'", ").", "dispatchEvent", "(", "new", "Event", "(", "'", "mouseover", "'", "))", ";\"", ");", "wc", ".", "waitForBackgroundJavaScript", "(", "500", ")", ";", "ScriptResult", "result", "=", "htmlPage", ".", "executeJavaScript", "(", "\"", "document", ".", "querySelector", "(", "'#", "tt", "'", ").", "innerHTML", ";", "\")", ";", "Object", "jsResult", "=", "result", ".", "getJavaScriptResult", "(", ");", "assertThat", "(", "jsResult", ",", "instanceOf", "(", "String", ".", "class", ")", ");", "String", "jsResultString", "=", "(", "String", ")", "jsResult", ";", "assertThat", "(", "\"", "The", "tooltip", "does", "not", "work", "as", "expected", "\"", ",", "jsResultString", ",", "containsString", "(", "validationPart", ")", ");", "assertThat", "(", "\"", "XSS", "not", "prevented", "\"", ",", "jsResultString", ",", "not", "(", "containsString", "(", "dangerousPart", ")", "))", ";", "}", "public", "static", "class", "WriteFileStep", "extends", "Builder", "{", "@", "Override", "public", "boolean", "perform", "(", "AbstractBuild", "<", "?,", "?", ">", "build", ",", "Launcher", "launcher", ",", "BuildListener", "listener", ")", "throws", "InterruptedException", ",", "IOException", "{", "build", ".", "getWorkspace", "(", ").", "child", "(", "\"", "test", ".", "txt", "\"", ").", "write", "(", "\"", "123", "\"", ",", "StandardCharsets", ".", "UTF_8", ".", "name", "(", "))", ";", "return", "true", ";", "}", "}", "public", "static", "class", "CustomBuild", "extends", "Build", "<", "FullNameChangingProject", ",", "CustomBuild", ">", "{", "public", "CustomBuild", "(", "FullNameChangingProject", "job", ")", "throws", "IOException", "{", "super", "(", "job", ")", ";", "}", "}", "static", "class", "FullNameChangingProject", "extends", "Project", "<", "FullNameChangingProject", ",", "CustomBuild", ">", "implements", "TopLevelItem", "{", "private", "volatile", "String", "virtualName", ";", "public", "FullNameChangingProject", "(", "ItemGroup", "parent", ",", "String", "name", ")", "{", "super", "(", "parent", ",", "name", ")", ";", "}", "public", "void", "setVirtualName", "(", "String", "virtualName", ")", "{", "this", ".", "virtualName", "=", "virtualName", ";", "}", "@", "Override", "public", "String", "getName", "(", ")", "{", "if", "(", "virtualName", "!", "=", "null", ")", "{", "return", "virtualName", ";", "}", "else", "{", "return", "super", ".", "getName", "(", ");", "}", "}", "@", "Override", "protected", "Class", "<", "CustomBuild", ">", "getBuildClass", "(", ")", "{", "return", "CustomBuild", ".", "class", ";", "}", "@", "Override", "public", "TopLevelItemDescriptor", "getDescriptor", "(", ")", "{", "return", "(", "FreeStyleProject", ".", "DescriptorImpl", ")", "Jenkins", ".", "get", "(", ").", "getDescriptorOrDie", "(", "getClass", "(", "))", ";", "}", "@", "TestExtension", "(", "\"", "preventXssInBadgeTooltip", "\"", ")", "public", "static", "class", "DescriptorImpl", "extends", "AbstractProjectDescriptor", "{", "@", "Override", "public", "FullNameChangingProject", "newInstance", "(", "ItemGroup", "parent", ",", "String", "name", ")", "{", "return", "new", "FullNameChangingProject", "(", "parent", ",", "name", ")", ";", "}", "}", "}", "}"], "docstring_tokens": ["using", "project-based", "matrix", "authorization"]}
{"contents": ["Tweak", "XmlInputFactory", "settings"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2010", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2010", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "math", ".", "BigDecimal", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "OutputKeys", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "@", "@", "-", "48", ",", "7", "+", "49", ",", "10", "@", "@", "protected", "Marshaller", "getMarshaller", "(", ")", "throws", "Exception", "{", "public", "static", "String", "getTextFromSource", "(", "Source", "source", ")", "{", "try", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "transformerFactory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_STYLESHEET", ",", "\"", "\")", ";", "Transformer", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "transformer", ".", "setOutputProperty", "(", "OutputKeys", ".", "INDENT", ",", "\"", "yes", "\"", ");", "StreamResult", "stream", "=", "new", "StreamResult", "(", "new", "StringWriter", "(", "))", ";", "transformer", ".", "transform", "(", "source", ",", "stream", ")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2006", "-", "2007", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2006", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "54", ",", "6", "+", "54", ",", "7", "@", "@", "*", "The", "implementation", "is", "<", "b", ">", "not", "<", "/", "b", ">", "thread", "-", "safe", ".", "*", "*", "@", "author", "Robert", "Kasanicky", "*", "@", "author", "Mahmoud", "Ben", "Hassine", "*", "/", "public", "class", "StaxEventItemReader", "<", "T", ">", "extends", "AbstractItemCountingItemStreamItemReader", "<", "T", ">", "implements", "ResourceAwareItemReaderItemStream", "<", "T", ">", ",", "InitializingBean", "{", "@", "@", "-", "76", ",", "6", "+", "77", ",", "8", "@", "@", "private", "boolean", "strict", "=", "true", ";", "private", "XMLInputFactory", "xmlInputFactory", "=", "StaxUtils", ".", "createXmlInputFactory", "(", ");", "public", "StaxEventItemReader", "(", ")", "{", "setName", "(", "ClassUtils", ".", "getShortName", "(", "StaxEventItemReader", ".", "class", ")", ");", "}", "@", "@", "-", "118", ",", "6", "+", "121", ",", "15", "@", "@", "public", "void", "setFragmentRootElementNames", "(", "String", "[", "]", "fragmentRootElementNames", ")", "{", "}", "}", "/", "**", "*", "Set", "the", "{", "@", "link", "XMLInputFactory", "}", ".", "*", "@", "param", "xmlInputFactory", "to", "use", "*", "/", "public", "void", "setXmlInputFactory", "(", "XMLInputFactory", "xmlInputFactory", ")", "{", "Assert", ".", "notNull", "(", "xmlInputFactory", ",", "\"", "XMLInputFactory", "must", "not", "be", "null", "\"", ");", "this", ".", "xmlInputFactory", "=", "xmlInputFactory", ";", "}", "/", "**", "*", "Ensure", "that", "all", "required", "dependencies", "for", "the", "ItemReader", "to", "run", "are", "provided", "after", "all", "properties", "have", "been", "set", ".", "*", "@", "@", "-", "208", ",", "7", "+", "220", ",", "7", "@", "@", "protected", "void", "doOpen", "(", ")", "throws", "Exception", "{", "}", "inputStream", "=", "resource", ".", "getInputStream", "(", ");", "eventReader", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLEventReader", "(", "inputStream", ")", ";", "eventReader", "=", "xmlInputFactory", ".", "createXMLEventReader", "(", "inputStream", ")", ";", "fragmentReader", "=", "new", "DefaultFragmentEventReader", "(", "eventReader", ")", ";", "noInput", "=", "false", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2006", "-", "2007", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2006", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "stream", ".", "XMLEventReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLEventWriter", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "@", "@", "-", "31", ",", "6", "+", "32", ",", "7", "@", "@", "*", "This", "class", "is", "thread", "-", "safe", ".", "*", "*", "@", "author", "Josh", "Long", "*", "@", "author", "Mahmoud", "Ben", "Hassine", "*", "*", "/", "public", "abstract", "class", "StaxUtils", "{", "@", "@", "-", "42", ",", "4", "+", "44", ",", "11", "@", "@", "public", "static", "Source", "getSource", "(", "XMLEventReader", "r", ")", "throws", "XMLStreamException", "{", "public", "static", "Result", "getResult", "(", "XMLEventWriter", "w", ")", "{", "return", "new", "StAXResult", "(", "w", ")", ";", "}", "public", "static", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "XMLInputFactory", "xmlInputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "xmlInputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "false", ")", ";", "xmlInputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "xmlInputFactory", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2017", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "19", ",", "7", "+", "19", ",", "10", "@", "@", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "org", ".", "springframework", ".", "batch", ".", "item", ".", "xml", ".", "StaxEventItemReader", ";", "import", "org", ".", "springframework", ".", "batch", ".", "item", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "oxm", ".", "Unmarshaller", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "@", "@", "-", "50", ",", "6", "+", "53", ",", "8", "@", "@", "private", "int", "currentItemCount", ";", "private", "XMLInputFactory", "xmlInputFactory", "=", "StaxUtils", ".", "createXmlInputFactory", "(", ");", "/", "**", "*", "Configure", "if", "the", "state", "of", "the", "{", "@", "link", "org", ".", "springframework", ".", "batch", ".", "item", ".", "ItemStreamSupport", "}", "*", "should", "be", "persisted", "within", "the", "{", "@", "link", "org", ".", "springframework", ".", "batch", ".", "item", ".", "ExecutionContext", "}", "@", "@", "-", "175", ",", "6", "+", "180", ",", "19", "@", "@", "return", "this", ";", "}", "/", "**", "*", "Set", "the", "{", "@", "link", "XMLInputFactory", "}", ".", "*", "*", "@", "param", "xmlInputFactory", "to", "use", "*", "@", "return", "The", "current", "instance", "of", "the", "builder", "*", "@", "see", "StaxEventItemReader", "#", "setXmlInputFactory", "(", "XMLInputFactory", ")", "*", "/", "public", "StaxEventItemReaderBuilder", "<", "T", ">", "xmlInputFactory", "(", "XMLInputFactory", "xmlInputFactory", ")", "{", "this", ".", "xmlInputFactory", "=", "xmlInputFactory", ";", "return", "this", ";", "}", "/", "**", "*", "Validates", "the", "configuration", "and", "builds", "a", "new", "{", "@", "link", "StaxEventItemReader", "}", "*", "@", "@", "-", "203", ",", "6", "+", "221", ",", "7", "@", "@", "reader", ".", "setUnmarshaller", "(", "this", ".", "unmarshaller", ")", ";", "reader", ".", "setCurrentItemCount", "(", "this", ".", "currentItemCount", ")", ";", "reader", ".", "setMaxItemCount", "(", "this", ".", "maxItemCount", ")", ";", "reader", ".", "setXmlInputFactory", "(", "this", ".", "xmlInputFactory", ")", ";", "return", "reader", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2008", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2008", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "15", ",", "6", "+", "15", ",", "8", "@", "@", "*", "/", "package", "org", ".", "springframework", ".", "batch", ".", "item", ".", "xml", ";", "import", "org", ".", "hamcrest", ".", "Matchers", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "batch", ".", "item", ".", "ExecutionContext", ";", "@", "@", "-", "33", ",", "12", "+", "35", ",", "12", "@", "@", "import", "javax", ".", "xml", ".", "namespace", ".", "QName", ";", "import", "javax", ".", "xml", ".", "stream", ".", "FactoryConfigurationError", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLEventReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "events", ".", "EndElement", ";", "import", "javax", ".", "xml", ".", "stream", ".", "events", ".", "StartElement", ";", "import", "javax", ".", "xml", ".", "stream", ".", "events", ".", "XMLEvent", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "@", "@", "-", "56", ",", "6", "+", "58", ",", "8", "@", "@", "*", "Tests", "for", "{", "@", "link", "StaxEventItemReader", "}", ".", "*", "*", "@", "author", "Robert", "Kasanicky", "*", "@", "author", "Michael", "Minella", "*", "@", "author", "Mahmoud", "Ben", "Hassine", "*", "/", "public", "class", "StaxEventItemReaderTests", "{", "@", "@", "-", "329", ",", "7", "+", "333", ",", "7", "@", "@", "public", "void", "testMultiFragmentNestedRestart", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testMoveCursorToNextFragment", "(", ")", "throws", "XMLStreamException", ",", "FactoryConfigurationError", ",", "IOException", "{", "Resource", "resource", "=", "new", "ByteArrayResource", "(", "xml", ".", "getBytes", "(", "))", ";", "XMLEventReader", "reader", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLEventReader", "(", "resource", ".", "getInputStream", "(", "))", ";", "XMLEventReader", "reader", "=", "StaxUtils", ".", "createXmlInputFactory", "(", ").", "createXMLEventReader", "(", "resource", ".", "getInputStream", "(", "))", ";", "final", "int", "EXPECTED_NUMBER_OF_FRAGMENTS", "=", "2", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "EXPECTED_NUMBER_OF_FRAGMENTS", ";", "i", "+", "+)", "{", "@", "@", "-", "346", ",", "7", "+", "350", ",", "7", "@", "@", "public", "void", "testMoveCursorToNextFragment", "(", ")", "throws", "XMLStreamException", ",", "FactoryCon", "@", "Test", "public", "void", "testMoveCursorToNextFragmentOnEmpty", "(", ")", "throws", "XMLStreamException", ",", "FactoryConfigurationError", ",", "IOException", "{", "Resource", "resource", "=", "new", "ByteArrayResource", "(", "emptyXml", ".", "getBytes", "(", "))", ";", "XMLEventReader", "reader", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLEventReader", "(", "resource", ".", "getInputStream", "(", "))", ";", "XMLEventReader", "reader", "=", "StaxUtils", ".", "createXmlInputFactory", "(", ").", "createXMLEventReader", "(", "resource", ".", "getInputStream", "(", "))", ";", "assertFalse", "(", "source", ".", "moveCursorToNextFragment", "(", "reader", ")", ");", "}", "@", "@", "-", "357", ",", "7", "+", "361", ",", "7", "@", "@", "public", "void", "testMoveCursorToNextFragmentOnEmpty", "(", ")", "throws", "XMLStreamException", ",", "Fac", "@", "Test", "public", "void", "testMoveCursorToNextFragmentOnMissing", "(", ")", "throws", "XMLStreamException", ",", "FactoryConfigurationError", ",", "IOException", "{", "Resource", "resource", "=", "new", "ByteArrayResource", "(", "missingXml", ".", "getBytes", "(", "))", ";", "XMLEventReader", "reader", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLEventReader", "(", "resource", ".", "getInputStream", "(", "))", ";", "XMLEventReader", "reader", "=", "StaxUtils", ".", "createXmlInputFactory", "(", ").", "createXMLEventReader", "(", "resource", ".", "getInputStream", "(", "))", ";", "assertFalse", "(", "source", ".", "moveCursorToNextFragment", "(", "reader", ")", ");", "}", "@", "@", "-", "577", ",", "6", "+", "581", ",", "39", "@", "@", "public", "void", "exceptionDuringUnmarshalling", "(", ")", "throws", "Exception", "{", "assertNull", "(", "source", ".", "read", "(", "))", ";", "}", "@", "Test", "public", "void", "testDtdXml", "(", ")", "{", "String", "xmlWithDtd", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "utf", "-", "8", "\\", "\"?", ">\\", "n", "<", "!", "DOCTYPE", "rohit", "[", "\\", "n", "<", "!", "ENTITY", "entityex", "SYSTEM", "\\", "\"", "file", ":", "//", "\"", "new", "File", "(", "\"", "src", "/", "test", "/", "resources", "/", "org", "/", "springframework", "/", "batch", "/", "support", "/", "existing", ".", "txt", "\"", ").", "getAbsolutePath", "(", ")", "\"", "\\\"", ">\\", "n", "]", ">\\", "n", "<", "abc", ">", "&", "entityex", ";", "</", "abc", ">", "\";", "StaxEventItemReader", "<", "String", ">", "reader", "=", "new", "StaxEventItemReader", "<", ">(", ");", "reader", ".", "setName", "(", "\"", "foo", "\"", ");", "reader", ".", "setResource", "(", "new", "ByteArrayResource", "(", "xmlWithDtd", ".", "getBytes", "(", "))", ");", "reader", ".", "setUnmarshaller", "(", "new", "MockFragmentUnmarshaller", "(", ")", "{", "@", "Override", "public", "Object", "unmarshal", "(", "Source", "source", ")", "throws", "XmlMappingException", "{", "try", "{", "XMLEventReader", "xmlEventReader", "=", "StaxTestUtils", ".", "getXmlEventReader", "(", "source", ")", ";", "xmlEventReader", ".", "nextEvent", "(", ");", "xmlEventReader", ".", "nextEvent", "(", ");", "return", "xmlEventReader", ".", "getElementText", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "}", ");", "reader", ".", "setFragmentRootElementName", "(", "\"", "abc", "\"", ");", "reader", ".", "open", "(", "new", "ExecutionContext", "(", "))", ";", "try", "{", "reader", ".", "read", "(", ");", "fail", "(", "\"", "Should", "fail", "when", "XML", "contains", "DTD", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "assertThat", "(", "e", ".", "getMessage", "(", "),", "Matchers", ".", "containsString", "(", "\"", "Undeclared", "general", "entity", "\\", "\"", "entityex", "\\", "\"\"", "))", ";", "}", "}", "/", "**", "*", "Stub", "emulating", "problems", "during", "unmarshalling", ".", "*", "/", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2017", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "16", ",", "6", "+", "16", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "batch", ".", "item", ".", "xml", ".", "builder", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "35", ",", "6", "+", "36", ",", "7", "@", "@", "/", "**", "*", "@", "author", "Michael", "Minella", "*", "@", "author", "Mahmoud", "Ben", "Hassine", "*", "/", "public", "class", "StaxEventItemReaderBuilderTests", "{", "@", "@", "-", "95", ",", "6", "+", "97", ",", "7", "@", "@", "public", "void", "testConfiguration", "(", ")", "throws", "Exception", "{", ".", "currentItemCount", "(", "1", ")", ".", "maxItemCount", "(", "2", ")", ".", "unmarshaller", "(", "unmarshaller", ")", ".", "xmlInputFactory", "(", "XMLInputFactory", ".", "newInstance", "(", "))", ".", "build", "(", ");", "reader", ".", "afterPropertiesSet", "(", ");", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2008", "-", "2012", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2008", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "18", ",", "20", "+", "18", ",", "21", "@", "@", "import", "java", ".", "util", ".", "NoSuchElementException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLEventReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "events", ".", "XMLEvent", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "import", "org", ".", "springframework", ".", "batch", ".", "item", ".", "xml", ".", "EventHelper", ";", "import", "org", ".", "springframework", ".", "batch", ".", "item", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ByteArrayResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "/", "**", "*", "Tests", "for", "{", "@", "link", "DefaultFragmentEventReader", "}", ".", "*", "*", "@", "author", "Robert", "Kasanicky", "*", "@", "author", "Mahmoud", "Ben", "Hassine", "*", "/", "public", "class", "DefaultFragmentEventReaderTests", "extends", "TestCase", "{", "@", "@", "-", "50", ",", "7", "+", "51", ",", "7", "@", "@", "@", "Override", "protected", "void", "setUp", "(", ")", "throws", "Exception", "{", "Resource", "input", "=", "new", "ByteArrayResource", "(", "xml", ".", "getBytes", "(", "))", ";", "eventReader", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLEventReader", "(", "eventReader", "=", "StaxUtils", ".", "createXmlInputFactory", "(", ").", "createXMLEventReader", "(", "input", ".", "getInputStream", "(", "))", ";", "fragmentReader", "=", "new", "DefaultFragmentEventReader", "(", "eventReader", ")", ";", "}"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["Change", "the", "default", "bind", "address", "for", "AJP", "to", "the", "loopback", "address"], "code_tokens": ["@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "coyote", ".", "Processor", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreCompat", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "AbstractEndpoint", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "AprEndpoint", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "AprEndpoint", ".", "Handler", ";", "@", "@", "-", "61", ",", "6", "+", "62", ",", "7", "@", "@", "public", "boolean", "isAprRequired", "(", ")", "{", "public", "AjpAprProtocol", "(", ")", "{", "endpoint", "=", "new", "AprEndpoint", "(", ");", "endpoint", ".", "setAddress", "(", "JreCompat", ".", "getInstance", "(", ").", "getLoopbackAddress", "(", "))", ";", "cHandler", "=", "new", "AjpConnectionHandler", "(", "this", ")", ";", "(", "(", "AprEndpoint", ")", "endpoint", ")", ".", "setHandler", "(", "cHandler", ")", ";", "setSoLinger", "(", "Constants", ".", "DEFAULT_CONNECTION_LINGER", ")", ";", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "coyote", ".", "Processor", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreCompat", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "AbstractEndpoint", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "NioChannel", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "NioEndpoint", ";", "@", "@", "-", "56", ",", "6", "+", "57", ",", "7", "@", "@", "public", "AjpNioProtocol", "(", ")", "{", "endpoint", "=", "new", "NioEndpoint", "(", ");", "endpoint", ".", "setAddress", "(", "JreCompat", ".", "getInstance", "(", ").", "getLoopbackAddress", "(", "))", ";", "cHandler", "=", "new", "AjpConnectionHandler", "(", "this", ")", ";", "(", "(", "NioEndpoint", ")", "endpoint", ")", ".", "setHandler", "(", "cHandler", ")", ";", "setSoLinger", "(", "Constants", ".", "DEFAULT_CONNECTION_LINGER", ")", ";", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "coyote", ".", "Processor", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreCompat", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "AbstractEndpoint", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "JIoEndpoint", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "net", ".", "JIoEndpoint", ".", "Handler", ";", "@", "@", "-", "57", ",", "6", "+", "58", ",", "7", "@", "@", "public", "AjpProtocol", "(", ")", "{", "endpoint", "=", "new", "JIoEndpoint", "(", ");", "endpoint", ".", "setAddress", "(", "JreCompat", ".", "getInstance", "(", ").", "getLoopbackAddress", "(", "))", ";", "cHandler", "=", "new", "AjpConnectionHandler", "(", "this", ")", ";", "(", "(", "JIoEndpoint", ")", "endpoint", ")", ".", "setHandler", "(", "cHandler", ")", ";", "setSoLinger", "(", "Constants", ".", "DEFAULT_CONNECTION_LINGER", ")", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "sql", ".", "CallableStatement", ";", "import", "java", ".", "sql", ".", "Connection", ";", "import", "java", ".", "sql", ".", "DatabaseMetaData", ";", "@", "@", "-", "56", ",", "6", "+", "57", ",", "7", "@", "@", "private", "static", "final", "Method", "resultSetGetObjectName", ";", "private", "static", "final", "Method", "statementCloseOnCompletion", ";", "private", "static", "final", "Method", "statementIsCloseOnCompletion", ";", "private", "static", "final", "Method", "getLoopbackAddress", ";", "static", "{", "Method", "m1", "=", "null", ";", "@", "@", "-", "72", ",", "6", "+", "74", ",", "7", "@", "@", "Method", "m12", "=", "null", ";", "Method", "m13", "=", "null", ";", "Method", "m14", "=", "null", ";", "Method", "m15", "=", "null", ";", "Constructor", "<", "GZIPOutputStream", ">", "c", "=", "null", ";", "try", "{", "/", "/", "Order", "is", "important", "for", "the", "error", "handling", "below", ".", "@", "@", "-", "91", ",", "6", "+", "94", ",", "7", "@", "@", "m12", "=", "ResultSet", ".", "class", ".", "getMethod", "(", "\"", "getObject", "\"", ",", "String", ".", "class", ",", "Class", ".", "class", ")", ";", "m13", "=", "Statement", ".", "class", ".", "getMethod", "(", "\"", "closeOnCompletion", "\"", ");", "m14", "=", "Statement", ".", "class", ".", "getMethod", "(", "\"", "isCloseOnCompletion", "\"", ");", "m15", "=", "InetAddress", ".", "class", ".", "getMethod", "(", "\"", "getLoopbackAddress", "\"", ");", "}", "catch", "(", "SecurityException", "e", ")", "{", "/", "/", "Should", "never", "happen", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jre7Compat", ".", "unexpected", "\"", "),", "e", ")", ";", "@", "@", "-", "118", ",", "6", "+", "122", ",", "7", "@", "@", "resultSetGetObjectName", "=", "m12", ";", "statementCloseOnCompletion", "=", "m13", ";", "statementIsCloseOnCompletion", "=", "m14", ";", "getLoopbackAddress", "=", "m15", ";", "}", "@", "@", "-", "353", ",", "6", "+", "358", ",", "20", "@", "@", "public", "boolean", "isCloseOnCompletion", "(", "Statement", "statement", ")", "throws", "SQLException", "{", "}", "@", "Override", "public", "InetAddress", "getLoopbackAddress", "(", ")", "{", "try", "{", "return", "(", "InetAddress", ")", "getLoopbackAddress", ".", "invoke", "(", "null", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "e", ")", ";", "}", "}", "/", "/", "Java", "9", "methods", "@", "Override", "@", "@", "-", "21", ",", "8", "+", "21", ",", "10", "@", "@", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "lang", ".", "reflect", ".", "AccessibleObject", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "URLConnection", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "java", ".", "sql", ".", "CallableStatement", ";", "import", "java", ".", "sql", ".", "Connection", ";", "import", "java", ".", "sql", ".", "DatabaseMetaData", ";", "@", "@", "-", "232", ",", "6", "+", "234", ",", "32", "@", "@", "public", "boolean", "isCloseOnCompletion", "(", "Statement", "statement", ")", "throws", "SQLException", "{", "}", "public", "InetAddress", "getLoopbackAddress", "(", ")", "{", "/", "/", "Javadoc", "for", "getByName", "(", ")", "states", "that", "calling", "with", "null", "will", "return", "one", "/", "/", "of", "the", "loopback", "addresses", "InetAddress", "result", "=", "null", ";", "try", "{", "result", "=", "InetAddress", ".", "getByName", "(", "null", ")", ";", "}", "catch", "(", "UnknownHostException", "e", ")", "{", "/", "/", "This", "would", "be", "unusual", "but", "ignore", "it", "in", "this", "case", ".", "}", "if", "(", "result", "=", "=", "null", ")", "{", "/", "/", "Fallback", "to", "default", "IPv4", "loopback", "address", ".", "/", "/", "Not", "perfect", "but", "good", "enough", "and", "if", "the", "address", "is", "not", "valid", "the", "/", "/", "bind", "will", "fail", "later", "with", "an", "appropriate", "error", "message", "try", "{", "result", "=", "InetAddress", ".", "getByName", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ");", "}", "catch", "(", "UnknownHostException", "e", ")", "{", "/", "/", "Unreachable", ".", "/", "/", "For", "text", "representations", "of", "IP", "addresses", "only", "the", "format", "is", "/", "/", "checked", ".", "}", "}", "return", "result", ";", "}", "/", "/", "Java", "6", "implementation", "of", "Java", "8", "methods", "public", "static", "boolean", "isJre8Available", "(", ")", "{", "@", "@", "-", "143", ",", "6", "+", "143", ",", "10", "@", "@", "Disable", "(", "comment", "out", "in", "server", ".", "xml", ")", "the", "AJP", "/", "1", ".", "3", "connector", "by", "default", ".", "(", "markt", ")", "<", "/", "update", ">", "<", "update", ">", "Change", "the", "default", "bind", "address", "for", "the", "AJP", "/", "1", ".", "3", "connector", "to", "be", "the", "loopback", "address", ".", "(", "markt", ")", "<", "/", "update", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">", "@", "@", "-", "306", ",", "10", "+", "306", ",", "7", "@", "@", "<", "attribute", "name", "=", "\"", "address", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "For", "servers", "with", "more", "than", "one", "IP", "address", ",", "this", "attribute", "specifies", "which", "address", "will", "be", "used", "for", "listening", "on", "the", "specified", "port", ".", "By", "default", ",", "this", "port", "will", "be", "used", "on", "all", "IP", "addresses", "associated", "with", "the", "server", ".", "A", "value", "of", "<", "code", ">", "127", ".", "0", ".", "0", ".", "1", "<", "/", "code", ">", "indicates", "that", "the", "Connector", "will", "only", "listen", "on", "the", "loopback", "interface", ".", "</", "p", ">", "port", ".", "By", "default", ",", "the", "loopback", "address", "will", "be", "used", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "bindOnInit", "\"", "required", "=", "\"", "false", "\"", ">"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["[PATCH]", "Don't", "leak", "NT", "bit", "into", "next", "task", "SYSENTER", "can", "cause", "a", "NT", "to", "be", "set", "which", "might", "cause", "crashes", "on", "the", "IRET", "in", "the", "next", "task.", "Following", "similar", "i386", "patch", "from", "Linus.", "Signed-off-by:", "Andi", "Kleen", "<ak@suse.de>"], "code_tokens": ["@", "@", "-", "155", ",", "6", "+", "155", ",", "10", "@", "@", "/", "*", "rdi", ":", "prev", "*", "/", "ENTRY", "(", "ret_from_fork", ")", "CFI_DEFAULT_STACK", "push", "kernel_eflags", "(", "%", "rip", ")", "CFI_ADJUST_CFA_OFFSET", "4", "popf", "#", "reset", "kernel", "eflags", "CFI_ADJUST_CFA_OFFSET", "-", "4", "call", "schedule_tail", "GET_THREAD_INFO", "(", "%", "rcx", ")", "testl", "$", "(", "_TIF_SYSCALL_TRACE", "|", "_TIF_SYSCALL_AUDIT", ")", ",", "threadinfo_flags", "(", "%", "rcx", ")", "@", "@", "-", "180", ",", "6", "+", "180", ",", "8", "@", "@", "void", "__cpuinit", "check_efer", "(", "void", ")", "}", "}", "unsigned", "long", "kernel_eflags", ";", "/", "*", "*", "cpu_init", "(", ")", "initializes", "state", "that", "is", "per", "-", "CPU", ".", "Some", "data", "is", "already", "*", "initialized", "(", "naturally", ")", "in", "the", "bootstrap", "process", ",", "such", "as", "the", "GDT", "@", "@", "-", "281", ",", "4", "+", "283", ",", "6", "@", "@", "void", "__cpuinit", "cpu_init", "(", "void", ")", "set_debugreg", "(", "0UL", ",", "7", ")", ";", "fpu_init", "(", ");", "raw_local_save_flags", "(", "kernel_eflags", ")", ";", "}", "@", "@", "-", "14", ",", "12", "+", "14", ",", "13", "@", "@", "#", "define", "__RESTORE", "(", "reg", ",", "offset", ")", "\"", "movq", "(", "14", "-", "\"", "#", "offset", "\"", ")*", "8", "(", "%%", "rsp", ")", ",%", "%\"", "#", "reg", "\"", "\\", "n", "\\", "t", "\"", "/", "*", "frame", "pointer", "must", "be", "last", "for", "get_wchan", "*", "/", "#", "define", "SAVE_CONTEXT", "\"", "pushq", "%", "%", "rbp", ";", "movq", "%", "%", "rsi", ",", "%%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "RESTORE_CONTEXT", "\"", "movq", "%", "%", "rbp", ",", "%%", "rsi", ";", "popq", "%", "%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "SAVE_CONTEXT", "\"", "pushf", ";", "pushq", "%", "%", "rbp", ";", "movq", "%", "%", "rsi", ",", "%%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "RESTORE_CONTEXT", "\"", "movq", "%", "%", "rbp", ",", "%%", "rsi", ";", "popq", "%", "%", "rbp", ";", "popf", "\\", "t", "\"", "#", "define", "__EXTRA_CLOBBER", "\\", ",", "\"", "rcx", "\"", ",\"", "rbx", "\"", ",\"", "rdx", "\"", ",\"", "r8", "\"", ",\"", "r9", "\"", ",\"", "r10", "\"", ",\"", "r11", "\"", ",\"", "r12", "\"", ",\"", "r13", "\"", ",\"", "r14", "\"", ",\"", "r15", "\"", "/", "*", "Save", "restore", "flags", "to", "clear", "handle", "leaking", "NT", "*", "/", "#", "define", "switch_to", "(", "prev", ",", "next", ",", "last", ")", "\\", "asm", "volatile", "(", "SAVE_CONTEXT", "\\", "\"", "movq", "%", "%", "rsp", ",", "%", "P", "[", "threadrsp", "]", "(%", "[", "prev", "]", ")\\", "n", "\\", "t", "\"", "/", "*", "save", "RSP", "*", "/", "\\"], "docstring_tokens": ["initiating", "SYSENTER", "to", "set", "an", "NT", "flag"]}
{"contents": ["mm:", "avoid", "setting", "up", "anonymous", "pages", "into", "file", "mapping", "Reading", "page", "fault", "handler", "code", "I've", "noticed", "that", "under", "right", "circumstances", "kernel", "would", "map", "anonymous", "pages", "into", "file", "mappings:", "if", "the", "VMA", "doesn't", "have", "vm_ops->fault()", "and", "the", "VMA", "wasn't", "fully", "populated", "on", "->mmap(),", "kernel", "would", "handle", "page", "fault", "to", "not", "populated", "pte", "with", "do_anonymous_page().", "Let's", "change", "page", "fault", "handler", "to", "use", "do_anonymous_page()", "only", "on", "anonymous", "VMA", "(->vm_ops", "==", "NULL)", "and", "make", "sure", "that", "the", "VMA", "is", "not", "shared.", "For", "file", "mappings", "without", "vm_ops->fault()", "or", "shred", "VMA", "without", "vm_ops,", "page", "fault", "on", "pte_none()", "entry", "would", "lead", "to", "SIGBUS.", "Signed-off-by:", "Kirill", "A.", "Shutemov", "<kirill.shutemov@linux.intel.com>", "Acked-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "2670", ",", "6", "+", "2670", ",", "10", "@", "@", "static", "int", "do_anonymous_page", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "vm_area_struct", "*", "vma", ",", "pte_unmap", "(", "page_table", ")", ";", "/", "*", "File", "mapping", "without", "-", ">", "vm_ops", "?", "*", "/", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_SHARED", ")", "return", "VM_FAULT_SIGBUS", ";", "/", "*", "Check", "if", "we", "need", "to", "add", "a", "guard", "page", "to", "the", "stack", "*", "/", "if", "(", "check_stack_guard_page", "(", "vma", ",", "address", ")", "<", "0", ")", "return", "VM_FAULT_SIGSEGV", ";", "@", "@", "-", "3099", ",", "6", "+", "3103", ",", "9", "@", "@", "static", "int", "do_fault", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "vm_area_struct", "*", "vma", ",", "-", "vma", "-", ">", "vm_start", ")", ">", ">", "PAGE_SHIFT", ")", "+", "vma", "-", ">", "vm_pgoff", ";", "pte_unmap", "(", "page_table", ")", ";", "/", "*", "The", "VMA", "was", "not", "fully", "populated", "on", "mmap", "(", ")", "or", "missing", "VM_DONTEXPAND", "*", "/", "if", "(", "!", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", "return", "VM_FAULT_SIGBUS", ";", "if", "(", "!(", "flags", "&", "FAULT_FLAG_WRITE", ")", ")", "return", "do_read_fault", "(", "mm", ",", "vma", ",", "address", ",", "pmd", ",", "pgoff", ",", "flags", ",", "orig_pte", ")", ";", "@", "@", "-", "3244", ",", "13", "+", "3251", ",", "12", "@", "@", "static", "int", "handle_pte_fault", "(", "struct", "mm_struct", "*", "mm", ",", "barrier", "(", ");", "if", "(", "!", "pte_present", "(", "entry", ")", ")", "{", "if", "(", "pte_none", "(", "entry", ")", ")", "{", "if", "(", "vma", "-", ">", "vm_ops", ")", "{", "if", "(", "likely", "(", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "}", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";", "if", "(", "vma", "-", ">", "vm_ops", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";", "}", "return", "do_swap_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";"], "docstring_tokens": ["via", "a", "crafted", "application", "that", "triggers", "writing", "to", "page", "zero", "."]}
{"contents": ["Sched:", "fix", "skip_clock_update", "optimization", "idle_balance()", "drops/retakes", "rq->lock,", "leaving", "the", "previous", "task", "vulnerable", "to", "set_tsk_need_resched().", "Clear", "it", "after", "we", "return", "from", "balancing", "instead,", "and", "in", "setup_thread_stack()", "as", "well,", "so", "no", "successfully", "descheduled", "or", "never", "scheduled", "task", "has", "it", "set.", "Need", "resched", "confused", "the", "skip_clock_update", "logic,", "which", "assumes", "that", "the", "next", "call", "to", "update_rq_clock()", "will", "come", "nearly", "immediately", "after", "being", "set.", "Make", "the", "optimization", "robust", "against", "the", "waking", "a", "sleeper", "before", "it", "sucessfully", "deschedules", "case", "by", "checking", "that", "the", "current", "task", "has", "not", "been", "dequeued", "before", "setting", "the", "flag,", "since", "it", "is", "that", "useless", "clock", "update", "we're", "trying", "to", "save,", "and", "clear", "unconditionally", "in", "schedule()", "proper", "instead", "of", "conditionally", "in", "put_prev_task().", "Signed-off-by:", "Mike", "Galbraith", "<efault@gmx.de>", "Reported-by:", "Bjoern", "B.", "Brandenburg", "<bbb.lst@gmail.com>", "Tested-by:", "Yong", "Zhang", "<yong.zhang0@gmail.com>", "Signed-off-by:", "Peter", "Zijlstra", "<a.p.zijlstra@chello.nl>", "Cc:", "stable@kernel.org", "LKML-Reference:", "<1291802742.1417.9.camel@marge.simson.net>", "Signed-off-by:", "Ingo", "Molnar", "<mingo@elte.hu>"], "code_tokens": ["@", "@", "-", "273", ",", "6", "+", "273", ",", "7", "@", "@", "static", "struct", "task_struct", "*", "dup_task_struct", "(", "struct", "task_struct", "*", "orig", ")", "setup_thread_stack", "(", "tsk", ",", "orig", ")", ";", "clear_user_return_notifier", "(", "tsk", ")", ";", "clear_tsk_need_resched", "(", "tsk", ")", ";", "stackend", "=", "end_of_stack", "(", "tsk", ")", ";", "*", "stackend", "=", "STACK_END_MAGIC", ";", "/", "*", "for", "overflow", "detection", "*", "/", "@", "@", "-", "641", ",", "17", "+", "641", ",", "18", "@", "@", "static", "void", "sched_irq_time_avg_update", "(", "struct", "rq", "*", "rq", ",", "u64", "irq_time", ")", ";", "inline", "void", "update_rq_clock", "(", "struct", "rq", "*", "rq", ")", "{", "if", "(", "!", "rq", "-", ">", "skip_clock_update", ")", "{", "int", "cpu", "=", "cpu_of", "(", "rq", ")", ";", "u64", "irq_time", ";", "int", "cpu", "=", "cpu_of", "(", "rq", ")", ";", "u64", "irq_time", ";", "rq", "-", ">", "clock", "=", "sched_clock_cpu", "(", "cpu", ")", ";", "irq_time", "=", "irq_time_cpu", "(", "cpu", ")", ";", "if", "(", "rq", "-", ">", "clock", "-", "irq_time", ">", "rq", "-", ">", "clock_task", ")", "rq", "-", ">", "clock_task", "=", "rq", "-", ">", "clock", "-", "irq_time", ";", "if", "(", "rq", "-", ">", "skip_clock_update", ")", "return", ";", "sched_irq_time_avg_update", "(", "rq", ",", "irq_time", ")", ";", "}", "rq", "-", ">", "clock", "=", "sched_clock_cpu", "(", "cpu", ")", ";", "irq_time", "=", "irq_time_cpu", "(", "cpu", ")", ";", "if", "(", "rq", "-", ">", "clock", "-", "irq_time", ">", "rq", "-", ">", "clock_task", ")", "rq", "-", ">", "clock_task", "=", "rq", "-", ">", "clock", "-", "irq_time", ";", "sched_irq_time_avg_update", "(", "rq", ",", "irq_time", ")", ";", "}", "/", "*", "@", "@", "-", "2129", ",", "7", "+", "2130", ",", "7", "@", "@", "static", "void", "check_preempt_curr", "(", "struct", "rq", "*", "rq", ",", "struct", "task_struct", "*", "p", ",", "int", "flags", ")", "*", "A", "queue", "event", "has", "occurred", ",", "and", "we", "'", "re", "going", "to", "schedule", ".", "In", "*", "this", "case", ",", "we", "can", "save", "a", "useless", "back", "to", "back", "clock", "update", ".", "*", "/", "if", "(", "test_tsk_need_resched", "(", "rq", "-", ">", "curr", ")", ")", "if", "(", "rq", "-", ">", "curr", "-", ">", "se", ".", "on_rq", "&", "&", "test_tsk_need_resched", "(", "rq", "-", ">", "curr", ")", ")", "rq", "-", ">", "skip_clock_update", "=", "1", ";", "}", "@", "@", "-", "3973", ",", "7", "+", "3974", ",", "6", "@", "@", "static", "void", "put_prev_task", "(", "struct", "rq", "*", "rq", ",", "struct", "task_struct", "*", "prev", ")", "{", "if", "(", "prev", "-", ">", "se", ".", "on_rq", ")", "update_rq_clock", "(", "rq", ")", ";", "rq", "-", ">", "skip_clock_update", "=", "0", ";", "prev", "-", ">", "sched_class", "-", ">", "put_prev_task", "(", "rq", ",", "prev", ")", ";", "}", "@", "@", "-", "4031", ",", "7", "+", "4031", ",", "6", "@", "@", "asmlinkage", "void", "__sched", "schedule", "(", "void", ")", "hrtick_clear", "(", "rq", ")", ";", "raw_spin_lock_irq", "(", "&", "rq", "-", ">", "lock", ")", ";", "clear_tsk_need_resched", "(", "prev", ")", ";", "switch_count", "=", "&", "prev", "-", ">", "nivcsw", ";", "if", "(", "prev", "-", ">", "state", "&", "&", "!", "(", "preempt_count", "(", ")", "&", "PREEMPT_ACTIVE", ")", ")", "{", "@", "@", "-", "4063", ",", "6", "+", "4062", ",", "8", "@", "@", "asmlinkage", "void", "__sched", "schedule", "(", "void", ")", "put_prev_task", "(", "rq", ",", "prev", ")", ";", "next", "=", "pick_next_task", "(", "rq", ")", ";", "clear_tsk_need_resched", "(", "prev", ")", ";", "rq", "-", ">", "skip_clock_update", "=", "0", ";", "if", "(", "likely", "(", "prev", "!", "=", "next", ")", ")", "{", "sched_info_switch", "(", "prev", ",", "next", ")", ";", "@", "@", "-", "4071", ",", "6", "+", "4072", ",", "7", "@", "@", "asmlinkage", "void", "__sched", "schedule", "(", "void", ")", "rq", "-", ">", "nr_switches", "+", "+;", "rq", "-", ">", "curr", "=", "next", ";", "+", "+*", "switch_count", ";", "WARN_ON_ONCE", "(", "test_tsk_need_resched", "(", "next", ")", ");", "context_switch", "(", "rq", ",", "prev", ",", "next", ")", ";", "/", "*", "unlocks", "the", "rq", "*", "/", "/", "*"], "docstring_tokens": ["via", "an", "application", "that", "executes", "code", "in", "a", "loop", "."]}
{"contents": ["move", "d_rcu", "from", "overlapping", "d_child", "to", "overlapping", "d_alias", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["@", "@", "-", "164", ",", "7", "+", "164", ",", "7", "@", "@", "static", "void", "spufs_prune_dir", "(", "struct", "dentry", "*", "dir", ")", "struct", "dentry", "*", "dentry", ",", "*", "tmp", ";", "mutex_lock", "(", "&", "dir", "-", ">", "d_inode", "-", ">", "i_mutex", ")", ";", "list_for_each_entry_safe", "(", "dentry", ",", "tmp", ",", "&", "dir", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry_safe", "(", "dentry", ",", "tmp", ",", "&", "dir", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "if", "(", "!(", "d_unhashed", "(", "dentry", ")", ")", "&", "&", "dentry", "-", ">", "d_inode", ")", "{", "dget_dlock", "(", "dentry", ")", ";", "@", "@", "-", "258", ",", "7", "+", "258", ",", "7", "@", "@", "void", "ll_invalidate_aliases", "(", "struct", "inode", "*", "inode", ")", "inode", "-", ">", "i_ino", ",", "inode", "-", ">", "i_generation", ",", "inode", ")", ";", "ll_lock_dcache", "(", "inode", ")", ";", "ll_d_hlist_for_each_entry", "(", "dentry", ",", "p", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "ll_d_hlist_for_each_entry", "(", "dentry", ",", "p", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "CDEBUG", "(", "D_DENTRY", ",", "\"", "dentry", "in", "drop", "%", ".*", "s", "(", "%", "p", ")", "parent", "%", "p", "\"", "\"", "inode", "%", "p", "flags", "%", "d", "\\", "n", "\"", ",", "dentry", "-", ">", "d_name", ".", "len", ",", "dentry", "-", ">", "d_name", ".", "name", ",", "dentry", ",", "dentry", "-", ">", "d_parent", ",", "@", "@", "-", "711", ",", "7", "+", "711", ",", "7", "@", "@", "void", "lustre_dump_dentry", "(", "struct", "dentry", "*", "dentry", ",", "int", "recur", ")", "return", ";", "list_for_each", "(", "tmp", ",", "&", "dentry", "-", ">", "d_subdirs", ")", "{", "struct", "dentry", "*", "d", "=", "list_entry", "(", "tmp", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "struct", "dentry", "*", "d", "=", "list_entry", "(", "tmp", ",", "struct", "dentry", ",", "d_child", ")", ";", "lustre_dump_dentry", "(", "d", ",", "recur", "-", "1", ")", ";", "}", "}", "@", "@", "-", "167", ",", "14", "+", "167", ",", "14", "@", "@", "static", "void", "ll_invalidate_negative_children", "(", "struct", "inode", "*", "dir", ")", "struct", "ll_d_hlist_node", "*", "p", ";", "ll_lock_dcache", "(", "dir", ")", ";", "ll_d_hlist_for_each_entry", "(", "dentry", ",", "p", ",", "&", "dir", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "ll_d_hlist_for_each_entry", "(", "dentry", ",", "p", ",", "&", "dir", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "if", "(", "!", "list_empty", "(", "&", "dentry", "-", ">", "d_subdirs", ")", ")", "{", "struct", "dentry", "*", "child", ";", "list_for_each_entry_safe", "(", "child", ",", "tmp_subdir", ",", "&", "dentry", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "d_child", ")", "{", "if", "(", "child", "-", ">", "d_inode", "=", "=", "NULL", ")", "d_lustre_invalidate", "(", "child", ",", "1", ")", ";", "}", "@", "@", "-", "362", ",", "7", "+", "362", ",", "7", "@", "@", "static", "struct", "dentry", "*", "ll_find_alias", "(", "struct", "inode", "*", "inode", ",", "struct", "dentry", "*", "dentry", ")", "discon_alias", "=", "invalid_alias", "=", "NULL", ";", "ll_lock_dcache", "(", "inode", ")", ";", "ll_d_hlist_for_each_entry", "(", "alias", ",", "p", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "ll_d_hlist_for_each_entry", "(", "alias", ",", "p", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "LASSERT", "(", "alias", "!", "=", "dentry", ")", ";", "spin_lock", "(", "&", "alias", "-", ">", "d_lock", ")", ";", "@", "@", "-", "953", ",", "7", "+", "953", ",", "7", "@", "@", "static", "void", "ll_get_child_fid", "(", "struct", "inode", "*", "dir", ",", "struct", "qstr", "*", "name", ",", "{", "struct", "dentry", "*", "parent", ",", "*", "child", ";", "parent", "=", "ll_d_hlist_entry", "(", "dir", "-", ">", "i_dentry", ",", "struct", "dentry", ",", "d_alias", ")", ";", "parent", "=", "ll_d_hlist_entry", "(", "dir", "-", ">", "i_dentry", ",", "struct", "dentry", ",", "d_u", ".", "d_alias", ")", ";", "child", "=", "d_lookup", "(", "parent", ",", "name", ")", ";", "if", "(", "child", ")", "{", "if", "(", "child", "-", ">", "d_inode", ")", "@", "@", "-", "125", ",", "7", "+", "125", ",", "7", "@", "@", "affs_fix_dcache", "(", "struct", "inode", "*", "inode", ",", "u32", "entry_ino", ")", "{", "struct", "dentry", "*", "dentry", ";", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "if", "(", "entry_ino", "=", "=", "(", "u32", ")", "(", "long", ")", "dentry", "-", ">", "d_fsdata", ")", "{", "dentry", "-", ">", "d_fsdata", "=", "(", "void", "*", ")", "inode", "-", ">", "i_ino", ";", "break", ";", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "static", "struct", "dentry", "*", "get_next_positive_subdir", "(", "struct", "dentry", "*", "prev", ",", "spin_lock", "(", "&", "root", "-", ">", "d_lock", ")", ";", "if", "(", "prev", ")", "next", "=", "prev", "-", ">", "d_u", ".", "d_child", ".", "next", ";", "next", "=", "prev", "-", ">", "d_child", ".", "next", ";", "else", "{", "prev", "=", "dget_dlock", "(", "root", ")", ";", "next", "=", "prev", "-", ">", "d_subdirs", ".", "next", ";", "@", "@", "-", "99", ",", "13", "+", "99", ",", "13", "@", "@", "static", "struct", "dentry", "*", "get_next_positive_subdir", "(", "struct", "dentry", "*", "prev", ",", "return", "NULL", ";", "}", "q", "=", "list_entry", "(", "next", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "q", "=", "list_entry", "(", "next", ",", "struct", "dentry", ",", "d_child", ")", ";", "spin_lock_nested", "(", "&", "q", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "/", "*", "Already", "gone", "or", "negative", "dentry", "(", "under", "construction", ")", "-", "try", "next", "*", "/", "if", "(", "!", "d_count", "(", "q", ")", "|", "|", "!", "simple_positive", "(", "q", ")", ")", "{", "spin_unlock", "(", "&", "q", "-", ">", "d_lock", ")", ";", "next", "=", "q", "-", ">", "d_u", ".", "d_child", ".", "next", ";", "next", "=", "q", "-", ">", "d_child", ".", "next", ";", "goto", "cont", ";", "}", "dget_dlock", "(", "q", ")", ";", "@", "@", "-", "155", ",", "13", "+", "155", ",", "13", "@", "@", "static", "struct", "dentry", "*", "get_next_positive_dentry", "(", "struct", "dentry", "*", "prev", ",", "goto", "relock", ";", "}", "spin_unlock", "(", "&", "p", "-", ">", "d_lock", ")", ";", "next", "=", "p", "-", ">", "d_u", ".", "d_child", ".", "next", ";", "next", "=", "p", "-", ">", "d_child", ".", "next", ";", "p", "=", "parent", ";", "if", "(", "next", "!", "=", "&", "parent", "-", ">", "d_subdirs", ")", "break", ";", "}", "}", "ret", "=", "list_entry", "(", "next", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "ret", "=", "list_entry", "(", "next", ",", "struct", "dentry", ",", "d_child", ")", ";", "spin_lock_nested", "(", "&", "ret", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "/", "*", "Negative", "dentry", "-", "try", "next", "*", "/", "@", "@", "-", "489", ",", "7", "+", "489", ",", "7", "@", "@", "struct", "dentry", "*", "autofs4_expire_indirect", "(", "struct", "super_block", "*", "sb", ",", "spin_lock", "(", "&", "sbi", "-", ">", "lookup_lock", ")", ";", "spin_lock", "(", "&", "expired", "-", ">", "d_parent", "-", ">", "d_lock", ")", ";", "spin_lock_nested", "(", "&", "expired", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "list_move", "(", "&", "expired", "-", ">", "d_parent", "-", ">", "d_subdirs", ",", "&", "expired", "-", ">", "d_u", ".", "d_child", ")", ";", "list_move", "(", "&", "expired", "-", ">", "d_parent", "-", ">", "d_subdirs", ",", "&", "expired", "-", ">", "d_child", ")", ";", "spin_unlock", "(", "&", "expired", "-", ">", "d_lock", ")", ";", "spin_unlock", "(", "&", "expired", "-", ">", "d_parent", "-", ">", "d_lock", ")", ";", "spin_unlock", "(", "&", "sbi", "-", ">", "lookup_lock", ")", ";", "@", "@", "-", "687", ",", "7", "+", "687", ",", "7", "@", "@", "static", "void", "autofs_clear_leaf_automount_flags", "(", "struct", "dentry", "*", "dentry", ")", "/", "*", "only", "consider", "parents", "below", "dentrys", "in", "the", "root", "*", "/", "if", "(", "IS_ROOT", "(", "parent", "-", ">", "d_parent", ")", ")", "return", ";", "d_child", "=", "&", "dentry", "-", ">", "d_u", ".", "d_child", ";", "d_child", "=", "&", "dentry", "-", ">", "d_child", ";", "/", "*", "Set", "parent", "managed", "if", "it", "'", "s", "becoming", "empty", "*", "/", "if", "(", "d_child", "-", ">", "next", "=", "=", "&", "parent", "-", ">", "d_subdirs", "&", "&", "d_child", "-", ">", "prev", "=", "=", "&", "parent", "-", ">", "d_subdirs", ")", "@", "@", "-", "111", ",", "7", "+", "111", ",", "7", "@", "@", "static", "int", "fpos_cmp", "(", "loff_t", "l", ",", "loff_t", "r", ")", "/", "*", "*", "When", "possible", ",", "we", "try", "to", "satisfy", "a", "readdir", "by", "peeking", "at", "the", "*", "dcache", ".", "We", "make", "this", "work", "by", "carefully", "ordering", "dentries", "on", "*", "d_u", ".", "d_child", "when", "we", "initially", "get", "results", "back", "from", "the", "MDS", ",", "and", "*", "d_child", "when", "we", "initially", "get", "results", "back", "from", "the", "MDS", ",", "and", "*", "falling", "back", "to", "a", "\"", "normal", "\"", "sync", "readdir", "if", "any", "dentries", "in", "the", "dir", "*", "are", "dropped", ".", "*", "@", "@", "-", "147", ",", "11", "+", "147", ",", "11", "@", "@", "static", "int", "__dcache_readdir", "(", "struct", "file", "*", "file", ",", "struct", "dir_context", "*", "ctx", ",", "p", "=", "parent", "-", ">", "d_subdirs", ".", "prev", ";", "dout", "(", "\"", "initial", "p", "%", "p", "/", "%", "p", "\\", "n", "\"", ",", "p", "-", ">", "prev", ",", "p", "-", ">", "next", ")", ";", "}", "else", "{", "p", "=", "last", "-", ">", "d_u", ".", "d_child", ".", "prev", ";", "p", "=", "last", "-", ">", "d_child", ".", "prev", ";", "}", "more", ":", "dentry", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "dentry", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_child", ")", ";", "di", "=", "ceph_dentry", "(", "dentry", ")", ";", "while", "(", "1", ")", "{", "dout", "(", "\"", "p", "%", "p", "/", "%", "p", "%", "s", "d_subdirs", "%", "p", "/", "%", "p", "\\", "n", "\"", ",", "p", "-", ">", "prev", ",", "p", "-", ">", "next", ",", "@", "@", "-", "174", ",", "7", "+", "174", ",", "7", "@", "@", "static", "int", "__dcache_readdir", "(", "struct", "file", "*", "file", ",", "struct", "dir_context", "*", "ctx", ",", "!", "dentry", "-", ">", "d_inode", "?", "\"", "null", "\"", ":", "\"", "\")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "p", "=", "p", "-", ">", "prev", ";", "dentry", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "dentry", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_child", ")", ";", "di", "=", "ceph_dentry", "(", "dentry", ")", ";", "}", "@", "@", "-", "1399", ",", "7", "+", "1399", ",", "7", "@", "@", "int", "ceph_readdir_prepopulate", "(", "struct", "ceph_mds_request", "*", "req", ",", "/", "*", "reorder", "parent", "'", "s", "d_subdirs", "*", "/", "spin_lock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "spin_lock_nested", "(", "&", "dn", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "list_move", "(", "&", "dn", "-", ">", "d_u", ".", "d_child", ",", "&", "parent", "-", ">", "d_subdirs", ")", ";", "list_move", "(", "&", "dn", "-", ">", "d_child", ",", "&", "parent", "-", ">", "d_subdirs", ")", ";", "spin_unlock", "(", "&", "dn", "-", ">", "d_lock", ")", ";", "spin_unlock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "}", "@", "@", "-", "895", ",", "7", "+", "895", ",", "7", "@", "@", "inode_has_hashed_dentries", "(", "struct", "inode", "*", "inode", ")", "struct", "dentry", "*", "dentry", ";", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "if", "(", "!", "d_unhashed", "(", "dentry", ")", "|", "|", "IS_ROOT", "(", "dentry", ")", ")", "{", "spin_unlock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "return", "true", ";", "@", "@", "-", "92", ",", "7", "+", "92", ",", "7", "@", "@", "static", "void", "coda_flag_children", "(", "struct", "dentry", "*", "parent", ",", "int", "flag", ")", "struct", "dentry", "*", "de", ";", "spin_lock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "de", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "de", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "/", "*", "don", "'", "t", "know", "what", "to", "do", "with", "negative", "dentries", "*", "/", "if", "(", "de", "-", ">", "d_inode", ")", "coda_flag_inode", "(", "de", "-", ">", "d_inode", ",", "flag", ")", ";", "@", "@", "-", "44", ",", "7", "+", "44", ",", "7", "@", "@", "/", "*", "*", "Usage", ":", "*", "dcache", "-", ">", "d_inode", "-", ">", "i_lock", "protects", ":", "*", "-", "i_dentry", ",", "d_alias", ",", "d_inode", "of", "aliases", "*", "-", "i_dentry", ",", "d_u", ".", "d_alias", ",", "d_inode", "of", "aliases", "*", "dcache_hash_bucket", "lock", "protects", ":", "*", "-", "the", "dcache", "hash", "table", "*", "s_anon", "bl", "list", "spinlock", "protects", ":", "@", "@", "-", "59", ",", "7", "+", "59", ",", "7", "@", "@", "*", "-", "d_unhashed", "(", ")", "*", "-", "d_parent", "and", "d_subdirs", "*", "-", "childrens", "'", "d_child", "and", "d_parent", "*", "-", "d_alias", ",", "d_inode", "*", "-", "d_u", ".", "d_alias", ",", "d_inode", "*", "*", "Ordering", ":", "*", "dentry", "-", ">", "d_inode", "-", ">", "i_lock", "@", "@", "-", "252", ",", "14", "+", "252", ",", "12", "@", "@", "static", "void", "__d_free", "(", "struct", "rcu_head", "*", "head", ")", "{", "struct", "dentry", "*", "dentry", "=", "container_of", "(", "head", ",", "struct", "dentry", ",", "d_u", ".", "d_rcu", ")", ";", "WARN_ON", "(", "!", "hlist_unhashed", "(", "&", "dentry", "-", ">", "d_alias", ")", ");", "kmem_cache_free", "(", "dentry_cache", ",", "dentry", ")", ";", "}", "static", "void", "__d_free_external", "(", "struct", "rcu_head", "*", "head", ")", "{", "struct", "dentry", "*", "dentry", "=", "container_of", "(", "head", ",", "struct", "dentry", ",", "d_u", ".", "d_rcu", ")", ";", "WARN_ON", "(", "!", "hlist_unhashed", "(", "&", "dentry", "-", ">", "d_alias", ")", ");", "kfree", "(", "external_name", "(", "dentry", ")", ");", "kmem_cache_free", "(", "dentry_cache", ",", "dentry", ")", ";", "}", "@", "@", "-", "271", ",", "6", "+", "269", ",", "7", "@", "@", "static", "inline", "int", "dname_external", "(", "const", "struct", "dentry", "*", "dentry", ")", "static", "void", "dentry_free", "(", "struct", "dentry", "*", "dentry", ")", "{", "WARN_ON", "(", "!", "hlist_unhashed", "(", "&", "dentry", "-", ">", "d_u", ".", "d_alias", ")", ");", "if", "(", "unlikely", "(", "dname_external", "(", "dentry", ")", "))", "{", "struct", "external_name", "*", "p", "=", "external_name", "(", "dentry", ")", ";", "if", "(", "likely", "(", "atomic_dec_and_test", "(", "&", "p", "-", ">", "u", ".", "count", ")", "))", "{", "@", "@", "-", "311", ",", "7", "+", "310", ",", "7", "@", "@", "static", "void", "dentry_iput", "(", "struct", "dentry", "*", "dentry", ")", "struct", "inode", "*", "inode", "=", "dentry", "-", ">", "d_inode", ";", "if", "(", "inode", ")", "{", "dentry", "-", ">", "d_inode", "=", "NULL", ";", "hlist_del_init", "(", "&", "dentry", "-", ">", "d_alias", ")", ";", "hlist_del_init", "(", "&", "dentry", "-", ">", "d_u", ".", "d_alias", ")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "spin_unlock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "if", "(", "!", "inode", "-", ">", "i_nlink", ")", "@", "@", "-", "336", ",", "7", "+", "335", ",", "7", "@", "@", "static", "void", "dentry_unlink_inode", "(", "struct", "dentry", "*", "dentry", ")", "struct", "inode", "*", "inode", "=", "dentry", "-", ">", "d_inode", ";", "__d_clear_type", "(", "dentry", ")", ";", "dentry", "-", ">", "d_inode", "=", "NULL", ";", "hlist_del_init", "(", "&", "dentry", "-", ">", "d_alias", ")", ";", "hlist_del_init", "(", "&", "dentry", "-", ">", "d_u", ".", "d_alias", ")", ";", "dentry_rcuwalk_barrier", "(", "dentry", ")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "spin_unlock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "@", "@", "-", "496", ",", "7", "+", "495", ",", "7", "@", "@", "static", "void", "__dentry_kill", "(", "struct", "dentry", "*", "dentry", ")", "}", "/", "*", "if", "it", "was", "on", "the", "hash", "then", "remove", "it", "*", "/", "__d_drop", "(", "dentry", ")", ";", "list_del", "(", "&", "dentry", "-", ">", "d_u", ".", "d_child", ")", ";", "list_del", "(", "&", "dentry", "-", ">", "d_child", ")", ";", "/", "*", "*", "Inform", "d_walk", "(", ")", "that", "we", "are", "no", "longer", "attached", "to", "the", "*", "dentry", "tree", "@", "@", "-", "722", ",", "7", "+", "721", ",", "7", "@", "@", "static", "struct", "dentry", "*", "__d_find_alias", "(", "struct", "inode", "*", "inode", ")", "again", ":", "discon_alias", "=", "NULL", ";", "hlist_for_each_entry", "(", "alias", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "alias", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "spin_lock", "(", "&", "alias", "-", ">", "d_lock", ")", ";", "if", "(", "S_ISDIR", "(", "inode", "-", ">", "i_mode", ")", "|", "|", "!", "d_unhashed", "(", "alias", ")", ")", "{", "if", "(", "IS_ROOT", "(", "alias", ")", "&", "&", "@", "@", "-", "772", ",", "7", "+", "771", ",", "7", "@", "@", "void", "d_prune_aliases", "(", "struct", "inode", "*", "inode", ")", "struct", "dentry", "*", "dentry", ";", "restart", ":", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "if", "(", "!", "dentry", "-", ">", "d_lockref", ".", "count", ")", "{", "struct", "dentry", "*", "parent", "=", "lock_parent", "(", "dentry", ")", ";", "@", "@", "-", "1050", ",", "7", "+", "1049", ",", "7", "@", "@", "static", "void", "d_walk", "(", "struct", "dentry", "*", "parent", ",", "void", "*", "data", ",", "resume", ":", "while", "(", "next", "!", "=", "&", "this_parent", "-", ">", "d_subdirs", ")", "{", "struct", "list_head", "*", "tmp", "=", "next", ";", "struct", "dentry", "*", "dentry", "=", "list_entry", "(", "tmp", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "struct", "dentry", "*", "dentry", "=", "list_entry", "(", "tmp", ",", "struct", "dentry", ",", "d_child", ")", ";", "next", "=", "tmp", "-", ">", "next", ";", "spin_lock_nested", "(", "&", "dentry", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "@", "@", "-", "1102", ",", "7", "+", "1101", ",", "7", "@", "@", "static", "void", "d_walk", "(", "struct", "dentry", "*", "parent", ",", "void", "*", "data", ",", "goto", "rename_retry", ";", "}", "rcu_read_unlock", "(", ");", "next", "=", "child", "-", ">", "d_u", ".", "d_child", ".", "next", ";", "next", "=", "child", "-", ">", "d_child", ".", "next", ";", "goto", "resume", ";", "}", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "{", "@", "@", "-", "1454", ",", "8", "+", "1453", ",", "8", "@", "@", "struct", "dentry", "*", "__d_alloc", "(", "struct", "super_block", "*", "sb", ",", "const", "struct", "qstr", "*", "name", ")", "INIT_HLIST_BL_NODE", "(", "&", "dentry", "-", ">", "d_hash", ")", ";", "INIT_LIST_HEAD", "(", "&", "dentry", "-", ">", "d_lru", ")", ";", "INIT_LIST_HEAD", "(", "&", "dentry", "-", ">", "d_subdirs", ")", ";", "INIT_HLIST_NODE", "(", "&", "dentry", "-", ">", "d_alias", ")", ";", "INIT_LIST_HEAD", "(", "&", "dentry", "-", ">", "d_u", ".", "d_child", ")", ";", "INIT_HLIST_NODE", "(", "&", "dentry", "-", ">", "d_u", ".", "d_alias", ")", ";", "INIT_LIST_HEAD", "(", "&", "dentry", "-", ">", "d_child", ")", ";", "d_set_d_op", "(", "dentry", ",", "dentry", "-", ">", "d_sb", "-", ">", "s_d_op", ")", ";", "this_cpu_inc", "(", "nr_dentry", ")", ";", "@", "@", "-", "1485", ",", "7", "+", "1484", ",", "7", "@", "@", "struct", "dentry", "*", "d_alloc", "(", "struct", "dentry", "*", "parent", ",", "const", "struct", "qstr", "*", "name", ")", "*", "/", "__dget_dlock", "(", "parent", ")", ";", "dentry", "-", ">", "d_parent", "=", "parent", ";", "list_add", "(", "&", "dentry", "-", ">", "d_u", ".", "d_child", ",", "&", "parent", "-", ">", "d_subdirs", ")", ";", "list_add", "(", "&", "dentry", "-", ">", "d_child", ",", "&", "parent", "-", ">", "d_subdirs", ")", ";", "spin_unlock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "return", "dentry", ";", "@", "@", "-", "1578", ",", "7", "+", "1577", ",", "7", "@", "@", "static", "void", "__d_instantiate", "(", "struct", "dentry", "*", "dentry", ",", "struct", "inode", "*", "inode", ")", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "__d_set_type", "(", "dentry", ",", "add_flags", ")", ";", "if", "(", "inode", ")", "hlist_add_head", "(", "&", "dentry", "-", ">", "d_alias", ",", "&", "inode", "-", ">", "i_dentry", ")", ";", "hlist_add_head", "(", "&", "dentry", "-", ">", "d_u", ".", "d_alias", ",", "&", "inode", "-", ">", "i_dentry", ")", ";", "dentry", "-", ">", "d_inode", "=", "inode", ";", "dentry_rcuwalk_barrier", "(", "dentry", ")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "@", "@", "-", "1602", ",", "7", "+", "1601", ",", "7", "@", "@", "static", "void", "__d_instantiate", "(", "struct", "dentry", "*", "dentry", ",", "struct", "inode", "*", "inode", ")", "void", "d_instantiate", "(", "struct", "dentry", "*", "entry", ",", "struct", "inode", "*", "inode", ")", "{", "BUG_ON", "(", "!", "hlist_unhashed", "(", "&", "entry", "-", ">", "d_alias", ")", ");", "BUG_ON", "(", "!", "hlist_unhashed", "(", "&", "entry", "-", ">", "d_u", ".", "d_alias", ")", ");", "if", "(", "inode", ")", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "__d_instantiate", "(", "entry", ",", "inode", ")", ";", "@", "@", "-", "1641", ",", "7", "+", "1640", ",", "7", "@", "@", "static", "struct", "dentry", "*", "__d_instantiate_unique", "(", "struct", "dentry", "*", "entry", ",", "return", "NULL", ";", "}", "hlist_for_each_entry", "(", "alias", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "alias", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "/", "*", "*", "Don", "'", "t", "need", "alias", "-", ">", "d_lock", "here", ",", "because", "aliases", "with", "*", "d_parent", "=", "=", "entry", "-", ">", "d_parent", "are", "not", "subject", "to", "name", "or", "@", "@", "-", "1667", ",", "7", "+", "1666", ",", "7", "@", "@", "struct", "dentry", "*", "d_instantiate_unique", "(", "struct", "dentry", "*", "entry", ",", "struct", "inode", "*", "inode", ")", "{", "struct", "dentry", "*", "result", ";", "BUG_ON", "(", "!", "hlist_unhashed", "(", "&", "entry", "-", ">", "d_alias", ")", ");", "BUG_ON", "(", "!", "hlist_unhashed", "(", "&", "entry", "-", ">", "d_u", ".", "d_alias", ")", ");", "if", "(", "inode", ")", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "@", "@", "-", "1698", ",", "7", "+", "1697", ",", "7", "@", "@", "EXPORT_SYMBOL", "(", "d_instantiate_unique", ")", ";", "*", "/", "int", "d_instantiate_no_diralias", "(", "struct", "dentry", "*", "entry", ",", "struct", "inode", "*", "inode", ")", "{", "BUG_ON", "(", "!", "hlist_unhashed", "(", "&", "entry", "-", ">", "d_alias", ")", ");", "BUG_ON", "(", "!", "hlist_unhashed", "(", "&", "entry", "-", ">", "d_u", ".", "d_alias", ")", ");", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "if", "(", "S_ISDIR", "(", "inode", "-", ">", "i_mode", ")", "&", "&", "!", "hlist_empty", "(", "&", "inode", "-", ">", "i_dentry", ")", ")", "{", "@", "@", "-", "1737", ",", "7", "+", "1736", ",", "7", "@", "@", "static", "struct", "dentry", "*", "__d_find_any_alias", "(", "struct", "inode", "*", "inode", ")", "if", "(", "hlist_empty", "(", "&", "inode", "-", ">", "i_dentry", ")", ")", "return", "NULL", ";", "alias", "=", "hlist_entry", "(", "inode", "-", ">", "i_dentry", ".", "first", ",", "struct", "dentry", ",", "d_alias", ")", ";", "alias", "=", "hlist_entry", "(", "inode", "-", ">", "i_dentry", ".", "first", ",", "struct", "dentry", ",", "d_u", ".", "d_alias", ")", ";", "__dget", "(", "alias", ")", ";", "return", "alias", ";", "}", "@", "@", "-", "1799", ",", "7", "+", "1798", ",", "7", "@", "@", "static", "struct", "dentry", "*", "__d_obtain_alias", "(", "struct", "inode", "*", "inode", ",", "int", "disconnected", ")", "spin_lock", "(", "&", "tmp", "-", ">", "d_lock", ")", ";", "tmp", "-", ">", "d_inode", "=", "inode", ";", "tmp", "-", ">", "d_flags", "|", "=", "add_flags", ";", "hlist_add_head", "(", "&", "tmp", "-", ">", "d_alias", ",", "&", "inode", "-", ">", "i_dentry", ")", ";", "hlist_add_head", "(", "&", "tmp", "-", ">", "d_u", ".", "d_alias", ",", "&", "inode", "-", ">", "i_dentry", ")", ";", "hlist_bl_lock", "(", "&", "tmp", "-", ">", "d_sb", "-", ">", "s_anon", ")", ";", "hlist_bl_add_head", "(", "&", "tmp", "-", ">", "d_hash", ",", "&", "tmp", "-", ">", "d_sb", "-", ">", "s_anon", ")", ";", "hlist_bl_unlock", "(", "&", "tmp", "-", ">", "d_sb", "-", ">", "s_anon", ")", ";", "@", "@", "-", "2234", ",", "7", "+", "2233", ",", "7", "@", "@", "int", "d_validate", "(", "struct", "dentry", "*", "dentry", ",", "struct", "dentry", "*", "dparent", ")", "struct", "dentry", "*", "child", ";", "spin_lock", "(", "&", "dparent", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "child", ",", "&", "dparent", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "child", ",", "&", "dparent", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "if", "(", "dentry", "=", "=", "child", ")", "{", "spin_lock_nested", "(", "&", "dentry", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "__dget_dlock", "(", "dentry", ")", ";", "@", "@", "-", "2525", ",", "13", "+", "2524", ",", "13", "@", "@", "static", "void", "__d_move", "(", "struct", "dentry", "*", "dentry", ",", "struct", "dentry", "*", "target", ",", "/", "*", "splicing", "a", "tree", "*", "/", "dentry", "-", ">", "d_parent", "=", "target", "-", ">", "d_parent", ";", "target", "-", ">", "d_parent", "=", "target", ";", "list_del_init", "(", "&", "target", "-", ">", "d_u", ".", "d_child", ")", ";", "list_move", "(", "&", "dentry", "-", ">", "d_u", ".", "d_child", ",", "&", "dentry", "-", ">", "d_parent", "-", ">", "d_subdirs", ")", ";", "list_del_init", "(", "&", "target", "-", ">", "d_child", ")", ";", "list_move", "(", "&", "dentry", "-", ">", "d_child", ",", "&", "dentry", "-", ">", "d_parent", "-", ">", "d_subdirs", ")", ";", "}", "else", "{", "/", "*", "swapping", "two", "dentries", "*", "/", "swap", "(", "dentry", "-", ">", "d_parent", ",", "target", "-", ">", "d_parent", ")", ";", "list_move", "(", "&", "target", "-", ">", "d_u", ".", "d_child", ",", "&", "target", "-", ">", "d_parent", "-", ">", "d_subdirs", ")", ";", "list_move", "(", "&", "dentry", "-", ">", "d_u", ".", "d_child", ",", "&", "dentry", "-", ">", "d_parent", "-", ">", "d_subdirs", ")", ";", "list_move", "(", "&", "target", "-", ">", "d_child", ",", "&", "target", "-", ">", "d_parent", "-", ">", "d_subdirs", ")", ";", "list_move", "(", "&", "dentry", "-", ">", "d_child", ",", "&", "dentry", "-", ">", "d_parent", "-", ">", "d_subdirs", ")", ";", "if", "(", "exchange", ")", "fsnotify_d_move", "(", "target", ")", ";", "fsnotify_d_move", "(", "dentry", ")", ";", "@", "@", "-", "3320", ",", "7", "+", "3319", ",", "7", "@", "@", "void", "d_tmpfile", "(", "struct", "dentry", "*", "dentry", ",", "struct", "inode", "*", "inode", ")", "{", "inode_dec_link_count", "(", "inode", ")", ";", "BUG_ON", "(", "dentry", "-", ">", "d_name", ".", "name", "!", "=", "dentry", "-", ">", "d_iname", "|", "|", "!", "hlist_unhashed", "(", "&", "dentry", "-", ">", "d_alias", ")", "|", "|", "!", "hlist_unhashed", "(", "&", "dentry", "-", ">", "d_u", ".", "d_alias", ")", "|", "|", "!", "d_unlinked", "(", "dentry", ")", ");", "spin_lock", "(", "&", "dentry", "-", ">", "d_parent", "-", ">", "d_lock", ")", ";", "spin_lock_nested", "(", "&", "dentry", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "@", "@", "-", "553", ",", "7", "+", "553", ",", "7", "@", "@", "void", "debugfs_remove_recursive", "(", "struct", "dentry", "*", "dentry", ")", "*", "use", "the", "d_u", ".", "d_child", "as", "the", "rcu", "head", "and", "corrupt", "this", "list", ".", "*", "/", "spin_lock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "child", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "child", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "if", "(", "!", "debugfs_positive", "(", "child", ")", ")", "continue", ";", "@", "@", "-", "50", ",", "7", "+", "50", ",", "7", "@", "@", "find_acceptable_alias", "(", "struct", "dentry", "*", "result", ",", "inode", "=", "result", "-", ">", "d_inode", ";", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "dget", "(", "dentry", ")", ";", "spin_unlock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "if", "(", "toput", ")", "@", "@", "-", "114", ",", "18", "+", "114", ",", "18", "@", "@", "loff_t", "dcache_dir_lseek", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "int", "whence", ")", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "/", "*", "d_lock", "not", "required", "for", "cursor", "*", "/", "list_del", "(", "&", "cursor", "-", ">", "d_u", ".", "d_child", ")", ";", "list_del", "(", "&", "cursor", "-", ">", "d_child", ")", ";", "p", "=", "dentry", "-", ">", "d_subdirs", ".", "next", ";", "while", "(", "n", "&", "&", "p", "!", "=", "&", "dentry", "-", ">", "d_subdirs", ")", "{", "struct", "dentry", "*", "next", ";", "next", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "next", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_child", ")", ";", "spin_lock_nested", "(", "&", "next", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "if", "(", "simple_positive", "(", "next", ")", ")", "n", "-", "-;", "spin_unlock", "(", "&", "next", "-", ">", "d_lock", ")", ";", "p", "=", "p", "-", ">", "next", ";", "}", "list_add_tail", "(", "&", "cursor", "-", ">", "d_u", ".", "d_child", ",", "p", ")", ";", "list_add_tail", "(", "&", "cursor", "-", ">", "d_child", ",", "p", ")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "}", "}", "@", "@", "-", "150", ",", "7", "+", "150", ",", "7", "@", "@", "int", "dcache_readdir", "(", "struct", "file", "*", "file", ",", "struct", "dir_context", "*", "ctx", ")", "{", "struct", "dentry", "*", "dentry", "=", "file", "-", ">", "f_path", ".", "dentry", ";", "struct", "dentry", "*", "cursor", "=", "file", "-", ">", "private_data", ";", "struct", "list_head", "*", "p", ",", "*", "q", "=", "&", "cursor", "-", ">", "d_u", ".", "d_child", ";", "struct", "list_head", "*", "p", ",", "*", "q", "=", "&", "cursor", "-", ">", "d_child", ";", "if", "(", "!", "dir_emit_dots", "(", "file", ",", "ctx", ")", ")", "return", "0", ";", "@", "@", "-", "159", ",", "7", "+", "159", ",", "7", "@", "@", "int", "dcache_readdir", "(", "struct", "file", "*", "file", ",", "struct", "dir_context", "*", "ctx", ")", "list_move", "(", "q", ",", "&", "dentry", "-", ">", "d_subdirs", ")", ";", "for", "(", "p", "=", "q", "-", ">", "next", ";", "p", "!", "=", "&", "dentry", "-", ">", "d_subdirs", ";", "p", "=", "p", "-", ">", "next", ")", "{", "struct", "dentry", "*", "next", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "struct", "dentry", "*", "next", "=", "list_entry", "(", "p", ",", "struct", "dentry", ",", "d_child", ")", ";", "spin_lock_nested", "(", "&", "next", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "if", "(", "!", "simple_positive", "(", "next", ")", ")", "{", "spin_unlock", "(", "&", "next", "-", ">", "d_lock", ")", ";", "@", "@", "-", "287", ",", "7", "+", "287", ",", "7", "@", "@", "int", "simple_empty", "(", "struct", "dentry", "*", "dentry", ")", "int", "ret", "=", "0", ";", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "child", ",", "&", "dentry", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "child", ",", "&", "dentry", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "spin_lock_nested", "(", "&", "child", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "if", "(", "simple_positive", "(", "child", ")", ")", "{", "spin_unlock", "(", "&", "child", "-", ">", "d_lock", ")", ";", "@", "@", "-", "403", ",", "7", "+", "403", ",", "7", "@", "@", "ncp_dget_fpos", "(", "struct", "dentry", "*", "dentry", ",", "struct", "dentry", "*", "parent", ",", "unsigned", "long", "fpos", ")", "/", "*", "If", "a", "pointer", "is", "invalid", ",", "we", "search", "the", "dentry", ".", "*", "/", "spin_lock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "dent", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "dent", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "if", "(", "(", "unsigned", "long", ")", "dent", "-", ">", "d_fsdata", "=", "=", "fpos", ")", "{", "if", "(", "dent", "-", ">", "d_inode", ")", "dget", "(", "dent", ")", ";", "@", "@", "-", "191", ",", "7", "+", "191", ",", "7", "@", "@", "ncp_renew_dentries", "(", "struct", "dentry", "*", "parent", ")", "struct", "dentry", "*", "dentry", ";", "spin_lock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "dentry", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "dentry", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "if", "(", "dentry", "-", ">", "d_fsdata", "=", "=", "NULL", ")", "ncp_age_dentry", "(", "server", ",", "dentry", ")", ";", "else", "@", "@", "-", "207", ",", "7", "+", "207", ",", "7", "@", "@", "ncp_invalidate_dircache_entries", "(", "struct", "dentry", "*", "parent", ")", "struct", "dentry", "*", "dentry", ";", "spin_lock", "(", "&", "parent", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "dentry", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "dentry", ",", "&", "parent", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "dentry", "-", ">", "d_fsdata", "=", "NULL", ";", "ncp_age_dentry", "(", "server", ",", "dentry", ")", ";", "}", "@", "@", "-", "58", ",", "7", "+", "58", ",", "7", "@", "@", "static", "int", "nfs_superblock_set_dummy_root", "(", "struct", "super_block", "*", "sb", ",", "struct", "inode", "*", "i", "*", "/", "spin_lock", "(", "&", "sb", "-", ">", "s_root", "-", ">", "d_inode", "-", ">", "i_lock", ")", ";", "spin_lock", "(", "&", "sb", "-", ">", "s_root", "-", ">", "d_lock", ")", ";", "hlist_del_init", "(", "&", "sb", "-", ">", "s_root", "-", ">", "d_alias", ")", ";", "hlist_del_init", "(", "&", "sb", "-", ">", "s_root", "-", ">", "d_u", ".", "d_alias", ")", ";", "spin_unlock", "(", "&", "sb", "-", ">", "s_root", "-", ">", "d_lock", ")", ";", "spin_unlock", "(", "&", "sb", "-", ">", "s_root", "-", ">", "d_inode", "-", ">", "i_lock", ")", ";", "}", "@", "@", "-", "63", ",", "14", "+", "63", ",", "14", "@", "@", "void", "__fsnotify_update_child_dentry_flags", "(", "struct", "inode", "*", "inode", ")", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "/", "*", "run", "all", "of", "the", "dentries", "associated", "with", "this", "inode", ".", "Since", "this", "is", "a", "*", "directory", ",", "there", "damn", "well", "better", "only", "be", "one", "item", "on", "this", "list", "*", "/", "hlist_for_each_entry", "(", "alias", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "alias", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "struct", "dentry", "*", "child", ";", "/", "*", "run", "all", "of", "the", "children", "of", "the", "original", "inode", "and", "fix", "their", "*", "d_flags", "to", "indicate", "parental", "interest", "(", "their", "parent", "is", "the", "*", "original", "inode", ")", "*", "/", "spin_lock", "(", "&", "alias", "-", ">", "d_lock", ")", ";", "list_for_each_entry", "(", "child", ",", "&", "alias", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "child", ",", "&", "alias", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "if", "(", "!", "child", "-", ">", "d_inode", ")", "continue", ";", "@", "@", "-", "172", ",", "7", "+", "172", ",", "7", "@", "@", "struct", "dentry", "*", "ocfs2_find_local_alias", "(", "struct", "inode", "*", "inode", ",", "struct", "dentry", "*", "dentry", ";", "spin_lock", "(", "&", "inode", "-", ">", "i_lock", ")", ";", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_alias", ")", "{", "hlist_for_each_entry", "(", "dentry", ",", "&", "inode", "-", ">", "i_dentry", ",", "d_u", ".", "d_alias", ")", "{", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "if", "(", "ocfs2_match_dentry", "(", "dentry", ",", "parent_blkno", ",", "skip_unhashed", ")", ")", "{", "trace_ocfs2_find_local_alias", "(", "dentry", "-", ">", "d_name", ".", "len", ",", "@", "@", "-", "124", ",", "15", "+", "124", ",", "15", "@", "@", "struct", "dentry", "{", "void", "*", "d_fsdata", ";", "/", "*", "fs", "-", "specific", "data", "*", "/", "struct", "list_head", "d_lru", ";", "/", "*", "LRU", "list", "*", "/", "struct", "list_head", "d_child", ";", "/", "*", "child", "of", "parent", "list", "*", "/", "struct", "list_head", "d_subdirs", ";", "/", "*", "our", "children", "*", "/", "/", "*", "*", "d_child", "and", "d_rcu", "can", "share", "memory", "*", "d_alias", "and", "d_rcu", "can", "share", "memory", "*", "/", "union", "{", "struct", "list_head", "d_child", ";", "/", "*", "child", "of", "parent", "list", "*", "/", "struct", "hlist_node", "d_alias", ";", "/", "*", "inode", "alias", "list", "*", "/", "struct", "rcu_head", "d_rcu", ";", "}", "d_u", ";", "struct", "list_head", "d_subdirs", ";", "/", "*", "our", "children", "*", "/", "struct", "hlist_node", "d_alias", ";", "/", "*", "inode", "alias", "list", "*", "/", "}", ";", "/", "*", "@", "@", "-", "6420", ",", "7", "+", "6420", ",", "7", "@", "@", "static", "int", "instance_mkdir", "(", "struct", "inode", "*", "inode", ",", "struct", "dentry", "*", "dentry", ",", "umode_t", "m", "int", "ret", ";", "/", "*", "Paranoid", ":", "Make", "sure", "the", "parent", "is", "the", "\"", "instances", "\"", "directory", "*", "/", "parent", "=", "hlist_entry", "(", "inode", "-", ">", "i_dentry", ".", "first", ",", "struct", "dentry", ",", "d_alias", ")", ";", "parent", "=", "hlist_entry", "(", "inode", "-", ">", "i_dentry", ".", "first", ",", "struct", "dentry", ",", "d_u", ".", "d_alias", ")", ";", "if", "(", "WARN_ON_ONCE", "(", "parent", "!", "=", "trace_instance_dir", ")", ")", "return", "-", "ENOENT", ";", "@", "@", "-", "6447", ",", "7", "+", "6447", ",", "7", "@", "@", "static", "int", "instance_rmdir", "(", "struct", "inode", "*", "inode", ",", "struct", "dentry", "*", "dentry", ")", "int", "ret", ";", "/", "*", "Paranoid", ":", "Make", "sure", "the", "parent", "is", "the", "\"", "instances", "\"", "directory", "*", "/", "parent", "=", "hlist_entry", "(", "inode", "-", ">", "i_dentry", ".", "first", ",", "struct", "dentry", ",", "d_alias", ")", ";", "parent", "=", "hlist_entry", "(", "inode", "-", ">", "i_dentry", ".", "first", ",", "struct", "dentry", ",", "d_u", ".", "d_alias", ")", ";", "if", "(", "WARN_ON_ONCE", "(", "parent", "!", "=", "trace_instance_dir", ")", ")", "return", "-", "ENOENT", ";", "@", "@", "-", "461", ",", "7", "+", "461", ",", "7", "@", "@", "static", "void", "remove_event_file_dir", "(", "struct", "ftrace_event_file", "*", "file", ")", "if", "(", "dir", ")", "{", "spin_lock", "(", "&", "dir", "-", ">", "d_lock", ")", ";", "/", "*", "probably", "unneeded", "*", "/", "list_for_each_entry", "(", "child", ",", "&", "dir", "-", ">", "d_subdirs", ",", "d_u", ".", "d_child", ")", "{", "list_for_each_entry", "(", "child", ",", "&", "dir", "-", ">", "d_subdirs", ",", "d_child", ")", "{", "if", "(", "child", "-", ">", "d_inode", ")", "/", "*", "probably", "unneeded", "*", "/", "child", "-", ">", "d_inode", "-", ">", "i_private", "=", "NULL", ";", "}", "@", "@", "-", "1200", ",", "7", "+", "1200", ",", "7", "@", "@", "static", "void", "sel_remove_entries", "(", "struct", "dentry", "*", "de", ")", "spin_lock", "(", "&", "de", "-", ">", "d_lock", ")", ";", "node", "=", "de", "-", ">", "d_subdirs", ".", "next", ";", "while", "(", "node", "!", "=", "&", "de", "-", ">", "d_subdirs", ")", "{", "struct", "dentry", "*", "d", "=", "list_entry", "(", "node", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "struct", "dentry", "*", "d", "=", "list_entry", "(", "node", ",", "struct", "dentry", ",", "d_child", ")", ";", "spin_lock_nested", "(", "&", "d", "-", ">", "d_lock", ",", "DENTRY_D_LOCK_NESTED", ")", ";", "list_del_init", "(", "node", ")", ";", "@", "@", "-", "1674", ",", "12", "+", "1674", ",", "12", "@", "@", "static", "void", "sel_remove_classes", "(", "void", ")", "list_for_each", "(", "class_node", ",", "&", "class_dir", "-", ">", "d_subdirs", ")", "{", "struct", "dentry", "*", "class_subdir", "=", "list_entry", "(", "class_node", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "struct", "dentry", ",", "d_child", ")", ";", "struct", "list_head", "*", "class_subdir_node", ";", "list_for_each", "(", "class_subdir_node", ",", "&", "class_subdir", "-", ">", "d_subdirs", ")", "{", "struct", "dentry", "*", "d", "=", "list_entry", "(", "class_subdir_node", ",", "struct", "dentry", ",", "d_u", ".", "d_child", ")", ";", "struct", "dentry", ",", "d_child", ")", ";", "if", "(", "d", "-", ">", "d_inode", ")", "if", "(", "d", "-", ">", "d_inode", "-", ">", "i_mode", "&", "S_IFDIR", ")"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Clean-up", "i18n", "for", "ChunkedInputFilter", "error", "message", "Add", "error", "flag", "to", "allow", "subsequent", "attempts", "at", "reading", "after", "an", "error", "to", "fail", "fast", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1601333", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "14", ",", "7", "+", "14", ",", "6", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "coyote", ".", "http11", ".", "filters", ";", "import", "java", ".", "io", ".", "EOFException", ";", "@", "@", "-", "29", ",", "6", "+", "28", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "buf", ".", "HexUtils", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "buf", ".", "MessageBytes", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "http", ".", "MimeHeaders", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "res", ".", "StringManager", ";", "/", "**", "*", "Chunked", "input", "filter", ".", "Parses", "chunked", "data", "according", "to", "@", "@", "-", "39", ",", "17", "+", "39", ",", "18", "@", "@", "*", "/", "public", "class", "ChunkedInputFilter", "implements", "InputFilter", "{", "private", "static", "final", "StringManager", "sm", "=", "StringManager", ".", "getManager", "(", "ChunkedInputFilter", ".", "class", ".", "getPackage", "(", ").", "getName", "(", "))", ";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "Constants", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "Constants", "protected", "static", "final", "String", "ENCODING_NAME", "=", "\"", "chunked", "\"", ";", "protected", "static", "final", "ByteChunk", "ENCODING", "=", "new", "ByteChunk", "(", ");", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Static", "Initializer", "static", "{", "ENCODING", ".", "setBytes", "(", "ENCODING_NAME", ".", "getBytes", "(", "Charset", ".", "defaultCharset", "(", "))", ",", "0", ",", "ENCODING_NAME", ".", "length", "(", "))", ";", "@", "@", "-", "58", ",", "7", "+", "59", ",", "6", "@", "@", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Instance", "Variables", "/", "**", "*", "Next", "buffer", "in", "the", "pipeline", ".", "*", "/", "@", "@", "-", "106", ",", "6", "+", "106", ",", "7", "@", "@", "*", "/", "protected", "ByteChunk", "trailingHeaders", "=", "new", "ByteChunk", "(", ");", "/", "**", "*", "Flag", "set", "to", "true", "if", "the", "next", "call", "to", "doRead", "(", ")", "must", "parse", "a", "CRLF", "pair", "*", "before", "doing", "anything", "else", ".", "@", "@", "-", "130", ",", "21", "+", "131", ",", "29", "@", "@", "*", "/", "private", "final", "int", "maxTrailerSize", ";", "/", "**", "*", "Size", "of", "extensions", "processed", "for", "this", "request", ".", "*", "/", "private", "long", "extensionSize", ";", "/", "**", "*", "Flag", "that", "indicates", "if", "an", "error", "has", "occurred", ".", "*", "/", "private", "boolean", "error", ";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Constructors", "public", "ChunkedInputFilter", "(", "int", "maxTrailerSize", ",", "int", "maxExtensionSize", ")", "{", "this", ".", "trailingHeaders", ".", "setLimit", "(", "maxTrailerSize", ")", ";", "this", ".", "maxExtensionSize", "=", "maxExtensionSize", ";", "this", ".", "maxTrailerSize", "=", "maxTrailerSize", ";", "}", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "InputBuffer", "Methods", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "InputBuffer", "Methods", "/", "**", "*", "Read", "bytes", ".", "@", "@", "-", "156", ",", "11", "+", "165", ",", "12", "@", "@", "public", "ChunkedInputFilter", "(", "int", "maxTrailerSize", ",", "int", "maxExtensionSize", ")", "{", "*", "control", ",", "the", "returned", "value", "should", "be", "-", "1", ".", "*", "/", "@", "Override", "public", "int", "doRead", "(", "ByteChunk", "chunk", ",", "Request", "req", ")", "throws", "IOException", "{", "if", "(", "endChunk", ")", "public", "int", "doRead", "(", "ByteChunk", "chunk", ",", "Request", "req", ")", "throws", "IOException", "{", "if", "(", "endChunk", ")", "{", "return", "-", "1", ";", "}", "checkError", "(", ");", "if", "(", "needCRLFParse", ")", "{", "needCRLFParse", "=", "false", ";", "@", "@", "-", "169", ",", "7", "+", "179", ",", "7", "@", "@", "public", "int", "doRead", "(", "ByteChunk", "chunk", ",", "Request", "req", ")", "if", "(", "remaining", "<", "=", "0", ")", "{", "if", "(", "!", "parseChunkHeader", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Invalid", "chunk", "header", "\"", ");", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "invalidHeader", "\"", "))", ";", "}", "if", "(", "endChunk", ")", "{", "parseEndChunk", "(", ");", "@", "@", "-", "181", ",", "8", "+", "191", ",", "7", "@", "@", "public", "int", "doRead", "(", "ByteChunk", "chunk", ",", "Request", "req", ")", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "Unexpected", "end", "of", "stream", "whilst", "reading", "request", "body", "\"", ");", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "eos", "\"", "))", ";", "}", "}", "@", "@", "-", "207", ",", "13", "+", "216", ",", "11", "@", "@", "public", "int", "doRead", "(", "ByteChunk", "chunk", ",", "Request", "req", ")", "}", "return", "result", ";", "}", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "InputFilter", "Methods", "/", "**", "*", "Read", "the", "content", "length", "from", "the", "request", ".", "*", "/", "@", "@", "-", "227", ",", "17", "+", "234", ",", "14", "@", "@", "public", "void", "setRequest", "(", "Request", "request", ")", "{", "*", "End", "the", "current", "request", ".", "*", "/", "@", "Override", "public", "long", "end", "(", ")", "throws", "IOException", "{", "public", "long", "end", "(", ")", "throws", "IOException", "{", "/", "/", "Consume", "extra", "bytes", ":", "parse", "the", "stream", "until", "the", "end", "chunk", "is", "found", "while", "(", "doRead", "(", "readChunk", ",", "null", ")", ">", "=", "0", ")", "{", "/", "/", "NOOP", ":", "Just", "consume", "the", "input", "}", "/", "/", "Return", "the", "number", "of", "extra", "bytes", "which", "were", "consumed", "return", "(", "lastValid", "-", "pos", ")", ";", "return", "lastValid", "-", "pos", ";", "}", "@", "@", "-", "246", ",", "7", "+", "250", ",", "7", "@", "@", "public", "long", "end", "(", ")", "*", "/", "@", "Override", "public", "int", "available", "(", ")", "{", "return", "(", "lastValid", "-", "pos", ")", ";", "return", "lastValid", "-", "pos", ";", "}", "@", "@", "-", "272", ",", "6", "+", "276", ",", "7", "@", "@", "public", "void", "recycle", "(", ")", "{", "trailingHeaders", ".", "recycle", "(", ");", "trailingHeaders", ".", "setLimit", "(", "maxTrailerSize", ")", ";", "extensionSize", "=", "0", ";", "error", "=", "false", ";", "}", "@", "@", "-", "287", ",", "20", "+", "292", ",", "17", "@", "@", "public", "ByteChunk", "getEncodingName", "(", ")", "{", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "Protected", "Methods", "/", "**", "*", "Read", "bytes", "from", "the", "previous", "buffer", ".", "*", "/", "protected", "int", "readBytes", "(", ")", "throws", "IOException", "{", "protected", "int", "readBytes", "(", ")", "throws", "IOException", "{", "int", "nRead", "=", "buffer", ".", "doRead", "(", "readChunk", ",", "null", ")", ";", "pos", "=", "readChunk", ".", "getStart", "(", ");", "lastValid", "=", "pos", "+", "nRead", ";", "buf", "=", "readChunk", ".", "getBytes", "(", ");", "return", "nRead", ";", "}", "@", "@", "-", "315", ",", "8", "+", "317", ",", "7", "@", "@", "protected", "int", "readBytes", "(", ")", "*", "digits", ".", "We", "should", "not", "parse", "F23IAMGONNAMESSTHISUP34CRLF", "as", "a", "valid", "*", "header", "according", "to", "the", "spec", ".", "*", "/", "protected", "boolean", "parseChunkHeader", "(", ")", "throws", "IOException", "{", "protected", "boolean", "parseChunkHeader", "(", ")", "throws", "IOException", "{", "int", "result", "=", "0", ";", "boolean", "eol", "=", "false", ";", "@", "@", "-", "356", ",", "29", "+", "357", ",", "30", "@", "@", "protected", "boolean", "parseChunkHeader", "(", ")", "/", "/", "validated", ".", "Currently", "it", "is", "simply", "ignored", ".", "extensionSize", "+", "+;", "if", "(", "maxExtensionSize", ">", "-", "1", "&", "&", "extensionSize", ">", "maxExtensionSize", ")", "{", "throw", "new", "IOException", "(", "\"", "maxExtensionSize", "exceeded", "\"", ");", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "maxExtension", "\"", "))", ";", "}", "}", "/", "/", "Parsing", "the", "CRLF", "increments", "pos", "if", "(", "!", "eol", ")", "{", "pos", "+", "+;", "}", "}", "if", "(", "readDigit", "=", "=", "0", "|", "|", "result", "<", "0", ")", "if", "(", "readDigit", "=", "=", "0", "|", "|", "result", "<", "0", ")", "{", "return", "false", ";", "}", "if", "(", "result", "=", "=", "0", ")", "if", "(", "result", "=", "=", "0", ")", "{", "endChunk", "=", "true", ";", "}", "remaining", "=", "result", ";", "if", "(", "remaining", "<", "0", ")", "if", "(", "remaining", "<", "0", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "@", "-", "405", ",", "26", "+", "407", ",", "27", "@", "@", "protected", "void", "parseCRLF", "(", "boolean", "tolerant", ")", "throws", "IOException", "{", "boolean", "crfound", "=", "false", ";", "while", "(", "!", "eol", ")", "{", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "=", "0", ")", "throw", "new", "IOException", "(", "\"", "Invalid", "CRLF", "\"", ");", "if", "(", "readBytes", "(", ")", "<", "=", "0", ")", "{", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "invalidCrlfNoData", "\"", "))", ";", "}", "}", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "CR", ")", "{", "if", "(", "crfound", ")", "throw", "new", "IOException", "(", "\"", "Invalid", "CRLF", ",", "two", "CR", "characters", "encountered", ".", "\")", ";", "if", "(", "crfound", ")", "{", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "invalidCrlfCRCR", "\"", "))", ";", "}", "crfound", "=", "true", ";", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "!", "tolerant", "&", "&", "!", "crfound", ")", "{", "throw", "new", "IOException", "(", "\"", "Invalid", "CRLF", ",", "no", "CR", "character", "encountered", ".", "\")", ";", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "invalidCrlfNoCR", "\"", "))", ";", "}", "eol", "=", "true", ";", "}", "else", "{", "throw", "new", "IOException", "(", "\"", "Invalid", "CRLF", "\"", ");", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "invalidCrlf", "\"", "))", ";", "}", "pos", "+", "+;", "}", "}", "@", "@", "-", "433", ",", "7", "+", "436", ",", "6", "@", "@", "protected", "void", "parseCRLF", "(", "boolean", "tolerant", ")", "throws", "IOException", "{", "*", "Parse", "end", "chunk", "data", ".", "*", "/", "protected", "void", "parseEndChunk", "(", ")", "throws", "IOException", "{", "/", "/", "Handle", "optional", "trailer", "headers", "while", "(", "parseHeader", "(", "))", "{", "/", "/", "Loop", "until", "we", "run", "out", "of", "headers", "@", "@", "-", "449", ",", "8", "+", "451", ",", "9", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "Read", "new", "bytes", "if", "needed", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "0", ")", "throw", "new", "EOFException", "(", "\"", "Unexpected", "end", "of", "stream", "whilst", "reading", "trailer", "headers", "for", "chunked", "request", "\"", ");", "if", "(", "readBytes", "(", ")", "<", "0", ")", "{", "throwEOFException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "eosTrailer", "\"", "))", ";", "}", "}", "chr", "=", "buf", "[", "pos", "]", ";", "@", "@", "-", "474", ",", "8", "+", "477", ",", "9", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "Read", "new", "bytes", "if", "needed", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "0", ")", "throw", "new", "EOFException", "(", "\"", "Unexpected", "end", "of", "stream", "whilst", "reading", "trailer", "headers", "for", "chunked", "request", "\"", ");", "if", "(", "readBytes", "(", ")", "<", "0", ")", "{", "throwEOFException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "eosTrailer", "\"", "))", ";", "}", "}", "chr", "=", "buf", "[", "pos", "]", ";", "@", "@", "-", "515", ",", "8", "+", "519", ",", "9", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "Read", "new", "bytes", "if", "needed", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "0", ")", "throw", "new", "EOFException", "(", "\"", "Unexpected", "end", "of", "stream", "whilst", "reading", "trailer", "headers", "for", "chunked", "request", "\"", ");", "if", "(", "readBytes", "(", ")", "<", "0", ")", "{", "throwEOFException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "eosTrailer", "\"", "))", ";", "}", "}", "chr", "=", "buf", "[", "pos", "]", ";", "@", "@", "-", "526", ",", "7", "+", "531", ",", "7", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "limit", "placed", "on", "trailing", "header", "size", "int", "newlimit", "=", "trailingHeaders", ".", "getLimit", "(", ")", "-", "1", ";", "if", "(", "trailingHeaders", ".", "getEnd", "(", ")", ">", "newlimit", ")", "{", "throw", "new", "IOException", "(", "\"", "Exceeded", "maxTrailerSize", "\"", ");", "throwIOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "maxTrailer", "\"", "))", ";", "}", "trailingHeaders", ".", "setLimit", "(", "newlimit", ")", ";", "}", "else", "{", "@", "@", "-", "540", ",", "8", "+", "545", ",", "9", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "Read", "new", "bytes", "if", "needed", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "0", ")", "throw", "new", "EOFException", "(", "\"", "Unexpected", "end", "of", "stream", "whilst", "reading", "trailer", "headers", "for", "chunked", "request", "\"", ");", "if", "(", "readBytes", "(", ")", "<", "0", ")", "{", "throwEOFException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "eosTrailer", "\"", "))", ";", "}", "}", "chr", "=", "buf", "[", "pos", "]", ";", "@", "@", "-", "565", ",", "8", "+", "571", ",", "9", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "Read", "new", "bytes", "if", "needed", "if", "(", "pos", ">", "=", "lastValid", ")", "{", "if", "(", "readBytes", "(", ")", "<", "0", ")", "throw", "new", "EOFException", "(", "\"", "Unexpected", "end", "of", "stream", "whilst", "reading", "trailer", "headers", "for", "chunked", "request", "\"", ");", "if", "(", "readBytes", "(", ")", "<", "0", ")", "{", "throwEOFException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "eosTrailer", "\"", "))", ";", "}", "}", "chr", "=", "buf", "[", "pos", "]", ";", "@", "@", "-", "587", ",", "4", "+", "594", ",", "23", "@", "@", "private", "boolean", "parseHeader", "(", ")", "throws", "IOException", "{", "return", "true", ";", "}", "private", "void", "throwIOException", "(", "String", "msg", ")", "throws", "IOException", "{", "error", "=", "true", ";", "throw", "new", "IOException", "(", "msg", ")", ";", "}", "private", "void", "throwEOFException", "(", "String", "msg", ")", "throws", "IOException", "{", "error", "=", "true", ";", "throw", "new", "EOFException", "(", "msg", ")", ";", "}", "private", "void", "checkError", "(", ")", "throws", "IOException", "{", "if", "(", "error", ")", "{", "throw", "new", "IOException", "(", "sm", ".", "getString", "(", "\"", "chunkedInputFilter", ".", "error", "\"", "))", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "25", "@", "@", "#", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "#", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "#", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "#", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "#", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "#", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "#", "#", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "#", "#", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "#", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "#", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "#", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "#", "limitations", "under", "the", "License", ".", "chunkedInputFilter", ".", "error", "=", "No", "data", "available", "due", "to", "previous", "error", "chunkedInputFilter", ".", "eos", "=", "Unexpected", "end", "of", "stream", "while", "reading", "request", "body", "chunkedInputFilter", ".", "eosTrailer", "=", "Unexpected", "end", "of", "stream", "while", "reading", "trailer", "headers", "chunkedInputFilter", ".", "invalidCrlf", "=", "Invalid", "end", "of", "line", "sequence", "(", "character", "other", "than", "CR", "or", "LF", "found", ")", "chunkedInputFilter", ".", "invalidCrlfCRCR", "=", "Invalid", "end", "of", "line", "sequence", "(", "CRCR", ")", "chunkedInputFilter", ".", "invalidCrlfNoCR", "=", "Invalid", "end", "of", "line", "sequence", "(", "No", "CR", "before", "LF", ")", "chunkedInputFilter", ".", "invalidCrlfNoData", "=", "Invalid", "end", "of", "line", "sequence", "(", "no", "data", "available", "to", "read", ")", "chunkedInputFilter", ".", "invalidHeader", "=", "Invalid", "chunk", "header", "chunkedInputFilter", ".", "maxExtension", "=", "maxExtensionSize", "exceeded", "chunkedInputFilter", ".", "maxTrailer", "=", "maxTrailerSize", "exceeded", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["by", "streaming", "data", "with", "malformed", "chunked", "transfer", "coding", "."]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/104"], "code_tokens": ["@", "@", "-", "347", ",", "7", "+", "347", ",", "8", "@", "@", "static", "MagickBooleanType", "load_tile", "(", "Image", "*", "image", ",", "Image", "*", "tile_image", ",", "*", "xcfdata", ",", "*", "xcfodata", ";", "xcfdata", "=", "(", "XCFPixelInfo", "*", ")", "AcquireQuantumMemory", "(", "data_length", ",", "sizeof", "(", "*", "xcfdata", ")", ");", "xcfdata", "=", "(", "XCFPixelInfo", "*", ")", "AcquireQuantumMemory", "(", "MagickMax", "(", "data_length", ",", "tile_image", "-", ">", "columns", "*", "tile_image", "-", ">", "rows", ")", ",", "sizeof", "(", "*", "xcfdata", ")", ");", "if", "(", "xcfdata", "=", "=", "(", "XCFPixelInfo", "*", ")", "NULL", ")", "ThrowBinaryException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ",", "image", "-", ">", "filename", ")", ";"], "docstring_tokens": ["malformed", "files"]}
{"contents": ["ext4:", "fix", "races", "between", "page", "faults", "and", "hole", "punching", "Currently,", "page", "faults", "and", "hole", "punching", "are", "completely", "unsynchronized.", "This", "can", "result", "in", "page", "fault", "faulting", "in", "a", "page", "into", "a", "range", "that", "we", "are", "punching", "after", "truncate_pagecache_range()", "has", "been", "called", "and", "thus", "we", "can", "end", "up", "with", "a", "page", "mapped", "to", "disk", "blocks", "that", "will", "be", "shortly", "freed.", "Filesystem", "corruption", "will", "shortly", "follow.", "Note", "that", "the", "same", "race", "is", "avoided", "for", "truncate", "by", "checking", "page", "fault", "offset", "against", "i_size", "but", "there", "isn't", "similar", "mechanism", "available", "for", "punching", "holes.", "Fix", "the", "problem", "by", "creating", "new", "rw", "semaphore", "i_mmap_sem", "in", "inode", "and", "grab", "it", "for", "writing", "over", "truncate,", "hole", "punching,", "and", "other", "functions", "removing", "blocks", "from", "extent", "tree", "and", "for", "read", "over", "page", "faults.", "We", "cannot", "easily", "use", "i_data_sem", "for", "this", "since", "that", "ranks", "below", "transaction", "start", "and", "we", "need", "something", "ranking", "above", "it", "so", "that", "it", "can", "be", "held", "over", "the", "whole", "truncate", "/", "hole", "punching", "operation.", "Also", "remove", "various", "workarounds", "we", "had", "in", "the", "code", "to", "reduce", "race", "window", "when", "page", "fault", "could", "have", "created", "pages", "with", "stale", "mapping", "information.", "Signed-off-by:", "Jan", "Kara", "<jack@suse.com>", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>"], "code_tokens": ["@", "@", "-", "910", ",", "6", "+", "910", ",", "15", "@", "@", "struct", "ext4_inode_info", "{", "*", "by", "other", "means", ",", "so", "we", "have", "i_data_sem", ".", "*", "/", "struct", "rw_semaphore", "i_data_sem", ";", "/", "*", "*", "i_mmap_sem", "is", "for", "serializing", "page", "faults", "with", "truncate", "/", "punch", "hole", "*", "operations", ".", "We", "have", "to", "make", "sure", "that", "new", "page", "cannot", "be", "faulted", "in", "*", "a", "section", "of", "the", "inode", "that", "is", "being", "punched", ".", "We", "cannot", "easily", "use", "*", "i_data_sem", "for", "this", "since", "we", "need", "protection", "for", "the", "whole", "punch", "*", "operation", "and", "i_data_sem", "ranks", "below", "transaction", "start", "so", "we", "have", "*", "to", "occasionally", "drop", "it", ".", "*", "/", "struct", "rw_semaphore", "i_mmap_sem", ";", "struct", "inode", "vfs_inode", ";", "struct", "jbd2_inode", "*", "jinode", ";", "@", "@", "-", "2484", ",", "6", "+", "2493", ",", "7", "@", "@", "extern", "int", "ext4_chunk_trans_blocks", "(", "struct", "inode", "*", ",", "int", "nrblocks", ")", ";", "extern", "int", "ext4_zero_partial_blocks", "(", "handle_t", "*", "handle", ",", "struct", "inode", "*", "inode", ",", "loff_t", "lstart", ",", "loff_t", "lend", ")", ";", "extern", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", ";", "extern", "int", "ext4_filemap_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", ";", "extern", "qsize_t", "*", "ext4_get_reserved_space", "(", "struct", "inode", "*", "inode", ")", ";", "extern", "void", "ext4_da_update_reserve_space", "(", "struct", "inode", "*", "inode", ",", "int", "used", ",", "int", "quota_claim", ")", ";", "@", "@", "-", "4770", ",", "7", "+", "4770", ",", "6", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "int", "partial_begin", ",", "partial_end", ";", "loff_t", "start", ",", "end", ";", "ext4_lblk_t", "lblk", ";", "struct", "address_space", "*", "mapping", "=", "inode", "-", ">", "i_mapping", ";", "unsigned", "int", "blkbits", "=", "inode", "-", ">", "i_blkbits", ";", "trace_ext4_zero_range", "(", "inode", ",", "offset", ",", "len", ",", "mode", ")", ";", "@", "@", "-", "4785", ",", "17", "+", "4784", ",", "6", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "return", "ret", ";", "}", "/", "*", "*", "Write", "out", "all", "dirty", "pages", "to", "avoid", "race", "conditions", "*", "Then", "release", "them", ".", "*", "/", "if", "(", "mapping", "-", ">", "nrpages", "&", "&", "mapping_tagged", "(", "mapping", ",", "PAGECACHE_TAG_DIRTY", ")", ")", "{", "ret", "=", "filemap_write_and_wait_range", "(", "mapping", ",", "offset", ",", "offset", "+", "len", "-", "1", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "}", "/", "*", "*", "Round", "up", "offset", ".", "This", "is", "not", "fallocate", ",", "we", "neet", "to", "zero", "out", "*", "blocks", ",", "so", "convert", "interior", "block", "aligned", "part", "of", "the", "range", "to", "@", "@", "-", "4856", ",", "16", "+", "4844", ",", "22", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "flags", "|", "=", "(", "EXT4_GET_BLOCKS_CONVERT_UNWRITTEN", "|", "EXT4_EX_NOCACHE", ")", ";", "/", "*", "Now", "release", "the", "pages", "and", "zero", "block", "aligned", "part", "of", "pages", "*", "/", "truncate_pagecache_range", "(", "inode", ",", "start", ",", "end", "-", "1", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "*", "released", "from", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "Now", "release", "the", "pages", "and", "zero", "block", "aligned", "part", "of", "pages", "*", "/", "truncate_pagecache_range", "(", "inode", ",", "start", ",", "end", "-", "1", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "ret", "=", "ext4_alloc_file_blocks", "(", "file", ",", "lblk", ",", "max_blocks", ",", "new_size", ",", "flags", ",", "mode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "ret", ")", "goto", "out_dio", ";", "}", "@", "@", "-", "5524", ",", "17", "+", "5518", ",", "22", "@", "@", "int", "ext4_collapse_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "goto", "out_mutex", ";", "}", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "/", "*", "Wait", "for", "existing", "dio", "to", "complete", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "handle", "=", "ext4_journal_start", "(", "inode", ",", "EXT4_HT_TRUNCATE", ",", "credits", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "handle", ")", ";", "goto", "out_dio", ";", "goto", "out_mmap", ";", "}", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_data_sem", ")", ";", "@", "@", "-", "5573", ",", "7", "+", "5572", ",", "8", "@", "@", "int", "ext4_collapse_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "out_mmap", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "5660", ",", "17", "+", "5660", ",", "22", "@", "@", "int", "ext4_insert_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "goto", "out_mutex", ";", "}", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "/", "*", "Wait", "for", "existing", "dio", "to", "complete", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "handle", "=", "ext4_journal_start", "(", "inode", ",", "EXT4_HT_TRUNCATE", ",", "credits", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "handle", ")", ";", "goto", "out_dio", ";", "goto", "out_mmap", ";", "}", "/", "*", "Expand", "file", "to", "avoid", "data", "loss", "if", "there", "is", "error", "while", "shifting", "*", "/", "@", "@", "-", "5741", ",", "7", "+", "5746", ",", "8", "@", "@", "int", "ext4_insert_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "out_mmap", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "209", ",", "15", "+", "209", ",", "18", "@", "@", "static", "int", "ext4_dax_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "int", "result", ";", "handle_t", "*", "handle", "=", "NULL", ";", "struct", "super_block", "*", "sb", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", "->", "i_sb", ";", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "struct", "super_block", "*", "sb", "=", "inode", "-", ">", "i_sb", ";", "bool", "write", "=", "vmf", "-", ">", "flags", "&", "FAULT_FLAG_WRITE", ";", "if", "(", "write", ")", "{", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "handle", "=", "ext4_journal_start_sb", "(", "sb", ",", "EXT4_HT_WRITE_PAGE", ",", "EXT4_DATA_TRANS_BLOCKS", "(", "sb", ")", ");", "}", "}", "else", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "result", "=", "VM_FAULT_SIGBUS", ";", "@", "@", "-", "228", ",", "8", "+", "231", ",", "10", "@", "@", "static", "int", "ext4_dax_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "if", "(", "write", ")", "{", "if", "(", "!", "IS_ERR", "(", "handle", ")", ")", "ext4_journal_stop", "(", "handle", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "}", "}", "else", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "result", ";", "}", "@", "@", "-", "246", ",", "10", "+", "251", ",", "12", "@", "@", "static", "int", "ext4_dax_pmd_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "addr", ",", "if", "(", "write", ")", "{", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "handle", "=", "ext4_journal_start_sb", "(", "sb", ",", "EXT4_HT_WRITE_PAGE", ",", "ext4_chunk_trans_blocks", "(", "inode", ",", "PMD_SIZE", "/", "PAGE_SIZE", ")", ");", "}", "}", "else", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "result", "=", "VM_FAULT_SIGBUS", ";", "@", "@", "-", "260", ",", "30", "+", "267", ",", "71", "@", "@", "static", "int", "ext4_dax_pmd_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "addr", ",", "if", "(", "write", ")", "{", "if", "(", "!", "IS_ERR", "(", "handle", ")", ")", "ext4_journal_stop", "(", "handle", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "}", "}", "else", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "result", ";", "}", "static", "int", "ext4_dax_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "return", "dax_mkwrite", "(", "vma", ",", "vmf", ",", "ext4_get_block_dax", ",", "ext4_end_io_unwritten", ")", ";", "int", "err", ";", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "sb_start_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "err", "=", "__dax_mkwrite", "(", "vma", ",", "vmf", ",", "ext4_get_block_dax", ",", "ext4_end_io_unwritten", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "err", ";", "}", "/", "*", "*", "Handle", "write", "fault", "for", "VM_MIXEDMAP", "mappings", ".", "Similarly", "to", "ext4_dax_mkwrite", "(", ")", "*", "handler", "we", "check", "for", "races", "agaist", "truncate", ".", "Note", "that", "since", "we", "cycle", "through", "*", "i_mmap_sem", ",", "we", "are", "sure", "that", "also", "any", "hole", "punching", "that", "began", "before", "we", "*", "were", "called", "is", "finished", "by", "now", "and", "so", "if", "it", "included", "part", "of", "the", "file", "we", "*", "are", "working", "on", ",", "our", "pte", "will", "get", "unmapped", "and", "the", "check", "for", "pte_same", "(", ")", "in", "*", "wp_pfn_shared", "(", ")", "fails", ".", "Thus", "fault", "gets", "retried", "and", "things", "work", "out", "as", "*", "desired", ".", "*", "/", "static", "int", "ext4_dax_pfn_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "struct", "super_block", "*", "sb", "=", "inode", "-", ">", "i_sb", ";", "int", "ret", "=", "VM_FAULT_NOPAGE", ";", "loff_t", "size", ";", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "size", "=", "(", "i_size_read", "(", "inode", ")", "+", "PAGE_SIZE", "-", "1", ")", ">", ">", "PAGE_SHIFT", ";", "if", "(", "vmf", "-", ">", "pgoff", ">", "=", "size", ")", "ret", "=", "VM_FAULT_SIGBUS", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "return", "ret", ";", "}", "static", "const", "struct", "vm_operations_struct", "ext4_dax_vm_ops", "=", "{", ".", "fault", "=", "ext4_dax_fault", ",", ".", "pmd_fault", "=", "ext4_dax_pmd_fault", ",", ".", "page_mkwrite", "=", "ext4_dax_mkwrite", ",", ".", "pfn_mkwrite", "=", "dax_pfn_mkwrite", ",", ".", "pfn_mkwrite", "=", "ext4_dax_pfn_mkwrite", ",", "}", ";", "#", "else", "#", "define", "ext4_dax_vm_ops", "ext4_file_vm_ops", "#", "endif", "static", "const", "struct", "vm_operations_struct", "ext4_file_vm_ops", "=", "{", ".", "fault", "=", "filemap_fault", ",", ".", "fault", "=", "ext4_filemap_fault", ",", ".", "map_pages", "=", "filemap_map_pages", ",", ".", "page_mkwrite", "=", "ext4_page_mkwrite", ",", "}", ";", "@", "@", "-", "3623", ",", "6", "+", "3623", ",", "15", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "}", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "first_block_offset", "=", "round_up", "(", "offset", ",", "sb", "-", ">", "s_blocksize", ")", ";", "last_block_offset", "=", "round_down", "(", "(", "offset", "+", "length", ")", ",", "sb", "-", ">", "s_blocksize", ")", "-", "1", ";", "@", "@", "-", "3631", ",", "10", "+", "3640", ",", "6", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "truncate_pagecache_range", "(", "inode", ",", "first_block_offset", ",", "last_block_offset", ")", ";", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "if", "(", "ext4_test_inode_flag", "(", "inode", ",", "EXT4_INODE_EXTENTS", ")", ")", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "else", "@", "@", "-", "3680", ",", "16", "+", "3685", ",", "12", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "if", "(", "IS_SYNC", "(", "inode", ")", ")", "ext4_handle_sync", "(", "handle", ")", ";", "/", "*", "Now", "release", "the", "pages", "again", "to", "reduce", "race", "window", "*", "/", "if", "(", "last_block_offset", ">", "first_block_offset", ")", "truncate_pagecache_range", "(", "inode", ",", "first_block_offset", ",", "last_block_offset", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "ext4_mark_inode_dirty", "(", "handle", ",", "inode", ")", ";", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "4823", ",", "13", "+", "4824", ",", "15", "@", "@", "int", "ext4_setattr", "(", "struct", "dentry", "*", "dentry", ",", "struct", "iattr", "*", "attr", ")", "}", "else", "ext4_wait_for_tail_page_commit", "(", "inode", ")", ";", "}", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "*", "Truncate", "pagecache", "after", "we", "'", "ve", "waited", "for", "commit", "*", "in", "data", "=", "journal", "mode", "to", "make", "pages", "freeable", ".", "*", "/", "truncate_pagecache", "(", "inode", ",", "inode", "-", ">", "i_size", ")", ";", "if", "(", "shrink", ")", "ext4_truncate", "(", "inode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "}", "if", "(", "!", "rc", ")", "{", "@", "@", "-", "5278", ",", "6", "+", "5281", ",", "8", "@", "@", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "sb_start_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "Delalloc", "case", "is", "easy", ".", "..", "*", "/", "if", "(", "test_opt", "(", "inode", "-", ">", "i_sb", ",", "DELALLOC", ")", "&", "&", "!", "ext4_should_journal_data", "(", "inode", ")", "&", "&", "@", "@", "-", "5347", ",", "6", "+", "5352", ",", "19", "@", "@", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "out_ret", ":", "ret", "=", "block_page_mkwrite_return", "(", "ret", ")", ";", "out", ":", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "ret", ";", "}", "int", "ext4_filemap_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "int", "err", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "err", "=", "filemap_fault", "(", "vma", ",", "vmf", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "err", ";", "}", "@", "@", "-", "958", ",", "6", "+", "958", ",", "7", "@", "@", "static", "void", "init_once", "(", "void", "*", "foo", ")", "INIT_LIST_HEAD", "(", "&", "ei", "-", ">", "i_orphan", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "xattr_sem", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "i_data_sem", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "i_mmap_sem", ")", ";", "inode_init_once", "(", "&", "ei", "-", ">", "vfs_inode", ")", ";", "}", "@", "@", "-", "10", ",", "8", "+", "10", ",", "10", "@", "@", "*", "/", "static", "inline", "void", "ext4_truncate_failed_write", "(", "struct", "inode", "*", "inode", ")", "{", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_inode_pages", "(", "inode", "-", ">", "i_mapping", ",", "inode", "-", ">", "i_size", ")", ";", "ext4_truncate", "(", "inode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "}", "/", "*"], "docstring_tokens": ["by", "writing", "to", "a", "page", "that", "is", "associated", "with", "a", "different", "user's", "file", "after", "unsynchronized", "hole", "punching", "and", "page-fault", "handling", "."]}
{"contents": ["SOAPUIOS-374", "-", "SoapUI", "OS:", "Vulnerability", "on", "importing", "WSDL", "with", "encoded", "property", "expansion"], "code_tokens": ["@", "@", "-", "35", ",", "6", "+", "35", ",", "7", "@", "@", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "SoapUIException", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "javax", ".", "xml", ".", "namespace", ".", "QName", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "URI", ";", "@", "@", "-", "66", ",", "6", "+", "67", ",", "7", "@", "@", "public", "WsdlInterface", "createNew", "(", "WsdlProject", "project", ",", "String", "name", ")", "{", "return", "importWsdl", "(", "project", ",", "url", ",", "createRequests", ",", "null", ",", "wsdlLoader", ")", ";", "}", "@", "Nullable", "public", "static", "WsdlInterface", "[", "]", "importWsdl", "(", "WsdlProject", "project", ",", "String", "url", ",", "boolean", "createRequests", ",", "QName", "bindingName", ",", "WsdlLoader", "wsdlLoader", ")", "throws", "SoapUIException", "{", "WsdlInterface", "[", "]", "result", ";", "@", "@", "-", "81", ",", "6", "+", "81", ",", "11", "@", "@", "public", "void", "initFromWadl", "(", "String", "wadlUrl", ")", "{", "XmlObject", "xmlObject", "=", "XmlUtils", ".", "createXmlObject", "(", "new", "URL", "(", "wadlUrl", ")", ");", "String", "content", "=", "xmlObject", ".", "xmlText", "(", ");", "if", "(", "!", "UISupport", ".", "handleDefinitionPropertyExpansions", "(", "wadlUrl", ",", "content", ")", ")", "{", "return", ";", "}", "Element", "element", "=", "(", "(", "Document", ")", "xmlObject", ".", "getDomNode", "(", "))", ".", "getDocumentElement", "(", ");", "/", "/", "try", "to", "allow", "older", "namespaces", "@", "@", "-", "92", ",", "7", "+", "97", ",", "7", "@", "@", "public", "void", "initFromWadl", "(", "String", "wadlUrl", ")", "{", "|", "|", "!", "element", ".", "getNamespaceURI", "(", ").", "equals", "(", "Constants", ".", "WADL11_NS", ")", ")", "{", "throw", "new", "Exception", "(", "\"", "Document", "is", "not", "a", "WADL", "application", "with", "\"", "+", "Constants", ".", "WADL11_NS", "+", "\"", "namespace", "\"", ");", "}", "content", "=", "PropertyExpansionRemover", ".", "removeExpansions", "(", "content", ")", ";", "ApplicationDocument", "applicationDocument", "=", "ApplicationDocument", ".", "Factory", ".", "parse", "(", "content", ")", ";", "application", "=", "applicationDocument", ".", "getApplication", "(", ");", "@", "@", "-", "37", ",", "6", "+", "37", ",", "7", "@", "@", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "support", ".", "AField", ".", "AFieldType", ";", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "support", ".", "AForm", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "java", ".", "io", ".", "File", ";", "/", "**", "@", "@", "-", "87", ",", "13", "+", "88", ",", "14", "@", "@", "public", "void", "valueChanged", "(", "XFormField", "sourceField", ",", "String", "newValue", ",", "String", "oldValu", "WsdlInterface", "[", "]", "results", "=", "importWsdl", "(", "project", ",", "expUrl", ")", ";", "if", "(", "!", "url", ".", "equals", "(", "expUrl", ")", ")", "{", "for", "(", "WsdlInterface", "iface", ":", "results", ")", "{", "iface", ".", "setDefinition", "(", "url", ",", "false", ")", ";", "if", "(", "results", "!", "=", "null", ")", "{", "if", "(", "!", "url", ".", "equals", "(", "expUrl", ")", ")", "{", "for", "(", "WsdlInterface", "iface", ":", "results", ")", "{", "iface", ".", "setDefinition", "(", "url", ",", "false", ")", ";", "}", "}", "break", ";", "}", "break", ";", "}", "}", "catch", "(", "InvalidDefinitionException", "ex", ")", "{", "ex", ".", "show", "(", ");", "@", "@", "-", "103", ",", "20", "+", "105", ",", "24", "@", "@", "public", "void", "valueChanged", "(", "XFormField", "sourceField", ",", "String", "newValue", ",", "String", "oldValu", "}", "}", "@", "Nullable", "private", "WsdlInterface", "[", "]", "importWsdl", "(", "WsdlProject", "project", ",", "String", "url", ")", "throws", "SoapUIException", "{", "WsdlInterface", "[", "]", "results", "=", "WsdlInterfaceFactory", ".", "importWsdl", "(", "project", ",", "url", ",", "dialog", ".", "getValue", "(", "Form", ".", "CREATEREQUEST", ")", ".", "equals", "(", "\"", "true", "\"", "))", ";", "for", "(", "WsdlInterface", "iface", ":", "results", ")", "{", "UISupport", ".", "select", "(", "iface", ")", ";", "if", "(", "dialog", ".", "getValue", "(", "Form", ".", "GENERATETESTSUITE", ")", ".", "equals", "(", "\"", "true", "\"", "))", "{", "GenerateWsdlTestSuiteAction", "generateTestSuiteAction", "=", "new", "GenerateWsdlTestSuiteAction", "(", ");", "generateTestSuiteAction", ".", "generateTestSuite", "(", "iface", ",", "true", ")", ";", "}", "if", "(", "results", "!", "=", "null", ")", "{", "for", "(", "WsdlInterface", "iface", ":", "results", ")", "{", "UISupport", ".", "select", "(", "iface", ")", ";", "if", "(", "dialog", ".", "getValue", "(", "Form", ".", "GENERATEMOCKSERVICE", ")", ".", "equals", "(", "\"", "true", "\"", "))", "{", "GenerateMockServiceAction", "generateMockAction", "=", "new", "GenerateMockServiceAction", "(", ");", "generateMockAction", ".", "generateMockService", "(", "iface", ",", "false", ")", ";", "if", "(", "dialog", ".", "getValue", "(", "Form", ".", "GENERATETESTSUITE", ")", ".", "equals", "(", "\"", "true", "\"", "))", "{", "GenerateWsdlTestSuiteAction", "generateTestSuiteAction", "=", "new", "GenerateWsdlTestSuiteAction", "(", ");", "generateTestSuiteAction", ".", "generateTestSuite", "(", "iface", ",", "true", ")", ";", "}", "if", "(", "dialog", ".", "getValue", "(", "Form", ".", "GENERATEMOCKSERVICE", ")", ".", "equals", "(", "\"", "true", "\"", "))", "{", "GenerateMockServiceAction", "generateMockAction", "=", "new", "GenerateMockServiceAction", "(", ");", "generateMockAction", ".", "generateMockService", "(", "iface", ",", "false", ")", ";", "}", "}", "}", "@", "@", "-", "31", ",", "6", "+", "31", ",", "7", "@", "@", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "UISupport", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "javax", ".", "wsdl", ".", "Binding", ";", "import", "javax", ".", "wsdl", ".", "Definition", ";", "import", "javax", ".", "wsdl", ".", "Port", ";", "@", "@", "-", "75", ",", "6", "+", "76", ",", "7", "@", "@", "return", "importWsdl", "(", "project", ",", "wsdlUrl", ",", "bindingName", ",", "null", ")", ";", "}", "@", "Nullable", "public", "static", "WsdlInterface", "[", "]", "importWsdl", "(", "WsdlProject", "project", ",", "String", "wsdlUrl", ",", "QName", "bindingName", ",", "WsdlLoader", "wsdlLoader", ")", "throws", "Exception", "{", "wsdlUrl", "=", "Tools", ".", "normalizeFileSeparators", "(", "wsdlUrl", ")", ";", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "com", ".", "eviware", ".", "soapui", ".", "settings", ".", "WsdlSettings", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "StringUtils", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "Tools", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "UISupport", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "xml", ".", "XmlUtils", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "tools", ".", "PropertyExpansionRemover", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "@", "@", "-", "42", ",", "12", "+", "43", ",", "13", "@", "@", "*", "/", "public", "abstract", "class", "WsdlLoader", "extends", "AbstractDefinitionLoader", "implements", "WsdlDefinitionLoader", "{", "protected", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "WsdlLoader", ".", "class", ")", ";", "private", "String", "url", ";", "private", "String", "firstNewURI", ";", "private", "String", "last", ";", "private", "String", "username", ";", "private", "String", "password", ";", "protected", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "WsdlLoader", ".", "class", ")", ";", "public", "WsdlLoader", "(", "String", "url", ")", "{", "this", ".", "url", "=", "url", ";", "@", "@", "-", "129", ",", "11", "+", "131", ",", "13", "@", "@", "private", "InvalidDefinitionException", "makeInvalidDefinitionException", "(", "String", "url", ",", "Ex", "private", "String", "readCleanWsdlFrom", "(", "String", "url", ")", "throws", "Exception", "{", "String", "content", "=", "XmlUtils", ".", "createXmlObject", "(", "load", "(", "url", ")", ").", "xmlText", "(", ");", "if", "(", "SoapUI", ".", "getSettings", "(", ").", "getBoolean", "(", "WsdlSettings", ".", "TRIM_WSDL", ")", ")", "{", "content", "=", "content", ".", "trim", "(", ");", "}", "return", "PropertyExpansionRemover", ".", "removeExpansions", "(", "content", ")", ";", "if", "(", "!", "UISupport", ".", "handleDefinitionPropertyExpansions", "(", "url", ",", "content", ")", ")", "{", "throw", "new", "Exception", "(", "\"", "The", "action", "has", "been", "cancelled", ".", "\")", ";", "}", "return", "content", ";", "}", "public", "String", "getBaseURI", "(", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "93", "@", "@", "package", "com", ".", "eviware", ".", "soapui", ".", "support", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "action", ".", "swing", ".", "ActionList", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "action", ".", "swing", ".", "DefaultActionList", ";", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "XForm", ";", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "XFormDialog", ";", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "XFormDialogBuilder", ";", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "XFormFactory", ";", "import", "com", ".", "eviware", ".", "x", ".", "form", ".", "XFormTextField", ";", "import", "com", ".", "eviware", ".", "x", ".", "impl", ".", "swing", ".", "JTextAreaFormField", ";", "import", "javax", ".", "swing", ".", "AbstractAction", ";", "import", "java", ".", "awt", ".", "event", ".", "ActionEvent", ";", "import", "java", ".", "util", ".", "List", ";", "public", "class", "DefinitionPropertyExpansionsDialog", "{", "public", "static", "final", "MessageSupport", "messages", "=", "MessageSupport", ".", "getMessages", "(", "DefinitionPropertyExpansionsDialog", ".", "class", ")", ";", "private", "XFormDialog", "dialog", "=", "null", ";", "private", "boolean", "importDefinition", ";", "public", "boolean", "isImportDefinition", "(", ")", "{", "return", "importDefinition", ";", "}", "private", "ActionList", "buildActions", "(", ")", "{", "ActionList", "actions", "=", "new", "DefaultActionList", "(", "\"", "Actions", "\"", ");", "actions", ".", "addAction", "(", "new", "ImportAction", "(", "))", ";", "actions", ".", "addAction", "(", "new", "CancelAction", "(", "))", ";", "return", "actions", ";", "}", "private", "XFormDialog", "buildDialog", "(", "List", "<", "String", ">", "propertyExpansions", ")", "{", "XFormDialogBuilder", "builder", "=", "XFormFactory", ".", "createDialogBuilder", "(", "messages", ".", "get", "(", "\"", "DefinitionPropertyExpansionsDialog", ".", "Title", "\"", "))", ";", "XForm", "form", "=", "builder", ".", "createForm", "(", "\"", "Basic", "\"", ");", "XFormTextField", "vulnerabilitiesTextField", "=", "form", ".", "addTextField", "(", "messages", ".", "get", "(", "\"", "DefinitionPropertyExpansionsDialog", ".", "Field", ".", "Vulnerabilities", ".", "Name", "\"", "),", "messages", ".", "get", "(", "\"", "DefinitionPropertyExpansionsDialog", ".", "Field", ".", "Vulnerabilities", ".", "Description", "\"", "),", "XForm", ".", "FieldType", ".", "TEXTAREA", ")", ";", "StringBuilder", "propertyExpansionsBuilder", "=", "new", "StringBuilder", "(", ");", "for", "(", "String", "propertyExpansion", ":", "propertyExpansions", ")", "{", "propertyExpansionsBuilder", ".", "append", "(", "propertyExpansion", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "}", "if", "(", "propertyExpansionsBuilder", ".", "length", "(", ")", ">", "0", ")", "{", "propertyExpansionsBuilder", ".", "deleteCharAt", "(", "propertyExpansionsBuilder", ".", "length", "(", ")", "-", "1", ")", ";", "}", "vulnerabilitiesTextField", ".", "setValue", "(", "propertyExpansionsBuilder", ".", "toString", "(", "))", ";", "(", "(", "JTextAreaFormField", ")", "vulnerabilitiesTextField", ")", ".", "setEditable", "(", "false", ")", ";", "dialog", "=", "builder", ".", "buildDialog", "(", "buildActions", "(", "),", "messages", ".", "get", "(", "\"", "DefinitionPropertyExpansionsDialog", ".", "Description", "\"", "),", "UISupport", ".", "createImageIcon", "(", "\"/", "warning_32x32", ".", "png", "\"", "))", ";", "return", "dialog", ";", "}", "public", "void", "showDialog", "(", "List", "<", "String", ">", "propertyExpansions", ")", "{", "if", "(", "dialog", "=", "=", "null", ")", "{", "dialog", "=", "buildDialog", "(", "propertyExpansions", ")", ";", "}", "dialog", ".", "show", "(", ");", "}", "private", "void", "closeDialog", "(", ")", "{", "dialog", ".", "setVisible", "(", "false", ")", ";", "dialog", "=", "null", ";", "}", "private", "class", "ImportAction", "extends", "AbstractAction", "{", "public", "ImportAction", "(", ")", "{", "super", "(", "messages", ".", "get", "(", "\"", "DefinitionPropertyExpansionsDialog", ".", "Action", ".", "Import", ".", "Name", "\"", "))", ";", "}", "@", "Override", "public", "void", "actionPerformed", "(", "ActionEvent", "e", ")", "{", "importDefinition", "=", "true", ";", "closeDialog", "(", ");", "}", "}", "private", "class", "CancelAction", "extends", "AbstractAction", "{", "public", "CancelAction", "(", ")", "{", "super", "(", "messages", ".", "get", "(", "\"", "DefinitionPropertyExpansionsDialog", ".", "Action", ".", "Cancel", ".", "Name", "\"", "))", ";", "}", "@", "Override", "public", "void", "actionPerformed", "(", "ActionEvent", "e", ")", "{", "importDefinition", "=", "false", ";", "closeDialog", "(", ");", "}", "}", "}", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "java", ".", "awt", ".", "event", ".", "ActionEvent", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "@", "@", "-", "44", ",", "13", "+", "45", ",", "17", "@", "@", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "public", "class", "Tools", "{", "public", "static", "final", "int", "COPY_BUFFER_SIZE", "=", "1000", ";", "private", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "Tools", ".", "class", ")", ";", "private", "static", "final", "Pattern", "PROPERTY_EXPANSION_EQUALS_PATTERN", "=", "Pattern", ".", "compile", "(", "\"^", "\\\\", "$\\", "\\{", "(.", "*)", "\\\\", "}$", "\")", ";", "private", "static", "final", "Pattern", "PROPERTY_EXPANSION_CONTAINS_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "\\\\", "$\\", "\\{", "(.", "*)", "\\\\", "})", "|(", "%", "24", "%", "7B", ".", "*%", "7D", ")", "|(", "%", "2524", "%", "257B", ".", "*%", "257D", ")", "|(", "%", "252524", "%", "25257B", ".", "*%", "25257D", ")", "\")", ";", "private", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "Tools", ".", "class", ")", ";", "public", "static", "String", "[", "]", "tokenizeArgs", "(", "String", "args", ")", "{", "if", "(", "args", "=", "=", "null", "|", "|", "args", ".", "trim", "(", ").", "length", "(", ")", "=", "=", "0", ")", "{", "@", "@", "-", "641", ",", "4", "+", "646", ",", "17", "@", "@", "public", "void", "run", "(", ")", "{", "}", "}", "))", ";", "}", "public", "static", "boolean", "isPropertyExpansion", "(", "@", "Nullable", "String", "value", ")", "{", "return", "value", "!", "=", "null", "&", "&", "PROPERTY_EXPANSION_EQUALS_PATTERN", ".", "matcher", "(", "value", ")", ".", "matches", "(", ");", "}", "public", "static", "List", "<", "String", ">", "getPropertyExpansions", "(", "String", "value", ")", "{", "List", "<", "String", ">", "properyExpansions", "=", "new", "ArrayList", "<", ">(", ");", "Matcher", "matcher", "=", "PROPERTY_EXPANSION_CONTAINS_PATTERN", ".", "matcher", "(", "value", ")", ";", "while", "(", "matcher", ".", "find", "(", "))", "{", "properyExpansions", ".", "add", "(", "matcher", ".", "group", "(", "))", ";", "}", "return", "properyExpansions", ";", "}", "}", "@", "@", "-", "1012", ",", "4", "+", "1012", ",", "18", "@", "@", "private", "static", "GraphicsConfiguration", "getGraphicsConfigurationForPosition", "(", "Point", "p", "}", "return", "null", ";", "}", "public", "static", "boolean", "handleDefinitionPropertyExpansions", "(", "String", "url", ",", "String", "definition", ")", "{", "List", "<", "String", ">", "propertyExpansions", "=", "Tools", ".", "getPropertyExpansions", "(", "definition", ")", ";", "if", "(", "propertyExpansions", ".", "size", "(", ")", ">", "0", ")", "{", "if", "(", "UISupport", ".", "isHeadless", "(", "))", "{", "SoapUI", ".", "getErrorLog", "(", ").", "error", "(", "\"", "The", "definition", "[", "\"", "+", "url", "+", "\"", "]", "contains", "potential", "security", "vulnerabilities", ".", "\")", ";", "return", "false", ";", "}", "DefinitionPropertyExpansionsDialog", "dialog", "=", "new", "DefinitionPropertyExpansionsDialog", "(", ");", "dialog", ".", "showDialog", "(", "propertyExpansions", ")", ";", "return", "dialog", ".", "isImportDefinition", "(", ");", "}", "return", "true", ";", "}", "}", "@", "@", "-", "38", ",", "6", "+", "38", ",", "7", "@", "@", "import", "com", ".", "eviware", ".", "soapui", ".", "security", ".", "SecurityTest", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "JsonUtil", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "StringUtils", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "Tools", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "UISupport", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "components", ".", "GroovyEditorComponent", ";", "import", "com", ".", "eviware", ".", "soapui", ".", "support", ".", "components", ".", "ShowPopupAction", ";", "@", "@", "-", "62", ",", "8", "+", "63", ",", "6", "@", "@", "import", "java", ".", "awt", ".", "dnd", ".", "DnDConstants", ";", "import", "java", ".", "awt", ".", "dnd", ".", "DropTarget", ";", "import", "java", ".", "awt", ".", "event", ".", "ActionEvent", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "public", "class", "PropertyExpansionPopupListener", "implements", "PopupMenuListener", "{", "private", "final", "Container", "targetMenu", ";", "@", "@", "-", "272", ",", "7", "+", "271", ",", "7", "@", "@", "public", "void", "actionPerformed", "(", "ActionEvent", "arg0", ")", "{", "if", "(", "!", "StringUtils", ".", "hasContent", "(", "sourceXPath", ")", "&", "&", "StringUtils", ".", "hasContent", "(", "userSelectedValue", ")", "&", "&", "!", "property", ".", "isReadOnly", "(", "))", "{", "if", "(", "!", "userInputIsPropertyExpansion", "(", "userSelectedValue", ")", ")", "{", "if", "(", "!", "Tools", ".", "isPropertyExpansion", "(", "userSelectedValue", ")", ")", "{", "userSelectedValue", "=", "UISupport", ".", "prompt", "(", "\"", "Do", "you", "want", "to", "update", "the", "value", "of", "the", "property", "?", "(", "\"", "+", "val", "+", "\"", ")\"", ",", "\"", "Get", "Data", "\"", ",", "userSelectedValue", ")", ";", "if", "(", "userSelectedValue", "!", "=", "null", ")", "{", "@", "@", "-", "283", ",", "16", "+", "282", ",", "6", "@", "@", "public", "void", "actionPerformed", "(", "ActionEvent", "arg0", ")", "{", "}", "}", "private", "static", "final", "Pattern", "pattern", "=", "Pattern", ".", "compile", "(", "\"^", "\\\\", "$\\", "\\{", "(.", "*)", "\\\\", "}$", "\")", ";", "private", "static", "boolean", "userInputIsPropertyExpansion", "(", "String", "userSelectedValue", ")", "{", "if", "(", "userSelectedValue", "=", "=", "null", ")", "{", "return", "false", ";", "}", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "userSelectedValue", ")", ";", "return", "matcher", ".", "matches", "(", ");", "}", "public", "static", "void", "addMenu", "(", "JPopupMenu", "popup", ",", "String", "menuName", ",", "ModelItem", "item", ",", "PropertyExpansionTarget", "component", ")", "{", "ScrollableMenu", "menu", "=", "new", "ScrollableMenu", "(", "menuName", ")", ";", "menu", ".", "setName", "(", "menuName", ")", ";", "@", "@", "-", "68", ",", "6", "+", "68", ",", "10", "@", "@", "public", "void", "setWidth", "(", "int", "columns", ")", "{", "getTextArea", "(", ").", "setColumns", "(", "columns", ")", ";", "}", "public", "void", "setEditable", "(", "boolean", "value", ")", "{", "getTextArea", "(", ").", "setEditable", "(", "value", ")", ";", "}", "@", "Override", "public", "boolean", "isMultiRow", "(", ")", "{", "return", "true", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "8", "@", "@", "DefinitionPropertyExpansionsDialog", ".", "Title", "=", "Potential", "Security", "Vulnerabilities", "Found", "DefinitionPropertyExpansionsDialog", ".", "Description", "=", "The", "definition", "contains", "SoapUI", "property", "expansions", ".", "\\", "It", "is", "a", "potential", "security", "vulnerability", "DefinitionPropertyExpansionsDialog", ".", "Field", ".", "Vulnerabilities", ".", "Name", "=", "Property", "expansions", ":", "DefinitionPropertyExpansionsDialog", ".", "Field", ".", "Vulnerabilities", ".", "Description", "=", "The", "list", "of", "SoapUI", "\\", "property", "expansions", "found", "in", "the", "definition", ".", "DefinitionPropertyExpansionsDialog", ".", "Action", ".", "Import", ".", "Name", "=", "Import", "Anyway", "DefinitionPropertyExpansionsDialog", ".", "Action", ".", "Cancel", ".", "Name", "=", "Cancel", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Merge", "pull", "request", "#510", "from", "wsargent/fix-197", "Fix", "for", "#197", "--", "use", "a", "hostname", "verifier", "that", "does", "hostname", "verification"], "code_tokens": ["@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "import", "org", ".", "asynchttpclient", ".", "filter", ".", "IOExceptionFilter", ";", "import", "org", ".", "asynchttpclient", ".", "filter", ".", "RequestFilter", ";", "import", "org", ".", "asynchttpclient", ".", "filter", ".", "ResponseFilter", ";", "import", "org", ".", "asynchttpclient", ".", "util", ".", "AllowAllHostnameVerifier", ";", "import", "org", ".", "asynchttpclient", ".", "util", ".", "DefaultHostnameVerifier", ";", "import", "org", ".", "asynchttpclient", ".", "util", ".", "ProxyUtils", ";", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "@", "@", "-", "596", ",", "7", "+", "596", ",", "7", "@", "@", "public", "TimeConverter", "getTimeConverter", "(", ")", "{", "private", "boolean", "allowSslConnectionPool", "=", "true", ";", "private", "boolean", "useRawUrl", "=", "false", ";", "private", "boolean", "removeQueryParamOnRedirect", "=", "true", ";", "private", "HostnameVerifier", "hostnameVerifier", "=", "new", "AllowAllHostnameVerifier", "(", ");", "private", "HostnameVerifier", "hostnameVerifier", "=", "new", "DefaultHostnameVerifier", "(", ");", "private", "int", "ioThreadMultiplier", "=", "2", ";", "private", "boolean", "strict302Handling", ";", "private", "boolean", "spdyEnabled", ";", "@", "@", "-", "15", ",", "6", "+", "15", ",", "7", "@", "@", "import", "org", ".", "asynchttpclient", ".", "filter", ".", "IOExceptionFilter", ";", "import", "org", ".", "asynchttpclient", ".", "filter", ".", "RequestFilter", ";", "import", "org", ".", "asynchttpclient", ".", "filter", ".", "ResponseFilter", ";", "import", "org", ".", "asynchttpclient", ".", "util", ".", "DefaultHostnameVerifier", ";", "import", "org", ".", "asynchttpclient", ".", "util", ".", "ProxyUtils", ";", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "@", "@", "-", "70", ",", "12", "+", "71", ",", "7", "@", "@", "void", "configureDefaults", "(", ")", "{", "allowSslConnectionPool", "=", "true", ";", "useRawUrl", "=", "false", ";", "removeQueryParamOnRedirect", "=", "true", ";", "hostnameVerifier", "=", "new", "HostnameVerifier", "(", ")", "{", "public", "boolean", "verify", "(", "String", "s", ",", "SSLSession", "sslSession", ")", "{", "return", "true", ";", "}", "}", ";", "hostnameVerifier", "=", "new", "DefaultHostnameVerifier", "(", ");", "}", "void", "configureExecutors", "(", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "142", "@", "@", "/", "*", "*", "To", "the", "extent", "possible", "under", "law", ",", "Kevin", "Locke", "has", "waived", "all", "copyright", "and", "*", "related", "or", "neighboring", "rights", "to", "this", "work", ".", "*", "<", "p", "/", ">", "*", "A", "legal", "description", "of", "this", "waiver", "is", "available", "in", "<", "a", "href", "=", "\"", "https", ":", "//", "gist", ".", "github", ".", "com", "/", "kevinoid", "/", "3829665", "\"", ">", "LICENSE", ".", "txt", "<", "/", "a", ">", "*", "/", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLPeerUnverifiedException", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLSession", ";", "import", "javax", ".", "security", ".", "auth", ".", "kerberos", ".", "KerberosPrincipal", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "Certificate", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "/", "**", "*", "Uses", "the", "internal", "HostnameChecker", "to", "verify", "the", "server", "'", "s", "hostname", "matches", "with", "the", "*", "certificate", ".", "This", "is", "a", "requirement", "for", "HTTPS", ",", "but", "the", "raw", "SSLEngine", "does", "not", "have", "*", "this", "functionality", ".", "As", "such", ",", "it", "has", "to", "be", "added", "in", "manually", ".", "For", "a", "more", "complete", "*", "description", "of", "hostname", "verification", "and", "why", "it", "'", "s", "important", ",", "*", "please", "read", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "tersesystems", ".", "com", "/", "2014", "/", "03", "/", "23", "/", "fixing", "-", "hostname", "-", "verification", "/", "\">", "Fixing", "*", "Hostname", "Verification", "<", "/", "a", ">", ".", "*", "<", "p", "/", ">", "*", "This", "code", "is", "based", "on", "Kevin", "Locke", "'", "s", "<", "a", "href", "=", "\"", "http", ":", "//", "kevinlocke", ".", "name", "/", "bits", "/", "2012", "/", "10", "/", "03", "/", "ssl", "-", "certificate", "-", "verification", "-", "in", "-", "dispatch", "-", "and", "-", "asynchttpclient", "/", "\">", "guide", "<", "/", "a", ">", ".", "*", "<", "p", "/", ">", "*", "/", "public", "class", "DefaultHostnameVerifier", "implements", "HostnameVerifier", "{", "private", "HostnameChecker", "checker", ";", "private", "HostnameVerifier", "extraHostnameVerifier", ";", "/", "/", "Logger", "to", "log", "exceptions", ".", "private", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "DefaultHostnameVerifier", ".", "class", ".", "getName", "(", "))", ";", "/", "**", "*", "A", "hostname", "verifier", "that", "uses", "the", "{", "{", "sun", ".", "security", ".", "util", ".", "HostnameChecker", "}", "}", "under", "the", "hood", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", ")", "{", "this", ".", "checker", "=", "new", "ProxyHostnameChecker", "(", ");", "}", "/", "**", "*", "A", "hostname", "verifier", "that", "takes", "an", "external", "hostname", "checker", ".", "Useful", "for", "testing", ".", "*", "*", "@", "param", "checker", "a", "hostnamechecker", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameChecker", "checker", ")", "{", "this", ".", "checker", "=", "checker", ";", "}", "/", "**", "*", "A", "hostname", "verifier", "that", "falls", "back", "to", "another", "hostname", "verifier", "if", "not", "found", ".", "*", "*", "@", "param", "extraHostnameVerifier", "another", "hostname", "verifier", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameVerifier", "extraHostnameVerifier", ")", "{", "this", ".", "checker", "=", "new", "ProxyHostnameChecker", "(", ");", "this", ".", "extraHostnameVerifier", "=", "extraHostnameVerifier", ";", "}", "/", "**", "*", "A", "hostname", "verifier", "with", "a", "hostname", "checker", ",", "that", "falls", "back", "to", "another", "hostname", "verifier", "if", "not", "found", ".", "*", "*", "@", "param", "checker", "a", "custom", "HostnameChecker", ".", "*", "@", "param", "extraHostnameVerifier", "another", "hostname", "verifier", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameChecker", "checker", ",", "HostnameVerifier", "extraHostnameVerifier", ")", "{", "this", ".", "checker", "=", "checker", ";", "this", ".", "extraHostnameVerifier", "=", "extraHostnameVerifier", ";", "}", "/", "**", "*", "Matches", "the", "hostname", "against", "the", "peer", "certificate", "in", "the", "session", ".", "*", "*", "@", "param", "hostname", "the", "IP", "address", "or", "hostname", "of", "the", "expected", "server", ".", "*", "@", "param", "session", "the", "SSL", "session", "containing", "the", "certificates", "with", "the", "ACTUAL", "hostname", "/", "ipaddress", ".", "*", "@", "return", "true", "if", "the", "hostname", "matches", ",", "false", "otherwise", ".", "*", "/", "private", "boolean", "hostnameMatches", "(", "String", "hostname", ",", "SSLSession", "session", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "hostname", "=", "{", "0", "}", ",", "session", "=", "{", "1", "}", "\",", "new", "Object", "[", "]", "{", "hostname", ",", "Base64", ".", "encode", "(", "session", ".", "getId", "(", "))", "}", ");", "try", "{", "final", "Certificate", "[", "]", "peerCertificates", "=", "session", ".", "getPeerCertificates", "(", ");", "if", "(", "peerCertificates", ".", "length", "=", "=", "0", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "No", "peer", "certificates", "\"", ");", "return", "false", ";", "}", "if", "(", "peerCertificates", "[", "0", "]", "instanceof", "X509Certificate", ")", "{", "X509Certificate", "peerCertificate", "=", "(", "X509Certificate", ")", "peerCertificates", "[", "0", "]", ";", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "peerCertificate", "=", "{", "0", "}", "\",", "peerCertificate", ")", ";", "try", "{", "checker", ".", "match", "(", "hostname", ",", "peerCertificate", ")", ";", "/", "/", "Certificate", "matches", "hostname", "if", "no", "exception", "is", "thrown", ".", "return", "true", ";", "}", "catch", "(", "CertificateException", "ex", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Certificate", "does", "not", "match", "hostname", "\"", ",", "ex", ")", ";", "}", "}", "else", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Peer", "does", "not", "have", "any", "certificates", "or", "they", "aren", "'", "t", "X", ".", "509", "\"", ");", "}", "return", "false", ";", "}", "catch", "(", "SSLPeerUnverifiedException", "ex", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Not", "using", "certificates", "for", "peers", ",", "try", "verifying", "the", "principal", "\"", ");", "try", "{", "Principal", "peerPrincipal", "=", "session", ".", "getPeerPrincipal", "(", ");", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "peerPrincipal", "=", "{", "0", "}", "\",", "peerPrincipal", ")", ";", "if", "(", "peerPrincipal", "instanceof", "KerberosPrincipal", ")", "{", "return", "checker", ".", "match", "(", "hostname", ",", "(", "KerberosPrincipal", ")", "peerPrincipal", ")", ";", "}", "else", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Can", "'", "t", "verify", "principal", ",", "not", "Kerberos", "\"", ");", "}", "}", "catch", "(", "SSLPeerUnverifiedException", "ex2", ")", "{", "/", "/", "Can", "'", "t", "verify", "principal", ",", "no", "principal", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Can", "'", "t", "verify", "principal", ",", "no", "principal", "\"", ",", "ex2", ")", ";", "}", "return", "false", ";", "}", "}", "/", "**", "*", "Verifies", "the", "hostname", "against", "the", "peer", "certificates", "in", "a", "session", ".", "Falls", "back", "to", "extraHostnameVerifier", "if", "*", "there", "is", "no", "match", ".", "*", "*", "@", "param", "hostname", "the", "IP", "address", "or", "hostname", "of", "the", "expected", "server", ".", "*", "@", "param", "session", "the", "SSL", "session", "containing", "the", "certificates", "with", "the", "ACTUAL", "hostname", "/", "ipaddress", ".", "*", "@", "return", "true", "if", "the", "hostname", "matches", ",", "false", "otherwise", ".", "*", "/", "public", "boolean", "verify", "(", "String", "hostname", ",", "SSLSession", "session", ")", "{", "if", "(", "hostnameMatches", "(", "hostname", ",", "session", ")", ")", "{", "return", "true", ";", "}", "else", "{", "return", "extraHostnameVerifier", "!", "=", "null", "&", "&", "extraHostnameVerifier", ".", "verify", "(", "hostname", ",", "session", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "Will", "Sargent", ".", "All", "rights", "reserved", ".", "*", "*", "This", "program", "is", "licensed", "to", "you", "under", "the", "Apache", "License", "Version", "2", ".", "0", ",", "*", "and", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "Apache", "License", "Version", "2", ".", "0", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "Apache", "License", "Version", "2", ".", "0", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ".", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "Apache", "License", "Version", "2", ".", "0", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "Apache", "License", "Version", "2", ".", "0", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "there", "under", ".", "*", "/", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "/", "**", "*", "Hostname", "checker", "interface", ".", "*", "/", "public", "interface", "HostnameChecker", "{", "public", "void", "match", "(", "String", "hostname", ",", "X509Certificate", "peerCertificate", ")", "throws", "CertificateException", ";", "public", "boolean", "match", "(", "String", "hostname", ",", "Principal", "principal", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "Will", "Sargent", ".", "All", "rights", "reserved", ".", "*", "*", "This", "program", "is", "licensed", "to", "you", "under", "the", "Apache", "License", "Version", "2", ".", "0", ",", "*", "and", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "Apache", "License", "Version", "2", ".", "0", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "Apache", "License", "Version", "2", ".", "0", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ".", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "Apache", "License", "Version", "2", ".", "0", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "Apache", "License", "Version", "2", ".", "0", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "there", "under", ".", "*", "/", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "/", "**", "*", "A", "HostnameChecker", "proxy", ".", "*", "/", "public", "class", "ProxyHostnameChecker", "implements", "HostnameChecker", "{", "public", "final", "static", "byte", "TYPE_TLS", "=", "1", ";", "private", "final", "Object", "checker", "=", "getHostnameChecker", "(", ");", "public", "ProxyHostnameChecker", "(", ")", "{", "}", "private", "Object", "getHostnameChecker", "(", ")", "{", "final", "ClassLoader", "classLoader", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "final", "Class", "<", "Object", ">", "hostnameCheckerClass", "=", "(", "Class", "<", "Object", ">", ")", "classLoader", ".", "loadClass", "(", "\"", "sun", ".", "security", ".", "util", ".", "HostnameChecker", "\"", ");", "final", "Method", "instanceMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "getInstance", "\"", ",", "Byte", ".", "TYPE", ")", ";", "return", "instanceMethod", ".", "invoke", "(", "null", ",", "TYPE_TLS", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "public", "void", "match", "(", "String", "hostname", ",", "X509Certificate", "peerCertificate", ")", "throws", "CertificateException", "{", "try", "{", "final", "Class", "<", "?>", "hostnameCheckerClass", "=", "checker", ".", "getClass", "(", ");", "final", "Method", "checkMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "match", "\"", ",", "String", ".", "class", ",", "X509Certificate", ".", "class", ")", ";", "checkMethod", ".", "invoke", "(", "checker", ",", "hostname", ",", "peerCertificate", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "Throwable", "t", "=", "e", ".", "getCause", "(", ");", "if", "(", "t", "instanceof", "CertificateException", ")", "{", "throw", "(", "CertificateException", ")", "t", ";", "}", "else", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "public", "boolean", "match", "(", "String", "hostname", ",", "Principal", "principal", ")", "{", "try", "{", "final", "Class", "<", "?>", "hostnameCheckerClass", "=", "checker", ".", "getClass", "(", ");", "final", "Method", "checkMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "match", "\"", ",", "String", ".", "class", ",", "Principal", ".", "class", ")", ";", "return", "(", "Boolean", ")", "checkMethod", ".", "invoke", "(", "null", ",", "hostname", ",", "principal", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "}"], "docstring_tokens": ["via", "an", "arbitrary", "valid", "certificate", "."]}
{"contents": ["inotify:", "Fix", "fsnotify_mark", "refcount", "leak", "in", "inotify_update_existing_watch()", "Commit", "4d97f7d53da7dc83", "(\"inotify:", "Add", "flag", "IN_MASK_CREATE", "for", "inotify_add_watch()\")", "forgot", "to", "call", "fsnotify_put_mark()", "with", "IN_MASK_CREATE", "after", "fsnotify_find_mark()", "Fixes:", "4d97f7d53da7dc83", "(\"inotify:", "Add", "flag", "IN_MASK_CREATE", "for", "inotify_add_watch()\")", "Signed-off-by:", "ZhangXiaoxu", "<zhangxiaoxu5@huawei.com>", "Signed-off-by:", "Jan", "Kara", "<jack@suse.cz>"], "code_tokens": ["@", "@", "-", "519", ",", "8", "+", "519", ",", "10", "@", "@", "static", "int", "inotify_update_existing_watch", "(", "struct", "fsnotify_group", "*", "group", ",", "fsn_mark", "=", "fsnotify_find_mark", "(", "&", "inode", "-", ">", "i_fsnotify_marks", ",", "group", ")", ";", "if", "(", "!", "fsn_mark", ")", "return", "-", "ENOENT", ";", "else", "if", "(", "create", ")", "return", "-", "EEXIST", ";", "else", "if", "(", "create", ")", "{", "ret", "=", "-", "EEXIST", ";", "goto", "out", ";", "}", "i_mark", "=", "container_of", "(", "fsn_mark", ",", "struct", "inotify_inode_mark", ",", "fsn_mark", ")", ";", "@", "@", "-", "548", ",", "6", "+", "550", ",", "7", "@", "@", "static", "int", "inotify_update_existing_watch", "(", "struct", "fsnotify_group", "*", "group", ",", "/", "*", "return", "the", "wd", "*", "/", "ret", "=", "i_mark", "-", ">", "wd", ";", "out", ":", "/", "*", "match", "the", "get", "from", "fsnotify_find_mark", "(", ")", "*", "/", "fsnotify_put_mark", "(", "fsn_mark", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["sctp:", "fix", "potential", "panics", "in", "the", "SCTP-AUTH", "API.", "All", "of", "the", "SCTP-AUTH", "socket", "options", "could", "cause", "a", "panic", "if", "the", "extension", "is", "disabled", "and", "the", "API", "is", "envoked.", "Additionally,", "there", "were", "some", "additional", "assumptions", "that", "certain", "pointers", "would", "always", "be", "valid", "which", "may", "not", "always", "be", "the", "case.", "This", "patch", "hardens", "the", "API", "and", "address", "all", "of", "the", "crash", "scenarios.", "Signed-off-by:", "Vlad", "Yasevich", "<vladislav.yasevich@hp.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "103", ",", "15", "+", "103", ",", "15", "@", "@", "static", "struct", "sctp_endpoint", "*", "sctp_endpoint_init", "(", "struct", "sctp_endpoint", "*", "ep", ",", "/", "*", "Initialize", "the", "CHUNKS", "parameter", "*", "/", "auth_chunks", "-", ">", "param_hdr", ".", "type", "=", "SCTP_PARAM_CHUNKS", ";", "auth_chunks", "-", ">", "param_hdr", ".", "length", "=", "htons", "(", "sizeof", "(", "sctp_paramhdr_t", ")", ");", "/", "*", "If", "the", "Add", "-", "IP", "functionality", "is", "enabled", ",", "we", "must", "*", "authenticate", ",", "ASCONF", "and", "ASCONF", "-", "ACK", "chunks", "*", "/", "if", "(", "sctp_addip_enable", ")", "{", "auth_chunks", "-", ">", "chunks", "[", "0", "]", "=", "SCTP_CID_ASCONF", ";", "auth_chunks", "-", ">", "chunks", "[", "1", "]", "=", "SCTP_CID_ASCONF_ACK", ";", "auth_chunks", "-", ">", "param_hdr", ".", "length", "=", "htons", "(", "sizeof", "(", "sctp_paramhdr_t", ")", "+", "2", ")", ";", "auth_chunks", "-", ">", "param_hdr", ".", "length", "+", "=", "htons", "(", "2", ")", ";", "}", "}", "@", "@", "-", "3055", ",", "6", "+", "3055", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_auth_chunk", "(", "struct", "sock", "*", "sk", ",", "{", "struct", "sctp_authchunk", "val", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "!", "=", "sizeof", "(", "struct", "sctp_authchunk", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "optlen", ")", ")", "@", "@", "-", "3085", ",", "6", "+", "3088", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_hmac_ident", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_hmacalgo", "*", "hmacs", ";", "int", "err", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "<", "sizeof", "(", "struct", "sctp_hmacalgo", ")", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "3123", ",", "6", "+", "3129", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_auth_key", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_association", "*", "asoc", ";", "int", "ret", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "<", "=", "sizeof", "(", "struct", "sctp_authkey", ")", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "3160", ",", "6", "+", "3169", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_active_key", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_authkeyid", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "!", "=", "sizeof", "(", "struct", "sctp_authkeyid", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "optlen", ")", ")", "@", "@", "-", "3185", ",", "6", "+", "3197", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_del_key", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_authkeyid", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "!", "=", "sizeof", "(", "struct", "sctp_authkeyid", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "optlen", ")", ")", "@", "@", "-", "5197", ",", "19", "+", "5212", ",", "29", "@", "@", "static", "int", "sctp_getsockopt_maxburst", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "static", "int", "sctp_getsockopt_hmac_ident", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "char", "__user", "*", "optval", ",", "int", "__user", "*", "optlen", ")", "{", "struct", "sctp_hmacalgo", "__user", "*", "p", "=", "(", "void", "__user", "*", ")", "optval", ";", "struct", "sctp_hmac_algo_param", "*", "hmacs", ";", "__u16", "param_len", ";", "__u16", "data_len", "=", "0", ";", "u32", "num_idents", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "hmacs", "=", "sctp_sk", "(", "sk", ")", "->", "ep", "-", ">", "auth_hmacs_list", ";", "param_len", "=", "ntohs", "(", "hmacs", "-", ">", "param_hdr", ".", "length", ")", ";", "data_len", "=", "ntohs", "(", "hmacs", "-", ">", "param_hdr", ".", "length", ")", "-", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "if", "(", "len", "<", "param_len", ")", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_hmacalgo", ")", "+", "data_len", ")", "return", "-", "EINVAL", ";", "len", "=", "sizeof", "(", "struct", "sctp_hmacalgo", ")", "+", "data_len", ";", "num_idents", "=", "data_len", "/", "sizeof", "(", "u16", ")", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "optval", ",", "hmacs", "-", ">", "hmac_ids", ",", "len", ")", ")", "if", "(", "put_user", "(", "num_idents", ",", "&", "p", "-", ">", "shmac_num_idents", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "p", "-", ">", "shmac_idents", ",", "hmacs", "-", ">", "hmac_ids", ",", "data_len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "@", "@", "-", "5219", ",", "6", "+", "5244", ",", "9", "@", "@", "static", "int", "sctp_getsockopt_active_key", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "struct", "sctp_authkeyid", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authkeyid", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "sizeof", "(", "struct", "sctp_authkeyid", ")", "))", "@", "@", "-", "5233", ",", "6", "+", "5261", ",", "12", "@", "@", "static", "int", "sctp_getsockopt_active_key", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "else", "val", ".", "scact_keynumber", "=", "sctp_sk", "(", "sk", ")", "->", "ep", "-", ">", "active_key_id", ";", "len", "=", "sizeof", "(", "struct", "sctp_authkeyid", ")", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "optval", ",", "&", "val", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "@", "@", "-", "5243", ",", "13", "+", "5277", ",", "16", "@", "@", "static", "int", "sctp_getsockopt_peer_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "struct", "sctp_authchunks", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "struct", "sctp_chunks_param", "*", "ch", ";", "u32", "num_chunks", ";", "u32", "num_chunks", "=", "0", ";", "char", "__user", "*", "to", ";", "if", "(", "len", "<", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "p", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "return", "-", "EFAULT", ";", "to", "=", "p", "-", ">", "gauth_chunks", ";", "@", "@", "-", "5258", ",", "20", "+", "5295", ",", "21", "@", "@", "static", "int", "sctp_getsockopt_peer_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "return", "-", "EINVAL", ";", "ch", "=", "asoc", "-", ">", "peer", ".", "peer_chunks", ";", "if", "(", "!", "ch", ")", "goto", "num", ";", "/", "*", "See", "if", "the", "user", "provided", "enough", "room", "for", "all", "the", "data", "*", "/", "num_chunks", "=", "ntohs", "(", "ch", "-", ">", "param_hdr", ".", "length", ")", "-", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "if", "(", "len", "<", "num_chunks", ")", "return", "-", "EINVAL", ";", "len", "=", "num_chunks", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "num_chunks", ")", ")", "return", "-", "EFAULT", ";", "num", ":", "len", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", "+", "num_chunks", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "put_user", "(", "num_chunks", ",", "&", "p", "-", ">", "gauth_number_of_chunks", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "@", "@", "-", "5282", ",", "13", "+", "5320", ",", "16", "@", "@", "static", "int", "sctp_getsockopt_local_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "struct", "sctp_authchunks", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "struct", "sctp_chunks_param", "*", "ch", ";", "u32", "num_chunks", ";", "u32", "num_chunks", "=", "0", ";", "char", "__user", "*", "to", ";", "if", "(", "len", "<", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "p", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "return", "-", "EFAULT", ";", "to", "=", "p", "-", ">", "gauth_chunks", ";", "@", "@", "-", "5301", ",", "17", "+", "5342", ",", "21", "@", "@", "static", "int", "sctp_getsockopt_local_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "else", "ch", "=", "sctp_sk", "(", "sk", ")", "->", "ep", "-", ">", "auth_chunk_list", ";", "if", "(", "!", "ch", ")", "goto", "num", ";", "num_chunks", "=", "ntohs", "(", "ch", "-", ">", "param_hdr", ".", "length", ")", "-", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "if", "(", "len", "<", "num_chunks", ")", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authchunks", ")", "+", "num_chunks", ")", "return", "-", "EINVAL", ";", "len", "=", "num_chunks", ";", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "num_chunks", ")", ")", "return", "-", "EFAULT", ";", "num", ":", "len", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", "+", "num_chunks", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "put_user", "(", "num_chunks", ",", "&", "p", "-", ">", "gauth_number_of_chunks", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}"], "docstring_tokens": ["using", "vectors"]}
{"contents": ["floppy:", "Do", "not", "copy", "a", "kernel", "pointer", "to", "user", "memory", "in", "FDGETPRM", "ioctl", "The", "final", "field", "of", "a", "floppy_struct", "is", "the", "field", "\"name\",", "which", "is", "a", "pointer", "to", "a", "string", "in", "kernel", "memory.", "The", "kernel", "pointer", "should", "not", "be", "copied", "to", "user", "memory.", "The", "FDGETPRM", "ioctl", "copies", "a", "floppy_struct", "to", "user", "memory,", "including", "this", "\"name\"", "field.", "This", "pointer", "cannot", "be", "used", "by", "the", "user", "and", "it", "will", "leak", "a", "kernel", "address", "to", "user-space,", "which", "will", "reveal", "the", "location", "of", "kernel", "code", "and", "data", "and", "undermine", "KASLR", "protection.", "Model", "this", "code", "after", "the", "compat", "ioctl", "which", "copies", "the", "returned", "data", "to", "a", "previously", "cleared", "temporary", "structure", "on", "the", "stack", "(excluding", "the", "name", "pointer)", "and", "copy", "out", "to", "userspace", "from", "there.", "As", "we", "already", "have", "an", "inparam", "union", "with", "an", "appropriate", "member", "and", "that", "memory", "is", "already", "cleared", "even", "for", "read", "only", "calls", "make", "use", "of", "that", "as", "a", "temporary", "store.", "Based", "on", "an", "initial", "patch", "by", "Brian", "Belleville.", "Signed-off-by:", "Andy", "Whitcroft", "<apw@canonical.com>", "Broke", "up", "long", "line.", "Signed-off-by:", "Jens", "Axboe", "<axboe@kernel.dk>"], "code_tokens": ["@", "@", "-", "3467", ",", "6", "+", "3467", ",", "9", "@", "@", "static", "int", "fd_locked_ioctl", "(", "struct", "block_device", "*", "bdev", ",", "fmode_t", "mode", ",", "unsigned", "int", "(", "struct", "floppy_struct", "*", "*)", "&", "outparam", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "memcpy", "(", "&", "inparam", ".", "g", ",", "outparam", ",", "offsetof", "(", "struct", "floppy_struct", ",", "name", ")", ");", "outparam", "=", "&", "inparam", ".", "g", ";", "break", ";", "case", "FDMSGON", ":", "UDP", "-", ">", "flags", "|", "=", "FTD_MSG", ";"], "docstring_tokens": ["using", "the", "FDGETPRM", "ioctl", "and", "use", "the", "obtained", "kernel", "pointer", "to", "discover", "the", "location", "of", "kernel", "code", "and", "data"]}
{"contents": ["trivial", "improvements", "to", "RPW"], "code_tokens": ["@", "@", "-", "20", ",", "15", "+", "20", ",", "19", "@", "@", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "CorruptedFileException", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "FilenameUtils", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "TikaInputStream", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Property", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "TikaCoreProperties", ";", "import", "org", ".", "apache", ".", "tika", ".", "mime", ".", "MediaType", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "AbstractRecursiveParserWrapperHandler", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "ContentHandlerDecorator", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "ContentHandlerFactory", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "RecursiveParserWrapperHandler", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "SecureContentHandler", ";", "import", "org", ".", "apache", ".", "tika", ".", "utils", ".", "ExceptionUtils", ";", "import", "org", ".", "apache", ".", "tika", ".", "utils", ".", "ParserUtils", ";", "import", "org", ".", "xml", ".", "sax", ".", "Attributes", ";", "import", "org", ".", "xml", ".", "sax", ".", "ContentHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "@", "@", "-", "221", ",", "7", "+", "225", ",", "12", "@", "@", "public", "void", "parse", "(", "InputStream", "stream", ",", "ContentHandler", "recursiveParserWrapperHandl", "long", "started", "=", "System", ".", "currentTimeMillis", "(", ");", "parserState", ".", "recursiveParserWrapperHandler", ".", "startDocument", "(", ");", "try", "{", "getWrappedParser", "(", ").", "parse", "(", "stream", ",", "localHandler", ",", "metadata", ",", "context", ")", ";", "try", "(", "TikaInputStream", "tis", "=", "TikaInputStream", ".", "get", "(", "stream", ")", ")", "{", "RecursivelySecureContentHandler", "secureContentHandler", "=", "new", "RecursivelySecureContentHandler", "(", "localHandler", ",", "tis", ")", ";", "context", ".", "set", "(", "RecursivelySecureContentHandler", ".", "class", ",", "secureContentHandler", ")", ";", "getWrappedParser", "(", ").", "parse", "(", "tis", ",", "secureContentHandler", ",", "metadata", ",", "context", ")", ";", "}", "}", "catch", "(", "SAXException", "e", ")", "{", "boolean", "wlr", "=", "isWriteLimitReached", "(", "e", ")", ";", "if", "(", "wlr", "=", "=", "false", ")", "{", "@", "@", "-", "366", ",", "8", "+", "375", ",", "14", "@", "@", "public", "void", "parse", "(", "InputStream", "stream", ",", "ContentHandler", "ignore", ",", "Parser", "preContextParser", "=", "context", ".", "get", "(", "Parser", ".", "class", ")", ";", "context", ".", "set", "(", "Parser", ".", "class", ",", "new", "EmbeddedParserDecorator", "(", "getWrappedParser", "(", "),", "objectLocation", ",", "parserState", ")", ");", "long", "started", "=", "System", ".", "currentTimeMillis", "(", ");", "RecursivelySecureContentHandler", "secureContentHandler", "=", "context", ".", "get", "(", "RecursivelySecureContentHandler", ".", "class", ")", ";", "/", "/", "store", "the", "handler", "that", "was", "used", "before", "this", "parse", "/", "/", "so", "that", "you", "can", "return", "it", "back", "to", "its", "state", "at", "the", "end", "of", "this", "parse", "ContentHandler", "preContextHandler", "=", "secureContentHandler", ".", "handler", ";", "secureContentHandler", ".", "updateContentHandler", "(", "localHandler", ")", ";", "try", "{", "super", ".", "parse", "(", "stream", ",", "localHandler", ",", "metadata", ",", "context", ")", ";", "super", ".", "parse", "(", "stream", ",", "secureContentHandler", ",", "metadata", ",", "context", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "boolean", "wlr", "=", "isWriteLimitReached", "(", "e", ")", ";", "if", "(", "wlr", "=", "=", "true", ")", "{", "@", "@", "-", "389", ",", "6", "+", "404", ",", "7", "@", "@", "public", "void", "parse", "(", "InputStream", "stream", ",", "ContentHandler", "ignore", ",", "}", "}", "finally", "{", "context", ".", "set", "(", "Parser", ".", "class", ",", "preContextParser", ")", ";", "secureContentHandler", ".", "updateContentHandler", "(", "preContextHandler", ")", ";", "long", "elapsedMillis", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "started", ";", "metadata", ".", "set", "(", "RecursiveParserWrapperHandler", ".", "PARSE_TIME_MILLIS", ",", "Long", ".", "toString", "(", "elapsedMillis", ")", ");", "parserState", ".", "recursiveParserWrapperHandler", ".", "endEmbeddedDocument", "(", "localHandler", ",", "metadata", ")", ";", "@", "@", "-", "406", ",", "7", "+", "422", ",", "46", "@", "@", "public", "void", "parse", "(", "InputStream", "stream", ",", "ContentHandler", "ignore", ",", "private", "ParserState", "(", "AbstractRecursiveParserWrapperHandler", "handler", ")", "{", "this", ".", "recursiveParserWrapperHandler", "=", "handler", ";", "}", "}", "private", "class", "RecursivelySecureContentHandler", "extends", "SecureContentHandler", "{", "private", "ContentHandler", "handler", ";", "public", "RecursivelySecureContentHandler", "(", "ContentHandler", "handler", ",", "TikaInputStream", "stream", ")", "{", "super", "(", "handler", ",", "stream", ")", ";", "this", ".", "handler", "=", "handler", ";", "}", "public", "void", "updateContentHandler", "(", "ContentHandler", "handler", ")", "{", "setContentHandler", "(", "handler", ")", ";", "this", ".", "handler", "=", "handler", ";", "}", "/", "**", "*", "Bypass", "the", "SecureContentHandler", ".", "..", "*", "*", "This", "handler", "only", "looks", "at", "zip", "bomb", "via", "zip", "expansion", ".", "*", "Users", "should", "be", "protected", "within", "entries", "against", "nested", "*", "nested", "xml", "entities", ".", "We", "don", "'", "t", "want", "to", "carry", "*", "those", "stats", "_across_", "entries", ".", "*", "*", "@", "param", "uri", "*", "@", "param", "localName", "*", "@", "param", "name", "*", "@", "param", "atts", "*", "@", "throws", "SAXException", "*", "/", "@", "Override", "public", "void", "startElement", "(", "String", "uri", ",", "String", "localName", ",", "String", "name", ",", "Attributes", "atts", ")", "throws", "SAXException", "{", "this", ".", "handler", ".", "startElement", "(", "uri", ",", "localName", ",", "name", ",", "atts", ")", ";", "}", "@", "Override", "public", "void", "endElement", "(", "String", "uri", ",", "String", "localName", ",", "String", "name", ")", "throws", "SAXException", "{", "this", ".", "handler", ".", "endElement", "(", "uri", ",", "localName", ",", "name", ")", ";", "}", "}", "}"], "docstring_tokens": ["persuading", "a", "victim", "to", "unzip", "a", "specially-crafted", "file"]}
{"contents": ["Security", "fixes"], "code_tokens": ["@", "@", "-", "104", ",", "6", "+", "104", ",", "10", "@", "@", "}", "private", "static", "final", "String", "NON_EXISTING_URL", "=", "\"", "http", ":", "//", "xmlbeam", ".", "org", "/", "nonexisting_namespace", "\"", ";", "private", "static", "final", "String", "[", "]", "FEATURE_DEFAULTS", "=", "new", "String", "[", "]", "{", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "#", "true", "\"", ",", "/", "/", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "#", "false", "\"", ",", "/", "/", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "#", "false", "\"", ",", "/", "/", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "#", "false", "\"", "}", ";", "private", "final", "Map", "<", "String", ",", "String", ">", "USER_DEFINED_MAPPING", "=", "new", "TreeMap", "<", "String", ",", "String", ">", "()", ";", "@", "@", "-", "126", ",", "7", "+", "130", ",", "7", "@", "@", "public", "DocumentBuilder", "createDocumentBuilder", "(", ")", "{", "DocumentBuilder", "documentBuilder", "=", "createDocumentBuilderFactory", "(", ").", "newDocumentBuilder", "(", ");", "return", "documentBuilder", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "throw", "new", "XBException", "(", "\"", "Error", "on", "creating", "document", "builder", "\"", ",", "e", ")", ";", "}", "}", "@", "@", "-", "136", ",", "7", "+", "140", ",", "16", "@", "@", "public", "DocumentBuilder", "createDocumentBuilder", "(", ")", "{", "@", "Override", "public", "DocumentBuilderFactory", "createDocumentBuilderFactory", "(", ")", "{", "DocumentBuilderFactory", "instance", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "instance", ".", "setXIncludeAware", "(", "false", ")", ";", "instance", ".", "setExpandEntityReferences", "(", "false", ")", ";", "for", "(", "String", "featureDefault", ":", "FEATURE_DEFAULTS", ")", "{", "String", "[", "]", "featureValue", "=", "featureDefault", ".", "split", "(", "\"#", "\")", ";", "try", "{", "instance", ".", "setFeature", "(", "featureValue", "[", "0", "]", ",", "Boolean", ".", "valueOf", "(", "featureValue", "[", "1", "]", "))", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "/", "/", "No", "worries", "if", "one", "feature", "is", "not", "supported", ".", "}", "}", "if", "(", "!", "NamespacePhilosophy", ".", "AGNOSTIC", ".", "equals", "(", "namespacePhilosophy", ")", ")", "{", "instance", ".", "setNamespaceAware", "(", "NamespacePhilosophy", ".", "HEDONISTIC", ".", "equals", "(", "namespacePhilosophy", ")", ");", "}", "@", "@", "-", "161", ",", "7", "+", "174", ",", "7", "@", "@", "public", "Transformer", "createTransformer", "(", "final", "Document", ".", "..", "document", ")", "{", "}", "return", "transformer", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "throw", "new", "XBException", "(", "\"", "Error", "on", "creating", "transformer", "\"", ",", "e", ")", ";", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request", "parameter"]}
{"contents": ["brcmfmac:", "add", "subtype", "check", "for", "event", "handling", "in", "data", "path", "For", "USB", "there", "is", "no", "separate", "channel", "being", "used", "to", "pass", "events", "from", "firmware", "to", "the", "host", "driver", "and", "as", "such", "are", "passed", "over", "the", "data", "path.", "In", "order", "to", "detect", "mock", "event", "messages", "an", "additional", "check", "is", "needed", "on", "event", "subtype.", "This", "check", "is", "added", "conditionally", "using", "unlikely()", "keyword.", "Reviewed-by:", "Hante", "Meuleman", "<hante.meuleman@broadcom.com>", "Reviewed-by:", "Pieter-Paul", "Giesberts", "<pieter-paul.giesberts@broadcom.com>", "Reviewed-by:", "Franky", "Lin", "<franky.lin@broadcom.com>", "Signed-off-by:", "Arend", "van", "Spriel", "<arend.vanspriel@broadcom.com>", "Signed-off-by:", "Kalle", "Valo", "<kvalo@codeaurora.org>"], "code_tokens": ["@", "@", "-", "519", ",", "7", "+", "519", ",", "8", "@", "@", "void", "brcmf_rx_frame", "(", "struct", "device", "*", "dev", ",", "struct", "sk_buff", "*", "skb", ",", "bool", "handle_event", ")", "}", "else", "{", "/", "*", "Process", "special", "event", "packets", "*", "/", "if", "(", "handle_event", ")", "brcmf_fweh_process_skb", "(", "ifp", "-", ">", "drvr", ",", "skb", ")", ";", "brcmf_fweh_process_skb", "(", "ifp", "-", ">", "drvr", ",", "skb", ",", "BCMILCP_SUBTYPE_VENDOR_LONG", ")", ";", "brcmf_netif_rx", "(", "ifp", ",", "skb", ")", ";", "}", "@", "@", "-", "536", ",", "7", "+", "537", ",", "7", "@", "@", "void", "brcmf_rx_event", "(", "struct", "device", "*", "dev", ",", "struct", "sk_buff", "*", "skb", ")", "if", "(", "brcmf_rx_hdrpull", "(", "drvr", ",", "skb", ",", "&", "ifp", ")", ")", "return", ";", "brcmf_fweh_process_skb", "(", "ifp", "-", ">", "drvr", ",", "skb", ")", ";", "brcmf_fweh_process_skb", "(", "ifp", "-", ">", "drvr", ",", "skb", ",", "0", ")", ";", "brcmu_pkt_buf_free_skb", "(", "skb", ")", ";", "}", "@", "@", "-", "211", ",", "7", "+", "211", ",", "7", "@", "@", "enum", "brcmf_fweh_event_code", "{", "*", "/", "#", "define", "BRCM_OUI", "\"", "\\", "x00", "\\", "x10", "\\", "x18", "\"", "#", "define", "BCMILCP_BCM_SUBTYPE_EVENT", "1", "#", "define", "BCMILCP_SUBTYPE_VENDOR_LONG", "32769", "/", "**", "*", "struct", "brcm_ethhdr", "-", "broadcom", "specific", "ether", "header", ".", "@", "@", "-", "334", ",", "10", "+", "334", ",", "10", "@", "@", "void", "brcmf_fweh_process_event", "(", "struct", "brcmf_pub", "*", "drvr", ",", "void", "brcmf_fweh_p2pdev_setup", "(", "struct", "brcmf_if", "*", "ifp", ",", "bool", "ongoing", ")", ";", "static", "inline", "void", "brcmf_fweh_process_skb", "(", "struct", "brcmf_pub", "*", "drvr", ",", "struct", "sk_buff", "*", "skb", ")", "struct", "sk_buff", "*", "skb", ",", "u16", "stype", ")", "{", "struct", "brcmf_event", "*", "event_packet", ";", "u16", "usr_stype", ";", "u16", "subtype", ",", "usr_stype", ";", "/", "*", "only", "process", "events", "when", "protocol", "matches", "*", "/", "if", "(", "skb", "-", ">", "protocol", "!", "=", "cpu_to_be16", "(", "ETH_P_LINK_CTL", ")", ")", "@", "@", "-", "346", ",", "8", "+", "346", ",", "16", "@", "@", "static", "inline", "void", "brcmf_fweh_process_skb", "(", "struct", "brcmf_pub", "*", "drvr", ",", "if", "(", "(", "skb", "-", ">", "len", "+", "ETH_HLEN", ")", "<", "sizeof", "(", "*", "event_packet", ")", ")", "return", ";", "/", "*", "check", "for", "BRCM", "oui", "match", "*", "/", "event_packet", "=", "(", "struct", "brcmf_event", "*", ")", "skb_mac_header", "(", "skb", ")", ";", "/", "*", "check", "subtype", "if", "needed", "*", "/", "if", "(", "unlikely", "(", "stype", ")", ")", "{", "subtype", "=", "get_unaligned_be16", "(", "&", "event_packet", "-", ">", "hdr", ".", "subtype", ")", ";", "if", "(", "subtype", "!", "=", "stype", ")", "return", ";", "}", "/", "*", "check", "for", "BRCM", "oui", "match", "*", "/", "if", "(", "memcmp", "(", "BRCM_OUI", ",", "&", "event_packet", "-", ">", "hdr", ".", "oui", "[", "0", "]", ",", "sizeof", "(", "event_packet", "-", ">", "hdr", ".", "oui", ")", "))", "return", ";", "@", "@", "-", "1116", ",", "7", "+", "1116", ",", "7", "@", "@", "static", "void", "brcmf_msgbuf_process_event", "(", "struct", "brcmf_msgbuf", "*", "msgbuf", ",", "void", "*", "buf", ")", "skb", "-", ">", "protocol", "=", "eth_type_trans", "(", "skb", ",", "ifp", "-", ">", "ndev", ")", ";", "brcmf_fweh_process_skb", "(", "ifp", "-", ">", "drvr", ",", "skb", ")", ";", "brcmf_fweh_process_skb", "(", "ifp", "-", ">", "drvr", ",", "skb", ",", "0", ")", ";", "exit", ":", "brcmu_pkt_buf_free_skb", "(", "skb", ")", ";"], "docstring_tokens": ["receiving", "firmware", "event", "frames", "from", "a", "remote", "source"]}
{"contents": ["l2tp:", "pass", "tunnel", "pointer", "to", "->session_create()", "Using", "l2tp_tunnel_find()", "in", "pppol2tp_session_create()", "and", "l2tp_eth_create()", "is", "racy,", "because", "no", "reference", "is", "held", "on", "the", "returned", "session.", "These", "functions", "are", "only", "used", "to", "implement", "the", "->session_create", "callback", "which", "is", "run", "by", "l2tp_nl_cmd_session_create().", "Therefore", "searching", "for", "the", "parent", "tunnel", "isn't", "necessary", "because", "l2tp_nl_cmd_session_create()", "already", "has", "a", "pointer", "to", "it", "and", "holds", "a", "reference.", "This", "patch", "modifies", "->session_create()'s", "prototype", "to", "directly", "pass", "the", "the", "parent", "tunnel", "as", "parameter,", "thus", "avoiding", "searching", "for", "it", "in", "pppol2tp_session_create()", "and", "l2tp_eth_create().", "Since", "we", "have", "to", "touch", "the", "->session_create()", "call", "in", "l2tp_nl_cmd_session_create(),", "let's", "also", "remove", "the", "useless", "conditional:", "we", "know", "that", "->session_create", "isn't", "NULL", "at", "this", "point", "because", "it's", "already", "been", "checked", "earlier", "in", "this", "same", "function.", "Finally,", "one", "might", "be", "tempted", "to", "think", "that", "the", "removed", "l2tp_tunnel_find()", "calls", "were", "harmless", "because", "they", "would", "return", "the", "same", "tunnel", "as", "the", "one", "held", "by", "l2tp_nl_cmd_session_create()", "anyway.", "But", "that", "tunnel", "might", "be", "removed", "and", "a", "new", "one", "created", "with", "same", "tunnel", "Id", "before", "the", "l2tp_tunnel_find()", "call.", "In", "this", "case", "l2tp_tunnel_find()", "would", "return", "the", "new", "tunnel", "which", "wouldn't", "be", "protected", "by", "the", "reference", "held", "by", "l2tp_nl_cmd_session_create().", "Fixes:", "309795f4bec2", "(\"l2tp:", "Add", "netlink", "control", "API", "for", "L2TP\")", "Fixes:", "d9e31d17ceba", "(\"l2tp:", "Add", "L2TP", "ethernet", "pseudowire", "support\")", "Signed-off-by:", "Guillaume", "Nault", "<g.nault@alphalink.fr>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "201", ",", "7", "+", "201", ",", "9", "@", "@", "struct", "l2tp_tunnel", "{", "}", ";", "struct", "l2tp_nl_cmd_ops", "{", "int", "(", "*", "session_create", ")", "(", "struct", "net", "*", "net", ",", "u32", "tunnel_id", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", ";", "int", "(", "*", "session_create", ")", "(", "struct", "net", "*", "net", ",", "struct", "l2tp_tunnel", "*", "tunnel", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", ";", "int", "(", "*", "session_delete", ")", "(", "struct", "l2tp_session", "*", "session", ")", ";", "}", ";", "@", "@", "-", "262", ",", "24", "+", "262", ",", "19", "@", "@", "static", "void", "l2tp_eth_adjust_mtu", "(", "struct", "l2tp_tunnel", "*", "tunnel", ",", "dev", "-", ">", "needed_headroom", "+", "=", "session", "-", ">", "hdr_len", ";", "}", "static", "int", "l2tp_eth_create", "(", "struct", "net", "*", "net", ",", "u32", "tunnel_id", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "static", "int", "l2tp_eth_create", "(", "struct", "net", "*", "net", ",", "struct", "l2tp_tunnel", "*", "tunnel", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "{", "unsigned", "char", "name_assign_type", ";", "struct", "net_device", "*", "dev", ";", "char", "name", "[", "IFNAMSIZ", "]", ";", "struct", "l2tp_tunnel", "*", "tunnel", ";", "struct", "l2tp_session", "*", "session", ";", "struct", "l2tp_eth", "*", "priv", ";", "struct", "l2tp_eth_sess", "*", "spriv", ";", "int", "rc", ";", "struct", "l2tp_eth_net", "*", "pn", ";", "tunnel", "=", "l2tp_tunnel_find", "(", "net", ",", "tunnel_id", ")", ";", "if", "(", "!", "tunnel", ")", "{", "rc", "=", "-", "ENODEV", ";", "goto", "out", ";", "}", "if", "(", "cfg", "-", ">", "ifname", ")", "{", "strlcpy", "(", "name", ",", "cfg", "-", ">", "ifname", ",", "IFNAMSIZ", ")", ";", "name_assign_type", "=", "NET_NAME_USER", ";", "@", "@", "-", "643", ",", "10", "+", "643", ",", "10", "@", "@", "static", "int", "l2tp_nl_cmd_session_create", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "genl_info", "*", "inf", "break", ";", "}", "ret", "=", "-", "EPROTONOSUPPORT", ";", "if", "(", "l2tp_nl_cmd_ops", "[", "cfg", ".", "pw_type", "]", "->", "session_create", ")", "ret", "=", "(", "*", "l2tp_nl_cmd_ops", "[", "cfg", ".", "pw_type", "]", "->", "session_create", ")", "(", "net", ",", "tunnel_id", ",", "session_id", ",", "peer_session_id", ",", "&", "cfg", ")", ";", "ret", "=", "l2tp_nl_cmd_ops", "[", "cfg", ".", "pw_type", "]", "->", "session_create", "(", "net", ",", "tunnel", ",", "session_id", ",", "peer_session_id", ",", "&", "cfg", ")", ";", "if", "(", "ret", ">", "=", "0", ")", "{", "session", "=", "l2tp_session_get", "(", "net", ",", "tunnel", ",", "session_id", ",", "false", ")", ";", "@", "@", "-", "788", ",", "25", "+", "788", ",", "20", "@", "@", "static", "int", "pppol2tp_connect", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "uservaddr", ",", "#", "ifdef", "CONFIG_L2TP_V3", "/", "*", "Called", "when", "creating", "sessions", "via", "the", "netlink", "interface", ".", "*", "/", "static", "int", "pppol2tp_session_create", "(", "struct", "net", "*", "net", ",", "u32", "tunnel_id", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "/", "*", "Called", "when", "creating", "sessions", "via", "the", "netlink", "interface", ".", "*", "/", "static", "int", "pppol2tp_session_create", "(", "struct", "net", "*", "net", ",", "struct", "l2tp_tunnel", "*", "tunnel", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "{", "int", "error", ";", "struct", "l2tp_tunnel", "*", "tunnel", ";", "struct", "l2tp_session", "*", "session", ";", "struct", "pppol2tp_session", "*", "ps", ";", "tunnel", "=", "l2tp_tunnel_find", "(", "net", ",", "tunnel_id", ")", ";", "/", "*", "Error", "if", "we", "can", "'", "t", "find", "the", "tunnel", "*", "/", "error", "=", "-", "ENOENT", ";", "if", "(", "tunnel", "=", "=", "NULL", ")", "goto", "out", ";", "/", "*", "Error", "if", "tunnel", "socket", "is", "not", "prepped", "*", "/", "if", "(", "tunnel", "-", ">", "sock", "=", "=", "NULL", ")", "if", "(", "!", "tunnel", "-", ">", "sock", ")", "{", "error", "=", "-", "ENOENT", ";", "goto", "out", ";", "}", "/", "*", "Default", "MTU", "values", ".", "*", "/", "if", "(", "cfg", "-", ">", "mtu", "=", "=", "0", ")"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Consolidate", "credential", "access/not", "found", "messages", "[#149701173]"], "code_tokens": ["@", "@", "-", "32", ",", "13", "+", "32", ",", "13", "@", "@", "public", "CredentialHandler", "(", "CredentialDataService", "credentialDataService", ",", "Permission", "public", "void", "deleteCredential", "(", "UserContext", "userContext", ",", "String", "credentialName", ")", "{", "if", "(", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "credentialName", ",", "DELETE", ")", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "boolean", "deleteSucceeded", "=", "credentialDataService", ".", "delete", "(", "credentialName", ")", ";", "if", "(", "!", "deleteSucceeded", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "}", "@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "public", "DataResponse", "getAllCredentialVersions", "(", "/", "/", "We", "need", "this", "extra", "check", "in", "case", "permissions", "aren", "'", "t", "being", "enforced", ".", "if", "(", "credentials", ".", "isEmpty", "(", ")", "|", "|", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "credentialName", ",", "READ", ")", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential_not_found", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "return", "DataResponse", ".", "fromEntity", "(", "credentials", ")", ";", "@", "@", "-", "106", ",", "7", "+", "106", ",", "7", "@", "@", "private", "Credential", "getVersionByIdentifier", "(", "auditRecordParametersList", ".", "add", "(", "eventAuditRecordParameters", ")", ";", "if", "(", "credential", "=", "=", "null", "|", "|", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "credential", ".", "getName", "(", "),", "READ", ")", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential_not_found", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "return", "credential", ";", "@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "public", "PermissionsView", "setPermissions", "(", "UserContext", "userContext", ",", "String", "name", ",", "/", "/", "We", "need", "to", "verify", "that", "the", "credential", "exists", "in", "case", "ACL", "enforcement", "is", "off", "if", "(", "credentialName", "=", "=", "null", "|", "|", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "name", ",", "WRITE_ACL", ")", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "for", "(", "PermissionEntry", "permissionEntry", ":", "permissionEntryList", ")", "{", "@", "@", "-", "72", ",", "7", "+", "72", ",", "7", "@", "@", "public", "PermissionsView", "setPermissions", "(", "UserContext", "userContext", ",", "String", "name", ",", "public", "void", "deletePermissionEntry", "(", "UserContext", "userContext", ",", "String", "credentialName", ",", "String", "actor", ")", "{", "if", "(", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "credentialName", ",", "WRITE_ACL", ")", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "if", "(", "!", "permissionService", ".", "validAclUpdateOperation", "(", "userContext", ",", "actor", ")", ")", "{", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "public", "void", "deletePermissionEntry", "(", "UserContext", "userContext", ",", "String", "credentialName", ".", "deleteAccessControlEntry", "(", "credentialName", ",", "actor", ")", ";", "if", "(", "!", "successfullyDeleted", ")", "{", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "}", "}", "@", "@", "-", "114", ",", "13", "+", "114", ",", "13", "@", "@", "public", "CredentialView", "save", "(", "private", "void", "verifyCredentialWritePermission", "(", "UserContext", "userContext", ",", "String", "credentialName", ")", "{", "if", "(", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "credentialName", ",", "WRITE", ")", ")", "{", "throw", "new", "PermissionException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "PermissionException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "}", "private", "void", "verifyAclWrite", "(", "UserContext", "userContext", ",", "String", "credentialName", ")", "{", "if", "(", "!", "permissionService", ".", "hasPermission", "(", "userContext", ".", "getAclUser", "(", "),", "credentialName", ",", "WRITE_ACL", ")", ")", "{", "throw", "new", "PermissionException", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", ");", "throw", "new", "PermissionException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "}", "}", "@", "@", "-", "55", ",", "7", "+", "55", ",", "7", "@", "@", "public", "JsonInterpolationService", "(", "CredentialDataService", "credentialDataService", ")", "{", "eventAuditRecordParameters", ".", "add", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "credentialName", ")", ");", "throw", "new", "ParameterizedValidationException", "(", "\"", "error", ".", "interpolation", ".", "invalid_access", "\"", ");", "throw", "new", "ParameterizedValidationException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "eventAuditRecordParameters", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "public", "CredentialView", "performRegenerate", "(", "Credential", "credential", "=", "credentialDataService", ".", "findMostRecent", "(", "requestBody", ".", "getName", "(", "))", ";", "if", "(", "credential", "=", "=", "null", ")", "{", "parametersList", ".", "add", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_UPDATE", ",", "requestBody", ".", "getName", "(", "))", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential_not_found", "\"", ");", "throw", "new", "EntryNotFoundException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "Regeneratable", "regeneratable", "=", "regeneratableTypes", "@", "@", "-", "7", ",", "7", "+", "7", ",", "6", "@", "@", "error", ".", "cert_not_ca", "=", "The", "requested", "certificate", "cannot", "be", "signed", "by", "the", "given", "CA", "bec", "error", ".", "missing_signing_ca", "=", "You", "must", "specify", "a", "signing", "CA", "or", "indicate", "self", "-", "signing", "when", "generating", "a", "certificate", ".", "Please", "update", "and", "retry", "your", "request", ".", "error", ".", "cannot_regenerate_non_generated_password", "=", "The", "password", "could", "not", "be", "regenerated", "because", "the", "value", "was", "statically", "set", ".", "Only", "generated", "passwords", "may", "be", "regenerated", ".", "error", ".", "cannot_regenerate_non_generated_certificate", "=", "The", "credential", "could", "not", "be", "regenerated", "because", "the", "certificate", "was", "statically", "set", "and", "is", "not", "self", "-", "signed", "or", "is", "invalid", ".", "error", ".", "credential_not_found", "=", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "error", ".", "excludes_all_charsets", "=", "The", "combination", "of", "parameters", "in", "the", "request", "is", "not", "allowed", ".", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "error", ".", "insufficient_hex_alpha", "=", "Password", "must", "contain", "at", "least", "1", "characters", "from", "A", "-", "F", ".", "error", ".", "invalid_alternate_name", "=", "A", "provided", "alternative", "name", "is", "not", "a", "valid", "hostname", "or", "IP", "address", ".", "Please", "update", "this", "value", "and", "retry", "your", "request", ".", "@", "@", "-", "35", ",", "11", "+", "34", ",", "10", "@", "@", "error", ".", "acl", ".", "invalid_operation", "=", "The", "provided", "operation", "is", "not", "supported", ".", "Valid", "value", "error", ".", "acl", ".", "invalid_update_operation", "=", "Modification", "of", "access", "control", "for", "the", "authenticated", "user", "is", "not", "allowed", ".", "Please", "contact", "an", "administrator", ".", "error", ".", "acl", ".", "missing_aces", "=", "At", "least", "one", "access", "control", "entry", "must", "be", "provided", ".", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "error", ".", "acl", ".", "missing_operations", "=", "At", "least", "one", "operation", "must", "be", "provided", ".", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "error", ".", "acl", ".", "lacks_credential_write", "=", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "error", ".", "interpolation", ".", "invalid_type", "=", "The", "credential", "'", "'{", "0", "}", "''", "is", "not", "the", "expected", "type", ".", "A", "credhub", "-", "ref", "credential", "must", "be", "of", "type", "'", "'", "JSON", "'", "'.", "error", ".", "interpolation", ".", "invalid_access", "=", "The", "request", "could", "not", "be", "completed", "because", "a", "reference", "credential", "could", "not", "be", "accessed", ".", "Please", "update", "and", "retry", "your", "request", ".", "error", ".", "auth", ".", "invalid_mtls_identity", "=", "The", "provided", "authentication", "mechanism", "does", "not", "provide", "a", "valid", "identity", ".", "Please", "contact", "your", "system", "administrator", ".", "error", ".", "auth", ".", "mtls_not_client_auth", "=", "The", "provided", "certificate", "is", "not", "authorized", "to", "be", "used", "for", "client", "authentication", ".", "error", ".", "credential", ".", "invalid_access", "=", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "error", ".", "credential", ".", "invalid_certificate_parameter", "=", "The", "request", "could", "not", "be", "completed", "because", "the", "{", "0", "}", "is", "too", "long", ".", "The", "max", "length", "for", "{", "0", "}", "is", "{", "1", "}", "characters", ".", "error", ".", "credential", ".", "invalid_character_in_name", "=", "Credential", "names", "may", "only", "include", "alpha", ",", "numeric", ",", "hyphen", ",", "underscore", ",", "and", "forward", "-", "slash", "characters", ".", "Please", "update", "and", "retry", "your", "request", ".", "error", ".", "credential", ".", "invalid_slash_in_name", "=", "A", "credential", "name", "cannot", "end", "with", "a", "'", "/'", "character", "or", "contain", "'", "//", "'.", "Credential", "names", "should", "be", "in", "the", "form", "of", "/", "[", "path", "]", "/[", "name", "]", "or", "[", "path", "]", "/[", "name", "]", ".", "Please", "update", "and", "retry", "your", "request", ".", "@", "@", "-", "161", ",", "7", "+", "161", ",", "7", "@", "@", "public", "void", "POST_whenAReferencedCredentialDoesNotExist_throwsAnError", "(", ")", "throws", "Ex", "null", ")", ".", "when", "(", "mockCredentialDataService", ")", ".", "findMostRecent", "(", "\"/", "cred1", "\"", ");", "String", "expectedMessage", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "a", "reference", "credential", "could", "not", "be", "accessed", ".", "Please", "update", "and", "retry", "your", "request", ".", "\";", "String", "expectedMessage", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "mockMvc", ".", "perform", "(", "post", "(", "\"/", "api", "/", "v1", "/", "interpolate", "\"", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_JSON", ")", "@", "@", "-", "165", ",", "13", "+", "165", ",", "12", "@", "@", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ")", ".", "accept", "(", "APPLICATION_JSON", ")", ";", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "mockMvc", ".", "perform", "(", "get", ")", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "content", "(", ").", "contentTypeCompatibleWith", "(", "APPLICATION_JSON", ")", ")", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ")", ".", "value", "(", "\"", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "\"", "+", "\"", "and", "retry", "your", "request", ".", "\")", "jsonPath", "(", "\"$", ".", "error", "\"", ").", "value", "(", "expectedError", ")", ")", ";", "}", ");", "}", ");", "@", "@", "-", "316", ",", "13", "+", "315", ",", "12", "@", "@", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ")", ".", "accept", "(", "APPLICATION_JSON", ")", ";", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "mockMvc", ".", "perform", "(", "get", ")", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "content", "(", ").", "contentTypeCompatibleWith", "(", "APPLICATION_JSON", ")", ")", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ")", ".", "value", "(", "\"", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "and", "\"", "+", "\"", "retry", "your", "request", ".", "\")", "jsonPath", "(", "\"$", ".", "error", "\"", ").", "value", "(", "expectedError", ")", ")", ";", "}", ");", "}", ";", "@", "@", "-", "348", ",", "13", "+", "346", ",", "12", "@", "@", "}", ");", "it", "(", "\"", "should", "return", "credential", "not", "found", "even", "if", "request", "is", "valid", "\"", ",", "(", ")", "-", ">", "{", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "this", ".", "response", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "content", "(", ").", "contentTypeCompatibleWith", "(", "APPLICATION_JSON", ")", ")", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ")", ".", "value", "(", "\"", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "and", "\"", "+", "\"", "retry", "your", "request", ".", "\")", "jsonPath", "(", "\"$", ".", "error", "\"", ").", "value", "(", "expectedError", ")", ")", ";", "}", ");", "@", "@", "-", "369", ",", "13", "+", "366", ",", "12", "@", "@", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ")", ".", "accept", "(", "APPLICATION_JSON", ")", ";", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "mockMvc", ".", "perform", "(", "get", ")", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "content", "(", ").", "contentTypeCompatibleWith", "(", "APPLICATION_JSON", ")", ")", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ")", ".", "value", "(", "\"", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "and", "\"", "+", "\"", "retry", "your", "request", ".", "\")", "jsonPath", "(", "\"$", ".", "error", "\"", ").", "value", "(", "expectedError", ")", ")", ";", "}", ");", "}", ";", "@", "@", "-", "1", ",", "28", "+", "1", ",", "5", "@", "@", "package", "io", ".", "pivotal", ".", "security", ".", "controller", ".", "v1", ".", "credential", ";", "import", "static", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ".", "beforeEach", ";", "import", "static", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ".", "describe", ";", "import", "static", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ".", "it", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "audit", ".", "AuditingOperationCode", ".", "CREDENTIAL_UPDATE", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "helper", ".", "SpectrumHelper", ".", "mockOutCurrentTimeProvider", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "helper", ".", "SpectrumHelper", ".", "wireAndUnwire", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "util", ".", "AuthConstants", ".", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doAnswer", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doReturn", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "APPLICATION_JSON", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "servlet", ".", "setup", ".", "SecurityMockMvcConfigurers", ".", "springSecurity", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "post", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultHandlers", ".", "print", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "jsonPath", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "status", ";", "import", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ";", "import", "io", ".", "pivotal", ".", "security", ".", "CredentialManagerApp", ";", "import", "io", ".", "pivotal", ".", "security", ".", "credential", ".", "RsaCredentialValue", ";", "@", "@", "-", "46", ",", "9", "+", "23", ",", "6", "@", "@", "import", "io", ".", "pivotal", ".", "security", ".", "service", ".", "EncryptionKeyCanaryMapper", ";", "import", "io", ".", "pivotal", ".", "security", ".", "util", ".", "CurrentTimeProvider", ";", "import", "io", ".", "pivotal", ".", "security", ".", "util", ".", "DatabaseProfileResolver", ";", "import", "java", ".", "time", ".", "Instant", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "java", ".", "util", ".", "function", ".", "Consumer", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "mockito", ".", "ArgumentCaptor", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "@", "@", "-", "61", ",", "6", "+", "35", ",", "33", "@", "@", "import", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "setup", ".", "MockMvcBuilders", ";", "import", "org", ".", "springframework", ".", "web", ".", "context", ".", "WebApplicationContext", ";", "import", "java", ".", "time", ".", "Instant", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "java", ".", "util", ".", "function", ".", "Consumer", ";", "import", "static", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ".", "beforeEach", ";", "import", "static", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ".", "describe", ";", "import", "static", "com", ".", "greghaskins", ".", "spectrum", ".", "Spectrum", ".", "it", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "audit", ".", "AuditingOperationCode", ".", "CREDENTIAL_UPDATE", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "helper", ".", "SpectrumHelper", ".", "mockOutCurrentTimeProvider", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "helper", ".", "SpectrumHelper", ".", "wireAndUnwire", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "util", ".", "AuthConstants", ".", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doAnswer", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doReturn", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "APPLICATION_JSON", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "servlet", ".", "setup", ".", "SecurityMockMvcConfigurers", ".", "springSecurity", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "post", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultHandlers", ".", "print", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "jsonPath", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "status", ";", "@", "RunWith", "(", "Spectrum", ".", "class", ")", "@", "ActiveProfiles", "(", "value", "=", "\"", "unit", "-", "test", "\"", ",", "resolver", "=", "DatabaseProfileResolver", ".", "class", ")", "@", "SpringBootTest", "(", "classes", "=", "CredentialManagerApp", ".", "class", ")", "@", "@", "-", "290", ",", "8", "+", "291", ",", "7", "@", "@", "it", "(", "\"", "returns", "an", "error", "\"", ",", "(", ")", "-", ">", "{", "String", "notFoundJson", "=", "\"", "{\"", "+", "\"", "\\", "\"", "error", "\\", "\":", "\\", "\"", "Credential", "not", "found", ".", "\"", "+", "\"", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "\\\"", "\"", "+", "\"", "\\", "\"", "error", "\\", "\":", "\\", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\\\"", "\"", "\"", "}\"", ";", "response", "@", "@", "-", "88", ",", "7", "+", "88", ",", "7", "@", "@", "public", "void", "deleteCredential_whenTheUserLacksPermission_throwsAnException", "(", ")", "{", "subject", ".", "deleteCredential", "(", "userContext", ",", "CREDENTIAL_NAME", ")", ";", "fail", "(", "\"", "Should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "102", ",", "7", "+", "102", ",", "7", "@", "@", "public", "void", "deleteCredential_whenTheCredentialIsNotDeleted_throwsAnException", "(", ")", "{", "subject", ".", "deleteCredential", "(", "userContext", ",", "CREDENTIAL_NAME", ")", ";", "fail", "(", "\"", "Should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "154", ",", "7", "+", "154", ",", "7", "@", "@", "public", "void", "getAllCredentialVersions_whenTheUserLacksPermission_throwsException", "(", "CREDENTIAL_NAME", ")", ";", "fail", "(", "\"", "should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential_not_found", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "188", ",", "7", "+", "188", ",", "7", "@", "@", "public", "void", "getCredentialVersions_whenTheCredentialDoesNotExist_throwsException", "(", "CREDENTIAL_NAME", ")", ";", "fail", "(", "\"", "should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential_not_found", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "252", ",", "7", "+", "252", ",", "7", "@", "@", "public", "void", "getMostRecentCredentialVersion_whenTheCredentialDoesNotExist_throwsE", "CREDENTIAL_NAME", ")", ";", "fail", "(", "\"", "should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential_not_found", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "268", ",", "7", "+", "268", ",", "7", "@", "@", "public", "void", "getMostRecentCredentialVersion_whenTheUserLacksPermission_throwsExce", "CREDENTIAL_NAME", ")", ";", "fail", "(", "\"", "should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential_not_found", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "332", ",", "7", "+", "332", ",", "7", "@", "@", "public", "void", "getCredentialVersion_whenTheVersionDoesNotExist_throwsException", "(", ")", "{", "subject", ".", "getCredentialVersion", "(", "userContext", ",", "newArrayList", "(", "),", "UUID_STRING", ")", ";", "fail", "(", "\"", "should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential_not_found", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "347", ",", "7", "+", "347", ",", "7", "@", "@", "public", "void", "getCredentialVersion_whenTheUserLacksPermission_throwsException", "(", ")", "{", "subject", ".", "getCredentialVersion", "(", "userContext", ",", "newArrayList", "(", "),", "UUID_STRING", ")", ";", "fail", "(", "\"", "should", "throw", "exception", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential_not_found", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "177", ",", "7", "+", "177", ",", "7", "@", "@", "public", "void", "setPermissions_whenUserDoesNotHavePermission_throwsException", "(", ")", "{", "subject", ".", "setPermissions", "(", "userContext", ",", "CREDENTIAL_NAME", ",", "emptyList", "(", "))", ";", "fail", "(", "\"", "should", "throw", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "verify", "(", "permissionsDataService", ",", "times", "(", "0", ")", ").", "saveAccessControlEntries", "(", "any", "(", "),", "any", "(", "))", ";", "}", "}", "@", "@", "-", "214", ",", "7", "+", "214", ",", "7", "@", "@", "public", "void", "setPermissions_whenTheCredentialDoesNotExist_throwsException", "(", ")", "{", "subject", ".", "setPermissions", "(", "userContext", ",", "CREDENTIAL_NAME", ",", "emptyList", "(", "))", ";", "fail", "(", "\"", "should", "throw", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "verify", "(", "permissionsDataService", ",", "times", "(", "0", ")", ").", "saveAccessControlEntries", "(", "any", "(", "),", "any", "(", "))", ";", "}", "}", "@", "@", "-", "261", ",", "7", "+", "261", ",", "7", "@", "@", "public", "void", "deletePermissions_whenNothingIsDeleted_throwsAnException", "(", ")", "{", "subject", ".", "deletePermissionEntry", "(", "userContext", ",", "CREDENTIAL_NAME", ",", "ACTOR_NAME", ")", ";", "fail", "(", "\"", "should", "throw", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "276", ",", "7", "+", "276", ",", "7", "@", "@", "public", "void", "deletePermissions_whenTheUserLacksPermission_throwsInsteadOfDeleting", "subject", ".", "deletePermissionEntry", "(", "userContext", ",", "CREDENTIAL_NAME", ",", "ACTOR_NAME", ")", ";", "fail", "(", "\"", "should", "throw", "\"", ");", "}", "catch", "(", "EntryNotFoundException", "e", ")", "{", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "e", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "verify", "(", "permissionsDataService", ",", "times", "(", "0", ")", ").", "deleteAccessControlEntry", "(", "any", "(", "),", "any", "(", "))", ";", "}", "}", "@", "@", "-", "76", ",", "11", "+", "76", ",", "11", "@", "@", "public", "void", "GET_byCredentialName_whenTheUserDoesntHavePermissionToReadCredential", "throws", "Exception", "{", "final", "MockHttpServletRequestBuilder", "get", "=", "get", "(", "\"/", "api", "/", "v1", "/", "data", "?", "name", "=", "\"", "+", "CREDENTIAL_NAME", ")", ".", "with", "(", "x509", "(", "cert", "(", "SELF_SIGNED_CERT_WITH_CLIENT_AUTH_EXT", ")", "))", ";", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "mockMvc", ".", "perform", "(", "get", ")", ".", "andDo", "(", "print", "(", "))", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ",", "equalTo", "(", "\"", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "\")", "))", ";", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ",", "equalTo", "(", "expectedError", ")", "))", ";", "}", "@", "Test", "@", "@", "-", "100", ",", "11", "+", "100", ",", "11", "@", "@", "public", "void", "GET_byId_whenTheUserDoesntHavePermissionToReadCredential_returns404", "(", "throws", "Exception", "{", "final", "MockHttpServletRequestBuilder", "get", "=", "get", "(", "\"/", "api", "/", "v1", "/", "data", "/", "\"", "+", "uuid", ")", ".", "with", "(", "x509", "(", "cert", "(", "SELF_SIGNED_CERT_WITH_CLIENT_AUTH_EXT", ")", "))", ";", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "mockMvc", ".", "perform", "(", "get", ")", ".", "andDo", "(", "print", "(", "))", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ",", "equalTo", "(", "\"", "Credential", "not", "found", ".", "Please", "validate", "your", "input", "and", "retry", "your", "request", ".", "\")", "))", ";", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ",", "equalTo", "(", "expectedError", ")", "))", ";", "}", "@", "Test", "@", "@", "-", "268", ",", "7", "+", "268", ",", "7", "@", "@", "public", "void", "save_whenThereIsAnExistingCredentialWithACEs_shouldThrowAnExceptionI", "accessControlEntries", ",", "currentUserPermissions", ")", ";", "}", "catch", "(", "PermissionException", "pe", ")", "{", "assertThat", "(", "pe", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "acl", ".", "lacks_credential_write", "\"", "))", ";", "assertThat", "(", "pe", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "}", "}", "@", "@", "-", "135", ",", "7", "+", "135", ",", "7", "@", "@", "public", "void", "interpolateCredHubReferences_whenAReferencedCredentialDoesNotExist_i", "try", "{", "subject", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "}", "catch", "(", "ParameterizedValidationException", "exception", ")", "{", "assertThat", "(", "exception", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "interpolation", ".", "invalid_access", "\"", "))", ";", "assertThat", "(", "exception", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "assertThat", "(", "eventAuditRecordParameters", ",", "hasSize", "(", "1", ")", ");", "assertThat", "(", "eventAuditRecordParameters", ",", "contains", "("], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["net:", "Limit", "socket", "I/O", "iovec", "total", "length", "to", "INT_MAX.", "This", "helps", "protect", "us", "from", "overflow", "issues", "down", "in", "the", "individual", "protocol", "sendmsg/recvmsg", "handlers.", "Once", "we", "hit", "INT_MAX", "we", "truncate", "out", "the", "rest", "of", "the", "iovec", "by", "setting", "the", "iov_len", "members", "to", "zero.", "This", "works", "because:", "1)", "For", "SOCK_STREAM", "and", "SOCK_SEQPACKET", "sockets,", "partial", "writes", "are", "allowed", "and", "the", "application", "will", "just", "continue", "with", "another", "write", "to", "send", "the", "rest", "of", "the", "data.", "2)", "For", "datagram", "oriented", "sockets,", "where", "there", "must", "be", "a", "one-to-one", "correspondance", "between", "write()", "calls", "and", "packets", "on", "the", "wire,", "INT_MAX", "is", "going", "to", "be", "far", "larger", "than", "the", "packet", "size", "limit", "the", "protocol", "is", "going", "to", "check", "for", "and", "signal", "with", "-EMSGSIZE.", "Based", "upon", "a", "patch", "by", "Linus", "Torvalds.", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "322", ",", "7", "+", "322", ",", "7", "@", "@", "extern", "int", "csum_partial_copy_fromiovecend", "(", "unsigned", "char", "*", "kdata", ",", "int", "offset", ",", "unsigned", "int", "len", ",", "__wsum", "*", "csump", ")", ";", "extern", "long", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", ";", "extern", "int", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", ";", "extern", "int", "memcpy_toiovec", "(", "struct", "iovec", "*", "v", ",", "unsigned", "char", "*", "kdata", ",", "int", "len", ")", ";", "extern", "int", "memcpy_toiovecend", "(", "const", "struct", "iovec", "*", "v", ",", "unsigned", "char", "*", "kdata", ",", "int", "offset", ",", "int", "len", ")", ";", "@", "@", "-", "41", ",", "10", "+", "41", ",", "12", "@", "@", "static", "inline", "int", "iov_from_user_compat_to_kern", "(", "struct", "iovec", "*", "kiov", ",", "compat_size_t", "len", ";", "if", "(", "get_user", "(", "len", ",", "&", "uiov32", "-", ">", "iov_len", ")", "|", "|", "get_user", "(", "buf", ",", "&", "uiov32", "-", ">", "iov_base", ")", ")", "{", "tot_len", "=", "-", "EFAULT", ";", "break", ";", "}", "get_user", "(", "buf", ",", "&", "uiov32", "-", ">", "iov_base", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "len", ">", "INT_MAX", "-", "tot_len", ")", "len", "=", "INT_MAX", "-", "tot_len", ";", "tot_len", "+", "=", "len", ";", "kiov", "-", ">", "iov_base", "=", "compat_ptr", "(", "buf", ")", ";", "kiov", "-", ">", "iov_len", "=", "(", "__kernel_size_t", ")", "len", ";", "@", "@", "-", "35", ",", "10", "+", "35", ",", "9", "@", "@", "*", "in", "any", "case", ".", "*", "/", "long", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", "int", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", "{", "int", "size", ",", "ct", ";", "long", "err", ";", "int", "size", ",", "ct", ",", "err", ";", "if", "(", "m", "-", ">", "msg_namelen", ")", "{", "if", "(", "mode", "=", "=", "VERIFY_READ", ")", "{", "@", "@", "-", "62", ",", "14", "+", "61", ",", "13", "@", "@", "long", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "err", "=", "0", ";", "for", "(", "ct", "=", "0", ";", "ct", "<", "m", "-", ">", "msg_iovlen", ";", "ct", "+", "+)", "{", "err", "+", "=", "iov", "[", "ct", "]", ".", "iov_len", ";", "/", "*", "*", "Goal", "is", "not", "to", "verify", "user", "data", ",", "but", "to", "prevent", "returning", "*", "negative", "value", ",", "which", "is", "interpreted", "as", "errno", ".", "*", "Overflow", "is", "still", "possible", ",", "but", "it", "is", "harmless", ".", "*", "/", "if", "(", "err", "<", "0", ")", "return", "-", "EMSGSIZE", ";", "size_t", "len", "=", "iov", "[", "ct", "]", ".", "iov_len", ";", "if", "(", "len", ">", "INT_MAX", "-", "err", ")", "{", "len", "=", "INT_MAX", "-", "err", ";", "iov", "[", "ct", "]", ".", "iov_len", "=", "len", ";", "}", "err", "+", "=", "len", ";", "}", "return", "err", ";"], "docstring_tokens": ["sending", "an", "overly", "large", "amount", "of", "packets"]}
{"contents": ["GEODE-3974:", "Improve", "permissions", "for", "geode-modules", "functions", "(#1258)"], "code_tokens": ["@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "import", "java", ".", "io", ".", "DataInput", ";", "import", "java", ".", "io", ".", "DataOutput", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "32", ",", "6", "+", "34", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "InternalDistributedSystem", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "MembershipListener", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "membership", ".", "InternalDistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "ResourcePermissions", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "public", "class", "BootstrappingFunction", "implements", "Function", ",", "MembershipListener", ",", "DataSerializable", "{", "@", "@", "-", "87", ",", "6", "+", "91", ",", "11", "@", "@", "private", "Cache", "verifyCacheExists", "(", ")", "{", "return", "cache", ";", "}", "@", "Override", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "ResourcePermissions", ".", "CLUSTER_MANAGE", ")", ";", "}", "private", "void", "registerAsMembershipListener", "(", "Cache", "cache", ")", "{", "DistributionManager", "dm", "=", "(", "(", "InternalDistributedSystem", ")", "cache", ".", "getDistributedSystem", "(", "))", ".", "getDistributionManager", "(", ");", "@", "@", "-", "20", ",", "10", "+", "20", ",", "10", "@", "@", "import", "java", ".", "io", ".", "FileWriter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "xml", ".", "crypto", ".", "Data", ";", "import", "org", ".", "apache", ".", "geode", ".", "DataSerializable", ";", "import", "org", ".", "apache", ".", "geode", ".", "InternalGemFireError", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "AttributesFactory", ";", "@", "@", "-", "32", ",", "8", "+", "32", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Declarable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionAttributes", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionFactory", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionShortcut", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Scope", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "client", ".", "ClientCache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "@", "@", "-", "46", ",", "6", "+", "44", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "PartitionedRegion", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "xmlcache", ".", "CacheXmlGenerator", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "i18n", ".", "LocalizedStrings", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "ResourcePermissions", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "public", "class", "CreateRegionFunction", "implements", "Function", ",", "Declarable", ",", "DataSerializable", "{", "@", "@", "-", "96", ",", "6", "+", "96", ",", "11", "@", "@", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "status", ")", ";", "}", "@", "Override", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "ResourcePermissions", ".", "DATA_MANAGE", ")", ";", "}", "private", "RegionStatus", "createOrRetrieveRegion", "(", "RegionConfiguration", "configuration", ")", "{", "RegionStatus", "status", "=", "null", ";", "String", "regionName", "=", "configuration", ".", "getRegionName", "(", ");", "@", "@", "-", "17", ",", "13", "+", "17", ",", "16", "@", "@", "import", "java", ".", "io", ".", "DataInput", ";", "import", "java", ".", "io", ".", "DataOutput", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "apache", ".", "geode", ".", "DataSerializable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Declarable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "RegionFunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "public", "class", "RegionSizeFunction", "implements", "Function", ",", "Declarable", ",", "DataSerializable", "{", "@", "@", "-", "38", ",", "6", "+", "41", ",", "12", "@", "@", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "rfc", ".", "getDataSet", "(", ").", "size", "(", "))", ";", "}", "@", "Override", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "new", "ResourcePermission", "(", "ResourcePermission", ".", "Resource", ".", "DATA", ",", "ResourcePermission", ".", "Operation", ".", "READ", ",", "regionName", ")", ");", "}", "public", "String", "getId", "(", ")", "{", "return", "ID", ";", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "import", "java", ".", "io", ".", "DataInput", ";", "import", "java", ".", "io", ".", "DataOutput", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "29", ",", "6", "+", "31", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "RegionFunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "partition", ".", "PartitionRegionHelper", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "/", "**", "*", "Touches", "the", "keys", "contained", "in", "the", "set", "of", "keys", "by", "performing", "a", "get", "on", "the", "partitioned", "region", ".", "@", "@", "-", "76", ",", "6", "+", "79", ",", "12", "@", "@", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "true", ")", ";", "}", "@", "Override", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "new", "ResourcePermission", "(", "ResourcePermission", ".", "Resource", ".", "DATA", ",", "ResourcePermission", ".", "Operation", ".", "READ", ",", "regionName", ")", ");", "}", "public", "String", "getId", "(", ")", "{", "return", "ID", ";", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "import", "java", ".", "io", ".", "DataInput", ";", "import", "java", ".", "io", ".", "DataOutput", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "27", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "/", "**", "*", "Touches", "the", "keys", "contained", "in", "the", "set", "of", "keys", "by", "performing", "a", "get", "on", "the", "replicated", "region", ".", "This", "@", "@", "-", "71", ",", "6", "+", "74", ",", "12", "@", "@", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "true", ")", ";", "}", "@", "Override", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "new", "ResourcePermission", "(", "ResourcePermission", ".", "Resource", ".", "DATA", ",", "ResourcePermission", ".", "Operation", ".", "READ", ",", "regionName", ")", ");", "}", "public", "String", "getId", "(", ")", "{", "return", "ID", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "91", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "*", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "*", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "*", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "*", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "*", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "*", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "geode", ".", "modules", ".", "util", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "ClassRule", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "experimental", ".", "categories", ".", "Category", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionShortcut", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "import", "org", ".", "apache", ".", "geode", ".", "examples", ".", "SimpleSecurityManager", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "IntegrationTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "SecurityTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "rules", ".", "ConnectionConfiguration", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "rules", ".", "GfshCommandRule", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "rules", ".", "ServerStarterRule", ";", "@", "Category", "(", "{", "IntegrationTest", ".", "class", ",", "SecurityTest", ".", "class", "}", ")", "public", "class", "ModuleFunctionsSecurityTest", "{", "@", "ClassRule", "public", "static", "ServerStarterRule", "server", "=", "new", "ServerStarterRule", "(", ").", "withJMXManager", "(", ").", "withSecurityManager", "(", "SimpleSecurityManager", ".", "class", ")", ".", "withRegion", "(", "RegionShortcut", ".", "REPLICATE", ",", "\"", "REPLICATE_1", "\"", ")", ".", "withRegion", "(", "RegionShortcut", ".", "PARTITION", ",", "\"", "PARTITION_1", "\"", ").", "withAutoStart", "(", ");", "@", "Rule", "public", "GfshCommandRule", "gfsh", "=", "new", "GfshCommandRule", "(", "server", ":", ":", "getJmxPort", ",", "GfshCommandRule", ".", "PortType", ".", "jmxManager", ")", ";", "@", "BeforeClass", "public", "static", "void", "setupClass", "(", ")", "{", "FunctionService", ".", "registerFunction", "(", "new", "BootstrappingFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "CreateRegionFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "RegionSizeFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "TouchPartitionedRegionEntriesFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "TouchReplicatedRegionEntriesFunction", "(", "))", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForBootstrappingFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "BootstrappingFunction", ".", "ID", ")", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForCreateRegionFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "CreateRegionFunction", ".", "ID", ")", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "DATA", ":", "MANAGE", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForRegionSizeFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "REPLICATE_1", "-", "-", "id", "=", "\"", "+", "RegionSizeFunction", ".", "ID", ")", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "DATA", ":", "READ", ":", "REPLICATE_1", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForTouchPartitionedRegionEntriesFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "PARTITION_1", "-", "-", "id", "=", "\"", "+", "TouchPartitionedRegionEntriesFunction", ".", "ID", ")", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "DATA", ":", "READ", ":", "PARTITION_1", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForTouchReplicatedRegionEntriesFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "REPLICATE_1", "-", "-", "id", "=", "\"", "+", "TouchReplicatedRegionEntriesFunction", ".", "ID", ")", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "DATA", ":", "READ", ":", "REPLICATE_1", "\"", ").", "statusIsSuccess", "(", ");", "}", "}", "@", "@", "-", "14", ",", "6", "+", "14", ",", "8", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "cli", ".", "functions", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "@", "@", "-", "49", ",", "6", "+", "51", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "cli", ".", "i18n", ".", "CliStrings", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "cli", ".", "util", ".", "RegionPath", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "configuration", ".", "domain", ".", "XmlEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "ResourcePermissions", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "/", "**", "*", "@", "@", "-", "121", ",", "6", "+", "125", ",", "11", "@", "@", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "}", "}", "@", "Override", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "ResourcePermissions", ".", "DATA_MANAGE", ")", ";", "}", "private", "CliFunctionResult", "handleException", "(", "final", "String", "memberNameOrId", ",", "final", "String", "exceptionMsg", ",", "final", "Exception", "e", ")", "{", "if", "(", "e", "!", "=", "null", "&", "&", "logger", ".", "isDebugEnabled", "(", "))", "{"], "docstring_tokens": ["by", "invoking", "an", "internal", "Geode", "function", "."]}
{"contents": ["HID:", "validate", "HID", "report", "id", "size", "The", "\"Report", "ID\"", "field", "of", "a", "HID", "report", "is", "used", "to", "build", "indexes", "of", "reports.", "The", "kernel's", "index", "of", "these", "is", "limited", "to", "256", "entries,", "so", "any", "malicious", "device", "that", "sets", "a", "Report", "ID", "greater", "than", "255", "will", "trigger", "memory", "corruption", "on", "the", "host:", "[", "1347.156239]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "ffff88094958a878", "[", "1347.156261]", "IP:", "[<ffffffff813e4da0>]", "hid_register_report+0x2a/0x8b", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["@", "@", "-", "63", ",", "6", "+", "63", ",", "8", "@", "@", "struct", "hid_report", "*", "hid_register_report", "(", "struct", "hid_device", "*", "device", ",", "unsigned", "type", ",", "struct", "hid_report_enum", "*", "report_enum", "=", "device", "-", ">", "report_enum", "+", "type", ";", "struct", "hid_report", "*", "report", ";", "if", "(", "id", ">", "=", "HID_MAX_IDS", ")", "return", "NULL", ";", "if", "(", "report_enum", "-", ">", "report_id_hash", "[", "id", "]", ")", "return", "report_enum", "-", ">", "report_id_hash", "[", "id", "]", ";", "@", "@", "-", "404", ",", "8", "+", "406", ",", "10", "@", "@", "static", "int", "hid_parser_global", "(", "struct", "hid_parser", "*", "parser", ",", "struct", "hid_item", "*", "item", ")", "case", "HID_GLOBAL_ITEM_TAG_REPORT_ID", ":", "parser", "-", ">", "global", ".", "report_id", "=", "item_udata", "(", "item", ")", ";", "if", "(", "parser", "-", ">", "global", ".", "report_id", "=", "=", "0", ")", "{", "hid_err", "(", "parser", "-", ">", "device", ",", "\"", "report_id", "0", "is", "invalid", "\\", "n", "\"", ");", "if", "(", "parser", "-", ">", "global", ".", "report_id", "=", "=", "0", "|", "|", "parser", "-", ">", "global", ".", "report_id", ">", "=", "HID_MAX_IDS", ")", "{", "hid_err", "(", "parser", "-", ">", "device", ",", "\"", "report_id", "%", "u", "is", "invalid", "\\", "n", "\"", ",", "parser", "-", ">", "global", ".", "report_id", ")", ";", "return", "-", "1", ";", "}", "return", "0", ";", "@", "@", "-", "575", ",", "7", "+", "579", ",", "7", "@", "@", "static", "void", "hid_close_report", "(", "struct", "hid_device", "*", "device", ")", "for", "(", "i", "=", "0", ";", "i", "<", "HID_REPORT_TYPES", ";", "i", "+", "+)", "{", "struct", "hid_report_enum", "*", "report_enum", "=", "device", "-", ">", "report_enum", "+", "i", ";", "for", "(", "j", "=", "0", ";", "j", "<", "256", ";", "j", "+", "+)", "{", "for", "(", "j", "=", "0", ";", "j", "<", "HID_MAX_IDS", ";", "j", "+", "+)", "{", "struct", "hid_report", "*", "report", "=", "report_enum", "-", ">", "report_id_hash", "[", "j", "]", ";", "if", "(", "report", ")", "hid_free_report", "(", "report", ")", ";", "@", "@", "-", "393", ",", "10", "+", "393", ",", "12", "@", "@", "struct", "hid_report", "{", "struct", "hid_device", "*", "device", ";", "/", "*", "associated", "device", "*", "/", "}", ";", "#", "define", "HID_MAX_IDS", "256", "struct", "hid_report_enum", "{", "unsigned", "numbered", ";", "struct", "list_head", "report_list", ";", "struct", "hid_report", "*", "report_id_hash", "[", "256", "]", ";", "struct", "hid_report", "*", "report_id_hash", "[", "HID_MAX_IDS", "]", ";", "}", ";", "#", "define", "HID_REPORT_TYPES", "3"], "docstring_tokens": ["via", "a", "crafted", "device", "that", "provides", "an", "invalid", "Report", "ID", "."]}
{"contents": ["Fixed", "heap", "overflow", "in", "yaml_parser_scan_uri_escapes", "(Thanks", "Ivan", "Fratric", "of", "the", "Google", "Security", "Team)."], "code_tokens": ["@", "@", "-", "5", ",", "7", "+", "5", ",", "7", "@", "@", "project", "(", "yaml", "C", ")", "set", "(", "YAML_VERSION_MAJOR", "0", ")", "set", "(", "YAML_VERSION_MINOR", "1", ")", "set", "(", "YAML_VERSION_PATCH", "4", ")", "set", "(", "YAML_VERSION_PATCH", "6", ")", "set", "(", "YAML_VERSION_STRING", "\"", "${", "YAML_VERSION_MAJOR", "}", ".$", "{", "YAML_VERSION_MINOR", "}", ".$", "{", "YAML_VERSION_PATCH", "}", "\")", "file", "(", "GLOB", "SRC", "src", "/", "*.", "c", ")", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "#", "Define", "the", "package", "version", "numbers", "and", "the", "bug", "reporting", "link", ".", "m4_define", "(", "[", "YAML_MAJOR", "]", ",", "0", ")", "m4_define", "(", "[", "YAML_MINOR", "]", ",", "1", ")", "m4_define", "(", "[", "YAML_PATCH", "]", ",", "5", ")", "m4_define", "(", "[", "YAML_PATCH", "]", ",", "6", ")", "m4_define", "(", "[", "YAML_BUGS", "]", ",", "[", "http", ":", "//", "pyyaml", ".", "org", "/", "newticket", "?", "component", "=", "libyaml", "]", ")", "#", "Define", "the", "libtool", "version", "numbers", ";", "check", "the", "Autobook", ",", "Section", "11", ".", "4", ".", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "m4_define", "(", "[", "YAML_BUGS", "]", ",", "[", "http", ":", "//", "pyyaml", ".", "org", "/", "newticket", "?", "component", "=", "libyaml", "]", ")", "#", "YAML_AGE", "=", "0", "m4_define", "(", "[", "YAML_RELEASE", "]", ",", "0", ")", "m4_define", "(", "[", "YAML_CURRENT", "]", ",", "2", ")", "m4_define", "(", "[", "YAML_REVISION", "]", ",", "3", ")", "m4_define", "(", "[", "YAML_REVISION", "]", ",", "4", ")", "m4_define", "(", "[", "YAML_AGE", "]", ",", "0", ")", "#", "Initialize", "autoconf", "&", "automake", ".", "@", "@", "-", "2629", ",", "6", "+", "2629", ",", "9", "@", "@", "yaml_parser_scan_tag_uri", "(", "yaml_parser_t", "*", "parser", ",", "int", "directive", ",", "/", "*", "Check", "if", "it", "is", "a", "URI", "-", "escape", "sequence", ".", "*", "/", "if", "(", "CHECK", "(", "parser", "-", ">", "buffer", ",", "'", "%'", "))", "{", "if", "(", "!", "STRING_EXTEND", "(", "parser", ",", "string", ")", ")", "goto", "error", ";", "if", "(", "!", "yaml_parser_scan_uri_escapes", "(", "parser", ",", "directive", ",", "start_mark", ",", "&", "string", ")", ")", "goto", "error", ";", "}", "@", "@", "-", "143", ",", "9", "+", "143", ",", "12", "@", "@", "yaml_string_join", "(", "(", "string", ")", ".", "start", "=", "(", "string", ")", ".", "pointer", "=", "(", "string", ")", ".", "end", "=", "0", ")", "#", "define", "STRING_EXTEND", "(", "context", ",", "string", ")", "\\", "(", "((", "string", ")", ".", "pointer", "+", "5", "<", "(", "string", ")", ".", "end", ")", "\\", "(", "((", "(", "string", ")", ".", "pointer", "+", "5", "<", "(", "string", ")", ".", "end", ")", "\\", "|", "|", "yaml_string_extend", "(", "&(", "string", ")", ".", "start", ",", "\\", "&", "(", "string", ")", ".", "pointer", ",", "&", "(", "string", ")", ".", "end", ")", ")", "&", "(", "string", ")", ".", "pointer", ",", "&", "(", "string", ")", ".", "end", ")", ")", "?", "\\", "1", ":", "\\", "(", "(", "context", ")", "->", "error", "=", "YAML_MEMORY_ERROR", ",", "\\", "0", ")", ")", "#", "define", "CLEAR", "(", "context", ",", "string", ")", "\\", "(", "(", "string", ")", ".", "pointer", "=", "(", "string", ")", ".", "start", ",", "\\", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "#", "define", "YAML_VERSION_MAJOR", "0", "#", "define", "YAML_VERSION_MINOR", "1", "#", "define", "YAML_VERSION_PATCH", "5", "#", "define", "YAML_VERSION_STRING", "\"", "0", ".", "1", ".", "5", "\"", "#", "define", "YAML_VERSION_PATCH", "6", "#", "define", "YAML_VERSION_STRING", "\"", "0", ".", "1", ".", "6", "\""], "docstring_tokens": ["a", "heap-based", "buffer", "overflow"]}
{"contents": ["/proc/iomem:", "only", "expose", "physical", "resource", "addresses", "to", "privileged", "users", "In", "commit", "c4004b02f8e5b", "(\"x86:", "remove", "the", "kernel", "code/data/bss", "resources", "from", "/proc/iomem\")", "I", "was", "hoping", "to", "remove", "the", "phyiscal", "kernel", "address", "data", "from", "/proc/iomem", "entirely,", "but", "that", "had", "to", "be", "reverted", "because", "some", "system", "programs", "actually", "use", "it.", "This", "limits", "all", "the", "detailed", "resource", "information", "to", "properly", "credentialed", "users", "instead.", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "105", ",", "16", "+", "105", ",", "25", "@", "@", "static", "int", "r_show", "(", "struct", "seq_file", "*", "m", ",", "void", "*", "v", ")", "{", "struct", "resource", "*", "root", "=", "m", "-", ">", "private", ";", "struct", "resource", "*", "r", "=", "v", ",", "*", "p", ";", "unsigned", "long", "long", "start", ",", "end", ";", "int", "width", "=", "root", "-", ">", "end", "<", "0x10000", "?", "4", ":", "8", ";", "int", "depth", ";", "for", "(", "depth", "=", "0", ",", "p", "=", "r", ";", "depth", "<", "MAX_IORES_LEVEL", ";", "depth", "+", "+,", "p", "=", "p", "-", ">", "parent", ")", "if", "(", "p", "-", ">", "parent", "=", "=", "root", ")", "break", ";", "if", "(", "file_ns_capable", "(", "m", "-", ">", "file", ",", "&", "init_user_ns", ",", "CAP_SYS_ADMIN", ")", ")", "{", "start", "=", "r", "-", ">", "start", ";", "end", "=", "r", "-", ">", "end", ";", "}", "else", "{", "start", "=", "end", "=", "0", ";", "}", "seq_printf", "(", "m", ",", "\"", "%*", "s", "%", "0", "*", "llx", "-", "%", "0", "*", "llx", ":", "%", "s", "\\", "n", "\"", ",", "depth", "*", "2", ",", "\"", "\",", "width", ",", "(", "unsigned", "long", "long", ")", "r", "-", ">", "start", ",", "width", ",", "(", "unsigned", "long", "long", ")", "r", "-", ">", "end", ",", "width", ",", "start", ",", "width", ",", "end", ",", "r", "-", ">", "name", "?", "r", "-", ">", "name", ":", "\"", "<", "BAD", ">", "\")", ";", "return", "0", ";", "}"], "docstring_tokens": ["reading", "the", "/proc/idmem", "file"]}
{"contents": ["Upon", "a", "password", "change", "we", "will", "expire", "all", "HTTP", "sessions", "for", "that", "user", "https://www.pivotaltracker.com/story/show/100043648", "[#100043648]"], "code_tokens": ["@", "@", "-", "82", ",", "7", "+", "82", ",", "7", "@", "@", "*", "@", "param", "methods", "the", "methods", "to", "set", "(", "defaults", "to", "POST", ")", "*", "/", "public", "void", "setMethods", "(", "Set", "<", "String", ">", "methods", ")", "{", "this", ".", "methods", "=", "new", "HashSet", "<", "String", ">", "()", ";", "this", ".", "methods", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "String", "method", ":", "methods", ")", "{", "this", ".", "methods", ".", "add", "(", "method", ".", "toUpperCase", "(", "))", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "98", "@", "@", "/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "Cloud", "Foundry", "*", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2015", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUserDatabase", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "context", ".", "SecurityContext", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "context", ".", "SecurityContextHolder", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "userdetails", ".", "UsernameNotFoundException", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "RedirectStrategy", ";", "import", "org", ".", "springframework", ".", "web", ".", "filter", ".", "OncePerRequestFilter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpSession", ";", "import", "java", ".", "io", ".", "IOException", ";", "public", "class", "SessionResetFilter", "extends", "OncePerRequestFilter", "{", "private", "static", "Log", "logger", "=", "LogFactory", ".", "getLog", "(", "SessionResetFilter", ".", "class", ")", ";", "private", "final", "RedirectStrategy", "strategy", ";", "private", "final", "String", "redirectUrl", ";", "private", "final", "UaaUserDatabase", "userDatabase", ";", "public", "SessionResetFilter", "(", "RedirectStrategy", "strategy", ",", "String", "redirectUrl", ",", "UaaUserDatabase", "userDatabase", ")", "{", "this", ".", "strategy", "=", "strategy", ";", "this", ".", "redirectUrl", "=", "redirectUrl", ";", "this", ".", "userDatabase", "=", "userDatabase", ";", "}", "public", "String", "getRedirectUrl", "(", ")", "{", "return", "redirectUrl", ";", "}", "@", "Override", "protected", "void", "doFilterInternal", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ",", "FilterChain", "filterChain", ")", "throws", "ServletException", ",", "IOException", "{", "SecurityContext", "context", "=", "SecurityContextHolder", ".", "getContext", "(", ");", "if", "(", "context", "!", "=", "null", "&", "&", "context", ".", "getAuthentication", "(", ")!", "=", "null", "&", "&", "context", ".", "getAuthentication", "(", ")", "instanceof", "UaaAuthentication", ")", "{", "UaaAuthentication", "authentication", "=", "(", "UaaAuthentication", ")", "context", ".", "getAuthentication", "(", ");", "if", "(", "authentication", ".", "isAuthenticated", "(", ")", "&", "&", "Origin", ".", "UAA", ".", "equals", "(", "authentication", ".", "getPrincipal", "(", ").", "getOrigin", "(", "))", "&", "&", "null", "!", "=", "request", ".", "getSession", "(", "false", ")", ")", "{", "boolean", "redirect", "=", "false", ";", "String", "userId", "=", "authentication", ".", "getPrincipal", "(", ").", "getId", "(", ");", "try", "{", "logger", ".", "debug", "(", "\"", "Evaluating", "user", "-", "id", "for", "session", "reset", ":", "\"+", "userId", ")", ";", "UaaUser", "user", "=", "userDatabase", ".", "retrieveUserById", "(", "userId", ")", ";", "long", "lastAuthTime", "=", "authentication", ".", "getAuthenticatedTime", "(", ");", "long", "passwordModTime", "=", "user", ".", "getPasswordLastModified", "(", ").", "getTime", "(", ")", ";", "/", "/", "if", "the", "password", "has", "changed", "after", "authentication", "time", "if", "(", "hasPasswordChangedAfterAuthentication", "(", "lastAuthTime", ",", "passwordModTime", ")", ")", "{", "logger", ".", "debug", "(", "String", ".", "format", "(", "\"", "Resetting", "user", "session", "for", "user", "ID", ":", "%", "s", "Auth", "Time", ":", "%", "s", "Password", "Change", "Time", ":", "%", "s", "\"", ",", "userId", ",", "lastAuthTime", ",", "passwordModTime", ")", ");", "redirect", "=", "true", ";", "}", "}", "catch", "(", "UsernameNotFoundException", "x", ")", "{", "logger", ".", "info", "(", "\"", "Authenticated", "user", "[", "\"+", "userId", "+", "\"]", "was", "not", "found", "in", "DB", ".", "\")", ";", "redirect", "=", "true", ";", "}", "if", "(", "redirect", ")", "{", "handleRedirect", "(", "request", ",", "response", ")", ";", "return", ";", "}", "}", "}", "filterChain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "protected", "boolean", "hasPasswordChangedAfterAuthentication", "(", "long", "lastAuthTime", ",", "long", "passwordModTime", ")", "{", "return", "passwordModTime", ">", "lastAuthTime", ";", "}", "protected", "void", "handleRedirect", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "IOException", "{", "HttpSession", "session", "=", "request", ".", "getSession", "(", "false", ")", ";", "if", "(", "session", "!", "=", "null", ")", "{", "session", ".", "invalidate", "(", ");", "}", "strategy", ".", "sendRedirect", "(", "request", ",", "response", ",", "getRedirectUrl", "(", "))", ";", "}", "}", "@", "@", "-", "13", ",", "6", "+", "13", ",", "7", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonCreator", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonIgnore", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonProperty", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "Authentication", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "GrantedAuthority", ";", "@", "@", "-", "30", ",", "6", "+", "31", ",", "7", "@", "@", "private", "UaaPrincipal", "principal", ";", "private", "UaaAuthenticationDetails", "details", ";", "private", "boolean", "authenticated", ";", "private", "long", "authenticatedTime", "=", "-", "1l", ";", "/", "**", "*", "Creates", "a", "token", "with", "the", "supplied", "array", "of", "authorities", ".", "@", "@", "-", "40", ",", "15", "+", "42", ",", "16", "@", "@", "public", "UaaAuthentication", "(", "UaaPrincipal", "principal", ",", "List", "<", "?", "extends", "GrantedAuthority", ">", "authorities", ",", "UaaAuthenticationDetails", "details", ")", "{", "this", "(", "principal", ",", "null", ",", "authorities", ",", "details", ",", "true", ")", ";", "this", "(", "principal", ",", "null", ",", "authorities", ",", "details", ",", "true", ",", "System", ".", "currentTimeMillis", "(", "))", ";", "}", "@", "JsonCreator", "public", "UaaAuthentication", "(", "@", "JsonProperty", "(", "\"", "principal", "\"", ")", "UaaPrincipal", "principal", ",", "@", "JsonProperty", "(", "\"", "credentials", "\"", ")", "Object", "credentials", ",", "@", "JsonProperty", "(", "\"", "authorities", "\"", ")", "List", "<", "?", "extends", "GrantedAuthority", ">", "authorities", ",", "@", "JsonProperty", "(", "\"", "details", "\"", ")", "UaaAuthenticationDetails", "details", ",", "@", "JsonProperty", "(", "\"", "authenticated", "\"", ")", "boolean", "authenticated", ")", "{", "@", "JsonProperty", "(", "\"", "authenticated", "\"", ")", "boolean", "authenticated", ",", "@", "JsonProperty", "(", "value", "=", "\"", "authenticatedTime", "\"", ",", "defaultValue", "=", "\"", "-", "1", "\"", ")", "long", "authenticatedTime", ")", "{", "if", "(", "principal", "=", "=", "null", "|", "|", "authorities", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "principal", "and", "authorities", "must", "not", "be", "null", "\"", ");", "}", "@", "@", "-", "57", ",", "9", "+", "60", ",", "15", "@", "@", "public", "UaaAuthentication", "(", "@", "JsonProperty", "(", "\"", "principal", "\"", ")", "UaaPrincipal", "principal", ",", "this", ".", "details", "=", "details", ";", "this", ".", "credentials", "=", "credentials", ";", "this", ".", "authenticated", "=", "authenticated", ";", "this", ".", "authenticatedTime", "=", "authenticatedTime", "=", "=", "0", "?", "-", "1", ":", "authenticatedTime", ";", "}", "public", "long", "getAuthenticatedTime", "(", ")", "{", "return", "authenticatedTime", ";", "}", "@", "Override", "@", "JsonIgnore", "public", "String", "getName", "(", ")", "{", "/", "/", "Should", "we", "return", "the", "ID", "for", "the", "principal", "name", "?", "(", "No", ",", "because", "the", "/", "/", "UaaUserDatabase", "retrieves", "users", "by", "name", ".", ")", "@", "@", "-", "134", ",", "8", "+", "134", ",", "11", "@", "@", "public", "Authentication", "authenticate", "(", "Authentication", "req", ")", "throws", "AuthenticationExce", "}", "}", "Authentication", "success", "=", "new", "UaaAuthentication", "(", "new", "UaaPrincipal", "(", "user", ")", ",", "user", ".", "getAuthorities", "(", "),", "(", "UaaAuthenticationDetails", ")", "req", ".", "getDetails", "(", "))", ";", "Authentication", "success", "=", "new", "UaaAuthentication", "(", "new", "UaaPrincipal", "(", "user", ")", ",", "user", ".", "getAuthorities", "(", "),", "(", "UaaAuthenticationDetails", ")", "req", ".", "getDetails", "(", "))", ";", "publish", "(", "new", "UserAuthenticationSuccessEvent", "(", "user", ",", "success", ")", ");", "return", "success", ";", "@", "@", "-", "109", ",", "7", "+", "109", ",", "7", "@", "@", "protected", "void", "stripScopesFromAuthentication", "(", "String", "identityZoneId", ",", "HttpServletR", "null", ",", "UaaStringUtils", ".", "getAuthoritiesFromStrings", "(", "clientScopes", ")", ",", "new", "UaaAuthenticationDetails", "(", "servletRequest", ")", ",", "true", ")", ";", "true", ",", "userAuthentication", ".", "getAuthenticatedTime", "(", "))", ";", "}", "oa", "=", "new", "OAuth2Authentication", "(", "request", ",", "userAuthentication", ")", ";", "oa", ".", "setDetails", "(", "oaDetails", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "172", "@", "@", "/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "Cloud", "Foundry", "*", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2015", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "InMemoryUaaUserDatabase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUserDatabase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZone", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "import", "org", ".", "springframework", ".", "security", ".", "authentication", ".", "UsernamePasswordAuthenticationToken", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "context", ".", "SecurityContextHolder", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "DefaultRedirectStrategy", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpSession", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "util", ".", "Calendar", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyBoolean", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "reset", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyZeroInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "public", "class", "SessionResetFilterTests", "{", "SessionResetFilter", "filter", ";", "HttpServletResponse", "response", ";", "HttpServletRequest", "request", ";", "HttpSession", "session", ";", "FilterChain", "chain", ";", "UaaUserDatabase", "userDatabase", ";", "UaaAuthentication", "authentication", ";", "Date", "yesterday", ";", "UaaUser", "user", ";", "Map", "<", "String", ",", "UaaUser", ">", "users", ";", "@", "Before", "public", "void", "setUpFilter", "(", ")", "throws", "Exception", "{", "yesterday", "=", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", ");", "user", "=", "new", "UaaUser", "(", "\"", "user", "-", "id", "\"", ",", "\"", "username", "\"", ",", "\"", "password", "\"", ",", "\"", "email", "\"", ",", "Collections", ".", "EMPTY_LIST", ",", "\"", "given", "name", "\"", ",", "\"", "family", "name", "\"", ",", "yesterday", ",", "yesterday", ",", "Origin", ".", "UAA", ",", "null", ",", "true", ",", "IdentityZone", ".", "getUaa", "(", ").", "getId", "(", "),", "\"", "salt", "\"", ",", "yesterday", ")", ";", "UaaPrincipal", "principal", "=", "new", "UaaPrincipal", "(", "user", ")", ";", "authentication", "=", "new", "UaaAuthentication", "(", "principal", ",", "null", ",", "Collections", ".", "EMPTY_LIST", ",", "null", ",", "true", ",", "System", ".", "currentTimeMillis", "(", "))", ";", "users", "=", "new", "HashMap", "<", ">(", ");", "users", ".", "put", "(", "user", ".", "getId", "(", "),", "user", ")", ";", "userDatabase", "=", "new", "InMemoryUaaUserDatabase", "(", "users", ")", ";", "chain", "=", "mock", "(", "FilterChain", ".", "class", ")", ";", "request", "=", "mock", "(", "HttpServletRequest", ".", "class", ")", ";", "response", "=", "mock", "(", "HttpServletResponse", ".", "class", ")", ";", "session", "=", "mock", "(", "HttpSession", ".", "class", ")", ";", "when", "(", "request", ".", "getSession", "(", "anyBoolean", "(", "))", ").", "thenReturn", "(", "session", ")", ";", "filter", "=", "new", "SessionResetFilter", "(", "new", "DefaultRedirectStrategy", "(", "),", "\"/", "login", "\"", ",", "userDatabase", ")", ";", "}", "@", "After", "public", "void", "clearThingsUp", "(", ")", "{", "SecurityContextHolder", ".", "clearContext", "(", ");", "IdentityZoneHolder", ".", "clear", "(", ");", "}", "@", "Test", "public", "void", "test_No_Authentication_Present", "(", ")", "throws", "Exception", "{", "filter", ".", "doFilterInternal", "(", "request", ",", "response", ",", "chain", ")", ";", "verify", "(", "chain", ",", "times", "(", "1", ")", ").", "doFilter", "(", "request", ",", "response", ")", ";", "}", "@", "Test", "public", "void", "test_No_UAA_Authentication_Present", "(", ")", "throws", "Exception", "{", "UsernamePasswordAuthenticationToken", "authenticationToken", "=", "new", "UsernamePasswordAuthenticationToken", "(", "\"", "test", "\"", ",\"", "test", "\"", ");", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "authenticationToken", ")", ";", "filter", ".", "doFilterInternal", "(", "request", ",", "response", ",", "chain", ")", ";", "verify", "(", "chain", ",", "times", "(", "1", ")", ").", "doFilter", "(", "request", ",", "response", ")", ";", "verifyZeroInteractions", "(", "request", ")", ";", "verifyZeroInteractions", "(", "response", ")", ";", "}", "@", "Test", "public", "void", "test_User_Modified_After_Authentication", "(", ")", "throws", "Exception", "{", "setFieldValue", "(", "\"", "authenticatedTime", "\"", ",", "(", "yesterday", ".", "getTime", "(", ")", "-", "(", "1000", "*", "60", "*", "60", "*", "24", ")", "),", "authentication", ")", ";", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "authentication", ")", ";", "filter", ".", "doFilterInternal", "(", "request", ",", "response", ",", "chain", ")", ";", "/", "/", "user", "is", "not", "forwarded", ",", "and", "error", "response", "is", "generated", "right", "away", "Mockito", ".", "verifyZeroInteractions", "(", "chain", ")", ";", "/", "/", "user", "redirect", "verify", "(", "response", ",", "times", "(", "1", ")", ").", "sendRedirect", "(", "anyString", "(", "))", ";", "/", "/", "session", "was", "requested", "verify", "(", "request", ",", "times", "(", "2", ")", ").", "getSession", "(", "false", ")", ";", "/", "/", "session", "was", "invalidated", "verify", "(", "session", ",", "times", "(", "1", ")", ").", "invalidate", "(", ");", "}", "protected", "long", "dropMilliSeconds", "(", "long", "time", ")", "{", "return", "(", "time", "/", "1000l", ")", "*", "1000l", ";", "}", "@", "Test", "public", "void", "test_User_Not_Modified", "(", ")", "throws", "Exception", "{", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "authentication", ")", ";", "filter", ".", "doFilterInternal", "(", "request", ",", "response", ",", "chain", ")", ";", "verify", "(", "chain", ",", "times", "(", "1", ")", ").", "doFilter", "(", "request", ",", "response", ")", ";", "verifyZeroInteractions", "(", "response", ")", ";", "}", "@", "Test", "public", "void", "test_User_Not_Originated_In_Uaa", "(", ")", "throws", "Exception", "{", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "authentication", ")", ";", "setFieldValue", "(", "\"", "origin", "\"", ",", "Origin", ".", "LDAP", ",", "authentication", ".", "getPrincipal", "(", "))", ";", "filter", ".", "doFilterInternal", "(", "request", ",", "response", ",", "chain", ")", ";", "verify", "(", "chain", ",", "times", "(", "1", ")", ").", "doFilter", "(", "request", ",", "response", ")", ";", "verifyZeroInteractions", "(", "request", ")", ";", "verifyZeroInteractions", "(", "response", ")", ";", "}", "protected", "void", "setFieldValue", "(", "String", "fieldname", ",", "Object", "value", ",", "Object", "object", ")", "{", "Field", "f", "=", "ReflectionUtils", ".", "findField", "(", "object", ".", "getClass", "(", "),", "fieldname", ")", ";", "ReflectionUtils", ".", "makeAccessible", "(", "f", ")", ";", "ReflectionUtils", ".", "setField", "(", "f", ",", "object", ",", "value", ")", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "Cloud", "Foundry", "*", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2015", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "JsonUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "UaaAuthenticationSerializationTests", "{", "@", "Test", "public", "void", "testDeserializationWithoutAuthenticatedTime", "(", ")", "throws", "Exception", "{", "String", "data", "=", "\"{", "\\\"", "principal", "\\", "\":", "{\\", "\"", "id", "\\", "\":", "\\\"", "user", "-", "id", "\\", "\",", "\\\"", "name", "\\", "\":", "\\\"", "username", "\\", "\",", "\\\"", "email", "\\", "\":", "\\\"", "email", "\\", "\",", "\\\"", "origin", "\\", "\":", "\\\"", "uaa", "\\", "\",", "\\\"", "externalId", "\\", "\":", "null", ",", "\\\"", "zoneId", "\\", "\":", "\\\"", "uaa", "\\", "\"}", ",\\", "\"", "credentials", "\\", "\":", "null", ",", "\\\"", "authorities", "\\", "\":", "[]", ",\\", "\"", "details", "\\", "\":", "null", ",", "\\\"", "authenticated", "\\", "\":", "true", ",", "\\\"", "authenticatedTime", "\\", "\":", "1438649464353", ",", "\\\"", "name", "\\", "\":", "\\\"", "username", "\\", "\"}", "\";", "UaaAuthentication", "authentication1", "=", "JsonUtils", ".", "readValue", "(", "data", ",", "UaaAuthentication", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "1438649464353l", ",", "authentication1", ".", "getAuthenticatedTime", "(", "))", ";", "String", "dataWithoutTime", "=", "\"{", "\\\"", "principal", "\\", "\":", "{\\", "\"", "id", "\\", "\":", "\\\"", "user", "-", "id", "\\", "\",", "\\\"", "name", "\\", "\":", "\\\"", "username", "\\", "\",", "\\\"", "email", "\\", "\":", "\\\"", "email", "\\", "\",", "\\\"", "origin", "\\", "\":", "\\\"", "uaa", "\\", "\",", "\\\"", "externalId", "\\", "\":", "null", ",", "\\\"", "zoneId", "\\", "\":", "\\\"", "uaa", "\\", "\"}", ",\\", "\"", "credentials", "\\", "\":", "null", ",", "\\\"", "authorities", "\\", "\":", "[]", ",\\", "\"", "details", "\\", "\":", "null", ",", "\\\"", "authenticated", "\\", "\":", "true", ",", "\\\"", "name", "\\", "\":", "\\\"", "username", "\\", "\"}", "\";", "UaaAuthentication", "authentication2", "=", "JsonUtils", ".", "readValue", "(", "dataWithoutTime", ",", "UaaAuthentication", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "-", "1", ",", "authentication2", ".", "getAuthenticatedTime", "(", "))", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "12", ",", "6", "+", "12", ",", "8", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "login", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaAuthentication", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaAuthenticationDetails", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "InvalidPasswordException", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "springframework", ".", "security", ".", "authentication", ".", "BadCredentialsException", ";", "@", "@", "-", "26", ",", "6", "+", "28", ",", "9", "@", "@", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMethod", ".", "GET", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMethod", ".", "POST", ";", "@", "@", "-", "67", ",", "6", "+", "72", ",", "14", "@", "@", "public", "String", "changePassword", "(", "changePasswordService", ".", "changePassword", "(", "username", ",", "currentPassword", ",", "newPassword", ")", ";", "request", ".", "getSession", "(", ").", "invalidate", "(", ");", "request", ".", "getSession", "(", "true", ")", ";", "if", "(", "authentication", "instanceof", "UaaAuthentication", ")", "{", "UaaAuthentication", "uaaAuthentication", "=", "(", "UaaAuthentication", ")", "authentication", ";", "authentication", "=", "new", "UaaAuthentication", "(", "uaaAuthentication", ".", "getPrincipal", "(", "),", "new", "LinkedList", "<", ">(", "uaaAuthentication", ".", "getAuthorities", "(", "))", ",", "new", "UaaAuthenticationDetails", "(", "request", ")", ")", ";", "}", "securityContext", ".", "setAuthentication", "(", "authentication", ")", ";", "return", "\"", "redirect", ":", "profile", "\"", ";", "}", "catch", "(", "BadCredentialsException", "e", ")", "{", "@", "@", "-", "46", ",", "7", "+", "46", ",", "9", "@", "@", "import", "java", ".", "sql", ".", "SQLException", ";", "import", "java", ".", "sql", ".", "Timestamp", ";", "import", "java", ".", "sql", ".", "Types", ";", "import", "java", ".", "util", ".", "Calendar", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "66", ",", "7", "+", "68", ",", "7", "@", "@", "public", "static", "final", "String", "CREATE_USER_SQL", "=", "\"", "insert", "into", "users", "(", "\"", "+", "USER_FIELDS", "+", "\"", ",", "password", ")", "values", "(", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?,", "?)", "\";", "public", "static", "final", "String", "UPDATE_USER_SQL", "=", "\"", "update", "users", "set", "version", "=", "?,", "lastModified", "=", "?,", "userName", "=", "?,", "email", "=", "?,", "givenName", "=", "?,", "familyName", "=", "?,", "active", "=", "?,", "phoneNumber", "=", "?,", "verified", "=", "?,", "origin", "=", "?,", "external_id", "=", "?,", "salt", "=", "?,", "passwd_lastmodified", "=", "?", "where", "id", "=", "?", "and", "version", "=", "?\"", ";", "public", "static", "final", "String", "UPDATE_USER_SQL", "=", "\"", "update", "users", "set", "version", "=", "?,", "lastModified", "=", "?,", "userName", "=", "?,", "email", "=", "?,", "givenName", "=", "?,", "familyName", "=", "?,", "active", "=", "?,", "phoneNumber", "=", "?,", "verified", "=", "?,", "origin", "=", "?,", "external_id", "=", "?,", "salt", "=", "?", "where", "id", "=", "?", "and", "version", "=", "?\"", ";", "public", "static", "final", "String", "DEACTIVATE_USER_SQL", "=", "\"", "update", "users", "set", "active", "=", "?", "where", "id", "=", "?\"", ";", "@", "@", "-", "169", ",", "7", "+", "171", ",", "7", "@", "@", "public", "void", "setValues", "(", "PreparedStatement", "ps", ")", "throws", "SQLException", "{", "ps", ".", "setString", "(", "13", ",", "StringUtils", ".", "hasText", "(", "user", ".", "getExternalId", "(", "))", "?", "user", ".", "getExternalId", "(", "):", "null", ")", ";", "ps", ".", "setString", "(", "14", ",", "identityZoneId", ")", ";", "ps", ".", "setString", "(", "15", ",", "user", ".", "getSalt", "(", "))", ";", "ps", ".", "setTimestamp", "(", "16", ",", "t", ")", ";", "ps", ".", "setTimestamp", "(", "16", ",", "getPasswordLastModifiedTimestamp", "(", "t", ")", ");", "ps", ".", "setString", "(", "17", ",", "user", ".", "getPassword", "(", "))", ";", "}", "@", "@", "-", "185", ",", "6", "+", "187", ",", "12", "@", "@", "public", "void", "setValues", "(", "PreparedStatement", "ps", ")", "throws", "SQLException", "{", "return", "retrieve", "(", "id", ")", ";", "}", "protected", "Timestamp", "getPasswordLastModifiedTimestamp", "(", "Timestamp", "t", ")", "{", "Calendar", "cal", "=", "new", "GregorianCalendar", "(", ");", "cal", ".", "set", "(", "Calendar", ".", "MILLISECOND", ",", "0", ")", ";", "return", "new", "Timestamp", "(", "cal", ".", "getTimeInMillis", "(", "))", ";", "}", "@", "Override", "public", "ScimUser", "createUser", "(", "ScimUser", "user", ",", "final", "String", "password", ")", "throws", "InvalidPasswordException", ",", "InvalidScimResourceException", "{", "@", "@", "-", "232", ",", "7", "+", "240", ",", "6", "@", "@", "public", "void", "setValues", "(", "PreparedStatement", "ps", ")", "throws", "SQLException", "{", "ps", ".", "setString", "(", "pos", "+", "+,", "origin", ")", ";", "ps", ".", "setString", "(", "pos", "+", "+,", "StringUtils", ".", "hasText", "(", "user", ".", "getExternalId", "(", "))", "?", "user", ".", "getExternalId", "(", "):", "null", ")", ";", "ps", ".", "setString", "(", "pos", "+", "+,", "user", ".", "getSalt", "(", "))", ";", "ps", ".", "setTimestamp", "(", "pos", "+", "+,", "t", ")", ";", "ps", ".", "setString", "(", "pos", "+", "+,", "id", ")", ";", "ps", ".", "setInt", "(", "pos", "+", "+,", "user", ".", "getVersion", "(", "))", ";", "}", "@", "@", "-", "265", ",", "7", "+", "272", ",", "7", "@", "@", "public", "void", "setValues", "(", "PreparedStatement", "ps", ")", "throws", "SQLException", "{", "Timestamp", "t", "=", "new", "Timestamp", "(", "new", "Date", "(", ").", "getTime", "(", "))", ";", "ps", ".", "setTimestamp", "(", "1", ",", "t", ")", ";", "ps", ".", "setString", "(", "2", ",", "encNewPassword", ")", ";", "ps", ".", "setTimestamp", "(", "3", ",", "t", ")", ";", "ps", ".", "setTimestamp", "(", "3", ",", "getPasswordLastModifiedTimestamp", "(", "t", ")", ");", "ps", ".", "setString", "(", "4", ",", "id", ")", ";", "}", "}", ");", "@", "@", "-", "164", ",", "7", "+", "164", ",", "7", "@", "@", "public", "void", "canCreateUserInDefaultIdentityZone", "(", ")", "{", "assertEquals", "(", "\"", "uaa", "\"", ",", "map", ".", "get", "(", "\"", "identity_zone_id", "\"", "))", ";", "assertNull", "(", "user", ".", "getPasswordLastModified", "(", "))", ";", "assertNotNull", "(", "created", ".", "getPasswordLastModified", "(", "))", ";", "assertEquals", "(", "created", ".", "getMeta", "(", ").", "getCreated", "(", "),", "created", ".", "getPasswordLastModified", "(", "))", ";", "assertEquals", "(", "(", "created", ".", "getMeta", "(", ").", "getCreated", "(", ").", "getTime", "(", ")", "/", "1000l", ")", "*", "1000l", ",", "created", ".", "getPasswordLastModified", "(", ").", "getTime", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "174", ",", "13", "+", "174", ",", "13", "@", "@", "public", "void", "canModifyPassword", "(", ")", "throws", "Exception", "{", "ScimUser", "created", "=", "db", ".", "createUser", "(", "user", ",", "\"", "j7hyqpassX", "\"", ");", "assertNull", "(", "user", ".", "getPasswordLastModified", "(", "))", ";", "assertNotNull", "(", "created", ".", "getPasswordLastModified", "(", "))", ";", "assertEquals", "(", "created", ".", "getMeta", "(", ").", "getCreated", "(", "),", "created", ".", "getPasswordLastModified", "(", "))", ";", "assertEquals", "(", "(", "created", ".", "getMeta", "(", ").", "getCreated", "(", ").", "getTime", "(", ")", "/", "1000l", ")", "*", "1000l", ",", "created", ".", "getPasswordLastModified", "(", ").", "getTime", "(", "))", ";", "Thread", ".", "sleep", "(", "10", ")", ";", "db", ".", "changePassword", "(", "created", ".", "getId", "(", "),", "\"", "j7hyqpassX", "\"", ",", "\"", "j7hyqpassXXX", "\"", ");", "user", "=", "db", ".", "retrieve", "(", "created", ".", "getId", "(", "))", ";", "assertNotNull", "(", "user", ".", "getPasswordLastModified", "(", "))", ";", "assertEquals", "(", "user", ".", "getMeta", "(", ").", "getLastModified", "(", "),", "user", ".", "getPasswordLastModified", "(", "))", ";", "assertEquals", "(", "(", "user", ".", "getMeta", "(", ").", "getLastModified", "(", ").", "getTime", "(", ")", "/", "1000l", ")", "*", "1000l", ",", "user", ".", "getPasswordLastModified", "(", ").", "getTime", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "91", ",", "6", "+", "91", ",", "7", "@", "@", "<", "entry", "value", "-", "ref", "=", "\"", "identityZoneSwitchingFilter", "\"", "key", "=", "\"#", "{", "T", "(", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "web", ".", "SecurityFilterChainPostProcessor", ".", "FilterPosition", ")", ".", "after", "(", "@", "oauth2TokenParseFilter", ")", "}\"", "/>", "<", "entry", "value", "-", "ref", "=", "\"", "xFrameOptionsFilter", "\"", "key", "=", "\"#", "{", "T", "(", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "web", ".", "SecurityFilterChainPostProcessor", ".", "FilterPosition", ")", ".", "position", "(", "101", ")", "}\"", "/>", "<", "entry", "value", "-", "ref", "=", "\"", "sessionResetFilter", "\"", "key", "=", "\"#", "{", "T", "(", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "web", ".", "SecurityFilterChainPostProcessor", ".", "FilterPosition", ")", ".", "position", "(", "102", ")", "}\"", "/>", "<", "/", "map", ">", "<", "/", "property", ">", "<", "/", "bean", ">", "@", "@", "-", "107", ",", "6", "+", "108", ",", "14", "@", "@", "<", "property", "name", "=", "\"", "additionalInternalHostnames", "\"", "value", "=", "\"#", "{@", "config", "[", "'", "zones", "'", "]=", "=", "null", "?", "null", ":", "@", "config", "[", "'", "zones", "'", "][", "'", "internal", "'", "]=", "=", "null", "?", "null", ":", "@", "config", "[", "'", "zones", "'", "][", "'", "internal", "'", "][", "'", "hostnames", "'", "]}", "\"/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "sessionResetFilter", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "SessionResetFilter", "\"", ">", "<", "constructor", "-", "arg", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "DefaultRedirectStrategy", "\"", "/>", "<", "/", "constructor", "-", "arg", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "login", "\"", "/>", "<", "constructor", "-", "arg", "ref", "=", "\"", "userDatabase", "\"", "/>", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "identityZoneSwitchingFilter", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneSwitchingFilter", "\"", "/>", "<", "bean", "id", "=", "\"", "uaaUrl", "\"", "class", "=", "\"", "java", ".", "lang", ".", "String", "\"", ">", "@", "@", "-", "12", ",", "15", "+", "12", ",", "7", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "feature", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "com", ".", "dumbster", ".", "smtp", ".", "SimpleSmtpServer", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "35", ",", "6", "+", "27", ",", "13", "@", "@", "import", "org", ".", "springframework", ".", "test", ".", "context", ".", "junit4", ".", "SpringJUnit4ClassRunner", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestTemplate", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "@", "RunWith", "(", "SpringJUnit4ClassRunner", ".", "class", ")", "@", "ContextConfiguration", "(", "classes", "=", "DefaultIntegrationTestConfig", ".", "class", ")", "public", "class", "ChangePasswordIT", "{", "@", "@", "-", "32", ",", "8", "+", "32", ",", "10", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotSame", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "APPLICATION_JSON", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "TEXT_HTML", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "TEXT_HTML_VALUE", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "SecurityMockMvcRequestPostProcessors", ".", "csrf", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "get", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "post", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "put", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "jsonPath", ";", "@", "@", "-", "144", ",", "6", "+", "146", ",", "63", "@", "@", "public", "void", "changePassword_Resets_Session", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "public", "void", "changePassword_Resets_All_Sessions", "(", ")", "throws", "Exception", "{", "ScimUser", "user", "=", "createUser", "(", ");", "MockHttpSession", "session", "=", "new", "MockHttpSession", "(", ");", "MockHttpSession", "afterLoginSessionA", "=", "(", "MockHttpSession", ")", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "login", ".", "do", "\"", ")", ".", "session", "(", "session", ")", ".", "accept", "(", "TEXT_HTML_VALUE", ")", ".", "param", "(", "\"", "username", "\"", ",", "user", ".", "getUserName", "(", "))", ".", "param", "(", "\"", "password", "\"", ",", "\"", "secr3T", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "\")", ")", ".", "andReturn", "(", ").", "getRequest", "(", ").", "getSession", "(", "false", ")", ";", "session", "=", "new", "MockHttpSession", "(", ");", "MockHttpSession", "afterLoginSessionB", "=", "(", "MockHttpSession", ")", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "login", ".", "do", "\"", ")", ".", "session", "(", "session", ")", ".", "accept", "(", "TEXT_HTML_VALUE", ")", ".", "param", "(", "\"", "username", "\"", ",", "user", ".", "getUserName", "(", "))", ".", "param", "(", "\"", "password", "\"", ",", "\"", "secr3T", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "\")", ")", ".", "andReturn", "(", ").", "getRequest", "(", ").", "getSession", "(", "false", ")", ";", "assertNotNull", "(", "afterLoginSessionA", ".", "getAttribute", "(", "HttpSessionSecurityContextRepository", ".", "SPRING_SECURITY_CONTEXT_KEY", ")", ");", "assertNotNull", "(", "afterLoginSessionB", ".", "getAttribute", "(", "HttpSessionSecurityContextRepository", ".", "SPRING_SECURITY_CONTEXT_KEY", ")", ");", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "profile", "\"", ").", "session", "(", "afterLoginSessionB", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", "Thread", ".", "sleep", "(", "1000", "-", "(", "System", ".", "currentTimeMillis", "(", ")", "%", "1000", ")", "+", "1", ")", ";", "MockHttpSession", "afterPasswordChange", "=", "(", "MockHttpSession", ")", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "change_password", ".", "do", "\"", ")", ".", "session", "(", "afterLoginSessionA", ")", ".", "with", "(", "csrf", "(", "))", ".", "accept", "(", "TEXT_HTML_VALUE", ")", ".", "param", "(", "\"", "current_password", "\"", ",", "\"", "secr3T", "\"", ")", ".", "param", "(", "\"", "new_password", "\"", ",", "\"", "secr3T1", "\"", ")", ".", "param", "(", "\"", "confirm_password", "\"", ",", "\"", "secr3T1", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"", "profile", "\"", "))", ".", "andReturn", "(", ").", "getRequest", "(", ").", "getSession", "(", "false", ")", ";", "assertTrue", "(", "afterLoginSessionA", ".", "isInvalid", "(", "))", ";", "assertNotNull", "(", "afterPasswordChange", ")", ";", "assertNotNull", "(", "afterPasswordChange", ".", "getAttribute", "(", "HttpSessionSecurityContextRepository", ".", "SPRING_SECURITY_CONTEXT_KEY", ")", ");", "assertNotSame", "(", "afterLoginSessionA", ",", "afterPasswordChange", ")", ";", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "profile", "\"", ")", ".", "session", "(", "afterLoginSessionB", ")", ".", "accept", "(", "TEXT_HTML", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "\"", "))", ";", "}", "private", "ScimUser", "createUser", "(", ")", "throws", "Exception", "{", "String", "id", "=", "generator", ".", "generate", "(", ");", "ScimUser", "user", "=", "new", "ScimUser", "(", "id", ",", "id", "+", "\"", "user", "@", "example", ".", "com", "\"", ",", "\"", "name", "\"", ",", "\"", "familyname", "\"", ");"], "docstring_tokens": ["by", "leveraging", "failure", "to", "expire", "existing", "sessions", "."]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/296"], "code_tokens": ["@", "@", "-", "5866", ",", "7", "+", "5866", ",", "7", "@", "@", "MagickExport", "Image", "*", "WaveletDenoiseImage", "(", "const", "Image", "*", "image", ",", "ThrowImageException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ");", "pixels_info", "=", "AcquireVirtualMemory", "(", "3", "*", "image", "-", ">", "columns", ",", "image", "-", ">", "rows", "*", "sizeof", "(", "*", "pixels", ")", ");", "kernel", "=", "(", "float", "*", ")", "AcquireQuantumMemory", "(", "MagickMax", "(", "image", "-", ">", "rows", ",", "image", "-", ">", "columns", ")", ",", "kernel", "=", "(", "float", "*", ")", "AcquireQuantumMemory", "(", "MagickMax", "(", "image", "-", ">", "rows", ",", "image", "-", ">", "columns", ")", "+", "1", ",", "GetOpenMPMaximumThreads", "(", ")*", "sizeof", "(", "*", "kernel", ")", ");", "if", "(", "(", "pixels_info", "=", "=", "(", "MemoryInfo", "*", ")", "NULL", ")", "|", "|", "(", "kernel", "=", "=", "(", "float", "*", ")", "NULL", ")", ")", "{", "@", "@", "-", "483", ",", "7", "+", "483", ",", "7", "@", "@", "print", "\"", "WaveletDenoise", ".", "..", "\\", "n", "\"", ";", "$", "example", "=", "$", "model", "-", ">", "Clone", "(", ");", "$", "example", "-", ">", "Label", "(", "'", "WaveletDenoise", "'", ");", "$", "example", "-", ">", "Label", "(", "'", "Wavelet", "Denoise", "'", ");", "$", "example", "-", ">", "WaveletDenoise", "(", "'", "5", "%", "')", ";", "push", "(", "@$", "images", ",", "$", "example", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "crafted", "file"]}
{"contents": ["KVM:", "x86:", "fix", "information", "leak", "to", "userland", "Structures", "kvm_vcpu_events,", "kvm_debugregs,", "kvm_pit_state2", "and", "kvm_clock_data", "are", "copied", "to", "userland", "with", "some", "padding", "and", "reserved", "fields", "unitialized.", "It", "leads", "to", "leaking", "of", "contents", "of", "kernel", "stack", "memory.", "We", "have", "to", "initialize", "them", "to", "zero.", "In", "patch", "v1", "Jan", "Kiszka", "suggested", "to", "fill", "reserved", "fields", "with", "zeros", "instead", "of", "memset'ting", "the", "whole", "struct.", "It", "makes", "sense", "as", "these", "fields", "are", "explicitly", "marked", "as", "padding.", "No", "more", "fields", "need", "zeroing.", "KVM-Stable-Tag.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segooon@gmail.com>", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>"], "code_tokens": ["@", "@", "-", "2560", ",", "6", "+", "2560", ",", "7", "@", "@", "static", "void", "kvm_vcpu_ioctl_x86_get_vcpu_events", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "!", "kvm_exception_is_soft", "(", "vcpu", "-", ">", "arch", ".", "exception", ".", "nr", ")", ";", "events", "-", ">", "exception", ".", "nr", "=", "vcpu", "-", ">", "arch", ".", "exception", ".", "nr", ";", "events", "-", ">", "exception", ".", "has_error_code", "=", "vcpu", "-", ">", "arch", ".", "exception", ".", "has_error_code", ";", "events", "-", ">", "exception", ".", "pad", "=", "0", ";", "events", "-", ">", "exception", ".", "error_code", "=", "vcpu", "-", ">", "arch", ".", "exception", ".", "error_code", ";", "events", "-", ">", "interrupt", ".", "injected", "=", "@", "@", "-", "2573", ",", "12", "+", "2574", ",", "14", "@", "@", "static", "void", "kvm_vcpu_ioctl_x86_get_vcpu_events", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "events", "-", ">", "nmi", ".", "injected", "=", "vcpu", "-", ">", "arch", ".", "nmi_injected", ";", "events", "-", ">", "nmi", ".", "pending", "=", "vcpu", "-", ">", "arch", ".", "nmi_pending", ";", "events", "-", ">", "nmi", ".", "masked", "=", "kvm_x86_ops", "-", ">", "get_nmi_mask", "(", "vcpu", ")", ";", "events", "-", ">", "nmi", ".", "pad", "=", "0", ";", "events", "-", ">", "sipi_vector", "=", "vcpu", "-", ">", "arch", ".", "sipi_vector", ";", "events", "-", ">", "flags", "=", "(", "KVM_VCPUEVENT_VALID_NMI_PENDING", "|", "KVM_VCPUEVENT_VALID_SIPI_VECTOR", "|", "KVM_VCPUEVENT_VALID_SHADOW", ")", ";", "memset", "(", "&", "events", "-", ">", "reserved", ",", "0", ",", "sizeof", "(", "events", "-", ">", "reserved", ")", ");", "}", "static", "int", "kvm_vcpu_ioctl_x86_set_vcpu_events", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "@", "@", "-", "2623", ",", "6", "+", "2626", ",", "7", "@", "@", "static", "void", "kvm_vcpu_ioctl_x86_get_debugregs", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "dbgregs", "-", ">", "dr6", "=", "vcpu", "-", ">", "arch", ".", "dr6", ";", "dbgregs", "-", ">", "dr7", "=", "vcpu", "-", ">", "arch", ".", "dr7", ";", "dbgregs", "-", ">", "flags", "=", "0", ";", "memset", "(", "&", "dbgregs", "-", ">", "reserved", ",", "0", ",", "sizeof", "(", "dbgregs", "-", ">", "reserved", ")", ");", "}", "static", "int", "kvm_vcpu_ioctl_x86_set_debugregs", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "@", "@", "-", "3106", ",", "6", "+", "3110", ",", "7", "@", "@", "static", "int", "kvm_vm_ioctl_get_pit2", "(", "struct", "kvm", "*", "kvm", ",", "struct", "kvm_pit_state2", "*", "ps", ")", "sizeof", "(", "ps", "-", ">", "channels", ")", ");", "ps", "-", ">", "flags", "=", "kvm", "-", ">", "arch", ".", "vpit", "-", ">", "pit_state", ".", "flags", ";", "mutex_unlock", "(", "&", "kvm", "-", ">", "arch", ".", "vpit", "-", ">", "pit_state", ".", "lock", ")", ";", "memset", "(", "&", "ps", "-", ">", "reserved", ",", "0", ",", "sizeof", "(", "ps", "-", ">", "reserved", ")", ");", "return", "r", ";", "}", "@", "@", "-", "3486", ",", "6", "+", "3491", ",", "7", "@", "@", "long", "kvm_arch_vm_ioctl", "(", "struct", "file", "*", "filp", ",", "user_ns", ".", "clock", "=", "kvm", "-", ">", "arch", ".", "kvmclock_offset", "+", "now_ns", ";", "local_irq_enable", "(", ");", "user_ns", ".", "flags", "=", "0", ";", "memset", "(", "&", "user_ns", ".", "pad", ",", "0", ",", "sizeof", "(", "user_ns", ".", "pad", ")", ");", "r", "=", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "argp", ",", "&", "user_ns", ",", "sizeof", "(", "user_ns", ")", "))"], "docstring_tokens": ["via", "unspecified", "vectors", "."]}
{"contents": ["unix:", "properly", "account", "for", "FDs", "passed", "over", "unix", "sockets", "It", "is", "possible", "for", "a", "process", "to", "allocate", "and", "accumulate", "far", "more", "FDs", "than", "the", "process'", "limit", "by", "sending", "them", "over", "a", "unix", "socket", "then", "closing", "them", "to", "keep", "the", "process'", "fd", "count", "low.", "This", "change", "addresses", "this", "problem", "by", "keeping", "track", "of", "the", "number", "of", "FDs", "in", "flight", "per", "user", "and", "preventing", "non-privileged", "processes", "from", "having", "more", "FDs", "in", "flight", "than", "their", "configured", "FD", "limit.", "Reported-by:", "socketpair@gmail.com", "Reported-by:", "Tetsuo", "Handa", "<penguin-kernel@I-love.SAKURA.ne.jp>", "Mitigates:", "(Linux", "2.0+)", "Suggested-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Acked-by:", "Hannes", "Frederic", "Sowa", "<hannes@stressinduktion.org>", "Signed-off-by:", "Willy", "Tarreau", "<w@1wt.eu>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "830", ",", "6", "+", "830", ",", "7", "@", "@", "struct", "user_struct", "{", "unsigned", "long", "mq_bytes", ";", "/", "*", "How", "many", "bytes", "can", "be", "allocated", "to", "mqueue", "?", "*", "/", "#", "endif", "unsigned", "long", "locked_shm", ";", "/", "*", "How", "many", "pages", "of", "mlocked", "shm", "?", "*", "/", "unsigned", "long", "unix_inflight", ";", "/", "*", "How", "many", "files", "in", "flight", "in", "unix", "sockets", "*", "/", "#", "ifdef", "CONFIG_KEYS", "struct", "key", "*", "uid_keyring", ";", "/", "*", "UID", "specific", "keyring", "*", "/", "@", "@", "-", "1513", ",", "6", "+", "1513", ",", "21", "@", "@", "static", "void", "unix_destruct_scm", "(", "struct", "sk_buff", "*", "skb", ")", "sock_wfree", "(", "skb", ")", ";", "}", "/", "*", "*", "The", "\"", "user", "-", ">", "unix_inflight", "\"", "variable", "is", "protected", "by", "the", "garbage", "*", "collection", "lock", ",", "and", "we", "just", "read", "it", "locklessly", "here", ".", "If", "you", "go", "*", "over", "the", "limit", ",", "there", "might", "be", "a", "tiny", "race", "in", "actually", "noticing", "*", "it", "across", "threads", ".", "Tough", ".", "*", "/", "static", "inline", "bool", "too_many_unix_fds", "(", "struct", "task_struct", "*", "p", ")", "{", "struct", "user_struct", "*", "user", "=", "current_user", "(", ");", "if", "(", "unlikely", "(", "user", "-", ">", "unix_inflight", ">", "task_rlimit", "(", "p", ",", "RLIMIT_NOFILE", ")", "))", "return", "!", "capable", "(", "CAP_SYS_RESOURCE", ")", "&", "&", "!", "capable", "(", "CAP_SYS_ADMIN", ")", ";", "return", "false", ";", "}", "#", "define", "MAX_RECURSION_LEVEL", "4", "static", "int", "unix_attach_fds", "(", "struct", "scm_cookie", "*", "scm", ",", "struct", "sk_buff", "*", "skb", ")", "@", "@", "-", "1521", ",", "6", "+", "1536", ",", "9", "@", "@", "static", "int", "unix_attach_fds", "(", "struct", "scm_cookie", "*", "scm", ",", "struct", "sk_buff", "*", "skb", ")", "unsigned", "char", "max_level", "=", "0", ";", "int", "unix_sock_count", "=", "0", ";", "if", "(", "too_many_unix_fds", "(", "current", ")", ")", "return", "-", "ETOOMANYREFS", ";", "for", "(", "i", "=", "scm", "-", ">", "fp", "-", ">", "count", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "{", "struct", "sock", "*", "sk", "=", "unix_get_socket", "(", "scm", "-", ">", "fp", "-", ">", "fp", "[", "i", "]", ");", "@", "@", "-", "1542", ",", "10", "+", "1560", ",", "8", "@", "@", "static", "int", "unix_attach_fds", "(", "struct", "scm_cookie", "*", "scm", ",", "struct", "sk_buff", "*", "skb", ")", "if", "(", "!", "UNIXCB", "(", "skb", ")", ".", "fp", ")", "return", "-", "ENOMEM", ";", "if", "(", "unix_sock_count", ")", "{", "for", "(", "i", "=", "scm", "-", ">", "fp", "-", ">", "count", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "unix_inflight", "(", "scm", "-", ">", "fp", "-", ">", "fp", "[", "i", "]", ");", "}", "for", "(", "i", "=", "scm", "-", ">", "fp", "-", ">", "count", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "unix_inflight", "(", "scm", "-", ">", "fp", "-", ">", "fp", "[", "i", "]", ");", "return", "max_level", ";", "}", "@", "@", "-", "120", ",", "37", "+", "120", ",", "40", "@", "@", "void", "unix_inflight", "(", "struct", "file", "*", "fp", ")", "{", "struct", "sock", "*", "s", "=", "unix_get_socket", "(", "fp", ")", ";", "spin_lock", "(", "&", "unix_gc_lock", ")", ";", "if", "(", "s", ")", "{", "struct", "unix_sock", "*", "u", "=", "unix_sk", "(", "s", ")", ";", "spin_lock", "(", "&", "unix_gc_lock", ")", ";", "if", "(", "atomic_long_inc_return", "(", "&", "u", "-", ">", "inflight", ")", "=", "=", "1", ")", "{", "BUG_ON", "(", "!", "list_empty", "(", "&", "u", "-", ">", "link", ")", ");", "list_add_tail", "(", "&", "u", "-", ">", "link", ",", "&", "gc_inflight_list", ")", ";", "}", "else", "{", "BUG_ON", "(", "list_empty", "(", "&", "u", "-", ">", "link", ")", ");", "}", "unix_tot_inflight", "+", "+;", "spin_unlock", "(", "&", "unix_gc_lock", ")", ";", "}", "fp", "-", ">", "f_cred", "-", ">", "user", "-", ">", "unix_inflight", "+", "+;", "spin_unlock", "(", "&", "unix_gc_lock", ")", ";", "}", "void", "unix_notinflight", "(", "struct", "file", "*", "fp", ")", "{", "struct", "sock", "*", "s", "=", "unix_get_socket", "(", "fp", ")", ";", "spin_lock", "(", "&", "unix_gc_lock", ")", ";", "if", "(", "s", ")", "{", "struct", "unix_sock", "*", "u", "=", "unix_sk", "(", "s", ")", ";", "spin_lock", "(", "&", "unix_gc_lock", ")", ";", "BUG_ON", "(", "list_empty", "(", "&", "u", "-", ">", "link", ")", ");", "if", "(", "atomic_long_dec_and_test", "(", "&", "u", "-", ">", "inflight", ")", ")", "list_del_init", "(", "&", "u", "-", ">", "link", ")", ";", "unix_tot_inflight", "-", "-;", "spin_unlock", "(", "&", "unix_gc_lock", ")", ";", "}", "fp", "-", ">", "f_cred", "-", ">", "user", "-", ">", "unix_inflight", "-", "-;", "spin_unlock", "(", "&", "unix_gc_lock", ")", ";", "}", "static", "void", "scan_inflight", "(", "struct", "sock", "*", "x", ",", "void", "(", "*", "func", ")", "(", "struct", "unix_sock", "*", "),"], "docstring_tokens": ["by", "sending", "each", "descriptor", "over", "a", "UNIX", "socket", "before", "closing", "it"]}
{"contents": ["mac80211:", "accept", "key", "reinstall", "without", "changing", "anything", "When", "a", "key", "is", "reinstalled", "we", "can", "reset", "the", "replay", "counters", "etc.", "which", "can", "lead", "to", "nonce", "reuse", "and/or", "replay", "detection", "being", "impossible,", "breaking", "security", "properties,", "as", "described", "in", "the", "\"KRACK", "attacks\".", "In", "particular,", "applies", "to", "GTK", "rekeying", "that", "happened", "in", "firmware", "while", "the", "host", "is", "in", "D3,", "with", "the", "second", "part", "of", "the", "attack", "being", "done", "after", "the", "host", "wakes", "up.", "In", "this", "case,", "the", "wpa_supplicant", "mitigation", "isn't", "sufficient", "since", "wpa_supplicant", "doesn't", "know", "the", "GTK", "material.", "In", "case", "this", "happens,", "simply", "silently", "accept", "the", "new", "key", "coming", "from", "userspace", "but", "don't", "take", "any", "action", "on", "it", "since", "it's", "the", "same", "key;", "this", "keeps", "the", "PN", "replay", "counters", "intact.", "Signed-off-by:", "Johannes", "Berg", "<johannes.berg@intel.com>"], "code_tokens": ["@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "*", "Copyright", "2006", "-", "2007", "Jiri", "Benc", "<", "jbenc", "@", "suse", ".", "cz", ">", "*", "Copyright", "2007", "-", "2008", "Johannes", "Berg", "<", "johannes", "@", "sipsolutions", ".", "net", ">", "*", "Copyright", "2013", "-", "2014", "Intel", "Mobile", "Communications", "GmbH", "*", "Copyright", "2015", "Intel", "Deutschland", "GmbH", "*", "Copyright", "2015", "-", "2017", "Intel", "Deutschland", "GmbH", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "version", "2", "as", "@", "@", "-", "620", ",", "9", "+", "620", ",", "6", "@", "@", "int", "ieee80211_key_link", "(", "struct", "ieee80211_key", "*", "key", ",", "pairwise", "=", "key", "-", ">", "conf", ".", "flags", "&", "IEEE80211_KEY_FLAG_PAIRWISE", ";", "idx", "=", "key", "-", ">", "conf", ".", "keyidx", ";", "key", "-", ">", "local", "=", "sdata", "-", ">", "local", ";", "key", "-", ">", "sdata", "=", "sdata", ";", "key", "-", ">", "sta", "=", "sta", ";", "mutex_lock", "(", "&", "sdata", "-", ">", "local", "-", ">", "key_mtx", ")", ";", "@", "@", "-", "633", ",", "6", "+", "630", ",", "21", "@", "@", "int", "ieee80211_key_link", "(", "struct", "ieee80211_key", "*", "key", ",", "else", "old_key", "=", "key_mtx_dereference", "(", "sdata", "-", ">", "local", ",", "sdata", "-", ">", "keys", "[", "idx", "]", ");", "/", "*", "*", "Silently", "accept", "key", "re", "-", "installation", "without", "really", "installing", "the", "*", "new", "version", "of", "the", "key", "to", "avoid", "nonce", "reuse", "or", "replay", "issues", ".", "*", "/", "if", "(", "old_key", "&", "&", "key", "-", ">", "conf", ".", "keylen", "=", "=", "old_key", "-", ">", "conf", ".", "keylen", "&", "&", "!", "memcmp", "(", "key", "-", ">", "conf", ".", "key", ",", "old_key", "-", ">", "conf", ".", "key", ",", "key", "-", ">", "conf", ".", "keylen", ")", ")", "{", "ieee80211_key_free_unused", "(", "key", ")", ";", "ret", "=", "0", ";", "goto", "out", ";", "}", "key", "-", ">", "local", "=", "sdata", "-", ">", "local", ";", "key", "-", ">", "sdata", "=", "sdata", ";", "key", "-", ">", "sta", "=", "sta", ";", "increment_tailroom_need_count", "(", "sdata", ")", ";", "ieee80211_key_replace", "(", "sdata", ",", "sta", ",", "pairwise", ",", "old_key", ",", "key", ")", ";", "@", "@", "-", "648", ",", "6", "+", "660", ",", "7", "@", "@", "int", "ieee80211_key_link", "(", "struct", "ieee80211_key", "*", "key", ",", "ret", "=", "0", ";", "}", "out", ":", "mutex_unlock", "(", "&", "sdata", "-", ">", "local", "-", ">", "key_mtx", ")", ";", "return", "ret", ";"], "docstring_tokens": ["establishing", "a", "man-in-the-middle", "position", "between", "supplicant", "and", "authenticator"]}
{"contents": ["Merge", "branch", "'feature/token_self_revocation'", "into", "prerelease/3.20.x", "[#152093534]", "https://www.pivotaltracker.com/story/show/152093534", "[#152164926]", "https://www.pivotaltracker.com/story/show/152164926"], "code_tokens": ["@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimResourceNotFoundException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "MultitenantJdbcClientDetailsService", ";", "import", "org", ".", "springframework", ".", "dao", ".", "EmptyResultDataAccessException", ";", "import", "org", ".", "springframework", ".", "http", ".", "ResponseEntity", ";", "@", "@", "-", "75", ",", "10", "+", "76", ",", "12", "@", "@", "public", "TokenRevocationEndpoint", "(", "MultitenantJdbcClientDetailsService", "clientDetails", "@", "RequestMapping", "(", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "{", "clientId", "}", "\")", "public", "ResponseEntity", "<", "Void", ">", "revokeTokensForClient", "(", "@", "PathVariable", "String", "clientId", ")", "{", "logger", ".", "debug", "(", "\"", "Revoking", "tokens", "for", "client", ":", "\"", "+", "clientId", ")", ";", "String", "zoneId", "=", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", ");", "BaseClientDetails", "client", "=", "(", "BaseClientDetails", ")", "clientDetailsService", ".", "loadClientByClientId", "(", "clientId", ")", ";", "client", ".", "addAdditionalInformation", "(", "ClientConstants", ".", "TOKEN_SALT", ",", "generator", ".", "generate", "(", "))", ";", "clientDetailsService", ".", "updateClientDetails", "(", "client", ")", ";", "logger", ".", "debug", "(", "\"", "Tokens", "revoked", "for", "client", ":", "\"", "+", "clientId", ")", ";", "tokenProvisioning", ".", "deleteByClient", "(", "clientId", ",", "zoneId", ")", ";", "return", "new", "ResponseEntity", "<", ">(", "OK", ")", ";", "}", "@", "@", "-", "46", ",", "6", "+", "46", ",", "7", "@", "@", "protected", "final", "static", "String", "DELETE_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "token_id", "=", "?", "and", "identity_zone_id", "=", "?\"", ";", "protected", "final", "static", "String", "DELETE_EXPIRED_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "expires_at", "<", "?", "\";", "protected", "final", "static", "String", "DELETE_REFRESH_TOKEN_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "user_id", "=", "?", "AND", "client_id", "=", "?", "AND", "response_type", "=", "'\"", "+", "REFRESH_TOKEN_RESPONSE_TYPE", "+", "\"", "'", "AND", "identity_zone_id", "=", "?\"", ";", "protected", "final", "static", "String", "DELETE_BY_CLIENT_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "identity_zone_id", "=", "?", "and", "client_id", "=", "?\"", ";", "protected", "final", "static", "String", "DELETE_BY_ZONE_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "identity_zone_id", "=", "?\"", ";", "@", "@", "-", "56", ",", "7", "+", "57", ",", "7", "@", "@", "protected", "AtomicLong", "lastExpiredCheck", "=", "new", "AtomicLong", "(", "0", ")", ";", "protected", "long", "expirationCheckInterval", "=", "30000", ";", "/", "/", "30", "seconds", "protected", "JdbcRevocableTokenProvisioning", "(", "JdbcTemplate", "jdbcTemplate", ")", "{", "public", "JdbcRevocableTokenProvisioning", "(", "JdbcTemplate", "jdbcTemplate", ")", "{", "this", ".", "rowMapper", "=", "new", "RevocableTokenRowMapper", "(", ");", "this", ".", "template", "=", "jdbcTemplate", ";", "}", "@", "@", "-", "136", ",", "6", "+", "137", ",", "11", "@", "@", "public", "RevocableToken", "delete", "(", "String", "id", ",", "int", "version", ")", "{", "return", "previous", ";", "}", "@", "Override", "public", "int", "deleteByClient", "(", "String", "clientId", ",", "String", "zoneId", ")", "{", "return", "template", ".", "update", "(", "DELETE_BY_CLIENT_QUERY", ",", "zoneId", ",", "clientId", ")", ";", "}", "@", "Override", "public", "int", "deleteByIdentityZone", "(", "String", "zoneId", ")", "{", "return", "template", ".", "update", "(", "DELETE_BY_ZONE_QUERY", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "@", "@", "-", "26", ",", "6", "+", "26", ",", "6", "@", "@", "List", "<", "RevocableToken", ">", "getClientTokens", "(", "String", "clientId", ")", ";", "int", "deleteByClient", "(", "String", "clientId", ",", "String", "zoneId", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "121", "@", "@", "/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Cloud", "Foundry", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2017", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaAuthentication", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaAuthenticationDetails", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaPrincipal", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "JdbcRevocableTokenProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "RevocableToken", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "jdbc", ".", "JdbcPagingListFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "jdbc", ".", "JdbcScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "JdbcTestBase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "MultitenantJdbcClientDetailsService", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationEventPublisher", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "context", ".", "SecurityContextHolder", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetails", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "OAuth2Request", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "client", ".", "BaseClientDetails", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ".", "TOKEN_SALT", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "spy", ";", "public", "class", "TokenRevocationEndpointTests", "extends", "JdbcTestBase", "{", "private", "TokenRevocationEndpoint", "endpoint", ";", "private", "RandomValueStringGenerator", "generator", ";", "private", "BaseClientDetails", "client", ";", "private", "ApplicationEventPublisher", "publisher", ";", "private", "MultitenantJdbcClientDetailsService", "clientService", ";", "@", "Before", "public", "void", "setupForTokenRevocation", "(", ")", "throws", "Exception", "{", "String", "zoneId", "=", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", ");", "generator", "=", "new", "RandomValueStringGenerator", "(", ");", "String", "clientId", "=", "generator", ".", "generate", "(", ").", "toLowerCase", "(", ");", "client", "=", "new", "BaseClientDetails", "(", "clientId", ",", "\"", "\",", "\"", "some", ".", "scopes", "\"", ",", "\"", "client_credentials", "\"", ",", "\"", "authorities", "\"", ");", "client", ".", "addAdditionalInformation", "(", "TOKEN_SALT", ",", "\"", "pre", "-", "salt", "\"", ");", "clientService", "=", "spy", "(", "new", "MultitenantJdbcClientDetailsService", "(", "dataSource", ")", ");", "clientService", ".", "addClientDetails", "(", "client", ")", ";", "ScimUserProvisioning", "userProvisioning", "=", "new", "JdbcScimUserProvisioning", "(", "jdbcTemplate", ",", "new", "JdbcPagingListFactory", "(", "jdbcTemplate", ",", "limitSqlAdapter", ")", ")", ";", "JdbcRevocableTokenProvisioning", "provisioning", "=", "spy", "(", "new", "JdbcRevocableTokenProvisioning", "(", "jdbcTemplate", ")", ");", "endpoint", "=", "spy", "(", "new", "TokenRevocationEndpoint", "(", "clientService", ",", "userProvisioning", ",", "provisioning", ")", ");", "publisher", "=", "mock", "(", "ApplicationEventPublisher", ".", "class", ")", ";", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "new", "UaaOauth2Authentication", "(", "\"", "token", "-", "value", "\"", ",", "zoneId", ",", "mock", "(", "OAuth2Request", ".", "class", ")", ",", "new", "UaaAuthentication", "(", "new", "UaaPrincipal", "(", "\"", "id", "\"", ",", "\"", "username", "\"", ",", "\"", "username", "@", "test", ".", "com", "\"", ",", "OriginKeys", ".", "UAA", ",", "\"", "\",", "zoneId", ")", ",", "Collections", ".", "emptyList", "(", "),", "mock", "(", "UaaAuthenticationDetails", ".", "class", ")", ")", ")", ")", ";", "provisioning", ".", "create", "(", "new", "RevocableToken", "(", ")", ".", "setClientId", "(", "client", ".", "getClientId", "(", "))", ".", "setTokenId", "(", "\"", "token", "-", "id", "\"", ")", ".", "setUserId", "(", "null", ")", ".", "setResponseType", "(", "RevocableToken", ".", "TokenType", ".", "ACCESS_TOKEN", ")", ".", "setValue", "(", "\"", "value", "\"", ")", ".", "setIssuedAt", "(", "System", ".", "currentTimeMillis", "(", "))", ")", ";", "}", "@", "After", "public", "void", "cleanup", "(", ")", "throws", "Exception", "{", "SecurityContextHolder", ".", "clearContext", "(", ");", "IdentityZoneHolder", ".", "clear", "(", ");", "}", "@", "Test", "public", "void", "revokeTokensForClient", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "pre", "-", "salt", "\"", ",", "getClient", "(", ").", "getAdditionalInformation", "(", ").", "get", "(", "TOKEN_SALT", ")", ");", "assertEquals", "(", "1", ",", "clientTokenCount", "(", "))", ";", "endpoint", ".", "revokeTokensForClient", "(", "client", ".", "getClientId", "(", "))", ";", "assertNotEquals", "(", "\"", "pre", "-", "salt", "\"", ",", "getClient", "(", ").", "getAdditionalInformation", "(", ").", "get", "(", "TOKEN_SALT", ")", ");", "assertEquals", "(", "0", ",", "clientTokenCount", "(", "))", ";", "}", "public", "ClientDetails", "getClient", "(", ")", "{", "return", "clientService", ".", "loadClientByClientId", "(", "client", ".", "getClientId", "(", "))", ";", "}", "public", "int", "clientTokenCount", "(", ")", "{", "return", "jdbcTemplate", ".", "queryForObject", "(", "\"", "select", "count", "(", "*)", "from", "revocable_tokens", "where", "client_id", "=", "?", "\",", "Integer", ".", "class", ",", "client", ".", "getClientId", "(", "))", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "69", ",", "7", "+", "69", ",", "7", "@", "@", "authentication", "-", "manager", "-", "ref", "=", "\"", "emptyAuthenticationManager", "\"", "entry", "-", "point", "-", "ref", "=", "\"", "oauthAuthenticationEntryPoint", "\"", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "security", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "uaa", ".", "admin", "'", ")", "or", "@", "self", ".", "isClientTokenRevocationForSelf", "(", "request", ",", "4", ")", "\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "tokens", ".", "revoke", "'", ")\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "user", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "uaa", ".", "admin", "'", ")", "or", "(", "#", "oauth2", ".", "hasScope", "(", "'", "tokens", ".", "revoke", "'", ")", "and", "@", "self", ".", "isUserTokenRevocationForSelf", "(", "request", ",", "4", ")", ")\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "tokens", ".", "revoke", "'", ")", "or", "@", "self", ".", "isTokenRevocationForSelf", "(", "request", ",", "3", ")", "\"", "method", "=", "\"", "DELETE", "\"", "/>", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"", "denyAll", "\"", "/", ">", "@", "@", "-", "692", ",", "7", "+", "692", ",", "7", "@", "@", "public", "void", "revokeAllTokens_forAClient", "(", ")", "throws", "Exception", "{", "true", ")", ";", "Snippet", "requestHeaders", "=", "requestHeaders", "(", "headerWithName", "(", "\"", "Authorization", "\"", ").", "description", "(", "\"", "Bearer", "token", "with", "uaa", ".", "admin", "or", "tokens", ".", "revoke", "scope", ".", "Any", "token", "with", "the", "matching", "client_id", "may", "also", "be", "used", "for", "self", "revocation", ".", "\")", ",", "headerWithName", "(", "\"", "Authorization", "\"", ").", "description", "(", "\"", "Bearer", "token", "with", "uaa", ".", "admin", "or", "tokens", ".", "revoke", "scope", ".", "\")", ",", "IDENTITY_ZONE_ID_HEADER", ",", "IDENTITY_ZONE_SUBDOMAIN_HEADER", ")", ";", "@", "@", "-", "2948", ",", "50", "+", "2948", ",", "119", "@", "@", "public", "void", "revokeOwnJWToken", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "public", "void", "revokeOtherClientToken", "(", ")", "throws", "Exception", "{", "public", "void", "revokeOtherClientTokenByJti", "(", ")", "throws", "Exception", "{", "String", "revokerClientId", "=", "generator", ".", "generate", "(", ");", "String", "resourceClientId", "=", "generator", ".", "generate", "(", ");", "BaseClientDetails", "resourceClient", "=", "new", "BaseClientDetails", "(", "resourceClientId", ",", "\"", "\",", "\"", "tokens", ".", "revoke", "\"", ",", "\"", "uaa", ".", "resource", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "\"", "uaa", ".", "resource", "\"", ");", "\"", "uaa", ".", "resource", "\"", ",", "\"", "http", ":", "//", "redirect", ".", "uri", "\"", ");", "resourceClient", ".", "setClientSecret", "(", "\"", "secret", "\"", ");", "createClient", "(", "getMockMvc", "(", "),", "adminToken", ",", "resourceClient", ")", ";", "BaseClientDetails", "client", "=", "new", "BaseClientDetails", "(", "BaseClientDetails", "revokerClient", "=", "new", "BaseClientDetails", "(", "generator", ".", "generate", "(", "),", "\"", "\",", "\"", "uaa", ".", "none", "\"", ",", "\"", "openid", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "\"", "tokens", ".", "revoke", "\"", ");", "client", ".", "setClientSecret", "(", "\"", "secret", "\"", ");", "createClient", "(", "getMockMvc", "(", "),", "adminToken", ",", "client", ")", ";", "\"", "tokens", ".", "revoke", "\"", ",", "\"", "http", ":", "//", "redirect", ".", "uri", "\"", ");", "revokerClient", ".", "setClientSecret", "(", "\"", "secret", "\"", ");", "createClient", "(", "getMockMvc", "(", "),", "adminToken", ",", "revokerClient", ")", ";", "/", "/", "this", "is", "the", "token", "we", "will", "revoke", "String", "revokeAccessToken", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "client", ".", "getClientId", "(", "),", "client", ".", "getClientSecret", "(", "),", "\"", "tokens", ".", "revoke", "\"", ",", "null", ",", "false", ")", ";", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "revokerClient", ".", "getClientId", "(", "),", "SECRET", ",", "\"", "tokens", ".", "revoke", "\"", ",", "null", ",", "false", ")", ";", "String", "tokenToBeRevoked", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "resourceClientId", ",", "resourceClient", ".", "getClientSecret", "(", "),", "null", ",", "null", ",", "true", ")", ";", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "resourceClientId", ",", "SECRET", ",", "null", ",", "null", ",", "true", ")", ";", "getMockMvc", "(", ").", "perform", "(", "delete", "(", "\"/", "oauth", "/", "token", "/", "revoke", "/", "\"", "+", "tokenToBeRevoked", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "revokeAccessToken", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "revokeAccessToken", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", "try", "{", "tokenProvisioning", ".", "retrieve", "(", "tokenToBeRevoked", ")", ";", "fail", "(", "\"", "Token", "should", "have", "been", "deleted", "\"", ");", "}", "catch", "(", "EmptyResultDataAccessException", "e", ")", "{", "/", "/", "expected", "}", "}", "@", "Test", "public", "void", "revokeOtherClientTokenByClientId_tokensDotRevoke", "(", ")", "throws", "Exception", "{", "revokeOtherClientTokenByClientId", "(", "\"", "tokens", ".", "revoke", "\"", ");", "}", "@", "Test", "public", "void", "revokeOtherClientTokenByClientId_uaaDotAdmin", "(", ")", "throws", "Exception", "{", "revokeOtherClientTokenByClientId", "(", "\"", "uaa", ".", "admin", "\"", ");", "}", "public", "void", "revokeOtherClientTokenByClientId", "(", "String", "scope", ")", "throws", "Exception", "{", "String", "revokerClientId", "=", "generator", ".", "generate", "(", ");", "String", "resourceClientId", "=", "generator", ".", "generate", "(", ");", "BaseClientDetails", "revokerClient", "=", "setUpClients", "(", "revokerClientId", ",", "scope", ",", "\"", "openid", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "true", ")", ";", "BaseClientDetails", "targetClient", "=", "setUpClients", "(", "resourceClientId", ",", "\"", "uaa", ".", "none", "\"", ",", "\"", "openid", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "true", ")", ";", "/", "/", "this", "is", "the", "token", "we", "will", "revoke", "String", "revokeAccessToken", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "revokerClient", ".", "getClientId", "(", "),", "SECRET", ",", "scope", ",", "null", ",", "false", ")", ";", "String", "tokenToBeRevoked", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "resourceClientId", ",", "SECRET", ",", "null", ",", "null", ",", "true", ")", ";", "getMockMvc", "(", ").", "perform", "(", "delete", "(", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "\"", "+", "resourceClientId", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "revokeAccessToken", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", "try", "{"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Added", "javadoc"], "code_tokens": ["@", "@", "-", "518", ",", "9", "+", "518", ",", "18", "@", "@", "native", "static", "public", "void", "consoleLog", "(", "String", "message", ")", "/", "*-", "{", "console", ".", "log", "(", "\"", "GWT", ":", "\"", "+", "message", ")", ";", "}", "-*", "/;", "/", "**", "*", "LoadingListener", "interface", "main", "purpose", "is", "to", "do", "some", "things", "before", "or", "after", "{", "@", "link", "GwtApplication", "#", "setupLoop", "(", ")}", "*", "/", "public", "interface", "LoadingListener", "{", "/", "**", "*", "Method", "called", "before", "the", "setup", "*", "/", "public", "void", "beforeSetup", "(", ");", "/", "**", "*", "Method", "called", "after", "the", "setup", "*", "/", "public", "void", "afterSetup", "(", ");", "}", "}"], "docstring_tokens": ["using", "timing", "attacks"]}
{"contents": ["crypto:", "Move", "md5_transform", "to", "lib/md5.c", "We", "are", "going", "to", "use", "this", "for", "TCP/IP", "sequence", "number", "and", "fragment", "ID", "generation.", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "21", ",", "99", "+", "21", ",", "9", "@", "@", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "string", ".", "h", ">", "#", "include", "<", "linux", "/", "types", ".", "h", ">", "#", "include", "<", "linux", "/", "cryptohash", ".", "h", ">", "#", "include", "<", "asm", "/", "byteorder", ".", "h", ">", "#", "define", "F1", "(", "x", ",", "y", ",", "z", ")", "(", "z", "^", "(", "x", "&", "(", "y", "^", "z", ")", "))", "#", "define", "F2", "(", "x", ",", "y", ",", "z", ")", "F1", "(", "z", ",", "x", ",", "y", ")", "#", "define", "F3", "(", "x", ",", "y", ",", "z", ")", "(", "x", "^", "y", "^", "z", ")", "#", "define", "F4", "(", "x", ",", "y", ",", "z", ")", "(", "y", "^", "(", "x", "|", "~", "z", ")", ")", "#", "define", "MD5STEP", "(", "f", ",", "w", ",", "x", ",", "y", ",", "z", ",", "in", ",", "s", ")", "\\", "(", "w", "+", "=", "f", "(", "x", ",", "y", ",", "z", ")", "+", "in", ",", "w", "=", "(", "w", "<", "<", "s", "|", "w", ">", ">(", "32", "-", "s", ")", ")", "+", "x", ")", "static", "void", "md5_transform", "(", "u32", "*", "hash", ",", "u32", "const", "*", "in", ")", "{", "u32", "a", ",", "b", ",", "c", ",", "d", ";", "a", "=", "hash", "[", "0", "]", ";", "b", "=", "hash", "[", "1", "]", ";", "c", "=", "hash", "[", "2", "]", ";", "d", "=", "hash", "[", "3", "]", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "0", "]", "+", "0xd76aa478", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "1", "]", "+", "0xe8c7b756", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "2", "]", "+", "0x242070db", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "3", "]", "+", "0xc1bdceee", ",", "22", ")", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "0xf57c0faf", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "5", "]", "+", "0x4787c62a", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "6", "]", "+", "0xa8304613", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "7", "]", "+", "0xfd469501", ",", "22", ")", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "8", "]", "+", "0x698098d8", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "9", "]", "+", "0x8b44f7af", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "10", "]", "+", "0xffff5bb1", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "11", "]", "+", "0x895cd7be", ",", "22", ")", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "12", "]", "+", "0x6b901122", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "13", "]", "+", "0xfd987193", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "14", "]", "+", "0xa679438e", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "15", "]", "+", "0x49b40821", ",", "22", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "1", "]", "+", "0xf61e2562", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "6", "]", "+", "0xc040b340", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "11", "]", "+", "0x265e5a51", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "0", "]", "+", "0xe9b6c7aa", ",", "20", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "5", "]", "+", "0xd62f105d", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "10", "]", "+", "0x02441453", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "15", "]", "+", "0xd8a1e681", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "4", "]", "+", "0xe7d3fbc8", ",", "20", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "0x21e1cde6", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "14", "]", "+", "0xc33707d6", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "3", "]", "+", "0xf4d50d87", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "8", "]", "+", "0x455a14ed", ",", "20", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "13", "]", "+", "0xa9e3e905", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "2", "]", "+", "0xfcefa3f8", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "7", "]", "+", "0x676f02d9", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "12", "]", "+", "0x8d2a4c8a", ",", "20", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "5", "]", "+", "0xfffa3942", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "8", "]", "+", "0x8771f681", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "11", "]", "+", "0x6d9d6122", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "14", "]", "+", "0xfde5380c", ",", "23", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "1", "]", "+", "0xa4beea44", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "4", "]", "+", "0x4bdecfa9", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "7", "]", "+", "0xf6bb4b60", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "10", "]", "+", "0xbebfbc70", ",", "23", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "13", "]", "+", "0x289b7ec6", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "0", "]", "+", "0xeaa127fa", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "3", "]", "+", "0xd4ef3085", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "6", "]", "+", "0x04881d05", ",", "23", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "0xd9d4d039", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "12", "]", "+", "0xe6db99e5", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "15", "]", "+", "0x1fa27cf8", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "2", "]", "+", "0xc4ac5665", ",", "23", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "0", "]", "+", "0xf4292244", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "7", "]", "+", "0x432aff97", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "14", "]", "+", "0xab9423a7", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "5", "]", "+", "0xfc93a039", ",", "21", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "12", "]", "+", "0x655b59c3", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "3", "]", "+", "0x8f0ccc92", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "10", "]", "+", "0xffeff47d", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "1", "]", "+", "0x85845dd1", ",", "21", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "8", "]", "+", "0x6fa87e4f", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "15", "]", "+", "0xfe2ce6e0", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "6", "]", "+", "0xa3014314", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "13", "]", "+", "0x4e0811a1", ",", "21", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "0xf7537e82", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "11", "]", "+", "0xbd3af235", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "2", "]", "+", "0x2ad7d2bb", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "9", "]", "+", "0xeb86d391", ",", "21", ")", ";", "hash", "[", "0", "]", "+", "=", "a", ";", "hash", "[", "1", "]", "+", "=", "b", ";", "hash", "[", "2", "]", "+", "=", "c", ";", "hash", "[", "3", "]", "+", "=", "d", ";", "}", "/", "*", "XXX", ":", "this", "stuff", "can", "be", "optimized", "*", "/", "static", "inline", "void", "le32_to_cpu_array", "(", "u32", "*", "buf", ",", "unsigned", "int", "words", ")", "{", "@", "@", "-", "8", ",", "6", "+", "8", ",", "11", "@", "@", "void", "sha_init", "(", "__u32", "*", "buf", ")", ";", "void", "sha_transform", "(", "__u32", "*", "digest", ",", "const", "char", "*", "data", ",", "__u32", "*", "W", ")", ";", "#", "define", "MD5_DIGEST_WORDS", "4", "#", "define", "MD5_MESSAGE_BYTES", "64", "void", "md5_transform", "(", "__u32", "*", "hash", ",", "__u32", "const", "*", "in", ")", ";", "__u32", "half_md4_transform", "(", "__u32", "buf", "[", "4", "]", ",", "__u32", "const", "in", "[", "8", "]", ");", "#", "endif", "@", "@", "-", "10", ",", "7", "+", "10", ",", "7", "@", "@", "endif", "lib", "-", "y", ":", "=", "ctype", ".", "o", "string", ".", "o", "vsprintf", ".", "o", "cmdline", ".", "o", "\\", "rbtree", ".", "o", "radix", "-", "tree", ".", "o", "dump_stack", ".", "o", "timerqueue", ".", "o", "\\", "idr", ".", "o", "int_sqrt", ".", "o", "extable", ".", "o", "prio_tree", ".", "o", "\\", "sha1", ".", "o", "irq_regs", ".", "o", "reciprocal_div", ".", "o", "argv_split", ".", "o", "\\", "sha1", ".", "o", "md5", ".", "o", "irq_regs", ".", "o", "reciprocal_div", ".", "o", "argv_split", ".", "o", "\\", "proportions", ".", "o", "prio_heap", ".", "o", "ratelimit", ".", "o", "show_mem", ".", "o", "\\", "is_single_threaded", ".", "o", "plist", ".", "o", "decompress", ".", "o", "find_next_bit", ".", "o", "@", "@", "-", "0", ",", "0", "+", "1", ",", "95", "@", "@", "#", "include", "<", "linux", "/", "kernel", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "cryptohash", ".", "h", ">", "#", "define", "F1", "(", "x", ",", "y", ",", "z", ")", "(", "z", "^", "(", "x", "&", "(", "y", "^", "z", ")", "))", "#", "define", "F2", "(", "x", ",", "y", ",", "z", ")", "F1", "(", "z", ",", "x", ",", "y", ")", "#", "define", "F3", "(", "x", ",", "y", ",", "z", ")", "(", "x", "^", "y", "^", "z", ")", "#", "define", "F4", "(", "x", ",", "y", ",", "z", ")", "(", "y", "^", "(", "x", "|", "~", "z", ")", ")", "#", "define", "MD5STEP", "(", "f", ",", "w", ",", "x", ",", "y", ",", "z", ",", "in", ",", "s", ")", "\\", "(", "w", "+", "=", "f", "(", "x", ",", "y", ",", "z", ")", "+", "in", ",", "w", "=", "(", "w", "<", "<", "s", "|", "w", ">", ">(", "32", "-", "s", ")", ")", "+", "x", ")", "void", "md5_transform", "(", "__u32", "*", "hash", ",", "__u32", "const", "*", "in", ")", "{", "u32", "a", ",", "b", ",", "c", ",", "d", ";", "a", "=", "hash", "[", "0", "]", ";", "b", "=", "hash", "[", "1", "]", ";", "c", "=", "hash", "[", "2", "]", ";", "d", "=", "hash", "[", "3", "]", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "0", "]", "+", "0xd76aa478", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "1", "]", "+", "0xe8c7b756", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "2", "]", "+", "0x242070db", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "3", "]", "+", "0xc1bdceee", ",", "22", ")", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "0xf57c0faf", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "5", "]", "+", "0x4787c62a", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "6", "]", "+", "0xa8304613", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "7", "]", "+", "0xfd469501", ",", "22", ")", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "8", "]", "+", "0x698098d8", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "9", "]", "+", "0x8b44f7af", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "10", "]", "+", "0xffff5bb1", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "11", "]", "+", "0x895cd7be", ",", "22", ")", ";", "MD5STEP", "(", "F1", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "12", "]", "+", "0x6b901122", ",", "7", ")", ";", "MD5STEP", "(", "F1", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "13", "]", "+", "0xfd987193", ",", "12", ")", ";", "MD5STEP", "(", "F1", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "14", "]", "+", "0xa679438e", ",", "17", ")", ";", "MD5STEP", "(", "F1", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "15", "]", "+", "0x49b40821", ",", "22", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "1", "]", "+", "0xf61e2562", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "6", "]", "+", "0xc040b340", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "11", "]", "+", "0x265e5a51", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "0", "]", "+", "0xe9b6c7aa", ",", "20", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "5", "]", "+", "0xd62f105d", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "10", "]", "+", "0x02441453", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "15", "]", "+", "0xd8a1e681", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "4", "]", "+", "0xe7d3fbc8", ",", "20", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "0x21e1cde6", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "14", "]", "+", "0xc33707d6", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "3", "]", "+", "0xf4d50d87", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "8", "]", "+", "0x455a14ed", ",", "20", ")", ";", "MD5STEP", "(", "F2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "13", "]", "+", "0xa9e3e905", ",", "5", ")", ";", "MD5STEP", "(", "F2", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "2", "]", "+", "0xfcefa3f8", ",", "9", ")", ";", "MD5STEP", "(", "F2", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "7", "]", "+", "0x676f02d9", ",", "14", ")", ";", "MD5STEP", "(", "F2", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "12", "]", "+", "0x8d2a4c8a", ",", "20", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "5", "]", "+", "0xfffa3942", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "8", "]", "+", "0x8771f681", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "11", "]", "+", "0x6d9d6122", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "14", "]", "+", "0xfde5380c", ",", "23", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "1", "]", "+", "0xa4beea44", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "4", "]", "+", "0x4bdecfa9", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "7", "]", "+", "0xf6bb4b60", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "10", "]", "+", "0xbebfbc70", ",", "23", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "13", "]", "+", "0x289b7ec6", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "0", "]", "+", "0xeaa127fa", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "3", "]", "+", "0xd4ef3085", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "6", "]", "+", "0x04881d05", ",", "23", ")", ";", "MD5STEP", "(", "F3", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "0xd9d4d039", ",", "4", ")", ";", "MD5STEP", "(", "F3", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "12", "]", "+", "0xe6db99e5", ",", "11", ")", ";", "MD5STEP", "(", "F3", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "15", "]", "+", "0x1fa27cf8", ",", "16", ")", ";", "MD5STEP", "(", "F3", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "2", "]", "+", "0xc4ac5665", ",", "23", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "0", "]", "+", "0xf4292244", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "7", "]", "+", "0x432aff97", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "14", "]", "+", "0xab9423a7", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "5", "]", "+", "0xfc93a039", ",", "21", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "12", "]", "+", "0x655b59c3", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "3", "]", "+", "0x8f0ccc92", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "10", "]", "+", "0xffeff47d", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "1", "]", "+", "0x85845dd1", ",", "21", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "8", "]", "+", "0x6fa87e4f", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "15", "]", "+", "0xfe2ce6e0", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "6", "]", "+", "0xa3014314", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "13", "]", "+", "0x4e0811a1", ",", "21", ")", ";", "MD5STEP", "(", "F4", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "0xf7537e82", ",", "6", ")", ";", "MD5STEP", "(", "F4", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "11", "]", "+", "0xbd3af235", ",", "10", ")", ";", "MD5STEP", "(", "F4", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "2", "]", "+", "0x2ad7d2bb", ",", "15", ")", ";", "MD5STEP", "(", "F4", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "9", "]", "+", "0xeb86d391", ",", "21", ")", ";", "hash", "[", "0", "]", "+", "=", "a", ";", "hash", "[", "1", "]", "+", "=", "b", ";", "hash", "[", "2", "]", "+", "=", "c", ";", "hash", "[", "3", "]", "+", "=", "d", ";", "}", "EXPORT_SYMBOL", "(", "md5_transform", ")", ";"], "docstring_tokens": ["by", "predicting", "these", "values", "and", "sending", "crafted", "packets", "."]}
{"contents": ["Change", "the", "default", "bind", "address", "for", "AJP", "to", "the", "loopback", "address"], "code_tokens": ["@", "@", "-", "16", ",", "6", "+", "16", ",", "8", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "coyote", ".", "ajp", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "org", ".", "apache", ".", "coyote", ".", "AbstractProtocol", ";", "import", "org", ".", "apache", ".", "coyote", ".", "Processor", ";", "import", "org", ".", "apache", ".", "coyote", ".", "UpgradeProtocol", ";", "@", "@", "-", "46", ",", "6", "+", "48", ",", "8", "@", "@", "public", "AbstractAjpProtocol", "(", "AbstractEndpoint", "<", "S", ",", "?>", "endpoint", ")", "{", "setConnectionTimeout", "(", "Constants", ".", "DEFAULT_CONNECTION_TIMEOUT", ")", ";", "/", "/", "AJP", "does", "not", "use", "Send", "File", "getEndpoint", "(", ").", "setUseSendfile", "(", "false", ")", ";", "/", "/", "AJP", "listens", "on", "loopback", "by", "default", "getEndpoint", "(", ").", "setAddress", "(", "InetAddress", ".", "getLoopbackAddress", "(", "))", ";", "ConnectionHandler", "<", "S", ">", "cHandler", "=", "new", "ConnectionHandler", "<", ">(", "this", ")", ";", "setHandler", "(", "cHandler", ")", ";", "getEndpoint", "(", ").", "setHandler", "(", "cHandler", ")", ";", "@", "@", "-", "178", ",", "6", "+", "178", ",", "10", "@", "@", "Disable", "(", "comment", "out", "in", "server", ".", "xml", ")", "the", "AJP", "/", "1", ".", "3", "connector", "by", "default", ".", "(", "markt", ")", "<", "/", "update", ">", "<", "update", ">", "Change", "the", "default", "bind", "address", "for", "the", "AJP", "/", "1", ".", "3", "connector", "to", "be", "the", "loopback", "address", ".", "(", "markt", ")", "<", "/", "update", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">", "@", "@", "-", "308", ",", "10", "+", "308", ",", "7", "@", "@", "<", "attribute", "name", "=", "\"", "address", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "For", "servers", "with", "more", "than", "one", "IP", "address", ",", "this", "attribute", "specifies", "which", "address", "will", "be", "used", "for", "listening", "on", "the", "specified", "port", ".", "By", "default", ",", "this", "port", "will", "be", "used", "on", "all", "IP", "addresses", "associated", "with", "the", "server", ".", "A", "value", "of", "<", "code", ">", "127", ".", "0", ".", "0", ".", "1", "<", "/", "code", ">", "indicates", "that", "the", "Connector", "will", "only", "listen", "on", "the", "loopback", "interface", ".", "</", "p", ">", "port", ".", "By", "default", ",", "the", "loopback", "address", "will", "be", "used", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "bindOnInit", "\"", "required", "=", "\"", "false", "\"", ">"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["THRIFT-4024,", "THRIFT-4783:", "throw", "when", "skipping", "invalid", "type", "(#1742)", "*", "THRIFT-4024:", "make", "c_glib", "throw", "on", "unsupported", "type", "when", "skipping", "*", "THRIFT-4783:", "throw", "on", "invalid", "skip", "(py)", "*", "THRIFT-4024:", "make", "cpp", "throw", "on", "unsupported", "type", "when", "skipping", "*", "THRIFT-4024:", "uniform", "skip", "behavior", "on", "unsupported", "type"], "code_tokens": ["@", "@", "-", "419", ",", "6", "+", "419", ",", "13", "@", "@", "thrift_protocol_read_binary", "(", "ThriftProtocol", "*", "protocol", ",", "gpointer", "*", "buf", ",", "len", ",", "error", ")", ";", "}", "#", "define", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "_RES", ",", "_CALL", ")", "\\", "{", "\\", "gint32", "_x", "=", "(", "_CALL", ")", ";", "\\", "if", "(", "_x", "<", "0", ")", "{", "return", "_x", ";", "}", "\\", "(", "_RES", ")", "+", "=", "_x", ";", "\\", "}", "gint32", "thrift_protocol_skip", "(", "ThriftProtocol", "*", "protocol", ",", "ThriftType", "type", ",", "GError", "*", "*", "error", ")", "{", "@", "@", "-", "469", ",", "38", "+", "476", ",", "41", "@", "@", "thrift_protocol_skip", "(", "ThriftProtocol", "*", "protocol", ",", "ThriftType", "type", ",", "GError", "*", "*", "error", ")", "gchar", "*", "name", ";", "gint16", "fid", ";", "ThriftType", "ftype", ";", "result", "+", "=", "thrift_protocol_read_struct_begin", "(", "protocol", ",", "&", "name", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_struct_begin", "(", "protocol", ",", "&", "name", ",", "error", ")", ")", "while", "(", "1", ")", "{", "result", "+", "=", "thrift_protocol_read_field_begin", "(", "protocol", ",", "&", "name", ",", "&", "ftype", ",", "&", "fid", ",", "error", ")", ";", "if", "(", "result", "<", "0", ")", "{", "return", "result", ";", "}", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_field_begin", "(", "protocol", ",", "&", "name", ",", "&", "ftype", ",", "&", "fid", ",", "error", ")", ")", "if", "(", "ftype", "=", "=", "T_STOP", ")", "{", "break", ";", "}", "result", "+", "=", "thrift_protocol_skip", "(", "protocol", ",", "ftype", ",", "error", ")", ";", "result", "+", "=", "thrift_protocol_read_field_end", "(", "protocol", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_skip", "(", "protocol", ",", "ftype", ",", "error", ")", ")", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_field_end", "(", "protocol", ",", "error", ")", ")", "}", "result", "+", "=", "thrift_protocol_read_struct_end", "(", "protocol", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_struct_end", "(", "protocol", ",", "error", ")", ")", "return", "result", ";", "}", "case", "T_SET", ":", "{", "gint32", "result", "=", "0", ";", "ThriftType", "elem_type", ";", "guint32", "i", ",", "size", ";", "result", "+", "=", "thrift_protocol_read_set_begin", "(", "protocol", ",", "&", "elem_type", ",", "&", "size", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_set_begin", "(", "protocol", ",", "&", "elem_type", ",", "&", "size", ",", "error", ")", ")", "for", "(", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+)", "{", "result", "+", "=", "thrift_protocol_skip", "(", "protocol", ",", "elem_type", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_skip", "(", "protocol", ",", "elem_type", ",", "error", ")", ")", "}", "result", "+", "=", "thrift_protocol_read_set_end", "(", "protocol", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_set_end", "(", "protocol", ",", "error", ")", ")", "return", "result", ";", "}", "case", "T_MAP", ":", "@", "@", "-", "509", ",", "33", "+", "519", ",", "45", "@", "@", "thrift_protocol_skip", "(", "ThriftProtocol", "*", "protocol", ",", "ThriftType", "type", ",", "GError", "*", "*", "error", ")", "ThriftType", "elem_type", ";", "ThriftType", "key_type", ";", "guint32", "i", ",", "size", ";", "result", "+", "=", "thrift_protocol_read_map_begin", "(", "protocol", ",", "&", "key_type", ",", "&", "elem_type", ",", "&", "size", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_map_begin", "(", "protocol", ",", "&", "key_type", ",", "&", "elem_type", ",", "&", "size", ",", "error", ")", ")", "for", "(", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+)", "{", "result", "+", "=", "thrift_protocol_skip", "(", "protocol", ",", "key_type", ",", "error", ")", ";", "result", "+", "=", "thrift_protocol_skip", "(", "protocol", ",", "elem_type", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_skip", "(", "protocol", ",", "key_type", ",", "error", ")", ")", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_skip", "(", "protocol", ",", "elem_type", ",", "error", ")", ")", "}", "result", "+", "=", "thrift_protocol_read_map_end", "(", "protocol", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_map_end", "(", "protocol", ",", "error", ")", ")", "return", "result", ";", "}", "case", "T_LIST", ":", "{", "gint32", "result", "=", "0", ";", "ThriftType", "elem_type", ";", "guint32", "i", ",", "size", ";", "result", "+", "=", "thrift_protocol_read_list_begin", "(", "protocol", ",", "&", "elem_type", ",", "&", "size", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_list_begin", "(", "protocol", ",", "&", "elem_type", ",", "&", "size", ",", "error", ")", ")", "for", "(", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+)", "{", "result", "+", "=", "thrift_protocol_skip", "(", "protocol", ",", "elem_type", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_skip", "(", "protocol", ",", "elem_type", ",", "error", ")", ")", "}", "result", "+", "=", "thrift_protocol_read_list_end", "(", "protocol", ",", "error", ")", ";", "THRIFT_SKIP_RESULT_OR_RETURN", "(", "result", ",", "thrift_protocol_read_list_end", "(", "protocol", ",", "error", ")", ")", "return", "result", ";", "}", "default", ":", "return", "0", ";", "break", ";", "}", "g_set_error", "(", "error", ",", "THRIFT_PROTOCOL_ERROR", ",", "THRIFT_PROTOCOL_ERROR_INVALID_DATA", ",", "\"", "unrecognized", "type", "\"", ");", "return", "-", "1", ";", "}", "/", "*", "define", "the", "GError", "domain", "for", "Thrift", "protocols", "*", "/", "@", "@", "-", "747", ",", "16", "+", "747", ",", "12", "@", "@", "uint32_t", "skip", "(", "Protocol_", "&", "prot", ",", "TType", "type", ")", "{", "result", "+", "=", "prot", ".", "readListEnd", "(", ");", "return", "result", ";", "}", "case", "T_STOP", ":", "case", "T_VOID", ":", "case", "T_U64", ":", "case", "T_UTF8", ":", "case", "T_UTF16", ":", "break", ";", "default", ":", "throw", "TProtocolException", "(", "TProtocolException", ":", ":", "INVALID_DATA", ")", ";", "break", ";", "}", "return", "0", ";", "throw", "TProtocolException", "(", "TProtocolException", ":", ":", "INVALID_DATA", ",", "\"", "invalid", "TType", "\"", ");", "}", "}", "}}", "/", "/", "apache", ":", ":", "thrift", ":", ":", "protocol", "@", "@", "-", "260", ",", "7", "+", "260", ",", "7", "@", "@", "protected", ":", "*", "in", "generated", "code", ".", "*", "/", "void", "skip", "(", "Protocol", ")", "(", "Protocol", "prot", ",", "TType", "type", ")", "if", "(", "is", "(", "Protocol", ":", "TProtocol", ")", ")", "{", "final", "switch", "(", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "TType", ".", "BOOL", ":", "prot", ".", "readBool", "(", ");", "break", ";", "@", "@", "-", "324", ",", "9", "+", "324", ",", "9", "@", "@", "void", "skip", "(", "Protocol", ")", "(", "Protocol", "prot", ",", "TType", "type", ")", "if", "(", "is", "(", "Protocol", ":", "TProtocol", ")", ")", "{", "}", "prot", ".", "readSetEnd", "(", ");", "break", ";", "case", "TType", ".", "STOP", ":", "goto", "case", ";", "case", "TType", ".", "VOID", ":", "assert", "(", "false", ",", "\"", "Invalid", "field", "type", "passed", ".", "\")", ";", "default", ":", "throw", "new", "TProtocolException", "(", "TProtocolException", ".", "Type", ".", "INVALID_DATA", ")", ";", "}", "}", "@", "@", "-", "101", ",", "7", "+", "101", ",", "7", "@", "@", "class", "TProtocolUtil", "{", "break", ";", "default", ":", "break", ";", "throw", "new", "TProtocolError", "(", "TProtocolErrorType", ".", "INVALID_DATA", ",", "\"", "Invalid", "data", "\"", ");", "}", "}", "}", "@", "@", "-", "96", ",", "8", "+", "96", ",", "6", "@", "@", "func", "Skip", "(", "self", "TProtocol", ",", "fieldType", "TType", ",", "maxDepth", "int", ")", "(", "err", "error", ")", "{", "}", "switch", "fieldType", "{", "case", "STOP", ":", "return", "case", "BOOL", ":", "_", ",", "err", "=", "self", ".", "ReadBool", "(", ")", "return", "@", "@", "-", "152", ",", "7", "+", "152", ",", "8", "@", "@", "public", "static", "void", "skip", "(", "TProtocol", "prot", ",", "byte", "type", ",", "int", "maxDepth", ")", "break", ";", "}", "default", ":", "break", ";", "throw", "new", "TProtocolException", "(", "TProtocolException", ".", "INVALID_DATA", ",", "\"", "Unrecognized", "type", "\"", "+", "type", ")", ";", "}", "}", "}", "@", "@", "-", "1376", ",", "9", "+", "1376", ",", "6", "@", "@", "Thrift", ".", "Protocol", ".", "prototype", "=", "{", "skip", ":", "function", "(", "type", ")", "{", "var", "ret", ",", "i", ";", "switch", "(", "type", ")", "{", "case", "Thrift", ".", "Type", ".", "STOP", ":", "return", "null", ";", "case", "Thrift", ".", "Type", ".", "BOOL", ":", "return", "this", ".", "readBool", "(", ");", "@", "@", "-", "107", ",", "9", "+", "107", ",", "7", "@", "@", "function", "TProtocolBase", ":", "readDouble", "(", ")", "end", "function", "TProtocolBase", ":", "readString", "(", ")", "end", "function", "TProtocolBase", ":", "skip", "(", "ttype", ")", "if", "type", "=", "=", "TType", ".", "STOP", "then", "return", "elseif", "ttype", "=", "=", "TType", ".", "BOOL", "then", "if", "ttype", "=", "=", "TType", ".", "BOOL", "then", "self", ":", "readBool", "(", ")", "elseif", "ttype", "=", "=", "TType", ".", "BYTE", "then", "self", ":", "readByte", "(", ")", "@", "@", "-", "153", ",", "6", "+", "151", ",", "10", "@", "@", "function", "TProtocolBase", ":", "skip", "(", "ttype", ")", "self", ":", "skip", "(", "ettype", ")", "end", "self", ":", "readListEnd", "(", ")", "else", "terror", "(", "TProtocolException", ":", "new", "{", "message", "=", "'", "Invalid", "data", "'", "}", ")", "end", "end", "@", "@", "-", "302", ",", "8", "+", "302", ",", "6", "@", "@", "TBinaryProtocol", ".", "prototype", ".", "getTransport", "=", "function", "(", ")", "{", "TBinaryProtocol", ".", "prototype", ".", "skip", "=", "function", "(", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "Type", ".", "STOP", ":", "return", ";", "case", "Type", ".", "BOOL", ":", "this", ".", "readBool", "(", ");", "break", ";", "@", "@", "-", "854", ",", "8", "+", "854", ",", "6", "@", "@", "TCompactProtocol", ".", "prototype", ".", "zigzagToI64", "=", "function", "(", "n", ")", "{", "TCompactProtocol", ".", "prototype", ".", "skip", "=", "function", "(", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "Type", ".", "STOP", ":", "return", ";", "case", "Type", ".", "BOOL", ":", "this", ".", "readBool", "(", ");", "break", ";", "@", "@", "-", "738", ",", "8", "+", "738", ",", "6", "@", "@", "TJSONProtocol", ".", "prototype", ".", "getTransport", "=", "function", "(", ")", "{", "*", "/", "TJSONProtocol", ".", "prototype", ".", "skip", "=", "function", "(", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "Type", ".", "STOP", ":", "return", ";", "case", "Type", ".", "BOOL", ":", "this", ".", "readBool", "(", ");", "break", ";", "@", "@", "-", "206", ",", "8", "+", "206", ",", "6", "@", "@", "struct", "(", "*", "skippage", "*", ")", "method", "skip", "typ", "=", "match", "typ", "with", "|", "T_STOP", "-", ">", "(", ")", "|", "T_VOID", "-", ">", "(", ")", "|", "T_BOOL", "-", ">", "ignore", "self", "#", "readBool", "|", "T_BYTE", "|", "T_I08", "-", ">", "ignore", "self", "#", "readByte", "@", "@", "-", "248", ",", "6", "+", "246", ",", "7", "@", "@", "struct", "self", "#", "readListEnd", ")", "|", "T_UTF8", "-", ">", "(", ")", "|", "T_UTF16", "-", ">", "(", ")", "|", "_", "-", ">", "raise", "(", "Protocol", ".", "E", "(", "Protocol", ".", "INVALID_DATA", ",", "\"", "Invalid", "data", "\"", "))", "end", "class", "virtual", "factory", "=", "@", "@", "-", "191", ",", "9", "+", "191", ",", "7", "@", "@", "def", "readUtf8", "(", "self", ")", ":", "return", "self", ".", "readString", "(", ").", "decode", "(", "'", "utf8", "'", ")", "def", "skip", "(", "self", ",", "ttype", ")", ":", "if", "ttype", "=", "=", "TType", ".", "STOP", ":", "return", "elif", "ttype", "=", "=", "TType", ".", "BOOL", ":", "if", "ttype", "=", "=", "TType", ".", "BOOL", ":", "self", ".", "readBool", "(", ")", "elif", "ttype", "=", "=", "TType", ".", "BYTE", ":", "self", ".", "readByte", "(", ")", "@", "@", "-", "232", ",", "6", "+", "230", ",", "10", "@", "@", "def", "skip", "(", "self", ",", "ttype", ")", ":", "for", "i", "in", "range", "(", "size", ")", ":", "self", ".", "skip", "(", "etype", ")", "self", ".", "readListEnd", "(", ")", "else", ":", "raise", "TProtocolException", "(", "TProtocolException", ".", "INVALID_DATA", ",", "\"", "invalid", "TType", "\"", ")", "#", "tuple", "of", ":", "(", "'", "reader", "method", "'", "name", ",", "is_container", "bool", ",", "'", "writer_method", "'", "name", ")", "_TTYPE_HANDLERS", "=", "(", "@", "@", "-", "323", ",", "8", "+", "323", ",", "6", "@", "@", "def", "read_type", "(", "field_info", ")", "def", "skip", "(", "type", ")", "case", "type", "when", "Types", ":", ":", "STOP", "nil", "when", "Types", ":", ":", "BOOL", "read_bool", "when", "Types", ":", ":", "BYTE", "@", "@", "-", "367", ",", "6", "+", "365", ",", "8", "@", "@", "def", "skip", "(", "type", ")", "skip", "(", "etype", ")", "end", "read_list_end", "else", "raise", "ProtocolException", ".", "new", "(", "ProtocolException", ":", ":", "INVALID_DATA", ",", "'", "Invalid", "data", "'", ")", "end", "end", "@", "@", "-", "163", ",", "7", "+", "163", ",", "6", "@", "@", "@", "prot", ".", "skip", "(", "Thrift", ":", ":", "Types", ":", ":", "I64", ")", "@", "prot", ".", "skip", "(", "Thrift", ":", ":", "Types", ":", ":", "DOUBLE", ")", "@", "prot", ".", "skip", "(", "Thrift", ":", ":", "Types", ":", ":", "STRING", ")", "@", "prot", ".", "skip", "(", "Thrift", ":", ":", "Types", ":", ":", "STOP", ")", "#", "should", "do", "absolutely", "nothing", "end", "it", "\"", "should", "skip", "structs", "\"", "do", "@", "@", "-", "175", ",", "8", "+", "175", ",", "9", "@", "@", "public", "extension", "TProtocol", "{", "try", "skip", "(", "type", ":", "elemType", ")", "}", "try", "readListEnd", "(", ")", "default", ":", "return", "throw", "TProtocolError", "(", "error", ":", ".", "invalidData", ",", "message", ":", "\"", "Invalid", "data", "\"", ")", "}", "}", "}"], "docstring_tokens": ["processing", "untrusted", "Thrift", "payloads"]}
{"contents": ["Issue", "#3555", "-", "DefaultHandler", "output", "is", "now", "HTML5", "compliant.", "Signed-off-by:", "Joakim", "Erdfelt", "<joakim.erdfelt@gmail.com>"], "code_tokens": ["@", "@", "-", "18", ",", "8", "+", "18", ",", "10", "@", "@", "package", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "handler", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "OutputStreamWriter", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "@", "@", "-", "31", ",", "12", "+", "33", ",", "13", "@", "@", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Handler", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Request", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Server", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "ByteArrayISO8859Writer", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "IO", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "log", ".", "Log", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "log", ".", "Logger", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "resource", ".", "Resource", ";", "import", "static", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ".", "UTF_8", ";", "/", "*", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "*", "/", "/", "**", "Default", "Handler", ".", "@", "@", "-", "116", ",", "12", "+", "119", ",", "18", "@", "@", "public", "void", "handle", "(", "String", "target", ",", "Request", "baseRequest", ",", "HttpServletRequest", "reques", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_NOT_FOUND", ")", ";", "response", ".", "setContentType", "(", "MimeTypes", ".", "Type", ".", "TEXT_HTML", ".", "toString", "(", "))", ";", "try", "(", "ByteArrayISO8859Writer", "writer", "=", "new", "ByteArrayISO8859Writer", "(", "1500", ")", ";)", "try", "(", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ");", "OutputStreamWriter", "writer", "=", "new", "OutputStreamWriter", "(", "outputStream", ",", "UTF_8", ")", ")", "{", "writer", ".", "write", "(", "\"<", "HTML", ">", "\\", "n", "<", "HEAD", ">", "\\", "n", "<", "TITLE", ">", "Error", "404", "-", "Not", "Found", "\"", ");", "writer", ".", "write", "(", "\"<", "/", "TITLE", ">", "\\", "n", "<", "BODY", ">", "\\", "n", "<", "H2", ">", "Error", "404", "-", "Not", "Found", ".", "</", "H2", ">", "\\", "n", "\"", ");", "writer", ".", "write", "(", "\"", "No", "context", "on", "this", "server", "matched", "or", "handled", "this", "request", ".", "<", "BR", ">", "\")", ";", "writer", ".", "write", "(", "\"", "Contexts", "known", "to", "this", "server", "are", ":", "<", "ul", ">", "\")", ";", "writer", ".", "append", "(", "\"<", "!", "DOCTYPE", "html", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "html", "lang", "=", "\\\"", "en", "\\", "\">", "\\", "n", "<", "head", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "title", ">", "Error", "404", "-", "Not", "Found", "<", "/", "title", ">", "\")", ";", "writer", ".", "append", "(", "\"<", "meta", "charset", "=", "\\\"", "utf", "-", "8", "\\", "\">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "style", ">", "body", "{", "font", "-", "family", ":", "sans", "-", "serif", ";", "}", "</", "style", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "/", "head", ">", "\\", "n", "<", "body", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "h2", ">", "Error", "404", "-", "Not", "Found", ".", "</", "h2", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "p", ">", "No", "context", "on", "this", "server", "matched", "or", "handled", "this", "request", ".", "</", "p", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "p", ">", "Contexts", "known", "to", "this", "server", "are", ":", "</", "p", ">", "\\", "n", "<", "ul", ">", "\")", ";", "Server", "server", "=", "getServer", "(", ");", "Handler", "[", "]", "handlers", "=", "server", "=", "=", "null", "?", "null", ":", "server", ".", "getChildHandlersByClass", "(", "ContextHandler", ".", "class", ")", ";", "@", "@", "-", "131", ",", "43", "+", "140", ",", "43", "@", "@", "public", "void", "handle", "(", "String", "target", ",", "Request", "baseRequest", ",", "HttpServletRequest", "reques", "ContextHandler", "context", "=", "(", "ContextHandler", ")", "handlers", "[", "i", "]", ";", "if", "(", "context", ".", "isRunning", "(", "))", "{", "writer", ".", "write", "(", "\"<", "li", ">", "<", "a", "href", "=", "\\\"", "\")", ";", "writer", ".", "append", "(", "\"<", "li", ">", "<", "a", "href", "=", "\\\"", "\")", ";", "if", "(", "context", ".", "getVirtualHosts", "(", ")!", "=", "null", "&", "&", "context", ".", "getVirtualHosts", "(", ").", "length", ">", "0", ")", "writer", ".", "write", "(", "\"", "http", ":", "//", "\"+", "context", ".", "getVirtualHosts", "(", ")[", "0", "]", "+\"", ":\"", "+", "request", ".", "getLocalPort", "(", "))", ";", "writer", ".", "write", "(", "context", ".", "getContextPath", "(", "))", ";", "writer", ".", "append", "(", "\"", "http", ":", "//", "\"+", "context", ".", "getVirtualHosts", "(", ")[", "0", "]", "+\"", ":\"", "+", "request", ".", "getLocalPort", "(", "))", ";", "writer", ".", "append", "(", "context", ".", "getContextPath", "(", "))", ";", "if", "(", "context", ".", "getContextPath", "(", ").", "length", "(", ")>", "1", "&", "&", "context", ".", "getContextPath", "(", ").", "endsWith", "(", "\"/", "\")", ")", "writer", ".", "write", "(", "\"/", "\")", ";", "writer", ".", "write", "(", "\"\\", "\">", "\")", ";", "writer", ".", "write", "(", "context", ".", "getContextPath", "(", "))", ";", "writer", ".", "append", "(", "\"/", "\")", ";", "writer", ".", "append", "(", "\"\\", "\">", "\")", ";", "writer", ".", "append", "(", "context", ".", "getContextPath", "(", "))", ";", "if", "(", "context", ".", "getVirtualHosts", "(", ")!", "=", "null", "&", "&", "context", ".", "getVirtualHosts", "(", ").", "length", ">", "0", ")", "writer", ".", "write", "(", "\"&", "nbsp", ";", "@&", "nbsp", ";", "\"+", "context", ".", "getVirtualHosts", "(", ")[", "0", "]", "+\"", ":\"", "+", "request", ".", "getLocalPort", "(", "))", ";", "writer", ".", "write", "(", "\"&", "nbsp", ";", "</", "a", ">", "</", "li", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"&", "nbsp", ";", "@&", "nbsp", ";", "\"+", "context", ".", "getVirtualHosts", "(", ")[", "0", "]", "+\"", ":\"", "+", "request", ".", "getLocalPort", "(", "))", ";", "writer", ".", "append", "(", "\"&", "nbsp", ";", "</", "a", ">", "</", "li", ">", "\\", "n", "\"", ");", "}", "else", "{", "writer", ".", "write", "(", "\"<", "li", ">", "\")", ";", "writer", ".", "write", "(", "context", ".", "getContextPath", "(", "))", ";", "writer", ".", "append", "(", "\"<", "li", ">", "\")", ";", "writer", ".", "append", "(", "context", ".", "getContextPath", "(", "))", ";", "if", "(", "context", ".", "getVirtualHosts", "(", ")!", "=", "null", "&", "&", "context", ".", "getVirtualHosts", "(", ").", "length", ">", "0", ")", "writer", ".", "write", "(", "\"&", "nbsp", ";", "@&", "nbsp", ";", "\"+", "context", ".", "getVirtualHosts", "(", ")[", "0", "]", "+\"", ":\"", "+", "request", ".", "getLocalPort", "(", "))", ";", "writer", ".", "write", "(", "\"&", "nbsp", ";", "\")", ";", "writer", ".", "append", "(", "\"&", "nbsp", ";", "@&", "nbsp", ";", "\"+", "context", ".", "getVirtualHosts", "(", ")[", "0", "]", "+\"", ":\"", "+", "request", ".", "getLocalPort", "(", "))", ";", "writer", ".", "append", "(", "\"&", "nbsp", ";", "\")", ";", "if", "(", "context", ".", "isFailed", "(", "))", "writer", ".", "write", "(", "\"", "[", "failed", "]", "\")", ";", "writer", ".", "append", "(", "\"", "[", "failed", "]", "\")", ";", "if", "(", "context", ".", "isStopped", "(", "))", "writer", ".", "write", "(", "\"", "[", "stopped", "]", "\")", ";", "writer", ".", "write", "(", "\"<", "/", "li", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"", "[", "stopped", "]", "\")", ";", "writer", ".", "append", "(", "\"<", "/", "li", ">", "\\", "n", "\"", ");", "}", "}", "writer", ".", "write", "(", "\"<", "/", "ul", ">", "<", "hr", ">", "\")", ";", "writer", ".", "write", "(", "\"<", "a", "href", "=", "\\\"", "http", ":", "//", "eclipse", ".", "org", "/", "jetty", "\\", "\">", "<", "img", "border", "=", "0", "src", "=", "\\\"", "/", "favicon", ".", "ico", "\\", "\"/", "><", "/", "a", ">", "&", "nbsp", ";", "\")", ";", "writer", ".", "write", "(", "\"<", "a", "href", "=", "\\\"", "http", ":", "//", "eclipse", ".", "org", "/", "jetty", "\\", "\">", "Powered", "by", "Jetty", ":", "//", "Java", "Web", "Server", "<", "/", "a", ">", "<", "hr", "/", ">\\", "n", "\"", ");", "writer", ".", "write", "(", "\"\\", "n", "<", "/", "BODY", ">", "\\", "n", "<", "/", "HTML", ">", "\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "/", "ul", ">", "<", "hr", "/", ">\\", "n", "\"", ");", "writer", ".", "append", "(", "\"<", "a", "href", "=", "\\\"", "http", ":", "//", "eclipse", ".", "org", "/", "jetty", "\\", "\">", "<", "img", "alt", "=", "\\\"", "icon", "\\", "\"", "src", "=", "\\\"", "/", "favicon", ".", "ico", "\\", "\"/", "><", "/", "a", ">", "&", "nbsp", ";", "\")", ";", "writer", ".", "append", "(", "\"<", "a", "href", "=", "\\\"", "http", ":", "//", "eclipse", ".", "org", "/", "jetty", "\\", "\">", "Powered", "by", "Eclipse", "Jetty", ":", "//", "Server", "<", "/", "a", ">", "<", "hr", "/", ">\\", "n", "\"", ");", "writer", ".", "append", "(", "\"\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\\", "n", "\"", ");", "writer", ".", "flush", "(", ");", "response", ".", "setContentLength", "(", "writer", ".", "size", "(", "))", ";", "try", "(", "OutputStream", "out", "=", "response", ".", "getOutputStream", "(", "))", "byte", "content", "[", "]", "=", "outputStream", ".", "toByteArray", "(", ");", "response", ".", "setContentLength", "(", "content", ".", "length", ")", ";", "try", "(", "OutputStream", "out", "=", "response", ".", "getOutputStream", "(", "))", "{", "writer", ".", "writeTo", "(", "out", ")", ";", "out", ".", "write", "(", "content", ")", ";", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["[PATCH]", "hugetlb:", "fix", "prio_tree", "unit", "hugetlb_vmtruncate_list", "was", "misconverted", "to", "prio_tree:", "its", "prio_tree", "is", "in", "units", "of", "PAGE_SIZE", "(PAGE_CACHE_SIZE)", "like", "any", "other,", "not", "HPAGE_SIZE", "(whereas", "its", "radix_tree", "is", "kept", "in", "units", "of", "HPAGE_SIZE,", "otherwise", "slots", "would", "be", "absurdly", "sparse).", "At", "first", "I", "thought", "the", "error", "benign,", "just", "calling", "__unmap_hugepage_range", "on", "more", "vmas", "than", "necessary;", "but", "on", "32-bit", "machines,", "when", "the", "prio_tree", "is", "searched", "correctly,", "it", "happens", "to", "ensure", "the", "v_offset", "calculation", "won't", "overflow.", "As", "it", "stood,", "when", "truncating", "at", "or", "beyond", "4GB,", "it", "was", "liable", "to", "discard", "pages", "COWed", "from", "lower", "offsets;", "or", "even", "to", "clear", "pmd", "entries", "of", "preceding", "vmas,", "triggering", "exit_mmap's", "BUG_ON(nr_ptes).", "Signed-off-by:", "Hugh", "Dickins", "<hugh@veritas.com>", "Cc:", "Adam", "Litke", "<agl@us.ibm.com>", "Cc:", "David", "Gibson", "<david@gibson.dropbear.id.au>", "Cc:", "\"Chen,", "Kenneth", "W\"", "<kenneth.w.chen@intel.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "271", ",", "26", "+", "271", ",", "24", "@", "@", "static", "void", "hugetlbfs_drop_inode", "(", "struct", "inode", "*", "inode", ")", "hugetlbfs_forget_inode", "(", "inode", ")", ";", "}", "/", "*", "*", "h_pgoff", "is", "in", "HPAGE_SIZE", "units", ".", "*", "vma", "-", ">", "vm_pgoff", "is", "in", "PAGE_SIZE", "units", ".", "*", "/", "static", "inline", "void", "hugetlb_vmtruncate_list", "(", "struct", "prio_tree_root", "*", "root", ",", "unsigned", "long", "h_pgoff", ")", "hugetlb_vmtruncate_list", "(", "struct", "prio_tree_root", "*", "root", ",", "pgoff_t", "pgoff", ")", "{", "struct", "vm_area_struct", "*", "vma", ";", "struct", "prio_tree_iter", "iter", ";", "vma_prio_tree_foreach", "(", "vma", ",", "&", "iter", ",", "root", ",", "h_pgoff", ",", "ULONG_MAX", ")", "{", "unsigned", "long", "h_vm_pgoff", ";", "vma_prio_tree_foreach", "(", "vma", ",", "&", "iter", ",", "root", ",", "pgoff", ",", "ULONG_MAX", ")", "{", "unsigned", "long", "v_offset", ";", "h_vm_pgoff", "=", "vma", "-", ">", "vm_pgoff", ">", ">", "(", "HPAGE_SHIFT", "-", "PAGE_SHIFT", ")", ";", "v_offset", "=", "(", "h_pgoff", "-", "h_vm_pgoff", ")", "<", "<", "HPAGE_SHIFT", ";", "/", "*", "*", "Is", "this", "VMA", "fully", "outside", "the", "truncation", "point", "?", "*", "Can", "the", "expression", "below", "overflow", "on", "32", "-", "bit", "arches", "?", "*", "No", ",", "because", "the", "prio_tree", "returns", "us", "only", "those", "vmas", "*", "which", "overlap", "the", "truncated", "area", "starting", "at", "pgoff", ",", "*", "and", "no", "vma", "on", "a", "32", "-", "bit", "arch", "can", "span", "beyond", "the", "4GB", ".", "*", "/", "if", "(", "h_vm_pgoff", ">", "=", "h_pgoff", ")", "if", "(", "vma", "-", ">", "vm_pgoff", "<", "pgoff", ")", "v_offset", "=", "(", "pgoff", "-", "vma", "-", ">", "vm_pgoff", ")", "<", "<", "PAGE_SHIFT", ";", "else", "v_offset", "=", "0", ";", "__unmap_hugepage_range", "(", "vma", ",", "@", "@", "-", "303", ",", "14", "+", "301", ",", "14", "@", "@", "hugetlb_vmtruncate_list", "(", "struct", "prio_tree_root", "*", "root", ",", "unsigned", "long", "h_pgoff", ")", "*", "/", "static", "int", "hugetlb_vmtruncate", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ")", "{", "unsigned", "long", "pgoff", ";", "pgoff_t", "pgoff", ";", "struct", "address_space", "*", "mapping", "=", "inode", "-", ">", "i_mapping", ";", "if", "(", "offset", ">", "inode", "-", ">", "i_size", ")", "return", "-", "EINVAL", ";", "BUG_ON", "(", "offset", "&", "~", "HPAGE_MASK", ")", ";", "pgoff", "=", "offset", ">", ">", "HPAGE_SHIFT", ";", "pgoff", "=", "offset", ">", ">", "PAGE_SHIFT", ";", "inode", "-", ">", "i_size", "=", "offset", ";", "spin_lock", "(", "&", "mapping", "-", ">", "i_mmap_lock", ")", ";"], "docstring_tokens": ["via", "unspecified", "vectors", "."]}
{"contents": ["DATAJPA-1519", "-", "Polishing.", "Moved", "the", "registration", "of", "the", "escape(\u2026)", "SpEL", "function", "into", "an", "EvaluationContextExtension", "to", "avoid", "the", "need", "for", "a", "dedicated", "static", "method", "on", "EscapeCharacter.", "Moved", "Escape", "Character", "in", "the", "\u2026.repository.query", "package", "to", "remove", "the", "package", "cycle."], "code_tokens": ["@", "@", "-", "45", ",", "6", "+", "45", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "JpaRepository", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "DefaultJpaContext", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EntityManagerBeanDefinitionRegistrarPostProcessor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "JpaEvaluationContextExtension", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "JpaRepositoryFactoryBean", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "AnnotationRepositoryConfigurationSource", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", ";", "@", "@", "-", "76", ",", "6", "+", "77", ",", "7", "@", "@", "private", "static", "final", "String", "DEFAULT_TRANSACTION_MANAGER_BEAN_NAME", "=", "\"", "transactionManager", "\"", ";", "private", "static", "final", "String", "ENABLE_DEFAULT_TRANSACTIONS_ATTRIBUTE", "=", "\"", "enableDefaultTransactions", "\"", ";", "private", "static", "final", "String", "JPA_METAMODEL_CACHE_CLEANUP_CLASSNAME", "=", "\"", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "util", ".", "JpaMetamodelCacheCleanup", "\"", ";", "private", "static", "final", "String", "ESCAPE_CHARACTER_PROPERTY", "=", "\"", "escapeCharacter", "\"", ";", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "@", "@", "-", "132", ",", "17", "+", "134", ",", "18", "@", "@", "public", "void", "postProcess", "(", "BeanDefinitionBuilder", "builder", ",", "RepositoryConfigurationSo", "Optional", "<", "String", ">", "transactionManagerRef", "=", "source", ".", "getAttribute", "(", "\"", "transactionManagerRef", "\"", ");", "builder", ".", "addPropertyValue", "(", "\"", "transactionManager", "\"", ",", "transactionManagerRef", ".", "orElse", "(", "DEFAULT_TRANSACTION_MANAGER_BEAN_NAME", ")", ");", "builder", ".", "addPropertyValue", "(", "\"", "entityManager", "\"", ",", "getEntityManagerBeanDefinitionFor", "(", "source", ",", "source", ".", "getSource", "(", "))", ");", "builder", ".", "addPropertyValue", "(", "\"", "escapeCharacter", "\"", ",", "getEscapeCharacter", "(", "source", ")", ".", "orElse", "(", "'\\", "\\'", "))", ";", "builder", ".", "addPropertyValue", "(", "ESCAPE_CHARACTER_PROPERTY", ",", "getEscapeCharacter", "(", "source", ")", ".", "orElse", "(", "'\\", "\\'", "))", ";", "builder", ".", "addPropertyReference", "(", "\"", "mappingContext", "\"", ",", "JPA_MAPPING_CONTEXT_BEAN_NAME", ")", ";", "}", "/", "**", "*", "XML", "configurations", "do", "not", "support", "{", "@", "link", "Character", "}", "values", ".", "This", "method", "catches", "the", "exception", "thrown", "and", "returns", "an", "{", "@", "link", "Optional", "#", "empty", "(", ")}", "instead", ".", "*", "XML", "configurations", "do", "not", "support", "{", "@", "link", "Character", "}", "values", ".", "This", "method", "catches", "the", "exception", "thrown", "and", "returns", "an", "*", "{", "@", "link", "Optional", "#", "empty", "(", ")}", "instead", ".", "*", "/", "private", "static", "Optional", "<", "Character", ">", "getEscapeCharacter", "(", "RepositoryConfigurationSource", "source", ")", "{", "try", "{", "return", "source", ".", "getAttribute", "(", "\"", "escapeCharacter", "\"", ",", "Character", ".", "class", ")", ";", "return", "source", ".", "getAttribute", "(", "ESCAPE_CHARACTER_PROPERTY", ",", "Character", ".", "class", ")", ";", "}", "catch", "(", "IllegalArgumentException", "___", ")", "{", "return", "Optional", ".", "empty", "(", ");", "}", "@", "@", "-", "209", ",", "6", "+", "212", ",", "21", "@", "@", "public", "void", "registerBeansForRoot", "(", "BeanDefinitionRegistry", "registry", ",", "RepositoryConf", "registerIfNotAlreadyRegistered", "(", "()", "-", ">", "new", "RootBeanDefinition", "(", "JPA_METAMODEL_CACHE_CLEANUP_CLASSNAME", ")", ",", "registry", ",", "JPA_METAMODEL_CACHE_CLEANUP_CLASSNAME", ",", "source", ")", ";", "/", "/", "EvaluationContextExtension", "for", "JPA", "specific", "SpEL", "functions", "registerIfNotAlreadyRegistered", "(", "()", "-", ">", "{", "Object", "value", "=", "AnnotationRepositoryConfigurationSource", ".", "class", ".", "isInstance", "(", "config", ")", "/", "/", "?", "config", ".", "getRequiredAttribute", "(", "ESCAPE_CHARACTER_PROPERTY", ",", "Character", ".", "class", ")", "/", "/", ":", "config", ".", "getAttribute", "(", "ESCAPE_CHARACTER_PROPERTY", ")", ".", "orElse", "(", "\"\\", "\\\"", ");", "BeanDefinitionBuilder", "builder", "=", "BeanDefinitionBuilder", ".", "rootBeanDefinition", "(", "JpaEvaluationContextExtension", ".", "class", ")", ";", "builder", ".", "addConstructorArgValue", "(", "value", ")", ";", "return", "builder", ".", "getBeanDefinition", "(", ");", "}", ",", "registry", ",", "JpaEvaluationContextExtension", ".", "class", ".", "getName", "(", "),", "source", ")", ";", "}", "/", "*", "@", "@", "-", "13", ",", "35", "+", "13", ",", "40", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ";", "import", "lombok", ".", "Value", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "/", "**", "*", "A", "Value", "-", "class", "encapsulating", "an", "escape", "character", "for", "LIKE", "queries", "and", "the", "actually", "usage", "of", "it", "in", "escaping", "Strings", ".", "*", "A", "value", "type", "encapsulating", "an", "escape", "character", "for", "LIKE", "queries", "and", "the", "actually", "usage", "of", "it", "in", "escaping", "*", "{", "@", "link", "String", "}", "s", ".", "*", "*", "@", "author", "Jens", "Schauder", "*", "@", "author", "Oliver", "Drotbohm", "*", "/", "@", "Value", "(", "staticConstructor", "=", "\"", "of", "\"", ")", "public", "class", "EscapeCharacter", "{", "private", "static", "final", "List", "<", "String", ">", "TO_REPLACE", "=", "Arrays", ".", "asList", "(", "\"", "_", "\"", ",", "\"", "%\"", ");", "char", "value", ";", "/", "**", "*", "Escapes", "all", "special", "like", "characters", "(", "{@", "code", "_", "}", ",", "{", "@", "code", "%", "})", "using", "the", "configured", "escape", "character", ".", "*", "*", "@", "param", "value", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "String", "escape", "(", "String", "value", ")", "{", "Assert", ".", "notNull", "(", "value", ",", "\"", "Value", "must", "be", "not", "null", ".", "\")", ";", "return", "value", ".", "replace", "(", "\"", "_", "\"", ",", "value", "+", "\"", "_", "\"", ").", "replace", "(", "\"%", "\",", "value", "+", "\"", "%\"", ");", "}", "/", "/", "used", "for", "SpEL", "expressions", "static", "String", "escape", "(", "String", "value", ",", "String", "escape", ")", "{", "Assert", ".", "hasText", "(", "escape", ",", "\"", "escape", "must", "be", "a", "sinlge", "character", "String", ".", "\")", ";", "char", "[", "]", "chars", "=", "escape", ".", "toCharArray", "(", ");", "Assert", ".", "isTrue", "(", "chars", ".", "length", "=", "=", "1", ",", "\"", "escape", "must", "be", "a", "single", "character", "String", ".", "\")", ";", "return", "EscapeCharacter", ".", "of", "(", "chars", "[", "0", "]", ").", "escape", "(", "value", ")", ";", "return", "TO_REPLACE", ".", "stream", "(", ")", "/", "/", ".", "reduce", "(", "value", ",", "(", "it", ",", "character", ")", "-", ">", "it", ".", "replace", "(", "character", ",", "this", ".", "value", "+", "character", ")", ");", "}", "}", "@", "@", "-", "36", ",", "7", "+", "36", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ReturnedType", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "AbstractQueryCreator", ";", "@", "@", "-", "22", ",", "7", "+", "22", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "QueryExtractor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "Query", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "ProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "NamedQueries", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "RepositoryMetadata", ";", "@", "@", "-", "27", ",", "7", "+", "27", ",", "6", "@", "@", "import", "javax", ".", "persistence", ".", "criteria", ".", "ParameterExpression", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ParametersParameterAccessor", ";", "@", "@", "-", "29", ",", "7", "+", "29", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "JpaQueryExecution", ".", "DeleteExecution", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "JpaQueryExecution", ".", "ExistsExecution", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ParametersParameterAccessor", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ResultProcessor", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ReturnedType", ";", "@", "@", "-", "15", ",", "7", "+", "15", ",", "6", "@", "@", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "@", "@", "-", "26", ",", "7", "+", "25", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "QueryParameterSetter", ".", "NamedOrIndexedQueryParameterSetter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "StringQuery", ".", "ParameterBinding", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "QueryMethodEvaluationContextProvider", ";", "@", "@", "-", "36", ",", "7", "+", "34", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "standard", ".", "SpelExpressionParser", ";", "import", "org", ".", "springframework", ".", "lang", ".", "Nullable", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ";", "/", "**", "*", "Encapsulates", "different", "strategies", "for", "the", "creation", "of", "a", "{", "@", "link", "QueryParameterSetter", "}", "from", "a", "{", "@", "link", "Query", "}", "and", "a", "@", "@", "-", "178", ",", "11", "+", "175", ",", "7", "@", "@", "public", "QueryParameterSetter", "create", "(", "ParameterBinding", "binding", ",", "DeclaredQuery", "decla", "private", "Object", "evaluateExpression", "(", "Expression", "expression", ",", "Object", "[", "]", "values", ")", "{", "EvaluationContext", "context", "=", "evaluationContextProvider", ".", "getEvaluationContext", "(", "parameters", ",", "values", ")", ";", "Method", "escapeMethod", "=", "ReflectionUtils", ".", "findMethod", "(", "EscapeCharacter", ".", "class", ",", "\"", "escape", "\"", ",", "String", ".", "class", ",", "String", ".", "class", ")", ";", "Assert", ".", "notNull", "(", "escapeMethod", ",", "\"", "Escape", "method", "must", "not", "be", "null", ".", "\")", ";", "context", ".", "setVariable", "(", "\"", "escape", "\"", ",", "escapeMethod", ")", ";", "return", "expression", ".", "getValue", "(", "context", ",", "Object", ".", "class", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "57", "@", "@", "/", "*", "*", "Copyright", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "spel", ".", "spi", ".", "EvaluationContextExtension", ";", "/", "**", "*", "{", "@", "link", "EvaluationContextExtension", "}", "to", "register", "{", "@", "link", "EscapeCharacter", "}", "as", "root", "object", "to", "essentially", "expose", "an", "*", "{", "@", "code", "expose", "(", "\u2026)", "}", "function", "to", "SpEL", ".", "*", "*", "@", "author", "Oliver", "Drotbohm", "*", "/", "public", "class", "JpaEvaluationContextExtension", "implements", "EvaluationContextExtension", "{", "private", "final", "EscapeCharacter", "character", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaEvaluationContextExtension", "}", "for", "the", "given", "escape", "character", ".", "*", "*", "@", "param", "escapeCharacter", "the", "character", "to", "be", "used", "to", "escape", "parameters", "for", "LIKE", "expression", ".", "*", "/", "public", "JpaEvaluationContextExtension", "(", "char", "escapeCharacter", ")", "{", "this", ".", "character", "=", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "spel", ".", "spi", ".", "EvaluationContextExtension", "#", "getExtensionId", "(", ")", "*", "/", "@", "Override", "public", "String", "getExtensionId", "(", ")", "{", "return", "\"", "jpa", "\"", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "spel", ".", "spi", ".", "EvaluationContextExtension", "#", "getRootObject", "(", ")", "*", "/", "@", "Override", "public", "Object", "getRootObject", "(", ")", "{", "return", "character", ";", "}", "}", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "QueryExtractor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "JpaRepository", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "AbstractJpaQuery", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "JpaQueryLookupStrategy", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "JpaQueryMethod", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "util", ".", "JpaMetamodel", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "ObjectProvider", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "context", ".", "MappingContext", ";", "import", "org", ".", "springframework", ".", "data", ".", "querydsl", ".", "EntityPathResolver", ";", "import", "org", ".", "springframework", ".", "data", ".", "querydsl", ".", "SimpleEntityPathResolver", ";", "@", "@", "-", "3", ",", "4", "+", "3", ",", "5", "@", "@", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", "-", "1", ".", "1", ".", "xsd", "=", "org", "/", "springfra", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", "-", "1", ".", "2", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "2", ".", "xsd", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", "-", "1", ".", "3", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "3", ".", "xsd", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", "-", "1", ".", "8", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "8", ".", "xsd", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "8", ".", "xsd", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", "-", "1", ".", "11", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "11", ".", "xsd", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "11", ".", "xsd", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?", ">", "<", "xsd", ":", "schema", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "\"", "xmlns", ":", "xsd", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "\"", "xmlns", ":", "tool", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "tool", "\"", "xmlns", ":", "context", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "context", "\"", "xmlns", ":", "repository", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "repository", "\"", "targetNamespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "\"", "elementFormDefault", "=", "\"", "qualified", "\"", "attributeFormDefault", "=", "\"", "unqualified", "\"", ">", "<", "xsd", ":", "import", "namespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "tool", "\"", "/", ">", "<", "xsd", ":", "import", "namespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "context", "\"", "/", ">", "<", "xsd", ":", "import", "namespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "repository", "\"", "schemaLocation", "=", "\"", "https", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "repository", "/", "spring", "-", "repository", ".", "xsd", "\"", "/", ">", "<", "xsd", ":", "element", "name", "=", "\"", "repositories", "\"", ">", "<", "xsd", ":", "complexType", ">", "<", "xsd", ":", "complexContent", ">", "<", "xsd", ":", "extension", "base", "=", "\"", "repository", ":", "repositories", "\"", ">", "<", "xsd", ":", "attributeGroup", "ref", "=", "\"", "repository", ":", "transactional", "-", "repository", "-", "attributes", "\"", "/", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "entity", "-", "manager", "-", "factory", "-", "ref", "\"", "type", "=", "\"", "entityManagerFactoryRef", "\"", "/", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "enable", "-", "default", "-", "transactions", "\"", "type", "=", "\"", "xsd", ":", "boolean", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "documentation", ">", "<!", "[", "CDATA", "[", "Controls", "whether", "repositories", "get", "transactions", "enabled", "by", "default", ".", "]", "]>", "</", "xsd", ":", "documentation", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "/", "xsd", ":", "attribute", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "escape", "-", "character", "\"", "type", "=", "\"", "xsd", ":", "string", "\"", "default", "=", "\"\\", "\">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "documentation", ">", "<!", "[", "CDATA", "[", "Configures", "what", "character", "is", "used", "to", "escape", "the", "LIKE", "wildcards", "_", "and", "%", "in", "derived", "queries", "with", "contains", ",", "startsWith", "or", "endsWith", "clauses", ".", "Defaults", "to", "\\", ".", "]", "]>", "</", "xsd", ":", "documentation", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "/", "xsd", ":", "attribute", ">", "<", "/", "xsd", ":", "extension", ">", "<", "/", "xsd", ":", "complexContent", ">", "<", "/", "xsd", ":", "complexType", ">", "<", "/", "xsd", ":", "element", ">", "<", "xsd", ":", "element", "name", "=", "\"", "auditing", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "appinfo", ">", "<", "tool", ":", "annotation", ">", "<", "tool", ":", "exports", "type", "=", "\"", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "support", ".", "AuditingEntityListener", "\"", "/", ">", "<", "tool", ":", "exports", "type", "=", "\"", "org", ".", "springframework", ".", "data", ".", "auditing", ".", "AuditingHandler", "\"", "/", ">", "<", "/", "tool", ":", "annotation", ">", "<", "/", "xsd", ":", "appinfo", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "xsd", ":", "complexType", ">", "<", "xsd", ":", "attributeGroup", "ref", "=", "\"", "repository", ":", "auditing", "-", "attributes", "\"", "/", ">", "<", "/", "xsd", ":", "complexType", ">", "<", "/", "xsd", ":", "element", ">", "<", "xsd", ":", "simpleType", "name", "=", "\"", "entityManagerFactoryRef", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "appinfo", ">", "<", "tool", ":", "annotation", "kind", "=", "\"", "ref", "\"", ">", "<", "tool", ":", "assignable", "-", "to", "type", "=", "\"", "org", ".", "springframework", ".", "orm", ".", "jpa", ".", "AbstractEntityManagerFactoryBean", "\"", "/", ">", "<", "/", "tool", ":", "annotation", ">", "<", "/", "xsd", ":", "appinfo", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "xsd", ":", "union", "memberTypes", "=", "\"", "xsd", ":", "string", "\"", "/", ">", "<", "/", "xsd", ":", "simpleType", ">", "<", "/", "xsd", ":", "schema", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "31", ",", "7", "+", "31", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "HibernateUtils", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "SpelAwareProxyProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "Repository", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "AbstractRepositoryMetadata", ";", "@", "@", "-", "35", ",", "7", "+", "35", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "QueryExtractor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "Query", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "ProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "Repository", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "NamedQueries", ";", "@", "@", "-", "29", ",", "7", "+", "29", ",", "6", "@", "@", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "DefaultParameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ParametersParameterAccessor", ";", "@", "@", "-", "28", ",", "7", "+", "28", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Param", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "Part", ";", "@", "@", "-", "24", ",", "7", "+", "24", ",", "6", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "Part", ";", "@", "@", "-", "44", ",", "7", "+", "44", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "HibernateUtils", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "Temporal", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "SpelAwareProxyProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "Repository", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "DefaultRepositoryMetadata", ";", "@", "@", "-", "559", ",", "7", "+", "559", ",", "7", "@", "@", "List", "<", "NameOnlyDto", ">", "findByNamedQueryWithConstructorExpression", "(", ");", "/", "/", "DATAJPA", "-", "1519", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{#", "escape", "(", "[", "0", "]", ",'", "#'", ")}", "%", "escape", "'", "#'", "\")", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{", "escape", "(", "[", "0", "]", ")}", "%", "escape", "'", "\\\\", "'\"", ")", "List", "<", "User", ">", "findContainingEscaped", "(", "String", "namePart", ")", ";", "interface", "RolesAndFirstname", "{"], "docstring_tokens": ["using", "a", "specially-crafted", "query"]}
{"contents": ["WW-4090", "Removes", "double", "evaluation", "of", "parsed", "expression", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/branches/STRUTS_2_3_14_2_X@1488897", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "11", ",", "17", "+", "11", ",", "16", "@", "@", "public", "Object", "evaluate", "(", "char", "[", "]", "openChars", ",", "String", "expression", ",", "TextParseUtil", ".", "Parsed", "/", "/", "deal", "with", "the", "\"", "pure", "\"", "expressions", "first", "!", "/", "/", "expression", "=", "expression", ".", "trim", "(", ");", "Object", "result", "=", "expression", ";", "int", "pos", "=", "0", ";", "for", "(", "char", "open", ":", "openChars", ")", "{", "int", "loopCount", "=", "1", ";", "int", "pos", "=", "0", ";", "/", "/", "this", "creates", "an", "implicit", "StringBuffer", "and", "shouldn", "'", "t", "be", "used", "in", "the", "inner", "loop", "final", "String", "lookupChars", "=", "open", "+", "\"", "{\"", ";", "while", "(", "true", ")", "{", "int", "start", "=", "expression", ".", "indexOf", "(", "lookupChars", ",", "pos", ")", ";", "if", "(", "start", "=", "=", "-", "1", ")", "{", "pos", "=", "0", ";", "loopCount", "+", "+;", "start", "=", "expression", ".", "indexOf", "(", "lookupChars", ")", ";", "}", "@", "@", "-", "97", ",", "6", "+", "97", ",", "24", "@", "@", "public", "void", "testTranslateVariables", "(", ")", "{", "assertEquals", "(", "\"", "count", "must", "be", "between", "123", "and", "456", ",", "current", "value", "is", "98765", ".", "\",", "s", ")", ";", "}", "public", "void", "testNestedExpression", "(", ")", "throws", "Exception", "{", "ValueStack", "stack", "=", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ");", "stack", ".", "push", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "foo", "\"", ",", "\"", "${", "%{", "1", "+", "1", "}", "}\"", ");", "}", "})", ";", "String", "s", "=", "TextParseUtil", ".", "translateVariables", "(", "\"$", "{", "foo", "}", "\",", "stack", ")", ";", "assertEquals", "(", "\"$", "{%", "{", "1", "+", "1", "}", "}\"", ",", "s", ")", ";", "stack", ".", "pop", "(", ");", "}", "public", "void", "testMixedOpenChars", "(", ")", "throws", "Exception", "{", "ValueStack", "stack", "=", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ");", "stack", ".", "push", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ");", "}", "})", ";", "String", "s", "=", "TextParseUtil", ".", "translateVariables", "(", "\"$", "{", "foo", "}", "-%", "{", "foo", "}", "\",", "stack", ")", ";", "assertEquals", "(", "\"", "bar", "-", "bar", "\"", ",", "s", ")", ";", "s", "=", "TextParseUtil", ".", "translateVariables", "(", "\"%", "{", "foo", "}", "-$", "{", "foo", "}", "\",", "stack", ")", ";", "assertEquals", "(", "\"%", "{", "foo", "}", "-", "bar", "\"", ",", "s", ")", ";", "/", "/", "this", "is", "bad", ",", "but", "it", "is", "the", "only", "way", "not", "to", "double", "evaluate", "passed", "expression", "stack", ".", "pop", "(", ");", "}", "public", "void", "testCommaDelimitedStringToSet", "(", ")", "{", "assertEquals", "(", "0", ",", "TextParseUtil", ".", "commaDelimitedStringToSet", "(", "\"\"", ").", "size", "(", "))", ";", "assertEquals", "(", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ",", "\"", "tee", "\"", "))", ",", "@", "@", "-", "132", ",", "10", "+", "150", ",", "13", "@", "@", "public", "void", "testTranslateVariablesNoRecursive", "(", ")", "{", "public", "void", "testTranslateVariablesRecursive", "(", ")", "{", "ValueStack", "stack", "=", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ");", "stack", ".", "push", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "foo", "\"", ",", "\"", "${", "1", "+", "1", "}", "\")", ";", "}", "})", ";", "stack", ".", "push", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "foo", "\"", ",", "\"", "${", "1", "+", "1", "}", "\")", ";", "put", "(", "\"", "bar", "\"", ",", "\"", "${", "${", "1", "+", "2", "}", "}\"", ");", "}", "})", ";", "Object", "s", "=", "TextParseUtil", ".", "translateVariables", "(", "'$", "',", "\"", "foo", ":", "$", "{", "foo", "}", "\",", "stack", ",", "String", ".", "class", ",", "null", ",", "2", ")", ";", "assertEquals", "(", "\"", "foo", ":", "2", "\"", ",", "s", ")", ";", "s", "=", "TextParseUtil", ".", "translateVariables", "(", "'$", "',", "\"", "foo", ":", "$", "{", "bar", "}", "\",", "stack", ",", "String", ".", "class", ",", "null", ",", "1", ")", ";", "assertEquals", "(", "\"", "foo", ":", "$", "{$", "{", "1", "+", "2", "}", "}\"", ",", "s", ")", ";", "}", "public", "void", "testTranslateVariablesWithNull", "(", ")", "{"], "docstring_tokens": ["via", "a", "request", "with", "a", "crafted", "value", "that", "contains", "both", "\"${}\"", "and", "\"%{}\"", "sequences"]}
{"contents": ["Fix", "object", "pollution", "vulnerability", "in", "`math.config`"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "10", "@", "@", "#", "History", "#", "not", "yet", "published", ",", "version", "7", ".", "5", ".", "1", "-", "Fix", "object", "pollution", "vulnerability", "in", "`", "math", ".", "config", "`", ".", "Thanks", "Snyk", ".", "#", "2020", "-", "10", "-", "07", ",", "version", "7", ".", "5", ".", "0", "-", "Function", "`", "pickRandom", "`", "now", "allows", "randomly", "picking", "elements", "from", "matrices", "@", "@", "-", "86", ",", "7", "+", "86", ",", "9", "@", "@", "export", "function", "deepExtend", "(", "a", ",", "b", ")", "{", "}", "for", "(", "const", "prop", "in", "b", ")", "{", "if", "(", "hasOwnProperty", "(", "b", ",", "prop", ")", ")", "{", "/", "/", "We", "check", "against", "prop", "not", "being", "in", "Object", ".", "prototype", "or", "Function", ".", "prototype", "/", "/", "to", "prevent", "polluting", "for", "example", "Object", ".", "__proto__", ".", "if", "(", "hasOwnProperty", "(", "b", ",", "prop", ")", "&", "&", "!", "(", "prop", "in", "Object", ".", "prototype", ")", "&", "&", "!", "(", "prop", "in", "Function", ".", "prototype", ")", ")", "{", "if", "(", "b", "[", "prop", "]", "&", "&", "b", "[", "prop", "]", ".", "constructor", "=", "==", "Object", ")", "{", "if", "(", "a", "[", "prop", "]", "=", "==", "undefined", ")", "{", "a", "[", "prop", "]", "=", "{", "}", "@", "@", "-", "390", ",", "6", "+", "390", ",", "34", "@", "@", "describe", "(", "'", "security", "'", ",", "function", "(", ")", "{", "assert", ".", "strictEqual", "(", "math", ".", "expression", ".", "mathWithTransform", ".", "chain", ",", "undefined", ")", "assert", ".", "deepStrictEqual", "(", "math", ".", "evaluate", "(", "'", "chain", "'", "),", "math", ".", "unit", "(", "'", "chain", "'", "))", "}", ")", "it", "(", "'", "should", "not", "allow", "polluting", "the", "Object", "prototype", "via", "config", "'", ",", "(", ")", "=", ">", "{", "const", "obj", "=", "{", "}", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "/", "/", "change", "the", "configuration", "const", "newConfig", "=", "JSON", ".", "parse", "(", "'{", "\"", "__proto__", "\"", ":{", "\"", "polluted", "\"", ":\"", "yes", "\"", "}}", "')", "math", ".", "config", "(", "newConfig", ")", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "}", ")", "it", "(", "'", "should", "not", "allow", "polluting", "the", "Object", "prototype", "via", "config", "via", "the", "expression", "parser", "'", ",", "(", ")", "=", ">", "{", "const", "obj", "=", "{", "}", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "/", "/", "change", "the", "configuration", "math", ".", "evaluate", "(", "'", "config", "(", "{\"", "__proto__", "\"", ":{", "\"", "polluted", "\"", ":\"", "yes", "\"", "}}", ")'", ")", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "}", ")", "it", "(", "'", "should", "not", "allow", "polluting", "the", "Object", "prototype", "by", "creating", "an", "object", "in", "the", "expression", "parser", "'", ",", "(", ")", "=", ">", "{", "const", "obj", "=", "{", "}", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "/", "/", "change", "the", "configuration", "math", ".", "evaluate", "(", "'", "a", "=", "{", "\"", "__proto__", "\"", ":{", "\"", "polluted", "\"", ":\"", "yes", "\"", "}}", "')", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "}", ")", "}", ")", "function", "isPlainObject", "(", "object", ")", "{", "@", "@", "-", "141", ",", "6", "+", "141", ",", "14", "@", "@", "describe", "(", "'", "object", "'", ",", "function", "(", ")", "{", "delete", "Object", ".", "prototype", ".", "foo", "}", ")", "it", "(", "'", "should", "not", "pollute", "Object", ".", "__proto__", "'", ",", "function", "(", ")", "{", "const", "obj", "=", "{", "}", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "deepExtend", "(", "obj", ",", "JSON", ".", "parse", "(", "'{", "\"", "__proto__", "\"", ":{", "\"", "polluted", "\"", ":\"", "yes", "\"", "}}", "')", ")", "assert", ".", "strictEqual", "(", "obj", ".", "polluted", ",", "undefined", ")", "}", ")", "}", ")", "describe", "(", "'", "deepEqual", "'", ",", "function", "(", ")", "{"], "docstring_tokens": ["via", "the", "deepExtend", "function", "that", "runs", "upon", "configuration", "updates", "."]}
{"contents": ["Fixed", "#2997"], "code_tokens": ["@", "@", "-", "8", ",", "7", "+", "8", ",", "9", "@", "@", "Project", ":", "jackson", "-", "databind", "#", "2986", ":", "Block", "two", "more", "gadget", "types", "(", "commons", "-", "dbcp2", ",", "CVE", "-", "2020", "-", "35490", "/", "CVE", "-", "2020", "-", "35491", ")", "(", "reported", "by", "Al1ex", "@", "knownsec", ")", "#", "2996", ":", "Block", "2", "more", "gadget", "types", "(", "placeholder", ")", "#", "2996", ":", "Block", "2", "more", "gadget", "types", "(", "newrelic", "-", "agent", ")", "(", "reported", "by", "Al1ex", "@", "knownsec", ")", "#", "2997", ":", "Block", "2", "more", "gadget", "types", "(", "tomcat", "/", "naming", "-", "factory", "-", "dbcp", ")", "(", "reported", "by", "Al1ex", "@", "knownsec", ")", "2", ".", "9", ".", "10", ".", "7", "(", "02", "-", "Dec", "-", "2020", ")", "@", "@", "-", "216", ",", "6", "+", "216", ",", "11", "@", "@", "s", ".", "add", "(", "\"", "com", ".", "newrelic", ".", "agent", ".", "deps", ".", "ch", ".", "qos", ".", "logback", ".", "core", ".", "db", ".", "JNDIConnectionSource", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "newrelic", ".", "agent", ".", "deps", ".", "ch", ".", "qos", ".", "logback", ".", "core", ".", "db", ".", "DriverManagerConnectionSource", "\"", ");", "/", "/", "[", "databind", "#", "2997", "]", ":", "tomcat", "/", "naming", "-", "factory", "-", "dbcp", "(", "embedded", "dbcp", "1", ".", "x", ")", "/", "/", "(", "derivative", "of", "#", "2478", ")", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "tomcat", ".", "dbcp", ".", "dbcp", ".", "datasources", ".", "PerUserPoolDataSource", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "tomcat", ".", "dbcp", ".", "dbcp", ".", "datasources", ".", "SharedPoolDataSource", "\"", ");", "DEFAULT_NO_DESER_CLASS_NAMES", "=", "Collections", ".", "unmodifiableSet", "(", "s", ")", ";", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "input"]}
{"contents": ["Fix", "potential", "FSImage", "corruption.", "Contributed", "by", "Ekanth", "Sethuramalingam", "&", "Arpit", "Agarwal.", "(cherry", "picked", "from", "commit", "0a1e922f3d8eca4e852be57124ec1bcafaadb289)"], "code_tokens": ["@", "@", "-", "38", ",", "7", "+", "38", ",", "8", "@", "@", "*", "[", "1", ":", "3", ")", "-", "-", "the", "type", "of", "the", "entry", "(", "AclEntryType", ")", "<", "br", ">", "*", "[", "3", ":", "6", ")", "-", "-", "the", "permission", "of", "the", "entry", "(", "FsAction", ")", "<", "br", ">", "*", "[", "6", ":", "7", ")", "-", "-", "A", "flag", "to", "indicate", "whether", "Named", "entry", "or", "not", "<", "br", ">", "*", "[", "7", ":", "32", ")", "-", "-", "the", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "<", "br", ">", "*", "[", "7", ":", "8", ")", "-", "-", "Reserved", "<", "br", ">", "*", "[", "8", ":", "32", ")", "-", "-", "the", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "<", "br", ">", "*", "string", "in", "the", "StringTableSection", ".", "<", "br", ">", "*", "/", "public", "enum", "AclEntryStatusFormat", "{", "@", "@", "-", "47", ",", "7", "+", "48", ",", "8", "@", "@", "TYPE", "(", "SCOPE", ".", "BITS", ",", "2", ")", ",", "PERMISSION", "(", "TYPE", ".", "BITS", ",", "3", ")", ",", "NAMED_ENTRY_CHECK", "(", "PERMISSION", ".", "BITS", ",", "1", ")", ",", "NAME", "(", "NAMED_ENTRY_CHECK", ".", "BITS", ",", "25", ")", ";", "RESERVED", "(", "NAMED_ENTRY_CHECK", ".", "BITS", ",", "1", ")", ",", "NAME", "(", "RESERVED", ".", "BITS", ",", "24", ")", ";", "private", "final", "LongBitFormat", "BITS", ";", "@", "@", "-", "35", ",", "8", "+", "35", ",", "8", "@", "@", "implements", "LinkedElement", "{", "static", "enum", "PermissionStatusFormat", "{", "MODE", "(", "null", ",", "16", ")", ",", "GROUP", "(", "MODE", ".", "BITS", ",", "25", ")", ",", "USER", "(", "GROUP", ".", "BITS", ",", "23", ")", ";", "GROUP", "(", "MODE", ".", "BITS", ",", "24", ")", ",", "USER", "(", "GROUP", ".", "BITS", ",", "24", ")", ";", "final", "LongBitFormat", "BITS", ";", "@", "@", "-", "27", ",", "25", "+", "27", ",", "56", "@", "@", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Preconditions", ";", "import", "com", ".", "google", ".", "common", ".", "primitives", ".", "Ints", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "util", ".", "LongBitFormat", ";", "/", "**", "*", "Class", "to", "pack", "XAttrs", "into", "byte", "[", "].", "<", "br", ">", "*", "For", "each", "XAttr", ":", "<", "br", ">", "*", "The", "first", "4", "bytes", "represents", "XAttr", "namespace", "and", "name", "<", "br", ">", "*", "[", "0", ":", "3", ")", "-", "XAttr", "namespace", "<", "br", ">", "*", "[", "3", ":", "32", ")", "-", "The", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "*", "[", "3", ":", "8", ")", "-", "Reserved", "<", "br", ">", "*", "[", "8", ":", "32", ")", "-", "The", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "*", "string", "in", "map", "<", "br", ">", "*", "The", "following", "two", "bytes", "represents", "the", "length", "of", "XAttr", "value", "<", "br", ">", "*", "The", "remaining", "bytes", "is", "the", "XAttr", "value", "<", "br", ">", "*", "/", "class", "XAttrFormat", "{", "private", "static", "final", "int", "XATTR_NAMESPACE_MASK", "=", "(", "1", "<", "<", "3", ")", "-", "1", ";", "private", "static", "final", "int", "XATTR_NAMESPACE_OFFSET", "=", "29", ";", "private", "static", "final", "int", "XATTR_NAME_MASK", "=", "(", "1", "<", "<", "29", ")", "-", "1", ";", "private", "static", "final", "int", "XATTR_NAME_ID_MAX", "=", "1", "<", "<", "29", ";", "private", "enum", "XAttrStatusFormat", "{", "NAMESPACE", "(", "null", ",", "3", ")", ",", "RESERVED", "(", "NAMESPACE", ".", "BITS", ",", "5", ")", ",", "NAME", "(", "RESERVED", ".", "BITS", ",", "24", ")", ";", "private", "final", "LongBitFormat", "BITS", ";", "XAttrStatusFormat", "(", "LongBitFormat", "previous", ",", "int", "length", ")", "{", "BITS", "=", "new", "LongBitFormat", "(", "name", "(", "),", "previous", ",", "length", ",", "0", ")", ";", "}", "static", "XAttr", ".", "NameSpace", "getNamespace", "(", "int", "xattrStatus", ")", "{", "int", "ordinal", "=", "(", "int", ")", "NAMESPACE", ".", "BITS", ".", "retrieve", "(", "xattrStatus", ")", ";", "return", "XAttr", ".", "NameSpace", ".", "values", "(", ")[", "ordinal", "]", ";", "}", "static", "String", "getName", "(", "int", "xattrStatus", ")", "{", "int", "id", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "xattrStatus", ")", ";", "return", "XAttrStorage", ".", "getName", "(", "id", ")", ";", "}", "static", "int", "toInt", "(", "XAttr", ".", "NameSpace", "namespace", ",", "String", "name", ")", "{", "long", "xattrStatusInt", "=", "0", ";", "xattrStatusInt", "=", "NAMESPACE", ".", "BITS", ".", "combine", "(", "namespace", ".", "ordinal", "(", "),", "xattrStatusInt", ")", ";", "int", "nid", "=", "XAttrStorage", ".", "getNameSerialNumber", "(", "name", ")", ";", "xattrStatusInt", "=", "NAME", ".", "BITS", ".", "combine", "(", "nid", ",", "xattrStatusInt", ")", ";", "return", "(", "int", ")", "xattrStatusInt", ";", "}", "}", "private", "static", "final", "int", "XATTR_VALUE_LEN_MAX", "=", "1", "<", "<", "16", ";", "private", "static", "final", "XAttr", ".", "NameSpace", "[", "]", "XATTR_NAMESPACE_VALUES", "=", "XAttr", ".", "NameSpace", ".", "values", "(", ");", "/", "**", "*", "Unpack", "byte", "[", "]", "to", "XAttrs", ".", "@", "@", "-", "64", ",", "10", "+", "95", ",", "8", "@", "@", "int", "v", "=", "Ints", ".", "fromBytes", "(", "attrs", "[", "i", "]", ",", "attrs", "[", "i", "+", "1", "]", ",", "attrs", "[", "i", "+", "2", "]", ",", "attrs", "[", "i", "+", "3", "]", ");", "i", "+", "=", "4", ";", "int", "ns", "=", "(", "v", ">", ">", "XATTR_NAMESPACE_OFFSET", ")", "&", "XATTR_NAMESPACE_MASK", ";", "int", "nid", "=", "v", "&", "XATTR_NAME_MASK", ";", "builder", ".", "setNameSpace", "(", "XATTR_NAMESPACE_VALUES", "[", "ns", "]", ");", "builder", ".", "setName", "(", "XAttrStorage", ".", "getName", "(", "nid", ")", ");", "builder", ".", "setNameSpace", "(", "XAttrStatusFormat", ".", "getNamespace", "(", "v", ")", ");", "builder", ".", "setName", "(", "XAttrStatusFormat", ".", "getName", "(", "v", ")", ");", "int", "vlen", "=", "(", "(", "0xff", "&", "attrs", "[", "i", "]", ")", "<", "<", "8", ")", "|", "(", "0xff", "&", "attrs", "[", "i", "+", "1", "]", ");", "i", "+", "=", "2", ";", "if", "(", "vlen", ">", "0", ")", "{", "@", "@", "-", "100", ",", "10", "+", "129", ",", "8", "@", "@", "static", "XAttr", "getXAttr", "(", "byte", "[", "]", "attrs", ",", "String", "prefixedName", ")", "{", "int", "v", "=", "Ints", ".", "fromBytes", "(", "attrs", "[", "i", "]", ",", "attrs", "[", "i", "+", "1", "]", ",", "attrs", "[", "i", "+", "2", "]", ",", "attrs", "[", "i", "+", "3", "]", ");", "i", "+", "=", "4", ";", "int", "ns", "=", "(", "v", ">", ">", "XATTR_NAMESPACE_OFFSET", ")", "&", "XATTR_NAMESPACE_MASK", ";", "int", "nid", "=", "v", "&", "XATTR_NAME_MASK", ";", "XAttr", ".", "NameSpace", "namespace", "=", "XATTR_NAMESPACE_VALUES", "[", "ns", "]", ";", "String", "name", "=", "XAttrStorage", ".", "getName", "(", "nid", ")", ";", "XAttr", ".", "NameSpace", "namespace", "=", "XAttrStatusFormat", ".", "getNamespace", "(", "v", ")", ";", "String", "name", "=", "XAttrStatusFormat", ".", "getName", "(", "v", ")", ";", "int", "vlen", "=", "(", "(", "0xff", "&", "attrs", "[", "i", "]", ")", "<", "<", "8", ")", "|", "(", "0xff", "&", "attrs", "[", "i", "+", "1", "]", ");", "i", "+", "=", "2", ";", "if", "(", "xAttr", ".", "getNameSpace", "(", ")", "=", "=", "namespace", "&", "&", "@", "@", "-", "134", ",", "15", "+", "161", ",", "7", "@", "@", "static", "XAttr", "getXAttr", "(", "byte", "[", "]", "attrs", ",", "String", "prefixedName", ")", "{", "ByteArrayOutputStream", "out", "=", "new", "ByteArrayOutputStream", "(", ");", "try", "{", "for", "(", "XAttr", "a", ":", "xAttrs", ")", "{", "int", "nsOrd", "=", "a", ".", "getNameSpace", "(", ").", "ordinal", "(", ");", "Preconditions", ".", "checkArgument", "(", "nsOrd", "<", "8", ",", "\"", "Too", "many", "namespaces", ".", "\")", ";", "int", "nid", "=", "XAttrStorage", ".", "getNameSerialNumber", "(", "a", ".", "getName", "(", "))", ";", "Preconditions", ".", "checkArgument", "(", "nid", "<", "XATTR_NAME_ID_MAX", ",", "\"", "Too", "large", "serial", "number", "of", "the", "xattr", "name", "\"", ");", "/", "/", "big", "-", "endian", "int", "v", "=", "(", "(", "nsOrd", "&", "XATTR_NAMESPACE_MASK", ")", "<", "<", "XATTR_NAMESPACE_OFFSET", ")", "|", "(", "nid", "&", "XATTR_NAME_MASK", ")", ";", "int", "v", "=", "XAttrStatusFormat", ".", "toInt", "(", "a", ".", "getNameSpace", "(", "),", "a", ".", "getName", "(", "))", ";", "out", ".", "write", "(", "Ints", ".", "toByteArray", "(", "v", ")", ");", "int", "vlen", "=", "a", ".", "getValue", "(", ")", "=", "=", "null", "?", "0", ":", "a", ".", "getValue", "(", ").", "length", ";", "Preconditions", ".", "checkArgument", "(", "vlen", "<", "XATTR_VALUE_LEN_MAX", ","], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["[PATCH]", "hrtimer:", "prevent", "overrun", "DoS", "in", "hrtimer_forward()", "hrtimer_forward()", "does", "not", "check", "for", "the", "possible", "overflow", "of", "timer->expires.", "This", "can", "happen", "on", "64", "bit", "machines", "with", "large", "interval", "values", "and", "results", "currently", "in", "an", "endless", "loop", "in", "the", "softirq", "because", "the", "expiry", "value", "becomes", "negative", "and", "therefor", "the", "timer", "is", "expired", "all", "the", "time.", "Check", "for", "this", "condition", "and", "set", "the", "expiry", "value", "to", "the", "max.", "expiry", "time", "in", "the", "future.", "The", "fix", "should", "be", "applied", "to", "stable", "kernel", "series", "as", "well.", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Acked-by:", "Ingo", "Molnar", "<mingo@elte.hu>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "644", ",", "6", "+", "644", ",", "12", "@", "@", "hrtimer_forward", "(", "struct", "hrtimer", "*", "timer", ",", "ktime_t", "now", ",", "ktime_t", "interval", ")", "orun", "+", "+;", "}", "timer", "-", ">", "expires", "=", "ktime_add", "(", "timer", "-", ">", "expires", ",", "interval", ")", ";", "/", "*", "*", "Make", "sure", ",", "that", "the", "result", "did", "not", "wrap", "with", "a", "very", "large", "*", "interval", ".", "*", "/", "if", "(", "timer", "-", ">", "expires", ".", "tv64", "<", "0", ")", "timer", "-", ">", "expires", "=", "ktime_set", "(", "KTIME_SEC_MAX", ",", "0", ")", ";", "return", "orun", ";", "}"], "docstring_tokens": ["using"]}
{"contents": ["HID:", "logitech:", "fix", "bounds", "checking", "on", "LED", "report", "size", "The", "check", "on", "report", "size", "for", "REPORT_TYPE_LEDS", "in", "logi_dj_ll_raw_request()", "is", "wrong;", "the", "current", "check", "doesn't", "make", "any", "sense", "--", "the", "report", "allocated", "by", "HID", "core", "in", "hid_hw_raw_request()", "can", "be", "much", "larger", "than", "DJREPORT_SHORT_LENGTH,", "and", "currently", "logi_dj_ll_raw_request()", "doesn't", "handle", "this", "properly", "at", "all.", "Fix", "the", "check", "by", "actually", "trimming", "down", "the", "report", "size", "properly", "if", "it", "is", "too", "large.", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Ben", "Hawkes", "<hawkes@google.com>", "Reviewed-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["@", "@", "-", "557", ",", "7", "+", "557", ",", "7", "@", "@", "static", "int", "logi_dj_ll_raw_request", "(", "struct", "hid_device", "*", "hid", ",", "if", "(", "!", "out_buf", ")", "return", "-", "ENOMEM", ";", "if", "(", "count", "<", "DJREPORT_SHORT_LENGTH", "-", "2", ")", "if", "(", "count", ">", "DJREPORT_SHORT_LENGTH", "-", "2", ")", "count", "=", "DJREPORT_SHORT_LENGTH", "-", "2", ";", "out_buf", "[", "0", "]", "=", "REPORT_ID_DJ_SHORT", ";"], "docstring_tokens": ["via", "a", "crafted", "device", "that", "specifies", "a", "large", "report", "size", "for", "an", "LED", "report", "."]}
{"contents": ["Fixed", "a", "security", "issue", "in", "`typed-function`", "allowing", "arbitrary", "code", "execution"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "9", "@", "@", "#", "#", "not", "yet", "released", ",", "version", "3", ".", "17", ".", "0", "-", "Improved", "`", "simplify", "`", "for", "nested", "exponentiations", ".", "Thanks", "@", "IvanVergiliev", ".", "-", "Fixed", "a", "security", "issue", "in", "`", "typed", "-", "function", "`", "allowing", "arbitrary", "code", "execution", "in", "the", "JavaScript", "engine", "by", "creating", "a", "typed", "function", "with", "JavaScript", "code", "in", "the", "name", ".", "Thanks", "Masato", "Kinugawa", ".", "#", "#", "2017", "-", "10", "-", "18", ",", "version", "3", ".", "16", ".", "5", "@", "@", "-", "592", ",", "7", "+", "592", ",", "7", "@", "@", "function", "factory", "(", "type", ",", "config", ",", "load", ",", "typed", ")", "{", "value", "=", "parseAssignment", "(", ");", "return", "new", "AssignmentNode", "(", "node", ".", "object", ",", "node", ".", "index", ",", "value", ")", ";", "}", "else", "if", "(", "type", ".", "isFunctionNode", "(", "node", ")", ")", "{", "else", "if", "(", "type", ".", "isFunctionNode", "(", "node", ")", "&", "&", "type", ".", "isSymbolNode", "(", "node", ".", "fn", ")", ")", "{", "/", "/", "parse", "function", "assignment", "like", "'", "f", "(", "x", ")", "=", "x", "^", "2", "'", "valid", "=", "true", ";", "args", "=", "[", "];", "@", "@", "-", "93", ",", "7", "+", "93", ",", "7", "@", "@", "\"", "javascript", "-", "natural", "-", "sort", "\"", ":", "\"", "0", ".", "7", ".", "1", "\"", ",", "\"", "seed", "-", "random", "\"", ":", "\"", "2", ".", "2", ".", "0", "\"", ",", "\"", "tiny", "-", "emitter", "\"", ":", "\"", "2", ".", "0", ".", "0", "\"", ",", "\"", "typed", "-", "function", "\"", ":", "\"", "0", ".", "10", ".", "5", "\"", "\"", "typed", "-", "function", "\"", ":", "\"", "0", ".", "10", ".", "6", "\"", "}", ",", "\"", "devDependencies", "\"", ":", "{", "\"", "benchmark", "\"", ":", "\"", "2", ".", "1", ".", "4", "\"", ",", "@", "@", "-", "812", ",", "6", "+", "812", ",", "13", "@", "@", "describe", "(", "'", "parse", "'", ",", "function", "(", ")", "{", "assert", ".", "equal", "(", "obj", ".", "f", "(", "2", ")", ",", "4", ")", ";", "}", ");", "it", "(", "'", "should", "not", "parse", "a", "function", "assignment", "in", "an", "accessor", "node", "'", ",", "function", "(", ")", "{", "assert", ".", "throws", "(", "function", "(", ")", "{", "var", "scope", "=", "{", "}", "var", "obj", "=", "parseAndEval", "(", "'", "a", "[", "\"", "b", "\"", "](", "x", ")", "=", "x", "^", "2", "'", ",", "scope", ")", ";", "}", ",", "/", "SyntaxError", ":", "Invalid", "left", "hand", "side", "of", "assignment", "operator", "=", "/)", "}", ");", "it", "(", "'", "should", "parse", "an", "object", "containing", "a", "variable", "assignment", "'", ",", "function", "(", ")", "{", "var", "scope", "=", "{", "};", "assert", ".", "deepEqual", "(", "parseAndEval", "(", "'{", "f", ":", "a", "=", "42", "}", "',", "scope", ")", ",", "{", "f", ":", "42", "}", ");", "@", "@", "-", "288", ",", "6", "+", "288", ",", "24", "@", "@", "describe", "(", "'", "security", "'", ",", "function", "(", ")", "{", "}", ",", "/", "Undefined", "symbol", "Chain", "/", ");", "}", ")", "it", "(", "'", "should", "not", "allow", "passing", "a", "function", "name", "containg", "bad", "contents", "'", ",", "function", "(", ")", "{", "/", "/", "underlying", "issues", "where", ":", "/", "/", "the", "input", "'", "[]", "[\"", "fn", "\"", "](", ")=", "0", "'", "/", "/", "-", "defines", "a", "function", "in", "the", "root", "scope", ",", "but", "this", "shouldn", "'", "t", "be", "allowed", "syntax", "/", "/", "-", "there", "is", "a", "typed", "function", "created", "which", "unsecurely", "evaluates", "JS", "code", "with", "the", "function", "name", "in", "it", "/", "/", "-", ">", "when", "the", "function", "name", "contains", "JS", "code", "it", "can", "be", "executed", ",", "example", ":", "/", "/", "/", "/", "var", "fn", "=", "typed", "(", "\"(", "){", "}+", "console", ".", "log", "(", "`", "hacked", ".", "..", "`)", ";", "function", "a", "\"", ",", "{", "\"", "\":", "function", "(", ")", "{", "}", "}", ")", "assert", ".", "throws", "(", "function", "(", ")", "{", "math", ".", "eval", "(", "'[", "][", "\"(", "){", "}+", "console", ".", "log", "(", "`", "hacked", ".", "..", "`)", ";", "function", "a", "\"", "](", ")=", "0", "'", ")", "}", ",", "/", "SyntaxError", ":", "Invalid", "left", "hand", "side", "of", "assignment", "operator", "=", "/)", ";", "assert", ".", "throws", "(", "function", "(", ")", "{", "math", ".", "eval", "(", "'{", "}[", "\"(", "){", "}+", "console", ".", "log", "(", "`", "hacked", ".", "..", "`)", ";", "function", "a", "\"", "](", ")=", "0", "'", ")", "}", ",", "/", "SyntaxError", ":", "Invalid", "left", "hand", "side", "of", "assignment", "operator", "=", "/)", ";", "}", ")", "it", "(", "'", "should", "allow", "calling", "functions", "on", "math", "'", ",", "function", "(", ")", "{", "assert", ".", "equal", "(", "math", ".", "eval", "(", "'", "sqrt", "(", "4", ")", "')", ",", "2", ")", ";", "}", ")"], "docstring_tokens": ["using", "a", "specially-crafted", "input", "in", "the", "name", "value"]}
{"contents": ["Bluetooth:", "HCI", "-", "Fix", "info", "leak", "via", "getsockname()", "The", "HCI", "code", "fails", "to", "initialize", "the", "hci_channel", "member", "of", "struct", "sockaddr_hci", "and", "that", "for", "leaks", "two", "bytes", "kernel", "stack", "via", "the", "getsockname()", "syscall.", "Initialize", "hci_channel", "with", "0", "to", "avoid", "the", "info", "leak.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Cc:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Cc:", "Gustavo", "Padovan", "<gustavo@padovan.org>", "Cc:", "Johan", "Hedberg", "<johan.hedberg@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "694", ",", "6", "+", "694", ",", "7", "@", "@", "static", "int", "hci_sock_getname", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "addr", ",", "*", "addr_len", "=", "sizeof", "(", "*", "haddr", ")", ";", "haddr", "-", ">", "hci_family", "=", "AF_BLUETOOTH", ";", "haddr", "-", ">", "hci_dev", "=", "hdev", "-", ">", "id", ";", "haddr", "-", ">", "hci_channel", "=", "0", ";", "release_sock", "(", "sk", ")", ";", "return", "0", ";"], "docstring_tokens": ["getsockname"]}
{"contents": ["RDMA/cma:", "Fix", "crash", "in", "request", "handlers", "Doug", "Ledford", "and", "Red", "Hat", "reported", "a", "crash", "when", "running", "the", "rdma_cm", "on", "a", "real-time", "OS.", "The", "crash", "has", "the", "following", "call", "trace:", "cm_process_work", "cma_req_handler", "cma_disable_callback", "rdma_create_id", "kzalloc", "init_completion", "cma_get_net_info", "cma_save_net_info", "cma_any_addr", "cma_zero_addr", "rdma_translate_ip", "rdma_copy_addr", "cma_acquire_dev", "rdma_addr_get_sgid", "ib_find_cached_gid", "cma_attach_to_dev", "ucma_event_handler", "kzalloc", "ib_copy_ah_attr_to_user", "cma_comp", "[", "preempted", "]", "cma_write", "copy_from_user", "ucma_destroy_id", "copy_from_user", "_ucma_find_context", "ucma_put_ctx", "ucma_free_ctx", "rdma_destroy_id", "cma_exch", "cma_cancel_operation", "rdma_node_get_transport", "rt_mutex_slowunlock", "bad_area_nosemaphore", "oops_enter", "They", "were", "able", "to", "reproduce", "the", "crash", "multiple", "times", "with", "the", "following", "details:", "Crash", "seems", "to", "always", "happen", "on", "the:", "mutex_unlock(&conn_id->handler_mutex);", "as", "conn_id", "looks", "to", "have", "been", "freed", "during", "this", "code", "path.", "An", "examination", "of", "the", "code", "shows", "that", "a", "race", "exists", "in", "the", "request", "handlers.", "When", "a", "new", "connection", "request", "is", "received,", "the", "rdma_cm", "allocates", "a", "new", "connection", "identifier.", "This", "identifier", "has", "a", "single", "reference", "count", "on", "it.", "If", "a", "user", "calls", "rdma_destroy_id()", "from", "another", "thread", "after", "receiving", "a", "callback,", "rdma_destroy_id", "will", "proceed", "to", "destroy", "the", "id", "and", "free", "the", "associated", "memory.", "However,", "the", "request", "handlers", "may", "still", "be", "in", "the", "process", "of", "running.", "When", "control", "returns", "to", "the", "request", "handlers,", "they", "can", "attempt", "to", "access", "the", "newly", "created", "identifiers.", "Fix", "this", "by", "holding", "a", "reference", "on", "the", "newly", "created", "rdma_cm_id", "until", "the", "request", "handler", "is", "through", "accessing", "it.", "Signed-off-by:", "Sean", "Hefty", "<sean.hefty@intel.com>", "Acked-by:", "Doug", "Ledford", "<dledford@redhat.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Roland", "Dreier", "<roland@purestorage.com>"], "code_tokens": ["@", "@", "-", "1210", ",", "6", "+", "1210", ",", "11", "@", "@", "static", "int", "cma_req_handler", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_event", "*", "ib_event", ")", "cm_id", "-", ">", "context", "=", "conn_id", ";", "cm_id", "-", ">", "cm_handler", "=", "cma_ib_handler", ";", "/", "*", "*", "Protect", "against", "the", "user", "destroying", "conn_id", "from", "another", "thread", "*", "until", "we", "'", "re", "done", "accessing", "it", ".", "*", "/", "atomic_inc", "(", "&", "conn_id", "-", ">", "refcount", ")", ";", "ret", "=", "conn_id", "-", ">", "id", ".", "event_handler", "(", "&", "conn_id", "-", ">", "id", ",", "&", "event", ")", ";", "if", "(", "!", "ret", ")", "{", "/", "*", "@", "@", "-", "1222", ",", "8", "+", "1227", ",", "10", "@", "@", "static", "int", "cma_req_handler", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_event", "*", "ib_event", ")", "ib_send_cm_mra", "(", "cm_id", ",", "CMA_CM_MRA_SETTING", ",", "NULL", ",", "0", ")", ";", "mutex_unlock", "(", "&", "lock", ")", ";", "mutex_unlock", "(", "&", "conn_id", "-", ">", "handler_mutex", ")", ";", "cma_deref_id", "(", "conn_id", ")", ";", "goto", "out", ";", "}", "cma_deref_id", "(", "conn_id", ")", ";", "/", "*", "Destroy", "the", "CM", "ID", "by", "returning", "a", "non", "-", "zero", "value", ".", "*", "/", "conn_id", "-", ">", "cm_id", ".", "ib", "=", "NULL", ";", "@", "@", "-", "1425", ",", "17", "+", "1432", ",", "25", "@", "@", "static", "int", "iw_conn_req_handler", "(", "struct", "iw_cm_id", "*", "cm_id", ",", "event", ".", "param", ".", "conn", ".", "private_data_len", "=", "iw_event", "-", ">", "private_data_len", ";", "event", ".", "param", ".", "conn", ".", "initiator_depth", "=", "attr", ".", "max_qp_init_rd_atom", ";", "event", ".", "param", ".", "conn", ".", "responder_resources", "=", "attr", ".", "max_qp_rd_atom", ";", "/", "*", "*", "Protect", "against", "the", "user", "destroying", "conn_id", "from", "another", "thread", "*", "until", "we", "'", "re", "done", "accessing", "it", ".", "*", "/", "atomic_inc", "(", "&", "conn_id", "-", ">", "refcount", ")", ";", "ret", "=", "conn_id", "-", ">", "id", ".", "event_handler", "(", "&", "conn_id", "-", ">", "id", ",", "&", "event", ")", ";", "if", "(", "ret", ")", "{", "/", "*", "User", "wants", "to", "destroy", "the", "CM", "ID", "*", "/", "conn_id", "-", ">", "cm_id", ".", "iw", "=", "NULL", ";", "cma_exch", "(", "conn_id", ",", "CMA_DESTROYING", ")", ";", "mutex_unlock", "(", "&", "conn_id", "-", ">", "handler_mutex", ")", ";", "cma_deref_id", "(", "conn_id", ")", ";", "rdma_destroy_id", "(", "&", "conn_id", "-", ">", "id", ")", ";", "goto", "out", ";", "}", "mutex_unlock", "(", "&", "conn_id", "-", ">", "handler_mutex", ")", ";", "cma_deref_id", "(", "conn_id", ")", ";", "out", ":", "if", "(", "dev", ")"], "docstring_tokens": ["sending", "a", "specially-crafted", "InfiniBand", "request"]}
{"contents": ["random:", "fix", "bound", "check", "ordering", "(", ")", "If", "root", "raised", "the", "default", "wakeup", "threshold", "over", "the", "size", "of", "the", "output", "pool,", "the", "pool", "transfer", "function", "could", "overflow", "the", "stack", "with", "RNG", "bytes,", "causing", "a", "DoS", "or", "potential", "privilege", "escalation.", "(Bug", "reported", "by", "the", "PaX", "Team", "<pageexec@freemail.hu>)", "Cc:", "Theodore", "Tso", "<tytso@mit.edu>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Signed-off-by:", "Matt", "Mackall", "<mpm@selenic.com>", "Signed-off-by:", "Chris", "Wright", "<chrisw@sous-sol.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "693", ",", "9", "+", "693", ",", "14", "@", "@", "static", "void", "xfer_secondary_pool", "(", "struct", "entropy_store", "*", "r", ",", "size_t", "nbytes", ")", "if", "(", "r", "-", ">", "pull", "&", "&", "r", "-", ">", "entropy_count", "<", "nbytes", "*", "8", "&", "&", "r", "-", ">", "entropy_count", "<", "r", "-", ">", "poolinfo", "-", ">", "POOLBITS", ")", "{", "int", "bytes", "=", "max_t", "(", "int", ",", "random_read_wakeup_thresh", "/", "8", ",", "min_t", "(", "int", ",", "nbytes", ",", "sizeof", "(", "tmp", ")", "))", ";", "/", "*", "If", "we", "'", "re", "limited", ",", "always", "leave", "two", "wakeup", "worth", "'", "s", "BITS", "*", "/", "int", "rsvd", "=", "r", "-", ">", "limit", "?", "0", ":", "random_read_wakeup_thresh", "/", "4", ";", "int", "bytes", "=", "nbytes", ";", "/", "*", "pull", "at", "least", "as", "many", "as", "BYTES", "as", "wakeup", "BITS", "*", "/", "bytes", "=", "max_t", "(", "int", ",", "bytes", ",", "random_read_wakeup_thresh", "/", "8", ")", ";", "/", "*", "but", "never", "more", "than", "the", "buffer", "size", "*", "/", "bytes", "=", "min_t", "(", "int", ",", "bytes", ",", "sizeof", "(", "tmp", ")", ");", "DEBUG_ENT", "(", "\"", "going", "to", "reseed", "%", "s", "with", "%", "d", "bits", "\"", "\"", "(%", "d", "of", "%", "d", "requested", ")", "\\", "n", "\"", ","], "docstring_tokens": ["by"]}
{"contents": ["KEYS:", "add", "missing", "permission", "check", "for", "request_key()", "destination", "When", "the", "request_key()", "syscall", "is", "not", "passed", "a", "destination", "keyring,", "it", "links", "the", "requested", "key", "(if", "constructed)", "into", "the", "\"default\"", "request-key", "keyring.", "This", "should", "require", "Write", "permission", "to", "the", "keyring.", "However,", "there", "is", "actually", "no", "permission", "check.", "This", "can", "be", "abused", "to", "add", "keys", "to", "any", "keyring", "to", "which", "only", "Search", "permission", "is", "granted.", "This", "is", "because", "Search", "permission", "allows", "joining", "the", "keyring.", "keyctl_set_reqkey_keyring(KEY_REQKEY_DEFL_SESSION_KEYRING)", "then", "will", "set", "the", "default", "request-key", "keyring", "to", "the", "session", "keyring.", "Then,", "request_key()", "can", "be", "used", "to", "add", "keys", "to", "the", "keyring.", "Both", "negatively", "and", "positively", "instantiated", "keys", "can", "be", "added", "using", "this", "method.", "Adding", "negative", "keys", "is", "trivial.", "Adding", "a", "positive", "key", "is", "a", "bit", "trickier.", "It", "requires", "that", "either", "/sbin/request-key", "positively", "instantiates", "the", "key,", "or", "that", "another", "thread", "adds", "the", "key", "to", "the", "process", "keyring", "at", "just", "the", "right", "time,", "such", "that", "request_key()", "misses", "it", "initially", "but", "then", "finds", "it", "in", "construct_alloc_key().", "Fix", "this", "bug", "by", "checking", "for", "Write", "permission", "to", "the", "keyring", "in", "construct_get_dest_keyring()", "when", "the", "default", "keyring", "is", "being", "used.", "We", "don't", "do", "the", "permission", "check", "for", "non-default", "keyrings", "because", "that", "was", "already", "done", "by", "the", "earlier", "call", "to", "lookup_user_key().", "Also,", "request_key_and_link()", "is", "currently", "passed", "a", "'struct", "key", "*'", "rather", "than", "a", "key_ref_t,", "so", "the", "\"possessed\"", "bit", "is", "unavailable.", "We", "also", "don't", "do", "the", "permission", "check", "for", "the", "\"requestor", "keyring\",", "to", "continue", "to", "support", "the", "use", "case", "described", "by", "commit", "8bbf4976b59f", "(\"KEYS:", "Alter", "use", "of", "key", "instantiation", "link-to-keyring", "argument\")", "where", "/sbin/request-key", "recursively", "calls", "request_key()", "to", "add", "keys", "to", "the", "original", "requestor's", "destination", "keyring.", "(I", "don't", "know", "of", "any", "users", "who", "actually", "do", "that,", "though...)", "Fixes:", "3e30148c3d52", "(\"[PATCH]", "Keys:", "Make", "request-key", "create", "an", "authorisation", "key\")", "Cc:", "<stable@vger.kernel.org>", "#", "v2.6.13+", "Signed-off-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>"], "code_tokens": ["@", "@", "-", "251", ",", "11", "+", "251", ",", "12", "@", "@", "static", "int", "construct_key", "(", "struct", "key", "*", "key", ",", "const", "void", "*", "callout_info", ",", "*", "The", "keyring", "selected", "is", "returned", "with", "an", "extra", "reference", "upon", "it", "which", "the", "*", "caller", "must", "release", ".", "*", "/", "static", "void", "construct_get_dest_keyring", "(", "struct", "key", "*", "*", "_dest_keyring", ")", "static", "int", "construct_get_dest_keyring", "(", "struct", "key", "*", "*", "_dest_keyring", ")", "{", "struct", "request_key_auth", "*", "rka", ";", "const", "struct", "cred", "*", "cred", "=", "current_cred", "(", ");", "struct", "key", "*", "dest_keyring", "=", "*", "_dest_keyring", ",", "*", "authkey", ";", "int", "ret", ";", "kenter", "(", "\"%", "p", "\"", ",", "dest_keyring", ")", ";", "@", "@", "-", "264", ",", "6", "+", "265", ",", "8", "@", "@", "static", "void", "construct_get_dest_keyring", "(", "struct", "key", "*", "*", "_dest_keyring", ")", "/", "*", "the", "caller", "supplied", "one", "*", "/", "key_get", "(", "dest_keyring", ")", ";", "}", "else", "{", "bool", "do_perm_check", "=", "true", ";", "/", "*", "use", "a", "default", "keyring", ";", "falling", "through", "the", "cases", "until", "we", "*", "find", "one", "that", "we", "actually", "have", "*", "/", "switch", "(", "cred", "-", ">", "jit_keyring", ")", "{", "@", "@", "-", "278", ",", "8", "+", "281", ",", "10", "@", "@", "static", "void", "construct_get_dest_keyring", "(", "struct", "key", "*", "*", "_dest_keyring", ")", "dest_keyring", "=", "key_get", "(", "rka", "-", ">", "dest_keyring", ")", ";", "up_read", "(", "&", "authkey", "-", ">", "sem", ")", ";", "if", "(", "dest_keyring", ")", "if", "(", "dest_keyring", ")", "{", "do_perm_check", "=", "false", ";", "break", ";", "}", "}", "case", "KEY_REQKEY_DEFL_THREAD_KEYRING", ":", "@", "@", "-", "314", ",", "11", "+", "319", ",", "29", "@", "@", "static", "void", "construct_get_dest_keyring", "(", "struct", "key", "*", "*", "_dest_keyring", ")", "default", ":", "BUG", "(", ");", "}", "/", "*", "*", "Require", "Write", "permission", "on", "the", "keyring", ".", "This", "is", "essential", "*", "because", "the", "default", "keyring", "may", "be", "the", "session", "keyring", ",", "and", "*", "joining", "a", "keyring", "only", "requires", "Search", "permission", ".", "*", "*", "However", ",", "this", "check", "is", "skipped", "for", "the", "\"", "requestor", "keyring", "\"", "so", "*", "that", "/", "sbin", "/", "request", "-", "key", "can", "itself", "use", "request_key", "(", ")", "to", "add", "*", "keys", "to", "the", "original", "requestor", "'", "s", "destination", "keyring", ".", "*", "/", "if", "(", "dest_keyring", "&", "&", "do_perm_check", ")", "{", "ret", "=", "key_permission", "(", "make_key_ref", "(", "dest_keyring", ",", "1", ")", ",", "KEY_NEED_WRITE", ")", ";", "if", "(", "ret", ")", "{", "key_put", "(", "dest_keyring", ")", ";", "return", "ret", ";", "}", "}", "}", "*", "_dest_keyring", "=", "dest_keyring", ";", "kleave", "(", "\"", "[", "dk", "%", "d", "]", "\",", "key_serial", "(", "dest_keyring", ")", ");", "return", ";", "return", "0", ";", "}", "/", "*", "@", "@", "-", "444", ",", "11", "+", "467", ",", "15", "@", "@", "static", "struct", "key", "*", "construct_key_and_link", "(", "struct", "keyring_search_context", "*", "ctx", ",", "if", "(", "ctx", "-", ">", "index_key", ".", "type", "=", "=", "&", "key_type_keyring", ")", "return", "ERR_PTR", "(", "-", "EPERM", ")", ";", "user", "=", "key_user_lookup", "(", "current_fsuid", "(", "))", ";", "if", "(", "!", "user", ")", "return", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "ret", "=", "construct_get_dest_keyring", "(", "&", "dest_keyring", ")", ";", "if", "(", "ret", ")", "goto", "error", ";", "construct_get_dest_keyring", "(", "&", "dest_keyring", ")", ";", "user", "=", "key_user_lookup", "(", "current_fsuid", "(", "))", ";", "if", "(", "!", "user", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "error_put_dest_keyring", ";", "}", "ret", "=", "construct_alloc_key", "(", "ctx", ",", "dest_keyring", ",", "flags", ",", "user", ",", "&", "key", ")", ";", "key_user_put", "(", "user", ")", ";", "@", "@", "-", "463", ",", "7", "+", "490", ",", "7", "@", "@", "static", "struct", "key", "*", "construct_key_and_link", "(", "struct", "keyring_search_context", "*", "ctx", ",", "}", "else", "if", "(", "ret", "=", "=", "-", "EINPROGRESS", ")", "{", "ret", "=", "0", ";", "}", "else", "{", "goto", "couldnt_alloc_key", ";", "goto", "error_put_dest_keyring", ";", "}", "key_put", "(", "dest_keyring", ")", ";", "@", "@", "-", "473", ",", "8", "+", "500", ",", "9", "@", "@", "static", "struct", "key", "*", "construct_key_and_link", "(", "struct", "keyring_search_context", "*", "ctx", ",", "construction_failed", ":", "key_negate_and_link", "(", "key", ",", "key_negative_timeout", ",", "NULL", ",", "NULL", ")", ";", "key_put", "(", "key", ")", ";", "couldnt_alloc_key", ":", "error_put_dest_keyring", ":", "key_put", "(", "dest_keyring", ")", ";", "error", ":", "kleave", "(", "\"", "=", "%", "d", "\"", ",", "ret", ")", ";", "return", "ERR_PTR", "(", "ret", ")", ";", "}"], "docstring_tokens": ["using", "a", "sequence", "of", "specially-crafted", "system", "calls"]}
{"contents": ["Merge", "pull", "request", "#82", "from", "jenkinsci-cert/security-343", "[SECURITY-343]", "Restrict", "API", "access", "to", "NodeMonitor", "data"], "code_tokens": ["@", "@", "-", "1072", ",", "8", "+", "1072", ",", "10", "@", "@", "public", "String", "getSearchUrl", "(", ")", "{", "@", "Exported", "(", "inline", "=", "true", ")", "public", "Map", "<", "String", "/", "*", "monitor", "name", "*", "/,", "Object", ">", "getMonitorData", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "r", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ";", "for", "(", "NodeMonitor", "monitor", ":", "NodeMonitor", ".", "getAll", "(", "))", "r", ".", "put", "(", "monitor", ".", "getClass", "(", ").", "getName", "(", "),", "monitor", ".", "data", "(", "this", ")", ");", "if", "(", "hasPermission", "(", "CONNECT", ")", ")", "{", "for", "(", "NodeMonitor", "monitor", ":", "NodeMonitor", ".", "getAll", "(", "))", "r", ".", "put", "(", "monitor", ".", "getClass", "(", ").", "getName", "(", "),", "monitor", ".", "data", "(", "this", ")", ");", "}", "return", "r", ";", "}", "@", "@", "-", "27", ",", "6", "+", "27", ",", "8", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "startsWith", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "spy", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "@", "@", "-", "47", ",", "6", "+", "49", ",", "7", "@", "@", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ".", "DummySecurityRealm", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "@", "@", "-", "140", ",", "6", "+", "143", ",", "26", "@", "@", "public", "void", "configXmlPostShouldUpdateNodeConfiguration", "(", ")", "throws", "Exception", "{", "assertThat", "(", "updatedSlave", ".", "getNumExecutors", "(", "),", "equalTo", "(", "42", ")", ");", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "343", "\"", ")", "public", "void", "emptyNodeMonitorDataWithoutConnect", "(", ")", "throws", "Exception", "{", "rule", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "new", "GlobalMatrixAuthorizationStrategy", "(", "))", ";", "assertTrue", "(", "computer", ".", "getMonitorData", "(", ").", "isEmpty", "(", "))", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "343", "\"", ")", "public", "void", "populatedNodeMonitorDataWithConnect", "(", ")", "throws", "Exception", "{", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "rule", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "auth", ".", "add", "(", "Computer", ".", "CONNECT", ",", "\"", "user", "\"", ");", "assertFalse", "(", "computer", ".", "getMonitorData", "(", ").", "isEmpty", "(", "))", ";", "}", "private", "OutputStream", "captureOutput", "(", ")", "throws", "IOException", "{", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", ");"], "docstring_tokens": ["using", "the", "remote", "API"]}
{"contents": ["sparc64:", "Fix", "sun4u", "execute", "bit", "check", "in", "TSB", "I-TLB", "load.", "Thanks", "to", "testcase", "and", "report", "from", "Brad", "Spengler:", "--------------------", "#include", "<stdio.h>", "typedef", "int", "(*", "_wee)(void);", "int", "main(void)", "{", "char", "buf[8]", "=", "{", "'\\x81',", "'\\xc7',", "'\\xe0',", "'\\x08',", "'\\x81',", "'\\xe8',", "'\\x00',", "'\\x00'", "};", "_wee", "wee;", "printf(\"%p\\n\",", "&buf);", "wee", "=", "(_wee)&buf;", "wee();", "return", "0;", "}", "--------------------", "TSB", "I-tlb", "load", "code", "tries", "to", "use", "andcc", "to", "check", "the", "_PAGE_EXEC_4U", "bit,", "but", "that's", "bit", "12", "so", "it", "gets", "sign", "extended", "all", "the", "way", "up", "to", "bit", "63", "and", "the", "test", "nearly", "always", "passes", "as", "a", "result.", "Use", "sethi", "to", "fix", "the", "bug.", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "191", ",", "10", "+", "191", ",", "12", "@", "@", "tsb_dtlb_load", ":", "tsb_itlb_load", ":", "/", "*", "Executable", "bit", "must", "be", "set", ".", "*", "/", "661", ":", "andcc", "%", "g5", ",", "_PAGE_EXEC_4U", ",", "%", "g0", ".", "section", ".", "sun4v_1insn_patch", ",", "\"", "ax", "\"", "661", ":", "sethi", "%", "hi", "(", "_PAGE_EXEC_4U", ")", ",", "%", "g4", "andcc", "%", "g5", ",", "%", "g4", ",", "%", "g0", ".", "section", ".", "sun4v_2insn_patch", ",", "\"", "ax", "\"", ".", "word", "661b", "andcc", "%", "g5", ",", "_PAGE_EXEC_4V", ",", "%", "g0", "nop", ".", "previous", "be", ",", "pn", "%", "xcc", ",", "tsb_do_fault"], "docstring_tokens": ["using", "a", "specially-crafted", "application"]}
{"contents": ["Handle", "close_notify", "as", "standard", "writeErr", "in", "AsyncSSLSocket.", "Summary:", "Fixes", "Reviewed", "By:", "mingtaoy", "Differential", "Revision:", "D18020613", "fbshipit-source-id:", "db82bb250e53f0d225f1280bd67bc74abd417836"], "code_tokens": ["@", "@", "-", "1450", ",", "9", "+", "1450", ",", "6", "@", "@", "AsyncSocket", ":", ":", "WriteResult", "AsyncSSLSocket", ":", ":", "interpretSSLError", "(", "int", "rc", ",", "int", "error", ")", "{", "WRITE_ERROR", ",", "std", ":", ":", "make_unique", "<", "SSLException", ">", "(", "SSLError", ":", ":", "INVALID_RENEGOTIATION", ")", ");", "}", "else", "{", "if", "(", "zero_return", "(", "error", ",", "rc", ",", "errno", ")", ")", "{", "return", "WriteResult", "(", "0", ")", ";", "}", "auto", "errError", "=", "ERR_get_error", "(", ");", "VLOG", "(", "3", ")", "<", "<", "\"", "ERROR", ":", "AsyncSSLSocket", "(", "fd", "=", "\"", "<", "<", "fd_", "<", "<", "\"", ",", "state", "=", "\"", "<", "<", "int", "(", "state_", ")", "<", "<", "\"", ",", "sslState", "=", "\"", "<", "<", "sslState_", "<", "<", "\"", ",", "events", "=", "\"", "<", "<", "eventFlags_", "<", "<", "\"", "):", "\"", "@", "@", "-", "1589", ",", "10", "+", "1586", ",", "7", "@", "@", "AsyncSocket", ":", ":", "WriteResult", "AsyncSSLSocket", ":", ":", "performWrite", "(", "*", "partialWritten", "=", "uint32_t", "(", "offset", ")", ";", "return", "WriteResult", "(", "totalWritten", ")", ";", "}", "auto", "writeResult", "=", "interpretSSLError", "(", "int", "(", "bytes", ")", ",", "error", ")", ";", "if", "(", "writeResult", ".", "writeReturn", "<", "0", ")", "{", "return", "writeResult", ";", "}", "/", "/", "else", "fall", "through", "to", "below", "to", "correctly", "record", "totalWritten", "return", "interpretSSLError", "(", "int", "(", "bytes", ")", ",", "error", ")", ";", "}", "totalWritten", "+", "=", "bytes", ";", "@", "@", "-", "808", ",", "6", "+", "808", ",", "114", "@", "@", "TEST", "(", "AsyncSSLSocketTest", ",", "SSLClientTimeoutTest", ")", "{", "cerr", "<", "<", "\"", "SSLClientTimeoutTest", "test", "completed", "\"", "<", "<", "endl", ";", "}", "class", "PerLoopReadCallback", ":", "public", "AsyncTransportWrapper", ":", ":", "ReadCallback", "{", "public", ":", "void", "getReadBuffer", "(", "void", "*", "*", "bufReturn", ",", "size_t", "*", "lenReturn", ")", "override", "{", "*", "bufReturn", "=", "buf_", ".", "data", "(", ");", "*", "lenReturn", "=", "buf_", ".", "size", "(", ");", "}", "void", "readDataAvailable", "(", "size_t", "len", ")", "noexcept", "override", "{", "VLOG", "(", "3", ")", "<", "<", "\"", "Read", "of", "size", ":", "\"", "<", "<", "len", ";", "s_", "-", ">", "setReadCB", "(", "nullptr", ")", ";", "s_", "-", ">", "getEventBase", "(", ")-", ">", "runInLoop", "(", "[", "this", "]", "()", "{", "s_", "-", ">", "setReadCB", "(", "this", ")", ";", "}", ");", "}", "void", "readErr", "(", "const", "AsyncSocketException", "&", ")", "noexcept", "override", "{", "}", "void", "readEOF", "(", ")", "noexcept", "override", "{", "}", "void", "setSocket", "(", "AsyncSocket", "*", "s", ")", "{", "s_", "=", "s", ";", "}", "private", ":", "AsyncSocket", "*", "s_", ";", "std", ":", ":", "array", "<", "uint8_t", ",", "1000", ">", "buf_", ";", "}", ";", "class", "CloseNotifyConnector", ":", "public", "AsyncSocket", ":", ":", "ConnectCallback", "{", "public", ":", "CloseNotifyConnector", "(", "EventBase", "*", "evb", ",", "const", "SocketAddress", "&", "addr", ")", "{", "evb_", "=", "evb", ";", "ssl_", "=", "AsyncSSLSocket", ":", ":", "newSocket", "(", "std", ":", ":", "make_shared", "<", "SSLContext", ">", "()", ",", "evb_", ")", ";", "ssl_", "-", ">", "connect", "(", "this", ",", "addr", ")", ";", "}", "void", "connectSuccess", "(", ")", "noexcept", "override", "{", "ssl_", "-", ">", "writeChain", "(", "nullptr", ",", "IOBuf", ":", ":", "copyBuffer", "(", "\"", "hi", "\"", "))", ";", "auto", "ssl", "=", "const_cast", "<", "SSL", "*", ">(", "ssl_", "-", ">", "getSSL", "(", "))", ";", "SSL_shutdown", "(", "ssl", ")", ";", "auto", "fd", "=", "ssl_", "-", ">", "detachNetworkSocket", "(", ");", "tcp_", ".", "reset", "(", "new", "AsyncSocket", "(", "evb_", ",", "fd", ")", ",", "AsyncSocket", ":", ":", "Destructor", "(", "))", ";", "evb_", "-", ">", "runAfterDelay", "(", "[", "this", "]", "()", "{", "perLoopReads_", ".", "setSocket", "(", "tcp_", ".", "get", "(", "))", ";", "tcp_", "-", ">", "setReadCB", "(", "&", "perLoopReads_", ")", ";", "evb_", "-", ">", "runAfterDelay", "(", "[", "this", "]", "()", "{", "tcp_", "-", ">", "closeNow", "(", ");", "}", ",", "10", ")", ";", "}", ",", "100", ")", ";", "}", "void", "connectErr", "(", "const", "AsyncSocketException", "&", "ex", ")", "noexcept", "override", "{", "FAIL", "(", ")", "<", "<", "ex", ".", "what", "(", ");", "}", "private", ":", "EventBase", "*", "evb_", ";", "std", ":", ":", "shared_ptr", "<", "AsyncSSLSocket", ">", "ssl_", ";", "std", ":", ":", "shared_ptr", "<", "AsyncSocket", ">", "tcp_", ";", "PerLoopReadCallback", "perLoopReads_", ";", "}", ";", "class", "ErrorCheckingWriteCallback", ":", "public", "AsyncSocket", ":", ":", "WriteCallback", "{", "public", ":", "void", "writeSuccess", "(", ")", "noexcept", "override", "{", "}", "void", "writeErr", "(", "size_t", ",", "const", "AsyncSocketException", "&", "ex", ")", "noexcept", "override", "{", "LOG", "(", "ERROR", ")", "<", "<", "\"", "write", "error", ":", "\"", "<", "<", "ex", ".", "what", "(", ");", "EXPECT_NE", "(", "ex", ".", "getType", "(", "),", "AsyncSocketException", ":", ":", "AsyncSocketExceptionType", ":", ":", "SSL_ERROR", ")", ";", "}", "}", ";", "class", "WriteOnEofReadCallback", ":", "public", "ReadCallback", "{", "public", ":", "using", "ReadCallback", ":", ":", "ReadCallback", ";", "void", "readEOF", "(", ")", "noexcept", "override", "{", "LOG", "(", "INFO", ")", "<", "<", "\"", "Got", "EOF", "\"", ";", "auto", "chain", "=", "IOBuf", ":", ":", "create", "(", "0", ")", ";", "for", "(", "size_t", "i", "=", "0", ";", "i", "<", "1000", "*", "1000", ";", "i", "+", "+)", "{", "auto", "buf", "=", "IOBuf", ":", ":", "create", "(", "10", ")", ";", "buf", "-", ">", "append", "(", "10", ")", ";", "memset", "(", "buf", "-", ">", "writableData", "(", "),", "'", "x", "'", ",", "10", ")", ";", "chain", "-", ">", "prependChain", "(", "std", ":", ":", "move", "(", "buf", ")", ");", "}", "socket_", "-", ">", "writeChain", "(", "&", "writeCallback_", ",", "std", ":", ":", "move", "(", "chain", ")", ");", "}", "void", "readErr", "(", "const", "AsyncSocketException", "&", "ex", ")", "noexcept", "override", "{", "LOG", "(", "ERROR", ")", "<", "<", "ex", ".", "what", "(", ");", "}", "private", ":", "ErrorCheckingWriteCallback", "writeCallback_", ";", "}", ";", "TEST", "(", "AsyncSSLSocketTest", ",", "EarlyCloseNotify", ")", "{", "WriteOnEofReadCallback", "readCallback", "(", "nullptr", ")", ";", "HandshakeCallback", "handshakeCallback", "(", "&", "readCallback", ")", ";", "SSLServerAcceptCallback", "acceptCallback", "(", "&", "handshakeCallback", ")", ";", "TestSSLServer", "server", "(", "&", "acceptCallback", ")", ";", "EventBase", "eventBase", ";", "CloseNotifyConnector", "cnc", "(", "&", "eventBase", ",", "server", ".", "getAddress", "(", "))", ";", "eventBase", ".", "loop", "(", ");", "}", "/", "**", "*", "Verify", "Client", "Ciphers", "obtained", "using", "SSL", "MSG", "Callback", ".", "*", "/", "@", "@", "-", "389", ",", "7", "+", "389", ",", "9", "@", "@", "class", "ReadCallback", ":", "public", "ReadCallbackBase", "{", "currentBuffer", ".", "length", "=", "len", ";", "wcb_", "-", ">", "setSocket", "(", "socket_", ")", ";", "if", "(", "wcb_", ")", "{", "wcb_", "-", ">", "setSocket", "(", "socket_", ")", ";", "}", "/", "/", "Write", "back", "the", "same", "data", ".", "socket_", "-", ">", "write", "(", "wcb_", ",", "currentBuffer", ".", "buffer", ",", "len", ",", "writeFlags", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["cifs:", "Rename", "cifs_strncpy_to_host", "and", "fix", "buffer", "size", "There", "is", "a", "possibility", "for", "the", "path_name", "and", "node_name", "buffers", "to", "overflow", "if", "they", "contain", "charcters", "that", "are", ">2", "bytes", "in", "the", "local", "charset.", "Resize", "the", "buffer", "allocation", "so", "to", "avoid", "this", "possibility.", "Also,", "as", "pointed", "out", "by", "Jeff", "Layton,", "it", "would", "be", "appropriate", "to", "rename", "the", "function", "to", "cifs_strlcpy_to_host", "to", "reflect", "the", "fact", "that", "the", "copied", "string", "is", "always", "NULL", "terminated.", "Signed-off-by:", "Suresh", "Jayaraman", "<sjayaraman@suse.de>", "Acked-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["@", "@", "-", "88", ",", "29", "+", "88", ",", "29", "@", "@", "static", "struct", "{", "*", "on", "failure", "-", "errno", "*", "/", "static", "int", "cifs_strncpy_to_host", "(", "char", "*", "*", "dst", ",", "const", "char", "*", "src", ",", "const", "int", "maxlen", ",", "cifs_strlcpy_to_host", "(", "char", "*", "*", "dst", ",", "const", "char", "*", "src", ",", "const", "int", "maxlen", ",", "const", "bool", "is_unicode", ",", "const", "struct", "nls_table", "*", "nls_codepage", ")", "{", "int", "plen", ";", "if", "(", "is_unicode", ")", "{", "plen", "=", "UniStrnlen", "(", "(", "wchar_t", "*", ")", "src", ",", "maxlen", ")", ";", "*", "dst", "=", "kmalloc", "(", "plen", "+", "2", ",", "GFP_KERNEL", ")", ";", "*", "dst", "=", "kmalloc", "(", "(", "4", "*", "plen", ")", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "!*", "dst", ")", "goto", "cifs_strncpy_to_host_ErrExit", ";", "goto", "cifs_strlcpy_to_host_ErrExit", ";", "cifs_strfromUCS_le", "(", "*", "dst", ",", "(", "__le16", "*", ")", "src", ",", "plen", ",", "nls_codepage", ")", ";", "(", "*", "dst", ")", "[", "plen", "]", "=", "0", ";", "(", "*", "dst", ")", "[", "plen", "+", "1", "]", "=", "0", ";", "/", "*", "needed", "for", "Unicode", "*", "/", "}", "else", "{", "plen", "=", "strnlen", "(", "src", ",", "maxlen", ")", ";", "*", "dst", "=", "kmalloc", "(", "plen", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "!*", "dst", ")", "goto", "cifs_strncpy_to_host_ErrExit", ";", "strncpy", "(", "*", "dst", ",", "src", ",", "plen", ")", ";", "goto", "cifs_strlcpy_to_host_ErrExit", ";", "strlcpy", "(", "*", "dst", ",", "src", ",", "plen", ")", ";", "}", "(", "*", "dst", ")", "[", "plen", "]", "=", "0", ";", "(", "*", "dst", ")", "[", "plen", "+", "1", "]", "=", "0", ";", "/", "*", "harmless", "for", "ASCII", "case", ",", "needed", "for", "Unicode", "*", "/", "return", "0", ";", "cifs_strncpy_to_host_ErrExit", ":", "cifs_strlcpy_to_host_ErrExit", ":", "cERROR", "(", "1", ",", "(", "\"", "Failed", "to", "allocate", "buffer", "for", "string", "\\", "n", "\"", "))", ";", "return", "-", "ENOMEM", ";", "}", "@", "@", "-", "4029", ",", "15", "+", "4029", ",", "15", "@", "@", "parse_DFS_referrals", "(", "TRANSACTION2_GET_DFS_REFER_RSP", "*", "pSMBr", ",", "/", "*", "copy", "DfsPath", "*", "/", "temp", "=", "(", "char", "*", ")", "ref", "+", "le16_to_cpu", "(", "ref", "-", ">", "DfsPathOffset", ")", ";", "max_len", "=", "data_end", "-", "temp", ";", "rc", "=", "cifs_strncpy_to_host", "(", "&(", "node", "-", ">", "path_name", ")", ",", "temp", ",", "rc", "=", "cifs_strlcpy_to_host", "(", "&(", "node", "-", ">", "path_name", ")", ",", "temp", ",", "max_len", ",", "is_unicode", ",", "nls_codepage", ")", ";", "if", "(", "rc", ")", "goto", "parse_DFS_referrals_exit", ";", "/", "*", "copy", "link", "target", "UNC", "*", "/", "temp", "=", "(", "char", "*", ")", "ref", "+", "le16_to_cpu", "(", "ref", "-", ">", "NetworkAddressOffset", ")", ";", "max_len", "=", "data_end", "-", "temp", ";", "rc", "=", "cifs_strncpy_to_host", "(", "&(", "node", "-", ">", "node_name", ")", ",", "temp", ",", "rc", "=", "cifs_strlcpy_to_host", "(", "&(", "node", "-", ">", "node_name", ")", ",", "temp", ",", "max_len", ",", "is_unicode", ",", "nls_codepage", ")", ";", "if", "(", "rc", ")", "goto", "parse_DFS_referrals_exit", ";"], "docstring_tokens": ["sending", "an", "overly", "long", "string", "of", "misaligned", "characters"]}
{"contents": ["Treat", "encrypted", "files", "as", "private.", "Contributed", "by", "Daniel", "Templeton.", "(cherry", "picked", "from", "commit", "f01a69f84f4cc7d925d078a7ce32e5800da4e429)", "(cherry", "picked", "from", "commit", "120f680318d766f44787fd0eec88270d61172523)"], "code_tokens": ["@", "@", "-", "274", ",", "10", "+", "274", ",", "21", "@", "@", "private", "static", "boolean", "checkPermissionOfOther", "(", "FileSystem", "fs", ",", "Path", "path", ",", "FsAction", "action", ",", "Map", "<", "URI", ",", "FileStatus", ">", "statCache", ")", "throws", "IOException", "{", "FileStatus", "status", "=", "getFileStatus", "(", "fs", ",", "path", ".", "toUri", "(", "),", "statCache", ")", ";", "FsPermission", "perms", "=", "status", ".", "getPermission", "(", ");", "FsAction", "otherAction", "=", "perms", ".", "getOtherAction", "(", ");", "if", "(", "otherAction", ".", "implies", "(", "action", ")", ")", "{", "return", "true", ";", "/", "/", "Encrypted", "files", "are", "always", "treated", "as", "private", ".", "This", "stance", "has", "two", "/", "/", "important", "side", "effects", ".", "The", "first", "is", "that", "the", "encrypted", "files", "will", "be", "/", "/", "downloaded", "as", "the", "job", "owner", "instead", "of", "the", "YARN", "user", ",", "which", "is", "required", "/", "/", "for", "the", "KMS", "ACLs", "to", "work", "as", "expected", ".", "Second", ",", "it", "prevent", "a", "file", "with", "/", "/", "world", "readable", "permissions", "that", "is", "stored", "in", "an", "encryption", "zone", "from", "/", "/", "being", "localized", "as", "a", "publicly", "shared", "file", "with", "world", "readable", "/", "/", "permissions", ".", "if", "(", "!", "perms", ".", "getEncryptedBit", "(", "))", "{", "FsAction", "otherAction", "=", "perms", ".", "getOtherAction", "(", ");", "if", "(", "otherAction", ".", "implies", "(", "action", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}"], "docstring_tokens": ["changing", "access", "permission", "to", "world", "readable", "in", "an", "encryption", "zone"]}
{"contents": ["proc:", "restrict", "access", "to", "/proc/PID/io", "/proc/PID/io", "may", "be", "used", "for", "gathering", "private", "information.", "E.g.", "for", "openssh", "and", "vsftpd", "daemons", "wchars/rchars", "may", "be", "used", "to", "learn", "the", "precise", "password", "length.", "Restrict", "it", "to", "processes", "being", "able", "to", "ptrace", "the", "target", "process.", "ptrace_may_access()", "is", "needed", "to", "prevent", "keeping", "open", "file", "descriptor", "of", "\"io\"", "file,", "executing", "setuid", "binary", "and", "gathering", "io", "information", "of", "the", "setuid'ed", "process.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segoon@openwall.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "2708", ",", "6", "+", "2708", ",", "9", "@", "@", "static", "int", "do_io_accounting", "(", "struct", "task_struct", "*", "task", ",", "char", "*", "buffer", ",", "int", "whole", ")", "struct", "task_io_accounting", "acct", "=", "task", "-", ">", "ioac", ";", "unsigned", "long", "flags", ";", "if", "(", "!", "ptrace_may_access", "(", "task", ",", "PTRACE_MODE_READ", ")", ")", "return", "-", "EACCES", ";", "if", "(", "whole", "&", "&", "lock_task_sighand", "(", "task", ",", "&", "flags", ")", ")", "{", "struct", "task_struct", "*", "t", "=", "task", ";", "@", "@", "-", "2839", ",", "7", "+", "2842", ",", "7", "@", "@", "static", "const", "struct", "pid_entry", "tgid_base_stuff", "[", "]", "=", "{", "REG", "(", "\"", "coredump_filter", "\"", ",", "S_IRUGO", "|", "S_IWUSR", ",", "proc_coredump_filter_operations", ")", ",", "#", "endif", "#", "ifdef", "CONFIG_TASK_IO_ACCOUNTING", "INF", "(", "\"", "io", "\"", ",", "S_IRUGO", ",", "proc_tgid_io_accounting", ")", ",", "INF", "(", "\"", "io", "\"", ",", "S_IRUSR", ",", "proc_tgid_io_accounting", ")", ",", "#", "endif", "#", "ifdef", "CONFIG_HARDWALL", "INF", "(", "\"", "hardwall", "\"", ",", "S_IRUGO", ",", "proc_pid_hardwall", ")", ",", "@", "@", "-", "3181", ",", "7", "+", "3184", ",", "7", "@", "@", "static", "const", "struct", "pid_entry", "tid_base_stuff", "[", "]", "=", "{", "REG", "(", "\"", "make", "-", "it", "-", "fail", "\"", ",", "S_IRUGO", "|", "S_IWUSR", ",", "proc_fault_inject_operations", ")", ",", "#", "endif", "#", "ifdef", "CONFIG_TASK_IO_ACCOUNTING", "INF", "(", "\"", "io", "\"", ",", "S_IRUGO", ",", "proc_tid_io_accounting", ")", ",", "INF", "(", "\"", "io", "\"", ",", "S_IRUSR", ",", "proc_tid_io_accounting", ")", ",", "#", "endif", "#", "ifdef", "CONFIG_HARDWALL", "INF", "(", "\"", "hardwall", "\"", ",", "S_IRUGO", ",", "proc_pid_hardwall", ")", ","], "docstring_tokens": ["as", "demonstrated", "by", "discovering", "the", "length", "of", "another", "user's", "password", "."]}
{"contents": ["Ensure", "HTTP/1.1", "processor", "is", "recycled", "after", "a", "direct", "h2c", "connection"], "code_tokens": ["@", "@", "-", "876", ",", "8", "+", "876", ",", "10", "@", "@", "public", "SocketState", "process", "(", "SocketWrapperBase", "<", "S", ">", "wrapper", ",", "SocketEvent", "status", ")", "{", "/", "/", "Assume", "direct", "HTTP", "/", "2", "connection", "UpgradeProtocol", "upgradeProtocol", "=", "getProtocol", "(", ").", "getUpgradeProtocol", "(", "\"", "h2c", "\"", ");", "if", "(", "upgradeProtocol", "!", "=", "null", ")", "{", "processor", "=", "upgradeProtocol", ".", "getProcessor", "(", "wrapper", ",", "getProtocol", "(", ").", "getAdapter", "(", "))", ";", "/", "/", "Release", "the", "Http11", "processor", "to", "be", "re", "-", "used", "release", "(", "processor", ")", ";", "/", "/", "Create", "the", "upgrade", "processor", "processor", "=", "upgradeProtocol", ".", "getProcessor", "(", "wrapper", ",", "getProtocol", "(", ").", "getAdapter", "(", "))", ";", "wrapper", ".", "unRead", "(", "leftOverInput", ")", ";", "/", "/", "Associate", "with", "the", "processor", "with", "the", "connection", "wrapper", ".", "setCurrentProcessor", "(", "processor", ")", ";", "@", "@", "-", "887", ",", "7", "+", "889", ",", "8", "@", "@", "public", "SocketState", "process", "(", "SocketWrapperBase", "<", "S", ">", "wrapper", ",", "SocketEvent", "status", ")", "{", "\"", "abstractConnectionHandler", ".", "negotiatedProcessor", ".", "fail", "\"", ",", "\"", "h2c", "\"", "))", ";", "}", "return", "SocketState", ".", "CLOSED", ";", "/", "/", "Exit", "loop", "and", "trigger", "appropriate", "clean", "-", "up", "state", "=", "SocketState", ".", "CLOSED", ";", "}", "}", "else", "{", "HttpUpgradeHandler", "httpUpgradeHandler", "=", "upgradeToken", ".", "getHttpUpgradeHandler", "(", ");", "@", "@", "-", "107", ",", "6", "+", "107", ",", "10", "@", "@", "<", "fix", ">", "Reduce", "the", "memory", "footprint", "of", "closed", "HTTP", "/", "2", "streams", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Ensure", "that", "the", "HTTP", "/", "1", ".", "1", "processor", "is", "correctly", "recycled", "when", "a", "direct", "connection", "to", "h2c", "is", "made", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Other", "\"", ">"], "docstring_tokens": ["sending", "specially-crafted", "requests"]}
{"contents": ["avcodec/cbs_jpeg:", "Check", "length", "for", "SOS", "Fixes:", "out", "of", "array", "access", "Fixes:", "19734/clusterfuzz-testcase-minimized-ffmpeg_BSF_TRACE_HEADERS_fuzzer-5673507031875584", "Fixes:", "19353/clusterfuzz-testcase-minimized-ffmpeg_BSF_TRACE_HEADERS_fuzzer-5703944462663680", "Found-by:", "continuous", "fuzzing", "process", "https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["@", "@", "-", "197", ",", "6", "+", "197", ",", "9", "@", "@", "static", "int", "cbs_jpeg_split_fragment", "(", "CodedBitstreamContext", "*", "ctx", ",", "if", "(", "marker", "=", "=", "JPEG_MARKER_SOS", ")", "{", "length", "=", "AV_RB16", "(", "frag", "-", ">", "data", "+", "start", ")", ";", "if", "(", "length", ">", "end", "-", "start", ")", "return", "AVERROR_INVALIDDATA", ";", "data_ref", "=", "NULL", ";", "data", "=", "av_malloc", "(", "end", "-", "start", "+", "AV_INPUT_BUFFER_PADDING_SIZE", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially", "crafted", "file"]}
{"contents": ["x86,", "cpu,", "amd:", "Add", "workaround", "for", "family", "16h,", "erratum", "793", "This", "adds", "the", "workaround", "for", "erratum", "793", "as", "a", "precaution", "in", "case", "not", "every", "BIOS", "implements", "it.", "This", "addresses", ".", "Erratum", "text:", "[Revision", "Guide", "for", "AMD", "Family", "16h", "Models", "00h-0Fh", "Processors,", "document", "51810", "Rev.", "3.04", "November", "2013]", "793", "Specific", "Combination", "of", "Writes", "to", "Write", "Combined", "Memory", "Types", "and", "Locked", "Instructions", "May", "Cause", "Core", "Hang", "Description", "Under", "a", "highly", "specific", "and", "detailed", "set", "of", "internal", "timing", "conditions,", "a", "locked", "instruction", "may", "trigger", "a", "timing", "sequence", "whereby", "the", "write", "to", "a", "write", "combined", "memory", "type", "is", "not", "flushed,", "causing", "the", "locked", "instruction", "to", "stall", "indefinitely.", "Potential", "Effect", "on", "System", "Processor", "core", "hang.", "Suggested", "Workaround", "BIOS", "should", "set", "MSR", "C001_1020[15]", "=", "1b.", "Fix", "Planned", "No", "fix", "planned", "[", "hpa:", "updated", "description,", "fixed", "typo", "in", "MSR", "name", "]", "Signed-off-by:", "Borislav", "Petkov", "<bp@suse.de>", "Link:", "http://lkml.kernel.org/r/20140114230711.GS29865@pd.tnic", "Tested-by:", "Aravind", "Gopalakrishnan", "<aravind.gopalakrishnan@amd.com>", "Signed-off-by:", "H.", "Peter", "Anvin", "<hpa@linux.intel.com>"], "code_tokens": ["@", "@", "-", "184", ",", "6", "+", "184", ",", "7", "@", "@", "#", "define", "MSR_AMD64_PATCH_LOADER", "0xc0010020", "#", "define", "MSR_AMD64_OSVW_ID_LENGTH", "0xc0010140", "#", "define", "MSR_AMD64_OSVW_STATUS", "0xc0010141", "#", "define", "MSR_AMD64_LS_CFG", "0xc0011020", "#", "define", "MSR_AMD64_DC_CFG", "0xc0011022", "#", "define", "MSR_AMD64_BU_CFG2", "0xc001102a", "#", "define", "MSR_AMD64_IBSFETCHCTL", "0xc0011030", "@", "@", "-", "508", ",", "6", "+", "508", ",", "16", "@", "@", "static", "void", "early_init_amd", "(", "struct", "cpuinfo_x86", "*", "c", ")", "set_cpu_cap", "(", "c", ",", "X86_FEATURE_EXTD_APICID", ")", ";", "}", "#", "endif", "/", "*", "F16h", "erratum", "793", ",", "CVE", "-", "2013", "-", "6885", "*", "/", "if", "(", "c", "-", ">", "x86", "=", "=", "0x16", "&", "&", "c", "-", ">", "x86_model", "<", "=", "0xf", ")", "{", "u64", "val", ";", "rdmsrl", "(", "MSR_AMD64_LS_CFG", ",", "val", ")", ";", "if", "(", "!(", "val", "&", "BIT", "(", "15", ")", "))", "wrmsrl", "(", "MSR_AMD64_LS_CFG", ",", "val", "|", "BIT", "(", "15", ")", ");", "}", "}", "static", "const", "int", "amd_erratum_383", "[", "];"], "docstring_tokens": ["mount", "a", "denial", "of", "service", "attack", "affecting", "the", "whole", "system"]}
{"contents": ["x86/cpufeatures:", "Add", "X86_BUG_SPECTRE_V[12]", "Add", "the", "bug", "bits", "for", "spectre", "v1/2", "and", "force", "them", "unconditionally", "for", "all", "cpus.", "Signed-off-by:", "David", "Woodhouse", "<dwmw@amazon.co.uk>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "gnomes@lxorguk.ukuu.org.uk", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "Andi", "Kleen", "<ak@linux.intel.com>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Jiri", "Kosina", "<jikos@kernel.org>", "Cc:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Dave", "Hansen", "<dave.hansen@intel.com>", "Cc:", "Kees", "Cook", "<keescook@google.com>", "Cc:", "Tim", "Chen", "<tim.c.chen@linux.intel.com>", "Cc:", "Greg", "Kroah-Hartman", "<gregkh@linux-foundation.org>", "Cc:", "Paul", "Turner", "<pjt@google.com>", "Cc:", "stable@vger.kernel.org", "Link:", "https://lkml.kernel.org/r/1515239374-23361-2-git-send-email-dwmw@amazon.co.uk"], "code_tokens": ["@", "@", "-", "342", ",", "5", "+", "342", ",", "7", "@", "@", "#", "define", "X86_BUG_MONITOR", "X86_BUG", "(", "12", ")", "/", "*", "IPI", "required", "to", "wake", "up", "remote", "CPU", "*", "/", "#", "define", "X86_BUG_AMD_E400", "X86_BUG", "(", "13", ")", "/", "*", "CPU", "is", "among", "the", "affected", "by", "Erratum", "400", "*", "/", "#", "define", "X86_BUG_CPU_MELTDOWN", "X86_BUG", "(", "14", ")", "/", "*", "CPU", "is", "affected", "by", "meltdown", "attack", "and", "needs", "kernel", "page", "table", "isolation", "*", "/", "#", "define", "X86_BUG_SPECTRE_V1", "X86_BUG", "(", "15", ")", "/", "*", "CPU", "is", "affected", "by", "Spectre", "variant", "1", "attack", "with", "conditional", "branches", "*", "/", "#", "define", "X86_BUG_SPECTRE_V2", "X86_BUG", "(", "16", ")", "/", "*", "CPU", "is", "affected", "by", "Spectre", "variant", "2", "attack", "with", "indirect", "branches", "*", "/", "#", "endif", "/", "*", "_ASM_X86_CPUFEATURES_H", "*", "/", "@", "@", "-", "902", ",", "6", "+", "902", ",", "9", "@", "@", "static", "void", "__init", "early_identify_cpu", "(", "struct", "cpuinfo_x86", "*", "c", ")", "if", "(", "c", "-", ">", "x86_vendor", "!", "=", "X86_VENDOR_AMD", ")", "setup_force_cpu_bug", "(", "X86_BUG_CPU_MELTDOWN", ")", ";", "setup_force_cpu_bug", "(", "X86_BUG_SPECTRE_V1", ")", ";", "setup_force_cpu_bug", "(", "X86_BUG_SPECTRE_V2", ")", ";", "fpu__init_system", "(", "c", ")", ";", "#", "ifdef", "CONFIG_X86_32"], "docstring_tokens": ["a", "combination", "of", "new", "microcode", "and", "compiler", "and", "hypervisor", "changes"]}
{"contents": ["Fix", "encrypt", "overflow", "An", "overflow", "can", "occur", "in", "the", "EVP_EncryptUpdate", "function.", "If", "an", "attacker", "is", "able", "to", "supply", "very", "large", "amounts", "of", "input", "data", "after", "a", "previous", "call", "to", "EVP_EncryptUpdate", "with", "a", "partial", "block", "then", "a", "length", "check", "can", "overflow", "resulting", "in", "a", "heap", "corruption.", "Following", "an", "analysis", "of", "all", "OpenSSL", "internal", "usage", "of", "the", "EVP_EncryptUpdate", "function", "all", "usage", "is", "one", "of", "two", "forms.", "The", "first", "form", "is", "like", "this:", "EVP_EncryptInit()", "EVP_EncryptUpdate()", "i.e.", "where", "the", "EVP_EncryptUpdate()", "call", "is", "known", "to", "be", "the", "first", "called", "function", "after", "an", "EVP_EncryptInit(),", "and", "therefore", "that", "specific", "call", "must", "be", "safe.", "The", "second", "form", "is", "where", "the", "length", "passed", "to", "EVP_EncryptUpdate()", "can", "be", "seen", "from", "the", "code", "to", "be", "some", "small", "value", "and", "therefore", "there", "is", "no", "possibility", "of", "an", "overflow.", "Since", "all", "instances", "are", "one", "of", "these", "two", "forms,", "I", "believe", "that", "there", "can", "be", "no", "overflows", "in", "internal", "code", "due", "to", "this", "problem.", "It", "should", "be", "noted", "that", "EVP_DecryptUpdate()", "can", "call", "EVP_EncryptUpdate()", "in", "certain", "code", "paths.", "Also", "EVP_CipherUpdate()", "is", "a", "synonym", "for", "EVP_EncryptUpdate().", "Therefore", "I", "have", "checked", "all", "instances", "of", "these", "calls", "too,", "and", "came", "to", "the", "same", "conclusion,", "i.e.", "there", "are", "no", "instances", "in", "internal", "usage", "where", "an", "overflow", "could", "occur.", "This", "could", "still", "represent", "a", "security", "issue", "for", "end", "user", "code", "that", "calls", "this", "function", "directly.", "Issue", "reported", "by", "Guido", "Vranken.", "Reviewed-by:", "Tim", "Hudson", "<tjh@openssl.org>"], "code_tokens": ["@", "@", "-", "332", ",", "7", "+", "332", ",", "7", "@", "@", "int", "EVP_EncryptUpdate", "(", "EVP_CIPHER_CTX", "*", "ctx", ",", "unsigned", "char", "*", "out", ",", "int", "*", "outl", ",", "bl", "=", "ctx", "-", ">", "cipher", "-", ">", "block_size", ";", "OPENSSL_assert", "(", "bl", "<", "=", "(", "int", ")", "sizeof", "(", "ctx", "-", ">", "buf", ")", ");", "if", "(", "i", "!", "=", "0", ")", "{", "if", "(", "i", "+", "inl", "<", "bl", ")", "{", "if", "(", "bl", "-", "i", ">", "inl", ")", "{", "memcpy", "(", "&(", "ctx", "-", ">", "buf", "[", "i", "]", "),", "in", ",", "inl", ")", ";", "ctx", "-", ">", "buf_len", "+", "=", "inl", ";", "*", "outl", "=", "0", ";"], "docstring_tokens": ["supply", "very", "large", "amounts", "of", "input", "data"]}
{"contents": ["CB-5134", "Add", "location.hash", "based", "exec()", "bridge."], "code_tokens": ["@", "@", "-", "58", ",", "6", "+", "58", ",", "7", "@", "@", "-", "(", "void", ")", "resetRequestId", "-", "(", "void", ")", "enqueueCommandBatch", ":", "(", "NSString", "*", ")", "batchJSON", "{", "CDV_EXEC_LOG", "(", "@\"", "Exec", ":", "Flushed", "JS", "-", ">", "native", "queue", "(", "hadCommands", "=", "%", "d", ")", ".\"", ",", "[", "batchJSON", "length", "]", ">", "0", ")", ";", "if", "(", "[", "batchJSON", "length", "]", ">", "0", ")", "{", "[", "_queue", "addObject", ":", "batchJSON", "]", ";", "[", "self", "executePending", "]", ";", "@", "@", "-", "93", ",", "7", "+", "94", ",", "6", "@", "@", "-", "(", "void", ")", "fetchCommandsFromJs", "NSString", "*", "queuedCommandsJSON", "=", "[", "_viewController", ".", "webView", "stringByEvaluatingJavaScriptFromString", ":", "@", "\"", "cordova", ".", "require", "(", "'", "cordova", "/", "exec", "'", ").", "nativeFetchMessages", "(", ")\"", "];", "CDV_EXEC_LOG", "(", "@\"", "Exec", ":", "Flushed", "JS", "-", ">", "native", "queue", "(", "hadCommands", "=", "%", "d", ")", ".\"", ",", "[", "queuedCommandsJSON", "length", "]", ">", "0", ")", ";", "[", "self", "enqueueCommandBatch", ":", "queuedCommandsJSON", "]", ";", "}", "@", "@", "-", "658", ",", "6", "+", "658", ",", "17", "@", "@", "-", "(", "BOOL", ")", "webView", ":", "(", "UIWebView", "*", ")", "theWebView", "shouldStartLoadWithRequest", ":", "(", "NSURLRequest", "*", "return", "NO", ";", "}", "if", "(", "[[", "url", "fragment", "]", "hasPrefix", ":", "@\"", "%", "01", "\"", "])", "{", "NSString", "*", "inlineCommands", "=", "[", "[", "url", "fragment", "]", "substringFromIndex", ":", "3", "]", ";", "if", "(", "[", "inlineCommands", "length", "]", "=", "=", "0", ")", "{", "[", "_commandQueue", "fetchCommandsFromJs", "]", ";", "}", "else", "{", "inlineCommands", "=", "[", "inlineCommands", "stringByRemovingPercentEncoding", "]", ";", "[", "_commandQueue", "enqueueCommandBatch", ":", "inlineCommands", "]", ";", "}", "return", "NO", ";", "}", "/", "*", "*", "Give", "plugins", "the", "chance", "to", "handle", "the", "url", "*", "/"], "docstring_tokens": ["a", "malicious", "script", "is", "free", "to", "invoke", "them", "in", "order", "to", "select", "a", "vulnerable", "bridge"]}
{"contents": ["avformat/movenc:", "Check", "that", "frame_types", "other", "than", "EAC3_FRAME_TYPE_INDEPENDENT", "have", "a", "supported", "substream", "id", "Fixes:", "out", "of", "array", "access", "Fixes:", "ffmpeg_bof_1.avi", "Found-by:", "Thuan", "Pham,", "Marcel", "B\u00f6hme,", "Andrew", "Santosa", "and", "Alexandru", "Razvan", "Caciulescu", "with", "AFLSmart", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["@", "@", "-", "437", ",", "6", "+", "437", ",", "12", "@", "@", "static", "int", "handle_eac3", "(", "MOVMuxContext", "*", "mov", ",", "AVPacket", "*", "pkt", ",", "MOVTrack", "*", "track", ")", "info", "-", ">", "ec3_done", "=", "1", ";", "goto", "concatenate", ";", "}", "}", "else", "{", "if", "(", "hdr", "-", ">", "substreamid", "!", "=", "0", ")", "{", "avpriv_request_sample", "(", "mov", "-", ">", "fc", ",", "\"", "Multiple", "non", "EAC3", "independent", "substreams", "\"", ");", "ret", "=", "AVERROR_PATCHWELCOME", ";", "goto", "end", ";", "}", "}", "/", "*", "fill", "the", "info", "needed", "for", "the", "\"", "dec3", "\"", "atom", "*", "/"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["dm", "snapshot:", "fix", "data", "corruption", "This", "patch", "fixes", "a", "particular", "type", "of", "data", "corruption", "that", "has", "been", "encountered", "when", "loading", "a", "snapshot's", "metadata", "from", "disk.", "When", "we", "allocate", "a", "new", "chunk", "in", "persistent_prepare,", "we", "increment", "ps->next_free", "and", "we", "make", "sure", "that", "it", "doesn't", "point", "to", "a", "metadata", "area", "by", "further", "incrementing", "it", "if", "necessary.", "When", "we", "load", "metadata", "from", "disk", "on", "device", "activation,", "ps->next_free", "is", "positioned", "after", "the", "last", "used", "data", "chunk.", "However,", "if", "this", "last", "used", "data", "chunk", "is", "followed", "by", "a", "metadata", "area,", "ps->next_free", "is", "positioned", "erroneously", "to", "the", "metadata", "area.", "A", "newly-allocated", "chunk", "is", "placed", "at", "the", "same", "location", "as", "the", "metadata", "area,", "resulting", "in", "data", "or", "metadata", "corruption.", "This", "patch", "changes", "the", "code", "so", "that", "ps->next_free", "skips", "the", "metadata", "area", "when", "metadata", "are", "loaded", "in", "function", "read_exceptions.", "The", "patch", "also", "moves", "a", "piece", "of", "code", "from", "persistent_prepare_exception", "to", "a", "separate", "function", "skip_metadata", "to", "avoid", "code", "duplication.", "Signed-off-by:", "Mikulas", "Patocka", "<mpatocka@redhat.com>", "Cc:", "stable@vger.kernel.org", "Cc:", "Mike", "Snitzer", "<snitzer@redhat.com>", "Signed-off-by:", "Alasdair", "G", "Kergon", "<agk@redhat.com>"], "code_tokens": ["@", "@", "-", "269", ",", "6", "+", "269", ",", "14", "@", "@", "static", "chunk_t", "area_location", "(", "struct", "pstore", "*", "ps", ",", "chunk_t", "area", ")", "return", "NUM_SNAPSHOT_HDR_CHUNKS", "+", "(", "(", "ps", "-", ">", "exceptions_per_area", "+", "1", ")", "*", "area", ")", ";", "}", "static", "void", "skip_metadata", "(", "struct", "pstore", "*", "ps", ")", "{", "uint32_t", "stride", "=", "ps", "-", ">", "exceptions_per_area", "+", "1", ";", "chunk_t", "next_free", "=", "ps", "-", ">", "next_free", ";", "if", "(", "sector_div", "(", "next_free", ",", "stride", ")", "=", "=", "NUM_SNAPSHOT_HDR_CHUNKS", ")", "ps", "-", ">", "next_free", "+", "+;", "}", "/", "*", "*", "Read", "or", "write", "a", "metadata", "area", ".", "Remembering", "to", "skip", "the", "first", "*", "chunk", "which", "holds", "the", "header", ".", "@", "@", "-", "502", ",", "6", "+", "510", ",", "8", "@", "@", "static", "int", "read_exceptions", "(", "struct", "pstore", "*", "ps", ",", "ps", "-", ">", "current_area", "-", "-;", "skip_metadata", "(", "ps", ")", ";", "return", "0", ";", "}", "@", "@", "-", "616", ",", "8", "+", "626", ",", "6", "@", "@", "static", "int", "persistent_prepare_exception", "(", "struct", "dm_exception_store", "*", "store", ",", "struct", "dm_exception", "*", "e", ")", "{", "struct", "pstore", "*", "ps", "=", "get_info", "(", "store", ")", ";", "uint32_t", "stride", ";", "chunk_t", "next_free", ";", "sector_t", "size", "=", "get_dev_size", "(", "dm_snap_cow", "(", "store", "-", ">", "snap", ")", "->", "bdev", ")", ";", "/", "*", "Is", "there", "enough", "room", "?", "*", "/", "@", "@", "-", "630", ",", "10", "+", "638", ",", "8", "@", "@", "static", "int", "persistent_prepare_exception", "(", "struct", "dm_exception_store", "*", "store", ",", "*", "Move", "onto", "the", "next", "free", "pending", ",", "making", "sure", "to", "take", "*", "into", "account", "the", "location", "of", "the", "metadata", "chunks", ".", "*", "/", "stride", "=", "(", "ps", "-", ">", "exceptions_per_area", "+", "1", ")", ";", "next_free", "=", "+", "+", "ps", "-", ">", "next_free", ";", "if", "(", "sector_div", "(", "next_free", ",", "stride", ")", "=", "=", "1", ")", "ps", "-", ">", "next_free", "+", "+;", "ps", "-", ">", "next_free", "+", "+;", "skip_metadata", "(", "ps", ")", ";", "atomic_inc", "(", "&", "ps", "-", ">", "pending_count", ")", ";", "return", "0", ";"], "docstring_tokens": ["via", "a", "crafted", "mapping", "to", "a", "snapshot", "block", "device", "."]}
{"contents": ["Fix", "ASN1_INTEGER", "handling.", "Only", "treat", "an", "ASN1_ANY", "type", "as", "an", "integer", "if", "it", "has", "the", "V_ASN1_INTEGER", "tag:", "V_ASN1_NEG_INTEGER", "is", "an", "internal", "only", "value", "which", "is", "never", "used", "for", "on", "the", "wire", "encoding.", "Thanks", "to", "David", "Benjamin", "<davidben@google.com>", "for", "reporting", "this", "bug.", "This", "was", "found", "using", "libFuzzer.", "RT#4364", "(part)", ".", "Reviewed-by:", "Emilia", "K\u00e4sper", "<emilia@openssl.org>"], "code_tokens": ["@", "@", "-", "126", ",", "9", "+", "126", ",", "7", "@", "@", "int", "ASN1_TYPE_cmp", "(", "const", "ASN1_TYPE", "*", "a", ",", "const", "ASN1_TYPE", "*", "b", ")", "result", "=", "0", ";", "/", "*", "They", "do", "not", "have", "content", ".", "*", "/", "break", ";", "case", "V_ASN1_INTEGER", ":", "case", "V_ASN1_NEG_INTEGER", ":", "case", "V_ASN1_ENUMERATED", ":", "case", "V_ASN1_NEG_ENUMERATED", ":", "case", "V_ASN1_BIT_STRING", ":", "case", "V_ASN1_OCTET_STRING", ":", "case", "V_ASN1_SEQUENCE", ":", "@", "@", "-", "903", ",", "9", "+", "903", ",", "7", "@", "@", "int", "asn1_ex_c2i", "(", "ASN1_VALUE", "*", "*", "pval", ",", "const", "unsigned", "char", "*", "cont", ",", "int", "len", ",", "break", ";", "case", "V_ASN1_INTEGER", ":", "case", "V_ASN1_NEG_INTEGER", ":", "case", "V_ASN1_ENUMERATED", ":", "case", "V_ASN1_NEG_ENUMERATED", ":", "tint", "=", "(", "ASN1_INTEGER", "*", "*)", "pval", ";", "if", "(", "!", "c2i_ASN1_INTEGER", "(", "tint", ",", "&", "cont", ",", "len", ")", ")", "goto", "err", ";", "@", "@", "-", "611", ",", "9", "+", "611", ",", "7", "@", "@", "int", "asn1_ex_i2c", "(", "ASN1_VALUE", "*", "*", "pval", ",", "unsigned", "char", "*", "cout", ",", "int", "*", "putype", ",", "break", ";", "case", "V_ASN1_INTEGER", ":", "case", "V_ASN1_NEG_INTEGER", ":", "case", "V_ASN1_ENUMERATED", ":", "case", "V_ASN1_NEG_ENUMERATED", ":", "/", "*", "*", "These", "are", "all", "have", "the", "same", "content", "format", "as", "ASN1_INTEGER", "*", "/"], "docstring_tokens": ["via", "an", "ANY", "field", "in", "crafted", "serialized", "data"]}
{"contents": ["fuse:", "prevent", "fuse_put_request", "on", "invalid", "pointer", "fuse_direct_io()", "has", "a", "loop", "where", "requests", "are", "allocated", "in", "each", "iteration.", "if", "allocation", "fails,", "the", "loop", "is", "broken", "out", "and", "follows", "into", "an", "unconditional", "fuse_put_request()", "on", "that", "invalid", "pointer.", "Signed-off-by:", "Anand", "V.", "Avati", "<avati@gluster.com>", "Signed-off-by:", "Miklos", "Szeredi", "<mszeredi@suse.cz>", "Cc:", "stable@kernel.org"], "code_tokens": ["@", "@", "-", "1063", ",", "7", "+", "1063", ",", "8", "@", "@", "ssize_t", "fuse_direct_io", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "break", ";", "}", "}", "fuse_put_request", "(", "fc", ",", "req", ")", ";", "if", "(", "!", "IS_ERR", "(", "req", ")", ")", "fuse_put_request", "(", "fc", ",", "req", ")", ";", "if", "(", "res", ">", "0", ")", "*", "ppos", "=", "pos", ";"], "docstring_tokens": ["via", "vectors", "possibly", "related", "to", "a", "memory-consumption", "attack", "."]}
{"contents": ["Fixed", "##72433:", "Use", "After", "Free", "Vulnerability", "in", "PHP's", "GC", "algorithm", "and", "unserialize"], "code_tokens": ["@", "@", "-", "13", ",", "5", "+", "13", ",", "5", "@", "@", "var_dump", "(", "gc_collect_cycles", "(", "))", ";", "echo", "\"", "ok", "\\", "n", "\"", ";", "?", ">", "-", "-", "EXPECT", "int", "(", "1", ")", "int", "(", "2", ")", "ok", "@", "@", "-", "831", ",", "6", "+", "831", ",", "16", "@", "@", "static", "HashTable", "*", "spl_array_get_debug_info", "(", "zval", "*", "obj", ",", "int", "*", "is_temp", "TSRMLS_DC", ")", "/", "*", "}", "/", "*", "}", "}}", "*", "/", "static", "HashTable", "*", "spl_array_get_gc", "(", "zval", "*", "object", ",", "zval", "*", "**", "gc_data", ",", "int", "*", "gc_data_count", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "spl_array_object", "*", "intern", "=", "(", "spl_array_object", "*", ")", "zend_object_store_get_object", "(", "object", "TSRMLS_CC", ")", ";", "*", "gc_data", "=", "&", "intern", "-", ">", "array", ";", "*", "gc_data_count", "=", "1", ";", "return", "zend_std_get_properties", "(", "object", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "static", "zval", "*", "spl_array_read_property", "(", "zval", "*", "object", ",", "zval", "*", "member", ",", "int", "type", ",", "const", "zend_literal", "*", "key", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "spl_array_object", "*", "intern", "=", "(", "spl_array_object", "*", ")", "zend_object_store_get_object", "(", "object", "TSRMLS_CC", ")", ";", "@", "@", "-", "1961", ",", "6", "+", "1971", ",", "7", "@", "@", "PHP_MINIT_FUNCTION", "(", "spl_array", ")", "spl_handler_ArrayObject", ".", "get_properties", "=", "spl_array_get_properties", ";", "spl_handler_ArrayObject", ".", "get_debug_info", "=", "spl_array_get_debug_info", ";", "spl_handler_ArrayObject", ".", "get_gc", "=", "spl_array_get_gc", ";", "spl_handler_ArrayObject", ".", "read_property", "=", "spl_array_read_property", ";", "spl_handler_ArrayObject", ".", "write_property", "=", "spl_array_write_property", ";", "spl_handler_ArrayObject", ".", "get_property_ptr_ptr", "=", "spl_array_get_property_ptr_ptr", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "32", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72433", ":", "Use", "After", "Free", "Vulnerability", "in", "PHP", "'", "s", "GC", "algorithm", "and", "unserialize", "-", "-", "FILE", "-", "-", "<", "?", "php", "/", "/", "Fill", "any", "potential", "freed", "spaces", "until", "now", ".", "$", "filler", "=", "array", "(", ");", "for", "(", "$", "i", "=", "0", ";", "$", "i", "<", "100", ";", "$", "i", "+", "+)", "$", "filler", "[", "]", "=", "\"", "\";", "/", "/", "Create", "our", "payload", "and", "unserialize", "it", ".", "$", "serialized_payload", "=", "'", "a", ":", "3", ":", "{", "i", ":", "0", ";", "r", ":", "1", ";", "i", ":", "1", ";", "r", ":", "1", ";", "i", ":", "2", ";", "C", ":", "11", ":", "\"", "ArrayObject", "\"", ":", "19", ":", "{", "x", ":", "i", ":", "0", ";", "r", ":", "1", ";", ";", "m", ":", "a", ":", "0", ":", "{}", "}}", "';", "$", "free_me", "=", "unserialize", "(", "$", "serialized_payload", ")", ";", "/", "/", "We", "need", "to", "increment", "the", "reference", "counter", "of", "our", "ArrayObject", "s", ".", "t", ".", "all", "reference", "counters", "of", "our", "unserialized", "array", "become", "0", ".", "$", "inc_ref_by_one", "=", "$", "free_me", "[", "2", "]", ";", "/", "/", "The", "call", "to", "gc_collect_cycles", "will", "free", "'", "$", "free_me", "'", ".", "gc_collect_cycles", "(", ");", "/", "/", "We", "now", "have", "multiple", "freed", "spaces", ".", "Fill", "all", "of", "them", ".", "$", "fill_freed_space_1", "=", "\"", "filler_zval_1", "\"", ";", "$", "fill_freed_space_2", "=", "\"", "filler_zval_2", "\"", ";", "var_dump", "(", "$", "free_me", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "*", "RECURSION", "*", "[", "1", "]", "=>", "*", "RECURSION", "*", "[", "2", "]", "=>", "object", "(", "ArrayObject", ")", "#%", "d", "(", "1", ")", "{", "[", "\"", "storage", "\"", ":\"", "ArrayObject", "\"", ":", "private", "]", "=>", "*", "RECURSION", "*", "}", "}"], "docstring_tokens": ["via", "crafted", "serialized", "data", "."]}
{"contents": ["CAMEL-10575:", "regenerate", "SnakeYAMLDataFormatConfiguration"], "code_tokens": ["@", "@", "-", "16", ",", "8", "+", "16", ",", "10", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "springboot", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLDataFormat", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "YAMLLibrary", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "YAMLTypeFilterDefinition", ";", "import", "org", ".", "springframework", ".", "boot", ".", "context", ".", "properties", ".", "ConfigurationProperties", ";", "/", "**", "@", "@", "-", "61", ",", "6", "+", "63", ",", "14", "@", "@", "*", "style", ".", "*", "/", "private", "Boolean", "prettyFlow", "=", "false", ";", "/", "**", "*", "Allow", "any", "class", "to", "be", "un", "-", "marshaled", "*", "/", "private", "Boolean", "allowAnyType", "=", "false", ";", "/", "**", "*", "Set", "the", "types", "SnakeYAML", "is", "allowed", "to", "un", "-", "marshall", "*", "/", "private", "List", "<", "YAMLTypeFilterDefinition", ">", "typeFilter", ";", "public", "YAMLLibrary", "getLibrary", "(", ")", "{", "return", "library", ";", "@", "@", "-", "126", ",", "4", "+", "136", ",", "20", "@", "@", "public", "Boolean", "getPrettyFlow", "(", ")", "{", "public", "void", "setPrettyFlow", "(", "Boolean", "prettyFlow", ")", "{", "this", ".", "prettyFlow", "=", "prettyFlow", ";", "}", "public", "Boolean", "getAllowAnyType", "(", ")", "{", "return", "allowAnyType", ";", "}", "public", "void", "setAllowAnyType", "(", "Boolean", "allowAnyType", ")", "{", "this", ".", "allowAnyType", "=", "allowAnyType", ";", "}", "public", "List", "<", "YAMLTypeFilterDefinition", ">", "getTypeFilter", "(", ")", "{", "return", "typeFilter", ";", "}", "public", "void", "setTypeFilter", "(", "List", "<", "YAMLTypeFilterDefinition", ">", "typeFilter", ")", "{", "this", ".", "typeFilter", "=", "typeFilter", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["using", "de-serializing", "untrusted", "data"]}
{"contents": ["Add", "tests", "for", "WebUtils"], "code_tokens": ["@", "@", "-", "87", ",", "7", "+", "87", ",", "7", "@", "@", "private", "HttpServletRequest", "createMockRequest", "(", "String", "path", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "path", ")", ";", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "path", ")", ";", "replay", "(", "request", ")", ";", "return", "request", ";", "}", "@", "@", "-", "136", ",", "11", "+", "136", ",", "20", "@", "@", "public", "static", "String", "getPathWithinApplication", "(", "HttpServletRequest", "request", ")", "{", "public", "static", "String", "getRequestUri", "(", "HttpServletRequest", "request", ")", "{", "String", "uri", "=", "(", "String", ")", "request", ".", "getAttribute", "(", "INCLUDE_REQUEST_URI_ATTRIBUTE", ")", ";", "if", "(", "uri", "=", "=", "null", ")", "{", "uri", "=", "request", ".", "getRequestURI", "(", ");", "uri", "=", "valueOrEmpty", "(", "request", ".", "getContextPath", "(", "))", "+", "\"", "/\"", "valueOrEmpty", "(", "request", ".", "getServletPath", "(", "))", "valueOrEmpty", "(", "request", ".", "getPathInfo", "(", "))", ";", "}", "return", "normalize", "(", "decodeAndCleanUriString", "(", "request", ",", "uri", ")", ");", "}", "private", "static", "String", "valueOrEmpty", "(", "String", "input", ")", "{", "if", "(", "input", "=", "=", "null", ")", "{", "return", "\"", "\";", "}", "return", "input", ";", "}", "/", "**", "*", "Normalize", "a", "relative", "URI", "path", "that", "may", "have", "relative", "values", "(", "\"/", "./", "\",", "*", "\"", "/.", "./", "\",", "and", "so", "on", ")", "it", "it", ".", "<", "strong", ">", "WARNING", "<", "/", "strong", ">", "-", "This", "method", "is", "@", "@", "-", "140", ",", "6", "+", "140", ",", "26", "@", "@", "public", "class", "WebUtilsTest", "{", "}", "@", "Test", "void", "testGetRequestUriWithServlet", "(", ")", "{", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "\",", "\"", "/", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"\"", ",", "\"", "/", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"\"", ",", "\"", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "\",", "\"", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "/\"", ",", "\"", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "/\"", ",", "\"", "//", "servlet", "\"", ",", "\"", "//", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "context", "-", "path", "\"", ",", "\"", "/", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "/", "context", "-", "path", "\"", ",", "\"", "//", "servlet", "\"", ",", "\"", "//", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "/", "context", "-", "path", "\"", ",", "\"", "/", "servlet", "\"", ",", "\"", "/.", "./", "servlet", "/", "other", "\"", ",", "\"", "/", "servlet", "/", "other", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "/", "context", "-", "path", "\"", ",", "\"", "/", "asdf", "\"", ",", "\"", "/.", "./", "servlet", "/", "other", "\"", ",", "\"", "/", "servlet", "/", "other", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "/", "context", "-", "path", "\"", ",", "\"", "/", "asdf", "\"", ",", "\"", ";/", "..", "/", "servlet", "/", "other", "\"", ",", "\"", "/", "asdf", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "context", "%", "2525path", "\"", ",", "\"", "/", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "c", "%", "6Fntext", "%", "20path", "\"", ",", "\"", "/", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"/", "context", "path", "\"", ",", "\"", "/", "servlet", "\"", ",", "\"", "/", "foobar", "\"", ",", "\"", "/", "servlet", "/", "foobar", "\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"\"", ",", "null", ",", "null", ",", "\"", "/\"", ")", "dotTestGetPathWithinApplicationFromRequest", "(", "\"\"", ",", "\"", "index", ".", "jsp", "\"", ",", "null", ",", "\"", "/", "index", ".", "jsp", "\"", ")", "}", "@", "Test", "void", "testGetPathWithinApplication", "(", ")", "{", "@", "@", "-", "172", ",", "4", "+", "192", ",", "18", "@", "@", "public", "class", "WebUtilsTest", "{", "assertEquals", "expectedValue", ",", "WebUtils", ".", "getPathWithinApplication", "(", "request", ")", "verify", "request", "}", "void", "dotTestGetPathWithinApplicationFromRequest", "(", "String", "contextPath", ",", "String", "servletPath", ",", "String", "pathInfo", ",", "String", "expectedValue", ")", "{", "HttpServletRequest", "request", "=", "createMock", "(", "HttpServletRequest", ")", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_REQUEST_URI_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "servletPath", ")", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "contextPath", ")", ".", "times", "(", "2", ")", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "pathInfo", ")", "expect", "(", "request", ".", "getCharacterEncoding", "(", "))", ".", "andReturn", "(", "\"", "UTF", "-", "8", "\"", ").", "anyTimes", "(", ")", "replay", "request", "assertEquals", "expectedValue", ",", "WebUtils", ".", "getPathWithinApplication", "(", "request", ")", "verify", "request", "}", "}", "@", "@", "-", "112", ",", "6", "+", "112", ",", "8", "@", "@", "public", "void", "testEnabled", "(", ")", "throws", "Exception", "{", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "CONTEXT_PATH", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "ENABLED_PATH", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "ENABLED_PATH", ")", ".", "anyTimes", "(", ");", "replay", "(", "request", ")", ";", "boolean", "continueFilterChain", "=", "filter", ".", "preHandle", "(", "request", ",", "response", ")", ";", "@", "@", "-", "128", ",", "6", "+", "130", ",", "8", "@", "@", "public", "void", "testEnabled", "(", ")", "throws", "Exception", "{", "public", "void", "testPathMatchEqualUrlSeparatorEnabled", "(", ")", "{", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "CONTEXT_PATH", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "\")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "\")", ".", "anyTimes", "(", ");", "replay", "(", "request", ")", ";", "boolean", "matchEnabled", "=", "filter", ".", "pathsMatch", "(", "\"/", "\",", "request", ")", ";", "@", "@", "-", "142", ",", "6", "+", "146", ",", "8", "@", "@", "public", "void", "testPathMatchEqualUrlSeparatorEnabled", "(", ")", "{", "public", "void", "testPathMatchEEnabled", "(", ")", "{", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "CONTEXT_PATH", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "\"", ").", "anyTimes", "(", ");", "replay", "(", "request", ")", ";", "boolean", "matchEnabled", "=", "filter", ".", "pathsMatch", "(", "\"/", "resource", "/", "book", "\"", ",", "request", ")", ";", "@", "@", "-", "156", ",", "6", "+", "162", ",", "8", "@", "@", "public", "void", "testPathMatchEEnabled", "(", ")", "{", "public", "void", "testPathMatchEndWithUrlSeparatorEnabled", "(", ")", "{", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "CONTEXT_PATH", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "\")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "\")", ".", "anyTimes", "(", ");", "replay", "(", "request", ")", ";", "boolean", "matchEnabled", "=", "filter", ".", "pathsMatch", "(", "\"/", "resource", "/", "book", "\"", ",", "request", ")", ";", "@", "@", "-", "170", ",", "6", "+", "178", ",", "8", "@", "@", "public", "void", "testPathMatchEndWithUrlSeparatorEnabled", "(", ")", "{", "public", "void", "testPathMatchEndWithMultiUrlSeparatorEnabled", "(", ")", "{", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "CONTEXT_PATH", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "/\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "/\"", ").", "anyTimes", "(", ");", "replay", "(", "request", ")", ";", "boolean", "matchEnabled", "=", "filter", ".", "pathsMatch", "(", "\"/", "resource", "/", "book", "\"", ",", "request", ")", ";", "@", "@", "-", "99", ",", "7", "+", "99", ",", "8", "@", "@", "public", "void", "testGetChainsWithMatch", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "index", ".", "html", "\"", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "index", ".", "html", "\"", ");", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "118", ",", "7", "+", "119", ",", "8", "@", "@", "public", "void", "testPathTraversalWithDot", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "./", "index", ".", "html", "\"", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"/", "\")", ";", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\".", "/", "index", ".", "html", "\"", ");", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "137", ",", "7", "+", "139", ",", "8", "@", "@", "public", "void", "testPathTraversalWithDotDot", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "public", "/", "..", "/", "index", ".", "html", "\"", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"/", "public", "/", "\")", ";", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\".", "./", "index", ".", "html", "\"", ");", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "156", ",", "7", "+", "159", ",", "8", "@", "@", "public", "void", "testGetChainsWithoutMatch", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "\")", ";", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"/", "\")", ";", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "null", ")", ";", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "178", ",", "7", "+", "182", ",", "8", "@", "@", "public", "void", "testGetChain", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "\"", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "\"", ");", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "200", ",", "7", "+", "205", ",", "8", "@", "@", "public", "void", "testGetChainEqualUrlSeparator", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "\")", ";", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"/", "\")", ";", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "null", ")", ";", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "222", ",", "7", "+", "228", ",", "8", "@", "@", "public", "void", "testGetChainEndWithUrlSeparator", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "\")", ";", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "\"", ");", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";", "@", "@", "-", "244", ",", "7", "+", "251", ",", "8", "@", "@", "public", "void", "testGetChainEndWithMultiUrlSeparator", "(", ")", "{", "expect", "(", "request", ".", "getAttribute", "(", "WebUtils", ".", "INCLUDE_CONTEXT_PATH_ATTRIBUTE", ")", ").", "andReturn", "(", "null", ")", ".", "anyTimes", "(", ");", "expect", "(", "request", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getRequestURI", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "/\"", ");", "expect", "(", "request", ".", "getServletPath", "(", "))", ".", "andReturn", "(", "\"\"", ");", "expect", "(", "request", ".", "getPathInfo", "(", "))", ".", "andReturn", "(", "\"/", "resource", "/", "book", "/", "/\"", ");", "replay", "(", "request", ")", ";", "FilterChain", "resolved", "=", "resolver", ".", "getChain", "(", "request", ",", "response", ",", "chain", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Fix", "potential", "XSS", "vulnerability", "(#307)", "*", "Escape", "text", "coming", "from", "URL", "that", "is", "used", "in", "the", "page", "*", "Comment", "out", "the", "contents", "of", "unit.html", "*", "Prevent", "remote", "scripts", "being", "executed", "*", "Remove", "remote", "URLs", "from", "unit", "test", "file", "(cherry", "picked", "from", "commit", "9117ffd5a3863e44c92fcd58564c0da22be858f4)"], "code_tokens": ["@", "@", "-", "15", ",", "10", "+", "15", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "legacy", "\"", ",", "\"", "sync", ",", "ab", ",", "src", ",", "./", "dojo", ",", "legacy", "-", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "152", "-", "build", ",", "legacy", "\"", ",", "@", "@", "-", "31", ",", "10", "+", "27", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "legacy", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "legacy", "-", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "152", "-", "build", ",", "legacy", "\"", ",", "@", "@", "-", "47", ",", "10", "+", "39", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "legacy", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "legacy", "-", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "152", "-", "build", ",", "legacy", "\"", ",", "@", "@", "-", "63", ",", "10", "+", "51", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "75", ",", "10", "+", "59", ",", "6", "@", "@", "define", "(", "[", "\"", "async", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "88", ",", "10", "+", "68", ",", "6", "@", "@", "define", "(", "[", "\"", "async", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "101", ",", "10", "+", "77", ",", "6", "@", "@", "define", "(", "[", "\"", "async", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "113", ",", "11", "+", "85", ",", "7", "@", "@", "define", "(", "[", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", "];", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", "];", "for", "(", "var", "i", "=", "0", ";", "i", "<", "testParams", ".", "length", ";", "i", "+", "+)", "{", "doh", ".", "register", "(", "\"", "testsDOH", ".", "_base", ".", "i18nExhaustive", "\"", "+", "i", ",", "require", ".", "toUrl", "(", "\"", "dojo", "/", "main", "\"", ")", "+", "\"", "/.", "./", "..", "/", "i18n", "-", "test", "/", "unit", ".", "html", "?", "\"", "+", "testParams", "[", "i", "]", ");", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "<", "html", ">", "<", "!-", "-<", "html", ">", "<", "head", ">", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "span", ".", "pass", "{", "background", "-", "color", ":", "green", "}", "@", "@", "-", "12", ",", "6", "+", "12", ",", "19", "@", "@", "/", "/#", "1", ",", ",", "src", ",", "./", "dojo", "\"", ",", "src", ",", "./", "dtk", "-", "i18n", "-", "test", "(", "function", "(", "){", "var", "escapes", "=", "{", "\"", "&\"", ":", "\"", "&", "amp", ";", "\",", "\"", "<\"", ":", "\"", "&", "lt", ";", "\",", "\"", ">\"", ":", "\"", "&", "gt", ";", "\",", "\"", "\\\"", "\":", "\"", "&", "quot", ";", "\",", "\"", "'\"", ":", "\"", "&#", "039", ";", "\"", "}", ";", "function", "escape", "(", "unsafe", ")", "{", "return", "unsafe", ".", "replace", "(", "/[", "&<", ">\"", "']", "/", "g", ",", "function", "(", "match", ")", "{", "return", "escapes", "[", "match", "]", ";", "}", ");", "}", "var", "hashInfo", "=", "location", ".", "search", ".", "substring", "(", "1", ")", ",", "options", "=", "hashInfo", ".", "split", "(", "\",", "\")", ";", "async", "=", "options", "[", "0", "]", "==", "\"", "async", "\"", "?", "true", ":", "undefined", ",", "@", "@", "-", "23", ",", "7", "+", "36", ",", "11", "@", "@", "testId", "=", "\"", "async", ":", "\"", "+", "async", "+", "\"", ",", "locale", ":", "\"", "+", "locale", "+", "\"", ",", "dojo", ":", "\"", "+", "dojoType", "+", "\"", ",", "i18nTest", ":", "\"", "+", "i18nTestType", "+", "\"", "(\"", "+", "hashInfo", "+", "\"", ")\"", ",", "testKind", "=", "options", "[", "6", "]", ";", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "+", "=", "hashInfo", ";", "if", "(", "(/", "^", "http", "/", "i", ")", ".", "test", "(", "i18nTestLocation", ")", ")", "{", "return", ";", "}", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "+", "=", "escape", "(", "hashInfo", ")", ";", "function", "report", "(", "result", ")", "{", "require", "(", "[\"", "doh", "\"", "],", "function", "(", "doh", ")", "{", "@", "@", "-", "39", ",", "7", "+", "56", ",", "7", "@", "@", "}", "else", "{", "text", "=", "\"", "<", "span", "class", "=", "'", "fail", "'", ">", "FAIL", "<", "/", "span", ">", ":", "\"", "+", "testId", "+", "\"", "<", "br", ">", "\"", "+", "result", ";", "}", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "=", "text", ";", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "=", "escape", "(", "text", ")", ";", "}", "dojoConfig", "=", "{", "@", "@", "-", "85", ",", "10", "+", "102", ",", "11", "@", "@", "var", "node", "=", "document", ".", "createElement", "(", "\"", "script", "\"", ");", "node", ".", "type", "=", "\"", "text", "/", "javascript", "\"", ";", "node", ".", "charset", "=", "\"", "utf", "-", "8", "\"", ";", "node", ".", "src", "=", "(", "/^", "http", "/", ".", "test", "(", "dojoLocation", ")", "?", "dojoLocation", ":", "\"", "..", "/\"", "+", "dojoLocation", ")", "+", "\"", "/", "dojo", ".", "js", "\"", ";", "/", "/", "If", "a", "user", "passes", "a", "remote", "URL", ",", "force", "it", "to", "use", "the", "local", "dojo", "node", ".", "src", "=", "(", "(/", "^", "http", "/", "i", ")", ".", "test", "(", "dojoLocation", ")", "?", "'", "..", "/", "dojo", "'", ":", "\"", "..", "/\"", "+", "dojoLocation", ")", "+", "\"", "/", "dojo", ".", "js", "\"", ";", "console", ".", "log", "(", "node", ".", "src", ")", ";", "document", ".", "getElementsByTagName", "(", "\"", "head", "\"", ")[", "0", "]", ".", "appendChild", "(", "node", ")", ";", "}", ")(", ");", "<", "/", "script", ">", "<", "/", "body", ">", "<", "/", "html", ">", "<", "/", "html", ">", "--", ">", "@", "@", "-", "59", ",", "6", "+", "59", ",", "6", "@", "@", "The", "various", "built", "module", "and", "loaders", "are", "constructed", "by", "the", "v1", ".", "7", "builder", ".", "The", "sh", "i18n", "-", "test", "/", "build", "-", "test", "-", "targets", ".", "sh", "accomplishes", "this", "task", "automatically", ".", "A", "unit", "test", "html", "page", "is", "constructed", "at", "i18n", "-", "test", "/", "unit", ".", "html", ".", "Given", "a", "query", "string", ",", "it", "will", "load", "a", "particular", "loader", "and", "exercise", "a", "particular", "set", "of", "modules", ".", "exercise", "a", "particular", "set", "of", "modules", ".", "Its", "contents", "must", "be", "uncommented", "before", "running", "the", "tests", ".", "Finally", ",", "the", "DOH", "test", "dojo", "/", "testsDOH", "/", "_base", "/", "i18nExhaustive", "runs", "all", "the", "various", "combinations", "."], "docstring_tokens": ["via", "wp-admin/admin.php", "."]}
{"contents": ["Improve", "scripting", "security", "(#179)", "*", "Improve", "scripting", "security:", "-", "OGNL", "is", "now", "disabled", "by", "default", "as", "it", "wasn't", "really", "used", "much", "(possible", "to", "reactive", "through", "a", "system", "setting)", "-", "A", "new", "condition", "sanitizer", "has", "been", "added", "in", "the", "ContextServlet", "to", "filter", "out", "any", "MVEL", "scripts", "(again", "not", "used", "much", "and", "can", "be", "reactivate", "using", "a", "system", "property)", "-", "A", "new", "ExpressionFilter", "has", "been", "added", "that", "will", "use", "configurable", "(system", "property)", "regular", "expressions", "to", "filter", "out", "possible", "malicious", "expressions", "-", "OGNL", "sandboxing", "has", "been", "improved", "-", "MVEL", "default", "imports", "have", "been", "modified", "to", "prevent", "using", "system-level", "classes", "*", "Fix", "bug", "in", "sanitizing", "code", "*", "New", "scripting", "execution", "sub-system:", "-", "Allow-listing", "of", "allowed", "expressions", "-", "Plugins", "may", "deployed", "their", "own", "allow-lists", "using", "JSON", "files", "-", "OGNL", "scripting", "is", "now", "deactivated", "by", "default", "-", "Minimal", "list", "of", "built-in", "MVEL", "allowed", "patterns", "*", "Fix", "typo", "in", "marker", "(cherry", "picked", "from", "commit", "343d24f27b1790701225711491e967bd3e2111c8)"], "code_tokens": ["@", "@", "-", "54", ",", "6", "+", "54", ",", "42", "@", "@", "<", "version", ">", "${", "version", ".", "karaf", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "api", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "slf4j", "<", "/", "groupId", ">", "<", "artifactId", ">", "slf4j", "-", "simple", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "6", ".", "6", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "felix", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "bundle", "-", "plugin", "<", "/", "artifactId", ">", "<", "extensions", ">", "true", "<", "/", "extensions", ">", "<", "configuration", ">", "<", "instructions", ">", "<", "Embed", "-", "Dependency", ">", "*;", "scope", "=", "compile", "|", "runtime", "<", "/", "Embed", "-", "Dependency", ">", "<", "Import", "-", "Package", ">", "org", ".", "apache", ".", "unomi", ".", "api", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "goals", ",", "*", "<", "/", "Import", "-", "Package", ">", "<", "/", "instructions", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "<", "/", "project", ">", "@", "@", "-", "17", ",", "9", "+", "17", ",", "12", "@", "@", "package", "org", ".", "apache", ".", "unomi", ".", "itests", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "DefinitionsService", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "CustomObjectMapper", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "PersistenceService", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "Configuration", ";", "@", "@", "-", "30", ",", "23", "+", "33", ",", "21", "@", "@", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "options", ".", "MavenArtifactUrlReference", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "options", ".", "extra", ".", "VMOption", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "util", ".", "Filter", ";", "import", "org", ".", "osgi", ".", "framework", ".", "BundleContext", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "function", ".", "Predicate", ";", "import", "java", ".", "util", ".", "function", ".", "Supplier", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "CoreOptions", ".", "maven", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "CoreOptions", ".", "systemProperty", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "debugConfiguration", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "editConfigurationFilePut", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "karafDistributionConfiguration", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "keepRuntimeFolder", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "logLevel", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "replaceConfigurationFile", ";", "import", "static", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "karaf", ".", "options", ".", "KarafDistributionOption", ".", "*;", "/", "**", "*", "Base", "class", "for", "integration", "tests", ".", "@", "@", "-", "68", ",", "6", "+", "69", ",", "9", "@", "@", "@", "Filter", "(", "timeout", "=", "600000", ")", "protected", "DefinitionsService", "definitionsService", ";", "@", "Inject", "protected", "BundleContext", "bundleContext", ";", "protected", "void", "removeItems", "(", "final", "Class", "<", "?", "extends", "Item", ">", ".", "..", "classes", ")", "throws", "InterruptedException", "{", "Condition", "condition", "=", "new", "Condition", "(", "definitionsService", ".", "getConditionType", "(", "\"", "matchAllCondition", "\"", "))", ";", "for", "(", "Class", "<", "?", "extends", "Item", ">", "aClass", ":", "classes", ")", "{", "@", "@", "-", "206", ",", "4", "+", "210", ",", "25", "@", "@", "protected", "void", "refreshPersistence", "(", ")", "throws", "InterruptedException", "{", "}", "return", "value", ";", "}", "protected", "String", "bundleResourceAsString", "(", "final", "String", "resourcePath", ")", "throws", "IOException", "{", "final", "java", ".", "net", ".", "URL", "url", "=", "bundleContext", ".", "getBundle", "(", ").", "getResource", "(", "resourcePath", ")", ";", "if", "(", "url", "!", "=", "null", ")", "{", "return", "IOUtils", ".", "toString", "(", "url", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "protected", "String", "getValidatedBundleJSON", "(", "final", "String", "resourcePath", ",", "Map", "<", "String", ",", "String", ">", "parameters", ")", "throws", "IOException", "{", "String", "jsonString", "=", "bundleResourceAsString", "(", "resourcePath", ")", ";", "if", "(", "parameters", "!", "=", "null", "&", "&", "parameters", ".", "size", "(", ")", ">", "0", ")", "{", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "parameterEntry", ":", "parameters", ".", "entrySet", "(", "))", "{", "jsonString", "=", "jsonString", ".", "replace", "(", "\"#", "##", "\"", "+", "parameterEntry", ".", "getKey", "(", ")", "+", "\"", "##", "#\"", ",", "parameterEntry", ".", "getValue", "(", "))", ";", "}", "}", "ObjectMapper", "objectMapper", "=", "CustomObjectMapper", ".", "getObjectMapper", "(", ");", "return", "objectMapper", ".", "writeValueAsString", "(", "objectMapper", ".", "readTree", "(", "jsonString", ")", ");", "}", "}", "@", "@", "-", "21", ",", "12", "+", "21", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "HttpPost", ";", "import", "org", ".", "apache", ".", "http", ".", "entity", ".", "ContentType", ";", "import", "org", ".", "apache", ".", "http", ".", "entity", ".", "StringEntity", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "ContextRequest", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "ContextResponse", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "*;", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "segments", ".", "Segment", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "DefinitionsService", ";", "@", "@", "-", "44", ",", "17", "+", "39", ",", "19", "@", "@", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "util", ".", "Filter", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "time", ".", "LocalDateTime", ";", "import", "java", ".", "time", ".", "ZoneId", ";", "import", "java", ".", "time", ".", "ZoneOffset", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "IsCollectionContaining", ".", "hasItem", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "@", "@", "-", "346", ",", "4", "+", "343", ",", "48", "@", "@", "public", "void", "testCreateEventWithProfileId_Success", "(", ")", "throws", "IOException", ",", "Interrupt", "Profile", "profile", "=", "this", ".", "profileService", ".", "load", "(", "profileId", ")", ";", "assertEquals", "(", "profileId", ",", "profile", ".", "getItemId", "(", "))", ";", "}", "@", "Test", "public", "void", "testOGNLVulnerability", "(", ")", "throws", "IOException", ",", "InterruptedException", "{", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "String", "vulnFileCanonicalPath", "=", "vulnFile", ".", "getCanonicalPath", "(", ");", "vulnFileCanonicalPath", "=", "vulnFileCanonicalPath", ".", "replace", "(", "\"\\", "\\\"", ",", "\"", "\\\\", "\\\\", "\")", ";", "/", "/", "this", "is", "required", "for", "Windows", "support", "Map", "<", "String", ",", "String", ">", "parameters", "=", "new", "HashMap", "<", ">(", ");", "parameters", ".", "put", "(", "\"", "VULN_FILE_PATH", "\"", ",", "vulnFileCanonicalPath", ")", ";", "HttpPost", "request", "=", "new", "HttpPost", "(", "URL", "+", "CONTEXT_URL", ")", ";", "request", ".", "setEntity", "(", "new", "StringEntity", "(", "getValidatedBundleJSON", "(", "\"", "security", "/", "ognl", "-", "payload", "-", "1", ".", "json", "\"", ",", "parameters", ")", ",", "ContentType", ".", "create", "(", "\"", "application", "/", "json", "\"", "))", ");", "TestUtils", ".", "executeContextJSONRequest", "(", "request", ")", ";", "refreshPersistence", "(", ");", "Thread", ".", "sleep", "(", "2000", ")", ";", "/", "/", "Making", "sure", "event", "is", "updated", "in", "DB", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFileCanonicalPath", ",", "vulnFile", ".", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testMVELVulnerability", "(", ")", "throws", "IOException", ",", "InterruptedException", "{", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "String", "vulnFileCanonicalPath", "=", "vulnFile", ".", "getCanonicalPath", "(", ");", "vulnFileCanonicalPath", "=", "vulnFileCanonicalPath", ".", "replace", "(", "\"\\", "\\\"", ",", "\"", "\\\\", "\\\\", "\")", ";", "/", "/", "this", "is", "required", "for", "Windows", "support", "Map", "<", "String", ",", "String", ">", "parameters", "=", "new", "HashMap", "<", ">(", ");", "parameters", ".", "put", "(", "\"", "VULN_FILE_PATH", "\"", ",", "vulnFileCanonicalPath", ")", ";", "HttpPost", "request", "=", "new", "HttpPost", "(", "URL", "+", "CONTEXT_URL", ")", ";", "request", ".", "setEntity", "(", "new", "StringEntity", "(", "getValidatedBundleJSON", "(", "\"", "security", "/", "mvel", "-", "payload", "-", "1", ".", "json", "\"", ",", "parameters", ")", ",", "ContentType", ".", "create", "(", "\"", "application", "/", "json", "\"", "))", ");", "TestUtils", ".", "executeContextJSONRequest", "(", "request", ")", ";", "refreshPersistence", "(", ");", "Thread", ".", "sleep", "(", "2000", ")", ";", "/", "/", "Making", "sure", "event", "is", "updated", "in", "DB", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFileCanonicalPath", ",", "vulnFile", ".", "exists", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "20", "@", "@", "{", "\"", "filters", "\"", ":", "[", "{", "\"", "id", "\"", ":", "\"", "filter1", "\"", ",", "\"", "filters", "\"", ":", "[", "{", "\"", "condition", "\"", ":", "{", "\"", "parameterValues", "\"", ":", "{", "\"", "propertyName", "\"", ":", "\"", "prop", "\"", ",", "\"", "comparisonOperator", "\"", ":", "\"", "equals", "\"", ",", "\"", "propertyValue", "\"", ":", "\"", "script", ":", ":", "Runtime", "r", "=", "Runtime", ".", "getRuntime", "(", ");", "r", ".", "exec", "(", "\\\"", "touch", "#", "##", "VULN_FILE_PATH", "#", "##", "\\\"", ");", "\"", "}", ",", "\"", "type", "\"", ":", "\"", "profilePropertyCondition", "\"", "}", "}", "]", "}", "]", ",", "\"", "sessionId", "\"", ":", "\"", "demo", "-", "session", "-", "id", "\"", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "28", "@", "@", "{", "\"", "personalizations", "\"", ":[", "{", "\"", "id", "\"", ":\"", "gender", "-", "test", "\"", ",", "\"", "strategy", "\"", ":\"", "matching", "-", "first", "\"", ",", "\"", "strategyOptions", "\"", ":{", "\"", "fallback", "\"", ":\"", "var2", "\"", "}", ",", "\"", "contents", "\"", ":[", "{", "\"", "filters", "\"", ":[", "{", "\"", "condition", "\"", ":{", "\"", "parameterValues", "\"", ":{", "\"", "propertyName", "\"", ":\"", "(#", "runtimeclass", "=", "#", "this", ".", "getClass", "(", ").", "forName", "(", "\\\"", "java", ".", "lang", ".", "Runtime", "\\", "\")", ").", "(#", "getruntimemethod", "=", "#", "runtimeclass", ".", "getDeclaredMethods", "(", ").", "{^", "#", "this", ".", "name", ".", "equals", "(", "\\\"", "getRuntime", "\\", "\")", "}[", "0", "]", ").", "(#", "rtobj", "=", "#", "getruntimemethod", ".", "invoke", "(", "null", ",", "null", ")", ").", "(#", "execmethod", "=", "#", "runtimeclass", ".", "getDeclaredMethods", "(", ").", "{?", "#", "this", ".", "name", ".", "equals", "(", "\\\"", "exec", "\\", "\")", "}.", "{?", "#", "this", ".", "getParameters", "(", ")[", "0", "]", ".", "getType", "(", ").", "getName", "(", ").", "equals", "(", "\\\"", "java", ".", "lang", ".", "String", "\\", "\")", "}.", "{?", "#", "this", ".", "getParameters", "(", ").", "length", "<", "2", "}", "[", "0", "]", ").", "(#", "execmethod", ".", "invoke", "(", "#", "rtobj", ",", "\\\"", "touch", "#", "##", "VULN_FILE_PATH", "#", "##", "\\\"", "))", "\",", "\"", "comparisonOperator", "\"", ":\"", "equals", "\"", ",", "\"", "propertyValue", "\"", ":\"", "male", "\"", "}", ",", "\"", "type", "\"", ":\"", "profilePropertyCondition", "\"", "}", "}", "]", "}", "]", "}", "]", ",", "\"", "sessionId", "\"", ":\"", "demo", "-", "session", "-", "id", "\"", "}", "@", "@", "-", "149", ",", "6", "+", "149", ",", "11", "@", "@", "<", "artifactId", ">", "unomi", "-", "web", "-", "tracker", "-", "wab", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "scripting", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "@", "@", "-", "60", ",", "6", "+", "60", ",", "7", "@", "@", "<", "bundle", "start", "-", "level", "=", "\"", "70", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "lifecycle", "-", "watcher", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "<", "bundle", "start", "-", "level", "=", "\"", "75", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "api", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "<", "bundle", "start", "-", "level", "=", "\"", "75", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "common", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "<", "bundle", "start", "-", "level", "=", "\"", "75", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "scripting", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "<", "bundle", "start", "-", "level", "=", "\"", "75", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "metrics", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "<", "bundle", "start", "-", "level", "=", "\"", "75", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "persistence", "-", "spi", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "<", "bundle", "start", "-", "level", "=", "\"", "76", "\"", "start", "=", "\"", "false", "\"", ">", "mvn", ":", "org", ".", "apache", ".", "unomi", "/", "unomi", "-", "persistence", "-", "elasticsearch", "-", "core", "/", "${", "project", ".", "version", "}", "</", "bundle", ">", "@", "@", "-", "31", ",", "8", "+", "31", ",", "13", "@", "@", "org", ".", "apache", ".", "unomi", ".", "hazelcast", ".", "network", ".", "port", "=", "${", "env", ":", "UNOMI_HAZELCAST_NETWORK_PORT", ":", "-", "5701", "#", "#", "Security", "settings", "#", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "org", ".", "apache", ".", "unomi", ".", "security", ".", "root", ".", "password", "=", "${", "env", ":", "UNOMI_ROOT_PASSWORD", ":", "-", "karaf", "}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "allow", "=", "${", "env", ":", "UNOMI_ALLOW_SCRIPTING_CLASSES", ":", "-", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "allow", "=", "${", "env", ":", "UNOMI_ALLOW_SCRIPTING_CLASSES", ":", "-", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "util", ".", "HashMap", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "forbid", "=", "${", "env", ":", "UNOMI_FORBID_SCRIPTING_CLASSES", ":", "-}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "filter", ".", "allow", "=", "${", "env", ":", "UNOMI_SCRIPTING_FILTER_ALLOW", ":", "-", "all", "}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "filter", ".", "forbid", "=", "${", "env", ":", "UNOMI_SCRIPTING_FILTER_FORBID", ":", "-.", "*", "Runtime", ".", "*,", ".*", "ProcessBuilder", ".", "*,", ".*", "exec", ".", "*,", ".*", "invoke", ".", "*,", ".*", "getClass", ".", "*,", ".*", "Class", ".", "*,", ".*", "ClassLoader", ".", "*,", ".*", "System", ".", "*,", ".*", "Method", ".", "*,", ".*", "method", ".", "*,", ".*", "Compiler", ".", "*,", ".*", "Thread", ".", "*,", ".*", "FileWriter", ".", "*,", ".*", "forName", ".", "*,", ".*", "Socket", ".", "*,", ".*", "DriverManager", ".", "*}", "org", ".", "apache", ".", "unomi", ".", "security", ".", "properties", ".", "useOGNLScripting", "=", "${", "env", ":", "UNOMI_SCRIPTING_USE_OGNL", ":", "-", "false", "}", "org", ".", "apache", ".", "unomi", ".", "security", ".", "personalization", ".", "sanitizeConditions", "=", "${", "env", ":", "UNOMI_SECURITY_SANITIZEPERSONALIZATIONCONDITIONS", ":", "-", "true", "}", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "#", "HTTP", "Settings", "#", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "@", "@", "-", "189", ",", "10", "+", "189", ",", "6", "@", "@", "<", "groupId", ">", "commons", "-", "collections", "<", "/", "groupId", ">", "<", "artifactId", ">", "commons", "-", "collections", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mvel", "<", "/", "groupId", ">", "<", "artifactId", ">", "mvel2", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "@", "@", "-", "218", ",", "6", "+", "214", ",", "13", "@", "@", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "scripting", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "@", "@", "-", "24", ",", "25", "+", "24", ",", "21", "@", "@", "import", "org", ".", "apache", ".", "lucene", ".", "analysis", ".", "charfilter", ".", "MappingCharFilterFactory", ";", "import", "org", ".", "apache", ".", "lucene", ".", "analysis", ".", "util", ".", "ClasspathResourceLoader", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "import", "org", ".", "mvel2", ".", "MVEL", ";", "import", "org", ".", "mvel2", ".", "ParserConfiguration", ";", "import", "org", ".", "mvel2", ".", "ParserContext", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "ConditionContextHelper", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ConditionContextHelper", ".", "class", ")", ";", "private", "static", "Map", "<", "String", ",", "Serializable", ">", "mvelExpressions", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "static", "MappingCharFilterFactory", "mappingCharFilterFactory", ";", "static", "{", "Map", "<", "String", ",", "String", ">", "args", "=", "new", "HashMap", "<", ">(", ");", "@", "@", "-", "55", ",", "12", "+", "51", ",", "12", "@", "@", "}", "}", "public", "static", "Condition", "getContextualCondition", "(", "Condition", "condition", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "{", "public", "static", "Condition", "getContextualCondition", "(", "Condition", "condition", ",", "Map", "<", "String", ",", "Object", ">", "context", ",", "ScriptExecutor", "scriptExecutor", ")", "{", "if", "(", "!", "hasContextualParameter", "(", "condition", ".", "getParameterValues", "(", "))", ")", "{", "return", "condition", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Map", "<", "String", ",", "Object", ">", "values", "=", "(", "Map", "<", "String", ",", "Object", ">", ")", "parseParameter", "(", "context", ",", "condition", ".", "getParameterValues", "(", "))", ";", "Map", "<", "String", ",", "Object", ">", "values", "=", "(", "Map", "<", "String", ",", "Object", ">", ")", "parseParameter", "(", "context", ",", "condition", ".", "getParameterValues", "(", "),", "scriptExecutor", ")", ";", "if", "(", "values", "=", "=", "null", ")", "{", "return", "null", ";", "}", "@", "@", "-", "70", ",", "21", "+", "66", ",", "21", "@", "@", "public", "static", "Condition", "getContextualCondition", "(", "Condition", "condition", ",", "Map", "<", "String", ",", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "private", "static", "Object", "parseParameter", "(", "Map", "<", "String", ",", "Object", ">", "context", ",", "Object", "value", ")", "{", "private", "static", "Object", "parseParameter", "(", "Map", "<", "String", ",", "Object", ">", "context", ",", "Object", "value", ",", "ScriptExecutor", "scriptExecutor", ")", "{", "if", "(", "value", "instanceof", "String", ")", "{", "if", "(", "((", "String", ")", "value", ")", ".", "startsWith", "(", "\"", "parameter", ":", ":\"", ")", "|", "|", "(", "(", "String", ")", "value", ")", ".", "startsWith", "(", "\"", "script", ":", ":\"", "))", "{", "String", "s", "=", "(", "String", ")", "value", ";", "if", "(", "s", ".", "startsWith", "(", "\"", "parameter", ":", ":\"", "))", "{", "return", "context", ".", "get", "(", "StringUtils", ".", "substringAfter", "(", "s", ",", "\"", "parameter", ":", ":\"", "))", ";", "}", "else", "if", "(", "s", ".", "startsWith", "(", "\"", "script", ":", ":\"", "))", "{", "String", "script", "=", "StringUtils", ".", "substringAfter", "(", "s", ",", "\"", "script", ":", ":\"", ");", "return", "executeScript", "(", "context", ",", "script", ")", ";", "return", "scriptExecutor", ".", "execute", "(", "script", ",", "context", ")", ";", "}", "}", "}", "else", "if", "(", "value", "instanceof", "Map", ")", "{", "Map", "<", "String", ",", "Object", ">", "values", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "(", "(", "Map", "<", "String", ",", "Object", ">", ")", "value", ")", ".", "entrySet", "(", "))", "{", "Object", "parameter", "=", "parseParameter", "(", "context", ",", "entry", ".", "getValue", "(", "))", ";", "Object", "parameter", "=", "parseParameter", "(", "context", ",", "entry", ".", "getValue", "(", "),", "scriptExecutor", ")", ";", "if", "(", "parameter", "=", "=", "null", ")", "{", "return", "null", ";", "}", "@", "@", "-", "94", ",", "7", "+", "90", ",", "7", "@", "@", "private", "static", "Object", "parseParameter", "(", "Map", "<", "String", ",", "Object", ">", "context", ",", "Object", "value", ")", "}", "else", "if", "(", "value", "instanceof", "List", ")", "{", "List", "<", "Object", ">", "values", "=", "new", "ArrayList", "<", "Object", ">", "()", ";", "for", "(", "Object", "o", ":", "(", "(", "List", "<", "?>", ")", "value", ")", ")", "{", "Object", "parameter", "=", "parseParameter", "(", "context", ",", "o", ")", ";", "Object", "parameter", "=", "parseParameter", "(", "context", ",", "o", ",", "scriptExecutor", ")", ";", "if", "(", "parameter", "!", "=", "null", ")", "{", "values", ".", "add", "(", "parameter", ")", ";", "}", "@", "@", "-", "104", ",", "22", "+", "100", ",", "6", "@", "@", "private", "static", "Object", "parseParameter", "(", "Map", "<", "String", ",", "Object", ">", "context", ",", "Object", "value", ")", "return", "value", ";", "}", "private", "static", "Object", "executeScript", "(", "Map", "<", "String", ",", "Object", ">", "context", ",", "String", "script", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "script", ")", ")", "{", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "ConditionContextHelper", ".", "class", ".", "getClassLoader", "(", "))", ";", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "mvelExpressions", ".", "put", "(", "script", ",", "MVEL", ".", "compileExpression", "(", "script", ",", "new", "ParserContext", "(", "parserConfiguration", ")", "))", ";", "}", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "script", ")", ",", "context", ")", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "}", "private", "static", "boolean", "hasContextualParameter", "(", "Object", "value", ")", "{", "if", "(", "value", "instanceof", "String", ")", "{", "if", "(", "((", "String", ")", "value", ")", ".", "startsWith", "(", "\"", "parameter", ":", ":\"", ")", "|", "|", "(", "(", "String", ")", "value", ")", ".", "startsWith", "(", "\"", "script", ":", ":\"", "))", "{", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "QueryBuilder", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "QueryBuilders", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "31", ",", "10", "+", "32", ",", "15", "@", "@", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ConditionESQueryBuilderDispatcher", ".", "class", ".", "getName", "(", "))", ";", "private", "Map", "<", "String", ",", "ConditionESQueryBuilder", ">", "queryBuilders", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "ScriptExecutor", "scriptExecutor", ";", "public", "ConditionESQueryBuilderDispatcher", "(", ")", "{", "}", "public", "void", "setScriptExecutor", "(", "ScriptExecutor", "scriptExecutor", ")", "{", "this", ".", "scriptExecutor", "=", "scriptExecutor", ";", "}", "public", "void", "addQueryBuilder", "(", "String", "name", ",", "ConditionESQueryBuilder", "evaluator", ")", "{", "queryBuilders", ".", "put", "(", "name", ",", "evaluator", ")", ";", "}", "@", "@", "-", "73", ",", "7", "+", "79", ",", "7", "@", "@", "public", "QueryBuilder", "buildFilter", "(", "Condition", "condition", ",", "Map", "<", "String", ",", "Object", ">", "context", "if", "(", "queryBuilders", ".", "containsKey", "(", "queryBuilderKey", ")", ")", "{", "ConditionESQueryBuilder", "queryBuilder", "=", "queryBuilders", ".", "get", "(", "queryBuilderKey", ")", ";", "Condition", "contextualCondition", "=", "ConditionContextHelper", ".", "getContextualCondition", "(", "condition", ",", "context", ")", ";", "Condition", "contextualCondition", "=", "ConditionContextHelper", ".", "getContextualCondition", "(", "condition", ",", "context", ",", "scriptExecutor", ")", ";", "if", "(", "contextualCondition", "!", "=", "null", ")", "{", "return", "queryBuilder", ".", "buildQuery", "(", "contextualCondition", ",", "context", ",", "this", ")", ";", "}", "@", "@", "-", "107", ",", "7", "+", "113", ",", "7", "@", "@", "public", "long", "count", "(", "Condition", "condition", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "{", "if", "(", "queryBuilders", ".", "containsKey", "(", "queryBuilderKey", ")", ")", "{", "ConditionESQueryBuilder", "queryBuilder", "=", "queryBuilders", ".", "get", "(", "queryBuilderKey", ")", ";", "Condition", "contextualCondition", "=", "ConditionContextHelper", ".", "getContextualCondition", "(", "condition", ",", "context", ")", ";", "Condition", "contextualCondition", "=", "ConditionContextHelper", ".", "getContextualCondition", "(", "condition", ",", "context", ",", "scriptExecutor", ")", ";", "if", "(", "contextualCondition", "!", "=", "null", ")", "{", "return", "queryBuilder", ".", "count", "(", "contextualCondition", ",", "context", ",", "this", ")", ";", "}", "@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricAdapter", ";", "import", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricsService", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "37", ",", "11", "+", "38", ",", "16", "@", "@", "private", "Map", "<", "String", ",", "ConditionEvaluator", ">", "evaluators", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "MetricsService", "metricsService", ";", "private", "ScriptExecutor", "scriptExecutor", ";", "public", "void", "setMetricsService", "(", "MetricsService", "metricsService", ")", "{", "this", ".", "metricsService", "=", "metricsService", ";", "}", "public", "void", "setScriptExecutor", "(", "ScriptExecutor", "scriptExecutor", ")", "{", "this", ".", "scriptExecutor", "=", "scriptExecutor", ";", "}", "public", "void", "addEvaluator", "(", "String", "name", ",", "ConditionEvaluator", "evaluator", ")", "{", "evaluators", ".", "put", "(", "name", ",", "evaluator", ")", ";", "}", "@", "@", "-", "72", ",", "7", "+", "78", ",", "7", "@", "@", "public", "boolean", "eval", "(", "Condition", "condition", ",", "Item", "item", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "return", "new", "MetricAdapter", "<", "Boolean", ">", "(", "metricsService", ",", "this", ".", "getClass", "(", ").", "getName", "(", ")", "+", "\"", ".", "conditions", ".", "\"", "+", "conditionEvaluatorKey", ")", "{", "@", "Override", "public", "Boolean", "execute", "(", "Object", ".", "..", "args", ")", "throws", "Exception", "{", "Condition", "contextualCondition", "=", "ConditionContextHelper", ".", "getContextualCondition", "(", "condition", ",", "context", ")", ";", "Condition", "contextualCondition", "=", "ConditionContextHelper", ".", "getContextualCondition", "(", "condition", ",", "context", ",", "scriptExecutor", ")", ";", "if", "(", "contextualCondition", "!", "=", "null", ")", "{", "return", "evaluator", ".", "eval", "(", "contextualCondition", ",", "item", ",", "context", ",", "dispatcher", ")", ";", "}", "else", "{", "@", "@", "-", "66", ",", "6", "+", "66", ",", "7", "@", "@", "<", "reference", "id", "=", "\"", "metricsService", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricsService", "\"", "/", ">", "<", "reference", "id", "=", "\"", "hazelcastInstance", "\"", "interface", "=", "\"", "com", ".", "hazelcast", ".", "core", ".", "HazelcastInstance", "\"", "/", ">", "<", "reference", "id", "=", "\"", "scriptExecutor", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", "\"", "/", ">", "<", "service", "id", "=", "\"", "elasticSearchPersistenceService", "\"", "ref", "=", "\"", "elasticSearchPersistenceServiceImpl", "\"", ">", "<", "interfaces", ">", "@", "@", "-", "76", ",", "11", "+", "77", ",", "13", "@", "@", "<", "bean", "id", "=", "\"", "conditionESQueryBuilderDispatcher", "\"", "class", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionESQueryBuilderDispatcher", "\"", ">", "<", "property", "name", "=", "\"", "scriptExecutor", "\"", "ref", "=", "\"", "scriptExecutor", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "conditionEvaluatorDispatcherImpl", "\"", "class", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionEvaluatorDispatcher", "\"", ">", "<", "property", "name", "=", "\"", "metricsService", "\"", "ref", "=", "\"", "metricsService", "\"", "/", ">", "<", "property", "name", "=", "\"", "scriptExecutor", "\"", "ref", "=", "\"", "scriptExecutor", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "elasticSearchPersistenceServiceImpl", "\"", "@", "@", "-", "84", ",", "6", "+", "84", ",", "12", "@", "@", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "scripting", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "!-", "-", "Unit", "tests", "-", "->", "<", "dependency", ">", "@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionESQueryBuilderDispatcher", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "PersistenceService", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "aggregate", ".", "TermsAggregate", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "QueryBuilder", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "QueryBuilders", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "RangeQueryBuilder", ";", "@", "@", "-", "38", ",", "6", "+", "39", ",", "7", "@", "@", "private", "DefinitionsService", "definitionsService", ";", "private", "PersistenceService", "persistenceService", ";", "private", "SegmentService", "segmentService", ";", "private", "ScriptExecutor", "scriptExecutor", ";", "private", "int", "maximumIdsQueryCount", "=", "5000", ";", "private", "int", "aggregateQueryBucketSize", "=", "5000", ";", "@", "@", "-", "50", ",", "6", "+", "52", ",", "10", "@", "@", "public", "void", "setPersistenceService", "(", "PersistenceService", "persistenceService", ")", "{", "this", ".", "persistenceService", "=", "persistenceService", ";", "}", "public", "void", "setScriptExecutor", "(", "ScriptExecutor", "scriptExecutor", ")", "{", "this", ".", "scriptExecutor", "=", "scriptExecutor", ";", "}", "public", "void", "setMaximumIdsQueryCount", "(", "int", "maximumIdsQueryCount", ")", "{", "this", ".", "maximumIdsQueryCount", "=", "maximumIdsQueryCount", ";", "}", "@", "@", "-", "175", ",", "7", "+", "181", ",", "7", "@", "@", "private", "Condition", "getEventCondition", "(", "Condition", "condition", ",", "Map", "<", "String", ",", "Object", ">", "con", "andCondition", ".", "setParameter", "(", "\"", "operator", "\"", ",", "\"", "and", "\"", ");", "andCondition", ".", "setParameter", "(", "\"", "subConditions", "\"", ",", "l", ")", ";", "l", ".", "add", "(", "ConditionContextHelper", ".", "getContextualCondition", "(", "eventCondition", ",", "context", ")", ");", "l", ".", "add", "(", "ConditionContextHelper", ".", "getContextualCondition", "(", "eventCondition", ",", "context", ",", "scriptExecutor", ")", ");", "Integer", "numberOfDays", "=", "(", "Integer", ")", "condition", ".", "getParameter", "(", "\"", "numberOfDays", "\"", ");", "if", "(", "numberOfDays", "!", "=", "null", ")", "{", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionEvaluator", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionEvaluatorDispatcher", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "PersistenceService", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "37", ",", "6", "+", "38", ",", "8", "@", "@", "private", "DefinitionsService", "definitionsService", ";", "private", "ScriptExecutor", "scriptExecutor", ";", "public", "void", "setPersistenceService", "(", "PersistenceService", "persistenceService", ")", "{", "this", ".", "persistenceService", "=", "persistenceService", ";", "}", "@", "@", "-", "45", ",", "6", "+", "48", ",", "10", "@", "@", "public", "void", "setDefinitionsService", "(", "DefinitionsService", "definitionsService", ")", "{", "this", ".", "definitionsService", "=", "definitionsService", ";", "}", "public", "void", "setScriptExecutor", "(", "ScriptExecutor", "scriptExecutor", ")", "{", "this", ".", "scriptExecutor", "=", "scriptExecutor", ";", "}", "@", "Override", "public", "boolean", "eval", "(", "Condition", "condition", ",", "Item", "item", ",", "Map", "<", "String", ",", "Object", ">", "context", ",", "ConditionEvaluatorDispatcher", "dispatcher", ")", "{", "@", "@", "-", "76", ",", "7", "+", "83", ",", "7", "@", "@", "public", "boolean", "eval", "(", "Condition", "condition", ",", "Item", "item", ",", "Map", "<", "String", ",", "Object", ">", "context", ",", "andCondition", ".", "setParameter", "(", "\"", "operator", "\"", ",", "\"", "and", "\"", ");", "andCondition", ".", "setParameter", "(", "\"", "subConditions", "\"", ",", "l", ")", ";", "l", ".", "add", "(", "ConditionContextHelper", ".", "getContextualCondition", "(", "eventCondition", ",", "context", ")", ");", "l", ".", "add", "(", "ConditionContextHelper", ".", "getContextualCondition", "(", "eventCondition", ",", "context", ",", "scriptExecutor", ")", ");", "Condition", "profileCondition", "=", "new", "Condition", "(", ");", "profileCondition", ".", "setConditionType", "(", "definitionsService", ".", "getConditionType", "(", "\"", "sessionPropertyCondition", "\"", "))", ";", "@", "@", "-", "23", ",", "7", "+", "23", ",", "10", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "*;", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "rules", ".", "Rule", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilter", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilterFactory", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "SecureFilteringClassLoader", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionContextHelper", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionEvaluator", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionEvaluatorDispatcher", ";", "@", "@", "-", "52", ",", "11", "+", "55", ",", "19", "@", "@", "private", "Map", "<", "String", ",", "Map", "<", "String", ",", "ExpressionAccessor", ">", ">", "expressionCache", "=", "new", "HashMap", "<", ">(", "64", ")", ";", "private", "boolean", "usePropertyConditionOptimizations", "=", "true", ";", "private", "static", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "PropertyConditionEvaluator", ".", "class", ".", "getClassLoader", "(", "))", ";", "private", "ExpressionFilterFactory", "expressionFilterFactory", ";", "private", "boolean", "useOGNLScripting", "=", "Boolean", ".", "parseBoolean", "(", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "security", ".", "properties", ".", "useOGNLScripting", "\"", ",", "\"", "false", "\"", "))", ";", "public", "void", "setUsePropertyConditionOptimizations", "(", "boolean", "usePropertyConditionOptimizations", ")", "{", "this", ".", "usePropertyConditionOptimizations", "=", "usePropertyConditionOptimizations", ";", "}", "public", "void", "setExpressionFilterFactory", "(", "ExpressionFilterFactory", "expressionFilterFactory", ")", "{", "this", ".", "expressionFilterFactory", "=", "expressionFilterFactory", ";", "}", "private", "int", "compare", "(", "Object", "actualValue", ",", "String", "expectedValue", ",", "Object", "expectedValueDate", ",", "Object", "expectedValueInteger", ",", "Object", "expectedValueDateExpr", ")", "{", "if", "(", "expectedValue", "=", "=", "null", "&", "&", "expectedValueDate", "=", "=", "null", "&", "&", "expectedValueInteger", "=", "=", "null", "&", "&", "getDate", "(", "expectedValueDateExpr", ")", "=", "=", "null", ")", "{", "return", "actualValue", "=", "=", "null", "?", "0", ":", "1", ";", "@", "@", "-", "255", ",", "7", "+", "266", ",", "12", "@", "@", "protected", "Object", "getPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "throws", "Exception", "return", "result", ";", "}", "}", "return", "getOGNLPropertyValue", "(", "item", ",", "expression", ")", ";", "if", "(", "useOGNLScripting", ")", "{", "return", "getOGNLPropertyValue", "(", "item", ",", "expression", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "OGNL", "Off", ".", "Expression", "not", "evaluated", ":", "{", "}\"", ",", "expression", ")", ";", "return", "null", ";", "}", "}", "protected", "Object", "getHardcodedPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "{", "@", "@", "-", "270", ",", "10", "+", "286", ",", "16", "@", "@", "protected", "Object", "getHardcodedPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "{", "return", "event", ".", "getTarget", "(", ").", "getItemId", "(", ");", "}", "if", "(", "expression", ".", "startsWith", "(", "\"", "target", ".", "properties", ".", "\")", ")", "{", "if", "(", "event", ".", "getTarget", "(", ")", "instanceof", "CustomItem", ")", "{", "CustomItem", "customItem", "=", "(", "CustomItem", ")", "event", ".", "getTarget", "(", ");", "String", "expressionPart", "=", "expression", ".", "substring", "(", "\"", "target", ".", "properties", ".", "\".", "length", "(", "))", ";", "return", "getNestedPropertyValue", "(", "expressionPart", ",", "customItem", ".", "getProperties", "(", "))", ";", "String", "expressionPart", "=", "expression", ".", "substring", "(", "\"", "target", ".", "properties", ".", "\".", "length", "(", "))", ";", "Item", "targetItem", "=", "event", ".", "getTarget", "(", ");", "if", "(", "targetItem", "instanceof", "CustomItem", ")", "{", "return", "getNestedPropertyValue", "(", "expressionPart", ",", "(", "(", "CustomItem", ")", "targetItem", ")", ".", "getProperties", "(", "))", ";", "}", "else", "if", "(", "targetItem", "instanceof", "Session", ")", "{", "return", "getNestedPropertyValue", "(", "expressionPart", ",", "(", "(", "Session", ")", "targetItem", ")", ".", "getProperties", "(", "))", ";", "}", "else", "if", "(", "targetItem", "instanceof", "Rule", ")", "{", "return", "null", ";", "}", "else", "if", "(", "targetItem", "instanceof", "Profile", ")", "{", "return", "getNestedPropertyValue", "(", "expressionPart", ",", "(", "(", "Profile", ")", "targetItem", ")", ".", "getProperties", "(", "))", ";", "}", "}", "if", "(", "\"", "target", ".", "scope", "\"", ".", "equals", "(", "expression", ")", ")", "{", "@", "@", "-", "282", ",", "8", "+", "304", ",", "41", "@", "@", "protected", "Object", "getHardcodedPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "{", "if", "(", "\"", "scope", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getScope", "(", ");", "}", "if", "(", "\"", "eventType", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getEventType", "(", ");", "}", "if", "(", "\"", "profile", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getProfile", "(", ");", "}", "if", "(", "\"", "profileId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getProfileId", "(", ");", "}", "if", "(", "\"", "session", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getSession", "(", ");", "}", "if", "(", "\"", "sessionId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getSessionId", "(", ");", "}", "if", "(", "\"", "source", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getSource", "(", ");", "}", "if", "(", "\"", "target", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getTarget", "(", ");", "}", "if", "(", "\"", "timeStamp", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getTimeStamp", "(", ");", "}", "if", "(", "\"", "itemId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getItemId", "(", ");", "}", "if", "(", "\"", "itemType", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "event", ".", "getItemType", "(", ");", "}", "}", "else", "if", "(", "item", "instanceof", "Session", ")", "{", "Session", "session", "=", "(", "Session", ")", "item", ";", "if", "(", "\"", "scope", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getScope", "(", ");", "}", "if", "(", "\"", "timeStamp", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getTimeStamp", "(", ");", "}", "@", "@", "-", "293", ",", "12", "+", "348", ",", "27", "@", "@", "protected", "Object", "getHardcodedPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "{", "if", "(", "\"", "size", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getSize", "(", ");", "}", "if", "(", "\"", "lastEventDate", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getLastEventDate", "(", ");", "}", "if", "(", "expression", ".", "startsWith", "(", "\"", "properties", ".", "\")", ")", "{", "return", "getNestedPropertyValue", "(", "expression", ".", "substring", "(", "\"", "properties", ".", "\".", "length", "(", "))", ",", "session", ".", "getProperties", "(", "))", ";", "}", "if", "(", "expression", ".", "startsWith", "(", "\"", "systemProperties", ".", "\")", ")", "{", "return", "getNestedPropertyValue", "(", "expression", ".", "substring", "(", "\"", "systemProperties", ".", "\".", "length", "(", "))", ",", "session", ".", "getSystemProperties", "(", "))", ";", "}", "if", "(", "\"", "itemId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getItemId", "(", ");", "}", "if", "(", "\"", "itemType", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getItemType", "(", ");", "}", "if", "(", "\"", "profile", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getProfile", "(", ");", "}", "if", "(", "\"", "profileId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "session", ".", "getProfileId", "(", ");", "}", "}", "else", "if", "(", "item", "instanceof", "Profile", ")", "{", "Profile", "profile", "=", "(", "Profile", ")", "item", ";", "if", "(", "\"", "segments", "\"", ".", "equals", "(", "expression", ")", ")", "{", "@", "@", "-", "316", ",", "17", "+", "386", ",", "38", "@", "@", "protected", "Object", "getHardcodedPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "{", "if", "(", "expression", ".", "startsWith", "(", "\"", "systemProperties", ".", "\")", ")", "{", "return", "getNestedPropertyValue", "(", "expression", ".", "substring", "(", "\"", "systemProperties", ".", "\".", "length", "(", "))", ",", "profile", ".", "getSystemProperties", "(", "))", ";", "}", "if", "(", "\"", "itemId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "profile", ".", "getItemId", "(", ");", "}", "if", "(", "\"", "itemType", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "profile", ".", "getItemType", "(", ");", "}", "if", "(", "\"", "mergedWith", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "profile", ".", "getMergedWith", "(", ");", "}", "}", "else", "if", "(", "item", "instanceof", "CustomItem", ")", "{", "CustomItem", "customItem", "=", "(", "CustomItem", ")", "item", ";", "if", "(", "expression", ".", "startsWith", "(", "\"", "properties", ".", "\")", ")", "{", "return", "getNestedPropertyValue", "(", "expression", ".", "substring", "(", "\"", "properties", ".", "\".", "length", "(", "))", ",", "customItem", ".", "getProperties", "(", "))", ";", "}", "if", "(", "\"", "itemId", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "customItem", ".", "getItemId", "(", ");", "}", "if", "(", "\"", "itemType", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "customItem", ".", "getItemType", "(", ");", "}", "if", "(", "\"", "scope", "\"", ".", "equals", "(", "expression", ")", ")", "{", "return", "customItem", ".", "getScope", "(", ");", "}", "}", "return", "NOT_OPTIMIZED_MARKER", ";", "}", "protected", "Object", "getOGNLPropertyValue", "(", "Item", "item", ",", "String", "expression", ")", "throws", "Exception", "{", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "PropertyConditionEvaluator", ".", "class", ".", "getClassLoader", "(", "))", ";", "if", "(", "expressionFilterFactory", ".", "getExpressionFilter", "(", "\"", "ognl", "\"", ").", "filter", "(", "expression", ")", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "Expression", "{", "}", "is", "not", "allowed", "!", "\",", "expression", ")", ";", "return", "null", ";", "}", "OgnlContext", "ognlContext", "=", "getOgnlContext", "(", "secureFilteringClassLoader", ")", ";", "ExpressionAccessor", "accessor", "=", "getPropertyAccessor", "(", "item", ",", "expression", ",", "ognlContext", ",", "secureFilteringClassLoader", ")", ";", "return", "accessor", "!", "=", "null", "?", "accessor", ".", "get", "(", "ognlContext", ",", "item", ")", ":", "null", ";", "@", "@", "-", "374", ",", "8", "+", "465", ",", "15", "@", "@", "public", "void", "restore", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyNa", "@", "Override", "public", "boolean", "isAccessible", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ")", "{", "int", "modifiers", "=", "member", ".", "getModifiers", "(", ");", "boolean", "result", "=", "Modifier", ".", "isPublic", "(", "modifiers", ")", ";", "return", "result", ";", "if", "(", "target", "instanceof", "Item", ")", "{", "if", "(", "\"", "getClass", "\"", ".", "equals", "(", "member", ".", "getName", "(", "))", ")", "{", "logger", ".", "warn", "(", "\"", "Target", "{", "}", "and", "member", "{", "}", "for", "property", "{", "}", "are", "not", "allowed", "by", "OGNL", "security", "filter", "\"", ",", "target", ",", "member", ",", "propertyName", ")", ";", "return", "false", ";", "}", "return", "Modifier", ".", "isPublic", "(", "modifiers", ")", ";", "}", "logger", ".", "warn", "(", "\"", "Target", "{", "}", "and", "member", "{", "}", "for", "property", "{", "}", "are", "not", "allowed", "by", "OGNL", "security", "filter", "\"", ",", "target", ",", "member", ",", "propertyName", ")", ";", "return", "false", ";", "}", "}", ",", "new", "ClassLoaderClassResolver", "(", "classLoader", ")", ",", "null", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "13", "@", "@", "[", "\"", "\\\\", "Q", "'", "systemProperties", ".", "goals", ".", "'+", "goalId", "+", "'", "TargetReached", "'", "\\\\", "E", "\"", ",", "\"", "\\\\", "Q", "'", "now", "-", "'+", "since", "+", "'", "d", "'", "\\\\", "E", "\"", ",", "\"", "\\\\", "Q", "'", "scores", ".", "'+", "scoringPlanId", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "QminimumDuration", "*", "1000", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "QmaximumDuration", "*", "1000", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "Qprofile", ".", "properties", ".", "?", "nbOfVisits", "!", "=", "null", "?", "(", "profile", ".", "properties", ".", "nbOfVisits", "+", "1", ")", ":", "1", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "Qsession", "!", "=", "null", "?", "session", ".", "size", "+", "1", ":", "0", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "Q", "'", "properties", ".", "optimizationTest_", "'", "+", "event", ".", "target", ".", "itemId", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "Qevent", ".", "target", ".", "properties", ".", "variantId", "\\", "\\", "E", "\"", ",", "\"", "\\\\", "Qprofile", ".", "properties", ".", "?", "systemProperties", ".", "goals", ".", "\\\\", "E", "[", "\\\\", "w", "\\", "\\", "_", "]", "*\\", "\\", "QReached", "!", "=", "null", "?", "(", "profile", ".", "properties", ".", "systemProperties", ".", "goals", ".", "\\\\", "E", "[", "\\\\", "w", "\\", "\\", "_", "]", "*\\", "\\", "QReached", ")", ":", "'", "now", "'", "\\\\", "E", "\"", ",", "\"", "\\\\", "Qprofile", ".", "properties", ".", "?", "systemProperties", ".", "campaigns", ".", "\\\\", "E", "[", "\\\\", "w", "\\", "\\", "_", "]", "*\\", "\\", "QEngaged", "!", "=", "null", "?", "(", "profile", ".", "properties", ".", "systemProperties", ".", "campaigns", ".", "\\\\", "E", "[", "\\\\", "w", "\\", "\\", "_", "]", "*\\", "\\", "QEngaged", ")", ":", "'", "now", "'", "\\\\", "E", "\"", "]", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "44", ",", "6", "+", "44", ",", "7", "@", "@", "<", "reference", "id", "=", "\"", "segmentService", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "SegmentService", "\"", "/>", "<", "reference", "id", "=", "\"", "eventService", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "EventService", "\"", "/>", "<", "reference", "id", "=", "\"", "configSharingService", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "ConfigSharingService", "\"", "/", ">", "<", "reference", "id", "=", "\"", "scriptExecutor", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", "\"", "/>", "<", "service", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "elasticsearch", ".", "conditions", ".", "ConditionESQueryBuilder", "\"", ">", "@", "@", "-", "102", ",", "6", "+", "103", ",", "7", "@", "@", "<", "property", "name", "=", "\"", "definitionsService", "\"", "ref", "=", "\"", "definitionsService", "\"", "/>", "<", "property", "name", "=", "\"", "persistenceService", "\"", "ref", "=", "\"", "persistenceService", "\"", "/>", "<", "property", "name", "=", "\"", "segmentService", "\"", "ref", "=", "\"", "segmentService", "\"", "/>", "<", "property", "name", "=", "\"", "scriptExecutor", "\"", "ref", "=", "\"", "scriptExecutor", "\"", "/", ">", "<", "property", "name", "=", "\"", "maximumIdsQueryCount", "\"", "value", "=", "\"$", "{", "es", ".", "maximumIdsQueryCount", "}", "\"/", ">", "<", "property", "name", "=", "\"", "aggregateQueryBucketSize", "\"", "value", "=", "\"$", "{", "es", ".", "aggregateQueryBucketSize", "}", "\"/", ">", "<", "/", "bean", ">", "@", "@", "-", "163", ",", "6", "+", "165", ",", "7", "@", "@", "<", "bean", "class", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "plugins", ".", "baseplugin", ".", "conditions", ".", "PastEventConditionEvaluator", "\"", ">", "<", "property", "name", "=", "\"", "definitionsService", "\"", "ref", "=", "\"", "definitionsService", "\"", "/>", "<", "property", "name", "=", "\"", "persistenceService", "\"", "ref", "=", "\"", "persistenceService", "\"", "/>", "<", "property", "name", "=", "\"", "scriptExecutor", "\"", "ref", "=", "\"", "scriptExecutor", "\"", "/", ">", "<", "/", "bean", ">", "<", "/", "service", ">", "@", "@", "-", "21", ",", "6", "+", "21", ",", "9", "@", "@", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilter", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilterFactory", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "io", ".", "File", ";", "@", "@", "-", "29", ",", "6", "+", "32", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutorService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Executors", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Future", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "static", "junit", ".", "framework", ".", "TestCase", ".", "assertEquals", ";", "import", "static", "junit", ".", "framework", ".", "TestCase", ".", "assertNull", ";", "@", "@", "-", "49", ",", "6", "+", "53", ",", "27", "@", "@", "private", "static", "final", "Profile", "mockProfile", "=", "generateMockProfile", "(", ");", "private", "static", "final", "Session", "mockSession", "=", "generateMockSession", "(", ");", "@", "Before", "public", "void", "setup", "(", ")", "{", "propertyConditionEvaluator", ".", "setExpressionFilterFactory", "(", "new", "ExpressionFilterFactory", "(", ")", "{", "@", "Override", "public", "ExpressionFilter", "getExpressionFilter", "(", "String", "filterCollection", ")", "{", "Set", "<", "Pattern", ">", "allowedExpressions", "=", "new", "HashSet", "<", ">(", ");", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "target", "\\", "\\.", "itemId", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "target", "\\", "\\.", "scope", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "target", "\\", "\\.", "properties", "\\", "\\.", "pageInfo", "\\", "\\.", "pagePath", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "target", "\\", "\\.", "properties", "\\", "\\.", "pageInfo", "\\", "\\.", "pageURL", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "size", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "lastEventDate", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "systemProperties", "\\", "\\.", "goals", "\\", "\\.", "_csk6r4cgeStartReached", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "properties", "\\", "\\.", "email", "\"", "))", ";", "allowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "\"", "systemProperties", "\\", "\\.", "goals", "\\", "\\.", "_csk6r4cgeStartReached", "\"", "))", ";", "Set", "<", "Pattern", ">", "forbiddenExpressions", "=", "new", "HashSet", "<", ">(", ");", "return", "new", "ExpressionFilter", "(", "allowedExpressions", ",", "forbiddenExpressions", ")", ";", "}", "}", ");", "}", "@", "Test", "public", "void", "testHardcodedEvaluator", "(", ")", "{", "Event", "mockEvent", "=", "generateMockEvent", "(", ");", "@", "@", "-", "62", ",", "7", "+", "87", ",", "7", "@", "@", "public", "void", "testHardcodedEvaluator", "(", ")", "{", "assertNull", "(", "\"", "Unexisting", "property", "should", "be", "null", "\"", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockProfile", ",", "\"", "properties", ".", "email", "\"", "))", ";", "/", "/", "here", "let", "'", "s", "make", "sure", "our", "reporting", "of", "non", "optimized", "expressions", "works", ".", "assertEquals", "(", "\"", "Should", "have", "received", "the", "non", "-", "optimized", "marker", "string", "\"", ",", "NOT_OPTIMIZED_MARKER", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockSession", ",", "\"", "lastEventDate", "\"", "))", ";", "assertEquals", "(", "\"", "Should", "have", "received", "the", "non", "-", "optimized", "marker", "string", "\"", ",", "NOT_OPTIMIZED_MARKER", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockSession", ",", "\"", "profile", ".", "itemId", "\"", "))", ";", "}", "@", "@", "-", "139", ",", "6", "+", "164", ",", "13", "@", "@", "public", "void", "testOGNLSecurity", "(", ")", "throws", "Exception", "{", "}", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFileCanonicalPath", ",", "vulnFile", ".", "exists", "(", "))", ";", "try", "{", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockEvent", ",", "\"", "(#", "runtimeclass", "=", "#", "this", ".", "getClass", "(", ").", "forName", "(", "\\\"", "java", ".", "lang", ".", "Runtime", "\\", "\")", ").", "(#", "getruntimemethod", "=", "#", "runtimeclass", ".", "getDeclaredMethods", "(", ").", "{^", "#", "this", ".", "name", ".", "equals", "(", "\\\"", "getRuntime", "\\", "\")", "}[", "0", "]", ").", "(#", "rtobj", "=", "#", "getruntimemethod", ".", "invoke", "(", "null", ",", "null", ")", ").", "(#", "execmethod", "=", "#", "runtimeclass", ".", "getDeclaredMethods", "(", ").", "{?", "#", "this", ".", "name", ".", "equals", "(", "\\\"", "exec", "\\", "\")", "}.", "{?", "#", "this", ".", "getParameters", "(", ")[", "0", "]", ".", "getType", "(", ").", "getName", "(", ").", "equals", "(", "\\\"", "java", ".", "lang", ".", "String", "\\", "\")", "}.", "{?", "#", "this", ".", "getParameters", "(", ").", "length", "<", "2", "}", "[", "0", "]", ").", "(#", "execmethod", ".", "invoke", "(", "#", "rtobj", ",", "\\\"", "touch", "\"", "+", "vulnFileCanonicalPath", "+", "\"\\", "\")", ")\"", ");", "}", "catch", "(", "RuntimeException", "|", "MethodFailedException", "re", ")", "{", "/", "/", "we", "ignore", "these", "exceptions", "as", "they", "are", "expected", ".", "}", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFileCanonicalPath", ",", "vulnFile", ".", "exists", "(", "))", ";", "}", "private", "void", "runHardcodedTest", "(", "int", "workerCount", ",", "ExecutorService", "executorService", ")", "throws", "InterruptedException", "{", "@", "@", "-", "774", ",", "7", "+", "774", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "commons", "-", "beanutils", "<", "/", "groupId", ">", "<", "artifactId", ">", "commons", "-", "beanutils", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "9", ".", "2", "<", "/", "version", ">", "<", "version", ">", "1", ".", "9", ".", "4", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "commons", "-", "collections", "<", "/", "groupId", ">", "@", "@", "-", "1024", ",", "6", "+", "1024", ",", "7", "@", "@", "<", "module", ">", "api", "<", "/", "module", ">", "<", "module", ">", "common", "<", "/", "module", ">", "<", "module", ">", "metrics", "<", "/", "module", ">", "<", "module", ">", "scripting", "<", "/", "module", ">", "<", "module", ">", "persistence", "-", "spi", "<", "/", "module", ">", "<", "module", ">", "lifecycle", "-", "watcher", "<", "/", "module", ">", "<", "module", ">", "persistence", "-", "elasticsearch", "<", "/", "module", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "94", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "~", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "~", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "~", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "~", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "~", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "~", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "~", "~", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "~", "~", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "~", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "~", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "~", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "~", "limitations", "under", "the", "License", ".", "-", "->", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "xsd", "/", "maven", "-", "4", ".", "0", ".", "0", ".", "xsd", "\"", ">", "<", "modelVersion", ">", "4", ".", "0", ".", "0", "<", "/", "modelVersion", ">", "<", "parent", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "root", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "unomi", "-", "scripting", "<", "/", "artifactId", ">", "<", "name", ">", "Apache", "Unomi", ":", ":", "Scripting", "Services", "<", "/", "name", ">", "<", "description", ">", "Scripting", "services", "used", "in", "the", "Apache", "Unomi", "Context", "server", "<", "/", "description", ">", "<", "packaging", ">", "bundle", "<", "/", "packaging", ">", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mvel", "<", "/", "groupId", ">", "<", "artifactId", ">", "mvel2", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "api", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "slf4j", "<", "/", "groupId", ">", "<", "artifactId", ">", "slf4j", "-", "simple", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "6", ".", "6", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "osgi", "<", "/", "groupId", ">", "<", "artifactId", ">", "osgi", ".", "core", "<", "/", "artifactId", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "fasterxml", ".", "jackson", ".", "core", "<", "/", "groupId", ">", "<", "artifactId", ">", "jackson", "-", "databind", "<", "/", "artifactId", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "felix", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "bundle", "-", "plugin", "<", "/", "artifactId", ">", "<", "extensions", ">", "true", "<", "/", "extensions", ">", "<", "configuration", ">", "<", "instructions", ">", "<", "Embed", "-", "Dependency", ">", "*;", "scope", "=", "compile", "|", "runtime", "<", "/", "Embed", "-", "Dependency", ">", "<", "Import", "-", "Package", ">", "org", ".", "apache", ".", "unomi", ".", "api", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "goals", ",", "*", "<", "/", "Import", "-", "Package", ">", "<", "/", "instructions", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "<", "/", "project", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "59", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "An", "expression", "filter", "is", "used", "to", "allow", "/", "deny", "scripts", "for", "execution", ".", "*", "/", "public", "class", "ExpressionFilter", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ExpressionFilter", ".", "class", ".", "getName", "(", "))", ";", "private", "final", "Set", "<", "Pattern", ">", "allowedExpressionPatterns", ";", "private", "final", "Set", "<", "Pattern", ">", "forbiddenExpressionPatterns", ";", "public", "ExpressionFilter", "(", "Set", "<", "Pattern", ">", "allowedExpressionPatterns", ",", "Set", "<", "Pattern", ">", "forbiddenExpressionPatterns", ")", "{", "this", ".", "allowedExpressionPatterns", "=", "allowedExpressionPatterns", ";", "this", ".", "forbiddenExpressionPatterns", "=", "forbiddenExpressionPatterns", ";", "}", "public", "String", "filter", "(", "String", "expression", ")", "{", "if", "(", "forbiddenExpressionPatterns", "!", "=", "null", "&", "&", "expressionMatches", "(", "expression", ",", "forbiddenExpressionPatterns", ")", ")", "{", "logger", ".", "warn", "(", "\"", "Expression", "{", "}", "is", "forbidden", "by", "expression", "filter", "\"", ",", "expression", ")", ";", "return", "null", ";", "}", "if", "(", "allowedExpressionPatterns", "!", "=", "null", "&", "&", "!", "expressionMatches", "(", "expression", ",", "allowedExpressionPatterns", ")", ")", "{", "logger", ".", "warn", "(", "\"", "Expression", "{", "}", "is", "not", "allowed", "by", "expression", "filter", "\"", ",", "expression", ")", ";", "return", "null", ";", "}", "return", "expression", ";", "}", "private", "boolean", "expressionMatches", "(", "String", "expression", ",", "Set", "<", "Pattern", ">", "patterns", ")", "{", "for", "(", "Pattern", "pattern", ":", "patterns", ")", "{", "if", "(", "pattern", ".", "matcher", "(", "expression", ")", ".", "matches", "(", "))", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ";", "/", "**", "*", "A", "factory", "interface", "to", "generate", "ExpressionFilter", "instances", "from", "a", "centralized", "configuration", "*", "/", "public", "interface", "ExpressionFilterFactory", "{", "/", "**", "*", "Retrieve", "an", "expression", "filter", "for", "the", "specified", "filterCollection", "identifier", ".", "*", "@", "param", "filterCollection", "a", "filter", "collection", "identifier", ",", "typically", "something", "like", "\"", "mvel", "\"", ",", "\"", "ognl", "\"", "*", "@", "return", "an", "instance", "of", "a", "ExpressionFilter", "with", "the", "configuration", "retrieved", "for", "the", "specified", "collection", "identifier", "*", "/", "ExpressionFilter", "getExpressionFilter", "(", "String", "filterCollection", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "80", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ";", "import", "org", ".", "mvel2", ".", "MVEL", ";", "import", "org", ".", "mvel2", ".", "ParserConfiguration", ";", "import", "org", ".", "mvel2", ".", "ParserContext", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "/", "**", "*", "MVEL", "script", "executor", "implementation", "*", "/", "public", "class", "MvelScriptExecutor", "implements", "ScriptExecutor", "{", "private", "final", "static", "String", "INVALID_SCRIPT_MARKER", "=", "\"", "--", "-", "Invalid", "Script", "Marker", "-", "--", "\";", "private", "Map", "<", "String", ",", "Serializable", ">", "mvelExpressions", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "SecureFilteringClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "private", "ExpressionFilterFactory", "expressionFilterFactory", ";", "public", "void", "setExpressionFilterFactory", "(", "ExpressionFilterFactory", "expressionFilterFactory", ")", "{", "this", ".", "expressionFilterFactory", "=", "expressionFilterFactory", ";", "}", "@", "Override", "public", "Object", "execute", "(", "String", "script", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "script", ")", ")", "{", "if", "(", "expressionFilterFactory", ".", "getExpressionFilter", "(", "\"", "mvel", "\"", ").", "filter", "(", "script", ")", "=", "=", "null", ")", "{", "mvelExpressions", ".", "put", "(", "script", ",", "INVALID_SCRIPT_MARKER", ")", ";", "}", "else", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "ParserContext", "parserContext", "=", "new", "ParserContext", "(", "parserConfiguration", ")", ";", "/", "/", "override", "hardcoded", "Class", "Literals", "that", "are", "inserted", "by", "default", "in", "MVEL", "and", "that", "may", "be", "a", "security", "risk", "parserContext", ".", "addImport", "(", "\"", "Runtime", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "System", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "ProcessBuilder", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "Class", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "ClassLoader", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "Thread", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "Compiler", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "ThreadLocal", "\"", ",", "String", ".", "class", ")", ";", "parserContext", ".", "addImport", "(", "\"", "SecurityManager", "\"", ",", "String", ".", "class", ")", ";", "mvelExpressions", ".", "put", "(", "script", ",", "MVEL", ".", "compileExpression", "(", "script", ",", "parserContext", ")", ");", "}", "}", "if", "(", "mvelExpressions", ".", "containsKey", "(", "script", ")", "&", "&", "mvelExpressions", ".", "get", "(", "script", ")", "!", "=", "INVALID_SCRIPT_MARKER", ")", "{", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "script", ")", ",", "context", ")", ";", "}", "else", "{", "return", "script", ";", "}", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "28", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ";", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "An", "interface", "to", "execute", "scripts", "with", "different", "implementations", ".", "*", "/", "public", "interface", "ScriptExecutor", "{", "Object", "execute", "(", "String", "script", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", ";", "}", "@", "@", "-", "14", ",", "14", "+", "14", ",", "14", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "common", ";", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "*", "A", "class", "loader", "that", "uses", "a", "whitelist", "and", "a", "black", "list", "of", "classes", "that", "it", "will", "allow", "to", "resolve", ".", "This", "is", "useful", "for", "providing", "proper", "*", "A", "class", "loader", "that", "uses", "a", "allow", "list", "and", "a", "deny", "list", "of", "classes", "that", "it", "will", "allow", "to", "resolve", ".", "This", "is", "useful", "for", "providing", "proper", "*", "sandboxing", "to", "scripting", "engine", "such", "as", "MVEL", ",", "OGNL", "or", "Groovy", ".", "*", "/", "public", "class", "SecureFilteringClassLoader", "extends", "ClassLoader", "{", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "static", "{", "String", "systemAllowedClasses", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "allow", "\"", ",", "\"", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*\"", ");", "\"", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "util", ".", "HashMap", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*\"", ");", "if", "(", "systemAllowedClasses", "!", "=", "null", ")", "{", "if", "(", "\"", "all", "\"", ".", "equals", "(", "systemAllowedClasses", ".", "trim", "(", "))", ")", "{", "defaultAllowedClasses", "=", "null", ";", "@", "@", "-", "98", ",", "6", "+", "98", ",", "22", "@", "@", "public", "SecureFilteringClassLoader", "(", "Set", "<", "String", ">", "allowedClasses", ",", "Set", "<", "String", ">", "forbid", "return", "delegate", ".", "loadClass", "(", "name", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "loadClass", "(", "String", "name", ",", "boolean", "resolve", ")", "throws", "ClassNotFoundException", "{", "if", "(", "forbiddenClasses", "!", "=", "null", "&", "&", "classNameMatches", "(", "forbiddenClasses", ",", "name", ")", ")", "{", "throw", "new", "ClassNotFoundException", "(", "\"", "Access", "to", "class", "\"", "+", "name", "+", "\"", "not", "allowed", "\"", ");", "}", "if", "(", "allowedClasses", "!", "=", "null", "&", "&", "!", "classNameMatches", "(", "allowedClasses", ",", "name", ")", ")", "{", "throw", "new", "ClassNotFoundException", "(", "\"", "Access", "to", "class", "\"", "+", "name", "+", "\"", "not", "allowed", "\"", ");", "}", "return", "super", ".", "loadClass", "(", "name", ",", "resolve", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "findClass", "(", "String", "name", ")", "throws", "ClassNotFoundException", "{", "return", "super", ".", "findClass", "(", "name", ")", ";", "}", "private", "boolean", "classNameMatches", "(", "Set", "<", "String", ">", "classesToTest", ",", "String", "className", ")", "{", "for", "(", "String", "classToTest", ":", "classesToTest", ")", "{", "if", "(", "classToTest", ".", "endsWith", "(", "\"*", "\")", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "190", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "internal", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "JsonNode", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilter", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilterFactory", ";", "import", "org", ".", "osgi", ".", "framework", ".", "Bundle", ";", "import", "org", ".", "osgi", ".", "framework", ".", "BundleContext", ";", "import", "org", ".", "osgi", ".", "framework", ".", "BundleEvent", ";", "import", "org", ".", "osgi", ".", "framework", ".", "BundleListener", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "public", "class", "ExpressionFilterFactoryImpl", "implements", "ExpressionFilterFactory", ",", "BundleListener", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ExpressionFilterFactoryImpl", ".", "class", ".", "getName", "(", "))", ";", "private", "final", "Map", "<", "Bundle", ",", "Map", "<", "String", ",", "Set", "<", "Pattern", ">", ">>", "allowedExpressionPatternsByBundle", "=", "new", "HashMap", "<", ">(", ");", "private", "final", "Map", "<", "String", ",", "Set", "<", "Pattern", ">", ">", "allowedExpressionPatternsByCollection", "=", "new", "HashMap", "<", ">(", ");", "private", "final", "Map", "<", "String", ",", "Set", "<", "Pattern", ">", ">", "forbiddenExpressionPatternsByCollection", "=", "new", "HashMap", "<", ">(", ");", "private", "BundleContext", "bundleContext", "=", "null", ";", "private", "final", "ObjectMapper", "objectMapper", "=", "new", "ObjectMapper", "(", ");", "private", "boolean", "expressionFiltersActivated", "=", "Boolean", ".", "parseBoolean", "(", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "filter", ".", "activated", "\"", ",", "\"", "true", "\"", "))", ";", "public", "void", "setBundleContext", "(", "BundleContext", "bundleContext", ")", "{", "this", ".", "bundleContext", "=", "bundleContext", ";", "}", "public", "ExpressionFilterFactoryImpl", "(", ")", "{", "}", "public", "void", "init", "(", ")", "{", "String", "initialFilterCollections", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "filter", ".", "collections", "\"", ",", "\"", "mvel", ",", "ognl", "\"", ");", "String", "[", "]", "initialFilterCollectionParts", "=", "initialFilterCollections", ".", "split", "(", "\",", "\")", ";", "if", "(", "initialFilterCollectionParts", "!", "=", "null", ")", "{", "for", "(", "String", "initialFilterCollection", ":", "initialFilterCollectionParts", ")", "{", "String", "systemAllowedPatterns", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "filter", ".", "\"+", "initialFilterCollection", "+", "\".", "allow", "\"", ",", "null", ")", ";", "if", "(", "systemAllowedPatterns", "!", "=", "null", ")", "{", "Set", "<", "Pattern", ">", "collectionAllowedExpressionPatterns", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "!\"", "all", "\"", ".", "equals", "(", "systemAllowedPatterns", ".", "trim", "(", "))", ")", "{", "collectionAllowedExpressionPatterns", "=", "null", ";", "}", "else", "{", "if", "(", "systemAllowedPatterns", ".", "trim", "(", ").", "length", "(", ")", ">", "0", ")", "{", "String", "[", "]", "systemAllowedPatternParts", "=", "systemAllowedPatterns", ".", "split", "(", "\",", "\")", ";", "collectionAllowedExpressionPatterns", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "String", "systemAllowedPatternPart", ":", "systemAllowedPatternParts", ")", "{", "collectionAllowedExpressionPatterns", ".", "add", "(", "Pattern", ".", "compile", "(", "systemAllowedPatternPart", ")", ");", "}", "}", "}", "allowedExpressionPatternsByCollection", ".", "put", "(", "initialFilterCollection", ",", "collectionAllowedExpressionPatterns", ")", ";", "}", "String", "systemForbiddenPatterns", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "filter", ".", "\"+", "initialFilterCollection", "+", "\".", "forbid", "\"", ",", "\"", ".*", "Runtime", ".", "*,", ".*", "ProcessBuilder", ".", "*,", ".*", "exec", ".", "*,", ".*", "invoke", ".", "*,", ".*", "getClass", ".", "*,", ".*", "Class", ".", "*,", ".*", "ClassLoader", ".", "*,", ".*", "System", ".", "*,", ".*", "Method", ".", "*,", ".*", "method", ".", "*,", ".*", "Compiler", ".", "*,", ".*", "Thread", ".", "*,", ".*", "FileWriter", ".", "*,", ".*", "forName", ".", "*,", ".*", "Socket", ".", "*,", ".*", "DriverManager", ".", "*,", "eval", "\"", ");", "if", "(", "systemForbiddenPatterns", "!", "=", "null", ")", "{", "Set", "<", "Pattern", ">", "collectionForbiddenExpressionPatterns", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "systemForbiddenPatterns", ".", "trim", "(", ").", "length", "(", ")", ">", "0", ")", "{", "String", "[", "]", "systemForbiddenPatternParts", "=", "systemForbiddenPatterns", ".", "split", "(", "\",", "\")", ";", "collectionForbiddenExpressionPatterns", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "String", "systemForbiddenPatternPart", ":", "systemForbiddenPatternParts", ")", "{", "collectionForbiddenExpressionPatterns", ".", "add", "(", "Pattern", ".", "compile", "(", "systemForbiddenPatternPart", ")", ");", "}", "}", "else", "{", "collectionForbiddenExpressionPatterns", "=", "null", ";", "}", "forbiddenExpressionPatternsByCollection", ".", "put", "(", "initialFilterCollection", ",", "collectionForbiddenExpressionPatterns", ")", ";", "}", "}", "}", "if", "(", "bundleContext", "!", "=", "null", ")", "{", "loadPredefinedAllowedPatterns", "(", "bundleContext", ")", ";", "for", "(", "Bundle", "bundle", ":", "bundleContext", ".", "getBundles", "(", "))", "{", "if", "(", "bundle", ".", "getBundleContext", "(", ")", "!", "=", "null", "&", "&", "bundle", ".", "getBundleId", "(", ")", "!", "=", "bundleContext", ".", "getBundle", "(", ").", "getBundleId", "(", "))", "{", "loadPredefinedAllowedPatterns", "(", "bundle", ".", "getBundleContext", "(", "))", ";", "}", "}", "bundleContext", ".", "addBundleListener", "(", "this", ")", ";", "}", "}", "public", "void", "destroy", "(", ")", "{", "if", "(", "bundleContext", "!", "=", "null", ")", "{", "bundleContext", ".", "removeBundleListener", "(", "this", ")", ";", "}", "}", "public", "void", "bundleChanged", "(", "BundleEvent", "event", ")", "{", "switch", "(", "event", ".", "getType", "(", "))", "{", "case", "BundleEvent", ".", "STARTED", ":", "processBundleStartup", "(", "event", ".", "getBundle", "(", ").", "getBundleContext", "(", "))", ";", "break", ";", "case", "BundleEvent", ".", "STOPPING", ":", "processBundleStop", "(", "event", ".", "getBundle", "(", ").", "getBundleContext", "(", "))", ";", "break", ";", "}", "}", "private", "void", "processBundleStartup", "(", "BundleContext", "bundleContext", ")", "{", "if", "(", "bundleContext", "=", "=", "null", ")", "{", "return", ";", "}", "loadPredefinedAllowedPatterns", "(", "bundleContext", ")", ";", "}", "private", "void", "processBundleStop", "(", "BundleContext", "bundleContext", ")", "{", "if", "(", "bundleContext", "=", "=", "null", ")", "{", "return", ";", "}", "removePredefinedAllowedPatterns", "(", "bundleContext", ")", ";", "}", "private", "void", "loadPredefinedAllowedPatterns", "(", "BundleContext", "bundleContext", ")", "{", "Enumeration", "<", "URL", ">", "predefinedAllowedExpressions", "=", "bundleContext", ".", "getBundle", "(", ").", "findEntries", "(", "\"", "META", "-", "INF", "/", "cxs", "/", "expressions", "\"", ",", "\"", "*.", "json", "\"", ",", "true", ")", ";", "if", "(", "predefinedAllowedExpressions", "=", "=", "null", ")", "{", "return", ";", "}", "Map", "<", "String", ",", "Set", "<", "Pattern", ">", ">", "predefinedAllowedExpressionsForBundle", "=", "new", "HashMap", "<", ">(", ");", "while", "(", "predefinedAllowedExpressions", ".", "hasMoreElements", "(", "))", "{", "URL", "predefinedAllowedExpressionsURL", "=", "predefinedAllowedExpressions", ".", "nextElement", "(", ");", "logger", ".", "debug", "(", "\"", "Found", "predefined", "allowed", "expressions", "at", "\"", "+", "predefinedAllowedExpressionsURL", "+", "\"", ",", "loading", ".", "..", "\"", ");", "try", "{", "JsonNode", "predefinedAllowedExpressionsNode", "=", "objectMapper", ".", "readTree", "(", "predefinedAllowedExpressionsURL", ")", ";", "Set", "<", "Pattern", ">", "bundleAllowedExpressions", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "JsonNode", "predefinedAllowedExpressionNode", ":", "predefinedAllowedExpressionsNode", ")", "{", "bundleAllowedExpressions", ".", "add", "(", "Pattern", ".", "compile", "(", "predefinedAllowedExpressionNode", ".", "asText", "(", "))", ");", "}", "String", "collection", "=", "predefinedAllowedExpressionsURL", ".", "getFile", "(", ").", "substring", "(", "\"/", "META", "-", "INF", "/", "cxs", "/", "expressions", "/", "\".", "length", "(", "),", "predefinedAllowedExpressionsURL", ".", "getFile", "(", ").", "length", "(", ")", "-", "\"", ".", "json", "\"", ".", "length", "(", "))", ";", "predefinedAllowedExpressionsForBundle", ".", "put", "(", "collection", ",", "bundleAllowedExpressions", ")", ";", "Set", "<", "Pattern", ">", "existingAllowedExpressions", "=", "allowedExpressionPatternsByCollection", ".", "get", "(", "collection", ")", ";", "if", "(", "existingAllowedExpressions", "=", "=", "null", ")", "{", "existingAllowedExpressions", "=", "new", "HashSet", "<", ">(", ");", "}", "existingAllowedExpressions", ".", "addAll", "(", "bundleAllowedExpressions", ")", ";", "allowedExpressionPatternsByCollection", ".", "put", "(", "collection", ",", "existingAllowedExpressions", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Error", "while", "loading", "expressions", "definition", "\"", "+", "predefinedAllowedExpressionsURL", ",", "e", ")", ";", "}", "}", "allowedExpressionPatternsByBundle", ".", "put", "(", "bundleContext", ".", "getBundle", "(", "),", "predefinedAllowedExpressionsForBundle", ")", ";", "}", "private", "void", "removePredefinedAllowedPatterns", "(", "BundleContext", "bundleContext", ")", "{", "Map", "<", "String", ",", "Set", "<", "Pattern", ">", ">", "allowedExpressionPatternsForBundle", "=", "allowedExpressionPatternsByBundle", ".", "get", "(", "bundleContext", ".", "getBundle", "(", "))", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Set", "<", "Pattern", ">", ">", "allowedExpressionPatternsEntry", ":", "allowedExpressionPatternsForBundle", ".", "entrySet", "(", "))", "{", "Set", "<", "Pattern", ">", "allowedExpressionPatterns", "=", "allowedExpressionPatternsByCollection", ".", "get", "(", "allowedExpressionPatternsEntry", ".", "getKey", "(", "))", ";", "allowedExpressionPatterns", ".", "removeAll", "(", "allowedExpressionPatternsEntry", ".", "getValue", "(", "))", ";", "allowedExpressionPatternsByCollection", ".", "put", "(", "allowedExpressionPatternsEntry", ".", "getKey", "(", "),", "allowedExpressionPatterns", ")", ";", "}", "}", "@", "Override", "public", "ExpressionFilter", "getExpressionFilter", "(", "String", "filterCollection", ")", "{", "if", "(", "expressionFiltersActivated", ")", "{", "return", "new", "ExpressionFilter", "(", "allowedExpressionPatternsByCollection", ".", "get", "(", "filterCollection", ")", ",", "forbiddenExpressionPatternsByCollection", ".", "get", "(", "filterCollection", ")", ");", "}", "else", "{", "/", "/", "if", "expression", "filtering", "is", "turned", "off", "we", "build", "an", "expression", "filter", "with", "no", "filters", "and", "that", "will", "accept", "everything", ".", "return", "new", "ExpressionFilter", "(", "null", ",", "null", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "[", "]", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "[", "]", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "48", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "~", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "~", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "~", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "~", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "~", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "~", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "~", "~", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "~", "~", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "~", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "~", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "~", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "~", "limitations", "under", "the", "License", ".", "-", "->", "<", "blueprint", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xmlns", ":", "cm", "=", "\"", "http", ":", "//", "aries", ".", "apache", ".", "org", "/", "blueprint", "/", "xmlns", "/", "blueprint", "-", "cm", "/", "v1", ".", "1", ".", "0", "\"", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "osgi", ".", "org", "/", "xmlns", "/", "blueprint", "/", "v1", ".", "0", ".", "0", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "www", ".", "osgi", ".", "org", "/", "xmlns", "/", "blueprint", "/", "v1", ".", "0", ".", "0", "http", ":", "//", "www", ".", "osgi", ".", "org", "/", "xmlns", "/", "blueprint", "/", "v1", ".", "0", ".", "0", "/", "blueprint", ".", "xsd", "http", ":", "//", "aries", ".", "apache", ".", "org", "/", "blueprint", "/", "xmlns", "/", "blueprint", "-", "cm", "/", "v1", ".", "1", ".", "0", "http", ":", "//", "aries", ".", "apache", ".", "org", "/", "schemas", "/", "blueprint", "-", "cm", "/", "blueprint", "-", "cm", "-", "1", ".", "1", ".", "0", ".", "xsd", "\"", ">", "<", "bean", "id", "=", "\"", "expressionFilterFactoryImpl", "\"", "init", "-", "method", "=", "\"", "init", "\"", "destroy", "-", "method", "=", "\"", "destroy", "\"", "class", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "internal", ".", "ExpressionFilterFactoryImpl", "\"", ">", "<", "property", "name", "=", "\"", "bundleContext", "\"", "ref", "=", "\"", "blueprintBundleContext", "\"", "/>", "<", "/", "bean", ">", "<", "service", "id", "=", "\"", "expressionFilterFactory", "\"", "ref", "=", "\"", "expressionFilterFactoryImpl", "\"", ">", "<", "interfaces", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ExpressionFilterFactory", "<", "/", "value", ">", "<", "/", "interfaces", ">", "<", "/", "service", ">", "<", "bean", "id", "=", "\"", "mvelScriptExecutor", "\"", "class", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "MvelScriptExecutor", "\"", ">", "<", "property", "name", "=", "\"", "expressionFilterFactory", "\"", "ref", "=", "\"", "expressionFilterFactoryImpl", "\"", "/", ">", "<", "/", "bean", ">", "<", "service", "id", "=", "\"", "scriptExecutor", "\"", "ref", "=", "\"", "mvelScriptExecutor", "\"", ">", "<", "interfaces", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", "<", "/", "value", ">", "<", "/", "interfaces", ">", "<", "service", "-", "properties", ">", "<", "entry", "key", "=", "\"", "language", "\"", "value", "=", "\"", "mvel", "\"", "/", ">", "<", "/", "service", "-", "properties", ">", "<", "/", "service", ">", "<", "/", "blueprint", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "130", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "scripting", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "public", "class", "MvelScriptExecutorTest", "{", "MvelScriptExecutor", "scriptExecutor", "=", "new", "MvelScriptExecutor", "(", ");", "public", "static", "final", "String", "MOCK_ITEM_ID", "=", "\"", "mockItemId", "\"", ";", "public", "static", "final", "String", "DIGITALL_SCOPE", "=", "\"", "digitall", "\"", ";", "public", "static", "final", "String", "PAGE_PATH_VALUE", "=", "\"", "/", "site", "/", "en", "/", "home", "/", "aboutus", ".", "html", "\"", ";", "public", "static", "final", "String", "PAGE_URL_VALUE", "=", "\"", "http", ":", "//", "localhost", ":", "8080", "/", "site", "/", "en", "/", "home", "/", "aboutus", ".", "html", "\"", ";", "@", "Before", "public", "void", "setup", "(", ")", "{", "scriptExecutor", ".", "setExpressionFilterFactory", "(", "new", "ExpressionFilterFactory", "(", ")", "{", "@", "Override", "public", "ExpressionFilter", "getExpressionFilter", "(", "String", "filterCollection", ")", "{", "Set", "<", "Pattern", ">", "allowedExpressions", "=", "new", "HashSet", "<", ">(", ");", "Set", "<", "Pattern", ">", "forbiddenExpressions", "=", "new", "HashSet", "<", ">(", ");", "return", "new", "ExpressionFilter", "(", "allowedExpressions", ",", "forbiddenExpressions", ")", ";", "}", "}", ");", "}", "@", "Test", "public", "void", "testMVELSecurity", "(", ")", "throws", "IOException", "{", "Map", "<", "String", ",", "Object", ">", "ctx", "=", "new", "HashMap", "<", ">(", ");", "Event", "mockEvent", "=", "generateMockEvent", "(", ");", "ctx", ".", "put", "(", "\"", "event", "\"", ",", "mockEvent", ")", ";", "ctx", ".", "put", "(", "\"", "session", "\"", ",", "mockEvent", ".", "getSession", "(", "))", ";", "ctx", ".", "put", "(", "\"", "profile", "\"", ",", "mockEvent", ".", "getProfile", "(", "))", ";", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "Object", "result", "=", "null", ";", "try", "{", "result", "=", "scriptExecutor", ".", "execute", "(", "\"", "java", ".", "io", ".", "PrintWriter", "writer", "=", "new", "java", ".", "io", ".", "PrintWriter", "(", "new", "java", ".", "io", ".", "BufferedWriter", "(", "new", "java", ".", "io", ".", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "System", ".", "out", ".", "println", "(", "\"", "Expected", "error", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "scriptExecutor", ".", "execute", "(", "\"", "import", "java", ".", "util", ".", "*;", "\\", "nimport", "java", ".", "io", ".", "*;", "\\", "nPrintWriter", "writer", "=", "new", "PrintWriter", "(", "new", "BufferedWriter", "(", "new", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "System", ".", "out", ".", "println", "(", "\"", "Expected", "error", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "scriptExecutor", ".", "execute", "(", "\"", "import", "java", ".", "util", ".", "*;", "\\", "nimport", "java", ".", "io", ".", "*;", "\\", "nnew", "Scanner", "(", "new", "File", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", "))", ".", "useDelimiter", "(", "\\\"", "\\\\", "\\\\", "Z", "\\", "\")", ".", "next", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "System", ".", "out", ".", "println", "(", "\"", "Expected", "error", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "scriptExecutor", ".", "execute", "(", "\"", "Runtime", "r", "=", "Runtime", ".", "getRuntime", "(", ");", "r", ".", "exec", "(", "\\\"", "touch", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")+", "\"\\", "\")", ";\"", ",", "ctx", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "System", ".", "out", ".", "println", "(", "\"", "Expected", "error", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "scriptExecutor", ".", "execute", "(", "\"", "Runtime", "r", "=", "Runtime", ".", "getClass", "(", ").", "forName", "(", "\\\"", "java", ".", "lang", ".", "Runtime", "\\", "\")", ".", "getDeclaredMethod", "(", "\\\"", "getRuntime", "\\", "\",", "null", ")", ".", "invoke", "(", "null", ",", "null", ")", ";", "r", ".", "exec", "(", "\\\"", "touch", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")+", "\"\\", "\")", ";\"", ",", "ctx", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "System", ".", "out", ".", "println", "(", "\"", "Expected", "error", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "ctx", ".", "put", "(", "\"", "goalId", "\"", ",", "\"", "d", ";", "\"", "\"", "Runtime", "r", "=", "Runtime", ".", "getClass", "(", ").", "forName", "(", "\\\"", "java", ".", "lang", ".", "Runtime", "\\", "\")", ".", "getDeclaredMethod", "(", "\\\"", "getRuntime", "\\", "\",", "null", ")", ".", "invoke", "(", "null", ",", "null", ")", ";", "r", ".", "exec", "(", "\\\"", "touch", "\"", "vulnFile", ".", "getCanonicalPath", "(", ")", "\"", "\\\"", ")\"", "\"", ";", "\"", ");", "result", "=", "scriptExecutor", ".", "execute", "(", "\"'", "systemProperties", "\\", "\\.", "goals", "\\", "\\.", "'+", "goalId", "+", "'", "TargetReached", "'", "\",", "ctx", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "System", ".", "out", ".", "println", "(", "\"", "Expected", "error", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "}", "private", "static", "Event", "generateMockEvent", "(", ")", "{", "Event", "mockEvent", "=", "new", "Event", "(", ");", "CustomItem", "targetItem", "=", "new", "CustomItem", "(", ");", "targetItem", ".", "setItemId", "(", "MOCK_ITEM_ID", ")", ";", "targetItem", ".", "setScope", "(", "DIGITALL_SCOPE", ")", ";", "mockEvent", ".", "setTarget", "(", "targetItem", ")", ";", "Map", "<", "String", ",", "Object", ">", "pageInfoMap", "=", "new", "HashMap", "<", ">(", ");", "pageInfoMap", ".", "put", "(", "\"", "pagePath", "\"", ",", "PAGE_PATH_VALUE", ")", ";", "pageInfoMap", ".", "put", "(", "\"", "pageURL", "\"", ",", "PAGE_URL_VALUE", ")", ";", "targetItem", ".", "getProperties", "(", ").", "put", "(", "\"", "pageInfo", "\"", ",", "pageInfoMap", ")", ";", "return", "mockEvent", ";", "}", "}", "@", "@", "-", "74", ",", "11", "+", "74", ",", "6", "@", "@", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mvel", "<", "/", "groupId", ">", "<", "artifactId", ">", "mvel2", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "github", ".", "fge", "<", "/", "groupId", ">", "<", "artifactId", ">", "json", "-", "patch", "<", "/", "artifactId", ">", "@", "@", "-", "160", ",", "6", "+", "155", ",", "13", "@", "@", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "scripting", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "@", "@", "-", "24", ",", "18", "+", "24", ",", "14", "@", "@", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "actions", ".", "ActionDispatcher", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "actions", ".", "ActionExecutor", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "EventService", ";", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "import", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", ";", "import", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricAdapter", ";", "import", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricsService", ";", "import", "org", ".", "mvel2", ".", "MVEL", ";", "import", "org", ".", "mvel2", ".", "ParserConfiguration", ";", "import", "org", ".", "mvel2", ".", "ParserContext", ";", "import", "org", ".", "osgi", ".", "framework", ".", "BundleContext", ";", "import", "org", ".", "osgi", ".", "framework", ".", "ServiceReference", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "44", ",", "12", "+", "40", ",", "12", "@", "@", "public", "class", "ActionExecutorDispatcher", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ActionExecutorDispatcher", ".", "class", ".", "getName", "(", "))", ";", "private", "static", "final", "String", "VALUE_NAME_SEPARATOR", "=", "\"", "::", "\";", "private", "final", "Map", "<", "String", ",", "Serializable", ">", "mvelExpressions", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "final", "Map", "<", "String", ",", "ValueExtractor", ">", "valueExtractors", "=", "new", "HashMap", "<", ">(", "11", ")", ";", "private", "Map", "<", "String", ",", "ActionExecutor", ">", "executors", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "MetricsService", "metricsService", ";", "private", "Map", "<", "String", ",", "ActionDispatcher", ">", "actionDispatchers", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "private", "BundleContext", "bundleContext", ";", "private", "ScriptExecutor", "scriptExecutor", ";", "public", "void", "setMetricsService", "(", "MetricsService", "metricsService", ")", "{", "this", ".", "metricsService", "=", "metricsService", ";", "@", "@", "-", "59", ",", "6", "+", "55", ",", "10", "@", "@", "public", "void", "setBundleContext", "(", "BundleContext", "bundleContext", ")", "{", "this", ".", "bundleContext", "=", "bundleContext", ";", "}", "public", "void", "setScriptExecutor", "(", "ScriptExecutor", "scriptExecutor", ")", "{", "this", ".", "scriptExecutor", "=", "scriptExecutor", ";", "}", "public", "ActionExecutorDispatcher", "(", ")", "{", "valueExtractors", ".", "put", "(", "\"", "profileProperty", "\"", ",", "new", "ValueExtractor", "(", ")", "{", "@", "Override", "@", "@", "-", "226", ",", "24", "+", "226", ",", "12", "@", "@", "public", "void", "unbindDispatcher", "(", "ServiceReference", "<", "ActionDispatcher", ">", "actionDispatcher", "}", "}", "protected", "Object", "executeScript", "(", "String", "valueAsString", ",", "Event", "event", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "valueAsString", ")", ")", "{", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "mvelExpressions", ".", "put", "(", "valueAsString", ",", "MVEL", ".", "compileExpression", "(", "valueAsString", ",", "new", "ParserContext", "(", "parserConfiguration", ")", "))", ";", "}", "Map", "<", "String", ",", "Object", ">", "ctx", "=", "new", "HashMap", "<", ">(", ");", "ctx", ".", "put", "(", "\"", "event", "\"", ",", "event", ")", ";", "ctx", ".", "put", "(", "\"", "session", "\"", ",", "event", ".", "getSession", "(", "))", ";", "ctx", ".", "put", "(", "\"", "profile", "\"", ",", "event", ".", "getProfile", "(", "))", ";", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "valueAsString", ")", ",", "ctx", ")", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "protected", "Object", "executeScript", "(", "String", "script", ",", "Event", "event", ")", "{", "Map", "<", "String", ",", "Object", ">", "context", "=", "new", "HashMap", "<", ">(", ");", "context", ".", "put", "(", "\"", "event", "\"", ",", "event", ")", ";", "context", ".", "put", "(", "\"", "session", "\"", ",", "event", ".", "getSession", "(", "))", ";", "context", ".", "put", "(", "\"", "profile", "\"", ",", "event", ".", "getProfile", "(", "))", ";", "return", "scriptExecutor", ".", "execute", "(", "script", ",", "context", ")", ";", "}", "}", "@", "@", "-", "64", ",", "7", "+", "64", ",", "8", "@", "@", "<", "reference", "id", "=", "\"", "karafCellarEventProducer", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "karaf", ".", "cellar", ".", "core", ".", "event", ".", "EventProducer", "\"", "/", ">", "<", "reference", "id", "=", "\"", "karafCellarGroupManager", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "karaf", ".", "cellar", ".", "core", ".", "GroupManager", "\"", "/", ">", "<", "reference", "id", "=", "\"", "osgiConfigurationAdmin", "\"", "interface", "=", "\"", "org", ".", "osgi", ".", "service", ".", "cm", ".", "ConfigurationAdmin", "\"", "/>", "<", "reference", "id", "=", "\"", "metricsService", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricsService", "\"", "/", ">", "<", "reference", "id", "=", "\"", "metricsService", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "metrics", ".", "MetricsService", "\"", "/>", "<", "reference", "id", "=", "\"", "scriptExecutor", "\"", "interface", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "ScriptExecutor", "\"", "/", ">", "<", "!-", "-", "Service", "definitions", "-", "->", "@", "@", "-", "136", ",", "6", "+", "137", ",", "7", "@", "@", "<", "bean", "id", "=", "\"", "actionExecutorDispatcherImpl", "\"", "class", "=", "\"", "org", ".", "apache", ".", "unomi", ".", "services", ".", "actions", ".", "ActionExecutorDispatcher", "\"", ">", "<", "property", "name", "=", "\"", "metricsService", "\"", "ref", "=", "\"", "metricsService", "\"", "/", ">", "<", "property", "name", "=", "\"", "scriptExecutor", "\"", "ref", "=", "\"", "scriptExecutor", "\"", "/>", "<", "property", "name", "=", "\"", "bundleContext", "\"", "ref", "=", "\"", "blueprintBundleContext", "\"", "/>", "<", "/", "bean", ">", "@", "@", "-", "1", ",", "106", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "services", ".", "actions", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ";", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mvel2", ".", "CompileException", ";", "import", "org", ".", "mvel2", ".", "MVEL", ";", "import", "org", ".", "mvel2", ".", "ParserConfiguration", ";", "import", "org", ".", "mvel2", ".", "ParserContext", ";", "import", "java", ".", "io", ".", "*;", "import", "java", ".", "util", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "public", "class", "ActionExecutorDispatcherTest", "{", "public", "static", "final", "String", "MOCK_ITEM_ID", "=", "\"", "mockItemId", "\"", ";", "public", "static", "final", "String", "DIGITALL_SCOPE", "=", "\"", "digitall", "\"", ";", "public", "static", "final", "String", "PAGE_PATH_VALUE", "=", "\"", "/", "site", "/", "en", "/", "home", "/", "aboutus", ".", "html", "\"", ";", "public", "static", "final", "String", "PAGE_URL_VALUE", "=", "\"", "http", ":", "//", "localhost", ":", "8080", "/", "site", "/", "en", "/", "home", "/", "aboutus", ".", "html", "\"", ";", "@", "Test", "public", "void", "testMVELSecurity", "(", ")", "throws", "IOException", "{", "Map", "<", "String", ",", "Object", ">", "ctx", "=", "new", "HashMap", "<", ">(", ");", "Event", "mockEvent", "=", "generateMockEvent", "(", ");", "ctx", ".", "put", "(", "\"", "event", "\"", ",", "mockEvent", ")", ";", "ctx", ".", "put", "(", "\"", "session", "\"", ",", "mockEvent", ".", "getSession", "(", "))", ";", "ctx", ".", "put", "(", "\"", "profile", "\"", ",", "mockEvent", ".", "getProfile", "(", "))", ";", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "Object", "result", "=", "null", ";", "try", "{", "result", "=", "executeMVEL", "(", "\"", "java", ".", "io", ".", "PrintWriter", "writer", "=", "new", "java", ".", "io", ".", "PrintWriter", "(", "new", "java", ".", "io", ".", "BufferedWriter", "(", "new", "java", ".", "io", ".", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "executeMVEL", "(", "\"", "import", "java", ".", "util", ".", "*;", "\\", "nimport", "java", ".", "io", ".", "*;", "\\", "nPrintWriter", "writer", "=", "new", "PrintWriter", "(", "new", "BufferedWriter", "(", "new", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "executeMVEL", "(", "\"", "import", "java", ".", "util", ".", "*;", "\\", "nimport", "java", ".", "io", ".", "*;", "\\", "nnew", "Scanner", "(", "new", "File", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", "))", ".", "useDelimiter", "(", "\\\"", "\\\\", "\\\\", "Z", "\\", "\")", ".", "next", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "}", "private", "Object", "executeMVEL", "(", "String", "expression", ",", "Object", "ctx", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "ParserContext", "parserContext", "=", "new", "ParserContext", "(", "parserConfiguration", ")", ";", "Serializable", "compiledExpression", "=", "MVEL", ".", "compileExpression", "(", "expression", ",", "parserContext", ")", ";", "try", "{", "return", "MVEL", ".", "executeExpression", "(", "compiledExpression", ",", "ctx", ",", "new", "HashMap", "(", "))", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "}", "return", "null", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "}", "private", "static", "Event", "generateMockEvent", "(", ")", "{", "Event", "mockEvent", "=", "new", "Event", "(", ");", "CustomItem", "targetItem", "=", "new", "CustomItem", "(", ");", "targetItem", ".", "setItemId", "(", "MOCK_ITEM_ID", ")", ";", "targetItem", ".", "setScope", "(", "DIGITALL_SCOPE", ")", ";", "mockEvent", ".", "setTarget", "(", "targetItem", ")", ";", "Map", "<", "String", ",", "Object", ">", "pageInfoMap", "=", "new", "HashMap", "<", ">(", ");", "pageInfoMap", ".", "put", "(", "\"", "pagePath", "\"", ",", "PAGE_PATH_VALUE", ")", ";", "pageInfoMap", ".", "put", "(", "\"", "pageURL", "\"", ",", "PAGE_URL_VALUE", ")", ";", "targetItem", ".", "getProperties", "(", ").", "put", "(", "\"", "pageInfo", "\"", ",", "pageInfoMap", ")", ";", "return", "mockEvent", ";", "}", "}", "@", "@", "-", "33", ",", "6", "+", "33", ",", "7", "@", "@", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "lifecycle", "-", "watcher", "<", "/", "value", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "api", "<", "/", "value", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "common", "<", "/", "value", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "scripting", "<", "/", "value", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "metrics", "<", "/", "value", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "persistence", "-", "spi", "<", "/", "value", ">", "<", "value", ">", "org", ".", "apache", ".", "unomi", ".", "persistence", "-", "elasticsearch", "-", "core", "<", "/", "value", ">", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "*;", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "*;", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "CustomObjectMapper", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "35", ",", "7", "+", "36", ",", "6", "@", "@", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "java", ".", "util", ".", "*;", "@", "@", "-", "59", ",", "6", "+", "59", ",", "8", "@", "@", "private", "PersonalizationService", "personalizationService", ";", "private", "ConfigSharingService", "configSharingService", ";", "private", "boolean", "sanitizeConditions", "=", "Boolean", ".", "parseBoolean", "(", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "security", ".", "personalization", ".", "sanitizeConditions", "\"", ",", "\"", "true", "\"", "))", ";", "@", "Override", "public", "void", "init", "(", "ServletConfig", "config", ")", "throws", "ServletException", "{", "super", ".", "init", "(", "config", ")", ";", "@", "@", "-", "363", ",", "7", "+", "365", ",", "7", "@", "@", "private", "Changes", "handleRequest", "(", "ContextRequest", "contextRequest", ",", "Session", "session", ",", "Pr", "List", "<", "PersonalizationService", ".", "PersonalizedContent", ">", "filterNodes", "=", "contextRequest", ".", "getFilters", "(", ");", "if", "(", "filterNodes", "!", "=", "null", ")", "{", "data", ".", "setFilteringResults", "(", "new", "HashMap", "<", ">(", "))", ";", "for", "(", "PersonalizationService", ".", "PersonalizedContent", "personalizedContent", ":", "filterNodes", ")", "{", "for", "(", "PersonalizationService", ".", "PersonalizedContent", "personalizedContent", ":", "sanitizePersonalizedContentObjects", "(", "filterNodes", ")", ")", "{", "data", ".", "getFilteringResults", "(", ").", "put", "(", "personalizedContent", ".", "getId", "(", "),", "personalizationService", ".", "filter", "(", "profile", ",", "session", ",", "personalizedContent", ")", ");", "}", "@", "@", "-", "372", ",", "7", "+", "374", ",", "7", "@", "@", "private", "Changes", "handleRequest", "(", "ContextRequest", "contextRequest", ",", "Session", "session", ",", "Pr", "List", "<", "PersonalizationService", ".", "PersonalizationRequest", ">", "personalizations", "=", "contextRequest", ".", "getPersonalizations", "(", ");", "if", "(", "personalizations", "!", "=", "null", ")", "{", "data", ".", "setPersonalizations", "(", "new", "HashMap", "<", ">(", "))", ";", "for", "(", "PersonalizationService", ".", "PersonalizationRequest", "personalization", ":", "personalizations", ")", "{", "for", "(", "PersonalizationService", ".", "PersonalizationRequest", "personalization", ":", "sanitizePersonalizations", "(", "personalizations", ")", ")", "{", "data", ".", "getPersonalizations", "(", ").", "put", "(", "personalization", ".", "getId", "(", "),", "personalizationService", ".", "personalizeList", "(", "profile", ",", "session", ",", "personalization", ")", ");", "}", "@", "@", "-", "470", ",", "4", "+", "472", ",", "89", "@", "@", "public", "void", "setPersonalizationService", "(", "PersonalizationService", "personalizationServ", "public", "void", "setConfigSharingService", "(", "ConfigSharingService", "configSharingService", ")", "{", "this", ".", "configSharingService", "=", "configSharingService", ";", "}", "private", "List", "<", "PersonalizationService", ".", "PersonalizedContent", ">", "sanitizePersonalizedContentObjects", "(", "List", "<", "PersonalizationService", ".", "PersonalizedContent", ">", "personalizedContentObjects", ")", "{", "if", "(", "!", "sanitizeConditions", ")", "{", "return", "personalizedContentObjects", ";", "}", "List", "<", "PersonalizationService", ".", "PersonalizedContent", ">", "result", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "PersonalizationService", ".", "PersonalizedContent", "personalizedContentObject", ":", "personalizedContentObjects", ")", "{", "boolean", "foundInvalidCondition", "=", "false", ";", "if", "(", "personalizedContentObject", ".", "getFilters", "(", ")", "!", "=", "null", ")", "{", "for", "(", "PersonalizationService", ".", "Filter", "filter", ":", "personalizedContentObject", ".", "getFilters", "(", "))", "{", "if", "(", "sanitizeCondition", "(", "filter", ".", "getCondition", "(", "))", "=", "=", "null", ")", "{", "foundInvalidCondition", "=", "true", ";", "break", ";", "}", "}", "}", "if", "(", "!", "foundInvalidCondition", ")", "{", "result", ".", "add", "(", "personalizedContentObject", ")", ";", "}", "}", "return", "result", ";", "}", "private", "List", "<", "PersonalizationService", ".", "PersonalizationRequest", ">", "sanitizePersonalizations", "(", "List", "<", "PersonalizationService", ".", "PersonalizationRequest", ">", "personalizations", ")", "{", "if", "(", "!", "sanitizeConditions", ")", "{", "return", "personalizations", ";", "}", "List", "<", "PersonalizationService", ".", "PersonalizationRequest", ">", "result", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "PersonalizationService", ".", "PersonalizationRequest", "personalizationRequest", ":", "personalizations", ")", "{", "List", "<", "PersonalizationService", ".", "PersonalizedContent", ">", "personalizedContents", "=", "sanitizePersonalizedContentObjects", "(", "personalizationRequest", ".", "getContents", "(", "))", ";", "if", "(", "personalizedContents", "!", "=", "null", "&", "&", "personalizedContents", ".", "size", "(", ")", ">", "0", ")", "{", "result", ".", "add", "(", "personalizationRequest", ")", ";", "}", "}", "return", "result", ";", "}", "private", "Condition", "sanitizeCondition", "(", "Condition", "condition", ")", "{", "Map", "<", "String", ",", "Object", ">", "newParameterValues", "=", "new", "LinkedHashMap", "<", ">(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "parameterEntry", ":", "condition", ".", "getParameterValues", "(", ").", "entrySet", "(", "))", "{", "Object", "sanitizedValue", "=", "sanitizeValue", "(", "parameterEntry", ".", "getValue", "(", "))", ";", "if", "(", "sanitizedValue", "!", "=", "null", ")", "{", "newParameterValues", ".", "put", "(", "parameterEntry", ".", "getKey", "(", "),", "parameterEntry", ".", "getValue", "(", "))", ";", "}", "else", "{", "return", "null", ";", "}", "}", "return", "condition", ";", "}", "private", "Object", "sanitizeValue", "(", "Object", "value", ")", "{", "if", "(", "value", "instanceof", "String", ")", "{", "String", "stringValue", "=", "(", "String", ")", "value", ";", "if", "(", "stringValue", ".", "startsWith", "(", "\"", "script", ":", ":\"", ")", "|", "|", "stringValue", ".", "startsWith", "(", "\"", "parameter", ":", ":\"", "))", "{", "logger", ".", "warn", "(", "\"", "Scripting", "detected", "in", "context", "request", "with", "value", "{", "},", "filtering", "out", ".", "..", "\",", "value", ")", ";", "return", "null", ";", "}", "else", "{", "return", "stringValue", ";", "}", "}", "else", "if", "(", "value", "instanceof", "List", ")", "{", "List", "values", "=", "(", "List", ")", "value", ";", "List", "newValues", "=", "new", "ArrayList", "(", ");", "for", "(", "Object", "listObject", ":", "values", ")", "{", "Object", "newObject", "=", "sanitizeValue", "(", "listObject", ")", ";", "if", "(", "newObject", "!", "=", "null", ")", "{", "newValues", ".", "add", "(", "newObject", ")", ";", "}", "}", "return", "values", ";", "}", "else", "if", "(", "value", "instanceof", "Map", ")", "{", "Map", "<", "Object", ",", "Object", ">", "newMap", "=", "new", "LinkedHashMap", "<", ">(", ");", "(", "(", "Map", "<", "?,", "?", ">)", "value", ")", ".", "forEach", "(", "(", "key", ",", "value1", ")", "-", ">", "{", "Object", "newObject", "=", "sanitizeValue", "(", "value1", ")", ";", "if", "(", "newObject", "!", "=", "null", ")", "{", "newMap", ".", "put", "(", "key", ",", "newObject", ")", ";", "}", "}", ");", "return", "newMap", ";", "}", "else", "if", "(", "value", "instanceof", "Condition", ")", "{", "return", "sanitizeCondition", "(", "(", "Condition", ")", "value", ")", ";", "}", "else", "{", "return", "value", ";", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Verify", "that", "zip", "file", "entries", "don't", "try", "to", "escape", "the", "parent", "dir", "+", "test", "Signed-off-by:", "Bart", "Hanssens", "<bart.hanssens@bosa.fgov.be>"], "code_tokens": ["@", "@", "-", "26", ",", "9", "+", "26", ",", "14", "@", "@", "*", "/", "private", "final", "static", "byte", "MAGIC_NUMBER", "[", "]", "=", "{", "(", "byte", ")", "0x50", ",", "(", "byte", ")", "0x4B", ",", "(", "byte", ")", "0x03", ",", "(", "byte", ")", "0x04", "}", ";", "public", "static", "boolean", "isZipStream", "(", "InputStream", "in", ")", "throws", "IOException", "{", "/", "**", "*", "Test", "if", "an", "input", "stream", "is", "a", "zip", "input", "stream", "by", "checking", "the", "\"", "magic", "number", "\"", "*", "*", "@", "param", "in", "input", "stream", "*", "@", "return", "true", "if", "start", "of", "input", "stream", "matches", "magic", "number", "*", "@", "throws", "IOException", "*", "/", "public", "static", "boolean", "isZipStream", "(", "InputStream", "in", ")", "throws", "IOException", "{", "in", ".", "mark", "(", "MAGIC_NUMBER", ".", "length", ")", ";", "byte", "[", "]", "fileHeader", "=", "IOUtil", ".", "readBytes", "(", "in", ",", "MAGIC_NUMBER", ".", "length", ")", ";", "in", ".", "reset", "(", ");", "@", "@", "-", "45", ",", "9", "+", "50", ",", "7", "@", "@", "public", "static", "boolean", "isZipStream", "(", "InputStream", "in", ")", "*", "@", "throws", "IOException", "*", "when", "something", "untoward", "happens", "during", "the", "extraction", "process", "*", "/", "public", "static", "void", "extract", "(", "File", "zipFile", ",", "File", "destDir", ")", "throws", "IOException", "{", "public", "static", "void", "extract", "(", "File", "zipFile", ",", "File", "destDir", ")", "throws", "IOException", "{", "try", "(", "ZipFile", "zf", "=", "new", "ZipFile", "(", "zipFile", ")", ")", "{", "extract", "(", "zf", ",", "destDir", ")", ";", "}", "@", "@", "-", "61", ",", "11", "+", "64", ",", "9", "@", "@", "public", "static", "void", "extract", "(", "File", "zipFile", ",", "File", "destDir", ")", "*", "@", "param", "destDir", "*", "the", "destination", "directory", "*", "@", "throws", "IOException", "*", "when", "something", "untowards", "happens", "during", "the", "extraction", "process", "*", "when", "something", "untoward", "happens", "during", "the", "extraction", "process", "*", "/", "public", "static", "void", "extract", "(", "ZipFile", "zipFile", ",", "File", "destDir", ")", "throws", "IOException", "{", "public", "static", "void", "extract", "(", "ZipFile", "zipFile", ",", "File", "destDir", ")", "throws", "IOException", "{", "assert", "destDir", ".", "isDirectory", "(", ");", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", "=", "zipFile", ".", "entries", "(", ");", "@", "@", "-", "87", ",", "15", "+", "88", ",", "16", "@", "@", "public", "static", "void", "extract", "(", "ZipFile", "zipFile", ",", "File", "destDir", ")", "*", "@", "throws", "IOException", "*", "if", "the", "entry", "could", "not", "be", "processed", "*", "/", "public", "static", "void", "writeEntry", "(", "ZipFile", "zipFile", ",", "ZipEntry", "entry", ",", "File", "destDir", ")", "throws", "IOException", "{", "public", "static", "void", "writeEntry", "(", "ZipFile", "zipFile", ",", "ZipEntry", "entry", ",", "File", "destDir", ")", "throws", "IOException", "{", "File", "outFile", "=", "new", "File", "(", "destDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outFile", ".", "getCanonicalFile", "(", ").", "toPath", "(", ").", "startsWith", "(", "destDir", ".", "toPath", "(", "))", ")", "{", "throw", "new", "IOException", "(", "\"", "Zip", "entry", "outside", "destination", "directory", ":", "\"", "+", "entry", ".", "getName", "(", "))", ";", "}", "if", "(", "entry", ".", "isDirectory", "(", "))", "{", "outFile", ".", "mkdirs", "(", ");", "}", "else", "{", "}", "else", "{", "outFile", ".", "getParentFile", "(", ").", "mkdirs", "(", ");", "try", "(", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "69", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Copyright", "(", "c", ")", "2018", "Eclipse", "RDF4J", "contributors", ".", "*", "All", "rights", "reserved", ".", "This", "program", "and", "the", "accompanying", "materials", "*", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Distribution", "License", "v1", ".", "0", "*", "which", "accompanies", "this", "distribution", ",", "and", "is", "available", "at", "*", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "org", "/", "documents", "/", "edl", "-", "v10", ".", "php", ".", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "eclipse", ".", "rdf4j", ".", "common", ".", "io", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipEntry", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipFile", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipOutputStream", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "public", "class", "ZipUtilTest", "{", "@", "Rule", "public", "TemporaryFolder", "dir", "=", "new", "TemporaryFolder", "(", ");", "@", "Test", "public", "void", "testWriteEntryNormal", "(", ")", "throws", "IOException", "{", "File", "f", "=", "dir", ".", "newFile", "(", "\"", "testok", ".", "zip", "\"", ");", "try", "(", "ZipOutputStream", "out", "=", "new", "ZipOutputStream", "(", "new", "FileOutputStream", "(", "f", ")", "))", "{", "ZipEntry", "e", "=", "new", "ZipEntry", "(", "\"", "helloworld", ".", "txt", "\"", ");", "out", ".", "putNextEntry", "(", "e", ")", ";", "out", ".", "write", "(", "\"", "hello", "world", "\"", ".", "getBytes", "(", "))", ";", "out", ".", "closeEntry", "(", ");", "}", "ZipFile", "zf", "=", "new", "ZipFile", "(", "f", ")", ";", "File", "subdir", "=", "dir", ".", "newFolder", "(", "\"", "extract", "\"", ");", "ZipUtil", ".", "extract", "(", "zf", ",", "subdir", ")", ";", "assertTrue", "(", "\"", "File", "not", "extracted", "\"", ",", "new", "File", "(", "subdir", ",", "\"", "helloworld", ".", "txt", "\"", ").", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testWriteEntryPathTraversing", "(", ")", "throws", "IOException", "{", "File", "f", "=", "dir", ".", "newFile", "(", "\"", "testnotok", ".", "zip", "\"", ");", "try", "(", "ZipOutputStream", "out", "=", "new", "ZipOutputStream", "(", "new", "FileOutputStream", "(", "f", ")", "))", "{", "ZipEntry", "e", "=", "new", "ZipEntry", "(", "\"", "hello", "/", "..", "/.", "./", "world", ".", "txt", "\"", ");", "out", ".", "putNextEntry", "(", "e", ")", ";", "out", ".", "write", "(", "\"", "hello", "world", "\"", ".", "getBytes", "(", "))", ";", "out", ".", "closeEntry", "(", ");", "}", "ZipFile", "zf", "=", "new", "ZipFile", "(", "f", ")", ";", "File", "subdir", "=", "dir", ".", "newFolder", "(", "\"", "extract", "\"", ");", "try", "{", "ZipUtil", ".", "extract", "(", "zf", ",", "subdir", ")", ";", "fail", "(", "\"", "No", "exception", "thrown", "\"", ");", "}", "catch", "(", "IOException", "ioe", ")", "{", "assertTrue", "(", "ioe", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "Zip", "entry", "outside", "destination", "directory", "\"", "))", ";", "}", "}", "}"], "docstring_tokens": ["via", "../", "in", "an", "entry", "in", "a", "ZIP", "archive", "."]}
{"contents": ["Fix", "bug", "#73192"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "30", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "73192", ":", "parse_url", "return", "wrong", "hostname", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "parse_url", "(", "\"", "http", ":", "//", "example", ".", "com", ":", "80", "#", "@", "google", ".", "com", "/", "\")", ");", "var_dump", "(", "parse_url", "(", "\"", "http", ":", "//", "example", ".", "com", ":", "80", "?", "@", "google", ".", "com", "/", "\")", ");", "?", ">", "-", "-", "EXPECT", "-", "-", "array", "(", "4", ")", "{", "[", "\"", "scheme", "\"", "]=", ">", "string", "(", "4", ")", "\"", "http", "\"", "[", "\"", "host", "\"", "]=", ">", "string", "(", "11", ")", "\"", "example", ".", "com", "\"", "[", "\"", "port", "\"", "]=", ">", "int", "(", "80", ")", "[", "\"", "fragment", "\"", "]=", ">", "string", "(", "12", ")", "\"", "@", "google", ".", "com", "/", "\"", "}", "array", "(", "4", ")", "{", "[", "\"", "scheme", "\"", "]=", ">", "string", "(", "4", ")", "\"", "http", "\"", "[", "\"", "host", "\"", "]=", ">", "string", "(", "11", ")", "\"", "example", ".", "com", "\"", "[", "\"", "port", "\"", "]=", ">", "int", "(", "80", ")", "[", "\"", "query", "\"", "]=", ">", "string", "(", "12", ")", "\"", "@", "google", ".", "com", "/", "\"", "}", "@", "@", "-", "763", ",", "25", "+", "763", ",", "9", "@", "@", "echo", "\"", "Done", "\"", ";", "int", "(", "6", ")", "}", ">", "http", ":", "//", "?:", "/:", "array", "(", "3", ")", "{", "[", "\"", "scheme", "\"", "]=", ">", "string", "(", "4", ")", "\"", "http", "\"", "[", "\"", "host", "\"", "]=", ">", "string", "(", "1", ")", "\"", "?\"", "[", "\"", "path", "\"", "]=", ">", "string", "(", "1", ")", "\"", "/\"", "}", "-", "->", "http", ":", "//", "?:", "/:", "bool", "(", "false", ")", ">", "http", ":", "//", "@?", ":/", ":", "array", "(", "4", ")", "{", "[", "\"", "scheme", "\"", "]=", ">", "string", "(", "4", ")", "\"", "http", "\"", "[", "\"", "host", "\"", "]=", ">", "string", "(", "1", ")", "\"", "?\"", "[", "\"", "user", "\"", "]=", ">", "string", "(", "0", ")", "\"", "\"", "[", "\"", "path", "\"", "]=", ">", "string", "(", "1", ")", "\"", "/\"", "}", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "array", "(", "2", ")", "{", "[", "\"", "scheme", "\"", "]=", ">", "@", "@", "-", "98", ",", "8", "+", "98", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "string", "(", "4", ")", "\"", "http", "\"", "-", "->", "http", ":", "//", "::", "#", ":", "string", "(", "4", ")", "\"", "http", "\"", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "string", "(", "1", ")", "\"", "x", "\"", ">", "http", ":", "//", "?:", "/", ":", "string", "(", "4", ")", "\"", "http", "\"", ">", "http", ":", "//", "@?", ":/", ":", "string", "(", "4", ")", "\"", "http", "\"", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "string", "(", "4", ")", "\"", "file", "\"", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "string", "(", "4", ")", "\"", "file", "\"", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "string", "(", "4", ")", "\"", "file", "\"", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "string", "(", "1", ")", "\"", ":\"", "-", "->", "http", ":", "//", "::", "#", ":", "string", "(", "1", ")", "\"", ":\"", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "string", "(", "1", ")", "\"", ":\"", ">", "http", ":", "//", "?:", "/", ":", "string", "(", "1", ")", "\"", "?\"", ">", "http", ":", "//", "@?", ":/", ":", "string", "(", "1", ")", "\"", "?\"", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "NULL", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "NULL", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "NULL", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "NULL", "-", "->", "http", ":", "//", "::", "#", ":", "NULL", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "int", "(", "6", ")", ">", "http", ":", "//", "?:", "/", ":", "NULL", ">", "http", ":", "//", "@?", ":/", ":", "NULL", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "NULL", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "NULL", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "NULL", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "NULL", "-", "->", "http", ":", "//", "::", "#", ":", "NULL", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "NULL", ">", "http", ":", "//", "?:", "/", ":", "NULL", ">", "http", ":", "//", "@?", ":/", ":", "string", "(", "0", ")", "\"", "\"", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "NULL", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "NULL", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "NULL", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "NULL", "-", "->", "http", ":", "//", "::", "#", ":", "NULL", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "NULL", ">", "http", ":", "//", "?:", "/", ":", "NULL", ">", "http", ":", "//", "@?", ":/", ":", "NULL", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "NULL", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "NULL", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "NULL", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "NULL", "-", "->", "http", ":", "//", "::", "#", ":", "NULL", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "NULL", ">", "http", ":", "//", "?:", "/", ":", "string", "(", "1", ")", "\"", "/\"", ">", "http", ":", "//", "@?", ":/", ":", "string", "(", "1", ")", "\"", "/\"", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "string", "(", "2", ")", "\"", "/:", "\"", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "string", "(", "3", ")", "\"", "a", ":", "/\"", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "string", "(", "5", ")", "\"", "/", "ab", ":", "/\"", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "NULL", "-", "->", "http", ":", "//", "::", "#", ":", "NULL", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "NULL", ">", "http", ":", "//", "?:", "/", ":", "NULL", ">", "http", ":", "//", "@?", ":/", ":", "NULL", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "NULL", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "NULL", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "NULL", "@", "@", "-", "97", ",", "8", "+", "97", ",", "8", "@", "@", "echo", "\"", "Done", "\"", ";", "-", "->", "http", ":", "//", "::", "?", ":", "NULL", "-", "->", "http", ":", "//", "::", "#", ":", "NULL", "-", "->", "x", ":", "//", "::", "6", ".", "5", ":", "NULL", ">", "http", ":", "//", "?:", "/", ":", "NULL", ">", "http", ":", "//", "@?", ":/", ":", "NULL", "-", "->", "http", ":", "//", "?:", "/", ":", "bool", "(", "false", ")", "-", "->", "http", ":", "//", "@?", ":/", ":", "bool", "(", "false", ")", "-", "->", "file", ":", "//", "/:", ":", "NULL", "-", "->", "file", ":", "//", "/", "a", ":", "/", ":", "NULL", "-", "->", "file", ":", "//", "/", "ab", ":", "/", ":", "NULL", "@", "@", "-", "217", ",", "28", "+", "217", ",", "7", "@", "@", "PHPAPI", "php_url", "*", "php_url_parse_ex", "(", "char", "const", "*", "str", ",", "int", "length", ")", "goto", "nohost", ";", "}", "e", "=", "ue", ";", "if", "(", "!(", "p", "=", "memchr", "(", "s", ",", "'", "/'", ",", "(", "ue", "-", "s", ")", "))", ")", "{", "char", "*", "query", ",", "*", "fragment", ";", "query", "=", "memchr", "(", "s", ",", "'", "?'", ",", "(", "ue", "-", "s", ")", ");", "fragment", "=", "memchr", "(", "s", ",", "'", "#'", ",", "(", "ue", "-", "s", ")", ");", "if", "(", "query", "&", "&", "fragment", ")", "{", "if", "(", "query", ">", "fragment", ")", "{", "e", "=", "fragment", ";", "}", "else", "{", "e", "=", "query", ";", "}", "}", "else", "if", "(", "query", ")", "{", "e", "=", "query", ";", "}", "else", "if", "(", "fragment", ")", "{", "e", "=", "fragment", ";", "}", "}", "else", "{", "e", "=", "p", ";", "}", "e", "=", "s", "+", "strcspn", "(", "s", ",", "\"", "/?", "#\"", ");", "/", "*", "check", "for", "login", "and", "password", "*", "/", "if", "(", "(", "p", "=", "zend_memrchr", "(", "s", ",", "'", "@'", ",", "(", "e", "-", "s", ")", "))", ")", "{"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["fix", "#41561", "(Values", "set", "with", "php_admin_*", "in", "httpd.conf", "can", "be", "overwritten", "with", "ini_set())"], "code_tokens": ["@", "@", "-", "245", ",", "6", "+", "245", ",", "10", "@", "@", "ZEND_API", "int", "zend_alter_ini_entry", "(", "char", "*", "name", ",", "uint", "name_length", ",", "char", "*", "new_value", ",", "return", "FAILURE", ";", "}", "if", "(", "stage", "=", "=", "ZEND_INI_STAGE_ACTIVATE", "&", "&", "modify_type", "=", "=", "ZEND_INI_SYSTEM", ")", "{", "ini_entry", "-", ">", "modifiable", "=", "ZEND_INI_SYSTEM", ";", "}", "duplicate", "=", "estrndup", "(", "new_value", ",", "new_value_length", ")", ";", "if", "(", "!", "ini_entry", "-", ">", "on_modify"], "docstring_tokens": ["by", "using", "ini_set", "to", "modify", "arbitrary", "configuration", "variables"]}
{"contents": ["Disable", "message", "interpolation", "in", "ConstraintViolations", "by", "default", "(#3208)", "Disable", "message", "interpolation", "in", "ConstraintViolations", "by", "default", "but", "allow", "enabling", "it", "explicitly", "with", "`SelfValidating#escapeExpressions()`.", "Additionally,", "`ConstraintViolations`", "now", "provides", "a", "set", "of", "methods", "which", "take", "a", "map", "of", "message", "parameters", "for", "interpolation.", "The", "message", "parameters", "will", "be", "escaped", "by", "default.", "Refs", "#3153", "Refs", "#3157"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "38", "@", "@", "/", "*", "*", "Hibernate", "Validator", ",", "declare", "and", "validate", "application", "constraints", "*", "*", "License", ":", "Apache", "License", ",", "Version", "2", ".", "0", "*", "See", "the", "license", ".", "txt", "file", "in", "the", "root", "directory", "or", "<", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ">", ".", "*", "/", "package", "io", ".", "dropwizard", ".", "validation", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "Utilities", "used", "for", "message", "interpolation", ".", "*", "*", "@", "author", "Guillaume", "Smet", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "final", "class", "InterpolationHelper", "{", "public", "static", "final", "char", "BEGIN_TERM", "=", "'", "{'", ";", "public", "static", "final", "char", "END_TERM", "=", "'", "}'", ";", "public", "static", "final", "char", "EL_DESIGNATOR", "=", "'", "$'", ";", "public", "static", "final", "char", "ESCAPE_CHARACTER", "=", "'", "\\\\", "';", "private", "static", "final", "Pattern", "ESCAPE_MESSAGE_PARAMETER_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "[\\", "\\\"", "+", "ESCAPE_CHARACTER", "+", "BEGIN_TERM", "+", "END_TERM", "+", "EL_DESIGNATOR", "+", "\"", "])", "\")", ";", "private", "InterpolationHelper", "(", ")", "{", "}", "@", "Nullable", "public", "static", "String", "escapeMessageParameter", "(", "@", "Nullable", "String", "messageParameter", ")", "{", "if", "(", "messageParameter", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "ESCAPE_MESSAGE_PARAMETER_PATTERN", ".", "matcher", "(", "messageParameter", ")", ".", "replaceAll", "(", "Matcher", ".", "quoteReplacement", "(", "String", ".", "valueOf", "(", "ESCAPE_CHARACTER", ")", ")", "+", "\"", "$", "1", "\"", ");", "}", "}", "@", "@", "-", "7", ",", "6", "+", "7", ",", "7", "@", "@", "import", "java", ".", "lang", ".", "annotation", ".", "Retention", ";", "import", "java", ".", "lang", ".", "annotation", ".", "RetentionPolicy", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Target", ";", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "The", "annotated", "element", "has", "methods", "annotated", "by", "@", "@", "-", "24", ",", "4", "+", "25", ",", "16", "@", "@", "Class", "<", "?>", "[]", "groups", "(", ")", "default", "{", "};", "Class", "<", "?", "extends", "Payload", ">", "[]", "payload", "(", ")", "default", "{", "};", "/", "**", "*", "Escape", "EL", "expressions", "to", "avoid", "template", "injection", "attacks", ".", "*", "<", "p", ">", "*", "This", "has", "serious", "security", "implications", "and", "you", "will", "*", "have", "to", "escape", "the", "violation", "messages", "added", "to", "{", "@", "link", "ViolationCollector", "}", "appropriately", ".", "*", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Map", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "String", ",", "Map", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Integer", ",", "String", ",", "Map", ")", "*", "/", "boolean", "escapeExpressions", "(", ")", "default", "true", ";", "}", "@", "@", "-", "31", ",", "15", "+", "31", ",", "17", "@", "@", "private", "final", "AnnotationConfiguration", "annotationConfiguration", "=", "new", "AnnotationConfiguration", ".", "StdConfiguration", "(", "AnnotationInclusion", ".", "INCLUDE_AND_INHERIT_IF_INHERITED", ")", ";", "private", "final", "TypeResolver", "typeResolver", "=", "new", "TypeResolver", "(", ");", "private", "final", "MemberResolver", "memberResolver", "=", "new", "MemberResolver", "(", "typeResolver", ")", ";", "private", "boolean", "escapeExpressions", "=", "true", ";", "@", "Override", "public", "void", "initialize", "(", "SelfValidating", "constraintAnnotation", ")", "{", "escapeExpressions", "=", "constraintAnnotation", ".", "escapeExpressions", "(", ");", "}", "@", "SuppressWarnings", "(", "{\"", "unchecked", "\"", ",", "\"", "rawtypes", "\"", "})", "@", "Override", "public", "boolean", "isValid", "(", "Object", "value", ",", "ConstraintValidatorContext", "context", ")", "{", "final", "ViolationCollector", "collector", "=", "new", "ViolationCollector", "(", "context", ")", ";", "final", "ViolationCollector", "collector", "=", "new", "ViolationCollector", "(", "context", ",", "escapeExpressions", ")", ";", "context", ".", "disableDefaultConstraintViolation", "(", ");", "for", "(", "ValidationCaller", "caller", ":", "methodMap", ".", "computeIfAbsent", "(", "value", ".", "getClass", "(", "),", "this", ":", ":", "findMethods", ")", ")", "{", "caller", ".", "setValidationObject", "(", "value", ")", ";", "@", "@", "-", "1", ",", "64", "+", "1", ",", "116", "@", "@", "package", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "constraintvalidation", ".", "HibernateConstraintValidatorContext", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "javax", ".", "validation", ".", "ConstraintValidatorContext", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "io", ".", "dropwizard", ".", "validation", ".", "InterpolationHelper", ".", "escapeMessageParameter", ";", "/", "**", "*", "This", "class", "is", "a", "simple", "wrapper", "around", "the", "ConstraintValidatorContext", "of", "hibernate", "validation", ".", "*", "It", "collects", "all", "the", "violations", "of", "the", "SelfValidation", "methods", "of", "an", "object", ".", "*", "/", "public", "class", "ViolationCollector", "{", "private", "static", "final", "Pattern", "ESCAPE_PATTERN", "=", "Pattern", ".", "compile", "(", "\"\\", "\\$", "\\\\", "{\"", ");", "private", "final", "ConstraintValidatorContext", "constraintValidatorContext", ";", "private", "final", "boolean", "escapeExpressions", ";", "private", "boolean", "violationOccurred", "=", "false", ";", "private", "ConstraintValidatorContext", "context", ";", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "constraintValidatorContext", ")", "{", "this", "(", "constraintValidatorContext", ",", "true", ")", ";", "}", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "context", ")", "{", "this", ".", "context", "=", "context", ";", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "constraintValidatorContext", ",", "boolean", "escapeExpressions", ")", "{", "this", ".", "constraintValidatorContext", "=", "constraintValidatorContext", ";", "this", ".", "escapeExpressions", "=", "escapeExpressions", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "<", "p", ">", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "see", "#", "addViolation", "(", "String", ",", "Map", ")", "*", "/", "public", "void", "addViolation", "(", "String", "message", ")", "{", "addViolation", "(", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", ".", "addConstraintViolation", "(", ");", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "<", "p", ">", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "see", "#", "addViolation", "(", "String", ",", "String", ",", "Map", ")", "*", "@", "since", "2", ".", "0", ".", "2", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ")", "{", "addViolation", "(", "propertyName", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addConstraintViolation", "(", ");", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "index", "the", "index", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Integer", ",", "String", ",", "Map", ")", "*", "@", "since", "2", ".", "0", ".", "2", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ")", "{", "addViolation", "(", "propertyName", ",", "index", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "index", "the", "index", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ").", "inIterable", "(", ").", "atIndex", "(", "index", ")", ".", "addConstraintViolation", "(", ");", "@", "@", "-", "69", ",", "32", "+", "121", ",", "46", "@", "@", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ")", "{", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "key", "the", "key", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "since", "2", ".", "0", ".", "2", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ")", "{", "addViolation", "(", "propertyName", ",", "key", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "key", "the", "key", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "final", "String", "messageTemplate", "=", "sanitizeTemplate", "(", "message", ")", ";", "final", "HibernateConstraintValidatorContext", "context", "=", "getContextWithMessageParameters", "(", "messageParameters", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ").", "inIterable", "(", ").", "atKey", "(", "key", ")", ".", "addConstraintViolation", "(", ");", "}", "@", "Nullable", "private", "String", "escapeEl", "(", "@", "Nullable", "String", "s", ")", "{", "if", "(", "s", "=", "=", "null", "|", "|", "s", ".", "isEmpty", "(", "))", "{", "return", "s", ";", "}", "final", "Matcher", "m", "=", "ESCAPE_PATTERN", ".", "matcher", "(", "s", ")", ";", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", "s", ".", "length", "(", ")", "+", "16", ")", ";", "while", "(", "m", ".", "find", "(", "))", "{", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "\\\\", "\\\\", "\\\\", "${", "\")", ";", "private", "HibernateConstraintValidatorContext", "getContextWithMessageParameters", "(", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "final", "HibernateConstraintValidatorContext", "context", "=", "constraintValidatorContext", ".", "unwrap", "(", "HibernateConstraintValidatorContext", ".", "class", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "messageParameter", ":", "messageParameters", ".", "entrySet", "(", "))", "{", "final", "Object", "value", "=", "messageParameter", ".", "getValue", "(", ");", "final", "String", "escapedValue", "=", "value", "=", "=", "null", "?", "null", ":", "escapeMessageParameter", "(", "value", ".", "toString", "(", "))", ";", "context", ".", "addMessageParameter", "(", "messageParameter", ".", "getKey", "(", "),", "escapedValue", ")", ";", "}", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "context", ";", "}", "return", "sb", ".", "toString", "(", ");", "@", "Nullable", "private", "String", "sanitizeTemplate", "(", "@", "Nullable", "String", "message", ")", "{", "return", "escapeExpressions", "?", "escapeMessageParameter", "(", "message", ")", ":", "message", ";", "}", "/", "**", "@", "@", "-", "104", ",", "7", "+", "170", ",", "7", "@", "@", "private", "String", "escapeEl", "(", "@", "Nullable", "String", "s", ")", "{", "*", "@", "return", "the", "wrapped", "Hibernate", "ConstraintValidatorContext", "*", "/", "public", "ConstraintValidatorContext", "getContext", "(", ")", "{", "return", "context", ";", "return", "constraintValidatorContext", ";", "}", "/", "**", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "io", ".", "dropwizard", ".", "validation", ";", "import", "io", ".", "dropwizard", ".", "util", ".", "Maps", ";", "import", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ".", "SelfValidating", ";", "import", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ".", "SelfValidation", ";", "import", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ".", "ViolationCollector", ";", "@", "@", "-", "12", ",", "6", "+", "13", ",", "7", "@", "@", "import", "javax", ".", "annotation", ".", "concurrent", ".", "NotThreadSafe", ";", "import", "javax", ".", "validation", ".", "Validator", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "@", "@", "-", "146", ",", "12", "+", "148", ",", "48", "@", "@", "public", "void", "validateCorrect", "(", "ViolationCollector", "col", ")", "{", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"$", "{'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "\\\\", "A", "{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "TEST", "\"", "))", ";", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "1", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "key", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "}", "}", "@", "SelfValidating", "(", "escapeExpressions", "=", "false", ")", "public", "static", "class", "EscapingDisabledExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"$", "{'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "\\\\", "A", "{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "TEST", "\"", "))", ";", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "1", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "key", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "}", "}", "@", "SelfValidating", "(", "escapeExpressions", "=", "false", ")", "public", "static", "class", "MessageParametersExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "No", "parameter", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "{", "unsetParameter", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "Mixed", "$", "{'", "value", "'", "}", "{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "Nested", "{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "${", "'", "nested", "'", "}\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "1", ",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "\"", "{", "key", "}", "\",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "key", "\"", ",", "\"", "KEY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "}", "}", "private", "final", "Validator", "validator", "=", "BaseValidator", ".", "newValidator", "(", ");", "@", "Test", "@", "@", "-", "271", ",", "13", "+", "309", ",", "47", "@", "@", "public", "void", "giveWarningIfNoValidationMethods", "(", ")", "{", "}", "@", "Test", "public", "void", "violationMessagesAreEscaped", "(", ")", "{", "public", "void", "violationMessagesAreEscapedByDefault", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "InjectionExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "$", "\\\\", "A", "{", "1", "+", "1", "}", "\",", "\"", "$", "{'", "value", "'", "}\"", ",", "\"", "{", "value", "}", "\",", "\"", "${", "'", "property", "'", "}", "$", "{'", "value", "'", "}\"", ",", "\"", "${", "'", "property", "'", "}[", "${", "'", "key", "'", "}]", "$", "{'", "value", "'", "}\"", ",", "\"", "${", "'", "property", "'", "}[", "1", "]", "$", "{'", "value", "'", "}\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "violationMessagesAreInterpolatedIfEscapingDisabled", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "EscapingDisabledExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "A2", "\"", ",", "\"", "TEST", "\"", ",", "\"", "value", "\"", ",", "\"", "${", "'", "property", "'", "}", "value", "\"", ",", "\"", "${", "'", "property", "'", "}[", "${", "'", "key", "'", "}]", "value", "\"", ",", "\"", "${", "'", "property", "'", "}[", "1", "]", "value", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "messageParametersExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "MessageParametersExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "Mixed", "value", "VALUE", "\"", ",", "\"", "Nested", "$", "{'", "nested", "'", "}\"", ",", "\"", "No", "parameter", "\"", ",", "\"", "VALUE", "\"", ",", "\"", "VALUE", "{", "unsetParameter", "}", "\",", "\"", "value", "}", "\",", "\"", "{", "value", "}", "\",", "\"", "{", "1", "+", "1", "}", "\",", "\"", "{", "value", "\"", ",", "\"", "{", "property", "}", "VALUE", "\"", ",", "\"", "{", "property", "}", "[", "1", "]", "VALUE", "\"", ",", "\"", "{", "property", "}", "[{", "key", "}", "]", "VALUE", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}", "}"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request"]}
{"contents": ["Improve", "TikaMemoryLimitException", "msg"], "code_tokens": ["@", "@", "-", "27", ",", "4", "+", "27", ",", "14", "@", "@", "public", "TikaMemoryLimitException", "(", "String", "msg", ")", "{", "super", "(", "msg", ")", ";", "}", "public", "TikaMemoryLimitException", "(", "long", "triedToAllocate", ",", "long", "maxAllowable", ")", "{", "super", "(", "msg", "(", "triedToAllocate", ",", "maxAllowable", ")", ");", "}", "private", "static", "String", "msg", "(", "long", "triedToAllocate", ",", "long", "maxAllowable", ")", "{", "return", "\"", "Tried", "to", "allocate", "\"", "+", "triedToAllocate", "+", "\"", "bytes", ",", "but", "\"", "+", "maxAllowable", "\"", "is", "the", "maximum", "allowed", ".", "Please", "open", "an", "issue", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "projects", "/", "TIKA", "\"", "\"", "if", "you", "believe", "this", "file", "is", "not", "corrupt", ".", "\";", "}", "}", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "input", ".", "CloseShieldInputStream", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaMemoryLimitException", ";", "import", "org", ".", "apache", ".", "tika", ".", "extractor", ".", "EmbeddedDocumentExtractor", ";", "import", "org", ".", "apache", ".", "tika", ".", "extractor", ".", "EmbeddedDocumentUtil", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "EndianUtils", ";", "@", "@", "-", "48", ",", "6", "+", "49", ",", "7", "@", "@", "*", "/", "public", "class", "AppleSingleFileParser", "extends", "AbstractParser", "{", "private", "static", "final", "int", "MAX_FIELD_LENGTH", "=", "1_073_741_824", ";", "/", "**", "*", "Entry", "types", "*", "/", "@", "@", "-", "123", ",", "8", "+", "125", ",", "8", "@", "@", "private", "long", "processFieldEntries", "(", "InputStream", "stream", ",", "List", "<", "FieldInfo", ">", "fieldInfoLi", "IOUtils", ".", "skipFully", "(", "stream", ",", "diff", ")", ";", "bytesRead", "+", "=", "diff", ";", "if", "(", "f", ".", "entryId", "=", "=", "REAL_NAME", ")", "{", "if", "(", "f", ".", "length", ">", "Integer", ".", "MAX_VALUE", ")", "{", "throw", "new", "TikaException", "(", "\"", "File", "name", "length", "can", "'", "t", "be", ">", "integer", "max", "\"", ");", "if", "(", "f", ".", "length", ">", "MAX_FIELD_LENGTH", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "f", ".", "length", ",", "MAX_FIELD_LENGTH", ")", ";", "}", "buffer", "=", "new", "byte", "[", "(", "int", ")", "f", ".", "length", "]", ";", "IOUtils", ".", "readFully", "(", "stream", ",", "buffer", ")", ";", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaMemoryLimitException", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "tika", ".", "mime", ".", "MediaType", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParseContext", ";", "@", "@", "-", "36", ",", "6", "+", "37", ",", "7", "@", "@", "*", "/", "public", "class", "ICNSParser", "extends", "AbstractParser", "{", "private", "static", "final", "long", "serialVersionUID", "=", "922010233654248327L", ";", "private", "static", "final", "long", "MAX_IMAGE_LENGTH_BYTES", "=", "10485760", ";", "//", "10MB", "private", "static", "final", "Set", "<", "MediaType", ">", "SUPPORTED_TYPES", "=", "Collections", ".", "singleton", "(", "MediaType", ".", "image", "(", "\"", "icns", "\"", "))", ";", "public", "static", "final", "String", "ICNS_MIME_TYPE", "=", "\"", "image", "/", "icns", "\"", ";", "@", "@", "-", "58", ",", "6", "+", "60", ",", "9", "@", "@", "public", "void", "parse", "(", "}", "IOUtils", ".", "readFully", "(", "stream", ",", "header", ",", "0", ",", "4", ")", ";", "/", "/", "Extract", "image", "size", "/", "length", "of", "bytes", "in", "file", "int", "image_length", "=", "java", ".", "nio", ".", "ByteBuffer", ".", "wrap", "(", "header", ")", ".", "getInt", "(", ");", "if", "(", "image_length", ">", "MAX_IMAGE_LENGTH_BYTES", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "image_length", ",", "MAX_IMAGE_LENGTH_BYTES", ")", ";", "}", "byte", "[", "]", "full_file", "=", "new", "byte", "[", "image_length", "]", ";", "IOUtils", ".", "readFully", "(", "stream", ",", "full_file", ")", ";", "ArrayList", "<", "ICNSType", ">", "icons", "=", "new", "ArrayList", "<", ">(", ");", "@", "@", "-", "74", ",", "7", "+", "79", ",", "7", "@", "@", "public", "void", "parse", "(", "if", "(", "icnstype", "=", "=", "null", ")", "{", "/", "/", "exit", "out", "of", "loop", "/", "/", "No", "more", "icons", "left", "offset", "=", "image_length", "-", "8", ";", "break", ";", "}", "else", "if", "(", "icnstype", ".", "hasMask", "(", ")", "=", "=", "true", ")", "{", "icon_masks", ".", "add", "(", "findIconType", "(", "tempByteArray", ")", ");", "}", "else", "{", "@", "@", "-", "628", ",", "7", "+", "628", ",", "8", "@", "@", "private", "FileNode", "deserializeFileNode", "(", "FileNode", "data", ",", "FileNodePtr", "curPath", ")", "throws", "}", "if", "(", "cch", ">", "dif", ".", "size", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "CCH", "=", "\"", "+", "cch", "+", "\"", "was", "found", "that", "was", "great", "than", "file", "size", "\"", "+", "dif", ".", "size", "(", "))", ";", "throw", "new", "TikaMemoryLimitException", "(", "\"", "CCH", "=", "\"", "+", "cch", "+", "\"", "was", "found", "that", "was", "greater", "\"", "\"", "than", "file", "size", "\"", "+", "dif", ".", "size", "(", "))", ";", "}", "ByteBuffer", "dataSpaceBuffer", "=", "ByteBuffer", ".", "allocate", "(", "(", "int", ")", "cch", "*", "2", ")", ";", "dif", ".", "read", "(", "dataSpaceBuffer", ")", ";", "@", "@", "-", "1174", ",", "7", "+", "1175", ",", "8", "@", "@", "long", "roomLeft", "(", ")", "{", "public", "void", "dumpHex", "(", ")", "throws", "TikaMemoryLimitException", ",", "IOException", "{", "if", "(", "end", "-", "offset", ">", "dif", ".", "size", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Exceeded", "memory", "limit", "when", "trying", "to", "dumpHex", "-", "\"", "+", "(", "end", "-", "offset", ")", "+", "\"", ">", "\"", "+", "dif", ".", "size", "(", "))", ";", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Exceeded", "memory", "limit", "when", "trying", "to", "dumpHex", "-", "\"", "\"", "\"", "+", "(", "end", "-", "offset", ")", "+", "\"", ">", "\"", "+", "dif", ".", "size", "(", "))", ";", "}", "ByteBuffer", "byteBuffer", "=", "ByteBuffer", ".", "allocate", "(", "(", "int", ")", "(", "end", "-", "offset", ")", ");", "LOG", ".", "debug", "(", "Hex", ".", "encodeHexString", "(", "byteBuffer", ".", "array", "(", "))", ");", "@", "@", "-", "302", ",", "7", "+", "302", ",", "8", "@", "@", "private", "boolean", "hasRevisionRole", "(", "ExtendedGUID", "rid", ",", "Pair", "<", "Long", ",", "ExtendedGUID", ">", "revis", "OneNotePtr", "content", "=", "new", "OneNotePtr", "(", "oneNoteDocument", ",", "dif", ")", ";", "content", ".", "reposition", "(", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ")", ";", "if", "(", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", ">", "dif", ".", "size", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "data", "store", "cb", "\"", "+", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", "+", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "data", "store", "cb", "\"", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", "\"", "exceeds", "document", "size", ":", "\"", "+", "dif", ".", "size", "(", "))", ";", "}", "handleEmbedded", "(", "(", "int", ")", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", ")", ";", "@", "@", "-", "454", ",", "7", "+", "454", ",", "8", "@", "@", "private", "static", "void", "copyUpToMaxLength", "(", "InputStream", "is", ",", "OutputStream", "os", ")", "throws", "IO", "BoundedInputStream", "bis", "=", "new", "BoundedInputStream", "(", "MAX_IMAGE_LENGTH_BYTES", ",", "is", ")", ";", "IOUtils", ".", "copy", "(", "bis", ",", "os", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Image", "size", "is", "larger", "than", "allowed", "(", "\"", "+", "MAX_IMAGE_LENGTH_BYTES", "+", "\"", ")\"", ");", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Image", "size", "is", "larger", "than", "allowed", "(", "\"", "+", "MAX_IMAGE_LENGTH_BYTES", "+", "\"", ")\"", ");", "}", "}", "@", "@", "-", "153", ",", "9", "+", "153", ",", "7", "@", "@", "protected", "void", "writeBytes", "(", "InputStream", "is", ",", "int", "len", ")", "throws", "IOException", ",", "TikaExcep", "throw", "new", "TikaException", "(", "\"", "Requesting", "I", "read", "<", "0", "bytes", "?", "!\"", ");", "}", "if", "(", "len", ">", "memoryLimitInKb", "*", "1024", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "embedded", "in", "RTF", "caused", "this", "(", "\"", "+", "len", "+", "\"", ")", "bytes", ")", ",", "but", "maximum", "allowed", "is", "(", "\"+", "(", "memoryLimitInKb", "*", "1024", ")", "+\"", ").", "\"+", "\"", "If", "this", "is", "a", "valid", "RTF", "file", ",", "consider", "increasing", "the", "memory", "limit", "via", "TikaConfig", ".", "\")", ";", "throw", "new", "TikaMemoryLimitException", "(", "len", ",", "(", "memoryLimitInKb", "*", "1024", ")", ");", "}", "byte", "[", "]", "bytes", "=", "new", "byte", "[", "len", "]", ";", "@", "@", "-", "155", ",", "7", "+", "155", ",", "8", "@", "@", "new", "DocumentInputStream", "(", "(", "DocumentEntry", ")", "ooxml", ")", "))", "{", "IOUtils", ".", "copy", "(", "bis", ",", "out", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Hit", "memory", "limit", "exception", ".", "Tried", "to", "copy", ">", "\"", "+", "memoryLimitInKb", "*", "1024", ")", ";", "throw", "new", "TikaMemoryLimitException", "(", "(", "memoryLimitInKb", "*", "1024", "+", "1", ")", ",", "(", "memoryLimitInKb", "*", "1024", ")", ");", "}", "}", "ret", "=", "out", ".", "toByteArray", "(", ");", "@", "@", "-", "190", ",", "7", "+", "191", ",", "7", "@", "@", "BoundedInputStream", "bis", "=", "new", "BoundedInputStream", "(", "memoryLimitInKb", "*", "1024", ",", "is", ")", ";", "IOUtils", ".", "copy", "(", "is", ",", "out", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Hit", "memory", "limit", "exception", ".", "Tried", "to", "copy", ">", "\"", "+", "memoryLimitInKb", "*", "1024", ")", ";", "throw", "new", "TikaMemoryLimitException", "(", "memoryLimitInKb", "*", "1024", "+", "1", ",", "memoryLimitInKb", "*", "1024", ")", ";", "}", "ret", "=", "out", ".", "toByteArray", "(", ");", "metadata", ".", "set", "(", "Metadata", ".", "RESOURCE_NAME_KEY", ",", "\"", "file_", "\"", "+", "unknownFilenameCount", ".", "getAndIncrement", "(", ")", "+", "\"", ".\"", "+", "type", ".", "getExtension", "(", "))", ";", "@", "@", "-", "325", ",", "12", "+", "326", ",", "9", "@", "@", "private", "String", "readLengthPrefixedAnsiString", "(", "InputStream", "is", ")", "throws", "IOException", ",", "if", "(", "len", "<", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "Requested", "length", "for", "reading", "bytes", "<", "0", "?", "!:", "\"", "+", "len", ")", ";", "}", "else", "if", "(", "memoryLimitInKb", ">", "-", "1", "&", "&", "len", ">", "memoryLimitInKb", "*", "1024", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "embedded", "in", "RTF", "caused", "this", "(", "\"", "+", "len", "+", "\"", ")", "bytes", ")", ",", "but", "maximum", "allowed", "is", "(", "\"+", "(", "memoryLimitInKb", "*", "1024", ")", "+\"", ").", "\"+", "\"", "If", "this", "is", "a", "valid", "RTF", "file", ",", "consider", "increasing", "the", "memory", "limit", "via", "TikaConfig", ".", "\")", ";", "throw", "new", "TikaMemoryLimitException", "(", "len", ",", "memoryLimitInKb", "*", "1024", ")", ";", "}", "else", "if", "(", "len", ">", "Integer", ".", "MAX_VALUE", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "embedded", "in", "RTF", "caused", "this", "(", "\"", "+", "len", "+", "\"", ")", "bytes", ")", ",", "but", "there", "is", "a", "hard", "limit", "of", "Integer", ".", "MAX_VALUE", "+", "\")", ";", "throw", "new", "TikaMemoryLimitException", "(", "len", ",", "Integer", ".", "MAX_VALUE", ")", ";", "}", "return", "new", "byte", "[", "(", "int", ")", "len", "]", ";", "@", "@", "-", "186", ",", "7", "+", "186", ",", "7", "@", "@", "public", "void", "parseEmbedded", "(", "InputStream", "inputStream", ",", "ContentHandler", "contentHandler", "IOUtils", ".", "copy", "(", "bis", ",", "bos", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "IOExceptionWithCause", "(", "new", "TikaMemoryLimitException", "(", "\"", "Tried", "to", "read", "beyond", "\"", "+", "MAX_ATTACHMENT_BYTES", "+", "\"", "bytes", "\"", "))", ";", "new", "TikaMemoryLimitException", "(", "MAX_ATTACHMENT_BYTES", "+", "1", ",", "MAX_ATTACHMENT_BYTES", ")", ");", "}", "byte", "[", "]", "data", "=", "bos", ".", "toByteArray", "(", ");"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["KEYS:", "Fix", "ASN.1", "indefinite", "length", "object", "parsing", "This", "fixes", ".", "In", "the", "ASN.1", "decoder,", "when", "the", "length", "field", "of", "an", "ASN.1", "value", "is", "extracted,", "it", "isn't", "validated", "against", "the", "remaining", "amount", "of", "data", "before", "being", "added", "to", "the", "cursor.", "With", "a", "sufficiently", "large", "size", "indicated,", "the", "check:", "datalen", "-", "dp", "<", "2", "may", "then", "fail", "due", "to", "integer", "overflow.", "Fix", "this", "by", "checking", "the", "length", "indicated", "against", "the", "amount", "of", "remaining", "data", "in", "both", "places", "a", "definite", "length", "is", "determined.", "Whilst", "we're", "at", "it,", "make", "the", "following", "changes:", "(1)", "Check", "the", "maximum", "size", "of", "extended", "length", "does", "not", "exceed", "the", "capacity", "of", "the", "variable", "it's", "being", "stored", "in", "(len)", "rather", "than", "the", "type", "that", "variable", "is", "assumed", "to", "be", "(size_t).", "(2)", "Compare", "the", "EOC", "tag", "to", "the", "symbolic", "constant", "ASN1_EOC", "rather", "than", "the", "integer", "0.", "(3)", "To", "reduce", "confusion,", "move", "the", "initialisation", "of", "len", "outside", "of:", "for", "(len", "=", "0;", "n", ">", "0;", "n--)", "{", "since", "it", "doesn't", "have", "anything", "to", "do", "with", "the", "loop", "counter", "n.", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Reviewed-by:", "Mimi", "Zohar", "<zohar@linux.vnet.ibm.com>", "Acked-by:", "David", "Woodhouse", "<David.Woodhouse@intel.com>", "Acked-by:", "Peter", "Jones", "<pjones@redhat.com>"], "code_tokens": ["@", "@", "-", "74", ",", "7", "+", "74", ",", "7", "@", "@", "static", "int", "asn1_find_indefinite_length", "(", "const", "unsigned", "char", "*", "data", ",", "size_t", "datalen", "/", "*", "Extract", "a", "tag", "from", "the", "data", "*", "/", "tag", "=", "data", "[", "dp", "+", "+]", ";", "if", "(", "tag", "=", "=", "0", ")", "{", "if", "(", "tag", "=", "=", "ASN1_EOC", ")", "{", "/", "*", "It", "appears", "to", "be", "an", "EOC", ".", "*", "/", "if", "(", "data", "[", "dp", "+", "+]", "!", "=", "0", ")", "goto", "invalid_eoc", ";", "@", "@", "-", "96", ",", "10", "+", "96", ",", "8", "@", "@", "static", "int", "asn1_find_indefinite_length", "(", "const", "unsigned", "char", "*", "data", ",", "size_t", "datalen", "/", "*", "Extract", "the", "length", "*", "/", "len", "=", "data", "[", "dp", "+", "+]", ";", "if", "(", "len", "<", "=", "0x7f", ")", "{", "dp", "+", "=", "len", ";", "goto", "next_tag", ";", "}", "if", "(", "len", "<", "=", "0x7f", ")", "goto", "check_length", ";", "if", "(", "unlikely", "(", "len", "=", "=", "ASN1_INDEFINITE_LENGTH", ")", ")", "{", "/", "*", "Indefinite", "length", "*", "/", "@", "@", "-", "110", ",", "14", "+", "108", ",", "18", "@", "@", "static", "int", "asn1_find_indefinite_length", "(", "const", "unsigned", "char", "*", "data", ",", "size_t", "datalen", "}", "n", "=", "len", "-", "0x80", ";", "if", "(", "unlikely", "(", "n", ">", "sizeof", "(", "size_t", ")", "-", "1", ")", ")", "if", "(", "unlikely", "(", "n", ">", "sizeof", "(", "len", ")", "-", "1", ")", ")", "goto", "length_too_long", ";", "if", "(", "unlikely", "(", "n", ">", "datalen", "-", "dp", ")", ")", "goto", "data_overrun_error", ";", "for", "(", "len", "=", "0", ";", "n", ">", "0", ";", "n", "-", "-)", "{", "len", "=", "0", ";", "for", "(", ";", "n", ">", "0", ";", "n", "-", "-)", "{", "len", "<", "<=", "8", ";", "len", "|", "=", "data", "[", "dp", "+", "+]", ";", "}", "check_length", ":", "if", "(", "len", ">", "datalen", "-", "dp", ")", "goto", "data_overrun_error", ";", "dp", "+", "=", "len", ";", "goto", "next_tag", ";"], "docstring_tokens": ["via", "crafted", "ASN.1", "data", "."]}
{"contents": ["mnt:", "Update", "detach_mounts", "to", "leave", "mounts", "connected", "Now", "that", "it", "is", "possible", "to", "lazily", "unmount", "an", "entire", "mount", "tree", "and", "leave", "the", "individual", "mounts", "connected", "to", "each", "other", "add", "a", "new", "flag", "UMOUNT_CONNECTED", "to", "umount_tree", "to", "force", "this", "behavior", "and", "use", "this", "flag", "in", "detach_mounts.", "This", "closes", "a", "bug", "where", "the", "deletion", "of", "a", "file", "or", "directory", "could", "trigger", "an", "unmount", "and", "reveal", "data", "under", "a", "mount", "point.", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>"], "code_tokens": ["@", "@", "-", "1348", ",", "6", "+", "1348", ",", "7", "@", "@", "static", "inline", "void", "namespace_lock", "(", "void", ")", "enum", "umount_tree_flags", "{", "UMOUNT_SYNC", "=", "1", ",", "UMOUNT_PROPAGATE", "=", "2", ",", "UMOUNT_CONNECTED", "=", "4", ",", "}", ";", "/", "*", "*", "mount_lock", "must", "be", "held", "@", "@", "-", "1386", ",", "7", "+", "1387", ",", "10", "@", "@", "static", "void", "umount_tree", "(", "struct", "mount", "*", "mnt", ",", "enum", "umount_tree_flags", "how", ")", "if", "(", "how", "&", "UMOUNT_SYNC", ")", "p", "-", ">", "mnt", ".", "mnt_flags", "|", "=", "MNT_SYNC_UMOUNT", ";", "disconnect", "=", "!", "IS_MNT_LOCKED_AND_LAZY", "(", "p", ")", ";", "disconnect", "=", "!", "((", "(", "how", "&", "UMOUNT_CONNECTED", ")", "&", "&", "mnt_has_parent", "(", "p", ")", "&", "&", "(", "p", "-", ">", "mnt_parent", "-", ">", "mnt", ".", "mnt_flags", "&", "MNT_UMOUNT", ")", ")", "|", "|", "IS_MNT_LOCKED_AND_LAZY", "(", "p", ")", ");", "pin_insert_group", "(", "&", "p", "-", ">", "mnt_umount", ",", "&", "p", "-", ">", "mnt_parent", "-", ">", "mnt", ",", "disconnect", "?", "&", "unmounted", ":", "NULL", ")", ";", "@", "@", "-", "1529", ",", "7", "+", "1533", ",", "7", "@", "@", "void", "__detach_mounts", "(", "struct", "dentry", "*", "dentry", ")", "umount_mnt", "(", "p", ")", ";", "}", "}", "else", "umount_tree", "(", "mnt", ",", "0", ")", ";", "else", "umount_tree", "(", "mnt", ",", "UMOUNT_CONNECTED", ")", ";", "}", "unlock_mount_hash", "(", ");", "put_mountpoint", "(", "mp", ")", ";"], "docstring_tokens": ["chroot", "and", "mount", "namespaces"]}
{"contents": ["bluetooth:", "Validate", "socket", "address", "length", "in", "sco_sock_bind().", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "526", ",", "6", "+", "526", ",", "9", "@", "@", "static", "int", "sco_sock_bind", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "addr", ",", "if", "(", "!", "addr", "|", "|", "addr", "-", ">", "sa_family", "!", "=", "AF_BLUETOOTH", ")", "return", "-", "EINVAL", ";", "if", "(", "addr_len", "<", "sizeof", "(", "struct", "sockaddr_sco", ")", ")", "return", "-", "EINVAL", ";", "lock_sock", "(", "sk", ")", ";", "if", "(", "sk", "-", ">", "sk_state", "!", "=", "BT_OPEN", ")", "{"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Fixed", "bug", "#70350:", "ZipArchive::extractTo", "allows", "for", "directory", "traversal", "when", "creating", "directories"], "code_tokens": ["@", "@", "-", "133", ",", "7", "+", "133", ",", "7", "@", "@", "static", "char", "*", "php_zip_make_relative_path", "(", "char", "*", "path", ",", "int", "path_len", ")", "/", "*", "{", "{{", "*", "/", "}", "/", "*", "}", "}}", "*", "/", "#", "ifdef", "PHP_ZIP_USE_OO", "#", "ifdef", "PHP_ZIP_USE_OO", "/", "*", "{", "{{", "php_zip_extract_file", "*", "/", "static", "int", "php_zip_extract_file", "(", "struct", "zip", "*", "za", ",", "char", "*", "dest", ",", "char", "*", "file", ",", "int", "file_len", "TSRMLS_DC", ")", "{", "@", "@", "-", "174", ",", "7", "+", "174", ",", "7", "@", "@", "static", "int", "php_zip_extract_file", "(", "struct", "zip", "*", "za", ",", "char", "*", "dest", ",", "char", "*", "file", ",", "int", "fil", "/", "*", "it", "is", "a", "directory", "only", ",", "see", "#", "40228", "*", "/", "if", "(", "path_cleaned_len", ">", "1", "&", "&", "IS_SLASH", "(", "path_cleaned", "[", "path_cleaned_len", "-", "1", "]", "))", "{", "len", "=", "spprintf", "(", "&", "file_dirname_fullpath", ",", "0", ",", "\"", "%", "s", "/", "%", "s", "\"", ",", "dest", ",", "file", ")", ";", "len", "=", "spprintf", "(", "&", "file_dirname_fullpath", ",", "0", ",", "\"", "%", "s", "/", "%", "s", "\"", ",", "dest", ",", "path_cleaned", ")", ";", "is_dir_only", "=", "1", ";", "}", "else", "{", "memcpy", "(", "file_dirname", ",", "path_cleaned", ",", "path_cleaned_len", ")", ";", "@", "@", "-", "295", ",", "7", "+", "295", ",", "7", "@", "@", "static", "int", "php_zip_extract_file", "(", "struct", "zip", "*", "za", ",", "char", "*", "dest", ",", "char", "*", "file", ",", "int", "fil", "}", "/", "*", "}", "}}", "*", "/", "static", "int", "php_zip_add_file", "(", "struct", "zip", "*", "za", ",", "const", "char", "*", "filename", ",", "size_t", "filename_len", ",", "static", "int", "php_zip_add_file", "(", "struct", "zip", "*", "za", ",", "const", "char", "*", "filename", ",", "size_t", "filename_len", ",", "char", "*", "entry_name", ",", "size_t", "entry_name_len", ",", "long", "offset_start", ",", "long", "offset_len", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "struct", "zip_source", "*", "zs", ";", "@", "@", "-", "345", ",", "7", "+", "345", ",", "7", "@", "@", "static", "int", "php_zip_add_file", "(", "struct", "zip", "*", "za", ",", "const", "char", "*", "filename", ",", "size_t", "filenam", "}", "/", "*", "}", "}}", "*", "/", "static", "int", "php_zip_parse_options", "(", "zval", "*", "options", ",", "long", "*", "remove_all_path", ",", "static", "int", "php_zip_parse_options", "(", "zval", "*", "options", ",", "long", "*", "remove_all_path", ",", "char", "*", "*", "remove_path", ",", "int", "*", "remove_path_len", ",", "char", "*", "*", "add_path", ",", "int", "*", "add_path_len", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "zval", "*", "*", "option", ";", "@", "@", "-", "375", ",", "11", "+", "375", ",", "11", "@", "@", "static", "int", "php_zip_parse_options", "(", "zval", "*", "options", ",", "long", "*", "remove_all_path", ",", "}", "if", "(", "Z_STRLEN_PP", "(", "option", ")", ">", "=", "MAXPATHLEN", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "remove_path", "string", "is", "too", "long", "(", "max", ":", "%", "i", ",", "%", "i", "given", ")", "\",", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "remove_path", "string", "is", "too", "long", "(", "max", ":", "%", "i", ",", "%", "i", "given", ")", "\",", "MAXPATHLEN", "-", "1", ",", "Z_STRLEN_PP", "(", "option", ")", ");", "return", "-", "1", ";", "}", "*", "remove_path_len", "=", "Z_STRLEN_PP", "(", "option", ")", ";", "*", "remove_path_len", "=", "Z_STRLEN_PP", "(", "option", ")", ";", "*", "remove_path", "=", "Z_STRVAL_PP", "(", "option", ")", ";", "}", "@", "@", "-", "395", ",", "11", "+", "395", ",", "11", "@", "@", "static", "int", "php_zip_parse_options", "(", "zval", "*", "options", ",", "long", "*", "remove_all_path", ",", "}", "if", "(", "Z_STRLEN_PP", "(", "option", ")", ">", "=", "MAXPATHLEN", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "add_path", "string", "too", "long", "(", "max", ":", "%", "i", ",", "%", "i", "given", ")", "\",", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "add_path", "string", "too", "long", "(", "max", ":", "%", "i", ",", "%", "i", "given", ")", "\",", "MAXPATHLEN", "-", "1", ",", "Z_STRLEN_PP", "(", "option", ")", ");", "return", "-", "1", ";", "}", "*", "add_path_len", "=", "Z_STRLEN_PP", "(", "option", ")", ";", "*", "add_path_len", "=", "Z_STRLEN_PP", "(", "option", ")", ";", "*", "add_path", "=", "Z_STRVAL_PP", "(", "option", ")", ";", "}", "return", "1", ";", "@", "@", "-", "528", ",", "7", "+", "528", ",", "7", "@", "@", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "glob_t", "globbuf", ";", "int", "n", ";", "int", "ret", ";", "if", "(", "pattern_len", ">", "=", "MAXPATHLEN", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Pattern", "exceeds", "the", "maximum", "allowed", "length", "of", "%", "d", "characters", "\"", ",", "MAXPATHLEN", ")", ";", "return", "-", "1", ";", "@", "@", "-", "539", ",", "9", "+", "539", ",", "9", "@", "@", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "return", "-", "1", ";", "}", "#", "ifdef", "ZTS", "#", "ifdef", "ZTS", "if", "(", "!", "IS_ABSOLUTE_PATH", "(", "pattern", ",", "pattern_len", ")", ")", "{", "result", "=", "VCWD_GETCWD", "(", "cwd", ",", "MAXPATHLEN", ")", ";", "result", "=", "VCWD_GETCWD", "(", "cwd", ",", "MAXPATHLEN", ")", ";", "if", "(", "!", "result", ")", "{", "cwd", "[", "0", "]", "=", "'", "\\", "0", "'", ";", "}", "@", "@", "-", "554", ",", "7", "+", "554", ",", "7", "@", "@", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "snprintf", "(", "work_pattern", ",", "MAXPATHLEN", ",", "\"", "%", "s", "%", "c", "%", "s", "\"", ",", "cwd", ",", "DEFAULT_SLASH", ",", "pattern", ")", ";", "pattern", "=", "work_pattern", ";", "}", "}", "#", "endif", "globbuf", ".", "gl_offs", "=", "0", ";", "@", "@", "-", "564", ",", "7", "+", "564", ",", "7", "@", "@", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "/", "*", "Some", "glob", "implementation", "simply", "return", "no", "data", "if", "no", "matches", "were", "found", ",", "others", "return", "the", "GLOB_NOMATCH", "error", "code", ".", "We", "don", "'", "t", "want", "to", "treat", "GLOB_NOMATCH", "as", "an", "error", "condition", "so", "that", "PHP", "glob", "(", ")", "behaves", "the", "same", "on", "both", "types", "of", "so", "that", "PHP", "glob", "(", ")", "behaves", "the", "same", "on", "both", "types", "of", "implementations", "and", "so", "that", "'", "foreach", "(", "glob", "(", ")", "as", ".", "..", "'", "can", "be", "used", "for", "simple", "glob", "(", ")", "calls", "without", "further", "error", "checking", ".", "@", "@", "-", "593", ",", "11", "+", "593", ",", "11", "@", "@", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "for", "(", "n", "=", "0", ";", "n", "<", "globbuf", ".", "gl_pathc", ";", "n", "+", "+)", "{", "/", "*", "we", "need", "to", "do", "this", "everytime", "since", "GLOB_ONLYDIR", "does", "not", "guarantee", "that", "*", "all", "directories", "will", "be", "filtered", ".", "GNU", "libc", "documentation", "states", "the", "*", "following", ":", "*", "If", "the", "information", "about", "the", "type", "of", "the", "file", "is", "easily", "available", "*", "non", "-", "directories", "will", "be", "rejected", "but", "no", "extra", "work", "will", "be", "done", "to", "*", "determine", "the", "information", "for", "each", "file", ".", "I", ".", "e", ".", ",", "the", "caller", "must", "still", "be", "*", "able", "to", "filter", "directories", "out", ".", "*", "following", ":", "*", "If", "the", "information", "about", "the", "type", "of", "the", "file", "is", "easily", "available", "*", "non", "-", "directories", "will", "be", "rejected", "but", "no", "extra", "work", "will", "be", "done", "to", "*", "determine", "the", "information", "for", "each", "file", ".", "I", ".", "e", ".", ",", "the", "caller", "must", "still", "be", "*", "able", "to", "filter", "directories", "out", ".", "*", "/", "if", "(", "flags", "&", "GLOB_ONLYDIR", ")", "{", "struct", "stat", "s", ";", "@", "@", "-", "633", ",", "9", "+", "633", ",", "9", "@", "@", "int", "php_zip_pcre", "(", "char", "*", "regexp", ",", "int", "regexp_len", ",", "char", "*", "path", ",", "int", "path_len", ",", "zval", "*", "r", "int", "files_cnt", ";", "char", "*", "*", "namelist", ";", "#", "ifdef", "ZTS", "#", "ifdef", "ZTS", "if", "(", "!", "IS_ABSOLUTE_PATH", "(", "path", ",", "path_len", ")", ")", "{", "result", "=", "VCWD_GETCWD", "(", "cwd", ",", "MAXPATHLEN", ")", ";", "result", "=", "VCWD_GETCWD", "(", "cwd", ",", "MAXPATHLEN", ")", ";", "if", "(", "!", "result", ")", "{", "cwd", "[", "0", "]", "=", "'", "\\", "0", "'", ";", "}", "@", "@", "-", "648", ",", "7", "+", "648", ",", "7", "@", "@", "int", "php_zip_pcre", "(", "char", "*", "regexp", ",", "int", "regexp_len", ",", "char", "*", "path", ",", "int", "path_len", ",", "zval", "*", "r", "snprintf", "(", "work_path", ",", "MAXPATHLEN", ",", "\"", "%", "s", "%", "c", "%", "s", "\"", ",", "cwd", ",", "DEFAULT_SLASH", ",", "path", ")", ";", "path", "=", "work_path", ";", "}", "}", "#", "endif", "if", "(", "ZIP_OPENBASEDIR_CHECKPATH", "(", "path", ")", ")", "{", "@", "@", "-", "665", ",", "7", "+", "665", ",", "7", "@", "@", "int", "php_zip_pcre", "(", "char", "*", "regexp", ",", "int", "regexp_len", ",", "char", "*", "path", ",", "int", "path_len", ",", "zval", "*", "r", "re", "=", "pcre_get_compiled_regex", "(", "regexp", ",", "&", "pcre_extra", ",", "&", "preg_options", "TSRMLS_CC", ")", ";", "if", "(", "!", "re", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Invalid", "expression", "\"", ");", "return", "-", "1", ";", "return", "-", "1", ";", "}", "array_init", "(", "return_value", ")", ";", "@", "@", "-", "678", ",", "15", "+", "678", ",", "15", "@", "@", "int", "php_zip_pcre", "(", "char", "*", "regexp", ",", "int", "regexp_len", ",", "char", "*", "path", ",", "int", "path_len", ",", "zval", "*", "r", "int", "matches", ";", "int", "namelist_len", "=", "strlen", "(", "namelist", "[", "i", "]", ");", "if", "(", "(", "namelist_len", "=", "=", "1", "&", "&", "namelist", "[", "i", "]", "[", "0", "]", "=", "=", "'", ".'", ")", "|", "|", "(", "namelist_len", "=", "=", "2", "&", "&", "namelist", "[", "i", "]", "[", "0", "]", "=", "=", "'", ".'", "&", "&", "namelist", "[", "i", "]", "[", "1", "]", "=", "=", "'", ".'", "))", "{", "efree", "(", "namelist", "[", "i", "]", ");", "continue", ";", "}", "if", "(", "(", "path_len", "+", "namelist_len", "+", "1", ")", ">", "=", "MAXPATHLEN", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "add_path", "string", "too", "long", "(", "max", ":", "%", "i", ",", "%", "i", "given", ")", "\",", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "add_path", "string", "too", "long", "(", "max", ":", "%", "i", ",", "%", "i", "given", ")", "\",", "MAXPATHLEN", "-", "1", ",", "(", "path_len", "+", "namelist_len", "+", "1", ")", ");", "efree", "(", "namelist", "[", "i", "]", ");", "break", ";", "@", "@", "-", "709", ",", "7", "+", "709", ",", "7", "@", "@", "int", "php_zip_pcre", "(", "char", "*", "regexp", ",", "int", "regexp_len", ",", "char", "*", "path", ",", "int", "path_len", ",", "zval", "*", "r", "/", "*", "0", "means", "that", "the", "vector", "is", "too", "small", "to", "hold", "all", "the", "captured", "substring", "offsets", "*", "/", "if", "(", "matches", "<", "0", ")", "{", "efree", "(", "namelist", "[", "i", "]", ");", "continue", ";", "continue", ";", "}", "add_next_index_string", "(", "return_value", ",", "fullpath", ",", "1", ")", ";", "@", "@", "-", "785", ",", "7", "+", "785", ",", "7", "@", "@", "static", "const", "zend_function_entry", "zip_functions", "[", "]", "=", "{", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "ZE2", "OO", "definitions", "*", "/", "#", "ifdef", "PHP_ZIP_USE_OO", "#", "ifdef", "PHP_ZIP_USE_OO", "static", "zend_class_entry", "*", "zip_class_entry", ";", "static", "zend_object_handlers", "zip_object_handlers", ";", "@", "@", "-", "805", ",", "7", "+", "805", ",", "7", "@", "@", "typedef", "struct", "_zip_prop_handler", "{", "#", "endif", "/", "*", "}", "}}", "*", "/", "#", "ifdef", "PHP_ZIP_USE_OO", "#", "ifdef", "PHP_ZIP_USE_OO", "static", "void", "php_zip_register_prop_handler", "(", "HashTable", "*", "prop_handler", ",", "char", "*", "name", ",", "zip_read_int_t", "read_int_func", ",", "zip_read_const_char_t", "read_char_func", ",", "zip_read_const_char_from_ze_t", "read_char_from_obj_func", ",", "int", "rettype", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "zip_prop_handler", "hnd", ";", "@", "@", "-", "893", ",", "7", "+", "893", ",", "7", "@", "@", "static", "zval", "*", "*", "php_zip_get_property_ptr_ptr", "(", "zval", "*", "object", ",", "zval", "*", "member", ",", "const", "zen", "if", "(", "obj", "-", ">", "prop_handler", "!", "=", "NULL", ")", "{", "if", "(", "key", ")", "{", "ret", "=", "zend_hash_quick_find", "(", "obj", "-", ">", "prop_handler", ",", "Z_STRVAL_P", "(", "member", ")", ",", "Z_STRLEN_P", "(", "member", ")", "+", "1", ",", "key", "-", ">", "hash_value", ",", "(", "void", "*", "*)", "&", "hnd", ")", ";", "}", "else", "{", "}", "else", "{", "ret", "=", "zend_hash_find", "(", "obj", "-", ">", "prop_handler", ",", "Z_STRVAL_P", "(", "member", ")", ",", "Z_STRLEN_P", "(", "member", ")", "+", "1", ",", "(", "void", "*", "*)", "&", "hnd", ")", ";", "}", "}", "@", "@", "-", "1483", ",", "7", "+", "1483", ",", "7", "@", "@", "static", "PHP_NAMED_FUNCTION", "(", "zif_zip_entry_compressionmethod", ")", "}", "/", "*", "}", "}}", "*", "/", "#", "ifdef", "PHP_ZIP_USE_OO", "#", "ifdef", "PHP_ZIP_USE_OO", "/", "*", "{", "{{", "proto", "mixed", "ZipArchive", ":", ":", "open", "(", "string", "source", "[", ",", "int", "flags", "]", ")", "Create", "new", "zip", "using", "source", "uri", "for", "output", ",", "return", "TRUE", "on", "success", "or", "the", "error", "code", "*", "/", "static", "ZIPARCHIVE_METHOD", "(", "open", ")", "@", "@", "-", "1590", ",", "7", "+", "1590", ",", "7", "@", "@", "static", "ZIPARCHIVE_METHOD", "(", "getStatusString", ")", "zip_error_get", "(", "intern", ",", "&", "zep", ",", "&", "syp", ")", ";", "len", "=", "zip_error_to_str", "(", "error_string", ",", "128", ",", "zep", ",", "syp", ")", ";", "RETVAL_STRINGL", "(", "error_string", ",", "len", ",", "1", ")", ";", "RETVAL_STRINGL", "(", "error_string", ",", "len", ",", "1", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1667", ",", "12", "+", "1667", ",", "12", "@", "@", "static", "void", "php_zip_add_from_pattern", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "type", ")", "/", "*", "ZIP_FROM_OBJECT", "(", "intern", ",", "this", ")", ";", "/", "*", "1", "=", "=", "glob", ",", "2", "=", "=", "pcre", "*", "/", "if", "(", "type", "=", "=", "1", ")", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "p", "|", "la", "\"", ",", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "p", "|", "la", "\"", ",", "&", "pattern", ",", "&", "pattern_len", ",", "&", "flags", ",", "&", "options", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "}", "else", "{", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "p", "|", "sa", "\"", ",", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "p", "|", "sa", "\"", ",", "&", "pattern", ",", "&", "pattern_len", ",", "&", "path", ",", "&", "path_len", ",", "&", "options", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1724", ",", "14", "+", "1724", ",", "14", "@", "@", "static", "void", "php_zip_add_from_pattern", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "type", ")", "/", "*", "if", "(", "add_path", ")", "{", "if", "(", "(", "add_path_len", "+", "file_stripped_len", ")", ">", "MAXPATHLEN", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Entry", "name", "too", "long", "(", "max", ":", "%", "d", ",", "%", "ld", "given", ")", "\",", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Entry", "name", "too", "long", "(", "max", ":", "%", "d", ",", "%", "ld", "given", ")", "\",", "MAXPATHLEN", "-", "1", ",", "(", "add_path_len", "+", "file_stripped_len", ")", ");", "zval_dtor", "(", "return_value", ")", ";", "RETURN_FALSE", ";", "}", "snprintf", "(", "entry_name_buf", ",", "MAXPATHLEN", ",", "\"", "%", "s", "%", "s", "\"", ",", "add_path", ",", "file_stripped", ")", ";", "entry_name", "=", "entry_name_buf", ";", "entry_name", "=", "entry_name_buf", ";", "entry_name_len", "=", "strlen", "(", "entry_name", ")", ";", "}", "else", "{", "entry_name", "=", "Z_STRVAL_PP", "(", "zval_file", ")", ";", "@", "@", "-", "1741", ",", "7", "+", "1741", ",", "7", "@", "@", "static", "void", "php_zip_add_from_pattern", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "type", ")", "/", "*", "efree", "(", "basename", ")", ";", "basename", "=", "NULL", ";", "}", "if", "(", "php_zip_add_file", "(", "intern", ",", "Z_STRVAL_PP", "(", "zval_file", ")", ",", "Z_STRLEN_PP", "(", "zval_file", ")", ",", "if", "(", "php_zip_add_file", "(", "intern", ",", "Z_STRVAL_PP", "(", "zval_file", ")", ",", "Z_STRLEN_PP", "(", "zval_file", ")", ",", "entry_name", ",", "entry_name_len", ",", "0", ",", "0", "TSRMLS_CC", ")", "<", "0", ")", "{", "zval_dtor", "(", "return_value", ")", ";", "RETURN_FALSE", ";", "@", "@", "-", "1801", ",", "7", "+", "1801", ",", "7", "@", "@", "static", "ZIPARCHIVE_METHOD", "(", "addFile", ")", "entry_name_len", "=", "filename_len", ";", "}", "if", "(", "php_zip_add_file", "(", "intern", ",", "filename", ",", "filename_len", ",", "if", "(", "php_zip_add_file", "(", "intern", ",", "filename", ",", "filename_len", ",", "entry_name", ",", "entry_name_len", ",", "0", ",", "0", "TSRMLS_CC", ")", "<", "0", ")", "{", "RETURN_FALSE", ";", "}", "else", "{", "@", "@", "-", "1865", ",", "7", "+", "1865", ",", "7", "@", "@", "static", "ZIPARCHIVE_METHOD", "(", "addFromString", ")", "}", "fail", ":", "zip_source_free", "(", "zs", ")", ";", "RETURN_FALSE", ";", "RETURN_FALSE", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "2770", ",", "7", "+", "2770", ",", "7", "@", "@", "static", "const", "zend_function_entry", "zip_class_functions", "[", "]", "=", "{", "/", "*", "{", "{{", "PHP_MINIT_FUNCTION", "*", "/", "static", "PHP_MINIT_FUNCTION", "(", "zip", ")", "{", "#", "ifdef", "PHP_ZIP_USE_OO", "#", "ifdef", "PHP_ZIP_USE_OO", "zend_class_entry", "ce", ";", "memcpy", "(", "&", "zip_object_handlers", ",", "zend_get_std_object_handlers", "(", "),", "sizeof", "(", "zend_object_handlers", ")", ");", "@", "@", "-", "2859", ",", "7", "+", "2859", ",", "7", "@", "@", "static", "PHP_MINIT_FUNCTION", "(", "zip", ")", "*", "/", "static", "PHP_MSHUTDOWN_FUNCTION", "(", "zip", ")", "{", "#", "ifdef", "PHP_ZIP_USE_OO", "#", "ifdef", "PHP_ZIP_USE_OO", "zend_hash_destroy", "(", "&", "zip_prop_handlers", ")", ";", "php_unregister_url_stream_wrapper", "(", "\"", "zip", "\"", "TSRMLS_CC", ")", ";", "#", "endif", "@", "@", "-", "0", ",", "0", "+", "1", ",", "33", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "70350", "(", "ZipArchive", ":", ":", "extractTo", "allows", "for", "directory", "traversal", "when", "creating", "directories", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "zip", "'", "))", "die", "(", "'", "skip", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "dir", "=", "dirname", "(", "__FILE__", ")", ".\"", "/", "bug70350", "\"", ";", "mkdir", "(", "$", "dir", ")", ";", "$", "archive", "=", "new", "ZipArchive", "(", ");", "$", "archive", "-", ">", "open", "(", "\"$", "dir", "/", "a", ".", "zip", "\"", ",", "ZipArchive", ":", ":", "CREATE", ")", ";", "$", "archive", "-", ">", "addEmptyDir", "(", "\".", "./", "down2", "/", "\")", ";", "$", "archive", "-", ">", "close", "(", ");", "$", "archive2", "=", "new", "ZipArchive", "(", ");", "$", "archive2", "-", ">", "open", "(", "'", "a", ".", "zip", "'", ");", "$", "archive2", "-", ">", "extractTo", "(", "$", "dir", ")", ";", "$", "archive2", "-", ">", "close", "(", ");", "var_dump", "(", "file_exists", "(", "\"$", "dir", "/", "down2", "/", "\")", ");", "var_dump", "(", "file_exists", "(", "\".", "./", "down2", "/", "\")", ");", "?", ">", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "$", "dir", "=", "dirname", "(", "__FILE__", ")", ".\"", "/", "bug70350", "\"", ";", "rmdir", "(", "\"$", "dir", "/", "down2", "\"", ");", "unlink", "(", "\"$", "dir", "/", "a", ".", "zip", "\"", ");", "rmdir", "(", "$", "dir", ")", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "bool", "(", "true", ")", "bool", "(", "false", ")"], "docstring_tokens": ["creating", "thousands", "of", "empty", "directories", "there", "a", "parent", "directory", "is", "served", "by", "the", "web", "server", "and", "allows", "a", "full", "directory", "listing"]}
{"contents": ["ARM:", "7735/2:", "Preserve", "the", "user", "r/w", "register", "TPIDRURW", "on", "context", "switch", "and", "fork", "Since", "commit", "6a1c53124aa1", "the", "user", "writeable", "TLS", "register", "was", "zeroed", "to", "prevent", "it", "from", "being", "used", "as", "a", "covert", "channel", "between", "two", "tasks.", "There", "are", "more", "and", "more", "applications", "coming", "to", "Windows", "RT,", "Wine", "could", "support", "them,", "but", "mostly", "they", "expect", "to", "have", "the", "thread", "environment", "block", "(TEB)", "in", "TPIDRURW.", "This", "patch", "preserves", "that", "register", "per", "thread", "instead", "of", "clearing", "it.", "Unlike", "the", "TPIDRURO,", "which", "is", "already", "switched,", "the", "TPIDRURW", "can", "be", "updated", "from", "userspace", "so", "needs", "careful", "treatment", "in", "the", "case", "that", "we", "modify", "TPIDRURW", "and", "call", "fork().", "To", "avoid", "this", "we", "must", "always", "read", "TPIDRURW", "in", "copy_thread.", "Signed-off-by:", "Andr\u00e9", "Hentschel", "<nerv@dawncrow.de>", "Signed-off-by:", "Will", "Deacon", "<will.deacon@arm.com>", "Signed-off-by:", "Jonathan", "Austin", "<jonathan.austin@arm.com>", "Signed-off-by:", "Russell", "King", "<rmk+kernel@arm.linux.org.uk>"], "code_tokens": ["@", "@", "-", "58", ",", "7", "+", "58", ",", "7", "@", "@", "struct", "thread_info", "{", "struct", "cpu_context_save", "cpu_context", ";", "/", "*", "cpu", "context", "*", "/", "__u32", "syscall", ";", "/", "*", "syscall", "number", "*", "/", "__u8", "used_cp", "[", "16", "]", ";", "/", "*", "thread", "used", "copro", "*", "/", "unsigned", "long", "tp_value", ";", "unsigned", "long", "tp_value", "[", "2", "]", ";", "/", "*", "TLS", "registers", "*", "/", "#", "ifdef", "CONFIG_CRUNCH", "struct", "crunch_state", "crunchstate", ";", "#", "endif", "@", "@", "-", "2", ",", "27", "+", "2", ",", "30", "@", "@", "#", "define", "__ASMARM_TLS_H", "#", "ifdef", "__ASSEMBLY__", ".", "macro", "set_tls_none", ",", "tp", ",", "tmp1", ",", "tmp2", "#", "include", "<", "asm", "/", "asm", "-", "offsets", ".", "h", ">", ".", "macro", "switch_tls_none", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", ".", "endm", ".", "macro", "set_tls_v6k", ",", "tp", ",", "tmp1", ",", "tmp2", ".", "macro", "switch_tls_v6k", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", "mrc", "p15", ",", "0", ",", "\\", "tmp2", ",", "c13", ",", "c0", ",", "2", "@", "get", "the", "user", "r", "/", "w", "register", "mcr", "p15", ",", "0", ",", "\\", "tp", ",", "c13", ",", "c0", ",", "3", "@", "set", "TLS", "register", "mov", "\\", "tmp1", ",", "#", "0", "mcr", "p15", ",", "0", ",", "\\", "tmp1", ",", "c13", ",", "c0", ",", "2", "@", "clear", "user", "r", "/", "w", "TLS", "register", "mcr", "p15", ",", "0", ",", "\\", "tpuser", ",", "c13", ",", "c0", ",", "2", "@", "and", "the", "user", "r", "/", "w", "register", "str", "\\", "tmp2", ",", "[", "\\", "base", ",", "#", "TI_TP_VALUE", "+", "4", "]", "@", "save", "it", ".", "endm", ".", "macro", "set_tls_v6", ",", "tp", ",", "tmp1", ",", "tmp2", ".", "macro", "switch_tls_v6", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", "ldr", "\\", "tmp1", ",", "=", "elf_hwcap", "ldr", "\\", "tmp1", ",", "[", "\\", "tmp1", ",", "#", "0", "]", "mov", "\\", "tmp2", ",", "#", "0xffff0fff", "tst", "\\", "tmp1", ",", "#", "HWCAP_TLS", "@", "hardware", "TLS", "available", "?", "mcrne", "p15", ",", "0", ",", "\\", "tp", ",", "c13", ",", "c0", ",", "3", "@", "yes", ",", "set", "TLS", "register", "movne", "\\", "tmp1", ",", "#", "0", "mcrne", "p15", ",", "0", ",", "\\", "tmp1", ",", "c13", ",", "c0", ",", "2", "@", "clear", "user", "r", "/", "w", "TLS", "register", "streq", "\\", "tp", ",", "[", "\\", "tmp2", ",", "#", "-", "15", "]", "@", "set", "TLS", "value", "at", "0xffff0ff0", "mrcne", "p15", ",", "0", ",", "\\", "tmp2", ",", "c13", ",", "c0", ",", "2", "@", "get", "the", "user", "r", "/", "w", "register", "mcrne", "p15", ",", "0", ",", "\\", "tp", ",", "c13", ",", "c0", ",", "3", "@", "yes", ",", "set", "TLS", "register", "mcrne", "p15", ",", "0", ",", "\\", "tpuser", ",", "c13", ",", "c0", ",", "2", "@", "set", "user", "r", "/", "w", "register", "strne", "\\", "tmp2", ",", "[", "\\", "base", ",", "#", "TI_TP_VALUE", "+", "4", "]", "@", "save", "it", ".", "endm", ".", "macro", "set_tls_software", ",", "tp", ",", "tmp1", ",", "tmp2", ".", "macro", "switch_tls_software", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", "mov", "\\", "tmp1", ",", "#", "0xffff0fff", "str", "\\", "tp", ",", "[", "\\", "tmp1", ",", "#", "-", "15", "]", "@", "set", "TLS", "value", "at", "0xffff0ff0", ".", "endm", "@", "@", "-", "31", ",", "19", "+", "34", ",", "30", "@", "@", "#", "ifdef", "CONFIG_TLS_REG_EMUL", "#", "define", "tls_emu", "1", "#", "define", "has_tls_reg", "1", "#", "define", "set_tls", "set_tls_none", "#", "define", "switch_tls", "switch_tls_none", "#", "elif", "defined", "(", "CONFIG_CPU_V6", ")", "#", "define", "tls_emu", "0", "#", "define", "has_tls_reg", "(", "elf_hwcap", "&", "HWCAP_TLS", ")", "#", "define", "set_tls", "set_tls_v6", "#", "define", "switch_tls", "switch_tls_v6", "#", "elif", "defined", "(", "CONFIG_CPU_32v6K", ")", "#", "define", "tls_emu", "0", "#", "define", "has_tls_reg", "1", "#", "define", "set_tls", "set_tls_v6k", "#", "define", "switch_tls", "switch_tls_v6k", "#", "else", "#", "define", "tls_emu", "0", "#", "define", "has_tls_reg", "0", "#", "define", "set_tls", "set_tls_software", "#", "define", "switch_tls", "switch_tls_software", "#", "endif", "#", "ifndef", "__ASSEMBLY__", "static", "inline", "unsigned", "long", "get_tpuser", "(", "void", ")", "{", "unsigned", "long", "reg", "=", "0", ";", "if", "(", "has_tls_reg", "&", "&", "!", "tls_emu", ")", "__asm__", "(", "\"", "mrc", "p15", ",", "0", ",", "%", "0", ",", "c13", ",", "c0", ",", "2", "\"", ":", "\"", "=", "r", "\"", "(", "reg", ")", ");", "return", "reg", ";", "}", "#", "endif", "#", "endif", "/", "*", "__ASMARM_TLS_H", "*", "/", "@", "@", "-", "685", ",", "15", "+", "685", ",", "16", "@", "@", "ENTRY", "(", "__switch_to", ")", "UNWIND", "(", ".", "fnstart", ")", "UNWIND", "(", ".", "cantunwind", ")", "add", "ip", ",", "r1", ",", "#", "TI_CPU_SAVE", "ldr", "r3", ",", "[", "r2", ",", "#", "TI_TP_VALUE", "]", "ARM", "(", "stmia", "ip", "!", ",", "{", "r4", "-", "sl", ",", "fp", ",", "sp", ",", "lr", "}", ")", "@", "Store", "most", "regs", "on", "stack", "THUMB", "(", "stmia", "ip", "!", ",", "{", "r4", "-", "sl", ",", "fp", "}", ")", "@", "Store", "most", "regs", "on", "stack", "THUMB", "(", "str", "sp", ",", "[", "ip", "]", ",", "#", "4", ")", "THUMB", "(", "str", "lr", ",", "[", "ip", "]", ",", "#", "4", ")", "ldr", "r4", ",", "[", "r2", ",", "#", "TI_TP_VALUE", "]", "ldr", "r5", ",", "[", "r2", ",", "#", "TI_TP_VALUE", "+", "4", "]", "#", "ifdef", "CONFIG_CPU_USE_DOMAINS", "ldr", "r6", ",", "[", "r2", ",", "#", "TI_CPU_DOMAIN", "]", "#", "endif", "set_tls", "r3", ",", "r4", ",", "r5", "switch_tls", "r1", ",", "r4", ",", "r5", ",", "r3", ",", "r7", "#", "if", "defined", "(", "CONFIG_CC_STACKPROTECTOR", ")", "&", "&", "!", "defined", "(", "CONFIG_SMP", ")", "ldr", "r7", ",", "[", "r2", ",", "#", "TI_TASK", "]", "ldr", "r8", ",", "=", "__stack_chk_guard", "@", "@", "-", "39", ",", "6", "+", "39", ",", "7", "@", "@", "#", "include", "<", "asm", "/", "thread_notify", ".", "h", ">", "#", "include", "<", "asm", "/", "stacktrace", ".", "h", ">", "#", "include", "<", "asm", "/", "mach", "/", "time", ".", "h", ">", "#", "include", "<", "asm", "/", "tls", ".", "h", ">", "#", "ifdef", "CONFIG_CC_STACKPROTECTOR", "#", "include", "<", "linux", "/", "stackprotector", ".", "h", ">", "@", "@", "-", "343", ",", "7", "+", "344", ",", "8", "@", "@", "copy_thread", "(", "unsigned", "long", "clone_flags", ",", "unsigned", "long", "stack_start", ",", "clear_ptrace_hw_breakpoint", "(", "p", ")", ";", "if", "(", "clone_flags", "&", "CLONE_SETTLS", ")", "thread", "-", ">", "tp_value", "=", "childregs", "-", ">", "ARM_r3", ";", "thread", "-", ">", "tp_value", "[", "0", "]", "=", "childregs", "-", ">", "ARM_r3", ";", "thread", "-", ">", "tp_value", "[", "1", "]", "=", "get_tpuser", "(", ");", "thread_notify", "(", "THREAD_NOTIFY_COPY", ",", "thread", ")", ";", "@", "@", "-", "849", ",", "7", "+", "849", ",", "7", "@", "@", "long", "arch_ptrace", "(", "struct", "task_struct", "*", "child", ",", "long", "request", ",", "#", "endif", "case", "PTRACE_GET_THREAD_AREA", ":", "ret", "=", "put_user", "(", "task_thread_info", "(", "child", ")", "->", "tp_value", ",", "ret", "=", "put_user", "(", "task_thread_info", "(", "child", ")", "->", "tp_value", "[", "0", "]", ",", "datap", ")", ";", "break", ";", "@", "@", "-", "581", ",", "7", "+", "581", ",", "7", "@", "@", "asmlinkage", "int", "arm_syscall", "(", "int", "no", ",", "struct", "pt_regs", "*", "regs", ")", "return", "regs", "-", ">", "ARM_r0", ";", "case", "NR", "(", "set_tls", ")", ":", "thread", "-", ">", "tp_value", "=", "regs", "-", ">", "ARM_r0", ";", "thread", "-", ">", "tp_value", "[", "0", "]", "=", "regs", "-", ">", "ARM_r0", ";", "if", "(", "tls_emu", ")", "return", "0", ";", "if", "(", "has_tls_reg", ")", "{", "@", "@", "-", "699", ",", "7", "+", "699", ",", "7", "@", "@", "static", "int", "get_tp_trap", "(", "struct", "pt_regs", "*", "regs", ",", "unsigned", "int", "instr", ")", "int", "reg", "=", "(", "instr", ">", ">", "12", ")", "&", "15", ";", "if", "(", "reg", "=", "=", "15", ")", "return", "1", ";", "regs", "-", ">", "uregs", "[", "reg", "]", "=", "current_thread_info", "(", ")-", ">", "tp_value", ";", "regs", "-", ">", "uregs", "[", "reg", "]", "=", "current_thread_info", "(", ")-", ">", "tp_value", "[", "0", "]", ";", "regs", "-", ">", "ARM_pc", "+", "=", "4", ";", "return", "0", ";", "}"], "docstring_tokens": ["persuading", "a", "victim", "to", "install", "a", "specially-crafted", "application"]}
{"contents": ["Merge", "pull", "request", "#37", "from", "jenkinsci-cert/SECURITY-214", "[SECURITY-214]", "OfflineCause.toString()", "is", "a", "string,", "not", "necessarily", "HTML"], "code_tokens": ["@", "@", "-", "188", ",", "7", "+", "188", ",", "7", "@", "@", "public", "boolean", "hasTooManyTimeouts", "(", ")", "{", "}", "/", "**", "*", "HTML", "rendering", "of", "the", "data", "*", "String", "rendering", "of", "the", "data", "*", "/", "@", "Override", "public", "String", "toString", "(", ")", "{", "@", "@", "-", "200", ",", "7", "+", "200", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "/", "/", "return", "buf", ".", "toString", "(", ");", "int", "fc", "=", "failureCount", "(", ");", "if", "(", "fc", ">", "0", ")", "return", "Util", ".", "wrapToErrorSpan", "(", "Messages", ".", "ResponseTimeMonitor_TimeOut", "(", "fc", ")", ");", "return", "Messages", ".", "ResponseTimeMonitor_TimeOut", "(", "fc", ")", ";", "return", "getAverage", "(", ")+", "\"", "ms", "\"", ";", "}", "@", "@", "-", "24", ",", "5", "+", "24", ",", "5", "@", "@", "THE", "SOFTWARE", ".", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "d", "=", "\"", "jelly", ":", "define", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "t", "=", "\"/", "lib", "/", "hudson", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", ">", "<", "p", "class", "=", "\"", "warning", "\"", "><", "j", ":", "out", "value", "=", "\"$", "{", "it", "}", "\"", "/", "><", "/", "p", ">", "<", "p", "class", "=", "\"", "warning", "\"", ">$", "{", "it", "}", "</", "p", ">", "<", "/", "j", ":", "jelly", ">"], "docstring_tokens": ["via", "the", "slave", "offline", "status", "message", "."]}
{"contents": ["Additional", "check", "when", "unpacking", "archives.", "Contributed", "by", "Jason", "Lowe", "and", "Akira", "Ajisaka."], "code_tokens": ["@", "@", "-", "620", ",", "16", "+", "620", ",", "21", "@", "@", "public", "static", "long", "getDU", "(", "File", "dir", ")", "{", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "String", "targetDirPath", "=", "unzipDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "file", "outside", "of", "\"", "+", "unzipDir", ")", ";", "}", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "@", "@", "-", "738", ",", "6", "+", "743", ",", "13", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "String", "targetDirPath", "=", "outputDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "entry", "outside", "of", "\"", "+", "outputDir", ")", ";", "}", "if", "(", "entry", ".", "isDirectory", "(", "))", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "@", "@", "-", "752", ",", "7", "+", "764", ",", "6", "@", "@", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "return", ";", "}", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "@", "@", "-", "38", ",", "6", "+", "38", ",", "7", "@", "@", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "@", "@", "-", "740", ",", "10", "+", "741", ",", "8", "@", "@", "public", "void", "testCreateLocalTempFile", "(", ")", "throws", "IOException", "{", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "/", "/", "make", "sa", "simple", "zip", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "tar", ":", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ";", "@", "@", "-", "760", ",", "7", "+", "759", ",", "7", "@", "@", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "tos", ".", "close", "(", ");", "}", "/", "/", "successfully", "untar", "it", "into", "an", "existing", "dir", ":", "/", "/", "successfully", "unzip", "it", "into", "an", "existing", "dir", ":", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "/", "/", "check", "result", ":", "assertTrue", "(", "new", "File", "(", "tmp", ",", "\"", "foo", "\"", ").", "exists", "(", "))", ";", "@", "@", "-", "775", ",", "8", "+", "774", ",", "36", "@", "@", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "}", "catch", "(", "IOException", "ioe", ")", "{", "/", "/", "okay", "}", "}", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip2", "(", ")", "throws", "IOException", "{", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "try", "(", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ")", "{", "/", "/", "Add", "an", "entry", "that", "contains", "invalid", "filename", "ZipEntry", "ze", "=", "new", "ZipEntry", "(", "\".", "./", "foo", "\"", ");", "byte", "[", "]", "data", "=", "\"", "some", "-", "content", "\"", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "ze", ".", "setSize", "(", "data", ".", "length", ")", ";", "tos", ".", "putNextEntry", "(", "ze", ")", ";", "tos", ".", "write", "(", "data", ")", ";", "tos", ".", "closeEntry", "(", ");", "tos", ".", "flush", "(", ");", "tos", ".", "finish", "(", ");", "}", "/", "/", "Unzip", "it", "into", "an", "existing", "dir", "try", "{", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "Assert", ".", "fail", "(", "\"", "unZip", "should", "throw", "IOException", ".", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "GenericTestUtils", ".", "assertExceptionContains", "(", "\"", "would", "create", "file", "outside", "of", "\"", ",", "e", ")", ";", "}", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "/", "*", "*", "Test", "method", "copy", "(", "FileSystem", "srcFS", ",", "Path", "src", ",", "File", "dst", ",", "boolean", "deleteSource", ",", "Configuration", "conf", ")"], "docstring_tokens": ["the", "public", "archive"]}
{"contents": ["[SECURITY-607]", "Add", "the", "RequirePOST", "annotation"], "code_tokens": ["@", "@", "-", "90", ",", "6", "+", "90", ",", "7", "@", "@", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "jobgenerator", ".", "JobGenerator", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "/", "**", "*", "Wraps", "a", "build", "with", "pre", "and", "post", "build", "steps", ".", "These", "steps", "can", "take", "@", "@", "-", "659", ",", "7", "+", "660", ",", "8", "@", "@", "public", "ParameterDefinition", "getParameterDefinition", "(", "String", "name", ")", "{", "public", "boolean", "isOverrideBuildParameters", "(", ")", "{", "return", "overrideBuildParameters", ";", "}", "@", "RequirePOST", "public", "void", "doSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "resp", ")", "throws", "IOException", ",", "ServletException", "{", "/", "/", "verify", "permission", "ReleaseWrapper", ".", "checkReleasePermission", "(", "project", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "87", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2017", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "plugins", ".", "release", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlCheckBoxInput", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "org", ".", "apache", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "class", "TestReleaseWrapper", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "607", "\"", ")", "public", "void", "ensurePostIsRequiredForSubmit", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "FreeStyleProject", "job", "=", "j", ".", "createFreeStyleProject", "(", "\"", "test", "\"", ");", "String", "submitUrl", "=", "job", ".", "getShortUrl", "(", ")", "+", "\"", "release", "/", "submit", "\"", ";", "URL", "releaseSubmitUrl", "=", "new", "URL", "(", "j", ".", "getURL", "(", ")", "+", "submitUrl", ")", ";", "/", "/", "the", "release", "plugin", "is", "not", "activated", "yet", ",", "so", "the", "page", "does", "not", "exist", "for", "the", "moment", "try", "{", "wc", ".", "getPage", "(", "new", "WebRequest", "(", "releaseSubmitUrl", ",", "HttpMethod", ".", "POST", ")", ");", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "assertEquals", "(", "HttpStatus", ".", "SC_NOT_FOUND", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "/", "/", "enable", "the", "release", "feature", "for", "that", "job", "HtmlForm", "configForm", "=", "j", ".", "createWebClient", "(", ").", "getPage", "(", "job", ",", "\"", "configure", "\"", ").", "getFormByName", "(", "\"", "config", "\"", ");", "HtmlCheckBoxInput", "releaseCheckButton", "=", "configForm", ".", "getInputByName", "(", "\"", "hudson", "-", "plugins", "-", "release", "-", "ReleaseWrapper", "\"", ");", "releaseCheckButton", ".", "setChecked", "(", "true", ")", ";", "HtmlPage", "configPageSubmit", "=", "j", ".", "submit", "(", "configForm", ")", ";", "assertEquals", "(", "HttpStatus", ".", "SC_OK", ",", "configPageSubmit", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "))", ";", "/", "/", "the", "GET", "method", "is", "not", "allowed", "try", "{", "wc", ".", "goTo", "(", "submitUrl", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "Assert", ".", "assertEquals", "(", "HttpStatus", ".", "SC_METHOD_NOT_ALLOWED", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "/", "/", "the", "POST", "method", "must", "be", "used", "to", "submit", "a", "form", "Page", "successSubmit", "=", "wc", ".", "getPage", "(", "new", "WebRequest", "(", "new", "URL", "(", "j", ".", "getURL", "(", ")", "+", "submitUrl", ")", ",", "HttpMethod", ".", "POST", ")", ");", "Assert", ".", "assertEquals", "(", "HttpStatus", ".", "SC_OK", ",", "successSubmit", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "}"], "docstring_tokens": ["parses", "a", "maliciously", "crafted", "file"]}
{"contents": ["SWS-1049", "-", "Replace", "direct", "API", "usage", "with", "better", "defaults."], "code_tokens": ["@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "client", ".", "WebServiceIOException", ";", "import", "org", ".", "springframework", ".", "ws", ".", "client", ".", "WebServiceTransformerException", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpression", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpressionFactory", ";", "@", "@", "-", "52", ",", "7", "+", "53", ",", "7", "@", "@", "public", "static", "final", "String", "DEFAULT_WSDL_LOCATION_EXPRESSION", "=", "\"", "/", "wsdl", ":", "definitions", "/", "wsdl", ":", "service", "/", "wsdl", ":", "port", "/", "soap", ":", "address", "/", "@", "location", "\"", ";", "private", "static", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "private", "static", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "private", "Map", "<", "String", ",", "String", ">", "expressionNamespaces", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "ws", ".", "WebServiceMessageFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerObjectSupport", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "Implementation", "of", "the", "{", "@", "link", "WebServiceMessageFactory", "}", "interface", "that", "creates", "a", "{", "@", "link", "DomPoxMessage", "}", ".", "@", "@", "-", "42", ",", "11", "+", "43", ",", "25", "@", "@", "/", "**", "The", "default", "content", "type", "for", "the", "POX", "messages", ".", "*", "/", "public", "static", "final", "String", "DEFAULT_CONTENT_TYPE", "=", "\"", "application", "/", "xml", "\"", ";", "private", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "private", "DocumentBuilderFactory", "documentBuilderFactory", ";", "private", "String", "contentType", "=", "DEFAULT_CONTENT_TYPE", ";", "/", "**", "*", "Use", "default", "{", "@", "link", "DocumentBuilderFactory", "}", ".", "*", "/", "public", "DomPoxMessageFactory", "(", ")", "{", "this", "(", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", "))", ";", "}", "/", "**", "*", "Provide", "your", "own", "{", "@", "link", "DocumentBuilderFactory", "}", ".", "*", "*", "@", "param", "documentBuilderFactory", "*", "/", "public", "DomPoxMessageFactory", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setValidating", "(", "false", ")", ";", "documentBuilderFactory", ".", "setExpandEntityReferences", "(", "false", ")", ";", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerObjectSupport", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "Abstract", "base", "class", "for", "endpoints", "that", "handle", "the", "message", "payload", "as", "DOM", "elements", ".", "@", "@", "-", "120", ",", "7", "+", "121", ",", "7", "@", "@", "protected", "DocumentBuilder", "createDocumentBuilder", "(", "DocumentBuilderFactory", "factory", ")", "*", "@", "throws", "ParserConfigurationException", "if", "thrown", "by", "JAXP", "methods", "*", "/", "protected", "DocumentBuilderFactory", "createDocumentBuilderFactory", "(", ")", "throws", "ParserConfigurationException", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "factory", ".", "setValidating", "(", "validating", ")", ";", "factory", ".", "setNamespaceAware", "(", "namespaceAware", ")", ";", "factory", ".", "setExpandEntityReferences", "(", "expandEntityReferences", ")", ";", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerObjectSupport", ";", "/", "**", "@", "@", "-", "63", ",", "7", "+", "64", ",", "7", "@", "@", "protected", "final", "XMLOutputFactory", "getOutputFactory", "(", ")", "{", "*", "@", "return", "the", "created", "{", "@", "code", "XMLInputFactory", "}", "*", "/", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "return", "XMLInputFactory", ".", "newInstance", "(", ");", "return", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "}", "/", "**", "@", "@", "-", "29", ",", "13", "+", "29", ",", "14", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "stax", ".", "StAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "core", ".", "MethodParameter", ";", "import", "org", ".", "springframework", ".", "xml", ".", "JaxpVersion", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "springframework", ".", "core", ".", "MethodParameter", ";", "import", "org", ".", "springframework", ".", "xml", ".", "JaxpVersion", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "/", "**", "*", "Implementation", "of", "{", "@", "link", "MethodArgumentResolver", "}", "and", "{", "@", "link", "MethodReturnValueHandler", "}", "that", "supports", "{", "@", "link", "Source", "}", "*", "objects", ".", "@", "@", "-", "125", ",", "7", "+", "126", ",", "7", "@", "@", "private", "boolean", "supports", "(", "MethodParameter", "parameter", ")", "{", "*", "@", "return", "the", "created", "factory", "*", "/", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "return", "XMLInputFactory", ".", "newInstance", "(", ");", "return", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "}", "/", "**", "Inner", "class", "to", "avoid", "a", "static", "JAXP", "1", ".", "4", "dependency", ".", "*", "/", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "annotation", ".", "RequestPayload", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerObjectSupport", ";", "/", "**", "@", "@", "-", "152", ",", "7", "+", "153", ",", "7", "@", "@", "private", "XMLEventReader", "resolveEventReader", "(", "Source", "requestSource", ")", "throws", "Transform", "*", "@", "return", "the", "created", "factory", "*", "/", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "return", "XMLInputFactory", ".", "newInstance", "(", ");", "return", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "}", "private", "ByteArrayInputStream", "convertToByteArrayInputStream", "(", "Source", "source", ")", "throws", "TransformerException", "{", "@", "@", "-", "25", ",", "16", "+", "25", ",", "17", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "org", ".", "springframework", ".", "core", ".", "MethodParameter", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "adapter", ".", "method", ".", "AbstractPayloadSourceMethodProcessor", ";", "import", "nu", ".", "xom", ".", "Builder", ";", "import", "nu", ".", "xom", ".", "Document", ";", "import", "nu", ".", "xom", ".", "Element", ";", "import", "nu", ".", "xom", ".", "ParsingException", ";", "import", "nu", ".", "xom", ".", "converters", ".", "DOMConverter", ";", "import", "org", ".", "w3c", ".", "dom", ".", "DOMImplementation", ";", "import", "org", ".", "springframework", ".", "core", ".", "MethodParameter", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "adapter", ".", "method", ".", "AbstractPayloadSourceMethodProcessor", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "Implementation", "of", "{", "@", "link", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "adapter", ".", "method", ".", "MethodArgumentResolver", "*", "MethodArgumentResolver", "}", "and", "{", "@", "link", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "adapter", ".", "method", ".", "MethodReturnValueHandler", "@", "@", "-", "104", ",", "7", "+", "105", ",", "7", "@", "@", "private", "boolean", "supports", "(", "MethodParameter", "parameter", ")", "{", "*", "@", "return", "the", "created", "factory", "*", "/", "protected", "DocumentBuilderFactory", "createDocumentBuilderFactory", "(", ")", "{", "return", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "return", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "}", "}", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "annotation", ".", "PayloadRoot", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "annotation", ".", "PayloadRoots", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "support", ".", "PayloadRootUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "Implementation", "of", "the", "{", "@", "link", "EndpointMapping", "}", "interface", "that", "uses", "the", "{", "@", "link", "PayloadRoot", "}", "annotation", "to", "map", "methods", "@", "@", "-", "54", ",", "7", "+", "55", ",", "16", "@", "@", "private", "static", "TransformerFactory", "transformerFactory", ";", "static", "{", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "setTransformerFactory", "(", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "}", "/", "**", "*", "Override", "the", "default", "{", "@", "link", "TransformerFactory", "}", ".", "*", "*", "@", "param", "transformerFactory", "*", "/", "public", "static", "void", "setTransformerFactory", "(", "TransformerFactory", "transformerFactory", ")", "{", "PayloadRootAnnotationMethodEndpointMapping", ".", "transformerFactory", "=", "transformerFactory", ";", "}", "@", "Override", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "support", ".", "PayloadRootUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "Implementation", "of", "the", "{", "@", "code", "EndpointMapping", "}", "interface", "to", "map", "from", "the", "qualified", "name", "of", "the", "request", "payload", "@", "@", "-", "49", ",", "12", "+", "50", ",", "20", "@", "@", "private", "static", "TransformerFactory", "transformerFactory", ";", "static", "{", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "setTransformerFactory", "(", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "}", "/", "**", "*", "Override", "the", "default", "{", "@", "link", "TransformerFactory", "}", ".", "*", "*", "@", "param", "transformerFactory", "*", "/", "public", "static", "void", "setTransformerFactory", "(", "TransformerFactory", "transformerFactory", ")", "{", "PayloadRootQNameEndpointMapping", ".", "transformerFactory", "=", "transformerFactory", ";", "}", "@", "Override", "protected", "QName", "resolveQName", "(", "MessageContext", "messageContext", ")", "throws", "TransformerException", "{", "return", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "messageContext", ".", "getRequest", "(", ").", "getPayloadSource", "(", "),", "transformerFactory", ")", ";", "}", "}", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "WebServiceMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "support", ".", "PayloadRootUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "Simple", "subclass", "of", "{", "@", "link", "AbstractMethodEndpointMapping", "}", "that", "maps", "from", "the", "local", "name", "of", "the", "request", "payload", "to", "@", "@", "-", "108", ",", "7", "+", "109", ",", "7", "@", "@", "public", "void", "setMethodSuffix", "(", "String", "methodSuffix", ")", "{", "@", "Override", "public", "final", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "Assert", ".", "notEmpty", "(", "getEndpoints", "(", "),", "\"", "'", "endpoints", "'", "is", "required", "\"", ");", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getEndpoints", "(", ").", "length", ";", "i", "+", "+)", "{", "registerMethods", "(", "getEndpoints", "(", ")[", "i", "]", ");", "}", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "ws", ".", "WebServiceMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpression", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpressionFactory", ";", "@", "@", "-", "86", ",", "7", "+", "87", ",", "7", "@", "@", "public", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "else", "{", "expression", "=", "XPathExpressionFactory", ".", "createXPathExpression", "(", "expressionString", ",", "namespaces", ")", ";", "}", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "}", "@", "Override", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerObjectSupport", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpression", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpressionFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "Abstract", "base", "class", "for", "{", "@", "link", "AddressingVersion", "}", "implementations", ".", "Uses", "{", "@", "link", "XPathExpression", "}", "s", "to", "retrieve", "@", "@", "-", "62", ",", "7", "+", "63", ",", "7", "@", "@", "*", "/", "public", "abstract", "class", "AbstractAddressingVersion", "extends", "TransformerObjectSupport", "implements", "AddressingVersion", "{", "private", "static", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "private", "static", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "private", "final", "XPathExpression", "toExpression", ";", "@", "@", "-", "53", ",", "6", "+", "53", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "support", ".", "SoapUtils", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "TransportConstants", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "TransportInputStream", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "/", "**", "*", "Axiom", "-", "specific", "implementation", "of", "the", "{", "@", "link", "org", ".", "springframework", ".", "ws", ".", "WebServiceMessageFactory", "WebServiceMessageFactory", "}", "@", "@", "-", "366", ",", "7", "+", "367", ",", "7", "@", "@", "protected", "String", "getCharSetEncoding", "(", "String", "contentType", ")", "{", "*", "@", "return", "the", "created", "factory", "*", "/", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_REPLACING_ENTITY_REFERENCES", ",", "replacingEntityReferences", ")", ";", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "supportingExternalEntities", ")", ";", "return", "inputFactory", ";", "@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "Collection", "of", "generic", "utility", "methods", "to", "work", "with", "Axiom", ".", "Includes", "conversion", "from", "{", "@", "code", "OMNamespace", "}", "s", "to", "@", "@", "-", "119", ",", "7", "+", "120", ",", "7", "@", "@", "public", "static", "Document", "toDocument", "(", "SOAPEnvelope", "envelope", ")", "{", "envelope", ".", "serialize", "(", "bos", ")", ";", "ByteArrayInputStream", "bis", "=", "new", "ByteArrayInputStream", "(", "bos", ".", "toByteArray", "(", "))", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "return", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ").", "parse", "(", "bis", ")", ";", "}", "@", "@", "-", "40", ",", "13", "+", "40", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "56", ",", "7", "+", "49", ",", "17", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "DefaultHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "abstract", "class", "AbstractWebServiceMessageTestCase", "{", "@", "@", "-", "74", ",", "7", "+", "77", ",", "7", "@", "@", "private", "String", "getExpectedString", "(", ")", "throws", "IOException", "{", "@", "Before", "public", "final", "void", "setUp", "(", ")", "throws", "Exception", "{", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "webServiceMessage", "=", "createWebServiceMessage", "(", ");", "payload", "=", "new", "ClassPathResource", "(", "\"", "payload", ".", "xml", "\"", ",", "AbstractWebServiceMessageTestCase", ".", "class", ")", ";", "@", "@", "-", "83", ",", "7", "+", "86", ",", "7", "@", "@", "public", "final", "void", "setUp", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDomPayload", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "payloadDocument", "=", "documentBuilder", ".", "parse", "(", "SaxUtils", ".", "createInputSource", "(", "payload", ")", ");", "@", "@", "-", "98", ",", "7", "+", "101", ",", "7", "@", "@", "public", "void", "testDomPayload", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testEventReaderPayload", "(", ")", "throws", "Exception", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLEventReader", "eventReader", "=", "inputFactory", ".", "createXMLEventReader", "(", "payload", ".", "getInputStream", "(", "))", ";", "Source", "staxSource", "=", "StaxUtils", ".", "createCustomStaxSource", "(", "eventReader", ")", ";", "transformer", ".", "transform", "(", "staxSource", ",", "webServiceMessage", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "148", ",", "7", "+", "151", ",", "7", "@", "@", "public", "void", "testStreamPayload", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testStreamReaderPayload", "(", ")", "throws", "Exception", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLStreamReader", "streamReader", "=", "inputFactory", ".", "createXMLStreamReader", "(", "payload", ".", "getInputStream", "(", "))", ";", "Source", "staxSource", "=", "StaxUtils", ".", "createCustomStaxSource", "(", "streamReader", ")", ";", "transformer", ".", "transform", "(", "staxSource", ",", "webServiceMessage", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "37", ",", "6", "+", "37", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "Mock", "implementation", "of", "the", "{", "@", "code", "WebServiceMessage", "}", "interface", ".", "@", "@", "-", "58", ",", "7", "+", "59", ",", "7", "@", "@", "public", "MockWebServiceMessage", "(", ")", "{", "}", "public", "MockWebServiceMessage", "(", "Source", "source", ")", "throws", "TransformerException", "{", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "Transformer", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "content", "=", "new", "StringBuilder", "(", ");", "transformer", ".", "transform", "(", "source", ",", "getPayloadResult", "(", "))", ";", "@", "@", "-", "39", ",", "12", "+", "39", ",", "9", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "66", ",", "6", "+", "63", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "support", ".", "FreePortScanner", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "public", "abstract", "class", "AbstractSoap11WebServiceTemplateIntegrationTestCase", "{", "@", "@", "-", "130", ",", "7", "+", "131", ",", "7", "@", "@", "public", "void", "sendSourceAndReceiveToResultNoResponse", "(", ")", "{", "@", "Test", "public", "void", "marshalSendAndReceiveResponse", "(", ")", "throws", "TransformerConfigurationException", "{", "final", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Object", "requestObject", "=", "new", "Object", "(", ");", "Marshaller", "marshaller", "=", "new", "Marshaller", "(", ")", "{", "@", "@", "-", "173", ",", "7", "+", "174", ",", "7", "@", "@", "public", "boolean", "supports", "(", "Class", "<", "?>", "clazz", ")", "{", "@", "Test", "public", "void", "marshalSendAndReceiveNoResponse", "(", ")", "throws", "TransformerConfigurationException", "{", "final", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Object", "requestObject", "=", "new", "Object", "(", ");", "Marshaller", "marshaller", "=", "new", "Marshaller", "(", ")", "{", "@", "@", "-", "41", ",", "12", "+", "41", ",", "9", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "67", ",", "6", "+", "64", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "support", ".", "FreePortScanner", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "public", "abstract", "class", "AbstractSoap12WebServiceTemplateIntegrationTestCase", "{", "@", "@", "-", "141", ",", "7", "+", "142", ",", "7", "@", "@", "public", "void", "sendSourceAndReceiveToResultNoResponse", "(", ")", "{", "@", "Test", "public", "void", "marshalSendAndReceiveResponse", "(", ")", "throws", "TransformerConfigurationException", "{", "final", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Object", "requestObject", "=", "new", "Object", "(", ");", "Marshaller", "marshaller", "=", "new", "Marshaller", "(", ")", "{", "@", "@", "-", "184", ",", "7", "+", "185", ",", "7", "@", "@", "public", "boolean", "supports", "(", "Class", "<", "?>", "clazz", ")", "{", "@", "Test", "public", "void", "marshalSendAndReceiveNoResponse", "(", ")", "throws", "TransformerConfigurationException", "{", "final", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Object", "requestObject", "=", "new", "Object", "(", ");", "Marshaller", "marshaller", "=", "new", "Marshaller", "(", ")", "{", "@", "@", "-", "29", ",", "7", "+", "29", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "@", "@", "-", "45", ",", "6", "+", "44", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "support", ".", "FreePortScanner", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "DomPoxWebServiceTemplateIntegrationTest", "{", "@", "@", "-", "125", ",", "9", "+", "128", ",", "9", "@", "@", "protected", "void", "doPost", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "S", "@", "Override", "public", "void", "init", "(", "ServletConfig", "servletConfig", ")", "throws", "ServletException", "{", "super", ".", "init", "(", "servletConfig", ")", ";", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "}", "@", "Override", "@", "@", "-", "22", ",", "7", "+", "22", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPConstants", ";", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPMessage", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "junit", ".", "Assert", ";", "@", "@", "-", "39", ",", "6", "+", "38", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "SaajSoapMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "SaajSoapMessageFactory", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "support", ".", "SaajUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "SimpleXsdSchema", ";", "public", "class", "PayloadValidatingInterceptorTest", "{", "@", "@", "-", "75", ",", "7", "+", "75", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "soap11Factory", "=", "new", "SaajSoapMessageFactory", "(", "MessageFactory", ".", "newInstance", "(", "SOAPConstants", ".", "SOAP_1_1_PROTOCOL", ")", ");", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "}", "@", "Test", "@", "@", "-", "22", ",", "14", "+", "22", ",", "16", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "DomPoxMessageTest", "{", "@", "@", "-", "39", ",", "10", "+", "41", ",", "10", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "message", "=", "new", "DomPoxMessage", "(", "document", ",", "transformer", ",", "DomPoxMessageFactory", ".", "DEFAULT_CONTENT_TYPE", ")", ";", "}", "@", "@", "-", "30", ",", "14", "+", "30", ",", "16", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "@", "SuppressWarnings", "(", "\"", "Since15", "\"", ")", "public", "abstract", "class", "AbstractEndpointTestCase", "{", "@", "@", "-", "53", ",", "7", "+", "55", ",", "7", "@", "@", "@", "Test", "public", "void", "testDomSource", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "requestDocument", "=", "documentBuilder", ".", "parse", "(", "new", "InputSource", "(", "new", "StringReader", "(", "REQUEST", ")", "))", ";", "@", "@", "-", "69", ",", "14", "+", "71", ",", "14", "@", "@", "public", "void", "testSaxSource", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testStaxSourceEventReader", "(", ")", "throws", "Exception", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLEventReader", "eventReader", "=", "inputFactory", ".", "createXMLEventReader", "(", "new", "StringReader", "(", "REQUEST", ")", ");", "testSource", "(", "new", "SAXSource", "(", "StaxUtils", ".", "createXMLReader", "(", "eventReader", ")", ",", "new", "InputSource", "(", "))", ");", "}", "@", "Test", "public", "void", "testStaxSourceStreamReader", "(", ")", "throws", "Exception", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLStreamReader", "streamReader", "=", "inputFactory", ".", "createXMLStreamReader", "(", "new", "StringReader", "(", "REQUEST", ")", ");", "testSource", "(", "new", "SAXSource", "(", "StaxUtils", ".", "createXMLReader", "(", "streamReader", ")", ",", "new", "InputSource", "(", "))", ");", "}", "@", "@", "-", "18", ",", "15", "+", "18", ",", "15", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "@", "@", "-", "39", ",", "7", "+", "39", ",", "7", "@", "@", "@", "Before", "public", "void", "createEndpoint", "(", ")", "throws", "Exception", "{", "endpoint", "=", "createResponseEndpoint", "(", ");", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "}", "@", "Test", "@", "@", "-", "23", ",", "14", "+", "23", ",", "10", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "*;", "import", "org", ".", "junit", ".", "Assert", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "47", ",", "6", "+", "43", ",", "11", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "mime", ".", "MimeMessage", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "class", "MarshallingPayloadEndpointTest", "{", "@", "@", "-", "59", ",", "7", "+", "60", ",", "7", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "MockWebServiceMessage", "request", "=", "new", "MockWebServiceMessage", "(", "\"<", "request", "/", ">\"", ");", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "factoryMock", "=", "createMock", "(", "WebServiceMessageFactory", ".", "class", ")", ";", "context", "=", "new", "DefaultMessageContext", "(", "request", ",", "factoryMock", ")", ";", "@", "@", "-", "22", ",", "7", "+", "22", ",", "10", "@", "@", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "org", ".", "apache", ".", "axiom", ".", "om", ".", "OMAbstractFactory", ";", "import", "org", ".", "apache", ".", "axiom", ".", "soap", ".", "SOAPFactory", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "DefaultMessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "@", "@", "-", "32", ",", "13", "+", "35", ",", "14", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "SaajSoapMessageFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "apache", ".", "axiom", ".", "om", ".", "OMAbstractFactory", ";", "import", "org", ".", "apache", ".", "axiom", ".", "soap", ".", "SOAPFactory", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "/", "**", "*", "Test", "case", "for", "AbstractStaxStreamPayloadEndpoint", ".", "@", "@", "-", "101", ",", "7", "+", "105", ",", "7", "@", "@", "protected", "XMLOutputFactory", "createXmlOutputFactory", "(", ")", "{", "@", "Test", "public", "void", "testSaajResponse", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "MessageFactory", "messageFactory", "=", "MessageFactory", ".", "newInstance", "(", ");", "SaajSoapMessage", "request", "=", "new", "SaajSoapMessage", "(", "messageFactory", ".", "createMessage", "(", "))", ";", "transformer", ".", "transform", "(", "new", "StringSource", "(", "REQUEST", ")", ",", "request", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "119", ",", "7", "+", "123", ",", "7", "@", "@", "public", "void", "testSaajResponse", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAxiomResponse", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "SOAPFactory", "axiomFactory", "=", "OMAbstractFactory", ".", "getSOAP11Factory", "(", ");", "AxiomSoapMessage", "request", "=", "new", "AxiomSoapMessage", "(", "axiomFactory", ")", ";", "transformer", ".", "transform", "(", "new", "StringSource", "(", "REQUEST", ")", ",", "request", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "137", ",", "7", "+", "141", ",", "7", "@", "@", "public", "void", "testAxiomResponse", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAxiomNoResponse", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "SOAPFactory", "axiomFactory", "=", "OMAbstractFactory", ".", "getSOAP11Factory", "(", ");", "AxiomSoapMessage", "request", "=", "new", "AxiomSoapMessage", "(", "axiomFactory", ")", ";", "transformer", ".", "transform", "(", "new", "StringSource", "(", "REQUEST", ")", ",", "request", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "152", ",", "7", "+", "156", ",", "7", "@", "@", "public", "void", "testAxiomNoResponse", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAxiomResponseNoPayloadCaching", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "SOAPFactory", "axiomFactory", "=", "OMAbstractFactory", ".", "getSOAP11Factory", "(", ");", "AxiomSoapMessage", "request", "=", "new", "AxiomSoapMessage", "(", "axiomFactory", ")", ";", "transformer", ".", "transform", "(", "new", "StringSource", "(", "REQUEST", ")", ",", "request", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "172", ",", "7", "+", "176", ",", "7", "@", "@", "public", "void", "testAxiomResponseNoPayloadCaching", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAxiomNoResponseNoPayloadCaching", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "SOAPFactory", "axiomFactory", "=", "OMAbstractFactory", ".", "getSOAP11Factory", "(", ");", "AxiomSoapMessage", "request", "=", "new", "AxiomSoapMessage", "(", "axiomFactory", ")", ";", "transformer", ".", "transform", "(", "new", "StringSource", "(", "REQUEST", ")", ",", "request", ".", "getPayloadResult", "(", "))", ";", "@", "@", "-", "20", ",", "21", "+", "20", ",", "21", "@", "@", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "ws", ".", "MockWebServiceMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "MockWebServiceMessageFactory", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "DefaultMessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "PayloadEndpoint", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "*;", "public", "class", "PayloadEndpointAdapterTest", "{", "@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "public", "void", "testSupports", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testInvoke", "(", ")", "throws", "Exception", "{", "MockWebServiceMessage", "request", "=", "new", "MockWebServiceMessage", "(", "\"<", "request", "/", ">\"", ");", "final", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "final", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "PayloadEndpoint", "endpoint", "=", "new", "PayloadEndpoint", "(", ")", "{", "public", "Source", "invoke", "(", "Source", "request", ")", "throws", "Exception", "{", "StringWriter", "writer", "=", "new", "StringWriter", "(", ");", "@", "@", "-", "31", ",", "6", "+", "31", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "annotation", ".", "XPathParam", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "141", ",", "7", "+", "142", ",", "7", "@", "@", "public", "void", "testInvokeSource", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testInvokeVoidDom", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "String", "rootNamespace", "=", "\"", "http", ":", "//", "rootnamespace", "\"", ";", "@", "@", "-", "20", ",", "17", "+", "20", ",", "17", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "springframework", ".", "core", ".", "MethodParameter", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "adapter", ".", "method", ".", "AbstractPayloadMethodProcessorTestCase", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "adapter", ".", "method", ".", "AbstractPayloadSourceMethodProcessor", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "annotation", ".", "RequestPayload", ";", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "annotation", ".", "ResponsePayload", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "public", "class", "DomPayloadMethodProcessorTest", "extends", "AbstractPayloadMethodProcessorTestCase", "{", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "protected", "void", "testArgument", "(", "Object", "argument", ",", "MethodParameter", "parameter", ")", "{", "@", "Override", "protected", "Element", "getReturnValue", "(", "MethodParameter", "returnType", ")", "throws", "ParserConfigurationException", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "return", "document", ".", "createElementNS", "(", "NAMESPACE_URI", ",", "LOCAL_NAME", ")", ";", "@", "@", "-", "23", ",", "7", "+", "23", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlType", ";", "import", "javax", ".", "xml", ".", "namespace", ".", "QName", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "39", ",", "6", "+", "38", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "axiom", ".", "AxiomSoapMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "axiom", ".", "AxiomSoapMessageFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "@", "@", "-", "133", ",", "7", "+", "133", ",", "7", "@", "@", "public", "void", "handleReturnValueAxiom", "(", ")", "throws", "Exception", "{", "assertTrue", "(", "\"", "context", "has", "no", "response", "\"", ",", "messageContext", ".", "hasResponse", "(", "))", ";", "AxiomSoapMessage", "response", "=", "(", "AxiomSoapMessage", ")", "messageContext", ".", "getResponse", "(", ");", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "StringResult", "payloadResult", "=", "new", "StringResult", "(", ");", "transformer", ".", "transform", "(", "response", ".", "getPayloadSource", "(", "),", "payloadResult", ")", ";", "@", "@", "-", "26", ",", "7", "+", "26", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "49", ",", "6", "+", "48", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "axiom", ".", "AxiomSoapMessageFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "AbstractXmlReader", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "@", "@", "-", "199", ",", "7", "+", "199", ",", "7", "@", "@", "public", "void", "handleReturnValueAxiom", "(", ")", "throws", "Exception", "{", "assertTrue", "(", "\"", "context", "has", "no", "response", "\"", ",", "messageContext", ".", "hasResponse", "(", "))", ";", "AxiomSoapMessage", "response", "=", "(", "AxiomSoapMessage", ")", "messageContext", ".", "getResponse", "(", ");", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "StringResult", "payloadResult", "=", "new", "StringResult", "(", ");", "transformer", ".", "transform", "(", "response", ".", "getPayloadSource", "(", "),", "payloadResult", ")", ";", "@", "@", "-", "22", ",", "7", "+", "22", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "41", ",", "6", "+", "40", ",", "9", "@", "@", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "PayloadTransformingInterceptorTest", "{", "@", "@", "-", "57", ",", "7", "+", "59", ",", "7", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "interceptor", "=", "new", "PayloadTransformingInterceptor", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "input", "=", "new", "ClassPathResource", "(", "\"", "transformInput", ".", "xml", "\"", ",", "getClass", "(", "))", ";", "output", "=", "new", "ClassPathResource", "(", "\"", "transformOutput", ".", "xml", "\"", ",", "getClass", "(", "))", ";", "@", "@", "-", "24", ",", "30", "+", "24", ",", "32", "@", "@", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "class", "PayloadRootUtilsTest", "{", "@", "Test", "public", "void", "testGetQNameForDomSource", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "builder", ".", "newDocument", "(", ");", "Element", "element", "=", "document", ".", "createElementNS", "(", "\"", "namespace", "\"", ",", "\"", "prefix", ":", "localname", "\"", ");", "document", ".", "appendChild", "(", "element", ")", ";", "Source", "source", "=", "new", "DOMSource", "(", "document", ")", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactory", ".", "newInstance", "(", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "Assert", ".", "assertNotNull", "(", "\"", "getQNameForNode", "returns", "null", "\"", ",", "qName", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "QName", "has", "invalid", "localname", "\"", ",", "\"", "localname", "\"", ",", "qName", ".", "getLocalPart", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Qname", "has", "invalid", "namespace", "\"", ",", "\"", "namespace", "\"", ",", "qName", ".", "getNamespaceURI", "(", "))", ";", "@", "@", "-", "57", ",", "10", "+", "59", ",", "10", "@", "@", "public", "void", "testGetQNameForDomSource", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testGetQNameForStaxSourceStreamReader", "(", ")", "throws", "Exception", "{", "String", "contents", "=", "\"", "<", "prefix", ":", "localname", "xmlns", ":", "prefix", "=", "'", "namespace", "'", "/>", "\";", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLStreamReader", "streamReader", "=", "inputFactory", ".", "createXMLStreamReader", "(", "new", "StringReader", "(", "contents", ")", ");", "Source", "source", "=", "StaxUtils", ".", "createStaxSource", "(", "streamReader", ")", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactory", ".", "newInstance", "(", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "Assert", ".", "assertNotNull", "(", "\"", "getQNameForNode", "returns", "null", "\"", ",", "qName", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "QName", "has", "invalid", "localname", "\"", ",", "\"", "localname", "\"", ",", "qName", ".", "getLocalPart", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Qname", "has", "invalid", "namespace", "\"", ",", "\"", "namespace", "\"", ",", "qName", ".", "getNamespaceURI", "(", "))", ";", "@", "@", "-", "70", ",", "10", "+", "72", ",", "10", "@", "@", "public", "void", "testGetQNameForStaxSourceStreamReader", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testGetQNameForStaxSourceEventReader", "(", ")", "throws", "Exception", "{", "String", "contents", "=", "\"", "<", "prefix", ":", "localname", "xmlns", ":", "prefix", "=", "'", "namespace", "'", "/>", "\";", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLEventReader", "eventReader", "=", "inputFactory", ".", "createXMLEventReader", "(", "new", "StringReader", "(", "contents", ")", ");", "Source", "source", "=", "StaxUtils", ".", "createStaxSource", "(", "eventReader", ")", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactory", ".", "newInstance", "(", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "Assert", ".", "assertNotNull", "(", "\"", "getQNameForNode", "returns", "null", "\"", ",", "qName", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "QName", "has", "invalid", "localname", "\"", ",", "\"", "localname", "\"", ",", "qName", ".", "getLocalPart", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Qname", "has", "invalid", "namespace", "\"", ",", "\"", "namespace", "\"", ",", "qName", ".", "getNamespaceURI", "(", "))", ";", "@", "@", "-", "84", ",", "7", "+", "86", ",", "7", "@", "@", "public", "void", "testGetQNameForStaxSourceEventReader", "(", ")", "throws", "Exception", "{", "public", "void", "testGetQNameForStreamSource", "(", ")", "throws", "Exception", "{", "String", "contents", "=", "\"", "<", "prefix", ":", "localname", "xmlns", ":", "prefix", "=", "'", "namespace", "'", "/>", "\";", "Source", "source", "=", "new", "StreamSource", "(", "new", "StringReader", "(", "contents", ")", ");", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactory", ".", "newInstance", "(", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "Assert", ".", "assertNotNull", "(", "\"", "getQNameForNode", "returns", "null", "\"", ",", "qName", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "QName", "has", "invalid", "localname", "\"", ",", "\"", "localname", "\"", ",", "qName", ".", "getLocalPart", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Qname", "has", "invalid", "namespace", "\"", ",", "\"", "namespace", "\"", ",", "qName", ".", "getNamespaceURI", "(", "))", ";", "@", "@", "-", "95", ",", "7", "+", "97", ",", "7", "@", "@", "public", "void", "testGetQNameForStreamSource", "(", ")", "throws", "Exception", "{", "public", "void", "testGetQNameForSaxSource", "(", ")", "throws", "Exception", "{", "String", "contents", "=", "\"", "<", "prefix", ":", "localname", "xmlns", ":", "prefix", "=", "'", "namespace", "'", "/>", "\";", "Source", "source", "=", "new", "SAXSource", "(", "new", "InputSource", "(", "new", "StringReader", "(", "contents", ")", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactory", ".", "newInstance", "(", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "source", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "Assert", ".", "assertNotNull", "(", "\"", "getQNameForNode", "returns", "null", "\"", ",", "qName", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "QName", "has", "invalid", "localname", "\"", ",", "\"", "localname", "\"", ",", "qName", ".", "getLocalPart", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Qname", "has", "invalid", "namespace", "\"", ",", "\"", "namespace", "\"", ",", "qName", ".", "getNamespaceURI", "(", "))", ";", "@", "@", "-", "104", ",", "7", "+", "106", ",", "7", "@", "@", "public", "void", "testGetQNameForSaxSource", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testGetQNameForNullSource", "(", ")", "throws", "Exception", "{", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "null", ",", "TransformerFactory", ".", "newInstance", "(", "))", ";", "QName", "qName", "=", "PayloadRootUtils", ".", "getPayloadRootQName", "(", "null", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "Assert", ".", "assertNull", "(", "\"", "Qname", "returned", "\"", ",", "qName", ")", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "25", ",", "6", "+", "25", ",", "8", "@", "@", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "public", "abstract", "class", "AbstractSoapElementTestCase", "{", "private", "SoapElement", "soapElement", ";", "@", "@", "-", "33", ",", "7", "+", "35", ",", "7", "@", "@", "@", "Before", "public", "final", "void", "setUp", "(", ")", "throws", "Exception", "{", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "soapElement", "=", "createSoapElement", "(", ");", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "10", "@", "@", "import", "java", ".", "io", ".", "InputStream", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "ws", ".", "InvalidXmlException", ";", "import", "org", ".", "springframework", ".", "ws", ".", "WebServiceMessage", ";", "@", "@", "-", "29", ",", "21", "+", "32", ",", "17", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "MockTransportInputStream", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "TransportInputStream", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "public", "class", "AxiomSoap11MessageFactoryTest", "extends", "AbstractSoap11MessageFactoryTestCase", "{", "private", "Transformer", "transformer", ";", "@", "Override", "protected", "WebServiceMessageFactory", "createMessageFactory", "(", ")", "throws", "Exception", "{", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "AxiomSoapMessageFactory", "factory", "=", "new", "AxiomSoapMessageFactory", "(", ");", "factory", ".", "afterPropertiesSet", "(", ");", "@", "@", "-", "22", ",", "11", "+", "22", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "apache", ".", "axiom", ".", "om", ".", "OMAbstractFactory", ";", "import", "org", ".", "apache", ".", "axiom", ".", "om", ".", "OMElement", ";", "import", "org", ".", "apache", ".", "axiom", ".", "om", ".", "OMFactory", ";", "@", "@", "-", "41", ",", "7", "+", "36", ",", "13", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "AxiomUtilsTest", "{", "@", "@", "-", "107", ",", "7", "+", "108", ",", "7", "@", "@", "public", "void", "testToLocale", "(", ")", "throws", "Exception", "{", "public", "void", "testToDocument", "(", ")", "throws", "Exception", "{", "Resource", "resource", "=", "new", "ClassPathResource", "(", "\"", "org", "/", "springframework", "/", "ws", "/", "soap", "/", "soap11", "/", "soap11", ".", "xml", "\"", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "expected", "=", "documentBuilder", ".", "parse", "(", "SaxUtils", ".", "createInputSource", "(", "resource", ")", ");", "@", "@", "-", "127", ",", "7", "+", "128", ",", "7", "@", "@", "public", "void", "testToEnvelope", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "buf", "=", "FileCopyUtils", ".", "copyToByteArray", "(", "resource", ".", "getFile", "(", "))", ";", "String", "expected", "=", "new", "String", "(", "buf", ",", "\"", "UTF", "-", "8", "\"", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "parse", "(", "SaxUtils", ".", "createInputSource", "(", "resource", ")", ");", "@", "@", "-", "26", ",", "15", "+", "26", ",", "15", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "public", "class", "SaajContentHandlerTest", "{", "private", "SaajContentHandler", "handler", ";", "@", "@", "-", "49", ",", "7", "+", "49", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "SOAPMessage", "message", "=", "messageFactory", ".", "createMessage", "(", ");", "envelope", "=", "message", ".", "getSOAPPart", "(", ").", "getEnvelope", "(", ");", "handler", "=", "new", "SaajContentHandler", "(", "envelope", ".", "getBody", "(", "))", ";", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "}", "@", "Test", "@", "@", "-", "27", ",", "16", "+", "27", ",", "17", "@", "@", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPException", ";", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPMessage", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "SaajUtilsTest", "{", "@", "@", "-", "119", ",", "7", "+", "120", ",", "7", "@", "@", "public", "void", "testToQNamePrefixNamespace", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testLoadMessage", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "factory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "builder", ".", "parse", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "soapMessage", ".", "xml", "\"", "))", ";", "@", "@", "-", "21", ",", "7", "+", "21", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPMessage", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "@", "@", "-", "31", ",", "7", "+", "30", ",", "9", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "SaajXmlReaderTest", "{", "@", "@", "-", "47", ",", "7", "+", "48", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "message", "=", "messageFactory", ".", "createMessage", "(", ");", "SOAPEnvelope", "envelope", "=", "message", ".", "getSOAPPart", "(", ").", "getEnvelope", "(", ");", "saajReader", "=", "new", "SaajXmlReader", "(", "envelope", ")", ";", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "}", "@", "Test", "@", "@", "-", "51", ",", "6", "+", "51", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "soap12", ".", "Soap12Fault", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "MockTransportInputStream", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "TransportInputStream", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "validation", ".", "ValidationErrorHandler", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "SimpleXsdSchema", ";", "@", "@", "-", "92", ",", "7", "+", "93", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "soap11Factory", "=", "new", "SaajSoapMessageFactory", "(", "MessageFactory", ".", "newInstance", "(", "SOAPConstants", ".", "SOAP_1_1_PROTOCOL", ")", ");", "soap12Factory", "=", "new", "SaajSoapMessageFactory", "(", "MessageFactory", ".", "newInstance", "(", "SOAPConstants", ".", "SOAP_1_2_PROTOCOL", ")", ");", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "}", "@", "Test", "@", "@", "-", "36", ",", "6", "+", "36", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "SoapVersion", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "MockTransportOutputStream", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "@", "@", "-", "96", ",", "7", "+", "97", ",", "7", "@", "@", "public", "void", "testToDocument", "(", ")", "throws", "Exception", "{", "transformer", ".", "transform", "(", "new", "StringSource", "(", "\"<", "payload", "xmlns", "=", "'", "http", ":", "//", "www", ".", "springframework", ".", "org", "'", "/", ">\"", "),", "soapMessage", ".", "getSoapBody", "(", ").", "getPayloadResult", "(", "))", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "expected", "=", "documentBuilder", ".", "newDocument", "(", ");", "@", "@", "-", "37", ",", "6", "+", "37", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "MockTransportOutputStream", ";", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "TransportConstants", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "@", "@", "-", "100", ",", "7", "+", "101", ",", "7", "@", "@", "public", "void", "testToDocument", "(", ")", "throws", "Exception", "{", "transformer", ".", "transform", "(", "new", "StringSource", "(", "\"<", "payload", "xmlns", "=", "'", "http", ":", "//", "www", ".", "springframework", ".", "org", "'", "/", ">\"", "),", "soapMessage", ".", "getSoapBody", "(", ").", "getPayloadResult", "(", "))", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "expected", "=", "documentBuilder", ".", "newDocument", "(", ");", "@", "@", "-", "56", ",", "6", "+", "56", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "transport", ".", "support", ".", "FreePortScanner", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "@", "@", "-", "109", ",", "7", "+", "110", ",", "7", "@", "@", "public", "final", "void", "setUp", "(", ")", "throws", "Exception", "{", "XMLUnit", ".", "setIgnoreWhitespace", "(", "true", ")", ";", "saajMessageFactory", "=", "MessageFactory", ".", "newInstance", "(", "SOAPConstants", ".", "SOAP_1_1_PROTOCOL", ")", ";", "messageFactory", "=", "new", "SaajSoapMessageFactory", "(", "saajMessageFactory", ")", ";", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "}", "protected", "abstract", "T", "createMessageSender", "(", ");", "@", "@", "-", "24", ",", "9", "+", "24", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "37", ",", "6", "+", "35", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "SaajSoapMessageFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "public", "class", "HttpServletConnectionTest", "{", "@", "@", "-", "67", ",", "7", "+", "69", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "connection", "=", "new", "HttpServletConnection", "(", "httpServletRequest", ",", "httpServletResponse", ")", ";", "MessageFactory", "saajMessageFactory", "=", "MessageFactory", ".", "newInstance", "(", "SOAPConstants", ".", "SOAP_1_1_PROTOCOL", ")", ";", "messageFactory", "=", "new", "SaajSoapMessageFactory", "(", "saajMessageFactory", ")", ";", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "}", "@", "Test", "@", "@", "-", "21", ",", "15", "+", "21", ",", "16", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "class", "LastModifiedHelperTest", "{", "private", "Resource", "resource", ";", "@", "@", "-", "50", ",", "7", "+", "51", ",", "7", "@", "@", "public", "void", "testSaxSource", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDomSource", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "parse", "(", "resource", ".", "getFile", "(", "))", ";", "@", "@", "-", "36", ",", "6", "+", "36", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "ws", ".", "server", ".", "endpoint", ".", "mapping", ".", "PayloadRootQNameEndpointMapping", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "server", ".", "endpoint", ".", "SimpleSoapExceptionResolver", ";", "import", "org", ".", "springframework", ".", "ws", ".", "wsdl", ".", "wsdl11", ".", "SimpleWsdl11Definition", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Assert", ";", "@", "@", "-", "90", ",", "7", "+", "91", ",", "7", "@", "@", "public", "void", "testDetectWsdlDefinitions", "(", ")", "throws", "Exception", "{", "new", "MockHttpServletRequest", "(", "HttpTransportConstants", ".", "METHOD_GET", ",", "\"", "/", "definition", ".", "wsdl", "\"", ");", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "servlet", ".", "service", "(", "request", ",", "response", ")", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "result", "=", "documentBuilder", ".", "parse", "(", "new", "ByteArrayInputStream", "(", "response", ".", "getContentAsByteArray", "(", "))", ");", "@", "@", "-", "23", ",", "19", "+", "23", ",", "20", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletResponse", ";", "import", "org", ".", "springframework", ".", "ws", ".", "wsdl", ".", "WsdlDefinition", ";", "import", "org", ".", "springframework", ".", "ws", ".", "wsdl", ".", "wsdl11", ".", "SimpleWsdl11Definition", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "*;", "public", "class", "WsdlDefinitionHandlerAdapterTest", "{", "@", "@", "-", "98", ",", "7", "+", "99", ",", "7", "@", "@", "public", "void", "transformLocations", "(", ")", "throws", "Exception", "{", "replay", "(", "definitionMock", ")", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "result", "=", "documentBuilder", ".", "parse", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "wsdl11", "-", "input", ".", "wsdl", "\"", "))", ";", "@", "@", "-", "185", ",", "7", "+", "186", ",", "7", "@", "@", "public", "void", "handleSimpleWsdl11DefinitionWithoutTransformLocations", "(", ")", "throws", "Excep", "adapter", ".", "handle", "(", "request", ",", "response", ",", "definition", ")", ";", "InputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "response", ".", "getContentAsByteArray", "(", "))", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "resultingDocument", "=", "documentBuilder", ".", "parse", "(", "inputStream", ")", ";", "@", "@", "-", "215", ",", "7", "+", "216", ",", "7", "@", "@", "public", "void", "handleSimpleWsdl11DefinitionWithTransformLocation", "(", ")", "throws", "Exception", "adapter", ".", "handle", "(", "request", ",", "response", ",", "definition", ")", ";", "InputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "response", ".", "getContentAsByteArray", "(", "))", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "resultingDocument", "=", "documentBuilder", ".", "parse", "(", "inputStream", ")", ";", "@", "@", "-", "22", ",", "18", "+", "22", ",", "19", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletResponse", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "SimpleXsdSchema", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "public", "class", "XsdSchemaHandlerAdapterTest", "{", "@", "@", "-", "99", ",", "7", "+", "100", ",", "7", "@", "@", "public", "void", "handleGetWithTransformLocation", "(", ")", "throws", "Exception", "{", "adapter", ".", "handle", "(", "request", ",", "response", ",", "schema", ")", ";", "InputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "response", ".", "getContentAsByteArray", "(", "))", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "resultingDocument", "=", "documentBuilder", ".", "parse", "(", "inputStream", ")", ";", "@", "@", "-", "22", ",", "17", "+", "22", ",", "19", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "SimpleXsdSchema", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "commons", ".", "CommonsXsdSchemaCollection", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "SimpleXsdSchema", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "commons", ".", "CommonsXsdSchemaCollection", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "DefaultWsdl11DefinitionTest", "{", "@", "@", "-", "45", ",", "9", "+", "47", ",", "9", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "definition", "=", "new", "DefaultWsdl11Definition", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "XMLUnit", ".", "setIgnoreWhitespace", "(", "true", ")", ";", "@", "@", "-", "24", ",", "7", "+", "24", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "@", "@", "-", "34", ",", "7", "+", "33", ",", "10", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "Wsdl4jDefinitionTest", "{", "@", "@", "-", "55", ",", "7", "+", "57", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "finally", "{", "is", ".", "close", "(", ");", "}", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "}", "@", "Test", "@", "@", "-", "64", ",", "7", "+", "66", ",", "7", "@", "@", "public", "void", "testGetSource", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertNotNull", "(", "\"", "Source", "is", "null", "\"", ",", "source", ")", ";", "DOMResult", "result", "=", "new", "DOMResult", "(", ");", "transformer", ".", "transform", "(", "source", ",", "result", ")", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "expected", "=", "documentBuilder", ".", "parse", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "complete", ".", "wsdl", "\"", "))", ";", "@", "@", "-", "26", ",", "15", "+", "26", ",", "16", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "class", "DefaultMessagesProviderTest", "{", "private", "DefaultMessagesProvider", "provider", ";", "@", "@", "-", "48", ",", "7", "+", "49", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "provider", "=", "new", "DefaultMessagesProvider", "(", ");", "WSDLFactory", "factory", "=", "WSDLFactory", ".", "newInstance", "(", ");", "definition", "=", "factory", ".", "newDefinition", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "}", "@", "@", "-", "26", ",", "15", "+", "26", ",", "16", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "class", "SuffixBasedMessagesProviderTest", "{", "private", "SuffixBasedMessagesProvider", "provider", ";", "@", "@", "-", "49", ",", "7", "+", "50", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "provider", ".", "setFaultSuffix", "(", "\"", "Foo", "\"", ");", "WSDLFactory", "factory", "=", "WSDLFactory", ".", "newInstance", "(", ");", "definition", "=", "factory", ".", "newDefinition", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "}", "@", "@", "-", "25", ",", "19", "+", "25", ",", "19", "@", "@", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPHeaderElement", ";", "import", "javax", ".", "xml", ".", "soap", ".", "SOAPMessage", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "DefaultMessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "context", ".", "MessageContext", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "SoapMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "SaajSoapMessage", ";", "import", "org", ".", "springframework", ".", "ws", ".", "soap", ".", "saaj", ".", "SaajSoapMessageFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "public", "class", "SaajWss4jMessageInterceptorSignTest", "extends", "Wss4jMessageInterceptorSignTestCase", "{", "@", "@", "-", "46", ",", "7", "+", "46", ",", "7", "@", "@", "@", "Test", "public", "void", "testSignAndValidate", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "interceptor", ".", "setSecurementActions", "(", "\"", "Signature", "\"", ");", "interceptor", ".", "setEnableSignatureConfirmation", "(", "false", ")", ";", "interceptor", ".", "setSecurementPassword", "(", "\"", "123456", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "100", "@", "@", "/", "*", "*", "Copyright", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "/", "**", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "3", ".", "0", ".", "5", "*", "/", "public", "class", "DocumentBuilderFactoryUtils", "{", "private", "static", "final", "Log", "log", "=", "LogFactory", ".", "getLog", "(", "DocumentBuilderFactoryUtils", ".", "class", ")", ";", "/", "**", "*", "Build", "a", "{", "@", "link", "DocumentBuilderFactory", "}", "then", "set", "properties", "to", "prevent", "external", "entity", "access", ".", "*", "*", "@", "see", "DocumentBuilderFactory", "#", "newInstance", "(", ")", "*", "/", "public", "static", "DocumentBuilderFactory", "newInstance", "(", ")", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "try", "{", "factory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", "+", "\"", "property", "not", "supported", "by", "\"", "+", "factory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "factory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", ",", "\"", "\")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", "+", "\"", "property", "not", "supported", "by", "\"", "+", "factory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "\"", "FEATURE", "'", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "'", "is", "probably", "not", "supported", "by", "\"", "+", "factory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "\"", "FEATURE", "'", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "'", "is", "probably", "not", "supported", "by", "\"", "+", "factory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "false", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "\"", "FEATURE", "'", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "'", "is", "probably", "not", "supported", "by", "\"", "+", "factory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "\"", ",", "false", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "\"", "FEATURE", "'", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "'", "is", "probably", "not", "supported", "by", "\"", "+", "factory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "factory", ".", "setXIncludeAware", "(", "false", ")", ";", "factory", ".", "setExpandEntityReferences", "(", "false", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "\"", "Caught", "\"", "+", "e", ".", "getMessage", "(", ")", "+", "\"", "attempting", "to", "configure", "your", "XML", "parser", ".", "\")", ";", "}", "}", "return", "factory", ";", "}", "}", "@", "@", "-", "22", ",", "12", "+", "22", ",", "11", "@", "@", "*", "Helper", "class", "used", "to", "find", "the", "current", "version", "of", "JAXP", ".", "We", "cannot", "depend", "on", "the", "Java", "version", ",", "since", "JAXP", "can", "be", "*", "upgraded", "independently", "of", "the", "Java", "version", ".", "*", "*", "<", "p", ">", "Only", "distinguishes", "between", "JAXP", "1", ".", "0", ",", "1", ".", "1", ",", "1", ".", "3", ",", "and", "1", ".", "4", ",", "since", "JAXP", "1", ".", "2", "was", "a", "maintenance", "release", "with", "no", "new", "*", "<", "p", ">", "Only", "distinguishes", "between", "JAXP", "1", ".", "0", ",", "1", ".", "1", ",", "1", ".", "3", ",", "1", ".", "4", ",", "and", "1", ".", "5", ",", "since", "JAXP", "1", ".", "2", "was", "a", "maintenance", "release", "with", "no", "new", "*", "classes", ".", "*", "*", "<", "p", ">", "Note", "that", "Spring", "-", "WS", "requires", "JDK", "1", ".", "5", "as", "of", "Spring", "-", "WS", "2", ".", "0", ",", "and", "therefore", "has", "at", "least", "JAXP", "1", ".", "3", "available", ".", "*", "*", "@", "author", "Arjen", "Poutsma", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "1", ".", "0", ".", "0", "*", "/", "public", "abstract", "class", "JaxpVersion", "{", "@", "@", "-", "52", ",", "19", "+", "51", ",", "31", "@", "@", "*", "/", "public", "static", "final", "int", "JAXP_14", "=", "4", ";", "/", "**", "*", "Constant", "identifying", "JAXP", "1", ".", "5", ".", "*", "/", "public", "static", "final", "int", "JAXP_15", "=", "5", ";", "private", "static", "final", "String", "JAXP_14_CLASS_NAME", "=", "\"", "javax", ".", "xml", ".", "transform", ".", "stax", ".", "StAXSource", "\"", ";", "private", "static", "final", "String", "JAXP_15_CLASS_NAME", "=", "\"", "javax", ".", "xml", ".", "validation", ".", "SchemaFactoryConfigurationError", "\"", ";", "private", "static", "int", "jaxpVersion", ";", "static", "{", "ClassLoader", "classLoader", "=", "JaxpVersion", ".", "class", ".", "getClassLoader", "(", ");", "try", "{", "ClassUtils", ".", "forName", "(", "JAXP_14_CLASS_NAME", ",", "classLoader", ")", ";", "jaxpVersion", "=", "JAXP_14", ";", "}", "catch", "(", "ClassNotFoundException", "ex", ")", "{", "/", "/", "leave", "1", ".", "3", "as", "default", "(", "it", "'", "s", "either", "1", ".", "3", "or", "unknown", ")", "jaxpVersion", "=", "JAXP_13", ";", "ClassUtils", ".", "forName", "(", "JAXP_15_CLASS_NAME", ",", "classLoader", ")", ";", "jaxpVersion", "=", "JAXP_15", ";", "}", "catch", "(", "ClassNotFoundException", "ex", ")", "{", "try", "{", "ClassUtils", ".", "forName", "(", "JAXP_14_CLASS_NAME", ",", "classLoader", ")", ";", "jaxpVersion", "=", "JAXP_14", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "/", "/", "leave", "1", ".", "3", "as", "default", "(", "it", "'", "s", "either", "1", ".", "3", "or", "unknown", ")", "jaxpVersion", "=", "JAXP_13", ";", "}", "}", "}", "@", "@", "-", "76", ",", "6", "+", "87", ",", "7", "@", "@", "*", "@", "see", "#", "JAXP_11", "*", "@", "see", "#", "JAXP_13", "*", "@", "see", "#", "JAXP_14", "*", "@", "see", "#", "JAXP_15", "*", "/", "public", "static", "int", "getJaxpVersion", "(", ")", "{", "return", "jaxpVersion", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "39", "@", "@", "/", "*", "*", "Copyright", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "/", "**", "*", "@", "author", "Greg", "Turnquist", "*", "/", "public", "class", "XMLInputFactoryUtils", "{", "/", "**", "*", "Build", "an", "{", "@", "link", "XMLInputFactory", "}", "and", "set", "properties", "to", "prevent", "external", "entities", "from", "accessing", ".", "*", "*", "@", "see", "XMLInputFactory", "#", "newInstance", "(", ")", "*", "/", "public", "static", "XMLInputFactory", "newInstance", "(", ")", "{", "XMLInputFactory", "factory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "factory", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "false", ")", ";", "factory", ".", "setProperty", "(", "\"", "javax", ".", "xml", ".", "stream", ".", "isSupportingExternalEntities", "\"", ",", "false", ")", ";", "return", "factory", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "57", "@", "@", "/", "*", "*", "Copyright", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ".", "transform", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactoryConfigurationError", ";", "/", "**", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "3", ".", "0", ".", "5", "*", "/", "public", "class", "TransformerFactoryUtils", "{", "/", "**", "*", "Build", "a", "new", "{", "@", "link", "TransformerFactory", "}", "using", "the", "default", "constructor", ".", "*", "/", "public", "static", "TransformerFactory", "newInstance", "(", ")", "{", "return", "defaultSettings", "(", "TransformerFactory", ".", "newInstance", "(", "))", ";", "}", "/", "**", "*", "Build", "an", "{", "@", "link", "TransformerFactory", "}", "and", "prevent", "external", "entities", "from", "accessing", ".", "*", "*", "@", "see", "TransformerFactory", "#", "newInstance", "(", ")", "*", "/", "public", "static", "TransformerFactory", "newInstance", "(", "Class", "<", "?", "extends", "TransformerFactory", ">", "transformerFactoryClass", ")", "{", "try", "{", "return", "defaultSettings", "(", "transformerFactoryClass", ".", "newInstance", "(", "))", ";", "}", "catch", "(", "InstantiationException", "|", "IllegalAccessException", "e", ")", "{", "throw", "new", "TransformerFactoryConfigurationError", "(", "e", ",", "\"", "Could", "not", "instantiate", "TransformerFactory", "[", "\"", "+", "transformerFactoryClass", "+", "\"", "]\"", ");", "}", "}", "/", "**", "*", "Prevent", "external", "entities", "from", "accessing", ".", "*", "/", "private", "static", "TransformerFactory", "defaultSettings", "(", "TransformerFactory", "factory", ")", "{", "factory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "factory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_STYLESHEET", ",", "\"", "\")", ";", "return", "factory", ";", "}", "}", "@", "@", "-", "22", ",", "7", "+", "22", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactoryConfigurationError", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "@", "@", "-", "83", ",", "16", "+", "82", ",", "11", "@", "@", "public", "void", "setTransformerFactoryClass", "(", "Class", "<", "?", "extends", "TransformerFactory", ">", "trans", "*", "/", "protected", "TransformerFactory", "newTransformerFactory", "(", "Class", "<", "?", "extends", "TransformerFactory", ">", "transformerFactoryClass", ")", "{", "if", "(", "transformerFactoryClass", "!", "=", "null", ")", "{", "try", "{", "return", "transformerFactoryClass", ".", "newInstance", "(", ");", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "TransformerFactoryConfigurationError", "(", "ex", ",", "\"", "Could", "not", "instantiate", "TransformerFactory", "[", "\"", "+", "transformerFactoryClass", "+", "\"", "]\"", ");", "}", "}", "else", "{", "return", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", "transformerFactoryClass", ")", ";", "return", "transformerFactory", ";", "}", "else", "{", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "return", "transformerFactory", ";", "}", "}", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "*", "Internal", "class", "that", "uses", "JAXP", "1", ".", "0", "features", "to", "create", "{", "@", "code", "XmlValidator", "}", "instances", ".", "*", "*", "@", "author", "Arjen", "Poutsma", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "1", ".", "0", ".", "0", "*", "/", "abstract", "class", "Jaxp13ValidatorFactory", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "130", "@", "@", "/", "*", "*", "Copyright", "2005", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ".", "validation", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Validator", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXNotRecognizedException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXNotSupportedException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "/", "**", "*", "Internal", "class", "that", "uses", "JAXP", "1", ".", "5", "features", "to", "create", "an", "{", "@", "code", "XmlValidator", "}", "with", "settings", "to", "prevent", "*", "external", "entity", "access", ".", "*", "*", "@", "author", "Arjen", "Poutsma", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "3", ".", "0", ".", "5", "*", "/", "abstract", "class", "Jaxp15ValidatorFactory", "{", "private", "static", "final", "Log", "log", "=", "LogFactory", ".", "getLog", "(", "Jaxp15ValidatorFactory", ".", "class", ")", ";", "static", "XmlValidator", "createValidator", "(", "Resource", "[", "]", "resources", ",", "String", "schemaLanguage", ")", "throws", "IOException", "{", "try", "{", "Schema", "schema", "=", "SchemaLoaderUtils", ".", "loadSchema", "(", "resources", ",", "schemaLanguage", ")", ";", "return", "new", "Jaxp15Validator", "(", "schema", ")", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "throw", "new", "XmlValidationException", "(", "\"", "Could", "not", "create", "Schema", ":", "\"", "+", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "}", "}", "private", "static", "class", "Jaxp15Validator", "implements", "XmlValidator", "{", "private", "Schema", "schema", ";", "public", "Jaxp15Validator", "(", "Schema", "schema", ")", "{", "this", ".", "schema", "=", "schema", ";", "}", "@", "Override", "public", "SAXParseException", "[", "]", "validate", "(", "Source", "source", ")", "throws", "IOException", "{", "return", "validate", "(", "source", ",", "null", ")", ";", "}", "@", "Override", "public", "SAXParseException", "[", "]", "validate", "(", "Source", "source", ",", "ValidationErrorHandler", "errorHandler", ")", "throws", "IOException", "{", "if", "(", "errorHandler", "=", "=", "null", ")", "{", "errorHandler", "=", "new", "DefaultValidationErrorHandler", "(", ");", "}", "Validator", "validator", "=", "schema", ".", "newValidator", "(", ");", "try", "{", "validator", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXNotRecognizedException", "|", "SAXNotSupportedException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", "+", "\"", "property", "not", "supported", "by", "\"", "+", "validator", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "validator", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", ",", "\"", "\")", ";", "}", "catch", "(", "SAXNotRecognizedException", "|", "SAXNotSupportedException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", "+", "\"", "property", "not", "supported", "by", "\"", "+", "validator", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "validator", ".", "setErrorHandler", "(", "errorHandler", ")", ";", "try", "{", "validator", ".", "validate", "(", "source", ")", ";", "return", "errorHandler", ".", "getErrors", "(", ");", "}", "catch", "(", "SAXException", "ex", ")", "{", "throw", "new", "XmlValidationException", "(", "\"", "Could", "not", "validate", "source", ":", "\"", "+", "ex", ".", "getMessage", "(", "),", "ex", ")", ";", "}", "}", "}", "/", "**", "{", "@", "code", "ErrorHandler", "}", "implementation", "that", "stores", "errors", "and", "fatal", "errors", "in", "a", "list", ".", "*", "/", "private", "static", "class", "DefaultValidationErrorHandler", "implements", "ValidationErrorHandler", "{", "private", "List", "<", "SAXParseException", ">", "errors", "=", "new", "ArrayList", "<", "SAXParseException", ">", "()", ";", "@", "Override", "public", "SAXParseException", "[", "]", "getErrors", "(", ")", "{", "return", "errors", ".", "toArray", "(", "new", "SAXParseException", "[", "errors", ".", "size", "(", ")]", ");", "}", "@", "Override", "public", "void", "warning", "(", "SAXParseException", "ex", ")", "throws", "SAXException", "{", "}", "@", "Override", "public", "void", "error", "(", "SAXParseException", "ex", ")", "throws", "SAXException", "{", "errors", ".", "add", "(", "ex", ")", ";", "}", "@", "Override", "public", "void", "fatalError", "(", "SAXParseException", "ex", ")", "throws", "SAXException", "{", "errors", ".", "add", "(", "ex", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "*", "*", "Copyright", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ".", "validation", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXNotRecognizedException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXNotSupportedException", ";", "/", "**", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "3", ".", "0", ".", "5", "*", "/", "public", "class", "SchemaFactoryUtils", "{", "private", "static", "final", "Log", "log", "=", "LogFactory", ".", "getLog", "(", "SchemaFactoryUtils", ".", "class", ")", ";", "/", "**", "*", "Build", "a", "{", "@", "link", "SchemaFactory", "}", "and", "set", "properties", "to", "prevent", "external", "entities", "from", "accessing", ".", "*", "*", "@", "see", "SchemaFactory", "#", "newInstance", "(", "String", ")", "*", "/", "public", "static", "SchemaFactory", "newInstance", "(", "String", "schemaLanguage", ")", "{", "SchemaFactory", "schemaFactory", "=", "SchemaFactory", ".", "newInstance", "(", "schemaLanguage", ")", ";", "try", "{", "schemaFactory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXNotRecognizedException", "|", "SAXNotSupportedException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", "+", "\"", "property", "not", "supported", "by", "\"", "+", "schemaFactory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "try", "{", "schemaFactory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", ",", "\"", "file", ",", "jar", ":", "file", "\"", ");", "}", "catch", "(", "SAXNotRecognizedException", "|", "SAXNotSupportedException", "e", ")", "{", "if", "(", "log", ".", "isWarnEnabled", "(", "))", "{", "log", ".", "warn", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", "+", "\"", "property", "not", "supported", "by", "\"", "+", "schemaFactory", ".", "getClass", "(", ").", "getCanonicalName", "(", "))", ";", "}", "}", "return", "schemaFactory", ";", "}", "}", "@", "@", "-", "21", ",", "14", "+", "21", ",", "13", "@", "@", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "/", "**", "*", "Convenient", "utility", "methods", "for", "loading", "of", "{", "@", "link", "Schema", "}", "objects", ",", "performing", "standard", "handling", "of", "input", "streams", ".", "*", "@", "@", "-", "67", ",", "14", "+", "66", ",", "14", "@", "@", "public", "static", "Schema", "loadSchema", "(", "Resource", "[", "]", "resources", ",", "String", "schemaLanguage", ")", "thr", "Assert", ".", "notEmpty", "(", "resources", ",", "\"", "No", "resources", "given", "\"", ");", "Assert", ".", "hasLength", "(", "schemaLanguage", ",", "\"", "No", "schema", "language", "provided", "\"", ");", "Source", "[", "]", "schemaSources", "=", "new", "Source", "[", "resources", ".", "length", "]", ";", "XMLReader", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "XMLReader", "xmlReader", "=", "XMLReaderFactoryUtils", ".", "createXMLReader", "(", ");", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "namespace", "-", "prefixes", "\"", ",", "true", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "resources", ".", "length", ";", "i", "+", "+)", "{", "Assert", ".", "notNull", "(", "resources", "[", "i", "]", ",", "\"", "Resource", "is", "null", "\"", ");", "Assert", ".", "isTrue", "(", "resources", "[", "i", "]", ".", "exists", "(", "),", "\"", "Resource", "\"", "+", "resources", "[", "i", "]", "+", "\"", "does", "not", "exist", "\"", ");", "schemaSources", "[", "i", "]", "=", "new", "ResourceSource", "(", "xmlReader", ",", "resources", "[", "i", "]", ");", "}", "SchemaFactory", "schemaFactory", "=", "SchemaFactory", ".", "newInstance", "(", "schemaLanguage", ")", ";", "SchemaFactory", "schemaFactory", "=", "SchemaFactoryUtils", ".", "newInstance", "(", "schemaLanguage", ")", ";", "return", "schemaFactory", ".", "newSchema", "(", "schemaSources", ")", ";", "}", "@", "@", "-", "87", ",", "4", "+", "86", ",", "5", "@", "@", "public", "static", "String", "getSystemId", "(", "Resource", "resource", ")", "{", "return", "null", ";", "}", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "43", "@", "@", "/", "*", "*", "Copyright", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ".", "validation", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "/", "**", "*", "@", "author", "Greg", "Turnquist", "*", "@", "since", "3", ".", "0", ".", "5", "*", "/", "public", "class", "XMLReaderFactoryUtils", "{", "/", "**", "*", "Build", "a", "{", "@", "link", "XMLReader", "}", "and", "set", "properties", "to", "prevent", "external", "entity", "access", ".", "*", "*", "@", "see", "XMLReaderFactory", "#", "createXMLReader", "(", ")", "*", "/", "public", "static", "XMLReader", "createXMLReader", "(", ")", "throws", "SAXException", "{", "XMLReader", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "\"", ",", "false", ")", ";", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "false", ")", ";", "return", "xmlReader", ";", "}", "}", "@", "@", "-", "19", ",", "13", "+", "19", ",", "13", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Validator", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "JaxpVersion", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "/", "**", "*", "Factory", "for", "{", "@", "link", "XmlValidator", "}", "objects", ",", "being", "aware", "of", "JAXP", "1", ".", "3", "{", "@", "link", "Validator", "}", "s", ",", "and", "JAXP", "1", ".", "0", "parsing", "*", "capabilities", ".", "Mainly", "for", "internal", "use", "within", "the", "framework", ".", "@", "@", "-", "84", ",", "10", "+", "84", ",", "15", "@", "@", "public", "static", "XmlValidator", "createValidator", "(", "Resource", "[", "]", "schemaResources", ",", "String", "sc", "Assert", ".", "hasLength", "(", "schemaLanguage", ",", "\"", "No", "schema", "language", "provided", "\"", ");", "Assert", ".", "isTrue", "(", "SCHEMA_W3C_XML", ".", "equals", "(", "schemaLanguage", ")", "|", "|", "SCHEMA_RELAX_NG", ".", "equals", "(", "schemaLanguage", ")", ",", "\"", "Invalid", "schema", "language", ":", "\"", "+", "schemaLanguage", ")", ";", "Assert", ".", "noNullElements", "(", "schemaResources", ",", "\"", "No", "null", "schemaResources", "allowed", "\"", ");", "for", "(", "Resource", "schemaResource", ":", "schemaResources", ")", "{", "Assert", ".", "isTrue", "(", "schemaResource", ".", "exists", "(", "),", "\"", "schema", "[", "\"", "+", "schemaResource", "+", "\"", "]", "does", "not", "exist", "\"", ");", "}", "if", "(", "JaxpVersion", ".", "getJaxpVersion", "(", ")", ">", "=", "JaxpVersion", ".", "JAXP_13", ")", "{", "if", "(", "JaxpVersion", ".", "getJaxpVersion", "(", ")", ">", "=", "JaxpVersion", ".", "JAXP_15", ")", "{", "logger", ".", "trace", "(", "\"", "Creating", "JAXP", "1", ".", "5", "XmlValidator", "\"", ");", "return", "Jaxp15ValidatorFactory", ".", "createValidator", "(", "schemaResources", ",", "schemaLanguage", ")", ";", "}", "else", "if", "(", "JaxpVersion", ".", "getJaxpVersion", "(", ")", ">", "=", "JaxpVersion", ".", "JAXP_13", ")", "{", "logger", ".", "trace", "(", "\"", "Creating", "JAXP", "1", ".", "3", "XmlValidator", "\"", ");", "return", "Jaxp13ValidatorFactory", ".", "createValidator", "(", "schemaResources", ",", "schemaLanguage", ")", ";", "}", "@", "@", "-", "31", ",", "6", "+", "31", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "InitializingBean", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "validation", ".", "XmlValidator", ";", "import", "org", ".", "springframework", ".", "xml", ".", "validation", ".", "XmlValidatorFactory", ";", "@", "@", "-", "48", ",", "7", "+", "49", ",", "7", "@", "@", "*", "/", "public", "class", "SimpleXsdSchema", "implements", "XsdSchema", ",", "InitializingBean", "{", "private", "static", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "private", "static", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "private", "static", "final", "String", "SCHEMA_NAMESPACE", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "\"", ";", "@", "@", "-", "28", ",", "6", "+", "28", ",", "8", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "public", "class", "DomContentHandlerTest", "{", "@", "@", "-", "55", ",", "7", "+", "57", ",", "7", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "result", "=", "documentBuilder", ".", "newDocument", "(", ");", "@", "@", "-", "20", ",", "13", "+", "20", ",", "14", "@", "@", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "class", "QNameUtilsTest", "{", "@", "Test", "@", "@", "-", "45", ",", "7", "+", "46", ",", "7", "@", "@", "public", "void", "testInvalidQNames", "(", ")", "{", "@", "Test", "public", "void", "testGetQNameForNodeNoNamespace", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "builder", ".", "newDocument", "(", ");", "Element", "element", "=", "document", ".", "createElement", "(", "\"", "localname", "\"", ");", "@", "@", "-", "59", ",", "7", "+", "60", ",", "7", "@", "@", "public", "void", "testGetQNameForNodeNoNamespace", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testGetQNameForNodeNoPrefix", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "builder", ".", "newDocument", "(", ");", "Element", "element", "=", "document", ".", "createElementNS", "(", "\"", "namespace", "\"", ",", "\"", "localname", "\"", ");", "@", "@", "-", "72", ",", "7", "+", "73", ",", "7", "@", "@", "public", "void", "testGetQNameForNodeNoPrefix", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testGetQNameForNode", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "builder", ".", "newDocument", "(", ");", "Element", "element", "=", "document", ".", "createElementNS", "(", "\"", "namespace", "\"", ",", "\"", "prefix", ":", "localname", "\"", ");", "@", "@", "-", "17", ",", "20", "+", "17", ",", "19", "@", "@", "package", "org", ".", "springframework", ".", "xml", ".", "transform", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "public", "class", "ResourceSourceTest", "{", "@", "Test", "public", "void", "testStringSource", "(", ")", "throws", "Exception", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "DOMResult", "result", "=", "new", "DOMResult", "(", ");", "ResourceSource", "source", "=", "new", "ResourceSource", "(", "new", "ClassPathResource", "(", "\"", "resourceSource", ".", "xml", "\"", ",", "getClass", "(", "))", ");", "transformer", ".", "transform", "(", "source", ",", "result", ")", ";", "@", "@", "-", "16", ",", "25", "+", "16", ",", "25", "@", "@", "package", "org", ".", "springframework", ".", "xml", ".", "transform", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Element", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "StringResultTest", "{", "@", "Test", "public", "void", "testStringResult", "(", ")", "throws", "Exception", "{", "Document", "document", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ").", "newDocumentBuilder", "(", ").", "newDocument", "(", ");", "Document", "document", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ").", "newDocumentBuilder", "(", ").", "newDocument", "(", ");", "Element", "element", "=", "document", ".", "createElementNS", "(", "\"", "namespace", "\"", ",", "\"", "prefix", ":", "localName", "\"", ");", "document", ".", "appendChild", "(", "element", ")", ";", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "StringResult", "result", "=", "new", "StringResult", "(", ");", "transformer", ".", "transform", "(", "new", "DOMSource", "(", "document", ")", ",", "result", ")", ";", "assertXMLEqual", "(", "\"", "Invalid", "result", "\"", ",", "\"", "<", "prefix", ":", "localName", "xmlns", ":", "prefix", "=", "'", "namespace", "'", "/>", "\",", "result", ".", "toString", "(", "))", ";", "@", "@", "-", "29", ",", "7", "+", "29", ",", "7", "@", "@", "@", "Test", "public", "void", "testStringSource", "(", ")", "throws", "TransformerException", "{", "Transformer", "transformer", "=", "TransformerFactory", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "Transformer", "transformer", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ").", "newTransformer", "(", ");", "String", "content", "=", "\"", "<", "prefix", ":", "content", "xmlns", ":", "prefix", "=", "'", "namespace", "'", "/>", "\";", "DOMResult", "result", "=", "new", "DOMResult", "(", ");", "transformer", ".", "transform", "(", "new", "StringSource", "(", "content", ")", ",", "result", ")", ";", "@", "@", "-", "41", ",", "8", "+", "41", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "@", "@", "-", "55", ",", "13", "+", "53", ",", "17", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "DefaultHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "XMLReaderFactory", ";", "import", "org", ".", "springframework", ".", "util", ".", "xml", ".", "StaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "XMLInputFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "*;", "public", "class", "TraxUtilsTest", "{", "@", "Test", "public", "void", "testGetDocument", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "@", "@", "-", "73", ",", "7", "+", "75", ",", "7", "@", "@", "public", "void", "testGetDocument", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDoWithDomSource", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "@", "@", "-", "89", ",", "7", "+", "91", ",", "7", "@", "@", "public", "void", "testDoWithDomSource", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDoWithDomResult", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "@", "@", "-", "137", ",", "7", "+", "139", ",", "7", "@", "@", "public", "void", "testDoWithSaxResult", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDoWithStaxSourceEventReader", "(", ")", "throws", "Exception", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLEventReader", "eventReader", "=", "inputFactory", ".", "createXMLEventReader", "(", "new", "StringReader", "(", "\"<", "element", "/", ">\"", "))", ";", "TraxUtils", ".", "SourceCallback", "mock", "=", "createMock", "(", "TraxUtils", ".", "SourceCallback", ".", "class", ")", ";", "@", "@", "-", "167", ",", "7", "+", "169", ",", "7", "@", "@", "public", "void", "testDoWithStaxResultEventWriter", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDoWithStaxSourceStreamReader", "(", ")", "throws", "Exception", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "inputFactory", "=", "XMLInputFactoryUtils", ".", "newInstance", "(", ");", "XMLStreamReader", "streamReader", "=", "inputFactory", ".", "createXMLStreamReader", "(", "new", "StringReader", "(", "\"<", "element", "/", ">\"", "))", ";", "TraxUtils", ".", "SourceCallback", "mock", "=", "createMock", "(", "TraxUtils", ".", "SourceCallback", ".", "class", ")", ";", "@", "@", "-", "23", ",", "10", "+", "23", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "36", ",", "6", "+", "32", ",", "11", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "abstract", "class", "AbstractValidatorFactoryTestCase", "{", "private", "XmlValidator", "validator", ";", "@", "@", "-", "98", ",", "7", "+", "99", ",", "7", "@", "@", "public", "void", "testHandleInvalidMessageSax", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testHandleValidMessageDom", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "Document", "document", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ")", ".", "parse", "(", "new", "InputSource", "(", "validInputStream", ")", ");", "@", "@", "-", "109", ",", "7", "+", "110", ",", "7", "@", "@", "public", "void", "testHandleValidMessageDom", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testHandleInvalidMessageDom", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "Document", "document", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ")", ".", "parse", "(", "new", "InputSource", "(", "invalidInputStream", ")", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "/", "*", "*", "Copyright", "2005", "-", "2010", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "xml", ".", "validation", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "public", "class", "Jaxp15ValidatorFactoryTest", "extends", "AbstractValidatorFactoryTestCase", "{", "@", "Override", "protected", "XmlValidator", "createValidator", "(", "Resource", "[", "]", "schemaResources", ",", "String", "schemaLanguage", ")", "throws", "IOException", "{", "return", "Jaxp15ValidatorFactory", ".", "createValidator", "(", "schemaResources", ",", "schemaLanguage", ")", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "33", ",", "6", "+", "33", ",", "7", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "public", "abstract", "class", "AbstractXPathExpressionFactoryTestCase", "{", "@", "@", "-", "46", ",", "7", "+", "47", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "namespaces", ".", "put", "(", "\"", "prefix1", "\"", ",", "\"", "namespace1", "\"", ");", "namespaces", ".", "put", "(", "\"", "prefix2", "\"", ",", "\"", "namespace2", "\"", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "InputStream", "inputStream", "=", "getClass", "(", ").", "getResourceAsStream", "(", "\"", "nonamespaces", ".", "xml", "\"", ");", "@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "ResourceSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "128", ",", "7", "+", "129", ",", "7", "@", "@", "public", "void", "testEvaluateAsString", "(", ")", "throws", "IOException", ",", "SAXException", "{", "@", "Test", "public", "void", "testEvaluateDomSource", "(", ")", "throws", "IOException", ",", "SAXException", ",", "ParserConfigurationException", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "documentBuilder", ".", "parse", "(", "SaxUtils", ".", "createInputSource", "(", "@", "@", "-", "22", ",", "18", "+", "22", ",", "20", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "validation", ".", "XmlValidator", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "validation", ".", "XmlValidator", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "abstract", "class", "AbstractXsdSchemaTestCase", "{", "@", "@", "-", "43", ",", "10", "+", "45", ",", "10", "@", "@", "@", "Before", "public", "final", "void", "setUp", "(", ")", "throws", "Exception", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "XMLUnit", ".", "setIgnoreWhitespace", "(", "true", ")", ";", "}", "@", "@", "-", "22", ",", "20", "+", "22", ",", "22", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "sax", ".", "SaxUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "validation", ".", "XmlValidator", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "AbstractXsdSchemaTestCase", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xsd", ".", "XsdSchema", ";", "import", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLUnit", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "assertXMLEqual", ";", "import", "static", "org", ".", "custommonkey", ".", "xmlunit", ".", "XMLAssert", ".", "*;", "public", "class", "CommonsXsdSchemaCollectionTest", "{", "@", "@", "-", "48", ",", "9", "+", "50", ",", "9", "@", "@", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "collection", "=", "new", "CommonsXsdSchemaCollection", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "TransformerFactory", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "XMLUnit", ".", "setIgnoreWhitespace", "(", "true", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["Fixed", "bug", "#67329", "fileinfo:", "NULL", "pointer", "deference", "flaw", "by", "processing", "certain", "CDF", "files"], "code_tokens": ["@", "@", "-", "16", ",", "6", "+", "16", ",", "8", "@", "@", "PHP", "NEWS", ".", "Fixed", "bug", "#", "67328", "(", "fileinfo", ":", "fileinfo", ":", "numerous", "file_printf", "calls", "resulting", "in", "performance", "degradation", ")", ".", ".", "Fixed", "bug", "#", "67326", "(", "fileinfo", ":", "cdf_read_short_sector", "insufficient", "boundary", "check", ")", ".", ".", "Fixed", "bug", "#", "67329", "(", "fileinfo", ":", "NULL", "pointer", "deference", "flaw", "by", "processing", "certain", "CDF", "files", ")", ".", "-", "SPL", ":", ".", "Fixed", "bug", "#", "67359", "(", "Segfault", "in", "recursiveDirectoryIterator", ")", ".", "(", "Laruence", ")", "@", "@", "-", "35", ",", "7", "+", "35", ",", "7", "@", "@", "#", "include", "\"", "file", ".", "h", "\"", "#", "ifndef", "lint", "FILE_RCSID", "(", "\"@", "(#", ")$", "File", ":", "cdf", ".", "c", ",", "v", "1", ".", "53", "2013", "/", "02", "/", "26", "16", ":", "20", ":", "42", "christos", "Exp", "$", "\")", "FILE_RCSID", "(", "\"@", "(#", ")$", "File", ":", "cdf", ".", "c", ",", "v", "1", ".", "55", "2014", "/", "02", "/", "27", "23", ":", "26", ":", "17", "christos", "Exp", "$", "\")", "#", "endif", "#", "include", "<", "assert", ".", "h", ">", "@", "@", "-", "688", ",", "11", "+", "688", ",", "13", "@", "@", "cdf_read_ssat", "(", "const", "cdf_info_t", "*", "info", ",", "const", "cdf_header_t", "*", "h", ",", "int", "cdf_read_short_stream", "(", "const", "cdf_info_t", "*", "info", ",", "const", "cdf_header_t", "*", "h", ",", "const", "cdf_sat_t", "*", "sat", ",", "const", "cdf_dir_t", "*", "dir", ",", "cdf_stream_t", "*", "scn", ")", "const", "cdf_sat_t", "*", "sat", ",", "const", "cdf_dir_t", "*", "dir", ",", "cdf_stream_t", "*", "scn", ",", "const", "cdf_directory_t", "*", "*", "root", ")", "{", "size_t", "i", ";", "const", "cdf_directory_t", "*", "d", ";", "*", "root", "=", "NULL", ";", "for", "(", "i", "=", "0", ";", "i", "<", "dir", "-", ">", "dir_len", ";", "i", "+", "+)", "if", "(", "dir", "-", ">", "dir_tab", "[", "i", "]", ".", "d_type", "=", "=", "CDF_DIR_TYPE_ROOT_STORAGE", ")", "break", ";", "@", "@", "-", "701", ",", "6", "+", "703", ",", "7", "@", "@", "cdf_read_short_stream", "(", "const", "cdf_info_t", "*", "info", ",", "const", "cdf_header_t", "*", "h", ",", "if", "(", "i", "=", "=", "dir", "-", ">", "dir_len", ")", "goto", "out", ";", "d", "=", "&", "dir", "-", ">", "dir_tab", "[", "i", "]", ";", "*", "root", "=", "d", ";", "/", "*", "If", "the", "it", "is", "not", "there", ",", "just", "fake", "it", ";", "some", "docs", "don", "'", "t", "have", "it", "*", "/", "if", "(", "d", "-", ">", "d_stream_first_sector", "<", "0", ")", "@", "@", "-", "300", ",", "7", "+", "300", ",", "8", "@", "@", "int", "cdf_read_dir", "(", "const", "cdf_info_t", "*", ",", "const", "cdf_header_t", "*", ",", "const", "cdf_sat_t", "*", ",", "int", "cdf_read_ssat", "(", "const", "cdf_info_t", "*", ",", "const", "cdf_header_t", "*", ",", "const", "cdf_sat_t", "*", ",", "cdf_sat_t", "*", ");", "int", "cdf_read_short_stream", "(", "const", "cdf_info_t", "*", ",", "const", "cdf_header_t", "*", ",", "const", "cdf_sat_t", "*", ",", "const", "cdf_dir_t", "*", ",", "cdf_stream_t", "*", ");", "const", "cdf_sat_t", "*", ",", "const", "cdf_dir_t", "*", ",", "cdf_stream_t", "*", ",", "const", "cdf_directory_t", "*", "*)", ";", "int", "cdf_read_property_info", "(", "const", "cdf_stream_t", "*", ",", "const", "cdf_header_t", "*", ",", "uint32_t", ",", "cdf_property_info_t", "*", "*,", "size_t", "*", ",", "size_t", "*", ");", "int", "cdf_read_summary_info", "(", "const", "cdf_info_t", "*", ",", "const", "cdf_header_t", "*", ",", "@", "@", "-", "26", ",", "7", "+", "26", ",", "7", "@", "@", "#", "include", "\"", "file", ".", "h", "\"", "#", "ifndef", "lint", "FILE_RCSID", "(", "\"@", "(#", ")$", "File", ":", "readcdf", ".", "c", ",", "v", "1", ".", "37", "2014", "/", "01", "/", "06", "13", ":", "41", ":", "18", "rrt", "Exp", "$", "\")", "FILE_RCSID", "(", "\"@", "(#", ")$", "File", ":", "readcdf", ".", "c", ",", "v", "1", ".", "40", "2014", "/", "03", "/", "06", "15", ":", "23", ":", "33", "christos", "Exp", "$", "\")", "#", "endif", "#", "include", "<", "stdlib", ".", "h", ">", "@", "@", "-", "77", ",", "6", "+", "77", ",", "40", "@", "@", "static", "const", "struct", "nv", "{", "#", "define", "strcasestr", "strstr", "#", "endif", "static", "const", "struct", "cv", "{", "uint64_t", "clsid", "[", "2", "]", ";", "const", "char", "*", "mime", ";", "}", "clsid2mime", "[", "]", "=", "{", "{", "#", "ifdef", "PHP_WIN32", "{", "0x00000000000c1084ui64", ",", "0x46000000000000c0ui64", "}", ",", "#", "else", "{", "0x00000000000c1084LLU", ",", "0x46000000000000c0LLU", "}", ",", "#", "endif", "\"", "x", "-", "msi", "\"", ",", "}", "}", ",", "clsid2desc", "[", "]", "=", "{", "{", "#", "ifdef", "PHP_WIN32", "{", "0x00000000000c1084ui64", ",", "0x46000000000000c0ui64", "}", ",", "#", "else", "{", "0x00000000000c1084LLU", ",", "0x46000000000000c0LLU", "}", ",", "#", "endif", "\"", "MSI", "Installer", "\"", ",", "}", ",", "}", ";", "private", "const", "char", "*", "cdf_clsid_to_mime", "(", "const", "uint64_t", "clsid", "[", "2", "]", ",", "const", "struct", "cv", "*", "cv", ")", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "cv", "[", "i", "]", ".", "mime", "!", "=", "NULL", ";", "i", "+", "+)", "{", "if", "(", "clsid", "[", "0", "]", "=", "=", "cv", "[", "i", "]", ".", "clsid", "[", "0", "]", "&", "&", "clsid", "[", "1", "]", "=", "=", "cv", "[", "i", "]", ".", "clsid", "[", "1", "]", ")", "return", "cv", "[", "i", "]", ".", "mime", ";", "}", "return", "NULL", ";", "}", "private", "const", "char", "*", "cdf_app_to_mime", "(", "const", "char", "*", "vbuf", ",", "const", "struct", "nv", "*", "nv", ")", "{", "@", "@", "-", "95", ",", "7", "+", "129", ",", "7", "@", "@", "cdf_app_to_mime", "(", "const", "char", "*", "vbuf", ",", "const", "struct", "nv", "*", "nv", ")", "private", "int", "cdf_file_property_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_property_info_t", "*", "info", ",", "size_t", "count", ")", "size_t", "count", ",", "const", "cdf_directory_t", "*", "root_storage", ")", "{", "size_t", "i", ";", "cdf_timestamp_t", "tp", ";", "@", "@", "-", "107", ",", "6", "+", "141", ",", "9", "@", "@", "cdf_file_property_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_property_info_t", "*", "info", ",", "memset", "(", "&", "ts", ",", "0", ",", "sizeof", "(", "ts", ")", ");", "if", "(", "!", "NOTMIME", "(", "ms", ")", "&", "&", "root_storage", ")", "str", "=", "cdf_clsid_to_mime", "(", "root_storage", "-", ">", "d_storage_uuid", ",", "clsid2mime", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+)", "{", "cdf_print_property_name", "(", "buf", ",", "sizeof", "(", "buf", ")", ",", "info", "[", "i", "]", ".", "pi_id", ")", ";", "switch", "(", "info", "[", "i", "]", ".", "pi_type", ")", "{", "@", "@", "-", "163", ",", "7", "+", "200", ",", "7", "@", "@", "cdf_file_property_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_property_info_t", "*", "info", ",", "buf", ",", "vbuf", ")", "=", "=", "-", "1", ")", "return", "-", "1", ";", "}", "}", "else", "if", "(", "info", "[", "i", "]", ".", "pi_id", "=", "=", "}", "else", "if", "(", "str", "=", "=", "NULL", "&", "&", "info", "[", "i", "]", ".", "pi_id", "=", "=", "CDF_PROPERTY_NAME_OF_APPLICATION", ")", "{", "str", "=", "cdf_app_to_mime", "(", "vbuf", ",", "app2mime", ")", ";", "}", "@", "@", "-", "217", ",", "7", "+", "254", ",", "7", "@", "@", "cdf_file_property_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_property_info_t", "*", "info", ",", "private", "int", "cdf_file_summary_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_header_t", "*", "h", ",", "const", "cdf_stream_t", "*", "sst", ")", "const", "cdf_stream_t", "*", "sst", ",", "const", "cdf_directory_t", "*", "root_storage", ")", "{", "cdf_summary_info_header_t", "si", ";", "cdf_property_info_t", "*", "info", ";", "@", "@", "-", "228", ",", "6", "+", "265", ",", "8", "@", "@", "cdf_file_summary_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_header_t", "*", "h", ",", "return", "-", "1", ";", "if", "(", "NOTMIME", "(", "ms", ")", ")", "{", "const", "char", "*", "str", ";", "if", "(", "file_printf", "(", "ms", ",", "\"", "Composite", "Document", "File", "V2", "Document", "\"", ")", "=", "=", "-", "1", ")", "return", "-", "1", ";", "@", "@", "-", "255", ",", "9", "+", "294", ",", "15", "@", "@", "cdf_file_summary_info", "(", "struct", "magic_set", "*", "ms", ",", "const", "cdf_header_t", "*", "h", ",", "return", "-", "2", ";", "break", ";", "}", "}", "if", "(", "root_storage", ")", "{", "str", "=", "cdf_clsid_to_mime", "(", "root_storage", "-", ">", "d_storage_uuid", ",", "clsid2desc", ")", ";", "if", "(", "str", ")", "if", "(", "file_printf", "(", "ms", ",", "\"", ",", "%", "s", "\"", ",", "str", ")", "=", "=", "-", "1", ")", "return", "-", "2", ";", "}", "}", "m", "=", "cdf_file_property_info", "(", "ms", ",", "info", ",", "count", ")", ";", "m", "=", "cdf_file_property_info", "(", "ms", ",", "info", ",", "count", ",", "root_storage", ")", ";", "free", "(", "info", ")", ";", "return", "m", "=", "=", "-", "1", "?", "-", "2", ":", "m", ";", "@", "@", "-", "275", ",", "6", "+", "320", ",", "7", "@", "@", "file_trycdf", "(", "struct", "magic_set", "*", "ms", ",", "int", "fd", ",", "const", "unsigned", "char", "*", "buf", ",", "int", "i", ";", "const", "char", "*", "expn", "=", "\"", "\";", "const", "char", "*", "corrupt", "=", "\"", "corrupt", ":", "\"", ";", "const", "cdf_directory_t", "*", "root_storage", ";", "info", ".", "i_fd", "=", "fd", ";", "info", ".", "i_buf", "=", "buf", ";", "@", "@", "-", "308", ",", "7", "+", "354", ",", "8", "@", "@", "file_trycdf", "(", "struct", "magic_set", "*", "ms", ",", "int", "fd", ",", "const", "unsigned", "char", "*", "buf", ",", "goto", "out2", ";", "}", "if", "(", "(", "i", "=", "cdf_read_short_stream", "(", "&", "info", ",", "&", "h", ",", "&", "sat", ",", "&", "dir", ",", "&", "sst", ")", ")", "=", "=", "-", "1", ")", "{", "if", "(", "(", "i", "=", "cdf_read_short_stream", "(", "&", "info", ",", "&", "h", ",", "&", "sat", ",", "&", "dir", ",", "&", "sst", ",", "&", "root_storage", ")", ")", "=", "=", "-", "1", ")", "{", "expn", "=", "\"", "Cannot", "read", "short", "stream", "\"", ";", "goto", "out3", ";", "}", "@", "@", "-", "329", ",", "23", "+", "376", ",", "21", "@", "@", "file_trycdf", "(", "struct", "magic_set", "*", "ms", ",", "int", "fd", ",", "const", "unsigned", "char", "*", "buf", ",", "#", "ifdef", "CDF_DEBUG", "cdf_dump_summary_info", "(", "&", "h", ",", "&", "scn", ")", ";", "#", "endif", "if", "(", "(", "i", "=", "cdf_file_summary_info", "(", "ms", ",", "&", "h", ",", "&", "scn", ")", ")", "<", "0", ")", "expn", "=", "\"", "Can", "'", "t", "expand", "summary_info", "\"", ";", "if", "(", "(", "i", "=", "cdf_file_summary_info", "(", "ms", ",", "&", "h", ",", "&", "scn", ",", "root_storage", ")", ")", "<", "0", ")", "expn", "=", "\"", "Can", "'", "t", "expand", "summary_info", "\"", ";", "if", "(", "i", "=", "=", "0", ")", "{", "const", "char", "*", "str", "=", "NULL", ";", "cdf_directory_t", "*", "d", ";", "char", "name", "[", "__arraycount", "(", "d", "-", ">", "d_name", ")", "];", "size_t", "j", ",", "k", ";", "for", "(", "j", "=", "0", ";", "j", "<", "dir", ".", "dir_len", ";", "j", "+", "+)", "{", "for", "(", "j", "=", "0", ";", "str", "=", "=", "NULL", "&", "&", "j", "<", "dir", ".", "dir_len", ";", "j", "+", "+)", "{", "d", "=", "&", "dir", ".", "dir_tab", "[", "j", "]", ";", "for", "(", "k", "=", "0", ";", "k", "<", "sizeof", "(", "name", ")", ";", "k", "+", "+)", "name", "[", "k", "]", "=", "(", "char", ")", "cdf_tole2", "(", "d", "-", ">", "d_name", "[", "k", "]", ");", "if", "(", "NOTMIME", "(", "ms", ")", ")", "str", "=", "cdf_app_to_mime", "(", "name", ",", "name2desc", ")", ";", "else", "str", "=", "cdf_app_to_mime", "(", "name", ",", "name2mime", ")", ";", "if", "(", "str", "!", "=", "NULL", ")", "break", ";", "str", "=", "cdf_app_to_mime", "(", "name", ",", "NOTMIME", "(", "ms", ")", "?", "name2desc", ":", "name2mime", ")", ";", "}", "if", "(", "NOTMIME", "(", "ms", ")", ")", "{", "if", "(", "str", "!", "=", "NULL", ")", "{"], "docstring_tokens": ["via", "a", "zero", "root_storage", "value", "in", "a", "CDF", "file"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/148"], "code_tokens": ["@", "@", "-", "2542", ",", "9", "+", "2542", ",", "12", "@", "@", "static", "void", "RemoveICCProfileFromResourceBlock", "(", "StringInfo", "*", "bim_profile", ")", "p", "=", "PushLongPixel", "(", "MSBEndian", ",", "p", ",", "&", "count", ")", ";", "if", "(", "id", "=", "=", "0x0000040f", ")", "{", "(", "void", ")", "CopyMagickMemory", "(", "q", ",", "q", "+", "PSDQuantum", "(", "count", ")", "+", "12", ",", "length", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", "-(", "q", "-", "datum", ")", ");", "SetStringInfoLength", "(", "bim_profile", ",", "length", "-", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", ");", "if", "(", "(", "q", "+", "PSDQuantum", "(", "count", ")", "+", "12", ")", "<", "(", "datum", "+", "length", "-", "16", ")", ")", "{", "(", "void", ")", "CopyMagickMemory", "(", "q", ",", "q", "+", "PSDQuantum", "(", "count", ")", "+", "12", ",", "length", "-", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", "-(", "q", "-", "datum", ")", ");", "SetStringInfoLength", "(", "bim_profile", ",", "length", "-", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", ");", "}", "break", ";", "}", "p", "+", "=", "count", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially", "crafted", "file"]}
{"contents": ["HV-912", "Wrapping", "call", "to", "SchemaFactory#newSchema()", "into", "privileged", "action"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "50", "@", "@", "/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", "*", "Copyright", "2010", ",", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", ",", "and", "individual", "contributors", "*", "by", "the", "@", "authors", "tag", ".", "See", "the", "copyright", ".", "txt", "in", "the", "distribution", "for", "a", "*", "full", "listing", "of", "individual", "contributors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "/", "**", "*", "Loads", "a", "given", "XML", "schema", ".", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "final", "class", "NewSchema", "implements", "PrivilegedExceptionAction", "<", "Schema", ">", "{", "private", "final", "SchemaFactory", "schemaFactory", ";", "private", "final", "URL", "url", ";", "public", "static", "NewSchema", "action", "(", "SchemaFactory", "schemaFactory", ",", "URL", "url", ")", "{", "return", "new", "NewSchema", "(", "schemaFactory", ",", "url", ")", ";", "}", "public", "NewSchema", "(", "SchemaFactory", "schemaFactory", ",", "URL", "url", ")", "{", "this", ".", "schemaFactory", "=", "schemaFactory", ";", "this", ".", "url", "=", "url", ";", "}", "@", "Override", "public", "Schema", "run", "(", ")", "throws", "SAXException", "{", "return", "schemaFactory", ".", "newSchema", "(", "url", ")", ";", "}", "}", "@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "@", "@", "-", "34", ",", "12", "+", "35", ",", "12", "@", "@", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "Contracts", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetClassLoader", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetResource", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewSchema", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Messages", ".", "MESSAGES", ";", "@", "@", "-", "137", ",", "6", "+", "138", ",", "14", "@", "@", "private", "synchronized", "XMLEventReader", "createXmlEventReader", "(", "InputStream", "xmlStream", ")", "return", "xmlInputFactory", ".", "createXMLEventReader", "(", "xmlStream", ")", ";", "}", "/", "**", "*", "Returns", "the", "XML", "schema", "identified", "by", "the", "given", "resource", "name", ".", "*", "*", "@", "param", "schemaResource", "*", "the", "resource", "name", "identifying", "the", "schema", ".", "*", "@", "return", "the", "schema", "identified", "by", "the", "given", "resource", "name", "or", "{", "@", "code", "null", "}", "if", "the", "resource", "was", "not", "found", "or", "could", "*", "not", "be", "loaded", ".", "*", "/", "public", "Schema", "getSchema", "(", "String", "schemaResource", ")", "{", "Schema", "schema", "=", "schemaCache", ".", "get", "(", "schemaResource", ")", ";", "@", "@", "-", "145", ",", "9", "+", "154", ",", "14", "@", "@", "public", "Schema", "getSchema", "(", "String", "schemaResource", ")", "{", "}", "schema", "=", "loadSchema", "(", "schemaResource", ")", ";", "Schema", "previous", "=", "schemaCache", ".", "putIfAbsent", "(", "schemaResource", ",", "schema", ")", ";", "return", "previous", "!", "=", "null", "?", "previous", ":", "schema", ";", "if", "(", "schema", "!", "=", "null", ")", "{", "Schema", "previous", "=", "schemaCache", ".", "putIfAbsent", "(", "schemaResource", ",", "schema", ")", ";", "return", "previous", "!", "=", "null", "?", "previous", ":", "schema", ";", "}", "else", "{", "return", "null", ";", "}", "}", "private", "Schema", "loadSchema", "(", "String", "schemaResource", ")", "{", "@", "@", "-", "157", ",", "9", "+", "171", ",", "9", "@", "@", "private", "Schema", "loadSchema", "(", "String", "schemaResource", ")", "{", "SchemaFactory", "sf", "=", "SchemaFactory", ".", "newInstance", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "W3C_XML_SCHEMA_NS_URI", ")", ";", "Schema", "schema", "=", "null", ";", "try", "{", "schema", "=", "sf", ".", "newSchema", "(", "schemaUrl", ")", ";", "schema", "=", "run", "(", "NewSchema", ".", "action", "(", "sf", ",", "schemaUrl", ")", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "catch", "(", "Exception", "e", ")", "{", "log", ".", "unableToCreateSchema", "(", "schemaResource", ",", "e", ".", "getMessage", "(", ")", ")", ";", "}", "return", "schema", ";", "@", "@", "-", "174", ",", "4", "+", "188", ",", "8", "@", "@", "private", "Schema", "loadSchema", "(", "String", "schemaResource", ")", "{", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "private", "<", "T", ">", "T", "run", "(", "PrivilegedExceptionAction", "<", "T", ">", "action", ")", "throws", "Exception", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "}"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Fix", "SECURITY-723", "-", "info", "disclosure", "over", "http", "Prior", "to", "this", "change,", "the", "/git/search/", "URL", "responded", "to", "queries", "for", "user", "name", "information", "with", "the", "user", "names", "of", "system", "users", "which", "match", "the", "query", "parameters,", "even", "if", "the", "query", "is", "not", "authenticated.", "This", "removes", "the", "ability", "to", "search", "through", "the", "/git/search/", "URL.", "The", "/git/search/", "URL", "is", "an", "accident", "of", "implementation", "from", "the", "2011", "addition", "of", "the", "GitStatus", "object."], "code_tokens": ["@", "@", "-", "16", ",", "7", "+", "16", ",", "7", "@", "@", "<", "/", "licenses", ">", "<", "artifactId", ">", "git", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "7", ".", "1", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "version", ">", "3", ".", "8", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "packaging", ">", "hpi", "<", "/", "packaging", ">", "<", "name", ">", "Jenkins", "Git", "plugin", "<", "/", "name", ">", "<", "description", ">", "Integrates", "Jenkins", "with", "GIT", "SCM", "<", "/", "description", ">", "@", "@", "-", "39", ",", "18", "+", "39", ",", "12", "@", "@", "*", "Information", "screen", "for", "the", "use", "of", "Git", "in", "Hudson", ".", "*", "/", "@", "Extension", "public", "class", "GitStatus", "extends", "AbstractModelObject", "implements", "UnprotectedRootAction", "{", "public", "class", "GitStatus", "implements", "UnprotectedRootAction", "{", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "\"", "Git", "\"", ";", "}", "@", "Override", "public", "String", "getSearchUrl", "(", ")", "{", "return", "getUrlName", "(", ");", "}", "@", "Override", "public", "String", "getIconFileName", "(", ")", "{", "/", "/", "TODO", "return", "null", ";", "@", "@", "-", "65", ",", "12", "+", "65", ",", "6", "@", "@", "public", "void", "testGetDisplayName", "(", ")", "{", "assertEquals", "(", "\"", "Git", "\"", ",", "this", ".", "gitStatus", ".", "getDisplayName", "(", "))", ";", "}", "@", "WithoutJenkins", "@", "Test", "public", "void", "testGetSearchUrl", "(", ")", "{", "assertEquals", "(", "\"", "git", "\"", ",", "this", ".", "gitStatus", ".", "getSearchUrl", "(", "))", ";", "}", "@", "WithoutJenkins", "@", "Test", "public", "void", "testGetIconFileName", "(", ")", "{"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Disable", "rsh/ssh", "functionality", "in", "imap", "by", "default", "(bug", "#77153)"], "code_tokens": ["@", "@", "-", "9", ",", "6", "+", "9", ",", "10", "@", "@", "PHP", "NEWS", ".", "Fixed", "bug", "#", "77147", "(", "Fixing", "60494", "ignored", "ICONV_MIME_DECODE_CONTINUE_ON_ERROR", ")", ".", "(", "cmb", ")", "-", "IMAP", ":", ".", "Fixed", "bug", "#", "77153", "(", "imap_open", "allows", "to", "run", "arbitrary", "shell", "commands", "via", "mailbox", "parameter", ")", ".", "(", "Stas", ")", "-", "ODBC", ":", ".", "Fixed", "bug", "#", "77079", "(", "odbc_fetch_object", "has", "incorrect", "type", "signature", ")", ".", "(", "Jon", "Allen", ")", "@", "@", "-", "146", ",", "6", "+", "146", ",", "13", "@", "@", "PHP", "7", ".", "1", "UPGRADE", "NOTES", "aligned", ",", "which", "causes", "slightly", "different", "behavior", "than", "before", "for", "some", "pathological", "cases", ".", "-", "IMAP", ":", "Starting", "with", "7", ".", "1", ".", "25", ",", "rsh", "/", "ssh", "logins", "are", "disabled", "by", "default", ".", "Use", "imap", ".", "enable_insecure_rsh", "if", "you", "want", "to", "enable", "them", ".", "Note", "that", "the", "IMAP", "library", "does", "not", "filter", "mailbox", "names", "before", "passing", "them", "to", "rsh", "/", "ssh", "command", ",", "thus", "passing", "untrusted", "data", "to", "this", "function", "with", "rsh", "/", "ssh", "enabled", "is", "insecure", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "2", ".", "New", "Features", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "@", "@", "-", "562", ",", "6", "+", "562", ",", "15", "@", "@", "static", "const", "zend_module_dep", "imap_deps", "[", "]", "=", "{", "}", ";", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "PHP_INI", "*", "/", "PHP_INI_BEGIN", "(", ")", "STD_PHP_INI_BOOLEAN", "(", "\"", "imap", ".", "enable_insecure_rsh", "\"", ",", "\"", "0", "\"", ",", "PHP_INI_SYSTEM", ",", "OnUpdateBool", ",", "enable_rsh", ",", "zend_imap_globals", ",", "imap_globals", ")", "PHP_INI_END", "(", ")", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "imap_module_entry", "*", "/", "zend_module_entry", "imap_module_entry", "=", "{", "@", "@", "-", "832", ",", "6", "+", "841", ",", "8", "@", "@", "PHP_MINIT_FUNCTION", "(", "imap", ")", "{", "unsigned", "long", "sa_all", "=", "SA_MESSAGES", "|", "SA_RECENT", "|", "SA_UNSEEN", "|", "SA_UIDNEXT", "|", "SA_UIDVALIDITY", ";", "REGISTER_INI_ENTRIES", "(", ");", "#", "ifndef", "PHP_WIN32", "mail_link", "(", "&", "unixdriver", ")", ";", "/", "*", "link", "in", "the", "unix", "driver", "*", "/", "mail_link", "(", "&", "mhdriver", ")", ";", "/", "*", "link", "in", "the", "mh", "driver", "*", "/", "@", "@", "-", "1049", ",", "6", "+", "1060", ",", "12", "@", "@", "PHP_MINIT_FUNCTION", "(", "imap", ")", "GC_TEXTS", "texts", "*", "/", "if", "(", "!", "IMAPG", "(", "enable_rsh", ")", ")", "{", "/", "*", "disable", "SSH", "and", "RSH", ",", "see", "https", ":", "//", "bugs", ".", "php", ".", "net", "/", "bug", ".", "php", "?", "id", "=", "77153", "*", "/", "mail_parameters", "(", "NIL", ",", "SET_RSHTIMEOUT", ",", "0", ")", ";", "mail_parameters", "(", "NIL", ",", "SET_SSHTIMEOUT", ",", "0", ")", ";", "}", "le_imap", "=", "zend_register_list_destructors_ex", "(", "mail_close_it", ",", "NULL", ",", "\"", "imap", "\"", ",", "module_number", ")", ";", "return", "SUCCESS", ";", "}", "@", "@", "-", "216", ",", "6", "+", "216", ",", "7", "@", "@", "ZEND_BEGIN_MODULE_GLOBALS", "(", "imap", ")", "#", "endif", "/", "*", "php_stream", "for", "php_mail_gets", "(", ")", "*", "/", "php_stream", "*", "gets_stream", ";", "zend_bool", "enable_rsh", ";", "ZEND_END_MODULE_GLOBALS", "(", "imap", ")", "#", "ifdef", "ZTS", "@", "@", "-", "0", ",", "0", "+", "1", ",", "24", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "77153", "(", "imap_open", "allows", "to", "run", "arbitrary", "shell", "commands", "via", "mailbox", "parameter", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "imap", "\"", "))", "{", "die", "(", "\"", "skip", "imap", "extension", "not", "available", "\"", ");", "}", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "payload", "=", "\"", "echo", "'", "BUG", "'", ">", "\"", ".", "__DIR__", ".", "'", "/", "__bug", "'", ";", "$", "payloadb64", "=", "base64_encode", "(", "$", "payload", ")", ";", "$", "server", "=", "\"", "x", "-", "oProxyCommand", "=", "echo", "\\", "t", "$", "payloadb64", "|", "base64", "\\", "t", "-", "d", "|", "sh", "}", "\";", "@", "imap_open", "(", "'{", "'.", "$", "server", ".", "':", "143", "/", "imap", "}", "INBOX", "'", ",", "'", "',", "'", "')", ";", "/", "/", "clean", "imap_errors", "(", ");", "var_dump", "(", "file_exists", "(", "__DIR__", ".", "'", "/", "__bug", "'", "))", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "bool", "(", "false", ")", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "if", "(", "file_exists", "(", "__DIR__", ".", "'", "/", "__bug", "'", "))", "unlink", "(", "__DIR__", ".", "'", "/", "__bug", "'", ");", "?", ">", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["sending", "specially", "crafted", "data"]}
{"contents": ["Provide", "a", "mechanism", "that", "enables", "the", "container", "to", "check", "if", "a", "component", "(typically", "a", "web", "application)", "has", "been", "granted", "a", "given", "permission", "when", "running", "under", "a", "SecurityManager", "without", "the", "current", "execution", "stack", "having", "to", "have", "passed", "through", "the", "component.", "Use", "this", "new", "mechanism", "to", "extend", "SecurityManager", "protection", "to", "the", "system", "property", "replacement", "feature", "of", "the", "digester.", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk@1754727", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "80", ",", "6", "+", "80", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreCompat", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreVendor", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "res", ".", "StringManager", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "security", ".", "PermissionCheck", ";", "/", "**", "*", "Specialized", "web", "application", "class", "loader", ".", "@", "@", "-", "125", ",", "7", "+", "126", ",", "7", "@", "@", "*", "@", "author", "Craig", "R", ".", "McClanahan", "*", "/", "public", "abstract", "class", "WebappClassLoaderBase", "extends", "URLClassLoader", "implements", "Lifecycle", ",", "InstrumentableClassLoader", ",", "WebappProperties", "{", "implements", "Lifecycle", ",", "InstrumentableClassLoader", ",", "WebappProperties", ",", "PermissionCheck", "{", "private", "static", "final", "org", ".", "apache", ".", "juli", ".", "logging", ".", "Log", "log", "=", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ".", "getLog", "(", "WebappClassLoaderBase", ".", "class", ")", ";", "@", "@", "-", "1386", ",", "6", "+", "1387", ",", "24", "@", "@", "protected", "PermissionCollection", "getPermissions", "(", "CodeSource", "codeSource", ")", "{", "}", "@", "Override", "public", "boolean", "check", "(", "Permission", "permission", ")", "{", "if", "(", "!", "Globals", ".", "IS_SECURITY_ENABLED", ")", "{", "return", "true", ";", "}", "Policy", "currentPolicy", "=", "Policy", ".", "getPolicy", "(", ");", "if", "(", "currentPolicy", "!", "=", "null", ")", "{", "URL", "contextRootUrl", "=", "resources", ".", "getResource", "(", "\"/", "\")", ".", "getCodeBase", "(", ");", "CodeSource", "cs", "=", "new", "CodeSource", "(", "contextRootUrl", ",", "(", "Certificate", "[", "])", "null", ")", ";", "PermissionCollection", "pc", "=", "currentPolicy", ".", "getPermissions", "(", "cs", ")", ";", "if", "(", "pc", ".", "implies", "(", "permission", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "<", "p", ">", "@", "@", "-", "23", ",", "11", "+", "23", ",", "13", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "security", ".", "Permission", ";", "import", "java", ".", "util", ".", "EmptyStackException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "PropertyPermission", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "SAXParser", ";", "@", "@", "-", "37", ",", "6", "+", "39", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "ExceptionUtils", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "IntrospectionUtils", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "security", ".", "PermissionCheck", ";", "import", "org", ".", "xml", ".", "sax", ".", "Attributes", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "ErrorHandler", ";", "@", "@", "-", "78", ",", "6", "+", "81", ",", "13", "@", "@", "implements", "IntrospectionUtils", ".", "PropertySource", "{", "@", "Override", "public", "String", "getProperty", "(", "String", "key", ")", "{", "ClassLoader", "cl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "if", "(", "cl", "instanceof", "PermissionCheck", ")", "{", "Permission", "p", "=", "new", "PropertyPermission", "(", "key", ",", "\"", "read", "\"", ");", "if", "(", "!(", "(", "PermissionCheck", ")", "cl", ")", ".", "check", "(", "p", ")", ")", "{", "return", "null", ";", "}", "}", "return", "System", ".", "getProperty", "(", "key", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "43", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "security", ";", "import", "java", ".", "security", ".", "Permission", ";", "/", "**", "*", "This", "interface", "is", "implemented", "by", "components", "to", "enable", "privileged", "code", "to", "*", "check", "whether", "the", "component", "has", "a", "given", "permission", ".", "*", "This", "is", "typically", "used", "when", "a", "privileged", "component", "(", "e", ".", "g", ".", "the", "container", ")", "is", "*", "performing", "an", "action", "on", "behalf", "of", "an", "untrusted", "component", "(", "e", ".", "g", ".", "a", "web", "*", "application", ")", "without", "the", "current", "thread", "having", "passed", "through", "a", "code", "source", "*", "provided", "by", "the", "untrusted", "component", ".", "Because", "the", "current", "thread", "has", "not", "*", "passed", "through", "a", "code", "source", "provided", "by", "the", "untrusted", "component", "the", "*", "SecurityManager", "assumes", "the", "code", "is", "trusted", "so", "the", "standard", "checking", "*", "mechanisms", "can", "'", "t", "be", "used", ".", "*", "/", "public", "interface", "PermissionCheck", "{", "/", "**", "*", "Does", "this", "component", "have", "the", "given", "permission", "?", "*", "*", "@", "param", "permission", "The", "permission", "to", "test", "*", "*", "@", "return", "{", "@", "code", "false", "}", "if", "a", "SecurityManager", "is", "enabled", "and", "the", "component", "*", "does", "not", "have", "the", "given", "permission", ",", "otherwise", "{", "@", "code", "false", "}", "*", "/", "boolean", "check", "(", "Permission", "permission", ")", ";", "}", "@", "@", "-", "109", ",", "6", "+", "109", ",", "14", "@", "@", "<", "bug", ">", "59859", "<", "/", "bug", ">", ":", "Fix", "resource", "leak", "in", "WebDAV", "servlet", ".", "Based", "on", "patch", "by", "Coty", "Sutherland", ".", "(", "fschumacher", ")", "<", "/", "fix", ">", "<", "add", ">", "Provide", "a", "mechanism", "that", "enables", "the", "container", "to", "check", "if", "a", "component", "(", "typically", "a", "web", "application", ")", "has", "been", "granted", "a", "given", "permission", "when", "running", "under", "a", "SecurityManager", "without", "the", "current", "execution", "stack", "having", "to", "have", "passed", "through", "the", "component", ".", "Use", "this", "new", "mechanism", "to", "extend", "SecurityManager", "protection", "to", "the", "system", "property", "replacement", "feature", "of", "the", "digester", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["a", "malicious", "web", "application"]}
{"contents": ["KVM:", "x86:", "Handle", "errors", "when", "RIP", "is", "set", "during", "far", "jumps", "Far", "jmp/call/ret", "may", "fault", "while", "loading", "a", "new", "RIP.", "Currently", "KVM", "does", "not", "handle", "this", "case,", "and", "may", "result", "in", "failed", "vm-entry", "once", "the", "assignment", "is", "done.", "The", "tricky", "part", "of", "doing", "so", "is", "that", "loading", "the", "new", "CS", "affects", "the", "VMCS/VMCB", "state,", "so", "if", "we", "fail", "during", "loading", "the", "new", "RIP,", "we", "are", "left", "in", "unconsistent", "state.", "Therefore,", "this", "patch", "saves", "on", "64-bit", "the", "old", "CS", "descriptor", "and", "restores", "it", "if", "loading", "RIP", "failed.", "This", "fixes", ".", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Nadav", "Amit", "<namit@cs.technion.ac.il>", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["@", "@", "-", "1443", ",", "7", "+", "1443", ",", "9", "@", "@", "static", "int", "write_segment_descriptor", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ",", "/", "*", "Does", "not", "support", "long", "mode", "*", "/", "static", "int", "__load_segment_descriptor", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ",", "u16", "selector", ",", "int", "seg", ",", "u8", "cpl", ",", "bool", "in_task_switch", ")", "u16", "selector", ",", "int", "seg", ",", "u8", "cpl", ",", "bool", "in_task_switch", ",", "struct", "desc_struct", "*", "desc", ")", "{", "struct", "desc_struct", "seg_desc", ",", "old_desc", ";", "u8", "dpl", ",", "rpl", ";", "@", "@", "-", "1584", ",", "6", "+", "1586", ",", "8", "@", "@", "static", "int", "__load_segment_descriptor", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ",", "}", "load", ":", "ctxt", "-", ">", "ops", "-", ">", "set_segment", "(", "ctxt", ",", "selector", ",", "&", "seg_desc", ",", "base3", ",", "seg", ")", ";", "if", "(", "desc", ")", "*", "desc", "=", "seg_desc", ";", "return", "X86EMUL_CONTINUE", ";", "exception", ":", "return", "emulate_exception", "(", "ctxt", ",", "err_vec", ",", "err_code", ",", "true", ")", ";", "@", "@", "-", "1593", ",", "7", "+", "1597", ",", "7", "@", "@", "static", "int", "load_segment_descriptor", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ",", "u16", "selector", ",", "int", "seg", ")", "{", "u8", "cpl", "=", "ctxt", "-", ">", "ops", "-", ">", "cpl", "(", "ctxt", ")", ";", "return", "__load_segment_descriptor", "(", "ctxt", ",", "selector", ",", "seg", ",", "cpl", ",", "false", ")", ";", "return", "__load_segment_descriptor", "(", "ctxt", ",", "selector", ",", "seg", ",", "cpl", ",", "false", ",", "NULL", ")", ";", "}", "static", "void", "write_register_operand", "(", "struct", "operand", "*", "op", ")", "@", "@", "-", "1987", ",", "17", "+", "1991", ",", "31", "@", "@", "static", "int", "em_iret", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "static", "int", "em_jmp_far", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "{", "int", "rc", ";", "unsigned", "short", "sel", ";", "unsigned", "short", "sel", ",", "old_sel", ";", "struct", "desc_struct", "old_desc", ",", "new_desc", ";", "const", "struct", "x86_emulate_ops", "*", "ops", "=", "ctxt", "-", ">", "ops", ";", "u8", "cpl", "=", "ctxt", "-", ">", "ops", "-", ">", "cpl", "(", "ctxt", ")", ";", "/", "*", "Assignment", "of", "RIP", "may", "only", "fail", "in", "64", "-", "bit", "mode", "*", "/", "if", "(", "ctxt", "-", ">", "mode", "=", "=", "X86EMUL_MODE_PROT64", ")", "ops", "-", ">", "get_segment", "(", "ctxt", ",", "&", "old_sel", ",", "&", "old_desc", ",", "NULL", ",", "VCPU_SREG_CS", ")", ";", "memcpy", "(", "&", "sel", ",", "ctxt", "-", ">", "src", ".", "valptr", "+", "ctxt", "-", ">", "op_bytes", ",", "2", ")", ";", "rc", "=", "load_segment_descriptor", "(", "ctxt", ",", "sel", ",", "VCPU_SREG_CS", ")", ";", "rc", "=", "__load_segment_descriptor", "(", "ctxt", ",", "sel", ",", "VCPU_SREG_CS", ",", "cpl", ",", "false", ",", "&", "new_desc", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "return", "rc", ";", "ctxt", "-", ">", "_eip", "=", "0", ";", "memcpy", "(", "&", "ctxt", "-", ">", "_eip", ",", "ctxt", "-", ">", "src", ".", "valptr", ",", "ctxt", "-", ">", "op_bytes", ")", ";", "return", "X86EMUL_CONTINUE", ";", "rc", "=", "assign_eip_far", "(", "ctxt", ",", "ctxt", "-", ">", "src", ".", "val", ",", "new_desc", ".", "l", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "{", "WARN_ON", "(", "!", "ctxt", "-", ">", "mode", "!", "=", "X86EMUL_MODE_PROT64", ")", ";", "/", "*", "assigning", "eip", "failed", ";", "restore", "the", "old", "cs", "*", "/", "ops", "-", ">", "set_segment", "(", "ctxt", ",", "old_sel", ",", "&", "old_desc", ",", "0", ",", "VCPU_SREG_CS", ")", ";", "return", "rc", ";", "}", "return", "rc", ";", "}", "static", "int", "em_grp45", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "@", "@", "-", "2064", ",", "21", "+", "2082", ",", "34", "@", "@", "static", "int", "em_ret", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "static", "int", "em_ret_far", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "{", "int", "rc", ";", "unsigned", "long", "cs", ";", "unsigned", "long", "eip", ",", "cs", ";", "u16", "old_cs", ";", "int", "cpl", "=", "ctxt", "-", ">", "ops", "-", ">", "cpl", "(", "ctxt", ")", ";", "struct", "desc_struct", "old_desc", ",", "new_desc", ";", "const", "struct", "x86_emulate_ops", "*", "ops", "=", "ctxt", "-", ">", "ops", ";", "if", "(", "ctxt", "-", ">", "mode", "=", "=", "X86EMUL_MODE_PROT64", ")", "ops", "-", ">", "get_segment", "(", "ctxt", ",", "&", "old_cs", ",", "&", "old_desc", ",", "NULL", ",", "VCPU_SREG_CS", ")", ";", "rc", "=", "emulate_pop", "(", "ctxt", ",", "&", "ctxt", "-", ">", "_eip", ",", "ctxt", "-", ">", "op_bytes", ")", ";", "rc", "=", "emulate_pop", "(", "ctxt", ",", "&", "eip", ",", "ctxt", "-", ">", "op_bytes", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "return", "rc", ";", "if", "(", "ctxt", "-", ">", "op_bytes", "=", "=", "4", ")", "ctxt", "-", ">", "_eip", "=", "(", "u32", ")", "ctxt", "-", ">", "_eip", ";", "rc", "=", "emulate_pop", "(", "ctxt", ",", "&", "cs", ",", "ctxt", "-", ">", "op_bytes", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "return", "rc", ";", "/", "*", "Outer", "-", "privilege", "level", "return", "is", "not", "implemented", "*", "/", "if", "(", "ctxt", "-", ">", "mode", ">", "=", "X86EMUL_MODE_PROT16", "&", "&", "(", "cs", "&", "3", ")", ">", "cpl", ")", "return", "X86EMUL_UNHANDLEABLE", ";", "rc", "=", "load_segment_descriptor", "(", "ctxt", ",", "(", "u16", ")", "cs", ",", "VCPU_SREG_CS", ")", ";", "rc", "=", "__load_segment_descriptor", "(", "ctxt", ",", "(", "u16", ")", "cs", ",", "VCPU_SREG_CS", ",", "0", ",", "false", ",", "&", "new_desc", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "return", "rc", ";", "rc", "=", "assign_eip_far", "(", "ctxt", ",", "eip", ",", "new_desc", ".", "l", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "{", "WARN_ON", "(", "!", "ctxt", "-", ">", "mode", "!", "=", "X86EMUL_MODE_PROT64", ")", ";", "ops", "-", ">", "set_segment", "(", "ctxt", ",", "old_cs", ",", "&", "old_desc", ",", "0", ",", "VCPU_SREG_CS", ")", ";", "}", "return", "rc", ";", "}", "@", "@", "-", "2505", ",", "19", "+", "2536", ",", "24", "@", "@", "static", "int", "load_state_from_tss16", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ",", "*", "Now", "load", "segment", "descriptors", ".", "If", "fault", "happens", "at", "this", "stage", "*", "it", "is", "handled", "in", "a", "context", "of", "new", "task", "*", "/", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ldt", ",", "VCPU_SREG_LDTR", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ldt", ",", "VCPU_SREG_LDTR", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "es", ",", "VCPU_SREG_ES", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "es", ",", "VCPU_SREG_ES", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "cs", ",", "VCPU_SREG_CS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "cs", ",", "VCPU_SREG_CS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ss", ",", "VCPU_SREG_SS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ss", ",", "VCPU_SREG_SS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ds", ",", "VCPU_SREG_DS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ds", ",", "VCPU_SREG_DS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "@", "@", "-", "2642", ",", "25", "+", "2678", ",", "32", "@", "@", "static", "int", "load_state_from_tss32", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ",", "*", "Now", "load", "segment", "descriptors", ".", "If", "fault", "happenes", "at", "this", "stage", "*", "it", "is", "handled", "in", "a", "context", "of", "new", "task", "*", "/", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ldt_selector", ",", "VCPU_SREG_LDTR", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ldt_selector", ",", "VCPU_SREG_LDTR", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "es", ",", "VCPU_SREG_ES", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "es", ",", "VCPU_SREG_ES", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "cs", ",", "VCPU_SREG_CS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "cs", ",", "VCPU_SREG_CS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ss", ",", "VCPU_SREG_SS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ss", ",", "VCPU_SREG_SS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ds", ",", "VCPU_SREG_DS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "ds", ",", "VCPU_SREG_DS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "fs", ",", "VCPU_SREG_FS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "fs", ",", "VCPU_SREG_FS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "gs", ",", "VCPU_SREG_GS", ",", "cpl", ",", "true", ")", ";", "ret", "=", "__load_segment_descriptor", "(", "ctxt", ",", "tss", "-", ">", "gs", ",", "VCPU_SREG_GS", ",", "cpl", ",", "true", ",", "NULL", ")", ";", "if", "(", "ret", "!", "=", "X86EMUL_CONTINUE", ")", "return", "ret", ";", "@", "@", "-", "2942", ",", "24", "+", "2985", ",", "39", "@", "@", "static", "int", "em_call_far", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "u16", "sel", ",", "old_cs", ";", "ulong", "old_eip", ";", "int", "rc", ";", "struct", "desc_struct", "old_desc", ",", "new_desc", ";", "const", "struct", "x86_emulate_ops", "*", "ops", "=", "ctxt", "-", ">", "ops", ";", "int", "cpl", "=", "ctxt", "-", ">", "ops", "-", ">", "cpl", "(", "ctxt", ")", ";", "old_cs", "=", "get_segment_selector", "(", "ctxt", ",", "VCPU_SREG_CS", ")", ";", "old_eip", "=", "ctxt", "-", ">", "_eip", ";", "ops", "-", ">", "get_segment", "(", "ctxt", ",", "&", "old_cs", ",", "&", "old_desc", ",", "NULL", ",", "VCPU_SREG_CS", ")", ";", "memcpy", "(", "&", "sel", ",", "ctxt", "-", ">", "src", ".", "valptr", "+", "ctxt", "-", ">", "op_bytes", ",", "2", ")", ";", "if", "(", "load_segment_descriptor", "(", "ctxt", ",", "sel", ",", "VCPU_SREG_CS", ")", ")", "rc", "=", "__load_segment_descriptor", "(", "ctxt", ",", "sel", ",", "VCPU_SREG_CS", ",", "cpl", ",", "false", ",", "&", "new_desc", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "return", "X86EMUL_CONTINUE", ";", "ctxt", "-", ">", "_eip", "=", "0", ";", "memcpy", "(", "&", "ctxt", "-", ">", "_eip", ",", "ctxt", "-", ">", "src", ".", "valptr", ",", "ctxt", "-", ">", "op_bytes", ")", ";", "rc", "=", "assign_eip_far", "(", "ctxt", ",", "ctxt", "-", ">", "src", ".", "val", ",", "new_desc", ".", "l", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "goto", "fail", ";", "ctxt", "-", ">", "src", ".", "val", "=", "old_cs", ";", "rc", "=", "em_push", "(", "ctxt", ")", ";", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "return", "rc", ";", "goto", "fail", ";", "ctxt", "-", ">", "src", ".", "val", "=", "old_eip", ";", "return", "em_push", "(", "ctxt", ")", ";", "rc", "=", "em_push", "(", "ctxt", ")", ";", "/", "*", "If", "we", "failed", ",", "we", "tainted", "the", "memory", ",", "but", "the", "very", "least", "we", "should", "restore", "cs", "*", "/", "if", "(", "rc", "!", "=", "X86EMUL_CONTINUE", ")", "goto", "fail", ";", "return", "rc", ";", "fail", ":", "ops", "-", ">", "set_segment", "(", "ctxt", ",", "old_cs", ",", "&", "old_desc", ",", "0", ",", "VCPU_SREG_CS", ")", ";", "return", "rc", ";", "}", "static", "int", "em_ret_near_imm", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["tcp:", "tcp_fragment()", "should", "apply", "sane", "memory", "limits", "Jonathan", "Looney", "reported", "that", "a", "malicious", "peer", "can", "force", "a", "sender", "to", "fragment", "its", "retransmit", "queue", "into", "tiny", "skbs,", "inflating", "memory", "usage", "and/or", "overflow", "32bit", "counters.", "TCP", "allows", "an", "application", "to", "queue", "up", "to", "sk_sndbuf", "bytes,", "so", "we", "need", "to", "give", "some", "allowance", "for", "non", "malicious", "splitting", "of", "retransmit", "queue.", "A", "new", "SNMP", "counter", "is", "added", "to", "monitor", "how", "many", "times", "TCP", "did", "not", "allow", "to", "split", "an", "skb", "if", "the", "allowance", "was", "exceeded.", "Note", "that", "this", "counter", "might", "increase", "in", "the", "case", "applications", "use", "SO_SNDBUF", "socket", "option", "to", "lower", "sk_sndbuf.", ":", "tcp_fragment,", "prevent", "fragmenting", "a", "packet", "when", "the", "socket", "is", "already", "using", "more", "than", "half", "the", "allowed", "space", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Reported-by:", "Jonathan", "Looney", "<jtl@netflix.com>", "Acked-by:", "Neal", "Cardwell", "<ncardwell@google.com>", "Acked-by:", "Yuchung", "Cheng", "<ycheng@google.com>", "Reviewed-by:", "Tyler", "Hicks", "<tyhicks@canonical.com>", "Cc:", "Bruce", "Curtis", "<brucec@netflix.com>", "Cc:", "Jonathan", "Lemon", "<jonathan.lemon@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "283", ",", "6", "+", "283", ",", "7", "@", "@", "enum", "LINUX_MIB_TCPACKCOMPRESSED", ",", "/", "*", "TCPAckCompressed", "*", "/", "LINUX_MIB_TCPZEROWINDOWDROP", ",", "/", "*", "TCPZeroWindowDrop", "*", "/", "LINUX_MIB_TCPRCVQDROP", ",", "/", "*", "TCPRcvQDrop", "*", "/", "LINUX_MIB_TCPWQUEUETOOBIG", ",", "/", "*", "TCPWqueueTooBig", "*", "/", "__LINUX_MIB_MAX", "}", ";", "@", "@", "-", "287", ",", "6", "+", "287", ",", "7", "@", "@", "static", "const", "struct", "snmp_mib", "snmp4_net_list", "[", "]", "=", "{", "SNMP_MIB_ITEM", "(", "\"", "TCPAckCompressed", "\"", ",", "LINUX_MIB_TCPACKCOMPRESSED", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPZeroWindowDrop", "\"", ",", "LINUX_MIB_TCPZEROWINDOWDROP", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPRcvQDrop", "\"", ",", "LINUX_MIB_TCPRCVQDROP", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPWqueueTooBig", "\"", ",", "LINUX_MIB_TCPWQUEUETOOBIG", ")", ",", "SNMP_MIB_SENTINEL", "}", ";", "@", "@", "-", "1296", ",", "6", "+", "1296", ",", "11", "@", "@", "int", "tcp_fragment", "(", "struct", "sock", "*", "sk", ",", "enum", "tcp_queue", "tcp_queue", ",", "if", "(", "nsize", "<", "0", ")", "nsize", "=", "0", ";", "if", "(", "unlikely", "(", "(", "sk", "-", ">", "sk_wmem_queued", ">", ">", "1", ")", ">", "sk", "-", ">", "sk_sndbuf", ")", ")", "{", "NET_INC_STATS", "(", "sock_net", "(", "sk", ")", ",", "LINUX_MIB_TCPWQUEUETOOBIG", ")", ";", "return", "-", "ENOMEM", ";", "}", "if", "(", "skb_unclone", "(", "skb", ",", "gfp", ")", ")", "return", "-", "ENOMEM", ";"], "docstring_tokens": ["sending", "specially-crafted", "SACKs", "requests"]}
{"contents": ["[KEYCLOAK-10779]", "-", "CSRF", "check", "to", "My", "Resources"], "code_tokens": ["@", "@", "-", "715", ",", "7", "+", "715", ",", "15", "@", "@", "public", "Response", "resourceDetailPage", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ")", "@", "Path", "(", "\"", "resource", "/", "{", "resource_id", "}", "/", "grant", "\"", ")", "@", "POST", "public", "Response", "grantPermission", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ",", "@", "FormParam", "(", "\"", "permission_id", "\"", ")", "String", "[", "]", "permissionId", ",", "@", "FormParam", "(", "\"", "requester", "\"", ")", "String", "requester", ")", "{", "public", "Response", "grantPermission", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ",", "@", "FormParam", "(", "\"", "permission_id", "\"", ")", "String", "[", "]", "permissionId", ",", "@", "FormParam", "(", "\"", "requester", "\"", ")", "String", "requester", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "formData", ")", "{", "if", "(", "auth", "=", "=", "null", ")", "{", "return", "login", "(", "\"", "resource", "\"", ");", "}", "auth", ".", "require", "(", "AccountRoles", ".", "MANAGE_ACCOUNT", ")", ";", "csrfCheck", "(", "formData", ")", ";", "AuthorizationProvider", "authorization", "=", "session", ".", "getProvider", "(", "AuthorizationProvider", ".", "class", ")", ";", "PermissionTicketStore", "ticketStore", "=", "authorization", ".", "getStoreFactory", "(", ").", "getPermissionTicketStore", "(", ");", "Resource", "resource", "=", "authorization", ".", "getStoreFactory", "(", ").", "getResourceStore", "(", ").", "findById", "(", "resourceId", ",", "null", ")", ";", "@", "@", "-", "823", ",", "7", "+", "831", ",", "15", "@", "@", "public", "Response", "grantPermission", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "Fo", "@", "Path", "(", "\"", "resource", "/", "{", "resource_id", "}", "/", "share", "\"", ")", "@", "POST", "public", "Response", "shareResource", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "user_id", "\"", ")", "String", "[", "]", "userIds", ",", "@", "FormParam", "(", "\"", "scope_id", "\"", ")", "String", "[", "]", "scopes", ")", "{", "public", "Response", "shareResource", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "user_id", "\"", ")", "String", "[", "]", "userIds", ",", "@", "FormParam", "(", "\"", "scope_id", "\"", ")", "String", "[", "]", "scopes", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "formData", ")", "{", "if", "(", "auth", "=", "=", "null", ")", "{", "return", "login", "(", "\"", "resource", "\"", ");", "}", "auth", ".", "require", "(", "AccountRoles", ".", "MANAGE_ACCOUNT", ")", ";", "csrfCheck", "(", "formData", ")", ";", "AuthorizationProvider", "authorization", "=", "session", ".", "getProvider", "(", "AuthorizationProvider", ".", "class", ")", ";", "PermissionTicketStore", "ticketStore", "=", "authorization", ".", "getStoreFactory", "(", ").", "getPermissionTicketStore", "(", ");", "Resource", "resource", "=", "authorization", ".", "getStoreFactory", "(", ").", "getResourceStore", "(", ").", "findById", "(", "resourceId", ",", "null", ")", ";", "@", "@", "-", "899", ",", "7", "+", "915", ",", "14", "@", "@", "public", "Response", "shareResource", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "Form", "@", "Path", "(", "\"", "resource", "\"", ")", "@", "POST", "public", "Response", "processResourceActions", "(", "@", "FormParam", "(", "\"", "resource_id", "\"", ")", "String", "[", "]", "resourceIds", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ")", "{", "public", "Response", "processResourceActions", "(", "@", "FormParam", "(", "\"", "resource_id", "\"", ")", "String", "[", "]", "resourceIds", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "formData", ")", "{", "if", "(", "auth", "=", "=", "null", ")", "{", "return", "login", "(", "\"", "resource", "\"", ");", "}", "auth", ".", "require", "(", "AccountRoles", ".", "MANAGE_ACCOUNT", ")", ";", "csrfCheck", "(", "formData", ")", ";", "AuthorizationProvider", "authorization", "=", "session", ".", "getProvider", "(", "AuthorizationProvider", ".", "class", ")", ";", "PermissionTicketStore", "ticketStore", "=", "authorization", ".", "getStoreFactory", "(", ").", "getPermissionTicketStore", "(", ");", "@", "@", "-", "36", ",", "6", "+", "36", ",", "7", "@", "@", "import", "java", ".", "net", ".", "URL", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "UIUtils", ".", "clickLink", ";", "import", "static", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "WaitUtils", ".", "pause", ";", "import", "static", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "WaitUtils", ".", "waitForPageToLoad", ";", "@", "@", "-", "209", ",", "6", "+", "210", ",", "10", "@", "@", "public", "void", "accountMyResource", "(", "String", "name", ")", "{", "public", "void", "accountGrantResource", "(", "String", "name", ",", "String", "requester", ")", "{", "accountMyResources", "(", ");", "grantResource", "(", "name", ",", "requester", ")", ";", "}", "public", "void", "grantResource", "(", "String", "name", ",", "String", "requester", ")", "{", "WebElement", "grantResource", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "grant", "-", "\"", "+", "name", "+", "\"", "-\"", "+", "requester", ")", ");", "waitUntilElement", "(", "grantResource", ")", ".", "is", "(", ").", "clickable", "(", ");", "grantResource", ".", "click", "(", ");", "@", "@", "-", "225", ",", "6", "+", "230", ",", "10", "@", "@", "public", "void", "accountGrantRemoveScope", "(", "String", "name", ",", "String", "requester", ",", "String", "scope", ")", "public", "void", "accountRevokeResource", "(", "String", "name", ",", "String", "requester", ")", "{", "accountMyResource", "(", "name", ")", ";", "revokeResource", "(", "name", ",", "requester", ")", ";", "}", "public", "void", "revokeResource", "(", "String", "name", ",", "String", "requester", ")", "{", "WebElement", "revokeResource", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "revoke", "-", "\"", "+", "name", "+", "\"", "-\"", "+", "requester", ")", ");", "waitUntilElement", "(", "revokeResource", ")", ".", "is", "(", ").", "clickable", "(", ");", "revokeResource", ".", "click", "(", ");", "@", "@", "-", "233", ",", "35", "+", "242", ",", "36", "@", "@", "public", "void", "accountRevokeResource", "(", "String", "name", ",", "String", "requester", ")", "{", "public", "void", "accountShareResource", "(", "String", "name", ",", "String", "user", ")", "{", "accountMyResource", "(", "name", ")", ";", "WebElement", "userIdInput", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "user_id", "\"", "))", ";", "UIUtils", ".", "setTextInputValue", "(", "userIdInput", ",", "user", ")", ";", "pause", "(", "200", ")", ";", "/", "/", "We", "need", "to", "wait", "a", "bit", "for", "the", "form", "to", "\"", "accept", "\"", "the", "input", "(", "otherwise", "it", "registers", "the", "input", "as", "empty", ")", "waitUntilElement", "(", "userIdInput", ")", ".", "attribute", "(", "UIUtils", ".", "VALUE_ATTR_NAME", ")", ".", "contains", "(", "user", ")", ";", "WebElement", "shareButton", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "share", "-", "button", "\"", "))", ";", "waitUntilElement", "(", "shareButton", ")", ".", "is", "(", ").", "clickable", "(", ");", "shareButton", ".", "click", "(", ");", "shareResource", "(", "user", ")", ";", "waitForPageToLoad", "(", ");", "}", "public", "void", "accountShareRemoveScope", "(", "String", "name", ",", "String", "user", ",", "String", "scope", ")", "{", "accountMyResource", "(", "name", ")", ";", "WebElement", "userIdInput", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "user_id", "\"", "))", ";", "UIUtils", ".", "setTextInputValue", "(", "userIdInput", ",", "user", ")", ";", "pause", "(", "200", ")", ";", "/", "/", "We", "need", "to", "wait", "a", "bit", "for", "the", "form", "to", "\"", "accept", "\"", "the", "input", "(", "otherwise", "it", "registers", "the", "input", "as", "empty", ")", "waitUntilElement", "(", "userIdInput", ")", ".", "attribute", "(", "UIUtils", ".", "VALUE_ATTR_NAME", ")", ".", "contains", "(", "user", ")", ";", "WebElement", "shareRemoveScope", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "share", "-", "remove", "-", "scope", "-", "\"", "+", "name", "+", "\"", "-\"", "+", "scope", ")", ");", "waitUntilElement", "(", "shareRemoveScope", ")", ".", "is", "(", ").", "clickable", "(", ");", "shareRemoveScope", ".", "click", "(", ");", "waitForPageToLoad", "(", ");", "shareResource", "(", "user", ")", ";", "waitForPageToLoad", "(", ");", "}", "public", "void", "shareResource", "(", "String", "user", ")", "{", "WebElement", "userIdInput", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "user_id", "\"", "))", ";", "UIUtils", ".", "setTextInputValue", "(", "userIdInput", ",", "user", ")", ";", "pause", "(", "200", ")", ";", "/", "/", "We", "need", "to", "wait", "a", "bit", "for", "the", "form", "to", "\"", "accept", "\"", "the", "input", "(", "otherwise", "it", "registers", "the", "input", "as", "empty", ")", "waitUntilElement", "(", "userIdInput", ")", ".", "attribute", "(", "UIUtils", ".", "VALUE_ATTR_NAME", ")", ".", "contains", "(", "user", ")", ";", "WebElement", "shareButton", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "share", "-", "button", "\"", "))", ";", "waitUntilElement", "(", "shareButton", ")", ".", "is", "(", ").", "clickable", "(", ");", "shareButton", ".", "click", "(", ");", "waitForPageToLoad", "(", ");", "}", "public", "void", "assertError", "(", ")", "{", "assertEquals", "(", "\"", "We", "'", "re", "sorry", ".", "..", "\",", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "kc", "-", "page", "-", "title", "\"", "))", ".", "getText", "(", "))", ";", "}", "public", "void", "accountDenyResource", "(", "String", "name", ")", "{", "@", "@", "-", "302", ",", "4", "+", "312", ",", "8", "@", "@", "public", "void", "navigateTo", "(", ")", "{", "public", "boolean", "isCurrent", "(", ")", "{", "return", "URLUtils", ".", "currentUrlStartsWith", "(", "toString", "(", "))", ";", "}", "public", "void", "executeScript", "(", "String", "script", ")", "{", "testExecutor", ".", "executeScript", "(", "script", ")", ";", "}", "}", "@", "@", "-", "677", ",", "6", "+", "677", ",", "51", "@", "@", "public", "void", "testRequestResourceToOwner", "(", ")", "throws", "Exception", "{", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "}", "@", "Test", "public", "void", "testCsrfGrantAccess", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "createAlbum", "(", "ALICE_ALBUM_NAME", ",", "true", ")", ";", "loginToClientPage", "(", "jdoeUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "accountMyResources", "(", ");", "clientPage", ".", "executeScript", "(", "\"", "document", ".", "forms", "[", "0", "]", ".", "stateChecker", ".", "value", "=", "'", "invalid", "'", "\")", ";", "clientPage", ".", "grantResource", "(", "ALICE_ALBUM_NAME", ",", "\"", "jdoe", "\"", ");", "clientPage", ".", "assertError", "(", ");", "}", "@", "Test", "public", "void", "testCsrfRevokeResource", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "createAlbum", "(", "ALICE_ALBUM_NAME", ",", "true", ")", ";", "loginToClientPage", "(", "jdoeUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "accountGrantResource", "(", "ALICE_ALBUM_NAME", ",", "\"", "jdoe", "\"", ");", "clientPage", ".", "navigateTo", "(", ");", "testExecutor", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertInitNotAuth", ")", ".", "login", "(", "this", ":", ":", "assertOnTestAppUrl", ")", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertSuccessfullyLoggedIn", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "accountMyResource", "(", "ALICE_ALBUM_NAME", ")", ";", "clientPage", ".", "executeScript", "(", "\"", "document", ".", "forms", "[", "0", "]", ".", "stateChecker", ".", "value", "=", "'", "invalid", "'", "\")", ";", "clientPage", ".", "revokeResource", "(", "ALICE_ALBUM_NAME", ",", "\"", "jdoe", "\"", ");", "clientPage", ".", "assertError", "(", ");", "}", "@", "Test", "public", "void", "testOwnerSharingResource", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "@", "@", "-", "720", ",", "6", "+", "765", ",", "34", "@", "@", "public", "void", "testOwnerSharingResource", "(", ")", "throws", "Exception", "{", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "}", "@", "Test", "public", "void", "testCrfCheckSharingResource", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "createAlbum", "(", "ALICE_ALBUM_NAME", ",", "true", ")", ";", "clientPage", ".", "accountMyResource", "(", "ALICE_ALBUM_NAME", ")", ";", "clientPage", ".", "executeScript", "(", "\"", "document", ".", "forms", "[", "'", "shareForm", "'", "].", "stateChecker", ".", "value", "=", "'", "invalid", "'", "\")", ";", "clientPage", ".", "shareResource", "(", "\"", "jdoe", "\"", ");", "clientPage", ".", "assertError", "(", ");", "clientPage", ".", "navigateTo", "(", ");", "testExecutor", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertInitNotAuth", ")", ".", "login", "(", ")", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertSuccessfullyLoggedIn", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "accountMyResource", "(", "ALICE_ALBUM_NAME", ")", ";", "clientPage", ".", "shareResource", "(", "\"", "jdoe", "\"", ");", "clientPage", ".", "navigateTo", "(", ");", "testExecutor", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertInitNotAuth", ")", ".", "login", "(", "this", ":", ":", "assertOnTestAppUrl", ")", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertSuccessfullyLoggedIn", ")", ";", "loginToClientPage", "(", "jdoeUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "}", "private", "void", "importResourceServerSettings", "(", ")", "throws", "FileNotFoundException", "{", "ResourceServerRepresentation", "authSettings", "=", "loadJson", "(", "new", "FileInputStream", "(", "new", "File", "(", "TEST_APPS_HOME_DIR", "+", "\"", "/", "photoz", "/", "photoz", "-", "restful", "-", "api", "-", "authz", "-", "service", ".", "json", "\"", "))", ",", "ResourceServerRepresentation", ".", "class", ")", ";", "@", "@", "-", "121", ",", "6", "+", "121", ",", "7", "@", "@", "<", "form", "action", "=", "\"$", "{", "url", ".", "getResourceGrant", "(", "authorization", ".", "resource", ".", "id", ")", "}\"", "name", "=", "\"", "revokeForm", "-", "${", "authorization", ".", "resource", ".", "id", "}", "-$", "{", "permission", ".", "requester", ".", "username", "}", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "action", "\"", "value", "=", "\"", "revoke", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "requester", "\"", "value", "=", "\"$", "{", "permission", ".", "requester", ".", "username", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "tr", ">", "<", "td", ">", "<", "#", "if", "permission", ".", "requester", ".", "email", "?", "?>", "${", "permission", ".", "requester", ".", "email", "}", "<#", "else", ">", "${", "permission", ".", "requester", ".", "username", "}", "</", "#", "if", ">", "@", "@", "-", "188", ",", "6", "+", "189", ",", "7", "@", "@", "<", "form", "action", "=", "\"$", "{", "url", ".", "getResourceGrant", "(", "authorization", ".", "resource", ".", "id", ")", "}\"", "name", "=", "\"", "revokePolicyForm", "-", "${", "authorization", ".", "resource", ".", "id", "}", "-$", "{", "permission", ".", "id", "}", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "action", "\"", "value", "=", "\"", "revokePolicy", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "permission_id", "\"", "value", "=", "\"$", "{", "permission", ".", "id", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "tr", ">", "<", "td", ">", "<", "#", "if", "permission", ".", "description", "?", "?>", "@", "@", "-", "239", ",", "6", "+", "241", ",", "7", "@", "@", "<", "div", "class", "=", "\"", "row", "\"", ">", "<", "div", "class", "=", "\"", "col", "-", "md", "-", "10", "\"", ">", "<", "form", "action", "=", "\"$", "{", "url", ".", "getResourceShare", "(", "authorization", ".", "resource", ".", "id", ")", "}\"", "name", "=", "\"", "shareForm", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "div", "class", "=", "\"", "col", "-", "sm", "-", "3", "col", "-", "md", "-", "3", "\"", ">", "<", "label", "for", "=", "\"", "password", "\"", "class", "=", "\"", "control", "-", "label", "\"", ">$", "{", "msg", "(", "\"", "username", "\"", ")}", "or", "$", "{", "msg", "(", "\"", "email", "\"", ")}", "<", "/", "label", ">", "<", "span", "class", "=", "\"", "required", "\"", ">*", "</", "span", ">", "<", "/", "div", ">", "@", "@", "-", "136", ",", "6", "+", "136", ",", "7", "@", "@", "<", "form", "action", "=", "\"$", "{", "url", ".", "getResourceGrant", "(", "resource", ".", "id", ")", "}\"", "name", "=", "\"", "approveForm", "-", "${", "resource", ".", "id", "}", "-$", "{", "permission", ".", "requester", ".", "username", "}", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "action", "\"", "value", "=", "\"", "grant", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "requester", "\"", "value", "=", "\"$", "{", "permission", ".", "requester", ".", "username", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "tr", ">", "<", "td", ">", "<", "#", "if", "resource", ".", "displayName", "?", "?>", "${", "resource", ".", "displayName", "}", "<#", "else", ">", "${", "resource", ".", "name", "}", "</", "#", "if", ">", "@", "@", "-", "234", ",", "6", "+", "235", ",", "7", "@", "@", "<", "div", "class", "=", "\"", "col", "-", "md", "-", "12", "\"", ">", "<", "form", "action", "=", "\"$", "{", "url", ".", "resourceUrl", "}", "\"", "name", "=", "\"", "shareForm", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "action", "\"", "value", "=", "\"", "cancel", "\"", "/>", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "table", "class", "=", "\"", "table", "table", "-", "striped", "table", "-", "bordered", "\"", ">", "<", "thead", ">", "<", "tr", ">", "@", "@", "-", "334", ",", "6", "+", "336", ",", "7", "@", "@", "<", "div", "class", "=", "\"", "col", "-", "md", "-", "12", "\"", ">", "<", "form", "action", "=", "\"$", "{", "url", ".", "resourceUrl", "}", "\"", "name", "=", "\"", "waitingApprovalForm", "\"", "method", "=", "\"", "post", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "action", "\"", "value", "=", "\"", "cancelRequest", "\"", "/>", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "table", "class", "=", "\"", "table", "table", "-", "striped", "table", "-", "bordered", "\"", ">", "<", "thead", ">", "<", "tr", ">"], "docstring_tokens": ["via", "request", "from", "an", "untrusted", "domain", "."]}
{"contents": ["Fix", "authentication", "verification", "for", "starttls", "This", "fixes", "a", "bug", "that", "was", "introduced", "that", "makes", "it", "so", "password", "isn't", "checked", "when", "authenticating", "if", "server", "is", "configured", "to", "use", "starttls", "Also", "adds", "tests", "for", "this", "case."], "code_tokens": ["@", "@", "-", "232", ",", "6", "+", "232", ",", "9", "@", "@", "private", "LdapContext", "getLdapContextUsingStartTls", "(", "LdapContextFactory", "ldapContextF", "ctx", ".", "addToEnvironment", "(", "Context", ".", "SECURITY_PRINCIPAL", ",", "principal", ")", ";", "ctx", ".", "addToEnvironment", "(", "Context", ".", "SECURITY_CREDENTIALS", ",", "credentials", ")", ";", "/", "/", "do", "a", "lookup", "of", "the", "user", "to", "trigger", "authentication", "ctx", ".", "lookup", "(", "principal", ".", "toString", "(", ")", ")", ";", "return", "ctx", ";", "}", "catch", "(", "IOException", "e", ")", "@", "@", "-", "717", ",", "6", "+", "717", ",", "25", "@", "@", "public", "void", "shouldBeAbleToLoginAndAuthorizeReaderWithLdapOnlyUsingStartTls", "(", ")", "thr", "}", "}", "@", "Test", "public", "void", "shouldFailLoginWrongPasswordWithLdapOnlyUsingStartTls", "(", ")", "throws", "Throwable", "{", "getLdapServer", "(", ").", "setConfidentialityRequired", "(", "true", ")", ";", "try", "(", "EmbeddedTestCertificates", "ignore", "=", "new", "EmbeddedTestCertificates", "(", ")", ")", "{", "/", "/", "When", "restartNeo4jServerWithOverriddenSettings", "(", "ldapOnlyAuthSettings", ".", "andThen", "(", "settings", "-", ">", "{", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_server", ",", "\"", "localhost", ":", "10389", "\"", ")", ";", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_use_starttls", ",", "\"", "true", "\"", ")", ";", "}", ")", ")", ";", "/", "/", "Then", "assertAuthFail", "(", "\"", "neo", "\"", ",", "\"", "wrong", "\"", ")", ";", "}", "}", "@", "Test", "public", "void", "shouldBeAbleToLoginAndAuthorizeReaderWithLdapUserContextUsingStartTls", "(", ")", "throws", "Throwable", "{", "@", "@", "-", "737", ",", "6", "+", "756", ",", "26", "@", "@", "public", "void", "shouldBeAbleToLoginAndAuthorizeReaderWithLdapUserContextUsingStartTl", "}", "}", "@", "Test", "public", "void", "shouldFailLoginWrongPasswordWithLdapUserContextUsingStartTls", "(", ")", "throws", "Throwable", "{", "getLdapServer", "(", ").", "setConfidentialityRequired", "(", "true", ")", ";", "try", "(", "EmbeddedTestCertificates", "ignore", "=", "new", "EmbeddedTestCertificates", "(", ")", ")", "{", "/", "/", "When", "restartNeo4jServerWithOverriddenSettings", "(", "ldapOnlyAuthSettings", ".", "andThen", "(", "settings", "-", ">", "{", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_authorization_use_system_account", ",", "\"", "false", "\"", ")", ";", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_server", ",", "\"", "localhost", ":", "10389", "\"", ")", ";", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_use_starttls", ",", "\"", "true", "\"", ")", ";", "}", ")", ")", ";", "/", "/", "Then", "assertAuthFail", "(", "\"", "neo", "\"", ",", "\"", "wrong", "\"", ")", ";", "}", "}", "/", "/-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "/", "/", "Active", "Directory", "tests", "on", "EC2", "/", "/", "NOTE", ":", "These", "rely", "on", "an", "external", "server", "and", "are", "not", "executed", "by", "automated", "testing"], "docstring_tokens": ["by", "sending", "any", "valid", "username", "with", "an", "arbitrary", "password", "."]}
{"contents": ["Fix", "a", "path", "traversal", "issue", "when", "using", "root", "fixes", "#59", "fixes", "#60"], "code_tokens": ["@", "@", "-", "1", ",", "3", "+", "1", ",", "8", "@", "@", "unreleased", "=", "==", "==", "==", "==", "=", "*", "Fix", "a", "path", "traversal", "issue", "when", "using", "`", "root", "`", "0", ".", "8", ".", "3", "/", "2014", "-", "08", "-", "16", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "@", "@", "-", "412", ",", "7", "+", "412", ",", "7", "@", "@", "SendStream", ".", "prototype", ".", "pipe", "=", "function", "(", "res", ")", "{", "if", "(", "root", "!", "==", "null", ")", "{", "/", "/", "join", "/", "normalize", "from", "optional", "root", "dir", "path", "=", "normalize", "(", "join", "(", "root", ",", "path", ")", ")", "root", "=", "normalize", "(", "root", ")", "root", "=", "normalize", "(", "root", "+", "sep", ")", "/", "/", "malicious", "path", "if", "(", "path", ".", "substr", "(", "0", ",", "root", ".", "length", ")", "!", "==", "root", ")", "{", "@", "@", "-", "421", ",", "7", "+", "421", ",", "7", "@", "@", "SendStream", ".", "prototype", ".", "pipe", "=", "function", "(", "res", ")", "{", "}", "/", "/", "explode", "path", "parts", "parts", "=", "path", ".", "substr", "(", "root", ".", "length", "+", "1", ")", ".", "split", "(", "sep", ")", "parts", "=", "path", ".", "substr", "(", "root", ".", "length", ")", ".", "split", "(", "sep", ")", "}", "else", "{", "/", "/", "\"", "..", "\"", "is", "malicious", "without", "\"", "root", "\"", "if", "(", "upPathRegexp", ".", "test", "(", "path", ")", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "loki", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "1097", ",", "6", "+", "1097", ",", "17", "@", "@", "describe", "(", "'", "send", "(", "file", ",", "options", ")", "',", "function", "(", "){", ".", "expect", "(", "200", ",", "'", "tobi", "'", ",", "done", ")", "}", ")", "it", "(", "'", "should", "with", "with", "trailing", "slash", "'", ",", "function", "(", "done", ")", "{", "var", "app", "=", "http", ".", "createServer", "(", "function", "(", "req", ",", "res", ")", "{", "send", "(", "req", ",", "req", ".", "url", ",", "{", "root", ":", "__dirname", "+", "'", "/", "fixtures", "/", "'}", ")", ".", "pipe", "(", "res", ")", ";", "}", ");", "request", "(", "app", ")", ".", "get", "(", "'/", "name", ".", "txt", "'", ")", ".", "expect", "(", "200", ",", "'", "tobi", "'", ",", "done", ")", "}", ")", "it", "(", "'", "should", "restrict", "paths", "to", "within", "root", "'", ",", "function", "(", "done", ")", "{", "var", "app", "=", "http", ".", "createServer", "(", "function", "(", "req", ",", "res", ")", "{", "send", "(", "req", ",", "req", ".", "url", ",", "{", "root", ":", "__dirname", "+", "'", "/", "fixtures", "'", "})", "@", "@", "-", "1118", ",", "6", "+", "1129", ",", "17", "@", "@", "describe", "(", "'", "send", "(", "file", ",", "options", ")", "',", "function", "(", "){", ".", "get", "(", "'/", "pets", "/", "..", "/.", "./", "send", ".", "js", "'", ")", ".", "expect", "(", "403", ",", "done", ")", "}", ")", "it", "(", "'", "should", "not", "allow", "root", "transversal", "'", ",", "function", "(", "done", ")", "{", "var", "app", "=", "http", ".", "createServer", "(", "function", "(", "req", ",", "res", ")", "{", "send", "(", "req", ",", "req", ".", "url", ",", "{", "root", ":", "__dirname", "+", "'", "/", "fixtures", "/", "name", ".", "d", "'", "})", ".", "pipe", "(", "res", ")", ";", "}", ");", "request", "(", "app", ")", ".", "get", "(", "'/", "..", "/", "name", ".", "dir", "/", "name", ".", "txt", "'", ")", ".", "expect", "(", "403", ",", "done", ")", "}", ")", "}", ")", "describe", "(", "'", "when", "missing", "'", ",", "function", "(", "){"], "docstring_tokens": ["send", "a", "specially-crafted", "request"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/1162"], "code_tokens": ["@", "@", "-", "95", ",", "132", "+", "95", ",", "165", "@", "@", "typedef", "struct", "}", "CUTPalHeader", ";", "static", "void", "InsertRow", "(", "Image", "*", "image", ",", "ssize_t", "depth", ",", "unsigned", "char", "*", "p", ",", "ssize_t", "y", ",", "ExceptionInfo", "*", "exception", ")", "static", "MagickBooleanType", "InsertRow", "(", "Image", "*", "image", ",", "ssize_t", "bpp", ",", "unsigned", "char", "*", "p", ",", "ssize_t", "y", ",", "ExceptionInfo", "*", "exception", ")", "{", "size_t", "bit", ";", "ssize_t", "x", ";", "register", "Quantum", "*", "q", ";", "Quantum", "index", ";", "int", "bit", ";", "index", "=", "0", ";", "switch", "(", "depth", ")", "{", "Quantum", "index", ";", "register", "Quantum", "*", "q", ";", "ssize_t", "x", ";", "q", "=", "QueueAuthenticPixels", "(", "image", ",", "0", ",", "y", ",", "image", "-", ">", "columns", ",", "1", ",", "exception", ")", ";", "if", "(", "q", "=", "=", "(", "Quantum", "*", ")", "NULL", ")", "return", "(", "MagickFalse", ")", ";", "switch", "(", "bpp", ")", "{", "case", "1", ":", "/", "*", "Convert", "bitmap", "scanline", ".", "*", "/", "{", "q", "=", "QueueAuthenticPixels", "(", "image", ",", "0", ",", "y", ",", "image", "-", ">", "columns", ",", "1", ",", "exception", ")", ";", "if", "(", "q", "=", "=", "(", "Quantum", "*", ")", "NULL", ")", "break", ";", "for", "(", "x", "=", "0", ";", "x", "<", "(", "(", "ssize_t", ")", "image", "-", ">", "columns", "-", "7", ")", ";", "x", "+", "=", "8", ")", "{", "for", "(", "bit", "=", "0", ";", "bit", "<", "8", ";", "bit", "+", "+)", "{", "index", "=", "(", "Quantum", ")", "(", "((", "(*", "p", ")", "&", "(", "0x80", ">", ">", "bit", ")", ")", "!", "=", "0", ")", "?", "0x01", ":", "0x00", ")", ";", "index", "=", "((", "*", "p", ")", "&", "(", "0x80", ">", ">", "bit", ")", "?", "0x01", ":", "0x00", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "p", "+", "+;", "}", "if", "(", "(", "image", "-", ">", "columns", "%", "8", ")", "!", "=", "0", ")", "{", "for", "(", "bit", "=", "0", ";", "bit", "<", "(", "image", "-", ">", "columns", "%", "8", ")", ";", "bit", "+", "+)", "{", "index", "=", "(", "Quantum", ")", "(", "((", "(*", "p", ")", "&", "(", "0x80", ">", ">", "bit", ")", ")", "!", "=", "0", ")", "?", "0x01", ":", "0x00", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "for", "(", "bit", "=", "0", ";", "bit", "<", "(", "ssize_t", ")", "(", "image", "-", ">", "columns", "%", "8", ")", ";", "bit", "+", "+)", "{", "index", "=", "((", "*", "p", ")", "&", "(", "0x80", ">", ">", "bit", ")", "?", "0x01", ":", "0x00", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "p", "+", "+;", "}", "(", "void", ")", "SyncAuthenticPixels", "(", "image", ",", "exception", ")", ";", "break", ";", "}", "case", "2", ":", "/", "*", "Convert", "PseudoColor", "scanline", ".", "*", "/", "{", "q", "=", "QueueAuthenticPixels", "(", "image", ",", "0", ",", "y", ",", "image", "-", ">", "columns", ",", "1", ",", "exception", ")", ";", "if", "(", "q", "=", "=", "(", "Quantum", "*", ")", "NULL", ")", "break", ";", "for", "(", "x", "=", "0", ";", "x", "<", "(", "(", "ssize_t", ")", "image", "-", ">", "columns", "-", "1", ")", ";", "x", "+", "=", "2", ")", "for", "(", "x", "=", "0", ";", "x", "<", "(", "(", "ssize_t", ")", "image", "-", ">", "columns", "-", "3", ")", ";", "x", "+", "=", "4", ")", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "6", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "2", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "p", "+", "+;", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "6", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "2", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "p", "+", "+;", "}", "if", "(", "(", "image", "-", ">", "columns", "%", "4", ")", "!", "=", "0", ")", "if", "(", "(", "image", "-", ">", "columns", "%", "4", ")", "!", "=", "0", ")", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "6", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "if", "(", "(", "image", "-", ">", "columns", "%", "4", ")", ">", "=", "1", ")", "if", "(", "(", "image", "-", ">", "columns", "%", "4", ")", ">", "1", ")", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "if", "(", "(", "image", "-", ">", "columns", "%", "4", ")", ">", "=", "2", ")", "if", "(", "(", "image", "-", ">", "columns", "%", "4", ")", ">", "2", ")", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "2", ")", "&", "0x3", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "}", "p", "+", "+;", "}", "(", "void", ")", "SyncAuthenticPixels", "(", "image", ",", "exception", ")", ";", "break", ";", "}", "case", "4", ":", "/", "*", "Convert", "PseudoColor", "scanline", ".", "*", "/", "{", "q", "=", "QueueAuthenticPixels", "(", "image", ",", "0", ",", "y", ",", "image", "-", ">", "columns", ",", "1", ",", "exception", ")", ";", "if", "(", "q", "=", "=", "(", "Quantum", "*", ")", "NULL", ")", "break", ";", "for", "(", "x", "=", "0", ";", "x", "<", "(", "(", "ssize_t", ")", "image", "-", ">", "columns", "-", "1", ")", ";", "x", "+", "=", "2", ")", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0xf", ",", "exception", ")", ";", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0x0f", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ")", "&", "0xf", ",", "exception", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ")", "&", "0x0f", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "p", "+", "+;", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "if", "(", "(", "image", "-", ">", "columns", "%", "2", ")", "!", "=", "0", ")", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0xf", ",", "exception", ")", ";", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "(*", "p", ">", ">", "4", ")", "&", "0x0f", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "p", "+", "+;", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "(", "void", ")", "SyncAuthenticPixels", "(", "image", ",", "exception", ")", ";", "break", ";", "}", "case", "8", ":", "/", "*", "Convert", "PseudoColor", "scanline", ".", "*", "/", "{", "q", "=", "QueueAuthenticPixels", "(", "image", ",", "0", ",", "y", ",", "image", "-", ">", "columns", ",", "1", ",", "exception", ")", ";", "if", "(", "q", "=", "=", "(", "Quantum", "*", ")", "NULL", ")", "break", ";", "for", "(", "x", "=", "0", ";", "x", "<", "(", "ssize_t", ")", "image", "-", ">", "columns", ";", "x", "+", "+)", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "*", "p", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "if", "(", "index", "<", "image", "-", ">", "colors", ")", "SetPixelViaPixelInfo", "(", "image", ",", "image", "-", ">", "colormap", "+", "(", "ssize_t", ")", "index", ",", "q", ")", ";", "p", "+", "+;", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "}", "break", ";", "case", "24", ":", "/", "*", "Convert", "DirectColor", "scanline", ".", "*", "/", "for", "(", "x", "=", "0", ";", "x", "<", "(", "ssize_t", ")", "image", "-", ">", "columns", ";", "x", "+", "+)", "{", "index", "=", "ConstrainColormapIndex", "(", "image", ",", "*", "p", ",", "exception", ")", ";", "SetPixelIndex", "(", "image", ",", "index", ",", "q", ")", ";", "p", "+", "+;", "SetPixelRed", "(", "image", ",", "ScaleCharToQuantum", "(", "*", "p", "+", "+)", ",", "q", ")", ";", "SetPixelGreen", "(", "image", ",", "ScaleCharToQuantum", "(", "*", "p", "+", "+)", ",", "q", ")", ";", "SetPixelBlue", "(", "image", ",", "ScaleCharToQuantum", "(", "*", "p", "+", "+)", ",", "q", ")", ";", "q", "+", "=", "GetPixelChannels", "(", "image", ")", ";", "}", "(", "void", ")", "SyncAuthenticPixels", "(", "image", ",", "exception", ")", ";", "break", ";", "}", "break", ";", "}", "if", "(", "!", "SyncAuthenticPixels", "(", "image", ",", "exception", ")", ")", "return", "(", "MagickFalse", ")", ";", "return", "(", "MagickTrue", ")", ";", "}", "/", "*"], "docstring_tokens": ["via", "a", "crafted", "image", "file", "due", "to", "an", "out-of-bounds", "write", "."]}
{"contents": ["powerpc/tm:", "Check", "for", "already", "reclaimed", "tasks", "Currently", "we", "can", "hit", "a", "scenario", "where", "we'll", "tm_reclaim()", "twice.", "This", "results", "in", "a", "TM", "bad", "thing", "exception", "because", "the", "second", "reclaim", "occurs", "when", "not", "in", "suspend", "mode.", "The", "scenario", "in", "which", "this", "can", "happen", "is", "the", "following.", "We", "attempt", "to", "deliver", "a", "signal", "to", "userspace.", "To", "do", "this", "we", "need", "obtain", "the", "stack", "pointer", "to", "write", "the", "signal", "context.", "To", "get", "this", "stack", "pointer", "we", "must", "tm_reclaim()", "in", "case", "we", "need", "to", "use", "the", "checkpointed", "stack", "pointer", "(see", "get_tm_stackpointer()).", "Normally", "we'd", "then", "return", "directly", "to", "userspace", "to", "deliver", "the", "signal", "without", "going", "through", "__switch_to().", "Unfortunatley,", "if", "at", "this", "point", "we", "get", "an", "error", "(such", "as", "a", "bad", "userspace", "stack", "pointer),", "we", "need", "to", "exit", "the", "process.", "The", "exit", "will", "result", "in", "a", "__switch_to().", "__switch_to()", "will", "attempt", "to", "save", "the", "process", "state", "which", "results", "in", "another", "tm_reclaim().", "This", "tm_reclaim()", "now", "causes", "a", "TM", "Bad", "Thing", "exception", "as", "this", "state", "has", "already", "been", "saved", "and", "the", "processor", "is", "no", "longer", "in", "TM", "suspend", "mode.", "Whee!", "This", "patch", "checks", "the", "state", "of", "the", "MSR", "to", "ensure", "we", "are", "TM", "suspended", "before", "we", "attempt", "the", "tm_reclaim().", "If", "we've", "already", "saved", "the", "state", "away,", "we", "should", "no", "longer", "be", "in", "TM", "suspend", "mode.", "This", "has", "the", "additional", "advantage", "of", "checking", "for", "a", "potential", "TM", "Bad", "Thing", "exception.", "Found", "using", "syscall", "fuzzer.", "Fixes:", "fb09692e71f1", "(\"powerpc:", "Add", "reclaim", "and", "recheckpoint", "functions", "for", "context", "switching", "transactional", "memory", "processes\")", "Cc:", "stable@vger.kernel.org", "#", "v3.9+", "Signed-off-by:", "Michael", "Neuling", "<mikey@neuling.org>", "Signed-off-by:", "Michael", "Ellerman", "<mpe@ellerman.id.au>"], "code_tokens": ["@", "@", "-", "551", ",", "6", "+", "551", ",", "24", "@", "@", "static", "void", "tm_reclaim_thread", "(", "struct", "thread_struct", "*", "thr", ",", "msr_diff", "&", "=", "MSR_FP", "|", "MSR_VEC", "|", "MSR_VSX", "|", "MSR_FE0", "|", "MSR_FE1", ";", "}", "/", "*", "*", "Use", "the", "current", "MSR", "TM", "suspended", "bit", "to", "track", "if", "we", "have", "*", "checkpointed", "state", "outstanding", ".", "*", "On", "signal", "delivery", ",", "we", "'", "d", "normally", "reclaim", "the", "checkpointed", "*", "state", "to", "obtain", "stack", "pointer", "(", "see", ":", "get_tm_stackpointer", "(", "))", ".", "*", "This", "will", "then", "directly", "return", "to", "userspace", "without", "going", "*", "through", "__switch_to", "(", ").", "However", ",", "if", "the", "stack", "frame", "is", "bad", ",", "*", "we", "need", "to", "exit", "this", "thread", "which", "calls", "__switch_to", "(", ")", "which", "*", "will", "again", "attempt", "to", "reclaim", "the", "already", "saved", "tm", "state", ".", "*", "Hence", "we", "need", "to", "check", "that", "we", "'", "ve", "not", "already", "reclaimed", "*", "this", "state", ".", "*", "We", "do", "this", "using", "the", "current", "MSR", ",", "rather", "tracking", "it", "in", "*", "some", "specific", "thread_struct", "bit", ",", "as", "it", "has", "the", "additional", "*", "benifit", "of", "checking", "for", "a", "potential", "TM", "bad", "thing", "exception", ".", "*", "/", "if", "(", "!", "MSR_TM_SUSPENDED", "(", "mfmsr", "(", "))", ")", "return", ";", "tm_reclaim", "(", "thr", ",", "thr", "-", ">", "regs", "-", ">", "msr", ",", "cause", ")", ";", "/", "*", "Having", "done", "the", "reclaim", ",", "we", "now", "have", "the", "checkpointed"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Fix", "bug", "#61755", "parsing", "bug", "can", "lead", "to", "access", "violations"], "code_tokens": ["@", "@", "-", "6", ",", "7", "+", "6", ",", "10", "@", "@", "PHP", "NEWS", ".", "Fixed", "bug", "#", "61537", "(", "json_encode", "(", ")", "incorrectly", "truncates", "/", "discards", "information", ")", ".", "(", "Adam", ")", "?", "?", "?", "??", "2012", ",", "PHP", "5", ".", "3", ".", "11", "-", "PDO", ":", ".", "Fixed", "bug", "#", "61755", "(", "A", "parsing", "bug", "in", "the", "prepared", "statements", "can", "lead", "to", "access", "violations", ")", ".", "(", "Johannes", ")", "-", "Iconv", "extension", ":", ".", "Fixed", "a", "bug", "that", "iconv", "extension", "fails", "to", "link", "to", "the", "correct", "library", "when", "another", "extension", "makes", "use", "of", "a", "library", "that", "links", "to", "the", "iconv", "@", "@", "-", "32", ",", "12", "+", "32", ",", "12", "@", "@", "#", "define", "YYCTYPE", "unsigned", "char", "#", "define", "YYCURSOR", "cursor", "#", "define", "YYLIMIT", "cursor", "#", "define", "YYLIMIT", "s", "-", ">", "end", "#", "define", "YYMARKER", "s", "-", ">", "ptr", "#", "define", "YYFILL", "(", "n", ")", "#", "define", "YYFILL", "(", "n", ")", "{", "RET", "(", "PDO_PARSER_EOI", ")", ";", "}", "typedef", "struct", "Scanner", "{", "char", "*", "ptr", ",", "*", "cur", ",", "*", "tok", ";", "char", "*", "ptr", ",", "*", "cur", ",", "*", "tok", ",", "*", "end", ";", "}", "Scanner", ";", "static", "int", "scan", "(", "Scanner", "*", "s", ")", "@", "@", "-", "51", ",", "7", "+", "51", ",", "6", "@", "@", "static", "int", "scan", "(", "Scanner", "*", "s", ")", "COMMENTS", "=", "(", "\"/", "*\"", "([", "^*", "]+", "|[", "*]", "+[", "^/", "*]", ")*", "[*", "]*", "\"*", "/\"", "|\"", "--", "\"[", "^\\", "r", "\\", "n", "]", "*)", ";", "SPECIALS", "=", "[", ":?", "\"'", "];", "MULTICHAR", "=", "[", ":?", "];", "EOF", "=", "[", "\\", "000", "]", ";", "ANYNOEOF", "=", "[", "\\", "001", "-", "\\", "377", "]", ";", "*", "/", "@", "@", "-", "64", ",", "7", "+", "63", ",", "6", "@", "@", "static", "int", "scan", "(", "Scanner", "*", "s", ")", "SPECIALS", "{", "SKIP_ONE", "(", "PDO_PARSER_TEXT", ")", ";", "}", "COMMENTS", "{", "RET", "(", "PDO_PARSER_TEXT", ")", ";", "}", "(", "ANYNOEOF", "\\", "SPECIALS", ")", "+", "{", "RET", "(", "PDO_PARSER_TEXT", ")", ";", "}", "EOF", "{", "RET", "(", "PDO_PARSER_EOI", ")", ";", "}", "*", "/", "}", "@", "@", "-", "94", ",", "6", "+", "92", ",", "7", "@", "@", "PDO_API", "int", "pdo_parse_params", "(", "pdo_stmt_t", "*", "stmt", ",", "char", "*", "inquery", ",", "int", "inquery_len", ",", "ptr", "=", "*", "outquery", ";", "s", ".", "cur", "=", "inquery", ";", "s", ".", "end", "=", "inquery", "+", "inquery_len", "+", "1", ";", "/", "*", "phase", "1", ":", "look", "for", "args", "*", "/", "while", "(", "(", "t", "=", "scan", "(", "&", "s", ")", ")", "!", "=", "PDO_PARSER_EOI", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "61755", "(", "A", "parsing", "bug", "in", "the", "prepared", "statements", "can", "lead", "to", "access", "violations", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "pdo", "'", ")", "|", "|", "!", "extension_loaded", "(", "'", "pdo_mysql", "'", "))", "die", "(", "'", "skip", "not", "loaded", "'", ");", "require", "dirname", "(", "__FILE__", ")", ".", "'", "/", "config", ".", "inc", "'", ";", "require", "dirname", "(", "__FILE__", ")", ".", "'", "/.", "./", "..", "/.", "./", "ext", "/", "pdo", "/", "tests", "/", "pdo_test", ".", "inc", "'", ";", "PDOTest", ":", ":", "skip", "(", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "require", "dirname", "(", "__FILE__", ")", ".", "'", "/.", "./", "..", "/.", "./", "ext", "/", "pdo", "/", "tests", "/", "pdo_test", ".", "inc", "'", ";", "$", "db", "=", "PDOTest", ":", ":", "test_factory", "(", "dirname", "(", "__FILE__", ")", ".", "'", "/", "common", ".", "phpt", "'", ");", "$", "db", "-", ">", "setAttribute", "(", "PDO", ":", ":", "ATTR_ERRMODE", ",", "PDO", ":", ":", "ERRMODE_EXCEPTION", ")", ";", "echo", "\"", "NULL", "-", "Byte", "before", "first", "placeholder", ":", "\\", "n", "\"", ";", "$", "s", "=", "$", "db", "-", ">", "prepare", "(", "\"", "SELECT", "\\", "\"", "a", "\\", "0b", "\\", "\",", "?", "\")", ";", "$", "s", "-", ">", "bindValue", "(", "1", ",", "\"", "c", "\"", ");", "$", "s", "-", ">", "execute", "(", ");", "$", "r", "=", "$", "s", "-", ">", "fetch", "(", ");", "echo", "\"", "Length", "of", "item", "0", ":", "\"", ".", "strlen", "(", "$", "r", "[", "0", "]", ").", "\",", "Value", "of", "item", "1", ":", "\"", ".$", "r", "[", "1", "]", ".\"", "\\", "n", "\"", ";", "echo", "\"", "\\", "nOpen", "comment", ":", "\\", "n", "\"", ";", "try", "{", "$", "s", "=", "$", "db", "-", ">", "prepare", "(", "\"", "SELECT", "/", "*\"", ");", "$", "s", "-", ">", "execute", "(", ");", "}", "catch", "(", "Exception", "$", "e", ")", "{", "echo", "\"", "Error", "code", ":", "\"", ".$", "e", "-", ">", "getCode", "(", ").", "\"\\", "n", "\"", ";", "}", "echo", "\"", "\\", "ndone", "!", "\\", "n", "\"", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "NULL", "-", "Byte", "before", "first", "placeholder", ":", "Length", "of", "item", "0", ":", "3", ",", "Value", "of", "item", "1", ":", "c", "Open", "comment", ":", "Error", "code", ":", "42000", "done", "!"], "docstring_tokens": ["via", "a", "crafted", "parameter", "value", "."]}
{"contents": ["clocksource/drivers/arm_arch_timer:", "Avoid", "infinite", "recursion", "when", "ftrace", "is", "enabled", "On", "platforms", "with", "an", "arch", "timer", "erratum", "workaround,", "it's", "possible", "for", "arch_timer_reg_read_stable()", "to", "recurse", "into", "itself", "when", "certain", "tracing", "options", "are", "enabled,", "leading", "to", "stack", "overflows", "and", "related", "problems.", "For", "example,", "when", "PREEMPT_TRACER", "and", "FUNCTION_GRAPH_TRACER", "are", "selected,", "it's", "possible", "to", "trigger", "this", "with:", "$", "mount", "-t", "debugfs", "nodev", "/sys/kernel/debug/", "$", "echo", "function_graph", ">", "/sys/kernel/debug/tracing/current_tracer", "The", "problem", "is", "that", "in", "such", "cases,", "preempt_disable()", "instrumentation", "attempts", "to", "acquire", "a", "timestamp", "via", "trace_clock(),", "resulting", "in", "a", "call", "back", "to", "arch_timer_reg_read_stable(),", "and", "hence", "recursion.", "This", "patch", "changes", "arch_timer_reg_read_stable()", "to", "use", "preempt_{disable,enable}_notrace(),", "which", "avoids", "this.", "This", "problem", "is", "similar", "to", "the", "fixed", "by", "upstream", "commit", "96b3d28bf4", "(\"sched/clock:", "Prevent", "tracing", "recursion", "in", "sched_clock_cpu()\").", "Fixes:", "6acc71ccac71", "(\"arm64:", "arch_timer:", "Allows", "a", "CPU-specific", "erratum", "to", "only", "affect", "a", "subset", "of", "CPUs\")", "Signed-off-by:", "Ding", "Tianhong", "<dingtianhong@huawei.com>", "Acked-by:", "Mark", "Rutland", "<mark.rutland@arm.com>", "Acked-by:", "Marc", "Zyngier", "<marc.zyngier@arm.com>", "Signed-off-by:", "Daniel", "Lezcano", "<daniel.lezcano@linaro.org>"], "code_tokens": ["@", "@", "-", "65", ",", "13", "+", "65", ",", "13", "@", "@", "DECLARE_PER_CPU", "(", "const", "struct", "arch_timer_erratum_workaround", "*", ",", "u64", "_val", ";", "\\", "if", "(", "needs_unstable_timer_counter_workaround", "(", "))", "{", "\\", "const", "struct", "arch_timer_erratum_workaround", "*", "wa", ";", "\\", "preempt_disable", "(", ");", "\\", "preempt_disable_notrace", "(", ");", "\\", "wa", "=", "__this_cpu_read", "(", "timer_unstable_counter_workaround", ")", ";", "\\", "if", "(", "wa", "&", "&", "wa", "-", ">", "read_", "#", "#", "reg", ")", "\\", "_val", "=", "wa", "-", ">", "read_", "#", "#", "reg", "(", ");", "\\", "else", "\\", "_val", "=", "read_sysreg", "(", "reg", ")", ";", "\\", "preempt_enable", "(", ");", "\\", "preempt_enable_notrace", "(", ");", "\\", "}", "else", "{", "\\", "_val", "=", "read_sysreg", "(", "reg", ")", ";", "\\", "}", "\\"], "docstring_tokens": ["using", "a", "specially-crafted", "file"]}
{"contents": ["Fixed", "bug", "#20927", "and", "updated", "the", "test", "case", "for", "the", "bug."], "code_tokens": ["@", "@", "-", "628", ",", "7", "+", "628", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "{", "const", "char", "*", "text", ",", "*", "breakchar", "=", "\"", "\\", "n", "\"", ";", "char", "*", "newtext", ";", "int", "textlen", ",", "breakcharlen", "=", "1", ",", "newtextlen", ";", "int", "textlen", ",", "breakcharlen", "=", "1", ",", "newtextlen", ",", "alloced", ",", "chk", ";", "long", "current", "=", "0", ",", "laststart", "=", "0", ",", "lastspace", "=", "0", ";", "long", "linelength", "=", "75", ";", "zend_bool", "docut", "=", "0", ";", "@", "@", "-", "670", ",", "18", "+", "670", ",", "24", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "}", "else", "{", "/", "*", "Multiple", "character", "line", "break", "or", "forced", "cut", "*", "/", "if", "(", "linelength", ">", "0", ")", "{", "/", "*", "Add", "extra", "10", "%", "to", "accomodate", "strings", "with", "unpredicatable", "number", "of", "breaks", "*", "/", "newtextlen", "=", "textlen", "+", "(", "int", ")", "((", "textlen", "/", "linelength", "+", "1", ")", "*", "breakcharlen", "*", "1", ".", "1", ")", "+", "1", ";", "chk", "=", "(", "int", ")", "(", "textlen", "/", "linelength", "+", "1", ")", ";", "alloced", "=", "textlen", "+", "chk", "*", "breakcharlen", "+", "1", ";", "}", "else", "{", "newtextlen", "=", "textlen", "*", "(", "breakcharlen", "+", "1", ")", "+", "1", ";", "chk", "=", "textlen", ";", "alloced", "=", "textlen", "*", "(", "breakcharlen", "+", "1", ")", "+", "1", ";", "}", "newtext", "=", "emalloc", "(", "newtextlen", ")", ";", "newtext", "=", "emalloc", "(", "alloced", ")", ";", "/", "*", "now", "keep", "track", "of", "the", "actual", "new", "text", "length", "*", "/", "newtextlen", "=", "0", ";", "laststart", "=", "lastspace", "=", "0", ";", "for", "(", "current", "=", "0", ";", "current", "<", "textlen", ";", "current", "+", "+)", "{", "if", "(", "chk", "<", "=", "0", ")", "{", "alloced", "+", "=", "(", "int", ")", "(", "((", "textlen", "-", "current", "+", "1", ")", "/", "linelength", "+", "1", ")", "*", "breakcharlen", ")", "+", "1", ";", "newtext", "=", "erealloc", "(", "newtext", ",", "alloced", ")", ";", "chk", "=", "(", "int", ")", "(", "(", "textlen", "-", "current", ")", "/", "linelength", ")", "+", "1", ";", "}", "/", "*", "when", "we", "hit", "an", "existing", "break", ",", "copy", "to", "new", "buffer", ",", "and", "*", "fix", "up", "laststart", "and", "lastspace", "*", "/", "if", "(", "text", "[", "current", "]", "=", "=", "breakchar", "[", "0", "]", "@", "@", "-", "691", ",", "6", "+", "697", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "newtextlen", "+", "=", "current", "-", "laststart", "+", "breakcharlen", ";", "current", "+", "=", "breakcharlen", "-", "1", ";", "laststart", "=", "lastspace", "=", "current", "+", "1", ";", "chk", "-", "-;", "}", "/", "*", "if", "it", "is", "a", "space", ",", "check", "if", "it", "is", "at", "the", "line", "boundary", ",", "*", "copy", "and", "insert", "a", "break", ",", "or", "just", "keep", "track", "of", "it", "*", "/", "@", "@", "-", "701", ",", "6", "+", "708", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "memcpy", "(", "newtext", "+", "newtextlen", ",", "breakchar", ",", "breakcharlen", ")", ";", "newtextlen", "+", "=", "breakcharlen", ";", "laststart", "=", "current", "+", "1", ";", "chk", "-", "-;", "}", "lastspace", "=", "current", ";", "}", "@", "@", "-", "714", ",", "6", "+", "722", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "memcpy", "(", "newtext", "+", "newtextlen", ",", "breakchar", ",", "breakcharlen", ")", ";", "newtextlen", "+", "=", "breakcharlen", ";", "laststart", "=", "lastspace", "=", "current", ";", "chk", "-", "-;", "}", "/", "*", "if", "the", "current", "word", "puts", "us", "over", "the", "linelength", ",", "copy", "*", "back", "up", "until", "the", "last", "space", ",", "insert", "a", "break", ",", "and", "move", "@", "@", "-", "725", ",", "6", "+", "734", ",", "7", "@", "@", "PHP_FUNCTION", "(", "wordwrap", ")", "memcpy", "(", "newtext", "+", "newtextlen", ",", "breakchar", ",", "breakcharlen", ")", ";", "newtextlen", "+", "=", "breakcharlen", ";", "laststart", "=", "lastspace", "=", "lastspace", "+", "1", ";", "chk", "-", "-;", "}", "}", "@", "@", "-", "3", ",", "17", "+", "3", ",", "16", "@", "@", "Segfault", "on", "wordwrap", "statement", "bug", "#", "20927", "-", "-", "SKIPIF", "-", "-", "FILE", "<", "?", "php", "$", "x", "=", "\"", "ADV", ":", "CLAIM", "YOUR", "FORTUNE", "NOW", "!", "!", "MAKE", "\"", ";", "$", "x", ".", "=", "\"", "xxxxxxxxxxHUNDREDS", "OF", "THOUSANDSxxxxxxxxxxxx", "\"", ";", "$", "b", "=", "\"", "CANITBREAKFOO", "\\", "n", "\"", ";", "$", "x", "=", "wordwrap", "(", "$", "x", ",", "20", ",", "$", "b", ",", "1", ")", ";", "$", "x", "=", "wordwrap", "(", "$", "x", ",", "20", ",", "$", "b", ",", "1", ")", ";", "print", "\"", "$", "x", "\\", "n", "\"", ";", "$", "string", "=", "str_repeat", "(", "\"", "1234567890", "X", "\"", ",", "10", ")", ";", "$", "break", "=", "str_repeat", "(", "\"", "a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap", "\"", ",", "8", ")", ";", "$", "linelength", "=", "10", ";", "echo", "\"", "Length", "of", "original", "string", ":", "\"", ".", "strlen", "(", "$", "string", ")", ".\"", "\\", "n", "\"", ";", "echo", "\"", "Length", "of", "break", "string", ":", "\"", ".", "strlen", "(", "$", "break", ")", ".\"", "\\", "n", "\"", ";", "var_dump", "(", "wordwrap", "(", "$", "string", ",", "$", "linelength", ",", "$", "break", ",", "1", ")", ");", "?", ">", "-", "-", "EXPECT", "ADV", ":", "CLAIM", "YOURCANITBREAKFOO", "FORTUNE", "NOW", "!", "!", "MAKECANITBREAKFOO", "xxxxxxxxxxHUNDREDSCANITBREAKFOO", "OFCANITBREAKFOO", "THOUSANDSxxxxxxxxxxxCANITBREAKFOO", "x", "Length", "of", "original", "string", ":", "130", "Length", "of", "break", "string", ":", "352", "string", "(", "6799", ")", "\"", "1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapXa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heap1234567890a", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapa", "-", "very", "-", "long", "-", "break", "-", "string", "-", "to", "-", "clobber", "-", "the", "-", "heapX", "\""], "docstring_tokens": ["sending"]}
{"contents": ["net:", "sctp:", "fix", "slab", "corruption", "from", "use", "after", "free", "on", "INIT", "collisions", "When", "hitting", "an", "INIT", "collision", "case", "during", "the", "4WHS", "with", "AUTH", "enabled,", "as", "already", "described", "in", "detail", "in", "commit", "1be9a950c646", "(\"net:", "sctp:", "inherit", "auth_capable", "on", "INIT", "collisions\"),", "it", "can", "happen", "that", "we", "occasionally", "still", "remotely", "trigger", "the", "following", "panic", "on", "server", "side", "which", "seems", "to", "have", "been", "uncovered", "after", "the", "fix", "from", "commit", "1be9a950c646", "...", "[", "533.876389]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "00000000ffffffff", "[", "533.913657]", "IP:", "[<ffffffff811ac385>]", "__kmalloc+0x95/0x230", "[", "533.940559]", "PGD", "5030f2067", "PUD", "0", "[", "533.957104]", "Oops:", "0000", "[#1]", "SMP", "[", "533.974283]", "Modules", "linked", "in:", "sctp", "mlx4_en", "[...]", "[", "534.939704]", "Call", "Trace:", "[", "534.951833]", "[<ffffffff81294e30>]", "?", "crypto_init_shash_ops+0x60/0xf0", "[", "534.984213]", "[<ffffffff81294e30>]", "crypto_init_shash_ops+0x60/0xf0", "[", "535.015025]", "[<ffffffff8128c8ed>]", "__crypto_alloc_tfm+0x6d/0x170", "[", "535.045661]", "[<ffffffff8128d12c>]", "crypto_alloc_base+0x4c/0xb0", "[", "535.074593]", "[<ffffffff8160bd42>]", "?", "_raw_spin_lock_bh+0x12/0x50", "[", "535.105239]", "[<ffffffffa0418c11>]", "sctp_inet_listen+0x161/0x1e0", "[sctp]", "[", "535.138606]", "[<ffffffff814e43bd>]", "SyS_listen+0x9d/0xb0", "[", "535.166848]", "[<ffffffff816149a9>]", "system_call_fastpath+0x16/0x1b", "...", "or", "depending", "on", "the", "the", "application,", "for", "example", "this", "one:", "[", "1370.026490]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "00000000ffffffff", "[", "1370.026506]", "IP:", "[<ffffffff811ab455>]", "kmem_cache_alloc+0x75/0x1d0", "[", "1370.054568]", "PGD", "633c94067", "PUD", "0", "[", "1370.070446]", "Oops:", "0000", "[#1]", "SMP", "[", "1370.085010]", "Modules", "linked", "in:", "sctp", "kvm_amd", "kvm", "[...]", "[", "1370.963431]", "Call", "Trace:", "[", "1370.974632]", "[<ffffffff8120f7cf>]", "?", "SyS_epoll_ctl+0x53f/0x960", "[", "1371.000863]", "[<ffffffff8120f7cf>]", "SyS_epoll_ctl+0x53f/0x960", "[", "1371.027154]", "[<ffffffff812100d3>]", "?", "anon_inode_getfile+0xd3/0x170", "[", "1371.054679]", "[<ffffffff811e3d67>]", "?", "__alloc_fd+0xa7/0x130", "[", "1371.080183]", "[<ffffffff816149a9>]", "system_call_fastpath+0x16/0x1b", "With", "slab", "debugging", "enabled,", "we", "can", "see", "that", "the", "poison", "has", "been", "overwritten:", "[", "669.826368]", "BUG", "kmalloc-128", "(Tainted:", "G", "W", "):", "Poison", "overwritten", "[", "669.826385]", "INFO:", "0xffff880228b32e50-0xffff880228b32e50.", "First", "byte", "0x6a", "instead", "of", "0x6b", "[", "669.826414]", "INFO:", "Allocated", "in", "sctp_auth_create_key+0x23/0x50", "[sctp]", "age=3", "cpu=0", "pid=18494", "[", "669.826424]", "__slab_alloc+0x4bf/0x566", "[", "669.826433]", "__kmalloc+0x280/0x310", "[", "669.826453]", "sctp_auth_create_key+0x23/0x50", "[sctp]", "[", "669.826471]", "sctp_auth_asoc_create_secret+0xcb/0x1e0", "[sctp]", "[", "669.826488]", "sctp_auth_asoc_init_active_key+0x68/0xa0", "[sctp]", "[", "669.826505]", "sctp_do_sm+0x29d/0x17c0", "[sctp]", "[...]", "[", "669.826629]", "INFO:", "Freed", "in", "kzfree+0x31/0x40", "age=1", "cpu=0", "pid=18494", "[", "669.826635]", "__slab_free+0x39/0x2a8", "[", "669.826643]", "kfree+0x1d6/0x230", "[", "669.826650]", "kzfree+0x31/0x40", "[", "669.826666]", "sctp_auth_key_put+0x19/0x20", "[sctp]", "[", "669.826681]", "sctp_assoc_update+0x1ee/0x2d0", "[sctp]", "[", "669.826695]", "sctp_do_sm+0x674/0x17c0", "[sctp]", "Since", "this", "only", "triggers", "in", "some", "collision-cases", "with", "AUTH,", "the", "problem", "at", "heart", "is", "that", "sctp_auth_key_put()", "on", "asoc->asoc_shared_key", "is", "called", "twice", "when", "having", "refcnt", "1,", "once", "directly", "in", "sctp_assoc_update()", "and", "yet", "again", "from", "within", "sctp_auth_asoc_init_active_key()", "via", "sctp_assoc_update()", "on", "the", "already", "kzfree'd", "memory,", "which", "is", "also", "consistent", "with", "the", "observation", "of", "the", "poison", "decrease", "from", "0x6b", "to", "0x6a", "(note:", "the", "overwrite", "is", "detected", "at", "a", "later", "point", "in", "time", "when", "poison", "is", "checked", "on", "new", "allocation).", "Reference", "counting", "of", "auth", "keys", "revisited:", "Shared", "keys", "for", "AUTH", "chunks", "are", "being", "stored", "in", "endpoints", "and", "associations", "in", "endpoint_shared_keys", "list.", "On", "endpoint", "creation,", "a", "null", "key", "is", "being", "added;", "on", "association", "creation,", "all", "endpoint", "shared", "keys", "are", "being", "cached", "and", "thus", "cloned", "over", "to", "the", "association.", "struct", "sctp_shared_key", "only", "holds", "a", "pointer", "to", "the", "actual", "key", "bytes,", "that", "is,", "struct", "sctp_auth_bytes", "which", "keeps", "track", "of", "users", "internally", "through", "refcounting.", "Naturally,", "on", "assoc", "or", "enpoint", "destruction,", "sctp_shared_key", "are", "being", "destroyed", "directly", "and", "the", "reference", "on", "sctp_auth_bytes", "dropped.", "User", "space", "can", "add", "keys", "to", "either", "list", "via", "setsockopt(2)", "through", "struct", "sctp_authkey", "and", "by", "passing", "that", "to", "sctp_auth_set_key()", "which", "replaces", "or", "adds", "a", "new", "auth", "key.", "There,", "sctp_auth_create_key()", "creates", "a", "new", "sctp_auth_bytes", "with", "refcount", "1", "and", "in", "case", "of", "replacement", "drops", "the", "reference", "on", "the", "old", "sctp_auth_bytes.", "A", "key", "can", "be", "set", "active", "from", "user", "space", "through", "setsockopt()", "on", "the", "id", "via", "sctp_auth_set_active_key(),", "which", "iterates", "through", "either", "endpoint_shared_keys", "and", "in", "case", "of", "an", "assoc,", "invokes", "(one", "of", "various", "places)", "sctp_auth_asoc_init_active_key().", "sctp_auth_asoc_init_active_key()", "computes", "the", "actual", "secret", "from", "local's", "and", "peer's", "random,", "hmac", "and", "shared", "key", "parameters", "and", "returns", "a", "new", "key", "directly", "as", "sctp_auth_bytes,", "that", "is", "asoc->asoc_shared_key,", "plus", "drops", "the", "reference", "if", "there", "was", "a", "previous", "one.", "The", "secret,", "which", "where", "we", "eventually", "double", "drop", "the", "ref", "comes", "from", "sctp_auth_asoc_set_secret()", "with", "intitial", "refcount", "of", "1,", "which", "also", "stays", "unchanged", "eventually", "in", "sctp_assoc_update().", "This", "key", "is", "later", "being", "used", "for", "crypto", "layer", "to", "set", "the", "key", "for", "the", "hash", "in", "crypto_hash_setkey()", "from", "sctp_auth_calculate_hmac().", "To", "close", "the", "loop:", "asoc->asoc_shared_key", "is", "freshly", "allocated", "secret", "material", "and", "independant", "of", "the", "sctp_shared_key", "management", "keeping", "track", "of", "only", "shared", "keys", "in", "endpoints", "and", "assocs.", "Hence,", "also", "commit", "4184b2a79a76", "(\"net:", "sctp:", "fix", "memory", "leak", "in", "auth", "key", "management\")", "is", "independant", "of", "this", "bug", "here", "since", "it", "concerns", "a", "different", "layer", "(though", "same", "structures", "being", "used", "eventually).", "asoc->asoc_shared_key", "is", "reference", "dropped", "correctly", "on", "assoc", "destruction", "in", "sctp_association_free()", "and", "when", "active", "keys", "are", "being", "replaced", "in", "sctp_auth_asoc_init_active_key(),", "it", "always", "has", "a", "refcount", "of", "1.", "Hence,", "it's", "freed", "prematurely", "in", "sctp_assoc_update().", "Simple", "fix", "is", "to", "remove", "that", "sctp_auth_key_put()", "from", "there", "which", "fixes", "these", "panics.", "Fixes:", "730fc3d05cd4", "(\"[SCTP]:", "Implete", "SCTP-AUTH", "parameter", "processing\")", "Signed-off-by:", "Daniel", "Borkmann", "<dborkman@redhat.com>", "Acked-by:", "Vlad", "Yasevich", "<vyasevich@gmail.com>", "Acked-by:", "Neil", "Horman", "<nhorman@tuxdriver.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1182", ",", "7", "+", "1182", ",", "6", "@", "@", "void", "sctp_assoc_update", "(", "struct", "sctp_association", "*", "asoc", ",", "asoc", "-", ">", "peer", ".", "peer_hmacs", "=", "new", "-", ">", "peer", ".", "peer_hmacs", ";", "new", "-", ">", "peer", ".", "peer_hmacs", "=", "NULL", ";", "sctp_auth_key_put", "(", "asoc", "-", ">", "asoc_shared_key", ")", ";", "sctp_auth_asoc_init_active_key", "(", "asoc", ",", "GFP_ATOMIC", ")", ";", "}"], "docstring_tokens": ["by", "triggering", "an", "INIT", "collision", "that", "leads", "to", "improper", "handling", "of", "shared-key", "data", "."]}
{"contents": ["ZEPPELIN-3404.", "Fail", "to", "run", "cronjob", "when", "user", "doesn't", "run", "it", "manually", "before", "cronjob", "###", "What", "is", "this", "PR", "for?", "This", "bug", "is", "introduced", "by", "#2914,", "this", "PR", "will", "set", "authenticationInfo", "using", "its", "user", "as", "we", "will", "store", "user", "into", "note.json.", "###", "What", "type", "of", "PR", "is", "it?", "[Bug", "Fix]", "###", "Todos", "*", "[", "]", "-", "Task", "###", "What", "is", "the", "Jira", "issue?", "*", "https://issues.apache.org/jira/browse/ZEPPELIN-3404", "###", "How", "should", "this", "be", "tested?", "*", "Manually", "tested", "###", "Questions:", "*", "Does", "the", "licenses", "files", "need", "update?", "No", "*", "Is", "there", "breaking", "changes", "for", "older", "versions?", "No", "*", "Does", "this", "needs", "documentation?", "No", "Author:", "Jeff", "Zhang", "<zjffdu@apache.org>", "Closes", "#2925", "from", "zjffdu/ZEPPELIN-3404", "and", "squashes", "the", "following", "commits:", "b94ecc9", "[Jeff", "Zhang]", "ZEPPELIN-3404.", "Fail", "to", "run", "cronjob", "when", "user", "doesn't", "run", "it", "manually", "before", "cronjob", "(cherry", "picked", "from", "commit", "1cea92ca30285241239538f358e90dea014b2e5f)", "Signed-off-by:", "Jeff", "Zhang", "<zjffdu@apache.org>"], "code_tokens": ["@", "@", "-", "76", ",", "6", "+", "76", ",", "10", "@", "@", "public", "void", "setRoles", "(", "List", "<", "String", ">", "roles", ")", "{", "this", ".", "roles", "=", "roles", ";", "}", "public", "void", "setRoles", "(", "String", "roles", ")", "{", "this", ".", "roles", "=", "gson", ".", "fromJson", "(", "roles", ",", "ArrayList", ".", "class", ")", ";", "}", "public", "List", "<", "String", ">", "getUsersAndRoles", "(", ")", "{", "List", "<", "String", ">", "usersAndRoles", "=", "new", "ArrayList", "<", ">(", ");", "if", "(", "roles", "!", "=", "null", ")", "{", "@", "@", "-", "447", ",", "19", "+", "447", ",", "17", "@", "@", "function", "NotebookCtrl", "(", "$", "scope", ",", "$", "route", ",", "$", "routeParams", ",", "$", "location", ",", "$", "rootScope", ",", "if", "(", "!$", "scope", ".", "note", ".", "config", ".", "cronExecutingUser", ")", "{", "$", "scope", ".", "note", ".", "config", ".", "cronExecutingUser", "=", "$", "rootScope", ".", "ticket", ".", "principal", ";", "}", "if", "(", "!$", "scope", ".", "note", ".", "config", ".", "cronExecutingRoles", ")", "{", "$", "scope", ".", "note", ".", "config", ".", "cronExecutingRoles", "=", "$", "rootScope", ".", "ticket", ".", "roles", ";", "}", "}", "else", "{", "$", "scope", ".", "note", ".", "config", ".", "cronExecutingUser", "=", "'", "';", "$", "scope", ".", "note", ".", "config", ".", "cronExecutingRoles", "=", "'", "';", "}", "$", "scope", ".", "note", ".", "config", ".", "cron", "=", "cronExpr", ";", "$", "scope", ".", "setConfig", "(", ");", "}", ";", "/", "**", "Set", "the", "username", "of", "the", "user", "to", "be", "used", "to", "execute", "all", "notes", "in", "notebook", "*", "*/", "$", "scope", ".", "setCronExecutingUser", "=", "function", "(", "cronExecutingUser", ")", "{", "$", "scope", ".", "note", ".", "config", ".", "cronExecutingUser", "=", "cronExecutingUser", ";", "$", "scope", ".", "setConfig", "(", ");", "}", ";", "/", "**", "Set", "release", "resource", "for", "this", "note", "*", "*/", "$", "scope", ".", "setReleaseResource", "=", "function", "(", "value", ")", "{", "$", "scope", ".", "note", ".", "config", ".", "releaseresource", "=", "value", ";", "@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "com", ".", "google", ".", "common", ".", "annotations", ".", "VisibleForTesting", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Preconditions", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "com", ".", "google", ".", "gson", ".", "Gson", ";", "import", "com", ".", "google", ".", "gson", ".", "GsonBuilder", ";", "import", "java", ".", "io", ".", "IOException", ";", "@", "@", "-", "31", ",", "6", "+", "32", ",", "7", "@", "@", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ScheduledFuture", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ScheduledThreadPoolExecutor", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "@", "@", "-", "640", ",", "17", "+", "642", ",", "24", "@", "@", "private", "void", "setParagraphMagic", "(", "Paragraph", "p", ",", "int", "index", ")", "{", "*", "Run", "all", "paragraphs", "sequentially", ".", "Only", "used", "for", "CronJob", "*", "/", "public", "synchronized", "void", "runAll", "(", ")", "{", "runAll", "(", "null", ",", "true", ")", ";", "String", "cronExecutingUser", "=", "(", "String", ")", "getConfig", "(", ").", "get", "(", "\"", "cronExecutingUser", "\"", ");", "String", "cronExecutingRoles", "=", "(", "String", ")", "getConfig", "(", ").", "get", "(", "\"", "cronExecutingRoles", "\"", ");", "if", "(", "null", "=", "=", "cronExecutingUser", ")", "{", "cronExecutingUser", "=", "\"", "anonymous", "\"", ";", "}", "AuthenticationInfo", "authenticationInfo", "=", "new", "AuthenticationInfo", "(", "cronExecutingUser", ",", "StringUtils", ".", "isEmpty", "(", "cronExecutingRoles", ")", "?", "null", ":", "cronExecutingRoles", ",", "null", ")", ";", "runAll", "(", "authenticationInfo", ",", "true", ")", ";", "}", "public", "void", "runAll", "(", "AuthenticationInfo", "authenticationInfo", ",", "boolean", "blocking", ")", "{", "for", "(", "Paragraph", "p", ":", "getParagraphs", "(", "))", "{", "if", "(", "!", "p", ".", "isEnabled", "(", "))", "{", "continue", ";", "}", "if", "(", "authenticationInfo", "!", "=", "null", ")", "{", "p", ".", "setAuthenticationInfo", "(", "authenticationInfo", ")", ";", "}", "p", ".", "setAuthenticationInfo", "(", "authenticationInfo", ")", ";", "if", "(", "!", "run", "(", "p", ".", "getId", "(", "),", "blocking", ")", ")", "{", "logger", ".", "warn", "(", "\"", "Skip", "running", "the", "remain", "notes", "because", "paragraph", "{", "}", "fails", "\"", ",", "p", ".", "getId", "(", "))", ";", "break", ";"], "docstring_tokens": ["Note", "permissions"]}
{"contents": ["do_sigaltstack:", "avoid", "copying", "'stack_t'", "as", "a", "structure", "to", "user", "space", "Ulrich", "Drepper", "correctly", "points", "out", "that", "there", "is", "generally", "padding", "in", "the", "structure", "on", "64-bit", "hosts,", "and", "that", "copying", "the", "structure", "from", "kernel", "to", "user", "space", "can", "leak", "information", "from", "the", "kernel", "stack", "in", "those", "padding", "bytes.", "Avoid", "the", "whole", "issue", "by", "just", "copying", "the", "three", "members", "one", "by", "one", "instead,", "which", "also", "means", "that", "the", "function", "also", "can", "avoid", "the", "need", "for", "a", "stack", "frame.", "This", "also", "happens", "to", "match", "how", "we", "copy", "the", "new", "structure", "from", "user", "space,", "so", "it", "all", "even", "makes", "sense.", "[", "The", "obvious", "solution", "of", "adding", "a", "memset()", "generates", "horrid", "code,", "gcc", "does", "really", "stupid", "things.", "]", "Reported-by:", "Ulrich", "Drepper", "<drepper@redhat.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "2454", ",", "11", "+", "2454", ",", "9", "@", "@", "do_sigaltstack", "(", "const", "stack_t", "__user", "*", "uss", ",", "stack_t", "__user", "*", "uoss", ",", "unsigned", "long", "s", "stack_t", "oss", ";", "int", "error", ";", "if", "(", "uoss", ")", "{", "oss", ".", "ss_sp", "=", "(", "void", "__user", "*", ")", "current", "-", ">", "sas_ss_sp", ";", "oss", ".", "ss_size", "=", "current", "-", ">", "sas_ss_size", ";", "oss", ".", "ss_flags", "=", "sas_ss_flags", "(", "sp", ")", ";", "}", "oss", ".", "ss_sp", "=", "(", "void", "__user", "*", ")", "current", "-", ">", "sas_ss_sp", ";", "oss", ".", "ss_size", "=", "current", "-", ">", "sas_ss_size", ";", "oss", ".", "ss_flags", "=", "sas_ss_flags", "(", "sp", ")", ";", "if", "(", "uss", ")", "{", "void", "__user", "*", "ss_sp", ";", "@", "@", "-", "2501", ",", "13", "+", "2499", ",", "16", "@", "@", "do_sigaltstack", "(", "const", "stack_t", "__user", "*", "uss", ",", "stack_t", "__user", "*", "uoss", ",", "unsigned", "long", "s", "current", "-", ">", "sas_ss_size", "=", "ss_size", ";", "}", "error", "=", "0", ";", "if", "(", "uoss", ")", "{", "error", "=", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "uoss", ",", "&", "oss", ",", "sizeof", "(", "oss", ")", "))", "if", "(", "!", "access_ok", "(", "VERIFY_WRITE", ",", "uoss", ",", "sizeof", "(", "*", "uoss", ")", "))", "goto", "out", ";", "error", "=", "__put_user", "(", "oss", ".", "ss_sp", ",", "&", "uoss", "-", ">", "ss_sp", ")", "|", "__put_user", "(", "oss", ".", "ss_size", ",", "&", "uoss", "-", ">", "ss_size", ")", "|", "__put_user", "(", "oss", ".", "ss_flags", ",", "&", "uoss", "-", ">", "ss_flags", ")", ";", "}", "error", "=", "0", ";", "out", ":", "return", "error", ";", "}"], "docstring_tokens": ["copying", "the", "structure", "from", "kernel", "to", "user", "space"]}
{"contents": ["USB:", "digi_acceleport:", "do", "sanity", "checking", "for", "the", "number", "of", "ports", "The", "driver", "can", "be", "crashed", "with", "devices", "that", "expose", "crafted", "descriptors", "with", "too", "few", "endpoints.", "See:", "http://seclists.org/bugtraq/2016/Mar/61", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "[johan:", "fix", "OOB", "endpoint", "check", "and", "add", "error", "messages", "]", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "1251", ",", "8", "+", "1251", ",", "27", "@", "@", "static", "int", "digi_port_init", "(", "struct", "usb_serial_port", "*", "port", ",", "unsigned", "port_num", ")", "static", "int", "digi_startup", "(", "struct", "usb_serial", "*", "serial", ")", "{", "struct", "device", "*", "dev", "=", "&", "serial", "-", ">", "interface", "-", ">", "dev", ";", "struct", "digi_serial", "*", "serial_priv", ";", "int", "ret", ";", "int", "i", ";", "/", "*", "check", "whether", "the", "device", "has", "the", "expected", "number", "of", "endpoints", "*", "/", "if", "(", "serial", "-", ">", "num_port_pointers", "<", "serial", "-", ">", "type", "-", ">", "num_ports", "+", "1", ")", "{", "dev_err", "(", "dev", ",", "\"", "OOB", "endpoints", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "serial", "-", ">", "type", "-", ">", "num_ports", "+", "1", ";", "i", "+", "+)", "{", "if", "(", "!", "serial", "-", ">", "port", "[", "i", "]", "->", "read_urb", ")", "{", "dev_err", "(", "dev", ",", "\"", "bulk", "-", "in", "endpoint", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "if", "(", "!", "serial", "-", ">", "port", "[", "i", "]", "->", "write_urb", ")", "{", "dev_err", "(", "dev", ",", "\"", "bulk", "-", "out", "endpoint", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "}", "serial_priv", "=", "kzalloc", "(", "sizeof", "(", "*", "serial_priv", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "serial_priv", ")"], "docstring_tokens": ["a", "malformed", "device-descriptor", "is", "presented"]}
{"contents": ["fixes", "#8840", "sort", "by", "sanitizing", "and", "email", "header", "injection"], "code_tokens": ["@", "@", "-", "109", ",", "6", "+", "109", ",", "7", "@", "@", "public", "ActionForward", "unspecified", "(", "ActionMapping", "rMapping", ",", "ActionForm", "form", ",", "if", "(", "!", "UtilMethods", ".", "isSet", "(", "invalidCaptchaURL", ")", ")", "{", "invalidCaptchaURL", "=", "errorURL", ";", "}", "invalidCaptchaURL", "=", "invalidCaptchaURL", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "ActionForward", "af", "=", "new", "ActionForward", "(", ");", "af", ".", "setRedirect", "(", "true", ")", ";", "if", "(", "UtilMethods", ".", "isSet", "(", "queryString", ")", ")", "{", "@", "@", "-", "418", ",", "6", "+", "418", ",", "23", "@", "@", "public", "static", "WebForm", "sendParameterizedEmail", "(", "Map", "<", "String", ",", "Object", ">", "parameters", ",", "Set", "<", "String", "subject", "=", "(", "String", ")", "getMapValue", "(", "\"", "subject", "\"", ",", "parameters", ")", ";", "subject", "=", "(", "subject", "=", "=", "null", ")", "?", "\"", "Mail", "from", "\"", "+", "host", ".", "getHostname", "(", ")", "+", "\"", "\"", ":", "subject", ";", "/", "/", "strip", "line", "breaks", "from", "headers", "from", "=", "from", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "to", "=", "to", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "cc", "=", "cc", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "bcc", "=", "bcc", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "fromName", "=", "fromName", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "subject", "=", "subject", ".", "replaceAll", "(", "\"\\", "\\", "s", "\"", ",", "\"", "\"", ");", "String", "emailFolder", "=", "(", "String", ")", "getMapValue", "(", "\"", "emailFolder", "\"", ",", "parameters", ")", ";", "boolean", "html", "=", "getMapValue", "(", "\"", "html", "\"", ",", "parameters", ")", "!", "=", "null", "?", "Parameter", ".", "getBooleanFromString", "(", "(", "String", ")", "getMapValue", "(", "\"", "html", "\"", ",", "parameters", ")", "):", "true", ";", "@", "@", "-", "5", ",", "6", "+", "5", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "com", ".", "dotmarketing", ".", "business", ".", "APILocator", ";", "import", "com", ".", "dotmarketing", ".", "common", ".", "util", ".", "SQLUtil", ";", "import", "com", ".", "dotmarketing", ".", "exception", ".", "DotDataException", ";", "import", "com", ".", "dotmarketing", ".", "util", ".", "UtilMethods", ";", "import", "com", ".", "liferay", ".", "portal", ".", "model", ".", "User", ";", "@", "@", "-", "100", ",", "6", "+", "101", ",", "9", "@", "@", "public", "WorkflowSearcher", "(", "Map", "<", "String", ",", "Object", ">", "map", ",", "User", "user", ")", "{", "stepId", "=", "getStringValue", "(", "\"", "stepId", "\"", ",", "map", ")", ";", "keywords", "=", "getStringValue", "(", "\"", "keywords", "\"", ",", "map", ")", ";", "orderBy", "=", "getStringValue", "(", "\"", "orderBy", "\"", ",", "map", ")", ";", "orderBy", "=", "SQLUtil", ".", "sanitizeSortBy", "(", "orderBy", ")", ";", "show4all", "=", "getBooleanValue", "(", "\"", "show4all", "\"", ",", "map", ")", ";", "open", "=", "getBooleanValue", "(", "\"", "open", "\"", ",", "map", ")", ";", "closed", "=", "getBooleanValue", "(", "\"", "closed", "\"", ",", "map", ")", ";", "@", "@", "-", "135", ",", "7", "+", "139", ",", "7", "@", "@", "public", "void", "setUser", "(", "User", "user", ")", "{", "}", "public", "String", "getOrderBy", "(", ")", "{", "return", "orderBy", ";", "return", "SQLUtil", ".", "sanitizeSortBy", "(", "orderBy", ")", ";", "}", "public", "List", "<", "WorkflowTask", ">", "findTasks", "(", ")", "throws", "DotDataException", "{", "@", "@", "-", "154", ",", "6", "+", "158", ",", "7", "@", "@", "public", "String", "getOrderBy", "(", ")", "{", "}", "public", "void", "setOrderBy", "(", "String", "orderBy", ")", "{", "orderBy", "=", "SQLUtil", ".", "sanitizeSortBy", "(", "orderBy", ")", ";", "this", ".", "orderBy", "=", "orderBy", ";", "}"], "docstring_tokens": ["via", "the", "orderby", "parameter", "."]}
{"contents": ["QPID-8046:", "[Broker-J]", "[PlainNegotiator]", "Eliminate", "redundant", "UTF-8/UnsupportedEncodingException", "catch", "block", "Cherry", "picked", "from", "fcca9d2"], "code_tokens": ["@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "qpid", ".", "server", ".", "security", ".", "auth", ".", "sasl", ".", "plain", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "security", ".", "auth", ".", "AuthenticationResult", ";", "@", "@", "-", "37", ",", "7", "+", "37", ",", "7", "@", "@", "}", "public", "static", "final", "String", "MECHANISM", "=", "\"", "PLAIN", "\"", ";", "private", "static", "final", "String", "UTF8", "=", "StandardCharsets", ".", "UTF_8", ".", "name", "(", ");", "private", "static", "final", "Charset", "UTF8", "=", "StandardCharsets", ".", "UTF_8", ";", "private", "UsernamePasswordAuthenticationProvider", "_usernamePasswordAuthenticationProvider", ";", "private", "volatile", "State", "_state", "=", "State", ".", "INITIAL", ";", "@", "@", "-", "86", ",", "17", "+", "86", ",", "10", "@", "@", "else", "if", "(", "_state", "=", "=", "State", ".", "INITIAL", "&", "&", "(", "response", "=", "=", "null", "|", "|", "response", ".", "length", "=", "=", "0", ")", ")", "}", "String", "password", ";", "try", "{", "_username", "=", "new", "String", "(", "response", ",", "authzidNullPosition", "+", "1", ",", "authcidNullPosition", "-", "authzidNullPosition", "-", "1", ",", "UTF8", ")", ";", "/", "/", "TODO", ":", "should", "not", "get", "pwd", "as", "a", "String", "but", "as", "a", "char", "array", ".", "..", "int", "passwordLen", "=", "response", ".", "length", "-", "authcidNullPosition", "-", "1", ";", "password", "=", "new", "String", "(", "response", ",", "authcidNullPosition", "+", "1", ",", "passwordLen", ",", "UTF8", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "JVM", "does", "not", "support", "UTF8", "\"", ",", "e", ")", ";", "}", "_username", "=", "new", "String", "(", "response", ",", "authzidNullPosition", "+", "1", ",", "authcidNullPosition", "-", "authzidNullPosition", "-", "1", ",", "UTF8", ")", ";", "/", "/", "TODO", ":", "should", "not", "get", "pwd", "as", "a", "String", "but", "as", "a", "char", "array", ".", "..", "int", "passwordLen", "=", "response", ".", "length", "-", "authcidNullPosition", "-", "1", ";", "password", "=", "new", "String", "(", "response", ",", "authcidNullPosition", "+", "1", ",", "passwordLen", ",", "UTF8", ")", ";", "return", "_usernamePasswordAuthenticationProvider", ".", "authenticate", "(", "_username", ",", "password", ")", ";", "}"], "docstring_tokens": ["including", "\"PLAIN", "\"", "in", "the", "\"disabledMechanisms", "\"", "attribute", "of", "the", "provider"]}
{"contents": ["Fix", "bug", "#67730", "-", "Null", "byte", "injection", "possible", "with", "imagexxx", "functions"], "code_tokens": ["@", "@", "-", "16", ",", "6", "+", "16", ",", "8", "@", "@", "PHP", "NEWS", "-", "GD", ":", ".", "Fixed", "bug", "#", "66901", "(", "php", "-", "gd", "'", "c_color", "'", "NULL", "pointer", "dereference", ")", ".", "(", "CVE", "-", "2014", "-", "2497", ")", "(", "Remi", ")", ".", "Fixed", "bug", "#", "67730", "(", "Null", "byte", "injection", "possible", "with", "imagexxx", "functions", ")", ".", "(", "CVE", "-", "2014", "-", "5120", ")", "(", "Ryan", "Mauger", ")", "-", "Milter", ":", ".", "Fixed", "bug", "#", "67715", "(", "php", "-", "milter", "does", "not", "build", "and", "crashes", "randomly", ")", ".", "(", "Mike", ")", "@", "@", "-", "124", ",", "6", "+", "124", ",", "11", "@", "@", "static", "void", "_php_image_output_ctx", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "image_type", ",", "RETURN_FALSE", ";", "}", "}", "else", "if", "(", "Z_TYPE_P", "(", "to_zval", ")", "=", "=", "IS_STRING", ")", "{", "if", "(", "CHECK_ZVAL_NULL_PATH", "(", "to_zval", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Invalid", "2nd", "parameter", ",", "filename", "must", "not", "contain", "null", "bytes", "\"", ");", "RETURN_FALSE", ";", "}", "stream", "=", "php_stream_open_wrapper", "(", "Z_STRVAL_P", "(", "to_zval", ")", ",", "\"", "wb", "\"", ",", "REPORT_ERRORS", "|", "IGNORE_PATH", "|", "IGNORE_URL_WIN", ",", "NULL", ")", ";", "if", "(", "stream", "=", "=", "NULL", ")", "{", "RETURN_FALSE", ";"], "docstring_tokens": ["."]}
{"contents": ["bpf:", "fix", "refcnt", "overflow", "On", "a", "system", "with", ">32Gbyte", "of", "phyiscal", "memory", "and", "infinite", "RLIMIT_MEMLOCK,", "the", "malicious", "application", "may", "overflow", "32-bit", "bpf", "program", "refcnt.", "It's", "also", "possible", "to", "overflow", "map", "refcnt", "on", "1Tb", "system.", "Impose", "32k", "hard", "limit", "which", "means", "that", "the", "same", "bpf", "program", "or", "map", "cannot", "be", "shared", "by", "more", "than", "32k", "processes.", "Fixes:", "1be7f75d1668", "(\"bpf:", "enable", "non-root", "eBPF", "programs\")", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "Acked-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "171", ",", "12", "+", "171", ",", "13", "@", "@", "void", "bpf_register_prog_type", "(", "struct", "bpf_prog_type_list", "*", "tl", ")", ";", "void", "bpf_register_map_type", "(", "struct", "bpf_map_type_list", "*", "tl", ")", ";", "struct", "bpf_prog", "*", "bpf_prog_get", "(", "u32", "ufd", ")", ";", "struct", "bpf_prog", "*", "bpf_prog_inc", "(", "struct", "bpf_prog", "*", "prog", ")", ";", "void", "bpf_prog_put", "(", "struct", "bpf_prog", "*", "prog", ")", ";", "void", "bpf_prog_put_rcu", "(", "struct", "bpf_prog", "*", "prog", ")", ";", "struct", "bpf_map", "*", "bpf_map_get_with_uref", "(", "u32", "ufd", ")", ";", "struct", "bpf_map", "*", "__bpf_map_get", "(", "struct", "fd", "f", ")", ";", "void", "bpf_map_inc", "(", "struct", "bpf_map", "*", "map", ",", "bool", "uref", ")", ";", "struct", "bpf_map", "*", "bpf_map_inc", "(", "struct", "bpf_map", "*", "map", ",", "bool", "uref", ")", ";", "void", "bpf_map_put_with_uref", "(", "struct", "bpf_map", "*", "map", ")", ";", "void", "bpf_map_put", "(", "struct", "bpf_map", "*", "map", ")", ";", "int", "bpf_map_precharge_memlock", "(", "u32", "pages", ")", ";", "@", "@", "-", "31", ",", "10", "+", "31", ",", "10", "@", "@", "static", "void", "*", "bpf_any_get", "(", "void", "*", "raw", ",", "enum", "bpf_type", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "BPF_TYPE_PROG", ":", "atomic_inc", "(", "&(", "(", "struct", "bpf_prog", "*", ")", "raw", ")", "->", "aux", "-", ">", "refcnt", ")", ";", "raw", "=", "bpf_prog_inc", "(", "raw", ")", ";", "break", ";", "case", "BPF_TYPE_MAP", ":", "bpf_map_inc", "(", "raw", ",", "true", ")", ";", "raw", "=", "bpf_map_inc", "(", "raw", ",", "true", ")", ";", "break", ";", "default", ":", "WARN_ON_ONCE", "(", "1", ")", ";", "@", "@", "-", "297", ",", "7", "+", "297", ",", "8", "@", "@", "static", "void", "*", "bpf_obj_do_get", "(", "const", "struct", "filename", "*", "pathname", ",", "goto", "out", ";", "raw", "=", "bpf_any_get", "(", "inode", "-", ">", "i_private", ",", "*", "type", ")", ";", "touch_atime", "(", "&", "path", ")", ";", "if", "(", "!", "IS_ERR", "(", "raw", ")", ")", "touch_atime", "(", "&", "path", ")", ";", "path_put", "(", "&", "path", ")", ";", "return", "raw", ";", "@", "@", "-", "218", ",", "11", "+", "218", ",", "18", "@", "@", "struct", "bpf_map", "*", "__bpf_map_get", "(", "struct", "fd", "f", ")", "return", "f", ".", "file", "-", ">", "private_data", ";", "}", "void", "bpf_map_inc", "(", "struct", "bpf_map", "*", "map", ",", "bool", "uref", ")", "/", "*", "prog", "'", "s", "and", "map", "'", "s", "refcnt", "limit", "*", "/", "#", "define", "BPF_MAX_REFCNT", "32768", "struct", "bpf_map", "*", "bpf_map_inc", "(", "struct", "bpf_map", "*", "map", ",", "bool", "uref", ")", "{", "atomic_inc", "(", "&", "map", "-", ">", "refcnt", ")", ";", "if", "(", "atomic_inc_return", "(", "&", "map", "-", ">", "refcnt", ")", ">", "BPF_MAX_REFCNT", ")", "{", "atomic_dec", "(", "&", "map", "-", ">", "refcnt", ")", ";", "return", "ERR_PTR", "(", "-", "EBUSY", ")", ";", "}", "if", "(", "uref", ")", "atomic_inc", "(", "&", "map", "-", ">", "usercnt", ")", ";", "return", "map", ";", "}", "struct", "bpf_map", "*", "bpf_map_get_with_uref", "(", "u32", "ufd", ")", "@", "@", "-", "234", ",", "7", "+", "241", ",", "7", "@", "@", "struct", "bpf_map", "*", "bpf_map_get_with_uref", "(", "u32", "ufd", ")", "if", "(", "IS_ERR", "(", "map", ")", ")", "return", "map", ";", "bpf_map_inc", "(", "map", ",", "true", ")", ";", "map", "=", "bpf_map_inc", "(", "map", ",", "true", ")", ";", "fdput", "(", "f", ")", ";", "return", "map", ";", "@", "@", "-", "658", ",", "6", "+", "665", ",", "15", "@", "@", "static", "struct", "bpf_prog", "*", "__bpf_prog_get", "(", "struct", "fd", "f", ")", "return", "f", ".", "file", "-", ">", "private_data", ";", "}", "struct", "bpf_prog", "*", "bpf_prog_inc", "(", "struct", "bpf_prog", "*", "prog", ")", "{", "if", "(", "atomic_inc_return", "(", "&", "prog", "-", ">", "aux", "-", ">", "refcnt", ")", ">", "BPF_MAX_REFCNT", ")", "{", "atomic_dec", "(", "&", "prog", "-", ">", "aux", "-", ">", "refcnt", ")", ";", "return", "ERR_PTR", "(", "-", "EBUSY", ")", ";", "}", "return", "prog", ";", "}", "/", "*", "called", "by", "sockets", "/", "tracing", "/", "seccomp", "before", "attaching", "program", "to", "an", "event", "*", "pairs", "with", "bpf_prog_put", "(", ")", "*", "/", "@", "@", "-", "670", ",", "7", "+", "686", ",", "7", "@", "@", "struct", "bpf_prog", "*", "bpf_prog_get", "(", "u32", "ufd", ")", "if", "(", "IS_ERR", "(", "prog", ")", ")", "return", "prog", ";", "atomic_inc", "(", "&", "prog", "-", ">", "aux", "-", ">", "refcnt", ")", ";", "prog", "=", "bpf_prog_inc", "(", "prog", ")", ";", "fdput", "(", "f", ")", ";", "return", "prog", ";", "@", "@", "-", "2049", ",", "15", "+", "2049", ",", "18", "@", "@", "static", "int", "replace_map_fd_with_map_ptr", "(", "struct", "verifier_env", "*", "env", ")", "return", "-", "E2BIG", ";", "}", "/", "*", "remember", "this", "map", "*", "/", "env", "-", ">", "used_maps", "[", "env", "-", ">", "used_map_cnt", "+", "+]", "=", "map", ";", "/", "*", "hold", "the", "map", ".", "If", "the", "program", "is", "rejected", "by", "verifier", ",", "*", "the", "map", "will", "be", "released", "by", "release_maps", "(", ")", "or", "it", "*", "will", "be", "used", "by", "the", "valid", "program", "until", "it", "'", "s", "unloaded", "*", "and", "all", "maps", "are", "released", "in", "free_bpf_prog_info", "(", ")", "*", "/", "bpf_map_inc", "(", "map", ",", "false", ")", ";", "map", "=", "bpf_map_inc", "(", "map", ",", "false", ")", ";", "if", "(", "IS_ERR", "(", "map", ")", ")", "{", "fdput", "(", "f", ")", ";", "return", "PTR_ERR", "(", "map", ")", ";", "}", "env", "-", ">", "used_maps", "[", "env", "-", ">", "used_map_cnt", "+", "+]", "=", "map", ";", "fdput", "(", "f", ")", ";", "next_insn", ":", "insn", "+", "+;"], "docstring_tokens": ["create", "references", "to", "them", "with", "relatively", "little", "memory", "usage"]}
{"contents": ["crypto:", "algif_skcipher", "-", "Load", "TX", "SG", "list", "after", "waiting", "We", "need", "to", "load", "the", "TX", "SG", "list", "in", "sendmsg(2)", "after", "waiting", "for", "incoming", "data,", "not", "before.", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>", "Tested-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>"], "code_tokens": ["@", "@", "-", "647", ",", "13", "+", "647", ",", "6", "@", "@", "static", "int", "skcipher_recvmsg_sync", "(", "struct", "socket", "*", "sock", ",", "struct", "msghdr", "*", "msg", ",", "lock_sock", "(", "sk", ")", ";", "while", "(", "msg_data_left", "(", "msg", ")", ")", "{", "sgl", "=", "list_first_entry", "(", "&", "ctx", "-", ">", "tsgl", ",", "struct", "skcipher_sg_list", ",", "list", ")", ";", "sg", "=", "sgl", "-", ">", "sg", ";", "while", "(", "!", "sg", "-", ">", "length", ")", "sg", "+", "+;", "if", "(", "!", "ctx", "-", ">", "used", ")", "{", "err", "=", "skcipher_wait_for_data", "(", "sk", ",", "flags", ")", ";", "if", "(", "err", ")", "@", "@", "-", "674", ",", "6", "+", "667", ",", "13", "@", "@", "static", "int", "skcipher_recvmsg_sync", "(", "struct", "socket", "*", "sock", ",", "struct", "msghdr", "*", "msg", ",", "if", "(", "!", "used", ")", "goto", "free", ";", "sgl", "=", "list_first_entry", "(", "&", "ctx", "-", ">", "tsgl", ",", "struct", "skcipher_sg_list", ",", "list", ")", ";", "sg", "=", "sgl", "-", ">", "sg", ";", "while", "(", "!", "sg", "-", ">", "length", ")", "sg", "+", "+;", "skcipher_request_set_crypt", "(", "&", "ctx", "-", ">", "req", ",", "sg", ",", "ctx", "-", ">", "rsgl", ".", "sg", ",", "used", ",", "ctx", "-", ">", "iv", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "application"]}
{"contents": ["[PATCH]", "I2C:", "Fix", "incorrect", "sysfs", "file", "permissions", "in", "it87", "and", "via686a", "drivers", "The", "it87", "and", "via686a", "hardware", "monitoring", "drivers", "each", "create", "a", "sysfs", "file", "named", "\"alarms\"", "in", "R/W", "mode,", "while", "they", "should", "really", "create", "it", "in", "read-only", "mode.", "Since", "we", "don't", "provide", "a", "store", "function", "for", "these", "files,", "write", "attempts", "to", "these", "files", "will", "do", "something", "undefined", "(I", "guess)", "and", "bad", "(I", "am", "sure).", "My", "own", "try", "resulted", "in", "a", "locked", "terminal", "(where", "I", "attempted", "the", "write)", "and", "a", "100%", "CPU", "load", "until", "next", "reboot.", "As", "a", "side", "note,", "wouldn't", "it", "make", "sense", "to", "check,", "when", "creating", "sysfs", "files,", "that", "readable", "files", "have", "a", "non-NULL", "show", "method,", "and", "writable", "files", "have", "a", "non-NULL", "store", "method?", "I", "know", "drivers", "are", "not", "supposed", "to", "do", "stupid", "things,", "but", "there", "is", "already", "a", "BUG_ON", "for", "several", "conditions", "in", "sysfs_create_file,", "so", "maybe", "we", "could", "add", "two", "more?", "Signed-off-by:", "Jean", "Delvare", "<khali@linux-fr.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@suse.de>"], "code_tokens": ["@", "@", "-", "668", ",", "7", "+", "668", ",", "7", "@", "@", "static", "ssize_t", "show_alarms", "(", "struct", "device", "*", "dev", ",", "char", "*", "buf", ")", "struct", "it87_data", "*", "data", "=", "it87_update_device", "(", "dev", ")", ";", "return", "sprintf", "(", "buf", ",", "\"%", "d", "\\", "n", "\"", ",", "ALARMS_FROM_REG", "(", "data", "-", ">", "alarms", ")", ");", "}", "static", "DEVICE_ATTR", "(", "alarms", ",", "S_IRUGO", "|", "S_IWUSR", ",", "show_alarms", ",", "NULL", ")", ";", "static", "DEVICE_ATTR", "(", "alarms", ",", "S_IRUGO", ",", "show_alarms", ",", "NULL", ")", ";", "static", "ssize_t", "show_vrm_reg", "(", "struct", "device", "*", "dev", ",", "char", "*", "buf", ")", "@", "@", "-", "574", ",", "7", "+", "574", ",", "7", "@", "@", "static", "ssize_t", "show_alarms", "(", "struct", "device", "*", "dev", ",", "char", "*", "buf", ")", "{", "struct", "via686a_data", "*", "data", "=", "via686a_update_device", "(", "dev", ")", ";", "return", "sprintf", "(", "buf", ",", "\"%", "d", "\\", "n", "\"", ",", "ALARMS_FROM_REG", "(", "data", "-", ">", "alarms", ")", ");", "}", "static", "DEVICE_ATTR", "(", "alarms", ",", "S_IRUGO", "|", "S_IWUSR", ",", "show_alarms", ",", "NULL", ")", ";", "static", "DEVICE_ATTR", "(", "alarms", ",", "S_IRUGO", ",", "show_alarms", ",", "NULL", ")", ";", "/", "*", "The", "driver", ".", "I", "choose", "to", "use", "type", "i2c_driver", ",", "as", "at", "is", "identical", "to", "both", "smbus_driver", "and", "isa_driver", ",", "and", "clients", "could", "be", "of", "either", "kind", "*", "/"], "docstring_tokens": ["which", "does", "not", "have", "an", "associated", "store", "function", "."]}
{"contents": ["do", "not", "allow", "invalid", "hazardous", "string", "as", "section", "name"], "code_tokens": ["@", "@", "-", "80", ",", "6", "+", "80", ",", "12", "@", "@", "function", "decode", "(", "str", ")", "{", "if", "(", "!", "match", ")", "return", "if", "(", "match", "[", "1", "]", "!", "==", "undefined", ")", "{", "section", "=", "unsafe", "(", "match", "[", "1", "]", ")", "if", "(", "section", "=", "==", "'", "__proto__", "'", ")", "{", "/", "/", "not", "allowed", "/", "/", "keep", "parsing", "the", "section", ",", "but", "don", "'", "t", "attach", "it", ".", "p", "=", "{", "}", "return", "}", "p", "=", "out", "[", "section", "]", "=", "out", "[", "section", "]", "|", "|", "{", "}", "return", "}", "@", "@", "-", "94", ",", "6", "+", "100", ",", "7", "@", "@", "function", "decode", "(", "str", ")", "{", "/", "/", "Convert", "keys", "with", "'", "[]", "'", "suffix", "to", "an", "array", "if", "(", "key", ".", "length", ">", "2", "&", "&", "key", ".", "slice", "(", "-", "2", ")", "=", "==", "'", "[]", "')", "{", "key", "=", "key", ".", "substring", "(", "0", ",", "key", ".", "length", "-", "2", ")", "if", "(", "key", "=", "==", "'", "__proto__", "'", ")", "return", "if", "(", "!", "p", "[", "key", "]", ")", "{", "p", "[", "key", "]", "=", "[", "]", "}", "else", "if", "(", "!", "Array", ".", "isArray", "(", "p", "[", "key", "]", "))", "{", "@", "@", "-", "125", ",", "6", "+", "132", ",", "7", "@", "@", "function", "decode", "(", "str", ")", "{", "var", "l", "=", "parts", ".", "pop", "(", ")", "var", "nl", "=", "l", ".", "replace", "(", "/\\", "\\\\", "./", "g", ",", "'", ".'", ")", "parts", ".", "forEach", "(", "function", "(", "part", ",", "_", ",", "__", ")", "{", "if", "(", "part", "=", "==", "'", "__proto__", "'", ")", "return", "if", "(", "!", "p", "[", "part", "]", "|", "|", "typeof", "p", "[", "part", "]", "!", "==", "'", "object", "'", ")", "p", "[", "part", "]", "=", "{", "}", "p", "=", "p", "[", "part", "]", "}", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "45", "@", "@", "var", "ini", "=", "require", "(", "'.", "./", "')", "var", "t", "=", "require", "(", "'", "tap", "'", ")", "var", "data", "=", "`", "__proto__", "=", "quux", "foo", "=", "baz", "[", "__proto__", "]", "foo", "=", "bar", "[", "other", "]", "foo", "=", "asdf", "[", "kid", ".", "__proto__", ".", "foo", "]", "foo", "=", "kid", "[", "arrproto", "]", "hello", "=", "snyk", "__proto__", "[", "]", "=", "you", "did", "a", "good", "job", "__proto__", "[", "]", "=", "so", "you", "deserve", "arrays", "thanks", "=", "true", "`", "var", "res", "=", "ini", ".", "parse", "(", "data", ")", "t", ".", "deepEqual", "(", "res", ",", "{", "foo", ":", "'", "baz", "'", ",", "other", ":", "{", "foo", ":", "'", "asdf", "'", ",", "}", ",", "kid", ":", "{", "foo", ":", "{", "foo", ":", "'", "kid", "'", ",", "}", ",", "}", ",", "arrproto", ":", "{", "hello", ":", "'", "snyk", "'", ",", "thanks", ":", "true", ",", "}", ",", "}", ")", "t", ".", "equal", "(", "res", ".", "__proto__", ",", "Object", ".", "prototype", ")", "t", ".", "equal", "(", "res", ".", "kid", ".", "__proto__", ",", "Object", ".", "prototype", ")", "t", ".", "equal", "(", "res", ".", "kid", ".", "foo", ".", "__proto__", ",", "Object", ".", "prototype", ")", "t", ".", "equal", "(", "res", ".", "arrproto", ".", "__proto__", ",", "Object", ".", "prototype", ")", "t", ".", "equal", "(", "Object", ".", "prototype", ".", "foo", ",", "undefined", ")", "t", ".", "equal", "(", "Object", ".", "prototype", "[", "0", "]", ",", "undefined", ")", "t", ".", "equal", "(", "Object", ".", "prototype", "[", "'", "0", "'", "],", "undefined", ")", "t", ".", "equal", "(", "Object", ".", "prototype", "[", "1", "]", ",", "undefined", ")", "t", ".", "equal", "(", "Object", ".", "prototype", "[", "'", "1", "'", "],", "undefined", ")", "t", ".", "equal", "(", "Array", ".", "prototype", "[", "0", "]", ",", "undefined", ")", "t", ".", "equal", "(", "Array", ".", "prototype", "[", "1", "]", ",", "undefined", ")"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Input:", "ims-pcu", "-", "sanity", "check", "against", "missing", "interfaces", "A", "malicious", "device", "missing", "interface", "can", "make", "the", "driver", "oops.", "Add", "sanity", "checking.", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Dmitry", "Torokhov", "<dmitry.torokhov@gmail.com>"], "code_tokens": ["@", "@", "-", "1663", ",", "13", "+", "1663", ",", "17", "@", "@", "static", "int", "ims_pcu_parse_cdc_data", "(", "struct", "usb_interface", "*", "intf", ",", "struct", "ims_pcu", "*", "pc", "pcu", "-", ">", "ctrl_intf", "=", "usb_ifnum_to_if", "(", "pcu", "-", ">", "udev", ",", "union_desc", "-", ">", "bMasterInterface0", ")", ";", "if", "(", "!", "pcu", "-", ">", "ctrl_intf", ")", "return", "-", "EINVAL", ";", "alt", "=", "pcu", "-", ">", "ctrl_intf", "-", ">", "cur_altsetting", ";", "pcu", "-", ">", "ep_ctrl", "=", "&", "alt", "-", ">", "endpoint", "[", "0", "]", ".", "desc", ";", "pcu", "-", ">", "max_ctrl_size", "=", "usb_endpoint_maxp", "(", "pcu", "-", ">", "ep_ctrl", ")", ";", "pcu", "-", ">", "data_intf", "=", "usb_ifnum_to_if", "(", "pcu", "-", ">", "udev", ",", "union_desc", "-", ">", "bSlaveInterface0", ")", ";", "if", "(", "!", "pcu", "-", ">", "data_intf", ")", "return", "-", "EINVAL", ";", "alt", "=", "pcu", "-", ">", "data_intf", "-", ">", "cur_altsetting", ";", "if", "(", "alt", "-", ">", "desc", ".", "bNumEndpoints", "!", "=", "2", ")", "{"], "docstring_tokens": ["using", "the", "malicious", "device"]}
{"contents": ["l2tp:", "fix", "info", "leak", "via", "getsockname()", "The", "L2TP", "code", "for", "IPv6", "fails", "to", "initialize", "the", "l2tp_unused", "member", "of", "struct", "sockaddr_l2tpip6", "and", "that", "for", "leaks", "two", "bytes", "kernel", "stack", "via", "the", "getsockname()", "syscall.", "Initialize", "l2tp_unused", "with", "0", "to", "avoid", "the", "info", "leak.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Cc:", "James", "Chapman", "<jchapman@katalix.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "410", ",", "6", "+", "410", ",", "7", "@", "@", "static", "int", "l2tp_ip6_getname", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "uaddr", ",", "lsa", "-", ">", "l2tp_family", "=", "AF_INET6", ";", "lsa", "-", ">", "l2tp_flowinfo", "=", "0", ";", "lsa", "-", ">", "l2tp_scope_id", "=", "0", ";", "lsa", "-", ">", "l2tp_unused", "=", "0", ";", "if", "(", "peer", ")", "{", "if", "(", "!", "lsk", "-", ">", "peer_conn_id", ")", "return", "-", "ENOTCONN", ";"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Fix", "bug#72697", "-", "select_colors", "write", "out-of-bounds"], "code_tokens": ["@", "@", "-", "99", ",", "7", "+", "99", ",", "7", "@", "@", "static", "void", "php_imagettftext_common", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", ",", "int", ")", ";", "#", "include", "\"", "gd_ctx", ".", "c", "\"", "/", "*", "as", "it", "is", "not", "really", "public", ",", "duplicate", "declaration", "here", "to", "avoid", "/", "*", "as", "it", "is", "not", "really", "public", ",", "duplicate", "declaration", "here", "to", "avoid", "pointless", "warnings", "*", "/", "int", "overflow2", "(", "int", "a", ",", "int", "b", ")", ";", "@", "@", "-", "1197", ",", "7", "+", "1197", ",", "7", "@", "@", "PHP_MINIT_FUNCTION", "(", "gd", ")", "REGISTER_LONG_CONSTANT", "(", "\"", "IMG_CROP_SIDES", "\"", ",", "GD_CROP_SIDES", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "IMG_CROP_THRESHOLD", "\"", ",", "GD_CROP_THRESHOLD", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "IMG_BELL", "\"", ",", "GD_BELL", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "IMG_BESSEL", "\"", ",", "GD_BESSEL", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "IMG_BILINEAR_FIXED", "\"", ",", "GD_BILINEAR_FIXED", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "@", "@", "-", "1658", ",", "11", "+", "1658", ",", "11", "@", "@", "PHP_FUNCTION", "(", "imagetruecolortopalette", ")", "ZEND_FETCH_RESOURCE", "(", "im", ",", "gdImagePtr", ",", "&", "IM", ",", "-", "1", ",", "\"", "Image", "\"", ",", "le_gd", ")", ";", "if", "(", "ncolors", "<", "=", "0", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Number", "of", "colors", "has", "to", "be", "greater", "than", "zero", "\"", ");", "if", "(", "ncolors", "<", "=", "0", "|", "|", "ncolors", ">", "INT_MAX", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Number", "of", "colors", "has", "to", "be", "greater", "than", "zero", "and", "no", "more", "than", "%", "d", "\"", ",", "INT_MAX", ")", ";", "RETURN_FALSE", ";", "}", "gdImageTrueColorToPalette", "(", "im", ",", "dither", ",", "ncolors", ")", ";", "gdImageTrueColorToPalette", "(", "im", ",", "dither", ",", "(", "int", ")", "ncolors", ")", ";", "RETURN_TRUE", ";", "}", "@", "@", "-", "3913", ",", "7", "+", "3913", ",", "7", "@", "@", "static", "void", "php_imagettftext_common", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "mode", ",", "int", "#", "endif", "/", "*", "VIRTUAL_DIR", "*", "/", "PHP_GD_CHECK_OPEN_BASEDIR", "(", "fontname", ",", "\"", "Invalid", "font", "filename", "\"", ");", "#", "ifdef", "HAVE_GD_FREETYPE", "if", "(", "extended", ")", "{", "error", "=", "gdImageStringFTEx", "(", "im", ",", "brect", ",", "col", ",", "fontname", ",", "ptsize", ",", "angle", ",", "x", ",", "y", ",", "str", ",", "&", "strex", ")", ";", "@", "@", "-", "4491", ",", "7", "+", "4491", ",", "7", "@", "@", "static", "void", "_php_image_convert", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "image_type", ")", "int", "x", ",", "y", ";", "float", "x_ratio", ",", "y_ratio", ";", "long", "ignore_warning", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "pplll", "\"", ",", "&", "f_org", ",", "&", "f_org_len", ",", "&", "f_dest", ",", "&", "f_dest_len", ",", "&", "height", ",", "&", "width", ",", "&", "threshold", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "5374", ",", "7", "+", "5374", ",", "7", "@", "@", "PHP_FUNCTION", "(", "imageaffinematrixget", ")", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Missing", "y", "position", "\"", ");", "RETURN_FALSE", ";", "}", "if", "(", "type", "=", "=", "GD_AFFINE_TRANSLATE", ")", "{", "res", "=", "gdAffineTranslate", "(", "affine", ",", "x", ",", "y", ")", ";", "}", "else", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72697", ":", "select_colors", "write", "out", "-", "of", "-", "bounds", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "function_exists", "(", "\"", "imagecreatetruecolor", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "if", "(", "PHP_INT_MAX", "!", "==", "9223372036854775807", ")", "die", "(", "\"", "skip", "for", "64", "-", "bit", "long", "systems", "only", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "img", "=", "imagecreatetruecolor", "(", "10", ",", "10", ")", ";", "imagetruecolortopalette", "(", "$", "img", ",", "false", ",", "PHP_INT_MAX", "/", "8", ")", ";", "?", ">", "DONE", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "imagetruecolortopalette", "(", "):", "Number", "of", "colors", "has", "to", "be", "greater", "than", "zero", "and", "no", "more", "than", "2147483647", "in", "%", "sbug72697", ".", "php", "on", "line", "%", "d", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["via", "a", "large", "value", "in", "the", "third", "argument", "."]}
{"contents": ["dcache:", "Handle", "escaped", "paths", "in", "prepend_path", "A", "rename", "can", "result", "in", "a", "dentry", "that", "by", "walking", "up", "d_parent", "will", "never", "reach", "it's", "mnt_root.", "For", "lack", "of", "a", "better", "term", "I", "call", "this", "an", "escaped", "path.", "prepend_path", "is", "called", "by", "four", "different", "functions", "__d_path,", "d_absolute_path,", "d_path,", "and", "getcwd.", "__d_path", "only", "wants", "to", "see", "paths", "are", "connected", "to", "the", "root", "it", "passes", "in.", "So", "__d_path", "needs", "prepend_path", "to", "return", "an", "error.", "d_absolute_path", "similarly", "wants", "to", "see", "paths", "that", "are", "connected", "to", "some", "root.", "Escaped", "paths", "are", "not", "connected", "to", "any", "mnt_root", "so", "d_absolute_path", "needs", "prepend_path", "to", "return", "an", "error", "greater", "than", "1.", "So", "escaped", "paths", "will", "be", "treated", "like", "paths", "on", "lazily", "unmounted", "mounts.", "getcwd", "needs", "to", "prepend", "\"(unreachable)\"", "so", "getcwd", "also", "needs", "prepend_path", "to", "return", "an", "error.", "d_path", "is", "the", "interesting", "hold", "out.", "d_path", "just", "wants", "to", "print", "something,", "and", "does", "not", "care", "about", "the", "weird", "cases.", "Which", "raises", "the", "question", "what", "should", "be", "printed?", "Given", "that", "<escaped_path>/<anything>", "should", "result", "in", "-ENOENT", "I", "believe", "it", "is", "desirable", "for", "escaped", "paths", "to", "be", "printed", "as", "empty", "paths.", "As", "there", "are", "not", "really", "any", "meaninful", "path", "components", "when", "considered", "from", "the", "perspective", "of", "a", "mount", "tree.", "So", "tweak", "prepend_path", "to", "return", "an", "empty", "path", "with", "an", "new", "error", "code", "of", "3", "when", "it", "encounters", "an", "escaped", "path.", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["@", "@", "-", "2926", ",", "6", "+", "2926", ",", "13", "@", "@", "static", "int", "prepend_path", "(", "const", "struct", "path", "*", "path", ",", "if", "(", "dentry", "=", "=", "vfsmnt", "-", ">", "mnt_root", "|", "|", "IS_ROOT", "(", "dentry", ")", ")", "{", "struct", "mount", "*", "parent", "=", "ACCESS_ONCE", "(", "mnt", "-", ">", "mnt_parent", ")", ";", "/", "*", "Escaped", "?", "*", "/", "if", "(", "dentry", "!", "=", "vfsmnt", "-", ">", "mnt_root", ")", "{", "bptr", "=", "*", "buffer", ";", "blen", "=", "*", "buflen", ";", "error", "=", "3", ";", "break", ";", "}", "/", "*", "Global", "root", "?", "*", "/", "if", "(", "mnt", "!", "=", "parent", ")", "{", "dentry", "=", "ACCESS_ONCE", "(", "mnt", "-", ">", "mnt_mountpoint", ")", ";"], "docstring_tokens": ["create", "another", "user", "and", "mount", "namespace", "within", "the", "existing", "container"]}
{"contents": ["udp:", "fix", "behavior", "of", "wrong", "checksums", "We", "have", "two", "problems", "in", "UDP", "stack", "related", "to", "bogus", "checksums", ":", "1)", "We", "return", "-EAGAIN", "to", "application", "even", "if", "receive", "queue", "is", "not", "empty.", "This", "breaks", "applications", "using", "edge", "trigger", "epoll()", "2)", "Under", "UDP", "flood,", "we", "can", "loop", "forever", "without", "yielding", "to", "other", "processes,", "potentially", "hanging", "the", "host,", "especially", "on", "non", "SMP.", "This", "patch", "is", "an", "attempt", "to", "make", "things", "better.", "We", "might", "in", "the", "future", "add", "extra", "support", "for", "rt", "applications", "wanting", "to", "better", "control", "time", "spent", "doing", "a", "recv()", "in", "a", "hostile", "environment.", "For", "example", "we", "could", "validate", "checksums", "before", "queuing", "packets", "in", "socket", "receive", "queue.", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Cc:", "Willem", "de", "Bruijn", "<willemb@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1345", ",", "10", "+", "1345", ",", "8", "@", "@", "int", "udp_recvmsg", "(", "struct", "sock", "*", "sk", ",", "struct", "msghdr", "*", "msg", ",", "size_t", "len", ",", "int", "noblock", ",", "}", "unlock_sock_fast", "(", "sk", ",", "slow", ")", ";", "if", "(", "noblock", ")", "return", "-", "EAGAIN", ";", "/", "*", "starting", "over", "for", "a", "new", "packet", "*", "/", "/", "*", "starting", "over", "for", "a", "new", "packet", ",", "but", "check", "if", "we", "need", "to", "yield", "*", "/", "cond_resched", "(", ");", "msg", "-", ">", "msg_flags", "&", "=", "~", "MSG_TRUNC", ";", "goto", "try_again", ";", "}", "@", "@", "-", "525", ",", "10", "+", "525", ",", "8", "@", "@", "int", "udpv6_recvmsg", "(", "struct", "sock", "*", "sk", ",", "struct", "msghdr", "*", "msg", ",", "size_t", "len", ",", "}", "unlock_sock_fast", "(", "sk", ",", "slow", ")", ";", "if", "(", "noblock", ")", "return", "-", "EAGAIN", ";", "/", "*", "starting", "over", "for", "a", "new", "packet", "*", "/", "/", "*", "starting", "over", "for", "a", "new", "packet", ",", "but", "check", "if", "we", "need", "to", "yield", "*", "/", "cond_resched", "(", ");", "msg", "-", ">", "msg_flags", "&", "=", "~", "MSG_TRUNC", ";", "goto", "try_again", ";", "}"], "docstring_tokens": ["ums"]}
{"contents": ["XWIKI-14247:", "Gadgets", "are", "not", "executed", "the", "right", "way", "*", "Execute", "the", "gadgets", "with", "the", "right", "author", "*", "Add", "new", "test"], "code_tokens": ["@", "@", "-", "33", ",", "8", "+", "33", ",", "8", "@", "@", "<", "properties", ">", "<", "!-", "-", "Name", "to", "display", "by", "the", "Extension", "Manager", "-", "->", "<", "xwiki", ".", "extension", ".", "name", ">", "Dashboard", "Macro", "<", "/", "xwiki", ".", "extension", ".", "name", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "56", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "22", "<", "/", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "71", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "41", "<", "/", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "<", "!-", "-", "TODO", ":", "Remove", "once", "the", "tests", "have", "been", "fixed", "to", "not", "output", "anything", "to", "the", "console", "!", "-", "->", "<", "xwiki", ".", "surefire", ".", "captureconsole", ".", "skip", ">", "true", "<", "/", "xwiki", ".", "surefire", ".", "captureconsole", ".", "skip", ">", "<", "/", "properties", ">", "@", "@", "-", "53", ",", "6", "+", "53", ",", "7", "@", "@", "import", "org", ".", "xwiki", ".", "rendering", ".", "syntax", ".", "Syntax", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "util", ".", "ParserUtils", ";", "import", "org", ".", "xwiki", ".", "security", ".", "authorization", ".", "AuthorExecutor", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityEngine", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityManager", ";", "@", "@", "-", "75", ",", "7", "+", "76", ",", "7", "@", "@", "*", "The", "reference", "to", "the", "gadgets", "class", ",", "relative", "to", "the", "current", "wiki", ".", "<", "br", ">", "*", "TODO", ":", "to", "make", "sure", "that", "this", "class", "exists", "before", "trying", "to", "read", "objects", "of", "this", "type", ".", "*", "/", "private", "static", "final", "EntityReference", "GADGET_CLASS", "=", "protected", "static", "final", "EntityReference", "GADGET_CLASS", "=", "new", "EntityReference", "(", "\"", "GadgetClass", "\"", ",", "EntityType", ".", "DOCUMENT", ",", "new", "EntityReference", "(", "\"", "XWiki", "\"", ",", "EntityType", ".", "SPACE", ")", ");", "/", "**", "@", "@", "-", "103", ",", "6", "+", "104", ",", "9", "@", "@", "@", "Named", "(", "\"", "local", "\"", ")", "private", "EntityReferenceSerializer", "<", "String", ">", "localReferenceSerializer", ";", "@", "Inject", "private", "AuthorExecutor", "authorExecutor", ";", "/", "**", "*", "Used", "to", "get", "the", "Velocity", "Engine", "and", "Velocity", "Context", "to", "use", "to", "evaluate", "the", "titles", "of", "the", "gadgets", ".", "*", "/", "@", "@", "-", "133", ",", "7", "+", "137", ",", "7", "@", "@", "DocumentReference", "gadgetsClass", "=", "currentReferenceEntityResolver", ".", "resolve", "(", "GADGET_CLASS", ")", ";", "List", "<", "BaseObject", ">", "gadgetObjects", "=", "sourceDoc", ".", "getXObjects", "(", "gadgetsClass", ")", ";", "if", "(", "gadgetObjects", "=", "=", "null", ")", "{", "if", "(", "gadgetObjects", "=", "=", "null", "|", "|", "gadgetObjects", ".", "isEmpty", "(", "))", "{", "return", "new", "ArrayList", "<", ">(", ");", "}", "@", "@", "-", "183", ",", "9", "+", "187", ",", "11", "@", "@", "/", "/", "parse", "both", "the", "title", "and", "content", "in", "the", "syntax", "of", "the", "transformation", "context", "List", "<", "Block", ">", "titleBlocks", "=", "renderGadgetProperty", "(", "gadgetTitle", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "context", ")", ";", "renderGadgetProperty", "(", "gadgetTitle", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "xObject", ".", "getOwnerDocument", "(", "),", "context", ")", ";", "List", "<", "Block", ">", "contentBlocks", "=", "renderGadgetProperty", "(", "content", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "context", ")", ";", "renderGadgetProperty", "(", "content", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "xObject", ".", "getOwnerDocument", "(", "),", "context", ")", ";", "/", "/", "create", "a", "gadget", "will", "all", "these", "and", "add", "the", "gadget", "to", "the", "container", "of", "gadgets", "Gadget", "gadget", "=", "new", "Gadget", "(", "id", ",", "titleBlocks", ",", "contentBlocks", ",", "position", ")", ";", "@", "@", "-", "196", ",", "12", "+", "202", ",", "16", "@", "@", "}", "private", "List", "<", "Block", ">", "renderGadgetProperty", "(", "String", "content", ",", "Syntax", "sourceSyntax", ",", "EntityReference", "sourceReference", ",", "MacroTransformationContext", "context", ")", "throws", "MissingParserException", ",", "ParseException", ",", "ContentExecutorException", "XWikiDocument", "ownerDocument", ",", "MacroTransformationContext", "context", ")", "throws", "Exception", "{", "XDOM", "xdom", "=", "this", ".", "contentExecutor", ".", "execute", "(", "content", ",", "sourceSyntax", ",", "sourceReference", ",", "context", ")", ";", "List", "<", "Block", ">", "xdomBlocks", "=", "xdom", ".", "getChildren", "(", ");", "this", ".", "parserUtils", ".", "removeTopLevelParagraph", "(", "xdomBlocks", ")", ";", "return", "xdomBlocks", ";", "/", "/", "Ensure", "that", "the", "gadgets", "are", "executed", "with", "the", "proper", "rights", ".", "return", "authorExecutor", ".", "call", "(", "()", "-", ">", "{", "XDOM", "xdom", "=", "this", ".", "contentExecutor", ".", "execute", "(", "content", ",", "sourceSyntax", ",", "sourceReference", ",", "context", ")", ";", "List", "<", "Block", ">", "xdomBlocks", "=", "xdom", ".", "getChildren", "(", ");", "this", ".", "parserUtils", ".", "removeTopLevelParagraph", "(", "xdomBlocks", ")", ";", "return", "xdomBlocks", ";", "}", ",", "ownerDocument", ".", "getAuthorReference", "(", "),", "ownerDocument", ".", "getDocumentReference", "(", "))", ";", "}", "/", "**", "@", "@", "-", "0", ",", "0", "+", "1", ",", "192", "@", "@", "/", "*", "*", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "*", "information", "regarding", "copyright", "ownership", ".", "*", "*", "This", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "*", "under", "the", "terms", "of", "the", "GNU", "Lesser", "General", "Public", "License", "as", "*", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", ".", "1", "of", "*", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "software", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "*", "Lesser", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "Lesser", "General", "Public", "*", "License", "along", "with", "this", "software", ";", "if", "not", ",", "write", "to", "the", "Free", "*", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "St", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "*", "02110", "-", "1301", "USA", ",", "or", "see", "the", "FSF", "site", ":", "http", ":", "//", "www", ".", "fsf", ".", "org", ".", "*", "/", "package", "org", ".", "xwiki", ".", "rendering", ".", "internal", ".", "macro", ".", "dashboard", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Callable", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "BeforeEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Test", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "org", ".", "mockito", ".", "invocation", ".", "InvocationOnMock", ";", "import", "org", ".", "mockito", ".", "stubbing", ".", "Answer", ";", "import", "org", ".", "xwiki", ".", "component", ".", "manager", ".", "ComponentLookupException", ";", "import", "org", ".", "xwiki", ".", "context", ".", "Execution", ";", "import", "org", ".", "xwiki", ".", "context", ".", "ExecutionContext", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "DocumentReference", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "DocumentReferenceResolver", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "EntityReference", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "WordBlock", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "XDOM", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "executor", ".", "ContentExecutor", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "macro", ".", "dashboard", ".", "Gadget", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "TransformationContext", ";", "import", "org", ".", "xwiki", ".", "security", ".", "authorization", ".", "AuthorExecutor", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "ComponentTest", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "InjectMockComponents", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "MockComponent", ";", "import", "org", ".", "xwiki", ".", "test", ".", "mockito", ".", "MockitoComponentManager", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityEngine", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityManager", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "XWikiVelocityException", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWiki", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWikiContext", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWikiException", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "doc", ".", "XWikiDocument", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "objects", ".", "BaseObject", ";", "import", "static", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Assertions", ".", "assertEquals", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "ComponentTest", "public", "class", "DefaultGadgetSourceTest", "{", "@", "InjectMockComponents", "private", "DefaultGadgetSource", "defaultGadgetSource", ";", "private", "static", "final", "String", "testSource", "=", "\"", "XWiki", ".", "Test", "\"", ";", "private", "static", "final", "String", "transformationId", "=", "\"", "fooId", "\"", ";", "@", "MockComponent", "private", "AuthorExecutor", "authorExecutor", ";", "@", "Mock", "private", "DocumentReference", "documentReference", ";", "@", "Mock", "private", "XWikiDocument", "xWikiDocument", ";", "@", "Mock", "private", "XWikiDocument", "ownerDocument", ";", "@", "Mock", "private", "DocumentReference", "ownerAuthorReference", ";", "@", "Mock", "private", "DocumentReference", "ownerSourceReference", ";", "@", "Mock", "private", "XWiki", "xwiki", ";", "@", "Mock", "private", "XWikiContext", "xWikiContext", ";", "@", "Mock", "private", "DocumentReference", "gadgetClassReference", ";", "@", "Mock", "private", "MacroTransformationContext", "macroTransformationContext", ";", "@", "BeforeEach", "public", "void", "setup", "(", "MockitoComponentManager", "componentManager", ")", "throws", "Exception", "{", "DocumentReferenceResolver", "<", "String", ">", "currentReferenceResolver", "=", "componentManager", ".", "getInstance", "(", "DocumentReferenceResolver", ".", "TYPE_STRING", ",", "\"", "current", "\"", ");", "when", "(", "currentReferenceResolver", ".", "resolve", "(", "testSource", ")", ").", "thenReturn", "(", "documentReference", ")", ";", "Execution", "execution", "=", "componentManager", ".", "getInstance", "(", "Execution", ".", "class", ")", ";", "ExecutionContext", "executionContext", "=", "mock", "(", "ExecutionContext", ".", "class", ")", ";", "when", "(", "execution", ".", "getContext", "(", "))", ".", "thenReturn", "(", "executionContext", ")", ";", "when", "(", "executionContext", ".", "getProperty", "(", "\"", "xwikicontext", "\"", "))", ".", "thenReturn", "(", "xWikiContext", ")", ";", "when", "(", "xWikiContext", ".", "getWiki", "(", "))", ".", "thenReturn", "(", "xwiki", ")", ";", "when", "(", "xwiki", ".", "getDocument", "(", "documentReference", ",", "xWikiContext", ")", ").", "thenReturn", "(", "xWikiDocument", ")", ";", "DocumentReferenceResolver", "<", "EntityReference", ">", "currentReferenceEntityResolver", "=", "componentManager", ".", "getInstance", "(", "DocumentReferenceResolver", ".", "TYPE_REFERENCE", ",", "\"", "current", "\"", ");", "when", "(", "currentReferenceEntityResolver", ".", "resolve", "(", "DefaultGadgetSource", ".", "GADGET_CLASS", ")", ").", "thenReturn", "(", "gadgetClassReference", ")", ";", "TransformationContext", "transformationContext", "=", "mock", "(", "TransformationContext", ".", "class", ")", ";", "when", "(", "macroTransformationContext", ".", "getTransformationContext", "(", "))", ".", "thenReturn", "(", "transformationContext", ")", ";", "when", "(", "transformationContext", ".", "getId", "(", "))", ".", "thenReturn", "(", "transformationId", ")", ";", "VelocityManager", "velocityManager", "=", "componentManager", ".", "getInstance", "(", "VelocityManager", ".", "class", ")", ";", "VelocityEngine", "velocityEngine", "=", "mock", "(", "VelocityEngine", ".", "class", ")", ";", "when", "(", "velocityManager", ".", "getVelocityEngine", "(", "))", ".", "thenReturn", "(", "velocityEngine", ")", ";", "when", "(", "velocityEngine", ".", "evaluate", "(", "any", "(", "),", "any", "(", "),", "any", "(", "),", "any", "(", "String", ".", "class", ")", "))", ".", "then", "(", "new", "Answer", "<", "Void", ">", "()", "{", "@", "Override", "public", "Void", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Object", "[", "]", "args", "=", "invocation", ".", "getArguments", "(", ");", "StringWriter", "stringWriter", "=", "(", "StringWriter", ")", "args", "[", "1", "]", ";", "String", "title", "=", "(", "String", ")", "args", "[", "3", "]", ";", "stringWriter", ".", "append", "(", "title", ")", ";", "return", "null", ";", "}", "}", ");", "AuthorExecutor", "authorExecutor", "=", "componentManager", ".", "getInstance", "(", "AuthorExecutor", ".", "class", ")", ";", "when", "(", "authorExecutor", ".", "call", "(", "any", "(", "),", "eq", "(", "ownerAuthorReference", ")", ",", "eq", "(", "ownerSourceReference", ")", "))", ".", "then", "(", "new", "Answer", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "throws", "Throwable", "{", "Callable", "callable", "=", "(", "Callable", ")", "invocationOnMock", ".", "getArguments", "(", ")[", "0", "]", ";", "return", "callable", ".", "call", "(", ");", "}", "}", ");", "ContentExecutor", "<", "MacroTransformationContext", ">", "contentExecutor", "=", "componentManager", ".", "getInstance", "(", "ContentExecutor", ".", "TYPE_MACRO_TRANSFORMATION", ")", ";", "when", "(", "contentExecutor", ".", "execute", "(", "any", "(", "),", "any", "(", "),", "any", "(", "),", "any", "(", "))", ").", "then", "(", "new", "Answer", "<", "XDOM", ">", "()", "{", "@", "Override", "public", "XDOM", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "throws", "Throwable", "{", "String", "content", "=", "invocationOnMock", ".", "getArgument", "(", "0", ")", ";", "XDOM", "xdom", "=", "new", "XDOM", "(", "Collections", ".", "singletonList", "(", "new", "WordBlock", "(", "content", ")", "))", ";", "return", "xdom", ";", "}", "}", ");", "when", "(", "ownerDocument", ".", "getAuthorReference", "(", "))", ".", "thenReturn", "(", "ownerAuthorReference", ")", ";", "when", "(", "ownerDocument", ".", "getDocumentReference", "(", "))", ".", "thenReturn", "(", "ownerSourceReference", ")", ";", "}", "@", "Test", "public", "void", "getGadgets", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "new", "ArrayList", "<", ">(", "),", "this", ".", "defaultGadgetSource", ".", "getGadgets", "(", "testSource", ",", "macroTransformationContext", ")", ");", "BaseObject", "gadgetObject1", "=", "mock", "(", "BaseObject", ".", "class", ")", ";", "when", "(", "xWikiDocument", ".", "getXObjects", "(", "gadgetClassReference", ")", ").", "thenReturn", "(", "Collections", ".", "singletonList", "(", "gadgetObject1", ")", ");", "when", "(", "gadgetObject1", ".", "getOwnerDocument", "(", "))", ".", "thenReturn", "(", "ownerDocument", ")", ";", "when", "(", "gadgetObject1", ".", "getStringValue", "(", "\"", "title", "\"", "))", ".", "thenReturn", "(", "\"", "Gadget", "1", "\"", ");", "when", "(", "gadgetObject1", ".", "getLargeStringValue", "(", "\"", "content", "\"", "))", ".", "thenReturn", "(", "\"", "Some", "content", "\"", ");", "when", "(", "gadgetObject1", ".", "getStringValue", "(", "\"", "position", "\"", "))", ".", "thenReturn", "(", "\"", "0", "\"", ");", "when", "(", "gadgetObject1", ".", "getNumber", "(", "))", ".", "thenReturn", "(", "42", ")", ";", "List", "<", "Gadget", ">", "gadgets", "=", "this", ".", "defaultGadgetSource", ".", "getGadgets", "(", "testSource", ",", "macroTransformationContext", ")", ";", "assertEquals", "(", "1", ",", "gadgets", ".", "size", "(", "))", ";", "Gadget", "gadget", "=", "gadgets", ".", "get", "(", "0", ")", ";", "assertEquals", "(", "\"", "Gadget", "1", "\"", ",", "gadget", ".", "getTitle", "(", ").", "get", "(", "0", ")", ".", "toString", "(", "))", ";", "assertEquals", "(", "\"", "Some", "content", "\"", ",", "gadget", ".", "getContent", "(", ").", "get", "(", "0", ")", ".", "toString", "(", "))", ";", "assertEquals", "(", "\"", "42", "\"", ",", "gadget", ".", "getId", "(", "))", ";", "}", "}", "@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "<", "packaging", ">", "jar", "<", "/", "packaging", ">", "<", "description", ">", "XWiki", "Platform", "-", "Rendering", "-", "Parser", "<", "/", "description", ">", "<", "properties", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "92", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "83", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "/", "properties", ">", "<", "dependencies", ">", "<", "dependency", ">", "@", "@", "-", "19", ",", "12", "+", "19", ",", "16", "@", "@", "*", "/", "package", "org", ".", "xwiki", ".", "rendering", ".", "executor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "import", "org", ".", "xwiki", ".", "component", ".", "annotation", ".", "Role", ";", "import", "org", ".", "xwiki", ".", "component", ".", "util", ".", "DefaultParameterizedType", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "EntityReference", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "XDOM", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "parser", ".", "MissingParserException", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "parser", ".", "ParseException", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "syntax", ".", "Syntax", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "/", "**", "*", "Parse", "the", "passed", "content", "and", "execute", "it", ".", "@", "@", "-", "36", ",", "6", "+", "40", ",", "14", "@", "@", "@", "Role", "public", "interface", "ContentExecutor", "<", "T", ">", "{", "/", "**", "*", "Type", "instance", "for", "{", "@", "code", "ContentExecutor", "<", "MacroTransformationContext", ">", "}.", "*", "*", "@", "since", "12", ".", "0RC1", ",", "11", ".", "10", ".", "3", ",", "11", ".", "3", ".", "7", "*", "/", "ParameterizedType", "TYPE_MACRO_TRANSFORMATION", "=", "new", "DefaultParameterizedType", "(", "null", ",", "ContentExecutor", ".", "class", ",", "MacroTransformationContext", ".", "class", ")", ";", "/", "**", "*", "Parse", "and", "execute", "content", ".", "*"], "docstring_tokens": ["editing", "personal", "dashboards"]}
{"contents": ["Merge", "pull", "request", "#53", "from", "serac/52-safe-header", "Define", "new", "ciphertext", "header", "format."], "code_tokens": ["@", "@", "-", "34", ",", "18", "+", "34", ",", "26", "@", "@", "*", "decrypt", "outstanding", "data", "which", "will", "be", "subsequently", "re", "-", "encrypted", "with", "a", "new", "key", ".", "</", "p", ">", "*", "*", "@", "author", "Middleware", "Services", "*", "*", "@", "deprecated", "Superseded", "by", "{", "@", "link", "CiphertextHeaderV2", "}", "*", "/", "@", "Deprecated", "public", "class", "CiphertextHeader", "{", "/", "**", "Maximum", "nonce", "length", "in", "bytes", ".", "*", "/", "protected", "static", "final", "int", "MAX_NONCE_LEN", "=", "255", ";", "/", "**", "Maximum", "key", "name", "length", "in", "bytes", ".", "*", "/", "protected", "static", "final", "int", "MAX_KEYNAME_LEN", "=", "500", ";", "/", "**", "Header", "nonce", "field", "value", ".", "*", "/", "private", "final", "byte", "[", "]", "nonce", ";", "protected", "final", "byte", "[", "]", "nonce", ";", "/", "**", "Header", "key", "name", "field", "value", ".", "*", "/", "private", "String", "keyName", ";", "protected", "final", "String", "keyName", ";", "/", "**", "Header", "length", "in", "bytes", ".", "*", "/", "private", "int", "length", ";", "protected", "final", "int", "length", ";", "/", "**", "@", "@", "-", "67", ",", "12", "+", "75", ",", "17", "@", "@", "public", "CiphertextHeader", "(", "final", "byte", "[", "]", "nonce", ")", "*", "/", "public", "CiphertextHeader", "(", "final", "byte", "[", "]", "nonce", ",", "final", "String", "keyName", ")", "{", "this", ".", "nonce", "=", "nonce", ";", "this", ".", "length", "=", "8", "+", "nonce", ".", "length", ";", "if", "(", "nonce", ".", "length", ">", "MAX_NONCE_LEN", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Nonce", "exceeds", "size", "limit", "in", "bytes", "(", "\"", "+", "MAX_NONCE_LEN", "+", "\"", ")\"", ");", "}", "if", "(", "keyName", "!", "=", "null", ")", "{", "this", ".", "length", "+", "=", "4", "+", "keyName", ".", "getBytes", "(", ").", "length", ";", "this", ".", "keyName", "=", "keyName", ";", "if", "(", "ByteUtil", ".", "toBytes", "(", "keyName", ")", ".", "length", ">", "MAX_KEYNAME_LEN", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Key", "name", "exceeds", "size", "limit", "in", "bytes", "(", "\"", "+", "MAX_KEYNAME_LEN", "+", "\"", ")\"", ");", "}", "}", "this", ".", "nonce", "=", "nonce", ";", "this", ".", "keyName", "=", "keyName", ";", "length", "=", "computeLength", "(", ");", "}", "/", "**", "@", "@", "-", "127", ",", "6", "+", "140", ",", "19", "@", "@", "public", "String", "getKeyName", "(", ")", "}", "/", "**", "*", "@", "return", "Length", "of", "this", "header", "encoded", "as", "bytes", ".", "*", "/", "protected", "int", "computeLength", "(", ")", "{", "int", "len", "=", "8", "+", "nonce", ".", "length", ";", "if", "(", "keyName", "!", "=", "null", ")", "{", "len", "+", "=", "4", "+", "keyName", ".", "getBytes", "(", ").", "length", ";", "}", "return", "len", ";", "}", "/", "**", "*", "Creates", "a", "header", "from", "encrypted", "data", "containing", "a", "cleartext", "header", "prepended", "to", "the", "start", ".", "*", "@", "@", "-", "143", ",", "17", "+", "169", ",", "20", "@", "@", "public", "static", "CiphertextHeader", "decode", "(", "final", "byte", "[", "]", "data", ")", "throws", "EncodingExceptio", "final", "int", "length", "=", "bb", ".", "getInt", "(", ");", "if", "(", "length", "<", "0", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Invalid", "ciphertext", "header", "length", ":", "\"", "+", "length", ")", ";", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "final", "byte", "[", "]", "nonce", ";", "int", "nonceLen", "=", "0", ";", "try", "{", "nonceLen", "=", "bb", ".", "getInt", "(", ");", "if", "(", "nonceLen", ">", "MAX_NONCE_LEN", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", ":", "maximum", "nonce", "length", "exceeded", "\"", ");", "}", "nonce", "=", "new", "byte", "[", "nonceLen", "]", ";", "bb", ".", "get", "(", "nonce", ")", ";", "}", "catch", "(", "IndexOutOfBoundsException", "|", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Invalid", "nonce", "length", ":", "\"", "+", "nonceLen", ")", ";", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "String", "keyName", "=", "null", ";", "@", "@", "-", "162", ",", "11", "+", "191", ",", "14", "@", "@", "public", "static", "CiphertextHeader", "decode", "(", "final", "byte", "[", "]", "data", ")", "throws", "EncodingExceptio", "int", "keyLen", "=", "0", ";", "try", "{", "keyLen", "=", "bb", ".", "getInt", "(", ");", "if", "(", "keyLen", ">", "MAX_KEYNAME_LEN", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", ":", "maximum", "key", "length", "exceeded", "\"", ");", "}", "b", "=", "new", "byte", "[", "keyLen", "]", ";", "bb", ".", "get", "(", "b", ")", ";", "keyName", "=", "new", "String", "(", "b", ")", ";", "}", "catch", "(", "IndexOutOfBoundsException", "|", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Invalid", "key", "length", ":", "\"", "+", "keyLen", ")", ";", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "}", "@", "@", "-", "188", ",", "17", "+", "220", ",", "20", "@", "@", "public", "static", "CiphertextHeader", "decode", "(", "final", "InputStream", "input", ")", "throws", "EncodingEx", "{", "final", "int", "length", "=", "ByteUtil", ".", "readInt", "(", "input", ")", ";", "if", "(", "length", "<", "0", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Invalid", "ciphertext", "header", "length", ":", "\"", "+", "length", ")", ";", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "final", "byte", "[", "]", "nonce", ";", "int", "nonceLen", "=", "0", ";", "try", "{", "nonceLen", "=", "ByteUtil", ".", "readInt", "(", "input", ")", ";", "if", "(", "nonceLen", ">", "MAX_NONCE_LEN", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", ":", "maximum", "nonce", "size", "exceeded", "\"", ");", "}", "nonce", "=", "new", "byte", "[", "nonceLen", "]", ";", "input", ".", "read", "(", "nonce", ")", ";", "}", "catch", "(", "ArrayIndexOutOfBoundsException", "e", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Invalid", "nonce", "length", ":", "\"", "+", "nonceLen", ")", ";", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "}", "@", "@", "-", "209", ",", "10", "+", "244", ",", "13", "@", "@", "public", "static", "CiphertextHeader", "decode", "(", "final", "InputStream", "input", ")", "throws", "EncodingEx", "int", "keyLen", "=", "0", ";", "try", "{", "keyLen", "=", "ByteUtil", ".", "readInt", "(", "input", ")", ";", "if", "(", "keyLen", ">", "MAX_KEYNAME_LEN", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", ":", "maximum", "key", "length", "exceeded", "\"", ");", "}", "b", "=", "new", "byte", "[", "keyLen", "]", ";", "input", ".", "read", "(", "b", ")", ";", "}", "catch", "(", "ArrayIndexOutOfBoundsException", "e", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Invalid", "key", "length", ":", "\"", "+", "keyLen", ")", ";", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "}", "@", "@", "-", "221", ",", "4", "+", "259", ",", "5", "@", "@", "public", "static", "CiphertextHeader", "decode", "(", "final", "InputStream", "input", ")", "throws", "EncodingEx", "return", "new", "CiphertextHeader", "(", "nonce", ",", "keyName", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "309", "@", "@", "/", "*", "See", "LICENSE", "for", "licensing", "and", "NOTICE", "for", "copyright", ".", "*", "/", "package", "org", ".", "cryptacular", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "BufferUnderflowException", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "nio", ".", "ByteOrder", ";", "import", "java", ".", "util", ".", "function", ".", "BiConsumer", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "import", "javax", ".", "crypto", ".", "SecretKey", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "digests", ".", "SHA256Digest", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "macs", ".", "HMac", ";", "import", "org", ".", "cryptacular", ".", "util", ".", "ByteUtil", ";", "/", "**", "*", "Cleartext", "header", "prepended", "to", "ciphertext", "providing", "data", "required", "for", "decryption", ".", "*", "*", "<", "p", ">", "Data", "format", ":", "</", "p", ">", "*", "*", "<", "pre", ">", "+", "--", "--", "--", "--", "-+", "--", "--", "--", "--", "-+", "--", "-+", "--", "--", "--", "--", "--", "+-", "--", "--", "--", "+-", "--", "--", "-", "|", "Version", "|", "KeyName", "|", "0", "|", "NonceLen", "|", "Nonce", "|", "HMAC", "|", "+", "--", "--", "--", "--", "-+", "--", "--", "--", "--", "-+", "--", "-+", "--", "--", "--", "--", "--", "+-", "--", "--", "--", "+-", "--", "--", "-", "|", "|", "+", "--", "-", "4", "-", "--", "+-", "--", "x", "-", "--", "+", "1", "+", "--", "-", "1", "-", "--", "-+", "--", "y", "-", "-+", "-", "32", "-", "*", "<", "/", "pre", ">", "*", "*", "<", "p", ">", "Where", "fields", "are", "defined", "as", "follows", ":", "</", "p", ">", "*", "*", "<", "ul", ">", "*", "<", "li", ">", "Version", "-", "Header", "version", "format", "as", "a", "negative", "number", "(", "4", "-", "byte", "integer", ")", ".", "Current", "version", "is", "-", "2", ".", "</", "li", ">", "*", "<", "li", ">", "KeyName", "-", "Symbolic", "key", "name", "encoded", "as", "UTF", "-", "8", "bytes", "(", "variable", "length", ")", "</", "li", ">", "*", "<", "li", ">", "0", "-", "Null", "byte", "signifying", "the", "end", "of", "the", "symbolic", "key", "name", "<", "/", "li", ">", "*", "<", "li", ">", "NonceLen", "-", "Nonce", "length", "in", "bytes", "(", "1", "-", "byte", "unsigned", "integer", ")", "</", "li", ">", "*", "<", "li", ">", "Nonce", "-", "Nonce", "bytes", "(", "variable", "length", ")", "</", "li", ">", "*", "<", "li", ">", "HMAC", "-", "HMAC", "-", "256", "over", "preceding", "fields", "(", "32", "bytes", ")", "</", "li", ">", "*", "<", "/", "ul", ">", "*", "*", "<", "p", ">", "The", "last", "two", "fields", "provide", "support", "for", "multiple", "keys", "at", "the", "encryption", "provider", ".", "A", "common", "case", "for", "multiple", "*", "keys", "is", "key", "rotation", ";", "by", "tagging", "encrypted", "data", "with", "a", "key", "name", ",", "an", "old", "key", "may", "be", "retrieved", "by", "name", "to", "decrypt", "*", "outstanding", "data", "which", "will", "be", "subsequently", "re", "-", "encrypted", "with", "a", "new", "key", ".", "</", "p", ">", "*", "*", "@", "author", "Middleware", "Services", "*", "/", "public", "class", "CiphertextHeaderV2", "extends", "CiphertextHeader", "{", "/", "**", "Header", "version", "format", ".", "*", "/", "private", "static", "final", "int", "VERSION", "=", "-", "2", ";", "/", "**", "Size", "of", "HMAC", "algorithm", "output", "in", "bytes", ".", "*", "/", "private", "static", "final", "int", "HMAC_SIZE", "=", "32", ";", "/", "**", "Function", "to", "resolve", "a", "key", "from", "a", "symbolic", "key", "name", ".", "*", "/", "private", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ";", "/", "**", "*", "Creates", "a", "new", "instance", "with", "a", "nonce", "and", "named", "key", ".", "*", "*", "@", "param", "nonce", "Nonce", "bytes", ".", "*", "@", "param", "keyName", "Key", "name", ".", "*", "/", "public", "CiphertextHeaderV2", "(", "final", "byte", "[", "]", "nonce", ",", "final", "String", "keyName", ")", "{", "super", "(", "nonce", ",", "keyName", ")", ";", "if", "(", "keyName", "=", "=", "null", "|", "|", "keyName", ".", "isEmpty", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Key", "name", "is", "required", "\"", ");", "}", "}", "/", "**", "*", "Sets", "the", "function", "to", "resolve", "keys", "from", "{", "@", "link", "#", "keyName", "}", ".", "*", "*", "@", "param", "keyLookup", "Key", "lookup", "function", ".", "*", "/", "public", "void", "setKeyLookup", "(", "final", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ")", "{", "this", ".", "keyLookup", "=", "keyLookup", ";", "}", "@", "Override", "public", "byte", "[", "]", "encode", "(", ")", "{", "final", "SecretKey", "key", "=", "keyLookup", "!", "=", "null", "?", "keyLookup", ".", "apply", "(", "keyName", ")", ":", "null", ";", "if", "(", "key", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Could", "not", "resolve", "secret", "key", "to", "generate", "header", "HMAC", "\"", ");", "}", "return", "encode", "(", "key", ")", ";", "}", "/", "**", "*", "Encodes", "the", "header", "into", "bytes", ".", "*", "*", "@", "param", "hmacKey", "Key", "used", "to", "generate", "header", "HMAC", ".", "*", "*", "@", "return", "Byte", "representation", "of", "header", ".", "*", "/", "public", "byte", "[", "]", "encode", "(", "final", "SecretKey", "hmacKey", ")", "{", "if", "(", "hmacKey", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Secret", "key", "cannot", "be", "null", "\"", ");", "}", "final", "ByteBuffer", "bb", "=", "ByteBuffer", ".", "allocate", "(", "length", ")", ";", "bb", ".", "order", "(", "ByteOrder", ".", "BIG_ENDIAN", ")", ";", "bb", ".", "putInt", "(", "VERSION", ")", ";", "bb", ".", "put", "(", "ByteUtil", ".", "toBytes", "(", "keyName", ")", ");", "bb", ".", "put", "(", "(", "byte", ")", "0", ")", ";", "bb", ".", "put", "(", "ByteUtil", ".", "toUnsignedByte", "(", "nonce", ".", "length", ")", ");", "bb", ".", "put", "(", "nonce", ")", ";", "bb", ".", "put", "(", "hmac", "(", "bb", ".", "array", "(", "),", "0", ",", "bb", ".", "limit", "(", ")", "-", "HMAC_SIZE", ")", ");", "return", "bb", ".", "array", "(", ");", "}", "/", "**", "*", "@", "return", "Length", "of", "this", "header", "encoded", "as", "bytes", ".", "*", "/", "protected", "int", "computeLength", "(", ")", "{", "return", "4", "+", "ByteUtil", ".", "toBytes", "(", "keyName", ")", ".", "length", "+", "2", "+", "nonce", ".", "length", "+", "HMAC_SIZE", ";", "}", "/", "**", "*", "Creates", "a", "header", "from", "encrypted", "data", "containing", "a", "cleartext", "header", "prepended", "to", "the", "start", ".", "*", "*", "@", "param", "data", "Encrypted", "data", "with", "prepended", "header", "data", ".", "*", "@", "param", "keyLookup", "Function", "used", "to", "look", "up", "the", "secret", "key", "from", "the", "symbolic", "key", "name", "in", "the", "header", ".", "*", "*", "@", "return", "Decoded", "header", ".", "*", "*", "@", "throws", "EncodingException", "when", "ciphertext", "header", "cannot", "be", "decoded", ".", "*", "/", "public", "static", "CiphertextHeaderV2", "decode", "(", "final", "byte", "[", "]", "data", ",", "final", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ")", "throws", "EncodingException", "{", "final", "ByteBuffer", "bb", "=", "ByteBuffer", ".", "wrap", "(", "data", ")", ".", "order", "(", "ByteOrder", ".", "BIG_ENDIAN", ")", ";", "return", "decodeInternal", "(", "ByteBuffer", ".", "wrap", "(", "data", ")", ".", "order", "(", "ByteOrder", ".", "BIG_ENDIAN", ")", ",", "keyLookup", ",", "ByteBuffer", "-", ">", "bb", ".", "getInt", "(", "),", "ByteBuffer", "-", ">", "bb", ".", "get", "(", "),", "(", "ByteBuffer", ",", "output", ")", "-", ">", "bb", ".", "get", "(", "output", ")", ");", "}", "/", "**", "*", "Creates", "a", "header", "from", "encrypted", "data", "containing", "a", "cleartext", "header", "prepended", "to", "the", "start", ".", "*", "*", "@", "param", "input", "Input", "stream", "that", "is", "positioned", "at", "the", "start", "of", "ciphertext", "header", "data", ".", "*", "@", "param", "keyLookup", "Function", "used", "to", "look", "up", "the", "secret", "key", "from", "the", "symbolic", "key", "name", "in", "the", "header", ".", "*", "*", "@", "return", "Decoded", "header", ".", "*", "*", "@", "throws", "EncodingException", "when", "ciphertext", "header", "cannot", "be", "decoded", ".", "*", "@", "throws", "StreamException", "on", "stream", "IO", "errors", ".", "*", "/", "public", "static", "CiphertextHeaderV2", "decode", "(", "final", "InputStream", "input", ",", "final", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ")", "throws", "EncodingException", ",", "StreamException", "{", "return", "decodeInternal", "(", "input", ",", "keyLookup", ",", "ByteUtil", ":", ":", "readInt", ",", "CiphertextHeaderV2", ":", ":", "readByte", ",", "CiphertextHeaderV2", ":", ":", "readInto", ")", ";", "}", "/", "**", "*", "Internal", "header", "decoding", "routine", ".", "*", "*", "@", "param", "<", "T", ">", "Type", "of", "input", "source", ".", "*", "@", "param", "source", "Source", "of", "header", "data", "(", "input", "stream", "or", "byte", "buffer", ")", ".", "*", "@", "param", "keyLookup", "Function", "to", "look", "up", "key", "from", "symbolic", "key", "name", "in", "header", ".", "*", "@", "param", "readIntFn", "Function", "that", "produces", "a", "4", "-", "byte", "integer", "from", "the", "input", "source", ".", "*", "@", "param", "readByteFn", "Function", "that", "produces", "a", "byte", "from", "the", "input", "source", ".", "*", "@", "param", "readBytesConsumer", "Function", "that", "fills", "a", "byte", "array", "from", "the", "input", "source", ".", "*", "*", "@", "return", "Decoded", "header", ".", "*", "/", "private", "static", "<", "T", ">", "CiphertextHeaderV2", "decodeInternal", "(", "final", "T", "source", ",", "final", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ",", "final", "Function", "<", "T", ",", "Integer", ">", "readIntFn", ",", "final", "Function", "<", "T", ",", "Byte", ">", "readByteFn", ",", "final", "BiConsumer", "<", "T", ",", "byte", "[", "]>", "readBytesConsumer", ")", "{", "final", "SecretKey", "key", ";", "final", "String", "keyName", ";", "final", "byte", "[", "]", "nonce", ";", "final", "byte", "[", "]", "hmac", ";", "try", "{", "final", "int", "version", "=", "readIntFn", ".", "apply", "(", "source", ")", ";", "if", "(", "version", "!", "=", "VERSION", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Unsupported", "ciphertext", "header", "version", "\"", ");", "}", "final", "ByteArrayOutputStream", "out", "=", "new", "ByteArrayOutputStream", "(", "100", ")", ";", "byte", "b", "=", "0", ";", "int", "count", "=", "0", ";", "while", "(", "(", "b", "=", "readByteFn", ".", "apply", "(", "source", ")", ")", "!", "=", "0", ")", "{", "out", ".", "write", "(", "b", ")", ";", "if", "(", "out", ".", "size", "(", ")", ">", "MAX_KEYNAME_LEN", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", ":", "maximum", "nonce", "length", "exceeded", "\"", ");", "}", "count", "+", "+;", "}", "keyName", "=", "ByteUtil", ".", "toString", "(", "out", ".", "toByteArray", "(", "),", "0", ",", "count", ")", ";", "key", "=", "keyLookup", ".", "apply", "(", "keyName", ")", ";", "if", "(", "key", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Symbolic", "key", "name", "mentioned", "in", "header", "was", "not", "found", "\"", ");", "}", "final", "int", "nonceLen", "=", "ByteUtil", ".", "toInt", "(", "readByteFn", ".", "apply", "(", "source", ")", ");", "nonce", "=", "new", "byte", "[", "nonceLen", "]", ";", "readBytesConsumer", ".", "accept", "(", "source", ",", "nonce", ")", ";", "hmac", "=", "new", "byte", "[", "HMAC_SIZE", "]", ";", "readBytesConsumer", ".", "accept", "(", "source", ",", "hmac", ")", ";", "}", "catch", "(", "IndexOutOfBoundsException", "|", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Bad", "ciphertext", "header", "\"", ");", "}", "final", "CiphertextHeaderV2", "header", "=", "new", "CiphertextHeaderV2", "(", "nonce", ",", "keyName", ")", ";", "final", "byte", "[", "]", "encoded", "=", "header", ".", "encode", "(", "key", ")", ";", "if", "(", "!", "arraysEqual", "(", "hmac", ",", "0", ",", "encoded", ",", "encoded", ".", "length", "-", "HMAC_SIZE", ",", "HMAC_SIZE", ")", ")", "{", "throw", "new", "EncodingException", "(", "\"", "Ciphertext", "header", "HMAC", "verification", "failed", "\"", ");", "}", "header", ".", "setKeyLookup", "(", "keyLookup", ")", ";", "return", "header", ";", "}", "/", "**", "*", "Generates", "an", "HMAC", "-", "256", "over", "the", "given", "input", "byte", "array", ".", "*", "*", "@", "param", "input", "Input", "bytes", ".", "*", "@", "param", "offset", "Starting", "position", "in", "input", "byte", "array", ".", "*", "@", "param", "length", "Number", "of", "bytes", "in", "input", "to", "consume", ".", "*", "*", "@", "return", "HMAC", "as", "byte", "array", ".", "*", "/", "private", "static", "byte", "[", "]", "hmac", "(", "final", "byte", "[", "]", "input", ",", "final", "int", "offset", ",", "final", "int", "length", ")", "{", "final", "HMac", "hmac", "=", "new", "HMac", "(", "new", "SHA256Digest", "(", "))", ";", "final", "byte", "[", "]", "output", "=", "new", "byte", "[", "HMAC_SIZE", "]", ";", "hmac", ".", "update", "(", "input", ",", "offset", ",", "length", ")", ";", "hmac", ".", "doFinal", "(", "output", ",", "0", ")", ";", "return", "output", ";", "}", "/", "**", "*", "Read", "<", "code", ">", "output", ".", "length", "<", "/", "code", ">", "bytes", "from", "the", "input", "stream", "into", "the", "output", "buffer", ".", "*", "*", "@", "param", "input", "Input", "stream", ".", "*", "@", "param", "output", "Output", "buffer", ".", "*", "*", "@", "throws", "StreamException", "on", "stream", "IO", "errors", ".", "*", "/", "private", "static", "void", "readInto", "(", "final", "InputStream", "input", ",", "final", "byte", "[", "]", "output", ")", "{", "try", "{", "input", ".", "read", "(", "output", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "}", "}", "/", "**", "*", "Read", "a", "single", "byte", "from", "the", "input", "stream", ".", "*", "*", "@", "param", "input", "Input", "stream", ".", "*", "*", "@", "return", "Byte", "read", "from", "input", "stream", ".", "*", "/", "private", "static", "byte", "readByte", "(", "final", "InputStream", "input", ")", "{", "try", "{", "return", "(", "byte", ")", "input", ".", "read", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "}", "}", "/", "**", "*", "Determines", "if", "two", "byte", "array", "ranges", "are", "equal", "bytewise", ".", "*", "*", "@", "param", "a", "First", "array", "to", "compare", ".", "*", "@", "param", "aOff", "Offset", "into", "first", "array", ".", "*", "@", "param", "b", "Second", "array", "to", "compare", ".", "*", "@", "param", "bOff", "Offset", "into", "second", "array", ".", "*", "@", "param", "length", "Number", "of", "bytes", "to", "compare", ".", "*", "*", "@", "return", "True", "if", "every", "byte", "in", "the", "given", "range", "is", "equal", ",", "false", "otherwise", ".", "*", "/", "private", "static", "boolean", "arraysEqual", "(", "final", "byte", "[", "]", "a", ",", "final", "int", "aOff", ",", "final", "byte", "[", "]", "b", ",", "final", "int", "bOff", ",", "final", "int", "length", ")", "{", "if", "(", "length", "+", "aOff", ">", "a", ".", "length", "|", "|", "length", "+", "bOff", ">", "b", ".", "length", ")", "{", "return", "false", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "length", ";", "i", "+", "+)", "{", "if", "(", "a", "[", "i", "+", "aOff", "]", "!", "=", "b", "[", "i", "+", "bOff", "]", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "}", "@", "@", "-", "45", ",", "25", "+", "45", ",", "25", "@", "@", "public", "AbstractBlockCipherBean", "(", "protected", "byte", "[", "]", "process", "(", "final", "CiphertextHeader", "header", ",", "final", "boolean", "mode", ",", "final", "byte", "[", "]", "input", ")", "{", "final", "BlockCipherAdapter", "cipher", "=", "newCipher", "(", "header", ",", "mode", ")", ";", "final", "byte", "[", "]", "headerBytes", "=", "header", ".", "encode", "(", ");", "int", "outOff", ";", "final", "int", "inOff", ";", "final", "int", "length", ";", "final", "byte", "[", "]", "output", ";", "if", "(", "mode", ")", "{", "final", "byte", "[", "]", "headerBytes", "=", "header", ".", "encode", "(", ");", "final", "int", "outSize", "=", "headerBytes", ".", "length", "+", "cipher", ".", "getOutputSize", "(", "input", ".", "length", ")", ";", "output", "=", "new", "byte", "[", "outSize", "]", ";", "System", ".", "arraycopy", "(", "headerBytes", ",", "0", ",", "output", ",", "0", ",", "headerBytes", ".", "length", ")", ";", "inOff", "=", "0", ";", "outOff", "=", "headerBytes", ".", "length", ";", "length", "=", "input", ".", "length", ";", "}", "else", "{", "length", "=", "input", ".", "length", "-", "headerBytes", ".", "length", ";", "outOff", "=", "0", ";", "inOff", "=", "header", ".", "getLength", "(", ");", "length", "=", "input", ".", "length", "-", "inOff", ";", "final", "int", "outSize", "=", "cipher", ".", "getOutputSize", "(", "length", ")", ";", "output", "=", "new", "byte", "[", "outSize", "]", ";", "inOff", "=", "headerBytes", ".", "length", ";", "outOff", "=", "0", ";", "}", "outOff", "+", "=", "cipher", ".", "processBytes", "(", "input", ",", "inOff", ",", "length", ",", "output", ",", "outOff", ")", ";", "outOff", "+", "=", "cipher", ".", "doFinal", "(", "output", ",", "outOff", ")", ";", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "protected", "void", "process", "(", "{", "final", "BlockCipherAdapter", "cipher", "=", "newCipher", "(", "header", ",", "mode", ")", ";", "final", "int", "outSize", "=", "cipher", ".", "getOutputSize", "(", "StreamUtil", ".", "CHUNK_SIZE", ")", ";", "final", "byte", "[", "]", "outBuf", "=", "new", "byte", "[", "outSize", ">", "StreamUtil", ".", "CHUNK_SIZE", "?", "outSize", ":", "StreamUtil", ".", "CHUNK_SIZE", "]", ";", "final", "byte", "[", "]", "outBuf", "=", "new", "byte", "[", "Math", ".", "max", "(", "outSize", ",", "StreamUtil", ".", "CHUNK_SIZE", ")", "];", "StreamUtil", ".", "pipeAll", "(", "input", ",", "output", ",", "@", "@", "-", "8", ",", "14", "+", "8", ",", "16", "@", "@", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "javax", ".", "crypto", ".", "SecretKey", ";", "import", "org", ".", "cryptacular", ".", "CiphertextHeader", ";", "import", "org", ".", "cryptacular", ".", "CiphertextHeaderV2", ";", "import", "org", ".", "cryptacular", ".", "CryptoException", ";", "import", "org", ".", "cryptacular", ".", "EncodingException", ";", "import", "org", ".", "cryptacular", ".", "StreamException", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "Nonce", ";", "import", "org", ".", "cryptacular", ".", "util", ".", "CipherUtil", ";", "/", "**", "*", "Base", "class", "for", "all", "cipher", "beans", ".", "The", "base", "class", "assumes", "all", "ciphertext", "output", "will", "contain", "a", "prepended", "{", "@", "link", "*", "CiphertextHeader", "}", "containing", "metadata", "that", "facilitates", "decryption", ".", "*", "CiphertextHeaderV2", "}", "containing", "metadata", "that", "facilitates", "decryption", ".", "*", "*", "@", "author", "Middleware", "Services", "*", "/", "@", "@", "-", "128", ",", "14", "+", "130", ",", "14", "@", "@", "public", "void", "setNonce", "(", "final", "Nonce", "nonce", ")", "@", "Override", "public", "byte", "[", "]", "encrypt", "(", "final", "byte", "[", "]", "input", ")", "throws", "CryptoException", "{", "return", "process", "(", "new", "CiphertextHeader", "(", "nonce", ".", "generate", "(", "),", "keyAlias", ")", ",", "true", ",", "input", ")", ";", "return", "process", "(", "header", "(", "),", "true", ",", "input", ")", ";", "}", "@", "Override", "public", "void", "encrypt", "(", "final", "InputStream", "input", ",", "final", "OutputStream", "output", ")", "throws", "CryptoException", ",", "StreamException", "{", "final", "CiphertextHeader", "header", "=", "new", "CiphertextHeader", "(", "nonce", ".", "generate", "(", "),", "keyAlias", ")", ";", "final", "CiphertextHeaderV2", "header", "=", "header", "(", ");", "try", "{", "output", ".", "write", "(", "header", ".", "encode", "(", "))", ";", "}", "catch", "(", "IOException", "e", ")", "{", "@", "@", "-", "148", ",", "23", "+", "150", ",", "15", "@", "@", "public", "void", "encrypt", "(", "final", "InputStream", "input", ",", "final", "OutputStream", "output", ")", "throws", "C", "@", "Override", "public", "byte", "[", "]", "decrypt", "(", "final", "byte", "[", "]", "input", ")", "throws", "CryptoException", ",", "EncodingException", "{", "final", "CiphertextHeader", "header", "=", "CiphertextHeader", ".", "decode", "(", "input", ")", ";", "if", "(", "header", ".", "getKeyName", "(", ")", "=", "=", "null", ")", "{", "throw", "new", "CryptoException", "(", "\"", "Ciphertext", "header", "does", "not", "contain", "required", "key", "\"", ");", "}", "return", "process", "(", "header", ",", "false", ",", "input", ")", ";", "return", "process", "(", "CipherUtil", ".", "decodeHeader", "(", "input", ",", "this", ":", ":", "lookupKey", ")", ",", "false", ",", "input", ")", ";", "}", "@", "Override", "public", "void", "decrypt", "(", "final", "InputStream", "input", ",", "final", "OutputStream", "output", ")", "throws", "CryptoException", ",", "EncodingException", ",", "StreamException", "{", "final", "CiphertextHeader", "header", "=", "CiphertextHeader", ".", "decode", "(", "input", ")", ";", "if", "(", "header", ".", "getKeyName", "(", ")", "=", "=", "null", ")", "{", "throw", "new", "CryptoException", "(", "\"", "Ciphertext", "header", "does", "not", "contain", "required", "key", "\"", ");", "}", "process", "(", "header", ",", "false", ",", "input", ",", "output", ")", ";", "process", "(", "CipherUtil", ".", "decodeHeader", "(", "input", ",", "this", ":", ":", "lookupKey", ")", ",", "false", ",", "input", ",", "output", ")", ";", "}", "@", "@", "-", "211", ",", "4", "+", "205", ",", "15", "@", "@", "protected", "SecretKey", "lookupKey", "(", "final", "String", "alias", ")", "*", "@", "param", "output", "Stream", "that", "receives", "output", "of", "cipher", ".", "*", "/", "protected", "abstract", "void", "process", "(", "CiphertextHeader", "header", ",", "boolean", "mode", ",", "InputStream", "input", ",", "OutputStream", "output", ")", ";", "/", "**", "*", "@", "return", "New", "ciphertext", "header", "for", "a", "pending", "encryption", "or", "decryption", "operation", "performed", "by", "this", "instance", ".", "*", "/", "private", "CiphertextHeaderV2", "header", "(", ")", "{", "final", "CiphertextHeaderV2", "header", "=", "new", "CiphertextHeaderV2", "(", "nonce", ".", "generate", "(", "),", "keyAlias", ")", ";", "header", ".", "setKeyLookup", "(", "this", ":", ":", "lookupKey", ")", ";", "return", "header", ";", "}", "}", "@", "@", "-", "31", ",", "14", "+", "31", ",", "27", "@", "@", "private", "ByteUtil", "(", ")", "{", "}", "*", "*", "@", "param", "data", "4", "-", "byte", "array", "in", "big", "-", "endian", "format", ".", "*", "*", "@", "return", "Long", "integer", "value", ".", "*", "@", "return", "Integer", "value", ".", "*", "/", "public", "static", "int", "toInt", "(", "final", "byte", "[", "]", "data", ")", "{", "return", "(", "data", "[", "0", "]", "<", "<", "24", ")", "|", "(", "(", "data", "[", "1", "]", "&", "0xff", ")", "<", "<", "16", ")", "|", "(", "(", "data", "[", "2", "]", "&", "0xff", ")", "<", "<", "8", ")", "|", "(", "data", "[", "3", "]", "&", "0xff", ")", ";", "}", "/", "**", "*", "Converts", "an", "unsigned", "byte", "into", "an", "integer", ".", "*", "*", "@", "param", "unsigned", "Unsigned", "byte", ".", "*", "*", "@", "return", "Integer", "value", ".", "*", "/", "public", "static", "int", "toInt", "(", "final", "byte", "unsigned", ")", "{", "return", "0x000000FF", "&", "unsigned", ";", "}", "/", "**", "*", "Reads", "4", "-", "bytes", "from", "the", "input", "stream", "and", "converts", "to", "a", "32", "-", "bit", "integer", ".", "*", "@", "@", "-", "175", ",", "6", "+", "188", ",", "21", "@", "@", "public", "static", "String", "toString", "(", "final", "byte", "[", "]", "bytes", ")", "}", "/", "**", "*", "Converts", "a", "portion", "of", "a", "byte", "array", "into", "a", "string", "in", "the", "UTF", "-", "8", "character", "set", ".", "*", "*", "@", "param", "bytes", "Byte", "array", "to", "convert", ".", "*", "@", "param", "offset", "Offset", "into", "byte", "array", "where", "string", "content", "begins", ".", "*", "@", "param", "length", "Total", "number", "of", "bytes", "to", "convert", ".", "*", "*", "@", "return", "UTF", "-", "8", "string", "representation", "of", "bytes", ".", "*", "/", "public", "static", "String", "toString", "(", "final", "byte", "[", "]", "bytes", ",", "final", "int", "offset", ",", "final", "int", "length", ")", "{", "return", "new", "String", "(", "bytes", ",", "offset", ",", "length", ",", "DEFAULT_CHARSET", ")", ";", "}", "/", "**", "*", "Converts", "a", "byte", "buffer", "into", "a", "string", "in", "the", "UTF", "-", "8", "character", "set", ".", "*", "@", "@", "-", "226", ",", "6", "+", "254", ",", "19", "@", "@", "public", "static", "ByteBuffer", "toByteBuffer", "(", "final", "String", "s", ")", "}", "/", "**", "*", "Converts", "an", "integer", "into", "an", "unsigned", "byte", ".", "All", "bits", "above", "1", "byte", "are", "truncated", ".", "*", "*", "@", "param", "b", "Integer", "value", ".", "*", "*", "@", "return", "Unsigned", "byte", "as", "a", "byte", ".", "*", "/", "public", "static", "byte", "toUnsignedByte", "(", "final", "int", "b", ")", "{", "return", "(", "byte", ")", "(", "0x000000FF", "&", "b", ")", ";", "}", "/", "**", "*", "Converts", "a", "byte", "buffer", "into", "a", "byte", "array", ".", "*", "@", "@", "-", "244", ",", "4", "+", "285", ",", "6", "@", "@", "public", "static", "ByteBuffer", "toByteBuffer", "(", "final", "String", "s", ")", "buffer", ".", "get", "(", "array", ")", ";", "return", "array", ";", "}", "}", "@", "@", "-", "4", ",", "6", "+", "4", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "import", "javax", ".", "crypto", ".", "SecretKey", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "BlockCipher", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "modes", ".", "AEADBlockCipher", ";", "@", "@", "-", "13", ",", "6", "+", "14", ",", "7", "@", "@", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "KeyParameter", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "params", ".", "ParametersWithIV", ";", "import", "org", ".", "cryptacular", ".", "CiphertextHeader", ";", "import", "org", ".", "cryptacular", ".", "CiphertextHeaderV2", ";", "import", "org", ".", "cryptacular", ".", "CryptoException", ";", "import", "org", ".", "cryptacular", ".", "EncodingException", ";", "import", "org", ".", "cryptacular", ".", "StreamException", ";", "@", "@", "-", "37", ",", "15", "+", "39", ",", "15", "@", "@", "private", "CipherUtil", "(", ")", "{", "}", "/", "**", "*", "Encrypts", "data", "using", "an", "AEAD", "cipher", ".", "A", "{", "@", "link", "CiphertextHeader", "}", "is", "prepended", "to", "the", "resulting", "ciphertext", "and", "used", "as", "*", "AAD", "(", "Additional", "Authenticated", "Data", ")", "passed", "to", "the", "AEAD", "cipher", ".", "*", "Encrypts", "data", "using", "an", "AEAD", "cipher", ".", "A", "{", "@", "link", "CiphertextHeaderV2", "}", "is", "prepended", "to", "the", "resulting", "ciphertext", "and", "*", "used", "as", "AAD", "(", "Additional", "Authenticated", "Data", ")", "passed", "to", "the", "AEAD", "cipher", ".", "*", "*", "@", "param", "cipher", "AEAD", "cipher", ".", "*", "@", "param", "key", "Encryption", "key", ".", "*", "@", "param", "nonce", "Nonce", "generator", ".", "*", "@", "param", "data", "Plaintext", "data", "to", "be", "encrypted", ".", "*", "*", "@", "return", "Concatenation", "of", "encoded", "{", "@", "link", "CiphertextHeader", "}", "and", "encrypted", "data", "that", "completely", "fills", "the", "returned", "*", "@", "return", "Concatenation", "of", "encoded", "{", "@", "link", "CiphertextHeaderV2", "}", "and", "encrypted", "data", "that", "completely", "fills", "the", "returned", "*", "byte", "array", ".", "*", "*", "@", "throws", "CryptoException", "on", "encryption", "errors", ".", "@", "@", "-", "54", ",", "22", "+", "56", ",", "22", "@", "@", "private", "CipherUtil", "(", ")", "{", "}", "throws", "CryptoException", "{", "final", "byte", "[", "]", "iv", "=", "nonce", ".", "generate", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeader", "(", "iv", ")", ".", "encode", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeaderV2", "(", "iv", ",", "\"", "1", "\"", ").", "encode", "(", "key", ")", ";", "cipher", ".", "init", "(", "true", ",", "new", "AEADParameters", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "MAC_SIZE_BITS", ",", "iv", ",", "header", ")", ");", "return", "encrypt", "(", "new", "AEADBlockCipherAdapter", "(", "cipher", ")", ",", "header", ",", "data", ")", ";", "}", "/", "**", "*", "Encrypts", "data", "using", "an", "AEAD", "cipher", ".", "A", "{", "@", "link", "CiphertextHeader", "}", "is", "prepended", "to", "the", "resulting", "ciphertext", "and", "used", "as", "*", "AAD", "(", "Additional", "Authenticated", "Data", ")", "passed", "to", "the", "AEAD", "cipher", ".", "*", "Encrypts", "data", "using", "an", "AEAD", "cipher", ".", "A", "{", "@", "link", "CiphertextHeaderV2", "}", "is", "prepended", "to", "the", "resulting", "ciphertext", "and", "used", "*", "as", "AAD", "(", "Additional", "Authenticated", "Data", ")", "passed", "to", "the", "AEAD", "cipher", ".", "*", "*", "@", "param", "cipher", "AEAD", "cipher", ".", "*", "@", "param", "key", "Encryption", "key", ".", "*", "@", "param", "nonce", "Nonce", "generator", ".", "*", "@", "param", "input", "Input", "stream", "containing", "plaintext", "data", ".", "*", "@", "param", "output", "Output", "stream", "that", "receives", "a", "{", "@", "link", "CiphertextHeader", "}", "followed", "by", "ciphertext", "data", "produced", "by", "the", "*", "AEAD", "cipher", "in", "encryption", "mode", ".", "*", "@", "param", "output", "Output", "stream", "that", "receives", "a", "{", "@", "link", "CiphertextHeaderV2", "}", "followed", "by", "ciphertext", "data", "produced", "by", "*", "the", "AEAD", "cipher", "in", "encryption", "mode", ".", "*", "*", "@", "throws", "CryptoException", "on", "encryption", "errors", ".", "*", "@", "throws", "StreamException", "on", "IO", "errors", ".", "@", "@", "-", "83", ",", "7", "+", "85", ",", "7", "@", "@", "public", "static", "void", "encrypt", "(", "throws", "CryptoException", ",", "StreamException", "{", "final", "byte", "[", "]", "iv", "=", "nonce", ".", "generate", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeader", "(", "iv", ")", ".", "encode", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeaderV2", "(", "iv", ",", "\"", "1", "\"", ").", "encode", "(", "key", ")", ";", "cipher", ".", "init", "(", "true", ",", "new", "AEADParameters", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "MAC_SIZE_BITS", ",", "iv", ",", "header", ")", ");", "writeHeader", "(", "header", ",", "output", ")", ";", "process", "(", "new", "AEADBlockCipherAdapter", "(", "cipher", ")", ",", "input", ",", "output", ")", ";", "@", "@", "-", "95", ",", "7", "+", "97", ",", "7", "@", "@", "public", "static", "void", "encrypt", "(", "*", "*", "@", "param", "cipher", "AEAD", "cipher", ".", "*", "@", "param", "key", "Encryption", "key", ".", "*", "@", "param", "data", "Ciphertext", "data", "containing", "a", "prepended", "{", "@", "link", "CiphertextHeader", "}", ".", "The", "header", "is", "treated", "as", "AAD", "input", "*", "@", "param", "data", "Ciphertext", "data", "containing", "a", "prepended", "{", "@", "link", "CiphertextHeaderV2", "}", ".", "The", "header", "is", "treated", "as", "AAD", "input", "*", "to", "the", "cipher", "that", "is", "verified", "during", "decryption", ".", "*", "*", "@", "return", "Decrypted", "data", "that", "completely", "fills", "the", "returned", "byte", "array", ".", "@", "@", "-", "106", ",", "7", "+", "108", ",", "7", "@", "@", "public", "static", "void", "encrypt", "(", "public", "static", "byte", "[", "]", "decrypt", "(", "final", "AEADBlockCipher", "cipher", ",", "final", "SecretKey", "key", ",", "final", "byte", "[", "]", "data", ")", "throws", "CryptoException", ",", "EncodingException", "{", "final", "CiphertextHeader", "header", "=", "CiphertextHeader", ".", "decode", "(", "data", ")", ";", "final", "CiphertextHeader", "header", "=", "decodeHeader", "(", "data", ",", "String", "-", ">", "key", ")", ";", "final", "byte", "[", "]", "nonce", "=", "header", ".", "getNonce", "(", ");", "final", "byte", "[", "]", "hbytes", "=", "header", ".", "encode", "(", ");", "cipher", ".", "init", "(", "false", ",", "new", "AEADParameters", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "MAC_SIZE_BITS", ",", "nonce", ",", "hbytes", ")", ");", "@", "@", "-", "119", ",", "7", "+", "121", ",", "7", "@", "@", "public", "static", "void", "encrypt", "(", "*", "*", "@", "param", "cipher", "AEAD", "cipher", ".", "*", "@", "param", "key", "Encryption", "key", ".", "*", "@", "param", "input", "Input", "stream", "containing", "a", "{", "@", "link", "CiphertextHeader", "}", "followed", "by", "ciphertext", "data", ".", "The", "header", "is", "*", "@", "param", "input", "Input", "stream", "containing", "a", "{", "@", "link", "CiphertextHeaderV2", "}", "followed", "by", "ciphertext", "data", ".", "The", "header", "is", "*", "treated", "as", "AAD", "input", "to", "the", "cipher", "that", "is", "verified", "during", "decryption", ".", "*", "@", "param", "output", "Output", "stream", "that", "receives", "plaintext", "produced", "by", "block", "cipher", "in", "decryption", "mode", ".", "*", "@", "@", "-", "134", ",", "7", "+", "136", ",", "7", "@", "@", "public", "static", "void", "decrypt", "(", "final", "OutputStream", "output", ")", "throws", "CryptoException", ",", "EncodingException", ",", "StreamException", "{", "final", "CiphertextHeader", "header", "=", "CiphertextHeader", ".", "decode", "(", "input", ")", ";", "final", "CiphertextHeader", "header", "=", "decodeHeader", "(", "input", ",", "String", "-", ">", "key", ")", ";", "final", "byte", "[", "]", "nonce", "=", "header", ".", "getNonce", "(", ");", "final", "byte", "[", "]", "hbytes", "=", "header", ".", "encode", "(", ");", "cipher", ".", "init", "(", "false", ",", "new", "AEADParameters", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "MAC_SIZE_BITS", ",", "nonce", ",", "hbytes", ")", ");", "@", "@", "-", "143", ",", "7", "+", "145", ",", "7", "@", "@", "public", "static", "void", "decrypt", "(", "/", "**", "*", "Encrypts", "data", "using", "the", "given", "block", "cipher", "with", "PKCS5", "padding", ".", "A", "{", "@", "link", "CiphertextHeader", "}", "is", "prepended", "to", "the", "*", "Encrypts", "data", "using", "the", "given", "block", "cipher", "with", "PKCS5", "padding", ".", "A", "{", "@", "link", "CiphertextHeaderV2", "}", "is", "prepended", "to", "the", "*", "resulting", "ciphertext", ".", "*", "*", "@", "param", "cipher", "Block", "cipher", ".", "@", "@", "-", "152", ",", "7", "+", "154", ",", "7", "@", "@", "public", "static", "void", "decrypt", "(", "*", "cipher", "block", "size", ".", "*", "@", "param", "data", "Plaintext", "data", "to", "be", "encrypted", ".", "*", "*", "@", "return", "Concatenation", "of", "encoded", "{", "@", "link", "CiphertextHeader", "}", "and", "encrypted", "data", "that", "completely", "fills", "the", "returned", "*", "@", "return", "Concatenation", "of", "encoded", "{", "@", "link", "CiphertextHeaderV2", "}", "and", "encrypted", "data", "that", "completely", "fills", "the", "returned", "*", "byte", "array", ".", "*", "*", "@", "throws", "CryptoException", "on", "encryption", "errors", ".", "@", "@", "-", "161", ",", "7", "+", "163", ",", "7", "@", "@", "public", "static", "void", "decrypt", "(", "throws", "CryptoException", "{", "final", "byte", "[", "]", "iv", "=", "nonce", ".", "generate", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeader", "(", "iv", ")", ".", "encode", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeaderV2", "(", "iv", ",", "\"", "1", "\"", ").", "encode", "(", "key", ")", ";", "final", "PaddedBufferedBlockCipher", "padded", "=", "new", "PaddedBufferedBlockCipher", "(", "cipher", ",", "new", "PKCS7Padding", "(", "))", ";", "padded", ".", "init", "(", "true", ",", "new", "ParametersWithIV", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "iv", ")", ");", "return", "encrypt", "(", "new", "BufferedBlockCipherAdapter", "(", "padded", ")", ",", "header", ",", "data", ")", ";", "@", "@", "-", "191", ",", "7", "+", "193", ",", "7", "@", "@", "public", "static", "void", "encrypt", "(", "throws", "CryptoException", ",", "StreamException", "{", "final", "byte", "[", "]", "iv", "=", "nonce", ".", "generate", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeader", "(", "iv", ")", ".", "encode", "(", ");", "final", "byte", "[", "]", "header", "=", "new", "CiphertextHeaderV2", "(", "iv", ",", "\"", "1", "\"", ").", "encode", "(", "key", ")", ";", "final", "PaddedBufferedBlockCipher", "padded", "=", "new", "PaddedBufferedBlockCipher", "(", "cipher", ",", "new", "PKCS7Padding", "(", "))", ";", "padded", ".", "init", "(", "true", ",", "new", "ParametersWithIV", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "iv", ")", ");", "writeHeader", "(", "header", ",", "output", ")", ";", "@", "@", "-", "214", ",", "7", "+", "216", ",", "7", "@", "@", "public", "static", "void", "encrypt", "(", "public", "static", "byte", "[", "]", "decrypt", "(", "final", "BlockCipher", "cipher", ",", "final", "SecretKey", "key", ",", "final", "byte", "[", "]", "data", ")", "throws", "CryptoException", ",", "EncodingException", "{", "final", "CiphertextHeader", "header", "=", "CiphertextHeader", ".", "decode", "(", "data", ")", ";", "final", "CiphertextHeader", "header", "=", "decodeHeader", "(", "data", ",", "String", "-", ">", "key", ")", ";", "final", "PaddedBufferedBlockCipher", "padded", "=", "new", "PaddedBufferedBlockCipher", "(", "cipher", ",", "new", "PKCS7Padding", "(", "))", ";", "padded", ".", "init", "(", "false", ",", "new", "ParametersWithIV", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "header", ".", "getNonce", "(", "))", ");", "return", "decrypt", "(", "new", "BufferedBlockCipherAdapter", "(", "padded", ")", ",", "data", ",", "header", ".", "getLength", "(", "))", ";", "@", "@", "-", "240", ",", "13", "+", "242", ",", "62", "@", "@", "public", "static", "void", "decrypt", "(", "final", "OutputStream", "output", ")", "throws", "CryptoException", ",", "EncodingException", ",", "StreamException", "{", "final", "CiphertextHeader", "header", "=", "CiphertextHeader", ".", "decode", "(", "input", ")", ";", "final", "CiphertextHeader", "header", "=", "decodeHeader", "(", "input", ",", "String", "-", ">", "key", ")", ";", "final", "PaddedBufferedBlockCipher", "padded", "=", "new", "PaddedBufferedBlockCipher", "(", "cipher", ",", "new", "PKCS7Padding", "(", "))", ";", "padded", ".", "init", "(", "false", ",", "new", "ParametersWithIV", "(", "new", "KeyParameter", "(", "key", ".", "getEncoded", "(", "))", ",", "header", ".", "getNonce", "(", "))", ");", "process", "(", "new", "BufferedBlockCipherAdapter", "(", "padded", ")", ",", "input", ",", "output", ")", ";", "}", "/", "**", "*", "Decodes", "the", "ciphertext", "header", "at", "the", "start", "of", "the", "given", "byte", "array", ".", "*", "Supports", "both", "original", "(", "deprecated", ")", "and", "v2", "formats", ".", "*", "*", "@", "param", "data", "Ciphertext", "data", "with", "prepended", "header", ".", "*", "@", "param", "keyLookup", "Decryption", "key", "lookup", "function", ".", "*", "*", "@", "return", "Ciphertext", "header", "instance", ".", "*", "/", "public", "static", "CiphertextHeader", "decodeHeader", "(", "final", "byte", "[", "]", "data", ",", "final", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ")", "{", "try", "{", "return", "CiphertextHeaderV2", ".", "decode", "(", "data", ",", "keyLookup", ")", ";", "}", "catch", "(", "EncodingException", "e", ")", "{", "return", "CiphertextHeader", ".", "decode", "(", "data", ")", ";", "}", "}", "/", "**", "*", "Decodes", "the", "ciphertext", "header", "at", "the", "start", "of", "the", "given", "input", "stream", ".", "*", "Supports", "both", "original", "(", "deprecated", ")", "and", "v2", "formats", ".", "*", "*", "@", "param", "in", "Ciphertext", "stream", "that", "is", "positioned", "at", "the", "start", "of", "the", "ciphertext", "header", ".", "*", "@", "param", "keyLookup", "Decryption", "key", "lookup", "function", ".", "*", "*", "@", "return", "Ciphertext", "header", "instance", ".", "*", "/", "public", "static", "CiphertextHeader", "decodeHeader", "(", "final", "InputStream", "in", ",", "final", "Function", "<", "String", ",", "SecretKey", ">", "keyLookup", ")", "{", "CiphertextHeader", "header", ";", "try", "{", "/", "/", "Mark", "the", "stream", "start", "position", "so", "we", "can", "try", "again", "with", "old", "format", "header", "if", "(", "in", ".", "markSupported", "(", "))", "{", "in", ".", "mark", "(", "4", ")", ";", "}", "header", "=", "CiphertextHeaderV2", ".", "decode", "(", "in", ",", "keyLookup", ")", ";", "}", "catch", "(", "EncodingException", "e", ")", "{", "try", "{", "in", ".", "reset", "(", ");", "}", "catch", "(", "IOException", "ioe", ")", "{", "throw", "new", "StreamException", "(", "\"", "Stream", "error", "trying", "to", "process", "old", "header", "format", ":", "\"", "+", "ioe", ".", "getMessage", "(", "))", ";", "}", "header", "=", "CiphertextHeader", ".", "decode", "(", "in", ")", ";", "}", "return", "header", ";", "}", "/", "**", "*", "Encrypts", "the", "given", "data", ".", "*", "@", "@", "-", "0", ",", "0", "+", "1", ",", "55", "@", "@", "/", "*", "See", "LICENSE", "for", "licensing", "and", "NOTICE", "for", "copyright", ".", "*", "/", "package", "org", ".", "cryptacular", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "cryptacular", ".", "util", ".", "CodecUtil", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertEquals", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "CiphertextHeader", "}", ".", "*", "*", "@", "author", "Middleware", "Services", "*", "/", "public", "class", "CiphertextHeaderTest", "{", "@", "Test", "(", "expectedExceptions", "=", "IllegalArgumentException", ".", "class", ",", "expectedExceptionsMessageRegExp", "=", "\"", "Nonce", "exceeds", "size", "limit", "in", "bytes", ".", "*\"", ")", "public", "void", "testNonceLimitConstructor", "(", ")", "{", "new", "CiphertextHeader", "(", "new", "byte", "[", "256", "]", ",", "\"", "key2", "\"", ");", "}", "@", "Test", "public", "void", "testEncodeDecodeSuccess", "(", ")", "{", "final", "byte", "[", "]", "nonce", "=", "new", "byte", "[", "255", "]", ";", "Arrays", ".", "fill", "(", "nonce", ",", "(", "byte", ")", "7", ")", ";", "final", "CiphertextHeader", "expected", "=", "new", "CiphertextHeader", "(", "nonce", ",", "\"", "aleph", "\"", ");", "final", "byte", "[", "]", "encoded", "=", "expected", ".", "encode", "(", ");", "assertEquals", "(", "expected", ".", "getLength", "(", "),", "encoded", ".", "length", ")", ";", "final", "CiphertextHeader", "actual", "=", "CiphertextHeader", ".", "decode", "(", "encoded", ")", ";", "assertEquals", "(", "expected", ".", "getNonce", "(", "),", "actual", ".", "getNonce", "(", "))", ";", "assertEquals", "(", "expected", ".", "getKeyName", "(", "),", "actual", ".", "getKeyName", "(", "))", ";", "assertEquals", "(", "expected", ".", "getLength", "(", "),", "actual", ".", "getLength", "(", "))", ";", "}", "@", "Test", "(", "expectedExceptions", "=", "EncodingException", ".", "class", ",", "expectedExceptionsMessageRegExp", "=", "\"", "Bad", "ciphertext", "header", ":", "maximum", "nonce", "length", "exceeded", "\"", ")", "public", "void", "testDecodeFailNonceLengthExceeded", "(", ")", "{", "/", "/", "https", ":", "//", "github", ".", "com", "/", "vt", "-", "middleware", "/", "cryptacular", "/", "issues", "/", "52", "CiphertextHeader", ".", "decode", "(", "CodecUtil", ".", "hex", "(", "\"", "000000347ffffffd", "\"", "))", ";", "}", "@", "Test", "(", "expectedExceptions", "=", "EncodingException", ".", "class", ",", "expectedExceptionsMessageRegExp", "=", "\"", "Bad", "ciphertext", "header", ":", "maximum", "key", "length", "exceeded", "\"", ")", "public", "void", "testDecodeFailKeyLengthExceeded", "(", ")", "{", "CiphertextHeader", ".", "decode", "(", "CodecUtil", ".", "hex", "(", "\"", "000000F300000004DEADBEEF00FFFFFF", "\"", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "67", "@", "@", "/", "*", "See", "LICENSE", "for", "licensing", "and", "NOTICE", "for", "copyright", ".", "*", "/", "package", "org", ".", "cryptacular", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "javax", ".", "crypto", ".", "SecretKey", ";", "import", "javax", ".", "crypto", ".", "spec", ".", "SecretKeySpec", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "sp80038a", ".", "RBGNonce", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "import", "static", "org", ".", "testng", ".", "Assert", ".", "assertEquals", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "CiphertextHeaderV2", "}", ".", "*", "*", "@", "author", "Middleware", "Services", "*", "/", "public", "class", "CiphertextHeaderV2Test", "{", "/", "**", "Test", "HMAC", "key", ".", "*", "/", "private", "final", "SecretKey", "key", "=", "new", "SecretKeySpec", "(", "new", "RBGNonce", "(", ").", "generate", "(", "),", "\"", "AES", "\"", ");", "@", "Test", "(", "expectedExceptions", "=", "IllegalArgumentException", ".", "class", ",", "expectedExceptionsMessageRegExp", "=", "\"", "Nonce", "exceeds", "size", "limit", "in", "bytes", ".", "*\"", ")", "public", "void", "testNonceLimitConstructor", "(", ")", "{", "new", "CiphertextHeaderV2", "(", "new", "byte", "[", "256", "]", ",", "\"", "key2", "\"", ");", "}", "@", "Test", "public", "void", "testEncodeDecodeSuccess", "(", ")", "{", "final", "byte", "[", "]", "nonce", "=", "new", "byte", "[", "255", "]", ";", "Arrays", ".", "fill", "(", "nonce", ",", "(", "byte", ")", "7", ")", ";", "final", "CiphertextHeaderV2", "expected", "=", "new", "CiphertextHeaderV2", "(", "nonce", ",", "\"", "aleph", "\"", ");", "expected", ".", "setKeyLookup", "(", "this", ":", ":", "getKey", ")", ";", "final", "byte", "[", "]", "encoded", "=", "expected", ".", "encode", "(", ");", "assertEquals", "(", "expected", ".", "getLength", "(", "),", "encoded", ".", "length", ")", ";", "final", "CiphertextHeaderV2", "actual", "=", "CiphertextHeaderV2", ".", "decode", "(", "encoded", ",", "this", ":", ":", "getKey", ")", ";", "assertEquals", "(", "expected", ".", "getNonce", "(", "),", "actual", ".", "getNonce", "(", "))", ";", "assertEquals", "(", "expected", ".", "getKeyName", "(", "),", "actual", ".", "getKeyName", "(", "))", ";", "assertEquals", "(", "expected", ".", "getLength", "(", "),", "actual", ".", "getLength", "(", "))", ";", "}", "@", "Test", "(", "expectedExceptions", "=", "EncodingException", ".", "class", ",", "expectedExceptionsMessageRegExp", "=", "\"", "Ciphertext", "header", "HMAC", "verification", "failed", "\"", ")", "public", "void", "testEncodeDecodeFailBadHMAC", "(", ")", "{", "final", "byte", "[", "]", "nonce", "=", "new", "byte", "[", "16", "]", ";", "Arrays", ".", "fill", "(", "nonce", ",", "(", "byte", ")", "3", ")", ";", "final", "CiphertextHeaderV2", "expected", "=", "new", "CiphertextHeaderV2", "(", "nonce", ",", "\"", "aleph", "\"", ");", "/", "/", "Tamper", "with", "computed", "HMAC", "final", "byte", "[", "]", "encoded", "=", "expected", ".", "encode", "(", "key", ")", ";", "final", "int", "index", "=", "encoded", ".", "length", "-", "3", ";", "final", "byte", "b", "=", "encoded", "[", "index", "]", ";", "encoded", "[", "index", "]", "=", "(", "byte", ")", "(", "b", "+", "1", ")", ";", "CiphertextHeaderV2", ".", "decode", "(", "encoded", ",", "this", ":", ":", "getKey", ")", ";", "}", "private", "SecretKey", "getKey", "(", "final", "String", "alias", ")", "{", "if", "(", "\"", "aleph", "\"", ".", "equals", "(", "alias", ")", ")", "{", "return", "key", ";", "}", "return", "null", ";", "}", "}", "@", "@", "-", "5", ",", "12", "+", "5", ",", "12", "@", "@", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "javax", ".", "crypto", ".", "SecretKey", ";", "import", "org", ".", "cryptacular", ".", "FailListener", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "sp80038d", ".", "CounterNonce", ";", "import", "org", ".", "cryptacular", ".", "io", ".", "FileResource", ";", "import", "org", ".", "cryptacular", ".", "spec", ".", "AEADBlockCipherSpec", ";", "import", "org", ".", "cryptacular", ".", "util", ".", "ByteUtil", ";", "import", "org", ".", "cryptacular", ".", "util", ".", "CodecUtil", ";", "import", "org", ".", "cryptacular", ".", "util", ".", "StreamUtil", ";", "import", "org", ".", "testng", ".", "annotations", ".", "DataProvider", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Listeners", ";", "@", "@", "-", "25", ",", "6", "+", "25", ",", "7", "@", "@", "@", "Listeners", "(", "FailListener", ".", "class", ")", "public", "class", "AEADBlockCipherBeanTest", "{", "@", "DataProvider", "(", "name", "=", "\"", "test", "-", "arrays", "\"", ")", "public", "Object", "[", "][", "]", "getTestArrays", "(", ")", "{", "@", "@", "-", "78", ",", "14", "+", "79", ",", "7", "@", "@", "public", "void", "testEncryptDecryptArray", "(", "final", "String", "input", ",", "final", "String", "cipherSpecString", ")", "throws", "Exception", "{", "final", "AEADBlockCipherBean", "cipherBean", "=", "new", "AEADBlockCipherBean", "(", ");", "final", "AEADBlockCipherSpec", "cipherSpec", "=", "AEADBlockCipherSpec", ".", "parse", "(", "cipherSpecString", ")", ";", "cipherBean", ".", "setNonce", "(", "new", "CounterNonce", "(", "\"", "vtmw", "\"", ",", "System", ".", "nanoTime", "(", "))", ");", "cipherBean", ".", "setKeyAlias", "(", "\"", "vtcrypt", "\"", ");", "cipherBean", ".", "setKeyPassword", "(", "\"", "vtcrypt", "\"", ");", "cipherBean", ".", "setKeyStore", "(", "getTestKeyStore", "(", "))", ";", "cipherBean", ".", "setBlockCipherSpec", "(", "cipherSpec", ")", ";", "final", "AEADBlockCipherBean", "cipherBean", "=", "newCipherBean", "(", "AEADBlockCipherSpec", ".", "parse", "(", "cipherSpecString", ")", ");", "final", "byte", "[", "]", "ciphertext", "=", "cipherBean", ".", "encrypt", "(", "ByteUtil", ".", "toBytes", "(", "input", ")", ");", "assertEquals", "(", "ByteUtil", ".", "toString", "(", "cipherBean", ".", "decrypt", "(", "ciphertext", ")", "),", "input", ")", ";", "}", "@", "@", "-", "95", ",", "14", "+", "89", ",", "7", "@", "@", "public", "void", "testEncryptDecryptArray", "(", "final", "String", "input", ",", "final", "String", "cipherSpecS", "public", "void", "testEncryptDecryptStream", "(", "final", "String", "path", ",", "final", "String", "cipherSpecString", ")", "throws", "Exception", "{", "final", "AEADBlockCipherBean", "cipherBean", "=", "new", "AEADBlockCipherBean", "(", ");", "final", "AEADBlockCipherSpec", "cipherSpec", "=", "AEADBlockCipherSpec", ".", "parse", "(", "cipherSpecString", ")", ";", "cipherBean", ".", "setNonce", "(", "new", "CounterNonce", "(", "\"", "vtmw", "\"", ",", "System", ".", "nanoTime", "(", "))", ");", "cipherBean", ".", "setKeyAlias", "(", "\"", "vtcrypt", "\"", ");", "cipherBean", ".", "setKeyPassword", "(", "\"", "vtcrypt", "\"", ");", "cipherBean", ".", "setKeyStore", "(", "getTestKeyStore", "(", "))", ";", "cipherBean", ".", "setBlockCipherSpec", "(", "cipherSpec", ")", ";", "final", "AEADBlockCipherBean", "cipherBean", "=", "newCipherBean", "(", "AEADBlockCipherSpec", ".", "parse", "(", "cipherSpecString", ")", ");", "final", "ByteArrayOutputStream", "tempOut", "=", "new", "ByteArrayOutputStream", "(", "8192", ")", ";", "cipherBean", ".", "encrypt", "(", "StreamUtil", ".", "makeStream", "(", "new", "File", "(", "path", ")", "),", "tempOut", ")", ";", "@", "@", "-", "113", ",", "6", "+", "100", ",", "34", "@", "@", "public", "void", "testEncryptDecryptStream", "(", "final", "String", "path", ",", "final", "String", "cipherSpecS", "}", "@", "Test", "public", "void", "testDecryptArrayBackwardCompatibleHeader", "(", ")", "{", "final", "AEADBlockCipherBean", "cipherBean", "=", "newCipherBean", "(", "new", "AEADBlockCipherSpec", "(", "\"", "Twofish", "\"", ",", "\"", "OCB", "\"", "))", ";", "final", "String", "expected", "=", "\"", "Have", "you", "passed", "through", "this", "night", "?", "\";", "final", "String", "v1CiphertextHex", "=", "\"", "0000001f0000000c76746d770002ba17043672d900000007767463727970745a38dee735266e3f5f7aafec8d1c9ed8a0830a2ff9", "\"", "\"", "c3a46c25f89e69b6eb39dbb82fd13da50e32b2544a73f1a4476677b377e6", "\"", ";", "final", "byte", "[", "]", "plaintext", "=", "cipherBean", ".", "decrypt", "(", "CodecUtil", ".", "hex", "(", "v1CiphertextHex", ")", ");", "assertEquals", "(", "expected", ",", "ByteUtil", ".", "toString", "(", "plaintext", ")", ");", "}", "@", "Test", "public", "void", "testDecryptStreamBackwardCompatibleHeader", "(", ")", "{", "final", "AEADBlockCipherBean", "cipherBean", "=", "newCipherBean", "(", "new", "AEADBlockCipherSpec", "(", "\"", "Twofish", "\"", ",", "\"", "OCB", "\"", "))", ";", "final", "String", "expected", "=", "\"", "Have", "you", "passed", "through", "this", "night", "?", "\";", "final", "String", "v1CiphertextHex", "=", "\"", "0000001f0000000c76746d770002ba17043672d900000007767463727970745a38dee735266e3f5f7aafec8d1c9ed8a0830a2ff9", "\"", "\"", "c3a46c25f89e69b6eb39dbb82fd13da50e32b2544a73f1a4476677b377e6", "\"", ";", "final", "ByteArrayInputStream", "in", "=", "new", "ByteArrayInputStream", "(", "CodecUtil", ".", "hex", "(", "v1CiphertextHex", ")", ");", "final", "ByteArrayOutputStream", "out", "=", "new", "ByteArrayOutputStream", "(", ");", "cipherBean", ".", "decrypt", "(", "in", ",", "out", ")", ";", "assertEquals", "(", "expected", ",", "ByteUtil", ".", "toString", "(", "out", ".", "toByteArray", "(", "))", ");", "}", "private", "static", "KeyStore", "getTestKeyStore", "(", ")", "{", "final", "KeyStoreFactoryBean", "bean", "=", "new", "KeyStoreFactoryBean", "(", ");", "@", "@", "-", "122", ",", "12", "+", "137", ",", "15", "@", "@", "private", "static", "KeyStore", "getTestKeyStore", "(", ")", "return", "bean", ".", "newInstance", "(", ");", "}", "private", "static", "SecretKey", "getTestKey", "(", ")", "private", "static", "AEADBlockCipherBean", "newCipherBean", "(", "final", "AEADBlockCipherSpec", "cipherSpec", ")", "{", "final", "KeyStoreBasedKeyFactoryBean", "<", "SecretKey", ">", "secretKeyFactoryBean", "=", "new", "KeyStoreBasedKeyFactoryBean", "<", ">(", ");", "secretKeyFactoryBean", ".", "setKeyStore", "(", "getTestKeyStore", "(", "))", ";", "secretKeyFactoryBean", ".", "setPassword", "(", "\"", "vtcrypt", "\"", ");", "secretKeyFactoryBean", ".", "setAlias", "(", "\"", "vtcrypt", "\"", ");", "return", "secretKeyFactoryBean", ".", "newInstance", "(", ");", "final", "AEADBlockCipherBean", "cipherBean", "=", "new", "AEADBlockCipherBean", "(", ");", "cipherBean", ".", "setNonce", "(", "new", "CounterNonce", "(", "\"", "vtmw", "\"", ",", "System", ".", "nanoTime", "(", "))", ");", "cipherBean", ".", "setKeyAlias", "(", "\"", "vtcrypt", "\"", ");", "cipherBean", ".", "setKeyPassword", "(", "\"", "vtcrypt", "\"", ");", "cipherBean", ".", "setKeyStore", "(", "getTestKeyStore", "(", "))", ";", "cipherBean", ".", "setBlockCipherSpec", "(", "cipherSpec", ")", ";", "return", "cipherBean", ";", "}", "}", "@", "@", "-", "17", ",", "11", "+", "17", ",", "14", "@", "@", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "modes", ".", "OCBBlockCipher", ";", "import", "org", ".", "bouncycastle", ".", "crypto", ".", "modes", ".", "OFBBlockCipher", ";", "import", "org", ".", "cryptacular", ".", "FailListener", ";", "import", "org", ".", "cryptacular", ".", "bean", ".", "KeyStoreBasedKeyFactoryBean", ";", "import", "org", ".", "cryptacular", ".", "bean", ".", "KeyStoreFactoryBean", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "Nonce", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "SecretKeyGenerator", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "sp80038a", ".", "LongCounterNonce", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "sp80038a", ".", "RBGNonce", ";", "import", "org", ".", "cryptacular", ".", "generator", ".", "sp80038d", ".", "CounterNonce", ";", "import", "org", ".", "cryptacular", ".", "io", ".", "FileResource", ";", "import", "org", ".", "testng", ".", "annotations", ".", "DataProvider", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Listeners", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "@", "@", "-", "35", ",", "6", "+", "38", ",", "22", "@", "@", "@", "Listeners", "(", "FailListener", ".", "class", ")", "public", "class", "CipherUtilTest", "{", "/", "**", "Static", "key", "derived", "from", "keystore", "on", "resource", "classpath", ".", "*", "/", "private", "static", "final", "SecretKey", "STATIC_KEY", ";", "static", "{", "final", "KeyStoreFactoryBean", "keyStoreFactory", "=", "new", "KeyStoreFactoryBean", "(", ");", "keyStoreFactory", ".", "setPassword", "(", "\"", "vtcrypt", "\"", ");", "keyStoreFactory", ".", "setResource", "(", "new", "FileResource", "(", "new", "File", "(", "\"", "src", "/", "test", "/", "resources", "/", "keystores", "/", "cipher", "-", "bean", ".", "jceks", "\"", "))", ");", "keyStoreFactory", ".", "setType", "(", "\"", "JCEKS", "\"", ");", "final", "KeyStoreBasedKeyFactoryBean", "<", "SecretKey", ">", "keyFactory", "=", "new", "KeyStoreBasedKeyFactoryBean", "<", ">(", ");", "keyFactory", ".", "setKeyStore", "(", "keyStoreFactory", ".", "newInstance", "(", "))", ";", "keyFactory", ".", "setAlias", "(", "\"", "vtcrypt", "\"", ");", "keyFactory", ".", "setPassword", "(", "\"", "vtcrypt", "\"", ");", "STATIC_KEY", "=", "keyFactory", ".", "newInstance", "(", ");", "}", "@", "DataProvider", "(", "name", "=", "\"", "block", "-", "cipher", "\"", ")", "public", "Object", "[", "][", "]", "getBlockCipherData", "(", ")", "{", "@", "@", "-", "165", ",", "4", "+", "184", ",", "32", "@", "@", "public", "void", "testAeadBlockCipherEncryptDecryptStream", "(", "final", "String", "path", ")", "CipherUtil", ".", "decrypt", "(", "cipher", ",", "key", ",", "tempIn", ",", "actual", ")", ";", "assertEquals", "(", "new", "String", "(", "actual", ".", "toByteArray", "(", "))", ",", "expected", ")", ";", "}", "@", "Test", "public", "void", "testDecryptArrayBackwardCompatibleHeader", "(", ")", "{", "final", "AEADBlockCipher", "cipher", "=", "new", "OCBBlockCipher", "(", "new", "TwofishEngine", "(", "),", "new", "TwofishEngine", "(", "))", ";", "final", "String", "expected", "=", "\"", "Have", "you", "passed", "through", "this", "night", "?", "\";", "final", "String", "v1CiphertextHex", "=", "\"", "0000001f0000000c76746d770002ba17043672d900000007767463727970745a38dee735266e3f5f7aafec8d1c9ed8a0830a2ff9", "\"", "\"", "c3a46c25f89e69b6eb39dbb82fd13da50e32b2544a73f1a4476677b377e6", "\"", ";", "final", "byte", "[", "]", "plaintext", "=", "CipherUtil", ".", "decrypt", "(", "cipher", ",", "STATIC_KEY", ",", "CodecUtil", ".", "hex", "(", "v1CiphertextHex", ")", ");", "assertEquals", "(", "expected", ",", "ByteUtil", ".", "toString", "(", "plaintext", ")", ");", "}", "@", "Test", "public", "void", "testDecryptStreamBackwardCompatibleHeader", "(", ")", "{", "final", "AEADBlockCipher", "cipher", "=", "new", "OCBBlockCipher", "(", "new", "TwofishEngine", "(", "),", "new", "TwofishEngine", "(", "))", ";", "final", "String", "expected", "=", "\"", "Have", "you", "passed", "through", "this", "night", "?", "\";", "final", "String", "v1CiphertextHex", "=", "\"", "0000001f0000000c76746d770002ba17043672d900000007767463727970745a38dee735266e3f5f7aafec8d1c9ed8a0830a2ff9", "\"", "\"", "c3a46c25f89e69b6eb39dbb82fd13da50e32b2544a73f1a4476677b377e6", "\"", ";", "final", "ByteArrayInputStream", "in", "=", "new", "ByteArrayInputStream", "(", "CodecUtil", ".", "hex", "(", "v1CiphertextHex", ")", ");", "final", "ByteArrayOutputStream", "out", "=", "new", "ByteArrayOutputStream", "(", ");", "CipherUtil", ".", "decrypt", "(", "cipher", ",", "STATIC_KEY", ",", "in", ",", "out", ")", ";", "assertEquals", "(", "expected", ",", "ByteUtil", ".", "toString", "(", "out", ".", "toByteArray", "(", "))", ");", "}", "}"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request"]}
{"contents": ["[SECURITY-1293]", "Secure", "the", "script", "check", "in", "StringScriptSource"], "code_tokens": ["@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "19", "<", "/", "version", ">", "<", "version", ">", "3", ".", "21", "<", "/", "version", ">", "<", "relativePath", "/", ">", "<", "/", "parent", ">", "@", "@", "-", "15", ",", "8", "+", "15", ",", "8", "@", "@", "<", "url", ">", "http", ":", "//", "wiki", ".", "jenkins", "-", "ci", ".", "org", "/", "display", "/", "JENKINS", "/", "Groovy", "+", "plugin", "<", "/", "url", ">", "<", "properties", ">", "<", "jenkins", ".", "version", ">", "1", ".", "580", ".", "3", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "6", "<", "/", "java", ".", "level", ">", "<", "jenkins", ".", "version", ">", "2", ".", "7", ".", "3", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "7", "<", "/", "java", ".", "level", ">", "<", "/", "properties", ">", "<", "developers", ">", "@", "@", "-", "53", ",", "7", "+", "53", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "script", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "24", "<", "/", "version", ">", "<", "version", ">", "1", ".", "50", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "10", ",", "6", "+", "10", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilationFailedException", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "scriptsecurity", ".", "sandbox", ".", "groovy", ".", "GroovySandbox", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "DataBoundConstructor", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "@", "@", "-", "67", ",", "7", "+", "68", ",", "7", "@", "@", "public", "FormValidation", "doCheckScript", "(", "@", "QueryParameter", "String", "command", ")", "{", "return", "FormValidation", ".", "error", "(", "\"", "Script", "seems", "to", "be", "empty", "string", "!", "\")", ";", "try", "{", "new", "GroovyShell", "(", ").", "parse", "(", "command", ")", ";", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ".", "parse", "(", "command", ")", ";", "return", "FormValidation", ".", "ok", "(", "\"", "So", "far", "so", "good", "\"", ");", "}", "catch", "(", "CompilationFailedException", "e", ")", "{", "return", "FormValidation", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2019", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "plugins", ".", "groovy", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "StringScriptSourceTest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "1293", "\"", ")", "@", "Test", "public", "void", "blockASTTest", "(", ")", "throws", "Exception", "{", "StringScriptSource", ".", "DescriptorImpl", "d", "=", "j", ".", "jenkins", ".", "getDescriptorByType", "(", "StringScriptSource", ".", "DescriptorImpl", ".", "class", ")", ";", "assertThat", "(", "d", ".", "doCheckScript", "(", "\"", "import", "groovy", ".", "transform", ".", "*\\", "n", "\"", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "import", "hudson", ".", "model", ".", "FreeStyleProject", "\\", "n", "\"", "\"", "@", "ASTTest", "(", "value", "=", "{", "assert", "Jenkins", ".", "getInstance", "(", ").", "createProject", "(", "FreeStyleProject", ".", "class", ",", "\\", "\"", "should", "-", "not", "-", "exist", "\\", "\")", "}", ")\\", "n", "\"", "\"", "@", "Field", "int", "x", "\\", "n", "\"", "\"", "echo", "'", "hello", "'", "\\", "n", "\"", ").", "toString", "(", "),", "containsString", "(", "\"", "Annotation", "ASTTest", "cannot", "be", "used", "in", "the", "sandbox", "\"", "))", ";", "assertNull", "(", "j", ".", "jenkins", ".", "getItem", "(", "\"", "should", "-", "not", "-", "exist", "\"", "))", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1293", "\"", ")", "@", "Test", "public", "void", "blockGrab", "(", ")", "throws", "Exception", "{", "StringScriptSource", ".", "DescriptorImpl", "d", "=", "j", ".", "jenkins", ".", "getDescriptorByType", "(", "StringScriptSource", ".", "DescriptorImpl", ".", "class", ")", ";", "assertThat", "(", "d", ".", "doCheckScript", "(", "\"@", "Grab", "(", "group", "=", "'", "foo", "'", ",", "module", "=", "'", "bar", "'", ",", "version", "=", "'", "1", ".", "0", "'", ")\\", "ndef", "foo", "\\", "n", "\"", ").", "toString", "(", "),", "containsString", "(", "\"", "Annotation", "Grab", "cannot", "be", "used", "in", "the", "sandbox", "\"", "))", ";", "}", "}"], "docstring_tokens": ["applying", "AST", "transforming", "annotations", "to", "source", "code", "elements"]}
{"contents": ["Unbreak", "crypt()", "(fix", "bug", "#55439)", "#", "If", "you", "want", "to", "remove", "static", "analyser", "messages,", "be", "my", "guest,", "#", "but", "please", "run", "unit", "tests", "after"], "code_tokens": ["@", "@", "-", "377", ",", "7", "+", "377", ",", "7", "@", "@", "char", "*", "php_md5_crypt_r", "(", "const", "char", "*", "pw", ",", "const", "char", "*", "salt", ",", "char", "*", "out", ")", "/", "*", "Now", "make", "the", "output", "string", "*", "/", "memcpy", "(", "passwd", ",", "MD5_MAGIC", ",", "MD5_MAGIC_LEN", ")", ";", "strlcpy", "(", "passwd", "+", "MD5_MAGIC_LEN", ",", "sp", ",", "sl", "+", "1", ")", ";", "strlcat", "(", "passwd", ",", "\"", "$\"", ",", "1", ")", ";", "strcat", "(", "passwd", ",", "\"", "$\"", ");", "PHP_MD5Final", "(", "final", ",", "&", "ctx", ")", ";"], "docstring_tokens": ["using", "an", "arbitrary", "password"]}
{"contents": ["Check", "for", "errors", "in", "BN_bn2dec()", "If", "an", "oversize", "BIGNUM", "is", "presented", "to", "BN_bn2dec()", "it", "can", "cause", "BN_div_word()", "to", "fail", "and", "not", "reduce", "the", "value", "of", "'t'", "resulting", "in", "OOB", "writes", "to", "the", "bn_data", "buffer", "and", "eventually", "crashing.", "Fix", "by", "checking", "return", "value", "of", "BN_div_word()", "and", "checking", "writes", "don't", "overflow", "buffer.", "Thanks", "to", "Shi", "Lei", "for", "reporting", "this", "bug.", "Reviewed-by:", "Tim", "Hudson", "<tjh@openssl.org>"], "code_tokens": ["@", "@", "-", "62", ",", "6", "+", "62", ",", "7", "@", "@", "char", "*", "BN_bn2dec", "(", "const", "BIGNUM", "*", "a", ")", "char", "*", "p", ";", "BIGNUM", "*", "t", "=", "NULL", ";", "BN_ULONG", "*", "bn_data", "=", "NULL", ",", "*", "lp", ";", "int", "bn_data_num", ";", "/", "*-", "*", "get", "an", "upper", "bound", "for", "the", "length", "of", "the", "decimal", "integer", "@", "@", "-", "71", ",", "7", "+", "72", ",", "8", "@", "@", "char", "*", "BN_bn2dec", "(", "const", "BIGNUM", "*", "a", ")", "*", "/", "i", "=", "BN_num_bits", "(", "a", ")", "*", "3", ";", "num", "=", "(", "i", "/", "10", "+", "i", "/", "1000", "+", "1", ")", "+", "1", ";", "bn_data", "=", "OPENSSL_malloc", "(", "(", "num", "/", "BN_DEC_NUM", "+", "1", ")", "*", "sizeof", "(", "BN_ULONG", ")", ");", "bn_data_num", "=", "num", "/", "BN_DEC_NUM", "+", "1", ";", "bn_data", "=", "OPENSSL_malloc", "(", "bn_data_num", "*", "sizeof", "(", "BN_ULONG", ")", ");", "buf", "=", "OPENSSL_malloc", "(", "num", "+", "3", ")", ";", "if", "(", "(", "buf", "=", "=", "NULL", ")", "|", "|", "(", "bn_data", "=", "=", "NULL", ")", ")", "{", "BNerr", "(", "BN_F_BN_BN2DEC", ",", "ERR_R_MALLOC_FAILURE", ")", ";", "@", "@", "-", "93", ",", "7", "+", "95", ",", "11", "@", "@", "char", "*", "BN_bn2dec", "(", "const", "BIGNUM", "*", "a", ")", "i", "=", "0", ";", "while", "(", "!", "BN_is_zero", "(", "t", ")", ")", "{", "*", "lp", "=", "BN_div_word", "(", "t", ",", "BN_DEC_CONV", ")", ";", "if", "(", "*", "lp", "=", "=", "(", "BN_ULONG", ")", "-", "1", ")", "goto", "err", ";", "lp", "+", "+;", "if", "(", "lp", "-", "bn_data", ">", "=", "bn_data_num", ")", "goto", "err", ";", "}", "lp", "-", "-;", "/", "*"], "docstring_tokens": ["using", "a", "specially", "crafted", "value"]}
{"contents": ["Sanity", "check", "record", "length", "before", "skipping", "explicit", "IV", "in", "DTLS", "to", "fix", "DoS", "attack.", "Thanks", "to", "Codenomicon", "for", "discovering", "this", "issue", "using", "Fuzz-o-Matic", "fuzzing", "as", "a", "service", "testing", "platform.", "(", ")"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "14", "@", "@", "Changes", "between", "0", ".", "9", ".", "8w", "and", "0", ".", "9", ".", "8x", "[", "xx", "XXX", "xxxx", "]", "*", ")", "Sanity", "check", "record", "length", "before", "skipping", "explicit", "IV", "in", "DTLS", "to", "fix", "DoS", "attack", ".", "Thanks", "to", "Codenomicon", "for", "discovering", "this", "issue", "using", "Fuzz", "-", "o", "-", "Matic", "fuzzing", "as", "a", "service", "testing", "platform", ".", "(", "CVE", "-", "2012", "-", "2333", ")", "[", "Steve", "Henson", "]", "*", ")", "Initialise", "tkeylen", "properly", "when", "encrypting", "CMS", "messages", ".", "Thanks", "to", "Solar", "Designer", "of", "Openwall", "for", "reporting", "this", "issue", ".", "[", "Steve", "Henson", "]", "@", "@", "-", "249", ",", "7", "+", "249", ",", "7", "@", "@", "int", "dtls1_enc", "(", "SSL", "*", "s", ",", "int", "send", ")", "}", "/", "*", "TLS", "1", ".", "0", "does", "not", "bound", "the", "number", "of", "padding", "bytes", "by", "the", "block", "size", ".", "*", "All", "of", "them", "must", "have", "value", "'", "padding_length", "'", ".", "*", "/", "if", "(", "i", ">", "(", "int", ")", "rec", "-", ">", "length", ")", "if", "(", "i", "+", "bs", ">", "(", "int", ")", "rec", "-", ">", "length", ")", "{", "/", "*", "Incorrect", "padding", ".", "SSLerr", "(", ")", "and", "ssl3_alert", "are", "done", "*", "by", "caller", ":", "we", "don", "'", "t", "want", "to", "reveal", "whether", "this", "is"], "docstring_tokens": ["using", "Fuzz-o-Matic", "fuzzing", "as", "a", "service", "testing", "platform"]}
{"contents": ["HV-912", "Reducing", "accessibility", "of", "some", "classes", "and", "methods"], "code_tokens": ["@", "@", "-", "21", ",", "7", "+", "21", ",", "6", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "Cascadable", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "GroupConversionTargetContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "Unwrapable", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newHashMap", ";", "@", "@", "-", "30", ",", "14", "+", "29", ",", "14", "@", "@", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "abstract", "class", "CascadableConstraintMappingContextImplBase", "<", "C", "extends", "Cascadable", "<", "C", ">", "&", "Unwrapable", "<", "C", ">", ">", "abstract", "class", "CascadableConstraintMappingContextImplBase", "<", "C", "extends", "Cascadable", "<", "C", ">", "&", "Unwrapable", "<", "C", ">", ">", "extends", "ConstraintMappingContextImplBase", "implements", "Cascadable", "<", "C", ">", ",", "Unwrapable", "<", "C", ">", "{", "protected", "boolean", "isCascading", ";", "protected", "Map", "<", "Class", "<", "?>", ",", "Class", "<", "?>", ">", "groupConversions", "=", "newHashMap", "(", ");", "private", "boolean", "unwrapValidatedValue", ";", "public", "CascadableConstraintMappingContextImplBase", "(", "DefaultConstraintMapping", "mapping", ")", "{", "CascadableConstraintMappingContextImplBase", "(", "DefaultConstraintMapping", "mapping", ")", "{", "super", "(", "mapping", ")", ";", "}", "@", "@", "-", "36", ",", "7", "+", "36", ",", "7", "@", "@", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "class", "ConfiguredConstraint", "<", "A", "extends", "Annotation", ">", "{", "class", "ConfiguredConstraint", "<", "A", "extends", "Annotation", ">", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "@", "@", "-", "51", ",", "11", "+", "51", ",", "11", "@", "@", "private", "ConfiguredConstraint", "(", "ConstraintDef", "<", "?,", "A", ">", "constraint", ",", "ConstraintLocation", "this", ".", "elementType", "=", "elementType", ";", "}", "public", "static", "<", "A", "extends", "Annotation", ">", "ConfiguredConstraint", "<", "A", ">", "forType", "(", "ConstraintDef", "<", "?,", "A", ">", "constraint", ",", "Class", "<", "?>", "beanType", ")", "{", "static", "<", "A", "extends", "Annotation", ">", "ConfiguredConstraint", "<", "A", ">", "forType", "(", "ConstraintDef", "<", "?,", "A", ">", "constraint", ",", "Class", "<", "?>", "beanType", ")", "{", "return", "new", "ConfiguredConstraint", "<", "A", ">", "(", "constraint", ",", "ConstraintLocation", ".", "forClass", "(", "beanType", ")", ",", "ElementType", ".", "TYPE", ")", ";", "}", "public", "static", "<", "A", "extends", "Annotation", ">", "ConfiguredConstraint", "<", "A", ">", "forProperty", "(", "ConstraintDef", "<", "?,", "A", ">", "constraint", ",", "Member", "member", ")", "{", "static", "<", "A", "extends", "Annotation", ">", "ConfiguredConstraint", "<", "A", ">", "forProperty", "(", "ConstraintDef", "<", "?,", "A", ">", "constraint", ",", "Member", "member", ")", "{", "return", "new", "ConfiguredConstraint", "<", "A", ">", "(", "constraint", ",", "ConstraintLocation", ".", "forProperty", "(", "member", ")", ",", "@", "@", "-", "21", ",", "7", "+", "21", ",", "6", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "TypeConstraintMappingContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "MetaConstraint", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "descriptor", ".", "ConstraintDescriptorImpl", ";", "@", "@", "-", "34", ",", "12", "+", "33", ",", "12", "@", "@", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "abstract", "class", "ConstraintMappingContextImplBase", "{", "abstract", "class", "ConstraintMappingContextImplBase", "{", "protected", "final", "DefaultConstraintMapping", "mapping", ";", "private", "final", "Set", "<", "ConfiguredConstraint", "<", "?>", ">", "constraints", ";", "public", "ConstraintMappingContextImplBase", "(", "DefaultConstraintMapping", "mapping", ")", "{", "ConstraintMappingContextImplBase", "(", "DefaultConstraintMapping", "mapping", ")", "{", "this", ".", "mapping", "=", "mapping", ";", "this", ".", "constraints", "=", "newHashSet", "(", ");", "}", "@", "@", "-", "29", ",", "13", "+", "29", ",", "13", "@", "@", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "final", "class", "CrossParameterConstraintMappingContextImpl", "final", "class", "CrossParameterConstraintMappingContextImpl", "extends", "ConstraintMappingContextImplBase", "implements", "CrossParameterConstraintMappingContext", "{", "private", "final", "ExecutableConstraintMappingContextImpl", "executableContext", ";", "public", "CrossParameterConstraintMappingContextImpl", "(", "ExecutableConstraintMappingContextImpl", "executableContext", ")", "{", "CrossParameterConstraintMappingContextImpl", "(", "ExecutableConstraintMappingContextImpl", "executableContext", ")", "{", "super", "(", "executableContext", ".", "getTypeContext", "(", ").", "getConstraintMapping", "(", ")", ")", ";", "this", ".", "executableContext", "=", "executableContext", ";", "}", "@", "@", "-", "14", ",", "14", "+", "14", ",", "14", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ";", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "context", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "ParameterNameProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "ConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "TypeConstraintMappingContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "context", ".", "TypeConstraintMappingContextImpl", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "AnnotationProcessingOptionsImpl", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "BeanConfiguration", ";", "@", "@", "-", "49", ",", "7", "+", "49", ",", "7", "@", "@", "*", "@", "author", "Kevin", "Pollet", "&", "lt", ";", "kevin", ".", "pollet", "@", "serli", ".", "com", "&", "gt", ";", "(", "C", ")", "2011", "SERLI", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "class", "ExecutableConstraintMappingContextImpl", "class", "ExecutableConstraintMappingContextImpl", "implements", "ConstructorConstraintMappingContext", ",", "MethodConstraintMappingContext", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "@", "@", "-", "60", ",", "11", "+", "60", ",", "11", "@", "@", "private", "ReturnValueConstraintMappingContextImpl", "returnValueContext", ";", "private", "CrossParameterConstraintMappingContextImpl", "crossParameterContext", ";", "public", "ExecutableConstraintMappingContextImpl", "(", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ",", "Constructor", "<", "?>", "constructor", ")", "{", "ExecutableConstraintMappingContextImpl", "(", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ",", "Constructor", "<", "?>", "constructor", ")", "{", "this", "(", "typeContext", ",", "ExecutableElement", ".", "forConstructor", "(", "constructor", ")", ")", ";", "}", "public", "ExecutableConstraintMappingContextImpl", "(", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ",", "Method", "method", ")", "{", "ExecutableConstraintMappingContextImpl", "(", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ",", "Method", "method", ")", "{", "this", "(", "typeContext", ",", "ExecutableElement", ".", "forMethod", "(", "method", ")", ")", ";", "}", "@", "@", "-", "23", ",", "13", "+", "23", ",", "13", "@", "@", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "class", "GroupConversionTargetContextImpl", "<", "C", ">", "implements", "GroupConversionTargetContext", "<", "C", ">", "{", "class", "GroupConversionTargetContextImpl", "<", "C", ">", "implements", "GroupConversionTargetContext", "<", "C", ">", "{", "private", "final", "C", "cascadableContext", ";", "private", "final", "Class", "<", "?>", "from", ";", "private", "final", "CascadableConstraintMappingContextImplBase", "<", "?>", "target", ";", "public", "GroupConversionTargetContextImpl", "(", "Class", "<", "?>", "from", ",", "C", "cascadableContext", ",", "CascadableConstraintMappingContextImplBase", "<", "?>", "target", ")", "{", "GroupConversionTargetContextImpl", "(", "Class", "<", "?>", "from", ",", "C", "cascadableContext", ",", "CascadableConstraintMappingContextImplBase", "<", "?>", "target", ")", "{", "this", ".", "from", "=", "from", ";", "this", ".", "cascadableContext", "=", "cascadableContext", ";", "this", ".", "target", "=", "target", ";", "@", "@", "-", "38", ",", "14", "+", "38", ",", "14", "@", "@", "*", "@", "author", "Gunnar", "Morling", "*", "@", "author", "Kevin", "Pollet", "&", "lt", ";", "kevin", ".", "pollet", "@", "serli", ".", "com", "&", "gt", ";", "(", "C", ")", "2011", "SERLI", "*", "/", "public", "final", "class", "ParameterConstraintMappingContextImpl", "final", "class", "ParameterConstraintMappingContextImpl", "extends", "CascadableConstraintMappingContextImplBase", "<", "ParameterConstraintMappingContext", ">", "implements", "ParameterConstraintMappingContext", "{", "private", "final", "ExecutableConstraintMappingContextImpl", "executableContext", ";", "private", "final", "int", "parameterIndex", ";", "public", "ParameterConstraintMappingContextImpl", "(", "ExecutableConstraintMappingContextImpl", "executableContext", ",", "int", "parameterIndex", ")", "{", "ParameterConstraintMappingContextImpl", "(", "ExecutableConstraintMappingContextImpl", "executableContext", ",", "int", "parameterIndex", ")", "{", "super", "(", "executableContext", ".", "getTypeContext", "(", ").", "getConstraintMapping", "(", ")", ")", ";", "this", ".", "executableContext", "=", "executableContext", ";", "@", "@", "-", "41", ",", "14", "+", "41", ",", "14", "@", "@", "*", "@", "author", "Gunnar", "Morling", "*", "@", "author", "Kevin", "Pollet", "&", "lt", ";", "kevin", ".", "pollet", "@", "serli", ".", "com", "&", "gt", ";", "(", "C", ")", "2011", "SERLI", "*", "/", "public", "final", "class", "PropertyConstraintMappingContextImpl", "final", "class", "PropertyConstraintMappingContextImpl", "extends", "CascadableConstraintMappingContextImplBase", "<", "PropertyConstraintMappingContext", ">", "implements", "PropertyConstraintMappingContext", "{", "private", "final", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ";", "private", "final", "Member", "member", ";", "public", "PropertyConstraintMappingContextImpl", "(", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ",", "Member", "member", ")", "{", "PropertyConstraintMappingContextImpl", "(", "TypeConstraintMappingContextImpl", "<", "?>", "typeContext", ",", "Member", "member", ")", "{", "super", "(", "typeContext", ".", "getConstraintMapping", "(", ")", ")", ";", "this", ".", "typeContext", "=", "typeContext", ";", "this", ".", "member", "=", "member", ";", "@", "@", "-", "99", ",", "7", "+", "99", ",", "7", "@", "@", "public", "MethodConstraintMappingContext", "method", "(", "String", "name", ",", "Class", "<", "?>", "..", ".", "parameterT", "return", "typeContext", ".", "method", "(", "name", ",", "parameterTypes", ")", ";", "}", "public", "ConstrainedElement", "build", "(", "ConstraintHelper", "constraintHelper", ")", "{", "ConstrainedElement", "build", "(", "ConstraintHelper", "constraintHelper", ")", "{", "if", "(", "member", "instanceof", "Field", ")", "{", "return", "new", "ConstrainedField", "(", "ConfigurationSource", ".", "API", ",", "@", "@", "-", "31", ",", "13", "+", "31", ",", "13", "@", "@", "*", "@", "author", "Gunnar", "Morling", "*", "@", "author", "Kevin", "Pollet", "&", "lt", ";", "kevin", ".", "pollet", "@", "serli", ".", "com", "&", "gt", ";", "(", "C", ")", "2011", "SERLI", "*", "/", "public", "final", "class", "ReturnValueConstraintMappingContextImpl", "final", "class", "ReturnValueConstraintMappingContextImpl", "extends", "CascadableConstraintMappingContextImplBase", "<", "ReturnValueConstraintMappingContext", ">", "implements", "ReturnValueConstraintMappingContext", "{", "private", "final", "ExecutableConstraintMappingContextImpl", "executableContext", ";", "public", "ReturnValueConstraintMappingContextImpl", "(", "ExecutableConstraintMappingContextImpl", "executableContext", ")", "{", "ReturnValueConstraintMappingContextImpl", "(", "ExecutableConstraintMappingContextImpl", "executableContext", ")", "{", "super", "(", "executableContext", ".", "getTypeContext", "(", ").", "getConstraintMapping", "(", ")", ")", ";", "this", ".", "executableContext", "=", "executableContext", ";", "}", "@", "@", "-", "33", ",", "7", "+", "33", ",", "6", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "MethodConstraintMappingContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "PropertyConstraintMappingContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "context", ".", "TypeConstraintMappingContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "descriptor", ".", "ConstraintDescriptorImpl", ".", "ConstraintType", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "location", ".", "ConstraintLocation", ";", "@", "@", "-", "80", ",", "7", "+", "79", ",", "7", "@", "@", "private", "List", "<", "Class", "<", "?>", ">", "defaultGroupSequence", ";", "private", "Class", "<", "?", "extends", "DefaultGroupSequenceProvider", "<", "?", "super", "C", ">", ">", "defaultGroupSequenceProviderClass", ";", "public", "TypeConstraintMappingContextImpl", "(", "DefaultConstraintMapping", "mapping", ",", "Class", "<", "C", ">", "beanClass", ")", "{", "TypeConstraintMappingContextImpl", "(", "DefaultConstraintMapping", "mapping", ",", "Class", "<", "C", ">", "beanClass", ")", "{", "super", "(", "mapping", ")", ";", "this", ".", "beanClass", "=", "beanClass", ";", "mapping", ".", "getAnnotationProcessingOptions", "(", ").", "ignoreAnnotationConstraintForClass", "(", "beanClass", ",", "Boolean", ".", "FALSE", ")", ";", "@", "@", "-", "199", ",", "7", "+", "198", ",", "7", "@", "@", "public", "ConstructorConstraintMappingContext", "constructor", "(", "Class", "<", "?>", "..", ".", "parameterType", "return", "context", ";", "}", "public", "BeanConfiguration", "<", "C", ">", "build", "(", "ConstraintHelper", "constraintHelper", ",", "ParameterNameProvider", "parameterNameProvider", ")", "{", "BeanConfiguration", "<", "C", ">", "build", "(", "ConstraintHelper", "constraintHelper", ",", "ParameterNameProvider", "parameterNameProvider", ")", "{", "return", "new", "BeanConfiguration", "<", "C", ">", "(", "ConfigurationSource", ".", "API", ",", "beanClass", ",", "@", "@", "-", "243", ",", "7", "+", "242", ",", "7", "@", "@", "public", "ConstructorConstraintMappingContext", "constructor", "(", "Class", "<", "?>", "..", ".", "parameterType", ")", ":", "null", ";", "}", "public", "Class", "<", "?>", "getBeanClass", "(", ")", "{", "Class", "<", "?>", "getBeanClass", "(", ")", "{", "return", "beanClass", ";", "}", "@", "@", "-", "39", ",", "7", "+", "39", ",", "7", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidatorConfiguration", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "ConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "context", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "constraintvalidation", ".", "ConstraintValidatorFactoryImpl", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "resolver", ".", "DefaultTraversableResolver", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "valuehandling", ".", "JavaFXPropertyValueUnwrapper", ";", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidatorConfiguration", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidatorContext", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidatorFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "context", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "constraintvalidation", ".", "ConstraintValidatorManager", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "BeanMetaDataManager", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "@", "@", "-", "17", ",", "9", "+", "17", ",", "10", "@", "@", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "provider", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "ParameterNameProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "context", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "AnnotationProcessingOptions", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "AnnotationProcessingOptionsImpl", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "*", "@", "author", "Gunnar", "Morling", "*", "@", "see", "java", ".", "lang", ".", "annotation", ".", "Annotation", "*", "/", "public", "class", "AnnotationProxy", "implements", "Annotation", ",", "InvocationHandler", ",", "Serializable", "{", "class", "AnnotationProxy", "implements", "Annotation", ",", "InvocationHandler", ",", "Serializable", "{", "private", "static", "final", "long", "serialVersionUID", "=", "6907601010599429454L", ";", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "@", "@", "-", "65", ",", "7", "+", "65", ",", "7", "@", "@", "private", "final", "Map", "<", "String", ",", "Object", ">", "values", ";", "private", "final", "int", "hashCode", ";", "public", "AnnotationProxy", "(", "AnnotationDescriptor", "<", "?>", "descriptor", ")", "{", "AnnotationProxy", "(", "AnnotationDescriptor", "<", "?>", "descriptor", ")", "{", "this", ".", "annotationType", "=", "descriptor", ".", "type", "(", ");", "values", "=", "Collections", ".", "unmodifiableMap", "(", "getAnnotationValues", "(", "descriptor", ")", ")", ";", "this", ".", "hashCode", "=", "calculateHashCode", "(", ");", "@", "@", "-", "51", ",", "14", "+", "51", ",", "14", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "ConstrainedExecutableBuilder", "{", "class", "ConstrainedExecutableBuilder", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "private", "ConstrainedExecutableBuilder", "(", ")", "{", "}", "public", "static", "Set", "<", "ConstrainedExecutable", ">", "buildMethodConstrainedExecutable", "(", "List", "<", "MethodType", ">", "methods", ",", "static", "Set", "<", "ConstrainedExecutable", ">", "buildMethodConstrainedExecutable", "(", "List", "<", "MethodType", ">", "methods", ",", "Class", "<", "?>", "beanClass", ",", "String", "defaultPackage", ",", "ParameterNameProvider", "parameterNameProvider", ",", "@", "@", "-", "125", ",", "7", "+", "125", ",", "7", "@", "@", "private", "ConstrainedExecutableBuilder", "(", ")", "{", "return", "constrainedExecutables", ";", "}", "public", "static", "Set", "<", "ConstrainedExecutable", ">", "buildConstructorConstrainedExecutable", "(", "List", "<", "ConstructorType", ">", "constructors", ",", "static", "Set", "<", "ConstrainedExecutable", ">", "buildConstructorConstrainedExecutable", "(", "List", "<", "ConstructorType", ">", "constructors", ",", "Class", "<", "?>", "beanClass", ",", "String", "defaultPackage", ",", "ParameterNameProvider", "parameterNameProvider", ",", "@", "@", "-", "41", ",", "13", "+", "41", ",", "13", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "ConstrainedFieldBuilder", "{", "class", "ConstrainedFieldBuilder", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "private", "ConstrainedFieldBuilder", "(", ")", "{", "}", "public", "static", "Set", "<", "ConstrainedField", ">", "buildConstrainedFields", "(", "List", "<", "FieldType", ">", "fields", ",", "static", "Set", "<", "ConstrainedField", ">", "buildConstrainedFields", "(", "List", "<", "FieldType", ">", "fields", ",", "Class", "<", "?>", "beanClass", ",", "String", "defaultPackage", ",", "ConstraintHelper", "constraintHelper", ",", "@", "@", "-", "43", ",", "13", "+", "43", ",", "13", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "ConstrainedGetterBuilder", "{", "class", "ConstrainedGetterBuilder", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "private", "ConstrainedGetterBuilder", "(", ")", "{", "}", "public", "static", "Set", "<", "ConstrainedExecutable", ">", "buildConstrainedGetters", "(", "List", "<", "GetterType", ">", "getterList", ",", "static", "Set", "<", "ConstrainedExecutable", ">", "buildConstrainedGetters", "(", "List", "<", "GetterType", ">", "getterList", ",", "Class", "<", "?>", "beanClass", ",", "String", "defaultPackage", ",", "ConstraintHelper", "constraintHelper", ",", "@", "@", "-", "40", ",", "12", "+", "40", ",", "12", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "ConstrainedParameterBuilder", "{", "class", "ConstrainedParameterBuilder", "{", "private", "ConstrainedParameterBuilder", "(", ")", "{", "}", "public", "static", "List", "<", "ConstrainedParameter", ">", "buildConstrainedParameters", "(", "List", "<", "ParameterType", ">", "parameterList", ",", "static", "List", "<", "ConstrainedParameter", ">", "buildConstrainedParameters", "(", "List", "<", "ParameterType", ">", "parameterList", ",", "ExecutableElement", "executableElement", ",", "String", "defaultPackage", ",", "ConstraintHelper", "constraintHelper", ",", "@", "@", "-", "35", ",", "12", "+", "35", ",", "12", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "ConstrainedTypeBuilder", "{", "class", "ConstrainedTypeBuilder", "{", "private", "ConstrainedTypeBuilder", "(", ")", "{", "}", "public", "static", "ConstrainedType", "buildConstrainedType", "(", "ClassType", "classType", ",", "static", "ConstrainedType", "buildConstrainedType", "(", "ClassType", "classType", ",", "Class", "<", "?>", "beanClass", ",", "String", "defaultPackage", ",", "ConstraintHelper", "constraintHelper", ",", "@", "@", "-", "26", ",", "12", "+", "26", ",", "12", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "GroupConversionBuilder", "{", "class", "GroupConversionBuilder", "{", "private", "GroupConversionBuilder", "(", ")", "{", "}", "public", "static", "Map", "<", "Class", "<", "?>", ",", "Class", "<", "?>", ">", "buildGroupConversionMap", "(", "List", "<", "GroupConversionType", ">", "groupConversionTypes", ",", "static", "Map", "<", "Class", "<", "?>", ",", "Class", "<", "?>", ">", "buildGroupConversionMap", "(", "List", "<", "GroupConversionType", ">", "groupConversionTypes", ",", "String", "defaultPackage", ")", "{", "Map", "<", "Class", "<", "?>", ",", "Class", "<", "?>", ">", "groupConversionMap", "=", "newHashMap", "(", ");", "for", "(", "GroupConversionType", "groupConversionType", ":", "groupConversionTypes", ")", "{", "@", "@", "-", "45", ",", "7", "+", "45", ",", "7", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "class", "MetaConstraintBuilder", "{", "class", "MetaConstraintBuilder", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "private", "static", "final", "String", "MESSAGE_PARAM", "=", "\"", "message", "\"", ";", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "private", "MetaConstraintBuilder", "(", ")", "{", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "static", "<", "A", "extends", "Annotation", ">", "MetaConstraint", "<", "A", ">", "buildMetaConstraint", "(", "ConstraintLocation", "constraintLocation", ",", "static", "<", "A", "extends", "Annotation", ">", "MetaConstraint", "<", "A", ">", "buildMetaConstraint", "(", "ConstraintLocation", "constraintLocation", ",", "ConstraintType", "constraint", ",", "java", ".", "lang", ".", "annotation", ".", "ElementType", "type", ",", "String", "defaultPackage", ",", "@", "@", "-", "14", ",", "7", "+", "14", ",", "7", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ";", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "xml", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "@", "@", "-", "30", ",", "7", "+", "30", ",", "7", "@", "@", "*", "*", "@", "author", "Hardy", "Ferentschik", "*", "/", "public", "final", "class", "ResourceLoaderHelper", "{", "final", "class", "ResourceLoaderHelper", "{", "private", "static", "final", "Log", "log", "=", "LoggerFactory", ".", "make", "(", ");", "/", "**", "@", "@", "-", "44", ",", "7", "+", "44", ",", "7", "@", "@", "*", "*", "@", "see", "InputStream", "#", "markSupported", "(", ")", "*", "/", "public", "static", "InputStream", "getResettableInputStreamForPath", "(", "String", "path", ")", "{", "static", "InputStream", "getResettableInputStreamForPath", "(", "String", "path", ")", "{", "/", "/", "TODO", "not", "sure", "if", "it", "'", "s", "the", "right", "thing", "to", "removing", "'", "/'", "String", "inputPath", "=", "path", ";", "if", "(", "inputPath", ".", "startsWith", "(", "\"", "/\"", ")", ")", "{", "@", "@", "-", "32", ",", "7", "+", "32", ",", "6", "@", "@", "import", "javax", ".", "validation", ".", "ValidationException", ";", "import", "javax", ".", "validation", ".", "spi", ".", "ValidationProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ResourceLoaderHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "LoadClass", ";", "@", "@", "-", "35", ",", "7", "+", "35", ",", "6", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ResourceLoaderHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "Log", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "logging", ".", "LoggerFactory", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewJaxbContext", ";", "@", "@", "-", "146", ",", "7", "+", "146", ",", "7", "@", "@", "private", "synchronized", "XMLEventReader", "createXmlEventReader", "(", "InputStream", "xmlStream", ")", "*", "@", "return", "the", "schema", "identified", "by", "the", "given", "resource", "name", "or", "{", "@", "code", "null", "}", "if", "the", "resource", "was", "not", "found", "or", "could", "*", "not", "be", "loaded", ".", "*", "/", "public", "Schema", "getSchema", "(", "String", "schemaResource", ")", "{", "Schema", "getSchema", "(", "String", "schemaResource", ")", "{", "Schema", "schema", "=", "schemaCache", ".", "get", "(", "schemaResource", ")", ";", "if", "(", "schema", "!", "=", "null", ")", "{", "@", "@", "-", "35", ",", "7", "+", "35", ",", "7", "@", "@", "*", "/", "public", "class", "PlatformResourceBundleLocator", "implements", "ResourceBundleLocator", "{", "private", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "PlatformResourceBundleLocator", ".", "class", ".", "getName", "(", ")", ")", ";", "private", "String", "bundleName", ";", "private", "final", "String", "bundleName", ";", "public", "PlatformResourceBundleLocator", "(", "String", "bundleName", ")", "{", "this", ".", "bundleName", "=", "bundleName", ";", "@", "@", "-", "49", ",", "6", "+", "49", ",", "7", "@", "@", "public", "PlatformResourceBundleLocator", "(", "String", "bundleName", ")", "{", "*", "*", "@", "return", "the", "resource", "bundle", "or", "<", "code", ">", "null", "<", "/", "code", ">", "if", "none", "is", "found", ".", "*", "/", "@", "Override", "public", "ResourceBundle", "getResourceBundle", "(", "Locale", "locale", ")", "{", "ResourceBundle", "rb", "=", "null", ";", "ClassLoader", "classLoader", "=", "GetClassLoader", ".", "fromContext", "(", ");", "@", "@", "-", "91", ",", "7", "+", "92", ",", "7", "@", "@", "private", "ResourceBundle", "loadBundle", "(", "ClassLoader", "classLoader", ",", "Locale", "locale", ",", "String", "private", "static", "class", "GetClassLoader", "implements", "PrivilegedAction", "<", "ClassLoader", ">", "{", "private", "final", "Class", "<", "?>", "clazz", ";", "public", "static", "ClassLoader", "fromContext", "(", ")", "{", "private", "static", "ClassLoader", "fromContext", "(", ")", "{", "final", "GetClassLoader", "action", "=", "new", "GetClassLoader", "(", "null", ")", ";", "if", "(", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", ")", "{", "return", "AccessController", ".", "doPrivileged", "(", "action", ")", ";", "@", "@", "-", "101", ",", "7", "+", "102", ",", "7", "@", "@", "public", "static", "ClassLoader", "fromContext", "(", ")", "{", "}", "}", "public", "static", "ClassLoader", "fromClass", "(", "Class", "<", "?>", "clazz", ")", "{", "private", "static", "ClassLoader", "fromClass", "(", "Class", "<", "?>", "clazz", ")", "{", "if", "(", "clazz", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Class", "is", "null", "\"", ")", ";", "}", "@", "@", "-", "118", ",", "6", "+", "119", ",", "7", "@", "@", "private", "GetClassLoader", "(", "Class", "<", "?>", "clazz", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "}", "@", "Override", "public", "ClassLoader", "run", "(", ")", "{", "if", "(", "clazz", "!", "=", "null", ")", "{", "return", "clazz", ".", "getClassLoader", "(", ");", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "validation", ".", "ConstraintViolation", ";", "import", "javax", ".", "validation", ".", "GroupDefinitionException", ";", "import", "javax", ".", "validation", ".", "GroupSequence", ";", "@", "@", "-", "35", ",", "7", "+", "36", ",", "6", "@", "@", "import", "org", ".", "testng", ".", "annotations", ".", "BeforeMethod", ";", "import", "org", ".", "testng", ".", "annotations", ".", "Test", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidator", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "HibernateValidatorConfiguration", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "ConstraintMapping", ";", "@", "@", "-", "48", ",", "7", "+", "48", ",", "7", "@", "@", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "defs", ".", "RangeDef", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "cfg", ".", "defs", ".", "SizeDef", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "group", ".", "GroupSequenceProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "cfg", ".", "context", ".", "DefaultConstraintMapping", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "engine", ".", "DefaultParameterNameProvider", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "core", ".", "ConstraintHelper", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "metadata", ".", "raw", ".", "BeanConfiguration", ";"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["tunnels:", "fix", "netns", "vs", "proto", "registration", "ordering", "Same", "stuff", "as", "in", "ip_gre", "patch:", "receive", "hook", "can", "be", "called", "before", "netns", "setup", "is", "done,", "oopsing", "in", "net_generic().", "Signed-off-by:", "Alexey", "Dobriyan", "<adobriyan@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "830", ",", "15", "+", "830", ",", "14", "@", "@", "static", "int", "__init", "ipip_init", "(", "void", ")", "printk", "(", "banner", ")", ";", "if", "(", "xfrm4_tunnel_register", "(", "&", "ipip_handler", ",", "AF_INET", ")", ")", "{", "err", "=", "register_pernet_device", "(", "&", "ipip_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "return", "err", ";", "err", "=", "xfrm4_tunnel_register", "(", "&", "ipip_handler", ",", "AF_INET", ")", ";", "if", "(", "err", "<", "0", ")", "{", "unregister_pernet_device", "(", "&", "ipip_net_ops", ")", ";", "printk", "(", "KERN_INFO", "\"", "ipip", "init", ":", "can", "'", "t", "register", "tunnel", "\\", "n", "\"", ");", "return", "-", "EAGAIN", ";", "}", "err", "=", "register_pernet_device", "(", "&", "ipip_net_ops", ")", ";", "if", "(", "err", ")", "xfrm4_tunnel_deregister", "(", "&", "ipip_handler", ",", "AF_INET", ")", ";", "return", "err", ";", "}", "@", "@", "-", "1461", ",", "27", "+", "1461", ",", "29", "@", "@", "static", "int", "__init", "ip6_tunnel_init", "(", "void", ")", "{", "int", "err", ";", "if", "(", "xfrm6_tunnel_register", "(", "&", "ip4ip6_handler", ",", "AF_INET", ")", ")", "{", "err", "=", "register_pernet_device", "(", "&", "ip6_tnl_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "out_pernet", ";", "err", "=", "xfrm6_tunnel_register", "(", "&", "ip4ip6_handler", ",", "AF_INET", ")", ";", "if", "(", "err", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "ip6_tunnel", "init", ":", "can", "'", "t", "register", "ip4ip6", "\\", "n", "\"", ");", "err", "=", "-", "EAGAIN", ";", "goto", "out", ";", "goto", "out_ip4ip6", ";", "}", "if", "(", "xfrm6_tunnel_register", "(", "&", "ip6ip6_handler", ",", "AF_INET6", ")", ")", "{", "err", "=", "xfrm6_tunnel_register", "(", "&", "ip6ip6_handler", ",", "AF_INET6", ")", ";", "if", "(", "err", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "ip6_tunnel", "init", ":", "can", "'", "t", "register", "ip6ip6", "\\", "n", "\"", ");", "err", "=", "-", "EAGAIN", ";", "goto", "unreg_ip4ip6", ";", "goto", "out_ip6ip6", ";", "}", "err", "=", "register_pernet_device", "(", "&", "ip6_tnl_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "err_pernet", ";", "return", "0", ";", "err_pernet", ":", "xfrm6_tunnel_deregister", "(", "&", "ip6ip6_handler", ",", "AF_INET6", ")", ";", "unreg_ip4ip6", ":", "out_ip6ip6", ":", "xfrm6_tunnel_deregister", "(", "&", "ip4ip6_handler", ",", "AF_INET", ")", ";", "out", ":", "out_ip4ip6", ":", "unregister_pernet_device", "(", "&", "ip6_tnl_net_ops", ")", ";", "out_pernet", ":", "return", "err", ";", "}", "@", "@", "-", "1227", ",", "15", "+", "1227", ",", "14", "@", "@", "static", "int", "__init", "sit_init", "(", "void", ")", "printk", "(", "KERN_INFO", "\"", "IPv6", "over", "IPv4", "tunneling", "driver", "\\", "n", "\"", ");", "if", "(", "xfrm4_tunnel_register", "(", "&", "sit_handler", ",", "AF_INET6", ")", "<", "0", ")", "{", "printk", "(", "KERN_INFO", "\"", "sit", "init", ":", "Can", "'", "t", "add", "protocol", "\\", "n", "\"", ");", "return", "-", "EAGAIN", ";", "}", "err", "=", "register_pernet_device", "(", "&", "sit_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "xfrm4_tunnel_deregister", "(", "&", "sit_handler", ",", "AF_INET6", ")", ";", "return", "err", ";", "err", "=", "xfrm4_tunnel_register", "(", "&", "sit_handler", ",", "AF_INET6", ")", ";", "if", "(", "err", "<", "0", ")", "{", "unregister_pernet_device", "(", "&", "sit_net_ops", ")", ";", "printk", "(", "KERN_INFO", "\"", "sit", "init", ":", "Can", "'", "t", "add", "protocol", "\\", "n", "\"", ");", "}", "return", "err", ";", "}", "@", "@", "-", "84", ",", "23", "+", "84", ",", "6", "@", "@", "static", "inline", "unsigned", "xfrm6_tunnel_spi_hash_byspi", "(", "u32", "spi", ")", "return", "spi", "%", "XFRM6_TUNNEL_SPI_BYSPI_HSIZE", ";", "}", "static", "int", "__init", "xfrm6_tunnel_spi_init", "(", "void", ")", "{", "xfrm6_tunnel_spi_kmem", "=", "kmem_cache_create", "(", "\"", "xfrm6_tunnel_spi", "\"", ",", "sizeof", "(", "struct", "xfrm6_tunnel_spi", ")", ",", "0", ",", "SLAB_HWCACHE_ALIGN", ",", "NULL", ")", ";", "if", "(", "!", "xfrm6_tunnel_spi_kmem", ")", "return", "-", "ENOMEM", ";", "return", "0", ";", "}", "static", "void", "xfrm6_tunnel_spi_fini", "(", "void", ")", "{", "kmem_cache_destroy", "(", "xfrm6_tunnel_spi_kmem", ")", ";", "}", "static", "struct", "xfrm6_tunnel_spi", "*", "__xfrm6_tunnel_spi_lookup", "(", "struct", "net", "*", "net", ",", "xfrm_address_t", "*", "saddr", ")", "{", "struct", "xfrm6_tunnel_net", "*", "xfrm6_tn", "=", "xfrm6_tunnel_pernet", "(", "net", ")", ";", "@", "@", "-", "375", ",", "42", "+", "358", ",", "44", "@", "@", "static", "int", "__init", "xfrm6_tunnel_init", "(", "void", ")", "{", "int", "rv", ";", "xfrm6_tunnel_spi_kmem", "=", "kmem_cache_create", "(", "\"", "xfrm6_tunnel_spi", "\"", ",", "sizeof", "(", "struct", "xfrm6_tunnel_spi", ")", ",", "0", ",", "SLAB_HWCACHE_ALIGN", ",", "NULL", ")", ";", "if", "(", "!", "xfrm6_tunnel_spi_kmem", ")", "return", "-", "ENOMEM", ";", "rv", "=", "register_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "out_pernet", ";", "rv", "=", "xfrm_register_type", "(", "&", "xfrm6_tunnel_type", ",", "AF_INET6", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "err", ";", "goto", "out_type", ";", "rv", "=", "xfrm6_tunnel_register", "(", "&", "xfrm6_tunnel_handler", ",", "AF_INET6", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "unreg", ";", "goto", "out_xfrm6", ";", "rv", "=", "xfrm6_tunnel_register", "(", "&", "xfrm46_tunnel_handler", ",", "AF_INET", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "dereg6", ";", "rv", "=", "xfrm6_tunnel_spi_init", "(", ");", "if", "(", "rv", "<", "0", ")", "goto", "dereg46", ";", "rv", "=", "register_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "deregspi", ";", "goto", "out_xfrm46", ";", "return", "0", ";", "deregspi", ":", "xfrm6_tunnel_spi_fini", "(", ");", "dereg46", ":", "xfrm6_tunnel_deregister", "(", "&", "xfrm46_tunnel_handler", ",", "AF_INET", ")", ";", "dereg6", ":", "out_xfrm46", ":", "xfrm6_tunnel_deregister", "(", "&", "xfrm6_tunnel_handler", ",", "AF_INET6", ")", ";", "unreg", ":", "out_xfrm6", ":", "xfrm_unregister_type", "(", "&", "xfrm6_tunnel_type", ",", "AF_INET6", ")", ";", "err", ":", "out_type", ":", "unregister_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "out_pernet", ":", "kmem_cache_destroy", "(", "xfrm6_tunnel_spi_kmem", ")", ";", "return", "rv", ";", "}", "static", "void", "__exit", "xfrm6_tunnel_fini", "(", "void", ")", "{", "unregister_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "xfrm6_tunnel_spi_fini", "(", ");", "xfrm6_tunnel_deregister", "(", "&", "xfrm46_tunnel_handler", ",", "AF_INET", ")", ";", "xfrm6_tunnel_deregister", "(", "&", "xfrm6_tunnel_handler", ",", "AF_INET6", ")", ";", "xfrm_unregister_type", "(", "&", "xfrm6_tunnel_type", ",", "AF_INET6", ")", ";", "unregister_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "kmem_cache_destroy", "(", "xfrm6_tunnel_spi_kmem", ")", ";", "}", "module_init", "(", "xfrm6_tunnel_init", ")", ";"], "docstring_tokens": ["by", "sending", "a", "packet", "during", "module", "loading", "."]}
{"contents": ["[FIXED", "SECURITY-73]", "Require", "RUN_SCRIPTS", "for", "/heapDump."], "code_tokens": ["@", "@", "-", "202", ",", "7", "+", "202", ",", "7", "@", "@", "public", "void", "doIndex", "(", "StaplerResponse", "rsp", ")", "throws", "IOException", "{", "@", "WebMethod", "(", "name", "=", "\"", "heapdump", ".", "hprof", "\"", ")", "public", "void", "doHeapDump", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "InterruptedException", "{", "owner", ".", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "owner", ".", "checkPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ";", "rsp", ".", "setContentType", "(", "\"", "application", "/", "octet", "-", "stream", "\"", ");", "FilePath", "dump", "=", "obtain", "(", ");"], "docstring_tokens": ["via", "vectors", "related", "to", "heapDump", "."]}
{"contents": ["fix:", "prevent", "possibility", "of", "execution", "of", "the", "code", "injected", "via", "prototype", "pollution", "when", "undefined", "is", "passed", "to", "compiled", "template", "function,", "closes", "#291"], "code_tokens": ["@", "@", "-", "42", ",", "7", "+", "42", ",", "7", "@", "@", "function", "InstallDots", "(", "o", ")", "{", "if", "(", "this", ".", "__destination", "[", "this", ".", "__destination", ".", "length", "-", "1", "]", "!", "==", "'", "/'", ")", "this", ".", "__destination", "+", "=", "'", "/'", ";", "this", ".", "__global", "=", "o", ".", "global", "|", "|", "\"", "window", ".", "render", "\"", ";", "this", ".", "__rendermodule", "=", "o", ".", "rendermodule", "|", "|", "{", "};", "this", ".", "__settings", "=", "o", ".", "templateSettings", "?", "copy", "(", "o", ".", "templateSettings", ",", "copy", "(", "doT", ".", "templateSettings", ")", ")", ":", "undefined", ";", "this", ".", "__settings", "=", "Object", ".", "prototype", ".", "hasOwnProperty", ".", "call", "(", "o", ",", "\"", "templateSettings", "\"", ")", "?", "copy", "(", "o", ".", "templateSettings", ",", "copy", "(", "doT", ".", "templateSettings", ")", ")", ":", "undefined", ";", "this", ".", "__includes", "=", "{", "};", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "'", "use", "strict", "'", ";", "var", "assert", "=", "require", "(", "'", "assert", "'", ");", "var", "doT", "=", "require", "(", "'.", ".'", ");", "describe", "(", "'", "doT", ".", "process", "'", ",", "function", "(", ")", "{", "describe", "(", "'", "polluting", "object", "prototype", "should", "not", "affect", "template", "compilation", "'", ",", "function", "(", ")", "{", "it", "(", "'", "should", "ignore", "varname", "on", "object", "prototype", "'", ",", "function", "(", ")", "{", "var", "currentLog", "=", "console", ".", "log", ";", "console", ".", "log", "=", "log", ";", "var", "logged", ";", "Object", ".", "prototype", ".", "templateSettings", "=", "{", "varname", ":", "'", "it", "=", "(", "console", ".", "log", "(", "\"", "executed", "\"", "),", "{}", ")'", "};", "try", "{", "const", "templates", "=", "doT", ".", "process", "(", "{", "path", ":", "'", "./", "test", "'", "})", ";", "assert", ".", "notEqual", "(", "logged", ",", "'", "executed", "'", ");", "/", "/", "injected", "code", "can", "only", "be", "executed", "if", "undefined", "is", "passed", "to", "template", "function", "templates", ".", "test", "(", ");", "assert", ".", "notEqual", "(", "logged", ",", "'", "executed", "'", ");", "}", "finally", "{", "console", ".", "log", "=", "currentLog", ";", "}", "function", "log", "(", "str", ")", "{", "logged", "=", "str", ";", "}", "}", ")", "}", ");", "}", ");", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "{", "{=", "it", "&", "&", "it", ".", "test", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request"]}
{"contents": ["Apply", "appropriate", "RPC", "handler", "to", "receive,", "receiveStream", "when", "auth", "enabled"], "code_tokens": ["@", "@", "-", "29", ",", "12", "+", "29", ",", "11", "@", "@", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "RpcResponseCallback", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "StreamCallbackWithID", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "TransportClient", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "sasl", ".", "SecretKeyHolder", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "sasl", ".", "SaslRpcHandler", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "AbstractAuthRpcHandler", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "RpcHandler", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "StreamManager", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "util", ".", "TransportConf", ";", "/", "**", "@", "@", "-", "46", ",", "7", "+", "45", ",", "7", "@", "@", "*", "The", "delegate", "will", "only", "receive", "messages", "if", "the", "given", "connection", "has", "been", "successfully", "*", "authenticated", ".", "A", "connection", "may", "be", "authenticated", "at", "most", "once", ".", "*", "/", "class", "AuthRpcHandler", "extends", "RpcHandler", "{", "class", "AuthRpcHandler", "extends", "AbstractAuthRpcHandler", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "AuthRpcHandler", ".", "class", ")", ";", "/", "**", "Transport", "configuration", ".", "*", "/", "@", "@", "-", "55", ",", "36", "+", "54", ",", "31", "@", "@", "/", "**", "The", "client", "channel", ".", "*", "/", "private", "final", "Channel", "channel", ";", "/", "**", "*", "RpcHandler", "we", "will", "delegate", "to", "for", "authenticated", "connections", ".", "When", "falling", "back", "to", "SASL", "*", "this", "will", "be", "replaced", "with", "the", "SASL", "RPC", "handler", ".", "*", "/", "@", "VisibleForTesting", "RpcHandler", "delegate", ";", "/", "**", "Class", "which", "provides", "secret", "keys", "which", "are", "shared", "by", "server", "and", "client", "on", "a", "per", "-", "app", "basis", ".", "*", "/", "private", "final", "SecretKeyHolder", "secretKeyHolder", ";", "/", "**", "Whether", "auth", "is", "done", "and", "future", "calls", "should", "be", "delegated", ".", "*", "/", "/", "**", "RPC", "handler", "for", "auth", "handshake", "when", "falling", "back", "to", "SASL", "auth", ".", "*", "/", "@", "VisibleForTesting", "boolean", "doDelegate", ";", "SaslRpcHandler", "saslHandler", ";", "AuthRpcHandler", "(", "TransportConf", "conf", ",", "Channel", "channel", ",", "RpcHandler", "delegate", ",", "SecretKeyHolder", "secretKeyHolder", ")", "{", "super", "(", "delegate", ")", ";", "this", ".", "conf", "=", "conf", ";", "this", ".", "channel", "=", "channel", ";", "this", ".", "delegate", "=", "delegate", ";", "this", ".", "secretKeyHolder", "=", "secretKeyHolder", ";", "}", "@", "Override", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "if", "(", "doDelegate", ")", "{", "delegate", ".", "receive", "(", "client", ",", "message", ",", "callback", ")", ";", "return", ";", "protected", "boolean", "doAuthChallenge", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "if", "(", "saslHandler", "!", "=", "null", ")", "{", "return", "saslHandler", ".", "doAuthChallenge", "(", "client", ",", "message", ",", "callback", ")", ";", "}", "int", "position", "=", "message", ".", "position", "(", ");", "@", "@", "-", "98", ",", "18", "+", "92", ",", "17", "@", "@", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallb", "if", "(", "conf", ".", "saslFallback", "(", "))", "{", "LOG", ".", "warn", "(", "\"", "Failed", "to", "parse", "new", "auth", "challenge", ",", "reverting", "to", "SASL", "for", "client", "{", "}.", "\",", "channel", ".", "remoteAddress", "(", "))", ";", "delegate", "=", "new", "SaslRpcHandler", "(", "conf", ",", "channel", ",", "delegate", ",", "secretKeyHolder", ")", ";", "saslHandler", "=", "new", "SaslRpcHandler", "(", "conf", ",", "channel", ",", "null", ",", "secretKeyHolder", ")", ";", "message", ".", "position", "(", "position", ")", ";", "message", ".", "limit", "(", "limit", ")", ";", "delegate", ".", "receive", "(", "client", ",", "message", ",", "callback", ")", ";", "doDelegate", "=", "true", ";", "return", "saslHandler", ".", "doAuthChallenge", "(", "client", ",", "message", ",", "callback", ")", ";", "}", "else", "{", "LOG", ".", "debug", "(", "\"", "Unexpected", "challenge", "message", "from", "client", "{", "},", "closing", "channel", ".", "\",", "channel", ".", "remoteAddress", "(", "))", ";", "callback", ".", "onFailure", "(", "new", "IllegalArgumentException", "(", "\"", "Unknown", "challenge", "message", ".", "\")", ");", "channel", ".", "close", "(", ");", "}", "return", ";", "return", "false", ";", "}", "/", "/", "Here", "we", "have", "the", "client", "challenge", ",", "so", "perform", "the", "new", "auth", "protocol", "and", "set", "up", "the", "channel", ".", "@", "@", "-", "131", ",", "7", "+", "124", ",", "7", "@", "@", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallb", "LOG", ".", "debug", "(", "\"", "Authentication", "failed", "for", "client", "{", "},", "closing", "channel", ".", "\",", "channel", ".", "remoteAddress", "(", "))", ";", "callback", ".", "onFailure", "(", "new", "IllegalArgumentException", "(", "\"", "Authentication", "failed", ".", "\")", ");", "channel", ".", "close", "(", ");", "return", ";", "return", "false", ";", "}", "finally", "{", "if", "(", "engine", "!", "=", "null", ")", "{", "try", "{", "@", "@", "-", "143", ",", "40", "+", "136", ",", "6", "@", "@", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallb", "}", "LOG", ".", "debug", "(", "\"", "Authorization", "successful", "for", "client", "{", "}.", "\",", "channel", ".", "remoteAddress", "(", "))", ";", "doDelegate", "=", "true", ";", "}", "@", "Override", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ")", "{", "delegate", ".", "receive", "(", "client", ",", "message", ")", ";", "}", "@", "Override", "public", "StreamCallbackWithID", "receiveStream", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "return", "delegate", ".", "receiveStream", "(", "client", ",", "message", ",", "callback", ")", ";", "return", "true", ";", "}", "@", "Override", "public", "StreamManager", "getStreamManager", "(", ")", "{", "return", "delegate", ".", "getStreamManager", "(", ");", "}", "@", "Override", "public", "void", "channelActive", "(", "TransportClient", "client", ")", "{", "delegate", ".", "channelActive", "(", "client", ")", ";", "}", "@", "Override", "public", "void", "channelInactive", "(", "TransportClient", "client", ")", "{", "delegate", ".", "channelInactive", "(", "client", ")", ";", "}", "@", "Override", "public", "void", "exceptionCaught", "(", "Throwable", "cause", ",", "TransportClient", "client", ")", "{", "delegate", ".", "exceptionCaught", "(", "cause", ",", "client", ")", ";", "}", "}", "@", "@", "-", "28", ",", "10", "+", "28", ",", "9", "@", "@", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "RpcResponseCallback", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "StreamCallbackWithID", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "TransportClient", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "AbstractAuthRpcHandler", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "RpcHandler", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "StreamManager", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "util", ".", "JavaUtils", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "util", ".", "TransportConf", ";", "@", "@", "-", "43", ",", "7", "+", "42", ",", "7", "@", "@", "*", "Note", "that", "the", "authentication", "process", "consists", "of", "multiple", "challenge", "-", "response", "pairs", ",", "each", "of", "*", "which", "are", "individual", "RPCs", ".", "*", "/", "public", "class", "SaslRpcHandler", "extends", "RpcHandler", "{", "public", "class", "SaslRpcHandler", "extends", "AbstractAuthRpcHandler", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "SaslRpcHandler", ".", "class", ")", ";", "/", "**", "Transport", "configuration", ".", "*", "/", "@", "@", "-", "52", ",", "37", "+", "51", ",", "28", "@", "@", "/", "**", "The", "client", "channel", ".", "*", "/", "private", "final", "Channel", "channel", ";", "/", "**", "RpcHandler", "we", "will", "delegate", "to", "for", "authenticated", "connections", ".", "*", "/", "private", "final", "RpcHandler", "delegate", ";", "/", "**", "Class", "which", "provides", "secret", "keys", "which", "are", "shared", "by", "server", "and", "client", "on", "a", "per", "-", "app", "basis", ".", "*", "/", "private", "final", "SecretKeyHolder", "secretKeyHolder", ";", "private", "SparkSaslServer", "saslServer", ";", "private", "boolean", "isComplete", ";", "private", "boolean", "isAuthenticated", ";", "public", "SaslRpcHandler", "(", "TransportConf", "conf", ",", "Channel", "channel", ",", "RpcHandler", "delegate", ",", "SecretKeyHolder", "secretKeyHolder", ")", "{", "super", "(", "delegate", ")", ";", "this", ".", "conf", "=", "conf", ";", "this", ".", "channel", "=", "channel", ";", "this", ".", "delegate", "=", "delegate", ";", "this", ".", "secretKeyHolder", "=", "secretKeyHolder", ";", "this", ".", "saslServer", "=", "null", ";", "this", ".", "isComplete", "=", "false", ";", "this", ".", "isAuthenticated", "=", "false", ";", "}", "@", "Override", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "if", "(", "isComplete", ")", "{", "/", "/", "Authentication", "complete", ",", "delegate", "to", "base", "handler", ".", "delegate", ".", "receive", "(", "client", ",", "message", ",", "callback", ")", ";", "return", ";", "}", "public", "boolean", "doAuthChallenge", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "if", "(", "saslServer", "=", "=", "null", "|", "|", "!", "saslServer", ".", "isComplete", "(", "))", "{", "ByteBuf", "nettyBuf", "=", "Unpooled", ".", "wrappedBuffer", "(", "message", ")", ";", "SaslMessage", "saslMessage", ";", "@", "@", "-", "118", ",", "55", "+", "108", ",", "28", "@", "@", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallb", "if", "(", "!", "SparkSaslServer", ".", "QOP_AUTH_CONF", ".", "equals", "(", "saslServer", ".", "getNegotiatedProperty", "(", "Sasl", ".", "QOP", ")", "))", "{", "logger", ".", "debug", "(", "\"", "SASL", "authentication", "successful", "for", "channel", "{", "}\"", ",", "client", ")", ";", "complete", "(", "true", ")", ";", "return", ";", "return", "true", ";", "}", "logger", ".", "debug", "(", "\"", "Enabling", "encryption", "for", "channel", "{", "}\"", ",", "client", ")", ";", "SaslEncryption", ".", "addToChannel", "(", "channel", ",", "saslServer", ",", "conf", ".", "maxSaslEncryptedBlockSize", "(", "))", ";", "complete", "(", "false", ")", ";", "return", ";", "return", "true", ";", "}", "}", "@", "Override", "public", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ")", "{", "delegate", ".", "receive", "(", "client", ",", "message", ")", ";", "}", "@", "Override", "public", "StreamCallbackWithID", "receiveStream", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "return", "delegate", ".", "receiveStream", "(", "client", ",", "message", ",", "callback", ")", ";", "}", "@", "Override", "public", "StreamManager", "getStreamManager", "(", ")", "{", "return", "delegate", ".", "getStreamManager", "(", ");", "}", "@", "Override", "public", "void", "channelActive", "(", "TransportClient", "client", ")", "{", "delegate", ".", "channelActive", "(", "client", ")", ";", "return", "false", ";", "}", "@", "Override", "public", "void", "channelInactive", "(", "TransportClient", "client", ")", "{", "try", "{", "delegate", ".", "channelInactive", "(", "client", ")", ";", "super", ".", "channelInactive", "(", "client", ")", ";", "}", "finally", "{", "if", "(", "saslServer", "!", "=", "null", ")", "{", "saslServer", ".", "dispose", "(", ");", "}", "}", "}", "@", "Override", "public", "void", "exceptionCaught", "(", "Throwable", "cause", ",", "TransportClient", "client", ")", "{", "delegate", ".", "exceptionCaught", "(", "cause", ",", "client", ")", ";", "}", "private", "void", "complete", "(", "boolean", "dispose", ")", "{", "if", "(", "dispose", ")", "{", "try", "{", "@", "@", "-", "177", ",", "7", "+", "140", ",", "6", "@", "@", "private", "void", "complete", "(", "boolean", "dispose", ")", "{", "}", "saslServer", "=", "null", ";", "isComplete", "=", "true", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "107", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "RpcResponseCallback", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "StreamCallbackWithID", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "TransportClient", ";", "/", "**", "*", "RPC", "Handler", "which", "performs", "authentication", ",", "and", "when", "it", "'", "s", "successful", ",", "delegates", "further", "*", "calls", "to", "another", "RPC", "handler", ".", "The", "authentication", "handshake", "itself", "should", "be", "implemented", "*", "by", "subclasses", ".", "*", "/", "public", "abstract", "class", "AbstractAuthRpcHandler", "extends", "RpcHandler", "{", "/", "**", "RpcHandler", "we", "will", "delegate", "to", "for", "authenticated", "connections", ".", "*", "/", "private", "final", "RpcHandler", "delegate", ";", "private", "boolean", "isAuthenticated", ";", "protected", "AbstractAuthRpcHandler", "(", "RpcHandler", "delegate", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "}", "/", "**", "*", "Responds", "to", "an", "authentication", "challenge", ".", "*", "*", "@", "return", "Whether", "the", "client", "is", "authenticated", ".", "*", "/", "protected", "abstract", "boolean", "doAuthChallenge", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", ";", "@", "Override", "public", "final", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "if", "(", "isAuthenticated", ")", "{", "delegate", ".", "receive", "(", "client", ",", "message", ",", "callback", ")", ";", "}", "else", "{", "isAuthenticated", "=", "doAuthChallenge", "(", "client", ",", "message", ",", "callback", ")", ";", "}", "}", "@", "Override", "public", "final", "void", "receive", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ")", "{", "if", "(", "isAuthenticated", ")", "{", "delegate", ".", "receive", "(", "client", ",", "message", ")", ";", "}", "else", "{", "throw", "new", "SecurityException", "(", "\"", "Unauthenticated", "call", "to", "receive", "(", ").", "\")", ";", "}", "}", "@", "Override", "public", "final", "StreamCallbackWithID", "receiveStream", "(", "TransportClient", "client", ",", "ByteBuffer", "message", ",", "RpcResponseCallback", "callback", ")", "{", "if", "(", "isAuthenticated", ")", "{", "return", "delegate", ".", "receiveStream", "(", "client", ",", "message", ",", "callback", ")", ";", "}", "else", "{", "throw", "new", "SecurityException", "(", "\"", "Unauthenticated", "call", "to", "receiveStream", "(", ").", "\")", ";", "}", "}", "@", "Override", "public", "StreamManager", "getStreamManager", "(", ")", "{", "return", "delegate", ".", "getStreamManager", "(", ");", "}", "@", "Override", "public", "void", "channelActive", "(", "TransportClient", "client", ")", "{", "delegate", ".", "channelActive", "(", "client", ")", ";", "}", "@", "Override", "public", "void", "channelInactive", "(", "TransportClient", "client", ")", "{", "delegate", ".", "channelInactive", "(", "client", ")", ";", "}", "@", "Override", "public", "void", "exceptionCaught", "(", "Throwable", "cause", ",", "TransportClient", "client", ")", "{", "delegate", ".", "exceptionCaught", "(", "cause", ",", "client", ")", ";", "}", "public", "boolean", "isAuthenticated", "(", ")", "{", "return", "isAuthenticated", ";", "}", "}", "@", "@", "-", "34", ",", "7", "+", "34", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "RpcResponseCallback", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "TransportClient", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "client", ".", "TransportClientBootstrap", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "sasl", ".", "SaslRpcHandler", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "sasl", ".", "SaslServerBootstrap", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "sasl", ".", "SecretKeyHolder", ";", "import", "org", ".", "apache", ".", "spark", ".", "network", ".", "server", ".", "RpcHandler", ";", "@", "@", "-", "65", ",", "8", "+", "64", ",", "7", "@", "@", "public", "void", "testNewAuth", "(", ")", "throws", "Exception", "{", "ByteBuffer", "reply", "=", "ctx", ".", "client", ".", "sendRpcSync", "(", "JavaUtils", ".", "stringToBytes", "(", "\"", "Ping", "\"", "),", "5000", ")", ";", "assertEquals", "(", "\"", "Pong", "\"", ",", "JavaUtils", ".", "bytesToString", "(", "reply", ")", ");", "assertTrue", "(", "ctx", ".", "authRpcHandler", ".", "doDelegate", ")", ";", "assertFalse", "(", "ctx", ".", "authRpcHandler", ".", "delegate", "instanceof", "SaslRpcHandler", ")", ";", "assertNull", "(", "ctx", ".", "authRpcHandler", ".", "saslHandler", ")", ";", "}", "@", "Test", "@", "@", "-", "78", ",", "7", "+", "76", ",", "7", "@", "@", "public", "void", "testAuthFailure", "(", ")", "throws", "Exception", "{", "ctx", ".", "createClient", "(", "\"", "client", "\"", ");", "fail", "(", "\"", "Should", "have", "failed", "to", "create", "client", ".", "\")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertFalse", "(", "ctx", ".", "authRpcHandler", ".", "doDelegate", ")", ";", "assertFalse", "(", "ctx", ".", "authRpcHandler", ".", "isAuthenticated", "(", "))", ";", "assertFalse", "(", "ctx", ".", "serverChannel", ".", "isActive", "(", "))", ";", "}", "}", "@", "@", "-", "91", ",", "6", "+", "89", ",", "8", "@", "@", "public", "void", "testSaslServerFallback", "(", ")", "throws", "Exception", "{", "ByteBuffer", "reply", "=", "ctx", ".", "client", ".", "sendRpcSync", "(", "JavaUtils", ".", "stringToBytes", "(", "\"", "Ping", "\"", "),", "5000", ")", ";", "assertEquals", "(", "\"", "Pong", "\"", ",", "JavaUtils", ".", "bytesToString", "(", "reply", ")", ");", "assertNotNull", "(", "ctx", ".", "authRpcHandler", ".", "saslHandler", ")", ";", "assertTrue", "(", "ctx", ".", "authRpcHandler", ".", "isAuthenticated", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "120", ",", "7", "+", "120", ",", "7", "@", "@", "public", "void", "testAuthReplay", "(", ")", "throws", "Exception", "{", "ctx", ".", "client", ".", "sendRpcSync", "(", "JavaUtils", ".", "stringToBytes", "(", "\"", "Ping", "\"", "),", "5000", ")", ";", "fail", "(", "\"", "Should", "have", "failed", "unencrypted", "RPC", ".", "\")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertTrue", "(", "ctx", ".", "authRpcHandler", ".", "doDelegate", ")", ";", "assertTrue", "(", "ctx", ".", "authRpcHandler", ".", "isAuthenticated", "(", "))", ";", "}", "}", "@", "@", "-", "151", ",", "7", "+", "151", ",", "7", "@", "@", "public", "StreamManager", "getStreamManager", "(", ")", "{", "ctx", ".", "client", ".", "sendRpcSync", "(", "JavaUtils", ".", "stringToBytes", "(", "\"", "Ping", "\"", "),", "5000", ")", ";", "fail", "(", "\"", "Should", "have", "failed", "unencrypted", "RPC", ".", "\")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertTrue", "(", "ctx", ".", "authRpcHandler", ".", "doDelegate", ")", ";", "assertTrue", "(", "ctx", ".", "authRpcHandler", ".", "isAuthenticated", "(", "))", ";", "assertTrue", "(", "e", ".", "getMessage", "(", ")", "+", "\"", "is", "not", "an", "expected", "error", "\"", ",", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "DDDDD", "\"", "))", ";", "/", "/", "Verify", "we", "receive", "the", "complete", "error", "message", "int", "messageStart", "=", "e", ".", "getMessage", "(", ").", "indexOf", "(", "\"", "DDDDD", "\"", ");", "@", "@", "-", "357", ",", "7", "+", "357", ",", "8", "@", "@", "public", "void", "testRpcHandlerDelegate", "(", ")", "throws", "Exception", "{", "public", "void", "testDelegates", "(", ")", "throws", "Exception", "{", "Method", "[", "]", "rpcHandlerMethods", "=", "RpcHandler", ".", "class", ".", "getDeclaredMethods", "(", ");", "for", "(", "Method", "m", ":", "rpcHandlerMethods", ")", "{", "SaslRpcHandler", ".", "class", ".", "getDeclaredMethod", "(", "m", ".", "getName", "(", "),", "m", ".", "getParameterTypes", "(", "))", ";", "Method", "delegate", "=", "SaslRpcHandler", ".", "class", ".", "getMethod", "(", "m", ".", "getName", "(", "),", "m", ".", "getParameterTypes", "(", "))", ";", "assertNotEquals", "(", "delegate", ".", "getDeclaringClass", "(", "),", "RpcHandler", ".", "class", ")", ";", "}", "}"], "docstring_tokens": ["via", "a", "shared", "secret", "."]}
{"contents": ["USB:", "yurex:", "fix", "out-of-bounds", "uaccess", "in", "read", "handler", "In", "general,", "accessing", "userspace", "memory", "beyond", "the", "length", "of", "the", "supplied", "buffer", "in", "VFS", "read/write", "handlers", "can", "lead", "to", "both", "kernel", "memory", "corruption", "(via", "kernel_read()/kernel_write(),", "which", "can", "e.g.", "be", "triggered", "via", "sys_splice())", "and", "privilege", "escalation", "inside", "userspace.", "Fix", "it", "by", "using", "simple_read_from_buffer()", "instead", "of", "custom", "logic.", "Fixes:", "6bc235a2e24a", "(\"USB:", "add", "driver", "for", "Meywa-Denki", "&", "Kayac", "YUREX\")", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "396", ",", "35", "+", "396", ",", "24", "@", "@", "static", "ssize_t", "yurex_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buffer", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "{", "struct", "usb_yurex", "*", "dev", ";", "int", "retval", "=", "0", ";", "int", "bytes_read", "=", "0", ";", "int", "len", "=", "0", ";", "char", "in_buffer", "[", "20", "]", ";", "unsigned", "long", "flags", ";", "dev", "=", "file", "-", ">", "private_data", ";", "mutex_lock", "(", "&", "dev", "-", ">", "io_mutex", ")", ";", "if", "(", "!", "dev", "-", ">", "interface", ")", "{", "/", "*", "already", "disconnected", "*", "/", "retval", "=", "-", "ENODEV", ";", "goto", "exit", ";", "mutex_unlock", "(", "&", "dev", "-", ">", "io_mutex", ")", ";", "return", "-", "ENODEV", ";", "}", "spin_lock_irqsave", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "bytes_read", "=", "snprintf", "(", "in_buffer", ",", "20", ",", "\"", "%", "lld", "\\", "n", "\"", ",", "dev", "-", ">", "bbu", ")", ";", "len", "=", "snprintf", "(", "in_buffer", ",", "20", ",", "\"", "%", "lld", "\\", "n", "\"", ",", "dev", "-", ">", "bbu", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "*", "ppos", "<", "bytes_read", ")", "{", "if", "(", "copy_to_user", "(", "buffer", ",", "in_buffer", "+", "*", "ppos", ",", "bytes_read", "-", "*", "ppos", ")", ")", "retval", "=", "-", "EFAULT", ";", "else", "{", "retval", "=", "bytes_read", "-", "*", "ppos", ";", "*", "ppos", "+", "=", "bytes_read", ";", "}", "}", "exit", ":", "mutex_unlock", "(", "&", "dev", "-", ">", "io_mutex", ")", ";", "return", "retval", ";", "return", "simple_read_from_buffer", "(", "buffer", ",", "count", ",", "ppos", ",", "in_buffer", ",", "len", ")", ";", "}", "static", "ssize_t", "yurex_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "user_buffer", ","], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["scm:", "fix", "scm_fp_list->list", "initialization", "made", "in", "wrong", "place", "This", "is", "the", "next", "page", "of", "the", "scm", "recursion", "story", "(the", "commit", "f8d570a4", "net:", "Fix", "recursive", "descent", "in", "__scm_destroy()).", "In", "function", "scm_fp_dup(),", "the", "INIT_LIST_HEAD(&fpl->list)", "of", "newly", "created", "fpl", "is", "done", "*before*", "the", "subsequent", "memcpy", "from", "the", "old", "structure", "and", "thus", "the", "freshly", "initialized", "list", "is", "overwritten.", "But", "that's", "OK,", "since", "this", "initialization", "is", "not", "required", "at", "all,", "since", "the", "fpl->list", "is", "list_add-ed", "at", "the", "destruction", "time", "in", "any", "case", "(and", "is", "unused", "in", "other", "code),", "so", "I", "propose", "to", "drop", "both", "initializations,", "rather", "than", "moving", "it", "after", "the", "memcpy.", "Please,", "correct", "me", "if", "I", "miss", "something", "significant.", "Signed-off-by:", "Pavel", "Emelyanov", "<xemul@openvz.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "75", ",", "7", "+", "75", ",", "6", "@", "@", "static", "int", "scm_fp_copy", "(", "struct", "cmsghdr", "*", "cmsg", ",", "struct", "scm_fp_list", "*", "*", "fplp", ")", "if", "(", "!", "fpl", ")", "return", "-", "ENOMEM", ";", "*", "fplp", "=", "fpl", ";", "INIT_LIST_HEAD", "(", "&", "fpl", "-", ">", "list", ")", ";", "fpl", "-", ">", "count", "=", "0", ";", "}", "fpp", "=", "&", "fpl", "-", ">", "fp", "[", "fpl", "-", ">", "count", "]", ";", "@", "@", "-", "301", ",", "7", "+", "300", ",", "6", "@", "@", "struct", "scm_fp_list", "*", "scm_fp_dup", "(", "struct", "scm_fp_list", "*", "fpl", ")", "new_fpl", "=", "kmalloc", "(", "sizeof", "(", "*", "fpl", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "new_fpl", ")", "{", "INIT_LIST_HEAD", "(", "&", "new_fpl", "-", ">", "list", ")", ";", "for", "(", "i", "=", "fpl", "-", ">", "count", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "get_file", "(", "fpl", "-", ">", "fp", "[", "i", "]", ");", "memcpy", "(", "new_fpl", ",", "fpl", ",", "sizeof", "(", "*", "fpl", ")", ");"], "docstring_tokens": ["via", "vectors", "related", "to", "sending", "an", "SCM_RIGHTS", "message", "through", "a", "UNIX", "domain", "socket", "and", "closing", "file", "descriptors", "."]}
{"contents": ["RANGER-921", ":", "Improve", "implementation", "of", "internal", "SQL", "calls", "Signed-off-by:", "Velmurugan", "Periasamy", "<vel@apache.org>"], "code_tokens": ["@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "java", ".", "util", ".", "TimeZone", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Component", ";", "@", "@", "-", "105", ",", "5", "+", "106", ",", "17", "@", "@", "public", "static", "Date", "getUTCDate", "(", "long", "epoh", ")", "{", "return", "null", ";", "}", "}", "public", "static", "Date", "stringToDate", "(", "String", "dateString", ",", "String", "dateFromat", ")", "{", "SimpleDateFormat", "simpleDateFormat", "=", "null", ";", "Date", "date", "=", "null", ";", "if", "(", "!", "StringUtils", ".", "isEmpty", "(", "dateString", ")", "&", "&", "!", "StringUtils", ".", "isEmpty", "(", "dateFromat", ")", "){", "try", "{", "simpleDateFormat", "=", "new", "SimpleDateFormat", "(", "dateFromat", ")", ";", "date", "=", "simpleDateFormat", ".", "parse", "(", "dateString", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "return", "null", ";", "}", "}", "return", "date", ";", "}", "}", "@", "@", "-", "18", ",", "13", "+", "18", ",", "11", "@", "@", "package", "org", ".", "apache", ".", "ranger", ".", "db", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "persistence", ".", "NoResultException", ";", "import", "javax", ".", "persistence", ".", "Query", ";", "import", "org", ".", "apache", ".", "ranger", ".", "biz", ".", "RangerBizUtil", ";", "import", "org", ".", "apache", ".", "ranger", ".", "common", ".", "AppConstants", ";", "import", "org", ".", "apache", ".", "ranger", ".", "common", ".", "DateUtil", ";", "import", "org", ".", "apache", ".", "ranger", ".", "common", ".", "db", ".", "BaseDao", ";", "import", "org", ".", "apache", ".", "ranger", ".", "entity", ".", "XXDataHist", ";", "@", "@", "-", "53", ",", "26", "+", "51", ",", "17", "@", "@", "public", "XXDataHist", "findObjByEventTimeClassTypeAndId", "(", "String", "eventTime", ",", "int", "classTy", "if", "(", "eventTime", "=", "=", "null", "|", "|", "objId", "=", "=", "null", ")", "{", "return", "null", ";", "}", "Date", "date", "=", "DateUtil", ".", "stringToDate", "(", "eventTime", ",", "\"", "yyyy", "-", "MM", "-", "dd", "'", "T", "'", "HH", ":", "mm", ":", "ss", "'", "Z", "'", "\")", ";", "if", "(", "date", "=", "=", "null", ")", "{", "return", "null", ";", "}", "try", "{", "int", "dbFlavor", "=", "RangerBizUtil", ".", "getDBFlavor", "(", ");", "String", "queryStr", "=", "\"", "\";", "if", "(", "dbFlavor", "=", "=", "AppConstants", ".", "DB_FLAVOR_ORACLE", ")", "{", "queryStr", "=", "\"", "select", "obj", ".", "*", "from", "x_data_hist", "obj", "where", "obj", ".", "obj_class_type", "=", "\"", "+", "classType", "+", "\"", "and", "obj", ".", "obj_id", "=", "\"", "+", "objId", "+", "\"", "and", "to_date", "(", "obj", ".", "create_time", ",", "'", "YYYY", "-", "MM", "-", "DD", "\\", "\"", "T", "\\", "\"", "HH24", ":", "MI", ":", "SS", "\\", "\"", "Z", "\\", "\"'", ")", "<", "=", "to_date", "(", "'\"", "+", "eventTime", "+", "\"", "',", "'", "YYYY", "-", "MM", "-", "DD", "\\", "\"", "T", "\\", "\"", "HH24", ":", "MI", ":", "SS", "\\", "\"", "Z", "\\", "\"'", ")", "ORDER", "BY", "obj", ".", "id", "DESC", "\"", ";", "}", "else", "{", "queryStr", "=", "\"", "select", "obj", ".", "*", "from", "x_data_hist", "obj", "where", "obj", ".", "obj_class_type", "=", "\"", "+", "classType", "+", "\"", "and", "obj", ".", "obj_id", "=", "\"", "+", "objId", "+", "\"", "and", "obj", ".", "create_time", "<", "=", "'", "\"", "+", "eventTime", "+", "\"", "'", "ORDER", "BY", "obj", ".", "id", "DESC", "\"", ";", "}", "Query", "jpaQuery", "=", "getEntityManager", "(", ").", "createNativeQuery", "(", "queryStr", ",", "tClass", ")", ".", "setMaxResults", "(", "1", ")", ";", "return", "(", "XXDataHist", ")", "jpaQuery", ".", "getSingleResult", "(", ");", "return", "getEntityManager", "(", ")", ".", "createNamedQuery", "(", "\"", "XXDataHist", ".", "findLatestByObjectClassTypeAndObjectIdAndEventTime", "\"", ",", "tClass", ")", ".", "setParameter", "(", "\"", "classType", "\"", ",", "classType", ")", ".", "setParameter", "(", "\"", "objectId", "\"", ",", "objId", ")", ".", "setParameter", "(", "\"", "createTime", "\"", ",", "date", ")", ".", "setMaxResults", "(", "1", ")", ".", "getSingleResult", "(", ");", "}", "catch", "(", "NoResultException", "e", ")", "{", "return", "null", ";", "}", "@", "@", "-", "101", ",", "17", "+", "101", ",", "4", "@", "@", "public", "XXPortalUser", "findByXUserId", "(", "Long", "xUserId", ")", "{", "}", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "List", "<", "String", ">", "findXPortalUserRolebyXPortalUserId", "(", "Long", "userId", ")", "{", "try", "{", "return", "getEntityManager", "(", ")", ".", "createNativeQuery", "(", "\"", "select", "user_role", "from", "x_portal_user_role", "where", "user_id", "=", "\"+", "userId", "+", "\"\"", ")", ".", "getResultList", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "null", ";", "}", "}", "}", "@", "@", "-", "56", ",", "4", "+", "56", ",", "18", "@", "@", "public", "XXPortalUserRole", "findByRoleUserId", "(", "Long", "userId", ",", "String", "role", ")", "{", "}", "return", "null", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "List", "<", "String", ">", "findXPortalUserRolebyXPortalUserId", "(", "Long", "userId", ")", "{", "if", "(", "userId", "=", "=", "null", ")", "{", "return", "new", "ArrayList", "<", "String", ">", "()", ";", "}", "try", "{", "List", "<", "String", ">", "returnList", "=", "getEntityManager", "(", ")", ".", "createNamedQuery", "(", "\"", "XXPortalUserRole", ".", "findXPortalUserRolebyXPortalUserId", "\"", ")", ".", "setParameter", "(", "\"", "userId", "\"", ",", "userId", ")", ".", "getResultList", "(", ");", "return", "returnList", ";", "}", "catch", "(", "NoResultException", "e", ")", "{", "return", "new", "ArrayList", "<", "String", ">", "()", ";", "}", "}", "}", "@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "assignPermissionToExistingUsers", "(", ")", "{", "for", "(", "XXPortalUser", "xPortalUser", ":", "allPortalUser", ")", "{", "VXPortalUser", "vPortalUser", "=", "xPortalUserService", ".", "populateViewBean", "(", "xPortalUser", ")", ";", "vPortalUsers", ".", "add", "(", "vPortalUser", ")", ";", "vPortalUser", ".", "setUserRoleList", "(", "daoManager", ".", "getXXPortalUser", "(", ").", "findXPortalUserRolebyXPortalUserId", "(", "vPortalUser", ".", "getId", "(", "))", ");", "vPortalUser", ".", "setUserRoleList", "(", "daoManager", ".", "getXXPortalUserRole", "(", ").", "findXPortalUserRolebyXPortalUserId", "(", "vPortalUser", ".", "getId", "(", "))", ");", "xUserMgr", ".", "assignPermissionToUser", "(", "vPortalUser", ",", "false", ")", ";", "countUserPermissionUpdated", "+", "=", "1", ";", "logger", ".", "info", "(", "\"", "Permissions", "assigned", "/", "updated", "on", "base", "of", "User", "'", "s", "Role", ",", "UserId", "[", "\"", "+", "xPortalUser", ".", "getId", "(", ")", "+", "\"", "]\"", ");", "@", "@", "-", "691", ",", "4", "+", "691", ",", "12", "@", "@", "<", "query", ">", "select", "obj", "from", "XXPolicy", "obj", ",", "XXPolicyItem", "polItem", ",", "XXPolicyItemGroupPerm", "polItemGroupPerm", "where", "obj", ".", "id", "=", "polItem", ".", "policyId", "and", "polItem", ".", "id", "=", "polItemGroupPerm", ".", "policyItemId", "and", "polItemGroupPerm", ".", "groupId", "=", ":", "groupId", "<", "/", "query", ">", "<", "/", "named", "-", "query", ">", "<", "named", "-", "query", "name", "=", "\"", "XXDataHist", ".", "findLatestByObjectClassTypeAndObjectIdAndEventTime", "\"", ">", "<", "query", ">", "select", "obj", "from", "XXDataHist", "obj", "where", "obj", ".", "objectId", "=", ":", "objectId", "and", "obj", ".", "objectClassType", "=", ":", "classType", "and", "obj", ".", "createTime", "&", "lt", ";", "=", ":", "createTime", "ORDER", "BY", "obj", ".", "id", "DESC", "<", "/", "query", ">", "<", "/", "named", "-", "query", ">", "<", "named", "-", "query", "name", "=", "\"", "XXPortalUserRole", ".", "findXPortalUserRolebyXPortalUserId", "\"", ">", "<", "query", ">", "select", "obj", ".", "userRole", "from", "XXPortalUserRole", "obj", "where", "obj", ".", "userId", "=", ":", "userId", "<", "/", "query", ">", "<", "/", "named", "-", "query", ">", "<", "/", "entity", "-", "mappings", ">"], "docstring_tokens": ["via", "the", "eventTime", "parameter", "to", "service/plugins/policies/eventTime", "."]}
{"contents": ["flat:", "fix", "uninitialized", "ptr", "with", "shared", "libs", "The", "new", "credentials", "code", "broke", "load_flat_shared_library()", "as", "it", "now", "uses", "an", "uninitialized", "cred", "pointer.", "Reported-by:", "Bernd", "Schmidt", "<bernds_cb1@t-online.de>", "Tested-by:", "Bernd", "Schmidt", "<bernds_cb1@t-online.de>", "Cc:", "Mike", "Frysinger", "<vapier@gentoo.org>", "Cc:", "David", "Howells", "<dhowells@redhat.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "828", ",", "15", "+", "828", ",", "22", "@", "@", "static", "int", "load_flat_shared_library", "(", "int", "id", ",", "struct", "lib_info", "*", "libs", ")", "if", "(", "IS_ERR", "(", "bprm", ".", "file", ")", ")", "return", "res", ";", "bprm", ".", "cred", "=", "prepare_exec_creds", "(", ");", "res", "=", "-", "ENOMEM", ";", "if", "(", "!", "bprm", ".", "cred", ")", "goto", "out", ";", "res", "=", "prepare_binprm", "(", "&", "bprm", ")", ";", "if", "(", "res", "<", "=", "(", "unsigned", "long", ")", "-", "4096", ")", "res", "=", "load_flat_file", "(", "&", "bprm", ",", "libs", ",", "id", ",", "NULL", ")", ";", "if", "(", "bprm", ".", "file", ")", "{", "allow_write_access", "(", "bprm", ".", "file", ")", ";", "fput", "(", "bprm", ".", "file", ")", ";", "bprm", ".", "file", "=", "NULL", ";", "}", "abort_creds", "(", "bprm", ".", "cred", ")", ";", "out", ":", "allow_write_access", "(", "bprm", ".", "file", ")", ";", "fput", "(", "bprm", ".", "file", ")", ";", "return", "(", "res", ")", ";", "}"], "docstring_tokens": ["uses", "an", "uninitialised", "cred", "pointer"]}
{"contents": ["cifs:", "fix", "off-by-one", "bug", "in", "build_unc_path_to_root", "commit", "839db3d10a", "(cifs:", "fix", "up", "handling", "of", "prefixpath=", "option)", "changed", "the", "code", "such", "that", "the", "vol->prepath", "no", "longer", "contained", "a", "leading", "delimiter", "and", "then", "fixed", "up", "the", "places", "that", "accessed", "that", "field", "to", "account", "for", "that", "change.", "One", "spot", "in", "build_unc_path_to_root", "was", "missed", "however.", "When", "doing", "the", "pointer", "addition", "on", "pos,", "that", "patch", "failed", "to", "account", "for", "the", "fact", "that", "we", "had", "already", "incremented", "\"pos\"", "by", "one", "when", "adding", "the", "length", "of", "the", "prepath.", "This", "caused", "a", "buffer", "overrun", "by", "one", "byte.", "This", "patch", "fixes", "the", "problem", "by", "correcting", "the", "handling", "of", "\"pos\".", "Cc:", "<stable@vger.kernel.org>", "#", "v3.8+", "Reported-by:", "Marcus", "Moeller", "<marcus.moeller@gmx.ch>", "Reported-by:", "Ken", "Fallon", "<ken.fallon@gmail.com>", "Signed-off-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["@", "@", "-", "3279", ",", "8", "+", "3279", ",", "8", "@", "@", "build_unc_path_to_root", "(", "const", "struct", "smb_vol", "*", "vol", ",", "pos", "=", "full_path", "+", "unc_len", ";", "if", "(", "pplen", ")", "{", "*", "pos", "+", "+", "=", "CIFS_DIR_SEP", "(", "cifs_sb", ")", ";", "strncpy", "(", "pos", ",", "vol", "-", ">", "prepath", ",", "pplen", ")", ";", "*", "pos", "=", "CIFS_DIR_SEP", "(", "cifs_sb", ")", ";", "strncpy", "(", "pos", "+", "1", ",", "vol", "-", ">", "prepath", ",", "pplen", ")", ";", "pos", "+", "=", "pplen", ";", "}"], "docstring_tokens": ["writing", "one", "byte", "past", "an", "allocated", "memory", "area"]}
{"contents": ["DATACMNS-1282", "-", "Switched", "to", "SimpleEvaluationContext", "in", "MapDataBinder."], "code_tokens": ["@", "@", "-", "39", ",", "16", "+", "39", ",", "12", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "util", ".", "TypeInformation", ";", "import", "org", ".", "springframework", ".", "expression", ".", "AccessException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "EvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "EvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypeLocator", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypedValue", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelEvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelMessage", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelParserConfiguration", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "standard", ".", "SpelExpressionParser", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardTypeConverter", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "SimpleEvaluationContext", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "WebDataBinder", ";", "@", "@", "-", "108", ",", "13", "+", "104", ",", "6", "@", "@", "protected", "ConfigurablePropertyAccessor", "getPropertyAccessor", "(", ")", "{", "private", "static", "final", "SpelExpressionParser", "PARSER", "=", "new", "SpelExpressionParser", "(", "new", "SpelParserConfiguration", "(", "false", ",", "true", ")", ");", "private", "static", "final", "TypeLocator", "REJECTING_LOCATOR", "=", "new", "TypeLocator", "(", ")", "{", "@", "Override", "public", "Class", "<", "?>", "findType", "(", "String", "typeName", ")", "throws", "EvaluationException", "{", "throw", "new", "SpelEvaluationException", "(", "SpelMessage", ".", "TYPE_NOT_FOUND", ",", "typeName", ")", ";", "}", "}", ";", "private", "final", "@", "NonNull", "Class", "<", "?>", "type", ";", "private", "final", "@", "NonNull", "Map", "<", "String", ",", "Object", ">", "map", ";", "@", "@", "-", "172", ",", "14", "+", "161", ",", "6", "@", "@", "public", "void", "setPropertyValue", "(", "String", "propertyName", ",", "Object", "value", ")", "throws", "BeansExce", "throw", "new", "NotWritablePropertyException", "(", "type", ",", "propertyName", ")", ";", "}", "StandardEvaluationContext", "context", "=", "new", "StandardEvaluationContext", "(", ");", "context", ".", "addPropertyAccessor", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ");", "context", ".", "setTypeConverter", "(", "new", "StandardTypeConverter", "(", "conversionService", ")", ");", "context", ".", "setTypeLocator", "(", "REJECTING_LOCATOR", ")", ";", "context", ".", "setRootObject", "(", "map", ")", ";", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";", "PropertyPath", "leafProperty", "=", "getPropertyPath", "(", "propertyName", ")", ".", "getLeafProperty", "(", ");", "TypeInformation", "<", "?>", "owningType", "=", "leafProperty", ".", "getOwningType", "(", ");", "TypeInformation", "<", "?>", "propertyType", "=", "owningType", ".", "getProperty", "(", "leafProperty", ".", "getSegment", "(", "))", ";", "@", "@", "-", "196", ",", "6", "+", "177", ",", "15", "@", "@", "public", "void", "setPropertyValue", "(", "String", "propertyName", ",", "Object", "value", ")", "throws", "BeansExce", "value", "=", "conversionService", ".", "convert", "(", "value", ",", "TypeDescriptor", ".", "forObject", "(", "value", ")", ",", "typeDescriptor", ")", ";", "}", "EvaluationContext", "context", "=", "SimpleEvaluationContext", "/", "/", ".", "forPropertyAccessors", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ")", "/", "/", ".", "withConversionService", "(", "conversionService", ")", "/", "/", ".", "withRootObject", "(", "map", ")", "/", "/", ".", "build", "(", ");", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";", "try", "{", "expression", ".", "setValue", "(", "context", ",", "value", ")", ";", "}", "catch", "(", "SpelEvaluationException", "o_O", ")", "{"], "docstring_tokens": ["sends", "a", "specially", "prepared", "form", "of", "a", "serialized", "object"]}
{"contents": ["crypto:", "algif", "-", "suppress", "sending", "source", "address", "information", "in", "recvmsg", "The", "current", "code", "does", "not", "set", "the", "msg_namelen", "member", "to", "0", "and", "therefore", "makes", "net/socket.c", "leak", "the", "local", "sockaddr_storage", "variable", "to", "userland", "--", "128", "bytes", "of", "kernel", "stack", "memory.", "Fix", "that.", "Cc:", "<stable@vger.kernel.org>", "#", "2.6.38", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>"], "code_tokens": ["@", "@", "-", "161", ",", "6", "+", "161", ",", "8", "@", "@", "static", "int", "hash_recvmsg", "(", "struct", "kiocb", "*", "unused", ",", "struct", "socket", "*", "sock", ",", "else", "if", "(", "len", "<", "ds", ")", "msg", "-", ">", "msg_flags", "|", "=", "MSG_TRUNC", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";", "lock_sock", "(", "sk", ")", ";", "if", "(", "ctx", "-", ">", "more", ")", "{", "ctx", "-", ">", "more", "=", "0", ";", "@", "@", "-", "432", ",", "6", "+", "432", ",", "7", "@", "@", "static", "int", "skcipher_recvmsg", "(", "struct", "kiocb", "*", "unused", ",", "struct", "socket", "*", "sock", ",", "long", "copied", "=", "0", ";", "lock_sock", "(", "sk", ")", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";", "for", "(", "iov", "=", "msg", "-", ">", "msg_iov", ",", "iovlen", "=", "msg", "-", ">", "msg_iovlen", ";", "iovlen", ">", "0", ";", "iovlen", "-", "-,", "iov", "+", "+)", "{", "unsigned", "long", "seglen", "=", "iov", "-", ">", "iov_len", ";"], "docstring_tokens": ["using", "recvmsg(2)/recvfrom(2)"]}
{"contents": ["HDFS-9574.", "Reduce", "client", "failures", "during", "datanode", "restart.", "Contributed", "by", "Kihwal", "Lee.", "(cherry", "picked", "from", "commit", "b06e39de4fc4f9c35afb472eef0bba2adf91954f)", "Conflicts:", "hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt", "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSInputStream.java", "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataNodeFaultInjector.java", "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/datanode/DataXceiver.java", "hadoop-hdfs-project/hadoop-hdfs/src/main/resources/hdfs-default.xml"], "code_tokens": ["@", "@", "-", "20", ",", "6", "+", "20", ",", "8", "@", "@", "Release", "2", ".", "6", ".", "4", "-", "UNRELEASED", "HDFS", "-", "6945", ".", "BlockManager", "should", "remove", "a", "block", "from", "excessReplicateMap", "and", "decrement", "ExcessBlocks", "metric", "when", "the", "block", "is", "removed", ".", "(", "aajisaka", ")", "HDFS", "-", "9574", ".", "Reduce", "client", "failures", "during", "datanode", "restart", "(", "kihwal", ")", "OPTIMIZATIONS", "BUG", "FIXES", "@", "@", "-", "470", ",", "6", "+", "470", ",", "8", "@", "@", "public", "static", "final", "String", "DFS_DATANODE_IPC_ADDRESS_DEFAULT", "=", "\"", "0", ".", "0", ".", "0", ".", "0", ":", "\"", "+", "DFS_DATANODE_IPC_DEFAULT_PORT", ";", "public", "static", "final", "String", "DFS_DATANODE_MIN_SUPPORTED_NAMENODE_VERSION_KEY", "=", "\"", "dfs", ".", "datanode", ".", "min", ".", "supported", ".", "namenode", ".", "version", "\"", ";", "public", "static", "final", "String", "DFS_DATANODE_MIN_SUPPORTED_NAMENODE_VERSION_DEFAULT", "=", "\"", "2", ".", "1", ".", "0", "-", "beta", "\"", ";", "public", "static", "final", "String", "DFS_DATANODE_BP_READY_TIMEOUT_KEY", "=", "\"", "dfs", ".", "datanode", ".", "bp", "-", "ready", ".", "timeout", "\"", ";", "public", "static", "final", "long", "DFS_DATANODE_BP_READY_TIMEOUT_DEFAULT", "=", "20", ";", "public", "static", "final", "String", "DFS_BLOCK_ACCESS_TOKEN_ENABLE_KEY", "=", "\"", "dfs", ".", "block", ".", "access", ".", "token", ".", "enable", "\"", ";", "public", "static", "final", "boolean", "DFS_BLOCK_ACCESS_TOKEN_ENABLE_DEFAULT", "=", "false", ";", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "@", "@", "-", "69", ",", "10", "+", "70", ",", "12", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "io", ".", "ByteBufferPool", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "ipc", ".", "RPC", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "ipc", ".", "RemoteException", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "ipc", ".", "RetriableException", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "net", ".", "NetUtils", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "security", ".", "token", ".", "SecretManager", ".", "InvalidToken", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "security", ".", "token", ".", "Token", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "IdentityHashStore", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "Time", ";", "import", "com", ".", "google", ".", "common", ".", "annotations", ".", "VisibleForTesting", ";", "@", "@", "-", "314", ",", "27", "+", "317", ",", "38", "@", "@", "private", "long", "fetchLocatedBlocksAndGetLastBlockLength", "(", ")", "throws", "IOException", "{", "private", "long", "readBlockLength", "(", "LocatedBlock", "locatedblock", ")", "throws", "IOException", "{", "assert", "locatedblock", "!", "=", "null", ":", "\"", "LocatedBlock", "cannot", "be", "null", "\"", ";", "int", "replicaNotFoundCount", "=", "locatedblock", ".", "getLocations", "(", ").", "length", ";", "for", "(", "DatanodeInfo", "datanode", ":", "locatedblock", ".", "getLocations", "(", "))", "{", "final", "int", "timeout", "=", "dfsClient", ".", "getConf", "(", ").", "socketTimeout", ";", "LinkedList", "<", "DatanodeInfo", ">", "nodeList", "=", "new", "LinkedList", "<", "DatanodeInfo", ">", "(", "Arrays", ".", "asList", "(", "locatedblock", ".", "getLocations", "(", "))", ");", "LinkedList", "<", "DatanodeInfo", ">", "retryList", "=", "new", "LinkedList", "<", "DatanodeInfo", ">", "()", ";", "boolean", "isRetry", "=", "false", ";", "long", "startTime", "=", "0", ";", "while", "(", "nodeList", ".", "size", "(", ")", ">", "0", ")", "{", "DatanodeInfo", "datanode", "=", "nodeList", ".", "pop", "(", ");", "ClientDatanodeProtocol", "cdp", "=", "null", ";", "try", "{", "cdp", "=", "DFSUtil", ".", "createClientDatanodeProtocolProxy", "(", "datanode", ",", "dfsClient", ".", "getConfiguration", "(", "),", "dfsClient", ".", "getConf", "(", ").", "socketTimeout", ",", "dfsClient", ".", "getConfiguration", "(", "),", "timeout", ",", "dfsClient", ".", "getConf", "(", ").", "connectToDnViaHostname", ",", "locatedblock", ")", ";", "final", "long", "n", "=", "cdp", ".", "getReplicaVisibleLength", "(", "locatedblock", ".", "getBlock", "(", "))", ";", "if", "(", "n", ">", "=", "0", ")", "{", "return", "n", ";", "}", "}", "catch", "(", "IOException", "ioe", ")", "{", "if", "(", "ioe", "instanceof", "RemoteException", "&", "&", "(", "((", "RemoteException", ")", "ioe", ")", ".", "unwrapRemoteException", "(", ")", "instanceof", "ReplicaNotFoundException", ")", ")", "{", "/", "/", "special", "case", ":", "replica", "might", "not", "be", "on", "the", "DN", ",", "treat", "as", "0", "length", "replicaNotFoundCount", "-", "-;", "}", "catch", "(", "IOException", "ioe", ")", "{", "if", "(", "ioe", "instanceof", "RemoteException", ")", "{", "if", "(", "((", "RemoteException", ")", "ioe", ")", ".", "unwrapRemoteException", "(", ")", "instanceof", "ReplicaNotFoundException", ")", "{", "/", "/", "replica", "is", "not", "on", "the", "DN", ".", "We", "will", "treat", "it", "as", "0", "length", "/", "/", "if", "no", "one", "actually", "has", "a", "replica", ".", "replicaNotFoundCount", "-", "-;", "}", "else", "if", "(", "((", "RemoteException", ")", "ioe", ")", ".", "unwrapRemoteException", "(", ")", "instanceof", "RetriableException", ")", "{", "/", "/", "add", "to", "the", "list", "to", "be", "retried", "if", "necessary", ".", "retryList", ".", "add", "(", "datanode", ")", ";", "}", "}", "if", "(", "DFSClient", ".", "LOG", ".", "isDebugEnabled", "(", "))", "{", "@", "@", "-", "346", ",", "6", "+", "360", ",", "30", "@", "@", "private", "long", "readBlockLength", "(", "LocatedBlock", "locatedblock", ")", "throws", "IOException", "{", "RPC", ".", "stopProxy", "(", "cdp", ")", ";", "}", "}", "/", "/", "Ran", "out", "of", "nodes", ",", "but", "there", "are", "retriable", "nodes", ".", "if", "(", "nodeList", ".", "size", "(", ")", "=", "=", "0", "&", "&", "retryList", ".", "size", "(", ")", ">", "0", ")", "{", "nodeList", ".", "addAll", "(", "retryList", ")", ";", "retryList", ".", "clear", "(", ");", "isRetry", "=", "true", ";", "}", "if", "(", "isRetry", ")", "{", "/", "/", "start", "tracking", "the", "time", "if", "(", "startTime", "=", "=", "0", ")", "{", "startTime", "=", "Time", ".", "monotonicNow", "(", ");", "}", "try", "{", "Thread", ".", "sleep", "(", "500", ")", ";", "/", "/", "delay", "between", "retries", ".", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "IOException", "(", "\"", "Interrupted", "while", "getting", "the", "length", ".", "\")", ";", "}", "}", "/", "/", "see", "if", "we", "ran", "out", "of", "retry", "time", "if", "(", "startTime", ">", "0", "&", "&", "(", "Time", ".", "monotonicNow", "(", ")", "-", "startTime", ">", "timeout", ")", ")", "{", "break", ";", "}", "}", "/", "/", "Namenode", "told", "us", "about", "these", "locations", ",", "but", "none", "know", "about", "the", "replica", "@", "@", "-", "50", ",", "6", "+", "50", ",", "8", "@", "@", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "DFS_DATANODE_RESTART_REPLICA_EXPIRY_DEFAULT", ";", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "IGNORE_SECURE_PORTS_FOR_TESTING_KEY", ";", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "IGNORE_SECURE_PORTS_FOR_TESTING_DEFAULT", ";", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "DFS_DATANODE_BP_READY_TIMEOUT_KEY", ";", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "DFS_DATANODE_BP_READY_TIMEOUT_DEFAULT", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "conf", ".", "Configuration", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ";", "@", "@", "-", "100", ",", "6", "+", "102", ",", "8", "@", "@", "final", "long", "maxLockedMemory", ";", "private", "final", "long", "bpReadyTimeout", ";", "public", "DNConf", "(", "Configuration", "conf", ")", "{", "this", ".", "conf", "=", "conf", ";", "socketTimeout", "=", "conf", ".", "getInt", "(", "DFS_CLIENT_SOCKET_TIMEOUT_KEY", ",", "@", "@", "-", "193", ",", "6", "+", "197", ",", "10", "@", "@", "public", "DNConf", "(", "Configuration", "conf", ")", "{", "this", ".", "restartReplicaExpiry", "=", "conf", ".", "getLong", "(", "DFS_DATANODE_RESTART_REPLICA_EXPIRY_KEY", ",", "DFS_DATANODE_RESTART_REPLICA_EXPIRY_DEFAULT", ")", "*", "1000L", ";", "this", ".", "bpReadyTimeout", "=", "conf", ".", "getLong", "(", "DFS_DATANODE_BP_READY_TIMEOUT_KEY", ",", "DFS_DATANODE_BP_READY_TIMEOUT_DEFAULT", ")", ";", "}", "/", "/", "We", "get", "minimumNameNodeVersion", "via", "a", "method", "so", "it", "can", "be", "mocked", "out", "in", "tests", ".", "@", "@", "-", "266", ",", "4", "+", "274", ",", "8", "@", "@", "public", "TrustedChannelResolver", "getTrustedChannelResolver", "(", ")", "{", "public", "boolean", "getIgnoreSecurePortsForTesting", "(", ")", "{", "return", "ignoreSecurePortsForTesting", ";", "}", "public", "long", "getBpReadyTimeout", "(", ")", "{", "return", "bpReadyTimeout", ";", "}", "}", "@", "@", "-", "1409", ",", "6", "+", "1409", ",", "7", "@", "@", "public", "int", "getIpcPort", "(", ")", "{", "@", "VisibleForTesting", "public", "DatanodeRegistration", "getDNRegistrationForBP", "(", "String", "bpid", ")", "throws", "IOException", "{", "DataNodeFaultInjector", ".", "get", "(", ").", "noRegistration", "(", ");", "BPOfferService", "bpos", "=", "blockPoolManager", ".", "get", "(", "bpid", ")", ";", "if", "(", "bpos", "=", "=", "null", "|", "|", "bpos", ".", "bpRegistration", "=", "=", "null", ")", "{", "throw", "new", "IOException", "(", "\"", "cannot", "find", "BPOfferService", "for", "bpid", "=", "\"+", "bpid", ")", ";", "@", "@", "-", "1536", ",", "7", "+", "1537", ",", "6", "@", "@", "public", "ShortCircuitFdsVersionException", "(", "String", "msg", ")", "{", "throw", "new", "ShortCircuitFdsUnsupportedException", "(", "fileDescriptorPassingDisabledReason", ")", ";", "}", "checkBlockToken", "(", "blk", ",", "token", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "READ", ")", ";", "int", "blkVersion", "=", "CURRENT_BLOCK_FORMAT_VERSION", ";", "if", "(", "maxVersion", "<", "blkVersion", ")", "{", "throw", "new", "ShortCircuitFdsVersionException", "(", "\"", "Your", "client", "is", "too", "old", "\"", "+", "@", "@", "-", "2744", ",", "6", "+", "2744", ",", "15", "@", "@", "public", "long", "getReplicaVisibleLength", "(", "final", "ExtendedBlock", "block", ")", "throws", "IOExceptio", "}", "private", "void", "checkReadAccess", "(", "final", "ExtendedBlock", "block", ")", "throws", "IOException", "{", "/", "/", "Make", "sure", "this", "node", "has", "registered", "for", "the", "block", "pool", ".", "try", "{", "getDNRegistrationForBP", "(", "block", ".", "getBlockPoolId", "(", "))", ";", "}", "catch", "(", "IOException", "e", ")", "{", "/", "/", "if", "it", "has", "not", "registered", "with", "the", "NN", ",", "throw", "an", "exception", "back", ".", "throw", "new", "org", ".", "apache", ".", "hadoop", ".", "ipc", ".", "RetriableException", "(", "\"", "Datanode", "not", "registered", ".", "Try", "again", "later", ".", "\")", ";", "}", "if", "(", "isBlockTokenEnabled", ")", "{", "Set", "<", "TokenIdentifier", ">", "tokenIds", "=", "UserGroupInformation", ".", "getCurrentUser", "(", ")", ".", "getTokenIdentifiers", "(", ");", "@", "@", "-", "39", ",", "4", "+", "39", ",", "6", "@", "@", "public", "static", "DataNodeFaultInjector", "get", "(", ")", "{", "public", "void", "getHdfsBlocksMetadata", "(", ")", "{", "}", "public", "void", "sendShortCircuitShmResponse", "(", ")", "throws", "IOException", "{", "}", "public", "void", "noRegistration", "(", ")", "throws", "IOException", "{", "}", "}", "@", "@", "-", "44", ",", "6", "+", "44", ",", "7", "@", "@", "import", "java", ".", "nio", ".", "channels", ".", "ClosedChannelException", ";", "import", "java", ".", "security", ".", "MessageDigest", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "ExtendedBlockId", ";", "@", "@", "-", "84", ",", "6", "+", "85", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "security", ".", "token", ".", "SecretManager", ".", "InvalidToken", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "security", ".", "token", ".", "Token", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "DataChecksum", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "Time", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Preconditions", ";", "import", "com", ".", "google", ".", "protobuf", ".", "ByteString", ";", "@", "@", "-", "273", ",", "6", "+", "275", ",", "9", "@", "@", "public", "void", "requestShortCircuitFds", "(", "final", "ExtendedBlock", "blk", ",", "SlotId", "slotId", ",", "int", "maxVersion", ",", "boolean", "supportsReceiptVerification", ")", "throws", "IOException", "{", "updateCurrentThreadName", "(", "\"", "Passing", "file", "descriptors", "for", "block", "\"", "+", "blk", ")", ";", "DataOutputStream", "out", "=", "getBufferedOutputStream", "(", ");", "checkAccess", "(", "out", ",", "true", ",", "blk", ",", "token", ",", "Op", ".", "REQUEST_SHORT_CIRCUIT_FDS", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "READ", ")", ";", "BlockOpResponseProto", ".", "Builder", "bld", "=", "BlockOpResponseProto", ".", "newBuilder", "(", ");", "FileInputStream", "fis", "[", "]", "=", "null", ";", "SlotId", "registeredSlotId", "=", "null", ";", "@", "@", "-", "301", ",", "9", "+", "306", ",", "6", "@", "@", "public", "void", "requestShortCircuitFds", "(", "final", "ExtendedBlock", "blk", ",", "}", "catch", "(", "ShortCircuitFdsUnsupportedException", "e", ")", "{", "bld", ".", "setStatus", "(", "ERROR_UNSUPPORTED", ")", ";", "bld", ".", "setMessage", "(", "e", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "InvalidToken", "e", ")", "{", "bld", ".", "setStatus", "(", "ERROR_ACCESS_TOKEN", ")", ";", "bld", ".", "setMessage", "(", "e", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "IOException", "e", ")", "{", "bld", ".", "setStatus", "(", "ERROR", ")", ";", "bld", ".", "setMessage", "(", "e", ".", "getMessage", "(", "))", ";", "@", "@", "-", "489", ",", "10", "+", "491", ",", "9", "@", "@", "public", "void", "readBlock", "(", "final", "ExtendedBlock", "block", ",", "final", "boolean", "sendChecksum", ",", "final", "CachingStrategy", "cachingStrategy", ")", "throws", "IOException", "{", "previousOpClientName", "=", "clientName", ";", "updateCurrentThreadName", "(", "\"", "Sending", "block", "\"", "+", "block", ")", ";", "OutputStream", "baseStream", "=", "getOutputStream", "(", ");", "DataOutputStream", "out", "=", "new", "DataOutputStream", "(", "new", "BufferedOutputStream", "(", "baseStream", ",", "HdfsConstants", ".", "SMALL_BUFFER_SIZE", ")", ");", "DataOutputStream", "out", "=", "getBufferedOutputStream", "(", ");", "checkAccess", "(", "out", ",", "true", ",", "block", ",", "blockToken", ",", "Op", ".", "READ_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "READ", ")", ";", "@", "@", "-", "508", ",", "7", "+", "509", ",", "6", "@", "@", "public", "void", "readBlock", "(", "final", "ExtendedBlock", "block", ",", ":", "dnR", "+", "\"", "Served", "block", "\"", "+", "block", "+", "\"", "to", "\"", "+", "remoteAddress", ";", "updateCurrentThreadName", "(", "\"", "Sending", "block", "\"", "+", "block", ")", ";", "try", "{", "try", "{", "blockSender", "=", "new", "BlockSender", "(", "block", ",", "blockOffset", ",", "length", ",", "@", "@", "-", "594", ",", "6", "+", "594", ",", "10", "@", "@", "public", "void", "writeBlock", "(", "final", "ExtendedBlock", "block", ",", "final", "boolean", "isTransfer", "=", "stage", "=", "=", "BlockConstructionStage", ".", "TRANSFER_RBW", "|", "|", "stage", "=", "=", "BlockConstructionStage", ".", "TRANSFER_FINALIZED", ";", "/", "/", "reply", "to", "upstream", "datanode", "or", "client", "final", "DataOutputStream", "replyOut", "=", "getBufferedOutputStream", "(", ");", "checkAccess", "(", "replyOut", ",", "isClient", ",", "block", ",", "blockToken", ",", "Op", ".", "WRITE_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "WRITE", ")", ";", "/", "/", "check", "single", "target", "for", "transfer", "-", "RBW", "/", "Finalized", "if", "(", "isTransfer", "&", "&", "targets", ".", "length", ">", "0", ")", "{", "throw", "new", "IOException", "(", "stage", "+", "\"", "does", "not", "support", "multiple", "targets", "\"", "@", "@", "-", "624", ",", "14", "+", "628", ",", "6", "@", "@", "public", "void", "writeBlock", "(", "final", "ExtendedBlock", "block", ",", "LOG", ".", "info", "(", "\"", "Receiving", "\"", "+", "block", "+", "\"", "src", ":", "\"", "+", "remoteAddress", "+", "\"", "dest", ":", "\"", "+", "localAddress", ")", ";", "/", "/", "reply", "to", "upstream", "datanode", "or", "client", "final", "DataOutputStream", "replyOut", "=", "new", "DataOutputStream", "(", "new", "BufferedOutputStream", "(", "getOutputStream", "(", "),", "HdfsConstants", ".", "SMALL_BUFFER_SIZE", ")", ");", "checkAccess", "(", "replyOut", ",", "isClient", ",", "block", ",", "blockToken", ",", "Op", ".", "WRITE_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "WRITE", ")", ";", "DataOutputStream", "mirrorOut", "=", "null", ";", "/", "/", "stream", "to", "next", "target", "DataInputStream", "mirrorIn", "=", "null", ";", "/", "/", "reply", "from", "next", "target", "Socket", "mirrorSock", "=", "null", ";", "/", "/", "socket", "to", "next", "target", "@", "@", "-", "812", ",", "13", "+", "808", ",", "13", "@", "@", "public", "void", "transferBlock", "(", "final", "ExtendedBlock", "blk", ",", "final", "String", "clientName", ",", "final", "DatanodeInfo", "[", "]", "targets", ",", "final", "StorageType", "[", "]", "targetStorageTypes", ")", "throws", "IOException", "{", "checkAccess", "(", "socketOut", ",", "true", ",", "blk", ",", "blockToken", ",", "Op", ".", "TRANSFER_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "COPY", ")", ";", "previousOpClientName", "=", "clientName", ";", "updateCurrentThreadName", "(", "Op", ".", "TRANSFER_BLOCK", "+", "\"", "\"", "+", "blk", ")", ";", "final", "DataOutputStream", "out", "=", "new", "DataOutputStream", "(", "getOutputStream", "(", "))", ";", "checkAccess", "(", "out", ",", "true", ",", "blk", ",", "blockToken", ",", "Op", ".", "TRANSFER_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "COPY", ")", ";", "try", "{", "datanode", ".", "transferReplicaForPipelineRecovery", "(", "blk", ",", "targets", ",", "targetStorageTypes", ",", "clientName", ")", ";", "@", "@", "-", "868", ",", "6", "+", "864", ",", "7", "@", "@", "private", "MD5Hash", "calcPartialBlockChecksum", "(", "ExtendedBlock", "block", ",", "@", "Override", "public", "void", "blockChecksum", "(", "final", "ExtendedBlock", "block", ",", "final", "Token", "<", "BlockTokenIdentifier", ">", "blockToken", ")", "throws", "IOException", "{", "updateCurrentThreadName", "(", "\"", "Getting", "checksum", "for", "block", "\"", "+", "block", ")", ";", "final", "DataOutputStream", "out", "=", "new", "DataOutputStream", "(", "getOutputStream", "(", "))", ";", "checkAccess", "(", "out", ",", "true", ",", "block", ",", "blockToken", ",", "@", "@", "-", "878", ",", "13", "+", "875", ",", "11", "@", "@", "public", "void", "blockChecksum", "(", "final", "ExtendedBlock", "block", ",", "long", "visibleLength", "=", "datanode", ".", "data", ".", "getReplicaVisibleLength", "(", "block", ")", ";", "boolean", "partialBlk", "=", "requestLength", "<", "visibleLength", ";", "updateCurrentThreadName", "(", "\"", "Reading", "metadata", "for", "block", "\"", "+", "block", ")", ";", "final", "LengthInputStream", "metadataIn", "=", "datanode", ".", "data", ".", "getMetaDataInputStream", "(", "block", ")", ";", "final", "DataInputStream", "checksumIn", "=", "new", "DataInputStream", "(", "new", "BufferedInputStream", "(", "metadataIn", ",", "HdfsConstants", ".", "IO_FILE_BUFFER_SIZE", ")", ");", "updateCurrentThreadName", "(", "\"", "Getting", "checksum", "for", "block", "\"", "+", "block", ")", ";", "try", "{", "/", "/", "read", "metadata", "file", "final", "BlockMetadataHeader", "header", "=", "BlockMetadataHeader", "@", "@", "-", "928", ",", "20", "+", "923", ",", "9", "@", "@", "public", "void", "blockChecksum", "(", "final", "ExtendedBlock", "block", ",", "public", "void", "copyBlock", "(", "final", "ExtendedBlock", "block", ",", "final", "Token", "<", "BlockTokenIdentifier", ">", "blockToken", ")", "throws", "IOException", "{", "updateCurrentThreadName", "(", "\"", "Copying", "block", "\"", "+", "block", ")", ";", "/", "/", "Read", "in", "the", "header", "if", "(", "datanode", ".", "isBlockTokenEnabled", ")", "{", "try", "{", "datanode", ".", "blockPoolTokenSecretManager", ".", "checkAccess", "(", "blockToken", ",", "null", ",", "block", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "COPY", ")", ";", "}", "catch", "(", "InvalidToken", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Invalid", "access", "token", "in", "request", "from", "\"", "+", "remoteAddress", "+", "\"", "for", "OP_COPY_BLOCK", "for", "block", "\"", "+", "block", "+", "\"", ":", "\"", "+", "e", ".", "getLocalizedMessage", "(", "))", ";", "sendResponse", "(", "ERROR_ACCESS_TOKEN", ",", "\"", "Invalid", "access", "token", "\"", ");", "return", ";", "}", "}", "DataOutputStream", "reply", "=", "getBufferedOutputStream", "(", ");", "checkAccess", "(", "reply", ",", "true", ",", "block", ",", "blockToken", ",", "Op", ".", "COPY_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "COPY", ")", ";", "if", "(", "!", "dataXceiverServer", ".", "balanceThrottler", ".", "acquire", "(", "))", "{", "/", "/", "not", "able", "to", "start", "String", "msg", "=", "\"", "Not", "able", "to", "copy", "block", "\"", "+", "block", ".", "getBlockId", "(", ")", "+", "\"", "\"", "+", "@", "@", "-", "953", ",", "18", "+", "937", ",", "14", "@", "@", "public", "void", "copyBlock", "(", "final", "ExtendedBlock", "block", ",", "}", "BlockSender", "blockSender", "=", "null", ";", "DataOutputStream", "reply", "=", "null", ";", "boolean", "isOpSuccess", "=", "true", ";", "try", "{", "/", "/", "check", "if", "the", "block", "exists", "or", "not", "blockSender", "=", "new", "BlockSender", "(", "block", ",", "0", ",", "-", "1", ",", "false", ",", "false", ",", "true", ",", "datanode", ",", "null", ",", "CachingStrategy", ".", "newDropBehind", "(", "))", ";", "/", "/", "set", "up", "response", "stream", "OutputStream", "baseStream", "=", "getOutputStream", "(", ");", "reply", "=", "new", "DataOutputStream", "(", "new", "BufferedOutputStream", "(", "baseStream", ",", "HdfsConstants", ".", "SMALL_BUFFER_SIZE", ")", ");", "/", "/", "send", "status", "first", "writeSuccessWithChecksumInfo", "(", "blockSender", ",", "reply", ")", ";", "@", "@", "-", "1004", ",", "21", "+", "984", ",", "12", "@", "@", "public", "void", "replaceBlock", "(", "final", "ExtendedBlock", "block", ",", "final", "String", "delHint", ",", "final", "DatanodeInfo", "proxySource", ")", "throws", "IOException", "{", "updateCurrentThreadName", "(", "\"", "Replacing", "block", "\"", "+", "block", "+", "\"", "from", "\"", "+", "delHint", ")", ";", "DataOutputStream", "replyOut", "=", "new", "DataOutputStream", "(", "getOutputStream", "(", "))", ";", "checkAccess", "(", "replyOut", ",", "true", ",", "block", ",", "blockToken", ",", "Op", ".", "REPLACE_BLOCK", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "REPLACE", ")", ";", "/", "*", "read", "header", "*", "/", "block", ".", "setNumBytes", "(", "dataXceiverServer", ".", "estimateBlockSize", ")", ";", "if", "(", "datanode", ".", "isBlockTokenEnabled", ")", "{", "try", "{", "datanode", ".", "blockPoolTokenSecretManager", ".", "checkAccess", "(", "blockToken", ",", "null", ",", "block", ",", "BlockTokenSecretManager", ".", "AccessMode", ".", "REPLACE", ")", ";", "}", "catch", "(", "InvalidToken", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Invalid", "access", "token", "in", "request", "from", "\"", "+", "remoteAddress", "+", "\"", "for", "OP_REPLACE_BLOCK", "for", "block", "\"", "+", "block", "+", "\"", ":", "\"", "+", "e", ".", "getLocalizedMessage", "(", "))", ";", "sendResponse", "(", "ERROR_ACCESS_TOKEN", ",", "\"", "Invalid", "access", "token", "\"", ");", "return", ";", "}", "}", "if", "(", "!", "dataXceiverServer", ".", "balanceThrottler", ".", "acquire", "(", "))", "{", "/", "/", "not", "able", "to", "start", "String", "msg", "=", "\"", "Not", "able", "to", "receive", "block", "\"", "+", "block", ".", "getBlockId", "(", ")", "+", "@", "@", "-", "1035", ",", "7", "+", "1006", ",", "6", "@", "@", "public", "void", "replaceBlock", "(", "final", "ExtendedBlock", "block", ",", "String", "errMsg", "=", "null", ";", "BlockReceiver", "blockReceiver", "=", "null", ";", "DataInputStream", "proxyReply", "=", "null", ";", "DataOutputStream", "replyOut", "=", "new", "DataOutputStream", "(", "getOutputStream", "(", "))", ";", "try", "{", "/", "/", "get", "the", "output", "stream", "to", "the", "proxy", "final", "String", "dnAddr", "=", "proxySource", ".", "getXferAddr", "(", "connectToDnViaHostname", ")", ";", "@", "@", "-", "1135", ",", "6", "+", "1105", ",", "16", "@", "@", "public", "void", "replaceBlock", "(", "final", "ExtendedBlock", "block", ",", "datanode", ".", "metrics", ".", "addReplaceBlockOp", "(", "elapsed", "(", "))", ";", "}", "/", "**", "*", "Separated", "for", "testing", ".", "*", "@", "return", "*", "/", "DataOutputStream", "getBufferedOutputStream", "(", ")", "{", "return", "new", "DataOutputStream", "(", "new", "BufferedOutputStream", "(", "getOutputStream", "(", "),", "HdfsConstants", ".", "SMALL_BUFFER_SIZE", ")", ");", "}", "private", "long", "elapsed", "(", ")", "{", "return", "now", "(", ")", "-", "opStartTime", ";", "}", "@", "@", "-", "1178", ",", "11", "+", "1158", ",", "51", "@", "@", "private", "void", "writeSuccessWithChecksumInfo", "(", "BlockSender", "blockSender", ",", "}", "/", "**", "*", "Wait", "until", "the", "BP", "is", "registered", ",", "upto", "the", "configured", "amount", "of", "time", ".", "*", "Throws", "an", "exception", "if", "times", "out", ",", "which", "should", "fail", "the", "client", "request", ".", "*", "@", "param", "the", "requested", "block", "*", "/", "void", "checkAndWaitForBP", "(", "final", "ExtendedBlock", "block", ")", "throws", "IOException", "{", "String", "bpId", "=", "block", ".", "getBlockPoolId", "(", ");", "/", "/", "The", "registration", "is", "only", "missing", "in", "relatively", "short", "time", "window", ".", "/", "/", "Optimistically", "perform", "this", "first", ".", "try", "{", "datanode", ".", "getDNRegistrationForBP", "(", "bpId", ")", ";", "return", ";", "}", "catch", "(", "IOException", "ioe", ")", "{", "/", "/", "not", "registered", "}", "/", "/", "retry", "long", "bpReadyTimeout", "=", "dnConf", ".", "getBpReadyTimeout", "(", ")", "*", "1000", ";", "long", "startTime", "=", "Time", ".", "monotonicNow", "(", ");", "while", "(", "Time", ".", "monotonicNow", "(", ")", "-", "startTime", "<", "=", "bpReadyTimeout", ")", "{", "try", "{", "datanode", ".", "getDNRegistrationForBP", "(", "bpId", ")", ";", "return", ";", "}", "catch", "(", "IOException", "ioe", ")", "{", "/", "/", "not", "registered", "}", "/", "/", "sleep", "before", "trying", "again", "try", "{", "Thread", ".", "sleep", "(", "1000", ")", ";", "}", "catch", "(", "InterruptedException", "ie", ")", "{", "throw", "new", "IOException", "(", "\"", "Interrupted", "while", "serving", "request", ".", "Aborting", ".", "\")", ";", "}", "}", "/", "/", "failed", "to", "obtain", "registration", ".", "throw", "new", "IOException", "(", "\"", "Not", "ready", "to", "serve", "the", "block", "pool", ",", "\"", "+", "bpId", "+", "\"", ".\"", ");", "}", "private", "void", "checkAccess", "(", "OutputStream", "out", ",", "final", "boolean", "reply", ",", "final", "ExtendedBlock", "blk", ",", "final", "Token", "<", "BlockTokenIdentifier", ">", "t", ",", "final", "Op", "op", ",", "final", "BlockTokenSecretManager", ".", "AccessMode", "mode", ")", "throws", "IOException", "{", "checkAndWaitForBP", "(", "blk", ")", ";", "if", "(", "datanode", ".", "isBlockTokenEnabled", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", "))", "{", "LOG", ".", "debug", "(", "\"", "Checking", "block", "access", "token", "for", "block", "'", "\"", "+", "blk", ".", "getBlockId", "(", ")", "@", "@", "-", "2224", ",", "4", "+", "2224", ",", "14", "@", "@", "<", "/", "description", ">", "<", "/", "property", ">", "<", "property", ">", "<", "name", ">", "dfs", ".", "datanode", ".", "bp", "-", "ready", ".", "timeout", "<", "/", "name", ">", "<", "value", ">", "20", "<", "/", "value", ">", "<", "description", ">", "The", "maximum", "wait", "time", "for", "datanode", "to", "be", "ready", "before", "failing", "the", "received", "request", ".", "Setting", "this", "to", "0", "fails", "requests", "right", "away", "if", "the", "datanode", "is", "not", "yet", "registered", "with", "the", "namenode", ".", "This", "wait", "time", "reduces", "initial", "request", "failures", "after", "datanode", "restart", ".", "<", "/", "description", ">", "<", "/", "property", ">", "<", "/", "configuration", ">", "@", "@", "-", "37", ",", "6", "+", "37", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "protocol", ".", "Block", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "common", ".", "HdfsServerConstants", ".", "ReplicaState", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "datanode", ".", "DataNode", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "datanode", ".", "DataNodeFaultInjector", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "datanode", ".", "DataNodeTestUtils", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "datanode", ".", "DatanodeUtil", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "datanode", ".", "ReplicaInfo", ";", "@", "@", "-", "211", ",", "4", "+", "212", ",", "76", "@", "@", "private", "static", "void", "createUnlinkTmpFile", "(", "ReplicaInfo", "replicaInfo", ",", "}", "}", "}", "@", "Test", "public", "void", "testWaitForRegistrationOnRestart", "(", ")", "throws", "Exception", "{", "Configuration", "conf", "=", "new", "HdfsConfiguration", "(", ");", "conf", ".", "setLong", "(", "DFSConfigKeys", ".", "DFS_DATANODE_BP_READY_TIMEOUT_KEY", ",", "5", ")", ";", "conf", ".", "setInt", "(", "DFSConfigKeys", ".", "DFS_CLIENT_SOCKET_TIMEOUT_KEY", ",", "5000", ")", ";", "/", "/", "This", "makes", "the", "datanode", "appear", "registered", "to", "the", "NN", ",", "but", "it", "won", "'", "t", "be", "/", "/", "able", "to", "get", "to", "the", "saved", "dn", "reg", "internally", ".", "DataNodeFaultInjector", "dnFaultInjector", "=", "new", "DataNodeFaultInjector", "(", ")", "{", "@", "Override", "public", "void", "noRegistration", "(", ")", "throws", "IOException", "{", "throw", "new", "IOException", "(", "\"", "no", "reg", "found", "for", "testing", "\"", ");", "}", "}", ";", "DataNodeFaultInjector", "oldDnInjector", "=", "DataNodeFaultInjector", ".", "get", "(", ");", "DataNodeFaultInjector", ".", "instance", "=", "dnFaultInjector", ";", "MiniDFSCluster", "cluster", "=", "null", ";", "long", "start", "=", "0", ";", "Path", "file", "=", "new", "Path", "(", "\"/", "reg", "\"", ");", "try", "{", "int", "numDNs", "=", "1", ";", "cluster", "=", "new", "MiniDFSCluster", ".", "Builder", "(", "conf", ")", ".", "numDataNodes", "(", "numDNs", ")", ".", "build", "(", ");", "cluster", ".", "waitActive", "(", ");", "start", "=", "System", ".", "currentTimeMillis", "(", ");", "FileSystem", "fileSys", "=", "cluster", ".", "getFileSystem", "(", ");", "try", "{", "DFSTestUtil", ".", "createFile", "(", "fileSys", ",", "file", ",", "10240L", ",", "(", "short", ")", "1", ",", "0L", ")", ";", "/", "/", "It", "is", "a", "bug", "if", "this", "does", "not", "fail", ".", "throw", "new", "IOException", "(", "\"", "Did", "not", "fail", "!", "\")", ";", "}", "catch", "(", "org", ".", "apache", ".", "hadoop", ".", "ipc", ".", "RemoteException", "e", ")", "{", "long", "elapsed", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "start", ";", "/", "/", "timers", "have", "at", "-", "least", "semantics", ",", "so", "it", "should", "be", "at", "least", "5", "seconds", ".", "if", "(", "elapsed", "<", "5000", "|", "|", "elapsed", ">", "10000", ")", "{", "throw", "new", "IOException", "(", "elapsed", "+", "\"", "seconds", "passed", ".", "\",", "e", ")", ";", "}", "}", "DataNodeFaultInjector", ".", "instance", "=", "oldDnInjector", ";", "/", "/", "this", "should", "succeed", "now", ".", "DFSTestUtil", ".", "createFile", "(", "fileSys", ",", "file", ",", "10240L", ",", "(", "short", ")", "1", ",", "0L", ")", ";", "/", "/", "turn", "it", "back", "to", "under", "-", "construction", ",", "so", "that", "the", "client", "calls", "/", "/", "getReplicaVisibleLength", "(", ")", "rpc", "method", "against", "the", "datanode", ".", "fileSys", ".", "append", "(", "file", ")", ";", "/", "/", "back", "to", "simulating", "unregistered", "node", ".", "DataNodeFaultInjector", ".", "instance", "=", "dnFaultInjector", ";", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "8", "]", ";", "start", "=", "System", ".", "currentTimeMillis", "(", ");", "try", "{", "fileSys", ".", "open", "(", "file", ")", ".", "read", "(", "0L", ",", "buffer", ",", "0", ",", "1", ")", ";", "throw", "new", "IOException", "(", "\"", "Did", "not", "fail", "!", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "long", "elapsed", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "start", ";", "if", "(", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "readBlockLength", "\"", "))", "{", "throw", "new", "IOException", "(", "\"", "Failed", ",", "but", "with", "unexpected", "exception", ":", "\",", "e", ")", ";", "}", "/", "/", "timers", "have", "at", "-", "least", "semantics", ",", "so", "it", "should", "be", "at", "least", "5", "seconds", ".", "if", "(", "elapsed", "<", "5000", "|", "|", "elapsed", ">", "10000", ")", "{", "throw", "new", "IOException", "(", "elapsed", "+", "\"", "seconds", "passed", ".", "\",", "e", ")", ";", "}", "}", "DataNodeFaultInjector", ".", "instance", "=", "oldDnInjector", ";", "fileSys", ".", "open", "(", "file", ")", ".", "read", "(", "0L", ",", "buffer", ",", "0", ",", "1", ")", ";", "}", "finally", "{", "DataNodeFaultInjector", ".", "instance", "=", "oldDnInjector", ";", "if", "(", "cluster", "!", "=", "null", ")", "{", "cluster", ".", "shutdown", "(", ");", "}", "}", "}", "}"], "docstring_tokens": ["by", "guessing", "certain", "fields", "in", "the", "token", "."]}
{"contents": ["[RESTEASY-2781]", "Clients", "running", "in", "a", "resource", "method", "throw", "safer", "WebApplicationException", "(#2632)", "[RESTEASY-2781]", "Removed", "smallrye", "reference", "from", "resteasy-client-api", "POM."], "code_tokens": ["@", "@", "-", "132", ",", "6", "+", "132", ",", "106", "@", "@", "If", "there", "is", "an", "ExceptionMapper", "for", "wrapped", "exception", ",", "then", "that", "is", "used", "to", "handl", "<", "/", "tgroup", ">", "<", "/", "table", ">", "<", "/", "sect1", ">", "<", "sect1", "id", "=", "\"", "ResteasyWebApplicationException", "\"", ">", "<", "title", ">", "Resteasy", "WebApplicationExceptions", "<", "/", "title", ">", "<", "para", ">", "Suppose", "a", "client", "at", "local", ".", "com", "calls", "the", "following", "resource", "method", ":", "</", "para", ">", "<", "programlisting", ">", "@", "GET", "@", "Path", "(", "\"", "remote", "\"", ")", "public", "String", "remote", "(", ")", "throws", "Exception", "{", "Client", "client", "=", "ClientBuilder", ".", "newClient", "(", ");", "return", "client", ".", "target", "(", "\"", "http", ":", "//", "third", ".", "party", ".", "com", "/", "exception", "\"", ").", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "}", "<", "/", "programlisting", ">", "<", "para", ">", "If", "the", "call", "to", "http", ":", "//", "third", ".", "party", ".", "com", "returns", "a", "status", "code", "3xx", ",", "4xx", ",", "or", "5xx", ",", "then", "the", "<", "classname", ">", "Client", "<", "/", "classname", ">", "is", "obliged", "by", "the", "JAX", "-", "RS", "specification", "to", "throw", "a", "<", "classname", ">", "WebApplicationException", "<", "/", "classname", ">", ".", "Moreover", ",", "if", "the", "<", "classname", ">", "WebApplicationException", "<", "/", "classname", ">", "contains", "a", "<", "classname", ">", "Response", "<", "/", "classname", ">", ",", "which", "it", "normally", "would", "in", "RESTEasy", ",", "the", "server", "runtime", "is", "obliged", "by", "the", "JAX", "-", "RS", "specification", "to", "return", "that", "<", "classname", ">", "Response", "<", "/", "classname", ">", ".", "As", "a", "result", ",", "information", "from", "the", "server", "at", "third", ".", "party", ".", "com", ",", "e", ".", "g", ".", ",", "headers", "and", "body", ",", "will", "get", "sent", "back", "to", "local", ".", "com", ".", "The", "problem", "is", "that", "that", "information", "could", "be", ",", "at", "best", ",", "meaningless", "to", "the", "client", "and", ",", "at", "worst", ",", "a", "security", "breach", ".", "</", "para", ">", "<", "para", ">", "RESTEasy", "has", "a", "solution", "that", "works", "around", "the", "problem", "and", "still", "conforms", "to", "the", "JAX", "-", "RS", "specification", ".", "In", "particular", ",", "for", "each", "<", "classname", ">", "WebApplicationException", "<", "/", "classname", ">", "it", "defines", "a", "new", "subclass", ":", "</", "para", ">", "<", "programlisting", ">", "WebApplicationException", "-", "ResteasyWebApplicationException", "-", "ClientErrorException", "|", "+", "-", "ResteasyClientErrorException", "|", "+", "-", "BadRequestException", "|", "|", "+", "-", "ResteasyBadRequestException", "|", "+", "-", "ForbiddenException", "|", "|", "+", "-", "ResteasyForbiddenException", "|", "+", "-", "NotAcceptableException", "|", "|", "+", "-", "ResteasyNotAcceptableException", "|", "+", "-", "NotAllowedException", "|", "|", "+", "-", "ResteasyNotAllowedException", "|", "+", "-", "NotAuthorizedException", "|", "|", "+", "-", "ResteasyNotAuthorizedException", "|", "+", "-", "NotFoundException", "|", "|", "+", "-", "ResteasyNotFoundException", "|", "+", "-", "NotSupportedException", "|", "|", "+", "-", "ResteasyNotSupportedException", "-", "RedirectionException", "|", "+", "-", "ResteasyRedirectionException", "-", "ServerErrorException", "|", "+", "-", "ResteasyServerErrorException", "|", "+", "-", "InternalServerErrorException", "|", "|", "+", "-", "ResteasyInternalServerErrorException", "|", "+", "-", "ServiceUnavailableException", "|", "|", "+", "-", "ResteasyServiceUnavailableException", "<", "/", "programlisting", ">", "<", "para", ">", "The", "new", "<", "classname", ">", "Exception", "<", "/", "classname", ">", "s", "play", "the", "same", "role", "as", "the", "original", "ones", ",", "but", "RESTEasy", "treats", "them", "slightly", "differently", ".", "When", "a", "<", "classname", ">", "Client", "<", "/", "classname", ">", "detects", "that", "it", "is", "running", "in", "the", "context", "of", "a", "resource", "method", ",", "it", "will", "throw", "one", "of", "the", "new", "<", "classname", ">", "Exception", "<", "/", "classname", ">", "s", ".", "However", ",", "instead", "of", "storing", "the", "original", "<", "classname", ">", "Response", "<", "/", "classname", ">", ",", "it", "stores", "a", "\"", "sanitized", "\"", "version", "of", "the", "<", "classname", ">", "Response", "<", "/", "classname", ">", ",", "in", "which", "only", "the", "status", "and", "the", "Allow", "and", "Content", "-", "Type", "headers", "are", "preserved", ".", "The", "original", "<", "classname", ">", "WebApplicationException", "<", "/", "classname", ">", ",", "and", "therefore", "the", "original", "<", "classname", ">", "Response", "<", "/", "classname", ">", ",", "can", "be", "accessed", "in", "one", "of", "two", "ways", ":", "</", "para", ">", "<", "programlisting", ">", "/", "/", "Create", "a", "NotAcceptableException", ".", "NotAcceptableException", "nae", "=", "new", "NotAcceptableException", "(", "Response", ".", "status", "(", "406", ")", ".", "entity", "(", "\"", "ooops", "\"", ").", "build", "(", "))", ";", "/", "/", "Wrap", "the", "NotAcceptableException", "in", "a", "ResteasyNotAcceptableException", ".", "ResteasyNotAcceptableException", "rnae", "=", "(", "ResteasyNotAcceptableException", ")", "WebApplicationExceptionWrapper", ".", "wrap", "(", "nae", ")", ";", "/", "/", "Extract", "the", "original", "NotAcceptableException", "using", "instance", "method", ".", "NotAcceptableException", "nae2", "=", "rnae", ".", "unwrap", "(", ");", "Assert", ".", "assertEquals", "(", "nae", ",", "nae2", ")", ";", "/", "/", "Extract", "the", "original", "NotAcceptableException", "using", "class", "method", ".", "NotAcceptableException", "nae3", "=", "(", "NotAcceptableException", ")", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "nae", ")", ";", "/", "/", "second", "way", "Assert", ".", "assertEquals", "(", "nae", ",", "nae3", ")", ";", "<", "/", "programlisting", ">", "<", "para", ">", "Note", "that", "this", "change", "is", "intended", "to", "introduce", "a", "safe", "default", "behavior", "in", "the", "case", "that", "the", "<", "classname", ">", "Exception", "<", "/", "classname", ">", "generated", "by", "the", "remote", "call", "is", "allowed", "to", "make", "its", "way", "up", "to", "the", "server", "runtime", ".", "It", "is", "considered", "a", "good", "practice", ",", "though", ",", "to", "catch", "the", "<", "classname", ">", "Exception", "<", "/", "classname", ">", "and", "treat", "it", "in", "some", "appropriate", "manner", ":", "</", "para", ">", "<", "programlisting", ">", "@", "GET", "@", "Path", "(", "\"", "remote", "/", "{", "i", "}", "\")", "public", "String", "remote", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "String", "i", ")", "throws", "Exception", "{", "Client", "client", "=", "ClientBuilder", ".", "newClient", "(", ");", "try", "{", "return", "client", ".", "target", "(", "\"", "http", ":", "//", "remote", ".", "com", "/", "exception", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "}", "catch", "(", "WebApplicationException", "wae", ")", "{", ".", "..", "}", "}", "<", "/", "programlisting", ">", "<", "para", ">", "<", "emphasis", "role", "=", "\"", "bold", "\"", ">", "Note", ".", "</", "emphasis", ">", "While", "RESTEasy", "will", "default", "to", "the", "new", ",", "safer", "behavior", ",", "the", "original", "behavior", "can", "be", "restored", "by", "setting", "the", "configuration", "parameter", "\"", "resteasy", ".", "original", ".", "webapplicationexception", ".", "behavior", "\"", "to", "\"", "true", "\"", ".<", "/", "para", ">", "<", "/", "sect1", ">", "<", "sect1", "id", "=", "\"", "overring_resteasy_exceptions", "\"", ">", "<", "title", ">", "Overriding", "RESTEasy", "Builtin", "Exceptions", "<", "/", "title", ">", "<", "para", ">", "You", "may", "override", "RESTEasy", "built", "-", "in", "exceptions", "by", "writing", "an", "ExceptionMapper", "for", "the", "exception", ".", "For", "that", "matter", ",", "you", "can", "write", "an", "ExceptionMapper", "@", "@", "-", "893", ",", "6", "+", "893", ",", "20", "@", "@", "String", "s", "=", "config", ".", "getOptionalValue", "(", "\"", "prop_name", "\"", ",", "String", ".", "class", ")", ".", "orElse", "(", "\"", "d", "'", "oh", "\"", ");", "patch", "request", "instead", ".", "<", "/", "entry", ">", "<", "/", "row", ">", "<", "row", ">", "<", "entry", ">", "resteasy", ".", "original", ".", "webapplicationexception", ".", "behavior", "<", "/", "entry", ">", "<", "entry", ">", "false", "<", "/", "entry", ">", "<", "entry", ">", "When", "set", "to", "\"", "true", "\"", ",", "this", "parameter", "will", "restore", "the", "original", "behavior", "in", "which", "a", "Client", "running", "in", "a", "resource", "method", "will", "throw", "a", "JAX", "-", "RS", "WebApplicationException", "instead", "of", "a", "Resteasy", "version", "with", "a", "sanitized", "<", "classname", ">", "Response", "<", "/", "classname", ">", ".", "For", "more", "information", ",", "see", "section", "<", "link", "linkend", "=", "'", "ResteasyWebApplicationException", "'", ">", "Resteasy", "WebApplicationExceptions", "<", "/", "link", ">", "<", "/", "entry", ">", "<", "/", "row", ">", "<", "/", "tbody", ">", "<", "/", "tgroup", ">", "<", "/", "table", ">", "@", "@", "-", "45", ",", "6", "+", "45", ",", "11", "@", "@", "<", "artifactId", ">", "jakarta", ".", "json", "<", "/", "artifactId", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "eclipse", ".", "microprofile", ".", "config", "<", "/", "groupId", ">", "<", "artifactId", ">", "microprofile", "-", "config", "-", "api", "<", "/", "artifactId", ">", "<", "scope", ">", "compile", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "profiles", ">", "<", "profile", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "BadRequestException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "BadRequestException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyBadRequestException", "extends", "BadRequestException", "implements", "WebApplicationExceptionWrapper", "<", "BadRequestException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "6250430572164780061L", ";", "private", "final", "BadRequestException", "wrapped", ";", "ResteasyBadRequestException", "(", "final", "BadRequestException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "BadRequestException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "28", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ClientErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "ClientErrorException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyClientErrorException", "extends", "ClientErrorException", "implements", "WebApplicationExceptionWrapper", "<", "ClientErrorException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "6839671465938091898L", ";", "private", "final", "ClientErrorException", "wrapped", ";", "ResteasyClientErrorException", "(", "final", "ClientErrorException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "ClientErrorException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ForbiddenException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "ForbiddenException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyForbiddenException", "extends", "ForbiddenException", "implements", "WebApplicationExceptionWrapper", "<", "ForbiddenException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "581285336820307590L", ";", "private", "final", "ForbiddenException", "wrapped", ";", "ResteasyForbiddenException", "(", "final", "ForbiddenException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "ForbiddenException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "InternalServerErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "InternalServerErrorException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyInternalServerErrorException", "extends", "InternalServerErrorException", "implements", "WebApplicationExceptionWrapper", "<", "InternalServerErrorException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "5293921582428847923L", ";", "private", "final", "InternalServerErrorException", "wrapped", ";", "ResteasyInternalServerErrorException", "(", "final", "InternalServerErrorException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "InternalServerErrorException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAcceptableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "NotAcceptableException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyNotAcceptableException", "extends", "NotAcceptableException", "implements", "WebApplicationExceptionWrapper", "<", "NotAcceptableException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "5369100091818187044L", ";", "private", "final", "NotAcceptableException", "wrapped", ";", "ResteasyNotAcceptableException", "(", "final", "NotAcceptableException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "NotAcceptableException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAllowedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "NotAllowedException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyNotAllowedException", "extends", "NotAllowedException", "implements", "WebApplicationExceptionWrapper", "<", "NotAllowedException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "6319306078354018353L", ";", "private", "final", "NotAllowedException", "wrapped", ";", "ResteasyNotAllowedException", "(", "final", "NotAllowedException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "NotAllowedException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "34", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAuthorizedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "NotAuthorizedException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyNotAuthorizedException", "extends", "NotAuthorizedException", "implements", "WebApplicationExceptionWrapper", "<", "NotAuthorizedException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "7034604450379314101L", ";", "private", "final", "NotAuthorizedException", "wrapped", ";", "ResteasyNotAuthorizedException", "(", "final", "NotAuthorizedException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "List", "<", "Object", ">", "getChallenges", "(", ")", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "@", "Override", "public", "NotAuthorizedException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotFoundException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "NotFoundException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyNotFoundException", "extends", "NotFoundException", "implements", "WebApplicationExceptionWrapper", "<", "NotFoundException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "8915809730318765630L", ";", "private", "final", "NotFoundException", "wrapped", ";", "ResteasyNotFoundException", "(", "final", "NotFoundException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "NotFoundException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotSupportedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "NotSupportedException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyNotSupportedException", "extends", "NotSupportedException", "implements", "WebApplicationExceptionWrapper", "<", "NotSupportedException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "6195843283913647466L", ";", "private", "final", "NotSupportedException", "wrapped", ";", "ResteasyNotSupportedException", "(", "final", "NotSupportedException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "NotSupportedException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "33", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "javax", ".", "ws", ".", "rs", ".", "RedirectionException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "RedirectionException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyRedirectionException", "extends", "RedirectionException", "implements", "WebApplicationExceptionWrapper", "<", "RedirectionException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "8815768802777099877L", ";", "private", "final", "RedirectionException", "wrapped", ";", "ResteasyRedirectionException", "(", "final", "RedirectionException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ");", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "URI", "getLocation", "(", ")", "{", "return", "wrapped", ".", "getLocation", "(", ");", "}", "@", "Override", "public", "RedirectionException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ServerErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "ServerErrorException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyServerErrorException", "extends", "ServerErrorException", "implements", "WebApplicationExceptionWrapper", "<", "ServerErrorException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "8591476266091129117L", ";", "private", "final", "ServerErrorException", "wrapped", ";", "ResteasyServerErrorException", "(", "final", "ServerErrorException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "ServerErrorException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "38", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ServiceUnavailableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "ServiceUnavailableException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyServiceUnavailableException", "extends", "ServiceUnavailableException", "implements", "WebApplicationExceptionWrapper", "<", "ServiceUnavailableException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "4477873328299557209L", ";", "private", "final", "ServiceUnavailableException", "wrapped", ";", "ResteasyServiceUnavailableException", "(", "final", "ServiceUnavailableException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ",", "wrapped", ".", "getCause", "(", "))", ";", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "boolean", "hasRetryAfter", "(", ")", "{", "return", "wrapped", ".", "hasRetryAfter", "(", ");", "}", "@", "Override", "public", "Date", "getRetryTime", "(", "final", "Date", "requestTime", ")", "{", "return", "wrapped", ".", "getRetryTime", "(", "requestTime", ")", ";", "}", "@", "Override", "public", "ServiceUnavailableException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "33", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "static", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ".", "sanitize", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "/", "**", "*", "Wraps", "a", "{", "@", "link", "WebApplicationException", "}", "with", "a", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", "response", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "class", "ResteasyWebApplicationException", "extends", "WebApplicationException", "implements", "WebApplicationExceptionWrapper", "<", "WebApplicationException", ">", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "8805699073882024461L", ";", "private", "final", "WebApplicationException", "wrapped", ";", "/", "**", "*", "Creates", "a", "new", "exception", "based", "on", "the", "wrapped", "exception", ".", "The", "response", "will", "be", "*", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", ".", "*", "*", "@", "param", "wrapped", "the", "exception", "to", "wrap", "*", "/", "public", "ResteasyWebApplicationException", "(", "final", "WebApplicationException", "wrapped", ")", "{", "super", "(", "wrapped", ".", "getMessage", "(", "),", "wrapped", ".", "getCause", "(", "),", "sanitize", "(", "wrapped", ".", "getResponse", "(", "))", ");", "this", ".", "wrapped", "=", "wrapped", ";", "}", "@", "Override", "public", "WebApplicationException", "unwrap", "(", ")", "{", "return", "wrapped", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "151", "@", "@", "/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", ".", "*", "*", "Copyright", "2020", "Red", "Hat", ",", "Inc", ".", ",", "and", "individual", "contributors", "*", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ";", "import", "javax", ".", "ws", ".", "rs", ".", "BadRequestException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ClientErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ForbiddenException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "InternalServerErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAcceptableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAllowedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAuthorizedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotFoundException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotSupportedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "RedirectionException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ServerErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ServiceUnavailableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MediaType", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "eclipse", ".", "microprofile", ".", "config", ".", "Config", ";", "import", "org", ".", "eclipse", ".", "microprofile", ".", "config", ".", "ConfigProvider", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ResteasyDeployment", ";", "/", "**", "*", "An", "interface", "which", "allows", "a", "{", "@", "link", "WebApplicationException", "}", "to", "be", "unwrapped", ".", "*", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "jperkins", "@", "redhat", ".", "com", "\"", ">", "James", "R", ".", "Perkins", "<", "/", "a", ">", "*", "/", "public", "interface", "WebApplicationExceptionWrapper", "<", "T", "extends", "WebApplicationException", ">", "{", "/", "**", "*", "If", "the", "{", "@", "code", "resteasy", ".", "original", ".", "webapplicationexception", ".", "behavior", "}", "is", "set", "to", "{", "@", "code", "true", "}", "or", "the", "request", "is", "*", "determined", "to", "not", "be", "a", "server", "side", "request", ",", "then", "the", "{", "@", "link", "WebApplicationException", "}", "passed", "in", "will", "be", "returned", ".", "*", "If", "the", "property", "is", "not", "set", "to", "{", "@", "code", "true", "}", "and", "this", "is", "a", "server", "side", "request", "then", "the", "exception", "is", "wrapped", "and", "*", "the", "response", "is", "{", "@", "linkplain", "#", "sanitize", "(", "Response", ")", "sanitized", "}", ".", "*", "*", "@", "param", "e", "the", "exception", "to", "possibly", "wrapped", "*", "*", "@", "return", "the", "wrapped", "exception", "or", "the", "original", "exception", "if", "the", "exception", "has", "already", "been", "wrapped", "the", "the", "*", "wrapping", "feature", "is", "turned", "off", "*", "/", "static", "WebApplicationException", "wrap", "(", "final", "WebApplicationException", "e", ")", "{", "final", "Config", "config", "=", "ConfigProvider", ".", "getConfig", "(", ");", "final", "boolean", "originalBehavior", "=", "config", ".", "getOptionalValue", "(", "\"", "resteasy", ".", "original", ".", "webapplicationexception", ".", "behavior", "\"", ",", "boolean", ".", "class", ")", ".", "orElse", "(", "false", ")", ";", "final", "boolean", "serverSide", "=", "ResteasyDeployment", ".", "onServer", "(", ");", "if", "(", "originalBehavior", "|", "|", "!", "serverSide", ")", "{", "return", "e", ";", "}", "if", "(", "e", "instanceof", "WebApplicationExceptionWrapper", ")", "{", "return", "e", ";", "}", "if", "(", "e", "instanceof", "BadRequestException", ")", "{", "return", "new", "ResteasyBadRequestException", "(", "(", "BadRequestException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "NotAuthorizedException", ")", "{", "return", "new", "ResteasyNotAuthorizedException", "(", "(", "NotAuthorizedException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "ForbiddenException", ")", "{", "return", "new", "ResteasyForbiddenException", "(", "(", "ForbiddenException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "NotFoundException", ")", "{", "return", "new", "ResteasyNotFoundException", "(", "(", "NotFoundException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "NotAllowedException", ")", "{", "return", "new", "ResteasyNotAllowedException", "(", "(", "NotAllowedException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "NotAcceptableException", ")", "{", "return", "new", "ResteasyNotAcceptableException", "(", "(", "NotAcceptableException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "NotSupportedException", ")", "{", "return", "new", "ResteasyNotSupportedException", "(", "(", "NotSupportedException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "InternalServerErrorException", ")", "{", "return", "new", "ResteasyInternalServerErrorException", "(", "(", "InternalServerErrorException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "ServiceUnavailableException", ")", "{", "return", "new", "ResteasyServiceUnavailableException", "(", "(", "ServiceUnavailableException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "ClientErrorException", ")", "{", "return", "new", "ResteasyClientErrorException", "(", "(", "ClientErrorException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "ServerErrorException", ")", "{", "return", "new", "ResteasyServerErrorException", "(", "(", "ServerErrorException", ")", "e", ")", ";", "}", "if", "(", "e", "instanceof", "RedirectionException", ")", "{", "return", "new", "ResteasyRedirectionException", "(", "(", "RedirectionException", ")", "e", ")", ";", "}", "return", "new", "ResteasyWebApplicationException", "(", "e", ")", ";", "}", "/", "**", "*", "Unwraps", "the", "exception", "if", "the", "passed", "in", "expression", "is", "a", "{", "@", "link", "WebApplicationExceptionWrapper", "}", ".", "Otherwise", "*", "the", "exception", "passed", "in", "is", "returned", ".", "*", "*", "@", "param", "e", "the", "exception", "to", "unwrap", "*", "*", "@", "return", "the", "unwrapped", "exception", "or", "the", "exception", "parameter", "itself", "if", "it", "was", "not", "a", "{", "@", "link", "WebApplicationExceptionWrapper", "}", "*", "/", "static", "WebApplicationException", "unwrap", "(", "final", "WebApplicationException", "e", ")", "{", "if", "(", "e", "instanceof", "WebApplicationExceptionWrapper", ")", "{", "return", "(", "(", "WebApplicationExceptionWrapper", "<", "?>", ")", "e", ")", ".", "unwrap", "(", ");", "}", "return", "e", ";", "}", "/", "**", "*", "Sanitizes", "the", "response", "by", "creating", "a", "new", "response", "with", "only", "the", "status", "code", ",", "allowed", "methods", ",", "entity", "and", "the", "*", "media", "type", ".", "All", "other", "information", "is", "removed", ".", "*", "*", "@", "param", "response", "the", "response", "to", "sanitize", ".", "*", "*", "@", "return", "the", "new", "response", "*", "/", "static", "Response", "sanitize", "(", "final", "Response", "response", ")", "{", "MediaType", "mediaType", "=", "response", ".", "getMediaType", "(", ");", "if", "(", "mediaType", "=", "=", "null", ")", "{", "/", "/", "Use", "a", "default", "media", "type", "if", "not", "set", "mediaType", "=", "MediaType", ".", "APPLICATION_OCTET_STREAM_TYPE", ";", "}", "return", "Response", ".", "status", "(", "response", ".", "getStatus", "(", "))", ".", "allow", "(", "response", ".", "getAllowedMethods", "(", "))", ".", "type", "(", "mediaType", ")", ".", "build", "(", ");", "}", "/", "**", "*", "Returns", "the", "original", ",", "unwrapped", ",", "exception", ".", "*", "*", "@", "return", "the", "original", "exception", "*", "/", "T", "unwrap", "(", ");", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "11", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "microprofile", ".", "client", ";", "import", "org", ".", "eclipse", ".", "microprofile", ".", "config", ".", "Config", ";", "import", "org", ".", "eclipse", ".", "microprofile", ".", "config", ".", "ConfigProvider", ";", "import", "org", ".", "eclipse", ".", "microprofile", ".", "rest", ".", "client", ".", "ext", ".", "ResponseExceptionMapper", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ResteasyDeployment", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MultivaluedMap", ";", "@", "@", "-", "13", ",", "12", "+", "18", ",", "15", "@", "@", "public", "Throwable", "toThrowable", "(", "Response", "response", ")", "{", "try", "{", "response", ".", "bufferEntity", "(", ");", "}", "catch", "(", "Exception", "ignored", ")", "{", "}", "return", "new", "WebApplicationException", "(", "\"", "Unknown", "error", ",", "status", "code", "\"", "+", "response", ".", "getStatus", "(", "),", "response", ")", ";", "return", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "WebApplicationException", "(", "\"", "Unknown", "error", ",", "status", "code", "\"", "+", "response", ".", "getStatus", "(", "),", "response", ")", ");", "}", "@", "Override", "public", "boolean", "handles", "(", "int", "status", ",", "MultivaluedMap", "headers", ")", "{", "return", "status", ">", "=", "400", ";", "final", "Config", "config", "=", "ConfigProvider", ".", "getConfig", "(", ");", "final", "boolean", "originalBehavior", "=", "config", ".", "getOptionalValue", "(", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ",", "boolean", ".", "class", ")", ".", "orElse", "(", "false", ")", ";", "final", "boolean", "serverSide", "=", "ResteasyDeployment", ".", "onServer", "(", ");", "return", "status", ">", "=", "(", "originalBehavior", "|", "|", "!", "serverSide", "?", "400", ":", "300", ")", ";", "}", "@", "Override", "@", "@", "-", "43", ",", "6", "+", "43", ",", "7", "@", "@", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "Providers", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "WriterInterceptor", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ClientHttpEngine", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClient", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "engines", ".", "AsyncClientHttpEngine", ";", "@", "@", "-", "230", ",", "7", "+", "231", ",", "9", "@", "@", "protected", "ClientInvocation", "(", "final", "ClientInvocation", "clientInvocation", ")", "}", "}", "if", "(", "status", ">", "=", "300", "&", "&", "status", "<", "400", ")", "throw", "new", "RedirectionException", "(", "response", ")", ";", "{", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "RedirectionException", "(", "response", ")", ");", "}", "return", "handleErrorStatus", "(", "response", ")", ";", "}", "@", "@", "-", "256", ",", "33", "+", "259", ",", "33", "@", "@", "protected", "ClientInvocation", "(", "final", "ClientInvocation", "clientInvocation", ")", "switch", "(", "status", ")", "{", "case", "400", ":", "throw", "new", "BadRequestException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "BadRequestException", "(", "response", ")", ");", "case", "401", ":", "throw", "new", "NotAuthorizedException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "NotAuthorizedException", "(", "response", ")", ");", "case", "403", ":", "throw", "new", "ForbiddenException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "ForbiddenException", "(", "response", ")", ");", "case", "404", ":", "throw", "new", "NotFoundException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "NotFoundException", "(", "response", ")", ");", "case", "405", ":", "throw", "new", "NotAllowedException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "NotAllowedException", "(", "response", ")", ");", "case", "406", ":", "throw", "new", "NotAcceptableException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "NotAcceptableException", "(", "response", ")", ");", "case", "415", ":", "throw", "new", "NotSupportedException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "NotSupportedException", "(", "response", ")", ");", "case", "500", ":", "throw", "new", "InternalServerErrorException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "InternalServerErrorException", "(", "response", ")", ");", "case", "503", ":", "throw", "new", "ServiceUnavailableException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "ServiceUnavailableException", "(", "response", ")", ");", "default", ":", "break", ";", "}", "if", "(", "status", ">", "=", "400", "&", "&", "status", "<", "500", ")", "throw", "new", "ClientErrorException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "ClientErrorException", "(", "response", ")", ");", "if", "(", "status", ">", "=", "500", ")", "throw", "new", "ServerErrorException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "ServerErrorException", "(", "response", ")", ");", "throw", "new", "WebApplicationException", "(", "response", ")", ";", "throw", "WebApplicationExceptionWrapper", ".", "wrap", "(", "new", "WebApplicationException", "(", "response", ")", ");", "}", "public", "ClientConfiguration", "getClientConfiguration", "(", ")", "@", "@", "-", "14", ",", "6", "+", "14", ",", "11", "@", "@", "@", "SuppressWarnings", "(", "\"", "rawtypes", "\"", ")", "public", "interface", "ResteasyDeployment", "{", "static", "boolean", "onServer", "(", ")", "{", "return", "ResteasyProviderFactory", ".", "getInstance", "(", ").", "isOnServer", "(", ");", "}", "void", "start", "(", ");", "void", "merge", "(", "ResteasyDeployment", "other", ")", ";", "@", "@", "-", "354", ",", "4", "+", "354", ",", "6", "@", "@", "public", "abstract", "MediaType", "getConcreteMediaTypeFromMessageBodyWriters", "(", "Class", "<", "?>", "ty", "public", "abstract", "void", "initializeClientProviders", "(", "ResteasyProviderFactory", "factory", ")", ";", "public", "abstract", "StatisticsController", "getStatisticsController", "(", ");", "protected", "abstract", "boolean", "isOnServer", "(", ");", "}", "@", "@", "-", "98", ",", "4", "+", "98", ",", "16", "@", "@", "public", "static", "void", "removeContextDataLevel", "(", ")", "contextualData", ".", "pop", "(", ");", "}", "public", "static", "Object", "searchContextData", "(", "Object", "o", ")", "{", "for", "(", "int", "i", "=", "contextualData", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "{", "Map", "<", "Class", "<", "?>", ",", "Object", ">", "map", "=", "contextualData", ".", "get", "(", "i", ")", ";", "if", "(", "map", ".", "containsKey", "(", "o", ")", ")", "{", "return", "map", ".", "get", "(", "o", ")", ";", "}", "}", "return", "null", ";", "}", "}", "@", "@", "-", "59", ",", "11", "+", "59", ",", "11", "@", "@", "public", "class", "ResteasyProviderFactoryDelegate", "extends", "ResteasyProviderFactory", "{", "private", "final", "ResteasyProviderFactory", "resteasyProviderFactoryDelegator", ";", "private", "final", "ResteasyProviderFactoryImpl", "resteasyProviderFactoryDelegator", ";", "public", "ResteasyProviderFactoryDelegate", "(", "final", "ResteasyProviderFactory", "resteasyProviderFactoryDelegator", ")", "{", "this", ".", "resteasyProviderFactoryDelegator", "=", "Objects", ".", "requireNonNull", "(", "resteasyProviderFactoryDelegator", ")", ";", "this", ".", "resteasyProviderFactoryDelegator", "=", "Objects", ".", "requireNonNull", "(", "(", "ResteasyProviderFactoryImpl", ")", "resteasyProviderFactoryDelegator", ")", ";", "}", "@", "Override", "@", "@", "-", "631", ",", "4", "+", "631", ",", "8", "@", "@", "public", "StatisticsController", "getStatisticsController", "(", ")", "return", "resteasyProviderFactoryDelegator", ".", "getStatisticsController", "(", ");", "}", "@", "Override", "protected", "boolean", "isOnServer", "(", ")", "{", "return", "resteasyProviderFactoryDelegator", ".", "isOnServer", "(", ");", "}", "}", "@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "AsyncStreamProvider", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ConstructorInjector", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ContextInjector", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "Dispatcher", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "HeaderValueProcessor", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "HttpRequest", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "HttpResponse", ";", "@", "@", "-", "1741", ",", "4", "+", "1742", ",", "9", "@", "@", "public", "void", "injectProperties", "(", "Object", "obj", ",", "HttpRequest", "request", ",", "HttpResponse", "respo", "public", "StatisticsController", "getStatisticsController", "(", ")", "{", "return", "statisticsController", ";", "}", "@", "Override", "protected", "boolean", "isOnServer", "(", ")", "{", "return", "ResteasyContext", ".", "searchContextData", "(", "Dispatcher", ".", "class", ")", "!", "=", "null", ";", "}", "}", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "String", "RESTEASY_SECURE_RANDOM_MAX_USE", "=", "\"", "resteasy", ".", "secure", ".", "random", ".", "max", ".", "use", "\"", ";", "String", "RESTEASY_ADD_CHARSET", "=", "\"", "resteasy", ".", "add", ".", "charset", "\"", ";", "String", "RESTEASY_DISABLE_HTML_SANITIZER", "=", "\"", "resteasy", ".", "disable", ".", "html", ".", "sanitizer", "\"", ";", "String", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "=", "\"", "resteasy", ".", "original", ".", "webapplicationexception", ".", "behavior", "\"", ";", "/", "**", "*", "Enable", "tracing", "support", ".", "@", "@", "-", "71", ",", "4", "+", "71", ",", "18", "@", "@", "public", "void", "clear", "(", ")", "{", "local", ".", "set", "(", "null", ")", ";", "}", "public", "T", "get", "(", "int", "i", ")", "{", "ArrayList", "<", "T", ">", "stack", "=", "getStack", "(", "false", ")", ";", "if", "(", "stack", "=", "=", "null", ")", "{", "return", "null", ";", "}", "if", "(", "i", "<", "0", "|", "|", "i", ">", "size", "(", "))", "{", "return", "null", ";", "}", "return", "stack", ".", "get", "(", "i", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "595", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "javax", ".", "ws", ".", "rs", ".", "RedirectionException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "eclipse", ".", "microprofile", ".", "rest", ".", "client", ".", "RestClientBuilder", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "Deployment", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "RunAsClient", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "junit", ".", "Arquillian", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyWebApplicationException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionMicroProfileProxyApplication", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionMicroProfileProxyResource", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionProxyResourceInterface", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "PortProviderUtil", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "TestUtil", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "Archive", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "asset", ".", "EmptyAsset", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "spec", ".", "WebArchive", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "/", "**", "*", "@", "tpSubChapter", "Resteasy", "-", "client", "*", "@", "tpChapter", "Client", "throws", "ResteasyWebApplicationException", "on", "server", "side", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "@", "tpTestCaseDetails", "Test", "WebApplicationExceptions", "and", "WebApplicationExceptionWrappers", "in", "various", "circumstances", ",", "*", "calls", "made", "by", "MicroProfile", "REST", "Client", "proxies", ".", "*", "*", "NOTE", ".", "Unlike", "RESTEasy", "Clients", "and", "RESTEasy", "Client", "proxies", ",", "which", "throws", "the", "subtree", "of", "WebApplicationExceptions", "*", "and", "WebApplicationExceptionWrappers", ",", "MicroProfile", "REST", "Client", "proxies", "throw", "only", "WebApplicationExceptions", "*", "and", "WebApplicationExceptionWrappers", ".", "*", "/", "@", "RunWith", "(", "Arquillian", ".", "class", ")", "@", "RunAsClient", "public", "class", "ClientWebApplicationExceptionMicroProfileProxyTest", "{", "private", "static", "ClientWebApplicationExceptionProxyResourceInterface", "proxy", ";", "static", "{", "try", "{", "proxy", "=", "RestClientBuilder", ".", "newBuilder", "(", ")", ".", "baseUri", "(", "new", "URI", "(", "generateURL", "(", "\"/", "app", "/", "test", "/", "\")", "))", ".", "build", "(", "ClientWebApplicationExceptionProxyResourceInterface", ".", "class", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "@", "Deployment", "public", "static", "Archive", "<", "?>", "deploy", "(", ")", "{", "WebArchive", "war", "=", "TestUtil", ".", "prepareArchive", "(", "ClientWebApplicationExceptionMicroProfileProxyTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionTest", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionMicroProfileProxyApplication", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionMicroProfileProxyResource", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionProxyResourceInterface", ".", "class", ")", ";", "war", ".", "addClass", "(", "PortProviderUtil", ".", "class", ")", ";", "war", ".", "addClass", "(", "TestUtil", ".", "class", ")", ";", "war", ".", "addAsWebInfResource", "(", "EmptyAsset", ".", "INSTANCE", ",", "\"", "beans", ".", "xml", "\"", ");", "return", "TestUtil", ".", "finishContainerPrepare", "(", "war", ",", "null", ",", "ClientWebApplicationExceptionMicroProfileProxyResource", ".", "class", ")", ";", "}", "public", "static", "String", "generateURL", "(", "String", "path", ")", "{", "return", "PortProviderUtil", ".", "generateURL", "(", "path", ",", "ClientWebApplicationExceptionMicroProfileProxyTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "}", "/", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "/", "/", "**", "*", "@", "tpTestDetails", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "calls", "the", "resource", "method", "oldException", "(", ")", "to", "throw", "*", "that", "WebApplicationException", ".", "Since", "it", "is", "running", "on", "the", "client", "side", ",", "the", "standard", "behavior", "of", "throwing", "a", "*", "WebApplicationException", "will", "occur", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testOldExceptionsDirectly", "(", ")", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "oldException", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "wae", ")", "{", "Response", "response", "=", "wae", ".", "getResponse", "(", ");", "WebApplicationException", "oldException", "=", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "wae", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "oldException", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "wae", ")", "{", "Response", "response", "=", "wae", ".", "getResponse", "(", ");", "WebApplicationException", "oldException", "=", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "wae", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "calls", "the", "resource", "method", "newException", "(", ")", "to", "throw", "*", "that", "WebApplicationExceptionWrapper", ".", "Since", "it", "is", "running", "on", "the", "client", "side", ",", "the", "standard", "behavior", "of", "throwing", "a", "*", "WebApplicationException", "will", "occur", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNewExceptionsDirectly", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "newException", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "final", "String", "msg", "=", "String", ".", "format", "(", "\"", "Failed", "on", "%", "d", ":", "%", "s", "\"", ",", "i", ",", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", "))", ";", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "msg", ",", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "msg", ",", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "msg", ",", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "msg", ",", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "newException", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "final", "String", "msg", "=", "String", ".", "format", "(", "\"", "Failed", "on", "%", "d", ":", "%", "s", "\"", ",", "0", ",", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "0", "]", ".", "getResponse", "(", "))", ";", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "msg", ",", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "msg", ",", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "msg", ",", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "msg", ",", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "noCatchOld", "(", ")", "is", "called", ".", "*", "*", "3", ".", "noCatchOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "4", ".", "In", "noCatchOld", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "*", "WebApplicationException", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "against", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchOldBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "WebApplicationException", "wae", "=", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "noCatchOld", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "WebApplicationException", "wae", "=", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "ResteasyWebApplicationException", "in", "ClientWebApplicationExceptionTest", ".", "newExceptions", ",", "the", "resource", "method", "noCatchNew", "(", ")", "is", "called", ".", "*", "*", "3", ".", "noCatchNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "The", "resulting", "*", "Response", "is", "sanitized", ".", "*", "*", "4", ".", "In", "noCatchNew", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "is", "sanitized", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchOldBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "noCatchNew", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "noCatchOld", "(", ")", "is", "called", ".", "*", "*", "2", ".", "noCatchOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "matching", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "3", ".", "In", "noCatchOld", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "WebApplicationExceptionWrapper", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchNewBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "noCatchOld", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "noCatchNew", "(", ")", "is", "called", ".", "*", "*", "2", ".", "noCatchNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "*", "*", "3", ".", "In", "noCatchNew", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "matching", "status", ",", "no", "*", "added", "headers", ",", "and", "empty", "entity", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchNewBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "noCatchNew", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "catchOldOld", "(", ")", "is", "called", ".", "*", "*", "3", ".", "catchOldOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "4", ".", "In", "catchOldOld", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "That", "WebApplicationException", "is", "caught", ",", "verified", "to", "match", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ",", "and", "then", "rethrown", ".", "The", "resulting", "HTTP", "response", "contains", "the", "*", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "against", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchOldBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchOldOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "catchOldOld", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "catchOldNew", "(", ")", "is", "called", ".", "*", "*", "3", ".", "catchOldNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "newExceptions", "*", "WebApplicationExceptionWrapper", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "In", "catchOldNew", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "That", "WebApplicationException", "is", "caught", ",", "verified", "to", "*", "have", "matching", "status", ",", "no", "added", "headers", ",", "and", "an", "empty", "entity", ",", "and", "then", "rethrown", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "verified", "to", "have", "*", "matching", "status", ",", "no", "added", "headers", ",", "and", "an", "empty", "entity", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchOldBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchOldNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "Assert", ".", "assertEquals", "(", "WebApplicationException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "/", "DefaultResponseExceptionMapper", "on", "client", "side", "doesn", "'", "t", "handle", "status", "s", ",", "300", "<", "=", "s", "<", "400", ",", "and", "/", "/", "ClientInvocation", "creates", "a", "RedirectionException", ".", "try", "{", "proxy", ".", "catchOldNew", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "catchNewOld", "(", ")", "is", "called", ".", "*", "*", "2", ".", "catchNewOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "matching", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "3", ".", "In", "catchNewOld", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ",", "caught", ",", "tested", ",", "and", "rethrown", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchNewBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchNewOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getClass", "(", "),", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "try", "{", "proxy", ".", "catchNewOld", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "catchNewNew", "(", ")", "is", "called", ".", "*", "*", "2", ".", "catchNewNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "*", "*", "3", ".", "In", "catchNewNew", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ",", "caught", ",", "tested", ",", "and", "rethrown", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "matching", "status", ",", "no", "*", "added", "headers", ",", "and", "empty", "entity", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchNewBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "1", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchNewNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getClass", "(", "),", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "try", "{", "proxy", ".", "catchNewNew", "(", "0", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "0", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RedirectionException", ".", "class", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "431", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "Deployment", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "RunAsClient", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "junit", ".", "Arquillian", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyWebApplicationException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClient", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClientBuilder", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionProxyResourceInterface", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionResteasyProxyApplication", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionResteasyProxyResource", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "PortProviderUtil", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "TestUtil", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "Archive", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "asset", ".", "EmptyAsset", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "spec", ".", "WebArchive", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "/", "**", "*", "@", "tpSubChapter", "Resteasy", "-", "client", "*", "@", "tpChapter", "Client", "throws", "ResteasyWebApplicationException", "on", "server", "side", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "@", "tpTestCaseDetails", "Test", "WebApplicationExceptions", "and", "WebApplicationExceptionWrapperss", "in", "various", "circumstances", ",", "*", "calls", "made", "by", "Resteasy", "client", "proxies", ".", "*", "*", "/", "@", "RunWith", "(", "Arquillian", ".", "class", ")", "@", "RunAsClient", "public", "class", "ClientWebApplicationExceptionResteasyProxyTest", "{", "private", "static", "ClientWebApplicationExceptionProxyResourceInterface", "proxy", ";", "static", "{", "ResteasyClient", "client", "=", "(", "ResteasyClient", ")", "ResteasyClientBuilder", ".", "newClient", "(", ");", "proxy", "=", "client", ".", "target", "(", "generateURL", "(", "\"/", "app", "/", "test", "/", "\")", ").", "proxy", "(", "ClientWebApplicationExceptionProxyResourceInterface", ".", "class", ")", ";", "}", "@", "Deployment", "public", "static", "Archive", "<", "?>", "deploy", "(", ")", "{", "WebArchive", "war", "=", "TestUtil", ".", "prepareArchive", "(", "ClientWebApplicationExceptionTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionTest", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionResteasyProxyApplication", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionResteasyProxyResource", ".", "class", ")", ";", "war", ".", "addClass", "(", "PortProviderUtil", ".", "class", ")", ";", "war", ".", "addClass", "(", "TestUtil", ".", "class", ")", ";", "war", ".", "addAsWebInfResource", "(", "EmptyAsset", ".", "INSTANCE", ",", "\"", "beans", ".", "xml", "\"", ");", "return", "TestUtil", ".", "finishContainerPrepare", "(", "war", ",", "null", ",", "ClientWebApplicationExceptionProxyResourceInterface", ".", "class", ")", ";", "}", "public", "static", "String", "generateURL", "(", "String", "path", ")", "{", "return", "PortProviderUtil", ".", "generateURL", "(", "path", ",", "ClientWebApplicationExceptionTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "}", "/", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "/", "/", "**", "*", "@", "tpTestDetails", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "calls", "the", "resource", "method", "oldException", "(", ")", "to", "throw", "*", "that", "WebApplicationException", ".", "Since", "it", "is", "running", "on", "the", "client", "side", ",", "the", "standard", "behavior", "of", "throwing", "a", "*", "WebApplicationException", "will", "occur", ".", "That", "WebApplicationException", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testOldExceptionsDirectly", "(", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "System", ".", "setProperty", "(", "\"", "node", "\"", ",", "\"", "localhost", "\"", ");", "proxy", ".", "oldException", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "wae", ")", "{", "Response", "response", "=", "wae", ".", "getResponse", "(", ");", "WebApplicationException", "oldException", "=", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "wae", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "calls", "the", "resource", "method", "newException", "(", ")", "to", "throw", "*", "that", "ResteasyWebApplicationException", ".", "Since", "it", "is", "running", "on", "the", "client", "side", ",", "the", "standard", "behavior", "of", "throwing", "a", "*", "WebApplicationException", "will", "occur", ".", "That", "WebApplicationException", "should", "match", "the", "result", "returned", "by", "newException", "(", ").", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNewExceptionsDirectly", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "newException", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "/", "/", "We", "compare", "the", "old", "exception", "here", "because", "this", "is", "coming", "from", "a", "client", "resulting", "in", "the", "exception", "thrown", "/", "/", "at", "the", "client", "not", "wrapped", ".", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "noCatchOld", "(", ")", "is", "called", ".", "*", "*", "3", ".", "noCatchOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "4", ".", "In", "noCatchOld", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "*", "WebApplicationException", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "against", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchOldBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "WebApplicationException", "wae", "=", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "ResteasyWebApplicationException", "in", "ClientWebApplicationExceptionTest", ".", "newExceptions", ",", "*", "the", "resource", "method", "noCatchNew", "(", ")", "is", "called", ".", "*", "*", "3", ".", "noCatchNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "The", "resulting", "*", "Response", "is", "sanitized", ".", "*", "*", "4", ".", "In", "noCatchNew", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "is", "sanitized", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchOldBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "/", "/", "We", "compare", "the", "old", "exception", "here", "because", "this", "is", "coming", "from", "a", "client", "resulting", "in", "the", "exception", "thrown", "/", "/", "at", "the", "client", "not", "wrapped", ".", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "noCatchOld", "(", ")", "is", "called", ".", "*", "*", "2", ".", "noCatchOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "matching", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "3", ".", "In", "noCatchOld", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "ResteasyWebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchNewBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "noCatchNew", "(", ")", "is", "called", ".", "*", "*", "2", ".", "noCatchNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "*", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "3", ".", "In", "noCatchNew", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "ResteasyWebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "has", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchNewBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "noCatchNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "/", "/", "We", "compare", "the", "old", "exception", "here", "because", "this", "is", "coming", "from", "a", "client", "resulting", "in", "the", "exception", "thrown", "/", "/", "at", "the", "client", "not", "wrapped", ".", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "catchOldOld", "(", ")", "is", "called", ".", "*", "*", "3", ".", "catchOldOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "4", ".", "In", "catchOldOld", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "That", "WebApplicationException", "is", "caught", ",", "verified", "to", "match", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ",", "and", "then", "rethrown", ".", "The", "resulting", "HTTP", "response", "contains", "the", "*", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "against", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchOldBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchOldOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "catchOldNew", "(", ")", "is", "called", ".", "*", "*", "3", ".", "catchOldNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "newExceptions", ".", "*", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "In", "catchOldNew", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "That", "WebApplicationException", "is", "caught", ",", "verified", "to", "*", "have", "matching", "status", ",", "no", "added", "headers", ",", "and", "an", "empty", "entity", ",", "and", "then", "rethrown", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "verified", "to", "have", "*", "matching", "status", ",", "no", "added", "headers", ",", "and", "an", "empty", "entity", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchOldBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "proxy", ".", "setBehavior", "(", "\"", "true", "\"", ");", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchOldNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "proxy", ".", "setBehavior", "(", "\"", "false", "\"", ");", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "catchNewOld", "(", ")", "is", "called", ".", "*", "*", "2", ".", "catchNewOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "matching", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "3", ".", "In", "catchNewOld", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ",", "caught", ",", "tested", ",", "and", "rethrown", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchNewBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchNewOld", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "catchNewNew", "(", ")", "is", "called", ".", "*", "*", "2", ".", "catchNewNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "The", "resulting", "*", "HTTP", "response", "will", "have", "a", "sanitized", "Response", ".", "*", "*", "3", ".", "In", "catchNewNew", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ",", "caught", ",", "tested", ",", "and", "rethrown", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchNewBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ClientWebApplicationExceptionTest", ".", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "proxy", ".", "catchNewNew", "(", "i", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "560", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "ws", ".", "rs", ".", "BadRequestException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ClientErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ForbiddenException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "InternalServerErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAcceptableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAllowedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotAuthorizedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotFoundException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotSupportedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "RedirectionException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ServerErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ServiceUnavailableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "Client", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "ClientBuilder", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "WebTarget", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ".", "ResponseBuilder", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "Deployment", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "RunAsClient", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "junit", ".", "Arquillian", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyBadRequestException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyClientErrorException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyForbiddenException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyInternalServerErrorException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyNotAcceptableException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyNotAllowedException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyNotAuthorizedException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyNotFoundException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyNotSupportedException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyRedirectionException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyServerErrorException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyServiceUnavailableException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyWebApplicationException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionApplication", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ".", "ClientWebApplicationExceptionResource", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "PortProviderUtil", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "TestUtil", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "Archive", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "spec", ".", "WebArchive", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "/", "**", "*", "@", "tpSubChapter", "Resteasy", "-", "client", "*", "@", "tpChapter", "Client", "throws", "ResteasyWebApplicationException", "on", "server", "side", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "@", "tpTestCaseDetails", "Test", "WebApplicationExceptions", "and", "WebApplicationExceptionWrappers", "in", "various", "circumstances", "*", "/", "@", "RunWith", "(", "Arquillian", ".", "class", ")", "@", "RunAsClient", "public", "class", "ClientWebApplicationExceptionTest", "{", "public", "static", "Response", "commonResponse", "=", "Response", ".", "ok", "(", "\"", "msg", "\"", ").", "status", "(", "444", ")", ".", "header", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ").", "build", "(", ");", "private", "static", "ResponseBuilder", "commonBuilder", "=", "Response", ".", "ok", "(", "\"", "msg", "\"", ").", "header", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ");", "public", "static", "WebApplicationException", "[", "]", "oldExceptions", "=", "{", "/", "/", "Redirection", "WebApplicationException", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "333", ")", ".", "build", "(", "))", ",", "/", "/", "The", "first", "four", "WebApplicationExceptions", "test", "the", "four", "WebApplicationException", "constructors", "/", "/", "that", "take", "a", "Response", "parameter", ".", "new", "WebApplicationException", "(", "commonResponse", ")", ",", "new", "WebApplicationException", "(", "\"", "msg", "\"", ",", "commonResponse", ")", ",", "new", "WebApplicationException", "(", "new", "Exception", "(", "),", "commonResponse", ")", ",", "new", "WebApplicationException", "(", "\"", "msg", "\"", ",", "new", "Exception", "(", "),", "commonResponse", ")", ",", "/", "/", "The", "other", "WebApplicationExceptions", "test", "the", "WebApplicationException", "subclasses", "that", "are", "/", "/", "thrown", "according", "to", "the", "status", "used", ".", "The", "relationship", "between", "status", "and", "subclass", "is", "given", "/", "/", "in", "oldExceptionMap", ".", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "400", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "401", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "403", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "404", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "405", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "406", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "415", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "500", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "503", ")", ".", "build", "(", "))", ",", "new", "WebApplicationException", "(", "commonBuilder", ".", "status", "(", "555", ")", ".", "build", "(", "))", ",", "}", ";", "public", "static", "Map", "<", "Integer", ",", "Class", "<", "?>", ">", "oldExceptionMap", "=", "new", "HashMap", "<", "Integer", ",", "Class", "<", "?>", ">(", ");", "static", "{", "oldExceptionMap", ".", "put", "(", "333", ",", "RedirectionException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "400", ",", "BadRequestException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "401", ",", "NotAuthorizedException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "403", ",", "ForbiddenException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "404", ",", "NotFoundException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "405", ",", "NotAllowedException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "406", ",", "NotAcceptableException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "415", ",", "NotSupportedException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "444", ",", "ClientErrorException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "500", ",", "InternalServerErrorException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "503", ",", "ServiceUnavailableException", ".", "class", ")", ";", "oldExceptionMap", ".", "put", "(", "555", ",", "ServerErrorException", ".", "class", ")", ";", "}", "public", "static", "WebApplicationException", "[", "]", "newExceptions", "=", "{", "/", "/", "The", "first", "four", "ResteasyWebApplicationExceptions", "test", "the", "four", "ResteasyWebApplicationException", "/", "/", "constructors", "that", "take", "a", "Response", "parameter", ".", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "0", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "1", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "2", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "3", "]", "),", "/", "/", "The", "other", "ResteasyWebApplicationExceptions", "test", "the", "ResteasyWebApplicationExceptions", "subclasses", "/", "/", "that", "are", "thrown", "according", "to", "the", "status", "used", ".", "The", "relationship", "between", "status", "and", "subclass", "is", "given", "/", "/", "in", "newExceptionMap", ".", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "4", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "5", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "6", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "7", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "8", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "9", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "10", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "11", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "12", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "13", "]", "),", "new", "ResteasyWebApplicationException", "(", "oldExceptions", "[", "14", "]", "),", "}", ";", "public", "static", "Map", "<", "Integer", ",", "Class", "<", "?>", ">", "newExceptionMap", "=", "new", "HashMap", "<", "Integer", ",", "Class", "<", "?>", ">(", ");", "static", "{", "newExceptionMap", ".", "put", "(", "333", ",", "ResteasyRedirectionException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "400", ",", "ResteasyBadRequestException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "401", ",", "ResteasyNotAuthorizedException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "403", ",", "ResteasyForbiddenException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "404", ",", "ResteasyNotFoundException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "405", ",", "ResteasyNotAllowedException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "406", ",", "ResteasyNotAcceptableException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "415", ",", "ResteasyNotSupportedException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "444", ",", "ResteasyClientErrorException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "500", ",", "ResteasyInternalServerErrorException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "503", ",", "ResteasyServiceUnavailableException", ".", "class", ")", ";", "newExceptionMap", ".", "put", "(", "555", ",", "ResteasyServerErrorException", ".", "class", ")", ";", "}", "private", "static", "Client", "client", ";", "private", "static", "WebTarget", "behaviorTarget", ";", "private", "static", "WebTarget", "target", ";", "@", "BeforeClass", "public", "static", "void", "beforeClass", "(", ")", "throws", "Exception", "{", "client", "=", "ClientBuilder", ".", "newClient", "(", ");", "behaviorTarget", "=", "client", ".", "target", "(", "generateURL", "(", "\"/", "app", "/", "test", "/", "behavior", "/", "\")", ");", "target", "=", "client", ".", "target", "(", "generateURL", "(", "\"/", "app", "/", "test", "/", "\")", ");", "}", "@", "AfterClass", "public", "static", "void", "stop", "(", ")", "throws", "Exception", "{", "client", ".", "close", "(", ");", "}", "@", "Deployment", "public", "static", "Archive", "<", "?>", "deploy", "(", ")", "{", "WebArchive", "war", "=", "TestUtil", ".", "prepareArchive", "(", "ClientWebApplicationExceptionTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionTest", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionApplication", ".", "class", ")", ";", "war", ".", "addClass", "(", "ClientWebApplicationExceptionResource", ".", "class", ")", ";", "war", ".", "addClass", "(", "PortProviderUtil", ".", "class", ")", ";", "war", ".", "addClass", "(", "TestUtil", ".", "class", ")", ";", "return", "TestUtil", ".", "finishContainerPrepare", "(", "war", ",", "null", ",", "ClientWebApplicationExceptionResource", ".", "class", ")", ";", "}", "public", "static", "String", "generateURL", "(", "String", "path", ")", "{", "return", "PortProviderUtil", ".", "generateURL", "(", "path", ",", "ClientWebApplicationExceptionTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "}", "/", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "//", "/", "/", "**", "*", "@", "tpTestDetails", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "calls", "the", "resource", "method", "oldException", "(", ")", "to", "throw", "*", "that", "WebApplicationException", ".", "Since", "it", "is", "running", "on", "the", "client", "side", ",", "the", "standard", "behavior", "of", "throwing", "a", "*", "WebApplicationException", "will", "occur", ".", "That", "WebApplicationException", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testOldExceptionsDirectly", "(", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "exception", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "wae", ")", "{", "Response", "response", "=", "wae", ".", "getResponse", "(", ");", "WebApplicationException", "oldException", "=", "oldExceptions", "[", "i", "]", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "oldException", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "wae", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "calls", "the", "resource", "method", "newException", "(", ")", "to", "throw", "*", "that", "ResteasyWebApplicationException", ".", "Since", "it", "is", "running", "on", "the", "client", "side", ",", "the", "standard", "behavior", "of", "throwing", "a", "*", "WebApplicationException", "will", "occur", ".", "That", "WebApplicationException", "should", "match", "the", "result", "returned", "by", "newException", "(", ")", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNewExceptionsDirectly", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "exception", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "/", "/", "We", "compare", "the", "old", "exception", "here", "because", "this", "is", "coming", "from", "a", "client", "resulting", "in", "the", "exception", "thrown", "/", "/", "at", "the", "client", "not", "wrapped", ".", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "noCatchOld", "(", ")", "is", "called", ".", "*", "*", "3", ".", "noCatchOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "4", ".", "In", "noCatchOld", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "*", "WebApplicationException", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "against", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchOldBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "true", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "nocatch", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "WebApplicationException", "wae", "=", "oldExceptions", "[", "i", "]", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "wae", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "false", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "noCatchNew", "(", ")", "is", "called", ".", "*", "*", "3", ".", "noCatchNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "The", "resulting", "*", "Response", "is", "sanitized", ".", "*", "*", "4", ".", "In", "noCatchNew", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "is", "sanitized", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchOldBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "true", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "nocatch", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "/", "/", "We", "compare", "the", "old", "exception", "here", "because", "this", "is", "coming", "from", "a", "client", "resulting", "in", "the", "exception", "thrown", "/", "/", "at", "the", "client", "not", "wrapped", ".", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "false", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "noCatchOld", "(", ")", "is", "called", ".", "*", "*", "2", ".", "noCatchOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "matching", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "3", ".", "In", "noCatchOld", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "WebApplicationExceptionWrapper", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchNewBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "nocatch", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "noCatchNew", "(", ")", "is", "called", ".", "*", "*", "2", ".", "noCatchNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "*", "WebApplicationExceptionWrapper", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "3", ".", "In", "noCatchNew", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "The", "resulting", "HTTP", "response", "has", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testNoCatchNewBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "nocatch", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "/", "/", "We", "compare", "the", "old", "exception", "here", "because", "this", "is", "coming", "from", "a", "client", "resulting", "in", "the", "exception", "thrown", "/", "/", "at", "the", "client", "not", "wrapped", ".", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "catchOldOld", "(", ")", "is", "called", ".", "*", "*", "3", ".", "catchOldOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "4", ".", "In", "catchOldOld", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "That", "WebApplicationException", "is", "caught", ",", "verified", "to", "match", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ",", "and", "then", "rethrown", ".", "The", "resulting", "HTTP", "response", "contains", "the", "*", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "against", "the", "matching", "*", "WebApplicationException", "in", "oldExceptins", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchOldBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "true", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "catch", "/", "old", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "rwae", ")", "{", "Assert", ".", "fail", "(", "\"", "Didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "false", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "The", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "to", "compel", "the", "original", "Client", "behavior", "on", "the", "server", "side", ".", "*", "*", "2", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "catchOldNew", "(", ")", "is", "called", ".", "*", "*", "3", ".", "catchOldNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "chosen", "member", "of", "newExceptions", ".", "*", "WebApplicationExceptionWrapper", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "Response", ".", "*", "*", "4", ".", "In", "catchOldNew", "(", "),", "the", "original", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationException", ",", "*", "which", "is", "thrown", "by", "the", "Client", ".", "That", "WebApplicationException", "is", "caught", ",", "verified", "to", "*", "have", "matching", "status", ",", "no", "added", "headers", ",", "and", "an", "empty", "entity", ",", "and", "then", "rethrown", ".", "*", "*", "5", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "verified", "to", "have", "*", "matching", "status", ",", "no", "added", "headers", ",", "and", "an", "empty", "entity", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchOldBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "true", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "catch", "/", "old", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "finally", "{", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "false", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "WebApplicationException", "in", "oldExceptions", ",", "the", "resource", "method", "catchNewOld", "(", ")", "is", "called", ".", "*", "*", "2", ".", "catchNewOld", "(", ")", "calls", "oldException", "(", "),", "which", "throws", "the", "matching", "member", "of", "oldExceptions", ".", "The", "resulting", "*", "HTTP", "response", "contains", "the", "status", ",", "headers", ",", "and", "entity", "in", "that", "WebApplicationException", ".", "*", "*", "3", ".", "In", "catchNewOld", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ",", "caught", ",", "tested", ",", "and", "rethrown", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchNewBehaviorOldExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "oldExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "catch", "/", "new", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "/", "**", "*", "@", "tpTestDetails", "1", ".", "For", "each", "ResteasyWebApplicationException", "in", "newExceptions", ",", "the", "resource", "method", "catchNewNew", "(", ")", "is", "called", ".", "*", "*", "2", ".", "catchNewNew", "(", ")", "calls", "newException", "(", "),", "which", "throws", "the", "matching", "member", "of", "newExceptions", ".", "The", "resulting", "*", "HTTP", "response", "will", "have", "a", "sanitized", "Response", ".", "*", "*", "3", ".", "In", "catchNewNew", "(", "),", "the", "new", "behavior", "causes", "the", "HTTP", "response", "to", "be", "turned", "into", "a", "WebApplicationExceptionWrapper", ",", "*", "which", "is", "thrown", "by", "the", "Client", ",", "caught", ",", "tested", ",", "and", "rethrown", ".", "*", "*", "4", ".", "The", "client", "side", "Client", "constructs", "and", "throws", "a", "WebApplicationException", "which", "is", "checked", "for", "a", "sanitized", "*", "Response", "and", "matching", "status", ".", "*", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", ".", "Final", "*", "/", "@", "Test", "public", "void", "testCatchNewBehaviorNewExceptions", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "newExceptions", ".", "length", ";", "i", "+", "+)", "{", "try", "{", "target", ".", "path", "(", "\"", "catch", "/", "new", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "Assert", ".", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "\"", "expected", "WebApplicationException", "\"", ");", "}", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "18", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ApplicationPath", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Application", ";", "@", "ApplicationPath", "(", "\"", "app", "\"", ")", "public", "class", "ClientWebApplicationExceptionApplication", "extends", "Application", "{", "@", "Override", "public", "Set", "<", "Class", "<", "?>", ">", "getClasses", "(", ")", "{", "HashSet", "<", "Class", "<", "?>", ">", "classes", "=", "new", "HashSet", "<", "Class", "<", "?>", ">(", ");", "classes", ".", "add", "(", "ClientWebApplicationExceptionResource", ".", "class", ")", ";", "return", "classes", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "18", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ApplicationPath", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Application", ";", "@", "ApplicationPath", "(", "\"", "app", "\"", ")", "public", "class", "ClientWebApplicationExceptionMicroProfileProxyApplication", "extends", "Application", "{", "@", "Override", "public", "Set", "<", "Class", "<", "?>", ">", "getClasses", "(", ")", "{", "HashSet", "<", "Class", "<", "?>", ">", "classes", "=", "new", "HashSet", "<", "Class", "<", "?>", ">(", ");", "classes", ".", "add", "(", "ClientWebApplicationExceptionMicroProfileProxyResource", ".", "class", ")", ";", "return", "classes", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "227", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "javax", ".", "ws", ".", "rs", ".", "GET", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "javax", ".", "ws", ".", "rs", ".", "PathParam", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyWebApplicationException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClient", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClientBuilder", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "ClientWebApplicationExceptionMicroProfileProxyTest", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "ClientWebApplicationExceptionTest", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "PortProviderUtil", ";", "import", "org", ".", "junit", ".", "Assert", ";", "@", "Path", "(", "\"", "test", "\"", ")", "public", "class", "ClientWebApplicationExceptionMicroProfileProxyResource", "{", "private", "static", "ClientWebApplicationExceptionProxyResourceInterface", "proxy", ";", "static", "{", "ResteasyClient", "client", "=", "(", "ResteasyClient", ")", "ResteasyClientBuilder", ".", "newClient", "(", ");", "proxy", "=", "client", ".", "target", "(", "generateURL", "(", "\"/", "app", "/", "test", "/", "\")", ").", "proxy", "(", "ClientWebApplicationExceptionProxyResourceInterface", ".", "class", ")", ";", "}", "private", "static", "String", "generateURL", "(", "String", "path", ")", "{", "return", "PortProviderUtil", ".", "generateURL", "(", "path", ",", "ClientWebApplicationExceptionMicroProfileProxyTest", ".", "class", ".", "getSimpleName", "(", "))", ";", "}", "/", "**", "*", "Sets", "the", "System", "property", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "*", "@", "param", "value", "value", "property", "is", "set", "to", "*", "/", "@", "GET", "@", "Path", "(", "\"", "behavior", "/", "{", "value", "}", "\")", "public", "void", "setBehavior", "(", "@", "PathParam", "(", "\"", "value", "\"", ")", "String", "value", ")", "{", "System", ".", "setProperty", "(", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ",", "value", ")", ";", "}", "/", "**", "*", "Throws", "an", "instance", "of", "WebApplicationException", "from", "oldExceptions", "table", ".", "The", "Response", "returned", "by", "*", "WebApplicationException", ".", "getResponse", "(", ")", "will", "be", "used", "by", "the", "container", "to", "create", "an", "HTTP", "response", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "oldException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "throw", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "}", "/", "**", "*", "Throws", "an", "instance", "of", "ResteasyWebApplicationException", "from", "newExceptions", "table", ".", "*", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "response", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "newException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "throw", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ";", "}", "/", "**", "*", "Uses", "a", "proxy", "to", "call", "oldException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "WebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "proxy", "will", "throw", "either", "a", "WebApplicationException", "or", "WebApplicationExceptionWrapper", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "noCatchOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "return", "proxy", ".", "oldException", "(", "i", ")", ";", "}", "/", "**", "*", "Uses", "a", "proxy", "to", "call", "newException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "WebApplicationExceptionWrapper", ".", "*", "Based", "on", "that", "response", ",", "the", "proxy", "will", "throw", "either", "a", "WebApplicationException", "or", "WebApplicationExceptionWrapper", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "noCatchNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "return", "proxy", ".", "newException", "(", "i", ")", ";", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "proxy", "to", "call", "oldException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "The", "contents", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "catchOldOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "proxy", ".", "oldException", "(", "i", ")", ";", "throw", "new", "Exception", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "proxy", "to", "call", "newException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", ",", "examined", ",", "and", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "catchOldNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "return", "proxy", ".", "newException", "(", "i", ")", ";", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "oldException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationExceptionWrapper", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "a", "sanitized", "*", "Response", ",", "but", "the", "unwrapped", "Response", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationExceptionWrapper", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "catchNewOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "return", "proxy", ".", "oldException", "(", "i", ")", ";", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "sanitizedResponse", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "sanitizedResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "sanitizedResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertFalse", "(", "sanitizedResponse", ".", "hasEntity", "(", "))", ";", "Response", "originalResponse", "=", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "e", ")", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "originalResponse", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "originalResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "originalResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "originalResponse", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptionMap", ".", "get", "(", "originalResponse", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "newException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationExceptionWrapper", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "a", "sanitized", "*", "Response", ",", "but", "the", "unwrapped", "Response", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "newException", "(", ").", "That", "WebApplicationExceptionWrapper", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "catchNewNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "return", "proxy", ".", "newException", "(", "i", ")", ";", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "sanitizedResponse", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "sanitizedResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "sanitizedResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertFalse", "(", "sanitizedResponse", ".", "hasEntity", "(", "))", ";", "Response", "originalResponse", "=", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "e", ")", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "originalResponse", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "originalResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "originalResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "originalResponse", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptionMap", ".", "get", "(", "originalResponse", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "125", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "javax", ".", "ws", ".", "rs", ".", "GET", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "javax", ".", "ws", ".", "rs", ".", "PathParam", ";", "public", "interface", "ClientWebApplicationExceptionProxyResourceInterface", "{", "/", "**", "*", "Sets", "the", "System", "property", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "*", "@", "param", "value", "value", "property", "is", "set", "to", "*", "/", "@", "GET", "@", "Path", "(", "\"", "behavior", "/", "{", "value", "}", "\")", "void", "setBehavior", "(", "@", "PathParam", "(", "\"", "value", "\"", ")", "String", "value", ")", ";", "/", "**", "*", "Throws", "an", "instance", "of", "WebApplicationException", "from", "oldExceptions", "table", ".", "The", "Response", "returned", "by", "*", "WebApplicationException", ".", "getResponse", "(", ")", "will", "be", "used", "by", "the", "container", "to", "create", "an", "HTTP", "response", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "old", "/", "{", "i", "}", "\")", "String", "oldException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "Throws", "an", "instance", "of", "ResteasyWebApplicationException", "from", "newExceptions", "table", ".", "*", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "null", ",", "so", "the", "container", "will", "return", "*", "an", "HTTP", "response", "with", "status", "500", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "new", "/", "{", "i", "}", "\")", "String", "newException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "Uses", "a", "Client", "or", "proxy", "to", "call", "oldException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "WebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "Client", "or", "proxy", "will", "throw", "either", "a", "WebApplicationException", "or", "ResteasyWebApplicationException", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "old", "/", "{", "i", "}", "\")", "String", "noCatchOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "Uses", "a", "Client", "or", "proxy", "to", "call", "newException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "ResteasyWebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "Client", "or", "proxy", "will", "throw", "either", "a", "WebApplicationException", "or", "ResteasyWebApplicationException", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "new", "/", "{", "i", "}", "\")", "String", "noCatchNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "or", "proxy", "to", "call", "oldException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "Client", "or", "proxy", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "It", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "old", "/", "{", "i", "}", "\")", "String", "catchOldOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "or", "proxy", "to", "call", "newException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "Client", "or", "proxy", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "It", "should", "have", "status", "500", "and", "represent", "*", "a", "stacktrace", ".", "That", "WebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "new", "/", "{", "i", "}", "\")", "String", "catchOldNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "or", "proxy", "to", "call", "oldException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "Client", "or", "proxy", "will", "throw", "a", "*", "ResteasyWebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "null", ",", "but", "*", "getOriginalResponse", "(", ")", "should", "return", "a", "Response", "which", "matches", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "ResteasyWebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "old", "/", "{", "i", "}", "\")", "String", "catchNewOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "or", "proxy", "to", "call", "newException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "Client", "or", "proxy", "will", "throw", "a", "*", "ResteasyWebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "null", ",", "but", "*", "getOriginalResponse", "(", ")", "should", "return", "a", "Response", "which", "has", "status", "500", "and", "represents", "*", "a", "stacktrace", ".", "That", "ResteasyWebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "new", "/", "{", "i", "}", "\")", "String", "catchNewNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "219", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "javax", ".", "ws", ".", "rs", ".", "GET", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "javax", ".", "ws", ".", "rs", ".", "PathParam", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "Client", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "ClientBuilder", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "WebTarget", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyWebApplicationException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "ClientWebApplicationExceptionTest", ";", "import", "org", ".", "junit", ".", "Assert", ";", "@", "Path", "(", "\"", "test", "\"", ")", "public", "class", "ClientWebApplicationExceptionResource", "{", "private", "static", "Client", "client", "=", "ClientBuilder", ".", "newClient", "(", ");", "private", "static", "WebTarget", "target", "=", "client", ".", "target", "(", "ClientWebApplicationExceptionTest", ".", "generateURL", "(", "\"/", "app", "/", "test", "/", "\")", ");", "/", "**", "*", "Sets", "the", "System", "property", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "*", "@", "param", "value", "value", "property", "is", "set", "to", "*", "/", "@", "GET", "@", "Path", "(", "\"", "behavior", "/", "{", "value", "}", "\")", "public", "void", "setBehavior", "(", "@", "PathParam", "(", "\"", "value", "\"", ")", "String", "value", ")", "{", "System", ".", "setProperty", "(", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ",", "value", ")", ";", "}", "/", "**", "*", "Throws", "an", "instance", "of", "WebApplicationException", "from", "oldExceptions", "table", ".", "The", "Response", "returned", "by", "*", "WebApplicationException", ".", "getResponse", "(", ")", "will", "be", "used", "by", "the", "container", "to", "create", "an", "HTTP", "response", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "oldException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "throw", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "}", "/", "**", "*", "Throws", "an", "instance", "of", "ResteasyWebApplicationException", "from", "newExceptions", "table", ".", "*", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "response", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "newException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "throw", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ";", "}", "/", "**", "*", "Uses", "a", "Client", "to", "call", "oldException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "WebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "Client", "will", "throw", "either", "a", "WebApplicationException", "or", "ResteasyWebApplicationException", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "noCatchOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "return", "target", ".", "path", "(", "\"", "exception", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "}", "/", "**", "*", "Uses", "a", "Client", "to", "call", "newException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "ResteasyWebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "Client", "will", "throw", "either", "a", "WebApplicationException", "or", "ResteasyWebApplicationException", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "noCatchNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "return", "target", ".", "path", "(", "\"", "exception", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "oldException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "Client", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "It", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "catchOldOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "target", ".", "path", "(", "\"", "exception", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "throw", "new", "Exception", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "ResteasyWebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "newException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "Client", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", "for", "a", "sanitized", "Response", "and", "matching", "status", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "catchOldNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "target", ".", "path", "(", "\"", "exception", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "throw", "new", "Exception", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "ResteasyWebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "oldException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationExceptionWrapper", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "a", "sanitized", "*", "Response", ",", "but", "the", "unwrapped", "Response", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationExceptionWrapper", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "catchNewOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "target", ".", "path", "(", "\"", "exception", "/", "old", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "throw", "new", "Exception", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "sanitizedResponse", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "sanitizedResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "sanitizedResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertFalse", "(", "sanitizedResponse", ".", "hasEntity", "(", "))", ";", "Response", "originalResponse", "=", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "e", ")", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "originalResponse", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "originalResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "originalResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "originalResponse", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptionMap", ".", "get", "(", "originalResponse", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "newException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationExceptionWrapper", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "a", "sanitized", "*", "Response", ",", "but", "the", "unwrapped", "Response", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "newException", "(", ").", "That", "WebApplicationExceptionWrapper", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "catchNewNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "target", ".", "path", "(", "\"", "exception", "/", "new", "/", "\"", "+", "i", ")", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "throw", "new", "Exception", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "sanitizedResponse", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "sanitizedResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "sanitizedResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertFalse", "(", "sanitizedResponse", ".", "hasEntity", "(", "))", ";", "Response", "originalResponse", "=", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "e", ")", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "originalResponse", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "originalResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "originalResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "originalResponse", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptionMap", ".", "get", "(", "originalResponse", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "18", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ApplicationPath", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Application", ";", "@", "ApplicationPath", "(", "\"", "app", "\"", ")", "public", "class", "ClientWebApplicationExceptionResteasyProxyApplication", "extends", "Application", "{", "@", "Override", "public", "Set", "<", "Class", "<", "?>", ">", "getClasses", "(", ")", "{", "HashSet", "<", "Class", "<", "?>", ">", "classes", "=", "new", "HashSet", "<", "Class", "<", "?>", ">(", ");", "classes", ".", "add", "(", "ClientWebApplicationExceptionResteasyProxyResource", ".", "class", ")", ";", "return", "classes", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "218", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "resource", ";", "import", "javax", ".", "ws", ".", "rs", ".", "GET", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "javax", ".", "ws", ".", "rs", ".", "PathParam", ";", "import", "javax", ".", "ws", ".", "rs", ".", "WebApplicationException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "ResteasyWebApplicationException", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "exception", ".", "WebApplicationExceptionWrapper", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClient", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "client", ".", "jaxrs", ".", "ResteasyClientBuilder", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "client", ".", "exception", ".", "ClientWebApplicationExceptionTest", ";", "import", "org", ".", "junit", ".", "Assert", ";", "@", "Path", "(", "\"", "test", "\"", ")", "public", "class", "ClientWebApplicationExceptionResteasyProxyResource", "{", "private", "static", "ClientWebApplicationExceptionProxyResourceInterface", "proxy", ";", "static", "{", "ResteasyClient", "client", "=", "(", "ResteasyClient", ")", "ResteasyClientBuilder", ".", "newClient", "(", ");", "proxy", "=", "client", ".", "target", "(", "ClientWebApplicationExceptionTest", ".", "generateURL", "(", "\"/", "app", "/", "test", "/", "\")", ").", "proxy", "(", "ClientWebApplicationExceptionProxyResourceInterface", ".", "class", ")", ";", "}", "/", "**", "*", "Sets", "the", "System", "property", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "*", "@", "param", "value", "value", "property", "is", "set", "to", "*", "/", "@", "GET", "@", "Path", "(", "\"", "behavior", "/", "{", "value", "}", "\")", "public", "void", "setBehavior", "(", "@", "PathParam", "(", "\"", "value", "\"", ")", "String", "value", ")", "{", "System", ".", "setProperty", "(", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ",", "value", ")", ";", "}", "/", "**", "*", "Throws", "an", "instance", "of", "WebApplicationException", "from", "oldExceptions", "table", ".", "The", "Response", "returned", "by", "*", "WebApplicationException", ".", "getResponse", "(", ")", "will", "be", "used", "by", "the", "container", "to", "create", "an", "HTTP", "response", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "oldException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "throw", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ";", "}", "/", "**", "*", "Throws", "an", "instance", "of", "ResteasyWebApplicationException", "from", "newExceptions", "table", ".", "*", "ResteasyWebApplicationException", ".", "getResponse", "(", ")", "returns", "a", "sanitized", "response", ".", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "exception", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "newException", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "throw", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ";", "}", "/", "**", "*", "Uses", "a", "proxy", "to", "call", "oldException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "WebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "proxy", "will", "throw", "either", "a", "WebApplicationException", "or", "ResteasyWebApplicationException", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "noCatchOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "return", "proxy", ".", "oldException", "(", "i", ")", ";", "}", "/", "**", "*", "Uses", "a", "proxy", "to", "call", "newException", "(", ")", "to", "get", "an", "HTTP", "response", "derived", "from", "a", "ResteasyWebApplicationException", ".", "*", "Based", "on", "that", "response", ",", "the", "proxy", "will", "throw", "either", "a", "WebApplicationException", "or", "ResteasyWebApplicationException", ",", "*", "depending", "on", "the", "value", "of", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "nocatch", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "noCatchNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "return", "proxy", ".", "newException", "(", "i", ")", ";", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "proxy", "to", "call", "oldException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", ".", "It", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationException", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "catchOldOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "proxy", ".", "oldException", "(", "i", ")", ";", "throw", "new", "Exception", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "response", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "is", "*", "set", "to", "\"", "true", "\"", "before", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "newException", "(", ").", "Since", "the", "old", "behavior", "is", "configured", ",", "the", "Client", "will", "throw", "a", "*", "WebApplicationException", ",", "which", "is", "caught", "and", "examined", "for", "a", "sanitized", "Response", "and", "matching", "status", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "old", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "catchOldNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "return", "proxy", ".", "newException", "(", "i", ")", ";", "}", "catch", "(", "ResteasyWebApplicationException", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "didn", "'", "t", "expect", "ResteasyWebApplicationException", "\"", ");", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "response", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "response", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ".", "length", "(", ")", "=", "=", "0", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptionMap", ".", "get", "(", "response", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "oldException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationExceptionWrapper", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "a", "sanitized", "*", "Response", ",", "but", "the", "unwrapped", "Response", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "oldException", "(", ").", "That", "WebApplicationExceptionWrapper", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "oldExceptions", "to", "be", "thrown", "by", "oldException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "old", "/", "{", "i", "}", "\")", "public", "String", "catchNewOld", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "return", "proxy", ".", "oldException", "(", "i", ")", ";", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "sanitizedResponse", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "sanitizedResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "sanitizedResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertFalse", "(", "sanitizedResponse", ".", "hasEntity", "(", "))", ";", "Response", "originalResponse", "=", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "e", ")", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "originalResponse", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "originalResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "originalResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "oldExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getEntity", "(", "),", "originalResponse", ".", "readEntity", "(", "String", ".", "class", ")", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptionMap", ".", "get", "(", "originalResponse", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "ResteasyWebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "/", "**", "*", "It", "is", "assumed", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "holds", "*", "\"", "false", "\"", "when", "this", "method", "is", "invoked", ".", "*", "*", "Uses", "a", "Client", "to", "call", "newException", "(", ").", "Since", "the", "new", "behavior", "is", "configured", ",", "the", "proxy", "will", "throw", "a", "*", "WebApplicationExceptionWrapper", ",", "which", "is", "caught", "and", "examined", ".", "getResponse", "(", ")", "should", "return", "a", "sanitized", "*", "Response", ",", "but", "the", "unwrapped", "Response", "should", "match", "the", "WebApplicationException", "*", "thrown", "by", "newException", "(", ").", "That", "WebApplicationExceptionWrapper", "is", "then", "rethrown", ".", "*", "*", "@", "param", "i", "determines", "element", "of", "newExceptions", "to", "be", "thrown", "by", "newException", "(", ")", "*", "@", "throws", "Exception", "*", "/", "@", "GET", "@", "Path", "(", "\"", "catch", "/", "new", "/", "new", "/", "{", "i", "}", "\")", "public", "String", "catchNewNew", "(", "@", "PathParam", "(", "\"", "i", "\"", ")", "int", "i", ")", "throws", "Exception", "{", "try", "{", "return", "proxy", ".", "newException", "(", "i", ")", ";", "}", "catch", "(", "WebApplicationException", "e", ")", "{", "Response", "sanitizedResponse", "=", "e", ".", "getResponse", "(", ");", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "sanitizedResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertNull", "(", "sanitizedResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertFalse", "(", "sanitizedResponse", ".", "hasEntity", "(", "))", ";", "Response", "originalResponse", "=", "WebApplicationExceptionWrapper", ".", "unwrap", "(", "e", ")", ".", "getResponse", "(", ");", "Assert", ".", "assertNotNull", "(", "originalResponse", ")", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getStatus", "(", "),", "originalResponse", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptions", "[", "i", "]", ".", "getResponse", "(", ").", "getHeaderString", "(", "\"", "foo", "\"", "),", "originalResponse", ".", "getHeaderString", "(", "\"", "foo", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "originalResponse", ".", "readEntity", "(", "String", ".", "class", ")", ".", "isEmpty", "(", "))", ";", "Assert", ".", "assertEquals", "(", "ClientWebApplicationExceptionTest", ".", "newExceptionMap", ".", "get", "(", "originalResponse", ".", "getStatus", "(", "))", ",", "e", ".", "getClass", "(", "))", ";", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "Exception", "(", "\"", "expected", "WebApplicationException", ",", "not", "\"", "+", "e", ".", "getClass", "(", "))", ";", "}", "}", "}", "@", "@", "-", "7", ",", "6", "+", "7", ",", "9", "@", "@", "import", "javax", ".", "ws", ".", "rs", ".", "NotAcceptableException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotSupportedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "Client", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "ClientBuilder", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "WebTarget", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "Deployment", ";", "import", "org", ".", "jboss", ".", "arquillian", ".", "container", ".", "test", ".", "api", ".", "RunAsClient", ";", "@", "@", "-", "21", ",", "6", "+", "24", ",", "7", "@", "@", "import", "org", ".", "jboss", ".", "resteasy", ".", "utils", ".", "TestUtil", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "Archive", ";", "import", "org", ".", "jboss", ".", "shrinkwrap", ".", "api", ".", "spec", ".", "WebArchive", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "@", "@", "-", "62", ",", "6", "+", "66", ",", "25", "@", "@", "*", "/", "@", "Test", "(", "expected", "=", "NotAcceptableException", ".", "class", ")", "public", "void", "testNotAcceptable", "(", ")", "{", "WebTarget", "behaviorTarget", "=", "new", "ResteasyClientBuilderImpl", "(", ").", "build", "(", ").", "target", "(", "generateURL", "(", "\"/", "behavior", "\"", "))", ";", "try", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "true", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "new", "ResteasyClientBuilderImpl", "(", ").", "build", "(", ").", "target", "(", "generateURL", "(", "\"/", "testNotAcceptable", "\"", "))", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "}", "finally", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "false", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "RESTEasy", "client", "errors", "that", "result", "in", "a", "closed", "Response", "are", "correctly", "handled", ".", "*", "Note", "that", "the", "default", "behavior", "has", "changed", "after", "RESTEASY", "-", "2728", ".", "*", "@", "tpPassCrit", "An", "NotAcceptableException", "is", "returned", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", "*", "/", "@", "Test", "(", "expected", "=", "NotAcceptableException", ".", "class", ")", "public", "void", "testNotAcceptableNewBehavior", "(", ")", "{", "Client", "c", "=", "new", "ResteasyClientBuilderImpl", "(", ").", "build", "(", ");", "try", "{", "c", ".", "target", "(", "generateURL", "(", "\"/", "testNotAcceptable", "\"", "))", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "@", "@", "-", "71", ",", "12", "+", "94", ",", "33", "@", "@", "public", "void", "testNotAcceptable", "(", ")", "{", "}", "/", "**", "*", "@", "tpTestDetails", "Closed", "Response", "instances", "should", "be", "handled", "correctly", "with", "full", "tracing", "enabled", ".", "*", "@", "tpPassCrit", "A", "NotSupportedException", "is", "returned", "*", "@", "tpTestDetails", "RESTEasy", "client", "errors", "that", "result", "in", "a", "closed", "Response", "are", "correctly", "handled", ".", "*", "Note", "that", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "*", "must", "be", "set", "to", "\"", "true", "\"", "to", "enforce", "old", "Client", "behavior", ".", "*", "@", "tpPassCrit", "A", "NotAcceptableException", "is", "returned", "*", "@", "tpSince", "RESTEasy", "4", ".", "0", ".", "0", ".", "CR1", "*", "/", "@", "Test", "(", "expected", "=", "NotSupportedException", ".", "class", ")", "public", "void", "testNotSupportedTraced", "(", ")", "{", "WebTarget", "behaviorTarget", "=", "ClientBuilder", ".", "newClient", "(", ").", "target", "(", "generateURL", "(", "\"/", "behavior", "\"", "))", ";", "try", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "true", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "ClientBuilder", ".", "newClient", "(", ").", "target", "(", "generateURL", "(", "\"/", "testNotSupportedTraced", "\"", "))", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "}", "finally", "{", "Response", "behaviorResponse", "=", "behaviorTarget", ".", "path", "(", "\"", "false", "\"", ").", "request", "(", ").", "get", "(", ");", "Assert", ".", "assertEquals", "(", "204", ",", "behaviorResponse", ".", "getStatus", "(", "))", ";", "}", "}", "/", "**", "*", "@", "tpTestDetails", "Closed", "Response", "instances", "should", "be", "handled", "correctly", "with", "full", "tracing", "enabled", ".", "*", "Note", "that", "the", "default", "behavior", "has", "changed", "after", "RESTEASY", "-", "2728", ".", "*", "@", "tpPassCrit", "An", "NotSupportedException", "is", "returned", "*", "@", "tpSince", "RESTEasy", "4", ".", "6", ".", "0", "*", "/", "@", "Test", "(", "expected", "=", "NotSupportedException", ".", "class", ")", "public", "void", "testNotSupportedTracedNewBehavior", "(", ")", "{", "Client", "c", "=", "new", "ResteasyClientBuilderImpl", "(", ").", "build", "(", ");", "try", "{", "c", ".", "target", "(", "generateURL", "(", "\"/", "testNotSupportedTraced", "\"", "))", ".", "request", "(", ").", "get", "(", "String", ".", "class", ")", ";", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "javax", ".", "ws", ".", "rs", ".", "GET", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotSupportedException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "javax", ".", "ws", ".", "rs", ".", "PathParam", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "Client", ";", "import", "javax", ".", "ws", ".", "rs", ".", "client", ".", "ClientBuilder", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Context", ";", "@", "@", "-", "11", ",", "12", "+", "12", ",", "24", "@", "@", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "UriInfo", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "server", ".", "servlet", ".", "ResteasyContextParameters", ";", "import", "static", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ".", "Status", ".", "NOT_ACCEPTABLE", ";", "import", "static", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ".", "Status", ".", "UNSUPPORTED_MEDIA_TYPE", ";", "@", "Path", "(", "\"\"", ")", "public", "class", "ClosedResponseHandlingResource", "{", "/", "**", "*", "Sets", "the", "System", "property", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", "*", "@", "param", "value", "value", "property", "is", "set", "to", "*", "/", "@", "GET", "@", "Path", "(", "\"", "behavior", "/", "{", "value", "}", "\")", "public", "void", "setBehavior", "(", "@", "PathParam", "(", "\"", "value", "\"", ")", "String", "value", ")", "{", "System", ".", "setProperty", "(", "ResteasyContextParameters", ".", "RESTEASY_ORIGINAL_WEBAPPLICATIONEXCEPTION_BEHAVIOR", ",", "value", ")", ";", "}", "@", "Path", "(", "\"/", "testNotAcceptable", "/", "406", "\"", ")", "@", "GET", "public", "Response", "errorNotAcceptable", "(", ")", "{"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["ec:", "validate", "that", "a", "point", "before", "deriving", "keys", "This", "update", "checks", "to", "make", "sure", "that", "the", "public", "key", "passed", "in", "to", "ECDH", "is", "a", "point", "that", "actually", "exists", "on", "the", "curve.", "This", "is", "important", "to", "prevent", "a", "twist", "attack", "that", "can", "be", "used", "to", "reveal", "the", "private", "key", "of", "a", "party", "in", "an", "ECDH", "operation", "over", "a", "number", "of", "occurances.", "For", "more", "details", "on", "the", "attack", "see", "this", "blog", "post:", "https://github.com/christianlundkvist/blog/blob/master/2020_05_26_secp256k1_twist_attacks/secp256k1_twist_attacks.md", "CVE:"], "code_tokens": ["@", "@", "-", "100", ",", "6", "+", "100", ",", "9", "@", "@", "KeyPair", ".", "prototype", ".", "_importPublic", "=", "function", "_importPublic", "(", "key", ",", "enc", ")", "{", "/", "/", "ECDH", "KeyPair", ".", "prototype", ".", "derive", "=", "function", "derive", "(", "pub", ")", "{", "if", "(", "!", "pub", ".", "validate", "(", "))", "{", "assert", "(", "pub", ".", "validate", "(", "),", "'", "public", "point", "not", "validated", "'", ");", "}", "return", "pub", ".", "mul", "(", "this", ".", "priv", ")", ".", "getX", "(", ");", "}", ";", "@", "@", "-", "27", ",", "3", "+", "27", ",", "17", "@", "@", "describe", "(", "'", "ECDH", "'", ",", "function", "(", ")", "{", "test", "(", "'", "ed25519", "'", ");", "test", "(", "'", "secp256k1", "'", ");", "}", ");", "describe", "(", "'", "ECDH", "twist", "attack", "'", ",", "(", ")", "=", ">", "{", "it", "(", "'", "should", "be", "able", "to", "prevent", "a", "twist", "attack", "for", "secp256k1", "'", ",", "(", ")", "=", ">", "{", "var", "bobEcdh", "=", "new", "elliptic", ".", "ec", "(", "'", "secp256k1", "'", ");", "var", "malloryEcdh", "=", "new", "elliptic", ".", "ec", "(", "'", "secp256k1", "'", ");", "var", "bob", "=", "bobEcdh", ".", "genKeyPair", "(", ");", "/", "/", "This", "is", "a", "bad", "point", "that", "shouldn", "'", "t", "be", "able", "to", "be", "passed", "to", "derive", ".", "/", "/", "If", "a", "bad", "point", "can", "be", "passed", "it", "'", "s", "possible", "to", "perform", "a", "twist", "attack", ".", "var", "mallory", "=", "malloryEcdh", ".", "keyFromPublic", "(", "{", "x", ":", "14", ",", "y", ":", "16", "}", ");", "assert", ".", "throws", "(", "function", "(", ")", "{", "bob", ".", "derive", "(", "mallory", ".", "getPublic", "(", "))", ";", "}", ");", "}", ");", "}", ");"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["set", "a", "global", "flag", "to", "disable", "clientlockoutpolicy", "[#138677887]", "https://www.pivotaltracker.com/story/show/138677887", "Signed-off-by:", "Bharath", "Sekar", "<bharath.sekar@ge.com>"], "code_tokens": ["@", "@", "-", "1", ",", "7", "+", "1", ",", "5", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonIgnore", ";", "public", "class", "LockoutPolicy", "{", "private", "int", "lockoutPeriodSeconds", ";", "private", "int", "lockoutAfterFailures", ";", "@", "@", "-", "17", ",", "11", "+", "15", ",", "6", "@", "@", "public", "LockoutPolicy", "(", "int", "countFailuresWithin", ",", "int", "lockoutAfterFailures", ",", "int", "lock", "this", ".", "lockoutPeriodSeconds", "=", "lockoutPeriodSeconds", ";", "}", "@", "JsonIgnore", "public", "boolean", "isLockoutEnabled", "(", ")", "{", "return", "countFailuresWithin", ">", "0", ";", "}", "public", "LockoutPolicy", "setLockoutPeriodSeconds", "(", "int", "lockoutPeriod", ")", "{", "this", ".", "lockoutPeriodSeconds", "=", "lockoutPeriod", ";", "return", "this", ";", "@", "@", "-", "6", ",", "11", "+", "6", ",", "18", "@", "@", "public", "class", "ClientLockoutPolicyRetriever", "implements", "LockoutPolicyRetriever", "{", "private", "LockoutPolicy", "defaultLockoutPolicy", ";", "private", "LockoutPolicy", "disabledLockoutPolicy", "=", "new", "LockoutPolicy", "(", ");", "private", "boolean", "isEnabled", ";", "@", "Override", "public", "LockoutPolicy", "getLockoutPolicy", "(", ")", "{", "LockoutPolicy", "res", "=", "IdentityZoneHolder", ".", "get", "(", ").", "getConfig", "(", ").", "getClientLockoutPolicy", "(", ");", "return", "res", ".", "getLockoutAfterFailures", "(", ")", "!", "=", "-", "1", "?", "res", ":", "defaultLockoutPolicy", ";", "if", "(", "isEnabled", ")", "{", "LockoutPolicy", "res", "=", "IdentityZoneHolder", ".", "get", "(", ").", "getConfig", "(", ").", "getClientLockoutPolicy", "(", ");", "return", "res", ".", "getLockoutAfterFailures", "(", ")", "!", "=", "-", "1", "?", "res", ":", "defaultLockoutPolicy", ";", "}", "else", "{", "return", "disabledLockoutPolicy", ";", "}", "}", "@", "Override", "@", "@", "-", "22", ",", "4", "+", "29", ",", "9", "@", "@", "public", "LockoutPolicy", "getDefaultLockoutPolicy", "(", ")", "{", "public", "void", "setDefaultLockoutPolicy", "(", "LockoutPolicy", "defaultLockoutPolicy", ")", "{", "this", ".", "defaultLockoutPolicy", "=", "defaultLockoutPolicy", ";", "}", "public", "ClientLockoutPolicyRetriever", "setEnabled", "(", "boolean", "enabled", ")", "{", "isEnabled", "=", "enabled", ";", "return", "this", ";", "}", "}", "@", "@", "-", "44", ",", "10", "+", "44", ",", "6", "@", "@", "public", "CommonLoginPolicy", "(", "UaaAuditService", "auditService", ",", "public", "Result", "isAllowed", "(", "String", "principalId", ")", "{", "LockoutPolicy", "lockoutPolicy", "=", "lockoutPolicyRetriever", ".", "getLockoutPolicy", "(", ");", "if", "(", "!", "lockoutPolicy", ".", "isLockoutEnabled", "(", "))", "{", "return", "new", "Result", "(", "true", ",", "0", ")", ";", "}", "long", "eventsAfter", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "lockoutPolicy", ".", "getCountFailuresWithin", "(", ")", "*", "1000", ";", "List", "<", "AuditEvent", ">", "events", "=", "auditService", ".", "find", "(", "principalId", ",", "eventsAfter", ")", ";", "@", "@", "-", "255", ",", "6", "+", "255", ",", "7", "@", "@", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "clientLockoutPolicyRetriever", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "manager", ".", "ClientLockoutPolicyRetriever", "\"", ">", "<", "property", "name", "=", "\"", "enabled", "\"", "value", "=", "\"$", "{", "authentication", ".", "policy", ".", "client", ".", "lockoutEnabled", ":", "false", "}", "\"", "/", ">", "<", "property", "name", "=", "\"", "defaultLockoutPolicy", "\"", "ref", "=", "\"", "defaultClientLockoutPolicy", "\"", "/", ">", "<", "/", "bean", ">", "@", "@", "-", "573", ",", "11", "+", "574", ",", "11", "@", "@", "<", "bean", "id", "=", "\"", "defaultClientLockoutPolicy", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "LockoutPolicy", "\"", ">", "<", "property", "name", "=", "\"", "lockoutAfterFailures", "\"", "value", "=", "\"$", "{", "authentication", ".", "policy", ".", "global", ".", "lockoutAfterFailures", ":", "5", "}", "\"/", ">", "value", "=", "\"$", "{", "authentication", ".", "policy", ".", "global", ".", "lockoutAfterFailures", ":", "-", "1", "}", "\"/", ">", "<", "property", "name", "=", "\"", "countFailuresWithin", "\"", "value", "=", "\"$", "{", "authentication", ".", "policy", ".", "global", ".", "countFailuresWithinSeconds", ":", "-", "1", "}", "\"/", ">", "<", "property", "name", "=", "\"", "lockoutPeriodSeconds", "\"", "value", "=", "\"$", "{", "authentication", ".", "policy", ".", "global", ".", "lockoutPeriodSeconds", ":", "300", "}", "\"/", ">", "value", "=", "\"$", "{", "authentication", ".", "policy", ".", "global", ".", "lockoutPeriodSeconds", ":", "-", "1", "}", "\"/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "globalUserLockoutPolicyRetriever", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "manager", ".", "UserLockoutPolicyRetriever", "\"", ">", "@", "@", "-", "25", ",", "12", "+", "25", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "jwt", ".", "Jwt", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "jwt", ".", "JwtHelper", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "Claims", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "CompositeAccessToken", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "JdbcRevocableTokenProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "RevocableToken", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "RevocableTokenProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "*;", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProvider", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "PasswordPolicy", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "UaaIdentityProviderDefinition", ";", "@", "@", "-", "81", ",", "69", "+", "76", ",", "30", "@", "@", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "URLDecoder", ";", "import", "java", ".", "sql", ".", "Timestamp", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Calendar", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "java", ".", "util", ".", "*;", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "CookieCsrfPostProcessor", ".", "cookieCsrf", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "createClient", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "createUser", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "getClientCredentialsOAuthAccessToken", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "getUserOAuthAccessToken", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "setDisableInternalAuth", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "*;", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "UaaTokenServicesTests", ".", "PASSWORD", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "JTI", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "ID_TOKEN_HINT_PROMPT", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "ID_TOKEN_HINT_PROMPT_NONE", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "OPAQUE", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "REFRESH_TOKEN_SUFFIX", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "REQUEST_TOKEN_FORMAT", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "*;", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "UaaSavedRequestAwareAuthenticationSuccessHandler", ".", "FORM_REDIRECT_PARAMETER", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "UaaSavedRequestAwareAuthenticationSuccessHandler", ".", "SAVED_REQUEST_SESSION_ATTRIBUTE", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsInAnyOrder", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "endsWith", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "greaterThan", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "lessThanOrEqualTo", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "stringContainsInOrder", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "*;", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "Is", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "StringStartsWith", ".", "startsWith", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "springframework", ".", "http", ".", "HttpHeaders", ".", "AUTHORIZATION", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "APPLICATION_FORM_URLENCODED", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "MediaType", ".", "APPLICATION_JSON", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "OAuth2AccessToken", ".", "ACCESS_TOKEN", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "OAuth2AccessToken", ".", "REFRESH_TOKEN", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "OAuth2Utils", ".", "GRANT_TYPE", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "delete", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "get", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "post", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "*;", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultHandlers", ".", "print", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "cookie", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "forwardedUrl", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "header", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "model", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "*;", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "request", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "status", ";", "public", "class", "TokenMvcMockTests", "extends", "AbstractTokenMockMvcTests", "{", "@", "@", "-", "2352", ",", "17", "+", "2308", ",", "8", "@", "@", "public", "void", "clientCredentials_byDefault_willNotLockoutClientsUsingFormData", "(", ")", "thr", "String", "clientId", "=", "\"", "testclient", "\"", "+", "generator", ".", "generate", "(", ");", "String", "scopes", "=", "\"", "space", ".", "*.", "developer", ",", "space", ".", "*.", "admin", ",", "org", ".", "*.", "reader", ",", "org", ".", "123", "*", ".", "admin", ",", "*.", "*,", "*\"", ";", "setUpClients", "(", "clientId", ",", "scopes", ",", "scopes", ",", "GRANT_TYPES", ",", "true", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "6", ";", "i", "+", "+)", "{", "getMockMvc", "(", ")", ".", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_FORM_URLENCODED_VALUE", ")", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", ")", ".", "param", "(", "\"", "client_id", "\"", ",", "clientId", ")", ".", "param", "(", "\"", "client_secret", "\"", ",", "BADSECRET", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isUnauthorized", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "tryLoginWithWrongSecretInBody", "(", "clientId", ")", ";", "}", "getMockMvc", "(", ")", "@", "@", "-", "2383", ",", "57", "+", "2330", ",", "53", "@", "@", "public", "void", "clientCredentials_byDefault_WillNotLockoutDuringFailedBasicAuth", "(", ")", "th", "setUpClients", "(", "clientId", ",", "scopes", ",", "scopes", ",", "GRANT_TYPES", ",", "true", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "6", ";", "i", "+", "+)", "{", "getMockMvc", "(", ")", ".", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Basic", "\"", "+", "new", "String", "(", "Base64", ".", "encode", "(", "(", "clientId", "+", "\"", ":\"", "+", "BADSECRET", ")", ".", "getBytes", "(", "))", "))", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isUnauthorized", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "tryLoginWithWrongSecretInHeader", "(", "clientId", ")", ";", "}", "getMockMvc", "(", ")", ".", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Basic", "\"", "+", "new", "String", "(", "Base64", ".", "encode", "(", "(", "clientId", "+", "\"", ":\"", "+", "SECRET", ")", ".", "getBytes", "(", "))", "))", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "login", "(", "clientId", ")", ";", "}", "@", "Test", "public", "void", "clientCredentials_byDefault_WillNotLockoutDuringFailedBasicAuthAndFormData", "(", ")", "throws", "Exception", "{", "String", "clientId", "=", "\"", "testclient", "\"", "+", "generator", ".", "generate", "(", ");", "String", "scopes", "=", "\"", "space", ".", "*.", "developer", ",", "space", ".", "*.", "admin", ",", "org", ".", "*.", "reader", ",", "org", ".", "123", "*", ".", "admin", ",", "*.", "*,", "*\"", ";", "setUpClients", "(", "clientId", ",", "scopes", ",", "scopes", ",", "GRANT_TYPES", ",", "true", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "3", ";", "i", "+", "+)", "{", "tryLoginWithWrongSecretInHeader", "(", "clientId", ")", ";", "tryLoginWithWrongSecretInBody", "(", "clientId", ")", ";", "}", "login", "(", "clientId", ")", ";", "}", "String", "body", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "3", ";", "i", "+", "+)", "{", "body", "=", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", "private", "void", "tryLoginWithWrongSecretInHeader", "(", "String", "clientId", ")", "throws", "Exception", "{", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Basic", "\"", "+", "new", "String", "(", "Base64", ".", "encode", "(", "(", "clientId", "+", "\"", ":\"", "+", "BADSECRET", ")", ".", "getBytes", "(", "))", "))", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", ")", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isUnauthorized", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "}", "body", "=", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_FORM_URLENCODED_VALUE", ")", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", ")", ".", "param", "(", "\"", "client_id", "\"", ",", "clientId", ")", ".", "param", "(", "\"", "client_secret", "\"", ",", "BADSECRET", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isUnauthorized", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "}", "private", "void", "tryLoginWithWrongSecretInBody", "(", "String", "clientId", ")", "throws", "Exception", "{", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_FORM_URLENCODED_VALUE", ")", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", ")", ".", "param", "(", "\"", "client_id", "\"", ",", "clientId", ")", ".", "param", "(", "\"", "client_secret", "\"", ",", "BADSECRET", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isUnauthorized", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "}", "body", "=", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", "private", "void", "login", "(", "String", "clientId", ")", "throws", "Exception", "{", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "oauth", "/", "token", "\"", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Basic", "\"", "+", "new", "String", "(", "Base64", ".", "encode", "(", "(", "clientId", "+", "\"", ":\"", "+", "SECRET", ")", ".", "getBytes", "(", "))", "))", ".", "param", "(", "\"", "grant_type", "\"", ",", "\"", "client_credentials", "\"", ")", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", ");", "}"], "docstring_tokens": ["using", "the", "lockout", "feature"]}
{"contents": ["ext4:", "add", "corruption", "check", "in", "ext4_xattr_set_entry()", "In", "theory", "this", "should", "have", "been", "caught", "earlier", "when", "the", "xattr", "list", "was", "verified,", "but", "in", "case", "it", "got", "missed,", "it's", "simple", "enough", "to", "add", "check", "to", "make", "sure", "we", "don't", "overrun", "the", "xattr", "buffer.", "This", "addresses", ".", "https://bugzilla.kernel.org/show_bug.cgi?id=200001", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>", "Reviewed-by:", "Andreas", "Dilger", "<adilger@dilger.ca>", "Cc:", "stable@kernel.org"], "code_tokens": ["@", "@", "-", "1560", ",", "7", "+", "1560", ",", "7", "@", "@", "static", "int", "ext4_xattr_set_entry", "(", "struct", "ext4_xattr_info", "*", "i", ",", "handle_t", "*", "handle", ",", "struct", "inode", "*", "inode", ",", "bool", "is_block", ")", "{", "struct", "ext4_xattr_entry", "*", "last", ";", "struct", "ext4_xattr_entry", "*", "last", ",", "*", "next", ";", "struct", "ext4_xattr_entry", "*", "here", "=", "s", "-", ">", "here", ";", "size_t", "min_offs", "=", "s", "-", ">", "end", "-", "s", "-", ">", "base", ",", "name_len", "=", "strlen", "(", "i", "-", ">", "name", ")", ";", "int", "in_inode", "=", "i", "-", ">", "in_inode", ";", "@", "@", "-", "1595", ",", "7", "+", "1595", ",", "13", "@", "@", "static", "int", "ext4_xattr_set_entry", "(", "struct", "ext4_xattr_info", "*", "i", ",", "/", "*", "Compute", "min_offs", "and", "last", ".", "*", "/", "last", "=", "s", "-", ">", "first", ";", "for", "(", ";", "!", "IS_LAST_ENTRY", "(", "last", ")", ";", "last", "=", "EXT4_XATTR_NEXT", "(", "last", ")", ")", "{", "for", "(", ";", "!", "IS_LAST_ENTRY", "(", "last", ")", ";", "last", "=", "next", ")", "{", "next", "=", "EXT4_XATTR_NEXT", "(", "last", ")", ";", "if", "(", "(", "void", "*", ")", "next", ">", "=", "s", "-", ">", "end", ")", "{", "EXT4_ERROR_INODE", "(", "inode", ",", "\"", "corrupted", "xattr", "entries", "\"", ");", "ret", "=", "-", "EFSCORRUPTED", ";", "goto", "out", ";", "}", "if", "(", "!", "last", "-", ">", "e_value_inum", "&", "&", "last", "-", ">", "e_value_size", ")", "{", "size_t", "offs", "=", "le16_to_cpu", "(", "last", "-", ">", "e_value_offs", ")", ";", "if", "(", "offs", "<", "min_offs", ")"], "docstring_tokens": ["by", "renaming", "a", "file", "in", "a", "crafted", "ext4", "filesystem", "image", "."]}
{"contents": ["SECURITY-565#", "Enforce", "permission", "and", "access", "credential", "from", "user", "store"], "code_tokens": ["@", "@", "-", "98", ",", "6", "+", "98", ",", "13", "@", "@", "public", "String", "getCredentialId", "(", ")", "{", "return", "null", ";", "}", "StandardUsernamePasswordCredentials", "getCredential", "(", "String", "apiUrl", ")", "{", "String", "credentialId", "=", "createCredentialId", "(", "apiUrl", ")", ";", "return", "CredentialsUtils", ".", "findCredential", "(", "credentialId", ",", "StandardUsernamePasswordCredentials", ".", "class", ",", "new", "BlueOceanDomainRequirement", "(", "))", ";", "}", "@", "Override", "public", "Container", "<", "ScmOrganization", ">", "getOrganizations", "(", ")", "{", "User", "authenticatedUser", "=", "getAuthenticatedUser", "(", ");", "@", "@", "-", "1", ",", "24", "+", "1", ",", "35", "@", "@", "package", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ";", "import", "com", ".", "cloudbees", ".", "jenkins", ".", "plugins", ".", "bitbucket", ".", "BitbucketSCMSource", ";", "import", "com", ".", "cloudbees", ".", "jenkins", ".", "plugins", ".", "bitbucket", ".", "endpoints", ".", "BitbucketEndpointConfiguration", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Preconditions", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "cloud", ".", "BitbucketCloudScm", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "model", ".", "BbBranch", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "model", ".", "BbSaveContentResponse", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "server", ".", "BitbucketServerScm", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ErrorMessage", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "Reachable", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "factory", ".", "organization", ".", "OrganizationFactory", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "hal", ".", "Link", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "AbstractScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "GitContent", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmContentProviderParams", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmFile", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "model", ".", "BlueOrganization", ";", "import", "jenkins", ".", "branch", ".", "MultiBranchProject", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMNavigator", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMSource", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "binary", ".", "Base64", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "digest", ".", "DigestUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Stapler", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "@", "@", "-", "192", ",", "16", "+", "203", ",", "47", "@", "@", "protected", "String", "apiUrl", "(", "@", "Nonnull", "SCMNavigator", "scmNavigator", ")", "{", "}", "@", "Override", "protected", "String", "credentialId", "(", "@", "Nonnull", "SCMSource", "scmSource", ")", "{", "if", "(", "scmSource", "instanceof", "BitbucketSCMSource", ")", "{", "return", "(", "(", "BitbucketSCMSource", ")", "scmSource", ")", ".", "getCredentialsId", "(", ");", "@", "Nonnull", "protected", "StandardUsernamePasswordCredentials", "getCredentialForUser", "(", "@", "Nonnull", "final", "Item", "item", ",", "@", "Nonnull", "String", "apiUrl", ")", "{", "User", "user", "=", "User", ".", "current", "(", ");", "if", "(", "user", "=", "=", "null", ")", "{", "/", "/", "ensure", "this", "session", "has", "authenticated", "user", "throw", "new", "ServiceException", ".", "UnauthorizedException", "(", "\"", "No", "logged", "in", "user", "found", "\"", ");", "}", "return", "null", ";", "}", "@", "Override", "protected", "String", "credentialId", "(", "@", "Nonnull", "SCMNavigator", "scmNavigator", ")", "{", "return", "null", ";", "StaplerRequest", "request", "=", "Stapler", ".", "getCurrentRequest", "(", ");", "String", "scmId", "=", "request", ".", "getParameter", "(", "\"", "scmId", "\"", ");", "/", "/", "get", "credential", "for", "this", "user", "AbstractBitbucketScm", "scm", ";", "final", "BlueOrganization", "organization", "=", "OrganizationFactory", ".", "getInstance", "(", ").", "getContainingOrg", "(", "item", ")", ";", "if", "(", "BitbucketEndpointConfiguration", ".", "normalizeServerUrl", "(", "apiUrl", ")", ".", "startsWith", "(", "BitbucketEndpointConfiguration", ".", "normalizeServerUrl", "(", "BitbucketCloudScm", ".", "API_URL", ")", ")", "/", "/", "tests", "might", "add", "scmId", "to", "indicate", "which", "Scm", "should", "be", "used", "to", "find", "credential", "/", "/", "We", "have", "to", "do", "this", "because", "apiUrl", "might", "be", "of", "WireMock", "server", "and", "not", "Github", "|", "|", "(", "StringUtils", ".", "isNotBlank", "(", "scmId", ")", "&", "&", "scmId", ".", "equals", "(", "BitbucketCloudScm", ".", "ID", ")", "))", "{", "scm", "=", "new", "BitbucketCloudScm", "(", "new", "Reachable", "(", ")", "{", "@", "Override", "public", "Link", "getLink", "(", ")", "{", "Preconditions", ".", "checkNotNull", "(", "organization", ")", ";", "return", "organization", ".", "getLink", "(", ").", "rel", "(", "\"", "scm", "\"", ");", "}", "}", ");", "}", "else", "{", "/", "/", "server", "scm", "=", "new", "BitbucketServerScm", "(", "(", "new", "Reachable", "(", ")", "{", "@", "Override", "public", "Link", "getLink", "(", ")", "{", "Preconditions", ".", "checkNotNull", "(", "organization", ")", ";", "return", "organization", ".", "getLink", "(", ").", "rel", "(", "\"", "scm", "\"", ");", "}", "}", "))", ";", "}", "/", "/", "pick", "up", "github", "credential", "from", "user", "'", "s", "store", "StandardUsernamePasswordCredentials", "credential", "=", "scm", ".", "getCredential", "(", "BitbucketEndpointConfiguration", ".", "normalizeServerUrl", "(", "apiUrl", ")", ");", "if", "(", "credential", "=", "=", "null", ")", "{", "throw", "new", "ServiceException", ".", "PreconditionRequired", "(", "\"", "Can", "'", "t", "access", "content", "from", "Bitbucket", ":", "no", "credential", "found", "\"", ");", "}", "return", "credential", ";", "}", "}", "}", "@", "@", "-", "6", ",", "6", "+", "6", ",", "7", "@", "@", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableMap", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "cloud", ".", "BitbucketCloudScm", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "PipelineBaseTest", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "57", ",", "8", "+", "58", ",", "7", "@", "@", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "this", ".", "apiUrl", "=", "String", ".", "format", "(", "\"", "http", ":", "//", "localhost", ":", "%", "s", "\"", ",", "bitbucketApi", ".", "port", "(", "))", ";", "}", "protected", "String", "createCredential", "(", "String", "scmId", ",", "String", "apiMode", ")", "throws", "IOException", ",", "UnirestException", "{", "User", "user", "=", "login", "(", ");", "protected", "String", "createCredential", "(", "String", "scmId", ",", "String", "apiMode", ",", "User", "user", ")", "throws", "IOException", ",", "UnirestException", "{", "RequestBuilder", "builder", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "200", ")", "@", "@", "-", "71", ",", "14", "+", "71", ",", "22", "@", "@", "protected", "String", "createCredential", "(", "String", "scmId", ",", "String", "apiMode", ")", "throws", "IOExcepti", "}", "Map", "r", "=", "builder", ".", "build", "(", "Map", ".", "class", ")", ";", "assertNotNull", "(", "r", ")", ";", "String", "credentialId", "=", "(", "String", ")", "r", ".", "get", "(", "\"", "credentialId", "\"", ");", "assertNotNull", "(", "credentialId", ")", ";", "return", "credentialId", ";", "}", "protected", "String", "createCredential", "(", "String", "scmId", ",", "User", "user", ")", "throws", "IOException", ",", "UnirestException", "{", "String", "apiMode", "=", "\"", "server", "\"", ";", "if", "(", "scmId", ".", "equals", "(", "BitbucketCloudScm", ".", "ID", ")", "){", "apiMode", "=", "\"", "cloud", "\"", ";", "}", "return", "createCredential", "(", "scmId", ",", "apiMode", ",", "user", ")", ";", "}", "protected", "String", "createCredential", "(", "String", "scmId", ")", "throws", "IOException", ",", "UnirestException", "{", "return", "createCredential", "(", "scmId", ",", "\"", "server", "\"", ");", "User", "user", "=", "login", "(", ");", "return", "createCredential", "(", "scmId", ",", "user", ")", ";", "}", "}", "@", "@", "-", "17", ",", "7", "+", "17", ",", "7", "@", "@", "public", "class", "BbCloudPipelineCreateRequestTest", "extends", "BbCloudWireMock", "{", "@", "Test", "public", "void", "createPipeline", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ")", ";", "Map", "r", "=", "new", "PipelineBaseTest", ".", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "201", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "authenticatedUser", ".", "getId", "(", "),", "authenticatedUser", ".", "getId", "(", "))", ")", "@", "@", "-", "6", ",", "10", "+", "6", ",", "13", "@", "@", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "tasks", ".", "Mailer", ";", "import", "hudson", ".", "util", ".", "DescribableList", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "BitbucketApi", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "BitbucketScmSaveFileRequest", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "server", ".", "BitbucketServerScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "ScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "credential", ".", "BlueOceanCredentialsProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "GitContent", ";", "@", "@", "-", "30", ",", "12", "+", "33", ",", "8", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "mock", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "mockStatic", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "when", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "*;", "/", "**", "*", "@", "author", "Vivek", "Pandey", "@", "@", "-", "46", ",", "7", "+", "45", ",", "7", "@", "@", "public", "class", "BitbucketCloudScmContentProviderTest", "extends", "BbCloudWireMock", "{", "@", "Test", "public", "void", "getContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "credentialId", ")", ";", "@", "@", "-", "57", ",", "9", "+", "56", ",", "32", "@", "@", "public", "void", "getContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "assertEquals", "(", "\"", "vivekp7", "\"", ",", "content", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "unauthorizedAccessToContentShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ",", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "aliceCredentialId", ",", "alice", ")", ";", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "BitbucketCloudScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "Bitbucket", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "newContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "credentialId", ")", ";", "@", "@", "-", "91", ",", "7", "+", "113", ",", "7", "@", "@", "public", "void", "newContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "@", "Test", "public", "void", "checkScmProperties", "(", ")", "throws", "Exception", "{", "/", "/", "ensure", "cloud", "provider", "works", "with", "cloud", "multibranch", "pipeline", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "authenticatedUser", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "credentialId", ")", ";", "ScmContentProvider", "provider", "=", "new", "BitbucketCloudScmContentProvider", "(", ");", "/", "/", "unfortunately", "overriding", "the", "apiUrl", "for", "WireMock", "returns", "a", "\"", "localhost", "\"", "URL", "here", ",", "so", "we", "mock", "the", "call", "@", "@", "-", "104", ",", "18", "+", "126", ",", "59", "@", "@", "public", "void", "checkScmProperties", "(", ")", "throws", "Exception", "{", "assertFalse", "(", "provider", ".", "support", "(", "mbp", ")", ");", "}", "@", "Test", "public", "void", "unauthorizedSaveContentShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "aliceCredentialId", ",", "alice", ")", ";", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\"", ")", ".", "branch", "(", "\"", "master", "\"", ").", "message", "(", "\"", "new", "commit", "\"", ").", "owner", "(", "\"", "TESTP", "\"", ").", "path", "(", "\"", "README", ".", "md", "\"", ").", "repo", "(", "\"", "pipeline", "-", "demo", "-", "test", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "BitbucketScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "BitbucketScmSaveFileRequest", "(", "content", ")", ");", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "new", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "README", ".", "md", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "master", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "pipeline", "-", "demo", "-", "test", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "try", "{", "new", "BitbucketCloudScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "Bitbucket", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "private", "StaplerRequest", "mockStapler", "(", "){", "mockStatic", "(", "Stapler", ".", "class", ")", ";", "StaplerRequest", "staplerRequest", "=", "mock", "(", "StaplerRequest", ".", "class", ")", ";", "when", "(", "Stapler", ".", "getCurrentRequest", "(", "))", ".", "thenReturn", "(", "staplerRequest", ")", ";", "when", "(", "staplerRequest", ".", "getRequestURI", "(", "))", ".", "thenReturn", "(", "\"", "http", ":", "//", "localhost", ":", "8080", "/", "jenkins", "/", "blue", "/", "rest", "/", "\")", ";", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "path", "\"", "))", ".", "thenReturn", "(", "\"", "Jenkinsfile", "\"", ");", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "repo", "\"", "))", ".", "thenReturn", "(", "\"", "demo1", "\"", ");", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "scmId", "\"", "))", ".", "thenReturn", "(", "BitbucketCloudScm", ".", "ID", ")", ";", "when", "(", "staplerRequest", ".", "getHeader", "(", "BitbucketApi", ".", "X_BB_API_TEST_MODE_HEADER", ")", ").", "thenReturn", "(", "\"", "cloud", "\"", ");", "return", "staplerRequest", ";", "}", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ")", "{", "return", "mockMbp", "(", "credentialId", ",", "authenticatedUser", ")", ";", "}", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ",", "User", "user", ")", "{", "MultiBranchProject", "mbp", "=", "mock", "(", "MultiBranchProject", ".", "class", ")", ";", "when", "(", "mbp", ".", "getName", "(", "))", ".", "thenReturn", "(", "\"", "pipeline1", "\"", ");", "when", "(", "mbp", ".", "getParent", "(", "))", ".", "thenReturn", "(", "j", ".", "jenkins", ")", ";", "@", "@", "-", "130", ",", "7", "+", "193", ",", "7", "@", "@", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ")", "{", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", "folderProperty", "=", "mock", "(", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", ".", "class", ")", ";", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "properties", "=", "new", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "(", "mbp", ")", ";", "properties", ".", "add", "(", "new", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", "(", "authenticatedUser", ".", "getId", "(", "),", "credentialId", ",", "user", ".", "getId", "(", "),", "credentialId", ",", "BlueOceanCredentialsProvider", ".", "createDomain", "(", "apiUrl", ")", ")", ");", "Domain", "domain", "=", "mock", "(", "Domain", ".", "class", ")", ";", "@", "@", "-", "40", ",", "7", "+", "40", ",", "7", "@", "@", "public", "void", "getOrganizationsWithoutCredentialId", "(", ")", "throws", "IOException", ",", "UnirestExc", "@", "Test", "public", "void", "getOrganizations", "(", ")", "throws", "IOException", ",", "UnirestException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ")", ";", "List", "orgs", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "authenticatedUser", ".", "getId", "(", "),", "authenticatedUser", ".", "getId", "(", "))", ")", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "public", "void", "getOrganizations", "(", ")", "throws", "IOException", ",", "UnirestException", "{", "@", "Test", "public", "void", "getRepositories", "(", ")", "throws", "IOException", ",", "UnirestException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ",", "\"", "cloud", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketCloudScm", ".", "ID", ")", ";", "Map", "repoResp", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "authenticatedUser", ".", "getId", "(", "),", "authenticatedUser", ".", "getId", "(", "))", ")", "@", "@", "-", "6", ",", "11", "+", "6", ",", "12", "@", "@", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "tasks", ".", "Mailer", ";", "import", "hudson", ".", "util", ".", "DescribableList", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "AbstractBitbucketScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "BitbucketScmSaveFileRequest", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "cloud", ".", "BitbucketCloudScm", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_bitbucket_pipeline", ".", "cloud", ".", "BitbucketCloudScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "ScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "credential", ".", "BlueOceanCredentialsProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "GitContent", ";", "@", "@", "-", "31", ",", "9", "+", "32", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "*;", "/", "**", "@", "@", "-", "57", ",", "6", "+", "56", ",", "28", "@", "@", "public", "void", "getContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "assertEquals", "(", "\"", "TESTP", "\"", ",", "content", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "unauthorizedAccessToContentShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createCredential", "(", "BitbucketServerScm", ".", "ID", ",", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "aliceCredentialId", ",", "alice", ")", ";", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "BitbucketServerScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "Bitbucket", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "newContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketServerScm", ".", "ID", ")", ";", "@", "@", "-", "74", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "newContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "README", ".", "md", "\\", "\",", "\\", "n", "\"", "+", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "master", "\\", "\",", "\\", "n", "\"", "+", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "pipeline", "-", "demo", "-", "test", "\\", "\",", "\\", "n", "\"", "+", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\\", "\"\"", "+", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+", "\"", "\\\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "+", "\"", "}\"", ";", "@", "@", "-", "88", ",", "6", "+", "109", ",", "44", "@", "@", "public", "void", "newContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "assertEquals", "(", "\"", "master", "\"", ",", "respContent", ".", "getContent", "(", ").", "getBranch", "(", "))", ";", "}", "@", "Test", "public", "void", "unauthorizedSaveContentShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createCredential", "(", "BitbucketServerScm", ".", "ID", ",", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "aliceCredentialId", ",", "alice", ")", ";", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\"", ")", ".", "branch", "(", "\"", "master", "\"", ").", "message", "(", "\"", "new", "commit", "\"", ").", "owner", "(", "\"", "TESTP", "\"", ").", "path", "(", "\"", "README", ".", "md", "\"", ").", "repo", "(", "\"", "pipeline", "-", "demo", "-", "test", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "BitbucketScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "BitbucketScmSaveFileRequest", "(", "content", ")", ");", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "new", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "README", ".", "md", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "master", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "pipeline", "-", "demo", "-", "test", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+", "\"", "\\\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "try", "{", "new", "BitbucketServerScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "Bitbucket", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "updateContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createCredential", "(", "BitbucketServerScm", ".", "ID", ")", ";", "@", "@", "-", "106", ",", "7", "+", "165", ",", "7", "@", "@", "public", "void", "updateContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "master", "\\", "\",", "\\", "n", "\"", "+", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "pipeline", "-", "demo", "-", "test", "\\", "\",", "\\", "n", "\"", "+", "\"", "\\", "\"", "commitId", "\\", "\"", ":", "\\", "\"", "0bae0ddbed2e897d3b44abc3aca9ba26e2f61710", "\\", "\",", "\\", "n", "\"", "+", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\\", "\"\"", "+", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+", "\"", "\\\"", "bm9kZXsKICBlY2hvICdoZWxsbyB3b3JsZCEnCn0K", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "+", "\"", "}\"", ";", "@", "@", "-", "123", ",", "7", "+", "182", ",", "7", "@", "@", "public", "void", "updateContent", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "@", "Test", "public", "void", "checkScmProperties", "(", ")", "throws", "Exception", "{", "/", "/", "ensure", "server", "provider", "works", "with", "server", "multibranch", "pipeline", "String", "credentialId", "=", "createCredential", "(", "BitbucketServerScm", ".", "ID", ",", "\"", "server", "\"", ");", "String", "credentialId", "=", "createCredential", "(", "BitbucketServerScm", ".", "ID", ",", "authenticatedUser", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "credentialId", ")", ";", "ScmContentProvider", "provider", "=", "new", "BitbucketServerScmContentProvider", "(", ");", "assertTrue", "(", "provider", ".", "support", "(", "mbp", ")", ");", "@", "@", "-", "134", ",", "7", "+", "193", ",", "7", "@", "@", "public", "void", "checkScmProperties", "(", ")", "throws", "Exception", "{", "assertFalse", "(", "provider", ".", "support", "(", "mbp", ")", ");", "}", "private", "StaplerRequest", "mockStapler", "(", "){", "private", "StaplerRequest", "mockStapler", "(", ")", "{", "mockStatic", "(", "Stapler", ".", "class", ")", ";", "StaplerRequest", "staplerRequest", "=", "mock", "(", "StaplerRequest", ".", "class", ")", ";", "when", "(", "Stapler", ".", "getCurrentRequest", "(", "))", ".", "thenReturn", "(", "staplerRequest", ")", ";", "@", "@", "-", "144", ",", "7", "+", "203", ",", "11", "@", "@", "private", "StaplerRequest", "mockStapler", "(", "){", "return", "staplerRequest", ";", "}", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ")", "{", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ")", "{", "return", "mockMbp", "(", "credentialId", ",", "authenticatedUser", ")", ";", "}", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ",", "User", "user", ")", "{", "MultiBranchProject", "mbp", "=", "mock", "(", "MultiBranchProject", ".", "class", ")", ";", "when", "(", "mbp", ".", "getName", "(", "))", ".", "thenReturn", "(", "\"", "pipeline1", "\"", ");", "when", "(", "mbp", ".", "getParent", "(", "))", ".", "thenReturn", "(", "j", ".", "jenkins", ")", ";", "@", "@", "-", "157", ",", "9", "+", "220", ",", "9", "@", "@", "private", "MultiBranchProject", "mockMbp", "(", "String", "credentialId", ")", "{", "/", "/", "mock", "blueocean", "credential", "provider", "stuff", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", "folderProperty", "=", "mock", "(", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", ".", "class", ")", ";", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "properties", "=", "new", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "(", "mbp", ")", ";", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "properties", "=", "new", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "(", "mbp", ")", ";", "properties", ".", "add", "(", "new", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", "(", "authenticatedUser", ".", "getId", "(", "),", "credentialId", ",", "user", ".", "getId", "(", "),", "credentialId", ",", "BlueOceanCredentialsProvider", ".", "createDomain", "(", "apiUrl", ")", ")", ");", "Domain", "domain", "=", "mock", "(", "Domain", ".", "class", ")", ";", "@", "@", "-", "5", ",", "11", "+", "5", ",", "9", "@", "@", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ErrorMessage", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "stapler", ".", "TreeResponse", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "credential", ".", "CredentialsUtils", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "Navigable", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "Reachable", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "hal", ".", "Link", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "credential", ".", "BlueOceanDomainRequirement", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "Scm", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmFactory", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmServerEndpointContainer", ";", "@", "@", "-", "51", ",", "8", "+", "49", ",", "7", "@", "@", "public", "GithubEnterpriseScm", "(", "Reachable", "parent", ")", "{", "@", "Override", "public", "String", "getCredentialId", "(", ")", "{", "String", "credentialId", "=", "createCredentialId", "(", "getUri", "(", "))", ";", "StandardUsernamePasswordCredentials", "githubCredential", "=", "CredentialsUtils", ".", "findCredential", "(", "credentialId", ",", "StandardUsernamePasswordCredentials", ".", "class", ",", "new", "BlueOceanDomainRequirement", "(", "))", ";", "StandardUsernamePasswordCredentials", "githubCredential", "=", "getCredential", "(", "getUri", "(", "))", ";", "if", "(", "githubCredential", "!", "=", "null", ")", "{", "return", "githubCredential", ".", "getId", "(", ");", "}", "@", "@", "-", "115", ",", "13", "+", "115", ",", "20", "@", "@", "public", "String", "getCredentialDomainName", "(", "){", "@", "Override", "public", "String", "getCredentialId", "(", "){", "StandardUsernamePasswordCredentials", "githubCredential", "=", "CredentialsUtils", ".", "findCredential", "(", "getId", "(", "),", "StandardUsernamePasswordCredentials", ".", "class", ",", "new", "BlueOceanDomainRequirement", "(", "))", ";", "StandardUsernamePasswordCredentials", "githubCredential", "=", "getCredential", "(", "getUri", "(", "))", ";", "if", "(", "githubCredential", "!", "=", "null", ")", "{", "return", "githubCredential", ".", "getId", "(", ");", "}", "return", "null", ";", "}", "StandardUsernamePasswordCredentials", "getCredential", "(", "String", "apiUrl", ")", "{", "String", "credentialId", "=", "createCredentialId", "(", "apiUrl", ")", ";", "return", "CredentialsUtils", ".", "findCredential", "(", "credentialId", ",", "StandardUsernamePasswordCredentials", ".", "class", ",", "new", "BlueOceanDomainRequirement", "(", "))", ";", "}", "@", "Override", "public", "Object", "getState", "(", ")", "{", "this", ".", "validateExistingAccessToken", "(", ");", "@", "@", "-", "225", ",", "17", "+", "232", ",", "22", "@", "@", "public", "boolean", "isOrganizationAvatarSupported", "(", ")", "{", "}", "catch", "(", "URISyntaxException", "ex", ")", "{", "throw", "new", "ServiceException", ".", "BadRequestException", "(", "new", "ErrorMessage", "(", "400", ",", "\"", "Invalid", "URI", ":", "\"", "+", "apiUri", ")", ");", "}", "if", "(", "apiUri", ".", "endsWith", "(", "\"/", "\")", ")", "{", "apiUri", "=", "apiUri", ".", "substring", "(", "0", ",", "apiUri", ".", "length", "(", ")", "-", "1", ")", ";", "}", "apiUri", "=", "normalizeUrl", "(", "apiUri", ")", ";", "}", "else", "{", "apiUri", "=", "\"", "\";", "}", "return", "apiUri", ";", "}", "static", "String", "normalizeUrl", "(", "@", "Nonnull", "String", "apiUrl", ")", "{", "if", "(", "apiUrl", ".", "endsWith", "(", "\"/", "\")", ")", "{", "apiUrl", "=", "apiUrl", ".", "substring", "(", "0", ",", "apiUrl", ".", "length", "(", ")", "-", "1", ")", ";", "}", "return", "apiUrl", ";", "}", "private", "static", "String", "getCredentialIdFromRequest", "(", "StaplerRequest", "request", ")", "{", "String", "credentialId", "=", "request", ".", "getParameter", "(", "CREDENTIAL_ID", ")", ";", "@", "@", "-", "1", ",", "22", "+", "1", ",", "30", "@", "@", "package", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_github_pipeline", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Preconditions", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ErrorMessage", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "Reachable", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "factory", ".", "organization", ".", "OrganizationFactory", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "hal", ".", "Link", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "GitContent", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "ScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "AbstractScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmContentProviderParams", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "model", ".", "BlueOrganization", ";", "import", "jenkins", ".", "branch", ".", "MultiBranchProject", ";", "import", "jenkins", ".", "branch", ".", "OrganizationFolder", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMNavigator", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMSource", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMNavigator", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMSource", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Stapler", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "@", "@", "-", "201", ",", "19", "+", "209", ",", "45", "@", "@", "protected", "String", "apiUrl", "(", "@", "Nonnull", "SCMNavigator", "scmNavigator", ")", "{", "}", "@", "Override", "protected", "String", "credentialId", "(", "@", "Nonnull", "SCMSource", "scmSource", ")", "{", "if", "(", "scmSource", "instanceof", "GitHubSCMSource", ")", "{", "return", "(", "(", "GitHubSCMSource", ")", "scmSource", ")", ".", "getScanCredentialsId", "(", ");", "protected", "StandardUsernamePasswordCredentials", "getCredentialForUser", "(", "final", "Item", "item", ",", "String", "apiUrl", ")", "{", "User", "user", "=", "User", ".", "current", "(", ");", "if", "(", "user", "=", "=", "null", ")", "{", "/", "/", "ensure", "this", "session", "has", "authenticated", "user", "throw", "new", "ServiceException", ".", "UnauthorizedException", "(", "\"", "No", "logged", "in", "user", "found", "\"", ");", "}", "return", "null", ";", "}", "@", "Override", "protected", "String", "credentialId", "(", "@", "Nonnull", "SCMNavigator", "scmNavigator", ")", "{", "if", "(", "scmNavigator", "instanceof", "GitHubSCMNavigator", ")", "{", "return", "(", "(", "GitHubSCMNavigator", ")", "scmNavigator", ")", ".", "getScanCredentialsId", "(", ");", "StaplerRequest", "request", "=", "Stapler", ".", "getCurrentRequest", "(", ");", "String", "scmId", "=", "request", ".", "getParameter", "(", "\"", "scmId", "\"", ");", "/", "/", "get", "credential", "for", "this", "user", "GithubScm", "scm", ";", "final", "BlueOrganization", "organization", "=", "OrganizationFactory", ".", "getInstance", "(", ").", "getContainingOrg", "(", "item", ")", ";", "if", "(", "apiUrl", ".", "startsWith", "(", "GitHubSCMSource", ".", "GITHUB_URL", ")", "/", "/", "tests", "might", "add", "scmId", "to", "indicate", "which", "Scm", "should", "be", "used", "to", "find", "credential", "/", "/", "We", "have", "to", "do", "this", "because", "apiUrl", "might", "be", "of", "WireMock", "server", "and", "not", "Github", "|", "|", "(", "StringUtils", ".", "isNotBlank", "(", "scmId", ")", "&", "&", "scmId", ".", "equals", "(", "GithubScm", ".", "ID", ")", "))", "{", "scm", "=", "new", "GithubScm", "(", "new", "Reachable", "(", ")", "{", "@", "Override", "public", "Link", "getLink", "(", ")", "{", "Preconditions", ".", "checkNotNull", "(", "organization", ")", ";", "return", "organization", ".", "getLink", "(", ").", "rel", "(", "\"", "scm", "\"", ");", "}", "}", ");", "}", "else", "{", "/", "/", "GHE", "scm", "=", "new", "GithubEnterpriseScm", "(", "(", "new", "Reachable", "(", ")", "{", "@", "Override", "public", "Link", "getLink", "(", ")", "{", "Preconditions", ".", "checkNotNull", "(", "organization", ")", ";", "return", "organization", ".", "getLink", "(", ").", "rel", "(", "\"", "scm", "\"", ");", "}", "}", "))", ";", "}", "return", "null", ";", "/", "/", "pick", "up", "github", "credential", "from", "user", "'", "s", "store", "StandardUsernamePasswordCredentials", "githubCredential", "=", "scm", ".", "getCredential", "(", "GithubScm", ".", "normalizeUrl", "(", "apiUrl", ")", ");", "if", "(", "githubCredential", "=", "=", "null", ")", "{", "throw", "new", "ServiceException", ".", "PreconditionRequired", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ");", "}", "return", "githubCredential", ";", "}", "}", "}", "@", "@", "-", "17", ",", "8", "+", "17", ",", "8", "@", "@", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "factory", ".", "organization", ".", "OrganizationFactory", ";", "import", "hudson", ".", "util", ".", "DescribableList", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "factory", ".", "organization", ".", "OrganizationFactory", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "PipelineBaseTest", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "credential", ".", "BlueOceanCredentialsProvider", ";", "import", "jenkins", ".", "branch", ".", "MultiBranchProject", ";", "@", "@", "-", "29", ",", "7", "+", "29", ",", "6", "@", "@", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMNavigator", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMSource", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Stapler", ";", "@", "@", "-", "47", ",", "9", "+", "46", ",", "7", "@", "@", "import", "static", "com", ".", "github", ".", "tomakehurst", ".", "wiremock", ".", "client", ".", "WireMock", ".", "urlMatching", ";", "import", "static", "com", ".", "github", ".", "tomakehurst", ".", "wiremock", ".", "core", ".", "WireMockConfiguration", ".", "wireMockConfig", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "mock", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "mockStatic", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "when", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "*;", "/", "**", "*", "@", "author", "Vivek", "Pandey", "@", "@", "-", "121", ",", "18", "+", "118", ",", "25", "@", "@", "public", "void", "tearDown", "(", ")", "{", "}", "protected", "String", "createGithubCredential", "(", ")", "throws", "UnirestException", "{", "return", "createGithubCredential", "(", "this", ".", "user", ")", ";", "}", "protected", "String", "createGithubCredential", "(", "User", "user", ")", "throws", "UnirestException", "{", "Map", "r", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "data", "(", "ImmutableMap", ".", "of", "(", "\"", "accessToken", "\"", ",", "accessToken", ")", ")", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "user", ".", "getId", "(", "),", "user", ".", "getId", "(", "))", ")", ".", "put", "(", "\"/", "organizations", "/", "\"", "+", "OrganizationFactory", ".", "getInstance", "(", ").", "list", "(", ").", "iterator", "(", ").", "next", "(", ").", "getName", "(", ")", "+", "\"", "/", "scm", "/", "github", "/", "validate", "/", "?", "apiUrl", "=", "\"+", "githubApiUrl", ")", ".", "build", "(", "Map", ".", "class", ")", ";", "String", "credentialId", "=", "(", "String", ")", "r", ".", "get", "(", "\"", "credentialId", "\"", ");", "assertEquals", "(", "\"", "github", "\"", ",", "credentialId", ")", ";", "assertEquals", "(", "GithubScm", ".", "ID", ",", "credentialId", ")", ";", "return", "credentialId", ";", "}", "protected", "String", "createGithubEnterpriseCredential", "(", ")", "throws", "UnirestException", "{", "return", "createGithubEnterpriseCredential", "(", "this", ".", "user", ")", ";", "}", "protected", "String", "createGithubEnterpriseCredential", "(", "User", "user", ")", "throws", "UnirestException", "{", "Map", "r", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "data", "(", "ImmutableMap", ".", "of", "(", "\"", "accessToken", "\"", ",", "accessToken", ")", ")", ".", "status", "(", "200", ")", "@", "@", "-", "3", ",", "11", "+", "3", ",", "9", "@", "@", "import", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableList", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableMap", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "ItemGroup", ";", "import", "hudson", ".", "model", ".", "TopLevelItem", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "factory", ".", "organization", ".", "OrganizationFactory", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "model", ".", "BlueOrganization", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "service", ".", "embedded", ".", "OrganizationFactoryImpl", ";", "@", "@", "-", "106", ",", "18", "+", "104", ",", "6", "@", "@", "private", "void", "createGithubOrgFolder", "(", "boolean", "shouldSuceed", ")", "throws", "Exception", "{", "}", "}", "private", "String", "createGithubCredential", "(", "User", "user", ")", "throws", "UnirestException", "{", "Map", "r", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "data", "(", "ImmutableMap", ".", "of", "(", "\"", "accessToken", "\"", ",", "\"", "12345", "\"", "))", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "user", ".", "getId", "(", "),", "user", ".", "getId", "(", "))", ")", ".", "put", "(", "\"/", "organizations", "/", "\"", "+", "getOrgName", "(", ")", "+", "\"", "/", "scm", "/", "github", "/", "validate", "/", "?", "apiUrl", "=", "\"+", "githubApiUrl", ")", ".", "build", "(", "Map", ".", "class", ")", ";", "assertEquals", "(", "\"", "github", "\"", ",", "r", ".", "get", "(", "\"", "credentialId", "\"", "))", ";", "return", "\"", "github", "\"", ";", "}", "private", "static", "String", "getOrgName", "(", ")", "{", "return", "OrganizationFactory", ".", "getInstance", "(", ").", "list", "(", ").", "iterator", "(", ").", "next", "(", ").", "getName", "(", ");", "}", "@", "@", "-", "269", ",", "18", "+", "269", ",", "6", "@", "@", "public", "void", "shouldFindUserStoreCredential", "(", ")", "throws", "IOException", "{", "assertEquals", "(", "\"", "System", "Github", "Access", "Token", "\"", ",", "c", ".", "getDescription", "(", "))", ";", "}", "private", "String", "createGithubCredential", "(", "User", "user", ")", "throws", "UnirestException", "{", "Map", "r", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "data", "(", "ImmutableMap", ".", "of", "(", "\"", "accessToken", "\"", ",", "\"", "12345", "\"", "))", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "user", ".", "getId", "(", "),", "user", ".", "getId", "(", "))", ")", ".", "put", "(", "\"/", "organizations", "/", "\"", "+", "getOrgName", "(", ")", "+", "\"", "/", "scm", "/", "github", "/", "validate", "/", "\")", ".", "build", "(", "Map", ".", "class", ")", ";", "assertEquals", "(", "\"", "github", "\"", ",", "r", ".", "get", "(", "\"", "credentialId", "\"", "))", ";", "return", "\"", "github", "\"", ";", "}", "private", "String", "getOrgName", "(", ")", "{", "return", "OrganizationFactory", ".", "getInstance", "(", ").", "list", "(", ").", "iterator", "(", ").", "next", "(", ").", "getName", "(", ");", "}", "@", "@", "-", "1", ",", "25", "+", "1", ",", "34", "@", "@", "package", "io", ".", "jenkins", ".", "blueocean", ".", "blueocean_github_pipeline", ";", "import", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "AbstractFolderProperty", ";", "import", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "AbstractFolderPropertyDescriptor", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "tasks", ".", "Mailer", ";", "import", "hudson", ".", "util", ".", "DescribableList", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "ScmContentProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "credential", ".", "BlueOceanCredentialsProvider", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "GitContent", ";", "import", "jenkins", ".", "branch", ".", "MultiBranchProject", ";", "import", "jenkins", ".", "branch", ".", "OrganizationFolder", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMNavigator", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMNavigator", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMSource", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Stapler", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "when", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ".", "*;", "/", "**", "*", "@", "author", "Vivek", "Pandey", "@", "@", "-", "32", ",", "7", "+", "41", ",", "23", "@", "@", "public", "void", "getContentForOrgFolder", "(", ")", "throws", "UnirestException", "{", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "credentialId", ")", ";", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "GithubFile", "content", "=", "(", "GithubFile", ")", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "assertEquals", "(", "\"", "Jenkinsfile", "\"", ",", "content", ".", "getContent", "(", ").", "getName", "(", "))", ";", "assertEquals", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ",", "content", ".", "getContent", "(", ").", "getSha", "(", "))", ";", "assertEquals", "(", "\"", "PR", "-", "demo", "\"", ",", "content", ".", "getContent", "(", ").", "getRepo", "(", "))", ";", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "content", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "getContentForOrgFolderGHE", "(", ")", "throws", "UnirestException", "{", "String", "credentialId", "=", "createGithubEnterpriseCredential", "(", ");", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "GithubFile", "content", "=", "(", "GithubFile", ")", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "assertEquals", "(", "\"", "Jenkinsfile", "\"", ",", "content", ".", "getContent", "(", ").", "getName", "(", "))", ";", "@", "@", "-", "47", ",", "7", "+", "72", ",", "24", "@", "@", "public", "void", "getContentForMbp", "(", ")", "throws", "UnirestException", "{", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "OrganizationFolder", "organizationFolder", "=", "mockOrgFolder", "(", "credentialId", ")", ";", "OrganizationFolder", "organizationFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "organizationFolder", ",", "credentialId", ")", ";", "GithubFile", "content", "=", "(", "GithubFile", ")", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "mbp", ")", ";", "assertEquals", "(", "\"", "Jenkinsfile", "\"", ",", "content", ".", "getContent", "(", ").", "getName", "(", "))", ";", "assertEquals", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ",", "content", ".", "getContent", "(", ").", "getSha", "(", "))", ";", "assertEquals", "(", "\"", "PR", "-", "demo", "\"", ",", "content", ".", "getContent", "(", ").", "getRepo", "(", "))", ";", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "content", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "getContentForMbpGHE", "(", ")", "throws", "UnirestException", "{", "String", "credentialId", "=", "createGithubEnterpriseCredential", "(", ");", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "OrganizationFolder", "organizationFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "organizationFolder", ",", "credentialId", ")", ";", "@", "@", "-", "58", ",", "6", "+", "100", ",", "99", "@", "@", "public", "void", "getContentForMbp", "(", ")", "throws", "UnirestException", "{", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "content", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "unauthorizedAccessToContentForOrgFolderShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "aliceCredentialId", ")", ";", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "unauthorizedAccessToContentForOrgFolderGHEShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubEnterpriseCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "aliceCredentialId", ")", ";", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "unauthorizedAccessToContentForMbpShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "OrganizationFolder", "organizationFolder", "=", "mockOrgFolder", "(", "alice", ",", "aliceCredentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "organizationFolder", ",", "aliceCredentialId", ")", ";", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "unauthorizedAccessToContentForMbpGHEShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubEnterpriseCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "OrganizationFolder", "organizationFolder", "=", "mockOrgFolder", "(", "alice", ",", "aliceCredentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "organizationFolder", ",", "aliceCredentialId", ")", ";", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "getContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "saveContentToOrgFolder", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createGithubCredential", "(", ");", "@", "@", "-", "69", ",", "7", "+", "204", ",", "7", "@", "@", "public", "void", "saveContentToOrgFolder", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "credentialId", ")", ";", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "+", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "+", "@", "@", "-", "91", ",", "6", "+", "226", ",", "121", "@", "@", "public", "void", "saveContentToOrgFolder", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "file", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "saveContentToOrgFolderGHE", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createGithubEnterpriseCredential", "(", ");", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\"", ")", ".", "branch", "(", "\"", "test1", "\"", ").", "message", "(", "\"", "another", "commit", "\"", ").", "owner", "(", "\"", "cloudbeers", "\"", ").", "path", "(", "\"", "Jankinsfile", "\"", ").", "repo", "(", "\"", "PR", "-", "demo", "\"", ").", "sha", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "first", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "Jenkinsfile", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "test1", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "PR", "-", "demo", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "sha", "\\", "\"", ":", "\\", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "GithubFile", "file", "=", "(", "GithubFile", ")", "new", "GithubScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "assertEquals", "(", "\"", "Jenkinsfile", "\"", ",", "file", ".", "getContent", "(", ").", "getName", "(", "))", ";", "assertEquals", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ",", "file", ".", "getContent", "(", ").", "getSha", "(", "))", ";", "assertEquals", "(", "\"", "PR", "-", "demo", "\"", ",", "file", ".", "getContent", "(", ").", "getRepo", "(", "))", ";", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "file", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "unauthorizedSaveContentToOrgFolderShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\"", ")", ".", "branch", "(", "\"", "test1", "\"", ").", "message", "(", "\"", "another", "commit", "\"", ").", "owner", "(", "\"", "cloudbeers", "\"", ").", "path", "(", "\"", "Jankinsfile", "\"", ").", "repo", "(", "\"", "PR", "-", "demo", "\"", ").", "sha", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "aliceCredentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "first", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "Jenkinsfile", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "test1", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "PR", "-", "demo", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "sha", "\\", "\"", ":", "\\", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "unauthorizedSaveContentToOrgFolderGHEShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubEnterpriseCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\"", ")", ".", "branch", "(", "\"", "test1", "\"", ").", "message", "(", "\"", "another", "commit", "\"", ").", "owner", "(", "\"", "cloudbeers", "\"", ").", "path", "(", "\"", "Jankinsfile", "\"", ").", "repo", "(", "\"", "PR", "-", "demo", "\"", ").", "sha", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "aliceCredentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "first", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "Jenkinsfile", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "test1", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "PR", "-", "demo", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "sha", "\\", "\"", ":", "\\", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "orgFolder", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "saveContentToMbp", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createGithubCredential", "(", ");", "@", "@", "-", "102", ",", "7", "+", "352", ",", "7", "@", "@", "public", "void", "saveContentToMbp", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "credentialId", ")", ";", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "orgFolder", ",", "credentialId", ")", ";", "@", "@", "-", "126", ",", "6", "+", "376", ",", "125", "@", "@", "public", "void", "saveContentToMbp", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "file", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "saveContentToMbpGHE", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createGithubEnterpriseCredential", "(", ");", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\"", ")", ".", "branch", "(", "\"", "test1", "\"", ").", "message", "(", "\"", "another", "commit", "\"", ").", "owner", "(", "\"", "cloudbeers", "\"", ").", "path", "(", "\"", "Jankinsfile", "\"", ").", "repo", "(", "\"", "PR", "-", "demo", "\"", ").", "sha", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "orgFolder", ",", "credentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "first", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "Jenkinsfile", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "test1", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "PR", "-", "demo", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "sha", "\\", "\"", ":", "\\", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "GithubFile", "file", "=", "(", "GithubFile", ")", "new", "GithubScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "mbp", ")", ";", "assertEquals", "(", "\"", "Jenkinsfile", "\"", ",", "file", ".", "getContent", "(", ").", "getName", "(", "))", ";", "assertEquals", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ",", "file", ".", "getContent", "(", ").", "getSha", "(", "))", ";", "assertEquals", "(", "\"", "PR", "-", "demo", "\"", ",", "file", ".", "getContent", "(", ").", "getRepo", "(", "))", ";", "assertEquals", "(", "\"", "cloudbeers", "\"", ",", "file", ".", "getContent", "(", ").", "getOwner", "(", "))", ";", "}", "@", "Test", "public", "void", "unauthorizedSaveContentToMbpShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", ");", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\"", ")", ".", "branch", "(", "\"", "test1", "\"", ").", "message", "(", "\"", "another", "commit", "\"", ").", "owner", "(", "\"", "cloudbeers", "\"", ").", "path", "(", "\"", "Jankinsfile", "\"", ").", "repo", "(", "\"", "PR", "-", "demo", "\"", ").", "sha", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "aliceCredentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "orgFolder", ",", "aliceCredentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "first", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "Jenkinsfile", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "test1", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "PR", "-", "demo", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "sha", "\\", "\"", ":", "\\", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "unauthorizedSaveContentToMbpGHEShouldFail", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "User", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "String", "aliceCredentialId", "=", "createGithubEnterpriseCredential", "(", "alice", ")", ";", "StaplerRequest", "staplerRequest", "=", "mockStapler", "(", "GithubEnterpriseScm", ".", "ID", ")", ";", "GitContent", "content", "=", "new", "GitContent", ".", "Builder", "(", ").", "autoCreateBranch", "(", "true", ")", ".", "base64Data", "(", "\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\"", ")", ".", "branch", "(", "\"", "test1", "\"", ").", "message", "(", "\"", "another", "commit", "\"", ").", "owner", "(", "\"", "cloudbeers", "\"", ").", "path", "(", "\"", "Jankinsfile", "\"", ").", "repo", "(", "\"", "PR", "-", "demo", "\"", ").", "sha", "(", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\"", ").", "build", "(", ");", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "aliceCredentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "orgFolder", ",", "aliceCredentialId", ")", ";", "String", "request", "=", "\"", "{\\", "n", "\"", "\"", "\\", "\"", "content", "\\", "\"", ":", "{", "\\", "n", "\"", "\"", "\\", "\"", "message", "\\", "\"", ":", "\\", "\"", "first", "commit", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "path", "\\", "\"", ":", "\\", "\"", "Jenkinsfile", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "branch", "\\", "\"", ":", "\\", "\"", "test1", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "repo", "\\", "\"", ":", "\\", "\"", "PR", "-", "demo", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "sha", "\\", "\"", ":", "\\", "\"", "e23b8ef5c2c4244889bf94db6c05cc08ea138aef", "\\", "\",", "\\", "n", "\"", "\"", "\\", "\"", "base64Data", "\\", "\"", ":", "\"", "+\"", "\\\"", "c2xlZXAgMTUKbm9kZSB7CiAgY2hlY2tvdXQgc2NtCiAgc2ggJ2xzIC1sJwp9", "\\", "\\", "nCnNsZWVwIDE1Cg", "=", "=\\", "\\", "n", "\\", "\"\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", ";", "when", "(", "staplerRequest", ".", "getReader", "(", "))", ".", "thenReturn", "(", "new", "BufferedReader", "(", "new", "StringReader", "(", "request", ")", ",", "request", ".", "length", "(", "))", ");", "try", "{", "/", "/", "Bob", "trying", "to", "access", "content", "but", "his", "credential", "is", "not", "setup", "so", "should", "fail", "new", "GithubScmContentProvider", "(", ").", "saveContent", "(", "staplerRequest", ",", "mbp", ")", ";", "}", "catch", "(", "ServiceException", ".", "PreconditionRequired", "e", ")", "{", "assertEquals", "(", "\"", "Can", "'", "t", "access", "content", "from", "github", ":", "no", "credential", "found", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "with", "PreConditionException", "\"", ");", "}", "@", "Test", "public", "void", "saveContentToMbpMissingBranch", "(", ")", "throws", "UnirestException", ",", "IOException", "{", "String", "credentialId", "=", "createGithubCredential", "(", ");", "@", "@", "-", "137", ",", "7", "+", "506", ",", "7", "@", "@", "public", "void", "saveContentToMbpMissingBranch", "(", ")", "throws", "UnirestException", ",", "IOException", "when", "(", "staplerRequest", ".", "bindJSON", "(", "Mockito", ".", "eq", "(", "GithubScmSaveFileRequest", ".", "class", ")", ",", "Mockito", ".", "any", "(", "JSONObject", ".", "class", ")", "))", ".", "thenReturn", "(", "new", "GithubScmSaveFileRequest", "(", "content", ")", ");", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "credentialId", ")", ";", "OrganizationFolder", "orgFolder", "=", "mockOrgFolder", "(", "user", ",", "credentialId", ")", ";", "MultiBranchProject", "mbp", "=", "mockMbp", "(", "orgFolder", ",", "credentialId", ")", ";", "@", "@", "-", "177", ",", "4", "+", "546", ",", "49", "@", "@", "public", "void", "testScmProperties", "(", ")", "throws", "Exception", "{", "assertFalse", "(", "provider", ".", "support", "(", "orgFolder", ")", ");", "}", "protected", "StaplerRequest", "mockStapler", "(", "){", "return", "mockStapler", "(", "\"", "github", "\"", ");", "}", "private", "StaplerRequest", "mockStapler", "(", "String", "scmId", ")", "{", "mockStatic", "(", "Stapler", ".", "class", ")", ";", "StaplerRequest", "staplerRequest", "=", "mock", "(", "StaplerRequest", ".", "class", ")", ";", "when", "(", "Stapler", ".", "getCurrentRequest", "(", "))", ".", "thenReturn", "(", "staplerRequest", ")", ";", "when", "(", "staplerRequest", ".", "getRequestURI", "(", "))", ".", "thenReturn", "(", "\"", "http", ":", "//", "localhost", ":", "8080", "/", "jenkins", "/", "blue", "/", "rest", "/", "\")", ";", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "path", "\"", "))", ".", "thenReturn", "(", "\"", "Jenkinsfile", "\"", ");", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "repo", "\"", "))", ".", "thenReturn", "(", "\"", "PR", "-", "demo", "\"", ");", "/", "/", "GithubScmContentProvider", "determines", "SCM", "using", "apiUrl", "but", "with", "wiremock", "/", "/", "apiUrl", "is", "localhost", "and", "not", "github", "so", "we", "use", "this", "parameter", "from", "test", "only", "to", "tell", "scm", "id", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "scmId", "\"", "))", ".", "thenReturn", "(", "scmId", ")", ";", "when", "(", "staplerRequest", ".", "getParameter", "(", "\"", "apiUrl", "\"", "))", ".", "thenReturn", "(", "githubApiUrl", ")", ";", "return", "staplerRequest", ";", "}", "private", "OrganizationFolder", "mockOrgFolder", "(", "User", "user", ",", "String", "credentialId", ")", "{", "OrganizationFolder", "orgFolder", "=", "mock", "(", "OrganizationFolder", ".", "class", ")", ";", "/", "/", "mock", "GithubSCMNavigator", "GitHubSCMNavigator", "navigator", "=", "mock", "(", "GitHubSCMNavigator", ".", "class", ")", ";", "when", "(", "navigator", ".", "getApiUri", "(", "))", ".", "thenReturn", "(", "githubApiUrl", ")", ";", "when", "(", "navigator", ".", "getScanCredentialsId", "(", "))", ".", "thenReturn", "(", "credentialId", ")", ";", "when", "(", "navigator", ".", "getRepoOwner", "(", "))", ".", "thenReturn", "(", "\"", "cloudbeers", "\"", ");", "when", "(", "(", "orgFolder", ")", ".", "getSCMNavigators", "(", "))", ".", "thenReturn", "(", "Lists", ".", "<", "SCMNavigator", ">", "newArrayList", "(", "navigator", ")", ");", "/", "/", "mock", "blueocean", "credential", "provider", "stuff", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", "folderProperty", "=", "mock", "(", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", ".", "class", ")", ";", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "properties", "=", "new", "DescribableList", "<", "AbstractFolderProperty", "<", "?>", ",", "AbstractFolderPropertyDescriptor", ">", "(", "orgFolder", ")", ";", "properties", ".", "add", "(", "new", "BlueOceanCredentialsProvider", ".", "FolderPropertyImpl", "(", "user", ".", "getId", "(", "),", "credentialId", ",", "BlueOceanCredentialsProvider", ".", "createDomain", "(", "githubApiUrl", ")", ")", ");", "when", "(", "orgFolder", ".", "getProperties", "(", "))", ".", "thenReturn", "(", "properties", ")", ";", "when", "(", "orgFolder", ".", "getParent", "(", "))", ".", "thenReturn", "(", "j", ".", "jenkins", ")", ";", "Domain", "domain", "=", "mock", "(", "Domain", ".", "class", ")", ";", "when", "(", "domain", ".", "getName", "(", "))", ".", "thenReturn", "(", "GithubScm", ".", "DOMAIN_NAME", ")", ";", "when", "(", "folderProperty", ".", "getDomain", "(", "))", ".", "thenReturn", "(", "domain", ")", ";", "return", "orgFolder", ";", "}", "}", "@", "@", "-", "2", ",", "12", "+", "2", ",", "18", "@", "@", "import", "hudson", ".", "model", ".", "BuildableItem", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "commons", ".", "ServiceException", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "Reachable", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "hal", ".", "Link", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "model", ".", "BluePipelineScm", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "acegisecurity", ".", "Authentication", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "/", "**", "*", "@", "author", "Vivek", "Pandey", "*", "/", "@", "@", "-", "24", ",", "6", "+", "30", ",", "7", "@", "@", "public", "ScmResourceImpl", "(", "Item", "item", ",", "BuildableItem", "branchJob", ",", "Reachable", "parent", ")", "{", "this", ".", "item", "=", "item", ";", "this", ".", "branchJob", "=", "branchJob", ";", "this", ".", "self", "=", "parent", ".", "getLink", "(", ").", "rel", "(", "\"", "scm", "\"", ");", "checkPermission", "(", ");", "}", "@", "Override", "@", "@", "-", "50", ",", "4", "+", "57", ",", "21", "@", "@", "public", "Object", "saveContent", "(", "StaplerRequest", "staplerRequest", ")", "{", "public", "Link", "getLink", "(", ")", "{", "return", "self", ";", "}", "private", "@", "Nonnull", "User", "checkPermission", "(", "){", "ACL", "acl", "=", "Jenkins", ".", "getInstance", "(", ").", "getACL", "(", ");", "Authentication", "a", "=", "Jenkins", ".", "getAuthentication", "(", ");", "User", "user", "=", "User", ".", "get", "(", "a", ")", ";", "if", "(", "user", "=", "=", "null", ")", "{", "throw", "new", "ServiceException", ".", "UnauthorizedException", "(", "\"", "No", "logged", "in", "user", "found", "\"", ");", "}", "if", "(", "!", "acl", ".", "hasPermission", "(", "a", ",", "Item", ".", "CONFIGURE", ")", "){", "throw", "new", "ServiceException", ".", "ForbiddenException", "(", "String", ".", "format", "(", "\"", "User", "%", "s", "must", "have", "Job", "configure", "permission", "to", "access", "content", "\"", ",", "a", ".", "getName", "(", "))", ");", "}", "return", "user", ";", "}", "}", "@", "@", "-", "1", ",", "13", "+", "1", ",", "12", "@", "@", "package", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "jenkins", ".", "branch", ".", "MultiBranchProject", ";", "import", "jenkins", ".", "branch", ".", "OrganizationFolder", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMNavigator", ";", "import", "jenkins", ".", "scm", ".", "api", ".", "SCMSource", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "Connector", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "GitHubSCMSource", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "@", "@", "-", "31", ",", "37", "+", "30", ",", "26", "@", "@", "public", "ScmContentProviderParams", "(", "Item", "item", ")", "{", "String", "apiUrl", "=", "null", ";", "String", "owner", "=", "null", ";", "String", "repo", "=", "null", ";", "String", "credentialId", "=", "null", ";", "if", "(", "item", "instanceof", "OrganizationFolder", ")", "{", "List", "<", "SCMNavigator", ">", "navigators", "=", "(", "(", "OrganizationFolder", ")", "item", ")", ".", "getSCMNavigators", "(", ");", "if", "(", "!", "navigators", ".", "isEmpty", "(", "))", "{", "SCMNavigator", "navigator", "=", "navigators", ".", "get", "(", "0", ")", ";", "apiUrl", "=", "apiUrl", "(", "navigator", ")", ";", "credentialId", "=", "credentialId", "(", "navigator", ")", ";", "owner", "=", "owner", "(", "navigator", ")", ";", "}", "}", "else", "if", "(", "item", "instanceof", "MultiBranchProject", ")", "{", "List", "<", "SCMSource", ">", "sources", "=", "(", "(", "MultiBranchProject", ")", "item", ")", ".", "getSCMSources", "(", ");", "if", "(", "!", "sources", ".", "isEmpty", "(", "))", "{", "SCMSource", "source", "=", "sources", ".", "get", "(", "0", ")", ";", "apiUrl", "=", "apiUrl", "(", "source", ")", ";", "credentialId", "=", "credentialId", "(", "source", ")", ";", "owner", "=", "owner", "(", "source", ")", ";", "repo", "=", "repo", "(", "source", ")", ";", "}", "}", "this", ".", "apiUrl", "=", "apiUrl", ";", "StandardUsernamePasswordCredentials", "cred", "=", "null", ";", "if", "(", "credentialId", "!", "=", "null", ")", "{", "StandardCredentials", "credentials", "=", "Connector", ".", "lookupScanCredentials", "(", "item", ",", "this", ".", "apiUrl", ",", "credentialId", ")", ";", "if", "(", "credentials", "instanceof", "StandardUsernamePasswordCredentials", ")", "{", "cred", "=", "(", "StandardUsernamePasswordCredentials", ")", "credentials", ";", "}", "}", "this", ".", "apiUrl", "=", "apiUrl", "=", "=", "null", "?", "GitHubSCMSource", ".", "GITHUB_URL", ":", "apiUrl", ";", ";", "this", ".", "owner", "=", "owner", ";", "this", ".", "repo", "=", "repo", ";", "this", ".", "credentials", "=", "cred", ";", "this", ".", "credentials", "=", "getCredentialForUser", "(", "item", ",", "this", ".", "apiUrl", ")", ";;", "}", "public", "String", "getApiUrl", "(", ")", "{", "@", "@", "-", "120", ",", "13", "+", "108", ",", "10", "@", "@", "public", "StandardUsernamePasswordCredentials", "getCredentials", "(", ")", "{", "protected", "abstract", "@", "CheckForNull", "String", "apiUrl", "(", "@", "Nonnull", "SCMNavigator", "scmNavigator", ")", ";", "/", "**", "*", "Gives", "credential", "id", "attached", "to", "SCMSource", "*", "Gives", "credential", "for", "SCM", "with", "this", "URL", "*", "@", "param", "item", "pipeline", "job", "item", "*", "@", "param", "apiUrl", "api", "url", "of", "scm", "provider", "*", "@", "return", "credential", "*", "/", "protected", "abstract", "@", "CheckForNull", "String", "credentialId", "(", "@", "Nonnull", "SCMSource", "scmSource", ")", ";", "/", "**", "*", "Gives", "credential", "id", "attached", "to", "SCMNavigator", "*", "/", "protected", "abstract", "@", "CheckForNull", "String", "credentialId", "(", "@", "Nonnull", "SCMNavigator", "scmNavigator", ")", ";", "protected", "abstract", "@", "Nonnull", "StandardUsernamePasswordCredentials", "getCredentialForUser", "(", "@", "Nonnull", "Item", "item", ",", "@", "Nonnull", "String", "apiUrl", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "156", "@", "@", "package", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableMap", ";", "import", "com", ".", "mashape", ".", "unirest", ".", "http", ".", "exceptions", ".", "UnirestException", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "tasks", ".", "Mailer", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmContent", ";", "import", "io", ".", "jenkins", ".", "blueocean", ".", "rest", ".", "impl", ".", "pipeline", ".", "scm", ".", "ScmFile", ";", "import", "jenkins", ".", "branch", ".", "MultiBranchProject", ";", "import", "jenkins", ".", "branch", ".", "OrganizationFolder", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "workflow", ".", "multibranch", ".", "WorkflowMultiBranchProject", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Exported", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutionException", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "/", "**", "*", "@", "author", "Vivek", "Pandey", "*", "/", "public", "class", "PipelineScmTest", "extends", "PipelineBaseTest", "{", "private", "User", "bob", ";", "private", "User", "alice", ";", "@", "Override", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "super", ".", "setup", "(", ");", "this", ".", "bob", "=", "login", "(", ");", "this", ".", "alice", "=", "j", ".", "jenkins", ".", "getUser", "(", "\"", "alice", "\"", ");", "alice", ".", "setFullName", "(", "\"", "Alice", "Cooper", "\"", ");", "alice", ".", "addProperty", "(", "new", "Mailer", ".", "UserProperty", "(", "\"", "alice", "@", "jenkins", "-", "ci", ".", "org", "\"", "))", ";", "}", "@", "Test", "public", "void", "unauthenticatedUserContentAccessShouldFail", "(", ")", "throws", "IOException", ",", "ExecutionException", ",", "InterruptedException", "{", "WorkflowMultiBranchProject", "mp", "=", "j", ".", "createProject", "(", "WorkflowMultiBranchProject", ".", "class", ",", "\"", "mbp", "\"", ");", "mp", ".", "setDisplayName", "(", "\"", "My", "MBP", "\"", ");", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "401", ")", ".", "get", "(", "\"/", "organizations", "/", "jenkins", "/", "pipelines", "/", "mbp", "/", "scm", "/", "content", "\"", ").", "build", "(", "Map", ".", "class", ")", ";", "}", "@", "Test", "public", "void", "AuthorizedUserContentAccessShouldSucceed", "(", ")", "throws", "IOException", ",", "ExecutionException", ",", "InterruptedException", ",", "UnirestException", "{", "WorkflowMultiBranchProject", "mp", "=", "j", ".", "createProject", "(", "WorkflowMultiBranchProject", ".", "class", ",", "\"", "mbp", "\"", ");", "mp", ".", "setDisplayName", "(", "\"", "My", "MBP", "\"", ");", "Map", "content", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "bob", ".", "getId", "(", "),", "bob", ".", "getId", "(", "))", ")", ".", "get", "(", "\"/", "organizations", "/", "jenkins", "/", "pipelines", "/", "mbp", "/", "scm", "/", "content", "\"", ").", "build", "(", "Map", ".", "class", ")", ";", "assertNotNull", "(", "content", ")", ";", "assertEquals", "(", "\"", "Hello", "World", "!", "\",", "(", "(", "Map", ")", "content", ".", "get", "(", "\"", "content", "\"", "))", ".", "get", "(", "\"", "data", "\"", "))", ";", "}", "@", "Test", "public", "void", "unauthenticatedUserContentUpdateShouldFail", "(", ")", "throws", "IOException", ",", "ExecutionException", ",", "InterruptedException", "{", "WorkflowMultiBranchProject", "mp", "=", "j", ".", "createProject", "(", "WorkflowMultiBranchProject", ".", "class", ",", "\"", "mbp", "\"", ");", "mp", ".", "setDisplayName", "(", "\"", "My", "MBP", "\"", ");", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "401", ")", ".", "data", "(", "ImmutableMap", ".", "of", "(", "\"", "content", "\"", ",", "ImmutableMap", ".", "of", "(", "\"", "data", "\"", ",\"", "Hello", "World", "Again", "!", "\")", "))", ".", "put", "(", "\"/", "organizations", "/", "jenkins", "/", "pipelines", "/", "mbp", "/", "scm", "/", "content", "\"", ").", "build", "(", "Map", ".", "class", ")", ";", "}", "@", "Test", "public", "void", "authorizedUserContentUpdateShouldSucceed", "(", ")", "throws", "IOException", ",", "ExecutionException", ",", "InterruptedException", ",", "UnirestException", "{", "WorkflowMultiBranchProject", "mp", "=", "j", ".", "createProject", "(", "WorkflowMultiBranchProject", ".", "class", ",", "\"", "mbp", "\"", ");", "mp", ".", "setDisplayName", "(", "\"", "My", "MBP", "\"", ");", "Map", "content", "=", "new", "RequestBuilder", "(", "baseUrl", ")", ".", "status", "(", "200", ")", ".", "jwtToken", "(", "getJwtToken", "(", "j", ".", "jenkins", ",", "bob", ".", "getId", "(", "),", "bob", ".", "getId", "(", "))", ")", ".", "data", "(", "ImmutableMap", ".", "of", "(", "\"", "content", "\"", ",", "ImmutableMap", ".", "of", "(", "\"", "data", "\"", ",\"", "Hello", "World", "Again", "!", "\")", "))", ".", "put", "(", "\"/", "organizations", "/", "jenkins", "/", "pipelines", "/", "mbp", "/", "scm", "/", "content", "\"", ").", "build", "(", "Map", ".", "class", ")", ";", "assertNotNull", "(", "content", ")", ";", "assertEquals", "(", "\"", "Hello", "World", "Again", "!", "\",", "(", "(", "Map", ")", "content", ".", "get", "(", "\"", "content", "\"", "))", ".", "get", "(", "\"", "data", "\"", "))", ";", "}", "public", "static", "class", "TestContent", "extends", "ScmContent", "{", "private", "final", "String", "data", ";", "public", "TestContent", "(", "String", "data", ")", "{", "this", ".", "data", "=", "data", ";", "}", "@", "Exported", "public", "String", "getData", "(", ")", "{", "return", "data", ";", "}", "}", "@", "TestExtension", "public", "static", "class", "TestScmContentProvider", "extends", "ScmContentProvider", "{", "@", "Nonnull", "@", "Override", "public", "String", "getScmId", "(", ")", "{", "return", "\"", "hello", "\"", ";", "}", "@", "CheckForNull", "@", "Override", "public", "String", "getApiUrl", "(", "@", "Nonnull", "Item", "item", ")", "{", "return", "\"", "https", ":", "//", "hello", ".", "example", ".", "com", "\"", ";", "}", "@", "CheckForNull", "@", "Override", "public", "Object", "getContent", "(", "@", "Nonnull", "StaplerRequest", "staplerRequest", ",", "@", "Nonnull", "Item", "item", ")", "{", "return", "new", "ScmFile", "<", "TestContent", ">", "()", "{", "@", "Override", "public", "TestContent", "getContent", "(", ")", "{", "return", "new", "TestContent", "(", "\"", "Hello", "World", "!", "\")", ";", "}", "}", ";", "}", "@", "CheckForNull", "@", "Override", "public", "Object", "saveContent", "(", "@", "Nonnull", "StaplerRequest", "staplerRequest", ",", "@", "Nonnull", "Item", "item", ")", "{", "try", "{", "JSONObject", "body", "=", "JSONObject", ".", "fromObject", "(", "IOUtils", ".", "toString", "(", "staplerRequest", ".", "getReader", "(", "))", ");", "final", "String", "data", "=", "(", "String", ")", "(", "(", "Map", ")", "body", ".", "get", "(", "\"", "content", "\"", "))", ".", "get", "(", "\"", "data", "\"", ");", "return", "new", "ScmFile", "<", "TestContent", ">", "()", "{", "@", "Override", "public", "TestContent", "getContent", "(", ")", "{", "return", "new", "TestContent", "(", "data", ")", ";", "}", "}", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "@", "Override", "public", "boolean", "support", "(", "@", "Nonnull", "Item", "item", ")", "{", "return", "item", "instanceof", "OrganizationFolder", "|", "|", "item", "instanceof", "MultiBranchProject", ";", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["ext3:", "Fix", "format", "string", "issues", "ext3_msg()", "takes", "the", "printk", "prefix", "as", "the", "second", "parameter", "and", "the", "format", "string", "as", "the", "third", "parameter.", "Two", "callers", "of", "ext3_msg", "omit", "the", "prefix", "and", "pass", "the", "format", "string", "as", "the", "second", "parameter", "and", "the", "first", "parameter", "to", "the", "format", "string", "as", "the", "third", "parameter.", "In", "both", "cases", "this", "string", "comes", "from", "an", "arbitrary", "source.", "Which", "means", "the", "string", "may", "contain", "format", "string", "characters,", "which", "will", "lead", "to", "undefined", "and", "potentially", "harmful", "behavior.", "The", "issue", "was", "introduced", "in", "commit", "4cf46b67eb(\"ext3:", "Unify", "log", "messages", "in", "ext3\")", "and", "is", "fixed", "by", "this", "patch.", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Lars-Peter", "Clausen", "<lars@metafoo.de>", "Signed-off-by:", "Jan", "Kara", "<jack@suse.cz>"], "code_tokens": ["@", "@", "-", "353", ",", "7", "+", "353", ",", "7", "@", "@", "static", "struct", "block_device", "*", "ext3_blkdev_get", "(", "dev_t", "dev", ",", "struct", "super_block", "*", "sb", ")", "return", "bdev", ";", "fail", ":", "ext3_msg", "(", "sb", ",", "\"", "error", ":", "failed", "to", "open", "journal", "device", "%", "s", ":", "%", "ld", "\"", ",", "ext3_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "error", ":", "failed", "to", "open", "journal", "device", "%", "s", ":", "%", "ld", "\"", ",", "__bdevname", "(", "dev", ",", "b", ")", ",", "PTR_ERR", "(", "bdev", ")", ");", "return", "NULL", ";", "@", "@", "-", "887", ",", "7", "+", "887", ",", "7", "@", "@", "static", "ext3_fsblk_t", "get_sb_block", "(", "void", "*", "*", "data", ",", "struct", "super_block", "*", "sb", ")", "/", "*", "todo", ":", "use", "simple_strtoll", "with", ">", "32bit", "ext3", "*", "/", "sb_block", "=", "simple_strtoul", "(", "options", ",", "&", "options", ",", "0", ")", ";", "if", "(", "*", "options", "&", "&", "*", "options", "!", "=", "'", ",'", ")", "{", "ext3_msg", "(", "sb", ",", "\"", "error", ":", "invalid", "sb", "specification", ":", "%", "s", "\"", ",", "ext3_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "error", ":", "invalid", "sb", "specification", ":", "%", "s", "\"", ",", "(", "char", "*", ")", "*", "data", ")", ";", "return", "1", ";", "}"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["usb:", "iowarrior:", "don't", "trust", "report_size", "for", "buffer", "size", "If", "the", "iowarrior", "devices", "in", "this", "case", "statement", "support", "more", "than", "8", "bytes", "per", "report,", "it", "is", "possible", "to", "write", "past", "the", "end", "of", "a", "kernel", "heap", "allocation.", "This", "will", "probably", "never", "be", "possible,", "but", "change", "the", "allocation", "to", "be", "more", "defensive", "anyway.", "Signed-off-by:", "Kees", "Cook", "<kees.cook@canonical.com>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@suse.de>"], "code_tokens": ["@", "@", "-", "374", ",", "7", "+", "374", ",", "7", "@", "@", "static", "ssize_t", "iowarrior_write", "(", "struct", "file", "*", "file", ",", "case", "USB_DEVICE_ID_CODEMERCS_IOWPV2", ":", "case", "USB_DEVICE_ID_CODEMERCS_IOW40", ":", "/", "*", "IOW24", "and", "IOW40", "use", "a", "synchronous", "call", "*", "/", "buf", "=", "kmalloc", "(", "8", ",", "GFP_KERNEL", ")", ";", "/", "*", "8", "bytes", "are", "enough", "for", "both", "products", "*", "/", "buf", "=", "kmalloc", "(", "count", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "buf", ")", "{", "retval", "=", "-", "ENOMEM", ";", "goto", "exit", ";"], "docstring_tokens": ["sending", "an", "overly", "long", "string"]}
{"contents": ["Compare", "HMACs", "with", "a", "time-constant", "string", "comparison."], "code_tokens": ["@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "security", ".", "Key", ";", "import", "java", ".", "security", ".", "MessageDigest", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "public", "class", "ClientDataEncoderImpl", "implements", "ClientDataEncoder", "@", "@", "-", "126", ",", "13", "+", "127", ",", "13", "@", "@", "private", "void", "validateHMAC", "(", "String", "storedHmacResult", ",", "Base64InputStream", "b64in", ")", "thro", "String", "actual", "=", "macOs", ".", "getResult", "(", ");", "if", "(", "!", "storedHmacResult", ".", "equals", "(", "actual", ")", ")", "if", "(", "!", "MessageDigest", ".", "isEqual", "(", "storedHmacResult", ".", "getBytes", "(", "),", "actual", ".", "getBytes", "(", "))", ")", "{", "throw", "new", "IOException", "(", "\"", "Client", "data", "associated", "with", "the", "current", "request", "appears", "to", "have", "been", "tampered", "with", "\"", "+", "\"", "(", "the", "HMAC", "signature", "does", "not", "match", ")", ".\"", ");", "}", "}", "public", "ObjectInputStream", "decodeEncodedClientData", "(", "String", "clientData", ")", "throws", "IOException", "{", "return", "decodeClientData", "(", "urlEncoder", ".", "decode", "(", "clientData", ")", ");"], "docstring_tokens": ["determine", "the", "correct", "signature", "for", "their", "payload"]}
{"contents": ["Fixed", "bug", "#71020", "(Use", "after", "free", "in", "Collator::sortWithSortKeys)"], "code_tokens": ["@", "@", "-", "34", ",", "6", "+", "34", ",", "10", "@", "@", "PHP", "NEWS", "-", "CLI", "server", ":", ".", "Fixed", "bug", "#", "71005", "(", "Segfault", "in", "php_cli_server_dispatch_router", "(", "))", ".", "(", "Adam", ")", "-", "Intl", ":", ".", "Fixed", "bug", "#", "71020", "(", "Use", "after", "free", "in", "Collator", ":", ":", "sortWithSortKeys", ")", ".", "(", "emmanuel", "dot", "law", "at", "gmail", "dot", "com", ",", "Laruence", ")", "-", "Mysqlnd", ":", ".", "Fixed", "bug", "#", "68077", "(", "LOAD", "DATA", "LOCAL", "INFILE", "/", "open_basedir", "restriction", ")", ".", "(", "Laruence", ")", "@", "@", "-", "363", ",", "6", "+", "363", ",", "7", "@", "@", "static", "void", "collator_sortkey_swap", "(", "collator_sort_key_index_t", "*", "p", ",", "collator_sort_ke", "PHP_FUNCTION", "(", "collator_sort_with_sort_keys", ")", "{", "zval", "*", "array", "=", "NULL", ";", "zval", "garbage", ";", "HashTable", "*", "hash", "=", "NULL", ";", "zval", "*", "hashData", "=", "NULL", ";", "/", "*", "currently", "processed", "item", "of", "input", "hash", "*", "/", "@", "@", "-", "505", ",", "7", "+", "506", ",", "7", "@", "@", "PHP_FUNCTION", "(", "collator_sort_with_sort_keys", ")", "zend_sort", "(", "sortKeyIndxBuf", ",", "sortKeyCount", ",", "sortKeyIndxSize", ",", "collator_cmp_sort_keys", ",", "(", "swap_func_t", ")", "collator_sortkey_swap", ")", ";", "zval_ptr_dtor", "(", "array", ")", ";", "ZVAL_COPY_VALUE", "(", "&", "garbage", ",", "array", ")", ";", "/", "*", "for", "resulting", "hash", "we", "'", "ll", "assign", "new", "hash", "keys", "rather", "then", "reordering", "*", "/", "array_init", "(", "array", ")", ";", "@", "@", "-", "518", ",", "6", "+", "519", ",", "7", "@", "@", "PHP_FUNCTION", "(", "collator_sort_with_sort_keys", ")", "if", "(", "utf16_buf", ")", "efree", "(", "utf16_buf", ")", ";", "zval_ptr_dtor", "(", "&", "garbage", ")", ";", "efree", "(", "sortKeyIndxBuf", ")", ";", "efree", "(", "sortKeyBuf", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "15", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "71020", "(", "Use", "after", "free", "in", "Collator", ":", ":", "sortWithSortKeys", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "intl", "'", ")", ")", "print", "'", "skip", "'", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "var_3", "=", "new", "Collator", "(", "\"", "Whatever", "\"", ");", "for", "(", "$", "x", "=", "0", ";", "$", "x", "<", "0xbb", ";", "$", "x", "+", "+)", "$", "myarray", "[", "substr", "(", "md5", "(", "microtime", "(", "))", ",", "rand", "(", "0", ",", "26", ")", ",", "9", ")", ".", "strval", "(", "$", "x", ")", "]=", "substr", "(", "md5", "(", "microtime", "(", "))", ",", "rand", "(", "0", ",", "26", ")", ",", "9", ")", ".", "strval", "(", "$", "x", ")", ";", "$", "var_3", "-", ">", "sortWithSortKeys", "(", "$", "myarray", ")", ";", "?", ">", "okey", "-", "-", "EXPECT", "-", "-", "okey"], "docstring_tokens": ["by", "leveraging", "the", "relationships", "between", "a", "key", "buffer", "and", "a", "destroyed", "array", "."]}
{"contents": ["ipmi_si:", "fix", "use-after-free", "of", "resource->name", "When", "we", "excute", "the", "following", "commands,", "we", "got", "oops", "rmmod", "ipmi_si", "cat", "/proc/ioports", "[", "1623.482380]", "Unable", "to", "handle", "kernel", "paging", "request", "at", "virtual", "address", "ffff00000901d478", "[", "1623.482382]", "Mem", "abort", "info:", "[", "1623.482383]", "ESR", "=", "0x96000007", "[", "1623.482385]", "Exception", "class", "=", "DABT", "(current", "EL),", "IL", "=", "32", "bits", "[", "1623.482386]", "SET", "=", "0,", "FnV", "=", "0", "[", "1623.482387]", "EA", "=", "0,", "S1PTW", "=", "0", "[", "1623.482388]", "Data", "abort", "info:", "[", "1623.482389]", "ISV", "=", "0,", "ISS", "=", "0x00000007", "[", "1623.482390]", "CM", "=", "0,", "WnR", "=", "0", "[", "1623.482393]", "swapper", "pgtable:", "4k", "pages,", "48-bit", "VAs,", "pgdp", "=", "00000000d7d94a66", "[", "1623.482395]", "[ffff00000901d478]", "pgd=000000dffbfff003,", "pud=000000dffbffe003,", "pmd=0000003f5d06e003,", "pte=0000000000000000", "[", "1623.482399]", "Internal", "error:", "Oops:", "96000007", "[#1]", "SMP", "[", "1623.487407]", "Modules", "linked", "in:", "ipmi_si(E)", "nls_utf8", "isofs", "rpcrdma", "ib_iser", "ib_srpt", "target_core_mod", "ib_srp", "scsi_transport_srp", "ib_ipoib", "rdma_ucm", "ib_umad", "rdma_cm", "ib_cm", "dm_mirror", "dm_region_hash", "dm_log", "iw_cm", "dm_mod", "aes_ce_blk", "crypto_simd", "cryptd", "aes_ce_cipher", "ses", "ghash_ce", "sha2_ce", "enclosure", "sha256_arm64", "sg", "sha1_ce", "hisi_sas_v2_hw", "hibmc_drm", "sbsa_gwdt", "hisi_sas_main", "ip_tables", "mlx5_ib", "ib_uverbs", "marvell", "ib_core", "mlx5_core", "ixgbe", "mdio", "hns_dsaf", "ipmi_devintf", "hns_enet_drv", "ipmi_msghandler", "hns_mdio", "[last", "unloaded:", "ipmi_si]", "[", "1623.532410]", "CPU:", "30", "PID:", "11438", "Comm:", "cat", "Kdump:", "loaded", "Tainted:", "G", "E", "5.0.0-rc3+", "#168", "[", "1623.541498]", "Hardware", "name:", "Huawei", "TaiShan", "2280", "/BC11SPCD,", "BIOS", "1.37", "11/21/2017", "[", "1623.548822]", "pstate:", "a0000005", "(NzCv", "daif", "-PAN", "-UAO)", "[", "1623.553684]", "pc", ":", "string+0x28/0x98", "[", "1623.557040]", "lr", ":", "vsnprintf+0x368/0x5e8", "[", "1623.560837]", "sp", ":", "ffff000013213a80", "[", "1623.564191]", "x29:", "ffff000013213a80", "x28:", "ffff00001138abb5", "[", "1623.569577]", "x27:", "ffff000013213c18", "x26:", "ffff805f67d06049", "[", "1623.574963]", "x25:", "0000000000000000", "x24:", "ffff00001138abb5", "[", "1623.580349]", "x23:", "0000000000000fb7", "x22:", "ffff0000117ed000", "[", "1623.585734]", "x21:", "ffff000011188fd8", "x20:", "ffff805f67d07000", "[", "1623.591119]", "x19:", "ffff805f67d06061", "x18:", "ffffffffffffffff", "[", "1623.596505]", "x17:", "0000000000000200", "x16:", "0000000000000000", "[", "1623.601890]", "x15:", "ffff0000117ed748", "x14:", "ffff805f67d07000", "[", "1623.607276]", "x13:", "ffff805f67d0605e", "x12:", "0000000000000000", "[", "1623.612661]", "x11:", "0000000000000000", "x10:", "0000000000000000", "[", "1623.618046]", "x9", ":", "0000000000000000", "x8", ":", "000000000000000f", "[", "1623.623432]", "x7", ":", "ffff805f67d06061", "x6", ":", "fffffffffffffffe", "[", "1623.628817]", "x5", ":", "0000000000000012", "x4", ":", "ffff00000901d478", "[", "1623.634203]", "x3", ":", "ffff0a00ffffff04", "x2", ":", "ffff805f67d07000", "[", "1623.639588]", "x1", ":", "ffff805f67d07000", "x0", ":", "ffffffffffffffff", "[", "1623.644974]", "Process", "cat", "(pid:", "11438,", "stack", "limit", "=", "0x000000008d4cbc10)", "[", "1623.651592]", "Call", "trace:", "[", "1623.654068]", "string+0x28/0x98", "[", "1623.657071]", "vsnprintf+0x368/0x5e8", "[", "1623.660517]", "seq_vprintf+0x70/0x98", "[", "1623.668009]", "seq_printf+0x7c/0xa0", "[", "1623.675530]", "r_show+0xc8/0xf8", "[", "1623.682558]", "seq_read+0x330/0x440", "[", "1623.689877]", "proc_reg_read+0x78/0xd0", "[", "1623.697346]", "__vfs_read+0x60/0x1a0", "[", "1623.704564]", "vfs_read+0x94/0x150", "[", "1623.711339]", "ksys_read+0x6c/0xd8", "[", "1623.717939]", "__arm64_sys_read+0x24/0x30", "[", "1623.725077]", "el0_svc_common+0x120/0x148", "[", "1623.732035]", "el0_svc_handler+0x30/0x40", "[", "1623.738757]", "el0_svc+0x8/0xc", "[", "1623.744520]", "Code:", "d1000406", "aa0103e2", "54000149", "b4000080", "(39400085)", "[", "1623.753441]", "---[", "end", "trace", "f91b6a4937de9835", "]---", "[", "1623.760871]", "Kernel", "panic", "-", "not", "syncing:", "Fatal", "exception", "[", "1623.768935]", "SMP:", "stopping", "secondary", "CPUs", "[", "1623.775718]", "Kernel", "Offset:", "disabled", "[", "1623.781998]", "CPU", "features:", "0x002,21006008", "[", "1623.788777]", "Memory", "Limit:", "none", "[", "1623.798329]", "Starting", "crashdump", "kernel...", "[", "1623.805202]", "Bye!", "If", "io_setup", "is", "called", "successful", "in", "try_smi_init()", "but", "try_smi_init()", "goes", "out_err", "before", "calling", "ipmi_register_smi(),", "so", "ipmi_unregister_smi()", "will", "not", "be", "called", "while", "removing", "module.", "It", "leads", "to", "the", "resource", "that", "allocated", "in", "io_setup()", "can", "not", "be", "freed,", "but", "the", "name(DEVICE_NAME)", "of", "resource", "is", "freed", "while", "removing", "the", "module.", "It", "causes", "use-after-free", "when", "cat", "/proc/ioports.", "Fix", "this", "by", "calling", "io_cleanup()", "while", "try_smi_init()", "goes", "to", "out_err.", "and", "don't", "call", "io_cleanup()", "until", "io_setup()", "returns", "successful", "to", "avoid", "warning", "prints.", "Fixes:", "93c303d2045b", "(\"ipmi_si:", "Clean", "up", "shutdown", "a", "bit\")", "Cc:", "stable@vger.kernel.org", "Reported-by:", "NuoHan", "Qiao", "<qiaonuohan@huawei.com>", "Suggested-by:", "Corey", "Minyard", "<cminyard@mvista.com>", "Signed-off-by:", "Yang", "Yingliang", "<yangyingliang@huawei.com>", "Signed-off-by:", "Corey", "Minyard", "<cminyard@mvista.com>"], "code_tokens": ["@", "@", "-", "2085", ",", "6", "+", "2085", ",", "11", "@", "@", "static", "int", "try_smi_init", "(", "struct", "smi_info", "*", "new_smi", ")", "WARN_ON", "(", "new_smi", "-", ">", "io", ".", "dev", "-", ">", "init_name", "!", "=", "NULL", ")", ";", "out_err", ":", "if", "(", "rv", "&", "&", "new_smi", "-", ">", "io", ".", "io_cleanup", ")", "{", "new_smi", "-", ">", "io", ".", "io_cleanup", "(", "&", "new_smi", "-", ">", "io", ")", ";", "new_smi", "-", ">", "io", ".", "io_cleanup", "=", "NULL", ";", "}", "kfree", "(", "init_name", ")", ";", "return", "rv", ";", "}", "@", "@", "-", "81", ",", "8", "+", "81", ",", "6", "@", "@", "int", "ipmi_si_mem_setup", "(", "struct", "si_sm_io", "*", "io", ")", "if", "(", "!", "addr", ")", "return", "-", "ENODEV", ";", "io", "-", ">", "io_cleanup", "=", "mem_cleanup", ";", "/", "*", "*", "Figure", "out", "the", "actual", "readb", "/", "readw", "/", "readl", "/", "etc", "routine", "to", "use", "based", "*", "upon", "the", "register", "size", ".", "@", "@", "-", "141", ",", "5", "+", "139", ",", "8", "@", "@", "int", "ipmi_si_mem_setup", "(", "struct", "si_sm_io", "*", "io", ")", "mem_region_cleanup", "(", "io", ",", "io", "-", ">", "io_size", ")", ";", "return", "-", "EIO", ";", "}", "io", "-", ">", "io_cleanup", "=", "mem_cleanup", ";", "return", "0", ";", "}", "@", "@", "-", "68", ",", "8", "+", "68", ",", "6", "@", "@", "int", "ipmi_si_port_setup", "(", "struct", "si_sm_io", "*", "io", ")", "if", "(", "!", "addr", ")", "return", "-", "ENODEV", ";", "io", "-", ">", "io_cleanup", "=", "port_cleanup", ";", "/", "*", "*", "Figure", "out", "the", "actual", "inb", "/", "inw", "/", "inl", "/", "etc", "routine", "to", "use", "based", "*", "upon", "the", "register", "size", ".", "@", "@", "-", "109", ",", "5", "+", "107", ",", "8", "@", "@", "int", "ipmi_si_port_setup", "(", "struct", "si_sm_io", "*", "io", ")", "return", "-", "EIO", ";", "}", "}", "io", "-", ">", "io_cleanup", "=", "port_cleanup", ";", "return", "0", ";", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["https://issues.apache.org/jira/browse/AMQ-6470", "-", "Remove", "unused", "ControlCommand", "handling", "in", "client"], "code_tokens": ["@", "@", "-", "1873", ",", "7", "+", "1873", ",", "6", "@", "@", "public", "void", "run", "(", ")", "{", "@", "Override", "public", "Response", "processControlCommand", "(", "ControlCommand", "command", ")", "throws", "Exception", "{", "onControlCommand", "(", "command", ")", ";", "return", "null", ";", "}", "@", "@", "-", "2221", ",", "25", "+", "2220", ",", "6", "@", "@", "void", "send", "(", "ActiveMQDestination", "destination", ",", "ActiveMQMessage", "msg", ",", "MessageId", "messag", "}", "}", "protected", "void", "onControlCommand", "(", "ControlCommand", "command", ")", "{", "String", "text", "=", "command", ".", "getCommand", "(", ");", "if", "(", "text", "!", "=", "null", ")", "{", "if", "(", "\"", "shutdown", "\"", ".", "equals", "(", "text", ")", ")", "{", "LOG", ".", "info", "(", "\"", "JVM", "told", "to", "shutdown", "\"", ");", "System", ".", "exit", "(", "0", ")", ";", "}", "/", "/", "TODO", "Should", "we", "handle", "the", "\"", "close", "\"", "case", "?", "/", "/", "if", "(", "false", "&", "&", "\"", "close", "\"", ".", "equals", "(", "text", ")", "){", "/", "/", "LOG", ".", "error", "(", "\"", "Broker", "\"", "+", "getBrokerInfo", "(", ")", "+", "\"", "shutdown", "connection", "\"", ");", "/", "/", "try", "{", "/", "/", "close", "(", ");", "/", "/", "}", "catch", "(", "JMSException", "e", ")", "{", "/", "/", "}", "/", "/", "}", "}", "}", "protected", "void", "onConnectionControl", "(", "ConnectionControl", "command", ")", "{", "if", "(", "command", ".", "isFaultTolerant", "(", "))", "{", "this", ".", "optimizeAcknowledge", "=", "false", ";"], "docstring_tokens": ["sending", "a", "specific", "command"]}
{"contents": ["infiniband:", "fix", "a", "possible", "use-after-free", "bug", "ucma_process_join()", "will", "free", "the", "new", "allocated", "\"mc\"", "struct,", "if", "there", "is", "any", "error", "after", "that,", "especially", "the", "copy_to_user().", "But", "in", "parallel,", "ucma_leave_multicast()", "could", "find", "this", "\"mc\"", "through", "idr_find()", "before", "ucma_process_join()", "frees", "it,", "since", "it", "is", "already", "published.", "So", "\"mc\"", "could", "be", "used", "in", "ucma_leave_multicast()", "after", "it", "is", "been", "allocated", "and", "freed", "in", "ucma_process_join(),", "since", "we", "don't", "refcnt", "it.", "Fix", "this", "by", "separating", "\"publish\"", "from", "ID", "allocation,", "so", "that", "we", "can", "get", "an", "ID", "first", "and", "publish", "it", "later", "after", "copy_to_user().", "Fixes:", "c8f6a362bf3e", "(\"RDMA/cma:", "Add", "multicast", "communication", "support\")", "Reported-by:", "Noam", "Rathaus", "<noamr@beyondsecurity.com>", "Signed-off-by:", "Cong", "Wang", "<xiyou.wangcong@gmail.com>", "Signed-off-by:", "Jason", "Gunthorpe", "<jgg@mellanox.com>"], "code_tokens": ["@", "@", "-", "235", ",", "7", "+", "235", ",", "7", "@", "@", "static", "struct", "ucma_multicast", "*", "ucma_alloc_multicast", "(", "struct", "ucma_context", "*", "ctx", ")", "return", "NULL", ";", "mutex_lock", "(", "&", "mut", ")", ";", "mc", "-", ">", "id", "=", "idr_alloc", "(", "&", "multicast_idr", ",", "mc", ",", "0", ",", "0", ",", "GFP_KERNEL", ")", ";", "mc", "-", ">", "id", "=", "idr_alloc", "(", "&", "multicast_idr", ",", "NULL", ",", "0", ",", "0", ",", "GFP_KERNEL", ")", ";", "mutex_unlock", "(", "&", "mut", ")", ";", "if", "(", "mc", "-", ">", "id", "<", "0", ")", "goto", "error", ";", "@", "@", "-", "1421", ",", "6", "+", "1421", ",", "10", "@", "@", "static", "ssize_t", "ucma_process_join", "(", "struct", "ucma_file", "*", "file", ",", "goto", "err3", ";", "}", "mutex_lock", "(", "&", "mut", ")", ";", "idr_replace", "(", "&", "multicast_idr", ",", "mc", ",", "mc", "-", ">", "id", ")", ";", "mutex_unlock", "(", "&", "mut", ")", ";", "mutex_unlock", "(", "&", "file", "-", ">", "mut", ")", ";", "ucma_put_ctx", "(", "ctx", ")", ";", "return", "0", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["[SECURITY-1322]", "Co-Authored-By:", "Wadeck", "Follonier", "<wadeck.follonier@gmail.com>"], "code_tokens": ["@", "@", "-", "119", ",", "6", "+", "119", ",", "12", "@", "@", "<", "version", ">", "2", ".", "2", ".", "0", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "cloudbees", "-", "folder", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "7", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "@", "@", "-", "23", ",", "9", "+", "23", ",", "7", "@", "@", "*", "/", "package", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsScope", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsSnapshotTaker", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "SecretBytes", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardCertificateCredentials", ";", "import", "edu", ".", "umd", ".", "cs", ".", "findbugs", ".", "annotations", ".", "CheckForNull", ";", "@", "@", "-", "35", ",", "19", "+", "33", ",", "20", "@", "@", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "model", ".", "AbstractDescribableImpl", ";", "import", "hudson", ".", "model", ".", "Descriptor", ";", "import", "hudson", ".", "remoting", ".", "Channel", ";", "import", "hudson", ".", "model", ".", "Items", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "HttpResponses", ";", "import", "hudson", ".", "util", ".", "IOUtils", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamException", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "java", ".", "security", ".", "KeyStoreException", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "@", "@", "-", "59", ",", "10", "+", "58", ",", "12", "@", "@", "import", "java", ".", "util", ".", "logging", ".", "LogRecord", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "hudson", ".", "util", ".", "XStream2", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "net", ".", "jcip", ".", "annotations", ".", "GuardedBy", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "binary", ".", "Base64", ";", "import", "org", ".", "apache", ".", "commons", ".", "fileupload", ".", "FileItem", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "@", "@", "-", "138", ",", "19", "+", "139", ",", "6", "@", "@", "public", "CertificateCredentialsImpl", "(", "@", "CheckForNull", "CredentialsScope", "scope", ",", "return", "plainText", "=", "=", "null", "?", "null", ":", "plainText", ".", "toCharArray", "(", ");", "}", "/", "**", "*", "When", "serializing", "over", "a", "{", "@", "link", "Channel", "}", "ensure", "that", "we", "send", "a", "self", "-", "contained", "version", ".", "*", "*", "@", "return", "the", "object", "instance", "to", "write", "to", "the", "stream", ".", "*", "/", "private", "Object", "writeReplace", "(", ")", "{", "if", "(", "/*", "XStream", "*", "/", "Channel", ".", "current", "(", ")", "=", "=", "null", "|", "|", "/", "*", "already", "safe", "to", "serialize", "*", "/", "keyStoreSource", ".", "isSnapshotSource", "(", "))", "{", "return", "this", ";", "}", "return", "CredentialsProvider", ".", "snapshot", "(", "this", ")", ";", "}", "/", "**", "*", "Returns", "the", "{", "@", "link", "KeyStore", "}", "containing", "the", "certificate", ".", "*", "@", "@", "-", "268", ",", "7", "+", "256", ",", "9", "@", "@", "public", "String", "getIconClassName", "(", ")", "{", "*", "*", "@", "return", "{", "@", "code", "true", "}", "if", "and", "only", "if", "the", "source", "is", "self", "contained", ".", "*", "@", "since", "1", ".", "14", "*", "@", "deprecated", "No", "longer", "need", "to", "distinguish", "snapshot", "sources", ".", "*", "/", "@", "Deprecated", "public", "boolean", "isSnapshotSource", "(", ")", "{", "return", "false", ";", "}", "@", "@", "-", "364", ",", "7", "+", "354", ",", "9", "@", "@", "protected", "static", "FormValidation", "validateCertificateKeystore", "(", "String", "type", ",", "byte", "[", "]", "/", "**", "*", "Let", "the", "user", "reference", "a", "file", "on", "the", "disk", ".", "*", "@", "deprecated", "This", "approach", "has", "security", "vulnerabilities", "and", "should", "be", "migrated", "to", "{", "@", "link", "UploadedKeyStoreSource", "}", "*", "/", "@", "Deprecated", "public", "static", "class", "FileOnMasterKeyStoreSource", "extends", "KeyStoreSource", "{", "/", "**", "@", "@", "-", "377", ",", "13", "+", "369", ",", "6", "@", "@", "protected", "static", "FormValidation", "validateCertificateKeystore", "(", "String", "type", ",", "byte", "[", "]", "*", "/", "private", "final", "String", "keyStoreFile", ";", "/", "**", "*", "Our", "constructor", ".", "*", "*", "@", "param", "keyStoreFile", "the", "path", "of", "the", "file", "on", "the", "master", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "by", "stapler", "@", "DataBoundConstructor", "public", "FileOnMasterKeyStoreSource", "(", "String", "keyStoreFile", ")", "{", "this", ".", "keyStoreFile", "=", "keyStoreFile", ";", "}", "@", "@", "-", "407", ",", "15", "+", "392", ",", "6", "@", "@", "public", "FileOnMasterKeyStoreSource", "(", "String", "keyStoreFile", ")", "{", "}", "}", "/", "**", "*", "Returns", "the", "private", "key", "file", "name", ".", "*", "*", "@", "return", "the", "private", "key", "file", "name", ".", "*", "/", "public", "String", "getKeyStoreFile", "(", ")", "{", "return", "keyStoreFile", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "@", "-", "434", ",", "63", "+", "410", ",", "28", "@", "@", "public", "String", "toString", "(", ")", "{", "\"", "}\"", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Extension", "public", "static", "class", "DescriptorImpl", "extends", "KeyStoreSourceDescriptor", "{", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "Messages", ".", "CertificateCredentialsImpl_FileOnMasterKeyStoreSourceDisplayName", "(", ");", "private", "Object", "readResolve", "(", ")", "{", "if", "(", "!", "Jenkins", ".", "getActiveInstance", "(", ").", "hasPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ")", "{", "LOGGER", ".", "warning", "(", "\"", "SECURITY", "-", "1322", ":", "Permission", "failure", "migrating", "FileOnMasterKeyStoreSource", "to", "UploadedKeyStoreSource", "for", "a", "Certificate", ".", "An", "administrator", "may", "need", "to", "perform", "the", "migration", ".", "\")", ";", "Jenkins", ".", "getActiveInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ";", "}", "/", "**", "*", "Checks", "the", "keystore", "file", "path", ".", "*", "*", "@", "param", "value", "the", "file", "path", ".", "*", "@", "param", "password", "the", "password", ".", "*", "@", "return", "the", "{", "@", "link", "FormValidation", "}", "results", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "stapler", "form", "validation", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "FormValidation", "doCheckKeyStoreFile", "(", "@", "QueryParameter", "String", "value", ",", "@", "QueryParameter", "String", "password", ")", "{", "if", "(", "StringUtils", ".", "isBlank", "(", "value", ")", ")", "{", "return", "FormValidation", ".", "error", "(", "Messages", ".", "CertificateCredentialsImpl_KeyStoreFileUnspecified", "(", "))", ";", "}", "File", "file", "=", "new", "File", "(", "value", ")", ";", "if", "(", "file", ".", "isFile", "(", "))", "{", "try", "{", "return", "validateCertificateKeystore", "(", "\"", "PKCS12", "\"", ",", "FileUtils", ".", "readFileToByteArray", "(", "file", ")", ",", "password", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "return", "FormValidation", ".", "error", "(", "Messages", ".", "CertificateCredentialsImpl_KeyStoreFileUnreadable", "(", "value", ")", ",", "e", ")", ";", "}", "}", "else", "{", "return", "FormValidation", ".", "error", "(", "Messages", ".", "CertificateCredentialsImpl_KeyStoreFileDoesNotExist", "(", "value", ")", ");", "}", "}", "LOGGER", ".", "log", "(", "Level", ".", "INFO", ",", "\"", "SECURITY", "-", "1322", ":", "Migrating", "FileOnMasterKeyStoreSource", "to", "UploadedKeyStoreSource", ".", "The", "containing", "item", "may", "need", "to", "be", "saved", "to", "complete", "the", "migration", ".", "\")", ";", "SecretBytes", "secretBytes", "=", "SecretBytes", ".", "fromBytes", "(", "getKeyStoreBytes", "(", "))", ";", "return", "new", "UploadedKeyStoreSource", "(", "secretBytes", ")", ";", "}", "}", "/", "**", "*", "Let", "the", "user", "reference", "a", "file", "on", "the", "disk", ".", "*", "Let", "the", "user", "reference", "an", "uploaded", "file", ".", "*", "/", "public", "static", "class", "UploadedKeyStoreSource", "extends", "KeyStoreSource", "implements", "Serializable", "{", "/", "**", "*", "Ensure", "consistent", "serialization", ".", "*", "/", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "/", "**", "*", "Our", "logger", ".", "*", "/", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "FileOnMasterKeyStoreSource", ".", "class", ".", "getName", "(", "))", ";", "/", "**", "*", "The", "old", "uploaded", "keystore", ".", "*", "/", "@", "@", "-", "750", ",", "55", "+", "691", ",", "21", "@", "@", "public", "HttpResponse", "doUpload", "(", "@", "NonNull", "StaplerRequest", "req", ")", "throws", "ServletExceptio", "}", "}", "/", "**", "*", "The", "{", "@", "link", "CredentialsSnapshotTaker", "}", "for", "{", "@", "link", "StandardCertificateCredentials", "}", ".", "*", "*", "@", "since", "1", ".", "14", "*", "/", "@", "Extension", "public", "static", "class", "CredentialsSnapshotTakerImpl", "extends", "CredentialsSnapshotTaker", "<", "StandardCertificateCredentials", ">", "{", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "Class", "<", "StandardCertificateCredentials", ">", "type", "(", ")", "{", "return", "StandardCertificateCredentials", ".", "class", ";", "static", "{", "try", "{", "/", "/", "the", "critical", "field", "allow", "the", "permission", "check", "to", "make", "the", "XML", "read", "to", "fail", "completely", "in", "case", "of", "violation", "/", "/", "TODO", ":", "Remove", "reflection", "once", "baseline", "is", "updated", "past", "2", ".", "85", ".", "Method", "m", "=", "XStream2", ".", "class", ".", "getMethod", "(", "\"", "addCriticalField", "\"", ",", "Class", ".", "class", ",", "String", ".", "class", ")", ";", "m", ".", "invoke", "(", "Items", ".", "XSTREAM2", ",", "CertificateCredentialsImpl", ".", "class", ",", "\"", "keyStoreSource", "\"", ");", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "StandardCertificateCredentials", "snapshot", "(", "StandardCertificateCredentials", "credentials", ")", "{", "if", "(", "credentials", "instanceof", "CertificateCredentialsImpl", ")", "{", "final", "KeyStoreSource", "keyStoreSource", "=", "(", "(", "CertificateCredentialsImpl", ")", "credentials", ")", ".", "getKeyStoreSource", "(", ");", "if", "(", "keyStoreSource", ".", "isSnapshotSource", "(", "))", "{", "return", "credentials", ";", "}", "return", "new", "CertificateCredentialsImpl", "(", "credentials", ".", "getScope", "(", "),", "credentials", ".", "getId", "(", "),", "credentials", ".", "getDescription", "(", "),", "credentials", ".", "getPassword", "(", ").", "getEncryptedValue", "(", "),", "new", "UploadedKeyStoreSource", "(", "SecretBytes", ".", "fromBytes", "(", "keyStoreSource", ".", "getKeyStoreBytes", "(", "))", "))", ";", "}", "ByteArrayOutputStream", "bos", "=", "new", "ByteArrayOutputStream", "(", ");", "final", "char", "[", "]", "password", "=", "credentials", ".", "getPassword", "(", ").", "getPlainText", "(", ").", "toCharArray", "(", ");", "try", "{", "credentials", ".", "getKeyStore", "(", ").", "store", "(", "bos", ",", "password", ")", ";", "bos", ".", "close", "(", ");", "}", "catch", "(", "KeyStoreException", "e", ")", "{", "return", "credentials", ";", "}", "catch", "(", "IOException", "e", ")", "{", "return", "credentials", ";", "}", "catch", "(", "NoSuchAlgorithmException", "e", ")", "{", "return", "credentials", ";", "}", "catch", "(", "CertificateException", "e", ")", "{", "return", "credentials", ";", "}", "finally", "{", "Arrays", ".", "fill", "(", "password", ",", "(", "char", ")", "0", ")", ";", "}", "return", "new", "CertificateCredentialsImpl", "(", "credentials", ".", "getScope", "(", "),", "credentials", ".", "getId", "(", "),", "credentials", ".", "getDescription", "(", "),", "credentials", ".", "getPassword", "(", ").", "getEncryptedValue", "(", "),", "new", "UploadedKeyStoreSource", "(", "SecretBytes", ".", "fromBytes", "(", "bos", ".", "toByteArray", "(", "))", "))", ";", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "}", "}", "@", "@", "-", "24", ",", "10", "+", "24", ",", "6", "@", "@", "UsernamePasswordCredentialsImpl", ".", "DisplayName", "=", "Username", "with", "password", "CertificateCredentialsImpl", ".", "DisplayName", "=", "Certificate", "CertificateCredentialsImpl", ".", "EmptyKeystore", "=", "Empty", "keystore", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSourceDisplayName", "=", "From", "a", "PKCS", "#", "12", "file", "on", "Jenkins", "master", "CertificateCredentialsImpl", ".", "KeyStoreFileDoesNotExist", "=", "The", "file", "\"", "{", "0", "}", "\"", "does", "not", "exist", "CertificateCredentialsImpl", ".", "KeyStoreFileUnreadable", "=", "Could", "not", "read", "file", "\"", "{", "0", "}", "\"", "CertificateCredentialsImpl", ".", "KeyStoreFileUnspecified", "=", "You", "must", "specify", "the", "file", "path", "CertificateCredentialsImpl", ".", "LoadKeyFailed", "=", "Could", "retrieve", "key", "\"", "{", "0", "}", "\"", "CertificateCredentialsImpl", ".", "LoadKeyFailedQueryEmptyPassword", "=", "Could", "retrieve", "key", "\"", "{", "0", "}", "\".", "You", "may", "need", "to", "provide", "a", "password", "CertificateCredentialsImpl", ".", "LoadKeystoreFailed", "=", "Could", "not", "load", "keystore", "@", "@", "-", "24", ",", "10", "+", "24", ",", "6", "@", "@", "UsernamePasswordCredentialsImpl", ".", "DisplayName", "=", "Benutzername", "und", "Passwort", "CertificateCredentialsImpl", ".", "DisplayName", "=", "Zertifikat", "CertificateCredentialsImpl", ".", "EmptyKeystore", "=", "leerer", "Zertifikatsspeicher", "(", "\"", "keystore", "\"", ")", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSourceDisplayName", "=", "Aus", "einer", "PKCS", "#", "12", "-", "Datei", "auf", "dem", "Jenkins", "Master", "CertificateCredentialsImpl", ".", "KeyStoreFileDoesNotExist", "=", "Die", "Datei", "\"", "{", "0", "}", "\"", "existiert", "nicht", "CertificateCredentialsImpl", ".", "KeyStoreFileUnreadable", "=", "Konnte", "Datei", "\"", "{", "0", "}", "\"", "nicht", "lesen", "CertificateCredentialsImpl", ".", "KeyStoreFileUnspecified", "=", "Sie", "m", "\\", "u00FCssen", "einen", "Dateipfad", "angeben", "CertificateCredentialsImpl", ".", "LoadKeyFailed", "=", "Konnte", "den", "Schl", "\\", "u00FCssel", "\"", "{", "0", "}", "\"", "nicht", "abrufen", "CertificateCredentialsImpl", ".", "LoadKeyFailedQueryEmptyPassword", "=", "Konnte", "den", "Schl", "\\", "u00FCssel", "\"", "{", "0", "}", "\"", "nicht", "abrufen", ".", "M", "\\", "u00F6glicherweise", "m", "\\", "u00FCssen", "Sie", "ein", "Passwort", "eingeben", "CertificateCredentialsImpl", ".", "LoadKeystoreFailed", "=", "Konnte", "den", "Zertifikatsspeicher", "(", "\"", "keystore", "\"", ")", "nicht", "laden", "@", "@", "-", "23", ",", "10", "+", "23", ",", "6", "@", "@", "UsernamePasswordCredentialsImpl", ".", "DisplayName", "=", "Nom", "d", "'", "'", "utilisateur", "et", "mot", "de", "passe", "CertificateCredentialsImpl", ".", "DisplayName", "=", "Certificat", "CertificateCredentialsImpl", ".", "EmptyKeystore", "=", "Magasin", "de", "cl", "\\", "u00e9", "vide", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSourceDisplayName", "=", "Depuis", "un", "fichier", "PKCS", "#", "12", "sur", "la", "machine", "ma", "\\", "u00eetre", "de", "Jenkins", "CertificateCredentialsImpl", ".", "KeyStoreFileDoesNotExist", "=", "Le", "fichier", "\"", "{", "0", "}", "\"", "n", "'", "'", "existe", "pas", "CertificateCredentialsImpl", ".", "KeyStoreFileUnreadable", "=", "Impossible", "de", "lire", "le", "fichier", "\"", "{", "0", "}", "\"", "CertificateCredentialsImpl", ".", "KeyStoreFileUnspecified", "=", "Vous", "devez", "sp", "\\", "u00e9cifier", "un", "chemin", "du", "fichier", "CertificateCredentialsImpl", ".", "LoadKeyFailed", "=", "Impossible", "de", "r", "\\", "u00e9cup", "\\", "u00e9rer", "la", "cl", "\\", "u00e9", "\"", "{", "0", "}", "\"", "CertificateCredentialsImpl", ".", "LoadKeyFailedQueryEmptyPassword", "=", "Impossible", "de", "r", "\\", "u00e9cup", "\\", "u00e9rer", "la", "cl", "\\", "u00e9", "\"", "{", "0", "}", "\".", "Vous", "pouvez", "avoir", "besoin", "de", "fournir", "un", "mot", "de", "passe", ".", "CertificateCredentialsImpl", ".", "LoadKeystoreFailed", "=", "Impossible", "de", "charger", "le", "magasin", "de", "cl", "\\", "u00e9", "@", "@", "-", "24", ",", "11", "+", "24", ",", "6", "@", "@", "UsernamePasswordCredentialsImpl", ".", "DisplayName", "=", "\\", "u30e6", "\\", "u30fc", "\\", "u30b6", "\\", "u30fc", "\\", "u540d", "\\", "u3068", "\\", "u30d1", "\\", "u30b9", "\\", "u30ef", "\\", "u30fc", "\\", "u30c9", "CertificateCredentialsImpl", ".", "DisplayName", "=", "\\", "u8a3c", "\\", "u660e", "\\", "u66f8", "CertificateCredentialsImpl", ".", "EmptyKeystore", "=", "\\", "u7a7a", "\\", "u306e", "\\", "u30ad", "\\", "u30fc", "\\", "u30b9", "\\", "u30c8", "\\", "u30a2", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSourceDisplayName", "=", "\\", "Jenkins", "\\", "u30de", "\\", "u30b9", "\\", "u30bf", "\\", "u30fc", "\\", "u4e0a", "\\", "u306ePKCS", "#", "12", "\\", "u8a3c", "\\", "u660e", "\\", "u66f8", "\\", "u30d5", "\\", "u30a1", "\\", "u30a4", "\\", "u30eb", "CertificateCredentialsImpl", ".", "KeyStoreFileDoesNotExist", "=", "\\", "u30d5", "\\", "u30a1", "\\", "u30a4", "\\", "u30eb", "\"", "{", "0", "}", "\"", "\\", "u306f", "\\", "u5b58", "\\", "u5728", "\\", "u3057", "\\", "u307e", "\\", "u305b", "\\", "u3093", "\\", "u3002", "CertificateCredentialsImpl", ".", "KeyStoreFileUnreadable", "=", "\\", "u30d5", "\\", "u30a1", "\\", "u30a4", "\\", "u30eb", "\"", "{", "0", "}", "\"", "\\", "u3092", "\\", "u8aad", "\\", "u3081", "\\", "u307e", "\\", "u305b", "\\", "u3093", "\\", "u3067", "\\", "u3057", "\\", "u305f", "\\", "u3002", "CertificateCredentialsImpl", ".", "KeyStoreFileUnspecified", "=", "\\", "u30d5", "\\", "u30a1", "\\", "u30a4", "\\", "u30eb", "\\", "u306e", "\\", "u30d1", "\\", "u30b9", "\\", "u3092", "\\", "u6307", "\\", "u5b9a", "\\", "u3057", "\\", "u3066", "\\", "u304f", "\\", "u3060", "\\", "u3055", "\\", "u3044", "\\", "u3002", "CertificateCredentialsImpl", ".", "LoadKeyFailed", "=", "\\", "u30ad", "\\", "u30fc", "\"", "{", "0", "}", "\"\\", "u3092", "\\", "u53d6", "\\", "u5f97", "\\", "u3067", "\\", "u304d", "\\", "u307e", "\\", "u3057", "\\", "u305f", "\\", "u3002", "CertificateCredentialsImpl", ".", "LoadKeyFailedQueryEmptyPassword", "=", "\\", "u30ad", "\\", "u30fc", "\"", "{", "0", "}", "\"\\", "u3092", "\\", "u53d6", "\\", "u5f97", "\\", "u3067", "\\", "u304d", "\\", "u307e", "\\", "u3057", "\\", "u305f", "\\", "u304c", "\\", "u3001", "\\", "u30d1", "\\", "u30b9", "\\", "u30ef", "\\", "u30fc", "\\", "u30c9", "\\", "u304c", "\\", "u5fc5", "\\", "u8981", "\\", "u3067", "\\", "u3059", "\\", "u3002", "CertificateCredentialsImpl", ".", "LoadKeystoreFailed", "=", "\\", "u30ad", "\\", "u30fc", "\\", "u30b9", "\\", "u30c8", "\\", "u30a2", "\\", "u3092", "\\", "u30ed", "\\", "u30fc", "\\", "u30c9", "\\", "u3067", "\\", "u304d", "\\", "u307e", "\\", "u305b", "\\", "u3093", "\\", "u3002", "@", "@", "-", "24", ",", "24", "+", "24", ",", "170", "@", "@", "package", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ";", "import", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", ";", "import", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "properties", ".", "FolderCredentialsProvider", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "Credentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsNameProvider", ";", "import", "java", ".", "io", ".", "File", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsStore", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "SecretBytes", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "SystemCredentialsProvider", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "CertificateCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "cli", ".", "CLICommandInvoker", ";", "import", "hudson", ".", "cli", ".", "UpdateJobCommand", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "static", "hudson", ".", "cli", ".", "CLICommandInvoker", ".", "Matcher", ".", "failedWith", ";", "import", "static", "hudson", ".", "cli", ".", "CLICommandInvoker", ".", "Matcher", ".", "succeeded", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasSize", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "*;", "public", "class", "CertificateCredentialsImplTest", "{", "@", "Rule", "public", "JenkinsRule", "r", "=", "new", "JenkinsRule", "(", ");", "/", "/", "needed", "for", "Secret", ".", "fromString", "to", "work", "@", "Rule", "public", "TemporaryFolder", "tmp", "=", "new", "TemporaryFolder", "(", ");", "@", "Rule", "public", "JenkinsRule", "r", "=", "new", "JenkinsRule", "(", ");", "@", "Rule", "public", "TemporaryFolder", "tmp", "=", "new", "TemporaryFolder", "(", ");", "@", "Test", "public", "void", "displayName", "(", ")", "throws", "Exception", "{", "File", "p12", "=", "tmp", ".", "newFile", "(", "\"", "test", ".", "p12", "\"", ");", "private", "File", "p12", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "IOException", "{", "p12", "=", "tmp", ".", "newFile", "(", "\"", "test", ".", "p12", "\"", ");", "FileUtils", ".", "copyURLToFile", "(", "CertificateCredentialsImplTest", ".", "class", ".", "getResource", "(", "\"", "test", ".", "p12", "\"", "),", "p12", ")", ";", "assertEquals", "(", "\"", "EMAILADDRESS", "=", "me", "@", "myhost", ".", "mydomain", ",", "CN", "=", "pkcs12", ",", "O", "=", "Fort", "-", "Funston", ",", "L", "=", "SanFrancisco", ",", "ST", "=", "CA", ",", "C", "=", "US", "\"", ",", "CredentialsNameProvider", ".", "name", "(", "new", "CertificateCredentialsImpl", "(", "null", ",", "\"", "abc123", "\"", ",", "null", ",", "\"", "password", "\"", ",", "new", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSource", "(", "p12", ".", "getAbsolutePath", "(", "))", "))", ");", "}", "@", "Test", "public", "void", "displayName", "(", ")", "throws", "IOException", "{", "SecretBytes", "uploadedKeystore", "=", "SecretBytes", ".", "fromBytes", "(", "Files", ".", "readAllBytes", "(", "p12", ".", "toPath", "(", "))", ");", "CertificateCredentialsImpl", ".", "UploadedKeyStoreSource", "storeSource", "=", "new", "CertificateCredentialsImpl", ".", "UploadedKeyStoreSource", "(", "uploadedKeystore", ")", ";", "assertEquals", "(", "\"", "EMAILADDRESS", "=", "me", "@", "myhost", ".", "mydomain", ",", "CN", "=", "pkcs12", ",", "O", "=", "Fort", "-", "Funston", ",", "L", "=", "SanFrancisco", ",", "ST", "=", "CA", ",", "C", "=", "US", "\"", ",", "CredentialsNameProvider", ".", "name", "(", "new", "CertificateCredentialsImpl", "(", "null", ",", "\"", "abc123", "\"", ",", "null", ",", "\"", "password", "\"", ",", "storeSource", ")", "))", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1322", "\"", ")", "public", "void", "verifySystemMasterSourceConvertedToUploadedSource", "(", ")", "throws", "Exception", "{", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSource", "storeSource", "=", "new", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSource", "(", "p12", ".", "getAbsolutePath", "(", "))", ";", "CertificateCredentialsImpl", "credentials", "=", "new", "CertificateCredentialsImpl", "(", "null", ",", "\"", "abc123", "\"", ",", "null", ",", "\"", "password", "\"", ",", "storeSource", ")", ";", "SystemCredentialsProvider", ".", "getInstance", "(", ").", "getCredentials", "(", ").", "add", "(", "credentials", ")", ";", "SystemCredentialsProvider", ".", "getInstance", "(", ").", "save", "(", ");", "SystemCredentialsProvider", "provider", "=", "new", "SystemCredentialsProvider", "(", ");", "Credentials", "reloadedCredentials", "=", "provider", ".", "getCredentials", "(", ").", "get", "(", "0", ")", ";", "assertThat", "(", "reloadedCredentials", ",", "instanceOf", "(", "CertificateCredentials", ".", "class", ")", ");", "CertificateCredentialsImpl", ".", "KeyStoreSource", "reloadedSource", "=", "(", "(", "CertificateCredentialsImpl", ")", "reloadedCredentials", ")", ".", "getKeyStoreSource", "(", ");", "assertThat", "(", "reloadedSource", ",", "instanceOf", "(", "CertificateCredentialsImpl", ".", "UploadedKeyStoreSource", ".", "class", ")", ");", "provider", ".", "save", "(", ");", "FilePath", "credentialsXml", "=", "r", ".", "getInstance", "(", ").", "getRootPath", "(", ").", "child", "(", "\"", "credentials", ".", "xml", "\"", ");", "String", "fileContents", "=", "credentialsXml", ".", "readToString", "(", ");", "assertThat", "(", "fileContents", ",", "not", "(", "containsString", "(", "\"", "Master", "\"", "))", ");", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1322", "\"", ")", "public", "void", "verifyGlobalMasterSourceConvertedToUploadedSource", "(", ")", "throws", "Exception", "{", "Folder", "folder", "=", "r", ".", "jenkins", ".", "createProject", "(", "Folder", ".", "class", ",", "\"", "folder1", "\"", ");", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSource", "storeSource", "=", "new", "CertificateCredentialsImpl", ".", "FileOnMasterKeyStoreSource", "(", "p12", ".", "getAbsolutePath", "(", "))", ";", "CertificateCredentialsImpl", "credentials", "=", "new", "CertificateCredentialsImpl", "(", "null", ",", "\"", "abc123", "\"", ",", "null", ",", "\"", "password", "\"", ",", "storeSource", ")", ";", "CredentialsStore", "folderStore", "=", "getFolderStore", "(", "folder", ")", ";", "Domain", "domain", "=", "new", "Domain", "(", "\"", "test", "\"", ",", "\"", "test", "\"", ",", "Collections", ".", "EMPTY_LIST", ")", ";", "folderStore", ".", "addDomain", "(", "domain", ",", "credentials", ")", ";", "folderStore", ".", "save", "(", ");", "folder", ".", "doReload", "(", ");", "CredentialsStore", "reloadedStore", "=", "getFolderStore", "(", "folder", ")", ";", "List", "<", "Credentials", ">", "reloadedCredentialsList", "=", "reloadedStore", ".", "getCredentials", "(", "domain", ")", ";", "assertThat", "(", "reloadedCredentialsList", ",", "hasSize", "(", "1", ")", ");", "Credentials", "reloadedCredentials", "=", "reloadedCredentialsList", ".", "get", "(", "0", ")", ";", "CertificateCredentialsImpl", ".", "KeyStoreSource", "reloadedSource", "=", "(", "(", "CertificateCredentialsImpl", ")", "reloadedCredentials", ")", ".", "getKeyStoreSource", "(", ");", "assertThat", "(", "reloadedSource", ",", "instanceOf", "(", "CertificateCredentialsImpl", ".", "UploadedKeyStoreSource", ".", "class", ")", ");", "reloadedStore", ".", "save", "(", ");", "String", "configFileContent", "=", "folder", ".", "getConfigFile", "(", ").", "asString", "(", ");", "assertThat", "(", "configFileContent", ",", "not", "(", "containsString", "(", "\"", "Master", "\"", "))", ");", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1322", "\"", ")", "@", "LocalData", "(", "\"", "updateFolder", "\"", ")", "public", "void", "verifyUserWithoutRunScriptsCannotUploadMasterKeySource", "(", ")", "throws", "Exception", "{", "Folder", "folder", "=", "r", ".", "jenkins", ".", "createProject", "(", "Folder", ".", "class", ",", "\"", "folder1", "\"", ");", "FilePath", "updateFolder", "=", "r", ".", "jenkins", ".", "getRootPath", "(", ").", "child", "(", "\"", "updateFolder", ".", "xml", "\"", ");", "CLICommandInvoker", ".", "Result", "result", "=", "new", "CLICommandInvoker", "(", "r", ",", "new", "UpdateJobCommand", "(", "))", ".", "authorizedTo", "(", "Jenkins", ".", "READ", ",", "Job", ".", "READ", ",", "Job", ".", "CONFIGURE", ")", ".", "withStdin", "(", "updateFolder", ".", "read", "(", "))", ".", "invokeWithArgs", "(", "\"", "folder1", "\"", ");", "assertThat", "(", "result", ".", "stderr", "(", "),", "containsString", "(", "\"", "user", "is", "missing", "the", "Overall", "/", "RunScripts", "permission", "\"", "))", ";", "/", "/", "-", "1", "=", "means", "An", "error", "occurred", ",", "according", "to", "JENKINS", "-", "32273", "assertThat", "(", "result", ",", "failedWith", "(", "-", "1", ")", ");", "String", "configFileContent", "=", "folder", ".", "getConfigFile", "(", ").", "asString", "(", ");", "assertThat", "(", "configFileContent", ",", "not", "(", "containsString", "(", "\"", "Master", "\"", "))", ");", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "1322", "\"", ")", "@", "LocalData", "(", "\"", "updateFolder", "\"", ")", "public", "void", "verifyUserWithRunScriptsCanUploadMasterKeySource", "(", ")", "throws", "Exception", "{", "Folder", "folder", "=", "r", ".", "jenkins", ".", "createProject", "(", "Folder", ".", "class", ",", "\"", "folder1", "\"", ");", "FilePath", "updateFolder", "=", "r", ".", "jenkins", ".", "getRootPath", "(", ").", "child", "(", "\"", "updateFolder", ".", "xml", "\"", ");", "CLICommandInvoker", ".", "Result", "result", "=", "new", "CLICommandInvoker", "(", "r", ",", "new", "UpdateJobCommand", "(", "))", ".", "authorizedTo", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "withStdin", "(", "updateFolder", ".", "read", "(", "))", ".", "invokeWithArgs", "(", "\"", "folder1", "\"", ");", "assertThat", "(", "result", ",", "succeeded", "(", "))", ";", "Domain", "domain", "=", "new", "Domain", "(", "\"", "test", "\"", ",", "\"", "test", "\"", ",", "Collections", ".", "EMPTY_LIST", ")", ";", "/", "/", "check", "the", "data", "is", "correctly", "updated", "in", "memory", "CredentialsStore", "folderStore", "=", "getFolderStore", "(", "folder", ")", ";", "List", "<", "Credentials", ">", "credentialsList", "=", "folderStore", ".", "getCredentials", "(", "domain", ")", ";", "assertThat", "(", "credentialsList", ",", "hasSize", "(", "1", ")", ");", "Credentials", "credentials", "=", "credentialsList", ".", "get", "(", "0", ")", ";", "CertificateCredentialsImpl", ".", "KeyStoreSource", "source", "=", "(", "(", "CertificateCredentialsImpl", ")", "credentials", ")", ".", "getKeyStoreSource", "(", ");", "assertThat", "(", "source", ",", "instanceOf", "(", "CertificateCredentialsImpl", ".", "UploadedKeyStoreSource", ".", "class", ")", ");", "folder", ".", "doReload", "(", ");", "/", "/", "as", "well", "as", "after", "a", "reload", "CredentialsStore", "reloadedFolderStore", "=", "getFolderStore", "(", "folder", ")", ";", "List", "<", "Credentials", ">", "reloadedCredentialsList", "=", "reloadedFolderStore", ".", "getCredentials", "(", "domain", ")", ";", "assertThat", "(", "reloadedCredentialsList", ",", "hasSize", "(", "1", ")", ");", "Credentials", "reloadedCredentials", "=", "reloadedCredentialsList", ".", "get", "(", "0", ")", ";", "CertificateCredentialsImpl", ".", "KeyStoreSource", "reloadedSource", "=", "(", "(", "CertificateCredentialsImpl", ")", "reloadedCredentials", ")", ".", "getKeyStoreSource", "(", ");", "assertThat", "(", "reloadedSource", ",", "instanceOf", "(", "CertificateCredentialsImpl", ".", "UploadedKeyStoreSource", ".", "class", ")", ");", "}", "private", "CredentialsStore", "getFolderStore", "(", "Folder", "f", ")", "{", "Iterable", "<", "CredentialsStore", ">", "stores", "=", "CredentialsProvider", ".", "lookupStores", "(", "f", ")", ";", "CredentialsStore", "folderStore", "=", "null", ";", "for", "(", "CredentialsStore", "s", ":", "stores", ")", "{", "if", "(", "s", ".", "getProvider", "(", ")", "instanceof", "FolderCredentialsProvider", "&", "&", "s", ".", "getContext", "(", ")", "=", "=", "f", ")", "{", "folderStore", "=", "s", ";", "break", ";", "}", "}", "return", "folderStore", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "50", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", ">", "<", "properties", ">", "<", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "properties", ".", "FolderCredentialsProvider_", "-", "FolderCredentialsProperty", ">", "<", "domainCredentialsMap", "class", "=", "\"", "hudson", ".", "util", ".", "CopyOnWriteMap", "$", "Hash", "\"", ">", "<", "entry", ">", "<", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ">", "<", "specifications", "/", ">", "<", "/", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ">", "<", "java", ".", "util", ".", "concurrent", ".", "CopyOnWriteArrayList", "/", ">", "<", "/", "entry", ">", "<", "entry", ">", "<", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ">", "<", "name", ">", "test", "<", "/", "name", ">", "<", "description", ">", "test", "<", "/", "description", ">", "<", "specifications", "/", ">", "<", "/", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ">", "<", "list", ">", "<", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "CertificateCredentialsImpl", ">", "<", "id", ">", "abc123", "<", "/", "id", ">", "<", "description", ">", "</", "description", ">", "<", "keyStoreSource", "class", "=", "\"", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "CertificateCredentialsImpl", "$", "FileOnMasterKeyStoreSource", "\"", ">", "<", "keyStoreFile", ">", "/", "var", "/", "folders", "/", "1_", "/", "75tlch4x6297hbn2f2xl41hw0000gn", "/", "T", "/", "junit1296816016832319162", "/", "test", ".", "p12", "<", "/", "keyStoreFile", ">", "<", "/", "keyStoreSource", ">", "<", "password", ">", "Q", "+", "y6JDkS3krlY0cRvZ54ahQPQDOCauzcZ", "/", "W0Aw0eT5g", "=", "</", "password", ">", "<", "/", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "CertificateCredentialsImpl", ">", "<", "/", "list", ">", "<", "/", "entry", ">", "<", "/", "domainCredentialsMap", ">", "<", "/", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "properties", ".", "FolderCredentialsProvider_", "-", "FolderCredentialsProperty", ">", "<", "/", "properties", ">", "<", "folderViews", "class", "=", "\"", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "views", ".", "DefaultFolderViewHolder", "\"", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", "\"", "reference", "=", "\".", "./", "..", "/.", "./", "..", "\"/", ">", "<", "name", ">", "All", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "tabBar", "class", "=", "\"", "hudson", ".", "views", ".", "DefaultViewsTabBar", "\"", "/>", "<", "/", "folderViews", ">", "<", "healthMetrics", ">", "<", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "health", ".", "WorstChildHealthMetric", ">", "<", "nonRecursive", ">", "false", "<", "/", "nonRecursive", ">", "<", "/", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "health", ".", "WorstChildHealthMetric", ">", "<", "/", "healthMetrics", ">", "<", "icon", "class", "=", "\"", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "icons", ".", "StockFolderIcon", "\"", "/>", "<", "/", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", ">", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["sending", "a", "specially-crafted", "form", "validation", "request"]}
{"contents": ["ACPICA:", "acpi:", "acpica:", "fix", "acpi", "operand", "cache", "leak", "in", "nseval.c", "I", "found", "an", "ACPI", "cache", "leak", "in", "ACPI", "early", "termination", "and", "boot", "continuing", "case.", "When", "early", "termination", "occurs", "due", "to", "malicious", "ACPI", "table,", "Linux", "kernel", "terminates", "ACPI", "function", "and", "continues", "to", "boot", "process.", "While", "kernel", "terminates", "ACPI", "function,", "kmem_cache_destroy()", "reports", "Acpi-Operand", "cache", "leak.", "Boot", "log", "of", "ACPI", "operand", "cache", "leak", "is", "as", "follows:", ">[", "0.464168]", "ACPI:", "Added", "_OSI(Module", "Device)", ">[", "0.467022]", "ACPI:", "Added", "_OSI(Processor", "Device)", ">[", "0.469376]", "ACPI:", "Added", "_OSI(3.0", "_SCP", "Extensions)", ">[", "0.471647]", "ACPI:", "Added", "_OSI(Processor", "Aggregator", "Device)", ">[", "0.477997]", "ACPI", "Error:", "Null", "stack", "entry", "at", "ffff880215c0aad8", "(20170303/exresop-174)", ">[", "0.482706]", "ACPI", "Exception:", "AE_AML_INTERNAL,", "While", "resolving", "operands", "for", "[opcode_name", "unavailable]", "(20170303/dswexec-461)", ">[", "0.487503]", "ACPI", "Error:", "Method", "parse/execution", "failed", "[\\DBG]", "(Node", "ffff88021710ab40),", "AE_AML_INTERNAL", "(20170303/psparse-543)", ">[", "0.492136]", "ACPI", "Error:", "Method", "parse/execution", "failed", "[\\_SB._INI]", "(Node", "ffff88021710a618),", "AE_AML_INTERNAL", "(20170303/psparse-543)", ">[", "0.497683]", "ACPI:", "Interpreter", "enabled", ">[", "0.499385]", "ACPI:", "(supports", "S0)", ">[", "0.501151]", "ACPI:", "Using", "IOAPIC", "for", "interrupt", "routing", ">[", "0.503342]", "ACPI", "Error:", "Null", "stack", "entry", "at", "ffff880215c0aad8", "(20170303/exresop-174)", ">[", "0.506522]", "ACPI", "Exception:", "AE_AML_INTERNAL,", "While", "resolving", "operands", "for", "[opcode_name", "unavailable]", "(20170303/dswexec-461)", ">[", "0.510463]", "ACPI", "Error:", "Method", "parse/execution", "failed", "[\\DBG]", "(Node", "ffff88021710ab40),", "AE_AML_INTERNAL", "(20170303/psparse-543)", ">[", "0.514477]", "ACPI", "Error:", "Method", "parse/execution", "failed", "[\\_PIC]", "(Node", "ffff88021710ab18),", "AE_AML_INTERNAL", "(20170303/psparse-543)", ">[", "0.518867]", "ACPI", "Exception:", "AE_AML_INTERNAL,", "Evaluating", "_PIC", "(20170303/bus-991)", ">[", "0.522384]", "kmem_cache_destroy", "Acpi-Operand:", "Slab", "cache", "still", "has", "objects", ">[", "0.524597]", "CPU:", "1", "PID:", "1", "Comm:", "swapper/0", "Not", "tainted", "4.12.0-rc5", "#26", ">[", "0.526795]", "Hardware", "name:", "innotek", "gmb_h", "virtual_box/virtual_box,", "BIOS", "virtual_box", "12/01/2006", ">[", "0.529668]", "Call", "Trace:", ">[", "0.530811]", "?", "dump_stack+0x5c/0x81", ">[", "0.532240]", "?", "kmem_cache_destroy+0x1aa/0x1c0", ">[", "0.533905]", "?", "acpi_os_delete_cache+0xa/0x10", ">[", "0.535497]", "?", "acpi_ut_delete_caches+0x3f/0x7b", ">[", "0.537237]", "?", "acpi_terminate+0xa/0x14", ">[", "0.538701]", "?", "acpi_init+0x2af/0x34f", ">[", "0.540008]", "?", "acpi_sleep_proc_init+0x27/0x27", ">[", "0.541593]", "?", "do_one_initcall+0x4e/0x1a0", ">[", "0.543008]", "?", "kernel_init_freeable+0x19e/0x21f", ">[", "0.546202]", "?", "rest_init+0x80/0x80", ">[", "0.547513]", "?", "kernel_init+0xa/0x100", ">[", "0.548817]", "?", "ret_from_fork+0x25/0x30", ">[", "0.550587]", "vgaarb:", "loaded", ">[", "0.551716]", "EDAC", "MC:", "Ver:", "3.0.0", ">[", "0.553744]", "PCI:", "Probing", "PCI", "hardware", ">[", "0.555038]", "PCI", "host", "bridge", "to", "bus", "0000:00", ">", "...", "Continue", "to", "boot", "and", "log", "is", "omitted", "...", "I", "analyzed", "this", "memory", "leak", "in", "detail", "and", "found", "acpi_ns_evaluate()", "function", "only", "removes", "Info->return_object", "in", "AE_CTRL_RETURN_VALUE", "case.", "But,", "when", "errors", "occur,", "the", "status", "value", "is", "not", "AE_CTRL_RETURN_VALUE,", "and", "Info->return_object", "is", "also", "not", "null.", "Therefore,", "this", "causes", "acpi", "operand", "memory", "leak.", "This", "cache", "leak", "causes", "a", "security", "threat", "because", "an", "old", "kernel", "(<=", "4.9)", "shows", "memory", "locations", "of", "kernel", "functions", "in", "stack", "dump.", "Some", "malicious", "users", "could", "use", "this", "information", "to", "neutralize", "kernel", "ASLR.", "I", "made", "a", "patch", "to", "fix", "ACPI", "operand", "cache", "leak.", "Signed-off-by:", "Seunghun", "Han", "<kkamagui@gmail.com>", "Signed-off-by:", "Erik", "Schmauss", "<erik.schmauss@intel.com>", "Signed-off-by:", "Rafael", "J.", "Wysocki", "<rafael.j.wysocki@intel.com>"], "code_tokens": ["@", "@", "-", "310", ",", "6", "+", "310", ",", "14", "@", "@", "acpi_status", "acpi_ns_evaluate", "(", "struct", "acpi_evaluate_info", "*", "info", ")", "/", "*", "Map", "AE_CTRL_RETURN_VALUE", "to", "AE_OK", ",", "we", "are", "done", "with", "it", "*", "/", "status", "=", "AE_OK", ";", "}", "else", "if", "(", "ACPI_FAILURE", "(", "status", ")", ")", "{", "/", "*", "If", "return_object", "exists", ",", "delete", "it", "*", "/", "if", "(", "info", "-", ">", "return_object", ")", "{", "acpi_ut_remove_reference", "(", "info", "-", ">", "return_object", ")", ";", "info", "-", ">", "return_object", "=", "NULL", ";", "}", "}", "ACPI_DEBUG_PRINT", "(", "(", "ACPI_DB_NAMES", ","], "docstring_tokens": ["using", "a", "specially-rafted", "ACPI", "table"]}
{"contents": ["Add", "mitigation", "for", "(bug", "#68925)"], "code_tokens": ["@", "@", "-", "2", ",", "6", "+", "2", ",", "10", "@", "@", "PHP", "NEWS", "|", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "?", "?", "?", "??", "20", "?", "?", "PHP", "5", ".", "4", ".", "38", "-", "Core", ":", ".", "Fixed", "bug", "#", "68925", "(", "Mitigation", "for", "CVE", "-", "2015", "-", "0235", "\u2013", "GHOST", ":", "glibc", "gethostbyname", "buffer", "overflow", ")", ".", "(", "Stas", ")", "22", "Jan", "2015", "PHP", "5", ".", "4", ".", "37", "-", "Core", ":", ".", "Fixed", "bug", "#", "68710", "(", "Use", "After", "Free", "Vulnerability", "in", "PHP", "'", "s", "unserialize", "(", "))", ".", "@", "@", "-", "222", ",", "6", "+", "222", ",", "11", "@", "@", "PHP_FUNCTION", "(", "gethostbyname", ")", "return", ";", "}", "if", "(", "hostname_len", ">", "MAXHOSTNAMELEN", ")", "{", "/", "*", "name", "too", "long", ",", "protect", "from", "CVE", "-", "2015", "-", "0235", "*", "/", "php_error_docref", "(", "NULL", ",", "E_WARNING", ",", "\"", "Host", "name", "is", "too", "long", ",", "the", "limit", "is", "%", "d", "characters", "\"", ",", "MAXHOSTNAMELEN", ")", ";", "RETURN_STRINGL", "(", "hostname", ",", "hostname_len", ",", "1", ")", ";", "}", "addr", "=", "php_gethostbyname", "(", "hostname", ")", ";", "RETVAL_STRING", "(", "addr", ",", "0", ")", ";", "@", "@", "-", "242", ",", "6", "+", "247", ",", "12", "@", "@", "PHP_FUNCTION", "(", "gethostbynamel", ")", "return", ";", "}", "if", "(", "hostname_len", ">", "MAXHOSTNAMELEN", ")", "{", "/", "*", "name", "too", "long", ",", "protect", "from", "CVE", "-", "2015", "-", "0235", "*", "/", "php_error_docref", "(", "NULL", ",", "E_WARNING", ",", "\"", "Host", "name", "is", "too", "long", ",", "the", "limit", "is", "%", "d", "characters", "\"", ",", "MAXHOSTNAMELEN", ")", ";", "RETURN_FALSE", ";", "}", "hp", "=", "gethostbyname", "(", "hostname", ")", ";", "if", "(", "hp", "=", "=", "NULL", "|", "|", "hp", "-", ">", "h_addr_list", "=", "=", "NULL", ")", "{", "RETURN_FALSE", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "13", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "68925", "(", "CVE", "-", "2015", "-", "0235", "\u2013", "GHOST", ":", "glibc", "gethostbyname", "buffer", "overflow", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "gethostbyname", "(", "str_repeat", "(", "\"", "0", "\"", ",", "2501", ")", "))", ";", "var_dump", "(", "gethostbynamel", "(", "str_repeat", "(", "\"", "0", "\"", ",", "2501", ")", "))", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "gethostbyname", "(", "):", "Host", "name", "is", "too", "long", ",", "the", "limit", "is", "256", "characters", "in", "%", "s", "/", "bug68925", ".", "php", "on", "line", "%", "d", "string", "(", "2501", ")", "\"", "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "\"", "Warning", ":", "gethostbynamel", "(", "):", "Host", "name", "is", "too", "long", ",", "the", "limit", "is", "256", "characters", "in", "%", "s", "/", "bug68925", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "#", "include", "\"", "php", ".", "h", "\"", "#", "include", "<", "stddef", ".", "h", ">", "#", "include", "<", "errno", ".", "h", ">", "#", "ifdef", "PHP_WIN32", "#", "include", "\"", "win32", "/", "inet", ".", "h", "\"", "@", "@", "-", "102", ",", "6", "+", "103", ",", "10", "@", "@", "const", "struct", "in6_addr", "in6addr_any", "=", "{", "0", "}", ";", "/", "*", "IN6ADDR_ANY_INIT", ";", "*", "/", "#", "define", "PHP_TIMEOUT_ERROR_VALUE", "ETIMEDOUT", "#", "endif", "#", "ifndef", "MAXHOSTNAMELEN", "#", "define", "MAXHOSTNAMELEN", "255", "#", "endif", "#", "if", "HAVE_GETADDRINFO", "#", "ifdef", "HAVE_GAI_STRERROR", "#", "define", "PHP_GAI_STRERROR", "(", "x", ")", "(", "gai_strerror", "(", "x", ")", ")", "@", "@", "-", "243", ",", "7", "+", "248", ",", "12", "@", "@", "PHPAPI", "int", "php_network_getaddresses", "(", "const", "char", "*", "host", ",", "int", "socktype", ",", "struct", "socka", "#", "else", "if", "(", "!", "inet_aton", "(", "host", ",", "&", "in", ")", ")", "{", "/", "*", "XXX", "NOT", "THREAD", "SAFE", "(", "is", "safe", "under", "win32", ")", "*", "/", "host_info", "=", "gethostbyname", "(", "host", ")", ";", "if", "(", "strlen", "(", "host", ")", ">", "MAXHOSTNAMELEN", ")", "{", "host_info", "=", "NULL", ";", "errno", "=", "E2BIG", ";", "}", "else", "{", "host_info", "=", "gethostbyname", "(", "host", ")", ";", "}", "if", "(", "host_info", "=", "=", "NULL", ")", "{", "if", "(", "error_string", ")", "{", "spprintf", "(", "error_string", ",", "0", ",", "\"", "php_network_getaddresses", ":", "gethostbyname", "failed", ".", "errno", "=", "%", "d", "\"", ",", "errno", ")", ";", "@", "@", "-", "611", ",", "7", "+", "611", ",", "11", "@", "@", "int", "fcgi_listen", "(", "const", "char", "*", "path", ",", "int", "backlog", ")", "if", "(", "sa", ".", "sa_inet", ".", "sin_addr", ".", "s_addr", "=", "=", "INADDR_NONE", ")", "{", "struct", "hostent", "*", "hep", ";", "hep", "=", "gethostbyname", "(", "host", ")", ";", "if", "(", "strlen", "(", "host", ")", ">", "MAXHOSTNAMELEN", ")", "{", "hep", "=", "NULL", ";", "}", "else", "{", "hep", "=", "gethostbyname", "(", "host", ")", ";", "}", "if", "(", "!", "hep", "|", "|", "hep", "-", ">", "h_addrtype", "!", "=", "AF_INET", "|", "|", "!", "hep", "-", ">", "h_addr_list", "[", "0", "]", ")", "{", "fprintf", "(", "stderr", ",", "\"", "Cannot", "resolve", "host", "name", "'", "%", "s", "'", "!\\", "n", "\"", ",", "host", ")", ";", "return", "-", "1", ";"], "docstring_tokens": ["or", "a", "compromise", "of", "related", "systems", "-", "such", "as", "those", "holding", "web", "server", "backups"]}
{"contents": ["KAFKA-8774:", "Regex", "can", "be", "found", "anywhere", "in", "config", "value", "(#7197)", "Corrected", "the", "AbstractHerder", "to", "correctly", "identify", "task", "configs", "that", "contain", "variables", "for", "externalized", "secrets.", "The", "original", "method", "incorrectly", "used", "`matcher.matches()`", "instead", "of", "`matcher.find()`.", "The", "former", "method", "expects", "the", "entire", "string", "to", "match", "the", "regex,", "whereas", "the", "second", "one", "can", "find", "a", "pattern", "anywhere", "within", "the", "input", "string", "(which", "fits", "this", "use", "case", "more", "correctly).", "Added", "unit", "tests", "to", "cover", "various", "cases", "of", "a", "config", "with", "externalized", "secrets,", "and", "updated", "system", "tests", "to", "cover", "case", "where", "config", "value", "contains", "additional", "characters", "besides", "secret", "that", "requires", "regex", "pattern", "to", "be", "found", "anywhere", "in", "the", "string", "(as", "opposed", "to", "complete", "match).", "Author:", "Arjun", "Satish", "<arjun@confluent.io>", "Reviewer:", "Randall", "Hauch", "<rhauch@gmail.com>"], "code_tokens": ["@", "@", "-", "461", ",", "12", "+", "461", ",", "13", "@", "@", "private", "String", "trace", "(", "Throwable", "t", ")", "{", "return", "result", ";", "}", "private", "static", "Set", "<", "String", ">", "keysWithVariableValues", "(", "Map", "<", "String", ",", "String", ">", "rawConfig", ",", "Pattern", "pattern", ")", "{", "/", "/", "Visible", "for", "testing", "static", "Set", "<", "String", ">", "keysWithVariableValues", "(", "Map", "<", "String", ",", "String", ">", "rawConfig", ",", "Pattern", "pattern", ")", "{", "Set", "<", "String", ">", "keys", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "config", ":", "rawConfig", ".", "entrySet", "(", "))", "{", "if", "(", "config", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "config", ".", "getValue", "(", "))", ";", "if", "(", "matcher", ".", "matches", "(", "))", "{", "if", "(", "matcher", ".", "find", "(", "))", "{", "keys", ".", "add", "(", "config", ".", "getKey", "(", "))", ";", "}", "}", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "config", ".", "ConfigDef", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "config", ".", "ConfigException", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "config", ".", "ConfigTransformer", ";", "import", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "connector", ".", "ConnectRecord", ";", "import", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "connector", ".", "Connector", ";", "import", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "runtime", ".", "distributed", ".", "ClusterConfigState", ";", "@", "@", "-", "52", ",", "6", "+", "53", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "runtime", ".", "AbstractHerder", ".", "keysWithVariableValues", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "easymock", ".", "PowerMock", ".", "verifyAll", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "easymock", ".", "PowerMock", ".", "replayAll", ";", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "strictMock", ";", "@", "@", "-", "322", ",", "6", "+", "324", ",", "32", "@", "@", "public", "void", "testReverseTransformConfigs", "(", ")", "throws", "Exception", "{", "assertFalse", "(", "reverseTransformed", ".", "get", "(", "0", ")", ".", "containsKey", "(", "TEST_KEY3", ")", ");", "}", "@", "Test", "public", "void", "testConfigProviderRegex", "(", ")", "{", "testConfigProviderRegex", "(", "\"\\", "\"$", "{:", ":}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"$", "{:", ":}", "\")", ";", "testConfigProviderRegex", "(", "\"\\", "\"$", "{:", "/", "a", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"\\", "\"$", "{", "file", ":", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"$", "{", "file", ":", "/", "a", "/", "b", "/", "c", ":", "}\"", ");", "testConfigProviderRegex", "(", "\"$", "{", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\")", ";", "testConfigProviderRegex", "(", "\"\\", "\"$", "{", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "\\\"", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "not", "null", "\"", ");", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "password", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "othervar", "}", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "\"", ",", "false", ")", ";", "}", "private", "void", "testConfigProviderRegex", "(", "String", "rawConnConfig", ")", "{", "testConfigProviderRegex", "(", "rawConnConfig", ",", "true", ")", ";", "}", "private", "void", "testConfigProviderRegex", "(", "String", "rawConnConfig", ",", "boolean", "expected", ")", "{", "Set", "<", "String", ">", "keys", "=", "keysWithVariableValues", "(", "Collections", ".", "singletonMap", "(", "\"", "key", "\"", ",", "rawConnConfig", ")", ",", "ConfigTransformer", ".", "DEFAULT_PATTERN", ")", ";", "boolean", "actual", "=", "keys", "!", "=", "null", "&", "&", "!", "keys", ".", "isEmpty", "(", ")", "&", "&", "keys", ".", "contains", "(", "\"", "key", "\"", ");", "assertEquals", "(", "String", ".", "format", "(", "\"%", "s", "should", "have", "matched", "regex", "\"", ",", "rawConnConfig", ")", ",", "expected", ",", "actual", ")", ";", "}", "private", "AbstractHerder", "createConfigValidationHerder", "(", "Class", "<", "?", "extends", "Connector", ">", "connectorClass", ")", "{", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "class", "ConnectRestApiTest", "(", "KafkaTest", ")", ":", "INPUT_FILE2", "=", "\"", "/", "mnt", "/", "connect", ".", "input2", "\"", "OUTPUT_FILE", "=", "\"", "/", "mnt", "/", "connect", ".", "output", "\"", "TOPIC", "=", "\"", "${", "file", ":", "%", "s", ":", "topic", ".", "external", "}", "\"", "%", "ConnectServiceBase", ".", "EXTERNAL_CONFIGS_FILE", "TOPIC", "=", "\"", "topic", "-", "${", "file", ":", "%", "s", ":", "topic", ".", "external", "}", "\"", "%", "ConnectServiceBase", ".", "EXTERNAL_CONFIGS_FILE", "TOPIC_TEST", "=", "\"", "test", "\"", "DEFAULT_BATCH_SIZE", "=", "\"", "2000", "\""], "docstring_tokens": ["sending", "specially", "crafted", "request"]}
{"contents": ["Fix", "ReDoS", "vulnerabilities", "reported", "by", "Snyk"], "code_tokens": ["@", "@", "-", "222", ",", "7", "+", "222", ",", "7", "@", "@", "/", "/", "Presto", "based", "/", "(", "opera", "\\", "smini", ")", "\\/", "([", "\\", "w", "\\", ".-", "]+", ")/", "i", ",", "/", "/", "Opera", "Mini", "/", "(", "opera", "\\", "s", "[", "mobiletab", "]", "+)", ".+", "version", "\\", "/(", "[\\", "w", "\\", ".-", "]+", ")/", "i", ",", "/", "/", "Opera", "Mobi", "/", "Tablet", "/", "(", "opera", "\\", "s", "[", "mobiletab", "]", "{", "3", ",", "6", "}", ").", "+", "version", "\\", "/(", "[\\", "w", "\\", ".-", "]+", ")/", "i", ",", "/", "/", "Opera", "Mobi", "/", "Tablet", "/", "(", "opera", ")", ".+", "version", "\\", "/(", "[\\", "w", "\\", ".]", "+)", "/", "i", ",", "/", "/", "Opera", ">", "9", ".", "80", "/", "(", "opera", ")", "[\\", "/\\", "s", "]", "+(", "[\\", "w", "\\", ".]", "+)", "/", "i", "/", "/", "Opera", "<", "9", ".", "80", "]", ",", "[", "NAME", ",", "VERSION", "]", ",", "[", "@", "@", "-", "252", ",", "7", "+", "252", ",", "7", "@", "@", "/", "(", "konqueror", ")", "\\/", "([", "\\", "w", "\\", ".]", "+)", "/", "i", "/", "/", "Konqueror", "]", ",", "[", "[", "NAME", ",", "'", "Konqueror", "'", "],", "VERSION", "]", ",", "[", "/", "(", "trident", ")", ".+", "rv", "[", ":\\", "s", "]", "([", "\\", "w", "\\", ".]", "+)", ".+", "like", "\\", "sgecko", "/", "i", "/", "/", "IE11", "/", "(", "trident", ")", ".+", "rv", "[", ":\\", "s", "]", "([", "\\", "w", "\\", ".]", "{", "1", ",", "9", "}", ").", "+", "like", "\\", "sgecko", "/", "i", "/", "/", "IE11", "]", ",", "[", "[", "NAME", ",", "'", "IE", "'", "],", "VERSION", "]", ",", "[", "/", "(", "edge", "|", "edgios", "|", "edga", "|", "edg", ")", "\\/", "((", "\\", "d", "+", ")?", "[\\", "w", "\\", ".]", "+)", "/", "i", "/", "/", "Microsoft", "Edge", "@", "@", "-", "362", ",", "13", "+", "362", ",", "13", "@", "@", "/", "fxios", "\\", "/(", "[\\", "w", "\\", ".-", "]+", ")/", "i", "/", "/", "Firefox", "for", "iOS", "]", ",", "[", "VERSION", ",", "[", "NAME", ",", "'", "Firefox", "'", "]]", ",", "[", "/", "version", "\\", "/(", "[\\", "w", "\\", ".]", "+)", ".+", "?", "mobile", "\\", "/\\", "w", "+", "\\", "s", "(", "safari", ")", "/", "i", "/", "/", "Mobile", "Safari", "/", "version", "\\", "/(", "[\\", "w", "\\", ".]", "+)", "\\", "s", ".", "*", "mobile", "\\", "/\\", "w", "+", "\\", "s", "(", "safari", ")", "/", "i", "/", "/", "Mobile", "Safari", "]", ",", "[", "VERSION", ",", "[", "NAME", ",", "'", "Mobile", "Safari", "'", "]]", ",", "[", "/", "version", "\\", "/(", "[\\", "w", "\\", ".]", "+)", ".+", "?(", "mobile", "\\", "s", "?", "safari", "|", "safari", ")", "/", "i", "/", "/", "Safari", "&", "Safari", "Mobile", "/", "version", "\\", "/(", "[\\", "w", "\\", ".]", "+)", "\\", "s", ".", "*(", "mobile", "\\", "s", "?", "safari", "|", "safari", ")", "/", "i", "/", "/", "Safari", "&", "Safari", "Mobile", "]", ",", "[", "VERSION", ",", "NAME", "]", ",", "[", "/", "webkit", ".", "+?", "(", "gsa", ")", "\\/", "([", "\\", "w", "\\", ".]", "+)", ".+", "?(", "mobile", "\\", "s", "?", "safari", "|", "safari", ")", "(\\", "/[", "\\", "w", "\\", ".]", "+)", "/", "i", "/", "/", "Google", "Search", "Appliance", "on", "iOS", "/", "webkit", ".", "+?", "(", "gsa", ")", "\\/", "([", "\\", "w", "\\", ".]", "+)", "\\", "s", ".", "*(", "mobile", "\\", "s", "?", "safari", "|", "safari", ")", "(\\", "/[", "\\", "w", "\\", ".]", "+)", "/", "i", "/", "/", "Google", "Search", "Appliance", "on", "iOS", "]", ",", "[", "[", "NAME", ",", "'", "GSA", "'", "],", "VERSION", "]", ",", "[", "/", "webkit", ".", "+?", "(", "mobile", "\\", "s", "?", "safari", "|", "safari", ")", "(\\", "/[", "\\", "w", "\\", ".]", "+)", "/", "i", "/", "/", "Safari", "<", "3", ".", "0", "@", "@", "-", "387", ",", "7", "+", "387", ",", "7", "@", "@", "/", "/", "Firefox", "/", "SeaMonkey", "/", "K", "-", "Meleon", "/", "IceCat", "/", "IceApe", "/", "Firebird", "/", "Phoenix", "/", "(", "firefox", ")", "\\/", "([", "\\", "w", "\\", ".]", "+)", "\\", "s", "[", "\\", "w", "\\", "s", "\\", "-]", "+\\", "/[", "\\", "w", "\\", ".]", "+$", "/", "i", ",", "/", "/", "Other", "Firefox", "-", "based", "/", "(", "mozilla", ")", "\\/", "([", "\\", "w", "\\", ".]", "+)", ".+", "rv", "\\", ":.", "+", "gecko", "\\", "/\\", "d", "+", "/", "i", ",", "/", "/", "Mozilla", "/", "(", "mozilla", ")", "\\/", "([", "\\", "w", "\\", ".]", "+)", "\\", "s", ".", "+", "rv", "\\", ":.", "+", "gecko", "\\", "/\\", "d", "+", "/", "i", ",", "/", "/", "Mozilla", "/", "/", "Other", "/", "(", "polaris", "|", "lynx", "|", "dillo", "|", "icab", "|", "doris", "|", "amaya", "|", "w3m", "|", "netsurf", "|", "sleipnir", ")", "[\\", "/\\", "s", "]", "?(", "[\\", "w", "\\", ".]", "+)", "/", "i", ",", "@", "@", "-", "487", ",", "7", "+", "487", ",", "7", "@", "@", "/", "(", "sprint", "\\", "s", "(", "\\", "w", "+", "))", "/", "i", "/", "/", "Sprint", "Phones", "]", ",", "[", "[", "VENDOR", ",", "mapper", ".", "str", ",", "maps", ".", "device", ".", "sprint", ".", "vendor", "]", ",", "[", "MODEL", ",", "mapper", ".", "str", ",", "maps", ".", "device", ".", "sprint", ".", "model", "]", ",", "[", "TYPE", ",", "MOBILE", "]", "],", "[", "/", "(", "htc", ")", "[;", "_", "\\", "s", "-", "]+", "([", "\\", "w", "\\", "s", "]", "+(", "?=", "\\)", "|\\", "sbuild", ")", "|\\", "w", "+", ")/", "i", ",", "/", "/", "HTC", "/", "(", "htc", ")", "[;", "_", "\\", "s", "-", "]{", "1", ",", "2", "}", "([", "\\", "w", "\\", "s", "]", "+(", "?=", "\\)", "|\\", "sbuild", ")", "|\\", "w", "+", ")/", "i", ",", "/", "/", "HTC", "/", "(", "zte", ")", "-(", "\\", "w", "*", ")/", "i", ",", "/", "/", "ZTE", "/", "(", "alcatel", "|", "geeksphone", "|", "nexian", "|", "panasonic", "|", "(?", "=;", "\\", "s", ")", "sony", ")", "[", "_", "\\", "s", "-", "]?", "([", "\\", "w", "-", "]*", ")/", "i", "/", "/", "Alcatel", "/", "GeeksPhone", "/", "Nexian", "/", "Panasonic", "/", "Sony", "@", "@", "-", "591", ",", "13", "+", "591", ",", "13", "@", "@", "]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "Google", "'", "],", "[", "TYPE", ",", "MOBILE", "]", "],", "[", "/", "android", ".", "+;", "\\", "s", "(", "\\", "w", "+", ")\\", "s", "+", "build", "\\", "/", "hm", "\\", "1", "/", "i", ",", "/", "/", "Xiaomi", "Hongmi", "'", "numeric", "'", "models", "/", "android", ".", "+(", "hm", "[", "\\", "s", "\\", "-", "_", "]", "*", "note", "?", "[\\", "s_", "]", "*(", "?:", "\\", "d", "\\", "w", ")", "?)", "\\", "s", "+", "build", "/", "i", ",", "/", "/", "Xiaomi", "Hongmi", "/", "android", ".", "+(", "redmi", "[", "\\", "s", "\\", "-", "_", "]", "*(", "?:", "note", "|", "k", ")", "?(", "?:", "[\\", "s_", "]", "?[", "\\", "w", "\\", "s", "]", "+)", ")(", "?:", "\\", "s", "+", "build", "|", "\\)", ")/", "i", ",", "/", "android", ".", "+(", "hm", "[", "\\", "s", "\\", "-", "_", "]", "?", "note", "?", "[\\", "s_", "]", "?(", "?:", "\\", "d", "\\", "w", ")", "?)", "\\", "sbuild", "/", "i", ",", "/", "/", "Xiaomi", "Hongmi", "/", "android", ".", "+(", "redmi", "[", "\\", "s", "\\", "-", "_", "]", "?(", "?:", "note", "|", "k", ")", "?(", "?:", "[\\", "s_", "]", "?[", "\\", "w", "\\", "s", "]", "+)", ")(", "?:", "\\", "sbuild", "|", "\\)", ")/", "i", ",", "/", "/", "Xiaomi", "Redmi", "/", "android", ".", "+(", "mi", "[", "\\", "s", "\\", "-", "_", "]", "*(", "?:", "a", "\\", "d", "|", "one", "|", "one", "[", "\\", "s_", "]", "plus", "|", "note", "lte", ")", "?[", "\\", "s_", "]", "?(", "?:", "\\", "d", "?", "\\", "w", "?", ")[", "\\", "s_", "]", "*(", "?:", "plus", ")", "?)", "\\", "s", "+", "build", "/", "i", "/", "android", ".", "+(", "mi", "[", "\\", "s", "\\", "-", "_", "]", "?(", "?:", "a", "\\", "d", "|", "one", "|", "one", "[", "\\", "s_", "]", "plus", "|", "note", "lte", ")", "?[", "\\", "s_", "]", "?(", "?:", "\\", "d", "?", "\\", "w", "?", ")[", "\\", "s_", "]", "?(", "?:", "plus", ")", "?)", "\\", "sbuild", "/", "i", "/", "/", "Xiaomi", "Mi", "]", ",", "[", "[", "MODEL", ",", "/", "_", "/", "g", ",", "'", "'", "],", "[", "VENDOR", ",", "'", "Xiaomi", "'", "],", "[", "TYPE", ",", "MOBILE", "]", "],", "[", "/", "android", ".", "+(", "mi", "[", "\\", "s", "\\", "-", "_", "]", "*(", "?:", "pad", ")", "(?", ":[", "\\", "s_", "]", "?[", "\\", "w", "\\", "s", "]", "+)", ")(", "?:", "\\", "s", "+", "build", "|", "\\)", ")/", "i", "/", "/", "Mi", "Pad", "tablets", "/", "android", ".", "+(", "mi", "[", "\\", "s", "\\", "-", "_", "]", "?(", "?:", "pad", ")", "(?", ":[", "\\", "s_", "]", "?[", "\\", "w", "\\", "s", "]", "+)", ")(", "?:", "\\", "sbuild", "|", "\\)", ")/", "i", "/", "/", "Mi", "Pad", "tablets", "]", ",[", "[", "MODEL", ",", "/", "_", "/", "g", ",", "'", "'", "],", "[", "VENDOR", ",", "'", "Xiaomi", "'", "],", "[", "TYPE", ",", "TABLET", "]", "],", "[", "/", "android", ".", "+;", "\\", "s", "(", "m", "[", "1", "-", "5", "]", "\\", "snote", ")", "\\", "sbuild", "/", "i", "/", "/", "Meizu", "]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "Meizu", "'", "],", "[", "TYPE", ",", "MOBILE", "]", "],", "[", "@", "@", "-", "611", ",", "7", "+", "611", ",", "7", "@", "@", "/", "android", ".", "+[", ";\\", "/]", "\\", "s", "*", "(", "RCT", "[", "\\", "d", "\\", "w", "]", "+)", "\\", "s", "+", "build", "/", "i", "/", "/", "RCA", "Tablets", "]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "RCA", "'", "],", "[", "TYPE", ",", "TABLET", "]", "],", "[", "/", "android", ".", "+[", ";\\", "/\\", "s", "]", "+(", "Venue", "[", "\\", "d", "\\", "s", "]", "{", "2", ",", "7", "}", ")\\", "s", "+", "build", "/", "i", "/", "/", "Dell", "Venue", "Tablets", "/", "android", ".", "+[", ";\\", "/\\", "s", "]", "(", "Venue", "[", "\\", "d", "\\", "s", "]", "{", "2", ",", "7", "}", ")\\", "s", "+", "build", "/", "i", "/", "/", "Dell", "Venue", "Tablets", "]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "Dell", "'", "],", "[", "TYPE", ",", "TABLET", "]", "],", "[", "/", "android", ".", "+[", ";\\", "/]", "\\", "s", "*", "(", "Q", "[", "T", "|", "M", "]", "[\\", "d", "\\", "w", "]", "+)", "\\", "s", "+", "build", "/", "i", "/", "/", "Verizon", "Tablet", "@", "@", "-", "669", ",", "8", "+", "669", ",", "8", "@", "@", "/", "android", ".", "+[", ";\\", "/]", "\\", "s", "*", "TU_", "(", "1491", ")", "\\", "s", "+", "build", "/", "i", "/", "/", "Rotor", "Tablets", "]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "Rotor", "'", "],", "[", "TYPE", ",", "TABLET", "]", "],", "[", "/", "android", ".", "+(", "KS", "(", ".+", "))", "\\", "s", "+", "build", "/", "i", "/", "/", "Amazon", "Kindle", "Tablets", "]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "Amazon", "'", "],", "[", "TYPE", ",", "TABLET", "]", "],", "[", "/", "/", "android", ".", "+(", "KS", "(", ".+", "))", "\\", "s", "+", "build", "/", "i", "/", "/", "Amazon", "Kindle", "Tablets", "/", "/]", ",", "[", "MODEL", ",", "[", "VENDOR", ",", "'", "Amazon", "'", "],", "[", "TYPE", ",", "TABLET", "]", "],", "[", "/", "android", ".", "+(", "Gigaset", ")", "[\\", "s", "\\", "-]", "+(", "Q", "\\", "w", "{", "1", ",", "9", "}", ")\\", "s", "+", "build", "/", "i", "/", "/", "Gigaset", "Tablets", "]", ",", "[", "VENDOR", ",", "MODEL", ",", "[", "TYPE", ",", "TABLET", "]", "],", "["], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["vfs:", "Carefully", "propogate", "mounts", "across", "user", "namespaces", "As", "a", "matter", "of", "policy", "MNT_READONLY", "should", "not", "be", "changable", "if", "the", "original", "mounter", "had", "more", "privileges", "than", "creator", "of", "the", "mount", "namespace.", "Add", "the", "flag", "CL_UNPRIVILEGED", "to", "note", "when", "we", "are", "copying", "a", "mount", "from", "a", "mount", "namespace", "that", "requires", "more", "privileges", "to", "a", "mount", "namespace", "that", "requires", "fewer", "privileges.", "When", "the", "CL_UNPRIVILEGED", "flag", "is", "set", "cause", "clone_mnt", "to", "set", "MNT_NO_REMOUNT", "if", "any", "of", "the", "mnt", "flags", "that", "should", "never", "be", "changed", "are", "set.", "This", "protects", "both", "mount", "propagation", "and", "the", "initial", "creation", "of", "a", "less", "privileged", "mount", "namespace.", "Cc:", "stable@vger.kernel.org", "Acked-by:", "Serge", "Hallyn", "<serge.hallyn@canonical.com>", "Reported-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>"], "code_tokens": ["@", "@", "-", "798", ",", "6", "+", "798", ",", "10", "@", "@", "static", "struct", "mount", "*", "clone_mnt", "(", "struct", "mount", "*", "old", ",", "struct", "dentry", "*", "root", ",", "}", "mnt", "-", ">", "mnt", ".", "mnt_flags", "=", "old", "-", ">", "mnt", ".", "mnt_flags", "&", "~", "MNT_WRITE_HOLD", ";", "/", "*", "Don", "'", "t", "allow", "unprivileged", "users", "to", "change", "mount", "flags", "*", "/", "if", "(", "(", "flag", "&", "CL_UNPRIVILEGED", ")", "&", "&", "(", "mnt", "-", ">", "mnt", ".", "mnt_flags", "&", "MNT_READONLY", ")", ")", "mnt", "-", ">", "mnt", ".", "mnt_flags", "|", "=", "MNT_LOCK_READONLY", ";", "atomic_inc", "(", "&", "sb", "-", ">", "s_active", ")", ";", "mnt", "-", ">", "mnt", ".", "mnt_sb", "=", "sb", ";", "mnt", "-", ">", "mnt", ".", "mnt_root", "=", "dget", "(", "root", ")", ";", "@", "@", "-", "2342", ",", "7", "+", "2346", ",", "7", "@", "@", "static", "struct", "mnt_namespace", "*", "dup_mnt_ns", "(", "struct", "mnt_namespace", "*", "mnt_ns", ",", "/", "*", "First", "pass", ":", "copy", "the", "tree", "topology", "*", "/", "copy_flags", "=", "CL_COPY_ALL", "|", "CL_EXPIRE", ";", "if", "(", "user_ns", "!", "=", "mnt_ns", "-", ">", "user_ns", ")", "copy_flags", "|", "=", "CL_SHARED_TO_SLAVE", ";", "copy_flags", "|", "=", "CL_SHARED_TO_SLAVE", "|", "CL_UNPRIVILEGED", ";", "new", "=", "copy_tree", "(", "old", ",", "old", "-", ">", "mnt", ".", "mnt_root", ",", "copy_flags", ")", ";", "if", "(", "IS_ERR", "(", "new", ")", ")", "{", "up_write", "(", "&", "namespace_sem", ")", ";", "@", "@", "-", "9", ",", "6", "+", "9", ",", "7", "@", "@", "#", "include", "<", "linux", "/", "mnt_namespace", ".", "h", ">", "#", "include", "<", "linux", "/", "mount", ".", "h", ">", "#", "include", "<", "linux", "/", "fs", ".", "h", ">", "#", "include", "<", "linux", "/", "nsproxy", ".", "h", ">", "#", "include", "\"", "internal", ".", "h", "\"", "#", "include", "\"", "pnode", ".", "h", "\"", "@", "@", "-", "220", ",", "6", "+", "221", ",", "7", "@", "@", "static", "struct", "mount", "*", "get_source", "(", "struct", "mount", "*", "dest", ",", "int", "propagate_mnt", "(", "struct", "mount", "*", "dest_mnt", ",", "struct", "dentry", "*", "dest_dentry", ",", "struct", "mount", "*", "source_mnt", ",", "struct", "list_head", "*", "tree_list", ")", "{", "struct", "user_namespace", "*", "user_ns", "=", "current", "-", ">", "nsproxy", "-", ">", "mnt_ns", "-", ">", "user_ns", ";", "struct", "mount", "*", "m", ",", "*", "child", ";", "int", "ret", "=", "0", ";", "struct", "mount", "*", "prev_dest_mnt", "=", "dest_mnt", ";", "@", "@", "-", "237", ",", "6", "+", "239", ",", "10", "@", "@", "int", "propagate_mnt", "(", "struct", "mount", "*", "dest_mnt", ",", "struct", "dentry", "*", "dest_dentry", ",", "source", "=", "get_source", "(", "m", ",", "prev_dest_mnt", ",", "prev_src_mnt", ",", "&", "type", ")", ";", "/", "*", "Notice", "when", "we", "are", "propagating", "across", "user", "namespaces", "*", "/", "if", "(", "m", "-", ">", "mnt_ns", "-", ">", "user_ns", "!", "=", "user_ns", ")", "type", "|", "=", "CL_UNPRIVILEGED", ";", "child", "=", "copy_tree", "(", "source", ",", "source", "-", ">", "mnt", ".", "mnt_root", ",", "type", ")", ";", "if", "(", "IS_ERR", "(", "child", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "child", ")", ";", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "#", "define", "CL_MAKE_SHARED", "0x08", "#", "define", "CL_PRIVATE", "0x10", "#", "define", "CL_SHARED_TO_SLAVE", "0x20", "#", "define", "CL_UNPRIVILEGED", "0x40", "static", "inline", "void", "set_mnt_shared", "(", "struct", "mount", "*", "mnt", ")", "{"], "docstring_tokens": ["by", "leveraging", "a", "separate", "mount", "namespace", "."]}
{"contents": ["Fixed", "bug", "#69152"], "code_tokens": ["@", "@", "-", "924", ",", "6", "+", "924", ",", "12", "@", "@", "PHP_METHOD", "(", "SoapFault", ",", "__toString", ")", "zend_call_function", "(", "&", "fci", ",", "NULL", "TSRMLS_CC", ")", ";", "convert_to_string", "(", "faultcode", ")", ";", "convert_to_string", "(", "faultstring", ")", ";", "convert_to_string", "(", "file", ")", ";", "convert_to_long", "(", "line", ")", ";", "convert_to_string", "(", "trace", ")", ";", "len", "=", "spprintf", "(", "&", "str", ",", "0", ",", "\"", "SoapFault", "exception", ":", "[", "%", "s", "]", "%", "s", "in", "%", "s", ":", "%", "ld", "\\", "nStack", "trace", ":", "\\", "n", "%", "s", "\"", ",", "Z_STRVAL_P", "(", "faultcode", ")", ",", "Z_STRVAL_P", "(", "faultstring", ")", ",", "Z_STRVAL_P", "(", "file", ")", ",", "Z_LVAL_P", "(", "line", ")", ",", "Z_STRLEN_P", "(", "trace", ")", "?", "Z_STRVAL_P", "(", "trace", ")", ":", "\"", "#", "0", "{", "main", "}", "\\", "n", "\"", ");"], "docstring_tokens": ["sending", "specially", "crafted", "data", "processed"]}
{"contents": ["apply", "changes", "for", "2.14.15", "release"], "code_tokens": ["@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "assemblies", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "assemblies", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "bundle", "-", "template", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "assemblies", "<", "/", "groupId", ">", "@", "@", "-", "41", ",", "15", "+", "41", ",", "15", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "@", "@", "-", "35", ",", "159", "+", "35", ",", "159", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "commons", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "db", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "gwt", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "httpclient", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "insight", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "maven", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "messaging", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "shiro", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "bouncycastle", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "jetty", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "goodies", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "groovy", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "guice", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "logging", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "osgi", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "other", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "plexus", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "rest", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "testing", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "metrics", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "bouncycastle", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "commons", "<", "/", "artifactId", ">", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "commons", "<", "/", "groupId", ">", "<", "artifactId", ">", "commons", "-", "compress", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "18", "<", "/", "version", ">", "<", "version", ">", "1", ".", "19", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "db", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "goodies", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "groovy", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "guice", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "gwt", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "httpclient", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "15", "+", "20", ",", "15", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "insight", "<", "/", "artifactId", ">", "<", "name", ">", "${", "project", ".", "groupId", "}", ":$", "{", "project", ".", "artifactId", "}", "</", "name", ">", "<", "packaging", ">", "pom", "<", "/", "packaging", ">", "<", "properties", ">", "<", "sonatype", "-", "licensing", ".", "version", ">", "1", ".", "4", "<", "/", "sonatype", "-", "licensing", ".", "version", ">", "<", "sonatype", "-", "licensing", ".", "version", ">", "1", ".", "5", ".", "0", "<", "/", "sonatype", "-", "licensing", ".", "version", ">", "<", "insight", "-", "brain", ".", "version", ">", "1", ".", "33", ".", "0", "-", "04", "<", "/", "insight", "-", "brain", ".", "version", ">", "<", "insight", "-", "scanner", ".", "version", ">", "2", ".", "4", ".", "5", "-", "01", "<", "/", "insight", "-", "scanner", ".", "version", ">", "<", "/", "properties", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "jetty", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "logging", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "maven", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "messaging", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "metrics", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "osgi", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "other", "<", "/", "artifactId", ">", "@", "@", "-", "92", ",", "7", "+", "92", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "tika", "<", "/", "groupId", ">", "<", "artifactId", ">", "tika", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "20", "<", "/", "version", ">", "<", "version", ">", "1", ".", "22", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "plexus", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "rest", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "scripts", "<", "/", "artifactId", ">", "@", "@", "-", "36", ",", "7", "+", "36", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "shiro", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "testing", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "base", "-", "configuration", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "bootstrap", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "client", "-", "core", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "core", "<", "/", "artifactId", ">", "@", "@", "-", "313", ",", "6", "+", "313", ",", "16", "@", "@", "public", "StorageFileItem", "retrieveArtifact", "(", "ArtifactStoreRequest", "gavRequest", ")", "}", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "storeArtifactPom", "(", "gavRequest", ",", "is", ",", "attributes", ",", "true", ")", ";", "}", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ",", "boolean", "withChecksums", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "@", "@", "-", "324", ",", "7", "+", "334", ",", "12", "@", "@", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Ma", "gavRequest", ".", "setRequestPath", "(", "repository", ".", "getGavCalculator", "(", ").", "gavToPath", "(", "gav", ")", ");", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "try", "{", "repository", ".", "getMetadataManager", "(", ").", "deployArtifact", "(", "gavRequest", ")", ";", "@", "@", "-", "335", ",", "6", "+", "350", ",", "13", "@", "@", "public", "void", "storeArtifactPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Ma", "}", "public", "void", "storeArtifact", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "storeArtifact", "(", "gavRequest", ",", "is", ",", "attributes", ",", "true", ")", ";", "}", "public", "void", "storeArtifact", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ",", "boolean", "withChecksums", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "@", "@", "-", "346", ",", "11", "+", "368", ",", "24", "@", "@", "public", "void", "storeArtifact", "(", "ArtifactStoreRequest", "gavRequest", ",", "InputStream", "is", ",", "Map", "<", "S", "gavRequest", ".", "setRequestPath", "(", "repository", ".", "getGavCalculator", "(", ").", "gavToPath", "(", "gav", ")", ");", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "}", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "String", "packaging", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "storeArtifactWithGeneratedPom", "(", "gavRequest", ",", "packaging", ",", "is", ",", "attributes", ",", "true", ")", ";", "}", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "String", "packaging", ",", "InputStream", "is", ",", "Map", "<", "String", ",", "String", ">", "attributes", ",", "boolean", "withChecksums", ")", "throws", "UnsupportedStorageOperationException", ",", "IllegalOperationException", ",", "ItemNotFoundException", ",", "StorageException", ",", "AccessDeniedException", "{", "@", "@", "-", "394", ",", "8", "+", "429", ",", "12", "@", "@", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "Strin", "/", "/", "writing", "to", "string", ",", "not", "to", "happen", "}", "repository", ".", "storeItemWithChecksums", "(", "pomRequest", ",", "new", "ByteArrayInputStream", "(", "sw", ".", "toString", "(", ").", "getBytes", "(", "))", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "pomRequest", ",", "new", "ByteArrayInputStream", "(", "sw", ".", "toString", "(", ").", "getBytes", "(", "))", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "pomRequest", ",", "new", "ByteArrayInputStream", "(", "sw", ".", "toString", "(", ").", "getBytes", "(", "))", ",", "attributes", ")", ";", "}", "try", "{", "repository", ".", "getMetadataManager", "(", ").", "deployArtifact", "(", "pomRequest", ")", ";", "@", "@", "-", "408", ",", "7", "+", "447", ",", "13", "@", "@", "public", "void", "storeArtifactWithGeneratedPom", "(", "ArtifactStoreRequest", "gavRequest", ",", "Strin", "/", "/", "reset", "path", "if", "anything", "changed", "it", "gavRequest", ".", "setRequestPath", "(", "repository", ".", "getGavCalculator", "(", ").", "gavToPath", "(", "gavRequest", ".", "getGav", "(", "))", ");", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "if", "(", "withChecksums", ")", "{", "repository", ".", "storeItemWithChecksums", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "else", "{", "repository", ".", "storeItem", "(", "gavRequest", ",", "is", ",", "attributes", ")", ";", "}", "}", "/", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "@", "@", "-", "0", ",", "0", "+", "1", ",", "79", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "javax", ".", "inject", ".", "Singleton", ";", "import", "static", "java", ".", "util", ".", "Arrays", ".", "stream", ";", "import", "static", "java", ".", "util", ".", "stream", ".", "Collectors", ".", "toSet", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isBlank", ";", "/", "**", "*", "Simple", "Path", "-", "based", "whitelist", "to", "validate", "allowed", "storage", "locations", "for", "repositories", ".", "Locations", "are", "whitelisted", "*", "by", "adding", "them", "as", "comma", "-", "separated", "values", "to", "the", "{", "@", "code", "nexus", ".", "override", ".", "local", ".", "storage", ".", "whitelist", "}", "property", "in", "*", "{", "@", "code", "nexus", ".", "properties", "}", ".", "*", "*", "A", "whitelisted", "path", "has", "its", "subdirectories", "included", ".", "For", "example", ",", "whitelisting", "the", "directory", "{", "@", "code", "/", "foo", "/", "bar", "}", "would", "*", "allow", "repositories", "to", "set", "their", "storage", "to", "{", "@", "code", "/", "foo", "/", "bar", "/", "baz", "}", ".", "*", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "@", "Named", "@", "Singleton", "public", "class", "StorageWhitelist", "{", "public", "static", "final", "String", "PROP_NAME", "=", "\"", "nexus", ".", "override", ".", "local", ".", "storage", ".", "whitelist", "\"", ";", "private", "static", "final", "String", "INJECTED_PROP", "=", "\"", "${", "\"", "+", "PROP_NAME", "+", "\"", ":-", "}\"", ";", "private", "final", "Set", "<", "Path", ">", "whitelistPaths", ";", "@", "Inject", "public", "StorageWhitelist", "(", "@", "Named", "(", "INJECTED_PROP", ")", "final", "String", "whitelistPaths", ")", "{", "this", ".", "whitelistPaths", "=", "isBlank", "(", "whitelistPaths", ")", "?", "new", "HashSet", "<", ">(", ")", ":", "stream", "(", "whitelistPaths", ".", "split", "(", "\",", "\")", ").", "map", "(", "this", ":", ":", "parse", ")", ".", "map", "(", "Path", ":", ":", "normalize", ")", ".", "collect", "(", "toSet", "(", "))", ";", "}", "void", "addWhitelistPath", "(", "final", "String", "whitelistPath", ")", "{", "this", ".", "whitelistPaths", ".", "add", "(", "parse", "(", "whitelistPath", ")", ".", "normalize", "(", "))", ";", "}", "public", "boolean", "isApproved", "(", "final", "String", "path", ")", "{", "Path", "targetPath", "=", "parse", "(", "path", ")", ".", "normalize", "(", ");", "return", "whitelistPaths", ".", "stream", "(", ").", "anyMatch", "(", "targetPath", ":", ":", "startsWith", ")", ";", "}", "/", "**", "*", "Attempts", "to", "generate", "a", "{", "@", "link", "Path", "}", "from", "a", "string", "first", "assuming", "the", "string", "is", "formatted", "as", "a", "{", "@", "link", "URI", "}", "and", "*", "subsequently", "as", "a", "direct", "path", "if", "not", "*", "*", "@", "param", "pathString", "A", "path", "string", "*", "@", "return", "the", "{", "@", "link", "Path", "}", "resulting", "from", "{", "@", "code", "pathString", "}", "*", "/", "private", "Path", "parse", "(", "final", "String", "pathString", ")", "{", "try", "{", "return", "Paths", ".", "get", "(", "URI", ".", "create", "(", "pathString", ")", ");", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "return", "Paths", ".", "get", "(", "pathString", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "144", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "StringJoiner", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "javax", ".", "inject", ".", "Singleton", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "ApplicationStatusSource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "SystemStatus", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "events", ".", "EventSubscriber", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "events", ".", "NexusStartedEvent", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "registry", ".", "RepositoryRegistry", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "AbstractRepository", ";", "import", "org", ".", "sonatype", ".", "sisu", ".", "goodies", ".", "common", ".", "ComponentSupport", ";", "import", "com", ".", "google", ".", "common", ".", "eventbus", ".", "Subscribe", ";", "import", "static", "java", ".", "lang", ".", "System", ".", "lineSeparator", ";", "import", "static", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ".", "UTF_8", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "createFile", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "newInputStream", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "notExists", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "write", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "APPEND", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "CREATE", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "READ", ";", "import", "static", "java", ".", "util", ".", "Objects", ".", "requireNonNull", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isNotBlank", ";", "import", "static", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ".", "PROP_NAME", ";", "/", "**", "*", "On", "upgrade", "this", "will", "populate", "the", "{", "@", "code", "nexus", ".", "override", ".", "local", ".", "storage", ".", "whitelist", "}", "property", "in", "{", "@", "code", "nexus", ".", "properties", "}", "*", "if", "it", "is", "not", "found", ".", "Its", "value", "will", "be", "created", "from", "all", "existing", "repositories", "which", "have", "a", "value", "set", "for", "*", "{", "@", "code", "overrideLocalStorageUrl", "}", "*", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "@", "Singleton", "@", "Named", "(", "\"", "StorageWhitelistUpgradeEvent", "\"", ")", "public", "class", "StorageWhitelistUpgradeEvent", "extends", "ComponentSupport", "implements", "EventSubscriber", "{", "private", "final", "ApplicationStatusSource", "applicationStatusSource", ";", "private", "final", "ApplicationDirectories", "applicationDirectories", ";", "private", "final", "RepositoryRegistry", "repositoryRegistry", ";", "private", "final", "StorageWhitelist", "storageWhitelist", ";", "@", "Inject", "public", "StorageWhitelistUpgradeEvent", "(", "final", "ApplicationStatusSource", "applicationStatusSource", ",", "final", "ApplicationDirectories", "applicationDirectories", ",", "final", "RepositoryRegistry", "repositoryRegistry", ",", "final", "StorageWhitelist", "storageWhitelist", ")", "{", "this", ".", "applicationStatusSource", "=", "requireNonNull", "(", "applicationStatusSource", ")", ";", "this", ".", "applicationDirectories", "=", "requireNonNull", "(", "applicationDirectories", ")", ";", "this", ".", "repositoryRegistry", "=", "requireNonNull", "(", "repositoryRegistry", ")", ";", "this", ".", "storageWhitelist", "=", "requireNonNull", "(", "storageWhitelist", ")", ";", "}", "@", "Subscribe", "public", "void", "inspect", "(", "final", "NexusStartedEvent", "startedEvent", ")", "{", "final", "SystemStatus", "systemStatus", "=", "applicationStatusSource", ".", "getSystemStatus", "(", ");", "if", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", "{", "try", "{", "if", "(", "notExists", "(", "nexusPropertiesPath", "(", "))", ")", "{", "createFile", "(", "nexusPropertiesPath", "(", "))", ";", "}", "try", "(", "InputStream", "nexusPropsIn", "=", "newInputStream", "(", "nexusPropertiesPath", "(", "),", "READ", ")", ")", "{", "Properties", "nexusProps", "=", "new", "Properties", "(", ");", "nexusProps", ".", "load", "(", "nexusPropsIn", ")", ";", "if", "(", "!", "nexusProps", ".", "containsKey", "(", "PROP_NAME", ")", ")", "{", "log", ".", "info", "(", "\"", "System", "upgrade", "detected", ":", "creating", "repo", "storage", "whitelist", "property", ":", "'", "{}", "'\"", ",", "PROP_NAME", ")", ";", "StringJoiner", "whitelistValue", "=", "new", "StringJoiner", "(", "\",", "\")", ";", "repositoryRegistry", ".", "getRepositories", "(", ").", "forEach", "(", "repo", "-", ">", "{", "String", "overrideLocalStorageUrl", "=", "(", "(", "AbstractRepository", ")", "repo", ")", ".", "getCurrentCoreConfiguration", "(", ").", "getConfiguration", "(", "false", ")", ".", "getLocalStorage", "(", ").", "getUrl", "(", ");", "if", "(", "isNotBlank", "(", "overrideLocalStorageUrl", ")", ")", "{", "log", ".", "info", "(", "\"", "Adding", "existing", "configured", "location", "'", "{}", "'", "to", "whitelisted", "storage", "locations", "\"", ",", "overrideLocalStorageUrl", ")", ";", "whitelistValue", ".", "add", "(", "overrideLocalStorageUrl", ")", ";", "storageWhitelist", ".", "addWhitelistPath", "(", "overrideLocalStorageUrl", ")", ";", "}", "}", ");", "write", "(", "nexusPropertiesPath", "(", "),", "createSection", "(", "whitelistValue", ".", "toString", "(", "))", ".", "getBytes", "(", "UTF_8", ")", ",", "CREATE", ",", "APPEND", ")", ";", "log", ".", "info", "(", "\"", "nexus", ".", "properties", "updated", "with", "'", "{}", "'", "property", "\"", ",", "PROP_NAME", ")", ";", "}", "}", "}", "catch", "(", "IOException", "e", ")", "{", "log", ".", "error", "(", "\"", "Unable", "to", "upgrade", "nexus", ".", "properties", "with", "whitelisted", "storage", "\"", ",", "e", ")", ";", "}", "}", "}", "private", "Path", "nexusPropertiesPath", "(", ")", "{", "return", "Paths", ".", "get", "(", "applicationDirectories", ".", "getInstallDirectory", "(", ").", "getAbsolutePath", "(", "),", "\"", "/", "conf", "/", "nexus", ".", "properties", "\"", ");", "}", "private", "String", "createSection", "(", "final", "String", "propValues", ")", "{", "StringBuilder", "propBuilder", "=", "new", "StringBuilder", "(", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "Storage", "whitelist", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "Generated", "using", "existing", "configured", "values", "from", "all", "repositories", "if", "not", "found", "on", "upgrade", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "Comma", "-", "separated", "list", "of", "allowed", "override", "storage", "locations", "for", "repositories", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "\"#", "See", "https", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nxrm2", "/", "configuring", "-", "repositories", "\"", ");", "propBuilder", ".", "append", "(", "lineSeparator", "(", "))", ";", "propBuilder", ".", "append", "(", "PROP_NAME", ")", ".", "append", "(", "\"=", "\")", ".", "append", "(", "propValues", ")", ";", "return", "propBuilder", ".", "toString", "(", ");", "}", "}", "@", "@", "-", "13", ",", "15", "+", "13", ",", "18", "@", "@", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "ItemNotFoundException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "ResourceStoreRequest", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "gav", ".", "Gav", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "gav", ".", "GavCalculator", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "gav", ".", "M2GavCalculator", ";", "import", "org", ".", "sonatype", ".", "sisu", ".", "litmus", ".", "testsupport", ".", "TestSupport", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Charsets", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mockito", ".", "ArgumentCaptor", ";", "@", "@", "-", "31", ",", "6", "+", "34", ",", "8", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "nullValue", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "never", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "@", "-", "40", ",", "6", "+", "45", ",", "26", "@", "@", "public", "class", "ArtifactStoreHelperTest", "extends", "TestSupport", "{", "private", "MavenRepository", "mavenRepository", ";", "private", "MetadataManager", "metadataManager", ";", "private", "GavCalculator", "gavCalculator", "=", "new", "M2GavCalculator", "(", ");", "private", "ArtifactStoreHelper", "underTest", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "mavenRepository", "=", "mock", "(", "MavenRepository", ".", "class", ")", ";", "metadataManager", "=", "mock", "(", "MetadataManager", ".", "class", ")", ";", "when", "(", "mavenRepository", ".", "getGavCalculator", "(", "))", ".", "thenReturn", "(", "gavCalculator", ")", ";", "when", "(", "mavenRepository", ".", "getMetadataManager", "(", "))", ".", "thenReturn", "(", "metadataManager", ")", ";", "when", "(", "mavenRepository", ".", "getName", "(", "))", ".", "thenReturn", "(", "\"", "repo", "\"", ");", "when", "(", "mavenRepository", ".", "getId", "(", "))", ".", "thenReturn", "(", "\"", "repo", "\"", ");", "when", "(", "mavenRepository", ".", "retrieveItem", "(", "any", "(", "Boolean", ".", "class", ")", ",", "any", "(", "ResourceStoreRequest", ".", "class", ")", "))", ".", "thenThrow", "(", "ItemNotFoundException", ".", "class", ")", ";", "underTest", "=", "new", "ArtifactStoreHelper", "(", "mavenRepository", ")", ";", "}", "/", "**", "*", "Test", "that", "verifies", "that", "classifier", "is", "not", "present", "in", "the", "artifact", "store", "request", "used", "to", "maintain", "metadata", ",", "even", "if", "*", "classified", "artifact", "is", "being", "deployed", "with", "POM", ".", "@", "@", "-", "48", ",", "20", "+", "73", ",", "11", "@", "@", "*", "/", "@", "Test", "public", "void", "classifierNotPassedOnGeneratedPomAndClassifiedArtifactDeploy", "(", ")", "throws", "Exception", "{", "final", "M2GavCalculator", "gavCalculator", "=", "new", "M2GavCalculator", "(", ");", "final", "MetadataManager", "metadataManager", "=", "mock", "(", "MetadataManager", ".", "class", ")", ";", "final", "MavenRepository", "mavenRepository", "=", "mock", "(", "MavenRepository", ".", "class", ")", ";", "when", "(", "mavenRepository", ".", "getGavCalculator", "(", "))", ".", "thenReturn", "(", "gavCalculator", ")", ";", "when", "(", "mavenRepository", ".", "getMetadataManager", "(", "))", ".", "thenReturn", "(", "metadataManager", ")", ";", "when", "(", "mavenRepository", ".", "retrieveItem", "(", "any", "(", "Boolean", ".", "class", ")", ",", "any", "(", "ResourceStoreRequest", ".", "class", ")", "))", ".", "thenThrow", "(", "ItemNotFoundException", ".", "class", ")", ";", "final", "ArtifactStoreHelper", "artifactStoreHelper", "=", "new", "ArtifactStoreHelper", "(", "mavenRepository", ")", ";", "final", "Gav", "gav", "=", "gavCalculator", ".", "pathToGav", "(", "\"/", "org", "/", "test", "/", "artifact", "/", "1", ".", "0", "/", "artifact", "-", "1", ".", "0", "-", "classifier", ".", "jar", "\"", ");", "assertThat", "(", "gav", ".", "getClassifier", "(", "),", "equalTo", "(", "\"", "classifier", "\"", "))", ";", "final", "ArtifactStoreRequest", "request", "=", "new", "ArtifactStoreRequest", "(", "mavenRepository", ",", "gav", ",", "false", ")", ";", "artifactStoreHelper", ".", "storeArtifactWithGeneratedPom", "(", "underTest", ".", "storeArtifactWithGeneratedPom", "(", "request", ",", "\"", "pom", "\"", ",", "new", "ByteArrayInputStream", "(", "\"", "Content", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", "),", "null", ")", ";", "final", "ArgumentCaptor", "<", "ArtifactStoreRequest", ">", "requestArgumentCaptor", "=", "ArgumentCaptor", "@", "@", "-", "72", ",", "4", "+", "88", ",", "62", "@", "@", "public", "void", "classifierNotPassedOnGeneratedPomAndClassifiedArtifactDeploy", "(", ")", "throw", "assertThat", "(", "requestsPassed", ",", "hasSize", "(", "1", ")", ");", "assertThat", "(", "requestsPassed", ".", "get", "(", "0", ")", ".", "getGav", "(", ").", "getClassifier", "(", "),", "nullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifact_withChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifact", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "buildInputStream", "(", "),", "null", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifact_withNoChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifact", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "buildInputStream", "(", "),", "null", ",", "false", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactPom_withChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactPom", "(", "buildRequest", "(", "\"", "pom", "\"", "),", "buildInputStream", "(", "),", "null", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactPom_withNoChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactPom", "(", "buildRequest", "(", "\"", "pom", "\"", "),", "buildInputStream", "(", "),", "null", ",", "false", ")", ";", "verify", "(", "mavenRepository", ")", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactWithGeneratedPom_withChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactWithGeneratedPom", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "\"", "jar", "\"", ",", "buildInputStream", "(", "),", "null", ")", ";", "verify", "(", "mavenRepository", ",", "times", "(", "2", ")", ").", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "@", "Test", "public", "void", "testStoreArtifactWithGeneratedPom_withNoChecksums", "(", ")", "throws", "Exception", "{", "underTest", ".", "storeArtifactWithGeneratedPom", "(", "buildRequest", "(", "\"", "jar", "\"", "),", "\"", "jar", "\"", ",", "buildInputStream", "(", "),", "null", ",", "false", ")", ";", "verify", "(", "mavenRepository", ",", "times", "(", "2", ")", ").", "storeItem", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "verify", "(", "mavenRepository", ",", "never", "(", "))", ".", "storeItemWithChecksums", "(", "any", "(", "),", "any", "(", "),", "any", "(", "))", ";", "}", "private", "ArtifactStoreRequest", "buildRequest", "(", "String", "extension", ")", "{", "final", "Gav", "gav", "=", "gavCalculator", ".", "pathToGav", "(", "\"/", "org", "/", "test", "/", "artifact", "/", "1", ".", "0", "/", "artifact", "-", "1", ".", "0", ".", "\"", "+", "extension", ")", ";", "return", "new", "ArtifactStoreRequest", "(", "mavenRepository", ",", "gav", ",", "false", ")", ";", "}", "private", "InputStream", "buildInputStream", "(", ")", "{", "return", "new", "ByteArrayInputStream", "(", "\"", "Content", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "79", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "/", "**", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "public", "class", "StorageWhitelistTest", "{", "private", "static", "final", "String", "ALLOWED_PATH", "=", "\"", "/", "dir1", "/", "dir2", "/", "dir3", "\"", ";", "private", "StorageWhitelist", "underTest", ";", "@", "Before", "public", "void", "setup", "(", ")", "{", "underTest", "=", "new", "StorageWhitelist", "(", "ALLOWED_PATH", ")", ";", "}", "@", "Test", "public", "void", "testIsApproved", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", ")", ",", "is", "(", "true", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "foo", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "\")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testAddWhitelistPath", "(", ")", "{", "String", "path", "=", "\"", "/", "foo", "/", "bar", "/", "baz", "\"", ";", "assertThat", "(", "underTest", ".", "isApproved", "(", "path", ")", ",", "is", "(", "false", ")", ");", "underTest", ".", "addWhitelistPath", "(", "path", ")", ";", "assertThat", "(", "underTest", ".", "isApproved", "(", "path", ")", ",", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "trailingSlashIgnored", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", "+", "\"/", "\")", ",", "is", "(", "true", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "foldera", "/", "folderb", "/", "folderd", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "foldera", "/", "folderb", "/", "folderd", "/", "\")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "subdirectoriesAreAllowed", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", "+", "\"", "/", "subfolder", "\"", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "intermediarySubdirectoriesNotAllowed", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "dir1", "/", "subdir", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "dir1", "/", "dir2", "/", "subdir", "\"", "),", "is", "(", "false", ")", ");", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"/", "dir1", "/", "dir10", "/", "subdir", "\"", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "reverseTraversalNotAllowed", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "ALLOWED_PATH", "+", "\"", "/.", "./", "..", "/.", "./", "usr", "/", "local", "\"", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testWindowsPathParsing", "(", ")", "{", "assertThat", "(", "underTest", ".", "isApproved", "(", "\"", "file", ":", "/", "C", ":", "/", "temp", "\"", "),", "is", "(", "false", ")", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "225", "@", "@", "/", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Open", "Source", "Version", "*", "Copyright", "(", "c", ")", "2008", "-", "present", "Sonatype", ",", "Inc", ".", "*", "All", "rights", "reserved", ".", "Includes", "the", "third", "-", "party", "code", "listed", "at", "http", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nexus", "/", "oss", "/", "attributions", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "Version", "1", ".", "0", ",", "*", "which", "accompanies", "this", "distribution", "and", "is", "available", "at", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", ".", "*", "*", "Sonatype", "Nexus", "(", "TM", ")", "Professional", "Version", "is", "available", "from", "Sonatype", ",", "Inc", ".", "\"", "Sonatype", "\"", "and", "\"", "Sonatype", "Nexus", "\"", "are", "trademarks", "*", "of", "Sonatype", ",", "Inc", ".", "Apache", "Maven", "is", "a", "trademark", "of", "the", "Apache", "Software", "Foundation", ".", "M2eclipse", "is", "a", "trademark", "of", "the", "*", "Eclipse", "Foundation", ".", "All", "other", "trademarks", "are", "the", "property", "of", "their", "respective", "owners", ".", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "ApplicationStatusSource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "SystemStatus", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CLocalStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepositoryCoreConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "events", ".", "NexusStartedEvent", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "registry", ".", "RepositoryRegistry", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "AbstractRepository", ";", "import", "org", ".", "sonatype", ".", "sisu", ".", "litmus", ".", "testsupport", ".", "TestSupport", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TestName", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "createDirectory", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "createTempDirectory", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "exists", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "newInputStream", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "newOutputStream", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "Files", ".", "readAllLines", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "CREATE_NEW", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ".", "READ", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ".", "deleteDirectory", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "EMPTY", ";", "import", "static", "org", ".", "fest", ".", "util", ".", "Lists", ".", "newArrayList", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyBoolean", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyZeroInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "static", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ".", "PROP_NAME", ";", "/", "**", "*", "@", "since", "2", ".", "14", ".", "15", "*", "/", "public", "class", "StorageWhitelistUpgradeEventTest", "extends", "TestSupport", "{", "@", "Rule", "public", "final", "TestName", "testName", "=", "new", "TestName", "(", ");", "@", "Mock", "private", "ApplicationStatusSource", "applicationStatusSource", ";", "@", "Mock", "private", "SystemStatus", "systemStatus", ";", "@", "Mock", "private", "ApplicationDirectories", "applicationDirectories", ";", "@", "Mock", "private", "File", "installDir", ";", "@", "Mock", "private", "RepositoryRegistry", "repositoryRegistry", ";", "@", "Mock", "private", "AbstractRepository", "repository", ";", "@", "Mock", "private", "CRepositoryCoreConfiguration", "coreConfig", ";", "@", "Mock", "private", "CRepository", "repositoryConfig", ";", "@", "Mock", "private", "CLocalStorage", "localStorage", ";", "@", "Mock", "private", "StorageWhitelist", "storageWhitelist", ";", "@", "Mock", "private", "NexusStartedEvent", "nexusStartedEvent", ";", "private", "Path", "testTempDir", ";", "private", "Path", "nexusPropPath", ";", "private", "StorageWhitelistUpgradeEvent", "underTest", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "underTest", "=", "new", "StorageWhitelistUpgradeEvent", "(", "applicationStatusSource", ",", "applicationDirectories", ",", "repositoryRegistry", ",", "storageWhitelist", ")", ";", "when", "(", "applicationStatusSource", ".", "getSystemStatus", "(", "))", ".", "thenReturn", "(", "systemStatus", ")", ";", "when", "(", "applicationDirectories", ".", "getInstallDirectory", "(", "))", ".", "thenReturn", "(", "installDir", ")", ";", "when", "(", "repositoryRegistry", ".", "getRepositories", "(", "))", ".", "thenReturn", "(", "newArrayList", "(", "repository", ")", ");", "when", "(", "repository", ".", "getCurrentCoreConfiguration", "(", "))", ".", "thenReturn", "(", "coreConfig", ")", ";", "when", "(", "coreConfig", ".", "getConfiguration", "(", "anyBoolean", "(", "))", ").", "thenReturn", "(", "repositoryConfig", ")", ";", "when", "(", "repositoryConfig", ".", "getLocalStorage", "(", "))", ".", "thenReturn", "(", "localStorage", ")", ";", "testTempDir", "=", "createTempDirectory", "(", "testName", ".", "getMethodName", "(", "))", ";", "createDirectory", "(", "testTempDir", ".", "resolve", "(", "\"", "conf", "\"", "))", ";", "nexusPropPath", "=", "testTempDir", ".", "resolve", "(", "\"", "conf", "/", "nexus", ".", "properties", "\"", ");", "when", "(", "installDir", ".", "getAbsolutePath", "(", "))", ".", "thenReturn", "(", "testTempDir", ".", "toAbsolutePath", "(", ").", "toString", "(", "))", ";", "}", "@", "After", "public", "void", "cleanup", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "testTempDir", ".", "toFile", "(", "))", ";", "}", "@", "Test", "public", "void", "doesNothingOnNonUpgradeStartup", "(", ")", "{", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "false", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "verifyZeroInteractions", "(", "storageWhitelist", ",", "applicationDirectories", ",", "repositoryRegistry", ")", ";", "}", "@", "Test", "public", "void", "createsWhitelistIfNotPresentOnUpgrade", "(", ")", "throws", "Exception", "{", "String", "storageUrl", "=", "\"", "/", "foo", "/", "bar", "\"", ";", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "storageUrl", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "1", ",", "storageUrl", ")", ";", "}", "@", "Test", "public", "void", "addsMultipleLocations", "(", ")", "throws", "Exception", "{", "when", "(", "repositoryRegistry", ".", "getRepositories", "(", "))", ".", "thenReturn", "(", "newArrayList", "(", "repository", ",", "repository", ",", "repository", ")", ");", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "\"/", "foo", "\"", ",", "\"", "/", "bar", "\"", ",", "\"", "/", "baz", "\"", ");", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "3", ",", "\"", "/", "foo", ",", "/", "bar", ",", "/", "baz", "\"", ");", "}", "@", "Test", "public", "void", "doesNotOverridePropertyIfExists", "(", ")", "throws", "Exception", "{", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "setProperty", "(", "PROP_NAME", ",", "\"", "/", "foo", "\"", ");", "try", "(", "OutputStream", "os", "=", "newOutputStream", "(", "nexusPropPath", ",", "CREATE_NEW", ")", ")", "{", "props", ".", "store", "(", "os", ",", "EMPTY", ")", ";", "}", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "\"/", "bar", "\"", ");", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "verifyZeroInteractions", "(", "storageWhitelist", ",", "repositoryRegistry", ")", ";", "validateProps", "(", "0", ",", "\"", "/", "foo", "\"", ");", "}", "@", "Test", "public", "void", "doesNotIncludeBlankLocations", "(", ")", "throws", "Exception", "{", "when", "(", "repositoryRegistry", ".", "getRepositories", "(", "))", ".", "thenReturn", "(", "newArrayList", "(", "repository", ",", "repository", ",", "repository", ")", ");", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "EMPTY", ",", "null", ",", "\"", "\"", ");", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "0", ",", "EMPTY", ")", ";", "}", "@", "Test", "public", "void", "preservesExistingPropertyFileFormat", "(", ")", "throws", "Exception", "{", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "setProperty", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", ");", "try", "(", "OutputStream", "os", "=", "newOutputStream", "(", "nexusPropPath", ",", "CREATE_NEW", ")", ")", "{", "props", ".", "store", "(", "os", ",", "\"", "pre", "-", "existing", "-", "comment", "\"", ");", "}", "when", "(", "systemStatus", ".", "isInstanceUpgraded", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "localStorage", ".", "getUrl", "(", "))", ".", "thenReturn", "(", "\"/", "baz", "\"", ");", "underTest", ".", "inspect", "(", "nexusStartedEvent", ")", ";", "validateProps", "(", "1", ",", "\"", "/", "baz", "\"", ");", "props", ".", "load", "(", "newInputStream", "(", "nexusPropPath", ",", "READ", ")", ");", "assertThat", "(", "\"", "Existing", "properties", "should", "still", "be", "present", "\"", ",", "props", ".", "get", "(", "\"", "foo", "\"", "),", "is", "(", "\"", "bar", "\"", "))", ";", "assertThat", "(", "\"", "Existing", "comments", "should", "still", "be", "present", "\"", ",", "readAllLines", "(", "nexusPropPath", ")", ",", "hasItem", "(", "\"#", "pre", "-", "existing", "-", "comment", "\"", "))", ";", "}", "private", "void", "validateProps", "(", "final", "int", "numWhitelistAdd", ",", "final", "String", "expectedValue", ")", "throws", "Exception", "{", "verify", "(", "storageWhitelist", ",", "times", "(", "numWhitelistAdd", ")", ").", "addWhitelistPath", "(", "anyString", "(", "))", ";", "assertThat", "(", "\"", "nexus", ".", "properties", "file", "should", "have", "been", "created", "\"", ",", "exists", "(", "nexusPropPath", ")", ",", "is", "(", "true", ")", ");", "Properties", "props", "=", "new", "Properties", "(", ");", "try", "(", "InputStream", "is", "=", "newInputStream", "(", "nexusPropPath", ",", "READ", ")", ")", "{", "props", ".", "load", "(", "is", ")", ";", "}", "assertThat", "(", "\"", "Whitelist", "property", "should", "have", "been", "written", "to", "nexus", ".", "properties", "\"", ",", "props", ".", "containsKey", "(", "PROP_NAME", ")", ");", "assertThat", "(", "\"", "Whitelist", "property", "did", "not", "have", "the", "expected", "value", "\"", ",", "props", ".", "getProperty", "(", "PROP_NAME", ")", ",", "is", "(", "expectedValue", ")", ");", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "csrfguard", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ehcache", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "launcher", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "common", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "locks", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "oss", "-", "edition", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "api", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "api", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "scheduler", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "security", "-", "realms", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "security", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "webapp", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "components", "<", "/", "artifactId", ">", "@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "content", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "crypto", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "groovy", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "h2", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "logging", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "lvo", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "console", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "rrb", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "siesta", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "timeline", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ui", "-", "extjs3", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "unpack", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "webresources", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "basic", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "testsuite", "-", "helper", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "capabilities", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "indexer", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "atlas", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "kazuki", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plexusplugin", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "internal", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "maven", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "archetype", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "maven", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "maven", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "maven", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "npm", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "npm", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "npm", "<", "/", "artifactId", ">", "@", "@", "-", "73", ",", "13", "+", "73", ",", "13", "@", "@", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "osgi", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "osgi", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "osgi", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "p2", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "@", "@", "-", "68", ",", "7", "+", "68", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "85", ",", "27", "+", "85", ",", "27", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "120", ",", "14", "+", "120", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "testsuite", "-", "helper", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "capabilities", "-", "testsuite", "-", "helper", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "logging", "-", "->", "@", "@", "-", "136", ",", "14", "+", "136", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "logging", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "logging", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "content", "-", "->", "@", "@", "-", "152", ",", "14", "+", "152", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "content", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "content", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "webresources", "-", "->", "@", "@", "-", "168", ",", "14", "+", "168", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webresources", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webresources", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "crypto", "-", "->", "@", "@", "-", "184", ",", "14", "+", "184", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "crypto", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "crypto", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "groovy", "-", "->", "@", "@", "-", "200", ",", "14", "+", "200", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovy", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovy", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "plexusplugin", "-", "->", "@", "@", "-", "216", ",", "14", "+", "216", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plexusplugin", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plexusplugin", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "h2", "-", "->", "@", "@", "-", "232", ",", "42", "+", "232", ",", "42", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "h2", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "h2", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "indexer", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "indexer", "-", "lucene", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "internal", "-", "->", "@", "@", "-", "276", ",", "20", "+", "276", ",", "20", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "groovyremote", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "kazuki", "-", "->", "@", "@", "-", "298", ",", "14", "+", "298", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kazuki", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kazuki", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "orient", "-", "->", "@", "@", "-", "314", ",", "22", "+", "314", ",", "22", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "orient", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "kenai", "-", "->", "@", "@", "-", "338", ",", "14", "+", "338", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kenai", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "kenai", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "ldap", "-", "->", "@", "@", "-", "354", ",", "22", "+", "354", ",", "22", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "realm", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "realm", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "realm", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "rutauth", "-", "->", "@", "@", "-", "378", ",", "14", "+", "378", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rutauth", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rutauth", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "402", ",", "14", "+", "402", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "lvo", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "lvo", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "maven", "-", "->", "@", "@", "-", "418", ",", "28", "+", "418", ",", "28", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "archetype", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "archetype", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "maven", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "maven", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "npm", "-", "->", "@", "@", "-", "448", ",", "14", "+", "448", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "469", ",", "29", "+", "469", ",", "29", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "npm", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "obr", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "obr", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "507", ",", "21", "+", "507", ",", "21", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "bridge", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "536", ",", "14", "+", "536", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "p2", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "560", ",", "56", "+", "560", ",", "56", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "console", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "console", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "restlet", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet", "-", "bridge", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "testsupport", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "testsupport", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "rubygems", "-", "->", "@", "@", "-", "618", ",", "21", "+", "618", ",", "21", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "client", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "tools", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "656", ",", "14", "+", "656", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rrb", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "rrb", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "siesta", "-", "->", "@", "@", "-", "672", ",", "14", "+", "672", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "siesta", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "siesta", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "site", "-", "->", "@", "@", "-", "688", ",", "14", "+", "688", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "709", ",", "7", "+", "709", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "site", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "atlas", "-", "->", "@", "@", "-", "718", ",", "14", "+", "718", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "atlas", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "atlas", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "timeline", "-", "->", "@", "@", "-", "734", ",", "14", "+", "734", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "timeline", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "timeline", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "ui", "-", "->", "@", "@", "-", "750", ",", "14", "+", "750", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ui", "-", "extjs3", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ui", "-", "extjs3", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "unpack", "-", "->", "@", "@", "-", "766", ",", "14", "+", "766", ",", "14", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "unpack", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "unpack", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "790", ",", "20", "+", "790", ",", "20", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "819", ",", "21", "+", "819", ",", "21", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "nexus", "-", "plugin", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "wonderland", "-", "plugin", "<", "/", "artifactId", ">", "<", "type", ">", "jar", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet", "-", "bridge", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "model", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "380", ",", "15", "+", "380", ",", "15", "@", "@", "public", "Object", "upload", "(", "Context", "context", ",", "Request", "request", ",", "Response", "response", ",", "List", "<", "F", "}", "if", "(", "isPom", ")", "{", "helper", ".", "storeArtifactPom", "(", "gavRequest", ",", "is", ",", "null", ")", ";", "helper", ".", "storeArtifactPom", "(", "gavRequest", ",", "is", ",", "null", ",", "withChecksums", "(", "))", ";", "isPom", "=", "false", ";", "}", "else", "{", "if", "(", "uploadContext", ".", "isPomAvailable", "(", "))", "{", "helper", ".", "storeArtifact", "(", "gavRequest", ",", "is", ",", "null", ")", ";", "helper", ".", "storeArtifact", "(", "gavRequest", ",", "is", ",", "null", ",", "withChecksums", "(", "))", ";", "}", "else", "{", "helper", ".", "storeArtifactWithGeneratedPom", "(", "gavRequest", ",", "uploadContext", ".", "getPackaging", "(", "),", "is", ",", "null", ")", ";", "helper", ".", "storeArtifactWithGeneratedPom", "(", "gavRequest", ",", "uploadContext", ".", "getPackaging", "(", "),", "is", ",", "null", ",", "withChecksums", "(", "))", ";", "}", "}", "}", "@", "@", "-", "668", ",", "4", "+", "668", ",", "8", "@", "@", "protected", "boolean", "versionMatchesPolicy", "(", "String", "version", ",", "RepositoryPolicy", "policy", ")", "return", "result", ";", "}", "protected", "boolean", "withChecksums", "(", ")", "{", "return", "true", ";", "}", "}", "@", "@", "-", "17", ",", "12", "+", "17", ",", "15", "@", "@", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "InvalidConfigurationException", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "ValidationMessage", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "ValidationResponse", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "AuthenticationInfoConverter", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "GlobalRemoteConnectionSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRemoteAuthentication", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRemoteConnectionSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepositoryCoreConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "validator", ".", "ApplicationValidationResponse", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "NoSuchRepositoryException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "ResourceStoreRequest", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "item", ".", "RepositoryItemUid", ";", "@", "@", "-", "37", ",", "6", "+", "40", ",", "7", "@", "@", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "RemoteStatus", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "Repository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "ShadowRepository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "AbstractNexusPlexusResource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "NexusCompat", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "NoSuchRepositoryAccessException", ";", "@", "@", "-", "60", ",", "6", "+", "64", ",", "8", "@", "@", "import", "org", ".", "restlet", ".", "data", ".", "Status", ";", "import", "org", ".", "restlet", ".", "resource", ".", "ResourceException", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isNotEmpty", ";", "public", "abstract", "class", "AbstractRepositoryPlexusResource", "extends", "AbstractNexusPlexusResource", "{", "@", "@", "-", "76", ",", "6", "+", "82", ",", "8", "@", "@", "private", "RepositoryURLBuilder", "repositoryURLBuilder", ";", "private", "StorageWhitelist", "storageWhitelist", ";", "@", "Inject", "public", "void", "setAuthenticationInfoConverter", "(", "final", "AuthenticationInfoConverter", "authenticationInfoConverter", ")", "{", "this", ".", "authenticationInfoConverter", "=", "authenticationInfoConverter", ";", "@", "@", "-", "96", ",", "6", "+", "104", ",", "11", "@", "@", "public", "void", "setRepositoryURLBuilder", "(", "final", "RepositoryURLBuilder", "repositoryURLBuil", "this", ".", "repositoryURLBuilder", "=", "repositoryURLBuilder", ";", "}", "@", "Inject", "public", "void", "setStorageWhitelist", "(", "final", "StorageWhitelist", "storageWhitelist", ")", "{", "this", ".", "storageWhitelist", "=", "storageWhitelist", ";", "}", "protected", "AuthenticationInfoConverter", "getAuthenticationInfoConverter", "(", ")", "{", "return", "authenticationInfoConverter", ";", "}", "@", "@", "-", "448", ",", "4", "+", "461", ",", "30", "@", "@", "protected", "CRemoteConnectionSettings", "convertRemoteConnectionSettings", "(", "return", "cRemoteConnectionSettings", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "/", "**", "*", "Validates", "the", "specified", "{", "@", "code", "storageLocationUrl", "}", "as", "an", "allowed", "URL", "for", "the", "'", "overrideLocalStorageUrl", "'", "property", "*", "of", "a", "repository", "configuration", ".", "Valid", "values", "are", "based", "on", "the", "configured", "{", "@", "link", "StorageWhitelist", "}", "*", "*", "@", "param", "storageLocationUrl", "the", "requested", "local", "storage", "url", "*", "@", "return", "the", "{", "@", "code", "storageLocationUrl", "}", "if", "valid", "*", "@", "throws", "InvalidConfigurationException", "if", "{", "@", "code", "storageLocationUrl", "}", "is", "not", "whitelisted", "*", "/", "protected", "String", "validOverrideLocalStorageUrl", "(", "final", "String", "storageLocationUrl", ")", "throws", "InvalidConfigurationException", "{", "if", "(", "isNotEmpty", "(", "storageLocationUrl", ")", "&", "&", "!", "storageWhitelist", ".", "isApproved", "(", "storageLocationUrl", ")", ")", "{", "getLogger", "(", ").", "warn", "(", "\"", "The", "location", "'", "{}", "'", "has", "not", "been", "whitelisted", "for", "use", "as", "repository", "storage", ".", "Add", "the", "value", "to", "the", "'", "{}", "'", "property", "in", "nexus", ".", "properties", ".", "See", "'", "Override", "Storage", "Location", "'", "under", "{", "}", "for", "details", "\"", ",", "storageLocationUrl", ",", "StorageWhitelist", ".", "PROP_NAME", ",", "\"", "https", ":", "//", "links", ".", "sonatype", ".", "com", "/", "products", "/", "nxrm2", "/", "configuring", "-", "repositories", "\"", ");", "String", "message", "=", "\"", "Specified", "location", "is", "not", "approved", "for", "storage", ".", "See", "nexus", ".", "log", "for", "details", ".", "\";", "ValidationResponse", "vr", "=", "new", "ApplicationValidationResponse", "(", ");", "ValidationMessage", "error", "=", "new", "ValidationMessage", "(", "\"", "overrideLocalStorageUrl", "\"", ",", "message", ",", "message", ")", ";", "vr", ".", "addValidationError", "(", "error", ")", ";", "throw", "new", "InvalidConfigurationException", "(", "vr", ")", ";", "}", "return", "storageLocationUrl", ";", "}", "}", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "javax", ".", "ws", ".", "rs", ".", "Produces", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "ConfigurationException", ";", "import", "org", ".", "sonatype", ".", "configuration", ".", "validation", ".", "InvalidConfigurationException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CLocalStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRemoteStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "model", ".", "CRepository", ";", "@", "@", "-", "48", ",", "7", "+", "49", ",", "6", "@", "@", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PathProtectionDescriptor", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PlexusResourceException", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "codehaus", ".", "enunciate", ".", "contract", ".", "jaxrs", ".", "ResourceMethodSignature", ";", "import", "org", ".", "codehaus", ".", "plexus", ".", "util", ".", "xml", ".", "Xpp3Dom", ";", "import", "org", ".", "restlet", ".", "Context", ";", "@", "@", "-", "58", ",", "6", "+", "58", ",", "8", "@", "@", "import", "org", ".", "restlet", ".", "resource", ".", "ResourceException", ";", "import", "org", ".", "restlet", ".", "resource", ".", "Variant", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isNotEmpty", ";", "/", "**", "*", "A", "resource", "list", "for", "Repository", "list", ".", "*", "@", "@", "-", "172", ",", "90", "+", "174", ",", "95", "@", "@", "public", "CRepository", "getRepositoryAppModel", "(", "RepositoryBaseResource", "resource", ",", "CRepos", "{", "CRepository", "appModel", "=", "new", "DefaultCRepository", "(", ");", "Xpp3Dom", "ex", "=", "null", ";", "appModel", ".", "setLocalStatus", "(", "LocalStatus", ".", "IN_SERVICE", ".", "name", "(", "))", ";", "if", "(", "target", "!", "=", "null", ")", "{", "appModel", ".", "setLocalStatus", "(", "target", ".", "getLocalStatus", "(", "))", ";", "try", "{", "Xpp3Dom", "ex", "=", "null", ";", "ex", "=", "(", "Xpp3Dom", ")", "target", ".", "getExternalConfiguration", "(", ");", "}", "else", "{", "ex", "=", "new", "Xpp3Dom", "(", "DefaultCRepository", ".", "EXTERNAL_CONFIGURATION_NODE_NAME", ")", ";", "}", "appModel", ".", "setLocalStatus", "(", "LocalStatus", ".", "IN_SERVICE", ".", "name", "(", "))", ";", "if", "(", "target", "!", "=", "null", ")", "{", "appModel", ".", "setLocalStatus", "(", "target", ".", "getLocalStatus", "(", "))", ";", "appModel", ".", "setId", "(", "resource", ".", "getId", "(", "))", ";", "ex", "=", "(", "Xpp3Dom", ")", "target", ".", "getExternalConfiguration", "(", ");", "}", "else", "{", "ex", "=", "new", "Xpp3Dom", "(", "DefaultCRepository", ".", "EXTERNAL_CONFIGURATION_NODE_NAME", ")", ";", "}", "appModel", ".", "setName", "(", "resource", ".", "getName", "(", "))", ";", "appModel", ".", "setId", "(", "resource", ".", "getId", "(", "))", ";", "appModel", ".", "setExposed", "(", "resource", ".", "isExposed", "(", "))", ";", "appModel", ".", "setName", "(", "resource", ".", "getName", "(", "))", ";", "appModel", ".", "setProviderRole", "(", "resource", ".", "getProviderRole", "(", "))", ";", "appModel", ".", "setExposed", "(", "resource", ".", "isExposed", "(", "))", ";", "if", "(", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_VIRTUAL", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "appModel", ".", "setProviderRole", "(", "resource", ".", "getProviderRole", "(", "))", ";", "/", "/", "indexer", "is", "unaware", "of", "the", "m2", "layout", "conversion", "appModel", ".", "setIndexable", "(", "false", ")", ";", "if", "(", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_VIRTUAL", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "RepositoryShadowResource", "repoResource", "=", "(", "RepositoryShadowResource", ")", "resource", ";", "/", "/", "indexer", "is", "unaware", "of", "the", "m2", "layout", "conversion", "appModel", ".", "setIndexable", "(", "false", ")", ";", "M2LayoutedM1ShadowRepositoryConfiguration", "exConf", "=", "new", "M2LayoutedM1ShadowRepositoryConfiguration", "(", "ex", ")", ";", "RepositoryShadowResource", "repoResource", "=", "(", "RepositoryShadowResource", ")", "resource", ";", "exConf", ".", "setMasterRepositoryId", "(", "repoResource", ".", "getShadowOf", "(", "))", ";", "M2LayoutedM1ShadowRepositoryConfiguration", "exConf", "=", "new", "M2LayoutedM1ShadowRepositoryConfiguration", "(", "ex", ")", ";", "exConf", ".", "setSynchronizeAtStartup", "(", "repoResource", ".", "isSyncAtStartup", "(", "))", ";", "exConf", ".", "setMasterRepositoryId", "(", "repoResource", ".", "getShadowOf", "(", "))", ";", "}", "else", "if", "(", "!", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_GROUP", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "RepositoryResource", "repoResource", "=", "(", "RepositoryResource", ")", "resource", ";", "exConf", ".", "setSynchronizeAtStartup", "(", "repoResource", ".", "isSyncAtStartup", "(", "))", ";", "/", "/", "we", "can", "use", "the", "default", "if", "the", "value", "is", "empty", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "repoResource", ".", "getWritePolicy", "(", "))", ")", "{", "appModel", ".", "setWritePolicy", "(", "repoResource", ".", "getWritePolicy", "(", "))", ";", "}", "else", "if", "(", "!", "RepositoryBaseResourceConverter", ".", "REPO_TYPE_GROUP", ".", "equals", "(", "resource", ".", "getRepoType", "(", "))", ")", "{", "RepositoryResource", "repoResource", "=", "(", "RepositoryResource", ")", "resource", ";", "appModel", ".", "setBrowseable", "(", "repoResource", ".", "isBrowseable", "(", "))", ";", "/", "/", "we", "can", "use", "the", "default", "if", "the", "value", "is", "empty", "if", "(", "isNotEmpty", "(", "repoResource", ".", "getWritePolicy", "(", "))", ")", "{", "appModel", ".", "setWritePolicy", "(", "repoResource", ".", "getWritePolicy", "(", "))", ";", "}", "appModel", ".", "setIndexable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setSearchable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setBrowseable", "(", "repoResource", ".", "isBrowseable", "(", "))", ";", "appModel", ".", "setNotFoundCacheTTL", "(", "repoResource", ".", "getNotFoundCacheTTL", "(", "))", ";", "appModel", ".", "setIndexable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setSearchable", "(", "repoResource", ".", "isIndexable", "(", "))", ";", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "appModel", ".", "setNotFoundCacheTTL", "(", "repoResource", ".", "getNotFoundCacheTTL", "(", "))", ";", "M2RepositoryConfiguration", "exConf", "=", "new", "M2RepositoryConfiguration", "(", "ex", ")", ";", "appModel", ".", "setExternalConfiguration", "(", "ex", ")", ";", "exConf", ".", "setRepositoryPolicy", "(", "EnumUtil", ".", "valueOf", "(", "repoResource", ".", "getRepoPolicy", "(", "),", "RepositoryPolicy", ".", "class", ")", ");", "M2RepositoryConfiguration", "exConf", "=", "new", "M2RepositoryConfiguration", "(", "ex", ")", ";", "if", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", ")", "!", "=", "null", ")", "{", "appModel", ".", "setLocalStorage", "(", "new", "CLocalStorage", "(", "))", ";", "exConf", ".", "setRepositoryPolicy", "(", "EnumUtil", ".", "valueOf", "(", "repoResource", ".", "getRepoPolicy", "(", "),", "RepositoryPolicy", ".", "class", ")", ");", "appModel", ".", "getLocalStorage", "(", ").", "setUrl", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", "))", ";", "if", "(", "isNotEmpty", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", "))", ")", "{", "appModel", ".", "setLocalStorage", "(", "new", "CLocalStorage", "(", "))", ";", "appModel", ".", "getLocalStorage", "(", ").", "setProvider", "(", "\"", "file", "\"", ");", "}", "else", "{", "appModel", ".", "setLocalStorage", "(", "null", ")", ";", "}", "appModel", ".", "getLocalStorage", "(", ").", "setUrl", "(", "validOverrideLocalStorageUrl", "(", "repoResource", ".", "getOverrideLocalStorageUrl", "(", "))", ");", "appModel", ".", "getLocalStorage", "(", ").", "setProvider", "(", "\"", "file", "\"", ");", "}", "else", "{", "appModel", ".", "setLocalStorage", "(", "null", ")", ";", "}", "RepositoryResourceRemoteStorage", "remoteStorage", "=", "repoResource", ".", "getRemoteStorage", "(", ");", "if", "(", "remoteStorage", "!", "=", "null", ")", "{", "appModel", ".", "setNotFoundCacheActive", "(", "true", ")", ";", "RepositoryResourceRemoteStorage", "remoteStorage", "=", "repoResource", ".", "getRemoteStorage", "(", ");", "if", "(", "remoteStorage", "!", "=", "null", ")", "{", "appModel", ".", "setNotFoundCacheActive", "(", "true", ")", ";", "appModel", ".", "setRemoteStorage", "(", "new", "CRemoteStorage", "(", "))", ";", "appModel", ".", "setRemoteStorage", "(", "new", "CRemoteStorage", "(", "))", ";", "appModel", ".", "getRemoteStorage", "(", ").", "setUrl", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ";", "appModel", ".", "getRemoteStorage", "(", ").", "setUrl", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ";", "appModel", ".", "getRemoteStorage", "(", ").", "setProvider", "(", "remoteProviderHintFactory", ".", "getDefaultRoleHint", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ");", "appModel", ".", "getRemoteStorage", "(", ").", "setProvider", "(", "remoteProviderHintFactory", ".", "getDefaultRoleHint", "(", "remoteStorage", ".", "getRemoteStorageUrl", "(", "))", ");", "}", "}", "}", "appModel", ".", "setProviderHint", "(", "resource", ".", "getProvider", "(", "))", ";", "appModel", ".", "setProviderHint", "(", "resource", ".", "getProvider", "(", "))", ";", "if", "(", "RepositoryProxyResource", ".", "class", ".", "isAssignableFrom", "(", "resource", ".", "getClass", "(", "))", ")", "{", "appModel", "=", "getRepositoryProxyAppModel", "(", "(", "RepositoryProxyResource", ")", "resource", ",", "appModel", ")", ";", "if", "(", "RepositoryProxyResource", ".", "class", ".", "isAssignableFrom", "(", "resource", ".", "getClass", "(", "))", ")", "{", "appModel", "=", "getRepositoryProxyAppModel", "(", "(", "RepositoryProxyResource", ")", "resource", ",", "appModel", ")", ";", "}", "}", "catch", "(", "InvalidConfigurationException", "e", ")", "{", "handleConfigurationException", "(", "e", ")", ";", "}", "return", "appModel", ";", "@", "@", "-", "297", ",", "7", "+", "297", ",", "7", "@", "@", "public", "Object", "put", "(", "Context", "context", ",", "Request", "request", ",", "Response", "response", ",", "Object", "pa", "}", "}", "repository", ".", "setLocalUrl", "(", "model", ".", "getOverrideLocalStorageUrl", "(", "))", ";", "repository", ".", "setLocalUrl", "(", "validOverrideLocalStorageUrl", "(", "model", ".", "getOverrideLocalStorageUrl", "(", "))", ");", "getNexusConfiguration", "(", ").", "saveConfiguration", "(", ");", "}", "@", "@", "-", "12", ",", "21", "+", "12", ",", "27", "@", "@", "*", "/", "package", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "repositories", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "NexusAppTestSupport", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "NexusConfiguration", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "ChecksumPolicy", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "maven", ".", "RepositoryPolicy", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "Repository", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "repository", ".", "RepositoryWritePolicy", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "proxy", ".", "storage", ".", "StorageWhitelist", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "AbstractNexusPlexusResource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "AuthenticationSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RemoteConnectionSettings", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RepositoryProxyResource", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RepositoryResourceRemoteStorage", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "rest", ".", "model", ".", "RepositoryResourceResponse", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PlexusResource", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "PlexusResourceException", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "error", ".", "ErrorMessage", ";", "import", "org", ".", "sonatype", ".", "plexus", ".", "rest", ".", "resource", ".", "error", ".", "ErrorResponse", ";", "import", "junit", ".", "framework", ".", "Assert", ";", "import", "org", ".", "codehaus", ".", "plexus", ".", "context", ".", "Context", ";", "import", "org", ".", "codehaus", ".", "plexus", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "37", ",", "6", "+", "43", ",", "7", "@", "@", "public", "class", "RepositoryCreateUpdateTest", "extends", "NexusAppTestSupport", "{", "private", "static", "final", "String", "OVERRIDE_LOCAL_STORAGE_PATH", "=", "\"", "storage", "/", "foo", "/", "bar", "\"", ";", "@", "Before", "public", "void", "prepare", "(", ")", "@", "@", "-", "45", ",", "6", "+", "52", ",", "12", "@", "@", "public", "void", "prepare", "(", ")", "startNx", "(", ");", "}", "@", "Override", "protected", "void", "customizeContext", "(", "final", "Context", "ctx", ")", "{", "super", ".", "customizeContext", "(", "ctx", ")", ";", "ctx", ".", "put", "(", "StorageWhitelist", ".", "PROP_NAME", ",", "Paths", ".", "get", "(", "getWorkHomeDir", "(", ").", "getAbsolutePath", "(", "),", "OVERRIDE_LOCAL_STORAGE_PATH", ")", ");", "}", "@", "Test", "public", "void", "testCreate", "(", ")", "throws", "Exception", "@", "@", "-", "304", ",", "10", "+", "317", ",", "9", "@", "@", "public", "void", "testCreateAuthNoProxy", "(", ")", "public", "void", "testUpdateLocalStorage", "(", ")", "throws", "Exception", "{", "RepositoryProxyResource", "originalResource", "=", "this", ".", "sendAndGetResponse", "(", ");", "String", "newlocalStorage", "=", "originalResource", ".", "getDefaultLocalStorageUrl", "(", ").", "replaceAll", "(", "originalResource", ".", "getId", "(", "),", "\"", "foo", "/", "bar", "\"", ");", "originalResource", ".", "getDefaultLocalStorageUrl", "(", ").", "replaceAll", "(", "originalResource", ".", "getId", "(", "),", "\"", "foo", "/", "baz", "\"", ");", "originalResource", ".", "setOverrideLocalStorageUrl", "(", "newlocalStorage", ")", ";", "RepositoryPlexusResource", "plexusResource", "=", "@", "@", "-", "321", ",", "6", "+", "333", ",", "24", "@", "@", "public", "void", "testUpdateLocalStorage", "(", ")", "RepositoryResourceResponse", "repoRequest", "=", "new", "RepositoryResourceResponse", "(", ");", "repoRequest", ".", "setData", "(", "originalResource", ")", ";", "/", "/", "request", "should", "fail", "as", "the", "storage", "location", "is", "not", "whitelisted", "try", "{", "plexusResource", ".", "put", "(", "null", ",", "request", ",", "response", ",", "repoRequest", ")", ";", "org", ".", "junit", ".", "Assert", ".", "fail", "(", "\"", "Expected", "update", "to", "fail", "due", "to", "non", "-", "whitelisted", "storage", "location", "\"", ");", "}", "catch", "(", "PlexusResourceException", "e", ")", "{", "ErrorResponse", "errorResponse", "=", "(", "ErrorResponse", ")", "e", ".", "getResultObject", "(", ");", "assert", "errorResponse", "!", "=", "null", "&", "&", "errorResponse", ".", "getErrors", "(", ").", "size", "(", ")", "=", "=", "1", ";", "ErrorMessage", "errorMessage", "=", "(", "ErrorMessage", ")", "errorResponse", ".", "getErrors", "(", ").", "get", "(", "0", ")", ";", "assert", "errorMessage", "!", "=", "null", "&", "&", "errorMessage", ".", "getId", "(", ").", "equals", "(", "\"", "overrideLocalStorageUrl", "\"", ")", "&", "&", "errorMessage", ".", "getMsg", "(", ").", "equals", "(", "\"", "Specified", "location", "is", "not", "approved", "for", "storage", ".", "See", "nexus", ".", "log", "for", "details", ".", "\")", ";", "}", "/", "/", "use", "a", "whitelisted", "storage", "location", "newlocalStorage", "=", "Paths", ".", "get", "(", "getWorkHomeDir", "(", ").", "getAbsolutePath", "(", "),", "OVERRIDE_LOCAL_STORAGE_PATH", ",", "originalResource", ".", "getId", "(", "))", ".", "toString", "(", ");", "originalResource", ".", "setOverrideLocalStorageUrl", "(", "newlocalStorage", ")", ";", "repoRequest", ".", "setData", "(", "originalResource", ")", ";", "RepositoryResourceResponse", "repoResponse", "=", "(", "RepositoryResourceResponse", ")", "plexusResource", ".", "put", "(", "null", ",", "request", ",", "response", ",", "repoRequest", ")", ";", "RepositoryProxyResource", "result", "=", "(", "RepositoryProxyResource", ")", "repoResponse", ".", "getData", "(", ");", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "restlet1x", "-", "testsupport", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "restlet1x", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "ruby", "-", "tools", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "rubygem", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "kenai", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "rutauth", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "security", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "yum", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "yum", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "yum", "-", "repository", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "sonatype", ".", "gossip", ".", "support", ".", "LoggingOutputStream", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "com", ".", "google", ".", "common", ".", "annotations", ".", "VisibleForTesting", ";", "import", "org", ".", "apache", ".", "commons", ".", "exec", ".", "CommandLine", ";", "import", "org", ".", "apache", ".", "commons", ".", "exec", ".", "DefaultExecutor", ";", "import", "org", ".", "apache", ".", "commons", ".", "exec", ".", "PumpStreamHandler", ";", "@", "@", "-", "99", ",", "13", "+", "100", ",", "19", "@", "@", "public", "int", "exec", "(", "final", "String", "command", ",", "String", "params", ",", "OutputStream", "out", ",", "OutputStr", "return", "exitValue", ";", "}", "private", "String", "getCleanCommand", "(", "String", "command", ",", "String", "params", ")", "{", "@", "VisibleForTesting", "String", "getCleanCommand", "(", "String", "command", ",", "String", "params", ")", "{", "if", "(", "allowedExecutables", ".", "contains", "(", "command", ")", ")", "{", "return", "command", "+", "\"", "\"", "+", "params", ";", "}", "File", "file", "=", "new", "File", "(", "command", ")", ";", "if", "(", "!", "file", ".", "exists", "(", "))", "{", "LOG", ".", "debug", "(", "\"", "Attempt", "to", "execute", "command", "that", "doesn", "'", "t", "exist", "{", "}\"", ",", "file", ".", "getAbsolutePath", "(", "))", ";", "return", "null", ";", "}", "if", "(", "file", ".", "getAbsolutePath", "(", ").", "startsWith", "(", "applicationDirectories", ".", "getWorkDirectory", "(", ").", "getAbsolutePath", "(", "))", ")", "{", "LOG", ".", "debug", "(", "\"", "Attempt", "to", "execute", "command", "with", "illegal", "path", "{", "}\"", ",", "file", ".", "getAbsolutePath", "(", "))", ";", "return", "null", ";", "@", "@", "-", "13", ",", "14", "+", "13", ",", "19", "@", "@", "package", "org", ".", "sonatype", ".", "nexus", ".", "yum", ".", "internal", ".", "task", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "configuration", ".", "application", ".", "ApplicationDirectories", ";", "import", "org", ".", "sonatype", ".", "nexus", ".", "yum", ".", "internal", ".", "support", ".", "YumNexusTestSupport", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "nullValue", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "@", "-", "29", ",", "62", "+", "34", ",", "65", "@", "@", "{", "private", "CommandLineExecutor", "underTest", ";", "private", "ApplicationDirectories", "applicationDirectories", ";", "@", "Rule", "public", "TemporaryFolder", "tmp", "=", "new", "TemporaryFolder", "(", ");", "@", "Before", "public", "void", "setup", "(", ")", "{", "applicationDirectories", "=", "mock", "(", "ApplicationDirectories", ".", "class", ")", ";", "when", "(", "applicationDirectories", ".", "getWorkDirectory", "(", "))", ".", "thenReturn", "(", "new", "File", "(", "\"/", "a", "/", "dir", "\"", "))", ";", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createrepo", ",", "mergerepo", "\"", ");", "}", "private", "File", "work", ";", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_createRepo", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "createrepo", "\"", ",", "\"", "--", "version", "\"", ");", "}", "private", "File", "bin", ";", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_createRepoNoPath", "(", ")", "throws", "Exception", "{", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createreposhouldntexist", ",", "mergereposhouldntexist", "\"", ");", "underTest", ".", "exec", "(", "\"", "createreposhouldntexist", "\"", ",", "\"", "--", "version", "\"", ");", "}", "private", "File", "createrepo", ";", "private", "File", "notcreaterepo", ";", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_mergeRepo", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "mergerepo", "\"", ",", "\"", "--", "version", "\"", ");", "private", "File", "workcreaterepo", ";", "private", "File", "mergerepo", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "work", "=", "tmp", ".", "newFolder", "(", "\"", "work", "\"", ");", "bin", "=", "tmp", ".", "newFolder", "(", "\"", "bin", "\"", ");", "createrepo", "=", "tmp", ".", "newFile", "(", "\"", "bin", "\"", "+", "File", ".", "separator", "+", "\"", "createrepo", "\"", ");", "notcreaterepo", "=", "tmp", ".", "newFile", "(", "\"", "bin", "\"", "+", "File", ".", "separator", "+", "\"", "notcreaterepo", "\"", ");", "workcreaterepo", "=", "tmp", ".", "newFile", "(", "\"", "work", "\"", "+", "File", ".", "separator", "+", "\"", "createrepo", "\"", ");", "mergerepo", "=", "tmp", ".", "newFile", "(", "\"", "bin", "\"", "+", "File", ".", "separator", "+", "\"", "mergerepo", "\"", ");", "ApplicationDirectories", "applicationDirectories", "=", "mock", "(", "ApplicationDirectories", ".", "class", ")", ";", "when", "(", "applicationDirectories", ".", "getWorkDirectory", "(", "))", ".", "thenReturn", "(", "work", ")", ";", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createrepo", ",", "mergerepo", "\"", ");", "}", "/", "/", "IOException", "should", "be", "thrown", "as", "validation", "will", "pass", ",", "but", "executable", "isn", "'", "t", "there", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "exec_mergeRepoNoPath", "(", ")", "throws", "Exception", "{", "underTest", "=", "new", "CommandLineExecutor", "(", "applicationDirectories", ",", "\"", "createreposhouldntexist", ",", "mergereposhouldntexist", "\"", ");", "underTest", ".", "exec", "(", "\"", "mergereposhouldntexist", "\"", ",", "\"", "--", "version", "\"", ");", "@", "Test", "public", "void", "getCleanCommand_legalAccess", "(", ")", "{", "assertCleanCommand", "(", "\"", "createrepo", "\"", ");", "assertCleanCommand", "(", "\"", "mergerepo", "\"", ");", "assertCleanCommand", "(", "createrepo", ".", "getAbsolutePath", "(", "))", ";", "assertCleanCommand", "(", "mergerepo", ".", "getAbsolutePath", "(", "))", ";", "}", "/", "/", "IllegalAccessException", "should", "be", "thrown", "as", "this", "executable", "isn", "'", "t", "allowed", "@", "Test", "(", "expected", "=", "IllegalAccessException", ".", "class", ")", "public", "void", "exec_notAllowed", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "somethingelse", "\"", ",", "\"", "--", "someotherflag", "\"", ");", "@", "Test", "public", "void", "getCleanCommand_illegalAccess", "(", ")", "{", "assertNotCleanCommand", "(", "\"/", "fake", "/", "path", "/", "createrepo", "\"", ");", "assertNotCleanCommand", "(", "\"/", "fake", "/", "path", "/", "mergerepo", "\"", ");", "assertNotCleanCommand", "(", "\"/", "fake", "/", "path", "/", "somethingelse", "\"", ");", "assertNotCleanCommand", "(", "bin", ".", "getAbsolutePath", "(", ")", "+", "File", ".", "separator", "+", "\"", "createreposhouldntexist", "\"", ");", "/", "/", "exists", "but", "isn", "'", "t", "in", "allowed", "executables", "assertNotCleanCommand", "(", "notcreaterepo", ".", "getAbsolutePath", "(", "))", ";", "/", "/", "extra", "command", "args", "are", "not", "allowed", "assertNotCleanCommand", "(", "bin", ".", "getAbsolutePath", "(", ")", "+", "File", ".", "separator", "+", "\"", "createrepo", "-", "-", "somethingbad", "\"", ");", "/", "/", "commands", "launching", "things", "inside", "nexus", "are", "not", "allowed", "assertNotCleanCommand", "(", "workcreaterepo", ".", "getAbsolutePath", "(", "))", ";", "/", "/", "this", "will", "trick", "weak", "validation", "logic", "into", "thinking", "it", "'", "s", "a", "path", "to", "a", "createrepo", "executable", "assertNotCleanCommand", "(", "\"/", "bin", "/", "bash", "-", "c", "curl", "$", "{", "IFS", "}", "http", ":", "//", "192", ".", "168", ".", "88", ".", "1", ":", "8000", "/", "|", "|", "\"", "+", "createrepo", ".", "getAbsolutePath", "(", "))", ";", "}", "/", "/", "IllegalAccessException", "should", "be", "thrown", "as", "commands", "launching", "things", "inside", "nexus", "are", "not", "allowed", "@", "Test", "(", "expected", "=", "IllegalAccessException", ".", "class", ")", "public", "void", "exec_pathNotAllowed", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "a", "/", "dir", "/", "createrepo", "\"", ",", "\"", "--", "someotherflag", "\"", ");", "private", "void", "assertCleanCommand", "(", "String", "command", ")", "{", "assertThat", "(", "underTest", ".", "getCleanCommand", "(", "command", ",", "\"", "--", "version", "\"", "),", "is", "(", "not", "(", "nullValue", "(", "))", "))", ";", "}", "@", "Test", "(", "expected", "=", "IllegalAccessException", ".", "class", ")", "public", "void", "exec_extraConfigNotAllowed", "(", ")", "throws", "Exception", "{", "underTest", ".", "exec", "(", "\"/", "fake", "/", "path", "/", "createrepo", "-", "-", "somethingbad", "\"", ",", "\"", "--", "someotherflag", "\"", ");", "private", "void", "assertNotCleanCommand", "(", "String", "command", ")", "{", "assertThat", "(", "underTest", ".", "getCleanCommand", "(", "command", ",", "\"", "--", "version", "\"", "),", "is", "(", "nullValue", "(", "))", ");", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "-", "yum", "<", "/", "artifactId", ">", "@", "@", "-", "28", ",", "7", "+", "28", ",", "7", "@", "@", "<", "name", ">", "${", "project", ".", "groupId", "}", ":$", "{", "project", ".", "artifactId", "}", "</", "name", ">", "<", "packaging", ">", "pom", "<", "/", "packaging", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "inceptionYear", ">", "2008", "<", "/", "inceptionYear", ">", "<", "url", ">", "http", ":", "//", "nexus", ".", "sonatype", ".", "org", "/", "</", "url", ">", "@", "@", "-", "92", ",", "7", "+", "92", ",", "7", "@", "@", "Define", "nexus", "versions", ".", "The", "'", "nexus", ".", "version", "'", "property", "always", "refers", "to", "the", "version", "of", "the", "current", "project", ".", "These", "values", "must", "always", "be", "constants", ";", "'", "nexus", ".", "version", "'", "will", "get", "update", "automatically", "by", "set", "-", "version", ".", "-", "->", "<", "nexus", ".", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "nexus", ".", "version", ">", "<", "nexus", ".", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "nexus", ".", "version", ">", "<", "!-", "-", "FIXME", ":", "WTF", "is", "this", "for", ",", "part", "of", "the", "http", "proxy", "changes", ",", "used", "in", "subst", "in", "test", "files", ":", "-(", "-", "->", "<", "nexus", ".", "configuration", ".", "version", ">", "2", ".", "8", ".", "0", "<", "/", "nexus", ".", "configuration", ".", "version", ">", "@", "@", "-", "164", ",", "123", "+", "164", ",", "123", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "base", "-", "configuration", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "bootstrap", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "client", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "configuration", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "classifier", ">", "tests", "<", "/", "classifier", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "csrfguard", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ehcache", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "launcher", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "ldap", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "locks", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "oss", "-", "edition", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "api", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "api", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "repository", "-", "metadata", "-", "model", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "scheduler", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "security", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "security", "-", "realms", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webapp", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "webapp", "<", "/", "artifactId", ">", "<", "type", ">", "war", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "testsupport", "-", "->", "@", "@", "-", "290", ",", "45", "+", "290", ",", "45", "@", "@", "<", "artifactId", ">", "nexus", "-", "it", "-", "helper", "-", "plugin", "<", "/", "artifactId", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugin", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "harness", "-", "launcher", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "support", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "assemblies", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "assemblies", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "bundle", "-", "template", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "classifier", ">", "bundle", "<", "/", "classifier", ">", "<", "type", ">", "zip", "<", "/", "type", ">", "<", "/", "dependency", ">", "@", "@", "-", "651", ",", "7", "+", "651", ",", "7", "@", "@", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "environment", "-", "maven", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "pluginManagement", ">", "@", "@", "-", "734", ",", "9", "+", "734", ",", "9", "@", "@", "<", "exclude", ">", "commons", "-", "vfs", ":", "commons", "-", "vfs", "<", "/", "exclude", ">", "<", "!-", "-", "Ban", "beanutils", "which", "includes", "commons", "-", "collections", ".", "Ban", "beanutils", "pre", "-", "1", ".", "9", "which", "includes", "embedded", "commons", "-", "collections", ".", "-", "->", "<", "exclude", ">", "commons", "-", "beanutils", ":", "commons", "-", "beanutils", "<", "/", "exclude", ">", "<", "exclude", ">", "commons", "-", "beanutils", ":", "commons", "-", "beanutils", ":", "(,", "1", ".", "9", "]", "</", "exclude", ">", "<", "!-", "-", "Security", "hazard", ":", "osvdb", "-", "68314", "@", "@", "-", "1", "+", "1", "@", "@", "b", "=", "release", "-", "2", ".", "14", ".", "14", ",", "r", "=", "37c24494ded9b6ce64d4bef5d2f81e8187d370a6", ",", "t", "=", "2019", "-", "08", "-", "07", "-", "1118", "-", "4244", "\\", "No", "newline", "at", "end", "of", "file", "b", "=", "release", "-", "2", ".", "14", ".", "15", ",", "r", "=", "68bc0271bf58b1bcd452d85022a385cfca949727", ",", "t", "=", "2019", "-", "10", "-", "08", "-", "1119", "-", "3412", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "testsuite", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "legacy", "-", "testsuite", "<", "/", "artifactId", ">", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "testsuite", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "modern", "-", "testsuite", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "testsuite", "<", "/", "groupId", ">", "@", "@", "-", "53", ",", "15", "+", "53", ",", "15", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "plugins", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "it", "-", "helper", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "common", "<", "/", "artifactId", ">", "@", "@", "-", "19", ",", "7", "+", "19", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "test", "-", "environment", "-", "maven", "-", "plugin", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "!-", "-", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "client", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "testsuite", "-", "support", "<", "/", "artifactId", ">", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "parent", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "nexus", "-", "testsupport", "<", "/", "artifactId", ">", "@", "@", "-", "46", ",", "7", "+", "46", ",", "7", "@", "@", "<", "groupId", ">", "org", ".", "sonatype", ".", "nexus", ".", "buildsupport", "<", "/", "groupId", ">", "<", "artifactId", ">", "nexus", "-", "buildsupport", "-", "all", "<", "/", "artifactId", ">", "<", "type", ">", "pom", "<", "/", "type", ">", "<", "version", ">", "2", ".", "14", ".", "14", "-", "01", "<", "/", "version", ">", "<", "version", ">", "2", ".", "14", ".", "15", "-", "01", "<", "/", "version", ">", "<", "scope", ">", "import", "<", "/", "scope", ">", "<", "/", "dependency", ">"], "docstring_tokens": ["uploading", "a", "specially", "crafted", "file"]}
{"contents": ["ALSA:", "pcm", ":", "Call", "kill_fasync()", "in", "stream", "lock", "Currently", "kill_fasync()", "is", "called", "outside", "the", "stream", "lock", "in", "snd_pcm_period_elapsed().", "This", "is", "potentially", "racy,", "since", "the", "stream", "may", "get", "released", "even", "during", "the", "irq", "handler", "is", "running.", "Although", "snd_pcm_release_substream()", "calls", "snd_pcm_drop(),", "this", "doesn't", "guarantee", "that", "the", "irq", "handler", "finishes,", "thus", "the", "kill_fasync()", "call", "outside", "the", "stream", "spin", "lock", "may", "be", "invoked", "after", "the", "substream", "is", "detached,", "as", "recently", "reported", "by", "KASAN.", "As", "a", "quick", "workaround,", "move", "kill_fasync()", "call", "inside", "the", "stream", "lock.", "The", "fasync", "is", "rarely", "used", "interface,", "so", "this", "shouldn't", "have", "a", "big", "impact", "from", "the", "performance", "POV.", "Ideally,", "we", "should", "implement", "some", "sync", "mechanism", "for", "the", "proper", "finish", "of", "stream", "and", "irq", "handler.", "But", "this", "oneliner", "should", "suffice", "for", "most", "cases,", "so", "far.", "Reported-by:", "Baozeng", "Ding", "<sploving1@gmail.com>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "1886", ",", "8", "+", "1886", ",", "8", "@", "@", "void", "snd_pcm_period_elapsed", "(", "struct", "snd_pcm_substream", "*", "substream", ")", "snd_timer_interrupt", "(", "substream", "-", ">", "timer", ",", "1", ")", ";", "#", "endif", "_end", ":", "snd_pcm_stream_unlock_irqrestore", "(", "substream", ",", "flags", ")", ";", "kill_fasync", "(", "&", "runtime", "-", ">", "fasync", ",", "SIGIO", ",", "POLL_IN", ")", ";", "snd_pcm_stream_unlock_irqrestore", "(", "substream", ",", "flags", ")", ";", "}", "EXPORT_SYMBOL", "(", "snd_pcm_period_elapsed", ")", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "SNDRV_PCM_TRIGGER_START", "command"]}
{"contents": ["Merge", "pull", "request", "#446", "from", "apache/WW-5096-fix-static", "[WW-5096]", "Fix", "StaticParametersInterceptor", "param", "overwrite"], "code_tokens": ["@", "@", "-", "227", ",", "21", "+", "227", ",", "13", "@", "@", "public", "String", "intercept", "(", "ActionInvocation", "invocation", ")", "throws", "Exception", "{", "protected", "void", "addParametersToContext", "(", "ActionContext", "ac", ",", "Map", "<", "String", ",", "?", ">", "newParams", ")", "{", "HttpParameters", "previousParams", "=", "ac", ".", "getParameters", "(", ");", "HttpParameters", ".", "Builder", "combinedParams", "=", "HttpParameters", ".", "create", "(", ");", "HttpParameters", ".", "Builder", "combinedParams", ";", "if", "(", "overwrite", ")", "{", "if", "(", "previousParams", "!", "=", "null", ")", "{", "combinedParams", "=", "combinedParams", ".", "withParent", "(", "previousParams", ")", ";", "}", "if", "(", "newParams", "!", "=", "null", ")", "{", "combinedParams", "=", "combinedParams", ".", "withExtraParams", "(", "newParams", ")", ";", "}", "combinedParams", "=", "HttpParameters", ".", "create", "(", ").", "withParent", "(", "previousParams", ")", ";", "combinedParams", "=", "combinedParams", ".", "withExtraParams", "(", "newParams", ")", ";", "}", "else", "{", "if", "(", "newParams", "!", "=", "null", ")", "{", "combinedParams", "=", "combinedParams", ".", "withExtraParams", "(", "newParams", ")", ";", "}", "if", "(", "previousParams", "!", "=", "null", ")", "{", "combinedParams", "=", "combinedParams", ".", "withParent", "(", "previousParams", ")", ";", "}", "combinedParams", "=", "HttpParameters", ".", "create", "(", "newParams", ")", ";", "combinedParams", "=", "combinedParams", ".", "withExtraParams", "(", "previousParams", ")", ";", "}", "ac", ".", "setParameters", "(", "combinedParams", ".", "build", "(", "))", ";", "}", "@", "@", "-", "192", ",", "7", "+", "192", ",", "11", "@", "@", "public", "HttpParameters", "build", "(", ")", "{", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "requestParameterMap", ".", "entrySet", "(", "))", "{", "String", "name", "=", "entry", ".", "getKey", "(", ");", "Object", "value", "=", "entry", ".", "getValue", "(", ");", "parameters", ".", "put", "(", "name", ",", "new", "Parameter", ".", "Request", "(", "name", ",", "value", ")", ");", "if", "(", "value", "instanceof", "Parameter", ")", "{", "parameters", ".", "put", "(", "name", ",", "(", "Parameter", ")", "value", ")", ";", "}", "else", "{", "parameters", ".", "put", "(", "name", ",", "new", "Parameter", ".", "Request", "(", "name", ",", "value", ")", ");", "}", "}", "return", "new", "HttpParameters", "(", "parameters", ")", ";", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "mock", ".", "MockActionProxy", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "HttpParameters", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "@", "@", "-", "139", ",", "6", "+", "140", ",", "51", "@", "@", "public", "void", "testNoMerge", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "0", ",", "ActionContext", ".", "getContext", "(", ").", "getParameters", "(", ").", "keySet", "(", ").", "size", "(", "))", ";", "}", "public", "void", "testOverwrite", "(", ")", "throws", "Exception", "{", "MockActionInvocation", "mai", "=", "new", "MockActionInvocation", "(", ");", "MockActionProxy", "map", "=", "new", "MockActionProxy", "(", ");", "ActionConfig", "ac", "=", "new", "ActionConfig", ".", "Builder", "(", "\"\"", ",", "\"", "\",", "\"", "\")", ".", "addParam", "(", "\"", "name", "\"", ",", "\"", "${", "hero", "}", "\")", ".", "build", "(", ");", "map", ".", "setConfig", "(", "ac", ")", ";", "mai", ".", "setProxy", "(", "map", ")", ";", "mai", ".", "setAction", "(", "new", "SimpleFooAction", "(", "))", ";", "Map", "<", "String", ",", "String", ">", "existingParams", "=", "new", "HashMap", "<", ">(", ");", "existingParams", ".", "put", "(", "\"", "name", "\"", ",", "\"", "Akash", "\"", ");", "ActionContext", ".", "getContext", "(", ").", "setParameters", "(", "HttpParameters", ".", "create", "(", "existingParams", ")", ".", "build", "(", "))", ";", "int", "before", "=", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ").", "size", "(", ");", "interceptor", ".", "setOverwrite", "(", "\"", "true", "\"", ");", "interceptor", ".", "intercept", "(", "mai", ")", ";", "assertEquals", "(", "before", ",", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ").", "size", "(", "))", ";", "assertEquals", "(", "\"$", "{", "hero", "}", "\",", "ActionContext", ".", "getContext", "(", ").", "getParameters", "(", ").", "get", "(", "\"", "name", "\"", ").", "toString", "(", "))", ";", "}", "public", "void", "testNoOverwrite", "(", ")", "throws", "Exception", "{", "MockActionInvocation", "mai", "=", "new", "MockActionInvocation", "(", ");", "MockActionProxy", "map", "=", "new", "MockActionProxy", "(", ");", "ActionConfig", "ac", "=", "new", "ActionConfig", ".", "Builder", "(", "\"\"", ",", "\"", "\",", "\"", "\")", ".", "addParam", "(", "\"", "name", "\"", ",", "\"", "${", "hero", "}", "\")", ".", "build", "(", ");", "map", ".", "setConfig", "(", "ac", ")", ";", "mai", ".", "setProxy", "(", "map", ")", ";", "mai", ".", "setAction", "(", "new", "SimpleFooAction", "(", "))", ";", "mai", ".", "setInvocationContext", "(", "ActionContext", ".", "getContext", "(", "))", ";", "Map", "<", "String", ",", "String", ">", "existingParams", "=", "new", "HashMap", "<", ">(", ");", "existingParams", ".", "put", "(", "\"", "name", "\"", ",", "\"", "Akash", "\"", ");", "ActionContext", ".", "getContext", "(", ").", "setParameters", "(", "HttpParameters", ".", "create", "(", "existingParams", ")", ".", "build", "(", "))", ";", "int", "before", "=", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ").", "size", "(", ");", "interceptor", ".", "setOverwrite", "(", "\"", "false", "\"", ");", "interceptor", ".", "intercept", "(", "mai", ")", ";", "assertEquals", "(", "before", ",", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ").", "size", "(", "))", ";", "assertEquals", "(", "\"", "Akash", "\"", ",", "ActionContext", ".", "getContext", "(", ").", "getParameters", "(", ").", "get", "(", "\"", "name", "\"", ").", "toString", "(", "))", ";", "}", "public", "void", "testFewParametersParse", "(", ")", "throws", "Exception", "{", "MockActionInvocation", "mai", "=", "new", "MockActionInvocation", "(", ");", "MockActionProxy", "map", "=", "new", "MockActionProxy", "(", ");"], "docstring_tokens": ["sending", "specially", "crafted", "data"]}
{"contents": ["Expand", "HTTP/2", "timeout", "handling", "to", "connection", "window", "exhaustion", "on", "write."], "code_tokens": ["@", "@", "-", "801", ",", "7", "+", "801", ",", "26", "@", "@", "int", "reserveWindowSize", "(", "Stream", "stream", ",", "int", "reservation", ",", "boolean", "block", ")", "throws", "IOEx", "if", "(", "allocation", "=", "=", "0", ")", "{", "if", "(", "block", ")", "{", "try", "{", "stream", ".", "wait", "(", ");", "/", "/", "Connection", "level", "window", "is", "empty", ".", "Although", "this", "/", "/", "request", "is", "for", "a", "stream", ",", "use", "the", "connection", "/", "/", "timeout", "long", "writeTimeout", "=", "protocol", ".", "getWriteTimeout", "(", ");", "if", "(", "writeTimeout", "<", "0", ")", "{", "stream", ".", "wait", "(", ");", "}", "else", "{", "stream", ".", "wait", "(", "writeTimeout", ")", ";", "}", "/", "/", "Has", "this", "stream", "been", "granted", "an", "allocation", "int", "[", "]", "value", "=", "backLogStreams", ".", "get", "(", "stream", ")", ";", "if", "(", "value", "[", "1", "]", "=", "=", "0", ")", "{", "/", "/", "No", "allocation", "/", "/", "Close", "the", "connection", ".", "Do", "this", "first", "since", "/", "/", "closing", "the", "stream", "will", "raise", "an", "exception", "close", "(", ");", "/", "/", "Close", "the", "stream", "(", "in", "app", "code", "so", "need", "to", "/", "/", "signal", "to", "app", "stream", "is", "closing", ")", "stream", ".", "doWriteTimeout", "(", ");", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "IOException", "(", "sm", ".", "getString", "(", "\"", "upgradeHandler", ".", "windowSizeReservationInterrupted", "\"", ",", "connectionId", ",", "@", "@", "-", "1024", ",", "11", "+", "1043", ",", "20", "@", "@", "private", "Stream", "createLocalStream", "(", "Request", "request", ")", "{", "private", "void", "close", "(", ")", "{", "connectionState", ".", "set", "(", "ConnectionState", ".", "CLOSED", ")", ";", "ConnectionState", "previous", "=", "connectionState", ".", "getAndSet", "(", "ConnectionState", ".", "CLOSED", ")", ";", "if", "(", "previous", "=", "=", "ConnectionState", ".", "CLOSED", ")", "{", "/", "/", "Already", "closed", "return", ";", "}", "for", "(", "Stream", "stream", ":", "streams", ".", "values", "(", "))", "{", "/", "/", "The", "connection", "is", "closing", ".", "Close", "the", "associated", "streams", "as", "no", "/", "/", "longer", "required", ".", "stream", ".", "receiveReset", "(", "Http2Error", ".", "CANCEL", ".", "getCode", "(", "))", ";", "/", "/", "Release", "any", "streams", "waiting", "for", "an", "allocation", "synchronized", "(", "stream", ")", "{", "stream", ".", "notifyAll", "(", ");", "}", "}", "try", "{", "socketWrapper", ".", "close", "(", ");", "@", "@", "-", "283", ",", "17", "+", "283", ",", "7", "@", "@", "final", "synchronized", "int", "reserveWindowSize", "(", "int", "reservation", ",", "boolean", "block", ")", "}", "windowSize", "=", "getWindowSize", "(", ");", "if", "(", "windowSize", "=", "=", "0", ")", "{", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "writeTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Prevent", "the", "application", "making", "further", "writes", "streamOutputBuffer", ".", "closed", "=", "true", ";", "/", "/", "Prevent", "Tomcat", "'", "s", "error", "handling", "trying", "to", "write", "coyoteResponse", ".", "setError", "(", ");", "coyoteResponse", ".", "setErrorReported", "(", ");", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";", "doWriteTimeout", "(", ");", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "/", "/", "Possible", "shutdown", "/", "rst", "or", "similar", ".", "Use", "an", "IOException", "to", "@", "@", "-", "316", ",", "6", "+", "306", ",", "21", "@", "@", "final", "synchronized", "int", "reserveWindowSize", "(", "int", "reservation", ",", "boolean", "block", ")", "}", "void", "doWriteTimeout", "(", ")", "throws", "CloseNowException", "{", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "writeTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Prevent", "the", "application", "making", "further", "writes", "streamOutputBuffer", ".", "closed", "=", "true", ";", "/", "/", "Prevent", "Tomcat", "'", "s", "error", "handling", "trying", "to", "write", "coyoteResponse", ".", "setError", "(", ");", "coyoteResponse", ".", "setErrorReported", "(", ");", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";", "}", "@", "Override", "public", "final", "void", "emitHeader", "(", "String", "name", ",", "String", "value", ")", "throws", "HpackException", "{", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "{", "@", "@", "-", "171", ",", "6", "+", "171", ",", "10", "@", "@", "for", "possible", "use", "with", "an", "asynchronous", "workflow", "like", "CompletableFuture", ".", "(", "remm", ")", "<", "/", "update", ">", "<", "fix", ">", "Expand", "HTTP", "/", "2", "timeout", "handling", "to", "include", "connection", "window", "exhaustion", "on", "write", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">"], "docstring_tokens": ["failing", "to", "send", "WINDOW_UPDATE", "messages"]}
{"contents": ["sctp:", "fix", "to", "calc", "the", "INIT/INIT-ACK", "chunk", "length", "correctly", "is", "set", "When", "calculating", "the", "INIT/INIT-ACK", "chunk", "length,", "we", "should", "not", "only", "account", "the", "length", "of", "parameters,", "but", "also", "the", "parameters", "zero", "padding", "length,", "such", "as", "AUTH", "HMACS", "parameter", "and", "CHUNKS", "parameter.", "Without", "the", "parameters", "zero", "padding", "length", "we", "may", "get", "following", "oops.", "skb_over_panic:", "text:ce2068d2", "len:130", "put:6", "head:cac3fe00", "data:cac3fe00", "tail:0xcac3fe82", "end:0xcac3fe80", "dev:<NULL>", "------------[", "cut", "here", "]------------", "kernel", "BUG", "at", "net/core/skbuff.c:127!", "invalid", "opcode:", "0000", "[#2]", "SMP", "last", "sysfs", "file:", "/sys/module/aes_generic/initstate", "Modules", "linked", "in:", "authenc", "......", "Pid:", "4102,", "comm:", "sctp_darn", "Tainted:", "G", "D", "2.6.34-rc2", "#6", "EIP:", "0060:[<c0607630>]", "EFLAGS:", "00010282", "CPU:", "0", "EIP", "is", "at", "skb_over_panic+0x37/0x3e", "EAX:", "00000078", "EBX:", "c07c024b", "ECX:", "c07c02b9", "EDX:", "cb607b78", "ESI:", "00000000", "EDI:", "cac3fe7a", "EBP:", "00000002", "ESP:", "cb607b74", "DS:", "007b", "ES:", "007b", "FS:", "00d8", "GS:", "0033", "SS:", "0068", "Process", "sctp_darn", "(pid:", "4102,", "ti=cb607000", "task=cabdc990", "task.ti=cb607000)", "Stack:", "c07c02b9", "ce2068d2", "00000082", "00000006", "cac3fe00", "cac3fe00", "cac3fe82", "cac3fe80", "<0>", "c07c024b", "cac3fe7c", "cac3fe7a", "c0608dec", "ca986e80", "ce2068d2", "00000006", "0000007a", "<0>", "cb8120ca", "ca986e80", "cb812000", "00000003", "cb8120c4", "ce208a25", "cb8120ca", "cadd9400", "Call", "Trace:", "[<ce2068d2>]", "?", "sctp_addto_chunk+0x45/0x85", "[sctp]", "[<c0608dec>]", "?", "skb_put+0x2e/0x32", "[<ce2068d2>]", "?", "sctp_addto_chunk+0x45/0x85", "[sctp]", "[<ce208a25>]", "?", "sctp_make_init+0x279/0x28c", "[sctp]", "[<c0686a92>]", "?", "apic_timer_interrupt+0x2a/0x30", "[<ce1fdc0b>]", "?", "sctp_sf_do_prm_asoc+0x2b/0x7b", "[sctp]", "[<ce202823>]", "?", "sctp_do_sm+0xa0/0x14a", "[sctp]", "[<ce2133b9>]", "?", "sctp_pname+0x0/0x14", "[sctp]", "[<ce211d72>]", "?", "sctp_primitive_ASSOCIATE+0x2b/0x31", "[sctp]", "[<ce20f3cf>]", "?", "sctp_sendmsg+0x7a0/0x9eb", "[sctp]", "[<c064eb1e>]", "?", "inet_sendmsg+0x3b/0x43", "[<c04244b7>]", "?", "task_tick_fair+0x2d/0xd9", "[<c06031e1>]", "?", "sock_sendmsg+0xa7/0xc1", "[<c0416afe>]", "?", "smp_apic_timer_interrupt+0x6b/0x75", "[<c0425123>]", "?", "dequeue_task_fair+0x34/0x19b", "[<c0446abb>]", "?", "sched_clock_local+0x17/0x11e", "[<c052ea87>]", "?", "_copy_from_user+0x2b/0x10c", "[<c060ab3a>]", "?", "verify_iovec+0x3c/0x6a", "[<c06035ca>]", "?", "sys_sendmsg+0x186/0x1e2", "[<c042176b>]", "?", "__wake_up_common+0x34/0x5b", "[<c04240c2>]", "?", "__wake_up+0x2c/0x3b", "[<c057e35c>]", "?", "tty_wakeup+0x43/0x47", "[<c04430f2>]", "?", "remove_wait_queue+0x16/0x24", "[<c0580c94>]", "?", "n_tty_read+0x5b8/0x65e", "[<c042be02>]", "?", "default_wake_function+0x0/0x8", "[<c0604e0e>]", "?", "sys_socketcall+0x17f/0x1cd", "[<c040264c>]", "?", "sysenter_do_call+0x12/0x22", "Code:", "0f", "45", "de", "53", "ff", "b0", "98", "00", "00", "00", "ff", "b0", "94", "......", "EIP:", "[<c0607630>]", "skb_over_panic+0x37/0x3e", "SS:ESP", "0068:cb607b74", "To", "reproduce:", "#", "modprobe", "sctp", "#", "echo", "1", ">", "/proc/sys/net/sctp/addip_enable", "#", "echo", "1", ">", "/proc/sys/net/sctp/auth_enable", "#", "sctp_test", "-H", "3ffe:501:ffff:100:20c:29ff:fe4d:f37e", "-P", "800", "-l", "#", "sctp_darn", "-H", "3ffe:501:ffff:100:20c:29ff:fe4d:f37e", "-P", "900", "-h", "192.168.0.21", "-p", "800", "-I", "-s", "-t", "sctp_darn", "ready", "to", "send...", "3ffe:501:ffff:100:20c:29ff:fe4d:f37e:900-192.168.0.21:800", "Interactive", "mode>", "bindx-add=192.168.0.21", "3ffe:501:ffff:100:20c:29ff:fe4d:f37e:900-192.168.0.21:800", "Interactive", "mode>", "bindx-add=192.168.1.21", "3ffe:501:ffff:100:20c:29ff:fe4d:f37e:900-192.168.0.21:800", "Interactive", "mode>", "snd=10", "------------------------------------------------------------------", "eth0", "has", "addresses:", "3ffe:501:ffff:100:20c:29ff:fe4d:f37e", "and", "192.168.0.21", "eth1", "has", "addresses:", "192.168.1.21", "------------------------------------------------------------------", "Reported-by:", "George", "Cheimonidis", "<gchimon@gmail.com>", "Signed-off-by:", "Wei", "Yongjun", "<yjwei@cn.fujitsu.com>", "Signed-off-by:", "Vlad", "Yasevich", "<vladislav.yasevich@hp.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "208", ",", "7", "+", "208", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "sp", "=", "sctp_sk", "(", "asoc", "-", ">", "base", ".", "sk", ")", ";", "num_types", "=", "sp", "-", ">", "pf", "-", ">", "supported_addrs", "(", "sp", ",", "types", ")", ";", "chunksize", "=", "sizeof", "(", "init", ")", "+", "addrs_len", "+", "SCTP_SAT_LEN", "(", "num_types", ")", ";", "chunksize", "=", "sizeof", "(", "init", ")", "+", "addrs_len", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "SCTP_SAT_LEN", "(", "num_types", ")", ");", "chunksize", "+", "=", "sizeof", "(", "ecap_param", ")", ";", "if", "(", "sctp_prsctp_enable", ")", "@", "@", "-", "238", ",", "14", "+", "239", ",", "14", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "/", "*", "Add", "HMACS", "parameter", "length", "if", "any", "were", "defined", "*", "/", "auth_hmacs", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_hmacs", ";", "if", "(", "auth_hmacs", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ");", "else", "auth_hmacs", "=", "NULL", ";", "/", "*", "Add", "CHUNKS", "parameter", "length", "*", "/", "auth_chunks", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_chunks", ";", "if", "(", "auth_chunks", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ");", "else", "auth_chunks", "=", "NULL", ";", "@", "@", "-", "255", ",", "7", "+", "256", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "/", "*", "If", "we", "have", "any", "extensions", "to", "report", ",", "account", "for", "that", "*", "/", "if", "(", "num_ext", ")", "chunksize", "+", "=", "sizeof", "(", "sctp_supported_ext_param_t", ")", "+", "num_ext", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "sizeof", "(", "sctp_supported_ext_param_t", ")", "num_ext", ")", ";", "/", "*", "RFC", "2960", "3", ".", "3", ".", "2", "Initiation", "(", "INIT", ")", "(", "1", ")", "*", "@", "@", "-", "397", ",", "13", "+", "399", ",", "13", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init_ack", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "auth_hmacs", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_hmacs", ";", "if", "(", "auth_hmacs", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ");", "else", "auth_hmacs", "=", "NULL", ";", "auth_chunks", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_chunks", ";", "if", "(", "auth_chunks", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ");", "else", "auth_chunks", "=", "NULL", ";", "@", "@", "-", "412", ",", "7", "+", "414", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init_ack", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "}", "if", "(", "num_ext", ")", "chunksize", "+", "=", "sizeof", "(", "sctp_supported_ext_param_t", ")", "+", "num_ext", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "sizeof", "(", "sctp_supported_ext_param_t", ")", "num_ext", ")", ";", "/", "*", "Now", "allocate", "and", "fill", "out", "the", "chunk", ".", "*", "/", "retval", "=", "sctp_make_chunk", "(", "asoc", ",", "SCTP_CID_INIT_ACK", ",", "0", ",", "chunksize", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "packet"]}
{"contents": ["media:", "usbtv:", "prevent", "double", "free", "in", "error", "case", "Quoting", "the", "original", "report:", "It", "looks", "like", "there", "is", "a", "double-free", "vulnerability", "in", "Linux", "usbtv", "driver", "on", "an", "error", "path", "of", "usbtv_probe", "function.", "When", "audio", "registration", "fails,", "usbtv_video_free", "function", "ends", "up", "freeing", "usbtv", "data", "structure,", "which", "gets", "freed", "the", "second", "time", "under", "usbtv_video_fail", "label.", "usbtv_audio_fail:", "usbtv_video_free(usbtv);", "=>", "v4l2_device_put(&usbtv->v4l2_dev);", "=>", "v4l2_device_put", "=>", "kref_put", "=>", "v4l2_device_release", "=>", "usbtv_release", "(CALLBACK)", "=>", "kfree(usbtv)", "(1st", "time)", "usbtv_video_fail:", "usb_set_intfdata(intf,", "NULL);", "usb_put_dev(usbtv->udev);", "kfree(usbtv);", "(2nd", "time)", "So,", "as", "we", "have", "refcounting,", "use", "it", "Reported-by:", "Yavuz,", "Tuba", "<tuba@ece.ufl.edu>", "Signed-off-by:", "Oliver", "Neukum", "<oneukum@suse.com>", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Hans", "Verkuil", "<hans.verkuil@cisco.com>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@s-opensource.com>"], "code_tokens": ["@", "@", "-", "112", ",", "6", "+", "112", ",", "8", "@", "@", "static", "int", "usbtv_probe", "(", "struct", "usb_interface", "*", "intf", ",", "return", "0", ";", "usbtv_audio_fail", ":", "/", "*", "we", "must", "not", "free", "at", "this", "point", "*", "/", "usb_get_dev", "(", "usbtv", "-", ">", "udev", ")", ";", "usbtv_video_free", "(", "usbtv", ")", ";", "usbtv_video_fail", ":"], "docstring_tokens": ["triggering", "failure", "of", "audio", "registration"]}
{"contents": ["binfmt_elf:", "switch", "to", "new", "creds", "when", "switching", "to", "new", "mm", "We", "used", "to", "delay", "switching", "to", "the", "new", "credentials", "until", "after", "we", "had", "mapped", "the", "executable", "(and", "possible", "elf", "interpreter).", "That", "was", "kind", "of", "odd", "to", "begin", "with,", "since", "the", "new", "executable", "will", "actually", "then", "_run_", "with", "the", "new", "creds,", "but", "whatever.", "The", "bigger", "problem", "was", "that", "we", "also", "want", "to", "make", "sure", "that", "we", "turn", "off", "prof", "events", "and", "tracing", "before", "we", "start", "mapping", "the", "new", "executable", "state.", "So", "while", "this", "is", "a", "cleanup,", "it's", "also", "a", "fix", "for", "a", "possible", "information", "leak.", "Reported-by:", "Robert", "\u015awi\u0119cki", "<robert@swiecki.net>", "Tested-by:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Acked-by:", "David", "Howells", "<dhowells@redhat.com>", "Acked-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Acked-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Acked-by:", "Eric", "W.", "Biederman", "<ebiederm@xmission.com>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Cc:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "853", ",", "6", "+", "853", ",", "7", "@", "@", "static", "int", "load_elf_binary", "(", "struct", "linux_binprm", "*", "bprm", ")", "current", "-", ">", "flags", "|", "=", "PF_RANDOMIZE", ";", "setup_new_exec", "(", "bprm", ")", ";", "install_exec_creds", "(", "bprm", ")", ";", "/", "*", "Do", "this", "so", "that", "we", "can", "load", "the", "interpreter", ",", "if", "need", "be", ".", "We", "will", "change", "some", "of", "these", "later", "*", "/", "@", "@", "-", "1044", ",", "7", "+", "1045", ",", "6", "@", "@", "static", "int", "load_elf_binary", "(", "struct", "linux_binprm", "*", "bprm", ")", "goto", "out", ";", "#", "endif", "/", "*", "ARCH_HAS_SETUP_ADDITIONAL_PAGES", "*", "/", "install_exec_creds", "(", "bprm", ")", ";", "retval", "=", "create_elf_tables", "(", "bprm", ",", "&", "loc", "-", ">", "elf_ex", ",", "load_addr", ",", "interp_load_addr", ")", ";", "if", "(", "retval", "<", "0", ")"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Implement", "nesting", "guard", "to", "avoid", "\"out", "of", "stack", "space\"", "Note", "that", "this", "limit", "is", "not", "an", "exact", "science", "it", "depends", "on", "various", "factors,", "which", "some", "are", "not", "under", "our", "control", "(compile", "time", "or", "even", "OS", "dependent", "settings", "on", "the", "available", "stack", "size)", "It", "should", "fix", "most", "common", "segfault", "cases", "though."], "code_tokens": ["@", "@", "-", "29", ",", "6", "+", "29", ",", "11", "@", "@", "class", "LocalOption", "{", "}", ";", "#", "define", "LOCAL_FLAG", "(", "name", ",", "opt", ")", "LocalOption", "<", "bool", ">", "flag_", "#", "#", "name", "(", "name", ",", "opt", ")", "#", "define", "LOCAL_COUNT", "(", "name", ",", "opt", ")", "LocalOption", "<", "size_t", ">", "cnt_", "#", "#", "name", "(", "name", ",", "opt", ")", "#", "define", "NESTING_GUARD", "(", "name", ")", "\\", "LocalOption", "<", "size_t", ">", "cnt_", "#", "#", "name", "(", "name", ",", "name", "+", "1", ")", ";", "\\", "if", "(", "nestings", ">", "MAX_NESTING", ")", "throw", "Exception", ":", ":", "NestingLimitError", "(", "pstate", ")", ";", "\\", "#", "define", "ATTACH_OPERATIONS", "(", ")\\", "virtual", "void", "perform", "(", "Operation", "<", "void", ">", "*", "op", ")", "{", "(", "*", "op", ")", "(", "this", ")", ";", "}", "\\", "@", "@", "-", "59", ",", "6", "+", "59", ",", "10", "@", "@", "namespace", "Sass", "{", ":", "Base", "(", "pstate", ",", "msg", ",", "import_stack", ")", "{", "}", "NestingLimitError", ":", ":", "NestingLimitError", "(", "ParserState", "pstate", ",", "std", ":", ":", "string", "msg", ",", "std", ":", ":", "vector", "<", "Sass_Import_Entry", ">", "*", "import_stack", ")", ":", "Base", "(", "pstate", ",", "msg", ",", "import_stack", ")", "{", "}", "UndefinedOperation", ":", ":", "UndefinedOperation", "(", "Expression_Ptr_Const", "lhs", ",", "Expression_Ptr_Const", "rhs", ",", "const", "std", ":", ":", "string", "&", "op", ")", ":", "lhs", "(", "lhs", ")", ",", "rhs", "(", "rhs", ")", ",", "op", "(", "op", ")", "{", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "namespace", "Sass", "{", "const", "std", ":", ":", "string", "def_msg", "=", "\"", "Invalid", "sass", "detected", "\"", ";", "const", "std", ":", ":", "string", "def_op_msg", "=", "\"", "Undefined", "operation", "\"", ";", "const", "std", ":", ":", "string", "def_op_null_msg", "=", "\"", "Invalid", "null", "operation", "\"", ";", "const", "std", ":", ":", "string", "def_nesting_limit", "=", "\"", "Code", "too", "deeply", "neested", "\"", ";", "class", "Base", ":", "public", "std", ":", ":", "runtime_error", "{", "protected", ":", "@", "@", "-", "83", ",", "6", "+", "84", ",", "12", "@", "@", "namespace", "Sass", "{", "virtual", "~", "InvalidSyntax", "(", ")", "throw", "(", ")", "{", "};", "}", ";", "class", "NestingLimitError", ":", "public", "Base", "{", "public", ":", "NestingLimitError", "(", "ParserState", "pstate", ",", "std", ":", ":", "string", "msg", "=", "def_nesting_limit", ",", "std", ":", ":", "vector", "<", "Sass_Import_Entry", ">", "*", "import_stack", "=", "0", ")", ";", "virtual", "~", "NestingLimitError", "(", ")", "throw", "(", ")", "{", "};", "}", ";", "/", "*", "common", "virtual", "base", "class", "(", "has", "no", "pstate", ")", "*", "/", "class", "OperationError", ":", "public", "std", ":", ":", "runtime_error", "{", "protected", ":", "@", "@", "-", "503", ",", "6", "+", "503", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "a", "ruleset", "connects", "a", "selector", "and", "a", "block", "Ruleset_Obj", "Parser", ":", ":", "parse_ruleset", "(", "Lookahead", "lookahead", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "inherit", "is_root", "from", "parent", "block", "Block_Obj", "parent", "=", "block_stack", ".", "back", "(", ");", "bool", "is_root", "=", "parent", "&", "&", "parent", "-", ">", "is_root", "(", ");", "@", "@", "-", "535", ",", "6", "+", "536", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "in", "the", "eval", "stage", "we", "will", "be", "re", "-", "parse", "it", "into", "an", "actual", "selector", "Selector_Schema_Obj", "Parser", ":", ":", "parse_selector_schema", "(", "const", "char", "*", "end_of_selector", ",", "bool", "chroot", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "move", "up", "to", "the", "start", "lex", "<", "optional_spaces", ">", "()", ";", "const", "char", "*", "i", "=", "position", ";", "@", "@", "-", "646", ",", "6", "+", "648", ",", "7", "@", "@", "namespace", "Sass", "{", "{", "bool", "reloop", ";", "bool", "had_linefeed", "=", "false", ";", "NESTING_GUARD", "(", "nestings", ")", ";", "Complex_Selector_Obj", "sel", ";", "Selector_List_Obj", "group", "=", "SASS_MEMORY_NEW", "(", "Selector_List", ",", "pstate", ")", ";", "group", "-", ">", "media_block", "(", "last_media_block", ")", ";", "@", "@", "-", "700", ",", "6", "+", "703", ",", "7", "@", "@", "namespace", "Sass", "{", "Complex_Selector_Obj", "Parser", ":", ":", "parse_complex_selector", "(", "bool", "chroot", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "String_Obj", "reference", "=", "0", ";", "lex", "<", "block_comment", ">", "()", ";", "advanceToNextToken", "(", ");", "@", "@", "-", "1055", ",", "6", "+", "1059", ",", "7", "@", "@", "namespace", "Sass", "{", "Expression_Obj", "Parser", ":", ":", "parse_map", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "Expression_Obj", "key", "=", "parse_list", "(", ");", "List_Obj", "map", "=", "SASS_MEMORY_NEW", "(", "List", ",", "pstate", ",", "0", ",", "SASS_HASH", ")", ";", "@", "@", "-", "1098", ",", "6", "+", "1103", ",", "7", "@", "@", "namespace", "Sass", "{", "Expression_Obj", "Parser", ":", ":", "parse_bracket_list", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "check", "if", "we", "have", "an", "empty", "list", "/", "/", "return", "the", "empty", "list", "as", "such", "if", "(", "peek_css", "<", "list_terminator", ">", "(", "position", ")", ")", "@", "@", "-", "1144", ",", "12", "+", "1150", ",", "14", "@", "@", "namespace", "Sass", "{", "/", "/", "so", "to", "speak", ":", "we", "unwrap", "items", "from", "lists", "if", "possible", "here", "!", "Expression_Obj", "Parser", ":", ":", "parse_list", "(", "bool", "delayed", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "return", "parse_comma_list", "(", "delayed", ")", ";", "}", "/", "/", "will", "return", "singletons", "unwrapped", "Expression_Obj", "Parser", ":", ":", "parse_comma_list", "(", "bool", "delayed", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "check", "if", "we", "have", "an", "empty", "list", "/", "/", "return", "the", "empty", "list", "as", "such", "if", "(", "peek_css", "<", "list_terminator", ">", "(", "position", ")", ")", "@", "@", "-", "1189", ",", "6", "+", "1197", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "will", "return", "singletons", "unwrapped", "Expression_Obj", "Parser", ":", ":", "parse_space_list", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "Expression_Obj", "disj1", "=", "parse_disjunction", "(", ");", "/", "/", "if", "it", "'", "s", "a", "singleton", ",", "return", "it", "(", "don", "'", "t", "wrap", "it", ")", "if", "(", "peek_css", "<", "space_list_terminator", ">", "(", "position", ")", "@", "@", "-", "1213", ",", "6", "+", "1222", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "logical", "OR", "operation", "Expression_Obj", "Parser", ":", ":", "parse_disjunction", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parse", "the", "left", "hand", "side", "conjunction", "@", "@", "-", "1234", ",", "6", "+", "1244", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "logical", "AND", "operation", "Expression_Obj", "Parser", ":", ":", "parse_conjunction", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parse", "the", "left", "hand", "side", "relation", "@", "@", "-", "1256", ",", "6", "+", "1267", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "comparison", "operations", "Expression_Obj", "Parser", ":", ":", "parse_relation", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parse", "the", "left", "hand", "side", "expression", "@", "@", "-", "1308", ",", "6", "+", "1320", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "addition", "and", "subtraction", "operations", "Expression_Obj", "Parser", ":", ":", "parse_expression", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parses", "multiple", "add", "and", "subtract", "operations", "@", "@", "-", "1351", ",", "6", "+", "1364", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "addition", "and", "subtraction", "operations", "Expression_Obj", "Parser", ":", ":", "parse_operators", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "Expression_Obj", "factor", "=", "parse_factor", "(", ");", "@", "@", "-", "1383", ",", "6", "+", "1397", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "called", "from", "parse_value_schema", "Expression_Obj", "Parser", ":", ":", "parse_factor", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "lex", "<", "css_comments", ">", "(", "false", ")", ";", "if", "(", "lex_css", "<", "exactly", "<", "'(", "'>", ">", "()", ")", "{", "/", "/", "parse_map", "may", "return", "a", "list", "@", "@", "-", "10", ",", "6", "+", "10", ",", "15", "@", "@", "#", "include", "\"", "position", ".", "hpp", "\"", "#", "include", "\"", "prelexer", ".", "hpp", "\"", "#", "ifndef", "MAX_NESTING", "/", "/", "Note", "that", "this", "limit", "is", "not", "an", "exact", "science", "/", "/", "it", "depends", "on", "various", "factors", ",", "which", "some", "are", "/", "/", "not", "under", "our", "control", "(", "compile", "time", "or", "even", "OS", "/", "/", "dependent", "settings", "on", "the", "available", "stack", "size", ")", "/", "/", "It", "should", "fix", "most", "common", "segfault", "cases", "though", ".", "#", "define", "MAX_NESTING", "512", "#", "endif", "struct", "Lookahead", "{", "const", "char", "*", "found", ";", "const", "char", "*", "error", ";", "@", "@", "-", "35", ",", "13", "+", "44", ",", "14", "@", "@", "namespace", "Sass", "{", "Position", "before_token", ";", "Position", "after_token", ";", "ParserState", "pstate", ";", "int", "indentation", ";", "size_t", "indentation", ";", "size_t", "nestings", ";", "Token", "lexed", ";", "Parser", "(", "Context", "&", "ctx", ",", "const", "ParserState", "&", "pstate", ")", ":", "ParserState", "(", "pstate", ")", ",", "ctx", "(", "ctx", ")", ",", "block_stack", "(", "),", "stack", "(", "0", ")", ",", "last_media_block", "(", "),", "source", "(", "0", ")", ",", "position", "(", "0", ")", ",", "end", "(", "0", ")", ",", "before_token", "(", "pstate", ")", ",", "after_token", "(", "pstate", ")", ",", "pstate", "(", "pstate", ")", ",", "indentation", "(", "0", ")", "source", "(", "0", ")", ",", "position", "(", "0", ")", ",", "end", "(", "0", ")", ",", "before_token", "(", "pstate", ")", ",", "after_token", "(", "pstate", ")", ",", "pstate", "(", "pstate", ")", ",", "indentation", "(", "0", ")", ",", "nestings", "(", "0", ")", "{", "stack", ".", "push_back", "(", "Scope", ":", ":", "Root", ")", ";", "}", "/", "/", "static", "Parser", "from_string", "(", "const", "std", ":", ":", "string", "&", "src", ",", "Context", "&", "ctx", ",", "ParserState", "pstate", "=", "ParserState", "(", "\"[", "STRING", "]", "\")", ");"], "docstring_tokens": ["using", "specially", "crafted", "input"]}
{"contents": ["[S390]", "user", "readable", "uninitialised", "kernel", "memory.", "A", "user", "space", "program", "can", "read", "uninitialised", "kernel", "memory", "by", "appending", "to", "a", "file", "from", "a", "bad", "address", "and", "then", "reading", "the", "result", "back.", "The", "cause", "is", "the", "copy_from_user", "function", "that", "does", "not", "clear", "the", "remaining", "bytes", "of", "the", "kernel", "buffer", "after", "it", "got", "a", "fault", "on", "the", "user", "space", "address.", "Signed-off-by:", "Martin", "Schwidefsky", "<schwidefsky@de.ibm.com>"], "code_tokens": ["@", "@", "-", "35", ",", "7", "+", "35", ",", "7", "@", "@", "size_t", "copy_from_user_mvcos", "(", "size_t", "size", ",", "const", "void", "__user", "*", "ptr", ",", "void", "*", "x", ")", "tmp1", "=", "-", "4096UL", ";", "asm", "volatile", "(", "\"", "0", ":", ".", "insn", "ss", ",", "0xc80000000000", ",", "0", "(", "%", "0", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",", "0", "\\", "n", "\"", "\"", "jz", "4f", "\\", "n", "\"", "\"", "jz", "7f", "\\", "n", "\"", "\"", "1", ":", "\"", "ALR", "\"", "%", "0", ",", "%", "3", "\\", "n", "\"", "\"", "\"", "SLR", "\"", "%", "1", ",", "%", "3", "\\", "n", "\"", "\"", "\"", "SLR", "\"", "%", "2", ",", "%", "3", "\\", "n", "\"", "@", "@", "-", "44", ",", "13", "+", "44", ",", "23", "@", "@", "size_t", "copy_from_user_mvcos", "(", "size_t", "size", ",", "const", "void", "__user", "*", "ptr", ",", "void", "*", "x", ")", "\"", "nr", "%", "4", ",", "%", "3", "\\", "n", "\"", "/", "*", "%", "4", "=", "(", "ptr", "+", "4095", ")", "&", "-", "4096", "*", "/", "\"", "\"", "SLR", "\"", "%", "4", ",", "%", "1", "\\", "n", "\"", "\"", "\"", "CLR", "\"", "%", "0", ",", "%", "4", "\\", "n", "\"", "/", "*", "copy", "crosses", "next", "page", "boundary", "?", "*", "/", "\"", "jnh", "5f", "\\", "n", "\"", "\"", "jnh", "4f", "\\", "n", "\"", "\"", "3", ":", ".", "insn", "ss", ",", "0xc80000000000", ",", "0", "(", "%", "4", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",", "0", "\\", "n", "\"", "\"", "\"", "SLR", "\"", "%", "0", ",", "%", "4", "\\", "n", "\"", "\"", "j", "5f", "\\", "n", "\"", "\"", "4", ":", "\"", "SLR", "\"", "%", "0", ",", "%", "0", "\\", "n", "\"", "\"", "5", ":", "\\", "n", "\"", "EX_TABLE", "(", "0b", ",", "2b", ")", "EX_TABLE", "(", "3b", ",", "5b", ")", "\"", "\"", "ALR", "\"", "%", "2", ",", "%", "4", "\\", "n", "\"", "\"", "4", ":", "\"", "LHI", "\"", "%", "4", ",", "-", "1", "\\", "n", "\"", "\"", "\"", "ALR", "\"", "%", "4", ",", "%", "0", "\\", "n", "\"", "/", "*", "copy", "remaining", "size", ",", "subtract", "1", "*", "/", "\"", "bras", "%", "3", ",", "6f", "\\", "n", "\"", "/", "*", "memset", "loop", "*", "/", "\"", "xc", "0", "(", "1", ",", "%", "2", ")", ",", "0", "(", "%", "2", ")", "\\", "n", "\"", "\"", "5", ":", "xc", "0", "(", "256", ",", "%", "2", ")", ",", "0", "(", "%", "2", ")", "\\", "n", "\"", "\"", "la", "%", "2", ",", "256", "(", "%", "2", ")", "\\", "n", "\"", "\"", "6", ":", "\"", "AHI", "\"", "%", "4", ",", "-", "256", "\\", "n", "\"", "\"", "jnm", "5b", "\\", "n", "\"", "\"", "ex", "%", "4", ",", "0", "(", "%", "3", ")", "\\", "n", "\"", "\"", "j", "8f", "\\", "n", "\"", "\"", "7", ":", "\"", "SLR", "\"", "%", "0", ",", "%", "0", "\\", "n", "\"", "\"", "8", ":", "\\", "n", "\"", "EX_TABLE", "(", "0b", ",", "2b", ")", "EX_TABLE", "(", "3b", ",", "4b", ")", ":", "\"", "+", "a", "\"", "(", "size", ")", ",", "\"", "+", "a", "\"", "(", "ptr", ")", ",", "\"", "+", "a", "\"", "(", "x", ")", ",", "\"", "+", "a", "\"", "(", "tmp1", ")", ",", "\"", "=", "a", "\"", "(", "tmp2", ")", ":", "\"", "d", "\"", "(", "reg0", ")", ":", "\"", "cc", "\"", ",", "\"", "memory", "\"", ");", "return", "size", ";", "@", "@", "-", "35", ",", "25", "+", "35", ",", "35", "@", "@", "size_t", "copy_from_user_std", "(", "size_t", "size", ",", "const", "void", "__user", "*", "ptr", ",", "void", "*", "x", ")", "tmp1", "=", "-", "256UL", ";", "asm", "volatile", "(", "\"", "0", ":", "mvcp", "0", "(", "%", "0", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",%", "3", "\\", "n", "\"", "\"", "jz", "5f", "\\", "n", "\"", "\"", "jz", "8f", "\\", "n", "\"", "\"", "1", ":", "\"", "ALR", "\"", "%", "0", ",", "%", "3", "\\", "n", "\"", "\"", "la", "%", "1", ",", "256", "(", "%", "1", ")", "\\", "n", "\"", "\"", "la", "%", "2", ",", "256", "(", "%", "2", ")", "\\", "n", "\"", "\"", "2", ":", "mvcp", "0", "(", "%", "0", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",%", "3", "\\", "n", "\"", "\"", "jnz", "1b", "\\", "n", "\"", "\"", "j", "5f", "\\", "n", "\"", "\"", "j", "8f", "\\", "n", "\"", "\"", "3", ":", "la", "%", "4", ",", "255", "(", "%", "1", ")", "\\", "n", "\"", "/", "*", "%", "4", "=", "ptr", "+", "255", "*", "/", "\"", "\"", "LHI", "\"", "%", "3", ",", "-", "4096", "\\", "n", "\"", "\"", "nr", "%", "4", ",", "%", "3", "\\", "n", "\"", "/", "*", "%", "4", "=", "(", "ptr", "+", "255", ")", "&", "-", "4096", "*", "/", "\"", "\"", "SLR", "\"", "%", "4", ",", "%", "1", "\\", "n", "\"", "\"", "\"", "CLR", "\"", "%", "0", ",", "%", "4", "\\", "n", "\"", "/", "*", "copy", "crosses", "next", "page", "boundary", "?", "*", "/", "\"", "jnh", "6f", "\\", "n", "\"", "\"", "jnh", "5f", "\\", "n", "\"", "\"", "4", ":", "mvcp", "0", "(", "%", "4", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",%", "3", "\\", "n", "\"", "\"", "\"", "SLR", "\"", "%", "0", ",", "%", "4", "\\", "n", "\"", "\"", "j", "6f", "\\", "n", "\"", "\"", "5", ":", "\"", "SLR", "\"", "%", "0", ",", "%", "0", "\\", "n", "\"", "\"", "6", ":", "\\", "n", "\"", "EX_TABLE", "(", "0b", ",", "3b", ")", "EX_TABLE", "(", "2b", ",", "3b", ")", "EX_TABLE", "(", "4b", ",", "6b", ")", "\"", "\"", "ALR", "\"", "%", "2", ",", "%", "4", "\\", "n", "\"", "\"", "5", ":", "\"", "LHI", "\"", "%", "4", ",", "-", "1", "\\", "n", "\"", "\"", "\"", "ALR", "\"", "%", "4", ",", "%", "0", "\\", "n", "\"", "/", "*", "copy", "remaining", "size", ",", "subtract", "1", "*", "/", "\"", "bras", "%", "3", ",", "7f", "\\", "n", "\"", "/", "*", "memset", "loop", "*", "/", "\"", "xc", "0", "(", "1", ",", "%", "2", ")", ",", "0", "(", "%", "2", ")", "\\", "n", "\"", "\"", "6", ":", "xc", "0", "(", "256", ",", "%", "2", ")", ",", "0", "(", "%", "2", ")", "\\", "n", "\"", "\"", "la", "%", "2", ",", "256", "(", "%", "2", ")", "\\", "n", "\"", "\"", "7", ":", "\"", "AHI", "\"", "%", "4", ",", "-", "256", "\\", "n", "\"", "\"", "jnm", "6b", "\\", "n", "\"", "\"", "ex", "%", "4", ",", "0", "(", "%", "3", ")", "\\", "n", "\"", "\"", "j", "9f", "\\", "n", "\"", "\"", "8", ":", "\"", "SLR", "\"", "%", "0", ",", "%", "0", "\\", "n", "\"", "\"", "9", ":", "\\", "n", "\"", "EX_TABLE", "(", "0b", ",", "3b", ")", "EX_TABLE", "(", "2b", ",", "3b", ")", "EX_TABLE", "(", "4b", ",", "5b", ")", ":", "\"", "+", "a", "\"", "(", "size", ")", ",", "\"", "+", "a", "\"", "(", "ptr", ")", ",", "\"", "+", "a", "\"", "(", "x", ")", ",", "\"", "+", "a", "\"", "(", "tmp1", ")", ",", "\"", "=", "a", "\"", "(", "tmp2", ")", ":", ":", "\"", "cc", "\"", ",", "\"", "memory", "\"", ");", "return", "size", ";", "@", "@", "-", "67", ",", "16", "+", "77", ",", "22", "@", "@", "size_t", "copy_from_user_std_small", "(", "size_t", "size", ",", "const", "void", "__user", "*", "ptr", ",", "void", "*", "x", ")", "asm", "volatile", "(", "\"", "0", ":", "mvcp", "0", "(", "%", "0", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",%", "3", "\\", "n", "\"", "\"", "\"", "SLR", "\"", "%", "0", ",", "%", "0", "\\", "n", "\"", "\"", "j", "3f", "\\", "n", "\"", "\"", "j", "5f", "\\", "n", "\"", "\"", "1", ":", "la", "%", "4", ",", "255", "(", "%", "1", ")", "\\", "n", "\"", "/", "*", "%", "4", "=", "ptr", "+", "255", "*", "/", "\"", "\"", "LHI", "\"", "%", "3", ",", "-", "4096", "\\", "n", "\"", "\"", "nr", "%", "4", ",", "%", "3", "\\", "n", "\"", "/", "*", "%", "4", "=", "(", "ptr", "+", "255", ")", "&", "-", "4096", "*", "/", "\"", "\"", "SLR", "\"", "%", "4", ",", "%", "1", "\\", "n", "\"", "\"", "\"", "CLR", "\"", "%", "0", ",", "%", "4", "\\", "n", "\"", "/", "*", "copy", "crosses", "next", "page", "boundary", "?", "*", "/", "\"", "jnh", "3f", "\\", "n", "\"", "\"", "jnh", "5f", "\\", "n", "\"", "\"", "2", ":", "mvcp", "0", "(", "%", "4", ",", "%", "2", ")", ",", "0", "(", "%", "1", ")", ",%", "3", "\\", "n", "\"", "\"", "\"", "SLR", "\"", "%", "0", ",", "%", "4", "\\", "n", "\"", "\"", "3", ":", "\\", "n", "\"", "\"", "\"", "ALR", "\"", "%", "2", ",", "%", "4", "\\", "n", "\"", "\"", "3", ":", "\"", "LHI", "\"", "%", "4", ",", "-", "1", "\\", "n", "\"", "\"", "\"", "ALR", "\"", "%", "4", ",", "%", "0", "\\", "n", "\"", "/", "*", "copy", "remaining", "size", ",", "subtract", "1", "*", "/", "\"", "bras", "%", "3", ",", "4f", "\\", "n", "\"", "\"", "xc", "0", "(", "1", ",", "%", "2", ")", ",", "0", "(", "%", "2", ")", "\\", "n", "\"", "\"", "4", ":", "ex", "%", "4", ",", "0", "(", "%", "3", ")", "\\", "n", "\"", "\"", "5", ":", "\\", "n", "\"", "EX_TABLE", "(", "0b", ",", "1b", ")", "EX_TABLE", "(", "2b", ",", "3b", ")", ":", "\"", "+", "a", "\"", "(", "size", ")", ",", "\"", "+", "a", "\"", "(", "ptr", ")", ",", "\"", "+", "a", "\"", "(", "x", ")", ",", "\"", "+", "a", "\"", "(", "tmp1", ")", ",", "\"", "=", "a", "\"", "(", "tmp2", ")", ":", ":", "\"", "cc", "\"", ",", "\"", "memory", "\"", ");"], "docstring_tokens": ["appending", "to", "a", "file", "from", "an", "invalid", "address"]}
{"contents": ["Update", "StaxInInterceptor", "to", "just", "create", "a", "html", "error", "message", "on", "the", "client", "side", "as", "the", "normal", "error", "handling", "works", "best", "on", "server", "side."], "code_tokens": ["@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "36", ",", "8", "+", "37", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "cxf", ".", "common", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "CastUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "HttpHeaderHelper", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "message", ".", "Message", ";", "import", "org", ".", "apache", ".", "cxf", ".", "message", ".", "MessageUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "phase", ".", "AbstractPhaseInterceptor", ";", "import", "org", ".", "apache", ".", "cxf", ".", "phase", ".", "Phase", ";", "import", "org", ".", "apache", ".", "cxf", ".", "staxutils", ".", "StaxUtils", ";", "@", "@", "-", "73", ",", "10", "+", "74", ",", "20", "@", "@", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "}", "String", "contentType", "=", "(", "String", ")", "message", ".", "get", "(", "Message", ".", "CONTENT_TYPE", ")", ";", "if", "(", "contentType", "!", "=", "null", "&", "&", "contentType", ".", "contains", "(", "\"", "text", "/", "html", "\"", "))", "{", "String", "htmlMessage", "=", "null", ";", "if", "(", "contentType", "!", "=", "null", "&", "&", "contentType", ".", "contains", "(", "\"", "text", "/", "html", "\"", ")", "&", "&", "MessageUtils", ".", "isRequestor", "(", "message", ")", ")", "{", "StringBuilder", "htmlMessage", "=", "new", "StringBuilder", "(", "1024", ")", ";", "try", "{", "htmlMessage", "=", "IOUtils", ".", "toString", "(", "is", ",", "500", ")", ";", "if", "(", "reader", "=", "=", "null", ")", "{", "reader", "=", "new", "InputStreamReader", "(", "is", ",", "(", "String", ")", "message", ".", "get", "(", "Message", ".", "ENCODING", ")", ");", "}", "char", "s", "[", "]", "=", "new", "char", "[", "1024", "]", ";", "int", "i", "=", "reader", ".", "read", "(", "s", ")", ";", "while", "(", "htmlMessage", ".", "length", "(", ")", "<", "64536", "&", "&", "i", ">", "0", ")", "{", "htmlMessage", ".", "append", "(", "s", ",", "0", ",", "i", ")", ";", "i", "=", "reader", ".", "read", "(", "s", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "Fault", "(", "new", "org", ".", "apache", ".", "cxf", ".", "common", ".", "i18n", ".", "Message", "(", "\"", "INVALID_HTML_RESPONSETYPE", "\"", ",", "LOG", ",", "\"", "(", "none", ")", "\")", ");"], "docstring_tokens": ["via", "a", "large", "request", "with", "the", "Content-Type", "set", "to", "text/html", "to", "a", "SOAP", "endpoint"]}
{"contents": ["[FLINK-16697][metrics][jmx]", "Disable", "rebinding"], "code_tokens": ["@", "@", "-", "41", ",", "20", "+", "41", ",", "24", "@", "@", "import", "javax", ".", "management", ".", "NotCompliantMBeanException", ";", "import", "javax", ".", "management", ".", "ObjectName", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServerFactory", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXServiceURL", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIJRMPServerImpl", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "management", ".", "ManagementFactory", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "rmi", ".", "NoSuchObjectException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "/", "**", "*", "{", "@", "link", "MetricReporter", "}", "that", "exports", "{", "@", "link", "Metric", "Metrics", "}", "via", "JMX", ".", "@", "@", "-", "469", ",", "42", "+", "473", ",", "31", "@", "@", "public", "long", "getCount", "(", ")", "{", "/", "**", "*", "JMX", "Server", "implementation", "that", "JMX", "clients", "can", "connect", "to", ".", "*", "*", "<", "p", ">", "Heavily", "based", "on", "j256", "simplejmx", "project", "*", "<", "p", ">", "Originally", "based", "on", "j256", "simplejmx", "project", "*", "*", "<", "p", ">", "https", ":", "//", "github", ".", "com", "/", "j256", "/", "simplejmx", "/", "blob", "/", "master", "/", "src", "/", "main", "/", "java", "/", "com", "/", "j256", "/", "simplejmx", "/", "server", "/", "JmxServer", ".", "java", "*", "/", "private", "static", "class", "JMXServer", "{", "private", "Registry", "rmiRegistry", ";", "private", "JMXConnectorServer", "connector", ";", "private", "int", "port", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "rmiServerReference", "=", "new", "AtomicReference", "<", ">(", ");", "public", "void", "start", "(", "int", "port", ")", "throws", "IOException", "{", "if", "(", "rmiRegistry", "!", "=", "null", "&", "&", "connector", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "JMXServer", "is", "already", "running", ".", "\")", ";", "return", ";", "}", "startRmiRegistry", "(", "port", ")", ";", "startJmxService", "(", "port", ")", ";", "internalStart", "(", "port", ")", ";", "this", ".", "port", "=", "port", ";", "}", "/", "**", "*", "Starts", "an", "RMI", "Registry", "that", "allows", "clients", "to", "lookup", "the", "JMX", "IP", "/", "port", ".", "*", "*", "@", "param", "port", "rmi", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startRmiRegistry", "(", "int", "port", ")", "throws", "IOException", "{", "rmiRegistry", "=", "LocateRegistry", ".", "createRegistry", "(", "port", ")", ";", "}", "private", "void", "internalStart", "(", "int", "port", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "/", "/", "this", "allows", "clients", "to", "lookup", "the", "JMX", "service", "rmiRegistry", "=", "new", "JmxRegistry", "(", "port", ",", "\"", "jmxrmi", "\"", ",", "rmiServerReference", ")", ";", "/", "**", "*", "Starts", "a", "JMX", "connector", "that", "allows", "(", "un", ")", "registering", "MBeans", "with", "the", "MBean", "server", "and", "RMI", "invocations", ".", "*", "*", "@", "param", "port", "jmx", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "String", "serviceUrl", "=", "\"", "service", ":", "jmx", ":", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jndi", "/", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jmxrmi", "\"", ";", "JMXServiceURL", "url", ";", "try", "{", "@", "@", "-", "513", ",", "12", "+", "506", ",", "20", "@", "@", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Malformed", "service", "url", "created", "\"", "+", "serviceUrl", ",", "e", ")", ";", "}", "connector", "=", "JMXConnectorServerFactory", ".", "newJMXConnectorServer", "(", "url", ",", "null", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "final", "RMIJRMPServerImpl", "rmiServer", "=", "new", "RMIJRMPServerImpl", "(", "port", ",", "null", ",", "null", ",", "null", ")", ";", "connector", "=", "new", "RMIConnectorServer", "(", "url", ",", "null", ",", "rmiServer", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "connector", ".", "start", "(", ");", "/", "/", "we", "can", "'", "t", "pass", "the", "created", "stub", "directly", "to", "the", "registry", "since", "this", "would", "form", "a", "cyclic", "dependency", ":", "/", "/", "-", "you", "can", "only", "start", "the", "connector", "after", "the", "registry", "was", "started", "/", "/", "-", "you", "can", "only", "create", "the", "stub", "after", "the", "connector", "was", "started", "/", "/", "-", "you", "can", "only", "start", "the", "registry", "after", "the", "stub", "was", "created", "rmiServerReference", ".", "set", "(", "rmiServer", ".", "toStub", "(", "))", ";", "}", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "if", "(", "connector", "!", "=", "null", ")", "{", "try", "{", "connector", ".", "stop", "(", ");", "@", "@", "-", "536", ",", "5", "+", "537", ",", "51", "@", "@", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "}", "}", "}", "/", "**", "*", "A", "registry", "that", "only", "exposes", "a", "single", "remote", "object", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "restriction", "\"", ")", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "final", "String", "lookupName", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ";", "JmxRegistry", "(", "final", "int", "port", ",", "final", "String", "lookupName", ",", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ")", "throws", "RemoteException", "{", "super", "(", "port", ")", ";", "this", ".", "lookupName", "=", "lookupName", ";", "this", ".", "remoteServerStub", "=", "remoteServerStub", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "s", ")", "throws", "NotBoundException", "{", "if", "(", "lookupName", ".", "equals", "(", "s", ")", ")", "{", "final", "Remote", "remote", "=", "remoteServerStub", ".", "get", "(", ");", "if", "(", "remote", "!", "=", "null", ")", "{", "return", "remote", ";", "}", "}", "throw", "new", "NotBoundException", "(", "\"", "Not", "bound", ".", "\")", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "start", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "unbind", "(", "String", "s", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "stop", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "rebind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "might", "as", "well", "not", "throw", "an", "exception", "here", "given", "that", "the", "others", "don", "'", "t", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "{", "return", "new", "String", "[", "]{", "lookupName", "}", ";", "}", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Fixed", "bug", "#75571:", "Potential", "infinite", "loop", "in", "gdImageCreateFromGifCtx", "Due", "to", "a", "signedness", "confusion", "in", "`GetCode_`", "a", "corrupt", "GIF", "file", "can", "trigger", "an", "infinite", "loop.", "Furthermore", "we", "make", "sure", "that", "a", "GIF", "without", "any", "palette", "entries", "is", "treated", "as", "invalid", "*after*", "open", "palette", "entries", "have", "been", "removed."], "code_tokens": ["@", "@", "-", "261", ",", "10", "+", "261", ",", "6", "@", "@", "gdImagePtr", "gdImageCreateFromGifCtx", "(", "gdIOCtxPtr", "fd", ")", "/", "*", "{", "{{", "*", "/", "if", "(", "!", "im", ")", "{", "return", "0", ";", "}", "if", "(", "!", "im", "-", ">", "colorsTotal", ")", "{", "gdImageDestroy", "(", "im", ")", ";", "return", "0", ";", "}", "/", "*", "Check", "for", "open", "colors", "at", "the", "end", ",", "so", "we", "can", "reduce", "colorsTotal", "and", "ultimately", "BitsPerPixel", "*", "/", "@", "@", "-", "275", ",", "6", "+", "271", ",", "10", "@", "@", "gdImagePtr", "gdImageCreateFromGifCtx", "(", "gdIOCtxPtr", "fd", ")", "/", "*", "{", "{{", "*", "/", "break", ";", "}", "}", "if", "(", "!", "im", "-", ">", "colorsTotal", ")", "{", "gdImageDestroy", "(", "im", ")", ";", "return", "0", ";", "}", "return", "im", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "375", ",", "7", "+", "375", ",", "7", "@", "@", "static", "int", "GetCode_", "(", "gdIOCtx", "*", "fd", ",", "CODE_STATIC_DATA", "*", "scd", ",", "int", "code_size", ",", "int", "flag", ",", "int", "*", "ZeroDataBlockP", ")", "{", "int", "i", ",", "j", ",", "ret", ";", "unsigned", "char", "count", ";", "int", "count", ";", "if", "(", "flag", ")", "{", "scd", "-", ">", "curbit", "=", "0", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "15", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "75571", "(", "Infinite", "loop", "in", "GIF", "reading", "causing", "DoS", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "gd", "'", "))", "die", "(", "'", "skip", "gd", "extension", "not", "available", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "imagecreatefromgif", "(", "__DIR__", ".", "'", "/", "bug75571", ".", "gif", "'", "))", ";", "?", ">", "=", "==", "DONE", "=", "==", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "imagecreatefromgif", "(", "):", "'", "%", "s", "'", "is", "not", "a", "valid", "GIF", "file", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "=", "==", "DONE", "=", "=="], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["f2fs:", "fix", "to", "do", "sanity", "check", "with", "i_extra_isize", "If", "inode.i_extra_isize", "was", "fuzzed", "to", "an", "abnormal", "value,", "when", "calculating", "inline", "data", "size,", "the", "result", "will", "overflow,", "result", "in", "accessing", "invalid", "memory", "area", "when", "operating", "inline", "data.", "Let's", "do", "sanity", "check", "with", "i_extra_isize", "during", "inode", "loading", "for", "fixing.", "https://bugzilla.kernel.org/show_bug.cgi?id=200421", "-", "Reproduce", "-", "POC", "(poc.c)", "#define", "_GNU_SOURCE", "#include", "<sys/types.h>", "#include", "<sys/mount.h>", "#include", "<sys/mman.h>", "#include", "<sys/stat.h>", "#include", "<sys/xattr.h>", "#include", "<dirent.h>", "#include", "<errno.h>", "#include", "<error.h>", "#include", "<fcntl.h>", "#include", "<stdio.h>", "#include", "<stdlib.h>", "#include", "<string.h>", "#include", "<unistd.h>", "#include", "<linux/falloc.h>", "#include", "<linux/loop.h>", "static", "void", "activity(char", "*mpoint)", "{", "char", "*foo_bar_baz;", "char", "*foo_baz;", "char", "*xattr;", "int", "err;", "err", "=", "asprintf(&foo_bar_baz,", "\"%s/foo/bar/baz\",", "mpoint);", "err", "=", "asprintf(&foo_baz,", "\"%s/foo/baz\",", "mpoint);", "err", "=", "asprintf(&xattr,", "\"%s/foo/bar/xattr\",", "mpoint);", "rename(foo_bar_baz,", "foo_baz);", "char", "buf2[113];", "memset(buf2,", "0,", "sizeof(buf2));", "listxattr(xattr,", "buf2,", "sizeof(buf2));", "removexattr(xattr,", "\"user.mime_type\");", "}", "int", "main(int", "argc,", "char", "*argv[])", "{", "activity(argv[1]);", "return", "0;", "}", "-", "Kernel", "message", "Umount", "the", "image", "will", "leave", "the", "following", "message", "[", "2910.995489]", "F2FS-fs", "(loop0):", "Mounted", "with", "checkpoint", "version", "=", "2", "[", "2918.416465]", "==================================================================", "[", "2918.416807]", "BUG:", "KASAN:", "slab-out-of-bounds", "in", "f2fs_iget+0xcb9/0x1a80", "[", "2918.417009]", "Read", "of", "size", "4", "at", "addr", "ffff88018efc2068", "by", "task", "a.out/1229", "[", "2918.417311]", "CPU:", "1", "PID:", "1229", "Comm:", "a.out", "Not", "tainted", "4.17.0+", "#1", "[", "2918.417314]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "2918.417323]", "Call", "Trace:", "[", "2918.417366]", "dump_stack+0x71/0xab", "[", "2918.417401]", "print_address_description+0x6b/0x290", "[", "2918.417407]", "kasan_report+0x28e/0x390", "[", "2918.417411]", "?", "f2fs_iget+0xcb9/0x1a80", "[", "2918.417415]", "f2fs_iget+0xcb9/0x1a80", "[", "2918.417422]", "?", "f2fs_lookup+0x2e7/0x580", "[", "2918.417425]", "f2fs_lookup+0x2e7/0x580", "[", "2918.417433]", "?", "__recover_dot_dentries+0x400/0x400", "[", "2918.417447]", "?", "legitimize_path.isra.29+0x5a/0xa0", "[", "2918.417453]", "__lookup_slow+0x11c/0x220", "[", "2918.417457]", "?", "may_delete+0x2a0/0x2a0", "[", "2918.417475]", "?", "deref_stack_reg+0xe0/0xe0", "[", "2918.417479]", "?", "__lookup_hash+0xb0/0xb0", "[", "2918.417483]", "lookup_slow+0x3e/0x60", "[", "2918.417488]", "walk_component+0x3ac/0x990", "[", "2918.417492]", "?", "generic_permission+0x51/0x1e0", "[", "2918.417495]", "?", "inode_permission+0x51/0x1d0", "[", "2918.417499]", "?", "pick_link+0x3e0/0x3e0", "[", "2918.417502]", "?", "link_path_walk+0x4b1/0x770", "[", "2918.417513]", "?", "_raw_spin_lock_irqsave+0x25/0x50", "[", "2918.417518]", "?", "walk_component+0x990/0x990", "[", "2918.417522]", "?", "path_init+0x2e6/0x580", "[", "2918.417526]", "path_lookupat+0x13f/0x430", "[", "2918.417531]", "?", "trailing_symlink+0x3a0/0x3a0", "[", "2918.417534]", "?", "do_renameat2+0x270/0x7b0", "[", "2918.417538]", "?", "__kasan_slab_free+0x14c/0x190", "[", "2918.417541]", "?", "do_renameat2+0x270/0x7b0", "[", "2918.417553]", "?", "kmem_cache_free+0x85/0x1e0", "[", "2918.417558]", "?", "do_renameat2+0x270/0x7b0", "[", "2918.417563]", "filename_lookup+0x13c/0x280", "[", "2918.417567]", "?", "filename_parentat+0x2b0/0x2b0", "[", "2918.417572]", "?", "kasan_unpoison_shadow+0x31/0x40", "[", "2918.417575]", "?", "kasan_kmalloc+0xa6/0xd0", "[", "2918.417593]", "?", "strncpy_from_user+0xaa/0x1c0", "[", "2918.417598]", "?", "getname_flags+0x101/0x2b0", "[", "2918.417614]", "?", "path_listxattr+0x87/0x110", "[", "2918.417619]", "path_listxattr+0x87/0x110", "[", "2918.417623]", "?", "listxattr+0xc0/0xc0", "[", "2918.417637]", "?", "mm_fault_error+0x1b0/0x1b0", "[", "2918.417654]", "do_syscall_64+0x73/0x160", "[", "2918.417660]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "2918.417676]", "RIP:", "0033:0x7f2f3a3480d7", "[", "2918.417677]", "Code:", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "be", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "66", "90", "b8", "c2", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "91", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "2918.417732]", "RSP:", "002b:00007fff4095b7d8", "EFLAGS:", "00000206", "ORIG_RAX:", "00000000000000c2", "[", "2918.417744]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007f2f3a3480d7", "[", "2918.417746]", "RDX:", "0000000000000071", "RSI:", "00007fff4095b810", "RDI:", "000000000126a0c0", "[", "2918.417749]", "RBP:", "00007fff4095b890", "R08:", "000000000126a010", "R09:", "0000000000000000", "[", "2918.417751]", "R10:", "00000000000001ab", "R11:", "0000000000000206", "R12:", "00000000004005e0", "[", "2918.417753]", "R13:", "00007fff4095b990", "R14:", "0000000000000000", "R15:", "0000000000000000", "[", "2918.417853]", "Allocated", "by", "task", "329:", "[", "2918.418002]", "kasan_kmalloc+0xa6/0xd0", "[", "2918.418007]", "kmem_cache_alloc+0xc8/0x1e0", "[", "2918.418023]", "mempool_init_node+0x194/0x230", "[", "2918.418027]", "mempool_init+0x12/0x20", "[", "2918.418042]", "bioset_init+0x2bd/0x380", "[", "2918.418052]", "blk_alloc_queue_node+0xe9/0x540", "[", "2918.418075]", "dm_create+0x2c0/0x800", "[", "2918.418080]", "dev_create+0xd2/0x530", "[", "2918.418083]", "ctl_ioctl+0x2a3/0x5b0", "[", "2918.418087]", "dm_ctl_ioctl+0xa/0x10", "[", "2918.418092]", "do_vfs_ioctl+0x13e/0x8c0", "[", "2918.418095]", "ksys_ioctl+0x66/0x70", "[", "2918.418098]", "__x64_sys_ioctl+0x3d/0x50", "[", "2918.418102]", "do_syscall_64+0x73/0x160", "[", "2918.418106]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "2918.418204]", "Freed", "by", "task", "0:", "[", "2918.418301]", "(stack", "is", "not", "available)", "[", "2918.418521]", "The", "buggy", "address", "belongs", "to", "the", "object", "at", "ffff88018efc0000", "which", "belongs", "to", "the", "cache", "biovec-max", "of", "size", "8192", "[", "2918.418894]", "The", "buggy", "address", "is", "located", "104", "bytes", "to", "the", "right", "of", "8192-byte", "region", "[ffff88018efc0000,", "ffff88018efc2000)", "[", "2918.419257]", "The", "buggy", "address", "belongs", "to", "the", "page:", "[", "2918.419431]", "page:ffffea00063bf000", "count:1", "mapcount:0", "mapping:ffff8801f2242540", "index:0x0", "compound_mapcount:", "0", "[", "2918.419702]", "flags:", "0x17fff8000008100(slab|head)", "[", "2918.419879]", "raw:", "017fff8000008100", "dead000000000100", "dead000000000200", "ffff8801f2242540", "[", "2918.420101]", "raw:", "0000000000000000", "0000000000030003", "00000001ffffffff", "0000000000000000", "[", "2918.420322]", "page", "dumped", "because:", "kasan:", "bad", "access", "detected", "[", "2918.420599]", "Memory", "state", "around", "the", "buggy", "address:", "[", "2918.420764]", "ffff88018efc1f00:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "2918.420975]", "ffff88018efc1f80:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "2918.421194]", ">ffff88018efc2000:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[", "2918.421406]", "^", "[", "2918.421627]", "ffff88018efc2080:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[", "2918.421838]", "ffff88018efc2100:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "2918.422046]", "==================================================================", "[", "2918.422264]", "Disabling", "lock", "debugging", "due", "to", "kernel", "taint", "[", "2923.901641]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "ffff88018f0db000", "[", "2923.901884]", "PGD", "22226a067", "P4D", "22226a067", "PUD", "222273067", "PMD", "18e642063", "PTE", "800000018f0db061", "[", "2923.902120]", "Oops:", "0003", "[#1]", "SMP", "KASAN", "PTI", "[", "2923.902274]", "CPU:", "1", "PID:", "1231", "Comm:", "umount", "Tainted:", "G", "B", "4.17.0+", "#1", "[", "2923.902490]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "2923.902761]", "RIP:", "0010:__memset+0x24/0x30", "[", "2923.902906]", "Code:", "90", "90", "90", "90", "90", "90", "66", "66", "90", "66", "90", "49", "89", "f9", "48", "89", "d1", "83", "e2", "07", "48", "c1", "e9", "03", "40", "0f", "b6", "f6", "48", "b8", "01", "01", "01", "01", "01", "01", "01", "01", "48", "0f", "af", "c6", "<f3>", "48", "ab", "89", "d1", "f3", "aa", "4c", "89", "c8", "c3", "90", "49", "89", "f9", "40", "88", "f0", "48", "89", "d1", "f3", "[", "2923.903446]", "RSP:", "0018:ffff88018ddf7ae0", "EFLAGS:", "00010206", "[", "2923.903622]", "RAX:", "0000000000000000", "RBX:", "ffff8801d549d888", "RCX:", "1ffffffffffdaffb", "[", "2923.903833]", "RDX:", "0000000000000000", "RSI:", "0000000000000000", "RDI:", "ffff88018f0daffc", "[", "2923.904062]", "RBP:", "ffff88018efc206c", "R08:", "1ffff10031df840d", "R09:", "ffff88018efc206c", "[", "2923.904273]", "R10:", "ffffffffffffe1ee", "R11:", "ffffed0031df65fa", "R12:", "0000000000000000", "[", "2923.904485]", "R13:", "ffff8801d549dc98", "R14:", "00000000ffffc3db", "R15:", "ffffea00063bec80", "[", "2923.904693]", "FS:", "00007fa8b2f8a840(0000)", "GS:ffff8801f3b00000(0000)", "knlGS:0000000000000000", "[", "2923.904937]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "2923.910080]", "CR2:", "ffff88018f0db000", "CR3:", "000000018f892000", "CR4:", "00000000000006e0", "[", "2923.914930]", "Call", "Trace:", "[", "2923.919724]", "f2fs_truncate_inline_inode+0x114/0x170", "[", "2923.924487]", "f2fs_truncate_blocks+0x11b/0x7c0", "[", "2923.929178]", "?", "f2fs_truncate_data_blocks+0x10/0x10", "[", "2923.933834]", "?", "dqget+0x670/0x670", "[", "2923.938437]", "?", "f2fs_destroy_extent_tree+0xd6/0x270", "[", "2923.943107]", "?", "__radix_tree_lookup+0x2f/0x150", "[", "2923.947772]", "f2fs_truncate+0xd4/0x1a0", "[", "2923.952491]", "f2fs_evict_inode+0x5ab/0x610", "[", "2923.957204]", "evict+0x15f/0x280", "[", "2923.961898]", "__dentry_kill+0x161/0x250", "[", "2923.966634]", "shrink_dentry_list+0xf3/0x250", "[", "2923.971897]", "shrink_dcache_parent+0xa9/0x100", "[", "2923.976561]", "?", "shrink_dcache_sb+0x1f0/0x1f0", "[", "2923.981177]", "?", "wait_for_completion+0x8a/0x210", "[", "2923.985781]", "?", "migrate_swap_stop+0x2d0/0x2d0", "[", "2923.990332]", "do_one_tree+0xe/0x40", "[", "2923.994735]", "shrink_dcache_for_umount+0x3a/0xa0", "[", "2923.999077]", "generic_shutdown_super+0x3e/0x1c0", "[", "2924.003350]", "kill_block_super+0x4b/0x70", "[", "2924.007619]", "deactivate_locked_super+0x65/0x90", "[", "2924.011812]", "cleanup_mnt+0x5c/0xa0", "[", "2924.015995]", "task_work_run+0xce/0xf0", "[", "2924.020174]", "exit_to_usermode_loop+0x115/0x120", "[", "2924.024293]", "do_syscall_64+0x12f/0x160", "[", "2924.028479]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "2924.032709]", "RIP:", "0033:0x7fa8b2868487", "[", "2924.036888]", "Code:", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "0f", "1f", "44", "00", "00", "31", "f6", "e9", "09", "00", "00", "00", "66", "0f", "1f", "84", "00", "00", "00", "00", "00", "b8", "a6", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "e1", "c9", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "2924.045750]", "RSP:", "002b:00007ffc39824d58", "EFLAGS:", "00000246", "ORIG_RAX:", "00000000000000a6", "[", "2924.050190]", "RAX:", "0000000000000000", "RBX:", "00000000008ea030", "RCX:", "00007fa8b2868487", "[", "2924.054604]", "RDX:", "0000000000000001", "RSI:", "0000000000000000", "RDI:", "00000000008f4360", "[", "2924.058940]", "RBP:", "00000000008f4360", "R08:", "0000000000000000", "R09:", "0000000000000014", "[", "2924.063186]", "R10:", "00000000000006b2", "R11:", "0000000000000246", "R12:", "00007fa8b2d7183c", "[", "2924.067418]", "R13:", "0000000000000000", "R14:", "00000000008ea210", "R15:", "00007ffc39824fe0", "[", "2924.071534]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hda_core", "snd_hwdep", "snd_pcm", "snd_timer", "joydev", "input_leds", "serio_raw", "snd", "soundcore", "mac_hid", "i2c_piix4", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "configfs", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "btrfs", "zstd_decompress", "zstd_compress", "xxhash", "raid10", "raid456", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "async_tx", "xor", "raid6_pq", "libcrc32c", "raid1", "raid0", "multipath", "linear", "8139too", "qxl", "ttm", "drm_kms_helper", "syscopyarea", "sysfillrect", "sysimgblt", "fb_sys_fops", "drm", "crct10dif_pclmul", "crc32_pclmul", "ghash_clmulni_intel", "pcbc", "aesni_intel", "psmouse", "aes_x86_64", "8139cp", "crypto_simd", "cryptd", "mii", "glue_helper", "pata_acpi", "floppy", "[", "2924.098044]", "CR2:", "ffff88018f0db000", "[", "2924.102520]", "---[", "end", "trace", "a8e0d899985faf31", "]---", "[", "2924.107012]", "RIP:", "0010:__memset+0x24/0x30", "[", "2924.111448]", "Code:", "90", "90", "90", "90", "90", "90", "66", "66", "90", "66", "90", "49", "89", "f9", "48", "89", "d1", "83", "e2", "07", "48", "c1", "e9", "03", "40", "0f", "b6", "f6", "48", "b8", "01", "01", "01", "01", "01", "01", "01", "01", "48", "0f", "af", "c6", "<f3>", "48", "ab", "89", "d1", "f3", "aa", "4c", "89", "c8", "c3", "90", "49", "89", "f9", "40", "88", "f0", "48", "89", "d1", "f3", "[", "2924.120724]", "RSP:", "0018:ffff88018ddf7ae0", "EFLAGS:", "00010206", "[", "2924.125312]", "RAX:", "0000000000000000", "RBX:", "ffff8801d549d888", "RCX:", "1ffffffffffdaffb", "[", "2924.129931]", "RDX:", "0000000000000000", "RSI:", "0000000000000000", "RDI:", "ffff88018f0daffc", "[", "2924.134537]", "RBP:", "ffff88018efc206c", "R08:", "1ffff10031df840d", "R09:", "ffff88018efc206c", "[", "2924.139175]", "R10:", "ffffffffffffe1ee", "R11:", "ffffed0031df65fa", "R12:", "0000000000000000", "[", "2924.143825]", "R13:", "ffff8801d549dc98", "R14:", "00000000ffffc3db", "R15:", "ffffea00063bec80", "[", "2924.148500]", "FS:", "00007fa8b2f8a840(0000)", "GS:ffff8801f3b00000(0000)", "knlGS:0000000000000000", "[", "2924.153247]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "2924.158003]", "CR2:", "ffff88018f0db000", "CR3:", "000000018f892000", "CR4:", "00000000000006e0", "[", "2924.164641]", "BUG:", "Bad", "rss-counter", "state", "mm:00000000fa04621e", "idx:0", "val:4", "[", "2924.170007]", "BUG:", "Bad", "rss-counter", "tate", "mm:00000000fa04621e", "idx:1", "val:2", "-", "Location", "https://elixir.bootlin.com/linux/v4.18-rc3/source/fs/f2fs/inline.c#L78", "memset(addr", "+", "from,", "0,", "MAX_INLINE_DATA(inode)", "-", "from);", "Here", "the", "length", "can", "be", "negative.", "Reported-by", "Wen", "Xu", "<wen.xu@gatech.edu>", "Signed-off-by:", "Chao", "Yu", "<yuchao0@huawei.com>", "Signed-off-by:", "Jaegeuk", "Kim", "<jaegeuk@kernel.org>"], "code_tokens": ["@", "@", "-", "196", ",", "6", "+", "196", ",", "7", "@", "@", "void", "f2fs_inode_chksum_set", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "struct", "page", "*", "page", ")", "static", "bool", "sanity_check_inode", "(", "struct", "inode", "*", "inode", ",", "struct", "page", "*", "node_page", ")", "{", "struct", "f2fs_sb_info", "*", "sbi", "=", "F2FS_I_SB", "(", "inode", ")", ";", "struct", "f2fs_inode_info", "*", "fi", "=", "F2FS_I", "(", "inode", ")", ";", "unsigned", "long", "long", "iblocks", ";", "iblocks", "=", "le64_to_cpu", "(", "F2FS_INODE", "(", "node_page", ")", "->", "i_blocks", ")", ";", "@", "@", "-", "237", ",", "6", "+", "238", ",", "17", "@", "@", "static", "bool", "sanity_check_inode", "(", "struct", "inode", "*", "inode", ",", "struct", "page", "*", "node_page", ")", "return", "false", ";", "}", "if", "(", "fi", "-", ">", "i_extra_isize", ">", "F2FS_TOTAL_EXTRA_ATTR_SIZE", "|", "|", "fi", "-", ">", "i_extra_isize", "%", "sizeof", "(", "__le32", ")", ")", "{", "set_sbi_flag", "(", "sbi", ",", "SBI_NEED_FSCK", ")", ";", "f2fs_msg", "(", "sbi", "-", ">", "sb", ",", "KERN_WARNING", ",", "\"", "%", "s", ":", "inode", "(", "ino", "=", "%", "lx", ")", "has", "corrupted", "i_extra_isize", ":", "%", "d", ",", "\"", "\"", "max", ":", "%", "zu", "\"", ",", "__func__", ",", "inode", "-", ">", "i_ino", ",", "fi", "-", ">", "i_extra_isize", ",", "F2FS_TOTAL_EXTRA_ATTR_SIZE", ")", ";", "return", "false", ";", "}", "if", "(", "F2FS_I", "(", "inode", ")", "->", "extent_tree", ")", "{", "struct", "extent_info", "*", "ei", "=", "&", "F2FS_I", "(", "inode", ")", "->", "extent_tree", "-", ">", "largest", ";", "@", "@", "-", "305", ",", "11", "+", "317", ",", "6", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "get_inline_info", "(", "inode", ",", "ri", ")", ";", "if", "(", "!", "sanity_check_inode", "(", "inode", ",", "node_page", ")", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "-", "EINVAL", ";", "}", "fi", "-", ">", "i_extra_isize", "=", "f2fs_has_extra_attr", "(", "inode", ")", "?", "le16_to_cpu", "(", "ri", "-", ">", "i_extra_isize", ")", ":", "0", ";", "@", "@", "-", "329", ",", "6", "+", "336", ",", "11", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "fi", "-", ">", "i_inline_xattr_size", "=", "0", ";", "}", "if", "(", "!", "sanity_check_inode", "(", "inode", ",", "node_page", ")", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "check", "data", "exist", "*", "/", "if", "(", "f2fs_has_inline_data", "(", "inode", ")", "&", "&", "!", "f2fs_exist_data", "(", "inode", ")", ")", "__recover_inline_status", "(", "inode", ",", "node_page", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["x86/mm/32:", "Enable", "full", "randomization", "on", "i386", "and", "X86_32", "Currently", "on", "i386", "and", "on", "X86_64", "when", "emulating", "X86_32", "in", "legacy", "mode,", "only", "the", "stack", "and", "the", "executable", "are", "randomized", "but", "not", "other", "mmapped", "files", "(libraries,", "vDSO,", "etc.).", "This", "patch", "enables", "randomization", "for", "the", "libraries,", "vDSO", "and", "mmap", "requests", "on", "i386", "and", "in", "X86_32", "in", "legacy", "mode.", "By", "default", "on", "i386", "there", "are", "8", "bits", "for", "the", "randomization", "of", "the", "libraries,", "vDSO", "and", "mmaps", "which", "only", "uses", "1MB", "of", "VA.", "This", "patch", "preserves", "the", "original", "randomness,", "using", "1MB", "of", "VA", "out", "of", "3GB", "or", "4GB.", "We", "think", "that", "1MB", "out", "of", "3GB", "is", "not", "a", "big", "cost", "for", "having", "the", "ASLR.", "The", "first", "obvious", "security", "benefit", "is", "that", "all", "objects", "are", "randomized", "(not", "only", "the", "stack", "and", "the", "executable)", "in", "legacy", "mode", "which", "highly", "increases", "the", "ASLR", "effectiveness,", "otherwise", "the", "attackers", "may", "use", "these", "non-randomized", "areas.", "But", "also", "sensitive", "setuid/setgid", "applications", "are", "more", "secure", "because", "currently,", "attackers", "can", "disable", "the", "randomization", "of", "these", "applications", "by", "setting", "the", "ulimit", "stack", "to", "\"unlimited\".", "This", "is", "a", "very", "old", "and", "widely", "known", "trick", "to", "disable", "the", "ASLR", "in", "i386", "which", "has", "been", "allowed", "for", "too", "long.", "Another", "trick", "used", "to", "disable", "the", "ASLR", "was", "to", "set", "the", "ADDR_NO_RANDOMIZE", "personality", "flag,", "but", "fortunately", "this", "doesn't", "work", "on", "setuid/setgid", "applications", "because", "there", "is", "security", "checks", "which", "clear", "Security-relevant", "flags.", "This", "patch", "always", "randomizes", "the", "mmap_legacy_base", "address,", "removing", "the", "possibility", "to", "disable", "the", "ASLR", "by", "setting", "the", "stack", "to", "\"unlimited\".", "Signed-off-by:", "Hector", "Marco-Gisbert", "<hecmargi@upv.es>", "Acked-by:", "Ismael", "Ripoll", "Ripoll", "<iripoll@upv.es>", "Acked-by:", "Kees", "Cook", "<keescook@chromium.org>", "Acked-by:", "Arjan", "van", "de", "Ven", "<arjan@linux.intel.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "akpm@linux-foundation.org", "Cc:", "kees", "Cook", "<keescook@chromium.org>", "Link:", "http://lkml.kernel.org/r/1457639460-5242-1-git-send-email-hecmargi@upv.es", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["@", "@", "-", "93", ",", "18", "+", "93", ",", "6", "@", "@", "static", "unsigned", "long", "mmap_base", "(", "unsigned", "long", "rnd", ")", "return", "PAGE_ALIGN", "(", "TASK_SIZE", "-", "gap", "-", "rnd", ")", ";", "}", "/", "*", "*", "Bottom", "-", "up", "(", "legacy", ")", "layout", "on", "X86_32", "did", "not", "support", "randomization", ",", "X86_64", "*", "does", ",", "but", "not", "when", "emulating", "X86_32", "*", "/", "static", "unsigned", "long", "mmap_legacy_base", "(", "unsigned", "long", "rnd", ")", "{", "if", "(", "mmap_is_ia32", "(", "))", "return", "TASK_UNMAPPED_BASE", ";", "else", "return", "TASK_UNMAPPED_BASE", "+", "rnd", ";", "}", "/", "*", "*", "This", "function", ",", "called", "very", "early", "during", "the", "creation", "of", "a", "new", "*", "process", "VM", "image", ",", "sets", "up", "which", "VM", "layout", "function", "to", "use", ":", "@", "@", "-", "116", ",", "7", "+", "104", ",", "7", "@", "@", "void", "arch_pick_mmap_layout", "(", "struct", "mm_struct", "*", "mm", ")", "if", "(", "current", "-", ">", "flags", "&", "PF_RANDOMIZE", ")", "random_factor", "=", "arch_mmap_rnd", "(", ");", "mm", "-", ">", "mmap_legacy_base", "=", "mmap_legacy_base", "(", "random_factor", ")", ";", "mm", "-", ">", "mmap_legacy_base", "=", "TASK_UNMAPPED_BASE", "+", "random_factor", ";", "if", "(", "mmap_is_legacy", "(", "))", "{", "mm", "-", ">", "mmap_base", "=", "mm", "-", ">", "mmap_legacy_base", ";"], "docstring_tokens": ["running", "32-bit", "applications", "in", "a", "x86", "machine", "disable", "the", "ASLR", "by", "setting", "the", "RLIMIT_STACK", "resource", "to", "unlimited"]}
{"contents": ["x86/mm:", "Fix", "use-after-free", "of", "ldt_struct", "The", "following", "commit:", "39a0526fb3f7", "(\"x86/mm:", "Factor", "out", "LDT", "init", "from", "context", "init\")", "renamed", "init_new_context()", "to", "init_new_context_ldt()", "and", "added", "a", "new", "init_new_context()", "which", "calls", "init_new_context_ldt().", "However,", "the", "error", "code", "of", "init_new_context_ldt()", "was", "ignored.", "Consequently,", "if", "a", "memory", "allocation", "in", "alloc_ldt_struct()", "failed", "during", "a", "fork(),", "the", "->context.ldt", "of", "the", "new", "task", "remained", "the", "same", "as", "that", "of", "the", "old", "task", "(due", "to", "the", "memcpy()", "in", "dup_mm()).", "ldt_struct's", "are", "not", "intended", "to", "be", "shared,", "so", "a", "use-after-free", "occurred", "after", "one", "task", "exited.", "Fix", "the", "bug", "by", "making", "init_new_context()", "pass", "through", "the", "error", "code", "of", "init_new_context_ldt().", "This", "bug", "was", "found", "by", "syzkaller,", "which", "encountered", "the", "following", "splat:", "BUG:", "KASAN:", "use-after-free", "in", "free_ldt_struct.part.2+0x10a/0x150", "arch/x86/kernel/ldt.c:116", "Read", "of", "size", "4", "at", "addr", "ffff88006d2cb7c8", "by", "task", "kworker/u9:0/3710", "CPU:", "1", "PID:", "3710", "Comm:", "kworker/u9:0", "Not", "tainted", "4.13.0-rc4-next-20170811", "#2", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Bochs", "01/01/2011", "Call", "Trace:", "__dump_stack", "lib/dump_stack.c:16", "[inline]", "dump_stack+0x194/0x257", "lib/dump_stack.c:52", "print_address_description+0x73/0x250", "mm/kasan/report.c:252", "kasan_report_error", "mm/kasan/report.c:351", "[inline]", "kasan_report+0x24e/0x340", "mm/kasan/report.c:409", "__asan_report_load4_noabort+0x14/0x20", "mm/kasan/report.c:429", "free_ldt_struct.part.2+0x10a/0x150", "arch/x86/kernel/ldt.c:116", "free_ldt_struct", "arch/x86/kernel/ldt.c:173", "[inline]", "destroy_context_ldt+0x60/0x80", "arch/x86/kernel/ldt.c:171", "destroy_context", "arch/x86/include/asm/mmu_context.h:157", "[inline]", "__mmdrop+0xe9/0x530", "kernel/fork.c:889", "mmdrop", "include/linux/sched/mm.h:42", "[inline]", "exec_mmap", "fs/exec.c:1061", "[inline]", "flush_old_exec+0x173c/0x1ff0", "fs/exec.c:1291", "load_elf_binary+0x81f/0x4ba0", "fs/binfmt_elf.c:855", "search_binary_handler+0x142/0x6b0", "fs/exec.c:1652", "exec_binprm", "fs/exec.c:1694", "[inline]", "do_execveat_common.isra.33+0x1746/0x22e0", "fs/exec.c:1816", "do_execve+0x31/0x40", "fs/exec.c:1860", "call_usermodehelper_exec_async+0x457/0x8f0", "kernel/umh.c:100", "ret_from_fork+0x2a/0x40", "arch/x86/entry/entry_64.S:431", "Allocated", "by", "task", "3700:", "save_stack_trace+0x16/0x20", "arch/x86/kernel/stacktrace.c:59", "save_stack+0x43/0xd0", "mm/kasan/kasan.c:447", "set_track", "mm/kasan/kasan.c:459", "[inline]", "kasan_kmalloc+0xad/0xe0", "mm/kasan/kasan.c:551", "kmem_cache_alloc_trace+0x136/0x750", "mm/slab.c:3627", "kmalloc", "include/linux/slab.h:493", "[inline]", "alloc_ldt_struct+0x52/0x140", "arch/x86/kernel/ldt.c:67", "write_ldt+0x7b7/0xab0", "arch/x86/kernel/ldt.c:277", "sys_modify_ldt+0x1ef/0x240", "arch/x86/kernel/ldt.c:307", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "Freed", "by", "task", "3700:", "save_stack_trace+0x16/0x20", "arch/x86/kernel/stacktrace.c:59", "save_stack+0x43/0xd0", "mm/kasan/kasan.c:447", "set_track", "mm/kasan/kasan.c:459", "[inline]", "kasan_slab_free+0x71/0xc0", "mm/kasan/kasan.c:524", "__cache_free", "mm/slab.c:3503", "[inline]", "kfree+0xca/0x250", "mm/slab.c:3820", "free_ldt_struct.part.2+0xdd/0x150", "arch/x86/kernel/ldt.c:121", "free_ldt_struct", "arch/x86/kernel/ldt.c:173", "[inline]", "destroy_context_ldt+0x60/0x80", "arch/x86/kernel/ldt.c:171", "destroy_context", "arch/x86/include/asm/mmu_context.h:157", "[inline]", "__mmdrop+0xe9/0x530", "kernel/fork.c:889", "mmdrop", "include/linux/sched/mm.h:42", "[inline]", "__mmput", "kernel/fork.c:916", "[inline]", "mmput+0x541/0x6e0", "kernel/fork.c:927", "copy_process.part.36+0x22e1/0x4af0", "kernel/fork.c:1931", "copy_process", "kernel/fork.c:1546", "[inline]", "_do_fork+0x1ef/0xfb0", "kernel/fork.c:2025", "SYSC_clone", "kernel/fork.c:2135", "[inline]", "SyS_clone+0x37/0x50", "kernel/fork.c:2129", "do_syscall_64+0x26c/0x8c0", "arch/x86/entry/common.c:287", "return_from_SYSCALL_64+0x0/0x7a", "Here", "is", "a", "C", "reproducer:", "#include", "<asm/ldt.h>", "#include", "<pthread.h>", "#include", "<signal.h>", "#include", "<stdlib.h>", "#include", "<sys/syscall.h>", "#include", "<sys/wait.h>", "#include", "<unistd.h>", "static", "void", "*fork_thread(void", "*_arg)", "{", "fork();", "}", "int", "main(void)", "{", "struct", "user_desc", "desc", "=", "{", ".entry_number", "=", "8191", "};", "syscall(__NR_modify_ldt,", "1,", "&desc,", "sizeof(desc));", "for", "(;;)", "{", "if", "(fork()", "==", "0)", "{", "pthread_t", "t;", "srand(getpid());", "pthread_create(&t,", "NULL,", "fork_thread,", "NULL);", "usleep(rand()", "%", "10000);", "syscall(__NR_exit_group,", "0);", "}", "wait(NULL);", "}", "}", "Note:", "the", "reproducer", "takes", "advantage", "of", "the", "fact", "that", "alloc_ldt_struct()", "may", "use", "vmalloc()", "to", "allocate", "a", "large", "->entries", "array,", "and", "after", "commit:", "5d17a73a2ebe", "(\"vmalloc:", "back", "off", "when", "the", "current", "task", "is", "killed\")", "it", "is", "possible", "for", "userspace", "to", "fail", "a", "task's", "vmalloc()", "by", "sending", "a", "fatal", "signal,", "e.g.", "via", "exit_group().", "It", "would", "be", "more", "difficult", "to", "reproduce", "this", "bug", "on", "kernels", "without", "that", "commit.", "This", "bug", "only", "affected", "kernels", "with", "CONFIG_MODIFY_LDT_SYSCALL=y.", "Signed-off-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Acked-by:", "Dave", "Hansen", "<dave.hansen@linux.intel.com>", "Cc:", "<stable@vger.kernel.org>", "[v4.6+]", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Borislav", "Petkov", "<bp@alien8.de>", "Cc:", "Brian", "Gerst", "<brgerst@gmail.com>", "Cc:", "Christoph", "Hellwig", "<hch@lst.de>", "Cc:", "Denys", "Vlasenko", "<dvlasenk@redhat.com>", "Cc:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Michal", "Hocko", "<mhocko@suse.com>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "Tetsuo", "Handa", "<penguin-kernel@I-love.SAKURA.ne.jp>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "linux-mm@kvack.org", "Fixes:", "39a0526fb3f7", "(\"x86/mm:", "Factor", "out", "LDT", "init", "from", "context", "init\")", "Link:", "http://lkml.kernel.org/r/20170824175029.76040-1-ebiggers3@gmail.com", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["@", "@", "-", "140", ",", "9", "+", "140", ",", "7", "@", "@", "static", "inline", "int", "init_new_context", "(", "struct", "task_struct", "*", "tsk", ",", "mm", "-", ">", "context", ".", "execute_only_pkey", "=", "-", "1", ";", "}", "#", "endif", "init_new_context_ldt", "(", "tsk", ",", "mm", ")", ";", "return", "0", ";", "return", "init_new_context_ldt", "(", "tsk", ",", "mm", ")", ";", "}", "static", "inline", "void", "destroy_context", "(", "struct", "mm_struct", "*", "mm", ")", "{"], "docstring_tokens": ["by", "running", "a", "specially", "crafted", "program", "."]}
{"contents": ["cifs:", "fix", "unicode", "string", "area", "word", "alignment", "in", "session", "setup", "The", "handling", "of", "unicode", "string", "area", "alignment", "is", "wrong.", "decode_unicode_ssetup", "improperly", "assumes", "that", "it", "will", "always", "be", "preceded", "by", "a", "pad", "byte.", "This", "isn't", "the", "case", "if", "the", "string", "area", "is", "already", "word-aligned.", "This", "problem,", "combined", "with", "the", "bad", "buffer", "sizing", "for", "the", "serverDomain", "string", "can", "cause", "memory", "corruption.", "The", "bad", "alignment", "can", "make", "it", "so", "that", "the", "alignment", "of", "the", "characters", "is", "off.", "This", "can", "make", "them", "translate", "to", "characters", "that", "are", "greater", "than", "2", "bytes", "each.", "If", "this", "happens", "we", "can", "overflow", "the", "allocation.", "Fix", "this", "by", "fixing", "the", "alignment", "in", "CIFS_SessSetup", "instead", "so", "we", "can", "verify", "it", "against", "the", "head", "of", "the", "response.", "Also,", "clean", "up", "the", "workaround", "for", "improperly", "terminated", "strings", "by", "checking", "for", "a", "odd-length", "unicode", "buffers", "and", "then", "forcibly", "terminating", "them.", "Finally,", "resize", "the", "buffer", "for", "serverDomain.", "Now", "that", "we've", "fixed", "the", "alignment,", "it's", "probably", "fine,", "but", "a", "malicious", "server", "could", "overflow", "it.", "A", "better", "solution", "for", "handling", "these", "strings", "is", "still", "needed,", "but", "this", "should", "be", "a", "suitable", "bandaid.", "Signed-off-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "CC:", "Stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["@", "@", "-", "285", ",", "27", "+", "285", ",", "26", "@", "@", "static", "int", "decode_unicode_ssetup", "(", "char", "*", "*", "pbcc_area", ",", "int", "bleft", ",", "int", "words_left", ",", "len", ";", "char", "*", "data", "=", "*", "pbcc_area", ";", "cFYI", "(", "1", ",", "(", "\"", "bleft", "%", "d", "\"", ",", "bleft", ")", ");", "/", "*", "SMB", "header", "is", "unaligned", ",", "so", "cifs", "servers", "word", "align", "start", "of", "Unicode", "strings", "*", "/", "data", "+", "+;", "bleft", "-", "-;", "/", "*", "Windows", "servers", "do", "not", "always", "double", "null", "terminate", "their", "final", "Unicode", "string", "-", "in", "which", "case", "we", "now", "will", "not", "attempt", "to", "decode", "the", "byte", "of", "junk", "which", "follows", "it", "*", "/", "/", "*", "*", "Windows", "servers", "do", "not", "always", "double", "null", "terminate", "their", "final", "*", "Unicode", "string", ".", "Check", "to", "see", "if", "there", "are", "an", "uneven", "number", "of", "bytes", "*", "left", ".", "If", "so", ",", "then", "add", "an", "extra", "NULL", "pad", "byte", "to", "the", "end", "of", "the", "*", "response", ".", "*", "*", "See", "section", "2", ".", "7", ".", "2", "in", "\"", "Implementing", "CIFS", "\"", "for", "details", "*", "/", "if", "(", "bleft", "%", "2", ")", "{", "data", "[", "bleft", "]", "=", "0", ";", "+", "+", "bleft", ";", "}", "words_left", "=", "bleft", "/", "2", ";", "/", "*", "save", "off", "server", "operating", "system", "*", "/", "len", "=", "UniStrnlen", "(", "(", "wchar_t", "*", ")", "data", ",", "words_left", ")", ";", "/", "*", "We", "look", "for", "obvious", "messed", "up", "bcc", "or", "strings", "in", "response", "so", "we", "do", "not", "go", "off", "the", "end", "since", "(", "at", "least", ")", "WIN2K", "and", "Windows", "XP", "have", "a", "major", "bug", "in", "not", "null", "terminating", "last", "Unicode", "string", "in", "response", "*", "/", "if", "(", "len", ">", "=", "words_left", ")", "return", "rc", ";", "@", "@", "-", "343", ",", "13", "+", "342", ",", "10", "@", "@", "static", "int", "decode_unicode_ssetup", "(", "char", "*", "*", "pbcc_area", ",", "int", "bleft", ",", "return", "rc", ";", "kfree", "(", "ses", "-", ">", "serverDomain", ")", ";", "ses", "-", ">", "serverDomain", "=", "kzalloc", "(", "2", "*", "(", "len", "+", "1", ")", ",", "GFP_KERNEL", ")", ";", "/", "*", "BB", "FIXME", "wrong", "length", "*", "/", "if", "(", "ses", "-", ">", "serverDomain", "!", "=", "NULL", ")", "{", "ses", "-", ">", "serverDomain", "=", "kzalloc", "(", "(", "4", "*", "len", ")", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "ses", "-", ">", "serverDomain", "!", "=", "NULL", ")", "cifs_strfromUCS_le", "(", "ses", "-", ">", "serverDomain", ",", "(", "__le16", "*", ")", "data", ",", "len", ",", "nls_cp", ")", ";", "ses", "-", ">", "serverDomain", "[", "2", "*", "len", "]", "=", "0", ";", "ses", "-", ">", "serverDomain", "[", "(", "2", "*", "len", ")", "+", "1", "]", "=", "0", ";", "}", "data", "+", "=", "2", "*", "(", "len", "+", "1", ")", ";", "words_left", "-", "=", "len", "+", "1", ";", "@", "@", "-", "702", ",", "12", "+", "698", ",", "18", "@", "@", "CIFS_SessSetup", "(", "unsigned", "int", "xid", ",", "struct", "cifsSesInfo", "*", "ses", ",", "int", "first_time", ",", "}", "/", "*", "BB", "check", "if", "Unicode", "and", "decode", "strings", "*", "/", "if", "(", "smb_buf", "-", ">", "Flags2", "&", "SMBFLG2_UNICODE", ")", "if", "(", "smb_buf", "-", ">", "Flags2", "&", "SMBFLG2_UNICODE", ")", "{", "/", "*", "unicode", "string", "area", "must", "be", "word", "-", "aligned", "*", "/", "if", "(", "((", "unsigned", "long", ")", "bcc_ptr", "-", "(", "unsigned", "long", ")", "smb_buf", ")", "%", "2", ")", "{", "+", "+", "bcc_ptr", ";", "-", "-", "bytes_remaining", ";", "}", "rc", "=", "decode_unicode_ssetup", "(", "&", "bcc_ptr", ",", "bytes_remaining", ",", "ses", ",", "nls_cp", ")", ";", "else", "ses", ",", "nls_cp", ")", ";", "}", "else", "{", "rc", "=", "decode_ascii_ssetup", "(", "&", "bcc_ptr", ",", "bytes_remaining", ",", "ses", ",", "nls_cp", ")", ";", "}", "ssetup_exit", ":", "if", "(", "spnego_key", ")", "{"], "docstring_tokens": ["sending", "an", "overly", "long", "string", "of", "misaligned", "characters"]}
{"contents": ["[SPARK-20922][CORE]", "Add", "whitelist", "of", "classes", "that", "can", "be", "deserialized", "by", "the", "launcher.", "Blindly", "deserializing", "classes", "using", "Java", "serialization", "opens", "the", "code", "up", "to", "issues", "in", "other", "libraries,", "since", "just", "deserializing", "data", "from", "a", "stream", "may", "end", "up", "execution", "code", "(think", "readObject()).", "Since", "the", "launcher", "protocol", "is", "pretty", "self-contained,", "there's", "just", "a", "handful", "of", "classes", "it", "legitimately", "needs", "to", "deserialize,", "and", "they're", "in", "just", "two", "packages,", "so", "add", "a", "filter", "that", "throws", "errors", "if", "classes", "from", "any", "other", "package", "show", "up", "in", "the", "stream.", "This", "also", "maintains", "backwards", "compatibility", "(the", "updated", "launcher", "code", "can", "still", "communicate", "with", "the", "backend", "code", "in", "older", "Spark", "releases).", "Tested", "with", "new", "and", "existing", "unit", "tests.", "Author:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>", "Closes", "#18166", "from", "vanzin/SPARK-20922.", "(cherry", "picked", "from", "commit", "8efc6e986554ae66eab93cd64a9035d716adbab0)", "Signed-off-by:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "53", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "spark", ".", "launcher", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "An", "object", "input", "stream", "that", "only", "allows", "classes", "used", "by", "the", "launcher", "protocol", "to", "be", "in", "the", "*", "serialized", "stream", ".", "See", "SPARK", "-", "20922", ".", "*", "/", "class", "FilteredObjectInputStream", "extends", "ObjectInputStream", "{", "private", "static", "final", "List", "<", "String", ">", "ALLOWED_PACKAGES", "=", "Arrays", ".", "asList", "(", "\"", "org", ".", "apache", ".", "spark", ".", "launcher", ".", "\",", "\"", "java", ".", "lang", ".", "\")", ";", "FilteredObjectInputStream", "(", "InputStream", "is", ")", "throws", "IOException", "{", "super", "(", "is", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "boolean", "isValid", "=", "ALLOWED_PACKAGES", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ");", "if", "(", "!", "isValid", ")", "{", "throw", "new", "IllegalArgumentException", "(", "String", ".", "format", "(", "\"", "Unexpected", "class", "in", "stream", ":", "%", "s", "\"", ",", "desc", ".", "getName", "(", "))", ");", "}", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "import", "java", ".", "io", ".", "Closeable", ";", "import", "java", ".", "io", ".", "EOFException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectOutputStream", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "@", "@", "-", "53", ",", "7", "+", "52", ",", "7", "@", "@", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "ObjectInputStream", "in", "=", "new", "ObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "FilteredObjectInputStream", "in", "=", "new", "FilteredObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "while", "(", "!", "closed", ")", "{", "Message", "msg", "=", "(", "Message", ")", "in", ".", "readObject", "(", ");", "handle", "(", "msg", ")", ";", "@", "@", "-", "19", ",", "8", "+", "19", ",", "11", "@", "@", "import", "java", ".", "io", ".", "Closeable", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "BlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "LinkedBlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Semaphore", ";", "@", "@", "-", "120", ",", "31", "+", "123", ",", "7", "@", "@", "public", "void", "testTimeout", "(", ")", "throws", "Exception", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "/", "/", "Try", "a", "few", "times", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "server", "-", "side", "close", "/", "/", "immediately", ".", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "handle", ".", "getSecret", "(", "),", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "exception", "caused", "by", "connection", "timeout", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "}", "finally", "{", "SparkLauncher", ".", "launcherConfig", ".", "remove", "(", "SparkLauncher", ".", "CHILD_CONNECTION_TIMEOUT", ")", ";", "kill", "(", "handle", ")", ";", "@", "@", "-", "183", ",", "6", "+", "162", ",", "25", "@", "@", "public", "void", "infoChanged", "(", "SparkAppHandle", "handle", ")", "{", "}", "}", "@", "Test", "public", "void", "testStreamFiltering", "(", ")", "throws", "Exception", "{", "ChildProcAppHandle", "handle", "=", "LauncherServer", ".", "newAppHandle", "(", ");", "TestClient", "client", "=", "null", ";", "try", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "client", ".", "send", "(", "new", "EvilPayload", "(", "))", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "assertEquals", "(", "0", ",", "EvilPayload", ".", "EVIL_BIT", ")", ";", "}", "finally", "{", "kill", "(", "handle", ")", ";", "close", "(", "client", ")", ";", "client", ".", "clientThread", ".", "join", "(", ");", "}", "}", "private", "void", "kill", "(", "SparkAppHandle", "handle", ")", "{", "if", "(", "handle", "!", "=", "null", ")", "{", "handle", ".", "kill", "(", ");", "@", "@", "-", "199", ",", "6", "+", "197", ",", "35", "@", "@", "private", "void", "close", "(", "Closeable", "c", ")", "{", "}", "}", "/", "**", "*", "Try", "a", "few", "times", "to", "get", "a", "client", "-", "side", "error", ",", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "*", "server", "-", "side", "close", "immediately", ".", "*", "/", "private", "void", "waitForError", "(", "TestClient", "client", ",", "String", "secret", ")", "throws", "Exception", "{", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "secret", ",", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "error", "but", "message", "went", "through", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "}", "private", "static", "class", "TestClient", "extends", "LauncherConnection", "{", "final", "BlockingQueue", "<", "Message", ">", "inbound", ";", "@", "@", "-", "220", ",", "4", "+", "247", ",", "19", "@", "@", "protected", "void", "handle", "(", "Message", "msg", ")", "throws", "IOException", "{", "}", "private", "static", "class", "EvilPayload", "extends", "LauncherProtocol", ".", "Message", "{", "static", "int", "EVIL_BIT", "=", "0", ";", "/", "/", "This", "field", "should", "cause", "the", "launcher", "server", "to", "throw", "an", "error", "and", "not", "deserialize", "the", "/", "/", "message", ".", "private", "List", "<", "String", ">", "notAllowedField", "=", "Arrays", ".", "asList", "(", "\"", "disallowed", "\"", ");", "private", "void", "readObject", "(", "ObjectInputStream", "stream", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "stream", ".", "defaultReadObject", "(", ");", "EVIL_BIT", "=", "1", ";", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["xfs:", "don't", "call", "xfs_da_shrink_inode", "with", "NULL", "bp", "xfs_attr3_leaf_create", "may", "have", "errored", "out", "before", "instantiating", "a", "buffer,", "for", "example", "if", "the", "blkno", "is", "out", "of", "range.", "In", "that", "case", "there", "is", "no", "work", "to", "do", "to", "remove", "it,", "and", "in", "fact", "xfs_da_shrink_inode", "will", "lead", "to", "an", "oops", "if", "we", "try.", "This", "also", "seems", "to", "fix", "a", "flaw", "where", "the", "original", "error", "from", "xfs_attr3_leaf_create", "gets", "overwritten", "in", "the", "cleanup", "case,", "and", "it", "removes", "a", "pointless", "assignment", "to", "bp", "which", "isn't", "used", "after", "this.", "Bugzilla:", "https://bugzilla.kernel.org/show_bug.cgi?id=199969", "Reported-by:", "Xu,", "Wen", "<wen.xu@gatech.edu>", "Tested-by:", "Xu,", "Wen", "<wen.xu@gatech.edu>", "Signed-off-by:", "Eric", "Sandeen", "<sandeen@redhat.com>", "Reviewed-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>", "Signed-off-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>"], "code_tokens": ["@", "@", "-", "791", ",", "9", "+", "791", ",", "8", "@", "@", "xfs_attr_shortform_to_leaf", "(", "ASSERT", "(", "blkno", "=", "=", "0", ")", ";", "error", "=", "xfs_attr3_leaf_create", "(", "args", ",", "blkno", ",", "&", "bp", ")", ";", "if", "(", "error", ")", "{", "error", "=", "xfs_da_shrink_inode", "(", "args", ",", "0", ",", "bp", ")", ";", "bp", "=", "NULL", ";", "if", "(", "error", ")", "/", "*", "xfs_attr3_leaf_create", "may", "not", "have", "instantiated", "a", "block", "*", "/", "if", "(", "bp", "&", "&", "(", "xfs_da_shrink_inode", "(", "args", ",", "0", ",", "bp", ")", "!", "=", "0", ")", ")", "goto", "out", ";", "xfs_idata_realloc", "(", "dp", ",", "size", ",", "XFS_ATTR_FORK", ")", ";", "/", "*", "try", "to", "put", "*", "/", "memcpy", "(", "ifp", "-", ">", "if_u1", ".", "if_data", ",", "tmpbuffer", ",", "size", ")", ";", "/", "*", "it", "back", "*", "/"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["Correct", "a", "regression", "in", "transfer-encoding", "parsing", "Invalid", "tokens", "are", "an", "error"], "code_tokens": ["@", "@", "-", "723", ",", "10", "+", "723", ",", "14", "@", "@", "private", "void", "prepareRequest", "(", ")", "throws", "IOException", "{", "MessageBytes", "transferEncodingValueMB", "=", "headers", ".", "getValue", "(", "\"", "transfer", "-", "encoding", "\"", ");", "if", "(", "transferEncodingValueMB", "!", "=", "null", ")", "{", "List", "<", "String", ">", "encodingNames", "=", "new", "ArrayList", "<", ">(", ");", "TokenList", ".", "parseTokenList", "(", "headers", ".", "values", "(", "\"", "transfer", "-", "encoding", "\"", "),", "encodingNames", ")", ";", "for", "(", "String", "encodingName", ":", "encodingNames", ")", "{", "/", "/", "\"", "identity", "\"", "codings", "are", "ignored", "addInputFilter", "(", "inputFilters", ",", "encodingName", ")", ";", "if", "(", "TokenList", ".", "parseTokenList", "(", "headers", ".", "values", "(", "\"", "transfer", "-", "encoding", "\"", "),", "encodingNames", ")", ")", "{", "for", "(", "String", "encodingName", ":", "encodingNames", ")", "{", "/", "/", "\"", "identity", "\"", "codings", "are", "ignored", "addInputFilter", "(", "inputFilters", ",", "encodingName", ")", ";", "}", "}", "else", "{", "/", "/", "Invalid", "transfer", "encoding", "badRequest", "(", "\"", "http11processor", ".", "request", ".", "invalidTransferEncoding", "\"", ");", "}", "}", "}", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "http11processor", ".", "header", ".", "parse", "=", "Error", "parsing", "HTTP", "request", "header", "http11processor", ".", "request", ".", "finish", "=", "Error", "finishing", "request", "http11processor", ".", "request", ".", "inconsistentHosts", "=", "The", "host", "specified", "in", "the", "request", "line", "is", "not", "consistent", "with", "the", "host", "header", "http11processor", ".", "request", ".", "invalidScheme", "=", "The", "HTTP", "request", "contained", "an", "absolute", "URI", "with", "an", "invalid", "scheme", "http11processor", ".", "request", ".", "invalidTransferEncoding", "=", "The", "HTTP", "request", "contained", "an", "invalid", "Transfer", "-", "Encoding", "header", "http11processor", ".", "request", ".", "invalidUri", "=", "The", "HTTP", "request", "contained", "an", "invalid", "URI", "http11processor", ".", "request", ".", "invalidUserInfo", "=", "The", "HTTP", "request", "contained", "an", "absolute", "URI", "with", "an", "invalid", "userinfo", "http11processor", ".", "request", ".", "multipleContentLength", "=", "The", "request", "contained", "multiple", "content", "-", "length", "headers", "@", "@", "-", "34", ",", "37", "+", "34", ",", "51", "@", "@", "private", "TokenList", "(", ")", "{", "*", "Parses", "an", "enumeration", "of", "header", "values", "of", "the", "form", "1", "#", "token", ",", "forcing", "all", "*", "parsed", "values", "to", "lower", "case", ".", "*", "*", "@", "param", "inputs", "The", "headers", "to", "parse", "*", "@", "param", "result", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "@", "param", "inputs", "The", "headers", "to", "parse", "*", "@", "param", "collection", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "*", "@", "return", "{", "@", "code", "}", "true", "if", "the", "header", "values", "were", "parsed", "cleanly", ",", "otherwise", "*", "{", "@", "code", "false", "}", "(", "e", ".", "g", ".", "if", "a", "non", "-", "token", "value", "was", "encountered", ")", "*", "*", "@", "throws", "IOException", "If", "an", "I", "/", "O", "error", "occurs", "reading", "the", "header", "*", "/", "public", "static", "void", "parseTokenList", "(", "Enumeration", "<", "String", ">", "inputs", ",", "Collection", "<", "String", ">", "result", ")", "throws", "IOException", "{", "public", "static", "boolean", "parseTokenList", "(", "Enumeration", "<", "String", ">", "inputs", ",", "Collection", "<", "String", ">", "collection", ")", "throws", "IOException", "{", "boolean", "result", "=", "true", ";", "while", "(", "inputs", ".", "hasMoreElements", "(", "))", "{", "String", "nextHeaderValue", "=", "inputs", ".", "nextElement", "(", ");", "if", "(", "nextHeaderValue", "!", "=", "null", ")", "{", "TokenList", ".", "parseTokenList", "(", "new", "StringReader", "(", "nextHeaderValue", ")", ",", "result", ")", ";", "if", "(", "!", "TokenList", ".", "parseTokenList", "(", "new", "StringReader", "(", "nextHeaderValue", ")", ",", "collection", ")", ")", "{", "result", "=", "false", ";", "}", "}", "}", "return", "result", ";", "}", "/", "**", "*", "Parses", "a", "header", "of", "the", "form", "1", "#", "token", ",", "forcing", "all", "parsed", "values", "to", "lower", "*", "case", ".", "This", "is", "typically", "used", "when", "header", "values", "are", "case", "-", "insensitive", ".", "*", "*", "@", "param", "input", "The", "header", "to", "parse", "*", "@", "param", "result", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "@", "param", "input", "The", "header", "to", "parse", "*", "@", "param", "collection", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "*", "@", "return", "{", "@", "code", "}", "true", "if", "the", "header", "was", "parsed", "cleanly", ",", "otherwise", "*", "{", "@", "code", "false", "}", "(", "e", ".", "g", ".", "if", "a", "non", "-", "token", "value", "was", "encountered", ")", "*", "*", "@", "throws", "IOException", "If", "an", "I", "/", "O", "error", "occurs", "reading", "the", "header", "*", "/", "public", "static", "void", "parseTokenList", "(", "Reader", "input", ",", "Collection", "<", "String", ">", "result", ")", "throws", "IOException", "{", "public", "static", "boolean", "parseTokenList", "(", "Reader", "input", ",", "Collection", "<", "String", ">", "collection", ")", "throws", "IOException", "{", "boolean", "invalid", "=", "false", ";", "boolean", "valid", "=", "false", ";", "do", "{", "String", "fieldName", "=", "HttpParser", ".", "readToken", "(", "input", ")", ";", "if", "(", "fieldName", "=", "=", "null", ")", "{", "/", "/", "Invalid", "field", "-", "name", ",", "skip", "to", "the", "next", "one", "invalid", "=", "true", ";", "HttpParser", ".", "skipUntil", "(", "input", ",", "0", ",", "'", ",'", ");", "continue", ";", "}", "@", "@", "-", "77", ",", "16", "+", "91", ",", "23", "@", "@", "public", "static", "void", "parseTokenList", "(", "Reader", "input", ",", "Collection", "<", "String", ">", "result", ")", "throw", "SkipResult", "skipResult", "=", "HttpParser", ".", "skipConstant", "(", "input", ",", "\"", ",\"", ");", "if", "(", "skipResult", "=", "=", "SkipResult", ".", "EOF", ")", "{", "/", "/", "EOF", "result", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "valid", "=", "true", ";", "collection", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "break", ";", "}", "else", "if", "(", "skipResult", "=", "=", "SkipResult", ".", "FOUND", ")", "{", "result", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "valid", "=", "true", ";", "collection", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "continue", ";", "}", "else", "{", "/", "/", "Not", "a", "token", "-", "ignore", "it", "invalid", "=", "true", ";", "HttpParser", ".", "skipUntil", "(", "input", ",", "0", ",", "'", ",'", ");", "continue", ";", "}", "}", "while", "(", "true", ")", ";", "/", "/", "Only", "return", "true", "if", "at", "least", "one", "valid", "token", "was", "read", "and", "no", "invalid", "/", "/", "entries", "were", "found", "return", "valid", "&", "&", "!", "invalid", ";", "}", "}", "@", "@", "-", "31", ",", "15", "+", "31", ",", "15", "@", "@", "public", "void", "testAll", "(", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expected", "=", "new", "HashSet", "<", ">(", ");", "expected", ".", "add", "(", "\"*", "\")", ";", "doTestVary", "(", "\"*", "\",", "expected", ")", ";", "doTestVary", "(", "\"*", "\",", "expected", ",", "true", ")", ";", "}", "@", "Test", "public", "void", "testSingle", "(", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expected", "=", "new", "HashSet", "<", ">(", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", "\"", ",", "expected", ",", "true", ")", ";", "}", "@", "@", "-", "49", ",", "19", "+", "49", ",", "19", "@", "@", "public", "void", "testMultiple", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "true", ")", ";", "}", "@", "Test", "public", "void", "testEmptyString", "(", ")", "throws", "IOException", "{", "doTestVary", "(", "\"\"", ",", "Collections", ".", "emptySet", "(", "))", ";", "doTestVary", "(", "\"\"", ",", "Collections", ".", "emptySet", "(", "),", "false", ")", ";", "}", "@", "Test", "public", "void", "testSingleInvalid", "(", ")", "throws", "IOException", "{", "doTestVary", "(", "\"{", "{{", "\",", "Collections", ".", "emptySet", "(", "))", ";", "doTestVary", "(", "\"{", "{{", "\",", "Collections", ".", "emptySet", "(", "),", "false", ")", ";", "}", "@", "@", "-", "71", ",", "7", "+", "71", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidStart", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidMiddle", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "91", ",", "7", "+", "91", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidEnd", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "{", "{{", "\",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "{", "{{", "\",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "101", ",", "7", "+", "101", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidStart2", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "OK", "{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "OK", "{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "111", ",", "7", "+", "111", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidMiddle2", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "OK", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "OK", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "121", ",", "21", "+", "121", ",", "80", "@", "@", "public", "void", "testMultipleWithInvalidEnd2", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "OK", "{", "{{", "\",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "OK", "{", "{{", "\",", "expected", ",", "false", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "private", "void", "doTestVary", "(", "String", "input", ",", "Set", "<", "String", ">", "expected", ")", "throws", "IOException", "{", "private", "void", "doTestVary", "(", "String", "input", ",", "Set", "<", "String", ">", "expectedTokens", ",", "boolean", "expectedResult", ")", "throws", "IOException", "{", "StringReader", "reader", "=", "new", "StringReader", "(", "input", ")", ";", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", ">(", ");", "Vary", ".", "parseVary", "(", "reader", ",", "result", ")", ";", "Assert", ".", "assertEquals", "(", "expected", ",", "result", ")", ";", "Set", "<", "String", ">", "tokens", "=", "new", "HashSet", "<", ">(", ");", "Vary", ".", "parseVary", "(", "reader", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "/", "/", "Can", "'", "t", "use", "reset", "(", ").", "Parser", "uses", "marks", ".", "reader", "=", "new", "StringReader", "(", "input", ")", ";", "result", ".", "clear", "(", ");", "TokenList", ".", "parseTokenList", "(", "reader", ",", "result", ")", ";", "Assert", ".", "assertEquals", "(", "expected", ",", "result", ")", ";", "tokens", ".", "clear", "(", ");", "boolean", "result", "=", "TokenList", ".", "parseTokenList", "(", "reader", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "Boolean", ".", "valueOf", "(", "expectedResult", ")", ",", "Boolean", ".", "valueOf", "(", "result", ")", ");", "}", "@", "Test", "public", "void", "testMultipleHeadersValidWithoutNull", "(", ")", "throws", "IOException", "{", "doTestMultipleHeadersValid", "(", "false", ")", ";", "}", "@", "Test", "public", "void", "testMultipleHeadersValidWithNull", "(", ")", "throws", "IOException", "{", "doTestMultipleHeadersValid", "(", "true", ")", ";", "}", "private", "void", "doTestMultipleHeadersValid", "(", "boolean", "withNull", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expectedTokens", "=", "new", "HashSet", "<", ">(", ");", "expectedTokens", ".", "add", "(", "\"", "bar", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo2", "\"", ");", "Set", "<", "String", ">", "inputs", "=", "new", "HashSet", "<", ">(", ");", "inputs", ".", "add", "(", "\"", "foo", "\"", ");", "if", "(", "withNull", ")", "{", "inputs", ".", "add", "(", "null", ")", ";", "}", "inputs", ".", "add", "(", "\"", "bar", ",", "foo2", "\"", ");", "Set", "<", "String", ">", "tokens", "=", "new", "HashSet", "<", ">(", ");", "boolean", "result", "=", "TokenList", ".", "parseTokenList", "(", "Collections", ".", "enumeration", "(", "inputs", ")", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "Assert", ".", "assertTrue", "(", "result", ")", ";", "}", "@", "Test", "public", "void", "doTestMultipleHeadersInvalid", "(", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expectedTokens", "=", "new", "HashSet", "<", ">(", ");", "expectedTokens", ".", "add", "(", "\"", "bar", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "bar2", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo2", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo3", "\"", ");", "Set", "<", "String", ">", "inputs", "=", "new", "HashSet", "<", ">(", ");", "inputs", ".", "add", "(", "\"", "foo", "\"", ");", "inputs", ".", "add", "(", "\"", "bar2", ",", "}", "}}", ",", "foo3", "\"", ");", "inputs", ".", "add", "(", "\"", "bar", ",", "foo2", "\"", ");", "Set", "<", "String", ">", "tokens", "=", "new", "HashSet", "<", ">(", ");", "boolean", "result", "=", "TokenList", ".", "parseTokenList", "(", "Collections", ".", "enumeration", "(", "inputs", ")", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "Assert", ".", "assertFalse", "(", "result", ")", ";", "}", "}", "@", "@", "-", "164", ",", "6", "+", "164", ",", "11", "@", "@", "Add", "support", "for", "RFC", "5915", "formatted", ",", "unencrypted", "EC", "key", "files", "when", "using", "a", "JSSE", "based", "TLS", "connector", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "fix", ">", "Correct", "a", "regression", "introduced", "in", "9", ".", "0", ".", "28", "that", "meant", "invalid", "tokens", "in", "the", "<", "code", ">", "Transfer", "-", "Encoding", "<", "/", "code", ">", "header", "were", "ignored", "rather", "than", "treated", "as", "an", "error", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["[FLINK-16697][metrics][jmx]", "Disable", "rebinding"], "code_tokens": ["@", "@", "-", "41", ",", "20", "+", "41", ",", "24", "@", "@", "import", "javax", ".", "management", ".", "NotCompliantMBeanException", ";", "import", "javax", ".", "management", ".", "ObjectName", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServerFactory", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXServiceURL", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIJRMPServerImpl", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "management", ".", "ManagementFactory", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "rmi", ".", "NoSuchObjectException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "/", "**", "*", "{", "@", "link", "MetricReporter", "}", "that", "exports", "{", "@", "link", "Metric", "Metrics", "}", "via", "JMX", ".", "@", "@", "-", "469", ",", "42", "+", "473", ",", "31", "@", "@", "public", "long", "getCount", "(", ")", "{", "/", "**", "*", "JMX", "Server", "implementation", "that", "JMX", "clients", "can", "connect", "to", ".", "*", "*", "<", "p", ">", "Heavily", "based", "on", "j256", "simplejmx", "project", "*", "<", "p", ">", "Originally", "based", "on", "j256", "simplejmx", "project", "*", "*", "<", "p", ">", "https", ":", "//", "github", ".", "com", "/", "j256", "/", "simplejmx", "/", "blob", "/", "master", "/", "src", "/", "main", "/", "java", "/", "com", "/", "j256", "/", "simplejmx", "/", "server", "/", "JmxServer", ".", "java", "*", "/", "private", "static", "class", "JMXServer", "{", "private", "Registry", "rmiRegistry", ";", "private", "JMXConnectorServer", "connector", ";", "private", "int", "port", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "rmiServerReference", "=", "new", "AtomicReference", "<", ">(", ");", "public", "void", "start", "(", "int", "port", ")", "throws", "IOException", "{", "if", "(", "rmiRegistry", "!", "=", "null", "&", "&", "connector", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "JMXServer", "is", "already", "running", ".", "\")", ";", "return", ";", "}", "startRmiRegistry", "(", "port", ")", ";", "startJmxService", "(", "port", ")", ";", "internalStart", "(", "port", ")", ";", "this", ".", "port", "=", "port", ";", "}", "/", "**", "*", "Starts", "an", "RMI", "Registry", "that", "allows", "clients", "to", "lookup", "the", "JMX", "IP", "/", "port", ".", "*", "*", "@", "param", "port", "rmi", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startRmiRegistry", "(", "int", "port", ")", "throws", "IOException", "{", "rmiRegistry", "=", "LocateRegistry", ".", "createRegistry", "(", "port", ")", ";", "}", "private", "void", "internalStart", "(", "int", "port", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "/", "/", "this", "allows", "clients", "to", "lookup", "the", "JMX", "service", "rmiRegistry", "=", "new", "JmxRegistry", "(", "port", ",", "\"", "jmxrmi", "\"", ",", "rmiServerReference", ")", ";", "/", "**", "*", "Starts", "a", "JMX", "connector", "that", "allows", "(", "un", ")", "registering", "MBeans", "with", "the", "MBean", "server", "and", "RMI", "invocations", ".", "*", "*", "@", "param", "port", "jmx", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "String", "serviceUrl", "=", "\"", "service", ":", "jmx", ":", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jndi", "/", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jmxrmi", "\"", ";", "JMXServiceURL", "url", ";", "try", "{", "@", "@", "-", "513", ",", "12", "+", "506", ",", "20", "@", "@", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Malformed", "service", "url", "created", "\"", "+", "serviceUrl", ",", "e", ")", ";", "}", "connector", "=", "JMXConnectorServerFactory", ".", "newJMXConnectorServer", "(", "url", ",", "null", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "final", "RMIJRMPServerImpl", "rmiServer", "=", "new", "RMIJRMPServerImpl", "(", "port", ",", "null", ",", "null", ",", "null", ")", ";", "connector", "=", "new", "RMIConnectorServer", "(", "url", ",", "null", ",", "rmiServer", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "connector", ".", "start", "(", ");", "/", "/", "we", "can", "'", "t", "pass", "the", "created", "stub", "directly", "to", "the", "registry", "since", "this", "would", "form", "a", "cyclic", "dependency", ":", "/", "/", "-", "you", "can", "only", "start", "the", "connector", "after", "the", "registry", "was", "started", "/", "/", "-", "you", "can", "only", "create", "the", "stub", "after", "the", "connector", "was", "started", "/", "/", "-", "you", "can", "only", "start", "the", "registry", "after", "the", "stub", "was", "created", "rmiServerReference", ".", "set", "(", "rmiServer", ".", "toStub", "(", "))", ";", "}", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "if", "(", "connector", "!", "=", "null", ")", "{", "try", "{", "connector", ".", "stop", "(", ");", "@", "@", "-", "536", ",", "5", "+", "537", ",", "51", "@", "@", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "}", "}", "}", "/", "**", "*", "A", "registry", "that", "only", "exposes", "a", "single", "remote", "object", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "restriction", "\"", ")", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "final", "String", "lookupName", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ";", "JmxRegistry", "(", "final", "int", "port", ",", "final", "String", "lookupName", ",", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ")", "throws", "RemoteException", "{", "super", "(", "port", ")", ";", "this", ".", "lookupName", "=", "lookupName", ";", "this", ".", "remoteServerStub", "=", "remoteServerStub", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "s", ")", "throws", "NotBoundException", "{", "if", "(", "lookupName", ".", "equals", "(", "s", ")", ")", "{", "final", "Remote", "remote", "=", "remoteServerStub", ".", "get", "(", ");", "if", "(", "remote", "!", "=", "null", ")", "{", "return", "remote", ";", "}", "}", "throw", "new", "NotBoundException", "(", "\"", "Not", "bound", ".", "\")", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "start", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "unbind", "(", "String", "s", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "stop", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "rebind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "might", "as", "well", "not", "throw", "an", "exception", "here", "given", "that", "the", "others", "don", "'", "t", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "{", "return", "new", "String", "[", "]{", "lookupName", "}", ";", "}", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["[FIXED", "SECURITY-89]", "When", "checking", "an", "API", "token,", "verify", "that", "the", "user", "actually", "exists."], "code_tokens": ["@", "@", "-", "2", ",", "9", "+", "2", ",", "13", "@", "@", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "hudson", ".", "security", ".", "UserMayOrMayNotExistException", ";", "import", "hudson", ".", "util", ".", "Scrambler", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "acegisecurity", ".", "context", ".", "SecurityContext", ";", "import", "org", ".", "acegisecurity", ".", "context", ".", "SecurityContextHolder", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UsernameNotFoundException", ";", "import", "org", ".", "springframework", ".", "dao", ".", "DataAccessException", ";", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "@", "@", "-", "41", ",", "6", "+", "45", ",", "17", "@", "@", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterCha", "int", "idx", "=", "uidpassword", ".", "indexOf", "(", "':", "')", ";", "if", "(", "idx", ">", "=", "0", ")", "{", "String", "username", "=", "uidpassword", ".", "substring", "(", "0", ",", "idx", ")", ";", "try", "{", "Jenkins", ".", "getInstance", "(", ").", "getSecurityRealm", "(", ").", "loadUserByUsername", "(", "username", ")", ";", "}", "catch", "(", "UserMayOrMayNotExistException", "x", ")", "{", "/", "/", "OK", ",", "give", "them", "the", "benefit", "of", "the", "doubt", ".", "}", "catch", "(", "UsernameNotFoundException", "x", ")", "{", "/", "/", "Not", "/", "no", "longer", "a", "user", ";", "deny", "the", "API", "token", ".", "(", "But", "do", "not", "leak", "the", "information", "that", "this", "happened", ".", ")", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "return", ";", "}", "catch", "(", "DataAccessException", "x", ")", "{", "throw", "new", "ServletException", "(", "x", ")", ";", "}", "String", "password", "=", "uidpassword", ".", "substring", "(", "idx", "+", "1", ")", ";", "/", "/", "attempt", "to", "authenticate", "as", "API", "token"], "docstring_tokens": ["via", "the", "token", "."]}
{"contents": ["Fixed", "bug", "#71587", "-", "Use-After-Free", "/", "Double-Free", "in", "WDDX", "Deserialize"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "43", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "71587", "(", "Use", "-", "After", "-", "Free", "/", "Double", "-", "Free", "in", "WDDX", "Deserialize", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "wddx", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "xml", "=", "<", "<<", "EOF", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "?", ">", "<", "!", "DOCTYPE", "wddxPacket", "SYSTEM", "'", "wddx_0100", ".", "dtd", "'", ">", "<", "wddxPacket", "version", "=", "'", "1", ".", "0", "'", ">", "<", "array", ">", "<", "var", "name", "=", "'", "ML", "'", "><", "/", "var", ">", "<", "string", ">", "manhluat", "<", "/", "string", ">", "<", "var", "name", "=", "'", "ML2", "'", "><", "/", "var", ">", "<", "boolean", "value", "=", "'", "a", "'", "/>", "<", "boolean", "value", "=", "'", "true", "'", "/>", "<", "/", "array", ">", "<", "/", "wddxPacket", ">", "EOF", ";", "$", "wddx", "=", "wddx_deserialize", "(", "$", "xml", ")", ";", "var_dump", "(", "$", "wddx", ")", ";", "/", "/", "Print", "mem", "leak", "foreach", "(", "$", "wddx", "as", "$", "k", "=", ">$", "v", ")", "printf", "(", "\"", "Key", ":", "%", "s", "\\", "nValue", ":", "%", "s", "\\", "n", "\"", ",", "bin2hex", "(", "$", "k", ")", ",", "bin2hex", "(", "$", "v", ")", ");", "?", ">", "DONE", "-", "-", "EXPECTF", "-", "-", "array", "(", "2", ")", "{", "[", "0", "]", "=>", "string", "(", "8", ")", "\"", "manhluat", "\"", "[", "1", "]", "=>", "bool", "(", "true", ")", "}", "Key", ":", "30", "Value", ":", "6d616e686c756174", "Key", ":", "31", "Value", ":", "31", "DONE", "@", "@", "-", "936", ",", "6", "+", "936", ",", "16", "@", "@", "static", "void", "php_wddx_pop_element", "(", "void", "*", "user_data", ",", "const", "XML_Char", "*", "name", ")", "!", "strcmp", "(", "name", ",", "EL_DATETIME", ")", ")", "{", "wddx_stack_top", "(", "stack", ",", "(", "void", "*", "*)", "&", "ent1", ")", ";", "if", "(", "!", "ent1", "-", ">", "data", ")", "{", "if", "(", "stack", "-", ">", "top", ">", "1", ")", "{", "stack", "-", ">", "top", "-", "-;", "}", "else", "{", "stack", "-", ">", "done", "=", "1", ";", "}", "efree", "(", "ent1", ")", ";", "return", ";", "}", "if", "(", "!", "strcmp", "(", "name", ",", "EL_BINARY", ")", ")", "{", "int", "new_len", "=", "0", ";", "unsigned", "char", "*", "new_str", ";", "@", "@", "-", "1032", ",", "6", "+", "1042", ",", "7", "@", "@", "static", "void", "php_wddx_pop_element", "(", "void", "*", "user_data", ",", "const", "XML_Char", "*", "name", ")", "}", "}", "else", "if", "(", "!", "strcmp", "(", "name", ",", "EL_VAR", ")", "&", "&", "stack", "-", ">", "varname", ")", "{", "efree", "(", "stack", "-", ">", "varname", ")", ";", "stack", "-", ">", "varname", "=", "NULL", ";", "}", "else", "if", "(", "!", "strcmp", "(", "name", ",", "EL_FIELD", ")", ")", "{", "st_entry", "*", "ent", ";", "wddx_stack_top", "(", "stack", ",", "(", "void", "*", "*)", "&", "ent", ")", ";", "@", "@", "-", "1051", ",", "7", "+", "1062", ",", "7", "@", "@", "static", "void", "php_wddx_process_data", "(", "void", "*", "user_data", ",", "const", "XML_Char", "*", "s", ",", "int", "len", ")", "if", "(", "!", "wddx_stack_is_empty", "(", "stack", ")", "&", "&", "!", "stack", "-", ">", "done", ")", "{", "wddx_stack_top", "(", "stack", ",", "(", "void", "*", "*)", "&", "ent", ")", ";", "switch", "(", "Z_TYPE_P", "(", "ent", ")", ")", "{", "switch", "(", "ent", "-", ">", "type", ")", "{", "case", "ST_STRING", ":", "if", "(", "Z_STRLEN_P", "(", "ent", "-", ">", "data", ")", "=", "=", "0", ")", "{", "STR_FREE", "(", "Z_STRVAL_P", "(", "ent", "-", ">", "data", ")", ");", "@", "@", "-", "1090", ",", "11", "+", "1101", ",", "11", "@", "@", "static", "void", "php_wddx_process_data", "(", "void", "*", "user_data", ",", "const", "XML_Char", "*", "s", ",", "int", "len", ")", "}", "else", "if", "(", "!", "strcmp", "(", "s", ",", "\"", "false", "\"", "))", "{", "Z_LVAL_P", "(", "ent", "-", ">", "data", ")", "=", "0", ";", "}", "else", "{", "stack", "-", ">", "top", "-", "-;", "zval_ptr_dtor", "(", "&", "ent", "-", ">", "data", ")", ";", "if", "(", "ent", "-", ">", "varname", ")", "if", "(", "ent", "-", ">", "varname", ")", "{", "efree", "(", "ent", "-", ">", "varname", ")", ";", "efree", "(", "ent", ")", ";", "}", "ent", "-", ">", "data", "=", "NULL", ";", "}", "break", ";"], "docstring_tokens": ["sending", "specially", "crafted", "data"]}
{"contents": ["arm:", "oabi", "compat:", "add", "missing", "access", "checks", "Add", "access", "checks", "to", "sys_oabi_epoll_wait()", "and", "sys_oabi_semtimedop().", "This", "fixes", ",", "a", "local", "privilege", "escalation", "under", "CONFIG_OABI_COMPAT.", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Chiachih", "Wu", "<wuchiachih@gmail.com>", "Reviewed-by:", "Kees", "Cook", "<keescook@chromium.org>", "Reviewed-by:", "Nicolas", "Pitre", "<nico@linaro.org>", "Signed-off-by:", "Dave", "Weinstein", "<olorin@google.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "279", ",", "8", "+", "279", ",", "12", "@", "@", "asmlinkage", "long", "sys_oabi_epoll_wait", "(", "int", "epfd", ",", "mm_segment_t", "fs", ";", "long", "ret", ",", "err", ",", "i", ";", "if", "(", "maxevents", "<", "=", "0", "|", "|", "maxevents", ">", "(", "INT_MAX", "/", "sizeof", "(", "struct", "epoll_event", ")", "))", "if", "(", "maxevents", "<", "=", "0", "|", "|", "maxevents", ">", "(", "INT_MAX", "/", "sizeof", "(", "*", "kbuf", ")", ")", "|", "|", "maxevents", ">", "(", "INT_MAX", "/", "sizeof", "(", "*", "events", ")", "))", "return", "-", "EINVAL", ";", "if", "(", "!", "access_ok", "(", "VERIFY_WRITE", ",", "events", ",", "sizeof", "(", "*", "events", ")", "*", "maxevents", ")", ")", "return", "-", "EFAULT", ";", "kbuf", "=", "kmalloc", "(", "sizeof", "(", "*", "kbuf", ")", "*", "maxevents", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "kbuf", ")", "return", "-", "ENOMEM", ";", "@", "@", "-", "317", ",", "6", "+", "321", ",", "8", "@", "@", "asmlinkage", "long", "sys_oabi_semtimedop", "(", "int", "semid", ",", "if", "(", "nsops", "<", "1", "|", "|", "nsops", ">", "SEMOPM", ")", "return", "-", "EINVAL", ";", "if", "(", "!", "access_ok", "(", "VERIFY_READ", ",", "tsops", ",", "sizeof", "(", "*", "tsops", ")", "*", "nsops", ")", ")", "return", "-", "EFAULT", ";", "sops", "=", "kmalloc", "(", "sizeof", "(", "*", "sops", ")", "*", "nsops", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "sops", ")", "return", "-", "ENOMEM", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "install", "a", "specially-crafted", "application"]}
{"contents": ["sysctl:", "don't", "overflow", "the", "user-supplied", "buffer", "with", "'\\0'", "If", "the", "string", "was", "too", "long", "to", "fit", "in", "the", "user-supplied", "buffer,", "the", "sysctl", "layer", "would", "zero-terminate", "it", "by", "writing", "past", "the", "end", "of", "the", "buffer.", "Don't", "do", "that.", "Noticed", "by", "Yi", "Yang", "<yang.y.yi@gmail.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "2201", ",", "14", "+", "2201", ",", "12", "@", "@", "int", "sysctl_string", "(", "ctl_table", "*", "table", ",", "int", "__user", "*", "name", ",", "int", "nlen", ",", "if", "(", "get_user", "(", "len", ",", "oldlenp", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "len", ")", "{", "l", "=", "strlen", "(", "table", "-", ">", "data", ")", ";", "l", "=", "strlen", "(", "table", "-", ">", "data", ")", "+", "1", ";", "if", "(", "len", ">", "l", ")", "len", "=", "l", ";", "if", "(", "len", ">", "=", "table", "-", ">", "maxlen", ")", "len", "=", "table", "-", ">", "maxlen", ";", "if", "(", "copy_to_user", "(", "oldval", ",", "table", "-", ">", "data", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "put_user", "(", "0", ",", "(", "(", "char", "__user", "*", ")", "oldval", ")", "+", "len", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "put_user", "(", "len", ",", "oldlenp", ")", ")", "return", "-", "EFAULT", ";", "}"], "docstring_tokens": ["which", "causes", "sysctl", "to", "write", "a", "zero", "byte", "outside", "the", "buffer", "."]}
{"contents": ["IB/uverbs:", "Handle", "large", "number", "of", "entries", "in", "poll", "CQ", "In", "ib_uverbs_poll_cq()", "code", "there", "is", "a", "potential", "integer", "overflow", "if", "userspace", "passes", "in", "a", "large", "cmd.ne.", "The", "calls", "to", "kmalloc()", "would", "allocate", "smaller", "buffers", "than", "intended,", "leading", "to", "memory", "corruption.", "There", "iss", "also", "an", "information", "leak", "if", "resp", "wasn't", "all", "used.", "Unprivileged", "userspace", "may", "call", "this", "function,", "although", "only", "if", "an", "RDMA", "device", "that", "uses", "this", "function", "is", "present.", "Fix", "this", "by", "copying", "CQ", "entries", "one", "at", "a", "time,", "which", "avoids", "the", "allocation", "entirely,", "and", "also", "by", "moving", "this", "copying", "into", "a", "function", "that", "makes", "sure", "to", "initialize", "all", "memory", "copied", "to", "userspace.", "Special", "thanks", "to", "Jason", "Gunthorpe", "<jgunthorpe@obsidianresearch.com>", "for", "his", "help", "and", "advice.", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Dan", "Carpenter", "<error27@gmail.com>", "[", "Monkey", "around", "with", "things", "a", "bit", "to", "avoid", "bad", "code", "generation", "by", "gcc", "when", "designated", "initializers", "are", "used.", "-", "Roland", "]", "Signed-off-by:", "Roland", "Dreier", "<rolandd@cisco.com>"], "code_tokens": ["@", "@", "-", "893", ",", "68", "+", "893", ",", "81", "@", "@", "ssize_t", "ib_uverbs_resize_cq", "(", "struct", "ib_uverbs_file", "*", "file", ",", "return", "ret", "?", "ret", ":", "in_len", ";", "}", "static", "int", "copy_wc_to_user", "(", "void", "__user", "*", "dest", ",", "struct", "ib_wc", "*", "wc", ")", "{", "struct", "ib_uverbs_wc", "tmp", ";", "tmp", ".", "wr_id", "=", "wc", "-", ">", "wr_id", ";", "tmp", ".", "status", "=", "wc", "-", ">", "status", ";", "tmp", ".", "opcode", "=", "wc", "-", ">", "opcode", ";", "tmp", ".", "vendor_err", "=", "wc", "-", ">", "vendor_err", ";", "tmp", ".", "byte_len", "=", "wc", "-", ">", "byte_len", ";", "tmp", ".", "ex", ".", "imm_data", "=", "(", "__u32", "__force", ")", "wc", "-", ">", "ex", ".", "imm_data", ";", "tmp", ".", "qp_num", "=", "wc", "-", ">", "qp", "-", ">", "qp_num", ";", "tmp", ".", "src_qp", "=", "wc", "-", ">", "src_qp", ";", "tmp", ".", "wc_flags", "=", "wc", "-", ">", "wc_flags", ";", "tmp", ".", "pkey_index", "=", "wc", "-", ">", "pkey_index", ";", "tmp", ".", "slid", "=", "wc", "-", ">", "slid", ";", "tmp", ".", "sl", "=", "wc", "-", ">", "sl", ";", "tmp", ".", "dlid_path_bits", "=", "wc", "-", ">", "dlid_path_bits", ";", "tmp", ".", "port_num", "=", "wc", "-", ">", "port_num", ";", "tmp", ".", "reserved", "=", "0", ";", "if", "(", "copy_to_user", "(", "dest", ",", "&", "tmp", ",", "sizeof", "tmp", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "ssize_t", "ib_uverbs_poll_cq", "(", "struct", "ib_uverbs_file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "int", "in_len", ",", "int", "out_len", ")", "{", "struct", "ib_uverbs_poll_cq", "cmd", ";", "struct", "ib_uverbs_poll_cq_resp", "*", "resp", ";", "struct", "ib_uverbs_poll_cq_resp", "resp", ";", "u8", "__user", "*", "header_ptr", ";", "u8", "__user", "*", "data_ptr", ";", "struct", "ib_cq", "*", "cq", ";", "struct", "ib_wc", "*", "wc", ";", "int", "ret", "=", "0", ";", "int", "i", ";", "int", "rsize", ";", "struct", "ib_wc", "wc", ";", "int", "ret", ";", "if", "(", "copy_from_user", "(", "&", "cmd", ",", "buf", ",", "sizeof", "cmd", ")", ")", "return", "-", "EFAULT", ";", "wc", "=", "kmalloc", "(", "cmd", ".", "ne", "*", "sizeof", "*", "wc", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "wc", ")", "return", "-", "ENOMEM", ";", "rsize", "=", "sizeof", "*", "resp", "+", "cmd", ".", "ne", "*", "sizeof", "(", "struct", "ib_uverbs_wc", ")", ";", "resp", "=", "kmalloc", "(", "rsize", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "resp", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "out_wc", ";", "}", "cq", "=", "idr_read_cq", "(", "cmd", ".", "cq_handle", ",", "file", "-", ">", "ucontext", ",", "0", ")", ";", "if", "(", "!", "cq", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "if", "(", "!", "cq", ")", "return", "-", "EINVAL", ";", "resp", "-", ">", "count", "=", "ib_poll_cq", "(", "cq", ",", "cmd", ".", "ne", ",", "wc", ")", ";", "/", "*", "we", "copy", "a", "struct", "ib_uverbs_poll_cq_resp", "to", "user", "space", "*", "/", "header_ptr", "=", "(", "void", "__user", "*", ")(", "unsigned", "long", ")", "cmd", ".", "response", ";", "data_ptr", "=", "header_ptr", "+", "sizeof", "resp", ";", "put_cq_read", "(", "cq", ")", ";", "memset", "(", "&", "resp", ",", "0", ",", "sizeof", "resp", ")", ";", "while", "(", "resp", ".", "count", "<", "cmd", ".", "ne", ")", "{", "ret", "=", "ib_poll_cq", "(", "cq", ",", "1", ",", "&", "wc", ")", ";", "if", "(", "ret", "<", "0", ")", "goto", "out_put", ";", "if", "(", "!", "ret", ")", "break", ";", "ret", "=", "copy_wc_to_user", "(", "data_ptr", ",", "&", "wc", ")", ";", "if", "(", "ret", ")", "goto", "out_put", ";", "for", "(", "i", "=", "0", ";", "i", "<", "resp", "-", ">", "count", ";", "i", "+", "+)", "{", "resp", "-", ">", "wc", "[", "i", "]", ".", "wr_id", "=", "wc", "[", "i", "]", ".", "wr_id", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "status", "=", "wc", "[", "i", "]", ".", "status", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "opcode", "=", "wc", "[", "i", "]", ".", "opcode", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "vendor_err", "=", "wc", "[", "i", "]", ".", "vendor_err", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "byte_len", "=", "wc", "[", "i", "]", ".", "byte_len", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "ex", ".", "imm_data", "=", "(", "__u32", "__force", ")", "wc", "[", "i", "]", ".", "ex", ".", "imm_data", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "qp_num", "=", "wc", "[", "i", "]", ".", "qp", "-", ">", "qp_num", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "src_qp", "=", "wc", "[", "i", "]", ".", "src_qp", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "wc_flags", "=", "wc", "[", "i", "]", ".", "wc_flags", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "pkey_index", "=", "wc", "[", "i", "]", ".", "pkey_index", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "slid", "=", "wc", "[", "i", "]", ".", "slid", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "sl", "=", "wc", "[", "i", "]", ".", "sl", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "dlid_path_bits", "=", "wc", "[", "i", "]", ".", "dlid_path_bits", ";", "resp", "-", ">", "wc", "[", "i", "]", ".", "port_num", "=", "wc", "[", "i", "]", ".", "port_num", ";", "data_ptr", "+", "=", "sizeof", "(", "struct", "ib_uverbs_wc", ")", ";", "+", "+", "resp", ".", "count", ";", "}", "if", "(", "copy_to_user", "(", "(", "void", "__user", "*", ")", "(", "unsigned", "long", ")", "cmd", ".", "response", ",", "resp", ",", "rsize", ")", ")", "if", "(", "copy_to_user", "(", "header_ptr", ",", "&", "resp", ",", "sizeof", "resp", ")", ")", "{", "ret", "=", "-", "EFAULT", ";", "goto", "out_put", ";", "}", "out", ":", "kfree", "(", "resp", ")", ";", "ret", "=", "in_len", ";", "out_wc", ":", "kfree", "(", "wc", ")", ";", "return", "ret", "?", "ret", ":", "in_len", ";", "out_put", ":", "put_cq_read", "(", "cq", ")", ";", "return", "ret", ";", "}", "ssize_t", "ib_uverbs_req_notify_cq", "(", "struct", "ib_uverbs_file", "*", "file", ","], "docstring_tokens": ["via", "vectors", "that", "cause", "this", "buffer", "to", "be", "only", "partially", "filled"]}
{"contents": ["[SECURITY-402,SECURITY-403]", "Squashed", "commit", "of", "the", "following:", "commit", "0ad3bf0c4a82a47ee183bec085cf1e6537619d1a", "Merge:", "51c33ef", "0c80b27", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Tue", "Feb", "20", "16:38:01", "2018", "+0100", "Merge", "remote-tracking", "branch", "'origin'", "into", "SECURITY-403", "commit", "51c33ef34d46f5fc859d1273eb309a447b821bc7", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Fri", "Feb", "16", "17:50:24", "2018", "+0100", "[SECURITY-403]", "Fixing", "test", "after", "csrf", "commit", "f8c49b7ba45344559e16815f6d5a8ed69856c1f8", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Thu", "Feb", "15", "13:38:00", "2018", "+0100", "[SECURITY-403]", "Also", "try", "to", "prevent", "CSRF", "commit", "aaccb2517cf32accfbc67c1228e19c5cd5cad0dc", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Wed", "Feb", "14", "18:32:23", "2018", "+0100", "[SECURITY-403]", "Fixing", "the", "test", "commit", "8663e69ed5db3d6fb5f0d9e550b47de011570434", "Author:", "rsandell", "<rsandell@cloudbees.com>", "Date:", "Thu", "Feb", "1", "13:36:32", "2018", "+0100", "[SECURITY-402,SECURITY-403]", "More", "Admin", "checks", "One", "test", "failing", "that", "I", "haven't", "figured", "out", "why", "yet"], "code_tokens": ["@", "@", "-", "41", ",", "6", "+", "41", ",", "7", "@", "@", "import", "hudson", ".", "model", ".", "Hudson", ";", "import", "hudson", ".", "model", ".", "ManagementLink", ";", "import", "hudson", ".", "model", ".", "Saveable", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "jenkins", ".", "model", ".", "ModelObjectWithContextMenu", ";", "@", "@", "-", "52", ",", "6", "+", "53", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "bind", ".", "JavaScriptMethod", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "112", ",", "6", "+", "114", ",", "7", "@", "@", "public", "DescriptorImpl", "getDescriptor", "(", ")", "{", "@", "Override", "public", "ContextMenu", "doContextMenu", "(", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "Exception", "{", "checkPermission", "(", ");", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "assert", "jenkins", "!", "=", "null", ";", "ContextMenu", "menu", "=", "new", "ContextMenu", "(", ");", "@", "@", "-", "189", ",", "6", "+", "192", ",", "7", "@", "@", "public", "AutoCompletionCandidates", "doAutoCompleteCopyNewItemFrom", "(", "@", "QueryParameter", "fi", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "from", "Jelly", "public", "List", "<", "GerritServer", ">", "getServers", "(", ")", "{", "checkPermission", "(", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "if", "(", "plugin", "=", "=", "null", ")", "{", "return", "Collections", ".", "emptyList", "(", ");", "@", "@", "-", "204", ",", "6", "+", "208", ",", "7", "@", "@", "public", "AutoCompletionCandidates", "doAutoCompleteCopyNewItemFrom", "(", "@", "QueryParameter", "fi", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "from", "Jelly", "public", "GerritServer", "getServer", "(", "String", "encodedServerName", ")", "{", "checkPermission", "(", ");", "String", "serverName", ";", "try", "{", "serverName", "=", "URLDecoder", ".", "decode", "(", "encodedServerName", ",", "CharEncoding", ".", "UTF_8", ")", ";", "@", "@", "-", "259", ",", "7", "+", "264", ",", "9", "@", "@", "public", "JSONObject", "getServerStatuses", "(", ")", "{", "*", "@", "return", "the", "new", "GerritServer", "*", "@", "throws", "IOException", "when", "error", "sending", "redirect", "back", "to", "the", "list", "of", "servers", "*", "/", "@", "RequirePOST", "public", "GerritServer", "doAddNewServer", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", "{", "checkPermission", "(", ");", "String", "serverName", "=", "req", ".", "getParameter", "(", "\"", "name", "\"", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "assert", "plugin", "!", "=", "null", ";", "@", "@", "-", "384", ",", "6", "+", "391", ",", "7", "@", "@", "public", "GerritAdministrativeMonitor", "getAdministrativeMonitor", "(", ")", "{", "*", "@", "return", "ok", "or", "error", ".", "*", "/", "public", "FormValidation", "doNameFreeCheck", "(", "@", "QueryParameter", "(", "\"", "value", "\"", ")", "final", "String", "value", ")", "{", "checkPermission", "(", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "assert", "plugin", "!", "=", "null", ";", "if", "(", "plugin", ".", "containsServer", "(", "value", ")", ")", "{", "@", "@", "-", "404", ",", "9", "+", "412", ",", "11", "@", "@", "public", "FormValidation", "doNameFreeCheck", "(", "@", "QueryParameter", "(", "\"", "value", "\"", ")", "final", "String", "valu", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "RequirePOST", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "submit", "{", "}\"", ",", "req", ".", "toString", "(", "))", ";", "}", "@", "@", "-", "422", ",", "4", "+", "432", ",", "26", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "Servl", "rsp", ".", "sendRedirect", "(", "\".", "\")", ";", "}", "/", "**", "*", "Checks", "that", "the", "current", "user", "has", "{", "@", "link", "#", "getRequiredPermission", "(", ")}", "permission", ".", "*", "If", "Jenkins", "is", "currently", "active", ".", "*", "/", "private", "void", "checkPermission", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "if", "(", "jenkins", "!", "=", "null", ")", "{", "jenkins", ".", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "}", "}", "/", "**", "*", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "permission", ".", "*", "Also", "used", "by", "Jelly", "*", "*", "@", "return", "the", "permission", "*", "/", "@", "Override", "public", "Permission", "getRequiredPermission", "(", ")", "{", "return", "Jenkins", ".", "ADMINISTER", ";", "}", "}", "@", "@", "-", "39", ",", "6", "+", "39", ",", "7", "@", "@", "import", "hudson", ".", "model", ".", "Failure", ";", "import", "hudson", ".", "model", ".", "Descriptor", ";", "import", "hudson", ".", "model", ".", "Hudson", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "ListBoxModel", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "@", "@", "-", "88", ",", "6", "+", "89", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "bind", ".", "JavaScriptMethod", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Exported", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "ExportedBean", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "@", "@", "-", "235", ",", "6", "+", "237", ",", "7", "@", "@", "public", "IGerritHudsonTriggerConfig", "getConfig", "(", ")", "{", "*", "@", "param", "config", "the", "config", ".", "*", "/", "public", "void", "setConfig", "(", "IGerritHudsonTriggerConfig", "config", ")", "{", "checkPermission", "(", ");", "this", ".", "config", "=", "config", ";", "}", "@", "@", "-", "394", ",", "11", "+", "397", ",", "33", "@", "@", "public", "boolean", "isLastServer", "(", ")", "{", "return", "PluginImpl", ".", "getServers_", "(", ").", "size", "(", ")", "=", "=", "1", ";", "}", "/", "**", "*", "Checks", "that", "the", "current", "user", "has", "{", "@", "link", "#", "getRequiredPermission", "(", ")}", "permission", ".", "*", "If", "Jenkins", "is", "currently", "active", ".", "*", "/", "private", "void", "checkPermission", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "if", "(", "jenkins", "!", "=", "null", ")", "{", "jenkins", ".", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "}", "}", "/", "**", "*", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "permission", "for", "viewing", "and", "changing", "the", "configuration", ".", "*", "Also", "used", "by", "Jelly", "*", "*", "@", "return", "the", "permission", "*", "/", "public", "final", "Permission", "getRequiredPermission", "(", ")", "{", "return", "Jenkins", ".", "ADMINISTER", ";", "}", "/", "**", "*", "Starts", "the", "server", "'", "s", "project", "list", "updater", ",", "send", "command", "queue", "and", "event", "manager", ".", "*", "*", "/", "public", "void", "start", "(", ")", "{", "checkPermission", "(", ");", "logger", ".", "info", "(", "\"", "Starting", "GerritServer", ":", "\"", "+", "name", ")", ";", "/", "/", "do", "not", "try", "to", "connect", "to", "gerrit", "unless", "there", "is", "a", "URL", "or", "a", "hostname", "in", "the", "text", "fields", "@", "@", "-", "445", ",", "6", "+", "470", ",", "7", "@", "@", "private", "void", "initializeConnectionListener", "(", ")", "{", "*", "*", "/", "public", "void", "stop", "(", ")", "{", "checkPermission", "(", ");", "logger", ".", "info", "(", "\"", "Stopping", "GerritServer", "\"", "+", "name", ")", ";", "if", "(", "projectListUpdater", "!", "=", "null", ")", "{", "@", "@", "-", "521", ",", "6", "+", "547", ",", "7", "@", "@", "public", "GerritConnectionListener", "getGerritConnectionListener", "(", ")", "{", "*", "*", "/", "public", "synchronized", "void", "startConnection", "(", ")", "{", "checkPermission", "(", ");", "if", "(", "!", "config", ".", "hasDefaultValues", "(", "))", "{", "if", "(", "gerritConnection", "=", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "Starting", "Gerrit", "connection", ".", "..", "\")", ";", "@", "@", "-", "545", ",", "6", "+", "572", ",", "7", "@", "@", "public", "synchronized", "void", "startConnection", "(", ")", "{", "*", "*", "/", "public", "synchronized", "void", "stopConnection", "(", ")", "{", "checkPermission", "(", ");", "if", "(", "gerritConnection", "!", "=", "null", ")", "{", "gerritConnection", ".", "shutdown", "(", "true", ")", ";", "gerritConnection", ".", "removeListener", "(", "gerritConnectionListener", ")", ";", "@", "@", "-", "868", ",", "9", "+", "896", ",", "11", "@", "@", "public", "ListBoxModel", "doFillNotificationLevelItems", "(", ")", "{", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "RequirePOST", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "submit", "{", "}\"", ",", "req", ".", "toString", "(", "))", ";", "}", "@", "@", "-", "908", ",", "6", "+", "938", ",", "7", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "Servl", "*", "@", "param", "newName", "the", "new", "name", "*", "/", "private", "void", "rename", "(", "String", "newName", ")", "{", "checkPermission", "(", ");", "if", "(", "isConnected", "(", "))", "{", "stopConnection", "(", ");", "stop", "(", ");", "@", "@", "-", "1002", ",", "7", "+", "1033", ",", "9", "@", "@", "private", "void", "removeGerritTriggerInJobs", "(", ")", "{", "*", "*", "@", "return", "connection", "status", ".", "*", "/", "@", "RequirePOST", "public", "JSONObject", "doWakeup", "(", ")", "{", "checkPermission", "(", ");", "Timer", "timer", "=", "new", "Timer", "(", ");", "try", "{", "startConnection", "(", ");", "@", "@", "-", "1047", ",", "7", "+", "1080", ",", "9", "@", "@", "public", "void", "run", "(", ")", "{", "*", "*", "@", "return", "connection", "status", ".", "*", "/", "@", "RequirePOST", "public", "JSONObject", "doSleep", "(", ")", "{", "checkPermission", "(", ");", "Timer", "timer", "=", "new", "Timer", "(", ");", "try", "{", "stopConnection", "(", ");", "@", "@", "-", "1207", ",", "10", "+", "1242", ",", "12", "@", "@", "private", "void", "setConnectionResponse", "(", "String", "response", ")", "{", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "RequirePOST", "public", "void", "doRemoveConfirm", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "stopConnection", "(", ");", "stop", "(", ");", "PluginImpl", "plugin", "=", "PluginImpl", ".", "getInstance", "(", ");", "@", "@", "-", "1404", ",", "6", "+", "1441", ",", "7", "@", "@", "public", "FormValidation", "doValidTimeCheck", "(", "public", "FormValidation", "doNameFreeCheck", "(", "@", "QueryParameter", "(", "\"", "value", "\"", ")", "final", "String", "value", ")", "{", "checkPermission", "(", ");", "if", "(", "!", "value", ".", "equals", "(", "name", ")", ")", "{", "if", "(", "PluginImpl", ".", "containsServer_", "(", "value", ")", ")", "{", "return", "FormValidation", ".", "error", "(", "\"", "The", "server", "name", "\"", "+", "value", "+", "\"", "is", "already", "in", "use", "!", "\")", ";", "@", "@", "-", "282", ",", "6", "+", "282", ",", "7", "@", "@", "public", "static", "GerritServer", "getFirstServer_", "(", ")", "{", "*", "@", "param", "servers", "the", "list", "to", "be", "set", ".", "*", "/", "public", "void", "setServers", "(", "List", "<", "GerritServer", ">", "servers", ")", "{", "checkAdmin", "(", ");", "if", "(", "this", ".", "servers", "!", "=", "servers", ")", "{", "this", ".", "servers", ".", "clear", "(", ");", "this", ".", "servers", ".", "addAll", "(", "servers", ")", ";", "@", "@", "-", "295", ",", "6", "+", "296", ",", "7", "@", "@", "public", "void", "setServers", "(", "List", "<", "GerritServer", ">", "servers", ")", "{", "*", "@", "return", "the", "list", "after", "adding", "the", "server", ".", "*", "/", "public", "List", "<", "GerritServer", ">", "addServer", "(", "GerritServer", "s", ")", "{", "checkAdmin", "(", ");", "servers", ".", "add", "(", "s", ")", ";", "return", "servers", ";", "}", "@", "@", "-", "306", ",", "10", "+", "308", ",", "23", "@", "@", "public", "void", "setServers", "(", "List", "<", "GerritServer", ">", "servers", ")", "{", "*", "@", "return", "the", "list", "after", "removing", "the", "server", ".", "*", "/", "public", "List", "<", "GerritServer", ">", "removeServer", "(", "GerritServer", "s", ")", "{", "checkAdmin", "(", ");", "servers", ".", "remove", "(", "s", ")", ";", "return", "servers", ";", "}", "/", "**", "*", "Checks", "that", "the", "current", "user", "has", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "permission", ".", "*", "If", "Jenkins", "is", "currently", "active", ".", "*", "/", "private", "void", "checkAdmin", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "/", "/", "Hoping", "this", "method", "doesn", "'", "t", "change", "meaning", "again", "if", "(", "jenkins", "!", "=", "null", ")", "{", "/", "/", "If", "Jenkins", "is", "not", "alive", "then", "we", "are", "not", "started", ",", "so", "no", "unauthorised", "user", "might", "do", "anything", "jenkins", ".", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "}", "}", "/", "**", "*", "Check", "whether", "the", "list", "of", "servers", "contains", "a", "GerritServer", "object", "of", "a", "specific", "name", ".", "@", "@", "-", "1", ",", "7", "+", "1", ",", "7", "@", "@", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "d", "=", "\"", "jelly", ":", "define", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "t", "=", "\"/", "lib", "/", "hudson", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "i", "=", "\"", "jelly", ":", "fmt", "\"", ">", "<", "l", ":", "layout", "title", "=", "\"$", "{%", "Remove", "Server", "}", "\"", "norefresh", "=", "\"", "true", "\"", ">", "<", "l", ":", "layout", "title", "=", "\"$", "{%", "Remove", "Server", "}", "\"", "norefresh", "=", "\"", "true", "\"", "permission", "=", "\"$", "{", "it", ".", "requiredPermission", "}", "\">", "<", "l", ":", "side", "-", "panel", ">", "<", "l", ":", "tasks", ">", "<", "l", ":", "task", "icon", "=", "\"", "images", "/", "24x24", "/", "up", ".", "gif", "\"", "href", "=", "\"$", "{", "rootURL", "}", "/\"", "title", "=", "\"$", "{%", "Back", "to", "Dashboard", "}", "\"/", ">", "@", "@", "-", "22", ",", "6", "+", "22", ",", "8", "@", "@", "*", "THE", "SOFTWARE", ".", "*", "/", "/", "*", "global", "crumb", "*", "/", "function", "serverTable", "(", ")", "{", "'", "use", "strict", "'", ";", "/", "/", "private", "funcs", "@", "@", "-", "158", ",", "17", "+", "160", ",", "21", "@", "@", "function", "serverTable", "(", ")", "{", "dataTable", ".", "subscribe", "(", "\"", "buttonClickEvent", "\"", ",", "function", "(", "oArgs", ")", "{", "var", "elButton", "=", "oArgs", ".", "target", ";", "var", "oRecord", "=", "this", ".", "getRecord", "(", "elButton", ")", ";", "var", "crumbStr", "=", "\"", "\";", "if", "(", "crumb", ".", "fieldName", "!", "==", "null", ")", "{", "crumbStr", "=", "crumb", ".", "fieldName", "+", "\"", "=\"", "+", "crumb", ".", "value", ";", "}", "if", "(", "elButton", ".", "name", "=", "==", "\"", "server", "\"", ")", "{", "/", "/", "for", "BtnServer", "if", "(", "oRecord", ".", "getData", "(", "\"", "status", "\"", ")", "=", "==", "\"", "up", "\"", ")", "{", "YAHOO", ".", "log", "(", "\"", "Stop", "connection", ".", "\")", ";", "elButton", ".", "firstElementChild", ".", "src", "=", "urlSysImg", "(", "24", ",", "\"", "blue_anime", ".", "gif", "\"", ");", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "GET", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "sleep", "\"", ",", "connectionCallBack", ")", ";", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "POST", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "sleep", "\"", ",", "connectionCallBack", ",", "crumbStr", ")", ";", "}", "else", "if", "(", "oRecord", ".", "getData", "(", "\"", "status", "\"", ")", "=", "==", "\"", "down", "\"", ")", "{", "YAHOO", ".", "log", "(", "\"", "Start", "connection", ".", "\")", ";", "elButton", ".", "firstElementChild", ".", "src", "=", "urlSysImg", "(", "24", ",", "\"", "red_anime", ".", "gif", "\"", ");", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "GET", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "wakeup", "\"", ",", "connectionCallBack", ")", ";", "YAHOO", ".", "util", ".", "Connect", ".", "asyncRequest", "(", "'", "POST", "'", ",", "oRecord", ".", "getData", "(", "\"", "serverUrl", "\"", ")", "+", "\"", "/", "wakeup", "\"", ",", "connectionCallBack", ",", "crumbStr", ")", ";", "}", "}", "else", "if", "(", "elButton", ".", "name", "=", "==", "\"", "edit", "\"", ")", "{", "/", "/", "for", "btnEdit", "@", "@", "-", "2", ",", "6", "+", "2", ",", "7", "@", "@", "*", "The", "MIT", "License", "*", "*", "Copyright", "2015", "Ericsson", ".", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "@", "@", "-", "24", ",", "20", "+", "25", ",", "34", "@", "@", "package", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ";", "import", "static", "com", ".", "sonymobile", ".", "tools", ".", "gerrit", ".", "gerritevents", ".", "mock", ".", "SshdServerMock", ".", "GERRIT_STREAM_EVENTS", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertSame", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "util", ".", "UrlUtils", ";", "import", "hudson", ".", "model", ".", "FreeStyleBuild", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "Result", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "apache", ".", "sshd", ".", "SshServer", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ".", "config", ".", "Config", ";", "@", "@", "-", "47", ",", "6", "+", "62", ",", "7", "@", "@", "import", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ".", "mock", ".", "Setup", ";", "import", "com", ".", "sonyericsson", ".", "hudson", ".", "plugins", ".", "gerrit", ".", "trigger", ".", "mock", ".", "TestUtils", ";", "import", "com", ".", "sonymobile", ".", "tools", ".", "gerrit", ".", "gerritevents", ".", "mock", ".", "SshdServerMock", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "MockAuthorizationStrategy", ";", "/", "**", "*", "Unit", "test", "to", "ensure", "build", "can", "be", "triggered", "even", "if", "@", "@", "-", "145", ",", "4", "+", "161", ",", "110", "@", "@", "public", "void", "testTriggerWithLockedDownInstance", "(", ")", "throws", "Exception", "{", "buildOne", ".", "getCause", "(", "GerritCause", ".", "class", ")", ".", "getEvent", "(", ").", "getProvider", "(", ").", "getName", "(", "))", ";", "}", "/", "**", "*", "Just", "verify", "that", "{", "@", "link", "PluginImpl", "#", "getServer", "(", "String", ")", "}", "et", ".", "al", ".", "hasn", "'", "t", "been", "locked", "down", "too", "tightly", ".", "*", "*", "@", "throws", "Exception", "if", "so", "*", "/", "@", "Test", "@", "Issue", "(", "{\"", "SECURITY", "-", "402", "\"", ",", "\"", "SECURITY", "-", "403", "\"", "}", ")", "public", "void", "testUserCanConfigureAJob", "(", ")", "throws", "Exception", "{", "GerritServer", "gerritServer", "=", "new", "GerritServer", "(", "PluginImpl", ".", "DEFAULT_SERVER_NAME", ")", ";", "SshdServerMock", ".", "configureFor", "(", "sshd", ",", "gerritServer", ")", ";", "PluginImpl", ".", "getInstance", "(", ").", "addServer", "(", "gerritServer", ")", ";", "gerritServer", ".", "getConfig", "(", ").", "setNumberOfSendingWorkerThreads", "(", "NUMBEROFSENDERTHREADS", ")", ";", "(", "(", "Config", ")", "gerritServer", ".", "getConfig", "(", "))", ".", "setGerritAuthKeyFile", "(", "sshKey", ".", "getPrivateKey", "(", "))", ";", "gerritServer", ".", "start", "(", ");", "GerritServer", "otherServer", "=", "new", "GerritServer", "(", "\"", "theOtherServer", "\"", ");", "SshdServerMock", ".", "configureFor", "(", "sshd", ",", "otherServer", ")", ";", "PluginImpl", ".", "getInstance", "(", ").", "addServer", "(", "otherServer", ")", ";", "otherServer", ".", "getConfig", "(", ").", "setNumberOfSendingWorkerThreads", "(", "NUMBEROFSENDERTHREADS", ")", ";", "(", "(", "Config", ")", "otherServer", ".", "getConfig", "(", "))", ".", "setGerritAuthKeyFile", "(", "sshKey", ".", "getPrivateKey", "(", "))", ";", "otherServer", ".", "start", "(", ");", "FreeStyleProject", "project", "=", "new", "TestUtils", ".", "JobBuilder", "(", "j", ")", ".", "name", "(", "projectName", ")", ".", "silentStartMode", "(", "false", ")", ".", "serverName", "(", "\"", "theOtherServer", "\"", ").", "build", "(", ");", "Setup", ".", "lockDown", "(", "j", ")", ";", "j", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "new", "MockAuthorizationStrategy", "(", ").", "grant", "(", "Item", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toAuthenticated", "(", ")", ".", "grant", "(", "Jenkins", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toEveryone", "(", ")", ".", "grant", "(", "Item", ".", "CONFIGURE", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "bob", "\"", "))", ";", "final", "JenkinsRule", ".", "WebClient", "webClient", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", ");", "HtmlPage", "page", "=", "webClient", ".", "getPage", "(", "project", ",", "\"", "configure", "\"", ");", "j", ".", "submit", "(", "page", ".", "getFormByName", "(", "\"", "config", "\"", "))", ";", "final", "FreeStyleProject", "freshJob", "=", "j", ".", "jenkins", ".", "getItem", "(", "projectName", ",", "j", ".", "jenkins", ",", "FreeStyleProject", ".", "class", ")", ";", "final", "String", "serverName", "=", "GerritTrigger", ".", "getTrigger", "(", "freshJob", ")", ".", "getServerName", "(", ");", "assertEquals", "(", "\"", "theOtherServer", "\"", ",", "serverName", ")", ";", "}", "/", "/", "CS", "IGNORE", "MagicNumber", "FOR", "NEXT", "32", "LINES", ".", "REASON", ":", "test", "data", ".", "/", "**", "*", "Tests", "that", "only", "an", "admin", "can", "read", "server", "configuration", "and", "manipulate", "server", "state", ".", "*", "@", "throws", "Exception", "if", "so", "*", "/", "@", "Test", "@", "Issue", "(", "{\"", "SECURITY", "-", "402", "\"", ",", "\"", "SECURITY", "-", "403", "\"", "}", ")", "public", "void", "testOnlyAdminCanPerformServerConfigurationActions", "(", ")", "throws", "Exception", "{", "GerritServer", "gerritServer", "=", "new", "GerritServer", "(", "PluginImpl", ".", "DEFAULT_SERVER_NAME", ")", ";", "SshdServerMock", ".", "configureFor", "(", "sshd", ",", "gerritServer", ")", ";", "PluginImpl", ".", "getInstance", "(", ").", "addServer", "(", "gerritServer", ")", ";", "gerritServer", ".", "getConfig", "(", ").", "setNumberOfSendingWorkerThreads", "(", "NUMBEROFSENDERTHREADS", ")", ";", "(", "(", "Config", ")", "gerritServer", ".", "getConfig", "(", "))", ".", "setGerritAuthKeyFile", "(", "sshKey", ".", "getPrivateKey", "(", "))", ";", "gerritServer", ".", "start", "(", ");", "Setup", ".", "lockDown", "(", "j", ")", ";", "j", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "new", "MockAuthorizationStrategy", "(", ").", "grant", "(", "Item", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toAuthenticated", "(", ")", ".", "grant", "(", "Jenkins", ".", "READ", ",", "Item", ".", "DISCOVER", ")", ".", "everywhere", "(", ").", "toEveryone", "(", ")", ".", "grant", "(", "Item", ".", "CONFIGURE", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "bob", "\"", ")", ".", "grant", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "alice", "\"", "))", ";", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "/", "/", "Not", "really", "testing", "csrf", "right", "now", "JenkinsRule", ".", "WebClient", "webClient", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "alice", "\"", ",", "\"", "alice", "\"", ");", "HtmlPage", "page", "=", "webClient", ".", "goTo", "(", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "\")", ";", "HtmlForm", "config", "=", "page", ".", "getFormByName", "(", "\"", "config", "\"", ");", "assertNotNull", "(", "config", ")", ";", "post", "(", "webClient", ",", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "sleep", "\"", ",", "\"", "application", "/", "json", "\"", ",", "null", ")", ";", "webClient", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", ");", "webClient", ".", "assertFails", "(", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "\",", "403", ")", ";", "post", "(", "webClient", ",", "\"", "plugin", "/", "gerrit", "-", "trigger", "/", "servers", "/", "0", "/", "wakeup", "\"", ",", "null", ",", "403", ")", ";", "}", "/", "**", "*", "Performs", "an", "HTTP", "POST", "request", "to", "the", "relative", "url", ".", "*", "*", "@", "param", "webClient", "the", "client", "*", "@", "param", "relative", "the", "url", "relative", "to", "the", "context", "path", "*", "@", "param", "expectedContentType", "if", "expecting", "specific", "content", "type", "or", "null", "if", "not", "*", "@", "param", "expectedStatus", "if", "expecting", "a", "failing", "http", "status", "code", "or", "null", "if", "not", "*", "@", "throws", "IOException", "if", "so", "*", "/", "private", "static", "void", "post", "(", "JenkinsRule", ".", "WebClient", "webClient", ",", "String", "relative", ",", "String", "expectedContentType", ",", "Integer", "expectedStatus", ")", "throws", "IOException", "{", "WebRequest", "request", "=", "new", "WebRequest", "(", "UrlUtils", ".", "toUrlUnsafe", "(", "webClient", ".", "getContextPath", "(", ")", "+", "relative", ")", ",", "HttpMethod", ".", "POST", ")", ";", "try", "{", "Page", "p", "=", "webClient", ".", "getPage", "(", "request", ")", ";", "if", "(", "expectedContentType", "!", "=", "null", ")", "{", "assertThat", "(", "p", ".", "getWebResponse", "(", ").", "getContentType", "(", "),", "is", "(", "expectedContentType", ")", ");", "}", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "if", "(", "expectedStatus", "!", "=", "null", ")", "{", "assertEquals", "(", "expectedStatus", ".", "intValue", "(", "),", "e", ".", "getStatusCode", "(", "))", ";", "}", "else", "{", "throw", "e", ";", "}", "}", "}", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Fix", "for", "#981", "(#987)"], "code_tokens": ["@", "@", "-", "9", ",", "7", "+", "9", ",", "7", "@", "@", "<", "groupId", ">", "com", ".", "sparkjava", "<", "/", "groupId", ">", "<", "artifactId", ">", "spark", "-", "core", "<", "/", "artifactId", ">", "<", "packaging", ">", "bundle", "<", "/", "packaging", ">", "<", "version", ">", "3", ".", "0", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "version", ">", "2", ".", "7", ".", "2", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "name", ">", "Spark", "<", "/", "name", ">", "<", "description", ">", "A", "Sinatra", "inspired", "java", "web", "framework", "<", "/", "description", ">", "<", "url", ">", "http", ":", "//", "www", ".", "sparkjava", ".", "com", "<", "/", "url", ">", "@", "@", "-", "74", ",", "14", "+", "74", ",", "22", "@", "@", "public", "ClassPathResource", "(", "String", "path", ")", "{", "*", "/", "public", "ClassPathResource", "(", "String", "path", ",", "ClassLoader", "classLoader", ")", "{", "Assert", ".", "notNull", "(", "path", ",", "\"", "Path", "must", "not", "be", "null", "\"", ");", "Assert", ".", "state", "(", "doesNotContainFileColon", "(", "path", ")", ",", "\"", "Path", "must", "not", "contain", "'", "file", ":", "'\"", ");", "String", "pathToUse", "=", "StringUtils", ".", "cleanPath", "(", "path", ")", ";", "if", "(", "pathToUse", ".", "startsWith", "(", "\"/", "\")", ")", "{", "pathToUse", "=", "pathToUse", ".", "substring", "(", "1", ")", ";", "}", "this", ".", "path", "=", "pathToUse", ";", "this", ".", "classLoader", "=", "(", "classLoader", "!", "=", "null", "?", "classLoader", ":", "ClassUtils", ".", "getDefaultClassLoader", "(", "))", ";", "}", "private", "static", "boolean", "doesNotContainFileColon", "(", "String", "path", ")", "{", "return", "!", "path", ".", "contains", "(", "\"", "file", ":", "\")", ";", "}", "/", "**", "*", "Create", "a", "new", "ClassPathResource", "with", "optional", "ClassLoader", "and", "Class", ".", "*", "Only", "for", "internal", "usage", ".", "@", "@", "-", "108", ",", "10", "+", "116", ",", "9", "@", "@", "public", "final", "String", "getPath", "(", ")", "{", "/", "**", "*", "This", "implementation", "checks", "for", "the", "resolution", "of", "a", "resource", "URL", ".", "*", "*", "@", "return", "if", "exists", ".", "*", "@", "see", "java", ".", "lang", ".", "ClassLoader", "#", "getResource", "(", "String", ")", "*", "@", "see", "java", ".", "lang", ".", "Class", "#", "getResource", "(", "String", ")", "*", "*", "@", "return", "if", "exists", ".", "*", "/", "@", "Override", "public", "boolean", "exists", "(", ")", "{", "@", "@", "-", "127", ",", "10", "+", "134", ",", "9", "@", "@", "public", "boolean", "exists", "(", ")", "{", "/", "**", "*", "This", "implementation", "opens", "an", "InputStream", "for", "the", "given", "class", "path", "resource", ".", "*", "*", "@", "return", "the", "input", "stream", ".", "*", "@", "see", "java", ".", "lang", ".", "ClassLoader", "#", "getResourceAsStream", "(", "String", ")", "*", "@", "see", "java", ".", "lang", ".", "Class", "#", "getResourceAsStream", "(", "String", ")", "*", "*", "@", "return", "the", "input", "stream", ".", "*", "/", "@", "Override", "public", "InputStream", "getInputStream", "(", ")", "throws", "IOException", "{", "@", "@", "-", "149", ",", "10", "+", "155", ",", "9", "@", "@", "public", "InputStream", "getInputStream", "(", ")", "throws", "IOException", "{", "/", "**", "*", "This", "implementation", "returns", "a", "URL", "for", "the", "underlying", "class", "path", "resource", ".", "*", "*", "@", "return", "the", "url", ".", "*", "@", "see", "java", ".", "lang", ".", "ClassLoader", "#", "getResource", "(", "String", ")", "*", "@", "see", "java", ".", "lang", ".", "Class", "#", "getResource", "(", "String", ")", "*", "*", "@", "return", "the", "url", ".", "*", "/", "@", "Override", "public", "URL", "getURL", "(", ")", "throws", "IOException", "{", "@", "@", "-", "172", ",", "9", "+", "177", ",", "8", "@", "@", "public", "URL", "getURL", "(", ")", "throws", "IOException", "{", "*", "This", "implementation", "creates", "a", "ClassPathResource", ",", "applying", "the", "given", "path", "*", "relative", "to", "the", "path", "of", "the", "underlying", "resource", "of", "this", "descriptor", ".", "*", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "applyRelativePath", "(", "String", ",", "String", ")", "*", "*", "@", "return", "the", "resource", ".", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "applyRelativePath", "(", "String", ",", "String", ")", "*", "/", "@", "Override", "public", "Resource", "createRelative", "(", "String", "relativePath", ")", "{", "@", "@", "-", "186", ",", "9", "+", "190", ",", "8", "@", "@", "public", "Resource", "createRelative", "(", "String", "relativePath", ")", "{", "*", "This", "implementation", "returns", "the", "name", "of", "the", "file", "that", "this", "class", "path", "*", "resource", "refers", "to", ".", "*", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "getFilename", "(", "String", ")", "*", "*", "@", "return", "the", "file", "name", ".", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "getFilename", "(", "String", ")", "*", "/", "@", "Override", "public", "String", "getFilename", "(", ")", "{", "@", "@", "-", "233", ",", "8", "+", "236", ",", "8", "@", "@", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "ClassLoader", "otherLoader", "=", "otherRes", ".", "classLoader", ";", "return", "(", "this", ".", "path", ".", "equals", "(", "otherRes", ".", "path", ")", "&", "&", "thisLoader", ".", "equals", "(", "otherLoader", ")", "&", "&", "this", ".", "clazz", ".", "equals", "(", "otherRes", ".", "clazz", ")", ");", "thisLoader", ".", "equals", "(", "otherLoader", ")", "&", "&", "this", ".", "clazz", ".", "equals", "(", "otherRes", ".", "clazz", ")", ");", "}", "return", "false", ";", "}"], "docstring_tokens": ["via", "various", "representations", "of", "absolute", "or", "relative", "pathname"]}
{"contents": ["bplist:", "Make", "sure", "to", "bail", "out", "if", "malloc()", "fails", "in", "parse_string_node()", "Credit", "to", "Wang", "Junjie", "<zhunkibatu@gmail.com>", "(#93)"], "code_tokens": ["@", "@", "-", "289", ",", "6", "+", "289", ",", "11", "@", "@", "static", "plist_t", "parse_string_node", "(", "const", "char", "*", "*", "bnode", ",", "uint64_t", "size", ")", "data", "-", ">", "type", "=", "PLIST_STRING", ";", "data", "-", ">", "strval", "=", "(", "char", "*", ")", "malloc", "(", "sizeof", "(", "char", ")", "*", "(", "size", "+", "1", ")", ");", "if", "(", "!", "data", "-", ">", "strval", ")", "{", "plist_free_data", "(", "data", ")", ";", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "Could", "not", "allocate", "%", "\"", "PRIu64", "\"", "bytes", "\\", "n", "\"", ",", "__func__", ",", "sizeof", "(", "char", ")", "*", "(", "size", "+", "1", ")", ");", "return", "NULL", ";", "}", "memcpy", "(", "data", "-", ">", "strval", ",", "*", "bnode", ",", "size", ")", ";", "data", "-", ">", "strval", "[", "size", "]", "=", "'", "\\", "0", "'", ";", "data", "-", ">", "length", "=", "strlen", "(", "data", "-", ">", "strval", ")", ";"], "docstring_tokens": ["via", "a", "crafted", "plist", "file", "."]}
{"contents": ["[SECURITY-507]", "Add", "@RequirePOST", "for", "the", "submit"], "code_tokens": ["@", "@", "-", "13", ",", "6", "+", "13", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "WebApp", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "DataBoundConstructor", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "jelly", ".", "InternationalizedStringExpressionListener", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "jelly", ".", "JellyFacet", ";", "@", "@", "-", "179", ",", "6", "+", "180", ",", "7", "@", "@", "public", "boolean", "isUpdated", "(", ")", "{", "/", "**", "*", "Handles", "the", "submission", "from", "the", "browser", ".", "*", "/", "@", "RequirePOST", "public", "void", "doSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ",", "@", "QueryParameter", "String", "locale", ")", "throws", "IOException", ",", "ServletException", "{", "JSONObject", "json", "=", "req", ".", "getSubmittedForm", "(", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "74", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2017", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "plugins", ".", "translation", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "util", ".", "NameValuePair", ";", "import", "org", ".", "apache", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "class", "L10nDecoratorTest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "507", "\"", ")", "public", "void", "ensurePostIsRequiredForSubmit", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "L10nDecorator", "l10nDecorator", "=", "j", ".", "jenkins", ".", "getDescriptorByType", "(", "L10nDecorator", ".", "class", ")", ";", "String", "submitUrl", "=", "l10nDecorator", ".", "getUrl", "(", ")", "+", "\"", "/", "submit", "\"", ";", "URL", "absoluteSubmitUrl", "=", "new", "URL", "(", "j", ".", "getURL", "(", ")", "+", "submitUrl", ")", ";", "/", "/", "the", "GET", "method", "is", "not", "allowed", "try", "{", "wc", ".", "goTo", "(", "submitUrl", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "Assert", ".", "assertEquals", "(", "HttpStatus", ".", "SC_METHOD_NOT_ALLOWED", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "/", "/", "the", "POST", "method", "must", "be", "used", "to", "submit", "a", "form", "WebRequest", "submitRequest", "=", "new", "WebRequest", "(", "absoluteSubmitUrl", ",", "HttpMethod", ".", "POST", ")", ";", "submitRequest", ".", "setRequestParameters", "(", "Arrays", ".", "asList", "(", "new", "NameValuePair", "(", "\"", "json", "\"", ",", "\"", "{}", "\")", ",", "new", "NameValuePair", "(", "\"", "locale", "\"", ",", "\"", "fr", "\"", ")", ")", ");", "Page", "successSubmit", "=", "wc", ".", "getPage", "(", "submitRequest", ")", ";", "Assert", ".", "assertEquals", "(", "HttpStatus", ".", "SC_OK", ",", "successSubmit", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "}"], "docstring_tokens": ["parses", "a", "maliciously", "crafted", "file"]}
