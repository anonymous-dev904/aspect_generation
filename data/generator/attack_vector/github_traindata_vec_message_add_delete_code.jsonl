{"contents": ["Add", "stream", "timeouts", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@1852698", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["static", "final", "long", "DEFAULT_KEEP_ALIVE_TIMEOUT", "=", "-", "1", ";", "static", "final", "long", "DEFAULT_STREAM_READ_TIMEOUT", "=", "20000", ";", "static", "final", "long", "DEFAULT_STREAM_WRITE_TIMEOUT", "=", "20000", ";", "/", "/", "These", "are", "the", "socket", "level", "timeouts", "private", "long", "keepAliveTimeout", "=", "DEFAULT_KEEP_ALIVE_TIMEOUT", ";", "/", "/", "These", "are", "the", "stream", "level", "timeouts", "private", "long", "streamReadTimeout", "=", "DEFAULT_STREAM_READ_TIMEOUT", ";", "private", "long", "streamWriteTimeout", "=", "DEFAULT_STREAM_WRITE_TIMEOUT", ";", "public", "long", "getWriteTimeout", "(", ")", "{", "return", "writeTimeout", ";", "}", "public", "void", "setWriteTimeout", "(", "long", "writeTimeout", ")", "{", "this", ".", "writeTimeout", "=", "writeTimeout", ";", "}", "public", "long", "getStreamReadTimeout", "(", ")", "{", "return", "streamReadTimeout", ";", "public", "void", "setStreamReadTimeout", "(", "long", "streamReadTimeout", ")", "{", "this", ".", "streamReadTimeout", "=", "streamReadTimeout", ";", "}", "public", "long", "getStreamWriteTimeout", "(", ")", "{", "return", "streamWriteTimeout", ";", "}", "public", "void", "setStreamWriteTimeout", "(", "long", "streamWriteTimeout", ")", "{", "this", ".", "streamWriteTimeout", "=", "streamWriteTimeout", ";</s>static", "final", "long", "DEFAULT_KEEP_ALIVE_TIMEOUT", "=", "-", "1", ";", "private", "long", "keepAliveTimeout", "=", "DEFAULT_KEEP_ALIVE_TIMEOUT", ";", "public", "long", "getWriteTimeout", "(", ")", "{", "return", "writeTimeout", ";", "public", "void", "setWriteTimeout", "(", "long", "writeTimeout", ")", "{", "this", ".", "writeTimeout", "=", "writeTimeout", ";"], "docstring_tokens": ["sending", "excessive", "SETTINGS", "frames"]}
{"contents": ["[SECURITY-1357]"], "code_tokens": ["import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "DoNotUse", ";", "@", "RequirePOST", "@", "Restricted", "(", "DoNotUse", ".", "class", ")", "/", "/", "WebOnly", "Jenkins", ".", "getActiveInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";</s>"], "docstring_tokens": ["using", "a", "specially-crafted", "argument"]}
{"contents": ["Change", "the", "default", "bind", "address", "for", "AJP", "to", "the", "loopback", "address"], "code_tokens": ["import", "java", ".", "net", ".", "InetAddress", ";", "/", "/", "AJP", "listens", "on", "loopback", "by", "default", "getEndpoint", "(", ").", "setAddress", "(", "InetAddress", ".", "getLoopbackAddress", "(", "))", ";", "<", "update", ">", "Change", "the", "default", "bind", "address", "for", "the", "AJP", "/", "1", ".", "3", "connector", "to", "be", "the", "loopback", "address", ".", "(", "markt", ")", "<", "/", "update", ">", "port", ".", "By", "default", ",", "the", "loopback", "address", "will", "be", "used", ".", "</", "p", "></s>port", ".", "By", "default", ",", "this", "port", "will", "be", "used", "on", "all", "IP", "addresses", "associated", "with", "the", "server", ".", "A", "value", "of", "<", "code", ">", "127", ".", "0", ".", "0", ".", "1", "<", "/", "code", ">", "indicates", "that", "the", "Connector", "will", "only", "listen", "on", "the", "loopback", "interface", ".", "</", "p", ">"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["SOLR-11477:", "Disallow", "resolving", "of", "external", "entities", "in", "Lucene", "queryparser/xml/CoreParser", "and", "SolrCoreParser", "(defType=xmlparser", "or", "{!xmlparser", "...})", "by", "default.", "(Michael", "Stepankin,", "Olga", "Barinova,", "Uwe", "Schindler,", "Christine", "Poerschke)"], "code_tokens": ["Changes", "in", "Runtime", "Behavior", "*", "Resolving", "of", "external", "entities", "in", "queryparser", "/", "xml", "/", "CoreParser", "is", "disallowed", "by", "default", ".", "See", "SOLR", "-", "11477", "for", "details", ".", "*", "SOLR", "-", "11477", ":", "Disallow", "resolving", "of", "external", "entities", "in", "queryparser", "/", "xml", "/", "CoreParser", "by", "default", ".", "(", "Michael", "Stepankin", ",", "Olga", "Barinova", ",", "Uwe", "Schindler", ",", "Christine", "Poerschke", ")", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "ErrorHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "java", ".", "util", ".", "Locale", ";", "/", "**", "*", "Parses", "the", "given", "stream", "as", "XML", "file", "and", "returns", "a", "{", "@", "link", "Query", "}", ".", "*", "By", "default", "this", "disallows", "external", "entities", "for", "security", "reasons", ".", "*", "/", "/", "**", "*", "Returns", "a", "SAX", "{", "@", "link", "EntityResolver", "}", "to", "be", "used", "by", "{", "@", "link", "DocumentBuilder", "}", ".", "*", "By", "default", "this", "returns", "{", "@", "link", "#", "DISALLOW_EXTERNAL_ENTITY_RESOLVER", "}", ",", "which", "disallows", "the", "*", "expansion", "of", "external", "entities", "(", "for", "security", "reasons", ")", ".", "To", "restore", "legacy", "behavior", ",", "*", "override", "this", "method", "to", "return", "{", "@", "code", "null", "}", ".", "*", "/", "protected", "EntityResolver", "getEntityResolver", "(", ")", "{", "return", "DISALLOW_EXTERNAL_ENTITY_RESOLVER", ";", "}", "/", "**", "*", "Subclass", "and", "override", "to", "return", "a", "SAX", "{", "@", "link", "ErrorHandler", "}", "to", "be", "used", "by", "{", "@", "link", "DocumentBuilder", "}", ".", "*", "By", "default", "this", "returns", "{", "@", "code", "null", "}", "so", "no", "error", "handler", "is", "used", ".", "*", "This", "method", "can", "be", "used", "to", "redirect", "XML", "parse", "errors", "/", "warnings", "to", "a", "custom", "logger", ".", "*", "/", "protected", "ErrorHandler", "getErrorHandler", "(", ")", "{", "return", "null", ";", "}", "private", "Document", "parseXML", "(", "InputStream", "pXmlFile", ")", "throws", "ParserException", "{", "final", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setValidating", "(", "false", ")", ";", "dbf", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "/", "/", "ignore", "since", "all", "implementations", "are", "required", "to", "support", "the", "/", "/", "{", "@", "link", "javax", ".", "xml", ".", "XMLConstants", "#", "FEATURE_SECURE_PROCESSING", "}", "feature", "final", "DocumentBuilder", "db", ";", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "}", "catch", "(", "Exception", "se", ")", "{", "throw", "new", "ParserException", "(", "\"", "XML", "Parser", "configuration", "error", ".", "\",", "se", ")", ";", "try", "{", "db", ".", "setEntityResolver", "(", "getEntityResolver", "(", "))", ";", "db", ".", "setErrorHandler", "(", "getErrorHandler", "(", "))", ";", "return", "db", ".", "parse", "(", "pXmlFile", ")", ";", "}", "catch", "(", "Exception", "se", ")", "{", "throw", "new", "ParserException", "(", "\"", "Error", "parsing", "XML", "stream", ":", "\"", "+", "se", ",", "se", ")", ";", "public", "static", "final", "EntityResolver", "DISALLOW_EXTERNAL_ENTITY_RESOLVER", "=", "(", "String", "publicId", ",", "String", "systemId", ")", "-", ">", "{", "throw", "new", "SAXException", "(", "String", ".", "format", "(", "Locale", ".", "ENGLISH", ",", "\"", "External", "Entity", "resolving", "unsupported", ":", "publicId", "=", "\\\"", "%", "s", "\\", "\"", "systemId", "=", "\\\"", "%", "s", "\\", "\"\"", ",", "publicId", ",", "systemId", ")", ");", "}", ";", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!", "DOCTYPE", "TermQuery", "SYSTEM", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "mydtd", "\"", ">", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "TermQuery", "fieldName", "=", "\"", "contents", "\"", ">", "sumitomo", "<", "/", "TermQuery", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "23", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!", "DOCTYPE", "TermQuery", "[", "<", "!", "ENTITY", "internalTerm", "\"", "sumitomo", "\"", ">", "<", "!", "ENTITY", "externalTerm", "SYSTEM", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\"", ">", "<", "!", "ENTITY", "%", "myParameterEntity", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "param", "\"", ">", "]", ">", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "TermQuery", "fieldName", "=", "\"", "contents", "\"", ">&", "internalTerm", ";", "&", "externalTerm", ";", "</", "TermQuery", ">", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "public", "void", "test_DOCTYPE_TermQueryXML", "(", ")", "throws", "ParserException", ",", "IOException", "{", "SAXException", "saxe", "=", "LuceneTestCase", ".", "expectThrows", "(", "ParserException", ".", "class", ",", "SAXException", ".", "class", ",", "(", ")", "-", ">", "parse", "(", "\"", "DOCTYPE_TermQuery", ".", "xml", "\"", "))", ";", "assertTrue", "(", "saxe", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "External", "Entity", "resolving", "unsupported", ":", "\")", ");", "}", "public", "void", "test_ENTITY_TermQueryXML", "(", ")", "throws", "ParserException", ",", "IOException", "{", "SAXException", "saxe", "=", "LuceneTestCase", ".", "expectThrows", "(", "ParserException", ".", "class", ",", "SAXException", ".", "class", ",", "(", ")", "-", ">", "parse", "(", "\"", "ENTITY_TermQuery", ".", "xml", "\"", "))", ";", "assertTrue", "(", "saxe", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "External", "Entity", "resolving", "unsupported", ":", "\")", ");", "}", "*", "SOLR", "-", "11477", ":", "in", "the", "XML", "query", "parser", "(", "defType", "=", "xmlparser", "or", "{", "!", "xmlparser", ".", "..", "}", ")", "the", "resolving", "of", "external", "entities", "is", "now", "disallowed", "by", "default", ".", "*", "SOLR", "-", "11477", ":", "Disallow", "resolving", "of", "external", "entities", "in", "the", "XML", "query", "parser", "(", "defType", "=", "xmlparser", ")", ".", "(", "Michael", "Stepankin", ",", "Olga", "Barinova", ",", "Uwe", "Schindler", ",", "Christine", "Poerschke", ")", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "util", ".", "XMLErrorLogger", ";", "import", "org", ".", "xml", ".", "sax", ".", "ErrorHandler", ";", "private", "static", "final", "XMLErrorLogger", "xmllog", "=", "new", "XMLErrorLogger", "(", "log", ")", ";", "@", "Override", "protected", "ErrorHandler", "getErrorHandler", "(", ")", "{", "return", "xmllog", ";", "}</s>static", "Document", "parseXML", "(", "InputStream", "pXmlFile", ")", "throws", "ParserException", "{", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilder", "db", "=", "null", ";", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "}", "catch", "(", "Exception", "se", ")", "{", "throw", "new", "ParserException", "(", "\"", "XML", "Parser", "configuration", "error", "\"", ",", "se", ")", ";", "org", ".", "w3c", ".", "dom", ".", "Document", "doc", "=", "null", ";", "doc", "=", "db", ".", "parse", "(", "pXmlFile", ")", ";", "catch", "(", "Exception", "se", ")", "{", "throw", "new", "ParserException", "(", "\"", "Error", "parsing", "XML", "stream", ":", "\"", "+", "se", ",", "se", ")", ";", "return", "doc", ";"], "docstring_tokens": ["using", "a", "Config", "API", "add-listener", "command", "to", "reach", "the", "RunExecutableListener", "class"]}
{"contents": ["perf_counter:", "Fix", "buffer", "overflow", "in", "perf_copy_attr()", "If", "we", "pass", "a", "big", "size", "data", "over", "perf_counter_open()", "syscall,", "the", "kernel", "will", "copy", "this", "data", "to", "a", "small", "buffer,", "it", "will", "cause", "kernel", "crash.", "This", "bug", "makes", "the", "kernel", "unsafe", "and", "non-root", "local", "user", "can", "trigger", "it.", "Signed-off-by:", "Xiao", "Guangrong", "<xiaoguangrong@cn.fujitsu.com>", "Acked-by:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Acked-by:", "Paul", "Mackerras", "<paulus@samba.org>", "Cc:", "<stable@kernel.org>", "LKML-Reference:", "<4AAF37D4.5010706@cn.fujitsu.com>", "Signed-off-by:", "Ingo", "Molnar", "<mingo@elte.hu>"], "code_tokens": ["size", "=", "sizeof", "(", "*", "attr", ")", ";</s>"], "docstring_tokens": ["via", "a", "\"big", "size", "data", "\"", "to", "the", "perf_counter_open", "system", "call", "."]}
{"contents": ["[SECURITY-49]", "actively", "invalidate", "bad", "API", "tokens.", "If", "the", "user", "still", "has", "the", "API", "token", "that's", "generated", "from", "secret.key,", "don't", "accept", "that.", "Hopefully", "this", "is", "the", "last", "fix"], "code_tokens": ["import", "jenkins", ".", "model", ".", "Jenkins", ";", "/", "*", "package", "*", "/", "ApiTokenProperty", "(", "String", "seed", ")", "{", "String", "p", "=", "apiToken", ".", "getPlainText", "(", ");", "if", "(", "p", ".", "equals", "(", "Util", ".", "getDigestOf", "(", "Jenkins", ".", "getInstance", "(", ").", "getSecretKey", "(", ")+", "\":", "\"+", "user", ".", "getId", "(", "))", "))", "{", "/", "/", "if", "the", "current", "token", "is", "the", "initial", "value", "created", "by", "pre", "SECURITY", "-", "49", "Jenkins", ",", "we", "can", "'", "t", "use", "that", ".", "/", "/", "force", "using", "the", "newer", "value", "apiToken", "=", "Secret", ".", "fromString", "(", "p", "=", "API_KEY_SEED", ".", "mac", "(", "user", ".", "getId", "(", "))", ");", "}", "return", "Util", ".", "getDigestOf", "(", "p", ")", ";", "import", "hudson", ".", "Util", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "public", "void", "testSecurity49Upgrade", "(", ")", "throws", "Exception", "{", "jenkins", ".", "setSecurityRealm", "(", "createDummySecurityRealm", "(", "))", ";", "User", "u", "=", "User", ".", "get", "(", "\"", "foo", "\"", ");", "String", "historicalInitialValue", "=", "Util", ".", "getDigestOf", "(", "Jenkins", ".", "getInstance", "(", ").", "getSecretKey", "(", ")", "+", "\"", ":\"", "+", "u", ".", "getId", "(", "))", ";", "/", "/", "we", "won", "'", "t", "accept", "historically", "used", "initial", "value", "as", "it", "may", "be", "compromised", "ApiTokenProperty", "t", "=", "new", "ApiTokenProperty", "(", "historicalInitialValue", ")", ";", "u", ".", "addProperty", "(", "t", ")", ";", "String", "apiToken1", "=", "t", ".", "getApiToken", "(", ");", "assertFalse", "(", "apiToken1", ".", "equals", "(", "Util", ".", "getDigestOf", "(", "historicalInitialValue", ")", "))", ";", "/", "/", "the", "replacement", "for", "the", "compromised", "value", "must", "be", "consistent", "and", "cannot", "be", "random", "ApiTokenProperty", "t2", "=", "new", "ApiTokenProperty", "(", "historicalInitialValue", ")", ";", "u", ".", "addProperty", "(", "t2", ")", ";", "assertEquals", "(", "apiToken1", ",", "t2", ".", "getApiToken", "(", "))", ";", "/", "/", "any", "other", "value", "is", "OK", ".", "those", "are", "changed", "values", "t", "=", "new", "ApiTokenProperty", "(", "historicalInitialValue", "+", "\"", "somethingElse", "\"", ");", "u", ".", "addProperty", "(", "t", ")", ";", "assertTrue", "(", "t", ".", "getApiToken", "(", ").", "equals", "(", "Util", ".", "getDigestOf", "(", "historicalInitialValue", "+", "\"", "somethingElse", "\"", "))", ");", "}</s>private", "ApiTokenProperty", "(", "String", "seed", ")", "{", "return", "Util", ".", "getDigestOf", "(", "apiToken", ".", "getPlainText", "(", "))", ";"], "docstring_tokens": ["via", "unknown", "vectors", "."]}
{"contents": ["Multiblock", "corrupted", "pointer", "fix", "OpenSSL", "1.0.2", "introduced", "the", "\"multiblock\"", "performance", "improvement.", "This", "feature", "only", "applies", "on", "64", "bit", "x86", "architecture", "platforms", "that", "support", "AES", "NI", "instructions.", "A", "defect", "in", "the", "implementation", "of", "\"multiblock\"", "can", "cause", "OpenSSL's", "internal", "write", "buffer", "to", "become", "incorrectly", "set", "to", "NULL", "when", "using", "non-blocking", "IO.", "Typically,", "when", "the", "user", "application", "is", "using", "a", "socket", "BIO", "for", "writing,", "this", "will", "only", "result", "in", "a", "failed", "connection.", "However", "if", "some", "other", "BIO", "is", "used", "then", "it", "is", "likely", "that", "a", "segmentation", "fault", "will", "be", "triggered,", "thus", "enabling", "a", "potential", "DoS", "attack.", "Reviewed-by:", "Richard", "Levitte", "<levitte@openssl.org>", "Reviewed-by:", "Andy", "Polyakov", "<appro@openssl.org>"], "code_tokens": ["if", "(", "i", "<", "0", "&", "&", "(", "!", "s", "-", ">", "wbio", "|", "|", "!", "BIO_should_retry", "(", "s", "-", ">", "wbio", ")", "))", "{</s>if", "(", "i", "<", "0", ")", "{"], "docstring_tokens": ["using", "a", "BIO", "other", "than", "a", "socket", "BIO", "for", "writing"]}
{"contents": ["Add", "test", "case", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@962871", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["package", "org", ".", "apache", ".", "coyote", ".", "http11", ";", "import", "java", ".", "io", ".", "File", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "SimpleHttpClient", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "Tomcat", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "TomcatBaseTest", ";", "public", "class", "TestAbstractHttp11Processor", "extends", "TomcatBaseTest", "{", "public", "void", "testWithTEVoid", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "void", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "public", "void", "testWithTEBuffered", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "buffered", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "public", "void", "testWithTEIdentity", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "identity", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "\"", "Connection", ":", "close", "\"", "+", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse200", "(", "))", ";", "assertTrue", "(", "client", ".", "getResponseBody", "(", ").", "contains", "(", "\"", "test", "-", "data", "\"", "))", ";", "}", "public", "void", "testWithTESavedRequest", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "savedrequest", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "public", "void", "testWithTEUnsupported", "(", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "File", "root", "=", "new", "File", "(", "\"", "test", "/", "webapp", "-", "3", ".", "0", "\"", ");", "tomcat", ".", "addWebapp", "(", "\"\"", ",", "root", ".", "getAbsolutePath", "(", "))", ";", "tomcat", ".", "start", "(", ");", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Transfer", "-", "encoding", ":", "unsupported", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Length", ":", "9", "\"", "+", "SimpleHttpClient", ".", "CRLF", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "SimpleHttpClient", ".", "CRLF", "SimpleHttpClient", ".", "CRLF", "\"", "test", "=", "data", "\"", ";", "Client", "client", "=", "new", "Client", "(", ");", "client", ".", "setPort", "(", "getPort", "(", "))", ";", "client", ".", "setRequest", "(", "new", "String", "[", "]", "{", "request", "}", ");", "client", ".", "connect", "(", ");", "client", ".", "processRequest", "(", ");", "assertTrue", "(", "client", ".", "isResponse501", "(", "))", ";", "}", "private", "static", "final", "class", "Client", "extends", "SimpleHttpClient", "{", "@", "Override", "public", "boolean", "isResponseBodyOK", "(", ")", "{", "return", "getResponseBody", "(", ").", "contains", "(", "\"", "test", "-", "data", "\"", ");", "}", "}", "}</s>"], "docstring_tokens": ["via", "a", "crafted", "header", "that", "interferes", "with", "\"recycling", "of", "a", "buffer.\""]}
{"contents": ["GEODE-7018:", "Enable", "hostname", "validation", "for", "SSL", "over", "NIO", "(#3849)"], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "*", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "*", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "*", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "*", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "*", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "*", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "geode", ".", "internal", ".", "net", ";", "import", "static", "junit", ".", "framework", ".", "TestCase", ".", "fail", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "internal", ".", "security", ".", "SecurableCommunicationChannel", ".", "CLUSTER", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "test", ".", "awaitility", ".", "GeodeAwaitility", ".", "await", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThatThrownBy", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "InetSocketAddress", ";", "import", "java", ".", "net", ".", "ServerSocket", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "nio", ".", "channels", ".", "ServerSocketChannel", ";", "import", "java", ".", "nio", ".", "channels", ".", "SocketChannel", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLEngine", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLHandshakeException", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "contrib", ".", "java", ".", "lang", ".", "system", ".", "RestoreSystemProperties", ";", "import", "org", ".", "junit", ".", "experimental", ".", "categories", ".", "Category", ";", "import", "org", ".", "junit", ".", "rules", ".", "ErrorCollector", ";", "import", "org", ".", "junit", ".", "rules", ".", "TestName", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameter", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameters", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "ssl", ".", "CertStores", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "ssl", ".", "TestSSLUtils", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "DMStats", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "DistributionConfig", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "DistributionConfigImpl", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "IgnoredException", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "MembershipTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "runners", ".", "CategoryWithParameterizedRunnerFactory", ";", "/", "**", "*", "Integration", "tests", "for", "SSL", "handshake", "specifically", "focusing", "on", "hostname", "validation", ".", "*", "/", "@", "Category", "(", "{", "MembershipTest", ".", "class", "}", ")", "@", "RunWith", "(", "Parameterized", ".", "class", ")", "@", "Parameterized", ".", "UseParametersRunnerFactory", "(", "CategoryWithParameterizedRunnerFactory", ".", "class", ")", "public", "class", "SSLSocketHostNameVerificationIntegrationTest", "{", "@", "Parameter", "public", "boolean", "addCertificateSAN", ";", "@", "Parameter", "(", "1", ")", "public", "boolean", "doEndPointIdentification", ";", "@", "Parameters", "(", "name", "=", "\"", "hasSAN", "=", "{", "0", "}", "and", "doEndPointIdentification", "=", "{", "1", "}", "\")", "public", "static", "Iterable", "<", "Boolean", "[", "]>", "addCertificateOrNot", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "new", "Boolean", "[", "]", "{", "Boolean", ".", "TRUE", ",", "Boolean", ".", "TRUE", "}", ",", "new", "Boolean", "[", "]", "{", "Boolean", ".", "TRUE", ",", "Boolean", ".", "FALSE", "}", ",", "new", "Boolean", "[", "]", "{", "Boolean", ".", "FALSE", ",", "Boolean", ".", "TRUE", "}", ",", "new", "Boolean", "[", "]", "{", "Boolean", ".", "FALSE", ",", "Boolean", ".", "FALSE", "}", ");", "}", "private", "DistributionConfig", "distributionConfig", ";", "private", "SocketCreator", "socketCreator", ";", "private", "InetAddress", "localHost", ";", "private", "Thread", "serverThread", ";", "private", "ServerSocket", "serverSocket", ";", "private", "Socket", "clientSocket", ";", "@", "Rule", "public", "ErrorCollector", "errorCollector", "=", "new", "ErrorCollector", "(", ");", "@", "Rule", "public", "RestoreSystemProperties", "restoreSystemProperties", "=", "new", "RestoreSystemProperties", "(", ");", "@", "Rule", "public", "TestName", "testName", "=", "new", "TestName", "(", ");", "private", "Throwable", "serverException", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "IgnoredException", ".", "addIgnoredException", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "SSLException", ":", "Read", "timed", "out", "\"", ");", "this", ".", "localHost", "=", "InetAddress", ".", "getLoopbackAddress", "(", ");", "TestSSLUtils", ".", "CertificateBuilder", "certBuilder", "=", "new", "TestSSLUtils", ".", "CertificateBuilder", "(", ")", ".", "commonName", "(", "\"", "iAmTheServer", "\"", ");", "if", "(", "addCertificateSAN", ")", "{", "certBuilder", ".", "sanDnsName", "(", "this", ".", "localHost", ".", "getHostName", "(", "))", ";", "}", "CertStores", "certStores", "=", "CertStores", ".", "locatorStore", "(", ");", "certStores", ".", "withCertificate", "(", "certBuilder", ")", ";", "certStores", ".", "trustSelf", "(", ");", "this", ".", "distributionConfig", "=", "new", "DistributionConfigImpl", "(", "certStores", ".", "propertiesWith", "(", "\"", "cluster", "\"", ",", "false", ",", "doEndPointIdentification", ")", ");", "SocketCreatorFactory", ".", "setDistributionConfig", "(", "this", ".", "distributionConfig", ")", ";", "this", ".", "socketCreator", "=", "SocketCreatorFactory", ".", "getSocketCreatorForComponent", "(", "CLUSTER", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "if", "(", "this", ".", "clientSocket", "!", "=", "null", ")", "{", "this", ".", "clientSocket", ".", "close", "(", ");", "}", "if", "(", "this", ".", "serverSocket", "!", "=", "null", ")", "{", "this", ".", "serverSocket", ".", "close", "(", ");", "}", "if", "(", "this", ".", "serverThread", "!", "=", "null", "&", "&", "this", ".", "serverThread", ".", "isAlive", "(", "))", "{", "this", ".", "serverThread", ".", "interrupt", "(", ");", "}", "SocketCreatorFactory", ".", "close", "(", ");", "}", "@", "Test", "public", "void", "nioHandshakeValidatesHostName", "(", ")", "throws", "Exception", "{", "ServerSocketChannel", "serverChannel", "=", "ServerSocketChannel", ".", "open", "(", ");", "this", ".", "serverSocket", "=", "serverChannel", ".", "socket", "(", ");", "InetSocketAddress", "addr", "=", "new", "InetSocketAddress", "(", "localHost", ",", "0", ")", ";", "serverSocket", ".", "bind", "(", "addr", ",", "10", ")", ";", "int", "serverPort", "=", "this", ".", "serverSocket", ".", "getLocalPort", "(", ");", "this", ".", "serverThread", "=", "startServerNIO", "(", "serverSocket", ",", "15000", ")", ";", "await", "(", ").", "until", "(", "()", "-", ">", "serverThread", ".", "isAlive", "(", "))", ";", "SocketChannel", "clientChannel", "=", "SocketChannel", ".", "open", "(", ");", "await", "(", ").", "until", "(", "(", ")", "-", ">", "clientChannel", ".", "connect", "(", "new", "InetSocketAddress", "(", "localHost", ",", "serverPort", ")", "))", ";", "this", ".", "clientSocket", "=", "clientChannel", ".", "socket", "(", ");", "SSLEngine", "sslEngine", "=", "this", ".", "socketCreator", ".", "createSSLEngine", "(", "this", ".", "localHost", ".", "getHostName", "(", "),", "1234", ")", ";", "try", "{", "this", ".", "socketCreator", ".", "handshakeSSLSocketChannel", "(", "clientSocket", ".", "getChannel", "(", "),", "sslEngine", ",", "0", ",", "true", ",", "ByteBuffer", ".", "allocate", "(", "500", ")", ",", "new", "BufferPool", "(", "mock", "(", "DMStats", ".", "class", ")", "))", ";", "if", "(", "doEndPointIdentification", "&", "&", "!", "addCertificateSAN", ")", "{", "fail", "(", "\"", "Failed", "to", "validate", "hostname", "in", "certificate", "SAN", "\"", ");", "}", "else", "{", "assertNull", "(", "serverException", ")", ";", "}", "}", "catch", "(", "SSLHandshakeException", "sslException", ")", "{", "if", "(", "doEndPointIdentification", "&", "&", "!", "addCertificateSAN", ")", "{", "assertThat", "(", "sslException", ")", ".", "hasRootCauseInstanceOf", "(", "CertificateException", ".", "class", ")", ".", "hasStackTraceContaining", "(", "\"", "No", "name", "matching", "\"", "+", "this", ".", "localHost", ".", "getHostName", "(", ")", "+", "\"", "found", "\"", ");", "}", "else", "{", "assertThat", "(", "sslException", ")", ".", "doesNotHaveSameClassAs", "(", "new", "CertificateException", "(", "\"", "No", "name", "matching", "\"", "+", "this", ".", "localHost", ".", "getHostName", "(", ")", "+", "\"", "found", "\"", "))", ";", "throw", "sslException", ";", "}", "}", "}", "private", "Thread", "startServerNIO", "(", "final", "ServerSocket", "serverSocket", ",", "int", "timeoutMillis", ")", "{", "Thread", "serverThread", "=", "new", "Thread", "(", "new", "MyThreadGroup", "(", "this", ".", "testName", ".", "getMethodName", "(", "))", ",", "(", ")", "-", ">", "{", "NioSslEngine", "engine", "=", "null", ";", "Socket", "socket", "=", "null", ";", "try", "{", "socket", "=", "serverSocket", ".", "accept", "(", ");", "SocketCreator", "sc", "=", "SocketCreatorFactory", ".", "getSocketCreatorForComponent", "(", "CLUSTER", ")", ";", "engine", "=", "sc", ".", "handshakeSSLSocketChannel", "(", "socket", ".", "getChannel", "(", "),", "sc", ".", "createSSLEngine", "(", "this", ".", "localHost", ".", "getHostName", "(", "),", "1234", ")", ",", "timeoutMillis", ",", "false", ",", "ByteBuffer", ".", "allocate", "(", "500", ")", ",", "new", "BufferPool", "(", "mock", "(", "DMStats", ".", "class", ")", "))", ";", "}", "catch", "(", "Throwable", "throwable", ")", "{", "serverException", "=", "throwable", ";", "}", "finally", "{", "if", "(", "engine", "!", "=", "null", "&", "&", "socket", "!", "=", "null", ")", "{", "final", "NioSslEngine", "nioSslEngine", "=", "engine", ";", "engine", ".", "close", "(", "socket", ".", "getChannel", "(", "))", ";", "assertThatThrownBy", "(", "()", "-", ">", "{", "nioSslEngine", ".", "unwrap", "(", "ByteBuffer", ".", "wrap", "(", "new", "byte", "[", "0", "]", "))", ";", "}", ")", ".", "isInstanceOf", "(", "IllegalStateException", ".", "class", ")", ";", "}", "}", "}", ",", "this", ".", "testName", ".", "getMethodName", "(", ")", "+", "\"", "-", "server", "\"", ");", "serverThread", ".", "start", "(", ");", "return", "serverThread", ";", "}", "private", "class", "MyThreadGroup", "extends", "ThreadGroup", "{", "public", "MyThreadGroup", "(", "final", "String", "name", ")", "{", "super", "(", "name", ")", ";", "}", "@", "Override", "public", "void", "uncaughtException", "(", "final", "Thread", "thread", ",", "final", "Throwable", "throwable", ")", "{", "errorCollector", ".", "addError", "(", "throwable", ")", ";", "}", "}", "}", "@", "@", "-", "933", ",", "6", "+", "933", ",", "14", "@", "@", "public", "NioSslEngine", "handshakeSSLSocketChannel", "(", "SocketChannel", "socketChannel", ",", "SSLEn", "if", "(", "!", "clientSocket", ")", "{", "engine", ".", "setNeedClientAuth", "(", "sslConfig", ".", "isRequireAuth", "(", "))", ";", "}", "if", "(", "clientSocket", ")", "{", "SSLParameters", "modifiedParams", "=", "checkAndEnableHostnameValidation", "(", "engine", ".", "getSSLParameters", "(", "))", ";", "engine", ".", "setSSLParameters", "(", "modifiedParams", ")", ";", "}", "private", "SSLParameters", "checkAndEnableHostnameValidation", "(", "SSLParameters", "sslParameters", ")", "{", "if", "(", "sslConfig", ".", "doEndpointIdentification", "(", "))", "{", "sslParameters", ".", "setEndpointIdentificationAlgorithm", "(", "\"", "HTTPS", "\"", ");", "}", "else", "{", "if", "(", "!", "hostnameValidationDisabledLogShown", ")", "{", "logger", ".", "info", "(", "\"", "Your", "SSL", "configuration", "disables", "hostname", "validation", ".", "\"", "+", "\"", "ssl", "-", "endpoint", "-", "identification", "-", "enabled", "should", "be", "set", "to", "true", "when", "SSL", "is", "enabled", ".", "\"", "+", "\"", "Please", "refer", "to", "the", "Apache", "GEODE", "SSL", "Documentation", "for", "SSL", "Property", ":", "ssl", "\u2011", "endpoint", "\u2011", "identification", "\u2011", "enabled", "\"", ");", "hostnameValidationDisabledLogShown", "=", "true", ";", "}", "}", "return", "sslParameters", ";", "}", "SSLParameters", "modifiedParams", "=", "checkAndEnableHostnameValidation", "(", "sslSocket", ".", "getSSLParameters", "(", "))", ";", "sslSocket", ".", "setSSLParameters", "(", "modifiedParams", ")", ";</s>if", "(", "sslConfig", ".", "doEndpointIdentification", "(", "))", "{", "SSLParameters", "sslParameters", "=", "sslSocket", ".", "getSSLParameters", "(", ");", "sslParameters", ".", "setEndpointIdentificationAlgorithm", "(", "\"", "HTTPS", "\"", ");", "sslSocket", ".", "setSSLParameters", "(", "sslParameters", ")", ";", "}", "else", "{", "if", "(", "!", "hostnameValidationDisabledLogShown", ")", "{", "logger", ".", "info", "(", "\"", "Your", "SSL", "configuration", "disables", "hostname", "validation", ".", "\"", "+", "\"", "ssl", "-", "endpoint", "-", "identification", "-", "enabled", "should", "be", "set", "to", "true", "when", "SSL", "is", "enabled", ".", "\"", "+", "\"", "Please", "refer", "to", "the", "Apache", "GEODE", "SSL", "Documentation", "for", "SSL", "Property", ":", "ssl", "\u2011", "endpoint", "\u2011", "identification", "\u2011", "enabled", "\"", ");", "hostnameValidationDisabledLogShown", "=", "true", ";", "}", "}", "import", "static", "org", ".", "apache", ".", "geode", ".", "internal", ".", "net", ".", "SSLConfigurationFactory", ".", "getSSLConfigForComponent", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "security", ".", "SecurableCommunicationChannel", ";", "if", "(", "!", "clientSocket", ")", "{", "engine", ".", "setNeedClientAuth", "(", "getSSLConfigForComponent", "(", "getConduit", "(", ").", "config", ",", "SecurableCommunicationChannel", ".", "CLUSTER", ")", ".", "isRequireAuth", "(", "))", ";", "}"], "docstring_tokens": ["using", "a", "man-in-the-middle", "attack", "."]}
{"contents": ["Merge", "pull", "request", "#510", "from", "wsargent/fix-197", "Fix", "for", "#197", "--", "use", "a", "hostname", "verifier", "that", "does", "hostname", "verification"], "code_tokens": ["import", "org", ".", "asynchttpclient", ".", "util", ".", "DefaultHostnameVerifier", ";", "private", "HostnameVerifier", "hostnameVerifier", "=", "new", "DefaultHostnameVerifier", "(", ");", "import", "org", ".", "asynchttpclient", ".", "util", ".", "DefaultHostnameVerifier", ";", "hostnameVerifier", "=", "new", "DefaultHostnameVerifier", "(", ");", "/", "*", "*", "To", "the", "extent", "possible", "under", "law", ",", "Kevin", "Locke", "has", "waived", "all", "copyright", "and", "*", "related", "or", "neighboring", "rights", "to", "this", "work", ".", "*", "<", "p", "/", ">", "*", "A", "legal", "description", "of", "this", "waiver", "is", "available", "in", "<", "a", "href", "=", "\"", "https", ":", "//", "gist", ".", "github", ".", "com", "/", "kevinoid", "/", "3829665", "\"", ">", "LICENSE", ".", "txt", "<", "/", "a", ">", "*", "/", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLPeerUnverifiedException", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLSession", ";", "import", "javax", ".", "security", ".", "auth", ".", "kerberos", ".", "KerberosPrincipal", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "Certificate", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "/", "**", "*", "Uses", "the", "internal", "HostnameChecker", "to", "verify", "the", "server", "'", "s", "hostname", "matches", "with", "the", "*", "certificate", ".", "This", "is", "a", "requirement", "for", "HTTPS", ",", "but", "the", "raw", "SSLEngine", "does", "not", "have", "*", "this", "functionality", ".", "As", "such", ",", "it", "has", "to", "be", "added", "in", "manually", ".", "For", "a", "more", "complete", "*", "description", "of", "hostname", "verification", "and", "why", "it", "'", "s", "important", ",", "*", "please", "read", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "tersesystems", ".", "com", "/", "2014", "/", "03", "/", "23", "/", "fixing", "-", "hostname", "-", "verification", "/", "\">", "Fixing", "*", "Hostname", "Verification", "<", "/", "a", ">", ".", "*", "<", "p", "/", ">", "*", "This", "code", "is", "based", "on", "Kevin", "Locke", "'", "s", "<", "a", "href", "=", "\"", "http", ":", "//", "kevinlocke", ".", "name", "/", "bits", "/", "2012", "/", "10", "/", "03", "/", "ssl", "-", "certificate", "-", "verification", "-", "in", "-", "dispatch", "-", "and", "-", "asynchttpclient", "/", "\">", "guide", "<", "/", "a", ">", ".", "*", "<", "p", "/", ">", "*", "/", "public", "class", "DefaultHostnameVerifier", "implements", "HostnameVerifier", "{", "private", "HostnameChecker", "checker", ";", "private", "HostnameVerifier", "extraHostnameVerifier", ";", "/", "/", "Logger", "to", "log", "exceptions", ".", "private", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "DefaultHostnameVerifier", ".", "class", ".", "getName", "(", "))", ";", "/", "**", "*", "A", "hostname", "verifier", "that", "uses", "the", "{", "{", "sun", ".", "security", ".", "util", ".", "HostnameChecker", "}", "}", "under", "the", "hood", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", ")", "{", "this", ".", "checker", "=", "new", "ProxyHostnameChecker", "(", ");", "}", "/", "**", "*", "A", "hostname", "verifier", "that", "takes", "an", "external", "hostname", "checker", ".", "Useful", "for", "testing", ".", "*", "*", "@", "param", "checker", "a", "hostnamechecker", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameChecker", "checker", ")", "{", "this", ".", "checker", "=", "checker", ";", "}", "/", "**", "*", "A", "hostname", "verifier", "that", "falls", "back", "to", "another", "hostname", "verifier", "if", "not", "found", ".", "*", "*", "@", "param", "extraHostnameVerifier", "another", "hostname", "verifier", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameVerifier", "extraHostnameVerifier", ")", "{", "this", ".", "checker", "=", "new", "ProxyHostnameChecker", "(", ");", "this", ".", "extraHostnameVerifier", "=", "extraHostnameVerifier", ";", "}", "/", "**", "*", "A", "hostname", "verifier", "with", "a", "hostname", "checker", ",", "that", "falls", "back", "to", "another", "hostname", "verifier", "if", "not", "found", ".", "*", "*", "@", "param", "checker", "a", "custom", "HostnameChecker", ".", "*", "@", "param", "extraHostnameVerifier", "another", "hostname", "verifier", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameChecker", "checker", ",", "HostnameVerifier", "extraHostnameVerifier", ")", "{", "this", ".", "checker", "=", "checker", ";", "this", ".", "extraHostnameVerifier", "=", "extraHostnameVerifier", ";", "}", "/", "**", "*", "Matches", "the", "hostname", "against", "the", "peer", "certificate", "in", "the", "session", ".", "*", "*", "@", "param", "hostname", "the", "IP", "address", "or", "hostname", "of", "the", "expected", "server", ".", "*", "@", "param", "session", "the", "SSL", "session", "containing", "the", "certificates", "with", "the", "ACTUAL", "hostname", "/", "ipaddress", ".", "*", "@", "return", "true", "if", "the", "hostname", "matches", ",", "false", "otherwise", ".", "*", "/", "private", "boolean", "hostnameMatches", "(", "String", "hostname", ",", "SSLSession", "session", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "hostname", "=", "{", "0", "}", ",", "session", "=", "{", "1", "}", "\",", "new", "Object", "[", "]", "{", "hostname", ",", "Base64", ".", "encode", "(", "session", ".", "getId", "(", "))", "}", ");", "try", "{", "final", "Certificate", "[", "]", "peerCertificates", "=", "session", ".", "getPeerCertificates", "(", ");", "if", "(", "peerCertificates", ".", "length", "=", "=", "0", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "No", "peer", "certificates", "\"", ");", "return", "false", ";", "}", "if", "(", "peerCertificates", "[", "0", "]", "instanceof", "X509Certificate", ")", "{", "X509Certificate", "peerCertificate", "=", "(", "X509Certificate", ")", "peerCertificates", "[", "0", "]", ";", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "peerCertificate", "=", "{", "0", "}", "\",", "peerCertificate", ")", ";", "try", "{", "checker", ".", "match", "(", "hostname", ",", "peerCertificate", ")", ";", "/", "/", "Certificate", "matches", "hostname", "if", "no", "exception", "is", "thrown", ".", "return", "true", ";", "}", "catch", "(", "CertificateException", "ex", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Certificate", "does", "not", "match", "hostname", "\"", ",", "ex", ")", ";", "}", "}", "else", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Peer", "does", "not", "have", "any", "certificates", "or", "they", "aren", "'", "t", "X", ".", "509", "\"", ");", "}", "return", "false", ";", "}", "catch", "(", "SSLPeerUnverifiedException", "ex", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Not", "using", "certificates", "for", "peers", ",", "try", "verifying", "the", "principal", "\"", ");", "try", "{", "Principal", "peerPrincipal", "=", "session", ".", "getPeerPrincipal", "(", ");", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "peerPrincipal", "=", "{", "0", "}", "\",", "peerPrincipal", ")", ";", "if", "(", "peerPrincipal", "instanceof", "KerberosPrincipal", ")", "{", "return", "checker", ".", "match", "(", "hostname", ",", "(", "KerberosPrincipal", ")", "peerPrincipal", ")", ";", "}", "else", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Can", "'", "t", "verify", "principal", ",", "not", "Kerberos", "\"", ");", "}", "}", "catch", "(", "SSLPeerUnverifiedException", "ex2", ")", "{", "/", "/", "Can", "'", "t", "verify", "principal", ",", "no", "principal", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Can", "'", "t", "verify", "principal", ",", "no", "principal", "\"", ",", "ex2", ")", ";", "}", "return", "false", ";", "}", "}", "/", "**", "*", "Verifies", "the", "hostname", "against", "the", "peer", "certificates", "in", "a", "session", ".", "Falls", "back", "to", "extraHostnameVerifier", "if", "*", "there", "is", "no", "match", ".", "*", "*", "@", "param", "hostname", "the", "IP", "address", "or", "hostname", "of", "the", "expected", "server", ".", "*", "@", "param", "session", "the", "SSL", "session", "containing", "the", "certificates", "with", "the", "ACTUAL", "hostname", "/", "ipaddress", ".", "*", "@", "return", "true", "if", "the", "hostname", "matches", ",", "false", "otherwise", ".", "*", "/", "public", "boolean", "verify", "(", "String", "hostname", ",", "SSLSession", "session", ")", "{", "if", "(", "hostnameMatches", "(", "hostname", ",", "session", ")", ")", "{", "return", "true", ";", "}", "else", "{", "return", "extraHostnameVerifier", "!", "=", "null", "&", "&", "extraHostnameVerifier", ".", "verify", "(", "hostname", ",", "session", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "Will", "Sargent", ".", "All", "rights", "reserved", ".", "*", "*", "This", "program", "is", "licensed", "to", "you", "under", "the", "Apache", "License", "Version", "2", ".", "0", ",", "*", "and", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "Apache", "License", "Version", "2", ".", "0", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "Apache", "License", "Version", "2", ".", "0", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ".", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "Apache", "License", "Version", "2", ".", "0", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "Apache", "License", "Version", "2", ".", "0", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "there", "under", ".", "*", "/", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "/", "**", "*", "Hostname", "checker", "interface", ".", "*", "/", "public", "interface", "HostnameChecker", "{", "public", "void", "match", "(", "String", "hostname", ",", "X509Certificate", "peerCertificate", ")", "throws", "CertificateException", ";", "public", "boolean", "match", "(", "String", "hostname", ",", "Principal", "principal", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "Will", "Sargent", ".", "All", "rights", "reserved", ".", "*", "*", "This", "program", "is", "licensed", "to", "you", "under", "the", "Apache", "License", "Version", "2", ".", "0", ",", "*", "and", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "Apache", "License", "Version", "2", ".", "0", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "Apache", "License", "Version", "2", ".", "0", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ".", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "Apache", "License", "Version", "2", ".", "0", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "Apache", "License", "Version", "2", ".", "0", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "there", "under", ".", "*", "/", "package", "org", ".", "asynchttpclient", ".", "util", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "/", "**", "*", "A", "HostnameChecker", "proxy", ".", "*", "/", "public", "class", "ProxyHostnameChecker", "implements", "HostnameChecker", "{", "public", "final", "static", "byte", "TYPE_TLS", "=", "1", ";", "private", "final", "Object", "checker", "=", "getHostnameChecker", "(", ");", "public", "ProxyHostnameChecker", "(", ")", "{", "}", "private", "Object", "getHostnameChecker", "(", ")", "{", "final", "ClassLoader", "classLoader", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "final", "Class", "<", "Object", ">", "hostnameCheckerClass", "=", "(", "Class", "<", "Object", ">", ")", "classLoader", ".", "loadClass", "(", "\"", "sun", ".", "security", ".", "util", ".", "HostnameChecker", "\"", ");", "final", "Method", "instanceMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "getInstance", "\"", ",", "Byte", ".", "TYPE", ")", ";", "return", "instanceMethod", ".", "invoke", "(", "null", ",", "TYPE_TLS", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "public", "void", "match", "(", "String", "hostname", ",", "X509Certificate", "peerCertificate", ")", "throws", "CertificateException", "{", "try", "{", "final", "Class", "<", "?>", "hostnameCheckerClass", "=", "checker", ".", "getClass", "(", ");", "final", "Method", "checkMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "match", "\"", ",", "String", ".", "class", ",", "X509Certificate", ".", "class", ")", ";", "checkMethod", ".", "invoke", "(", "checker", ",", "hostname", ",", "peerCertificate", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "Throwable", "t", "=", "e", ".", "getCause", "(", ");", "if", "(", "t", "instanceof", "CertificateException", ")", "{", "throw", "(", "CertificateException", ")", "t", ";", "}", "else", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "public", "boolean", "match", "(", "String", "hostname", ",", "Principal", "principal", ")", "{", "try", "{", "final", "Class", "<", "?>", "hostnameCheckerClass", "=", "checker", ".", "getClass", "(", ");", "final", "Method", "checkMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "match", "\"", ",", "String", ".", "class", ",", "Principal", ".", "class", ")", ";", "return", "(", "Boolean", ")", "checkMethod", ".", "invoke", "(", "null", ",", "hostname", ",", "principal", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "}</s>import", "org", ".", "asynchttpclient", ".", "util", ".", "AllowAllHostnameVerifier", ";", "private", "HostnameVerifier", "hostnameVerifier", "=", "new", "AllowAllHostnameVerifier", "(", ");", "hostnameVerifier", "=", "new", "HostnameVerifier", "(", ")", "{", "public", "boolean", "verify", "(", "String", "s", ",", "SSLSession", "sslSession", ")", "{", "return", "true", ";", "}", "}", ";"], "docstring_tokens": ["via", "an", "arbitrary", "valid", "certificate", "."]}
{"contents": ["Improve", "checking", "of", "EXIF", "profile", "to", "prevent", "integer", "overflow", "(bug", "report", "from", "Ibrahim", "el-sayed)"], "code_tokens": ["*", "quantum", "=", "(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "24", ";", "*", "quantum", "|", "=(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "16", ";", "*", "quantum", "|", "=(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "8", ";", "*", "quantum", "|", "=(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "0", ";", "*", "quantum", "=", "(", "unsigned", "short", ")", "(", "*", "p", "+", "+)", "<", "<", "8", ";", "*", "quantum", "|", "=(", "unsigned", "short", ")", "(", "*", "p", "+", "+)", ";", "}", "static", "inline", "void", "WriteResourceLong", "(", "unsigned", "char", "*", "p", ",", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "3", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "if", "(", "q", ">", "(", "exif", "+", "length", "-", "12", ")", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/", "if", "(", "components", "<", "0", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/", "unsigned", "int", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "3", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "3", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "0", "]", ";", "return", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "return", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "0", "]", ";", "return", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "return", "(", "value", "&", "0xffff", ")", ";", "if", "(", "q", ">", "(", "exif", "+", "length", "-", "12", ")", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/", "if", "(", "components", "<", "0", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/</s>*", "quantum", "=", "(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "24", ")", ";", "*", "quantum", "|", "=(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "16", ")", ";", "*", "quantum", "|", "=(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "8", ")", ";", "*", "quantum", "|", "=(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "0", ")", ";", "*", "quantum", "=", "(", "unsigned", "short", ")", "(", "*", "p", "+", "+", "<", "<", "8", ")", ";", "*", "quantum", "|", "=(", "unsigned", "short", ")", "(", "*", "p", "+", "+", "<", "<", "0", ")", ";", "}", "static", "inline", "void", "WriteResourceLong", "(", "unsigned", "char", "*", "p", ",", "value", "=", "(", "unsigned", "short", ")", "(", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "buffer", "[", "0", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "((", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "0", "]", "<", "<", "8", ")", "|", "(", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "1", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "3", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "(", "buffer", "[", "0", "]", "))", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "8", ")", "|", "buffer", "[", "3", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "size_t", "value", "=", "(", "size_t", ")", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", ";", "value", "|", "=", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "buffer", "[", "0", "]", "<", "<", "8", ")", ";", "value", "|", "=", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "3", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "(", "buffer", "[", "0", "]", "))", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "8", ")", "|", "buffer", "[", "3", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "3", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "(", "buffer", "[", "0", "]", "))", ";", "return", "(", "(", "unsigned", "int", ")", "(", "value", "&", "0xffffffff", ")", ");", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "8", ")", "|", "buffer", "[", "3", "]", ");", "return", "(", "(", "unsigned", "int", ")", "(", "value", "&", "0xffffffff", ")", ");", "value", "=", "(", "unsigned", "short", ")", "(", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "buffer", "[", "0", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "((", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "0", "]", "<", "<", "8", ")", "|", "(", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "1", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "buffer", "[", "0", "]", ");", "return", "(", "(", "unsigned", "short", ")", "(", "value", "&", "0xffff", ")", ");", "value", "=", "(", "unsigned", "short", ")", "(", "((", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "0", "]", "<", "<", "8", ")", "|", "(", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "1", "]", ");", "return", "(", "(", "unsigned", "short", ")", "(", "value", "&", "0xffff", ")", ");"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially", "crafted", "image", "file"]}
{"contents": ["Fix", "for", "Only", "accept", "change", "cipher", "spec", "when", "it", "is", "expected", "instead", "of", "at", "any", "time.", "This", "prevents", "premature", "setting", "of", "session", "keys", "before", "the", "master", "secret", "is", "determined", "which", "an", "attacker", "could", "use", "as", "a", "MITM", "attack.", "Thanks", "to", "KIKUCHI", "Masashi", "(Lepidum", "Co.", "Ltd.)", "for", "reporting", "this", "issue", "and", "providing", "the", "initial", "fix", "this", "patch", "is", "based", "on."], "code_tokens": ["s", "-", ">", "s3", "-", ">", "flags", "|", "=", "SSL3_FLAGS_CCS_OK", ";", "s", "-", ">", "s3", "-", ">", "flags", "|", "=", "SSL3_FLAGS_CCS_OK", ";", "if", "(", "!(", "s", "-", ">", "s3", "-", ">", "flags", "&", "SSL3_FLAGS_CCS_OK", ")", ")", "{", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "SSLerr", "(", "SSL_F_SSL3_READ_BYTES", ",", "SSL_R_CCS_RECEIVED_EARLY", ")", ";", "goto", "f_err", ";", "}", "s", "-", ">", "s3", "-", ">", "flags", "&", "=", "~", "SSL3_FLAGS_CCS_OK", ";", "s", "-", ">", "s3", "-", ">", "flags", "|", "=", "SSL3_FLAGS_CCS_OK", ";", "s", "-", ">", "s3", "-", ">", "flags", "|", "=", "SSL3_FLAGS_CCS_OK", ";", "{", "s", "-", ">", "s3", "-", ">", "flags", "|", "=", "SSL3_FLAGS_CCS_OK", ";", "}", "#", "define", "SSL3_FLAGS_CCS_OK", "0x0080</s>"], "docstring_tokens": ["using", "a", "specially-crafted", "handshake"]}
{"contents": ["Protect", "against", "symlink", "attacks", "Update", "embedded", "launch", "script", "to", "no", "longer", "change", "ownership", "of", "files", "or", "folders", "that", "already", "exist.", "Fixes", "gh-11397"], "code_tokens": ["@", "Test", "public", "void", "pidFolderOwnership", "(", ")", "throws", "Exception", "{", "String", "output", "=", "doTest", "(", "\"", "pid", "-", "folder", "-", "ownership", ".", "sh", "\"", ");", "System", ".", "err", ".", "println", "(", "output", ")", ";", "assertThat", "(", "output", ")", ".", "contains", "(", "\"", "phil", "root", "\"", ");", "}", "@", "Test", "public", "void", "pidFileOwnership", "(", ")", "throws", "Exception", "{", "String", "output", "=", "doTest", "(", "\"", "pid", "-", "file", "-", "ownership", ".", "sh", "\"", ");", "assertThat", "(", "output", ")", ".", "contains", "(", "\"", "phil", "root", "\"", ");", "}", "@", "Test", "public", "void", "logFileOwnership", "(", ")", "throws", "Exception", "{", "String", "output", "=", "doTest", "(", "\"", "log", "-", "file", "-", "ownership", ".", "sh", "\"", ");", "assertThat", "(", "output", ")", ".", "contains", "(", "\"", "phil", "root", "\"", ");", "}", "source", ".", "/", "test", "-", "functions", ".", "sh", "install_service", "chmod", "o", "+", "w", "/", "var", "/", "log", "useradd", "phil", "mkdir", "/", "phil", "-", "files", "chown", "phil", "/", "phil", "-", "files", "useradd", "andy", "chown", "andy", "/", "test", "-", "service", "/", "spring", "-", "boot", "-", "app", ".", "jar", "start_service", "stop_service", "su", "-", "andy", "-", "c", "\"", "ln", "-", "s", "-", "f", "/", "phil", "-", "files", "/", "var", "/", "log", "/", "spring", "-", "boot", "-", "app", ".", "log", "\"", "start_service", "ls", "-", "ld", "/", "phil", "-", "files", "@", "@", "-", "0", ",", "0", "+", "1", ",", "18", "@", "@", "source", ".", "/", "test", "-", "functions", ".", "sh", "install_service", "useradd", "phil", "mkdir", "/", "phil", "-", "files", "chown", "phil", "/", "phil", "-", "files", "useradd", "andy", "chown", "andy", "/", "test", "-", "service", "/", "spring", "-", "boot", "-", "app", ".", "jar", "start_service", "stop_service", "su", "-", "andy", "-", "c", "\"", "ln", "-", "s", "/", "phil", "-", "files", "/", "var", "/", "run", "/", "spring", "-", "boot", "-", "app", "/", "spring", "-", "boot", "-", "app", ".", "pid", "\"", "start_service", "ls", "-", "ld", "/", "phil", "-", "files", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "source", ".", "/", "test", "-", "functions", ".", "sh", "install_service", "chmod", "o", "+", "w", "/", "var", "/", "run", "useradd", "phil", "mkdir", "/", "phil", "-", "files", "chown", "phil", "/", "phil", "-", "files", "useradd", "andy", "chown", "andy", "/", "test", "-", "service", "/", "spring", "-", "boot", "-", "app", ".", "jar", "su", "-", "andy", "-", "c", "\"", "ln", "-", "s", "-", "f", "/", "phil", "-", "files", "/", "var", "/", "run", "/", "spring", "-", "boot", "-", "app", "\"", "start_service", "ls", "-", "ld", "/", "phil", "-", "files", "@", "@", "-", "146", ",", "12", "+", "146", ",", "12", "@", "@", "start", "(", ")", "{", "if", "[", "[", "!", "-", "e", "\"", "$", "PID_FOLDER", "\"", "]", "];", "then", "mkdir", "-", "p", "\"", "$", "PID_FOLDER", "\"", "&", ">", "/", "dev", "/", "null", "chown", "\"", "$", "run_user", "\"", "\"", "$", "PID_FOLDER", "\"", "fi</s>mkdir", "-", "p", "\"", "$", "PID_FOLDER", "\"", "&", ">", "/", "dev", "/", "null", "chown", "\"", "$", "run_user", "\"", "\"", "$", "PID_FOLDER", "\"", "chown", "\"", "$", "run_user", "\"", "\"", "$", "pid_file", "\"", "chown", "\"", "$", "run_user", "\"", "\"", "$", "log_file", "\"", "-", "-", "chuid", "\"", "$", "run_user", "\"", "\\"], "docstring_tokens": ["creating", "a", "symbolic", "link", "from", "a", "temporary", "file", "to", "various", "files", "on", "the", "system"]}
{"contents": ["Merge", "pull", "request", "#2330", "from", "square/jwilson_0209_dont_pay", "Don't", "pay", "to", "clean", "certificates", "if", "we", "aren't", "pinning."], "code_tokens": ["if", "(", "trustRootIndex", "!", "=", "null", ")", "{", "peerCertificates", "=", "new", "CertificateChainCleaner", "(", "trustRootIndex", ")", ".", "clean", "(", "peerCertificates", ")", ";", "}</s>if", "(", "trustRootIndex", "!", "=", "null", ")", "{", "peerCertificates", "=", "new", "CertificateChainCleaner", "(", "trustRootIndex", ")", ".", "clean", "(", "peerCertificates", ")", ";", "}"], "docstring_tokens": ["by", "sending", "a", "certificate", "chain", "with", "a", "certificate", "from", "a", "non-pinned", "trusted", "CA", "and", "the", "pinned", "certificate", "."]}
{"contents": ["SOLR-13971:", "Removing", "velocity", "from", "_default", "and", "disabling", "custom", "template", "support", "by", "default"], "code_tokens": ["*", "SOLR", "-", "13971", ":", "Velocity", "response", "writer", "'", "s", "resource", "loading", "now", "possible", "only", "through", "startup", "parameters", ".", "Also", ",", "removed", "velocity", "response", "writer", "from", "_default", "configset", ".", "(", "Ishan", "Chattopadhyaya", ")", "public", "static", "final", "String", "PROPERTIES_FILE", "=", "\"", "init", ".", "properties", ".", "file", "\"", ";", "/", "/", "System", "property", "names", ",", "these", "are", "_only_", "loaded", "at", "node", "startup", "(", "no", "per", "-", "request", "control", "of", "these", ")", "Boolean", "prle", "=", "Boolean", ".", "getBoolean", "(", "PARAMS_RESOURCE_LOADER_ENABLED", ")", ";", "/", "/", "solr", "resource", "loader", ":", "off", "by", "default", "Boolean", "srle", "=", "Boolean", ".", "getBoolean", "(", "SOLR_RESOURCE_LOADER_ENABLED", ")", ";", "solrResourceLoaderEnabled", "=", "(", "null", "=", "=", "srle", "?", "false", ":", "srle", ")", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "System", ".", "setProperty", "(", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "System", ".", "setProperty", "(", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "@", "AfterClass", "public", "static", "void", "afterClass", "(", ")", "throws", "Exception", "{", "System", ".", "clearProperty", "(", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ");", "System", ".", "clearProperty", "(", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ");", "}", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "browse", "\"", ">", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "browse", "\"", ">", "The", "above", "example", "shows", "the", "optional", "initialization", "and", "custom", "tool", "parameters", "used", "by", "VelocityResponseWriter", ";", "these", "are", "detailed", "in", "the", "following", "table", ".", "These", "initialization", "parameters", "are", "only", "specified", "in", "the", "writer", "registration", "in", "`", "solrconfig", ".", "xml", "`", ",", "not", "as", "request", "-", "time", "parameters", ".", "In", "this", "example", ",", "all", "Solr", "nodes", "should", "be", "started", "with", "`", "-", "Dparams", ".", "resource", ".", "loader", ".", "enabled", "=", "true", "`", ".", "See", "further", "below", "for", "request", "-", "time", "parameters", ".", "=", "==", "VelocityResponseWriter", "Startup", "Parameters", "=", "==", "VelocityResponseWriter", "Initialization", "Parameters", "`", "template", ".", "base", ".", "dir", "`", "::", "If", "specified", "and", "exists", "as", "a", "file", "system", "directory", ",", "a", "file", "resource", "loader", "will", "be", "added", "for", "this", "directory", ".", "Templates", "in", "this", "directory", "will", "override", "\"", "solr", "\"", "resource", "loader", "templates", ".", "`", "init", ".", "properties", ".", "file", "`", "::", "Specifies", "a", "properties", "file", "name", "which", "must", "exist", "in", "the", "Solr", "`", "conf", "/", "`", "directory", "(", "*", "not", "*", "under", "a", "`", "velocity", "/", "`", "subdirectory", ")", "or", "root", "of", "a", "JAR", "file", "in", "a", "<", "lib", ">", ".</s>public", "static", "final", "String", "PROPERTIES_FILE", "=", "\"", "init", ".", "properties", ".", "file", "\"", ";", "Boolean", "prle", "=", "args", ".", "getBooleanArg", "(", "PARAMS_RESOURCE_LOADER_ENABLED", ")", ";", "/", "/", "solr", "resource", "loader", ":", "on", "by", "default", "Boolean", "srle", "=", "args", ".", "getBooleanArg", "(", "SOLR_RESOURCE_LOADER_ENABLED", ")", ";", "solrResourceLoaderEnabled", "=", "(", "null", "=", "=", "srle", "?", "true", ":", "srle", ")", ";", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "contrib", "/", "velocity", "/", "lib", "\"", "regex", "=", "\".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "velocity", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "-", "->", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "velocity", ",", "browse", "\"", ">", "-", "->", "<", "!", "Custom", "response", "writers", "can", "be", "declared", "as", "needed", ".", "..", "-", "->", "<", "queryResponseWriter", "name", "=", "\"", "velocity", "\"", "class", "=", "\"", "solr", ".", "VelocityResponseWriter", "\"", "startup", "=", "\"", "lazy", "\"", ">", "<", "str", "name", "=", "\"", "template", ".", "base", ".", "dir", "\"", ">$", "{", "velocity", ".", "template", ".", "base", ".", "dir", ":", "}<", "/", "str", ">", "<", "str", "name", "=", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "solr", ".", "resource", ".", "loader", ".", "enabled", ":", "true", "}", "</", "str", ">", "<", "str", "name", "=", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "params", ".", "resource", ".", "loader", ".", "enabled", ":", "false", "}", "</", "str", ">", "<", "/", "queryResponseWriter", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "contrib", "/", "velocity", "/", "lib", "\"", "regex", "=", "\".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "velocity", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "-", "->", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "velocity", ",", "browse", "\"", ">", "-", "->", "<", "!", "Custom", "response", "writers", "can", "be", "declared", "as", "needed", ".", "..", "-", "->", "<", "queryResponseWriter", "name", "=", "\"", "velocity", "\"", "class", "=", "\"", "solr", ".", "VelocityResponseWriter", "\"", "startup", "=", "\"", "lazy", "\"", ">", "<", "str", "name", "=", "\"", "template", ".", "base", ".", "dir", "\"", ">$", "{", "velocity", ".", "template", ".", "base", ".", "dir", ":", "}<", "/", "str", ">", "<", "str", "name", "=", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "solr", ".", "resource", ".", "loader", ".", "enabled", ":", "true", "}", "</", "str", ">", "<", "str", "name", "=", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "params", ".", "resource", ".", "loader", ".", "enabled", ":", "false", "}", "</", "str", ">", "<", "/", "queryResponseWriter", ">", "<", "bool", "name", "=", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ">", "true", "<", "/", "bool", ">", "<", "bool", "name", "=", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ">", "false", "<", "/", "bool", ">", "-", "->", "The", "above", "example", "shows", "the", "optional", "initialization", "and", "custom", "tool", "parameters", "used", "by", "VelocityResponseWriter", ";", "these", "are", "detailed", "in", "the", "following", "table", ".", "These", "initialization", "parameters", "are", "only", "specified", "in", "the", "writer", "registration", "in", "`", "solrconfig", ".", "xml", "`", ",", "not", "as", "request", "-", "time", "parameters", ".", "See", "further", "below", "for", "request", "-", "time", "parameters", ".", "=", "==", "VelocityResponseWriter", "Initialization", "Parameters", "`", "template", ".", "base", ".", "dir", "`", "::", "If", "specified", "and", "exists", "as", "a", "file", "system", "directory", ",", "a", "file", "resource", "loader", "will", "be", "added", "for", "this", "directory", ".", "Templates", "in", "this", "directory", "will", "override", "\"", "solr", "\"", "resource", "loader", "templates", ".", "`", "init", ".", "properties", ".", "file", "`", "::", "Specifies", "a", "properties", "file", "name", "which", "must", "exist", "in", "the", "Solr", "`", "conf", "/", "`", "directory", "(", "*", "not", "*", "under", "a", "`", "velocity", "/", "`", "subdirectory", ")", "or", "root", "of", "a", "JAR", "file", "in", "a", "<", "lib", ">", "."], "docstring_tokens": ["the", "VelocityResponseWriter"]}
{"contents": ["perf:", "Remove", "the", "nmi", "parameter", "from", "the", "swevent", "and", "overflow", "interface", "The", "nmi", "parameter", "indicated", "if", "we", "could", "do", "wakeups", "from", "the", "current", "context,", "if", "not,", "we", "would", "set", "some", "state", "and", "self-IPI", "and", "let", "the", "resulting", "interrupt", "do", "the", "wakeup.", "For", "the", "various", "event", "classes:", "-", "hardware:", "nmi=0;", "PMI", "is", "in", "fact", "an", "NMI", "or", "we", "run", "irq_work_run", "from", "the", "PMI-tail", "(ARM", "etc.)", "-", "tracepoint:", "nmi=0;", "since", "tracepoint", "could", "be", "from", "NMI", "context.", "-", "software:", "nmi=[0,1];", "some,", "like", "the", "schedule", "thing", "cannot", "perform", "wakeups,", "and", "hence", "need", "0.", "As", "one", "can", "see,", "there", "is", "very", "little", "nmi=1", "usage,", "and", "the", "down-side", "of", "not", "using", "it", "is", "that", "on", "some", "platforms", "some", "software", "events", "can", "have", "a", "jiffy", "delay", "in", "wakeup", "(when", "arch_irq_work_raise", "isn't", "implemented).", "The", "up-side", "however", "is", "that", "we", "can", "remove", "the", "nmi", "parameter", "and", "save", "a", "bunch", "of", "conditionals", "in", "fast", "paths.", "Signed-off-by:", "Peter", "Zijlstra", "<a.p.zijlstra@chello.nl>", "Cc:", "Michael", "Cree", "<mcree@orcon.net.nz>", "Cc:", "Will", "Deacon", "<will.deacon@arm.com>", "Cc:", "Deng-Cheng", "Zhu", "<dengcheng.zhu@gmail.com>", "Cc:", "Anton", "Blanchard", "<anton@samba.org>", "Cc:", "Eric", "B", "Munson", "<emunson@mgebm.net>", "Cc:", "Heiko", "Carstens", "<heiko.carstens@de.ibm.com>", "Cc:", "Paul", "Mundt", "<lethal@linux-sh.org>", "Cc:", "David", "S.", "Miller", "<davem@davemloft.net>", "Cc:", "Frederic", "Weisbecker", "<fweisbec@gmail.com>", "Cc:", "Jason", "Wessel", "<jason.wessel@windriver.com>", "Cc:", "Don", "Zickus", "<dzickus@redhat.com>", "Link:", "http://lkml.kernel.org/n/tip-agjev8eu666tvknpb3iaj0fg@git.kernel.org", "Signed-off-by:", "Ingo", "Molnar", "<mingo@elte.hu>"], "code_tokens": ["if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "{", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "static", "void", "ptrace_hbptriggered", "(", "struct", "perf_event", "*", "bp", ",", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "regs", "-", ">", "ARM_pc", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "regs", ",", "addr", ")", ";", "if", "(", "perf_event_overflow", "(", "event", ",", "data", ",", "regs", ")", ")", "1", ",", "regs", ",", "0", ")", ";", "1", ",", "regs", ",", "0", ")", ";", "1", ",", "regs", ",", "0", ")", ";", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "1", ",", "regs", ",", "regs", "-", ">", "cp0_badvaddr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "xcp", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "regs", ",", "address", ")", ";", "1", ",", "regs", ",", "0", ")", ";", "\\", "1", ",", "regs", ",", "regs", "-", ">", "dar", ")", ";", "\\", "struct", "pt_regs", "*", "regs", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "record_and_restart", "(", "event", ",", "val", ",", "regs", ")", ";", "struct", "pt_regs", "*", "regs", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "record_and_restart", "(", "event", ",", "val", ",", "regs", ")", ";", "void", "ptrace_triggered", "(", "struct", "perf_event", "*", "bp", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "void", "ptrace_triggered", "(", "struct", "perf_event", "*", "bp", ",", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "sfar", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "regs", ",", "sfar", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "regs", ",", "address", ")", ";", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_output_begin", "(", "&", "handle", ",", "event", ",", "header", ".", "size", "*", "(", "top", "-", "at", ")", ",", "1", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "&", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "static", "void", "kgdb_hw_overflow_handler", "(", "struct", "perf_event", "*", "event", ",", "static", "void", "ptrace_triggered", "(", "struct", "perf_event", "*", "bp", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "typedef", "void", "(", "*", "perf_overflow_handler_t", ")", "(", "struct", "perf_event", "*", ",", "extern", "int", "perf_event_overflow", "(", "struct", "perf_event", "*", "event", ",", "extern", "void", "__perf_sw_event", "(", "u32", ",", "u64", ",", "struct", "pt_regs", "*", ",", "u64", ")", ";", "perf_sw_event", "(", "u32", "event_id", ",", "u64", "nr", ",", "struct", "pt_regs", "*", "regs", ",", "u64", "addr", ")", "__perf_sw_event", "(", "event_id", ",", "nr", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_CONTEXT_SWITCHES", ",", "1", ",", "NULL", ",", "0", ")", ";", "int", "sample", ")", ";", "perf_sw_event", "(", "u32", "event_id", ",", "u64", "nr", ",", "struct", "pt_regs", "*", "regs", ",", "u64", "addr", ")", "{", "}", "static", "void", "perf_event_output", "(", "struct", "perf_event", "*", "event", ",", "if", "(", "perf_output_begin", "(", "&", "handle", ",", "event", ",", "header", ".", "size", ",", "1", ")", ")", "ret", "=", "perf_output_begin", "(", "&", "handle", ",", "event", ",", "read_event", ".", "header", ".", "size", ",", "0", ")", ";", "task_event", "-", ">", "event_id", ".", "header", ".", "size", ",", "0", ")", ";", "comm_event", "-", ">", "event_id", ".", "header", ".", "size", ",", "0", ")", ";", "mmap_event", "-", ">", "event_id", ".", "header", ".", "size", ",", "0", ")", ";", "throttle_event", ".", "header", ".", "size", ",", "0", ")", ";", "static", "int", "__perf_event_overflow", "(", "struct", "perf_event", "*", "event", ",", "event", "-", ">", "pending_disable", "=", "1", ";", "irq_work_queue", "(", "&", "event", "-", ">", "pending", ")", ";", "event", "-", ">", "overflow_handler", "(", "event", ",", "data", ",", "regs", ")", ";", "perf_event_output", "(", "event", ",", "data", ",", "regs", ")", ";", "event", "-", ">", "pending_wakeup", "=", "1", ";", "irq_work_queue", "(", "&", "event", "-", ">", "pending", ")", ";", "int", "perf_event_overflow", "(", "struct", "perf_event", "*", "event", ",", "return", "__perf_event_overflow", "(", "event", ",", "1", ",", "data", ",", "regs", ")", ";", "struct", "perf_sample_data", "*", "data", ",", "if", "(", "__perf_event_overflow", "(", "event", ",", "throttle", ",", "struct", "perf_sample_data", "*", "data", ",", "return", "perf_swevent_overflow", "(", "event", ",", "1", ",", "data", ",", "regs", ")", ";", "perf_swevent_overflow", "(", "event", ",", "0", ",", "data", ",", "regs", ")", ";", "u64", "nr", ",", "perf_swevent_event", "(", "event", ",", "nr", ",", "data", ",", "regs", ")", ";", "void", "__perf_sw_event", "(", "u32", "event_id", ",", "u64", "nr", ",", "struct", "pt_regs", "*", "regs", ",", "u64", "addr", ")", "do_perf_sw_event", "(", "PERF_TYPE_SOFTWARE", ",", "event_id", ",", "nr", ",", "&", "data", ",", "regs", ")", ";", "perf_swevent_event", "(", "event", ",", "count", ",", "&", "data", ",", "regs", ")", ";", "perf_swevent_event", "(", "bp", ",", "1", ",", "&", "sample", ",", "regs", ")", ";", "if", "(", "perf_event_overflow", "(", "event", ",", "&", "data", ",", "regs", ")", ")", "handle", "-", ">", "event", "-", ">", "pending_wakeup", "=", "1", ";", "irq_work_queue", "(", "&", "handle", "-", ">", "event", "-", ">", "pending", ")", ";", "int", "sample", ")", "perf_sw_event", "(", "PERF_COUNT_SW_CPU_MIGRATIONS", ",", "1", ",", "NULL", ",", "0", ")", ";", "static", "void", "watchdog_overflow_callback", "(", "struct", "perf_event", "*", "event", ",", "static", "void", "sample_hbp_handler", "(", "struct", "perf_event", "*", "bp", ",</s>if", "(", "perf_event_overflow", "(", "event", ",", "1", ",", "&", "data", ",", "regs", ")", ")", "{", "if", "(", "perf_event_overflow", "(", "event", ",", "0", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "0", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "0", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "0", ",", "&", "data", ",", "regs", ")", ")", "static", "void", "ptrace_hbptriggered", "(", "struct", "perf_event", "*", "bp", ",", "int", "unused", ",", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "regs", "-", ">", "ARM_pc", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "regs", ",", "addr", ")", ";", "if", "(", "perf_event_overflow", "(", "event", ",", "0", ",", "data", ",", "regs", ")", ")", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "1", ",", "0", ",", "regs", ",", "regs", "-", ">", "cp0_badvaddr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "xcp", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "\\", "1", ",", "0", ",", "regs", ",", "regs", "-", ">", "dar", ")", ";", "\\", "struct", "pt_regs", "*", "regs", ",", "int", "nmi", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "nmi", ",", "&", "data", ",", "regs", ")", ")", "record_and_restart", "(", "event", ",", "val", ",", "regs", ",", "nmi", ")", ";", "struct", "pt_regs", "*", "regs", ",", "int", "nmi", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "nmi", ",", "&", "data", ",", "regs", ")", ")", "record_and_restart", "(", "event", ",", "val", ",", "regs", ",", "nmi", ")", ";", "void", "ptrace_triggered", "(", "struct", "perf_event", "*", "bp", ",", "int", "nmi", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "void", "ptrace_triggered", "(", "struct", "perf_event", "*", "bp", ",", "int", "nmi", ",", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "if", "(", "perf_event_overflow", "(", "event", ",", "1", ",", "&", "data", ",", "regs", ")", ")", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "sfar", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_ALIGNMENT_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "sfar", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_EMULATION_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "0", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "if", "(", "perf_event_overflow", "(", "event", ",", "1", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "1", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "perf_output_begin", "(", "&", "handle", ",", "event", ",", "header", ".", "size", "*", "(", "top", "-", "at", ")", ",", "1", ",", "1", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "1", ",", "&", "data", ",", "&", "regs", ")", ")", "if", "(", "perf_event_overflow", "(", "event", ",", "1", ",", "&", "data", ",", "regs", ")", ")", "static", "void", "kgdb_hw_overflow_handler", "(", "struct", "perf_event", "*", "event", ",", "int", "nmi", ",", "static", "void", "ptrace_triggered", "(", "struct", "perf_event", "*", "bp", ",", "int", "nmi", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS", ",", "1", ",", "0", ",", "regs", ",", "address", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MAJ", ",", "1", ",", "0", ",", "perf_sw_event", "(", "PERF_COUNT_SW_PAGE_FAULTS_MIN", ",", "1", ",", "0", ",", "typedef", "void", "(", "*", "perf_overflow_handler_t", ")", "(", "struct", "perf_event", "*", ",", "int", ",", "int", "nmi", ";", "extern", "int", "perf_event_overflow", "(", "struct", "perf_event", "*", "event", ",", "int", "nmi", ",", "extern", "void", "__perf_sw_event", "(", "u32", ",", "u64", ",", "int", ",", "struct", "pt_regs", "*", ",", "u64", ")", ";", "perf_sw_event", "(", "u32", "event_id", ",", "u64", "nr", ",", "int", "nmi", ",", "struct", "pt_regs", "*", "regs", ",", "u64", "addr", ")", "__perf_sw_event", "(", "event_id", ",", "nr", ",", "nmi", ",", "regs", ",", "addr", ")", ";", "perf_sw_event", "(", "PERF_COUNT_SW_CONTEXT_SWITCHES", ",", "1", ",", "1", ",", "NULL", ",", "0", ")", ";", "int", "nmi", ",", "int", "sample", ")", ";", "perf_sw_event", "(", "u32", "event_id", ",", "u64", "nr", ",", "int", "nmi", ",", "struct", "pt_regs", "*", "regs", ",", "u64", "addr", ")", "{", "}", "static", "void", "perf_event_output", "(", "struct", "perf_event", "*", "event", ",", "int", "nmi", ",", "if", "(", "perf_output_begin", "(", "&", "handle", ",", "event", ",", "header", ".", "size", ",", "nmi", ",", "1", ")", ")", "ret", "=", "perf_output_begin", "(", "&", "handle", ",", "event", ",", "read_event", ".", "header", ".", "size", ",", "0", ",", "0", ")", ";", "task_event", "-", ">", "event_id", ".", "header", ".", "size", ",", "0", ",", "0", ")", ";", "comm_event", "-", ">", "event_id", ".", "header", ".", "size", ",", "0", ",", "0", ")", ";", "mmap_event", "-", ">", "event_id", ".", "header", ".", "size", ",", "0", ",", "0", ")", ";", "throttle_event", ".", "header", ".", "size", ",", "1", ",", "0", ")", ";", "static", "int", "__perf_event_overflow", "(", "struct", "perf_event", "*", "event", ",", "int", "nmi", ",", "if", "(", "nmi", ")", "{", "event", "-", ">", "pending_disable", "=", "1", ";", "irq_work_queue", "(", "&", "event", "-", ">", "pending", ")", ";", "}", "else", "perf_event_disable", "(", "event", ")", ";", "event", "-", ">", "overflow_handler", "(", "event", ",", "nmi", ",", "data", ",", "regs", ")", ";", "perf_event_output", "(", "event", ",", "nmi", ",", "data", ",", "regs", ")", ";", "if", "(", "nmi", ")", "{", "event", "-", ">", "pending_wakeup", "=", "1", ";", "irq_work_queue", "(", "&", "event", "-", ">", "pending", ")", ";", "}", "else", "perf_event_wakeup", "(", "event", ")", ";", "int", "perf_event_overflow", "(", "struct", "perf_event", "*", "event", ",", "int", "nmi", ",", "return", "__perf_event_overflow", "(", "event", ",", "nmi", ",", "1", ",", "data", ",", "regs", ")", ";", "int", "nmi", ",", "struct", "perf_sample_data", "*", "data", ",", "if", "(", "__perf_event_overflow", "(", "event", ",", "nmi", ",", "throttle", ",", "int", "nmi", ",", "struct", "perf_sample_data", "*", "data", ",", "return", "perf_swevent_overflow", "(", "event", ",", "1", ",", "nmi", ",", "data", ",", "regs", ")", ";", "perf_swevent_overflow", "(", "event", ",", "0", ",", "nmi", ",", "data", ",", "regs", ")", ";", "u64", "nr", ",", "int", "nmi", ",", "perf_swevent_event", "(", "event", ",", "nr", ",", "nmi", ",", "data", ",", "regs", ")", ";", "void", "__perf_sw_event", "(", "u32", "event_id", ",", "u64", "nr", ",", "int", "nmi", ",", "struct", "pt_regs", "*", "regs", ",", "u64", "addr", ")", "do_perf_sw_event", "(", "PERF_TYPE_SOFTWARE", ",", "event_id", ",", "nr", ",", "nmi", ",", "&", "data", ",", "regs", ")", ";", "perf_swevent_event", "(", "event", ",", "count", ",", "1", ",", "&", "data", ",", "regs", ")", ";", "perf_swevent_event", "(", "bp", ",", "1", ",", "1", ",", "&", "sample", ",", "regs", ")", ";", "if", "(", "perf_event_overflow", "(", "event", ",", "0", ",", "&", "data", ",", "regs", ")", ")", "if", "(", "handle", "-", ">", "nmi", ")", "{", "handle", "-", ">", "event", "-", ">", "pending_wakeup", "=", "1", ";", "irq_work_queue", "(", "&", "handle", "-", ">", "event", "-", ">", "pending", ")", ";", "}", "else", "perf_event_wakeup", "(", "handle", "-", ">", "event", ")", ";", "int", "nmi", ",", "int", "sample", ")", "handle", "-", ">", "nmi", "=", "nmi", ";", "perf_sw_event", "(", "PERF_COUNT_SW_CPU_MIGRATIONS", ",", "1", ",", "1", ",", "NULL", ",", "0", ")", ";", "static", "void", "watchdog_overflow_callback", "(", "struct", "perf_event", "*", "event", ",", "int", "nmi", ",", "static", "void", "sample_hbp_handler", "(", "struct", "perf_event", "*", "bp", ",", "int", "nmi", ","], "docstring_tokens": ["using", "a", "specially-crafted", "application"]}
{"contents": ["Make", "it", "possible", "to", "white", "list", "and", "black", "list", "classes", "used", "in", "OGNL", "and", "MVEL2", "scripting", "languages", "(#158)", "*", "Make", "it", "possible", "to", "white", "list", "and", "black", "list", "classes", "used", "in", "OGNL", "and", "MVEL2", "scripting", "languages", "*", "Add", "new", "integration", "test", "to", "AllITs", "list", "*", "Add", "some", "documentation", "for", "the", "configuration", "parameters", "(cherry", "picked", "from", "commit", "789ae8e820c507866b9c91590feebffa4e996f5e)"], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "common", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "*", "A", "class", "loader", "that", "uses", "a", "whitelist", "and", "a", "black", "list", "of", "classes", "that", "it", "will", "allow", "to", "resolve", ".", "This", "is", "useful", "for", "providing", "proper", "*", "sandboxing", "to", "scripting", "engine", "such", "as", "MVEL", ",", "OGNL", "or", "Groovy", ".", "*", "/", "public", "class", "SecureFilteringClassLoader", "extends", "ClassLoader", "{", "private", "Set", "<", "String", ">", "allowedClasses", "=", "null", ";", "private", "Set", "<", "String", ">", "forbiddenClasses", "=", "null", ";", "private", "static", "Set", "<", "String", ">", "defaultAllowedClasses", "=", "null", ";", "private", "static", "Set", "<", "String", ">", "defaultForbiddenClasses", "=", "null", ";", "static", "{", "String", "systemAllowedClasses", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "allow", "\"", ",", "\"", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*\"", ");", "if", "(", "systemAllowedClasses", "!", "=", "null", ")", "{", "if", "(", "\"", "all", "\"", ".", "equals", "(", "systemAllowedClasses", ".", "trim", "(", "))", ")", "{", "defaultAllowedClasses", "=", "null", ";", "}", "else", "{", "if", "(", "systemAllowedClasses", ".", "trim", "(", ").", "length", "(", ")", ">", "0", ")", "{", "String", "[", "]", "systemAllowedClassesParts", "=", "systemAllowedClasses", ".", "split", "(", "\",", "\")", ";", "defaultAllowedClasses", "=", "new", "HashSet", "<", ">(", ");", "defaultAllowedClasses", ".", "addAll", "(", "Arrays", ".", "asList", "(", "systemAllowedClassesParts", ")", ");", "}", "else", "{", "defaultAllowedClasses", "=", "null", ";", "}", "}", "}", "String", "systemForbiddenClasses", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "forbid", "\"", ",", "null", ")", ";", "if", "(", "systemForbiddenClasses", "!", "=", "null", ")", "{", "if", "(", "systemForbiddenClasses", ".", "trim", "(", ").", "length", "(", ")", ">", "0", ")", "{", "String", "[", "]", "systemForbiddenClassesParts", "=", "systemForbiddenClasses", ".", "split", "(", "\",", "\")", ";", "defaultForbiddenClasses", "=", "new", "HashSet", "<", ">(", ");", "defaultForbiddenClasses", ".", "addAll", "(", "Arrays", ".", "asList", "(", "systemForbiddenClassesParts", ")", ");", "}", "else", "{", "defaultForbiddenClasses", "=", "null", ";", "}", "}", "}", "ClassLoader", "delegate", ";", "/", "**", "*", "Sets", "up", "the", "securing", "filtering", "class", "loader", ",", "using", "the", "default", "allowed", "and", "forbidden", "classes", ".", "By", "default", "the", "*", "@", "param", "delegate", "the", "class", "loader", "we", "delegate", "to", "if", "the", "filtering", "was", "not", "applied", ".", "*", "/", "public", "SecureFilteringClassLoader", "(", "ClassLoader", "delegate", ")", "{", "this", "(", "defaultAllowedClasses", ",", "defaultForbiddenClasses", ",", "delegate", ")", ";", "}", "/", "**", "*", "Sets", "up", "the", "secure", "filtering", "class", "loader", "*", "@", "param", "allowedClasses", "the", "list", "of", "allowed", "FQN", "class", "names", ",", "or", "if", "this", "filtering", "is", "to", "be", "deactivated", ",", "pass", "null", ".", "*", "if", "you", "want", "to", "allow", "no", "class", ",", "pass", "an", "empty", "hashset", "*", "@", "param", "forbiddenClasses", "the", "list", "of", "forbidden", "FQN", "class", "names", ",", "or", "if", "this", "filtering", "is", "to", "be", "deactivated", ",", "pass", "null", "or", "an", "empty", "set", "*", "*", "@", "param", "delegate", "the", "class", "loader", "we", "delegate", "to", "if", "the", "filtering", "was", "not", "applied", ".", "*", "/", "public", "SecureFilteringClassLoader", "(", "Set", "<", "String", ">", "allowedClasses", ",", "Set", "<", "String", ">", "forbiddenClasses", ",", "ClassLoader", "delegate", ")", "{", "super", "(", "delegate", ")", ";", "this", ".", "allowedClasses", "=", "allowedClasses", ";", "this", ".", "forbiddenClasses", "=", "forbiddenClasses", ";", "this", ".", "delegate", "=", "delegate", ";", "}", "@", "Override", "public", "Class", "<", "?>", "loadClass", "(", "String", "name", ")", "throws", "ClassNotFoundException", "{", "if", "(", "forbiddenClasses", "!", "=", "null", "&", "&", "classNameMatches", "(", "forbiddenClasses", ",", "name", ")", ")", "{", "throw", "new", "ClassNotFoundException", "(", "\"", "Access", "to", "class", "\"", "+", "name", "+", "\"", "not", "allowed", "\"", ");", "}", "if", "(", "allowedClasses", "!", "=", "null", "&", "&", "!", "classNameMatches", "(", "allowedClasses", ",", "name", ")", ")", "{", "throw", "new", "ClassNotFoundException", "(", "\"", "Access", "to", "class", "\"", "+", "name", "+", "\"", "not", "allowed", "\"", ");", "}", "return", "delegate", ".", "loadClass", "(", "name", ")", ";", "}", "private", "boolean", "classNameMatches", "(", "Set", "<", "String", ">", "classesToTest", ",", "String", "className", ")", "{", "for", "(", "String", "classToTest", ":", "classesToTest", ")", "{", "if", "(", "classToTest", ".", "endsWith", "(", "\"*", "\")", ")", "{", "if", "(", "className", ".", "startsWith", "(", "classToTest", ".", "substring", "(", "0", ",", "classToTest", ".", "length", "(", ")", "-", "1", ")", "))", "return", "true", ";", "}", "else", "{", "if", "(", "className", ".", "equals", "(", "classToTest", ")", ")", "return", "true", ";", "}", "}", "return", "false", ";", "}", "}", "@", "@", "-", "41", ",", "7", "+", "41", ",", "8", "@", "@", "UpdateEventFromContextServletIT", ".", "class", ",", "SecurityIT", ".", "class", "String", "karafDebug", "=", "System", ".", "getProperty", "(", "\"", "it", ".", "karaf", ".", "debug", "\"", ");", "if", "(", "karafDebug", "!", "=", "null", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "Found", "system", "Karaf", "Debug", "system", "property", ",", "activating", "configuration", ":", "\"", "+", "karafDebug", ")", ";", "String", "port", "=", "\"", "5006", "\"", ";", "boolean", "hold", "=", "true", ";", "if", "(", "karafDebug", ".", "trim", "(", ").", "length", "(", ")", ">", "0", ")", "{", "String", "[", "]", "debugOptions", "=", "karafDebug", ".", "split", "(", "\",", "\")", ";", "for", "(", "String", "debugOption", ":", "debugOptions", ")", "{", "String", "[", "]", "debugOptionParts", "=", "debugOption", ".", "split", "(", "\":", "\")", ";", "if", "(", "\"", "hold", "\"", ".", "equals", "(", "debugOptionParts", "[", "0", "]", "))", "{", "hold", "=", "Boolean", ".", "parseBoolean", "(", "debugOptionParts", "[", "1", "]", ".", "trim", "(", "))", ";", "}", "if", "(", "\"", "port", "\"", ".", "equals", "(", "debugOptionParts", "[", "0", "]", "))", "{", "port", "=", "debugOptionParts", "[", "1", "]", ".", "trim", "(", ");", "}", "}", "}", "options", ".", "add", "(", "0", ",", "debugConfiguration", "(", "port", ",", "hold", ")", ");", "}", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "itests", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "HttpPost", ";", "import", "org", ".", "apache", ".", "http", ".", "entity", ".", "ContentType", ";", "import", "org", ".", "apache", ".", "http", ".", "entity", ".", "StringEntity", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "ContextRequest", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "conditions", ".", "Condition", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "services", ".", "PersonalizationService", ";", "import", "org", ".", "apache", ".", "unomi", ".", "lifecycle", ".", "BundleWatcher", ";", "import", "org", ".", "apache", ".", "unomi", ".", "persistence", ".", "spi", ".", "CustomObjectMapper", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "junit", ".", "PaxExam", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "spi", ".", "reactors", ".", "ExamReactorStrategy", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "spi", ".", "reactors", ".", "PerSuite", ";", "import", "org", ".", "ops4j", ".", "pax", ".", "exam", ".", "util", ".", "Filter", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "@", "RunWith", "(", "PaxExam", ".", "class", ")", "@", "ExamReactorStrategy", "(", "PerSuite", ".", "class", ")", "public", "class", "SecurityIT", "extends", "BaseIT", "{", "private", "final", "static", "Logger", "LOGGER", "=", "LoggerFactory", ".", "getLogger", "(", "SecurityIT", ".", "class", ")", ";", "private", "static", "final", "String", "SESSION_ID", "=", "\"", "vuln", "-", "session", "-", "id", "\"", ";", "private", "ObjectMapper", "objectMapper", ";", "private", "TestUtils", "testUtils", "=", "new", "TestUtils", "(", ");", "@", "Inject", "@", "Filter", "(", "timeout", "=", "600000", ")", "protected", "BundleWatcher", "bundleWatcher", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "InterruptedException", "{", "while", "(", "!", "bundleWatcher", ".", "isStartupComplete", "(", "))", "{", "LOGGER", ".", "info", "(", "\"", "Waiting", "for", "startup", "to", "complete", ".", "..", "\")", ";", "Thread", ".", "sleep", "(", "1000", ")", ";", "}", "objectMapper", "=", "CustomObjectMapper", ".", "getObjectMapper", "(", ");", "}", "@", "Test", "public", "void", "testOGNLInjection", "(", ")", "throws", "IOException", ",", "InterruptedException", "{", "ContextRequest", "contextRequest", "=", "new", "ContextRequest", "(", ");", "List", "<", "PersonalizationService", ".", "PersonalizationRequest", ">", "personalizations", "=", "new", "ArrayList", "<", ">(", ");", "PersonalizationService", ".", "PersonalizationRequest", "personalizationRequest", "=", "new", "PersonalizationService", ".", "PersonalizationRequest", "(", ");", "personalizationRequest", ".", "setId", "(", "\"", "vuln", "-", "test", "\"", ");", "personalizationRequest", ".", "setStrategy", "(", "\"", "matching", "-", "first", "\"", ");", "Map", "<", "String", ",", "Object", ">", "strategyOptions", "=", "new", "HashMap", "<", ">(", ");", "strategyOptions", ".", "put", "(", "\"", "fallback", "\"", ",", "\"", "var2", "\"", ");", "personalizationRequest", ".", "setStrategyOptions", "(", "strategyOptions", ")", ";", "List", "<", "PersonalizationService", ".", "PersonalizedContent", ">", "personalizationContents", "=", "new", "ArrayList", "<", ">(", ");", "PersonalizationService", ".", "PersonalizedContent", "var1Content", "=", "new", "PersonalizationService", ".", "PersonalizedContent", "(", ");", "var1Content", ".", "setId", "(", "\"", "var1", "\"", ");", "List", "<", "PersonalizationService", ".", "Filter", ">", "filters", "=", "new", "ArrayList", "<", ">(", ");", "PersonalizationService", ".", "Filter", "filter", "=", "new", "PersonalizationService", ".", "Filter", "(", ");", "Condition", "condition", "=", "new", "Condition", "(", ");", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "condition", ".", "setConditionTypeId", "(", "\"", "profilePropertyCondition", "\"", ");", "condition", ".", "setParameter", "(", "\"", "propertyName", "\"", ",", "\"", "@", "java", ".", "lang", ".", "Runtime", "@", "getRuntime", "(", ").", "exec", "(", "'", "touch", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "')", "\")", ";", "condition", ".", "setParameter", "(", "\"", "comparisonOperator", "\"", ",", "\"", "equals", "\"", ");", "condition", ".", "setParameter", "(", "\"", "propertyValue", "\"", ",", "\"", "script", ":", ":", "java", ".", "io", ".", "PrintWriter", "writer", "=", "new", "java", ".", "io", ".", "PrintWriter", "(", "new", "java", ".", "io", ".", "BufferedWriter", "(", "new", "java", ".", "io", ".", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\")", ";", "filter", ".", "setCondition", "(", "condition", ")", ";", "filters", ".", "add", "(", "filter", ")", ";", "var1Content", ".", "setFilters", "(", "filters", ")", ";", "personalizationContents", ".", "add", "(", "var1Content", ")", ";", "PersonalizationService", ".", "PersonalizedContent", "var2Content", "=", "new", "PersonalizationService", ".", "PersonalizedContent", "(", ");", "var2Content", ".", "setId", "(", "\"", "var2", "\"", ");", "personalizationContents", ".", "add", "(", "var2Content", ")", ";", "personalizationRequest", ".", "setContents", "(", "personalizationContents", ")", ";", "personalizations", ".", "add", "(", "personalizationRequest", ")", ";", "contextRequest", ".", "setPersonalizations", "(", "personalizations", ")", ";", "contextRequest", ".", "setSessionId", "(", "SESSION_ID", ")", ";", "HttpPost", "request", "=", "new", "HttpPost", "(", "URL", "+", "\"", "/", "context", ".", "json", "\"", ");", "request", ".", "setEntity", "(", "new", "StringEntity", "(", "objectMapper", ".", "writeValueAsString", "(", "contextRequest", ")", ",", "ContentType", ".", "create", "(", "\"", "application", "/", "json", "\"", "))", ");", "TestUtils", ".", "RequestResponse", "response", "=", "executeContextJSONRequest", "(", "request", ",", "SESSION_ID", ")", ";", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "}", "private", "TestUtils", ".", "RequestResponse", "executeContextJSONRequest", "(", "HttpPost", "request", ",", "String", "sessionId", ")", "throws", "IOException", "{", "return", "testUtils", ".", "executeContextJSONRequest", "(", "request", ",", "sessionId", ")", ";", "}", "}", "@", "@", "-", "193", ",", "6", "+", "193", ",", "24", "@", "@", "You", "should", "now", "have", "SSL", "setup", "on", "Karaf", "with", "your", "certificate", ",", "and", "you", "can", "test", "i", "=", "==", "=", "Scripting", "security", "By", "default", ",", "scripting", "(", "using", "in", "conditions", ",", "segments", "and", "rules", ")", "is", "controlled", "by", "a", "custom", "classloader", "that", "is", "quite", "restrictive", "and", "using", "a", "white", "-", "list", "/", "black", "list", "system", ".", "It", "is", "controlled", "through", "the", "following", "property", "in", "the", "`", "unomi", ".", "custom", ".", "system", ".", "properties", "`", "file", ":", "[", "source", "]", "-", "--", "-", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "allow", "=", "${", "env", ":", "UNOMI_ALLOW_SCRIPTING_CLASSES", ":", "-", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "forbid", "=", "${", "env", ":", "UNOMI_FORBID_SCRIPTING_CLASSES", ":", "-}", "-", "--", "-", "If", "you", "encounter", "any", "errors", "while", "trying", "to", "access", "a", "class", "in", "a", "condition", "or", "an", "action", "it", "might", "be", "due", "to", "this", "restrictive", "configuration", ".", "If", "you", "need", ",", "for", "example", "when", "adding", "a", "custom", "item", "type", ",", "to", "adjust", "these", ",", "please", "be", "careful", "as", "scripts", "may", "be", "called", "directly", "from", "the", "context", ".", "json", "personalization", "conditions", "and", "therefore", "should", "be", "kept", "minimal", ".", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "allow", "=", "${", "env", ":", "UNOMI_ALLOW_SCRIPTING_CLASSES", ":", "-", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Profile", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Session", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Item", ",", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ",", "ognl", ".", "*,", "java", ".", "lang", ".", "Object", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "lang", ".", "Integer", ",", "org", ".", "mvel2", ".", "*}", "org", ".", "apache", ".", "unomi", ".", "scripting", ".", "forbid", "=", "${", "env", ":", "UNOMI_FORBID_SCRIPTING_CLASSES", ":", "-}", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "import", "java", ".", "util", ".", "*;", "return", "executeScript", "(", "context", ",", "script", ")", ";", "private", "static", "Object", "executeScript", "(", "Map", "<", "String", ",", "Object", ">", "context", ",", "String", "script", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "script", ")", ")", "{", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "ConditionContextHelper", ".", "class", ".", "getClassLoader", "(", "))", ";", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "mvelExpressions", ".", "put", "(", "script", ",", "MVEL", ".", "compileExpression", "(", "script", ",", "new", "ParserContext", "(", "parserConfiguration", ")", "))", ";", "}", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "script", ")", ",", "context", ")", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "}", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "PropertyConditionEvaluator", ".", "class", ".", "getClassLoader", "(", "))", ";", "OgnlContext", "ognlContext", "=", "getOgnlContext", "(", "secureFilteringClassLoader", ")", ";", "ExpressionAccessor", "accessor", "=", "getPropertyAccessor", "(", "item", ",", "expression", ",", "ognlContext", ",", "secureFilteringClassLoader", ")", ";", "return", "accessor", "!", "=", "null", "?", "accessor", ".", "get", "(", "ognlContext", ",", "item", ")", ":", "null", ";", "String", "nextExpression", "=", "expressionPart", ".", "substring", "(", "nextDotPos", "+", "1", ")", ";", "return", "getNestedPropertyValue", "(", "nextExpression", ",", "(", "Map", "<", "String", ",", "Object", ">", ")", "mapValue", ")", ";", "private", "class", "ClassLoaderClassResolver", "extends", "DefaultClassResolver", "{", "private", "ClassLoader", "classLoader", ";", "public", "ClassLoaderClassResolver", "(", "ClassLoader", "classLoader", ")", "{", "this", ".", "classLoader", "=", "classLoader", ";", "}", "@", "Override", "protected", "Class", "toClassForName", "(", "String", "className", ")", "throws", "ClassNotFoundException", "{", "return", "Class", ".", "forName", "(", "className", ",", "true", ",", "classLoader", ")", ";", "}", "}", "private", "OgnlContext", "getOgnlContext", "(", "ClassLoader", "classLoader", ")", "{", "return", "(", "OgnlContext", ")", "Ognl", ".", "createDefaultContext", "(", "null", ",", "new", "MemberAccess", "(", ")", "{", "@", "Override", "public", "Object", "setup", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "void", "restore", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ",", "Object", "state", ")", "{", "}", "@", "Override", "public", "boolean", "isAccessible", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ")", "{", "int", "modifiers", "=", "member", ".", "getModifiers", "(", ");", "boolean", "result", "=", "Modifier", ".", "isPublic", "(", "modifiers", ")", ";", "return", "result", ";", "}", "}", ",", "new", "ClassLoaderClassResolver", "(", "classLoader", ")", ",", "null", ")", ";", "private", "ExpressionAccessor", "getPropertyAccessor", "(", "Item", "item", ",", "String", "expression", ",", "OgnlContext", "ognlContext", ",", "ClassLoader", "classLoader", ")", "throws", "Exception", "{", "current", ".", "setContextClassLoader", "(", "classLoader", ")", ";", "Node", "node", "=", "Ognl", ".", "compileExpression", "(", "ognlContext", ",", "item", ",", "expression", ")", ";", "import", "ognl", ".", "MethodFailedException", ";", "import", "java", ".", "io", ".", "File", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "assertEquals", "(", "\"", "Target", "page", "url", "value", "is", "not", "correct", "\"", ",", "PAGE_URL_VALUE", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockEvent", ",", "\"", "target", ".", "properties", ".", "pageInfo", ".", "pageURL", "\"", "))", ";", "assertEquals", "(", "\"", "Should", "have", "received", "the", "non", "-", "optimized", "marker", "string", "\"", ",", "NOT_OPTIMIZED_MARKER", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockSession", ",", "\"", "lastEventDate", "\"", "))", ";", "assertEquals", "(", "\"", "Target", "scope", "is", "not", "correct", "\"", ",", "DIGITALL_SCOPE", ",", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockEvent", ",", "\"", "target", ".", "scope", "\"", "))", ";", "assertEquals", "(", "\"", "Should", "have", "received", "the", "proper", "last", "even", "date", "\"", ",", "SESSION_LAST_EVENT_DATE", ",", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockSession", ",", "\"", "lastEventDate", "\"", "))", ";", "assertEquals", "(", "\"", "Target", "scope", "is", "not", "correct", "\"", ",", "DIGITALL_SCOPE", ",", "propertyConditionEvaluator", ".", "getPropertyValue", "(", "mockEvent", ",", "\"", "target", ".", "scope", "\"", "))", ";", "@", "Test", "public", "void", "testOGNLSecurity", "(", ")", "throws", "Exception", "{", "Event", "mockEvent", "=", "generateMockEvent", "(", ");", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "try", "{", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockEvent", ",", "\"", "@", "java", ".", "lang", ".", "Runtime", "@", "getRuntime", "(", ").", "exec", "(", "'", "touch", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "')", "\")", ";", "}", "catch", "(", "RuntimeException", "|", "MethodFailedException", "re", ")", "{", "/", "/", "we", "ignore", "these", "exceptions", "as", "they", "are", "expected", ".", "}", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "try", "{", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockEvent", ",", "\"", "(#", "cmd", "=", "'", "touch", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "')", ".(", "#", "cmds", "=", "{'", "bash", "'", ",'", "-", "c", "'", ",#", "cmd", "}", ").", "(#", "p", "=", "new", "java", ".", "lang", ".", "ProcessBuilder", "(", "#", "cmds", ")", ").", "(#", "p", ".", "redirectErrorStream", "(", "true", ")", ").", "(#", "process", "=", "#", "p", ".", "start", "(", "))", "\")", ";", "}", "catch", "(", "RuntimeException", "|", "MethodFailedException", "re", ")", "{", "/", "/", "we", "ignore", "these", "exceptions", "as", "they", "are", "expected", ".", "}", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "try", "{", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockEvent", ",", "\"", "(#", "cmd", "=", "'", "touch", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "')", ".(", "#", "iswin", "=", "(@", "java", ".", "lang", ".", "System", "@", "getProperty", "(", "'", "os", ".", "name", "'", ").", "toLowerCase", "(", ").", "contains", "(", "'", "win", "'", "))", ").", "(#", "cmds", "=", "(#", "iswin", "?", "{'", "cmd", ".", "exe", "'", ",'", "/", "c", "'", ",#", "cmd", "}", ":{", "'", "bash", "'", ",'", "-", "c", "'", ",#", "cmd", "}", "))", ".(", "#", "p", "=", "new", "java", ".", "lang", ".", "ProcessBuilder", "(", "#", "cmds", ")", ").", "(#", "p", ".", "redirectErrorStream", "(", "true", ")", ").", "(#", "process", "=", "#", "p", ".", "start", "(", "))", "\")", ";", "}", "catch", "(", "RuntimeException", "|", "MethodFailedException", "re", ")", "{", "/", "/", "we", "ignore", "these", "exceptions", "as", "they", "are", "expected", ".", "}", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "}", "Map", "<", "String", ",", "Object", ">", "pageInfoMap", "=", "new", "HashMap", "<", ">(", ");", "<", "version", ">", "3", ".", "2", ".", "14", "<", "/", "version", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "unomi", "<", "/", "groupId", ">", "<", "artifactId", ">", "unomi", "-", "common", "<", "/", "artifactId", ">", "<", "version", ">", "${", "project", ".", "version", "}", "</", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "return", "executeScript", "(", "valueAsString", ",", "event", ")", ";", "protected", "Object", "executeScript", "(", "String", "valueAsString", ",", "Event", "event", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "valueAsString", ")", ")", "{", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "mvelExpressions", ".", "put", "(", "valueAsString", ",", "MVEL", ".", "compileExpression", "(", "valueAsString", ",", "new", "ParserContext", "(", "parserConfiguration", ")", "))", ";", "}", "Map", "<", "String", ",", "Object", ">", "ctx", "=", "new", "HashMap", "<", ">(", ");", "ctx", ".", "put", "(", "\"", "event", "\"", ",", "event", ")", ";", "ctx", ".", "put", "(", "\"", "session", "\"", ",", "event", ".", "getSession", "(", "))", ";", "ctx", ".", "put", "(", "\"", "profile", "\"", ",", "event", ".", "getProfile", "(", "))", ";", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "valueAsString", ")", ",", "ctx", ")", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "}", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "unomi", ".", "services", ".", "actions", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "CustomItem", ";", "import", "org", ".", "apache", ".", "unomi", ".", "api", ".", "Event", ";", "import", "org", ".", "apache", ".", "unomi", ".", "common", ".", "SecureFilteringClassLoader", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mvel2", ".", "CompileException", ";", "import", "org", ".", "mvel2", ".", "MVEL", ";", "import", "org", ".", "mvel2", ".", "ParserConfiguration", ";", "import", "org", ".", "mvel2", ".", "ParserContext", ";", "import", "java", ".", "io", ".", "*;", "import", "java", ".", "util", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "public", "class", "ActionExecutorDispatcherTest", "{", "public", "static", "final", "String", "MOCK_ITEM_ID", "=", "\"", "mockItemId", "\"", ";", "public", "static", "final", "String", "DIGITALL_SCOPE", "=", "\"", "digitall", "\"", ";", "public", "static", "final", "String", "PAGE_PATH_VALUE", "=", "\"", "/", "site", "/", "en", "/", "home", "/", "aboutus", ".", "html", "\"", ";", "public", "static", "final", "String", "PAGE_URL_VALUE", "=", "\"", "http", ":", "//", "localhost", ":", "8080", "/", "site", "/", "en", "/", "home", "/", "aboutus", ".", "html", "\"", ";", "@", "Test", "public", "void", "testMVELSecurity", "(", ")", "throws", "IOException", "{", "Map", "<", "String", ",", "Object", ">", "ctx", "=", "new", "HashMap", "<", ">(", ");", "Event", "mockEvent", "=", "generateMockEvent", "(", ");", "ctx", ".", "put", "(", "\"", "event", "\"", ",", "mockEvent", ")", ";", "ctx", ".", "put", "(", "\"", "session", "\"", ",", "mockEvent", ".", "getSession", "(", "))", ";", "ctx", ".", "put", "(", "\"", "profile", "\"", ",", "mockEvent", ".", "getProfile", "(", "))", ";", "File", "vulnFile", "=", "new", "File", "(", "\"", "target", "/", "vuln", "-", "file", ".", "txt", "\"", ");", "if", "(", "vulnFile", ".", "exists", "(", "))", "{", "vulnFile", ".", "delete", "(", ");", "}", "Object", "result", "=", "null", ";", "try", "{", "result", "=", "executeMVEL", "(", "\"", "java", ".", "io", ".", "PrintWriter", "writer", "=", "new", "java", ".", "io", ".", "PrintWriter", "(", "new", "java", ".", "io", ".", "BufferedWriter", "(", "new", "java", ".", "io", ".", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "executeMVEL", "(", "\"", "import", "java", ".", "util", ".", "*;", "\\", "nimport", "java", ".", "io", ".", "*;", "\\", "nPrintWriter", "writer", "=", "new", "PrintWriter", "(", "new", "BufferedWriter", "(", "new", "FileWriter", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", ",", "true", ")", "))", ";\\", "nwriter", ".", "println", "(", "\\\"", "test", "\\", "\")", ";\\", "nwriter", ".", "close", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "try", "{", "result", "=", "executeMVEL", "(", "\"", "import", "java", ".", "util", ".", "*;", "\\", "nimport", "java", ".", "io", ".", "*;", "\\", "nnew", "Scanner", "(", "new", "File", "(", "\\\"", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", ")", "+", "\"", "\\\"", "))", ".", "useDelimiter", "(", "\\\"", "\\\\", "\\\\", "Z", "\\", "\")", ".", "next", "(", ");", "\",", "ctx", ")", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "since", "access", "to", "these", "classes", "should", "not", "be", "allowed", "}", "System", ".", "out", ".", "println", "(", "\"", "result", "=", "\"", "+", "result", ")", ";", "assertFalse", "(", "\"", "Vulnerability", "successfully", "executed", "!", "File", "created", "at", "\"", "+", "vulnFile", ".", "getCanonicalPath", "(", "),", "vulnFile", ".", "exists", "(", "))", ";", "}", "private", "Object", "executeMVEL", "(", "String", "expression", ",", "Object", "ctx", ")", "{", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "ClassLoader", "secureFilteringClassLoader", "=", "new", "SecureFilteringClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "secureFilteringClassLoader", ")", ";", "parserConfiguration", ".", "setClassLoader", "(", "secureFilteringClassLoader", ")", ";", "ParserContext", "parserContext", "=", "new", "ParserContext", "(", "parserConfiguration", ")", ";", "Serializable", "compiledExpression", "=", "MVEL", ".", "compileExpression", "(", "expression", ",", "parserContext", ")", ";", "try", "{", "return", "MVEL", ".", "executeExpression", "(", "compiledExpression", ",", "ctx", ",", "new", "HashMap", "(", "))", ";", "}", "catch", "(", "CompileException", "ce", ")", "{", "/", "/", "this", "is", "expected", "}", "return", "null", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}", "}", "private", "static", "Event", "generateMockEvent", "(", ")", "{", "Event", "mockEvent", "=", "new", "Event", "(", ");", "CustomItem", "targetItem", "=", "new", "CustomItem", "(", ");", "targetItem", ".", "setItemId", "(", "MOCK_ITEM_ID", ")", ";", "targetItem", ".", "setScope", "(", "DIGITALL_SCOPE", ")", ";", "mockEvent", ".", "setTarget", "(", "targetItem", ")", ";", "Map", "<", "String", ",", "Object", ">", "pageInfoMap", "=", "new", "HashMap", "<", ">(", ");", "pageInfoMap", ".", "put", "(", "\"", "pagePath", "\"", ",", "PAGE_PATH_VALUE", ")", ";", "pageInfoMap", ".", "put", "(", "\"", "pageURL", "\"", ",", "PAGE_URL_VALUE", ")", ";", "targetItem", ".", "getProperties", "(", ").", "put", "(", "\"", "pageInfo", "\"", ",", "pageInfoMap", ")", ";", "return", "mockEvent", ";", "}", "}</s>UpdateEventFromContextServletIT", ".", "class", "debugConfiguration", "(", "\"", "5006", "\"", ",", "false", ")", ",", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "script", ")", ")", "{", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "ConditionContextHelper", ".", "class", ".", "getClassLoader", "(", "))", ";", "mvelExpressions", ".", "put", "(", "script", ",", "MVEL", ".", "compileExpression", "(", "script", ",", "new", "ParserContext", "(", "parserConfiguration", ")", "))", ";", "}", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "script", ")", ",", "context", ")", ";", "ExpressionAccessor", "accessor", "=", "getPropertyAccessor", "(", "item", ",", "expression", ")", ";", "return", "accessor", "!", "=", "null", "?", "accessor", ".", "get", "(", "getOgnlContext", "(", "),", "item", ")", ":", "null", ";", "String", "nextExpression", "=", "expressionPart", ".", "substring", "(", "nextDotPos", "+", "1", ")", ";", "return", "getNestedPropertyValue", "(", "nextExpression", ",", "(", "Map", "<", "String", ",", "Object", ">", ")", "mapValue", ")", ";", "private", "OgnlContext", "getOgnlContext", "(", ")", "{", "return", "(", "OgnlContext", ")", "Ognl", ".", "createDefaultContext", "(", "null", ",", "new", "MemberAccess", "(", ")", "{", "@", "Override", "public", "Object", "setup", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "void", "restore", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ",", "Object", "state", ")", "{", "}", "@", "Override", "public", "boolean", "isAccessible", "(", "Map", "context", ",", "Object", "target", ",", "Member", "member", ",", "String", "propertyName", ")", "{", "int", "modifiers", "=", "member", ".", "getModifiers", "(", ");", "boolean", "result", "=", "Modifier", ".", "isPublic", "(", "modifiers", ")", ";", "return", "result", ";", "}", "}", ");", "private", "ExpressionAccessor", "getPropertyAccessor", "(", "Item", "item", ",", "String", "expression", ")", "throws", "Exception", "{", "current", ".", "setContextClassLoader", "(", "PropertyConditionEvaluator", ".", "class", ".", "getClassLoader", "(", "))", ";", "Node", "node", "=", "Ognl", ".", "compileExpression", "(", "getOgnlContext", "(", ")", ",", "item", ",", "expression", ")", ";", "assertEquals", "(", "\"", "Target", "page", "url", "value", "is", "not", "correct", "\"", ",", "PAGE_URL_VALUE", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockEvent", ",", "\"", "target", ".", "properties", ".", "pageInfo", ".", "pageURL", "\"", "))", ";", "assertEquals", "(", "\"", "Should", "have", "received", "the", "non", "-", "optimized", "marker", "string", "\"", ",", "NOT_OPTIMIZED_MARKER", ",", "propertyConditionEvaluator", ".", "getHardcodedPropertyValue", "(", "mockSession", ",", "\"", "lastEventDate", "\"", ")", ")", ";", "assertEquals", "(", "\"", "Target", "scope", "is", "not", "correct", "\"", ",", "DIGITALL_SCOPE", ",", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockEvent", ",", "\"", "target", ".", "scope", "\"", "))", ";", "assertEquals", "(", "\"", "Should", "have", "received", "the", "proper", "last", "even", "date", "\"", ",", "SESSION_LAST_EVENT_DATE", ",", "propertyConditionEvaluator", ".", "getOGNLPropertyValue", "(", "mockSession", ",", "\"", "lastEventDate", "\"", ")", ")", ";", "assertEquals", "(", "\"", "Target", "scope", "is", "not", "correct", "\"", ",", "DIGITALL_SCOPE", ",", "propertyConditionEvaluator", ".", "getPropertyValue", "(", "mockEvent", ",", "\"", "target", ".", "scope", "\"", "))", ";", "Map", "<", "String", ",", "Object", ">", "pageInfoMap", "=", "new", "HashMap", "<", ">(", ");", "<", "version", ">", "3", ".", "2", ".", "11", "<", "/", "version", ">", "final", "ClassLoader", "tccl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "if", "(", "!", "mvelExpressions", ".", "containsKey", "(", "valueAsString", ")", ")", "{", "ParserConfiguration", "parserConfiguration", "=", "new", "ParserConfiguration", "(", ");", "parserConfiguration", ".", "setClassLoader", "(", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "mvelExpressions", ".", "put", "(", "valueAsString", ",", "MVEL", ".", "compileExpression", "(", "valueAsString", ",", "new", "ParserContext", "(", "parserConfiguration", ")", "))", ";", "}", "Map", "<", "String", ",", "Object", ">", "ctx", "=", "new", "HashMap", "<", ">(", ");", "ctx", ".", "put", "(", "\"", "event", "\"", ",", "event", ")", ";", "ctx", ".", "put", "(", "\"", "session", "\"", ",", "event", ".", "getSession", "(", "))", ";", "ctx", ".", "put", "(", "\"", "profile", "\"", ",", "event", ".", "getProfile", "(", "))", ";", "return", "MVEL", ".", "executeExpression", "(", "mvelExpressions", ".", "get", "(", "valueAsString", ")", ",", "ctx", ")", ";", "}", "finally", "{", "Thread", ".", "currentThread", "(", ").", "setContextClassLoader", "(", "tccl", ")", ";", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["TIKA-3084", "--", "upgrade", "mp4", "parser", "dependency"], "code_tokens": ["<", "groupId", ">", "org", ".", "tallison", "<", "/", "groupId", ">", "<", "version", ">", "1", ".", "9", ".", "41", ".", "2", "<", "/", "version", ">", "import", "org", ".", "apache", ".", "tika", ".", "config", ".", "Field", ";", "import", "org", ".", "mp4parser", ".", "Box", ";", "import", "org", ".", "mp4parser", ".", "Container", ";", "import", "org", ".", "mp4parser", ".", "IsoFile", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleAlbumBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtist2Box", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtistBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCommentBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCompilationBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleDiskNumberBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleEncoderBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGPSCoordinatesBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGenreBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleItemListBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleNameBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleRecordingYear2Box", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackAuthorBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackNumberBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "Utf8AppleDataBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "FileTypeBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "MetaBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "MovieBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "MovieHeaderBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "SampleDescriptionBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "SampleTableBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "TrackBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "TrackHeaderBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "UserDataBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "sampleentry", ".", "AudioSampleEntry", ";", "try", "(", "IsoFile", "isoFile", "=", "new", "IsoFile", "(", "tstream", ".", "getFile", "(", "))", ")", "{", "tmp", ".", "addResource", "(", "isoFile", ")", ";", "/", "/", "Grab", "the", "file", "type", "box", "FileTypeBox", "fileType", "=", "getOrNull", "(", "isoFile", ",", "FileTypeBox", ".", "class", ")", ";", "if", "(", "fileType", "!", "=", "null", ")", "{", "/", "/", "Identify", "the", "type", "MediaType", "type", "=", "MediaType", ".", "application", "(", "\"", "mp4", "\"", ");", "for", "(", "Map", ".", "Entry", "<", "MediaType", ",", "List", "<", "String", ">", ">", "e", ":", "typesMap", ".", "entrySet", "(", "))", "{", "if", "(", "e", ".", "getValue", "(", ").", "contains", "(", "fileType", ".", "getMajorBrand", "(", "))", ")", "{", "type", "=", "e", ".", "getKey", "(", ");", "break", ";", "}", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "type", ".", "toString", "(", "))", ";", "if", "(", "type", ".", "getType", "(", ").", "equals", "(", "\"", "audio", "\"", "))", "{", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_COMPRESSOR", ",", "fileType", ".", "getMajorBrand", "(", ").", "trim", "(", "))", ";", "}", "else", "{", "/", "/", "Some", "older", "QuickTime", "files", "lack", "the", "FileType", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "\"", "video", "/", "quicktime", "\"", ");", "}", "/", "/", "Get", "the", "main", "MOOV", "box", "MovieBox", "moov", "=", "getOrNull", "(", "isoFile", ",", "MovieBox", ".", "class", ")", ";", "if", "(", "moov", "=", "=", "null", ")", "{", "/", "/", "Bail", "out", "return", ";", "}", "XHTMLContentHandler", "xhtml", "=", "new", "XHTMLContentHandler", "(", "handler", ",", "metadata", ")", ";", "xhtml", ".", "startDocument", "(", ");", "handleMovieHeaderBox", "(", "moov", ",", "metadata", ",", "xhtml", ")", ";", "handleTrackBoxes", "(", "moov", ",", "metadata", ",", "xhtml", ")", ";", "/", "/", "Get", "metadata", "from", "the", "User", "Data", "Box", "UserDataBox", "userData", "=", "getOrNull", "(", "moov", ",", "UserDataBox", ".", "class", ")", ";", "if", "(", "userData", "!", "=", "null", ")", "{", "extractGPS", "(", "userData", ",", "metadata", ")", ";", "MetaBox", "metaBox", "=", "getOrNull", "(", "userData", ",", "MetaBox", ".", "class", ")", ";", "/", "/", "Check", "for", "iTunes", "Metadata", "/", "/", "See", "http", ":", "//", "atomicparsley", ".", "sourceforge", ".", "net", "/", "mpeg", "-", "4files", ".", "html", "and", "/", "/", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "mp4v2", "/", "wiki", "/", "iTunesMetadata", "for", "more", "on", "these", "handleApple", "(", "metaBox", ",", "metadata", ",", "xhtml", ")", ";", "/", "/", "TODO", "Check", "for", "other", "kinds", "too", "}", "/", "/", "All", "done", "xhtml", ".", "endDocument", "(", ");", "}", "finally", "{", "tmp", ".", "dispose", "(", ");", "}", "}", "private", "void", "handleTrackBoxes", "(", "MovieBox", "moov", ",", "Metadata", "metadata", ",", "XHTMLContentHandler", "xhtml", ")", "{", "/", "/", "Get", "some", "more", "information", "from", "the", "track", "header", "/", "/", "TODO", "Decide", "how", "to", "handle", "multiple", "tracks", "List", "<", "TrackBox", ">", "tb", "=", "moov", ".", "getBoxes", "(", "TrackBox", ".", "class", ")", ";", "if", "(", "tb", "=", "=", "null", "|", "|", "tb", ".", "size", "(", ")", "=", "=", "0", ")", "{", "return", ";", "}", "TrackBox", "track", "=", "tb", ".", "get", "(", "0", ")", ";", "TrackHeaderBox", "header", "=", "track", ".", "getTrackHeaderBox", "(", ");", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "CREATED", ",", "header", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "header", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "video", "with", "and", "height", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_WIDTH", ",", "(", "int", ")", "header", ".", "getWidth", "(", "))", ";", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_LENGTH", ",", "(", "int", ")", "header", ".", "getHeight", "(", "))", ";", "/", "/", "Get", "the", "sample", "information", "SampleTableBox", "samples", "=", "track", ".", "getSampleTableBox", "(", ");", "if", "(", "samples", "!", "=", "null", ")", "{", "SampleDescriptionBox", "sampleDesc", "=", "samples", ".", "getSampleDescriptionBox", "(", ");", "if", "(", "sampleDesc", "!", "=", "null", ")", "{", "/", "/", "Look", "for", "the", "first", "Audio", "Sample", ",", "if", "present", "AudioSampleEntry", "sample", "=", "getOrNull", "(", "sampleDesc", ",", "AudioSampleEntry", ".", "class", ")", ";", "if", "(", "sample", "!", "=", "null", ")", "{", "XMPDM", ".", "ChannelTypePropertyConverter", ".", "convertAndSet", "(", "metadata", ",", "sample", ".", "getChannelCount", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_TYPE", ",", "sample", ".", "getSampleSize", "(", "))", ";", "/", "/", "TODO", "Num", "-", ">", "Type", "mapping", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "sample", ".", "getSampleRate", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getSamplesPerPacket", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getBytesPerSample", "(", "))", ";", "}", "}", "}", "private", "void", "handleMovieHeaderBox", "(", "MovieBox", "moov", ",", "Metadata", "metadata", ",", "XHTMLContentHandler", "xhtml", ")", "{", "/", "/", "Pull", "out", "some", "information", "from", "the", "header", "box", "MovieHeaderBox", "mHeader", "=", "getOrNull", "(", "moov", ",", "MovieHeaderBox", ".", "class", ")", ";", "if", "(", "mHeader", "=", "=", "null", ")", "{", "return", ";", "}", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "CREATED", ",", "mHeader", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "mHeader", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "duration", "double", "durationSeconds", "=", "(", "(", "double", ")", "mHeader", ".", "getDuration", "(", "))", "/", "mHeader", ".", "getTimescale", "(", ");", "metadata", ".", "set", "(", "XMPDM", ".", "DURATION", ",", "DURATION_FORMAT", ".", "format", "(", "durationSeconds", ")", ");", "/", "/", "The", "timescale", "is", "normally", "the", "sampling", "rate", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "mHeader", ".", "getTimescale", "(", "))", ";", "}", "private", "void", "handleApple", "(", "MetaBox", "metaBox", ",", "Metadata", "metadata", ",", "XHTMLContentHandler", "xhtml", ")", "throws", "SAXException", "{", "AppleItemListBox", "apple", "=", "getOrNull", "(", "metaBox", ",", "AppleItemListBox", ".", "class", ")", ";", "if", "(", "apple", "=", "=", "null", ")", "{", "return", ";", "}", "/", "/", "Title", "AppleNameBox", "title", "=", "getOrNull", "(", "apple", ",", "AppleNameBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "TITLE", ",", "metadata", ",", "title", ")", ";", "/", "/", "Artist", "AppleArtistBox", "artist", "=", "getOrNull", "(", "apple", ",", "AppleArtistBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "CREATOR", ",", "metadata", ",", "artist", ")", ";", "addMetadata", "(", "XMPDM", ".", "ARTIST", ",", "metadata", ",", "artist", ")", ";", "/", "/", "Album", "Artist", "AppleArtist2Box", "artist2", "=", "getOrNull", "(", "apple", ",", "AppleArtist2Box", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM_ARTIST", ",", "metadata", ",", "artist2", ")", ";", "/", "/", "Album", "AppleAlbumBox", "album", "=", "getOrNull", "(", "apple", ",", "AppleAlbumBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM", ",", "metadata", ",", "album", ")", ";", "/", "/", "Composer", "AppleTrackAuthorBox", "composer", "=", "getOrNull", "(", "apple", ",", "AppleTrackAuthorBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "COMPOSER", ",", "metadata", ",", "composer", ")", ";", "/", "/", "Genre", "AppleGenreBox", "genre", "=", "getOrNull", "(", "apple", ",", "AppleGenreBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "GENRE", ",", "metadata", ",", "genre", ")", ";", "/", "/", "Year", "AppleRecordingYear2Box", "year", "=", "getOrNull", "(", "apple", ",", "AppleRecordingYear2Box", ".", "class", ")", ";", "if", "(", "year", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "RELEASE_DATE", ",", "year", ".", "getValue", "(", "))", ";", "}", "/", "/", "Track", "number", "AppleTrackNumberBox", "trackNum", "=", "getOrNull", "(", "apple", ",", "AppleTrackNumberBox", ".", "class", ")", ";", "if", "(", "trackNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "TRACK_NUMBER", ",", "trackNum", ".", "getA", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "NUMBER_OF_TRACKS", ",", "trackNum", ".", "getB", "(", "))", ";", "/", "/", "TODO", "}", "/", "/", "Disc", "number", "AppleDiskNumberBox", "discNum", "=", "getOrNull", "(", "apple", ",", "AppleDiskNumberBox", ".", "class", ")", ";", "if", "(", "discNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "DISC_NUMBER", ",", "discNum", ".", "getA", "(", "))", ";", "}", "/", "/", "Compilation", "AppleCompilationBox", "compilation", "=", "getOrNull", "(", "apple", ",", "AppleCompilationBox", ".", "class", ")", ";", "if", "(", "compilation", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "COMPILATION", ",", "(", "int", ")", "compilation", ".", "getValue", "(", "))", ";", "}", "/", "/", "Comment", "AppleCommentBox", "comment", "=", "getOrNull", "(", "apple", ",", "AppleCommentBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "LOG_COMMENT", ",", "metadata", ",", "comment", ")", ";", "/", "/", "Encoder", "AppleEncoderBox", "encoder", "=", "getOrNull", "(", "apple", ",", "AppleEncoderBox", ".", "class", ")", ";", "if", "(", "encoder", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMP", ".", "CREATOR_TOOL", ",", "encoder", ".", "getValue", "(", "))", ";", "}", "/", "/", "As", "text", "for", "(", "Box", "box", ":", "apple", ".", "getBoxes", "(", "))", "{", "if", "(", "box", "instanceof", "Utf8AppleDataBox", ")", "{", "xhtml", ".", "element", "(", "\"", "p", "\"", ",", "(", "(", "Utf8AppleDataBox", ")", "box", ")", ".", "getValue", "(", "))", ";", "/", "**", "*", "Override", "the", "maximum", "record", "size", "limit", ".", "NOTE", ":", "this", "*", "sets", "a", "static", "variable", "on", "the", "IsoFile", "and", "affects", "all", "files", "*", "parsed", "in", "this", "JVM", "!", "!!", "*", "*", "@", "param", "maxRecordSize", "*", "/", "@", "Field", "public", "void", "setMaxRecordSize", "(", "long", "maxRecordSize", ")", "{", "IsoFile", ".", "MAX_RECORD_SIZE_OVERRIDE", "=", "maxRecordSize", ";", "}", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";</s><", "groupId", ">", "com", ".", "googlecode", ".", "mp4parser", "<", "/", "groupId", ">", "<", "version", ">", "1", ".", "1", ".", "22", "<", "/", "version", ">", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "tika", ".", "parser", ".", "mp4", ";", "import", "static", "com", ".", "googlecode", ".", "mp4parser", ".", "util", ".", "CastUtils", ".", "l2i", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "RandomAccessFile", ";", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "nio", ".", "channels", ".", "WritableByteChannel", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "DataSource", ";", "/", "**", "*", "A", "{", "@", "link", "DataSource", "}", "implementation", "that", "relies", "on", "direct", "reads", "from", "a", "{", "@", "link", "RandomAccessFile", "}", ".", "*", "It", "should", "be", "slower", "than", "{", "@", "link", "com", ".", "googlecode", ".", "mp4parser", ".", "FileDataSourceImpl", "}", "but", "does", "not", "incur", "the", "implicit", "file", "locks", "of", "*", "memory", "mapped", "I", "/", "O", "on", "some", "JVMs", ".", "This", "implementation", "allows", "for", "a", "more", "controlled", "deletion", "of", "files", "*", "and", "might", "be", "preferred", "when", "working", "with", "temporary", "files", ".", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "bugs", ".", "java", ".", "com", "/", "view_bug", ".", "do", "?", "bug_id", "=", "4724038", "\"", ">", "JDK", "-", "4724038", ":", "(", "fs", ")", "Add", "unmap", "method", "to", "MappedByteBuffer", "<", "/", "a", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "bugs", ".", "java", ".", "com", "/", "view_bug", ".", "do", "?", "bug_id", "=", "6359560", "\"", ">", "JDK", "-", "6359560", ":", "(", "fs", ")", "File", ".", "deleteOnExit", "(", ")", "doesn", "'", "t", "work", "when", "MappedByteBuffer", "exists", "(", "win", ")", "</", "a", ">", "*", "/", "public", "class", "DirectFileReadDataSource", "implements", "DataSource", "{", "private", "static", "final", "int", "TRANSFER_SIZE", "=", "8192", ";", "private", "RandomAccessFile", "raf", ";", "public", "DirectFileReadDataSource", "(", "File", "f", ")", "throws", "IOException", "{", "this", ".", "raf", "=", "new", "RandomAccessFile", "(", "f", ",", "\"", "r", "\"", ");", "}", "public", "int", "read", "(", "ByteBuffer", "byteBuffer", ")", "throws", "IOException", "{", "int", "len", "=", "byteBuffer", ".", "remaining", "(", ");", "int", "totalRead", "=", "0", ";", "int", "bytesRead", "=", "0", ";", "byte", "[", "]", "buf", "=", "new", "byte", "[", "TRANSFER_SIZE", "]", ";", "while", "(", "totalRead", "<", "len", ")", "{", "int", "bytesToRead", "=", "Math", ".", "min", "(", "(", "len", "-", "totalRead", ")", ",", "TRANSFER_SIZE", ")", ";", "bytesRead", "=", "raf", ".", "read", "(", "buf", ",", "0", ",", "bytesToRead", ")", ";", "if", "(", "bytesRead", "<", "0", ")", "{", "break", ";", "}", "else", "{", "totalRead", "+", "=", "bytesRead", ";", "}", "byteBuffer", ".", "put", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "}", "if", "(", "bytesRead", "<", "0", "&", "&", "position", "(", ")", "=", "=", "size", "(", ")", "&", "&", "byteBuffer", ".", "hasRemaining", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "End", "of", "stream", "reached", "earlier", "than", "expected", "\"", ");", "}", "return", "(", "(", "bytesRead", "<", "0", ")", "&", "&", "(", "totalRead", "=", "=", "0", ")", ")", "?", "-", "1", ":", "totalRead", ";", "}", "public", "int", "readAllInOnce", "(", "ByteBuffer", "byteBuffer", ")", "throws", "IOException", "{", "if", "(", "byteBuffer", ".", "remaining", "(", ")", ">", "raf", ".", "length", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "trying", "to", "readAllInOnce", "past", "end", "of", "stream", "\"", ");", "}", "byte", "[", "]", "buf", "=", "new", "byte", "[", "byteBuffer", ".", "remaining", "(", ")]", ";", "int", "read", "=", "raf", ".", "read", "(", "buf", ")", ";", "byteBuffer", ".", "put", "(", "buf", ",", "0", ",", "read", ")", ";", "return", "read", ";", "}", "public", "long", "size", "(", ")", "throws", "IOException", "{", "return", "raf", ".", "length", "(", ");", "}", "public", "long", "position", "(", ")", "throws", "IOException", "{", "return", "raf", ".", "getFilePointer", "(", ");", "}", "public", "void", "position", "(", "long", "nuPos", ")", "throws", "IOException", "{", "if", "(", "nuPos", ">", "raf", ".", "length", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "requesting", "seek", "past", "end", "of", "stream", "\"", ");", "}", "raf", ".", "seek", "(", "nuPos", ")", ";", "}", "public", "long", "transferTo", "(", "long", "position", ",", "long", "count", ",", "WritableByteChannel", "target", ")", "throws", "IOException", "{", "return", "target", ".", "write", "(", "map", "(", "position", ",", "count", ")", ");", "}", "public", "ByteBuffer", "map", "(", "long", "startPosition", ",", "long", "size", ")", "throws", "IOException", "{", "if", "(", "startPosition", "<", "0", "|", "|", "size", "<", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "startPosition", "and", "size", "must", "both", "be", ">", "=", "0", "\"", ");", "}", "/", "/", "make", "sure", "that", "start", "+", "size", "aren", "'", "t", "greater", "than", "avail", "size", "/", "/", "in", "raf", ".", "BigInteger", "end", "=", "BigInteger", ".", "valueOf", "(", "startPosition", ")", ";", "end", "=", "end", ".", "add", "(", "BigInteger", ".", "valueOf", "(", "size", ")", ");", "if", "(", "end", ".", "compareTo", "(", "BigInteger", ".", "valueOf", "(", "raf", ".", "length", "(", "))", ")", ">", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "requesting", "read", "past", "end", "of", "stream", "\"", ");", "}", "raf", ".", "seek", "(", "startPosition", ")", ";", "int", "payLoadSize", "=", "l2i", "(", "size", ")", ";", "/", "/", "hack", "to", "check", "for", "potential", "overflow", "if", "(", "Long", ".", "MAX_VALUE", "-", "payLoadSize", "<", "startPosition", "|", "|", "Long", ".", "MAX_VALUE", "-", "payLoadSize", ">", "raf", ".", "length", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "requesting", "read", "past", "end", "of", "stream", "\"", ");", "}", "byte", "[", "]", "payload", "=", "new", "byte", "[", "payLoadSize", "]", ";", "raf", ".", "readFully", "(", "payload", ")", ";", "return", "ByteBuffer", ".", "wrap", "(", "payload", ")", ";", "}", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "raf", ".", "close", "(", ");", "}", "}", "import", "com", ".", "coremedia", ".", "iso", ".", "IsoFile", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "Box", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "Container", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "FileTypeBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "MetaBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "MovieBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "MovieHeaderBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "SampleDescriptionBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "SampleTableBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "TrackBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "TrackHeaderBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "UserDataBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "apple", ".", "AppleItemListBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "sampleentry", ".", "AudioSampleEntry", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "DataSource", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleAlbumBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtist2Box", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtistBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCommentBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCompilationBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleDiskNumberBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleEncoderBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGPSCoordinatesBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGenreBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleNameBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleRecordingYear2Box", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackAuthorBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackNumberBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "Utf8AppleDataBox", ";", "try", "(", "DataSource", "dataSource", "=", "new", "DirectFileReadDataSource", "(", "tstream", ".", "getFile", "(", "))", ")", "{", "try", "(", "IsoFile", "isoFile", "=", "new", "IsoFile", "(", "dataSource", ")", ")", "{", "tmp", ".", "addResource", "(", "isoFile", ")", ";", "/", "/", "Grab", "the", "file", "type", "box", "FileTypeBox", "fileType", "=", "getOrNull", "(", "isoFile", ",", "FileTypeBox", ".", "class", ")", ";", "if", "(", "fileType", "!", "=", "null", ")", "{", "/", "/", "Identify", "the", "type", "MediaType", "type", "=", "MediaType", ".", "application", "(", "\"", "mp4", "\"", ");", "for", "(", "Map", ".", "Entry", "<", "MediaType", ",", "List", "<", "String", ">", ">", "e", ":", "typesMap", ".", "entrySet", "(", "))", "{", "if", "(", "e", ".", "getValue", "(", ").", "contains", "(", "fileType", ".", "getMajorBrand", "(", "))", ")", "{", "type", "=", "e", ".", "getKey", "(", ");", "break", ";", "}", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "type", ".", "toString", "(", "))", ";", "if", "(", "type", ".", "getType", "(", ").", "equals", "(", "\"", "audio", "\"", "))", "{", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_COMPRESSOR", ",", "fileType", ".", "getMajorBrand", "(", ").", "trim", "(", "))", ";", "}", "}", "else", "{", "/", "/", "Some", "older", "QuickTime", "files", "lack", "the", "FileType", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "\"", "video", "/", "quicktime", "\"", ");", "/", "/", "Get", "the", "main", "MOOV", "box", "MovieBox", "moov", "=", "getOrNull", "(", "isoFile", ",", "MovieBox", ".", "class", ")", ";", "if", "(", "moov", "=", "=", "null", ")", "{", "/", "/", "Bail", "out", "return", ";", "}", "XHTMLContentHandler", "xhtml", "=", "new", "XHTMLContentHandler", "(", "handler", ",", "metadata", ")", ";", "xhtml", ".", "startDocument", "(", ");", "/", "/", "Pull", "out", "some", "information", "from", "the", "header", "box", "MovieHeaderBox", "mHeader", "=", "getOrNull", "(", "moov", ",", "MovieHeaderBox", ".", "class", ")", ";", "if", "(", "mHeader", "!", "=", "null", ")", "{", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "Metadata", ".", "CREATION_DATE", ",", "mHeader", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "mHeader", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "duration", "double", "durationSeconds", "=", "(", "(", "double", ")", "mHeader", ".", "getDuration", "(", "))", "/", "mHeader", ".", "getTimescale", "(", ");", "metadata", ".", "set", "(", "XMPDM", ".", "DURATION", ",", "DURATION_FORMAT", ".", "format", "(", "durationSeconds", ")", ");", "/", "/", "The", "timescale", "is", "normally", "the", "sampling", "rate", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "mHeader", ".", "getTimescale", "(", "))", ";", "}", "/", "/", "Get", "some", "more", "information", "from", "the", "track", "header", "/", "/", "TODO", "Decide", "how", "to", "handle", "multiple", "tracks", "List", "<", "TrackBox", ">", "tb", "=", "moov", ".", "getBoxes", "(", "TrackBox", ".", "class", ")", ";", "if", "(", "tb", ".", "size", "(", ")", ">", "0", ")", "{", "TrackBox", "track", "=", "tb", ".", "get", "(", "0", ")", ";", "TrackHeaderBox", "header", "=", "track", ".", "getTrackHeaderBox", "(", ");", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "CREATED", ",", "header", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "header", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "video", "with", "and", "height", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_WIDTH", ",", "(", "int", ")", "header", ".", "getWidth", "(", "))", ";", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_LENGTH", ",", "(", "int", ")", "header", ".", "getHeight", "(", "))", ";", "/", "/", "Get", "the", "sample", "information", "SampleTableBox", "samples", "=", "track", ".", "getSampleTableBox", "(", ");", "if", "(", "samples", "!", "=", "null", ")", "{", "SampleDescriptionBox", "sampleDesc", "=", "samples", ".", "getSampleDescriptionBox", "(", ");", "if", "(", "sampleDesc", "!", "=", "null", ")", "{", "/", "/", "Look", "for", "the", "first", "Audio", "Sample", ",", "if", "present", "AudioSampleEntry", "sample", "=", "getOrNull", "(", "sampleDesc", ",", "AudioSampleEntry", ".", "class", ")", ";", "if", "(", "sample", "!", "=", "null", ")", "{", "XMPDM", ".", "ChannelTypePropertyConverter", ".", "convertAndSet", "(", "metadata", ",", "sample", ".", "getChannelCount", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_TYPE", ",", "sample", ".", "getSampleSize", "(", "))", ";", "/", "/", "TODO", "Num", "-", ">", "Type", "mapping", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "sample", ".", "getSampleRate", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getSamplesPerPacket", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getBytesPerSample", "(", "))", ";", "}", "}", "}", "}", "/", "/", "Get", "metadata", "from", "the", "User", "Data", "Box", "UserDataBox", "userData", "=", "getOrNull", "(", "moov", ",", "UserDataBox", ".", "class", ")", ";", "if", "(", "userData", "!", "=", "null", ")", "{", "extractGPS", "(", "userData", ",", "metadata", ")", ";", "MetaBox", "meta", "=", "getOrNull", "(", "userData", ",", "MetaBox", ".", "class", ")", ";", "/", "/", "Check", "for", "iTunes", "Metadata", "/", "/", "See", "http", ":", "//", "atomicparsley", ".", "sourceforge", ".", "net", "/", "mpeg", "-", "4files", ".", "html", "and", "/", "/", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "mp4v2", "/", "wiki", "/", "iTunesMetadata", "for", "more", "on", "these", "AppleItemListBox", "apple", "=", "getOrNull", "(", "meta", ",", "AppleItemListBox", ".", "class", ")", ";", "if", "(", "apple", "!", "=", "null", ")", "{", "/", "/", "Title", "AppleNameBox", "title", "=", "getOrNull", "(", "apple", ",", "AppleNameBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "TITLE", ",", "metadata", ",", "title", ")", ";", "/", "/", "Artist", "AppleArtistBox", "artist", "=", "getOrNull", "(", "apple", ",", "AppleArtistBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "CREATOR", ",", "metadata", ",", "artist", ")", ";", "addMetadata", "(", "XMPDM", ".", "ARTIST", ",", "metadata", ",", "artist", ")", ";", "/", "/", "Album", "Artist", "AppleArtist2Box", "artist2", "=", "getOrNull", "(", "apple", ",", "AppleArtist2Box", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM_ARTIST", ",", "metadata", ",", "artist2", ")", ";", "/", "/", "Album", "AppleAlbumBox", "album", "=", "getOrNull", "(", "apple", ",", "AppleAlbumBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM", ",", "metadata", ",", "album", ")", ";", "/", "/", "Composer", "AppleTrackAuthorBox", "composer", "=", "getOrNull", "(", "apple", ",", "AppleTrackAuthorBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "COMPOSER", ",", "metadata", ",", "composer", ")", ";", "/", "/", "Genre", "AppleGenreBox", "genre", "=", "getOrNull", "(", "apple", ",", "AppleGenreBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "GENRE", ",", "metadata", ",", "genre", ")", ";", "/", "/", "Year", "AppleRecordingYear2Box", "year", "=", "getOrNull", "(", "apple", ",", "AppleRecordingYear2Box", ".", "class", ")", ";", "if", "(", "year", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "RELEASE_DATE", ",", "year", ".", "getValue", "(", "))", ";", "}", "/", "/", "Track", "number", "AppleTrackNumberBox", "trackNum", "=", "getOrNull", "(", "apple", ",", "AppleTrackNumberBox", ".", "class", ")", ";", "if", "(", "trackNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "TRACK_NUMBER", ",", "trackNum", ".", "getA", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "NUMBER_OF_TRACKS", ",", "trackNum", ".", "getB", "(", "))", ";", "/", "/", "TODO", "}", "/", "/", "Disc", "number", "AppleDiskNumberBox", "discNum", "=", "getOrNull", "(", "apple", ",", "AppleDiskNumberBox", ".", "class", ")", ";", "if", "(", "discNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "DISC_NUMBER", ",", "discNum", ".", "getA", "(", "))", ";", "}", "/", "/", "Compilation", "AppleCompilationBox", "compilation", "=", "getOrNull", "(", "apple", ",", "AppleCompilationBox", ".", "class", ")", ";", "if", "(", "compilation", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "COMPILATION", ",", "(", "int", ")", "compilation", ".", "getValue", "(", "))", ";", "}", "/", "/", "Comment", "AppleCommentBox", "comment", "=", "getOrNull", "(", "apple", ",", "AppleCommentBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "LOG_COMMENT", ",", "metadata", ",", "comment", ")", ";", "/", "/", "Encoder", "AppleEncoderBox", "encoder", "=", "getOrNull", "(", "apple", ",", "AppleEncoderBox", ".", "class", ")", ";", "if", "(", "encoder", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMP", ".", "CREATOR_TOOL", ",", "encoder", ".", "getValue", "(", "))", ";", "}", "/", "/", "As", "text", "for", "(", "Box", "box", ":", "apple", ".", "getBoxes", "(", "))", "{", "if", "(", "box", "instanceof", "Utf8AppleDataBox", ")", "{", "xhtml", ".", "element", "(", "\"", "p", "\"", ",", "(", "(", "Utf8AppleDataBox", ")", "box", ")", ".", "getValue", "(", "))", ";", "}", "}", "}", "/", "/", "TODO", "Check", "for", "other", "kinds", "too", "/", "/", "All", "done", "xhtml", ".", "endDocument", "(", ");", "}", "finally", "{", "tmp", ".", "dispose", "(", ");"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["tunnels:", "fix", "netns", "vs", "proto", "registration", "ordering", "Same", "stuff", "as", "in", "ip_gre", "patch:", "receive", "hook", "can", "be", "called", "before", "netns", "setup", "is", "done,", "oopsing", "in", "net_generic().", "Signed-off-by:", "Alexey", "Dobriyan", "<adobriyan@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["err", "=", "register_pernet_device", "(", "&", "ipip_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "return", "err", ";", "err", "=", "xfrm4_tunnel_register", "(", "&", "ipip_handler", ",", "AF_INET", ")", ";", "if", "(", "err", "<", "0", ")", "{", "unregister_pernet_device", "(", "&", "ipip_net_ops", ")", ";", "err", "=", "register_pernet_device", "(", "&", "ip6_tnl_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "out_pernet", ";", "err", "=", "xfrm6_tunnel_register", "(", "&", "ip4ip6_handler", ",", "AF_INET", ")", ";", "if", "(", "err", "<", "0", ")", "{", "goto", "out_ip4ip6", ";", "err", "=", "xfrm6_tunnel_register", "(", "&", "ip6ip6_handler", ",", "AF_INET6", ")", ";", "if", "(", "err", "<", "0", ")", "{", "goto", "out_ip6ip6", ";", "out_ip6ip6", ":", "out_ip4ip6", ":", "unregister_pernet_device", "(", "&", "ip6_tnl_net_ops", ")", ";", "out_pernet", ":", "return", "err", ";", "err", "=", "xfrm4_tunnel_register", "(", "&", "sit_handler", ",", "AF_INET6", ")", ";", "if", "(", "err", "<", "0", ")", "{", "unregister_pernet_device", "(", "&", "sit_net_ops", ")", ";", "printk", "(", "KERN_INFO", "\"", "sit", "init", ":", "Can", "'", "t", "add", "protocol", "\\", "n", "\"", ");", "}", "xfrm6_tunnel_spi_kmem", "=", "kmem_cache_create", "(", "\"", "xfrm6_tunnel_spi", "\"", ",", "sizeof", "(", "struct", "xfrm6_tunnel_spi", ")", ",", "0", ",", "SLAB_HWCACHE_ALIGN", ",", "NULL", ")", ";", "if", "(", "!", "xfrm6_tunnel_spi_kmem", ")", "return", "-", "ENOMEM", ";", "rv", "=", "register_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "out_pernet", ";", "goto", "out_type", ";", "goto", "out_xfrm6", ";", "goto", "out_xfrm46", ";", "out_xfrm46", ":", "out_xfrm6", ":", "out_type", ":", "unregister_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "out_pernet", ":", "kmem_cache_destroy", "(", "xfrm6_tunnel_spi_kmem", ")", ";", "unregister_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "kmem_cache_destroy", "(", "xfrm6_tunnel_spi_kmem", ")", ";</s>if", "(", "xfrm4_tunnel_register", "(", "&", "ipip_handler", ",", "AF_INET", ")", ")", "{", "return", "-", "EAGAIN", ";", "err", "=", "register_pernet_device", "(", "&", "ipip_net_ops", ")", ";", "if", "(", "err", ")", "xfrm4_tunnel_deregister", "(", "&", "ipip_handler", ",", "AF_INET", ")", ";", "if", "(", "xfrm6_tunnel_register", "(", "&", "ip4ip6_handler", ",", "AF_INET", ")", ")", "{", "err", "=", "-", "EAGAIN", ";", "goto", "out", ";", "if", "(", "xfrm6_tunnel_register", "(", "&", "ip6ip6_handler", ",", "AF_INET6", ")", ")", "{", "err", "=", "-", "EAGAIN", ";", "goto", "unreg_ip4ip6", ";", "err", "=", "register_pernet_device", "(", "&", "ip6_tnl_net_ops", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "err_pernet", ";", "err_pernet", ":", "xfrm6_tunnel_deregister", "(", "&", "ip6ip6_handler", ",", "AF_INET6", ")", ";", "unreg_ip4ip6", ":", "out", ":", "if", "(", "xfrm4_tunnel_register", "(", "&", "sit_handler", ",", "AF_INET6", ")", "<", "0", ")", "{", "printk", "(", "KERN_INFO", "\"", "sit", "init", ":", "Can", "'", "t", "add", "protocol", "\\", "n", "\"", ");", "return", "-", "EAGAIN", ";", "}", "xfrm4_tunnel_deregister", "(", "&", "sit_handler", ",", "AF_INET6", ")", ";", "static", "int", "__init", "xfrm6_tunnel_spi_init", "(", "void", ")", "{", "xfrm6_tunnel_spi_kmem", "=", "kmem_cache_create", "(", "\"", "xfrm6_tunnel_spi", "\"", ",", "sizeof", "(", "struct", "xfrm6_tunnel_spi", ")", ",", "0", ",", "SLAB_HWCACHE_ALIGN", ",", "NULL", ")", ";", "if", "(", "!", "xfrm6_tunnel_spi_kmem", ")", "return", "-", "ENOMEM", ";", "return", "0", ";", "}", "static", "void", "xfrm6_tunnel_spi_fini", "(", "void", ")", "{", "kmem_cache_destroy", "(", "xfrm6_tunnel_spi_kmem", ")", ";", "}", "goto", "err", ";", "goto", "unreg", ";", "goto", "dereg6", ";", "rv", "=", "xfrm6_tunnel_spi_init", "(", ");", "if", "(", "rv", "<", "0", ")", "goto", "dereg46", ";", "rv", "=", "register_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "if", "(", "rv", "<", "0", ")", "goto", "deregspi", ";", "deregspi", ":", "xfrm6_tunnel_spi_fini", "(", ");", "dereg46", ":", "xfrm6_tunnel_deregister", "(", "&", "xfrm46_tunnel_handler", ",", "AF_INET", ")", ";", "dereg6", ":", "unreg", ":", "err", ":", "unregister_pernet_subsys", "(", "&", "xfrm6_tunnel_net_ops", ")", ";", "xfrm6_tunnel_spi_fini", "(", ");"], "docstring_tokens": ["by", "sending", "a", "packet", "during", "module", "loading", "."]}
{"contents": ["ext4:", "add", "corruption", "check", "in", "ext4_xattr_set_entry()", "In", "theory", "this", "should", "have", "been", "caught", "earlier", "when", "the", "xattr", "list", "was", "verified,", "but", "in", "case", "it", "got", "missed,", "it's", "simple", "enough", "to", "add", "check", "to", "make", "sure", "we", "don't", "overrun", "the", "xattr", "buffer.", "This", "addresses", ".", "https://bugzilla.kernel.org/show_bug.cgi?id=200001", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>", "Reviewed-by:", "Andreas", "Dilger", "<adilger@dilger.ca>", "Cc:", "stable@kernel.org"], "code_tokens": ["struct", "ext4_xattr_entry", "*", "last", ",", "*", "next", ";", "for", "(", ";", "!", "IS_LAST_ENTRY", "(", "last", ")", ";", "last", "=", "next", ")", "{", "next", "=", "EXT4_XATTR_NEXT", "(", "last", ")", ";", "if", "(", "(", "void", "*", ")", "next", ">", "=", "s", "-", ">", "end", ")", "{", "EXT4_ERROR_INODE", "(", "inode", ",", "\"", "corrupted", "xattr", "entries", "\"", ");", "ret", "=", "-", "EFSCORRUPTED", ";", "goto", "out", ";", "}</s>struct", "ext4_xattr_entry", "*", "last", ";", "for", "(", ";", "!", "IS_LAST_ENTRY", "(", "last", ")", ";", "last", "=", "EXT4_XATTR_NEXT", "(", "last", ")", ")", "{"], "docstring_tokens": ["by", "renaming", "a", "file", "in", "a", "crafted", "ext4", "filesystem", "image", "."]}
{"contents": ["Use", "the", "Index", "Access", "Control", "from", "the", "scroll", "search", "context", "(#60640)", "When", "the", "RBACEngine", "authorizes", "scroll", "searches", "it", "sets", "the", "index", "access", "control", "to", "the", "very", "limiting", "IndicesAccessControl.ALLOW_NO_INDICES", "value.", "This", "change", "will", "set", "it", "to", "the", "value", "for", "the", "index", "access", "control", "that", "was", "produced", "during", "the", "authorization", "of", "the", "initial", "search", "that", "created", "the", "scroll,", "which", "is", "now", "stored", "in", "the", "scroll", "context."], "code_tokens": ["/", "/", "RBACEngine", "simply", "authorizes", "scroll", "related", "actions", "without", "filling", "in", "any", "DLS", "/", "FLS", "permissions", ".", "/", "/", "Scroll", "related", "actions", "have", "special", "security", "logic", ",", "where", "the", "security", "context", "of", "the", "initial", "search", "/", "/", "request", "is", "attached", "to", "the", "scroll", "context", "upon", "creation", "in", "{", "@", "code", "SecuritySearchOperationListener", "#", "onNewScrollContext", "}", "/", "/", "and", "it", "is", "then", "verified", ",", "before", "every", "use", "of", "the", "scroll", ",", "in", "/", "/", "{", "@", "code", "SecuritySearchOperationListener", "#", "validateSearchContext", "}", ".", "/", "/", "The", "DLS", "/", "FLS", "permissions", "are", "used", "inside", "the", "{", "@", "code", "DirectoryReader", "}", "that", "{", "@", "code", "SecurityIndexReaderWrapper", "}", "/", "/", "built", "while", "handling", "the", "initial", "search", "request", ".", "In", "addition", ",", "for", "consistency", ",", "the", "DLS", "/", "FLS", "permissions", "from", "/", "/", "the", "originating", "search", "request", "are", "attached", "to", "the", "thread", "context", "upon", "validating", "the", "scroll", ".", "listener", ".", "onResponse", "(", "new", "IndexAuthorizationResult", "(", "true", ",", "null", ")", ");", "import", "org", ".", "elasticsearch", ".", "ElasticsearchSecurityException", ";", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "AuthorizationServiceField", ";", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "accesscontrol", ".", "IndicesAccessControl", ";", "/", "/", "store", "the", "DLS", "and", "FLS", "permissions", "of", "the", "initial", "search", "request", "that", "created", "the", "scroll", "/", "/", "this", "is", "then", "used", "to", "assert", "the", "DLS", "/", "FLS", "permission", "for", "the", "scroll", "search", "action", "IndicesAccessControl", "indicesAccessControl", "=", "securityContext", ".", "getThreadContext", "(", ").", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "assert", "indicesAccessControl", "!", "=", "null", ":", "\"", "thread", "context", "does", "not", "contain", "index", "access", "control", "\"", ";", "searchContext", ".", "scrollContext", "(", ").", "putInContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "indicesAccessControl", ")", ";", "/", "/", "piggyback", "on", "context", "validation", "to", "assert", "the", "DLS", "/", "FLS", "permissions", "on", "the", "thread", "context", "of", "the", "scroll", "search", "handler", "if", "(", "null", "=", "=", "securityContext", ".", "getThreadContext", "(", ").", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ")", "{", "/", "/", "fill", "in", "the", "DLS", "and", "FLS", "permissions", "for", "the", "scroll", "search", "action", "from", "the", "scroll", "context", "IndicesAccessControl", "scrollIndicesAccessControl", "=", "searchContext", ".", "scrollContext", "(", ").", "getFromContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "assert", "scrollIndicesAccessControl", "!", "=", "null", ":", "\"", "scroll", "does", "not", "contain", "index", "access", "control", "\"", ";", "securityContext", ".", "getThreadContext", "(", ").", "putTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "scrollIndicesAccessControl", ")", ";", "}", "}", "}", "}", "@", "Override", "public", "void", "onPreFetchPhase", "(", "SearchContext", "searchContext", ")", "{", "ensureIndicesAccessControlForScrollThreadContext", "(", "searchContext", ")", ";", "}", "@", "Override", "public", "void", "onPreQueryPhase", "(", "SearchContext", "searchContext", ")", "{", "ensureIndicesAccessControlForScrollThreadContext", "(", "searchContext", ")", ";", "}", "void", "ensureIndicesAccessControlForScrollThreadContext", "(", "SearchContext", "searchContext", ")", "{", "if", "(", "licenseState", ".", "isSecurityEnabled", "(", ")", "&", "&", "searchContext", ".", "scrollContext", "(", ")", "!", "=", "null", ")", "{", "IndicesAccessControl", "scrollIndicesAccessControl", "=", "searchContext", ".", "scrollContext", "(", ").", "getFromContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "IndicesAccessControl", "threadIndicesAccessControl", "=", "securityContext", ".", "getThreadContext", "(", ").", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "if", "(", "scrollIndicesAccessControl", "!", "=", "threadIndicesAccessControl", ")", "{", "throw", "new", "ElasticsearchSecurityException", "(", "\"[", "\"", "+", "searchContext", ".", "id", "(", ")", "+", "\"", "]", "expected", "scroll", "indices", "access", "control", "[", "\"", "scrollIndicesAccessControl", ".", "toString", "(", ")", "+", "\"", "]", "but", "found", "[", "\"", "+", "threadIndicesAccessControl", ".", "toString", "(", ")", "+", "\"", "]", "in", "thread", "\"", "\"", "context", "\"", ");", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "QueryBuilder", ";", "public", "void", "testScrollWithQueryCache", "(", ")", "{", "assertAcked", "(", "client", "(", ").", "admin", "(", ").", "indices", "(", ").", "prepareCreate", "(", "\"", "test", "\"", ")", ".", "setSettings", "(", "Settings", ".", "builder", "(", ").", "put", "(", "IndexModule", ".", "INDEX_QUERY_CACHE_EVERYTHING_SETTING", ".", "getKey", "(", "),", "true", ")", ")", ".", "addMapping", "(", "\"", "type1", "\"", ",", "\"", "field1", "\"", ",", "\"", "type", "=", "text", "\"", ",", "\"", "field2", "\"", ",", "\"", "type", "=", "text", "\"", ")", ")", ";", "final", "int", "numDocs", "=", "scaledRandomIntBetween", "(", "2", ",", "4", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numDocs", ";", "i", "+", "+)", "{", "client", "(", ").", "prepareIndex", "(", "\"", "test", "\"", ",", "\"", "type1", "\"", ",", "String", ".", "valueOf", "(", "i", ")", ")", ".", "setSource", "(", "\"", "field1", "\"", ",", "\"", "value1", "\"", ",", "\"", "field2", "\"", ",", "\"", "value2", "\"", ")", ".", "get", "(", ");", "}", "refresh", "(", "\"", "test", "\"", ");", "final", "QueryBuilder", "cacheableQueryBuilder", "=", "constantScoreQuery", "(", "termQuery", "(", "\"", "field1", "\"", ",", "\"", "value1", "\"", "))", ";", "SearchResponse", "user1SearchResponse", "=", "null", ";", "SearchResponse", "user2SearchResponse", "=", "null", ";", "int", "scrolledDocsUser1", "=", "0", ";", "final", "int", "numScrollSearch", "=", "scaledRandomIntBetween", "(", "20", ",", "30", ")", ";", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numScrollSearch", ";", "i", "+", "+)", "{", "if", "(", "randomBoolean", "(", "))", "{", "if", "(", "user2SearchResponse", "=", "=", "null", ")", "{", "user2SearchResponse", "=", "client", "(", ").", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user2", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearch", "(", "\"", "test", "\"", ")", ".", "setQuery", "(", "cacheableQueryBuilder", ")", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "setSize", "(", "1", ")", ".", "setFetchSource", "(", "true", ")", ".", "get", "(", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "0", ")", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "0", ")", ");", "}", "else", "{", "/", "/", "make", "sure", "scroll", "is", "empty", "user2SearchResponse", "=", "client", "(", ")", ".", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user2", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearchScroll", "(", "user2SearchResponse", ".", "getScrollId", "(", "))", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "get", "(", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "0", ")", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "0", ")", ");", "if", "(", "randomBoolean", "(", "))", "{", "/", "/", "maybe", "reuse", "the", "scroll", "even", "if", "empty", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "user2SearchResponse", ".", "getScrollId", "(", "))", ".", "get", "(", ");", "user2SearchResponse", "=", "null", ";", "}", "}", "}", "else", "{", "if", "(", "user1SearchResponse", "=", "=", "null", ")", "{", "user1SearchResponse", "=", "client", "(", ").", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user1", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearch", "(", "\"", "test", "\"", ")", ".", "setQuery", "(", "cacheableQueryBuilder", ")", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "setSize", "(", "1", ")", ".", "setFetchSource", "(", "true", ")", ".", "get", "(", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "numDocs", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "get", "(", "\"", "field1", "\"", "),", "is", "(", "\"", "value1", "\"", "))", ";", "scrolledDocsUser1", "+", "+;", "}", "else", "{", "user1SearchResponse", "=", "client", "(", ")", ".", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user1", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearchScroll", "(", "user1SearchResponse", ".", "getScrollId", "(", "))", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "get", "(", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "numDocs", ")", ");", "if", "(", "scrolledDocsUser1", "<", "numDocs", ")", "{", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "get", "(", "\"", "field1", "\"", "),", "is", "(", "\"", "value1", "\"", "))", ";", "scrolledDocsUser1", "+", "+;", "}", "else", "{", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "0", ")", ");", "if", "(", "randomBoolean", "(", "))", "{", "/", "/", "maybe", "reuse", "the", "scroll", "even", "if", "empty", "if", "(", "user1SearchResponse", ".", "getScrollId", "(", ")", "!", "=", "null", ")", "{", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "user1SearchResponse", ".", "getScrollId", "(", "))", ".", "get", "(", ");", "}", "user1SearchResponse", "=", "null", ";", "scrolledDocsUser1", "=", "0", ";", "}", "}", "}", "}", "}", "}", "finally", "{", "if", "(", "user1SearchResponse", "!", "=", "null", ")", "{", "String", "scrollId", "=", "user1SearchResponse", ".", "getScrollId", "(", ");", "if", "(", "scrollId", "!", "=", "null", ")", "{", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "scrollId", ")", ".", "get", "(", ");", "}", "}", "if", "(", "user2SearchResponse", "!", "=", "null", ")", "{", "String", "scrollId", "=", "user2SearchResponse", ".", "getScrollId", "(", ");", "if", "(", "scrollId", "!", "=", "null", ")", "{", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "scrollId", ")", ".", "get", "(", ");", "}", "}", "}", "}", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "AuthorizationServiceField", ";", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "accesscontrol", ".", "IndicesAccessControl", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "nullValue", ";", "IndicesAccessControl", "indicesAccessControl", "=", "mock", "(", "IndicesAccessControl", ".", "class", ")", ";", "threadContext", ".", "putTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "indicesAccessControl", ")", ";", "assertThat", "(", "testSearchContext", ".", "scrollContext", "(", ").", "getFromContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "final", "IndicesAccessControl", "indicesAccessControl", "=", "mock", "(", "IndicesAccessControl", ".", "class", ")", ";", "testSearchContext", ".", "scrollContext", "(", ").", "putInContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "indicesAccessControl", ")", ";", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "nullValue", "(", "))", ";", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "nullValue", "(", "))", ";</s>/", "/", "we", "store", "the", "request", "as", "a", "transient", "in", "the", "ThreadContext", "in", "case", "of", "a", "authorization", "failure", "at", "the", "shard", "/", "/", "level", ".", "If", "authorization", "fails", "we", "will", "audit", "a", "access_denied", "message", "and", "will", "use", "the", "request", "to", "retrieve", "/", "/", "information", "such", "as", "the", "index", "and", "the", "incoming", "address", "of", "the", "request", "listener", ".", "onResponse", "(", "new", "IndexAuthorizationResult", "(", "true", ",", "IndicesAccessControl", ".", "ALLOW_NO_INDICES", ")", ");"], "docstring_tokens": ["running", "the", "same", "query"]}
{"contents": ["Fixed", "#68677"], "code_tokens": ["zend_shared_alloc_register_xlat_entry", "(", "source", ",", "retval", ")", ";</s>zend_shared_alloc_register_xlat_entry", "(", "source", ",", "retval", ")", ";"], "docstring_tokens": ["sending", "specially-crafted", "data"]}
{"contents": ["DATAJPA-965", "-", "Fix", "potential", "blind", "SQL", "injection", "in", "Sort", "when", "used", "in", "combination", "with", "@Query.", "We", "now", "decline", "sort", "expressions", "that", "contain", "functions", "such", "as", "ORDER", "BY", "LENGTH(name)", "when", "used", "with", "repository", "having", "a", "String", "query", "defined", "via", "the", "@Query", "annotation.", "Think", "of", "a", "query", "method", "as", "follows:", "@Query(\"select", "p", "from", "Person", "p", "where", "LOWER(p.lastname)", "=", "LOWER(:lastname)\")", "List<Person>", "findByLastname(@Param(\"lastname\")", "String", "lastname,", "Sort", "sort);", "Calls", "to", "findByLastname(\"lannister\",", "new", "Sort(\"LENGTH(firstname)\"))", "from", "now", "on", "throw", "an", "Exception", "indicating", "function", "calls", "are", "not", "allowed", "within", "the", "_ORDER", "BY_", "clause.", "However", "you", "still", "can", "use", "JpaSort.unsafe(\"LENGTH(firstname)\")", "to", "restore", "the", "behavior.", "Kudos", "to", "Niklas", "Sa\u0308ro\u0308kaari,", "Joona", "Immonen,", "Arto", "Santala,", "Antti", "Virtanen,", "Michael", "Holopainen", "and", "Antti", "Ahola", "who", "brought", "this", "to", "our", "attention."], "code_tokens": ["*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "@", "author", "Christoph", "Strobl", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ")", "{", "super", "(", "orders", ")", ";", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "JpaSort", "andUnsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "null", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "Order", "order", ":", "this", ")", "{", "orders", ".", "add", "(", "order", ")", ";", "}", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ",", "direction", ",", "Collections", ".", "<", "Path", "<", "?,", "?", ">>", "emptyList", "(", "))", ";", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "properties", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "String", ".", "..", "properties", ")", "{", "return", "unsafe", "(", "Sort", ".", "DEFAULT_DIRECTION", ",", "properties", ")", ";", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notNull", "(", "direction", ",", "\"", "Direction", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "return", "unsafe", "(", "direction", ",", "Arrays", ".", "asList", "(", "properties", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "List", "<", "String", ">", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ")", ";", "}", "/", "**", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "static", "class", "JpaOrder", "extends", "Order", "{", "private", "final", "boolean", "unsafe", ";", "private", "final", "boolean", "ignoreCase", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaOrder", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ")", "{", "this", "(", "direction", ",", "property", ",", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "Order", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "nullHandlingHint", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "NullHandling", "#", "NATIVE", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandlingHint", ")", "{", "this", "(", "direction", ",", "property", ",", "nullHandlingHint", ",", "false", ",", "true", ")", ";", "}", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandling", ",", "boolean", "ignoreCase", ",", "boolean", "unsafe", ")", "{", "super", "(", "direction", ",", "property", ",", "nullHandling", ")", ";", "this", ".", "ignoreCase", "=", "ignoreCase", ";", "this", ".", "unsafe", "=", "unsafe", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "Direction", "order", ")", "{", "return", "new", "JpaOrder", "(", "order", ",", "getProperty", "(", "),", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "NullHandling", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "NullHandling", "nullHandling", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "nullHandling", ",", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsFirst", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsFirst", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_FIRST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsLast", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsLast", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_LAST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsNative", "(", ")", "*", "/", "public", "JpaOrder", "nullsNative", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "new", "{", "@", "link", "Sort", "}", "with", "potentially", "unsafe", "{", "@", "link", "Order", "}", "instances", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "Sort", "withUnsafe", "(", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "getDirection", "(", "),", "property", ",", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ");", "}", "return", "new", "Sort", "(", "orders", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "ignoreCase", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "ignoreCase", "(", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "getNullHandling", "(", "),", "true", ",", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "isIgnoreCase", "(", ")", "*", "/", "@", "Override", "public", "boolean", "isIgnoreCase", "(", ")", "{", "return", "super", ".", "isIgnoreCase", "(", ")", "|", "|", "ignoreCase", ";", "}", "/", "**", "*", "@", "return", "true", "if", "{", "@", "link", "JpaOrder", "}", "created", "{", "@", "link", "#", "withUnsafe", "(", "String", ".", "..", ")}", ".", "*", "/", "public", "boolean", "isUnsafe", "(", ")", "{", "return", "unsafe", ";", "}", "}", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "*", "@", "author", "Christoph", "Strobl", "private", "static", "final", "Pattern", "PUNCTATION_PATTERN", "=", "Pattern", ".", "compile", "(", "\".", "*(", "(?", "![", "\\\\", ".", "_", "]", ")[", "\\\\", "p", "{", "Punct", "}", "|\\", "\\", "s", "]", ")\"", ");", "private", "static", "final", "String", "FUNCTION_ALIAS_GROUP_NAME", "=", "\"", "alias", "\"", ";", "private", "static", "final", "Pattern", "FUNCTION_PATTERN", ";", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "\")", ";", "/", "/", "at", "least", "one", "space", "builder", ".", "append", "(", "\"\\", "\\", "w", "+", "\\\\", "([", "0", "-", "9a", "-", "zA", "-", "z", "\\", "\\.", "_", ",", "\\\\", "s", "'", "]+", "\\\\", ")\"", ");", "/", "/", "any", "function", "call", "including", "parameters", "within", "the", "brackets", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "[", "as", "|", "AS", "]", "+\\", "\\", "s", "+", "(?", "<\"", "+", "FUNCTION_ALIAS_GROUP_NAME", "+", "\"", ">[", "\\\\", "w", "\\", "\\.", "]+", ")\"", ");", "/", "/", "the", "potential", "alias", "FUNCTION_PATTERN", "=", "compile", "(", "builder", ".", "toString", "(", "))", ";", "Set", "<", "String", ">", "functionAliases", "=", "getFunctionAliases", "(", "query", ")", ";", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "functionAliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "Set", "<", "String", ">", "functionAlias", ",", "String", "alias", ",", "Order", "order", ")", "{", "checkSortExpression", "(", "order", ")", ";", "if", "(", "functionAlias", ".", "contains", "(", "property", ")", ")", "{", "return", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "property", ",", "toJpaDirection", "(", "order", ")", ");", "}", "/", "**", "*", "Returns", "the", "aliases", "used", "for", "aggregate", "functions", "like", "{", "@", "code", "SUM", ",", "COUNT", ",", ".", "..", "}.", "*", "*", "@", "param", "query", "*", "@", "return", "*", "/", "static", "Set", "<", "String", ">", "getFunctionAliases", "(", "String", "query", ")", "{", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", "String", ">", "()", ";", "Matcher", "matcher", "=", "FUNCTION_PATTERN", ".", "matcher", "(", "query", ")", ";", "while", "(", "matcher", ".", "find", "(", "))", "{", "String", "alias", "=", "matcher", ".", "group", "(", "FUNCTION_ALIAS_GROUP_NAME", ")", ";", "if", "(", "StringUtils", ".", "hasText", "(", "alias", ")", ")", "{", "result", ".", "add", "(", "alias", ")", ";", "}", "}", "return", "result", ";", "}", "/", "**", "*", "Check", "any", "given", "{", "@", "link", "JpaOrder", "#", "isUnsafe", "(", ")}", "order", "for", "presence", "of", "at", "least", "one", "property", "offending", "the", "*", "{", "@", "link", "#", "PUNCTATION_PATTERN", "}", "and", "throw", "an", "{", "@", "link", "Exception", "}", "indicating", "potential", "unsafe", "order", "by", "expression", ".", "*", "*", "@", "param", "order", "*", "/", "private", "static", "void", "checkSortExpression", "(", "Order", "order", ")", "{", "if", "(", "order", "instanceof", "JpaOrder", "&", "&", "(", "(", "JpaOrder", ")", "order", ")", ".", "isUnsafe", "(", "))", "{", "return", ";", "}", "if", "(", "PUNCTATION_PATTERN", ".", "matcher", "(", "order", ".", "getProperty", "(", "))", ".", "find", "(", "))", "{", "throw", "new", "InvalidDataAccessApiUsageException", "(", "String", ".", "format", "(", "\"", "Sort", "expression", "'", "%", "s", "'", "must", "not", "contain", "functions", "or", "expressions", ".", "Please", "use", "JpaSort", ".", "unsafe", ".", "\",", "order", ")", ");", "}", "}", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "*", "@", "author", "Christoph", "Strobl", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItem", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortWithMultiplePropertiesCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ",", "\"", "spring", ".", "data", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "spring", ".", "data", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "spring", ".", "data", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesSafeAndUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ").", "andUnsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesUnsafeAndSafeSortCorrectly", "(", ")", "{", "Sort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ").", "and", "(", "ASC", ",", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "*", "Copyright", "2008", "-", "2016", "the", "original", "author", "or", "authors", ".", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ";", "*", "@", "author", "Christoph", "Strobl", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotAllowWhitespaceInSort", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "case", "when", "foo", "then", "bar", "\"", ");", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixUnsageJpaSortFunctionCalls", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "assertThat", "(", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", "),", "endsWith", "(", "\"", "order", "by", "sum", "(", "foo", ")", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixMultipleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", ",", "SUM", "(", "m", ".", "stocks", ")", "AS", "sumStocks", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ",", "\"", "sumStocks", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", ",", "sumStocks", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixSingleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesSingleNonAliasedFunctionCallRelatedSortProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "someOtherProperty", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "someOtherProperty", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesNonAliasedFunctionCallRelatedSortPropertyWhenSelectClauseContainesAliasedFunctionForDifferentProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "m", ".", "name", ",", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "name", "\"", ",", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "name", "asc", ",", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleNumericParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "SUBSTRING", "(", "m", ".", "name", ",", "2", ",", "5", ")", "AS", "trimmedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "trimmedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "trimmedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleStringParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "CONCAT", "(", "m", ".", "name", ",", "'", "foo", "'", ")", "AS", "extendedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "extendedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "extendedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithUnderscores", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avg_price", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avg_price", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avg_price", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithDots", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "m", ".", "avg", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "m", ".", "avg", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "avg", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWhenQueryStringContainsMultipleWhiteSpaces", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}</s>*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Order", "order", ")", "{", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2008", "-", "2015", "the", "original", "author", "or", "authors", ".", "@", "Test"], "docstring_tokens": ["via", "a", "sort", "instance", "with", "a", "function", "call", "."]}
{"contents": ["eCryptfs:", "Check", "Tag", "11", "literal", "data", "buffer", "size", "Tag", "11", "packets", "are", "stored", "in", "the", "metadata", "section", "of", "an", "eCryptfs", "file", "to", "store", "the", "key", "signature(s)", "used", "to", "encrypt", "the", "file", "encryption", "key.", "After", "extracting", "the", "packet", "length", "field", "to", "determine", "the", "key", "signature", "length,", "a", "check", "is", "not", "performed", "to", "see", "if", "the", "length", "would", "exceed", "the", "key", "signature", "buffer", "size", "that", "was", "passed", "into", "parse_tag_11_packet().", "Thanks", "to", "Ramon", "de", "Carvalho", "Valle", "for", "finding", "this", "bug", "using", "fsfuzzer.", "Signed-off-by:", "Tyler", "Hicks", "<tyhicks@linux.vnet.ibm.com>", "Cc:", "stable@kernel.org", "(2.6.27", "and", "30)", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "unlikely", "(", "(*", "tag_11_contents_size", ")", ">", "max_contents_bytes", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "Literal", "data", "section", "in", "tag", "11", "packet", "exceeds", "\"", "\"", "expected", "size", "\\", "n", "\"", ");", "rc", "=", "-", "EINVAL", ";", "goto", "out", ";", "}</s>"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "an", "eCryptfs", "file", "containing", "a", "specially-crafted", "metadata", "section"]}
{"contents": ["ping:", "prevent", "NULL", "pointer", "dereference", "on", "write", "to", "msg_name", "A", "plain", "read()", "on", "a", "socket", "does", "set", "msg->msg_name", "to", "NULL.", "So", "check", "for", "NULL", "pointer", "first.", "Signed-off-by:", "Hannes", "Frederic", "Sowa", "<hannes@stressinduktion.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "sin", ")", "{", "sin", "-", ">", "sin_family", "=", "AF_INET", ";", "sin", "-", ">", "sin_port", "=", "0", "/", "*", "skb", "-", ">", "h", ".", "uh", "-", ">", "source", "*", "/;", "sin", "-", ">", "sin_addr", ".", "s_addr", "=", "ip_hdr", "(", "skb", ")", "->", "saddr", ";", "memset", "(", "sin", "-", ">", "sin_zero", ",", "0", ",", "sizeof", "(", "sin", "-", ">", "sin_zero", ")", ");", "*", "addr_len", "=", "sizeof", "(", "*", "sin", ")", ";", "}", "if", "(", "sin6", ")", "{", "sin6", "-", ">", "sin6_family", "=", "AF_INET6", ";", "sin6", "-", ">", "sin6_port", "=", "0", ";", "sin6", "-", ">", "sin6_addr", "=", "ip6", "-", ">", "saddr", ";", "sin6", "-", ">", "sin6_flowinfo", "=", "0", ";", "if", "(", "np", "-", ">", "sndflow", ")", "sin6", "-", ">", "sin6_flowinfo", "=", "ip6_flowinfo", "(", "ip6", ")", ";", "sin6", "-", ">", "sin6_scope_id", "=", "ipv6_iface_scope_id", "(", "&", "sin6", "-", ">", "sin6_addr", ",", "IP6CB", "(", "skb", ")", "->", "iif", ")", ";", "*", "addr_len", "=", "sizeof", "(", "*", "sin6", ")", ";", "}</s>sin", "-", ">", "sin_family", "=", "AF_INET", ";", "sin", "-", ">", "sin_port", "=", "0", "/", "*", "skb", "-", ">", "h", ".", "uh", "-", ">", "source", "*", "/;", "sin", "-", ">", "sin_addr", ".", "s_addr", "=", "ip_hdr", "(", "skb", ")", "->", "saddr", ";", "memset", "(", "sin", "-", ">", "sin_zero", ",", "0", ",", "sizeof", "(", "sin", "-", ">", "sin_zero", ")", ");", "*", "addr_len", "=", "sizeof", "(", "*", "sin", ")", ";", "sin6", "-", ">", "sin6_family", "=", "AF_INET6", ";", "sin6", "-", ">", "sin6_port", "=", "0", ";", "sin6", "-", ">", "sin6_addr", "=", "ip6", "-", ">", "saddr", ";", "sin6", "-", ">", "sin6_flowinfo", "=", "0", ";", "if", "(", "np", "-", ">", "sndflow", ")", "sin6", "-", ">", "sin6_flowinfo", "=", "ip6_flowinfo", "(", "ip6", ")", ";", "sin6", "-", ">", "sin6_scope_id", "=", "ipv6_iface_scope_id", "(", "&", "sin6", "-", ">", "sin6_addr", ",", "IP6CB", "(", "skb", ")", "->", "iif", ")", ";", "*", "addr_len", "=", "sizeof", "(", "*", "sin6", ")", ";"], "docstring_tokens": ["by", "leveraging", "unspecified", "privileges", "to", "execute", "a", "crafted", "application", "."]}
{"contents": ["fs:", "limit", "filesystem", "stacking", "depth", "Add", "a", "simple", "read-only", "counter", "to", "super_block", "that", "indicates", "how", "deep", "this", "is", "in", "the", "stack", "of", "filesystems.", "Previously", "ecryptfs", "was", "the", "only", "stackable", "filesystem", "and", "it", "explicitly", "disallowed", "multiple", "layers", "of", "itself.", "Overlayfs,", "however,", "can", "be", "stacked", "recursively", "and", "also", "may", "be", "stacked", "on", "top", "of", "ecryptfs", "or", "vice", "versa.", "To", "limit", "the", "kernel", "stack", "usage", "we", "must", "limit", "the", "depth", "of", "the", "filesystem", "stack.", "Initially", "the", "limit", "is", "set", "to", "2.", "Signed-off-by:", "Miklos", "Szeredi", "<mszeredi@suse.cz>"], "code_tokens": ["s", "-", ">", "s_stack_depth", "=", "path", ".", "dentry", "-", ">", "d_sb", "-", ">", "s_stack_depth", "+", "1", ";", "rc", "=", "-", "EINVAL", ";", "if", "(", "s", "-", ">", "s_stack_depth", ">", "FILESYSTEM_MAX_STACK_DEPTH", ")", "{", "pr_err", "(", "\"", "eCryptfs", ":", "maximum", "fs", "stacking", "depth", "exceeded", "\\", "n", "\"", ");", "goto", "out_free", ";", "}", "sb", "-", ">", "s_stack_depth", "=", "max", "(", "upperpath", ".", "mnt", "-", ">", "mnt_sb", "-", ">", "s_stack_depth", ",", "lowerpath", ".", "mnt", "-", ">", "mnt_sb", "-", ">", "s_stack_depth", ")", "+", "1", ";", "err", "=", "-", "EINVAL", ";", "if", "(", "sb", "-", ">", "s_stack_depth", ">", "FILESYSTEM_MAX_STACK_DEPTH", ")", "{", "pr_err", "(", "\"", "overlayfs", ":", "maximum", "fs", "stacking", "depth", "exceeded", "\\", "n", "\"", ");", "goto", "out_put_workpath", ";", "}", "/", "*", "*", "Maximum", "number", "of", "layers", "of", "fs", "stack", ".", "Needs", "to", "be", "limited", "to", "*", "prevent", "kernel", "stack", "overflow", "*", "/", "#", "define", "FILESYSTEM_MAX_STACK_DEPTH", "2", "/", "*", "*", "Indicates", "how", "deep", "in", "a", "filesystem", "stack", "this", "SB", "is", "*", "/", "int", "s_stack_depth", ";</s>"], "docstring_tokens": ["via", "a", "large", "filesystem", "stack", "that", "includes", "an", "overlayfs", "layer"]}
{"contents": ["UNDERTOW-1338", "File", "descriptor", "leak", "cause", "JarURLConnection.getLastModi\u2026", "(#638)", "UNDERTOW-1337", "File", "descriptor", "leak", "cause", "JarURLConnection.getLastModified()"], "code_tokens": ["import", "java", ".", "net", ".", "JarURLConnection", ";", "if", "(", "url", ".", "getProtocol", "(", ").", "equals", "(", "\"", "jar", "\"", "))", "{", "connection", ".", "setUseCaches", "(", "false", ")", ";", "URL", "jar", "=", "(", "(", "JarURLConnection", ")", "connection", ")", ".", "getJarFileURL", "(", ");", "lastModified", "=", "new", "Date", "(", "new", "File", "(", "jar", ".", "getFile", "(", "))", ".", "lastModified", "(", "))", ";", "}", "else", "{", "lastModified", "=", "new", "Date", "(", "connection", ".", "getLastModified", "(", "))", ";", "}</s>lastModified", "=", "new", "Date", "(", "connection", ".", "getLastModified", "(", "))", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["sched/fair:", "Fix", "infinite", "loop", "in", "update_blocked_averages()", "by", "reverting", "a9e7f6544b9c", "Zhipeng", "Xie,", "Xie", "XiuQi", "and", "Sargun", "Dhillon", "reported", "lockups", "in", "the", "scheduler", "under", "high", "loads,", "starting", "at", "around", "the", "v4.18", "time", "frame,", "and", "Zhipeng", "Xie", "tracked", "it", "down", "to", "bugs", "in", "the", "rq->leaf_cfs_rq_list", "manipulation.", "Do", "a", "(manual)", "revert", "of:", "a9e7f6544b9c", "(\"sched/fair:", "Fix", "O(nr_cgroups)", "in", "load", "balance", "path\")", "It", "turns", "out", "that", "the", "list_del_leaf_cfs_rq()", "introduced", "by", "this", "commit", "is", "a", "surprising", "property", "that", "was", "not", "considered", "in", "followup", "commits", "such", "as:", "9c2791f936ef", "(\"sched/fair:", "Fix", "hierarchical", "order", "in", "rq->leaf_cfs_rq_list\")", "As", "Vincent", "Guittot", "explains:", "\"I", "think", "that", "there", "is", "a", "bigger", "problem", "with", "commit", "a9e7f6544b9c", "and", "cfs_rq", "throttling:", "Let", "take", "the", "example", "of", "the", "following", "topology", "TG2", "-->", "TG1", "-->", "root:", "1)", "The", "1st", "time", "a", "task", "is", "enqueued,", "we", "will", "add", "TG2", "cfs_rq", "then", "TG1", "cfs_rq", "to", "leaf_cfs_rq_list", "and", "we", "are", "sure", "to", "do", "the", "whole", "branch", "in", "one", "path", "because", "it", "has", "never", "been", "used", "and", "can't", "be", "throttled", "so", "tmp_alone_branch", "will", "point", "to", "leaf_cfs_rq_list", "at", "the", "end.", "2)", "Then", "TG1", "is", "throttled", "3)", "and", "we", "add", "TG3", "as", "a", "new", "child", "of", "TG1.", "4)", "The", "1st", "enqueue", "of", "a", "task", "on", "TG3", "will", "add", "TG3", "cfs_rq", "just", "before", "TG1", "cfs_rq", "and", "tmp_alone_branch", "will", "stay", "on", "rq->leaf_cfs_rq_list.", "With", "commit", "a9e7f6544b9c,", "we", "can", "del", "a", "cfs_rq", "from", "rq->leaf_cfs_rq_list.", "So", "if", "the", "load", "of", "TG1", "cfs_rq", "becomes", "NULL", "before", "step", "2)", "above,", "TG1", "cfs_rq", "is", "removed", "from", "the", "list.", "Then", "at", "step", "4),", "TG3", "cfs_rq", "is", "added", "at", "the", "beginning", "of", "rq->leaf_cfs_rq_list", "but", "tmp_alone_branch", "still", "points", "to", "TG3", "cfs_rq", "because", "its", "throttled", "parent", "can't", "be", "enqueued", "when", "the", "lock", "is", "released.", "tmp_alone_branch", "doesn't", "point", "to", "rq->leaf_cfs_rq_list", "whereas", "it", "should.", "So", "if", "TG3", "cfs_rq", "is", "removed", "or", "destroyed", "before", "tmp_alone_branch", "points", "on", "another", "TG", "cfs_rq,", "the", "next", "TG", "cfs_rq", "that", "will", "be", "added,", "will", "be", "linked", "outside", "rq->leaf_cfs_rq_list", "-", "which", "is", "bad.", "In", "addition,", "we", "can", "break", "the", "ordering", "of", "the", "cfs_rq", "in", "rq->leaf_cfs_rq_list", "but", "this", "ordering", "is", "used", "to", "update", "and", "propagate", "the", "update", "from", "leaf", "down", "to", "root.\"", "Instead", "of", "trying", "to", "work", "through", "all", "these", "cases", "and", "trying", "to", "reproduce", "the", "very", "high", "loads", "that", "produced", "the", "lockup", "to", "begin", "with,", "simplify", "the", "code", "temporarily", "by", "reverting", "a9e7f6544b9c", "-", "which", "change", "was", "clearly", "not", "thought", "through", "completely.", "This", "(hopefully)", "gives", "us", "a", "kernel", "that", "doesn't", "lock", "up", "so", "people", "can", "continue", "to", "enjoy", "their", "holidays", "without", "worrying", "about", "regressions.", ";-)", "[", "mingo:", "Wrote", "changelog,", "fixed", "weird", "spelling", "in", "code", "comment", "while", "at", "it.", "]", "Analyzed-by:", "Xie", "XiuQi", "<xiexiuqi@huawei.com>", "Analyzed-by:", "Vincent", "Guittot", "<vincent.guittot@linaro.org>", "Reported-by:", "Zhipeng", "Xie", "<xiezhipeng1@huawei.com>", "Reported-by:", "Sargun", "Dhillon", "<sargun@sargun.me>", "Reported-by:", "Xie", "XiuQi", "<xiexiuqi@huawei.com>", "Tested-by:", "Zhipeng", "Xie", "<xiezhipeng1@huawei.com>", "Tested-by:", "Sargun", "Dhillon", "<sargun@sargun.me>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Acked-by:", "Vincent", "Guittot", "<vincent.guittot@linaro.org>", "Cc:", "<stable@vger.kernel.org>", "#", "v4.13+", "Cc:", "Bin", "Li", "<huawei.libin@huawei.com>", "Cc:", "Mike", "Galbraith", "<efault@gmx.de>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Tejun", "Heo", "<tj@kernel.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Fixes:", "a9e7f6544b9c", "(\"sched/fair:", "Fix", "O(nr_cgroups)", "in", "load", "balance", "path\")", "Link:", "http://lkml.kernel.org/r/1545879866-27809-1-git-send-email-xiexiuqi@huawei.com", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["/", "*", "Iterate", "through", "all", "leaf", "cfs_rq", "'", "s", "on", "a", "runqueue", ":", "*", "/", "#", "define", "for_each_leaf_cfs_rq", "(", "rq", ",", "cfs_rq", ")", "\\", "list_for_each_entry_rcu", "(", "cfs_rq", ",", "&", "rq", "-", ">", "leaf_cfs_rq_list", ",", "leaf_cfs_rq_list", ")", "#", "define", "for_each_leaf_cfs_rq", "(", "rq", ",", "cfs_rq", ")", "\\", "for", "(", "cfs_rq", "=", "&", "rq", "-", ">", "cfs", ";", "cfs_rq", ";", "cfs_rq", "=", "NULL", ")", "struct", "cfs_rq", "*", "cfs_rq", ";", "for_each_leaf_cfs_rq", "(", "rq", ",", "cfs_rq", ")", "{", "struct", "cfs_rq", "*", "cfs_rq", ";", "for_each_leaf_cfs_rq", "(", "cpu_rq", "(", "cpu", ")", ",", "cfs_rq", ")</s>/", "*", "Iterate", "thr", "'", "all", "leaf", "cfs_rq", "'", "s", "on", "a", "runqueue", "*", "/", "#", "define", "for_each_leaf_cfs_rq_safe", "(", "rq", ",", "cfs_rq", ",", "pos", ")", "\\", "list_for_each_entry_safe", "(", "cfs_rq", ",", "pos", ",", "&", "rq", "-", ">", "leaf_cfs_rq_list", ",", "\\", "leaf_cfs_rq_list", ")", "#", "define", "for_each_leaf_cfs_rq_safe", "(", "rq", ",", "cfs_rq", ",", "pos", ")", "\\", "for", "(", "cfs_rq", "=", "&", "rq", "-", ">", "cfs", ",", "pos", "=", "NULL", ";", "cfs_rq", ";", "cfs_rq", "=", "pos", ")", "static", "inline", "bool", "cfs_rq_is_decayed", "(", "struct", "cfs_rq", "*", "cfs_rq", ")", "{", "if", "(", "cfs_rq", "-", ">", "load", ".", "weight", ")", "return", "false", ";", "if", "(", "cfs_rq", "-", ">", "avg", ".", "load_sum", ")", "return", "false", ";", "if", "(", "cfs_rq", "-", ">", "avg", ".", "util_sum", ")", "return", "false", ";", "if", "(", "cfs_rq", "-", ">", "avg", ".", "runnable_load_sum", ")", "return", "false", ";", "return", "true", ";", "}", "struct", "cfs_rq", "*", "cfs_rq", ",", "*", "pos", ";", "for_each_leaf_cfs_rq_safe", "(", "rq", ",", "cfs_rq", ",", "pos", ")", "{", "/", "*", "*", "There", "can", "be", "a", "lot", "of", "idle", "CPU", "cgroups", ".", "Don", "'", "t", "let", "fully", "*", "decayed", "cfs_rqs", "linger", "on", "the", "list", ".", "*", "/", "if", "(", "cfs_rq_is_decayed", "(", "cfs_rq", ")", ")", "list_del_leaf_cfs_rq", "(", "cfs_rq", ")", ";", "struct", "cfs_rq", "*", "cfs_rq", ",", "*", "pos", ";", "for_each_leaf_cfs_rq_safe", "(", "cpu_rq", "(", "cpu", ")", ",", "cfs_rq", ",", "pos", ")"], "docstring_tokens": ["by", "inducing", "a", "high", "load", "."]}
{"contents": ["x86/mm:", "Add", "barriers", "and", "document", "switch_mm()-vs-flush", "synchronization", "When", "switch_mm()", "activates", "a", "new", "PGD,", "it", "also", "sets", "a", "bit", "that", "tells", "other", "CPUs", "that", "the", "PGD", "is", "in", "use", "so", "that", "TLB", "flush", "IPIs", "will", "be", "sent.", "In", "order", "for", "that", "to", "work", "correctly,", "the", "bit", "needs", "to", "be", "visible", "prior", "to", "loading", "the", "PGD", "and", "therefore", "starting", "to", "fill", "the", "local", "TLB.", "Document", "all", "the", "barriers", "that", "make", "this", "work", "correctly", "and", "add", "a", "couple", "that", "were", "missing.", "Signed-off-by:", "Andy", "Lutomirski", "<luto@kernel.org>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Borislav", "Petkov", "<bp@alien8.de>", "Cc:", "Brian", "Gerst", "<brgerst@gmail.com>", "Cc:", "Dave", "Hansen", "<dave.hansen@linux.intel.com>", "Cc:", "Denys", "Vlasenko", "<dvlasenk@redhat.com>", "Cc:", "H.", "Peter", "Anvin", "<hpa@zytor.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "linux-mm@kvack.org", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["/", "*", "*", "Re", "-", "load", "page", "tables", ".", "*", "*", "This", "logic", "has", "an", "ordering", "constraint", ":", "*", "*", "CPU", "0", ":", "Write", "to", "a", "PTE", "for", "'", "next", "'", "*", "CPU", "0", ":", "load", "bit", "1", "in", "mm_cpumask", ".", "if", "nonzero", ",", "send", "IPI", ".", "*", "CPU", "1", ":", "set", "bit", "1", "in", "next", "'", "s", "mm_cpumask", "*", "CPU", "1", ":", "load", "from", "the", "PTE", "that", "CPU", "0", "writes", "(", "implicit", ")", "*", "*", "We", "need", "to", "prevent", "an", "outcome", "in", "which", "CPU", "1", "observes", "*", "the", "new", "PTE", "value", "and", "CPU", "0", "observes", "bit", "1", "clear", "in", "*", "mm_cpumask", ".", "(", "If", "that", "occurs", ",", "then", "the", "IPI", "will", "never", "*", "be", "sent", ",", "and", "CPU", "0", "'", "s", "TLB", "will", "contain", "a", "stale", "entry", ".", ")", "*", "*", "The", "bad", "outcome", "can", "occur", "if", "either", "CPU", "'", "s", "load", "is", "*", "reordered", "before", "that", "CPU", "'", "s", "store", ",", "so", "both", "CPUs", "much", "*", "execute", "full", "barriers", "to", "prevent", "this", "from", "happening", ".", "*", "*", "Thus", ",", "switch_mm", "needs", "a", "full", "barrier", "between", "the", "*", "store", "to", "mm_cpumask", "and", "any", "operation", "that", "could", "load", "*", "from", "next", "-", ">", "pgd", ".", "This", "barrier", "synchronizes", "with", "*", "remote", "TLB", "flushers", ".", "Fortunately", ",", "load_cr3", "is", "*", "serializing", "and", "thus", "acts", "as", "a", "full", "barrier", ".", "*", "*", "/", "*", "*", "As", "above", ",", "this", "is", "a", "barrier", "that", "forces", "*", "TLB", "repopulation", "to", "be", "ordered", "after", "the", "*", "store", "to", "mm_cpumask", ".", "/", "*", "This", "is", "an", "implicit", "full", "barrier", "that", "synchronizes", "with", "switch_mm", ".", "*", "/", "if", "(", "current", "-", ">", "active_mm", "!", "=", "mm", ")", "{", "/", "*", "Synchronize", "with", "switch_mm", ".", "*", "/", "smp_mb", "(", ");", "}", "/", "*", "Synchronize", "with", "switch_mm", ".", "*", "/", "smp_mb", "(", ");", "/", "*", "*", "Both", "branches", "below", "are", "implicit", "full", "barriers", "(", "MOV", "to", "CR", "or", "*", "INVLPG", ")", "that", "synchronize", "with", "switch_mm", ".", "*", "/", "if", "(", "current", "-", ">", "mm", ")", "{", "/", "*", "*", "Implicit", "full", "barrier", "(", "INVLPG", ")", "that", "synchronizes", "*", "with", "switch_mm", ".", "*", "/", "}", "else", "{", "/", "*", "Synchronize", "with", "switch_mm", ".", "*", "/", "smp_mb", "(", ");", "}</s>/", "*", "Re", "-", "load", "page", "tables", "*", "/", "if", "(", "current", "-", ">", "active_mm", "!", "=", "mm", ")", "if", "(", "current", "-", ">", "mm", ")", "else"], "docstring_tokens": ["finding", "a", "code", "path", "that", "unmaps", "a", "page"]}
{"contents": ["[CIFS]", "Don't", "allow", "a", "backslash", "in", "a", "path", "component", "Unless", "Posix", "paths", "have", "been", "negotiated,", "the", "backslash,", "\"\\\",", "is", "not", "a", "valid", "character", "in", "a", "path", "component.", "Signed-off-by:", "Dave", "Kleikamp", "<shaggy@austin.ibm.com>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["/", "*", "*", "Don", "'", "t", "allow", "the", "separator", "character", "in", "a", "path", "component", ".", "*", "The", "VFS", "will", "not", "allow", "\"", "/\"", ",", "but", "\"", "\\\"", "is", "allowed", "by", "posix", ".", "*", "/", "if", "(", "!(", "cifs_sb", "-", ">", "mnt_cifs_flags", "&", "CIFS_MOUNT_POSIX_PATHS", ")", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "direntry", "-", ">", "d_name", ".", "len", ";", "i", "+", "+)", "if", "(", "direntry", "-", ">", "d_name", ".", "name", "[", "i", "]", "=", "=", "'", "\\\\", "')", "{", "cFYI", "(", "1", ",", "(", "\"", "Invalid", "file", "name", "\"", "))", ";", "FreeXid", "(", "xid", ")", ";", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "}", "}</s>"], "docstring_tokens": ["via", "\"..\\\\\"", "sequences"]}
{"contents": ["Fix", "potential", "FSImage", "corruption.", "Contributed", "by", "Ekanth", "Sethuramalingam", "&", "Arpit", "Agarwal.", "(cherry", "picked", "from", "commit", "0a1e922f3d8eca4e852be57124ec1bcafaadb289)"], "code_tokens": ["*", "[", "7", ":", "8", ")", "-", "-", "Reserved", "<", "br", ">", "*", "[", "8", ":", "32", ")", "-", "-", "the", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "<", "br", ">", "RESERVED", "(", "NAMED_ENTRY_CHECK", ".", "BITS", ",", "1", ")", ",", "NAME", "(", "RESERVED", ".", "BITS", ",", "24", ")", ";", "GROUP", "(", "MODE", ".", "BITS", ",", "24", ")", ",", "USER", "(", "GROUP", ".", "BITS", ",", "24", ")", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "util", ".", "LongBitFormat", ";", "*", "[", "3", ":", "8", ")", "-", "Reserved", "<", "br", ">", "*", "[", "8", ":", "32", ")", "-", "The", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "private", "enum", "XAttrStatusFormat", "{", "NAMESPACE", "(", "null", ",", "3", ")", ",", "RESERVED", "(", "NAMESPACE", ".", "BITS", ",", "5", ")", ",", "NAME", "(", "RESERVED", ".", "BITS", ",", "24", ")", ";", "private", "final", "LongBitFormat", "BITS", ";", "XAttrStatusFormat", "(", "LongBitFormat", "previous", ",", "int", "length", ")", "{", "BITS", "=", "new", "LongBitFormat", "(", "name", "(", "),", "previous", ",", "length", ",", "0", ")", ";", "}", "static", "XAttr", ".", "NameSpace", "getNamespace", "(", "int", "xattrStatus", ")", "{", "int", "ordinal", "=", "(", "int", ")", "NAMESPACE", ".", "BITS", ".", "retrieve", "(", "xattrStatus", ")", ";", "return", "XAttr", ".", "NameSpace", ".", "values", "(", ")[", "ordinal", "]", ";", "}", "static", "String", "getName", "(", "int", "xattrStatus", ")", "{", "int", "id", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "xattrStatus", ")", ";", "return", "XAttrStorage", ".", "getName", "(", "id", ")", ";", "}", "static", "int", "toInt", "(", "XAttr", ".", "NameSpace", "namespace", ",", "String", "name", ")", "{", "long", "xattrStatusInt", "=", "0", ";", "xattrStatusInt", "=", "NAMESPACE", ".", "BITS", ".", "combine", "(", "namespace", ".", "ordinal", "(", "),", "xattrStatusInt", ")", ";", "int", "nid", "=", "XAttrStorage", ".", "getNameSerialNumber", "(", "name", ")", ";", "xattrStatusInt", "=", "NAME", ".", "BITS", ".", "combine", "(", "nid", ",", "xattrStatusInt", ")", ";", "return", "(", "int", ")", "xattrStatusInt", ";", "}", "}", "builder", ".", "setNameSpace", "(", "XAttrStatusFormat", ".", "getNamespace", "(", "v", ")", ");", "builder", ".", "setName", "(", "XAttrStatusFormat", ".", "getName", "(", "v", ")", ");", "XAttr", ".", "NameSpace", "namespace", "=", "XAttrStatusFormat", ".", "getNamespace", "(", "v", ")", ";", "String", "name", "=", "XAttrStatusFormat", ".", "getName", "(", "v", ")", ";", "int", "v", "=", "XAttrStatusFormat", ".", "toInt", "(", "a", ".", "getNameSpace", "(", "),", "a", ".", "getName", "(", "))", ";</s>*", "[", "7", ":", "32", ")", "-", "-", "the", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "<", "br", ">", "NAME", "(", "NAMED_ENTRY_CHECK", ".", "BITS", ",", "25", ")", ";", "GROUP", "(", "MODE", ".", "BITS", ",", "25", ")", ",", "USER", "(", "GROUP", ".", "BITS", ",", "23", ")", ";", "*", "[", "3", ":", "32", ")", "-", "The", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "private", "static", "final", "int", "XATTR_NAMESPACE_MASK", "=", "(", "1", "<", "<", "3", ")", "-", "1", ";", "private", "static", "final", "int", "XATTR_NAMESPACE_OFFSET", "=", "29", ";", "private", "static", "final", "int", "XATTR_NAME_MASK", "=", "(", "1", "<", "<", "29", ")", "-", "1", ";", "private", "static", "final", "int", "XATTR_NAME_ID_MAX", "=", "1", "<", "<", "29", ";", "private", "static", "final", "XAttr", ".", "NameSpace", "[", "]", "XATTR_NAMESPACE_VALUES", "=", "XAttr", ".", "NameSpace", ".", "values", "(", ");", "int", "ns", "=", "(", "v", ">", ">", "XATTR_NAMESPACE_OFFSET", ")", "&", "XATTR_NAMESPACE_MASK", ";", "int", "nid", "=", "v", "&", "XATTR_NAME_MASK", ";", "builder", ".", "setNameSpace", "(", "XATTR_NAMESPACE_VALUES", "[", "ns", "]", ");", "builder", ".", "setName", "(", "XAttrStorage", ".", "getName", "(", "nid", ")", ");", "int", "ns", "=", "(", "v", ">", ">", "XATTR_NAMESPACE_OFFSET", ")", "&", "XATTR_NAMESPACE_MASK", ";", "int", "nid", "=", "v", "&", "XATTR_NAME_MASK", ";", "XAttr", ".", "NameSpace", "namespace", "=", "XATTR_NAMESPACE_VALUES", "[", "ns", "]", ";", "String", "name", "=", "XAttrStorage", ".", "getName", "(", "nid", ")", ";", "int", "nsOrd", "=", "a", ".", "getNameSpace", "(", ").", "ordinal", "(", ");", "Preconditions", ".", "checkArgument", "(", "nsOrd", "<", "8", ",", "\"", "Too", "many", "namespaces", ".", "\")", ";", "int", "nid", "=", "XAttrStorage", ".", "getNameSerialNumber", "(", "a", ".", "getName", "(", "))", ";", "Preconditions", ".", "checkArgument", "(", "nid", "<", "XATTR_NAME_ID_MAX", ",", "\"", "Too", "large", "serial", "number", "of", "the", "xattr", "name", "\"", ");", "/", "/", "big", "-", "endian", "int", "v", "=", "(", "(", "nsOrd", "&", "XATTR_NAMESPACE_MASK", ")", "<", "<", "XATTR_NAMESPACE_OFFSET", ")", "|", "(", "nid", "&", "XATTR_NAME_MASK", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["KVM:", "emulate:", "avoid", "accessing", "NULL", "ctxt->memopp", "A", "failure", "to", "decode", "the", "instruction", "can", "cause", "a", "NULL", "pointer", "access.", "This", "is", "fixed", "simply", "by", "moving", "the", "\"done\"", "label", "as", "close", "as", "possible", "to", "the", "return.", "This", "fixes", ".", "Reported-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "stable@vger.kernel.org", "Fixes:", "41061cdb98a0bec464278b4db8e894a3121671f5", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["done", ":</s>done", ":"], "docstring_tokens": ["forcing", "the", "host", "to", "emulate", "certain", "well-formed", "RIP-relative", "instructions", "or", "certain", "types", "of", "corrupt", "or", "page-straddling", "instructions"]}
{"contents": ["Only", "allow", "ephemeral", "RSA", "keys", "in", "export", "ciphersuites.", "OpenSSL", "clients", "would", "tolerate", "temporary", "RSA", "keys", "in", "non-export", "ciphersuites.", "It", "also", "had", "an", "option", "SSL_OP_EPHEMERAL_RSA", "which", "enabled", "this", "server", "side.", "Remove", "both", "options", "as", "they", "are", "a", "protocol", "violation.", "Thanks", "to", "Karthikeyan", "Bhargavan", "for", "reporting", "this", "issue.", "(", ")", "Reviewed-by:", "Matt", "Caswell", "<matt@openssl.org>"], "code_tokens": ["*", ")", "Remove", "non", "-", "export", "ephemeral", "RSA", "code", "on", "client", "and", "server", ".", "This", "code", "violated", "the", "TLS", "standard", "by", "allowing", "the", "use", "of", "temporary", "RSA", "keys", "in", "non", "-", "export", "ciphersuites", "and", "could", "be", "used", "by", "a", "server", "to", "effectively", "downgrade", "the", "RSA", "key", "length", "used", "to", "a", "value", "smaller", "than", "the", "server", "certificate", ".", "Thanks", "for", "Karthikeyan", "Bhargavan", "for", "reporting", "this", "issue", ".", "(", "CVE", "-", "2015", "-", "0204", ")", "[", "Steve", "Henson", "]", "This", "option", "is", "no", "longer", "implemented", "and", "is", "treated", "as", "no", "op", ".", "An", "application", "may", "either", "directly", "specify", "the", "key", "or", "can", "supply", "the", "key", "via", "a", "callback", "function", ".", "The", "callback", "approach", "has", "the", "advantage", ",", "that", "the", "callback", "may", "generate", "the", "key", "only", "in", "case", "it", "is", "actually", "needed", ".", "As", "the", "generation", "of", "a", "RSA", "key", "is", "however", "costly", ",", "it", "will", "lead", "to", "a", "significant", "delay", "in", "the", "handshake", "procedure", ".", "Another", "advantage", "of", "the", "callback", "function", "is", "that", "it", "can", "supply", "keys", "of", "different", "size", "while", "the", "explicit", "setting", "of", "the", "key", "is", "only", "useful", "for", "key", "size", "of", "512", "bits", "to", "satisfy", "the", "export", "restricted", "ciphers", "and", "does", "give", "away", "key", "length", "if", "a", "longer", "key", "would", "be", "allowed", ".", "/", "*", "*", "clear", "this", ",", "it", "may", "get", "reset", "by", "*", "send_server_key_exchange", "*", "/", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "=", "0", ";", "if", "(", "/", "*", "Temporary", "RSA", "keys", "only", "allowed", "in", "export", "ciphersuites", "*", "/", "if", "(", "!", "SSL_C_IS_EXPORT", "(", "s", "-", ">", "s3", "-", ">", "tmp", ".", "new_cipher", ")", ")", "{", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "SSLerr", "(", "SSL_F_SSL3_GET_SERVER_CERTIFICATE", ",", "SSL_R_UNEXPECTED_MESSAGE", ")", ";", "goto", "f_err", ";", "}", "/", "*", "*", "clear", "this", ",", "it", "may", "get", "reset", "by", "*", "send_server_key_exchange", "*", "/", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "=", "0", ";", "if", "(", "/", "*", "Does", "nothing", ":", "retained", "for", "compatibiity", "*", "/", "#", "define", "SSL_OP_EPHEMERAL_RSA", "0x0</s>Always", "use", "ephemeral", "(", "temporary", ")", "RSA", "key", "when", "doing", "RSA", "operations", "(", "see", "L", "<", "SSL_CTX_set_tmp_rsa_callback", "(", "3", ")", "|", "SSL_CTX_set_tmp_rsa_callback", "(", "3", ")", ">)", ".", "According", "to", "the", "specifications", "this", "is", "only", "done", ",", "when", "a", "RSA", "key", "can", "only", "be", "used", "for", "signature", "operations", "(", "namely", "under", "export", "ciphers", "with", "restricted", "RSA", "keylength", ")", ".", "By", "setting", "this", "option", ",", "ephemeral", "RSA", "keys", "are", "always", "used", ".", "This", "option", "breaks", "compatibility", "with", "the", "SSL", "/", "TLS", "specifications", "and", "may", "lead", "to", "interoperability", "problems", "with", "clients", "and", "should", "therefore", "never", "be", "used", ".", "Ciphers", "with", "DHE", "(", "ephemeral", "Diffie", "-", "Hellman", ")", "key", "exchange", "should", "be", "used", "instead", ".", "On", "OpenSSL", "servers", "ephemeral", "RSA", "key", "exchange", "is", "therefore", "disabled", "by", "default", "and", "must", "be", "explicitly", "enabled", "using", "the", "SSL_OP_EPHEMERAL_RSA", "option", "of", "L", "<", "SSL_CTX_set_options", "(", "3", ")", "|", "SSL_CTX_set_options", "(", "3", ")", ">,", "violating", "the", "TLS", "/", "SSL", "standard", ".", "When", "ephemeral", "RSA", "key", "exchange", "is", "required", "for", "export", "ciphers", ",", "it", "will", "automatically", "be", "used", "without", "this", "option", "!", "An", "application", "may", "either", "directly", "specify", "the", "key", "or", "can", "supply", "the", "key", "via", "a", "callback", "function", ".", "The", "callback", "approach", "has", "the", "advantage", ",", "that", "the", "callback", "may", "generate", "the", "key", "only", "in", "case", "it", "is", "actually", "needed", ".", "As", "the", "generation", "of", "a", "RSA", "key", "is", "however", "costly", ",", "it", "will", "lead", "to", "a", "significant", "delay", "in", "the", "handshake", "procedure", ".", "Another", "advantage", "of", "the", "callback", "function", "is", "that", "it", "can", "supply", "keys", "of", "different", "size", "(", "e", ".", "g", ".", "for", "SSL_OP_EPHEMERAL_RSA", "usage", ")", "while", "the", "explicit", "setting", "of", "the", "key", "is", "only", "useful", "for", "key", "size", "of", "512", "bits", "to", "satisfy", "the", "export", "restricted", "ciphers", "and", "does", "give", "away", "key", "length", "if", "a", "longer", "key", "would", "be", "allowed", ".", "/", "*", "clear", "this", ",", "it", "may", "get", "reset", "by", "*", "send_server_key_exchange", "*", "/", "if", "(", "(", "s", "-", ">", "options", "&", "SSL_OP_EPHEMERAL_RSA", ")", "#", "ifndef", "OPENSSL_NO_KRB5", "&", "&", "!", "(", "alg_k", "&", "SSL_kKRB5", ")", "#", "endif", "/", "*", "OPENSSL_NO_KRB5", "*", "/", ")", "/", "*", "option", "SSL_OP_EPHEMERAL_RSA", "sends", "temporary", "RSA", "key", "*", "even", "when", "forbidden", "by", "protocol", "specs", "*", "(", "handshake", "may", "fail", "as", "clients", "are", "not", "required", "to", "*", "be", "able", "to", "handle", "this", ")", "*", "/", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "=", "1", ";", "else", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "=", "0", ";", "if", "(", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "/", "*", "clear", "this", ",", "it", "may", "get", "reset", "by", "*", "send_server_key_exchange", "*", "/", "if", "(", "(", "s", "-", ">", "options", "&", "SSL_OP_EPHEMERAL_RSA", ")", "#", "ifndef", "OPENSSL_NO_KRB5", "&", "&", "!", "(", "alg_k", "&", "SSL_kKRB5", ")", "#", "endif", "/", "*", "OPENSSL_NO_KRB5", "*", "/", ")", "/", "*", "option", "SSL_OP_EPHEMERAL_RSA", "sends", "temporary", "RSA", "key", "*", "even", "when", "forbidden", "by", "protocol", "specs", "*", "(", "handshake", "may", "fail", "as", "clients", "are", "not", "required", "to", "*", "be", "able", "to", "handle", "this", ")", "*", "/", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "=", "1", ";", "else", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "=", "0", ";", "if", "(", "s", "-", ">", "s3", "-", ">", "tmp", ".", "use_rsa_tmp", "/", "*", "Set", "to", "always", "use", "the", "tmp_rsa", "key", "when", "doing", "RSA", "operations", ",", "*", "even", "when", "this", "violates", "protocol", "specs", "*", "/", "#", "define", "SSL_OP_EPHEMERAL_RSA", "0x00200000L"], "docstring_tokens": ["using", "man-in-the-middle", "techniques"]}
{"contents": ["Patch", "Exchange", "Autodiscover", "Code", "for", "Security", "Issue", "The", "change", "removes", "the", "unauthenticated", "GET", "fallback", "attempt", "for", "the", "Autodiscover", "process.", "Given", "that", "the", "Autodiscover", "code", "is", "functionally", "broken", "and", "this", "fallback", "attempt", "wouldn't", "succeed", "unless", "an", "attacker", "faked", "a", "success", "response,", "a", "good", "way", "to", "patch", "the", "security", "issue", "is", "to", "disable", "the", "attempt.", "The", "change", "also", "updates", "the", "request", "content", "type,", "disables", "automatic", "redirects,", "and", "allows", "for", "parsing", "namespaces", "to", "help", "the", "first", "two", "attempts", "succeed.", "As", "this", "is", "not", "meant", "to", "be", "a", "functional", "patch", "but", "a", "security", "patch,", "there", "are", "no", "further", "changes", "to", "the", "Autodiscover", "code.", "BUG:", "26488455", "Change-Id:", "I0fc93c95e755c8fa60e94da5bec4b3b4c49cdfc1"], "code_tokens": ["/", "**", "*", "Returns", "the", "redirect", "address", "from", "this", "response", "in", "{", "@", "link", "Uri", "}", "form", "or", "{", "@", "code", "null", "}", "if", "the", "*", "location", "field", "is", "missing", "from", "the", "header", ".", "*", "/", "public", "Uri", "getRedirectUri", "(", ")", "{", "final", "Header", "locHeader", "=", "getHeader", "(", "\"", "Location", "\"", ");", "return", "locHeader", "!", "=", "null", "?", "Uri", ".", "parse", "(", "locHeader", ".", "getValue", "(", "))", ":", "null", ";", "}", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "params", ".", "HttpClientParams", ";", "public", "final", "static", "int", "ATTEMPT_MAX", "=", "1", ";", "private", "static", "final", "String", "AUTODISCOVER_CONTENT_TYPE", "=", "\"", "text", "/", "xml", "\"", ";", "private", "static", "final", "String", "HTTPS_SCHEME", "=", "\"", "https", "\"", ";", "/", "**", "Returns", "the", "content", "type", "of", "Autodiscover", "requests", ".", "*", "/", "@", "Override", "protected", "String", "getRequestContentType", "(", ")", "{", "return", "AUTODISCOVER_CONTENT_TYPE", ";", "}", "final", "HttpUriRequest", "req", "=", "mConnection", ".", "makePost", "(", "requestUri", ",", "getRequestEntity", "(", "),", "getRequestContentType", "(", "),", "addPolicyKeyHeaderToRequest", "(", "))", ";", "/", "/", "Disable", "auto", "-", "redirecting", "for", "this", "request", ".", "HttpClientParams", ".", "setRedirecting", "(", "req", ".", "getParams", "(", "),", "false", ")", ";", "final", "Uri", "loc", "=", "response", ".", "getRedirectUri", "(", ");", "if", "(", "loc", "!", "=", "null", "&", "&", "HTTPS_SCHEME", ".", "equalsIgnoreCase", "(", "loc", ".", "getScheme", "(", "))", ")", "{", "mRedirectUri", "=", "loc", ".", "toString", "(", ");", "LogUtils", ".", "d", "(", "TAG", ",", "\"", "Posting", "autodiscover", "to", "redirect", ":", "\"", "+", "mRedirectUri", ")", ";", "final", "XmlPullParserFactory", "parserFactory", "=", "XmlPullParserFactory", ".", "newInstance", "(", ");", "/", "/", "Calling", "setNamespaceAware", "(", "true", ")", "will", "enable", "parsing", "the", "autodiscover", "namespace", "tag", ".", "parserFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "final", "XmlPullParser", "parser", "=", "parserFactory", ".", "newPullParser", "(", ");</s>}", "public", "final", "static", "int", "ATTEMPT_UNAUTHENTICATED_GET", "=", "2", ";", "public", "final", "static", "int", "ATTEMPT_MAX", "=", "2", ";", "case", "ATTEMPT_UNAUTHENTICATED_GET", ":", "return", "\"", "http", ":", "//", "autodiscover", ".", "\"", "+", "domain", "+", "AUTO_DISCOVER_PAGE", ";", "HttpUriRequest", "req", ";", "if", "(", "mAttemptNumber", "=", "=", "ATTEMPT_UNAUTHENTICATED_GET", ")", "{", "req", "=", "mConnection", ".", "makeGet", "(", "requestUri", ")", ";", "}", "else", "{", "req", "=", "mConnection", ".", "makePost", "(", "requestUri", ",", "getRequestEntity", "(", "),", "getRequestContentType", "(", "),", "addPolicyKeyHeaderToRequest", "(", "))", ";", "}", "final", "String", "loc", "=", "response", ".", "getRedirectAddress", "(", ");", "if", "(", "loc", "!", "=", "null", "&", "&", "loc", ".", "startsWith", "(", "\"", "http", "\"", "))", "{", "LogUtils", ".", "d", "(", "TAG", ",", "\"", "Posting", "autodiscover", "to", "redirect", ":", "\"", "+", "loc", ")", ";", "mRedirectUri", "=", "loc", ";", "final", "XmlPullParser", "parser", "=", "XmlPullParserFactory", ".", "newInstance", "(", ").", "newPullParser", "(", ");"], "docstring_tokens": ["persuading", "a", "victim", "to", "install", "a", "specially-crafted", "application"]}
{"contents": ["IB/uverbs:", "Prevent", "integer", "overflow", "in", "ib_umem_get", "address", "arithmetic", "Properly", "verify", "that", "the", "resulting", "page", "aligned", "end", "address", "is", "larger", "than", "both", "the", "start", "address", "and", "the", "length", "of", "the", "memory", "area", "requested.", "Both", "the", "start", "and", "length", "arguments", "for", "ib_umem_get", "are", "controlled", "by", "the", "user.", "A", "misbehaving", "user", "can", "provide", "values", "which", "will", "cause", "an", "integer", "overflow", "when", "calculating", "the", "page", "aligned", "end", "address.", "This", "overflow", "can", "cause", "also", "miscalculation", "of", "the", "number", "of", "pages", "mapped,", "and", "additional", "logic", "issues.", "Addresses:", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Shachar", "Raindel", "<raindel@mellanox.com>", "Signed-off-by:", "Jack", "Morgenstein", "<jackm@mellanox.com>", "Signed-off-by:", "Or", "Gerlitz", "<ogerlitz@mellanox.com>", "Signed-off-by:", "Roland", "Dreier", "<roland@purestorage.com>"], "code_tokens": ["/", "*", "*", "If", "the", "combination", "of", "the", "addr", "and", "size", "requested", "for", "this", "memory", "*", "region", "causes", "an", "integer", "overflow", ",", "return", "error", ".", "*", "/", "if", "(", "(", "PAGE_ALIGN", "(", "addr", "+", "size", ")", "<", "=", "size", ")", "|", "|", "(", "PAGE_ALIGN", "(", "addr", "+", "size", ")", "<", "=", "addr", ")", ")", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";</s>"], "docstring_tokens": ["using", "memory", "windows"]}
{"contents": ["PROTON-1157:", "fail", "if", "amqps:", "scheme", "is", "specified", "but", "SSL", "is", "not", "available"], "code_tokens": ["if", "url", ".", "scheme", "=", "=", "'", "amqps", "'", ":", "if", "not", "self", ".", "ssl_domain", ":", "raise", "SSLUnavailable", "(", "\"", "amqps", ":", "SSL", "libraries", "not", "found", "\"", ")", "#", "use", "container", "'", "s", "default", "client", "domain", "if", "none", "specified", ".", "This", "is", "#", "only", "necessary", "of", "the", "URL", "specifies", "the", "\"", "amqps", ":", "\"", "scheme", "if", "not", "ssl_config", "and", "url", ".", "scheme", "=", "=", "'", "amqps", "'", ":", "#", "use", "container", "'", "s", "default", "server", "domain", "if", "self", ".", "ssl", ":", "ssl_config", "=", "self", ".", "ssl", ".", "server", "else", ":", "raise", "SSLUnavailable", "(", "\"", "amqps", ":", "SSL", "libraries", "not", "found", "\"", ")</s>if", "url", ".", "scheme", "=", "=", "'", "amqps", "'", "and", "self", ".", "ssl_domain", ":", "if", "not", "ssl_config", "and", "url", ".", "scheme", "=", "=", "'", "amqps", "'", "and", "self", ".", "ssl", ":", "ssl_config", "=", "self", ".", "ssl", ".", "server"], "docstring_tokens": ["using", "man-in-the-middle", "techniques"]}
{"contents": ["avcodec/dfa:", "Fix", "off", "by", "1", "error", "Fixes", "out", "of", "array", "access", "Fixes:", "1345/clusterfuzz-testcase-minimized-6062963045695488", "Found-by:", "continuous", "fuzzing", "process", "https://github.com/google/oss-fuzz/tree/master/targets/ffmpeg", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["if", "(", "frame_end", "-", "frame", "<", "width", "+", "4", ")</s>if", "(", "frame_end", "-", "frame", "<", "width", "+", "3", ")"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["Fix", "bug", "in", ":", "check", "we", "have", "really", "received", "a", "client", "hello", "before", "rejecting", "multiple", "SGC", "restarts."], "code_tokens": ["Changes", "between", "1", ".", "0", ".", "0g", "and", "1", ".", "0", ".", "0h", "[", "xx", "XXX", "xxxx", "]", "*", ")", "Fix", "CVE", "-", "2011", "-", "4619", ":", "make", "sure", "we", "really", "are", "receiving", "a", "client", "hello", "before", "rejecting", "multiple", "SGC", "restarts", ".", "Thanks", "to", "Ivan", "Nestlerode", "<", "inestlerode", "@", "us", ".", "ibm", ".", "com", ">", "for", "discovering", "this", "bug", ".", "[", "Steve", "Henson", "]", "/", "*", "We", "only", "allow", "the", "client", "to", "restart", "the", "handshake", "once", "per", "*", "negotiation", ".", "*", "/", "if", "(", "s", "-", ">", "s3", "-", ">", "flags", "&", "SSL3_FLAGS_SGC_RESTART_DONE", ")", "{", "SSLerr", "(", "SSL_F_SSL3_CHECK_CLIENT_HELLO", ",", "SSL_R_MULTIPLE_SGC_RESTARTS", ")", ";", "return", "-", "1", ";", "}</s>/", "*", "We", "only", "allow", "the", "client", "to", "restart", "the", "handshake", "once", "per", "*", "negotiation", ".", "*", "/", "if", "(", "s", "-", ">", "s3", "-", ">", "flags", "&", "SSL3_FLAGS_SGC_RESTART_DONE", ")", "{", "SSLerr", "(", "SSL_F_SSL3_CHECK_CLIENT_HELLO", ",", "SSL_R_MULTIPLE_SGC_RESTARTS", ")", ";", "return", "-", "1", ";", "}"], "docstring_tokens": ["via", "unspecified", "vectors", "."]}
{"contents": ["fix", "#72494,", "improve", "input", "color", "check", "and", "prevent", "issues", "when", "old", "gd", "are", "used,", "done", "before", "gd", "call"], "code_tokens": ["if", "(", "color", "<", "0", "|", "|", "(", "!", "gdImageTrueColor", "(", "im", ")", "&", "&", "color", ">", "=", "gdImageColorsTotal", "(", "im", ")", "))", "{</s>if", "(", "color", "<", "0", ")", "{"], "docstring_tokens": ["using", "a", "malformed", "color", "index"]}
{"contents": ["SOLR-11971:", "Don't", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler's", "dataConfig", "request", "parameter"], "code_tokens": ["Bug", "Fixes", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "*", "SOLR", "-", "11971", ":", "Don", "'", "t", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler", "'", "s", "dataConfig", "request", "parameter", ".", "(", "\u9ea6", "\u9999", "\u6d53\u90c1", ",", "Uwe", "Schindler", ")", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "EmptyEntityResolver", ";", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "dbf", ".", "setValidating", "(", "false", ")", ";", "/", "/", "only", "enable", "xinclude", ",", "if", "XML", "is", "coming", "from", "safe", "source", "(", "local", "file", ")", "/", "/", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", ":", "/", "/", "only", "enable", "xinclude", "/", "external", "entities", ",", "if", "XML", "is", "coming", "from", "/", "/", "safe", "source", "(", "local", "file", ")", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", ":", "if", "(", "core", "!", "=", "null", "&", "&", "configFile", ".", "getSystemId", "(", ")", "!", "=", "null", ")", "{", "}", "else", "{", "/", "/", "Don", "'", "t", "allow", "external", "entities", "without", "having", "a", "system", "ID", ":", "builder", ".", "setEntityResolver", "(", "EmptyEntityResolver", ".", "SAX_INSTANCE", ")", ";", "}", "public", "void", "testExternalEntity", "(", ")", "throws", "Exception", "{", "StringDataSource", ".", "xml", "=", "wellformedXml", ";", "/", "/", "This", "should", "not", "fail", "as", "external", "entities", "are", "replaced", "by", "an", "empty", "string", "during", "parsing", ":", "runFullImport", "(", "dataConfigWithEntity", ")", ";", "assertQ", "(", "req", "(", "\"*", ":*", "\")", ",", "\"", "//", "*[", "@", "numFound", "=", "'", "3", "'", "]\"", ");", "}", "private", "String", "dataConfigWithEntity", "=", "\"", "<!", "DOCTYPE", "dataConfig", "[", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "internalTerm", "\\", "\"", "node", "\\", "\">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "<", "dataConfig", ">", "\\", "n", "\"", "\"", "<", "dataSource", "name", "=", "\\\"", "str", "\\", "\"", "type", "=", "\\\"", "TestErrorHandling", "$", "StringDataSource", "\\", "\"", "/", ">\"", "\"", "<", "document", ">", "\\", "n", "\"", "\"", "<", "entity", "name", "=", "\\\"", "&", "internalTerm", ";", "\\\"", "dataSource", "=", "\\\"", "str", "\\", "\"", "processor", "=", "\\\"", "XPathEntityProcessor", "\\", "\"", "url", "=", "\\\"", "test", "\\", "\"", "forEach", "=", "\\\"", "/", "root", "/", "node", "\\", "\"", "onError", "=", "\\\"", "skip", "\\", "\">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "id", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "id", "\\", "\">", "&", "externalTerm", ";", "</", "field", ">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "desc", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "desc", "\\", "\"", "/", ">\\", "n", "\"", "\"", "<", "/", "entity", ">", "\\", "n", "\"", "\"", "<", "/", "document", ">", "\\", "n", "\"", "\"", "</", "dataConfig", ">", "\";</s>(", "No", "Changes", ")", "public", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "public", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "/", "/", "only", "enable", "xinclude", ",", "if", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", "if", "(", "core", "!", "=", "null", ")"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["xen-netback:", "fix", "input", "validation", "in", "xenvif_set_hash_mapping()", "Both", "len", "and", "off", "are", "frontend", "specified", "values,", "so", "we", "need", "to", "make", "sure", "there's", "no", "overflow", "when", "adding", "the", "two", "for", "the", "bounds", "check.", "We", "also", "want", "to", "avoid", "undefined", "behavior", "and", "hence", "use", "off", "to", "index", "into", "->hash.mapping[]", "only", "after", "bounds", "checking.", "This", "at", "the", "same", "time", "allows", "to", "take", "care", "of", "not", "applying", "off", "twice", "for", "the", "bounds", "checking", "against", "vif->num_queues.", "It", "is", "also", "insufficient", "to", "bounds", "check", "copy_op.len,", "as", "this", "is", "len", "truncated", "to", "16", "bits.", "This", "is", "XSA-270", "/", ".", "Reported-by:", "Felix", "Wilhelm", "<fwilhelm@google.com>", "Signed-off-by:", "Jan", "Beulich", "<jbeulich@suse.com>", "Reviewed-by:", "Paul", "Durrant", "<paul.durrant@citrix.com>", "Tested-by:", "Paul", "Durrant", "<paul.durrant@citrix.com>", "Cc:", "stable@vger.kernel.org", "[4.7", "onwards]", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["u32", "*", "mapping", "=", "vif", "-", ">", "hash", ".", "mapping", ";", ".", "len", "=", "len", "*", "sizeof", "(", "*", "mapping", ")", ",", "if", "(", "(", "off", "+", "len", "<", "off", ")", "|", "|", "(", "off", "+", "len", ">", "vif", "-", ">", "hash", ".", "size", ")", "|", "|", "len", ">", "XEN_PAGE_SIZE", "/", "sizeof", "(", "*", "mapping", ")", ")", "copy_op", ".", "dest", ".", "u", ".", "gmfn", "=", "virt_to_gfn", "(", "mapping", "+", "off", ")", ";", "copy_op", ".", "dest", ".", "offset", "=", "xen_offset_in_page", "(", "mapping", "+", "off", ")", ";</s>u32", "*", "mapping", "=", "&", "vif", "-", ">", "hash", ".", "mapping", "[", "off", "]", ";", ".", "dest", ".", "u", ".", "gmfn", "=", "virt_to_gfn", "(", "mapping", ")", ",", ".", "dest", ".", "offset", "=", "xen_offset_in_page", "(", "mapping", ")", ",", ".", "len", "=", "len", "*", "sizeof", "(", "u32", ")", ",", "if", "(", "(", "off", "+", "len", ">", "vif", "-", ">", "hash", ".", "size", ")", "|", "|", "copy_op", ".", "len", ">", "XEN_PAGE_SIZE", ")"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request"]}
{"contents": ["x86/nospec:", "Simplify", "alternative_msr_write()", "The", "macro", "is", "not", "type", "safe", "and", "I", "did", "look", "for", "why", "that", "\"g\"", "constraint", "for", "the", "asm", "doesn't", "work:", "it's", "because", "the", "asm", "is", "more", "fundamentally", "wrong.", "It", "does", "movl", "%[val],", "%%eax", "but", "\"val\"", "isn't", "a", "32-bit", "value,", "so", "then", "gcc", "will", "pass", "it", "in", "a", "register,", "and", "generate", "code", "like", "movl", "%rsi,", "%eax", "and", "gas", "will", "complain", "about", "a", "nonsensical", "'mov'", "instruction", "(it's", "moving", "a", "64-bit", "register", "to", "a", "32-bit", "one).", "Passing", "it", "through", "memory", "will", "just", "hide", "the", "real", "bug", "-", "gcc", "still", "thinks", "the", "memory", "location", "is", "64-bit,", "but", "the", "\"movl\"", "will", "only", "load", "the", "first", "32", "bits", "and", "it", "all", "happens", "to", "work", "because", "x86", "is", "little-endian.", "Convert", "it", "to", "a", "type", "safe", "inline", "function", "with", "a", "little", "trick", "which", "hands", "the", "feature", "into", "the", "ALTERNATIVE", "macro.", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Reviewed-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["static", "__always_inline", "void", "alternative_msr_write", "(", "unsigned", "int", "msr", ",", "u64", "val", ",", "unsigned", "int", "feature", ")", "{", "asm", "volatile", "(", "ALTERNATIVE", "(", "\"\"", ",", "\"", "wrmsr", "\"", ",", "%", "c", "[", "feature", "]", ")", ":", ":", "\"", "c", "\"", "(", "msr", ")", ",", "\"", "a", "\"", "(", "val", ")", ",", "\"", "d", "\"", "(", "val", ">", ">", "32", ")", ",", "[", "feature", "]", "\"", "i", "\"", "(", "feature", ")", ":", "\"", "memory", "\"", ");", "}</s>#", "define", "alternative_msr_write", "(", "_msr", ",", "_val", ",", "_feature", ")", "\\", "asm", "volatile", "(", "ALTERNATIVE", "(", "\"\"", ",", "\\", "\"", "movl", "%", "[", "msr", "]", ",", "%", "%", "ecx", "\\", "n", "\\", "t", "\"", "\\", "\"", "movl", "%", "[", "val", "]", ",", "%", "%", "eax", "\\", "n", "\\", "t", "\"", "\\", "\"", "movl", "$", "0", ",", "%", "%", "edx", "\\", "n", "\\", "t", "\"", "\\", "\"", "wrmsr", "\"", ",", "\\", "_feature", ")", "\\", ":", ":", "[", "msr", "]", "\"", "i", "\"", "(", "_msr", ")", ",", "[", "val", "]", "\"", "i", "\"", "(", "_val", ")", "\\", ":", "\"", "eax", "\"", ",", "\"", "ecx", "\"", ",", "\"", "edx", "\"", ",", "\"", "memory", "\"", ")"], "docstring_tokens": ["execute", "a", "Spectre-style", "gadget", "on", "a", "pointer", "read", "from", "a", "memory", "slot"]}
{"contents": ["SONAR-11305", "Return", "external", "identity", "only", "to", "sys", "admin", "in", "api/users/search"], "code_tokens": ["new", "Change", "(", "\"", "7", ".", "4", "\"", ",", "\"", "External", "identity", "is", "only", "returned", "to", "system", "administrators", "\"", "),", "setIfNeeded", "(", "FIELD_EXTERNAL_IDENTITY", ",", "fields", ",", "user", ".", "getExternalLogin", "(", "),", "userBuilder", ":", ":", "setExternalIdentity", ")", ";", "@", "Test", "public", "void", "return_external_information", "(", ")", "{", "UserDto", "user", "=", "db", ".", "users", "(", ").", "insertUser", "(", ");", "userIndexer", ".", "indexOnStartup", "(", "null", ")", ";", "userSession", ".", "logIn", "(", ").", "setSystemAdministrator", "(", ");", "SearchWsResponse", "response", "=", "ws", ".", "newRequest", "(", ")", ".", "executeProtobuf", "(", "SearchWsResponse", ".", "class", ")", ";", "assertThat", "(", "response", ".", "getUsersList", "(", "))", ".", "extracting", "(", "User", ":", ":", "getLogin", ",", "User", ":", ":", "getExternalIdentity", ",", "User", ":", ":", "getExternalProvider", ")", ".", "containsExactlyInAnyOrder", "(", "tuple", "(", "user", ".", "getLogin", "(", "),", "user", ".", "getExternalLogin", "(", "),", "user", ".", "getExternalIdentityProvider", "(", "))", ");", "}", "@", "Test", "public", "void", "return_external_identity_only_when_system_administer", "(", ")", "{", "UserDto", "user", "=", "db", ".", "users", "(", ").", "insertUser", "(", ");", "userIndexer", ".", "indexOnStartup", "(", "null", ")", ";", "userSession", ".", "logIn", "(", ").", "setSystemAdministrator", "(", ");", "assertThat", "(", "ws", ".", "newRequest", "(", ")", ".", "executeProtobuf", "(", "SearchWsResponse", ".", "class", ")", ".", "getUsersList", "(", "))", ".", "extracting", "(", "User", ":", ":", "getLogin", ",", "User", ":", ":", "getExternalIdentity", ")", ".", "containsExactlyInAnyOrder", "(", "tuple", "(", "user", ".", "getLogin", "(", "),", "user", ".", "getExternalLogin", "(", "))", ");", "userSession", ".", "logIn", "(", ");", "assertThat", "(", "ws", ".", "newRequest", "(", ")", ".", "executeProtobuf", "(", "SearchWsResponse", ".", "class", ")", ".", "getUsersList", "(", "))", ".", "extracting", "(", "User", ":", ":", "getLogin", ",", "User", ":", ":", "hasExternalIdentity", ")", ".", "containsExactlyInAnyOrder", "(", "tuple", "(", "user", ".", "getLogin", "(", "),", "false", ")", ");", "}</s>setIfNeeded", "(", "FIELD_EXTERNAL_IDENTITY", ",", "fields", ",", "user", ".", "getExternalLogin", "(", "),", "userBuilder", ":", ":", "setExternalIdentity", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["bpf:", "fix", "integer", "overflows", "There", "were", "various", "issues", "related", "to", "the", "limited", "size", "of", "integers", "used", "in", "the", "verifier:", "-", "`off", "+", "size`", "overflow", "in", "__check_map_access()", "-", "`off", "+", "reg->off`", "overflow", "in", "check_mem_access()", "-", "`off", "+", "reg->var_off.value`", "overflow", "or", "32-bit", "truncation", "of", "`reg->var_off.value`", "in", "check_mem_access()", "-", "32-bit", "truncation", "in", "check_stack_boundary()", "Make", "sure", "that", "any", "integer", "math", "cannot", "overflow", "by", "not", "allowing", "pointer", "math", "with", "large", "values.", "Also", "reduce", "the", "scope", "of", "\"scalar", "op", "scalar\"", "tracking.", "Fixes:", "f1174f77b50c", "(\"bpf/verifier:", "rework", "value", "tracking\")", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "Signed-off-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>"], "code_tokens": ["#", "define", "BPF_MAX_VAR_OFF", "(", "1", "<", "<", "29", ")", "#", "define", "BPF_MAX_VAR_SIZ", "(", "1", "<", "<", "29", ")", "static", "bool", "check_reg_sane_offset", "(", "struct", "bpf_verifier_env", "*", "env", ",", "const", "struct", "bpf_reg_state", "*", "reg", ",", "enum", "bpf_reg_type", "type", ")", "{", "bool", "known", "=", "tnum_is_const", "(", "reg", "-", ">", "var_off", ")", ";", "s64", "val", "=", "reg", "-", ">", "var_off", ".", "value", ";", "s64", "smin", "=", "reg", "-", ">", "smin_value", ";", "if", "(", "known", "&", "&", "(", "val", ">", "=", "BPF_MAX_VAR_OFF", "|", "|", "val", "<", "=", "-", "BPF_MAX_VAR_OFF", ")", ")", "{", "verbose", "(", "env", ",", "\"", "math", "between", "%", "s", "pointer", "and", "%", "lld", "is", "not", "allowed", "\\", "n", "\"", ",", "reg_type_str", "[", "type", "]", ",", "val", ")", ";", "return", "false", ";", "}", "if", "(", "reg", "-", ">", "off", ">", "=", "BPF_MAX_VAR_OFF", "|", "|", "reg", "-", ">", "off", "<", "=", "-", "BPF_MAX_VAR_OFF", ")", "{", "verbose", "(", "env", ",", "\"", "%", "s", "pointer", "offset", "%", "d", "is", "not", "allowed", "\\", "n", "\"", ",", "reg_type_str", "[", "type", "]", ",", "reg", "-", ">", "off", ")", ";", "return", "false", ";", "}", "if", "(", "smin", "=", "=", "S64_MIN", ")", "{", "verbose", "(", "env", ",", "\"", "math", "between", "%", "s", "pointer", "and", "register", "with", "unbounded", "min", "value", "is", "not", "allowed", "\\", "n", "\"", ",", "reg_type_str", "[", "type", "]", ");", "return", "false", ";", "}", "if", "(", "smin", ">", "=", "BPF_MAX_VAR_OFF", "|", "|", "smin", "<", "=", "-", "BPF_MAX_VAR_OFF", ")", "{", "verbose", "(", "env", ",", "\"", "value", "%", "lld", "makes", "%", "s", "pointer", "be", "out", "of", "bounds", "\\", "n", "\"", ",", "smin", ",", "reg_type_str", "[", "type", "]", ");", "return", "false", ";", "}", "return", "true", ";", "}", "if", "(", "!", "check_reg_sane_offset", "(", "env", ",", "off_reg", ",", "ptr_reg", "-", ">", "type", ")", "|", "|", "!", "check_reg_sane_offset", "(", "env", ",", "ptr_reg", ",", "ptr_reg", "-", ">", "type", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "!", "check_reg_sane_offset", "(", "env", ",", "dst_reg", ",", "ptr_reg", "-", ">", "type", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "!", "src_known", "&", "&", "opcode", "!", "=", "BPF_ADD", "&", "&", "opcode", "!", "=", "BPF_SUB", "&", "&", "opcode", "!", "=", "BPF_AND", ")", "{", "__mark_reg_unknown", "(", "dst_reg", ")", ";", "return", "0", ";", "}</s>#", "define", "BPF_MAX_VAR_OFF", "(", "1ULL", "<", "<", "31", ")", "#", "define", "BPF_MAX_VAR_SIZ", "INT_MAX"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["netfilter:", "x_tables:", "check", "for", "size", "overflow", "Ben", "Hawkes", "says:", "integer", "overflow", "in", "xt_alloc_table_info,", "which", "on", "32-bit", "systems", "can", "lead", "to", "small", "structure", "allocation", "and", "a", "copy_from_user", "based", "heap", "corruption.", "Reported-by:", "Ben", "Hawkes", "<hawkes@google.com>", "Signed-off-by:", "Florian", "Westphal", "<fw@strlen.de>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["if", "(", "sz", "<", "sizeof", "(", "*", "info", ")", ")", "return", "NULL", ";</s>"], "docstring_tokens": ["entry"]}
{"contents": ["Add", "additional", "configuration", "options", "to", "the", "DIGEST", "authenticator", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc5.5.x/trunk@1159309", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "catalina", ".", "LifecycleException", ";", "public", "class", "DigestAuthenticator", "extends", "AuthenticatorBase", "{", "/", "**", "*", "Tomcat", "'", "s", "DIGEST", "implementation", "only", "supports", "auth", "quality", "of", "protection", ".", "*", "/", "protected", "static", "final", "String", "QOP", "=", "\"", "auth", "\"", ";", "/", "**", "*", "List", "of", "client", "nonce", "values", "currently", "being", "tracked", "*", "/", "protected", "Map", "cnonces", ";", "/", "**", "*", "Maximum", "number", "of", "client", "nonces", "to", "keep", "in", "the", "cache", ".", "If", "not", "specified", ",", "*", "the", "default", "value", "of", "1000", "is", "used", ".", "*", "/", "protected", "int", "cnonceCacheSize", "=", "1000", ";", "protected", "String", "key", "=", "null", ";", "/", "**", "*", "How", "long", "server", "nonces", "are", "valid", "for", "in", "milliseconds", ".", "Defaults", "to", "5", "*", "minutes", ".", "*", "/", "protected", "long", "nonceValidity", "=", "5", "*", "60", "*", "1000", ";", "/", "**", "*", "Opaque", "string", ".", "*", "/", "protected", "String", "opaque", ";", "/", "**", "*", "Should", "the", "URI", "be", "validated", "as", "required", "by", "RFC2617", "?", "Can", "be", "disabled", "in", "*", "reverse", "proxies", "where", "the", "proxy", "has", "modified", "the", "URI", ".", "*", "/", "protected", "boolean", "validateUri", "=", "true", ";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Properties", "public", "int", "getCnonceCacheSize", "(", ")", "{", "return", "cnonceCacheSize", ";", "}", "public", "void", "setCnonceCacheSize", "(", "int", "cnonceCacheSize", ")", "{", "this", ".", "cnonceCacheSize", "=", "cnonceCacheSize", ";", "}", "public", "String", "getKey", "(", ")", "{", "return", "key", ";", "}", "public", "void", "setKey", "(", "String", "key", ")", "{", "this", ".", "key", "=", "key", ";", "}", "public", "long", "getNonceValidity", "(", ")", "{", "return", "nonceValidity", ";", "}", "public", "void", "setNonceValidity", "(", "long", "nonceValidity", ")", "{", "this", ".", "nonceValidity", "=", "nonceValidity", ";", "}", "public", "String", "getOpaque", "(", ")", "{", "return", "opaque", ";", "}", "public", "void", "setOpaque", "(", "String", "opaque", ")", "{", "this", ".", "opaque", "=", "opaque", ";", "}", "public", "boolean", "isValidateUri", "(", ")", "{", "return", "validateUri", ";", "}", "public", "void", "setValidateUri", "(", "boolean", "validateUri", ")", "{", "this", ".", "validateUri", "=", "validateUri", ";", "}", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Public", "Methods", "DigestInfo", "digestInfo", "=", "new", "DigestInfo", "(", "getOpaque", "(", "),", "getNonceValidity", "(", "),", "getKey", "(", "),", "cnonces", ",", "isValidateUri", "(", "))", ";", "if", "(", "digestInfo", ".", "validate", "(", "request", ",", "authorization", ",", "config", ")", ")", "{", "principal", "=", "digestInfo", ".", "authenticate", "(", "context", ".", "getRealm", "(", "))", ";", "}", "/", "/", "Next", ",", "generate", "a", "nonce", "token", "(", "that", "is", "a", "token", "which", "is", "supposed", "String", "nonce", "=", "generateNonce", "(", "request", ")", ";", "setAuthenticateHeader", "(", "request", ",", "response", ",", "config", ",", "nonce", ",", "digestInfo", ".", "isNonceStale", "(", "))", ";", "protected", "String", "generateNonce", "(", "Request", "request", ")", "{", "String", "ipTimeKey", "=", "request", ".", "getRemoteAddr", "(", ")", "+", "\"", ":\"", "+", "currentTime", "+", "\"", ":\"", "+", "getKey", "(", ");", "byte", "[", "]", "buffer", ";", "buffer", "=", "md5Helper", ".", "digest", "(", "ipTimeKey", ".", "getBytes", "(", "))", ";", "return", "currentTime", "+", "\"", ":\"", "+", "md5Encoder", ".", "encode", "(", "buffer", ")", ";", "*", "digest", "-", "challenge", "=", "1", "#", "(", "realm", "|", "[", "domain", "]", "|", "nonce", "|", "*", "@", "param", "nonce", "nonce", "token", "String", "nonce", ",", "boolean", "isNonceStale", ")", "{", "String", "authenticateHeader", ";", "if", "(", "isNonceStale", ")", "{", "authenticateHeader", "=", "\"", "Digest", "realm", "=", "\\\"", "\"", "+", "realmName", "+", "\"", "\\\"", ",", "\"", "\"", "qop", "=", "\\\"", "\"", "+", "QOP", "+", "\"", "\\\"", ",", "nonce", "=", "\\\"", "\"", "+", "nonce", "+", "\"", "\\\"", ",", "\"", "+", "\"", "opaque", "=", "\\\"", "\"", "getOpaque", "(", ")", "+", "\"", "\\\"", ",", "stale", "=", "true", "\"", ";", "}", "else", "{", "authenticateHeader", "=", "\"", "Digest", "realm", "=", "\\\"", "\"", "+", "realmName", "+", "\"", "\\\"", ",", "\"", "\"", "qop", "=", "\\\"", "\"", "+", "QOP", "+", "\"", "\\\"", ",", "nonce", "=", "\\\"", "\"", "+", "nonce", "+", "\"", "\\\"", ",", "\"", "+", "\"", "opaque", "=", "\\\"", "\"", "getOpaque", "(", ")", "+", "\"", "\\\"", "\";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Lifecycle", "Methods", "public", "void", "start", "(", ")", "throws", "LifecycleException", "{", "super", ".", "start", "(", ");", "/", "/", "Generate", "a", "random", "secret", "key", "if", "(", "getKey", "(", ")", "=", "=", "null", ")", "{", "setKey", "(", "generateSessionId", "(", "))", ";", "}", "/", "/", "Generate", "the", "opaque", "string", "the", "same", "way", "if", "(", "getOpaque", "(", ")", "=", "=", "null", ")", "{", "setOpaque", "(", "generateSessionId", "(", "))", ";", "}", "cnonces", "=", "new", "LinkedHashMap", "(", ")", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "private", "static", "final", "long", "LOG_SUPPRESS_TIME", "=", "5", "*", "60", "*", "1000", ";", "private", "long", "lastLog", "=", "0", ";", "protected", "boolean", "removeEldestEntry", "(", "Map", ".", "Entry", "eldest", ")", "{", "/", "/", "This", "is", "called", "from", "a", "sync", "so", "keep", "it", "simple", "long", "currentTime", "=", "System", ".", "currentTimeMillis", "(", ");", "if", "(", "size", "(", ")", ">", "getCnonceCacheSize", "(", "))", "{", "if", "(", "lastLog", "<", "currentTime", "&", "&", "(", "currentTime", "-", "(", "(", "NonceInfo", ")", "eldest", ".", "getValue", "(", "))", ".", "getTimestamp", "(", "))", "<", "getNonceValidity", "(", "))", "{", "/", "/", "Replay", "attack", "is", "possible", "log", ".", "warn", "(", "sm", ".", "getString", "(", "\"", "digestAuthenticator", ".", "cacheRemove", "\"", "))", ";", "lastLog", "=", "currentTime", "+", "LOG_SUPPRESS_TIME", ";", "}", "return", "true", ";", "}", "return", "false", ";", "}", "}", ";", "}", "private", "static", "class", "DigestInfo", "{", "private", "String", "opaque", ";", "private", "long", "nonceValidity", ";", "private", "String", "key", ";", "private", "Map", "cnonces", ";", "private", "boolean", "validateUri", "=", "true", ";", "private", "String", "userName", "=", "null", ";", "private", "String", "method", "=", "null", ";", "private", "String", "uri", "=", "null", ";", "private", "String", "response", "=", "null", ";", "private", "String", "nonce", "=", "null", ";", "private", "String", "nc", "=", "null", ";", "private", "String", "cnonce", "=", "null", ";", "private", "String", "realmName", "=", "null", ";", "private", "String", "qop", "=", "null", ";", "private", "boolean", "nonceStale", "=", "false", ";", "public", "DigestInfo", "(", "String", "opaque", ",", "long", "nonceValidity", ",", "String", "key", ",", "Map", "cnonces", ",", "boolean", "validateUri", ")", "{", "this", ".", "opaque", "=", "opaque", ";", "this", ".", "nonceValidity", "=", "nonceValidity", ";", "this", ".", "key", "=", "key", ";", "this", ".", "cnonces", "=", "cnonces", ";", "this", ".", "validateUri", "=", "validateUri", ";", "}", "public", "boolean", "validate", "(", "Request", "request", ",", "String", "authorization", ",", "LoginConfig", "config", ")", "{", "/", "/", "Validate", "the", "authorization", "credentials", "format", "if", "(", "authorization", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "!", "authorization", ".", "startsWith", "(", "\"", "Digest", "\"", "))", "{", "return", "false", ";", "}", "authorization", "=", "authorization", ".", "substring", "(", "7", ")", ".", "trim", "(", ");", "/", "/", "Bugzilla", "37132", ":", "http", ":", "//", "issues", ".", "apache", ".", "org", "/", "bugzilla", "/", "show_bug", ".", "cgi", "?", "id", "=", "37132", "String", "[", "]", "tokens", "=", "authorization", ".", "split", "(", "\",", "(?", "=(", "?:", "[^", "\\\"", "]*", "\\\"", "[^", "\\\"", "]*", "\\\"", ")+", "$)", "\")", ";", "method", "=", "request", ".", "getMethod", "(", ");", "String", "opaque", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "tokens", ".", "length", ";", "i", "+", "+)", "{", "String", "currentToken", "=", "tokens", "[", "i", "]", ";", "if", "(", "currentToken", ".", "length", "(", ")", "=", "=", "0", ")", "continue", ";", "int", "equalSign", "=", "currentToken", ".", "indexOf", "(", "'=", "')", ";", "if", "(", "equalSign", "<", "0", ")", "{", "return", "false", ";", "}", "String", "currentTokenName", "=", "currentToken", ".", "substring", "(", "0", ",", "equalSign", ")", ".", "trim", "(", ");", "String", "currentTokenValue", "=", "currentToken", ".", "substring", "(", "equalSign", "+", "1", ")", ".", "trim", "(", ");", "if", "(", "\"", "username", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "userName", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "realm", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "realmName", "=", "removeQuotes", "(", "currentTokenValue", ",", "true", ")", ";", "if", "(", "\"", "nonce", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "nonce", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "nc", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "nc", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "cnonce", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "cnonce", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "qop", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "qop", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "uri", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "uri", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "response", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "response", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "opaque", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "opaque", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "}", "if", "(", "(", "userName", "=", "=", "null", ")", "|", "|", "(", "realmName", "=", "=", "null", ")", "|", "|", "(", "nonce", "=", "=", "null", ")", "|", "|", "(", "uri", "=", "=", "null", ")", "|", "|", "(", "response", "=", "=", "null", ")", ")", "{", "return", "false", ";", "}", "/", "/", "Validate", "the", "URI", "-", "should", "match", "the", "request", "line", "sent", "by", "client", "if", "(", "validateUri", ")", "{", "String", "uriQuery", ";", "String", "query", "=", "request", ".", "getQueryString", "(", ");", "if", "(", "query", "=", "=", "null", ")", "{", "uriQuery", "=", "request", ".", "getRequestURI", "(", ");", "}", "else", "{", "uriQuery", "=", "request", ".", "getRequestURI", "(", ")", "+", "\"", "?\"", "+", "query", ";", "}", "if", "(", "!", "uri", ".", "equals", "(", "uriQuery", ")", ")", "{", "return", "false", ";", "}", "}", "/", "/", "Validate", "the", "Realm", "name", "String", "lcRealm", "=", "config", ".", "getRealmName", "(", ");", "if", "(", "lcRealm", "=", "=", "null", ")", "{", "lcRealm", "=", "REALM_NAME", ";", "}", "if", "(", "!", "lcRealm", ".", "equals", "(", "realmName", ")", ")", "{", "return", "false", ";", "}", "/", "/", "Validate", "the", "opaque", "string", "if", "(", "!", "this", ".", "opaque", ".", "equals", "(", "opaque", ")", ")", "{", "return", "false", ";", "}", "/", "/", "Validate", "nonce", "int", "i", "=", "nonce", ".", "indexOf", "(", "\":", "\")", ";", "if", "(", "i", "<", "0", "|", "|", "(", "i", "+", "1", ")", "=", "=", "nonce", ".", "length", "(", "))", "{", "return", "false", ";", "}", "long", "nonceTime", ";", "try", "{", "nonceTime", "=", "Long", ".", "parseLong", "(", "nonce", ".", "substring", "(", "0", ",", "i", ")", ");", "}", "catch", "(", "NumberFormatException", "nfe", ")", "{", "return", "false", ";", "}", "String", "md5clientIpTimeKey", "=", "nonce", ".", "substring", "(", "i", "+", "1", ")", ";", "long", "currentTime", "=", "System", ".", "currentTimeMillis", "(", ");", "if", "(", "(", "currentTime", "-", "nonceTime", ")", ">", "nonceValidity", ")", "{", "nonceStale", "=", "true", ";", "return", "false", ";", "}", "String", "serverIpTimeKey", "=", "request", ".", "getRemoteAddr", "(", ")", "+", "\"", ":\"", "+", "nonceTime", "+", "\"", ":\"", "+", "key", ";", "byte", "[", "]", "buffer", "=", "null", ";", "synchronized", "(", "md5Helper", ")", "{", "buffer", "=", "md5Helper", ".", "digest", "(", "serverIpTimeKey", ".", "getBytes", "(", "))", ";", "}", "String", "md5ServerIpTimeKey", "=", "md5Encoder", ".", "encode", "(", "buffer", ")", ";", "if", "(", "!", "md5ServerIpTimeKey", ".", "equals", "(", "md5clientIpTimeKey", ")", ")", "{", "return", "false", ";", "}", "/", "/", "Validate", "qop", "if", "(", "qop", "!", "=", "null", "&", "&", "!", "QOP", ".", "equals", "(", "qop", ")", ")", "{", "return", "false", ";", "}", "/", "/", "Validate", "cnonce", "and", "nc", "/", "/", "Check", "if", "presence", "of", "nc", "and", "nonce", "is", "consistent", "with", "presence", "of", "qop", "if", "(", "qop", "=", "=", "null", ")", "{", "if", "(", "cnonce", "!", "=", "null", "|", "|", "nc", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "{", "if", "(", "cnonce", "=", "=", "null", "|", "|", "nc", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "nc", ".", "length", "(", ")", "!", "=", "8", ")", "{", "return", "false", ";", "}", "long", "count", ";", "try", "{", "count", "=", "Long", ".", "parseLong", "(", "nc", ",", "16", ")", ";", "}", "catch", "(", "NumberFormatException", "nfe", ")", "{", "return", "false", ";", "}", "NonceInfo", "info", ";", "synchronized", "(", "cnonces", ")", "{", "info", "=", "(", "NonceInfo", ")", "cnonces", ".", "get", "(", "cnonce", ")", ";", "}", "if", "(", "info", "=", "=", "null", ")", "{", "info", "=", "new", "NonceInfo", "(", ");", "}", "else", "{", "if", "(", "count", "<", "=", "info", ".", "getCount", "(", "))", "{", "return", "false", ";", "}", "}", "info", ".", "setCount", "(", "count", ")", ";", "info", ".", "setTimestamp", "(", "currentTime", ")", ";", "synchronized", "(", "cnonces", ")", "{", "cnonces", ".", "put", "(", "cnonce", ",", "info", ")", ";", "}", "}", "return", "true", ";", "}", "public", "boolean", "isNonceStale", "(", ")", "{", "return", "nonceStale", ";", "}", "public", "Principal", "authenticate", "(", "Realm", "realm", ")", "{", "/", "/", "Second", "MD5", "digest", "used", "to", "calculate", "the", "digest", ":", "/", "/", "MD5", "(", "Method", "+", "\"", ":\"", "+", "uri", ")", "String", "a2", "=", "method", "+", "\"", ":\"", "+", "uri", ";", "byte", "[", "]", "buffer", ";", "synchronized", "(", "md5Helper", ")", "{", "buffer", "=", "md5Helper", ".", "digest", "(", "a2", ".", "getBytes", "(", "))", ";", "}", "String", "md5a2", "=", "md5Encoder", ".", "encode", "(", "buffer", ")", ";", "return", "realm", ".", "authenticate", "(", "userName", ",", "response", ",", "nonce", ",", "nc", ",", "cnonce", ",", "qop", ",", "realmName", ",", "md5a2", ")", ";", "}", "}", "private", "static", "class", "NonceInfo", "{", "private", "volatile", "long", "count", ";", "private", "volatile", "long", "timestamp", ";", "public", "void", "setCount", "(", "long", "l", ")", "{", "count", "=", "l", ";", "}", "public", "long", "getCount", "(", ")", "{", "return", "count", ";", "}", "public", "void", "setTimestamp", "(", "long", "l", ")", "{", "timestamp", "=", "l", ";", "}", "public", "long", "getTimestamp", "(", ")", "{", "return", "timestamp", ";", "}", "}", "digestAuthenticator", ".", "cacheRemove", "=", "A", "valid", "entry", "has", "been", "removed", "from", "client", "nonce", "cache", "to", "make", "room", "for", "new", "entries", ".", "A", "replay", "attack", "is", "now", "possible", ".", "To", "prevent", "the", "possibility", "of", "replay", "attacks", ",", "reduce", "nonceValidity", "or", "increase", "cnonceCacheSize", ".", "Further", "warnings", "of", "this", "type", "will", "be", "suppressed", "for", "5", "minutes", ".", "<", "attribute", "name", "=", "\"", "cnonceCacheSize", "\"", "description", "=", "\"", "The", "size", "of", "the", "cnonce", "cache", "used", "to", "prevent", "replay", "attacks", "\"", "type", "=", "\"", "int", "\"", "/>", "<", "attribute", "name", "=", "\"", "key", "\"", "description", "=", "\"", "The", "secret", "key", "used", "by", "digest", "authentication", "\"", "type", "=", "\"", "java", ".", "lang", ".", "String", "\"", "/>", "<", "attribute", "name", "=", "\"", "nonceValidity", "\"", "description", "=", "\"", "The", "time", ",", "in", "milliseconds", ",", "for", "which", "a", "server", "issued", "nonce", "will", "be", "valid", "\"", "type", "=", "\"", "long", "\"", "/>", "<", "attribute", "name", "=", "\"", "opaque", "\"", "description", "=", "\"", "The", "opaque", "server", "string", "used", "by", "digest", "authentication", "\"", "type", "=", "\"", "java", ".", "lang", ".", "String", "\"", "/>", "<", "attribute", "name", "=", "\"", "validateUri", "\"", "description", "=", "\"", "Should", "the", "uri", "be", "validated", "as", "required", "by", "RFC2617", "?", "\"", "type", "=", "\"", "boolean", "\"", "/>", "*", "@", "param", "nonce", "Unique", "(", "or", "supposedly", "unique", ")", "token", "which", "has", "been", "used", "String", "nonce", ",", "String", "nc", ",", "String", "cnonce", ",", "String", "serverDigestValue", ";", "if", "(", "qop", "=", "=", "null", ")", "{", "serverDigestValue", "=", "md5a1", "+", "\"", ":\"", "+", "nonce", "+", "\"", ":\"", "+", "md5a2", ";", "}", "else", "{", "serverDigestValue", "=", "md5a1", "+", "\"", ":\"", "+", "nonce", "+", "\"", ":\"", "+", "nc", "+", "\"", ":\"", "cnonce", "+", "\"", ":\"", "+", "qop", "+", "\"", ":\"", "+", "md5a2", ";", "}", "+", "\"", "ClientSigest", ":", "\"", "+", "clientDigest", "+", "\"", "nonce", ":", "\"", "+", "nonce", "+", "\"", "nc", ":", "\"", "+", "nc", "+", "\"", "cnonce", ":", "\"", "+", "cnonce", "+", "\"", "qop", ":", "\"", "+", "qop", "+", "\"", "realm", ":", "\"", "+", "realm", "+", "\"", "md5a2", ":", "\"", "+", "md5a2", "+", "\"", "Server", "digest", ":", "\"", "+", "serverDigest", ")", ";", "@", "@", "-", "78", ",", "6", "+", "78", ",", "10", "@", "@", "<", "add", ">", "Add", "additional", "configuration", "options", "to", "the", "DIGEST", "authenticator", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "attribute", "name", "=", "\"", "cnonceCacheSize", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "To", "protect", "against", "replay", "attacks", ",", "the", "DIGEST", "authenticator", "tracks", "client", "nonce", "and", "nonce", "count", "values", ".", "This", "attribute", "controls", "the", "size", "of", "that", "cache", ".", "If", "not", "specified", ",", "the", "default", "value", "of", "1000", "is", "used", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "key", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "The", "secret", "key", "used", "by", "digest", "authentication", ".", "If", "not", "set", ",", "a", "secure", "random", "value", "is", "generated", ".", "This", "should", "normally", "only", "be", "set", "when", "it", "is", "necessary", "to", "keep", "key", "values", "constant", "either", "across", "server", "restarts", "and", "/", "or", "across", "a", "cluster", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "nonceValidity", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "The", "time", ",", "in", "milliseconds", ",", "that", "a", "server", "generated", "nonce", "will", "be", "considered", "valid", "for", "use", "in", "authentication", ".", "If", "not", "specified", ",", "the", "default", "value", "of", "300000", "(", "5", "minutes", ")", "will", "be", "used", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "opaque", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "The", "opaque", "server", "string", "used", "by", "digest", "authentication", ".", "If", "not", "set", ",", "a", "random", "value", "is", "generated", ".", "This", "should", "normally", "only", "be", "set", "when", "it", "is", "necessary", "to", "keep", "opaque", "values", "constant", "either", "across", "server", "restarts", "and", "/", "or", "across", "a", "cluster", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "validateUri", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "Should", "the", "URI", "be", "validated", "as", "required", "by", "RFC2617", "?", "If", "not", "specified", ",", "the", "default", "value", "of", "<", "code", ">", "true", "<", "/", "code", ">", "will", "be", "used", ".", "This", "should", "normally", "only", "be", "set", "when", "Tomcat", "is", "located", "behind", "a", "reverse", "proxy", "and", "the", "proxy", "is", "modifying", "the", "URI", "passed", "to", "Tomcat", "such", "that", "DIGEST", "authentication", "always", "fails", ".", "</", "p", ">", "<", "/", "attribute", "></s>*", "Add", "additional", "configuration", "options", "to", "the", "DIGEST", "authenticator", "http", ":", "//", "people", ".", "apache", ".", "org", "/", "~", "markt", "/", "patches", "/", "2011", "-", "04", "-", "01", "-", "digest", "-", "tc5", ".", "patch", "+", "1", ":", "markt", ":", "jfclere", "+", "1", ":", "kkolinko", ":", "with", "r1158177", "(", "s", "/", "nOnce", "/", "nonce", ")", "-", "1", ":", "public", "class", "DigestAuthenticator", "extends", "AuthenticatorBase", "{", "protected", "String", "key", "=", "\"", "Catalina", "\"", ";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Properties", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Public", "Methods", "principal", "=", "findPrincipal", "(", "request", ",", "authorization", ",", "context", ".", "getRealm", "(", "))", ";", "/", "/", "Next", ",", "generate", "a", "nOnce", "token", "(", "that", "is", "a", "token", "which", "is", "supposed", "String", "nOnce", "=", "generateNOnce", "(", "request", ")", ";", "setAuthenticateHeader", "(", "request", ",", "response", ",", "config", ",", "nOnce", ")", ";", "/", "**", "*", "Parse", "the", "specified", "authorization", "credentials", ",", "and", "return", "the", "*", "associated", "Principal", "that", "these", "credentials", "authenticate", "(", "if", "any", ")", "*", "from", "the", "specified", "Realm", ".", "If", "there", "is", "no", "such", "Principal", ",", "return", "*", "<", "code", ">", "null", "<", "/", "code", ">", ".", "*", "*", "@", "param", "request", "HTTP", "servlet", "request", "*", "@", "param", "authorization", "Authorization", "credentials", "from", "this", "request", "*", "@", "param", "realm", "Realm", "used", "to", "authenticate", "Principals", "*", "/", "protected", "static", "Principal", "findPrincipal", "(", "Request", "request", ",", "String", "authorization", ",", "Realm", "realm", ")", "{", "/", "/", "System", ".", "out", ".", "println", "(", "\"", "Authorization", "token", ":", "\"", "+", "authorization", ")", ";", "/", "/", "Validate", "the", "authorization", "credentials", "format", "if", "(", "authorization", "=", "=", "null", ")", "return", "(", "null", ")", ";", "if", "(", "!", "authorization", ".", "startsWith", "(", "\"", "Digest", "\"", "))", "return", "(", "null", ")", ";", "authorization", "=", "authorization", ".", "substring", "(", "7", ")", ".", "trim", "(", ");", "/", "/", "Bugzilla", "37132", ":", "http", ":", "//", "issues", ".", "apache", ".", "org", "/", "bugzilla", "/", "show_bug", ".", "cgi", "?", "id", "=", "37132", "String", "[", "]", "tokens", "=", "authorization", ".", "split", "(", "\",", "(?", "=(", "?:", "[^", "\\\"", "]*", "\\\"", "[^", "\\\"", "]*", "\\\"", ")+", "$)", "\")", ";", "String", "userName", "=", "null", ";", "String", "realmName", "=", "null", ";", "String", "nOnce", "=", "null", ";", "String", "nc", "=", "null", ";", "String", "cnonce", "=", "null", ";", "String", "qop", "=", "null", ";", "String", "uri", "=", "null", ";", "String", "response", "=", "null", ";", "String", "method", "=", "request", ".", "getMethod", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "tokens", ".", "length", ";", "i", "+", "+)", "{", "String", "currentToken", "=", "tokens", "[", "i", "]", ";", "if", "(", "currentToken", ".", "length", "(", ")", "=", "=", "0", ")", "continue", ";", "int", "equalSign", "=", "currentToken", ".", "indexOf", "(", "'=", "')", ";", "if", "(", "equalSign", "<", "0", ")", "return", "null", ";", "String", "currentTokenName", "=", "currentToken", ".", "substring", "(", "0", ",", "equalSign", ")", ".", "trim", "(", ");", "String", "currentTokenValue", "=", "currentToken", ".", "substring", "(", "equalSign", "+", "1", ")", ".", "trim", "(", ");", "if", "(", "\"", "username", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "userName", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "realm", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "realmName", "=", "removeQuotes", "(", "currentTokenValue", ",", "true", ")", ";", "if", "(", "\"", "nonce", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "nOnce", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "nc", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "nc", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "cnonce", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "cnonce", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "qop", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "qop", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "uri", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "uri", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "if", "(", "\"", "response", "\"", ".", "equals", "(", "currentTokenName", ")", ")", "response", "=", "removeQuotes", "(", "currentTokenValue", ")", ";", "}", "if", "(", "(", "userName", "=", "=", "null", ")", "|", "|", "(", "realmName", "=", "=", "null", ")", "|", "|", "(", "nOnce", "=", "=", "null", ")", "|", "|", "(", "uri", "=", "=", "null", ")", "|", "|", "(", "response", "=", "=", "null", ")", ")", "return", "null", ";", "/", "/", "Second", "MD5", "digest", "used", "to", "calculate", "the", "digest", ":", "/", "/", "MD5", "(", "Method", "+", "\"", ":\"", "+", "uri", ")", "String", "a2", "=", "method", "+", "\"", ":\"", "+", "uri", ";", "/", "/", "System", ".", "out", ".", "println", "(", "\"", "A2", ":", "\"", "+", "a2", ")", ";", "byte", "[", "]", "buffer", "=", "null", ";", "synchronized", "(", "md5Helper", ")", "{", "buffer", "=", "md5Helper", ".", "digest", "(", "a2", ".", "getBytes", "(", "))", ";", "}", "String", "md5a2", "=", "md5Encoder", ".", "encode", "(", "buffer", ")", ";", "return", "(", "realm", ".", "authenticate", "(", "userName", ",", "response", ",", "nOnce", ",", "nc", ",", "cnonce", ",", "qop", ",", "realmName", ",", "md5a2", ")", ");", "}", "/", "/", "System", ".", "out", ".", "println", "(", "\"", "Authorization", "token", ":", "\"", "+", "authorization", ")", ";", "protected", "String", "generateNOnce", "(", "Request", "request", ")", "{", "String", "nOnceValue", "=", "request", ".", "getRemoteAddr", "(", ")", "+", "\"", ":\"", "+", "currentTime", "+", "\"", ":\"", "+", "key", ";", "byte", "[", "]", "buffer", "=", "null", ";", "buffer", "=", "md5Helper", ".", "digest", "(", "nOnceValue", ".", "getBytes", "(", "))", ";", "nOnceValue", "=", "md5Encoder", ".", "encode", "(", "buffer", ")", ";", "return", "nOnceValue", ";", "*", "digest", "-", "challenge", "=", "1", "#", "(", "realm", "|", "[", "domain", "]", "|", "nOnce", "|", "*", "@", "param", "nOnce", "nonce", "token", "String", "nOnce", ")", "{", "byte", "[", "]", "buffer", "=", "null", ";", "synchronized", "(", "md5Helper", ")", "{", "buffer", "=", "md5Helper", ".", "digest", "(", "nOnce", ".", "getBytes", "(", "))", ";", "String", "authenticateHeader", "=", "\"", "Digest", "realm", "=", "\\\"", "\"", "+", "realmName", "+", "\"", "\\\"", ",", "\"", "+", "\"", "qop", "=", "\\\"", "auth", "\\", "\",", "nonce", "=", "\\\"", "\"", "+", "nOnce", "+", "\"", "\\\"", ",", "\"", "+", "\"", "opaque", "=", "\\\"", "\"", "+", "md5Encoder", ".", "encode", "(", "buffer", ")", "+", "\"", "\\\"", "\";", "*", "@", "param", "nOnce", "Unique", "(", "or", "supposedly", "unique", ")", "token", "which", "has", "been", "used", "String", "nOnce", ",", "String", "nc", ",", "String", "cnonce", ",", "String", "serverDigestValue", "=", "md5a1", "+", "\"", ":\"", "+", "nOnce", "+", "\"", ":\"", "+", "nc", "+", "\"", ":\"", "+", "cnonce", "+", "\"", ":\"", "+", "qop", "+", "\"", ":\"", "+", "md5a2", ";", "+", "\"", "ClientSigest", ":", "\"", "+", "clientDigest", "+", "\"", "nOnce", ":", "\"", "+", "nOnce"], "docstring_tokens": ["by", "sniffing", "the", "network", "for", "valid", "requests"]}
{"contents": ["bpf:", "fix", "32-bit", "ALU", "op", "verification", "32-bit", "ALU", "ops", "operate", "on", "32-bit", "values", "and", "have", "32-bit", "outputs.", "Adjust", "the", "verifier", "accordingly.", "Fixes:", "f1174f77b50c", "(\"bpf/verifier:", "rework", "value", "tracking\")", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "Signed-off-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>"], "code_tokens": ["/", "*", "WARNING", ":", "This", "function", "does", "calculations", "on", "64", "-", "bit", "values", ",", "but", "the", "actual", "*", "execution", "may", "occur", "on", "32", "-", "bit", "values", ".", "Therefore", ",", "things", "like", "bitshifts", "*", "need", "extra", "checks", "in", "the", "32", "-", "bit", "case", ".", "*", "/", "u64", "insn_bitness", "=", "(", "BPF_CLASS", "(", "insn", "-", ">", "code", ")", "=", "=", "BPF_ALU64", ")", "?", "64", ":", "32", ";", "if", "(", "umax_val", ">", "=", "insn_bitness", ")", "{", "/", "*", "Shifts", "greater", "than", "31", "or", "63", "are", "undefined", ".", "*", "This", "includes", "shifts", "by", "a", "negative", "number", ".", "if", "(", "umax_val", ">", "=", "insn_bitness", ")", "{", "/", "*", "Shifts", "greater", "than", "31", "or", "63", "are", "undefined", ".", "*", "This", "includes", "shifts", "by", "a", "negative", "number", ".", "if", "(", "BPF_CLASS", "(", "insn", "-", ">", "code", ")", "!", "=", "BPF_ALU64", ")", "{", "/", "*", "32", "-", "bit", "ALU", "ops", "are", "(", "32", ",", "32", ")", "->", "32", "*", "/", "coerce_reg_to_size", "(", "dst_reg", ",", "4", ")", ";", "coerce_reg_to_size", "(", "&", "src_reg", ",", "4", ")", ";", "}</s>if", "(", "BPF_CLASS", "(", "insn", "-", ">", "code", ")", "!", "=", "BPF_ALU64", ")", "{", "/", "*", "32", "-", "bit", "ALU", "ops", "are", "(", "32", ",", "32", ")", "->", "64", "*", "/", "coerce_reg_to_size", "(", "dst_reg", ",", "4", ")", ";", "coerce_reg_to_size", "(", "&", "src_reg", ",", "4", ")", ";", "}", "if", "(", "umax_val", ">", "63", ")", "{", "/", "*", "Shifts", "greater", "than", "63", "are", "undefined", ".", "This", "includes", "*", "shifts", "by", "a", "negative", "number", ".", "if", "(", "umax_val", ">", "63", ")", "{", "/", "*", "Shifts", "greater", "than", "63", "are", "undefined", ".", "This", "includes", "*", "shifts", "by", "a", "negative", "number", "."], "docstring_tokens": ["leveraging", "mishandling", "of", "invalid", "variable", "stack", "read", "operation"]}
{"contents": ["ARM:", "7735/2:", "Preserve", "the", "user", "r/w", "register", "TPIDRURW", "on", "context", "switch", "and", "fork", "Since", "commit", "6a1c53124aa1", "the", "user", "writeable", "TLS", "register", "was", "zeroed", "to", "prevent", "it", "from", "being", "used", "as", "a", "covert", "channel", "between", "two", "tasks.", "There", "are", "more", "and", "more", "applications", "coming", "to", "Windows", "RT,", "Wine", "could", "support", "them,", "but", "mostly", "they", "expect", "to", "have", "the", "thread", "environment", "block", "(TEB)", "in", "TPIDRURW.", "This", "patch", "preserves", "that", "register", "per", "thread", "instead", "of", "clearing", "it.", "Unlike", "the", "TPIDRURO,", "which", "is", "already", "switched,", "the", "TPIDRURW", "can", "be", "updated", "from", "userspace", "so", "needs", "careful", "treatment", "in", "the", "case", "that", "we", "modify", "TPIDRURW", "and", "call", "fork().", "To", "avoid", "this", "we", "must", "always", "read", "TPIDRURW", "in", "copy_thread.", "Signed-off-by:", "Andr\u00e9", "Hentschel", "<nerv@dawncrow.de>", "Signed-off-by:", "Will", "Deacon", "<will.deacon@arm.com>", "Signed-off-by:", "Jonathan", "Austin", "<jonathan.austin@arm.com>", "Signed-off-by:", "Russell", "King", "<rmk+kernel@arm.linux.org.uk>"], "code_tokens": ["unsigned", "long", "tp_value", "[", "2", "]", ";", "/", "*", "TLS", "registers", "*", "/", "#", "include", "<", "asm", "/", "asm", "-", "offsets", ".", "h", ">", ".", "macro", "switch_tls_none", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", ".", "macro", "switch_tls_v6k", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", "mrc", "p15", ",", "0", ",", "\\", "tmp2", ",", "c13", ",", "c0", ",", "2", "@", "get", "the", "user", "r", "/", "w", "register", "mcr", "p15", ",", "0", ",", "\\", "tpuser", ",", "c13", ",", "c0", ",", "2", "@", "and", "the", "user", "r", "/", "w", "register", "str", "\\", "tmp2", ",", "[", "\\", "base", ",", "#", "TI_TP_VALUE", "+", "4", "]", "@", "save", "it", ".", "macro", "switch_tls_v6", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", "mrcne", "p15", ",", "0", ",", "\\", "tmp2", ",", "c13", ",", "c0", ",", "2", "@", "get", "the", "user", "r", "/", "w", "register", "mcrne", "p15", ",", "0", ",", "\\", "tp", ",", "c13", ",", "c0", ",", "3", "@", "yes", ",", "set", "TLS", "register", "mcrne", "p15", ",", "0", ",", "\\", "tpuser", ",", "c13", ",", "c0", ",", "2", "@", "set", "user", "r", "/", "w", "register", "strne", "\\", "tmp2", ",", "[", "\\", "base", ",", "#", "TI_TP_VALUE", "+", "4", "]", "@", "save", "it", ".", "macro", "switch_tls_software", ",", "base", ",", "tp", ",", "tpuser", ",", "tmp1", ",", "tmp2", "#", "define", "switch_tls", "switch_tls_none", "#", "define", "switch_tls", "switch_tls_v6", "#", "define", "switch_tls", "switch_tls_v6k", "#", "define", "switch_tls", "switch_tls_software", "#", "ifndef", "__ASSEMBLY__", "static", "inline", "unsigned", "long", "get_tpuser", "(", "void", ")", "{", "unsigned", "long", "reg", "=", "0", ";", "if", "(", "has_tls_reg", "&", "&", "!", "tls_emu", ")", "__asm__", "(", "\"", "mrc", "p15", ",", "0", ",", "%", "0", ",", "c13", ",", "c0", ",", "2", "\"", ":", "\"", "=", "r", "\"", "(", "reg", ")", ");", "return", "reg", ";", "}", "#", "endif", "ldr", "r4", ",", "[", "r2", ",", "#", "TI_TP_VALUE", "]", "ldr", "r5", ",", "[", "r2", ",", "#", "TI_TP_VALUE", "+", "4", "]", "switch_tls", "r1", ",", "r4", ",", "r5", ",", "r3", ",", "r7", "#", "include", "<", "asm", "/", "tls", ".", "h", ">", "thread", "-", ">", "tp_value", "[", "0", "]", "=", "childregs", "-", ">", "ARM_r3", ";", "thread", "-", ">", "tp_value", "[", "1", "]", "=", "get_tpuser", "(", ");", "ret", "=", "put_user", "(", "task_thread_info", "(", "child", ")", "->", "tp_value", "[", "0", "]", ",", "thread", "-", ">", "tp_value", "[", "0", "]", "=", "regs", "-", ">", "ARM_r0", ";", "regs", "-", ">", "uregs", "[", "reg", "]", "=", "current_thread_info", "(", ")-", ">", "tp_value", "[", "0", "]", ";</s>unsigned", "long", "tp_value", ";", ".", "macro", "set_tls_none", ",", "tp", ",", "tmp1", ",", "tmp2", ".", "macro", "set_tls_v6k", ",", "tp", ",", "tmp1", ",", "tmp2", "mov", "\\", "tmp1", ",", "#", "0", "mcr", "p15", ",", "0", ",", "\\", "tmp1", ",", "c13", ",", "c0", ",", "2", "@", "clear", "user", "r", "/", "w", "TLS", "register", ".", "macro", "set_tls_v6", ",", "tp", ",", "tmp1", ",", "tmp2", "mcrne", "p15", ",", "0", ",", "\\", "tp", ",", "c13", ",", "c0", ",", "3", "@", "yes", ",", "set", "TLS", "register", "movne", "\\", "tmp1", ",", "#", "0", "mcrne", "p15", ",", "0", ",", "\\", "tmp1", ",", "c13", ",", "c0", ",", "2", "@", "clear", "user", "r", "/", "w", "TLS", "register", ".", "macro", "set_tls_software", ",", "tp", ",", "tmp1", ",", "tmp2", "#", "define", "set_tls", "set_tls_none", "#", "define", "set_tls", "set_tls_v6", "#", "define", "set_tls", "set_tls_v6k", "#", "define", "set_tls", "set_tls_software", "ldr", "r3", ",", "[", "r2", ",", "#", "TI_TP_VALUE", "]", "set_tls", "r3", ",", "r4", ",", "r5", "thread", "-", ">", "tp_value", "=", "childregs", "-", ">", "ARM_r3", ";", "ret", "=", "put_user", "(", "task_thread_info", "(", "child", ")", "->", "tp_value", ",", "thread", "-", ">", "tp_value", "=", "regs", "-", ">", "ARM_r0", ";", "regs", "-", ">", "uregs", "[", "reg", "]", "=", "current_thread_info", "(", ")-", ">", "tp_value", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "install", "a", "specially-crafted", "application"]}
{"contents": ["Validation", "fix", "in", "the", "STS", "git-svn-id:", "https://svn.apache.org/repos/asf/cxf/trunk@1551228", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["if", "(", "!", "assertion", ".", "isSigned", "(", "))", "{", "LOG", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "The", "received", "assertion", "is", "not", "signed", ",", "and", "therefore", "not", "trusted", "\"", ");", "return", "response", ";", "}", "RequestData", "requestData", "=", "new", "RequestData", "(", ");", "requestData", ".", "setSigVerCrypto", "(", "sigCrypto", ")", ";", "WSSConfig", "wssConfig", "=", "WSSConfig", ".", "getNewInstance", "(", ");", "requestData", ".", "setWssConfig", "(", "wssConfig", ")", ";", "requestData", ".", "setCallbackHandler", "(", "callbackHandler", ")", ";", "requestData", ".", "setMsgContext", "(", "tokenParameters", ".", "getWebServiceContext", "(", ").", "getMessageContext", "(", "))", ";", "WSDocInfo", "docInfo", "=", "new", "WSDocInfo", "(", "validateTargetElement", ".", "getOwnerDocument", "(", "))", ";", "/", "/", "Verify", "the", "signature", "Signature", "sig", "=", "assertion", ".", "getSignature", "(", ");", "KeyInfo", "keyInfo", "=", "sig", ".", "getKeyInfo", "(", ");", "SAMLKeyInfo", "samlKeyInfo", "=", "SAMLUtil", ".", "getCredentialFromKeyInfo", "(", "keyInfo", ".", "getDOM", "(", "),", "new", "WSSSAMLKeyInfoProcessor", "(", "requestData", ",", "docInfo", ")", ",", "sigCrypto", ")", ";", "assertion", ".", "verifySignature", "(", "samlKeyInfo", ")", ";", "/", "**", "*", "Test", "an", "invalid", "SAML", "2", "Assertion", "*", "/", "@", "org", ".", "junit", ".", "Test", "public", "void", "testInvalidSAML2Assertion", "(", ")", "throws", "Exception", "{", "TokenValidator", "samlTokenValidator", "=", "new", "SAMLTokenValidator", "(", ");", "TokenValidatorParameters", "validatorParameters", "=", "createValidatorParameters", "(", ");", "TokenRequirements", "tokenRequirements", "=", "validatorParameters", ".", "getTokenRequirements", "(", ");", "/", "/", "Create", "a", "ValidateTarget", "consisting", "of", "a", "SAML", "Assertion", "Crypto", "crypto", "=", "CryptoFactory", ".", "getInstance", "(", "getEncryptionProperties", "(", "))", ";", "CallbackHandler", "callbackHandler", "=", "new", "PasswordCallbackHandler", "(", ");", "Element", "samlToken", "=", "createSAMLAssertion", "(", "WSConstants", ".", "WSS_SAML2_TOKEN_TYPE", ",", "crypto", ",", "\"", "mystskey", "\"", ",", "callbackHandler", ")", ";", "Document", "doc", "=", "samlToken", ".", "getOwnerDocument", "(", ");", "samlToken", "=", "(", "Element", ")", "doc", ".", "appendChild", "(", "samlToken", ")", ";", "ReceivedToken", "validateTarget", "=", "new", "ReceivedToken", "(", "samlToken", ")", ";", "tokenRequirements", ".", "setValidateTarget", "(", "validateTarget", ")", ";", "validatorParameters", ".", "setToken", "(", "validateTarget", ")", ";", "assertTrue", "(", "samlTokenValidator", ".", "canHandleToken", "(", "validateTarget", ")", ");", "TokenValidatorResponse", "validatorResponse", "=", "samlTokenValidator", ".", "validateToken", "(", "validatorParameters", ")", ";", "assertTrue", "(", "validatorResponse", "!", "=", "null", ")", ";", "assertTrue", "(", "validatorResponse", ".", "getToken", "(", ")", "!", "=", "null", ")", ";", "assertTrue", "(", "validatorResponse", ".", "getToken", "(", ").", "getState", "(", ")", "=", "=", "STATE", ".", "VALID", ")", ";", "/", "/", "Replace", "\"", "alice", "\"", "with", "\"", "bob", "\"", ".", "Element", "nameID", "=", "(", "Element", ")", "samlToken", ".", "getElementsByTagNameNS", "(", "WSConstants", ".", "SAML2_NS", ",", "\"", "NameID", "\"", ").", "item", "(", "0", ")", ";", "nameID", ".", "setTextContent", "(", "\"", "bob", "\"", ");", "/", "/", "Now", "validate", "again", "validateTarget", "=", "new", "ReceivedToken", "(", "samlToken", ")", ";", "tokenRequirements", ".", "setValidateTarget", "(", "validateTarget", ")", ";", "validatorParameters", ".", "setToken", "(", "validateTarget", ")", ";", "assertTrue", "(", "samlTokenValidator", ".", "canHandleToken", "(", "validateTarget", ")", ");", "validatorResponse", "=", "samlTokenValidator", ".", "validateToken", "(", "validatorParameters", ")", ";", "assertTrue", "(", "validatorResponse", "!", "=", "null", ")", ";", "assertTrue", "(", "validatorResponse", ".", "getToken", "(", ")", "!", "=", "null", ")", ";", "assertTrue", "(", "validatorResponse", ".", "getToken", "(", ").", "getState", "(", ")", "!", "=", "STATE", ".", "VALID", ")", ";", "}</s>if", "(", "!", "assertion", ".", "isSigned", "(", "))", "{", "LOG", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "The", "received", "assertion", "is", "not", "signed", ",", "and", "therefore", "not", "trusted", "\"", ");", "return", "response", ";", "}", "RequestData", "requestData", "=", "new", "RequestData", "(", ");", "requestData", ".", "setSigVerCrypto", "(", "sigCrypto", ")", ";", "WSSConfig", "wssConfig", "=", "WSSConfig", ".", "getNewInstance", "(", ");", "requestData", ".", "setWssConfig", "(", "wssConfig", ")", ";", "requestData", ".", "setCallbackHandler", "(", "callbackHandler", ")", ";", "requestData", ".", "setMsgContext", "(", "tokenParameters", ".", "getWebServiceContext", "(", ").", "getMessageContext", "(", "))", ";", "WSDocInfo", "docInfo", "=", "new", "WSDocInfo", "(", "validateTargetElement", ".", "getOwnerDocument", "(", "))", ";", "/", "/", "Verify", "the", "signature", "Signature", "sig", "=", "assertion", ".", "getSignature", "(", ");", "KeyInfo", "keyInfo", "=", "sig", ".", "getKeyInfo", "(", ");", "SAMLKeyInfo", "samlKeyInfo", "=", "SAMLUtil", ".", "getCredentialFromKeyInfo", "(", "keyInfo", ".", "getDOM", "(", "),", "new", "WSSSAMLKeyInfoProcessor", "(", "requestData", ",", "docInfo", ")", ",", "sigCrypto", ")", ";", "assertion", ".", "verifySignature", "(", "samlKeyInfo", ")", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "token"]}
{"contents": ["NFC:", "llcp:", "Limit", "size", "of", "SDP", "URI", "The", "tlv_len", "is", "u8,", "so", "we", "need", "to", "limit", "the", "size", "of", "the", "SDP", "URI.", "Enforce", "this", "both", "in", "the", "NLA", "policy", "and", "in", "the", "code", "that", "performs", "the", "allocation", "and", "copy,", "to", "avoid", "writing", "past", "the", "end", "of", "the", "allocated", "buffer.", "Fixes:", "d9b8d8e19b073", "(\"NFC:", "llcp:", "Service", "Name", "Lookup", "netlink", "interface\")", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["/", "*", "sdreq", "-", ">", "tlv_len", "is", "u8", ",", "takes", "uri_len", ",", "+", "3", "for", "header", ",", "+", "1", "for", "NULL", "*", "/", "if", "(", "WARN_ON_ONCE", "(", "uri_len", ">", "U8_MAX", "-", "4", ")", ")", "return", "NULL", ";", "[", "NFC_SDP_ATTR_URI", "]", "=", "{", ".", "type", "=", "NLA_STRING", ",", ".", "len", "=", "U8_MAX", "-", "4", "}", ",</s>[", "NFC_SDP_ATTR_URI", "]", "=", "{", ".", "type", "=", "NLA_STRING", "}", ","], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Fix", "bug", "#72093:", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "We", "can", "not", "modify", "result", "since", "it", "can", "be", "copy", "of", "_zero_", "or", "_one_,", "etc.", "and", "\"copy\"", "in", "bcmath", "is", "just", "bumping", "the", "refcount."], "code_tokens": ["/", "*", "{", "{{", "split_bc_num", "Convert", "to", "bc_num", "detecting", "scale", "*", "/", "static", "bc_num", "split_bc_num", "(", "bc_num", "num", ")", "{", "bc_num", "newnum", ";", "if", "(", "num", "-", ">", "n_refs", ">", "=", "1", ")", "{", "return", "num", ";", "}", "newnum", "=", "_bc_new_num_ex", "(", "0", ",", "0", ",", "0", ")", ";", "*", "newnum", "=", "*", "num", ";", "newnum", "-", ">", "n_refs", "=", "1", ";", "num", "-", ">", "n_refs", "-", "-;", "return", "newnum", ";", "}", "/", "*", "}", "}}", "*", "/", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale_int", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale_int", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "-", "-", "TEST", "-", "-", "Bug", "72093", ":", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "bcmath", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "bcpowmod", "(", "1", ",", "\"", "A", "\"", ",", "128", ",", "-", "200", ")", ");", "var_dump", "(", "bcpowmod", "(", "1", ",", "1", ".", "2", ",", "1", ",", "1", ")", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "string", "(", "1", ")", "\"", "1", "\"", "bc", "math", "warning", ":", "non", "-", "zero", "scale", "in", "exponent", "string", "(", "3", ")", "\"", "0", ".", "0", "\"", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "#", "define", "PHP_RELEASE_VERSION", "27", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "27", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50527</s>if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "-", ">", "n_scale", "=", "scale", ";", "#", "define", "PHP_RELEASE_VERSION", "35", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "35", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50535"], "docstring_tokens": ["via", "a", "crafted", "call", "."]}
{"contents": ["batman-adv:", "Only", "write", "requested", "number", "of", "byte", "to", "user", "buffer", "Don't", "write", "more", "than", "the", "requested", "number", "of", "bytes", "of", "an", "batman-adv", "icmp", "packet", "to", "the", "userspace", "buffer.", "Otherwise", "unrelated", "userspace", "memory", "might", "get", "overridden", "by", "the", "kernel.", "Signed-off-by:", "Sven", "Eckelmann", "<sven@narfation.org>", "Signed-off-by:", "Marek", "Lindner", "<lindner_marek@yahoo.de>"], "code_tokens": ["packet_len", "=", "min", "(", "count", ",", "socket_packet", "-", ">", "icmp_len", ")", ";", "error", "=", "copy_to_user", "(", "buf", ",", "&", "socket_packet", "-", ">", "icmp_packet", ",", "packet_len", ")", ";</s>error", "=", "copy_to_user", "(", "buf", ",", "&", "socket_packet", "-", ">", "icmp_packet", ",", "socket_packet", "-", ">", "icmp_len", ")", ";", "packet_len", "=", "socket_packet", "-", ">", "icmp_len", ";"], "docstring_tokens": ["sending", "specially-crafted", "packets"]}
{"contents": ["FLINK-16697][metrics][jmx]", "Disable", "rebinding"], "code_tokens": ["import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIJRMPServerImpl", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "*", "<", "p", ">", "Originally", "based", "on", "j256", "simplejmx", "project", "private", "final", "AtomicReference", "<", "Remote", ">", "rmiServerReference", "=", "new", "AtomicReference", "<", ">(", ");", "internalStart", "(", "port", ")", ";", "private", "void", "internalStart", "(", "int", "port", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "/", "/", "this", "allows", "clients", "to", "lookup", "the", "JMX", "service", "rmiRegistry", "=", "new", "JmxRegistry", "(", "port", ",", "\"", "jmxrmi", "\"", ",", "rmiServerReference", ")", ";", "final", "RMIJRMPServerImpl", "rmiServer", "=", "new", "RMIJRMPServerImpl", "(", "port", ",", "null", ",", "null", ",", "null", ")", ";", "connector", "=", "new", "RMIConnectorServer", "(", "url", ",", "null", ",", "rmiServer", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "/", "/", "we", "can", "'", "t", "pass", "the", "created", "stub", "directly", "to", "the", "registry", "since", "this", "would", "form", "a", "cyclic", "dependency", ":", "/", "/", "-", "you", "can", "only", "start", "the", "connector", "after", "the", "registry", "was", "started", "/", "/", "-", "you", "can", "only", "create", "the", "stub", "after", "the", "connector", "was", "started", "/", "/", "-", "you", "can", "only", "start", "the", "registry", "after", "the", "stub", "was", "created", "rmiServerReference", ".", "set", "(", "rmiServer", ".", "toStub", "(", "))", ";", "rmiServerReference", ".", "set", "(", "null", ")", ";", "/", "**", "*", "A", "registry", "that", "only", "exposes", "a", "single", "remote", "object", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "restriction", "\"", ")", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "final", "String", "lookupName", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ";", "JmxRegistry", "(", "final", "int", "port", ",", "final", "String", "lookupName", ",", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ")", "throws", "RemoteException", "{", "super", "(", "port", ")", ";", "this", ".", "lookupName", "=", "lookupName", ";", "this", ".", "remoteServerStub", "=", "remoteServerStub", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "s", ")", "throws", "NotBoundException", "{", "if", "(", "lookupName", ".", "equals", "(", "s", ")", ")", "{", "final", "Remote", "remote", "=", "remoteServerStub", ".", "get", "(", ");", "if", "(", "remote", "!", "=", "null", ")", "{", "return", "remote", ";", "}", "}", "throw", "new", "NotBoundException", "(", "\"", "Not", "bound", ".", "\")", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "start", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "unbind", "(", "String", "s", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "stop", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "rebind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "might", "as", "well", "not", "throw", "an", "exception", "here", "given", "that", "the", "others", "don", "'", "t", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "{", "return", "new", "String", "[", "]{", "lookupName", "}", ";", "}", "}", "<", "arg", ">", "--", "add", "-", "exports", "=", "java", ".", "rmi", "/", "sun", ".", "rmi", ".", "registry", "=", "ALL", "-", "UNNAMED", "<", "/", "arg", "></s>import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServerFactory", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "*", "<", "p", ">", "Heavily", "based", "on", "j256", "simplejmx", "project", "startRmiRegistry", "(", "port", ")", ";", "startJmxService", "(", "port", ")", ";", "/", "**", "*", "Starts", "an", "RMI", "Registry", "that", "allows", "clients", "to", "lookup", "the", "JMX", "IP", "/", "port", ".", "*", "*", "@", "param", "port", "rmi", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startRmiRegistry", "(", "int", "port", ")", "throws", "IOException", "{", "rmiRegistry", "=", "LocateRegistry", ".", "createRegistry", "(", "port", ")", ";", "}", "/", "**", "*", "Starts", "a", "JMX", "connector", "that", "allows", "(", "un", ")", "registering", "MBeans", "with", "the", "MBean", "server", "and", "RMI", "invocations", ".", "*", "*", "@", "param", "port", "jmx", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "connector", "=", "JMXConnectorServerFactory", ".", "newJMXConnectorServer", "(", "url", ",", "null", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["x86/dumpstack:", "Don't", "dump", "kernel", "memory", "based", "on", "usermode", "RIP", "show_opcodes()", "is", "used", "both", "for", "dumping", "kernel", "instructions", "and", "for", "dumping", "user", "instructions.", "If", "userspace", "causes", "#PF", "by", "jumping", "to", "a", "kernel", "address,", "show_opcodes()", "can", "be", "reached", "with", "regs->ip", "controlled", "by", "the", "user,", "pointing", "to", "kernel", "code.", "Make", "sure", "that", "userspace", "can't", "trick", "us", "into", "dumping", "kernel", "memory", "into", "dmesg.", "Fixes:", "7cccf0725cf7", "(\"x86/dumpstack:", "Add", "a", "show_ip()", "function\")", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Reviewed-by:", "Kees", "Cook", "<keescook@chromium.org>", "Reviewed-by:", "Borislav", "Petkov", "<bp@suse.de>", "Cc:", "\"H.", "Peter", "Anvin\"", "<hpa@zytor.com>", "Cc:", "Andy", "Lutomirski", "<luto@kernel.org>", "Cc:", "security@kernel.org", "Cc:", "stable@vger.kernel.org", "Link:", "https://lkml.kernel.org/r/20180828154901.112726-1-jannh@google.com"], "code_tokens": ["void", "show_opcodes", "(", "struct", "pt_regs", "*", "regs", ",", "const", "char", "*", "loglvl", ")", ";", "void", "show_opcodes", "(", "struct", "pt_regs", "*", "regs", ",", "const", "char", "*", "loglvl", ")", "unsigned", "long", "prologue", "=", "regs", "-", ">", "ip", "-", "PROLOGUE_SIZE", ";", "bool", "bad_ip", ";", "/", "*", "*", "Make", "sure", "userspace", "isn", "'", "t", "trying", "to", "trick", "us", "into", "dumping", "kernel", "*", "memory", "by", "pointing", "the", "userspace", "instruction", "pointer", "at", "it", ".", "*", "/", "bad_ip", "=", "user_mode", "(", "regs", ")", "&", "&", "__chk_range_not_ok", "(", "prologue", ",", "OPCODE_BUFSIZE", ",", "TASK_SIZE_MAX", ")", ";", "if", "(", "bad_ip", "|", "|", "probe_kernel_read", "(", "opcodes", ",", "(", "u8", "*", ")", "prologue", ",", "OPCODE_BUFSIZE", ")", ")", "{", "show_opcodes", "(", "regs", ",", "loglvl", ")", ";", "show_opcodes", "(", "regs", ",", "loglvl", ")", ";</s>void", "show_opcodes", "(", "u8", "*", "rip", ",", "const", "char", "*", "loglvl", ")", ";", "void", "show_opcodes", "(", "u8", "*", "rip", ",", "const", "char", "*", "loglvl", ")", "if", "(", "probe_kernel_read", "(", "opcodes", ",", "rip", "-", "PROLOGUE_SIZE", ",", "OPCODE_BUFSIZE", ")", ")", "{", "show_opcodes", "(", "(", "u8", "*", ")", "regs", "-", ">", "ip", ",", "loglvl", ")", ";", "show_opcodes", "(", "(", "u8", "*", ")", "regs", "-", ">", "ip", ",", "loglvl", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["userfaultfd:", "hugetlbfs:", "remove", "superfluous", "page", "unlock", "in", "VM_SHARED", "case", "huge_add_to_page_cache->add_to_page_cache", "implicitly", "unlocks", "the", "page", "before", "returning", "in", "case", "of", "errors.", "The", "error", "returned", "was", "-EEXIST", "by", "running", "UFFDIO_COPY", "on", "a", "non-hole", "offset", "of", "a", "VM_SHARED", "hugetlbfs", "mapping.", "It", "was", "an", "userland", "bug", "that", "triggered", "it", "and", "the", "kernel", "must", "cope", "with", "it", "returning", "-EEXIST", "from", "ioctl(UFFDIO_COPY)", "as", "expected.", "page", "dumped", "because:", "VM_BUG_ON_PAGE(!PageLocked(page))", "kernel", "BUG", "at", "mm/filemap.c:964!", "invalid", "opcode:", "0000", "[#1]", "SMP", "CPU:", "1", "PID:", "22582", "Comm:", "qemu-system-x86", "Not", "tainted", "4.11.11-300.fc26.x86_64", "#1", "RIP:", "unlock_page+0x4a/0x50", "Call", "Trace:", "hugetlb_mcopy_atomic_pte+0xc0/0x320", "mcopy_atomic+0x96f/0xbe0", "userfaultfd_ioctl+0x218/0xe90", "do_vfs_ioctl+0xa5/0x600", "SyS_ioctl+0x79/0x90", "entry_SYSCALL_64_fastpath+0x1a/0xa9", "Link:", "http://lkml.kernel.org/r/20170802165145.22628-2-aarcange@redhat.com", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Tested-by:", "Maxime", "Coquelin", "<maxime.coquelin@redhat.com>", "Reviewed-by:", "Mike", "Kravetz", "<mike.kravetz@oracle.com>", "Cc:", "\"Dr.", "David", "Alan", "Gilbert\"", "<dgilbert@redhat.com>", "Cc:", "Mike", "Rapoport", "<rppt@linux.vnet.ibm.com>", "Cc:", "Alexey", "Perevalov", "<a.perevalov@samsung.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["out_release_nounlock", ":</s>out_release_nounlock", ":"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Expand", "HTTP/2", "timeout", "handling", "to", "connection", "window", "exhaustion", "on", "write."], "code_tokens": ["/", "/", "Connection", "level", "window", "is", "empty", ".", "Although", "this", "/", "/", "request", "is", "for", "a", "stream", ",", "use", "the", "connection", "/", "/", "timeout", "long", "writeTimeout", "=", "protocol", ".", "getWriteTimeout", "(", ");", "if", "(", "writeTimeout", "<", "0", ")", "{", "stream", ".", "wait", "(", ");", "}", "else", "{", "stream", ".", "wait", "(", "writeTimeout", ")", ";", "}", "/", "/", "Has", "this", "stream", "been", "granted", "an", "allocation", "int", "[", "]", "value", "=", "backLogStreams", ".", "get", "(", "stream", ")", ";", "if", "(", "value", "[", "1", "]", "=", "=", "0", ")", "{", "/", "/", "No", "allocation", "/", "/", "Close", "the", "connection", ".", "Do", "this", "first", "since", "/", "/", "closing", "the", "stream", "will", "raise", "an", "exception", "close", "(", ");", "/", "/", "Close", "the", "stream", "(", "in", "app", "code", "so", "need", "to", "/", "/", "signal", "to", "app", "stream", "is", "closing", ")", "stream", ".", "doWriteTimeout", "(", ");", "}", "ConnectionState", "previous", "=", "connectionState", ".", "getAndSet", "(", "ConnectionState", ".", "CLOSED", ")", ";", "if", "(", "previous", "=", "=", "ConnectionState", ".", "CLOSED", ")", "{", "/", "/", "Already", "closed", "return", ";", "}", "/", "/", "Release", "any", "streams", "waiting", "for", "an", "allocation", "synchronized", "(", "stream", ")", "{", "stream", ".", "notifyAll", "(", ");", "}", "doWriteTimeout", "(", ");", "void", "doWriteTimeout", "(", ")", "throws", "CloseNowException", "{", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "writeTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Prevent", "the", "application", "making", "further", "writes", "streamOutputBuffer", ".", "closed", "=", "true", ";", "/", "/", "Prevent", "Tomcat", "'", "s", "error", "handling", "trying", "to", "write", "coyoteResponse", ".", "setError", "(", ");", "coyoteResponse", ".", "setErrorReported", "(", ");", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";", "}", "<", "fix", ">", "Expand", "HTTP", "/", "2", "timeout", "handling", "to", "include", "connection", "window", "exhaustion", "on", "write", ".", "(", "markt", ")", "<", "/", "fix", "></s>stream", ".", "wait", "(", ");", "connectionState", ".", "set", "(", "ConnectionState", ".", "CLOSED", ")", ";", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "writeTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Prevent", "the", "application", "making", "further", "writes", "streamOutputBuffer", ".", "closed", "=", "true", ";", "/", "/", "Prevent", "Tomcat", "'", "s", "error", "handling", "trying", "to", "write", "coyoteResponse", ".", "setError", "(", ");", "coyoteResponse", ".", "setErrorReported", "(", ");", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";"], "docstring_tokens": ["failing", "to", "send", "WINDOW_UPDATE", "messages"]}
{"contents": ["[FIXED", "SECURITY-109]", "SECURITY-55", "fix", "to", "BuildTrigger", "configuration", "failed", "if", "downstream", "project", "was", "not", "visible."], "code_tokens": ["List", "<", "AbstractProject", ">", "childProjects", ";", "SecurityContext", "orig", "=", "ACL", ".", "impersonate", "(", "ACL", ".", "SYSTEM", ")", ";", "try", "{", "childProjects", "=", "t", ".", "getChildProjects", "(", "this", ")", ";", "}", "finally", "{", "SecurityContextHolder", ".", "setContext", "(", "orig", ")", ";", "}", "for", "(", "AbstractProject", "downstream", ":", "childProjects", ")", "{", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlTextInput", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "security", ".", "AuthorizationMatrixProperty", ";", "import", "hudson", ".", "security", ".", "LegacySecurityRealm", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "security", ".", "ProjectMatrixAuthorizationStrategy", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "public", "void", "testConfigureDownstreamProjectSecurity", "(", ")", "throws", "Exception", "{", "jenkins", ".", "setSecurityRealm", "(", "new", "LegacySecurityRealm", "(", "))", ";", "ProjectMatrixAuthorizationStrategy", "auth", "=", "new", "ProjectMatrixAuthorizationStrategy", "(", ");", "auth", ".", "add", "(", "Jenkins", ".", "READ", ",", "\"", "alice", "\"", ");", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "FreeStyleProject", "upstream", "=", "createFreeStyleProject", "(", "\"", "upstream", "\"", ");", "Map", "<", "Permission", ",", "Set", "<", "String", ">", ">", "perms", "=", "new", "HashMap", "<", "Permission", ",", "Set", "<", "String", ">", ">(", ");", "perms", ".", "put", "(", "Item", ".", "READ", ",", "Collections", ".", "singleton", "(", "\"", "alice", "\"", "))", ";", "perms", ".", "put", "(", "Item", ".", "CONFIGURE", ",", "Collections", ".", "singleton", "(", "\"", "alice", "\"", "))", ";", "upstream", ".", "addProperty", "(", "new", "AuthorizationMatrixProperty", "(", "perms", ")", ");", "FreeStyleProject", "downstream", "=", "createFreeStyleProject", "(", "\"", "downstream", "\"", ");", "/", "*", "Original", "SECURITY", "-", "55", "test", "case", ":", "downstream", ".", "addProperty", "(", "new", "AuthorizationMatrixProperty", "(", "Collections", ".", "singletonMap", "(", "Item", ".", "READ", ",", "Collections", ".", "singleton", "(", "\"", "alice", "\"", "))", "))", ";", "*", "/", "WebClient", "wc", "=", "createWebClient", "(", ");", "wc", ".", "login", "(", "\"", "alice", "\"", ");", "HtmlPage", "page", "=", "wc", ".", "getPage", "(", "upstream", ",", "\"", "configure", "\"", ");", "HtmlForm", "config", "=", "page", ".", "getFormByName", "(", "\"", "config", "\"", ");", "config", ".", "getButtonByCaption", "(", "\"", "Add", "post", "-", "build", "action", "\"", ").", "click", "(", ");", "/", "/", "lib", "/", "hudson", "/", "project", "/", "config", "-", "publishers2", ".", "jelly", "page", ".", "getAnchorByText", "(", "\"", "Build", "other", "projects", "\"", ").", "click", "(", ");", "HtmlTextInput", "childProjects", "=", "config", ".", "getInputByName", "(", "\"", "buildTrigger", ".", "childProjects", "\"", ");", "childProjects", ".", "setValueAttribute", "(", "\"", "downstream", "\"", ");", "try", "{", "submit", "(", "config", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "x", ")", "{", "assertEquals", "(", "403", ",", "x", ".", "getStatusCode", "(", "))", ";", "}", "assertEquals", "(", "Collections", ".", "emptyList", "(", "),", "upstream", ".", "getDownstreamProjects", "(", "))", ";", "}</s>for", "(", "AbstractProject", "downstream", ":", "t", ".", "getChildProjects", "(", "this", ")", ")", "{"], "docstring_tokens": ["by", "configuring", "a", "job", "to", "trigger", "another", "job", "."]}
{"contents": ["src/pitch/pitchyinfft.c:", "fix", "out", "of", "bound", "read", "when", "samplerate", ">", "50kHz", "(closes:", "#189)"], "code_tokens": ["12500", ".", ",", "15000", ".", ",", "20000", ".", ",", "25100", ".", ",", "-", "1", ".", "while", "(", "freq", ">", "freqs", "[", "j", "]", "&", "&", "freqs", "[", "j", "]", ">", "0", ")", "{", "AUBIO_DBG", "(", "\"", "freq", "%", "3", ".", "5f", ">", "%", "3", ".", "5f", "\\", "tsamplerate", "%", "d", "(", "Hz", ")", "\\", "t", "(", "weight", "length", "%", "d", ",", "bufsize", "%", "d", ")", "%", "d", "%", "d", "\\", "n", "\"", ",", "freq", ",", "freqs", "[", "j", "]", ",", "samplerate", ",", "p", "-", ">", "weight", "-", ">", "length", ",", "bufsize", ",", "i", ",", "j", ")", ";</s>12500", ".", ",", "15000", ".", ",", "20000", ".", ",", "25100", "while", "(", "freq", ">", "freqs", "[", "j", "]", ")", "{"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["Fix", "BZ", "64563", "-", "additional", "payload", "length", "validation", "https://bz.apache.org/bugzilla/show_bug.cgi?id=64563"], "code_tokens": ["wsFrame", ".", "payloadMsbInvalid", "=", "An", "invalid", "WebSocket", "frame", "was", "received", "-", "the", "most", "significant", "bit", "of", "a", "64", "-", "bit", "payload", "was", "illegally", "set", "/", "/", "The", "most", "significant", "bit", "of", "those", "8", "bytes", "is", "required", "to", "be", "zero", "/", "/", "(", "see", "RFC", "6455", ",", "section", "5", ".", "2", ")", ".", "If", "the", "most", "significant", "bit", "is", "set", ",", "/", "/", "the", "resulting", "payload", "length", "will", "be", "negative", "so", "test", "for", "that", ".", "if", "(", "payloadLength", "<", "0", ")", "{", "throw", "new", "WsIOException", "(", "new", "CloseReason", "(", "CloseCodes", ".", "PROTOCOL_ERROR", ",", "sm", ".", "getString", "(", "\"", "wsFrame", ".", "payloadMsbInvalid", "\"", "))", ");", "}", "<", "subsection", "name", "=", "\"", "WebSocket", "\"", ">", "<", "changelog", ">", "<", "fix", ">", "<", "bug", ">", "64563", "<", "/", "bug", ">", ":", "Add", "additional", "validation", "of", "payload", "length", "for", "WebSocket", "messages", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", "></s>"], "docstring_tokens": ["sending", "multiple", "requests", "with", "invalid", "payload", "lengths"]}
{"contents": ["nEPT:", "Nested", "INVEPT", "If", "we", "let", "L1", "use", "EPT,", "we", "should", "probably", "also", "support", "the", "INVEPT", "instruction.", "In", "our", "current", "nested", "EPT", "implementation,", "when", "L1", "changes", "its", "EPT", "table", "for", "L2", "(i.e.,", "EPT12),", "L0", "modifies", "the", "shadow", "EPT", "table", "(EPT02),", "and", "in", "the", "course", "of", "this", "modification", "already", "calls", "INVEPT.", "But", "if", "last", "level", "of", "shadow", "page", "is", "unsync", "not", "all", "L1's", "changes", "to", "EPT12", "are", "intercepted,", "which", "means", "roots", "need", "to", "be", "synced", "when", "L1", "calls", "INVEPT.", "Global", "INVEPT", "should", "not", "be", "different", "since", "roots", "are", "synced", "by", "kvm_mmu_load()", "each", "time", "EPTP02", "changes.", "Reviewed-by:", "Xiao", "Guangrong", "<xiaoguangrong@linux.vnet.ibm.com>", "Signed-off-by:", "Nadav", "Har'El", "<nyh@il.ibm.com>", "Signed-off-by:", "Jun", "Nakajima", "<jun.nakajima@intel.com>", "Signed-off-by:", "Xinhao", "Xu", "<xinhao.xu@intel.com>", "Signed-off-by:", "Yang", "Zhang", "<yang.z.zhang@Intel.com>", "Signed-off-by:", "Gleb", "Natapov", "<gleb@redhat.com>", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["#", "define", "VMX_EPT_EXTENT_SHIFT", "24", "#", "define", "VMX_EPT_INVEPT_BIT", "(", "1ull", "<", "<", "20", ")", "#", "define", "EXIT_REASON_INVEPT", "50", "EXPORT_SYMBOL_GPL", "(", "kvm_mmu_sync_roots", ")", ";", "+", "+", "vcpu", "-", ">", "stat", ".", "tlb_flush", ";", "EXPORT_SYMBOL_GPL", "(", "kvm_mmu_flush_tlb", ")", ";", "static", "unsigned", "long", "nested_ept_get_cr3", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", ";", "static", "u32", "nested_vmx_ept_caps", ";", "/", "*", "Emulate", "the", "INVEPT", "instruction", "*", "/", "static", "int", "handle_invept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "u32", "vmx_instruction_info", ",", "types", ";", "unsigned", "long", "type", ";", "gva_t", "gva", ";", "struct", "x86_exception", "e", ";", "struct", "{", "u64", "eptp", ",", "gpa", ";", "}", "operand", ";", "u64", "eptp_mask", "=", "(", "(", "1ull", "<", "<", "51", ")", "-", "1", ")", "&", "PAGE_MASK", ";", "if", "(", "!(", "nested_vmx_secondary_ctls_high", "&", "SECONDARY_EXEC_ENABLE_EPT", ")", "|", "|", "!", "(", "nested_vmx_ept_caps", "&", "VMX_EPT_INVEPT_BIT", ")", ")", "{", "kvm_queue_exception", "(", "vcpu", ",", "UD_VECTOR", ")", ";", "return", "1", ";", "}", "if", "(", "!", "nested_vmx_check_permission", "(", "vcpu", ")", ")", "return", "1", ";", "if", "(", "!", "kvm_read_cr0_bits", "(", "vcpu", ",", "X86_CR0_PE", ")", ")", "{", "kvm_queue_exception", "(", "vcpu", ",", "UD_VECTOR", ")", ";", "return", "1", ";", "}", "vmx_instruction_info", "=", "vmcs_read32", "(", "VMX_INSTRUCTION_INFO", ")", ";", "type", "=", "kvm_register_read", "(", "vcpu", ",", "(", "vmx_instruction_info", ">", ">", "28", ")", "&", "0xf", ")", ";", "types", "=", "(", "nested_vmx_ept_caps", ">", ">", "VMX_EPT_EXTENT_SHIFT", ")", "&", "6", ";", "if", "(", "!(", "types", "&", "(", "1UL", "<", "<", "type", ")", "))", "{", "nested_vmx_failValid", "(", "vcpu", ",", "VMXERR_INVALID_OPERAND_TO_INVEPT_INVVPID", ")", ";", "return", "1", ";", "}", "/", "*", "According", "to", "the", "Intel", "VMX", "instruction", "reference", ",", "the", "memory", "*", "operand", "is", "read", "even", "if", "it", "isn", "'", "t", "needed", "(", "e", ".", "g", ".", ",", "for", "type", "=", "=", "global", ")", "*", "/", "if", "(", "get_vmx_mem_address", "(", "vcpu", ",", "vmcs_readl", "(", "EXIT_QUALIFICATION", ")", ",", "vmx_instruction_info", ",", "&", "gva", ")", ")", "return", "1", ";", "if", "(", "kvm_read_guest_virt", "(", "&", "vcpu", "-", ">", "arch", ".", "emulate_ctxt", ",", "gva", ",", "&", "operand", ",", "sizeof", "(", "operand", ")", ",", "&", "e", ")", ")", "{", "kvm_inject_page_fault", "(", "vcpu", ",", "&", "e", ")", ";", "return", "1", ";", "}", "switch", "(", "type", ")", "{", "case", "VMX_EPT_EXTENT_CONTEXT", ":", "if", "(", "(", "operand", ".", "eptp", "&", "eptp_mask", ")", "!", "=", "(", "nested_ept_get_cr3", "(", "vcpu", ")", "&", "eptp_mask", ")", ")", "break", ";", "case", "VMX_EPT_EXTENT_GLOBAL", ":", "kvm_mmu_sync_roots", "(", "vcpu", ")", ";", "kvm_mmu_flush_tlb", "(", "vcpu", ")", ";", "nested_vmx_succeed", "(", "vcpu", ")", ";", "break", ";", "default", ":", "BUG_ON", "(", "1", ")", ";", "break", ";", "}", "skip_emulated_instruction", "(", "vcpu", ")", ";", "return", "1", ";", "}", "[", "EXIT_REASON_INVEPT", "]", "=", "handle_invept", ",", "case", "EXIT_REASON_INVEPT", ":</s>"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Update", "to", "ActiveMQ", "5.15.12"], "code_tokens": ["import", "org", ".", "apache", ".", "activemq", ".", "broker", ".", "jmx", ".", "ManagementContext", ";", "final", "ManagementContext", "managementContext", "=", "new", "ManagementContext", "(", ");", "managementContext", ".", "setCreateConnector", "(", "false", ")", ";", "broker", ".", "setManagementContext", "(", "managementContext", ")", ";", "<", "org", ".", "apache", ".", "activemq", ".", "version", ">", "5", ".", "15", ".", "12", "<", "/", "org", ".", "apache", ".", "activemq", ".", "version", "></s><", "org", ".", "apache", ".", "activemq", ".", "version", ">", "5", ".", "15", ".", "10", "<", "/", "org", ".", "apache", ".", "activemq", ".", "version", ">"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["pohmelfs/connector:", "Disallow", "unpliviged", "users", "to", "configure", "pohmelfs", "Signed-off-by:", "Philipp", "Reisner", "<philipp.reisner@linbit.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "cap_raised", "(", "nsp", "-", ">", "eff_cap", ",", "CAP_SYS_ADMIN", ")", ")", "return", ";</s>"], "docstring_tokens": ["via", "calls", "to", "functions", "in", "these", "subsystems", "."]}
{"contents": ["crypto:", "mcryptd", "-", "Check", "mcryptd", "algorithm", "compatibility", "Algorithms", "not", "compatible", "with", "mcryptd", "could", "be", "spawned", "by", "mcryptd", "with", "a", "direct", "crypto_alloc_tfm", "invocation", "using", "a", "\"mcryptd(alg)\"", "name", "construct.", "This", "causes", "mcryptd", "to", "crash", "the", "kernel", "if", "an", "arbitrary", "\"alg\"", "is", "incompatible", "and", "not", "intended", "to", "be", "used", "with", "mcryptd.", "It", "is", "an", "issue", "if", "AF_ALG", "tries", "to", "spawn", "mcryptd(alg)", "to", "expose", "it", "externally.", "But", "such", "algorithms", "must", "be", "used", "internally", "and", "not", "be", "exposed.", "We", "added", "a", "check", "to", "enforce", "that", "only", "internal", "algorithms", "are", "allowed", "with", "mcryptd", "at", "the", "time", "mcryptd", "is", "spawning", "an", "algorithm.", "Link:", "http://marc.info/?l=linux-crypto-vger&m=148063683310477&w=2", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Mikulas", "Patocka", "<mpatocka@redhat.com>", "Signed-off-by:", "Tim", "Chen", "<tim.c.chen@linux.intel.com>", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>"], "code_tokens": ["static", "inline", "bool", "mcryptd_check_internal", "(", "struct", "rtattr", "*", "*", "tb", ",", "u32", "*", "type", ",", "return", "false", ";", "*", "type", "|", "=", "algt", "-", ">", "type", "&", "CRYPTO_ALG_INTERNAL", ";", "*", "mask", "|", "=", "algt", "-", ">", "mask", "&", "CRYPTO_ALG_INTERNAL", ";", "if", "(", "*", "type", "&", "*", "mask", "&", "CRYPTO_ALG_INTERNAL", ")", "return", "true", ";", "else", "return", "false", ";", "if", "(", "!", "mcryptd_check_internal", "(", "tb", ",", "&", "type", ",", "&", "mask", ")", ")", "return", "-", "EINVAL", ";</s>static", "inline", "void", "mcryptd_check_internal", "(", "struct", "rtattr", "*", "*", "tb", ",", "u32", "*", "type", ",", "return", ";", "if", "(", "(", "algt", "-", ">", "type", "&", "CRYPTO_ALG_INTERNAL", ")", ")", "*", "type", "|", "=", "CRYPTO_ALG_INTERNAL", ";", "if", "(", "(", "algt", "-", ">", "mask", "&", "CRYPTO_ALG_INTERNAL", ")", ")", "*", "mask", "|", "=", "CRYPTO_ALG_INTERNAL", ";", "mcryptd_check_internal", "(", "tb", ",", "&", "type", ",", "&", "mask", ")", ";"], "docstring_tokens": ["using", "an", "AF_ALG", "socket", "with", "an", "incompatible", "algorithm"]}
{"contents": ["Bluetooth:", "SCO", "-", "Fix", "missing", "msg_namelen", "update", "in", "sco_sock_recvmsg()", "If", "the", "socket", "is", "in", "state", "BT_CONNECT2", "and", "BT_SK_DEFER_SETUP", "is", "set", "in", "the", "flags,", "sco_sock_recvmsg()", "returns", "early", "with", "0", "without", "updating", "the", "possibly", "set", "msg_namelen", "member.", "This,", "in", "turn,", "leads", "to", "a", "128", "byte", "kernel", "stack", "leak", "in", "net/socket.c.", "Fix", "this", "by", "updating", "msg_namelen", "in", "this", "case.", "For", "all", "other", "cases", "it", "will", "be", "handled", "in", "bt_sock_recvmsg().", "Cc:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Cc:", "Gustavo", "Padovan", "<gustavo@padovan.org>", "Cc:", "Johan", "Hedberg", "<johan.hedberg@gmail.com>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["msg", "-", ">", "msg_namelen", "=", "0", ";</s>"], "docstring_tokens": ["using", "recvmsg(2)/recvfrom(2)"]}
{"contents": ["binfmt_elf:", "switch", "to", "new", "creds", "when", "switching", "to", "new", "mm", "We", "used", "to", "delay", "switching", "to", "the", "new", "credentials", "until", "after", "we", "had", "mapped", "the", "executable", "(and", "possible", "elf", "interpreter).", "That", "was", "kind", "of", "odd", "to", "begin", "with,", "since", "the", "new", "executable", "will", "actually", "then", "_run_", "with", "the", "new", "creds,", "but", "whatever.", "The", "bigger", "problem", "was", "that", "we", "also", "want", "to", "make", "sure", "that", "we", "turn", "off", "prof", "events", "and", "tracing", "before", "we", "start", "mapping", "the", "new", "executable", "state.", "So", "while", "this", "is", "a", "cleanup,", "it's", "also", "a", "fix", "for", "a", "possible", "information", "leak.", "Reported-by:", "Robert", "\u015awi\u0119cki", "<robert@swiecki.net>", "Tested-by:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Acked-by:", "David", "Howells", "<dhowells@redhat.com>", "Acked-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Acked-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Acked-by:", "Eric", "W.", "Biederman", "<ebiederm@xmission.com>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Cc:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["install_exec_creds", "(", "bprm", ")", ";</s>install_exec_creds", "(", "bprm", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Consolidate", "credential", "access", "paths", "We", "now", "use", "the", "CredentialHandler", "as", "the", "consistent", "access", "path", "for", "credentials.", "Consequently,", "it", "must", "return", "Credentials", "instead", "of", "views.", "[Finishes", "#149701173]"], "code_tokens": ["public", "Map", "<", "String", ",", "Object", ">", "interpolate", "(", "@", "RequestBody", "Map", "<", "String", ",", "Object", ">", "requestBody", ",", "UserContext", "userContext", ")", "{", "return", "eventAuditLogService", ".", "auditEvents", "(", "requestUuid", ",", "userContext", ",", "(", "eventAuditRecordParametersList", "-", ">", ".", "interpolateCredHubReferences", "(", "userContext", ",", "requestBody", ",", "eventAuditRecordParametersList", ")", ")", "import", "io", ".", "pivotal", ".", "security", ".", "domain", ".", "Credential", ";", "import", "static", "java", ".", "util", ".", "Collections", ".", "singletonList", ";", "return", "eventAuditLogService", ".", "auditEvents", "(", "requestUuid", ",", "userContext", ",", "eventAuditRecordParametersList", "-", ">", "{", "Credential", "credentialVersion", "=", "credentialHandler", ".", "getCredentialVersion", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "id", ")", ";", "return", "CredentialView", ".", "fromEntity", "(", "credentialVersion", ")", ";", "}", ");", "List", "<", "Credential", ">", "credentials", ";", "Credential", "credential", "=", "credentialHandler", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "credentialName", ")", ";", "credentials", "=", "singletonList", "(", "credential", ")", ";", "credentials", "=", "credentialHandler", ".", "getAllCredentialVersions", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "credentialName", ")", ";", "return", "DataResponse", ".", "fromEntity", "(", "credentials", ")", ";", "public", "List", "<", "Credential", ">", "getAllCredentialVersions", "(", "return", "credentials", ";", "public", "Credential", "getMostRecentCredentialVersion", "(", "return", "credential", ";", "public", "Credential", "getCredentialVersion", "(", "return", "getVersionByIdentifier", "(", ")", ";", "import", "io", ".", "pivotal", ".", "security", ".", "auth", ".", "UserContext", ";", "import", "io", ".", "pivotal", ".", "security", ".", "handler", ".", "CredentialHandler", ";", "private", "final", "CredentialHandler", "credentialHandler", ";", "public", "JsonInterpolationService", "(", "CredentialHandler", "credentialHandler", ")", "{", "this", ".", "credentialHandler", "=", "credentialHandler", ";", "public", "Map", "<", "String", ",", "Object", ">", "interpolateCredHubReferences", "(", "UserContext", "userContext", ",", "Map", "<", "String", ",", "Object", ">", "servicesMap", ",", "List", "<", "EventAuditRecordParameters", ">", "eventAuditRecordParametersList", ")", "{", "Credential", "credential", "=", "credentialHandler", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "credentialName", ")", ";", "List", "<", "Credential", ">", "credentialVersions", "=", "subject", ".", "getAllCredentialVersions", "(", "userContext", ",", "assertThat", "(", "credentialVersions", ",", "hasSize", "(", "2", ")", ");", "assertThat", "(", "credentialVersions", ".", "get", "(", "0", ")", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "credentialVersions", ".", "get", "(", "0", ")", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION1_CREATED_AT", ")", ");", "assertThat", "(", "credentialVersions", ".", "get", "(", "1", ")", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "credentialVersions", ".", "get", "(", "1", ")", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION2_CREATED_AT", ")", ");", "Credential", "credential", "=", "subject", ".", "getMostRecentCredentialVersion", "(", "assertThat", "(", "credential", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "credential", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION1_CREATED_AT", ")", ");", "Credential", "credential", "=", "subject", ".", "getCredentialVersion", "(", "assertThat", "(", "credential", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "credential", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION1_CREATED_AT", ")", ");", "import", "org", ".", "springframework", ".", "http", ".", "MediaType", ";", "@", "Test", "public", "void", "interpolate_whenTheUserHasAccessToAllReferencedCredentials_returnsInterpolatedBody", "(", ")", "throws", "Exception", "{", "makeJsonCredential", "(", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ",", "\"", "secret1", "\"", ");", "makeJsonCredential", "(", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ",", "\"", "secret2", "\"", ");", "MockHttpServletRequestBuilder", "request", "=", "post", "(", "\"/", "api", "/", "v1", "/", "interpolate", "\"", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "content", "(", "\"", "{\"", "\"", "\\", "\"", "pp", "-", "config", "-", "server", "\\", "\":", "[", "\"", "\"", "{", "\"", "\"", "\\", "\"", "credentials", "\\", "\":", "{", "\"", "\"", "\\", "\"", "credhub", "-", "ref", "\\", "\":", "\\", "\"(", "(/", "secret1", ")", ")\\", "\"\"", "\"", "}", ",\"", "\"", "\\", "\"", "label", "\\", "\":", "\\", "\"", "pp", "-", "config", "-", "server", "\\", "\"\"", "\"", "}", "\"", "\"", "]", ",\"", "\"", "\\", "\"", "pp", "-", "something", "-", "else", "\\", "\":", "[", "\"", "\"", "{", "\"", "\"", "\\", "\"", "credentials", "\\", "\":", "{", "\"", "\"", "\\", "\"", "credhub", "-", "ref", "\\", "\":", "\\", "\"(", "(/", "secret2", ")", ")\\", "\"\"", "\"", "}", ",\"", "\"", "\\", "\"", "something", "\\", "\":", "[", "\\\"", "pp", "-", "config", "-", "server", "\\", "\"]", "\"", "\"", "}", "\"", "\"", "]", "\"", "\"", "}", "\"", ")", ";", "this", ".", "mockMvc", ".", "perform", "(", "request", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "pp", "-", "config", "-", "server", "[", "0", "]", ".", "credentials", ".", "secret1", "\"", ")", ".", "value", "(", "equalTo", "(", "\"", "secret1", "-", "value", "\"", "))", ")", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "pp", "-", "something", "-", "else", "[", "0", "]", ".", "credentials", ".", "secret2", "\"", ")", ".", "value", "(", "equalTo", "(", "\"", "secret2", "-", "value", "\"", "))", ");", "}", "@", "Test", "public", "void", "interpolate_whenTheUserDoesNotHaveAccessToAllReferencedCredentials_returnsAnError", "(", ")", "throws", "Exception", "{", "makeJsonCredential", "(", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ",", "\"", "secret1", "\"", ");", "makeJsonCredential", "(", "UAA_OAUTH2_CLIENT_CREDENTIALS_TOKEN", ",", "\"", "secret2", "\"", ");", "MockHttpServletRequestBuilder", "request", "=", "post", "(", "\"/", "api", "/", "v1", "/", "interpolate", "\"", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "UAA_OAUTH2_PASSWORD_GRANT_TOKEN", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "content", "(", "\"", "{\"", "\"", "\\", "\"", "pp", "-", "config", "-", "server", "\\", "\":", "[", "\"", "\"", "{", "\"", "\"", "\\", "\"", "credentials", "\\", "\":", "{", "\"", "\"", "\\", "\"", "credhub", "-", "ref", "\\", "\":", "\\", "\"(", "(/", "secret1", ")", ")\\", "\"\"", "\"", "}", ",\"", "\"", "\\", "\"", "label", "\\", "\":", "\\", "\"", "pp", "-", "config", "-", "server", "\\", "\"\"", "\"", "}", "\"", "\"", "]", ",\"", "\"", "\\", "\"", "pp", "-", "something", "-", "else", "\\", "\":", "[", "\"", "\"", "{", "\"", "\"", "\\", "\"", "credentials", "\\", "\":", "{", "\"", "\"", "\\", "\"", "credhub", "-", "ref", "\\", "\":", "\\", "\"(", "(/", "secret2", ")", ")\\", "\"\"", "\"", "}", ",\"", "\"", "\\", "\"", "something", "\\", "\":", "[", "\\\"", "pp", "-", "config", "-", "server", "\\", "\"]", "\"", "\"", "}", "\"", "\"", "]", "\"", "\"", "}", "\"", ")", ";", "String", "expectedError", "=", "\"", "The", "request", "could", "not", "be", "completed", "because", "the", "credential", "does", "not", "exist", "or", "you", "do", "not", "have", "sufficient", "authorization", ".", "\";", "this", ".", "mockMvc", ".", "perform", "(", "request", ")", ".", "andExpect", "(", "status", "(", ").", "isNotFound", "(", "))", ".", "andExpect", "(", "jsonPath", "(", "\"$", ".", "error", "\"", ",", "equalTo", "(", "expectedError", ")", "))", ";", "}", "private", "void", "makeJsonCredential", "(", "String", "userToken", ",", "String", "credentialName", ")", "throws", "Exception", "{", "MockHttpServletRequestBuilder", "createRequest1", "=", "put", "(", "\"/", "api", "/", "v1", "/", "data", "\"", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "userToken", ")", ".", "contentType", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "content", "(", "\"", "{\"", "\"", "\\\"", "name", "\\", "\":", "\\\"", "\"", "+", "credentialName", "+", "\"", "\\\"", ",\"", "\"", "\\\"", "type", "\\", "\":", "\\\"", "json", "\\", "\",", "\"", "\"", "\\\"", "value", "\\", "\":", "{\"", "\"", "\\\"", "\"", "+", "credentialName", "+", "\"", "\\\"", ":\\", "\"\"", "+", "credentialName", "+", "\"", "-", "value", "\\", "\"\"", "\"", "}\"", "\"", "}\"", ")", ";", "this", ".", "mockMvc", ".", "perform", "(", "createRequest1", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", "}", "import", "io", ".", "pivotal", ".", "security", ".", "auth", ".", "UserContext", ";", "import", "io", ".", "pivotal", ".", "security", ".", "handler", ".", "CredentialHandler", ";", "import", "static", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "CollectionHelper", ".", "newArrayList", ";", "private", "CredentialHandler", "credentialHandler", ";", "private", "UserContext", "userContext", ";", "credentialHandler", "=", "mock", "(", "CredentialHandler", ".", "class", ")", ";", "userContext", "=", "mock", "(", "UserContext", ".", "class", ")", ";", "subject", "=", "new", "JsonInterpolationService", "(", "credentialHandler", ")", ";", ")", ".", "when", "(", "credentialHandler", ")", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "eventAuditRecordParameters", ",", "\"/", "password_cred", "\"", ");", "subject", ".", "interpolateCredHubReferences", "(", "userContext", ",", "deserialize", "(", "inputJson", ",", "Map", ".", "class", ")", ",", "eventAuditRecordParameters", ")", ";", "+", "\"", "}", "]\"", "+", "\"", "}\"", ",", "Map", ".", "class", ")", ";", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "+", "\"", "}", "]\"", "+", "\"", "}\"", ",", "Map", ".", "class", ")", ";", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "+", "\"", "}\"", ";", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "+", "\"", "}\"", ";", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "+", "\"", "}\"", ";", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "+", "\"", "}", "\"", "+", "\"", "}\"", ";", "Map", "response", "=", "subject", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ")", ".", "when", "(", "credentialHandler", ")", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "newArrayList", "(", "),", "\"", "/", "cred1", "\"", ");", ")", ".", "when", "(", "credentialHandler", ")", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "newArrayList", "(", "),", "\"", "/", "cred2", "\"", ");", ")", ".", "when", "(", "credentialHandler", ")", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "newArrayList", "(", "),", "\"", "/", "cred3", "\"", ");", "response", "=", "subject", ".", "interpolateCredHubReferences", "(", "userContext", ",", "inputJson", ",", "eventAuditRecordParameters", ")", ";</s>public", "Map", "<", "String", ",", "Object", ">", "interpolate", "(", "@", "RequestBody", "Map", "<", "String", ",", "Object", ">", "requestBody", ",", "UserContext", "userContext", ")", "{", "return", "eventAuditLogService", ".", "auditEvents", "(", "requestUuid", ",", "userContext", ",", "(", "eventAuditRecordParameters", "-", ">", ".", "interpolateCredHubReferences", "(", "requestBody", ",", "eventAuditRecordParameters", ")", ")", "return", "eventAuditLogService", ".", "auditEvents", "(", "requestUuid", ",", "userContext", ",", "eventAuditRecordParametersList", "-", ">", "(", "credentialHandler", ".", "getCredentialVersion", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "id", ")", ")", ");", "return", "credentialHandler", ".", "getMostRecentCredentialVersion", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "credentialName", ")", ";", "return", "credentialHandler", ".", "getAllCredentialVersions", "(", "userContext", ",", "eventAuditRecordParametersList", ",", "credentialName", ")", ";", "import", "io", ".", "pivotal", ".", "security", ".", "view", ".", "CredentialView", ";", "import", "io", ".", "pivotal", ".", "security", ".", "view", ".", "DataResponse", ";", "import", "static", "java", ".", "util", ".", "Collections", ".", "singletonList", ";", "public", "DataResponse", "getAllCredentialVersions", "(", "return", "DataResponse", ".", "fromEntity", "(", "credentials", ")", ";", "public", "DataResponse", "getMostRecentCredentialVersion", "(", "return", "DataResponse", ".", "fromEntity", "(", "singletonList", "(", "credential", ")", ");", "public", "CredentialView", "getCredentialVersion", "(", "return", "CredentialView", ".", "fromEntity", "(", "getVersionByIdentifier", "(", ")", ");", "import", "io", ".", "pivotal", ".", "security", ".", "data", ".", "CredentialDataService", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "audit", ".", "AuditingOperationCode", ".", "CREDENTIAL_ACCESS", ";", "private", "CredentialDataService", "credentialDataService", ";", "public", "JsonInterpolationService", "(", "CredentialDataService", "credentialDataService", ")", "{", "this", ".", "credentialDataService", "=", "credentialDataService", ";", "public", "Map", "<", "String", ",", "Object", ">", "interpolateCredHubReferences", "(", "Map", "<", "String", ",", "Object", ">", "servicesMap", ",", "List", "<", "EventAuditRecordParameters", ">", "eventAuditRecordParameters", ")", "{", "Credential", "credential", "=", "credentialDataService", ".", "findMostRecent", "(", "credentialName", ")", ";", "if", "(", "credential", "=", "=", "null", ")", "{", "eventAuditRecordParameters", ".", "add", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "credentialName", ")", ");", "throw", "new", "ParameterizedValidationException", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", ");", "}", "eventAuditRecordParameters", ".", "add", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "credential", ".", "getName", "(", "))", ");", "import", "io", ".", "pivotal", ".", "security", ".", "view", ".", "CredentialView", ";", "import", "io", ".", "pivotal", ".", "security", ".", "view", ".", "DataResponse", ";", "DataResponse", "response", "=", "subject", ".", "getAllCredentialVersions", "(", "userContext", ",", "List", "<", "CredentialView", ">", "responseCredentials", "=", "response", ".", "getData", "(", ");", "assertThat", "(", "responseCredentials", ",", "hasSize", "(", "2", ")", ");", "assertThat", "(", "responseCredentials", ".", "get", "(", "0", ")", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "responseCredentials", ".", "get", "(", "0", ")", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION1_CREATED_AT", ")", ");", "assertThat", "(", "responseCredentials", ".", "get", "(", "1", ")", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "responseCredentials", ".", "get", "(", "1", ")", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION2_CREATED_AT", ")", ");", "DataResponse", "response", "=", "subject", ".", "getMostRecentCredentialVersion", "(", "List", "<", "CredentialView", ">", "responseCredentials", "=", "response", ".", "getData", "(", ");", "assertThat", "(", "responseCredentials", ",", "hasSize", "(", "1", ")", ");", "assertThat", "(", "responseCredentials", ".", "get", "(", "0", ")", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "responseCredentials", ".", "get", "(", "0", ")", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION1_CREATED_AT", ")", ");", "CredentialView", "response", "=", "subject", ".", "getCredentialVersion", "(", "assertThat", "(", "response", ".", "getName", "(", "),", "equalTo", "(", "CREDENTIAL_NAME", ")", ");", "assertThat", "(", "response", ".", "getVersionCreatedAt", "(", "),", "equalTo", "(", "VERSION1_CREATED_AT", ")", ");", "import", "io", ".", "pivotal", ".", "security", ".", "data", ".", "CredentialDataService", ";", "import", "static", "io", ".", "pivotal", ".", "security", ".", "audit", ".", "AuditingOperationCode", ".", "CREDENTIAL_ACCESS", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "contains", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsInAnyOrder", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "samePropertyValuesAs", ";", "private", "CredentialDataService", "credentialDataService", ";", "credentialDataService", "=", "mock", "(", "CredentialDataService", ".", "class", ")", ";", "subject", "=", "new", "JsonInterpolationService", "(", "credentialDataService", ")", ";", "@", "Test", "public", "void", "interpolateCredHubReferences_updatesTheEventAuditRecordParameters", "(", ")", "throws", "Exception", "{", "setupValidRequest", "(", ");", "assertThat", "(", "eventAuditRecordParameters", ",", "hasSize", "(", "3", ")", ");", "assertThat", "(", "eventAuditRecordParameters", ",", "containsInAnyOrder", "(", "samePropertyValuesAs", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "\"", "/", "cred1", "\"", "))", ",", "samePropertyValuesAs", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "\"", "/", "cred2", "\"", "))", ",", "samePropertyValuesAs", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "\"", "/", "cred3", "\"", "))", "))", ";", "}", ")", ".", "when", "(", "credentialDataService", ")", ".", "findMostRecent", "(", "\"/", "password_cred", "\"", ");", "subject", ".", "interpolateCredHubReferences", "(", "deserialize", "(", "inputJson", ",", "Map", ".", "class", ")", ",", "eventAuditRecordParameters", ")", ";", "assertThat", "(", "eventAuditRecordParameters", ",", "hasSize", "(", "1", ")", ");", "assertThat", "(", "eventAuditRecordParameters", ",", "contains", "(", "samePropertyValuesAs", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "\"", "/", "password_cred", "\"", "))", ")", ");", "@", "Test", "public", "void", "interpolateCredHubReferences_whenAReferencedCredentialDoesNotExist_itThrowsAnException", "(", ")", "{", "String", "inputJsonString", "=", "\"", "{\"", "+", "\"", "\\", "\"", "pp", "-", "config", "-", "server", "\\", "\":", "[", "\"", "+", "\"", "{", "\"", "+", "\"", "\\", "\"", "credentials", "\\", "\":", "{", "\"", "+", "\"", "\\", "\"", "credhub", "-", "ref", "\\", "\":", "\\", "\"(", "(/", "missing_cred", ")", ")\\", "\"\"", "+", "\"", "}", ",\"", "+", "\"", "\\", "\"", "label", "\\", "\":", "\\", "\"", "pp", "-", "config", "-", "server", "\\", "\"\"", "+", "\"", "}", "\"", "+", "\"", "]", "\"", "+", "\"", "}\"", ";", "Map", "<", "String", ",", "Object", ">", "inputJson", "=", "deserialize", "(", "inputJsonString", ",", "Map", ".", "class", ")", ";", "doReturn", "(", "null", ")", ".", "when", "(", "credentialDataService", ")", ".", "findMostRecent", "(", "\"/", "missing_cred", "\"", ");", "try", "{", "subject", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "}", "catch", "(", "ParameterizedValidationException", "exception", ")", "{", "assertThat", "(", "exception", ".", "getMessage", "(", "),", "equalTo", "(", "\"", "error", ".", "credential", ".", "invalid_access", "\"", "))", ";", "assertThat", "(", "eventAuditRecordParameters", ",", "hasSize", "(", "1", ")", ");", "assertThat", "(", "eventAuditRecordParameters", ",", "contains", "(", "samePropertyValuesAs", "(", "new", "EventAuditRecordParameters", "(", "CREDENTIAL_ACCESS", ",", "\"", "/", "missing_cred", "\"", "))", ")", ");", "}", "}", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", "Map", "response", "=", "subject", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";", ")", ".", "when", "(", "credentialDataService", ")", ".", "findMostRecent", "(", "\"/", "cred1", "\"", ");", ")", ".", "when", "(", "credentialDataService", ")", ".", "findMostRecent", "(", "\"/", "cred2", "\"", ");", ")", ".", "when", "(", "credentialDataService", ")", ".", "findMostRecent", "(", "\"/", "cred3", "\"", ");", "response", "=", "subject", ".", "interpolateCredHubReferences", "(", "inputJson", ",", "eventAuditRecordParameters", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Detect", "invalid", "port", "in", "xp_socket", "parse", "ip", "address", "For", "historical", "reasons,", "fsockopen()", "accepts", "the", "port", "and", "hostname", "separately:", "fsockopen('127.0.0.1',", "80)", "However,", "with", "the", "introdcution", "of", "stream", "transports", "in", "PHP", "4.3,", "it", "became", "possible", "to", "include", "the", "port", "in", "the", "hostname", "specifier:", "fsockopen('127.0.0.1:80')", "Or", "more", "formally:", "fsockopen('tcp://127.0.0.1:80')", "Confusing", "results", "when", "these", "two", "forms", "are", "combined,", "however.", "fsockopen('127.0.0.1:80',", "443)", "results", "in", "fsockopen()", "attempting", "to", "connect", "to", "'127.0.0.1:80:443'", "which", "any", "reasonable", "stack", "would", "consider", "invalid.", "Unfortunately,", "PHP", "parses", "the", "address", "looking", "for", "the", "first", "colon", "(with", "special", "handling", "for", "IPv6,", "don't", "worry)", "and", "calls", "atoi()", "from", "there.", "atoi()", "in", "turn,", "simply", "stops", "parsing", "at", "the", "first", "non-numeric", "character", "and", "returns", "the", "value", "so", "far.", "The", "end", "result", "is", "that", "the", "explicitly", "supplied", "port", "is", "treated", "as", "ignored", "garbage,", "rather", "than", "producing", "an", "error.", "This", "diff", "replaces", "atoi()", "with", "strtol()", "and", "inspects", "the", "stop", "character.", "If", "additional", "\"garbage\"", "of", "any", "kind", "is", "found,", "it", "fails", "and", "returns", "an", "error."], "code_tokens": ["-", "-", "TEST", "-", "-", "Use", "of", "double", "-", "port", "in", "fsockopen", "(", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "try", "=", "[", "'", "127", ".", "0", ".", "0", ".", "1", ":", "80", "'", ",", "'", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "80", "'", ",", "'", "[:", ":", "1", "]", ":", "80", "'", ",", "'", "tcp", ":", "//", "[:", ":", "1", "]", ":", "80", "'", ",", "'", "localhost", ":", "80", "'", ",", "'", "tcp", ":", "//", "localhost", ":", "80", "'", ",", "]", ";", "foreach", "(", "$", "try", "as", "$", "addr", ")", "{", "echo", "\"", "==", "$", "addr", "=", "=\\", "n", "\"", ";", "var_dump", "(", "@", "fsockopen", "(", "$", "addr", ",", "81", ",", "$", "errno", ",", "$", "errstr", ")", ",", "$", "errstr", ")", ";", "}", "-", "-", "EXPECTF", "-", "-", "=", "=", "127", ".", "0", ".", "0", ".", "1", ":", "80", "=", "=", "bool", "(", "false", ")", "string", "(", "41", ")", "\"", "Failed", "to", "parse", "address", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "80", ":", "81", "\"", "\"", "=", "=", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "80", "=", "=", "bool", "(", "false", ")", "string", "(", "41", ")", "\"", "Failed", "to", "parse", "address", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "80", ":", "81", "\"", "\"", "=", "=", "[", "::", "1", "]", ":", "80", "=", "=", "bool", "(", "false", ")", "string", "(", "37", ")", "\"", "Failed", "to", "parse", "address", "\"", "[:", ":", "1", "]", ":", "80", ":", "81", "\"", "\"", "=", "=", "tcp", ":", "//", "[:", ":", "1", "]", ":", "80", "=", "=", "bool", "(", "false", ")", "string", "(", "37", ")", "\"", "Failed", "to", "parse", "address", "\"", "[:", ":", "1", "]", ":", "80", ":", "81", "\"", "\"", "=", "=", "localhost", ":", "80", "=", "=", "bool", "(", "false", ")", "string", "(", "41", ")", "\"", "Failed", "to", "parse", "address", "\"", "localhost", ":", "80", ":", "81", "\"", "\"", "=", "=", "tcp", ":", "//", "localhost", ":", "80", "=", "=", "bool", "(", "false", ")", "string", "(", "41", ")", "\"", "Failed", "to", "parse", "address", "\"", "localhost", ":", "80", ":", "81", "\"", "\"", "char", "*", "p", "=", "memchr", "(", "str", "+", "1", ",", "'", "]'", ",", "str_len", "-", "2", ")", ",", "*", "e", "=", "NULL", ";", "*", "portno", "=", "strtol", "(", "p", "+", "2", ",", "&", "e", ",", "10", ")", ";", "if", "(", "e", "&", "&", "*", "e", ")", "{", "if", "(", "get_err", ")", "{", "*", "err", "=", "strpprintf", "(", "0", ",", "\"", "Failed", "to", "parse", "address", "\\", "\"%", "s", "\\", "\"\"", ",", "str", ")", ";", "}", "return", "NULL", ";", "}", "char", "*", "e", "=", "NULL", ";", "*", "portno", "=", "strtol", "(", "colon", "+", "1", ",", "&", "e", ",", "10", ")", ";", "if", "(", "!", "e", "|", "|", "!", "*", "e", ")", "{", "return", "estrndup", "(", "str", ",", "colon", "-", "str", ")", ";", "if", "(", "get_err", ")", "{", "*", "err", "=", "strpprintf", "(", "0", ",", "\"", "Failed", "to", "parse", "address", "\\", "\"%", "s", "\\", "\"\"", ",", "str", ")", ";", "}", "return", "NULL", ";</s>char", "*", "p", ";", "p", "=", "memchr", "(", "str", "+", "1", ",", "'", "]'", ",", "str_len", "-", "2", ")", ";", "*", "portno", "=", "atoi", "(", "p", "+", "2", ")", ";", "*", "portno", "=", "atoi", "(", "colon", "+", "1", ")", ";", "host", "=", "estrndup", "(", "str", ",", "colon", "-", "str", ")", ";", "}", "else", "{", "if", "(", "get_err", ")", "{", "*", "err", "=", "strpprintf", "(", "0", ",", "\"", "Failed", "to", "parse", "address", "\\", "\"%", "s", "\\", "\"\"", ",", "str", ")", ";", "return", "NULL", ";", "return", "host", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "argument"]}
{"contents": ["SCTP:", "Clean", "up", "OOTB", "handling", "and", "fix", "infinite", "loop", "processing", "While", "processing", "OOTB", "chunks", "as", "well", "as", "chunks", "with", "an", "invalid", "length", "of", "0,", "it", "was", "possible", "to", "SCTP", "to", "get", "wedged", "inside", "an", "infinite", "loop", "because", "we", "didn't", "catch", "the", "condition", "correctly,", "or", "didn't", "mark", "the", "packet", "for", "discard", "correctly.", "This", "work", "is", "based", "on", "original", "findings", "and", "work", "by", "Wei", "Yongjun", "<yjwei@cn.fujitsu.com>", "Signed-off-by:", "Vlad", "Yasevich", "<vladislav.yasevich@hp.com>"], "code_tokens": ["static", "sctp_disposition_t", "sctp_sf_tabort_8_4_8", "(", "const", "struct", "sctp_endpoint", "*", "ep", ",", "const", "struct", "sctp_association", "*", "asoc", ",", "const", "sctp_subtype_t", "type", ",", "void", "*", "arg", ",", "sctp_cmd_seq_t", "*", "commands", ")", ";", "const", "struct", "sctp_endpoint", "*", "ep", ",", "static", "sctp_disposition_t", "sctp_sf_violation_chunk", "(", "const", "struct", "sctp_endpoint", "*", "ep", ",", "const", "struct", "sctp_association", "*", "asoc", ",", "const", "sctp_subtype_t", "type", ",", "void", "*", "arg", ",", "sctp_cmd_seq_t", "*", "commands", ")", ";", "if", "(", "!", "sctp_vtag_verify_either", "(", "chunk", ",", "asoc", ")", ")", "return", "sctp_sf_pdiscard", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "return", "sctp_sf_violation_chunk", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "/", "*", "Make", "sure", "that", "the", "SHUTDOWN_COMPLETE", "chunk", "has", "a", "valid", "length", ".", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_chunkhdr_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "return", "sctp_sf_violation_chunk", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "/", "*", "Make", "sure", "that", "the", "INIT", "-", "ACK", "chunk", "has", "a", "valid", "length", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_initack_chunk_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "return", "sctp_sf_tabort_8_4_8", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "/", "*", "Make", "sure", "that", "the", "chunk", "has", "a", "valid", "length", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_chunkhdr_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "static", "sctp_disposition_t", "sctp_sf_tabort_8_4_8", "(", "const", "struct", "sctp_endpoint", "*", "ep", ",", "/", "*", "Report", "violation", "if", "the", "chunk", "is", "less", "then", "minimal", "*", "/", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "/", "*", "Now", "that", "we", "know", "we", "at", "least", "have", "a", "chunk", "header", ",", "*", "do", "things", "that", "are", "type", "appropriate", ".", "*", "/", "/", "*", "Report", "violation", "if", "chunk", "len", "overflows", "*", "/", "ch_end", "=", "(", "(", "__u8", "*", ")", "ch", ")", "+", "WORD_ROUND", "(", "ntohs", "(", "ch", "-", ">", "length", ")", ");", "if", "(", "ch_end", ">", "skb_tail_pointer", "(", "skb", ")", ")", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "struct", "sctp_chunk", "*", "chunk", "=", "arg", ";", "/", "*", "Make", "sure", "that", "the", "SHUTDOWN_ACK", "chunk", "has", "a", "valid", "length", ".", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_chunkhdr_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "struct", "sctp_chunk", "*", "chunk", "=", "arg", ";", "/", "*", "Make", "sure", "that", "the", "chunk", "has", "a", "valid", "length", ".", "*", "Since", "we", "don", "'", "t", "know", "the", "chunk", "type", ",", "we", "use", "a", "general", "*", "chunkhdr", "structure", "to", "make", "a", "comparison", ".", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_chunkhdr_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "struct", "sctp_chunk", "*", "chunk", "=", "arg", ";", "/", "*", "Make", "sure", "that", "the", "chunk", "has", "a", "valid", "length", ".", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_chunkhdr_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "const", "struct", "sctp_endpoint", "*", "ep", ",", "struct", "sctp_packet", "*", "packet", "=", "NULL", ";", "if", "(", "asoc", ")", "{", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_REPLY", ",", "SCTP_CHUNK", "(", "abort", ")", ");", "SCTP_INC_STATS", "(", "SCTP_MIB_OUTCTRLCHUNKS", ")", ";", "if", "(", "asoc", "-", ">", "state", "<", "=", "SCTP_STATE_COOKIE_ECHOED", ")", "{", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_TIMER_STOP", ",", "SCTP_TO", "(", "SCTP_EVENT_TIMEOUT_T1_INIT", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_SET_SK_ERR", ",", "SCTP_ERROR", "(", "ECONNREFUSED", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_INIT_FAILED", ",", "SCTP_PERR", "(", "SCTP_ERROR_PROTO_VIOLATION", ")", ");", "}", "else", "{", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_SET_SK_ERR", ",", "SCTP_ERROR", "(", "ECONNABORTED", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_ASSOC_FAILED", ",", "SCTP_PERR", "(", "SCTP_ERROR_PROTO_VIOLATION", ")", ");", "SCTP_DEC_STATS", "(", "SCTP_MIB_CURRESTAB", ")", ";", "}", "packet", "=", "sctp_ootb_pkt_new", "(", "asoc", ",", "chunk", ")", ";", "if", "(", "!", "packet", ")", "goto", "nomem_pkt", ";", "if", "(", "sctp_test_T_bit", "(", "abort", ")", ")", "packet", "-", ">", "vtag", "=", "ntohl", "(", "chunk", "-", ">", "sctp_hdr", "-", ">", "vtag", ")", ";", "abort", "-", ">", "skb", "-", ">", "sk", "=", "ep", "-", ">", "base", ".", "sk", ";", "sctp_packet_append_chunk", "(", "packet", ",", "abort", ")", ";", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_SEND_PKT", ",", "SCTP_PACKET", "(", "packet", ")", ");", "SCTP_INC_STATS", "(", "SCTP_MIB_OUTCTRLCHUNKS", ")", ";", "sctp_sf_pdiscard", "(", "ep", ",", "asoc", ",", "SCTP_ST_CHUNK", "(", "0", ")", ",", "arg", ",", "commands", ")", ";", "nomem_pkt", ":", "sctp_chunk_free", "(", "abort", ")", ";", "return", "sctp_sf_abort_violation", "(", "ep", ",", "asoc", ",", "arg", ",", "commands", ",", "err_str", ",", "return", "sctp_sf_abort_violation", "(", "ep", ",", "asoc", ",", "arg", ",", "commands", ",", "err_str", ",", "/", "*", "Handle", "protocol", "violation", "of", "an", "invalid", "chunk", "bundling", ".", "For", "example", ",", "*", "when", "we", "have", "an", "association", "and", "we", "recieve", "bundled", "INIT", "-", "ACK", ",", "or", "*", "SHUDOWN", "-", "COMPLETE", ",", "our", "peer", "is", "clearly", "violationg", "the", "\"", "MUST", "NOT", "bundle", "\"", "*", "statement", "from", "the", "specs", ".", "Additinally", ",", "there", "might", "be", "an", "attacker", "*", "on", "the", "path", "and", "we", "may", "not", "want", "to", "continue", "this", "communication", ".", "*", "/", "static", "sctp_disposition_t", "sctp_sf_violation_chunk", "(", "const", "struct", "sctp_endpoint", "*", "ep", ",", "const", "struct", "sctp_association", "*", "asoc", ",", "const", "sctp_subtype_t", "type", ",", "void", "*", "arg", ",", "sctp_cmd_seq_t", "*", "commands", ")", "{", "char", "err_str", "[", "]=", "\"", "The", "following", "chunk", "violates", "protocol", ":", "\";", "if", "(", "!", "asoc", ")", "return", "sctp_sf_violation", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "return", "sctp_sf_abort_violation", "(", "ep", ",", "asoc", ",", "arg", ",", "commands", ",", "err_str", ",", "sizeof", "(", "err_str", ")", ");", "}", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_ootb", ")", ",</s>sctp_state_fn_t", "sctp_sf_tabort_8_4_8", ";", "return", "SCTP_DISPOSITION_VIOLATION", ";", "if", "(", "!", "sctp_vtag_verify_either", "(", "chunk", ",", "asoc", ")", ")", "return", "sctp_sf_pdiscard", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "/", "*", "Make", "sure", "that", "the", "INIT", "-", "ACK", "chunk", "has", "a", "valid", "length", "*", "/", "if", "(", "!", "sctp_chunk_length_valid", "(", "chunk", ",", "sizeof", "(", "sctp_initack_chunk_t", ")", "))", "return", "sctp_sf_violation_chunklen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "return", "SCTP_DISPOSITION_VIOLATION", ";", "return", "sctp_sf_ootb", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "sctp_disposition_t", "sctp_sf_tabort_8_4_8", "(", "const", "struct", "sctp_endpoint", "*", "ep", ",", "/", "*", "Break", "out", "if", "chunk", "length", "is", "less", "then", "minimal", ".", "*", "/", "break", ";", "ch_end", "=", "(", "(", "__u8", "*", ")", "ch", ")", "+", "WORD_ROUND", "(", "ntohs", "(", "ch", "-", ">", "length", ")", ");", "if", "(", "ch_end", ">", "skb_tail_pointer", "(", "skb", ")", ")", "break", ";", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_REPLY", ",", "SCTP_CHUNK", "(", "abort", ")", ");", "SCTP_INC_STATS", "(", "SCTP_MIB_OUTCTRLCHUNKS", ")", ";", "if", "(", "asoc", "-", ">", "state", "<", "=", "SCTP_STATE_COOKIE_ECHOED", ")", "{", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_TIMER_STOP", ",", "SCTP_TO", "(", "SCTP_EVENT_TIMEOUT_T1_INIT", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_SET_SK_ERR", ",", "SCTP_ERROR", "(", "ECONNREFUSED", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_INIT_FAILED", ",", "SCTP_PERR", "(", "SCTP_ERROR_PROTO_VIOLATION", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_SET_SK_ERR", ",", "SCTP_ERROR", "(", "ECONNABORTED", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_ASSOC_FAILED", ",", "SCTP_PERR", "(", "SCTP_ERROR_PROTO_VIOLATION", ")", ");", "SCTP_DEC_STATS", "(", "SCTP_MIB_CURRESTAB", ")", ";", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_DISCARD_PACKET", ",", "SCTP_NULL", "(", "))", ";", "return", "sctp_sf_abort_violation", "(", "asoc", ",", "arg", ",", "commands", ",", "err_str", ",", "return", "sctp_sf_abort_violation", "(", "asoc", ",", "arg", ",", "commands", ",", "err_str", ",", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ",", "\\", "TYPE_SCTP_FUNC", "(", "sctp_sf_tabort_8_4_8", ")", ","], "docstring_tokens": ["via", "(1", ")", "an", "Out", "Of", "The", "Blue", "(OOTB", ")", "chunk", "or", "(2", ")", "a", "chunk", "of", "zero", "length", "."]}
{"contents": ["bplist:", "Fix", "possible", "out-of-bounds", "read", "in", "parse_array_node()", "with", "proper", "bounds", "checking"], "code_tokens": ["uint64_t", "str_j", "=", "0", ";", "uint64_t", "index1", ";", "const", "char", "*", "const", "end_data", "=", "bplist", "-", ">", "data", "+", "bplist", "-", ">", "size", ";", "const", "char", "*", "index1_ptr", "=", "NULL", ";", "index1_ptr", "=", "(", "*", "bnode", ")", "+", "str_j", ";", "if", "(", "index1_ptr", "<", "bplist", "-", ">", "data", "|", "|", "index1_ptr", "+", "bplist", "-", ">", "ref_size", ">", "=", "end_data", ")", "{", "plist_free", "(", "node", ")", ";", "return", "NULL", ";", "}", "index1", "=", "UINT_TO_HOST", "(", "index1_ptr", ",", "bplist", "-", ">", "ref_size", ")", ";</s>uint32_t", "str_j", "=", "0", ";", "uint32_t", "index1", ";", "index1", "=", "UINT_TO_HOST", "(", "(*", "bnode", ")", "+", "str_j", ",", "bplist", "-", ">", "ref_size", ")", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "file"]}
{"contents": ["block:", "do", "not", "pass", "disk", "names", "as", "format", "strings", "Disk", "names", "may", "contain", "arbitrary", "strings,", "so", "they", "must", "not", "be", "interpreted", "as", "format", "strings.", "It", "seems", "that", "only", "md", "allows", "arbitrary", "strings", "to", "be", "used", "for", "disk", "names,", "but", "this", "could", "allow", "for", "a", "local", "memory", "corruption", "from", "uid", "0", "into", "ring", "0.", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "Jens", "Axboe", "<axboe@kernel.dk>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["dev_set_name", "(", "ddev", ",", "\"", "%", "s", "\"", ",", "disk", "-", ">", "disk_name", ")", ";", "thread", "=", "kthread_create", "(", "nbd_thread", ",", "nbd", ",", "\"", "%", "s", "\"", ",", "nbd", "-", ">", "disk", "-", ">", "disk_name", ")", ";", "error", "=", "dev_set_name", "(", "&", "oud", "-", ">", "class_dev", ",", "\"", "%", "s", "\"", ",", "disk", "-", ">", "disk_name", ")", ";</s>dev_set_name", "(", "ddev", ",", "disk", "-", ">", "disk_name", ")", ";", "thread", "=", "kthread_create", "(", "nbd_thread", ",", "nbd", ",", "nbd", "-", ">", "disk", "-", ">", "disk_name", ")", ";", "error", "=", "dev_set_name", "(", "&", "oud", "-", ">", "class_dev", ",", "disk", "-", ">", "disk_name", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request", "containing", "format", "string", "specifiers"]}
{"contents": ["From", "HEAD:", "Fix", "double-free", "in", "TLS", "server", "name", "extensions", "which", "could", "lead", "to", "a", "remote", "crash", "found", "by", "Codenomicon", "TLS", "test", "suite", "(", ")", "Reviewed", "by:", "openssl-security@openssl.org", "Obtained", "from:", "jorton@redhat.com"], "code_tokens": ["*", ")", "Fix", "double", "free", "in", "TLS", "server", "name", "extensions", "which", "could", "lead", "to", "a", "remote", "crash", "found", "by", "Codenomicon", "TLS", "test", "suite", "(", "CVE", "-", "2008", "-", "0891", ")", "[", "Joe", "Orton", "]", "s", "-", ">", "session", "-", ">", "tlsext_hostname", "=", "NULL", ";</s>"], "docstring_tokens": ["via", "a", "malformed", "Client", "Hello", "packet", "."]}
{"contents": ["ath9k_htc:", "properly", "set", "MAC", "address", "and", "BSSID", "mask", "Pick", "the", "MAC", "address", "of", "the", "first", "virtual", "interface", "as", "the", "new", "hardware", "MAC", "address.", "Set", "BSSID", "mask", "according", "to", "this", "MAC", "address.", "This", "fixes", ".", "Signed-off-by:", "Mathy", "Vanhoef", "<vanhoefm@gmail.com>", "Signed-off-by:", "John", "W.", "Linville", "<linville@tuxdriver.com>"], "code_tokens": ["if", "(", "iter_data", "-", ">", "hw_macaddr", "!", "=", "NULL", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "ETH_ALEN", ";", "i", "+", "+)", "iter_data", "-", ">", "mask", "[", "i", "]", "&", "=", "~", "(", "iter_data", "-", ">", "hw_macaddr", "[", "i", "]", "^", "mac", "[", "i", "]", ");", "}", "else", "{", "iter_data", "-", ">", "hw_macaddr", "=", "mac", ";", "}", "static", "void", "ath9k_htc_set_mac_bssid_mask", "(", "struct", "ath9k_htc_priv", "*", "priv", ",", "*", "Pick", "the", "MAC", "address", "of", "the", "first", "interface", "as", "the", "new", "hardware", "*", "MAC", "address", ".", "The", "hardware", "will", "use", "it", "together", "with", "the", "BSSID", "mask", "*", "when", "matching", "addresses", ".", "iter_data", ".", "hw_macaddr", "=", "NULL", ";", "if", "(", "iter_data", ".", "hw_macaddr", ")", "memcpy", "(", "common", "-", ">", "macaddr", ",", "iter_data", ".", "hw_macaddr", ",", "ETH_ALEN", ")", ";", "ath9k_htc_set_mac_bssid_mask", "(", "priv", ",", "vif", ")", ";", "ath9k_htc_set_mac_bssid_mask", "(", "priv", ",", "vif", ")", ";", "*", "Pick", "the", "MAC", "address", "of", "the", "first", "interface", "as", "the", "new", "hardware", "*", "MAC", "address", ".", "The", "hardware", "will", "use", "it", "together", "with", "the", "BSSID", "mask", "*", "when", "matching", "addresses", ".</s>for", "(", "i", "=", "0", ";", "i", "<", "ETH_ALEN", ";", "i", "+", "+)", "iter_data", "-", ">", "mask", "[", "i", "]", "&", "=", "~", "(", "iter_data", "-", ">", "hw_macaddr", "[", "i", "]", "^", "mac", "[", "i", "]", ");", "static", "void", "ath9k_htc_set_bssid_mask", "(", "struct", "ath9k_htc_priv", "*", "priv", ",", "*", "Use", "the", "hardware", "MAC", "address", "as", "reference", ",", "the", "hardware", "uses", "it", "*", "together", "with", "the", "BSSID", "mask", "when", "matching", "addresses", ".", "iter_data", ".", "hw_macaddr", "=", "common", "-", ">", "macaddr", ";", "ath9k_htc_set_bssid_mask", "(", "priv", ",", "vif", ")", ";", "ath9k_htc_set_bssid_mask", "(", "priv", ",", "vif", ")", ";", "*", "Use", "the", "hardware", "MAC", "address", "as", "reference", ",", "the", "hardware", "uses", "it", "*", "together", "with", "the", "BSSID", "mask", "when", "matching", "addresses", "."], "docstring_tokens": ["sending", "specially-crafted", "packets"]}
{"contents": ["mdio_bus:", "Fix", "use-after-free", "on", "device_register", "fails", "KASAN", "has", "found", "use-after-free", "in", "fixed_mdio_bus_init,", "commit", "0c692d07842a", "(\"drivers/net/phy/mdio_bus.c:", "call", "put_device", "on", "device_register()", "failure\")", "call", "put_device()", "while", "device_register()", "fails,give", "up", "the", "last", "reference", "to", "the", "device", "and", "allow", "mdiobus_release", "to", "be", "executed", ",kfreeing", "the", "bus.", "However", "in", "most", "drives,", "mdiobus_free", "be", "called", "to", "free", "the", "bus", "while", "mdiobus_register", "fails.", "use-after-free", "occurs", "when", "access", "bus", "again,", "this", "patch", "revert", "it", "to", "let", "mdiobus_free", "free", "the", "bus.", "KASAN", "report", "details", "as", "below:", "BUG:", "KASAN:", "use-after-free", "in", "mdiobus_free+0x85/0x90", "drivers/net/phy/mdio_bus.c:482", "Read", "of", "size", "4", "at", "addr", "ffff8881dc824d78", "by", "task", "syz-executor.0/3524", "CPU:", "1", "PID:", "3524", "Comm:", "syz-executor.0", "Not", "tainted", "5.0.0-rc7+", "#45", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "1.10.2-1ubuntu1", "04/01/2014", "Call", "Trace:", "__dump_stack", "lib/dump_stack.c:77", "[inline]", "dump_stack+0xfa/0x1ce", "lib/dump_stack.c:113", "print_address_description+0x65/0x270", "mm/kasan/report.c:187", "kasan_report+0x149/0x18d", "mm/kasan/report.c:317", "mdiobus_free+0x85/0x90", "drivers/net/phy/mdio_bus.c:482", "fixed_mdio_bus_init+0x283/0x1000", "[fixed_phy]", "?", "0xffffffffc0e40000", "?", "0xffffffffc0e40000", "?", "0xffffffffc0e40000", "do_one_initcall+0xfa/0x5ca", "init/main.c:887", "do_init_module+0x204/0x5f6", "kernel/module.c:3460", "load_module+0x66b2/0x8570", "kernel/module.c:3808", "__do_sys_finit_module+0x238/0x2a0", "kernel/module.c:3902", "do_syscall_64+0x147/0x600", "arch/x86/entry/common.c:290", "entry_SYSCALL_64_after_hwframe+0x49/0xbe", "RIP:", "0033:0x462e99", "Code:", "f7", "d8", "64", "89", "02", "b8", "ff", "ff", "ff", "ff", "c3", "66", "0f", "1f", "44", "00", "00", "48", "89", "f8", "48", "89", "f7", "48", "89", "d6", "48", "89", "ca", "4d", "89", "c2", "4d", "89", "c8", "4c", "8b", "4c", "24", "08", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "c7", "c1", "bc", "ff", "ff", "ff", "f7", "d8", "64", "89", "01", "48", "RSP:", "002b:00007f6215c19c58", "EFLAGS:", "00000246", "ORIG_RAX:", "0000000000000139", "RAX:", "ffffffffffffffda", "RBX:", "000000000073bf00", "RCX:", "0000000000462e99", "RDX:", "0000000000000000", "RSI:", "0000000020000080", "RDI:", "0000000000000003", "RBP:", "00007f6215c19c70", "R08:", "0000000000000000", "R09:", "0000000000000000", "R10:", "0000000000000000", "R11:", "0000000000000246", "R12:", "00007f6215c1a6bc", "R13:", "00000000004bcefb", "R14:", "00000000006f7030", "R15:", "0000000000000004", "Allocated", "by", "task", "3524:", "set_track", "mm/kasan/common.c:85", "[inline]", "__kasan_kmalloc.constprop.3+0xa0/0xd0", "mm/kasan/common.c:496", "kmalloc", "include/linux/slab.h:545", "[inline]", "kzalloc", "include/linux/slab.h:740", "[inline]", "mdiobus_alloc_size+0x54/0x1b0", "drivers/net/phy/mdio_bus.c:143", "fixed_mdio_bus_init+0x163/0x1000", "[fixed_phy]", "do_one_initcall+0xfa/0x5ca", "init/main.c:887", "do_init_module+0x204/0x5f6", "kernel/module.c:3460", "load_module+0x66b2/0x8570", "kernel/module.c:3808", "__do_sys_finit_module+0x238/0x2a0", "kernel/module.c:3902", "do_syscall_64+0x147/0x600", "arch/x86/entry/common.c:290", "entry_SYSCALL_64_after_hwframe+0x49/0xbe", "Freed", "by", "task", "3524:", "set_track", "mm/kasan/common.c:85", "[inline]", "__kasan_slab_free+0x130/0x180", "mm/kasan/common.c:458", "slab_free_hook", "mm/slub.c:1409", "[inline]", "slab_free_freelist_hook", "mm/slub.c:1436", "[inline]", "slab_free", "mm/slub.c:2986", "[inline]", "kfree+0xe1/0x270", "mm/slub.c:3938", "device_release+0x78/0x200", "drivers/base/core.c:919", "kobject_cleanup", "lib/kobject.c:662", "[inline]", "kobject_release", "lib/kobject.c:691", "[inline]", "kref_put", "include/linux/kref.h:67", "[inline]", "kobject_put+0x146/0x240", "lib/kobject.c:708", "put_device+0x1c/0x30", "drivers/base/core.c:2060", "__mdiobus_register+0x483/0x560", "drivers/net/phy/mdio_bus.c:382", "fixed_mdio_bus_init+0x26b/0x1000", "[fixed_phy]", "do_one_initcall+0xfa/0x5ca", "init/main.c:887", "do_init_module+0x204/0x5f6", "kernel/module.c:3460", "load_module+0x66b2/0x8570", "kernel/module.c:3808", "__do_sys_finit_module+0x238/0x2a0", "kernel/module.c:3902", "do_syscall_64+0x147/0x600", "arch/x86/entry/common.c:290", "entry_SYSCALL_64_after_hwframe+0x49/0xbe", "The", "buggy", "address", "belongs", "to", "the", "object", "at", "ffff8881dc824c80", "which", "belongs", "to", "the", "cache", "kmalloc-2k", "of", "size", "2048", "The", "buggy", "address", "is", "located", "248", "bytes", "inside", "of", "2048-byte", "region", "[ffff8881dc824c80,", "ffff8881dc825480)", "The", "buggy", "address", "belongs", "to", "the", "page:", "page:ffffea0007720800", "count:1", "mapcount:0", "mapping:ffff8881f6c02800", "index:0x0", "compound_mapcount:", "0", "flags:", "0x2fffc0000010200(slab|head)", "raw:", "02fffc0000010200", "0000000000000000", "0000000500000001", "ffff8881f6c02800", "raw:", "0000000000000000", "00000000800f000f", "00000001ffffffff", "0000000000000000", "page", "dumped", "because:", "kasan:", "bad", "access", "detected", "Memory", "state", "around", "the", "buggy", "address:", "ffff8881dc824c00:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "ffff8881dc824c80:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", ">ffff8881dc824d00:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "^", "ffff8881dc824d80:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "ffff8881dc824e00:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "Fixes:", "0c692d07842a", "(\"drivers/net/phy/mdio_bus.c:", "call", "put_device", "on", "device_register()", "failure\")", "Signed-off-by:", "YueHaibing", "<yuehaibing@huawei.com>", "Reviewed-by:", "Andrew", "Lunn", "<andrew@lunn.ch>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["</s>put_device", "(", "&", "bus", "-", ">", "dev", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "command"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/196"], "code_tokens": ["status", "=", "MagickTrue", ";", "if", "(", "fputc", "(", "c", ",", "file", ")", "!", "=", "c", ")", "status", "=", "MagickFalse", ";", "if", "(", "status", "=", "=", "MagickFalse", ")", "image", "=", "DestroyImage", "(", "image", ")", ";</s>(", "void", ")", "fputc", "(", "c", ",", "file", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially", "crafted", "file"]}
{"contents": ["posix-cpu-timers:", "workaround", "to", "suppress", "the", "problems", "with", "mt", "exec", "posix-cpu-timers.c", "correctly", "assumes", "that", "the", "dying", "process", "does", "posix_cpu_timers_exit_group()", "and", "removes", "all", "!CPUCLOCK_PERTHREAD", "timers", "from", "signal->cpu_timers", "list.", "But,", "it", "also", "assumes", "that", "timer->it.cpu.task", "is", "always", "the", "group", "leader,", "and", "thus", "the", "dead", "->task", "means", "the", "dead", "thread", "group.", "This", "is", "obviously", "not", "true", "after", "de_thread()", "changes", "the", "leader.", "After", "that", "almost", "every", "posix_cpu_timer_", "method", "has", "problems.", "It", "is", "not", "simple", "to", "fix", "this", "bug", "correctly.", "First", "of", "all,", "I", "think", "that", "timer->it.cpu", "should", "use", "struct", "pid", "instead", "of", "task_struct.", "Also,", "the", "locking", "should", "be", "reworked", "completely.", "In", "particular,", "tasklist_lock", "should", "not", "be", "used", "at", "all.", "This", "all", "needs", "a", "lot", "of", "nontrivial", "and", "hard-to-test", "changes.", "Change", "__exit_signal()", "to", "do", "posix_cpu_timers_exit_group()", "when", "the", "old", "leader", "dies", "during", "exec.", "This", "is", "not", "the", "fix,", "just", "the", "temporary", "hack", "to", "hide", "the", "problem", "for", "2.6.37", "and", "stable.", "IOW,", "this", "is", "obviously", "wrong", "but", "this", "is", "what", "we", "currently", "have", "anyway:", "cpu", "timers", "do", "not", "work", "after", "mt", "exec.", "In", "theory", "this", "change", "adds", "another", "race.", "The", "exiting", "leader", "can", "detach", "the", "timers", "which", "were", "attached", "to", "the", "new", "leader.", "However,", "the", "window", "between", "de_thread()", "and", "release_task()", "is", "small,", "we", "can", "pretend", "that", "sys_timer_create()", "was", "called", "before", "de_thread().", "Signed-off-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "*", "This", "can", "only", "happen", "if", "the", "caller", "is", "de_thread", "(", ").", "*", "FIXME", ":", "this", "is", "the", "temporary", "hack", ",", "we", "should", "teach", "*", "posix", "-", "cpu", "-", "timers", "to", "handle", "this", "case", "correctly", ".", "*", "/", "if", "(", "unlikely", "(", "has_group_leader_pid", "(", "tsk", ")", "))", "posix_cpu_timers_exit_group", "(", "tsk", ")", ";</s>"], "docstring_tokens": ["via"]}
{"contents": ["jbd2:", "don't", "mark", "block", "as", "modified", "if", "the", "handle", "is", "out", "of", "credits", "Do", "not", "set", "the", "b_modified", "flag", "in", "block's", "journal", "head", "should", "not", "until", "after", "we're", "sure", "that", "jbd2_journal_dirty_metadat()", "will", "not", "abort", "with", "an", "error", "due", "to", "there", "not", "being", "enough", "space", "reserved", "in", "the", "jbd2", "handle.", "Otherwise,", "future", "attempts", "to", "modify", "the", "buffer", "may", "lead", "a", "large", "number", "of", "spurious", "errors", "and", "warnings.", "This", "addresses", ".", "https://bugzilla.kernel.org/show_bug.cgi?id=200071", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>", "Cc:", "stable@kernel.org"], "code_tokens": ["if", "(", "jh", "-", ">", "b_transaction", "=", "=", "transaction", "&", "&", "jh", "-", ">", "b_jlist", "!", "=", "BJ_Metadata", ")", "pr_err", "(", "\"", "JBD2", ":", "assertion", "failure", ":", "h_type", "=", "%", "u", "\"", "\"", "h_line_no", "=", "%", "u", "block_no", "=", "%", "llu", "jlist", "=", "%", "u", "\\", "n", "\"", ",", "handle", "-", ">", "h_type", ",", "handle", "-", ">", "h_line_no", ",", "(", "unsigned", "long", "long", ")", "bh", "-", ">", "b_blocknr", ",", "jh", "-", ">", "b_jlist", ")", ";", "jh", "-", ">", "b_modified", "=", "1", ";</s>jh", "-", ">", "b_modified", "=", "1", ";"], "docstring_tokens": ["by", "mounting", "and", "operating", "on", "a", "crafted", "ext4", "filesystem", "image", "."]}
{"contents": ["iw_cxgb3:", "Fix", "incorrectly", "returning", "error", "on", "success", "The", "cxgb3_*_send()", "functions", "return", "NET_XMIT_", "values,", "which", "are", "positive", "integers", "values.", "So", "don't", "treat", "positive", "return", "values", "as", "an", "error.", "Signed-off-by:", "Steve", "Wise", "<swise@opengridcomputing.com>", "Signed-off-by:", "Hariprasad", "Shenai", "<hariprasad@chelsio.com>", "Signed-off-by:", "Doug", "Ledford", "<dledford@redhat.com>"], "code_tokens": ["return", "error", "<", "0", "?", "error", ":", "0", ";", "return", "error", "<", "0", "?", "error", ":", "0", ";</s>return", "error", ";", "return", "error", ";"], "docstring_tokens": ["via", "crafted", "packets", "."]}
{"contents": ["cifs:", "clean", "up", "cifs_find_smb_ses", "(try", "#2)", "This", "patch", "replaces", "the", "earlier", "patch", "by", "the", "same", "name.", "The", "only", "difference", "is", "that", "MAX_PASSWORD_SIZE", "has", "been", "increased", "to", "attempt", "to", "match", "the", "limits", "that", "windows", "enforces.", "Do", "a", "better", "job", "of", "matching", "sessions", "by", "authtype.", "Matching", "by", "username", "for", "a", "Kerberos", "session", "is", "incorrect,", "and", "anonymous", "sessions", "need", "special", "handling.", "Also,", "in", "the", "case", "where", "we", "do", "match", "by", "username,", "we", "also", "need", "to", "match", "by", "password.", "That", "ensures", "that", "someone", "else", "doesn't", "\"borrow\"", "an", "existing", "session", "without", "needing", "to", "know", "the", "password.", "Finally,", "passwords", "can", "be", "longer", "than", "16", "bytes.", "Bump", "MAX_PASSWORD_SIZE", "to", "512", "to", "match", "the", "size", "that", "the", "userspace", "mount", "helper", "allows.", "Signed-off-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["#", "define", "MAX_PASSWORD_SIZE", "512", "/", "*", "max", "for", "windows", "seems", "to", "be", "256", "wide", "chars", "*", "/", "cifs_find_smb_ses", "(", "struct", "TCP_Server_Info", "*", "server", ",", "struct", "smb_vol", "*", "vol", ")", "list_for_each_entry", "(", "ses", ",", "&", "server", "-", ">", "smb_ses_list", ",", "smb_ses_list", ")", "{", "switch", "(", "server", "-", ">", "secType", ")", "{", "case", "Kerberos", ":", "if", "(", "vol", "-", ">", "linux_uid", "!", "=", "ses", "-", ">", "linux_uid", ")", "continue", ";", "break", ";", "default", ":", "/", "*", "anything", "else", "takes", "username", "/", "password", "*", "/", "if", "(", "strncmp", "(", "ses", "-", ">", "userName", ",", "vol", "-", ">", "username", ",", "MAX_USERNAME_SIZE", ")", ")", "continue", ";", "if", "(", "strlen", "(", "vol", "-", ">", "username", ")", "!", "=", "0", "&", "&", "strncmp", "(", "ses", "-", ">", "password", ",", "vol", "-", ">", "password", ",", "MAX_PASSWORD_SIZE", ")", ")", "continue", ";", "}", "+", "+", "ses", "-", ">", "ses_count", ";", "ses", "=", "cifs_find_smb_ses", "(", "server", ",", "volume_info", ")", ";</s>#", "define", "MAX_PASSWORD_SIZE", "16", "cifs_find_smb_ses", "(", "struct", "TCP_Server_Info", "*", "server", ",", "char", "*", "username", ")", "struct", "list_head", "*", "tmp", ";", "list_for_each", "(", "tmp", ",", "&", "server", "-", ">", "smb_ses_list", ")", "{", "ses", "=", "list_entry", "(", "tmp", ",", "struct", "cifsSesInfo", ",", "smb_ses_list", ")", ";", "if", "(", "strncmp", "(", "ses", "-", ">", "userName", ",", "username", ",", "MAX_USERNAME_SIZE", ")", ")", "continue", ";", "ses", "=", "cifs_find_smb_ses", "(", "server", ",", "volume_info", "-", ">", "username", ")", ";"], "docstring_tokens": ["mount", "the", "same", "share", "without", "knowing", "the", "correct", "password"]}
{"contents": ["ALSA:", "hda-intel:", "Avoid", "divide", "by", "zero", "crash", "On", "my", "AMD780V", "chipset,", "hda_intel.c", "can", "crash", "the", "kernel", "with", "a", "divide", "by", "zero", "for", "as-yet", "unknown", "reasons.", "A", "simple", "check", "for", "zero", "prevents", "it,", "though", "the", "problem", "that", "causes", "it", "remains.", "Since", "the", "workaround", "is", "harmless", "and", "won't", "affect", "anyone", "except", "victims", "of", "this", "bug,", "it", "should", "be", "safe;", "moreover,", "because", "this", "crash", "can", "be", "triggered", "by", "a", "user-mode", "application,", "there", "are", "denial", "of", "service", "implications", "on", "the", "systems", "affected", "by", "the", "bug", "without", "the", "patch.", "Signed-off-by:", "Jody", "Bruchon", "<jody@nctritech.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["if", "(", "azx_dev", "-", ">", "period_bytes", "=", "=", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "hda", "-", "intel", ":", "Divide", "by", "zero", "was", "avoided", "\"", "\"", "in", "azx_dev", "-", ">", "period_bytes", ".", "\\", "n", "\"", ");", "return", "0", ";", "}</s>"], "docstring_tokens": ["via", "unknown", "manipulations", "that", "trigger", "a", "divide-by-zero", "error", "."]}
{"contents": ["ipv6:", "Prevent", "overrun", "when", "parsing", "v6", "header", "options", "The", "KASAN", "warning", "repoted", "below", "was", "discovered", "with", "a", "syzkaller", "program.", "The", "reproducer", "is", "basically:", "int", "s", "=", "socket(AF_INET6,", "SOCK_RAW,", "NEXTHDR_HOP);", "send(s,", "&one_byte_of_data,", "1,", "MSG_MORE);", "send(s,", "&more_than_mtu_bytes_data,", "2000,", "0);", "The", "socket()", "call", "sets", "the", "nexthdr", "field", "of", "the", "v6", "header", "to", "NEXTHDR_HOP,", "the", "first", "send", "call", "primes", "the", "payload", "with", "a", "non", "zero", "byte", "of", "data,", "and", "the", "second", "send", "call", "triggers", "the", "fragmentation", "path.", "The", "fragmentation", "code", "tries", "to", "parse", "the", "header", "options", "in", "order", "to", "figure", "out", "where", "to", "insert", "the", "fragment", "option.", "Since", "nexthdr", "points", "to", "an", "invalid", "option,", "the", "calculation", "of", "the", "size", "of", "the", "network", "header", "can", "made", "to", "be", "much", "larger", "than", "the", "linear", "section", "of", "the", "skb", "and", "data", "is", "read", "outside", "of", "it.", "This", "fix", "makes", "ip6_find_1stfrag", "return", "an", "error", "if", "it", "detects", "running", "out-of-bounds.", "[", "42.361487]", "==================================================================", "[", "42.364412]", "BUG:", "KASAN:", "slab-out-of-bounds", "in", "ip6_fragment+0x11c8/0x3730", "[", "42.365471]", "Read", "of", "size", "840", "at", "addr", "ffff88000969e798", "by", "task", "ip6_fragment-oo/3789", "[", "42.366469]", "[", "42.366696]", "CPU:", "1", "PID:", "3789", "Comm:", "ip6_fragment-oo", "Not", "tainted", "4.11.0+", "#41", "[", "42.367628]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "1.10.1-1ubuntu1", "04/01/2014", "[", "42.368824]", "Call", "Trace:", "[", "42.369183]", "dump_stack+0xb3/0x10b", "[", "42.369664]", "print_address_description+0x73/0x290", "[", "42.370325]", "kasan_report+0x252/0x370", "[", "42.370839]", "?", "ip6_fragment+0x11c8/0x3730", "[", "42.371396]", "check_memory_region+0x13c/0x1a0", "[", "42.371978]", "memcpy+0x23/0x50", "[", "42.372395]", "ip6_fragment+0x11c8/0x3730", "[", "42.372920]", "?", "nf_ct_expect_unregister_notifier+0x110/0x110", "[", "42.373681]", "?", "ip6_copy_metadata+0x7f0/0x7f0", "[", "42.374263]", "?", "ip6_forward+0x2e30/0x2e30", "[", "42.374803]", "ip6_finish_output+0x584/0x990", "[", "42.375350]", "ip6_output+0x1b7/0x690", "[", "42.375836]", "?", "ip6_finish_output+0x990/0x990", "[", "42.376411]", "?", "ip6_fragment+0x3730/0x3730", "[", "42.376968]", "ip6_local_out+0x95/0x160", "[", "42.377471]", "ip6_send_skb+0xa1/0x330", "[", "42.377969]", "ip6_push_pending_frames+0xb3/0xe0", "[", "42.378589]", "rawv6_sendmsg+0x2051/0x2db0", "[", "42.379129]", "?", "rawv6_bind+0x8b0/0x8b0", "[", "42.379633]", "?", "_copy_from_user+0x84/0xe0", "[", "42.380193]", "?", "debug_check_no_locks_freed+0x290/0x290", "[", "42.380878]", "?", "___sys_sendmsg+0x162/0x930", "[", "42.381427]", "?", "rcu_read_lock_sched_held+0xa3/0x120", "[", "42.382074]", "?", "sock_has_perm+0x1f6/0x290", "[", "42.382614]", "?", "___sys_sendmsg+0x167/0x930", "[", "42.383173]", "?", "lock_downgrade+0x660/0x660", "[", "42.383727]", "inet_sendmsg+0x123/0x500", "[", "42.384226]", "?", "inet_sendmsg+0x123/0x500", "[", "42.384748]", "?", "inet_recvmsg+0x540/0x540", "[", "42.385263]", "sock_sendmsg+0xca/0x110", "[", "42.385758]", "SYSC_sendto+0x217/0x380", "[", "42.386249]", "?", "SYSC_connect+0x310/0x310", "[", "42.386783]", "?", "__might_fault+0x110/0x1d0", "[", "42.387324]", "?", "lock_downgrade+0x660/0x660", "[", "42.387880]", "?", "__fget_light+0xa1/0x1f0", "[", "42.388403]", "?", "__fdget+0x18/0x20", "[", "42.388851]", "?", "sock_common_setsockopt+0x95/0xd0", "[", "42.389472]", "?", "SyS_setsockopt+0x17f/0x260", "[", "42.390021]", "?", "entry_SYSCALL_64_fastpath+0x5/0xbe", "[", "42.390650]", "SyS_sendto+0x40/0x50", "[", "42.391103]", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "[", "42.391731]", "RIP:", "0033:0x7fbbb711e383", "[", "42.392217]", "RSP:", "002b:00007ffff4d34f28", "EFLAGS:", "00000246", "ORIG_RAX:", "000000000000002c", "[", "42.393235]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007fbbb711e383", "[", "42.394195]", "RDX:", "0000000000001000", "RSI:", "00007ffff4d34f60", "RDI:", "0000000000000003", "[", "42.395145]", "RBP:", "0000000000000046", "R08:", "00007ffff4d34f40", "R09:", "0000000000000018", "[", "42.396056]", "R10:", "0000000000000000", "R11:", "0000000000000246", "R12:", "0000000000400aad", "[", "42.396598]", "R13:", "0000000000000066", "R14:", "00007ffff4d34ee0", "R15:", "00007fbbb717af00", "[", "42.397257]", "[", "42.397411]", "Allocated", "by", "task", "3789:", "[", "42.397702]", "save_stack_trace+0x16/0x20", "[", "42.398005]", "save_stack+0x46/0xd0", "[", "42.398267]", "kasan_kmalloc+0xad/0xe0", "[", "42.398548]", "kasan_slab_alloc+0x12/0x20", "[", "42.398848]", "__kmalloc_node_track_caller+0xcb/0x380", "[", "42.399224]", "__kmalloc_reserve.isra.32+0x41/0xe0", "[", "42.399654]", "__alloc_skb+0xf8/0x580", "[", "42.400003]", "sock_wmalloc+0xab/0xf0", "[", "42.400346]", "__ip6_append_data.isra.41+0x2472/0x33d0", "[", "42.400813]", "ip6_append_data+0x1a8/0x2f0", "[", "42.401122]", "rawv6_sendmsg+0x11ee/0x2db0", "[", "42.401505]", "inet_sendmsg+0x123/0x500", "[", "42.401860]", "sock_sendmsg+0xca/0x110", "[", "42.402209]", "___sys_sendmsg+0x7cb/0x930", "[", "42.402582]", "__sys_sendmsg+0xd9/0x190", "[", "42.402941]", "SyS_sendmsg+0x2d/0x50", "[", "42.403273]", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "[", "42.403718]", "[", "42.403871]", "Freed", "by", "task", "1794:", "[", "42.404146]", "save_stack_trace+0x16/0x20", "[", "42.404515]", "save_stack+0x46/0xd0", "[", "42.404827]", "kasan_slab_free+0x72/0xc0", "[", "42.405167]", "kfree+0xe8/0x2b0", "[", "42.405462]", "skb_free_head+0x74/0xb0", "[", "42.405806]", "skb_release_data+0x30e/0x3a0", "[", "42.406198]", "skb_release_all+0x4a/0x60", "[", "42.406563]", "consume_skb+0x113/0x2e0", "[", "42.406910]", "skb_free_datagram+0x1a/0xe0", "[", "42.407288]", "netlink_recvmsg+0x60d/0xe40", "[", "42.407667]", "sock_recvmsg+0xd7/0x110", "[", "42.408022]", "___sys_recvmsg+0x25c/0x580", "[", "42.408395]", "__sys_recvmsg+0xd6/0x190", "[", "42.408753]", "SyS_recvmsg+0x2d/0x50", "[", "42.409086]", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "[", "42.409513]", "[", "42.409665]", "The", "buggy", "address", "belongs", "to", "the", "object", "at", "ffff88000969e780", "[", "42.409665]", "which", "belongs", "to", "the", "cache", "kmalloc-512", "of", "size", "512", "[", "42.410846]", "The", "buggy", "address", "is", "located", "24", "bytes", "inside", "of", "[", "42.410846]", "512-byte", "region", "[ffff88000969e780,", "ffff88000969e980)", "[", "42.411941]", "The", "buggy", "address", "belongs", "to", "the", "page:", "[", "42.412405]", "page:ffffea000025a780", "count:1", "mapcount:0", "mapping:", "(null)", "index:0x0", "compound_mapcount:", "0", "[", "42.413298]", "flags:", "0x100000000008100(slab|head)", "[", "42.413729]", "raw:", "0100000000008100", "0000000000000000", "0000000000000000", "00000001800c000c", "[", "42.414387]", "raw:", "ffffea00002a9500", "0000000900000007", "ffff88000c401280", "0000000000000000", "[", "42.415074]", "page", "dumped", "because:", "kasan:", "bad", "access", "detected", "[", "42.415604]", "[", "42.415757]", "Memory", "state", "around", "the", "buggy", "address:", "[", "42.416222]", "ffff88000969e880:", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "[", "42.416904]", "ffff88000969e900:", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "[", "42.417591]", ">ffff88000969e980:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[", "42.418273]", "^", "[", "42.418588]", "ffff88000969ea00:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "42.419273]", "ffff88000969ea80:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "42.419882]", "==================================================================", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Craig", "Gallek", "<kraig@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "unfrag_ip6hlen", "<", "0", ")", "return", "ERR_PTR", "(", "unfrag_ip6hlen", ")", ";", "if", "(", "hlen", "<", "0", ")", "{", "err", "=", "hlen", ";", "goto", "fail", ";", "}", "while", "(", "offset", "<", "=", "packet_len", ")", "{", "struct", "ipv6_opt_hdr", "*", "exthdr", ";", "if", "(", "offset", "+", "sizeof", "(", "struct", "ipv6_opt_hdr", ")", ">", "packet_len", ")", "return", "-", "EINVAL", ";", "offset", "+", "=", "ipv6_optlen", "(", "exthdr", ")", ";", "*", "nexthdr", "=", "&", "exthdr", "-", ">", "nexthdr", ";", "return", "-", "EINVAL", ";", "if", "(", "unfrag_ip6hlen", "<", "0", ")", "return", "ERR_PTR", "(", "unfrag_ip6hlen", ")", ";</s>struct", "ipv6_opt_hdr", "*", "exthdr", "=", "(", "struct", "ipv6_opt_hdr", "*", ")(", "ipv6_hdr", "(", "skb", ")", "+", "1", ")", ";", "while", "(", "offset", "+", "1", "<", "=", "packet_len", ")", "{", "offset", "+", "=", "ipv6_optlen", "(", "exthdr", ")", ";", "*", "nexthdr", "=", "&", "exthdr", "-", ">", "nexthdr", ";", "return", "offset", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "socket", "and", "send", "system", "calls"]}
{"contents": ["block:", "Fix", "io_context", "leak", "after", "clone", "with", "CLONE_IO", "With", "CLONE_IO,", "copy_io()", "increments", "both", "ioc->refcount", "and", "ioc->nr_tasks.", "However", "exit_io_context()", "only", "decrements", "ioc->refcount", "if", "ioc->nr_tasks", "reaches", "0.", "Always", "call", "put_io_context()", "in", "exit_io_context().", "Signed-off-by:", "Louis", "Rilling", "<louis.rilling@kerlabs.com>", "Signed-off-by:", "Jens", "Axboe", "<jens.axboe@oracle.com>"], "code_tokens": ["put_io_context", "(", "ioc", ")", ";</s>put_io_context", "(", "ioc", ")", ";"], "docstring_tokens": ["by", "starting", "multiple", "processes", "that", "share", "an", "I/O", "context", "."]}
{"contents": ["[FIXED", "SECURITY-200]", "-", "Do", "not", "expose", "Api", "tokens", "to", "other", "users", "by", "default", "System", "property", "can", "be", "used", "to", "restore", "the", "original", "behavior"], "code_tokens": ["import", "hudson", ".", "security", ".", "ACL", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "/", "**", "*", "If", "enabled", ",", "shows", "API", "tokens", "to", "users", "with", "{", "@", "link", "Jenkins", "#", "ADMINISTER", ")", "permissions", ".", "*", "Disabled", "by", "default", "due", "to", "the", "security", "reasons", ".", "*", "If", "enabled", ",", "it", "restores", "the", "original", "Jenkins", "behavior", "(", "SECURITY", "-", "200", ")", ".", "*", "@", "since", "TODO", "*", "/", "private", "static", "final", "boolean", "SHOW_TOKEN_TO_ADMINS", "=", "Boolean", ".", "getBoolean", "(", "ApiTokenProperty", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "showTokenToAdmins", "\"", ");", "/", "**", "*", "Gets", "the", "API", "token", ".", "*", "The", "method", "performs", "security", "checks", ".", "Only", "the", "current", "user", "and", "SYSTEM", "may", "see", "it", ".", "*", "Users", "with", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", "may", "be", "allowed", "to", "do", "it", "using", "{", "@", "link", "#", "SHOW_TOKEN_TO_ADMINS", "}", ".", "*", "*", "@", "return", "API", "Token", ".", "Never", "null", ",", "but", "may", "be", "{", "@", "link", "Messages", "#", "ApiTokenProperty_ChangeToken_TokenIsHidden", "(", ")}", "*", "if", "the", "user", "has", "no", "appropriate", "permissions", ".", "*", "@", "since", "TODO", ":", "the", "method", "performs", "security", "checks", "*", "/", "@", "Nonnull", "return", "hasPermissionToSeeToken", "(", ")", "?", "getApiTokenInsecure", "(", ")", ":", "Messages", ".", "ApiTokenProperty_ChangeToken_TokenIsHidden", "(", ");", "}", "@", "Nonnull", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "/", "*", "package", "*", "/", "String", "getApiTokenInsecure", "(", ")", "{", "return", "getApiTokenInsecure", "(", ").", "equals", "(", "password", ")", ";", "}", "private", "boolean", "hasPermissionToSeeToken", "(", ")", "{", "final", "Jenkins", "jenkins", "=", "Jenkins", ".", "getInstance", "(", ");", "if", "(", "jenkins", "=", "=", "null", ")", "{", "return", "false", ";", "/", "/", "Should", "not", "happen", "-", "we", "don", "'", "t", "display", "UIs", "in", "this", "stage", "}", "/", "/", "Administrators", "can", "do", "whatever", "they", "want", "if", "(", "SHOW_TOKEN_TO_ADMINS", "&", "&", "jenkins", ".", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ")", "{", "return", "true", ";", "}", "final", "User", "current", "=", "User", ".", "current", "(", ");", "if", "(", "current", "=", "=", "null", ")", "{", "/", "/", "Anonymous", "return", "false", ";", "}", "/", "/", "SYSTEM", "user", "is", "always", "eligible", "to", "see", "tokens", "if", "(", "Jenkins", ".", "getAuthentication", "(", ")", "=", "=", "ACL", ".", "SYSTEM", ")", "{", "return", "true", ";", "}", "/", "/", "TODO", ":", "replace", "by", "IdStrategy", "in", "newer", "Jenkins", "versions", "/", "/", "return", "User", ".", "idStrategy", "(", ").", "equals", "(", "user", ".", "getId", "(", "),", "current", ".", "getId", "(", "))", ";", "return", "StringUtils", ".", "equals", "(", "user", ".", "getId", "(", "),", "current", ".", "getId", "(", "))", ";", "return", "HttpResponses", ".", "html", "(", "p", ".", "hasPermissionToSeeToken", "(", ")", "?", "Messages", ".", "ApiTokenProperty_ChangeToken_Success", "(", ")", ":", "Messages", ".", "ApiTokenProperty_ChangeToken_SuccessHidden", "(", "))", ";", "ApiTokenProperty", ".", "ChangeToken", ".", "TokenIsHidden", "=", "Token", "is", "hidden", "ApiTokenProperty", ".", "ChangeToken", ".", "Success", "=", "<", "div", ">", "Updated", ".", "See", "the", "new", "token", "in", "the", "field", "above", "<", "/", "div", ">", "ApiTokenProperty", ".", "ChangeToken", ".", "SuccessHidden", "=", "<", "div", ">", "Updated", ".", "You", "need", "to", "login", "as", "the", "user", "to", "see", "the", "token", "<", "/", "div", ">", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "final", "ApiTokenProperty", "t", "=", "u", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ";", "/", "/", "Make", "sure", "that", "user", "is", "able", "to", "get", "the", "token", "via", "the", "interface", "ACL", ".", "impersonate", "(", "u", ".", "impersonate", "(", "),", "new", "Runnable", "(", ")", "{", "public", "void", "run", "(", ")", "{", "assertEquals", "(", "\"", "User", "is", "unable", "to", "get", "its", "own", "token", "\"", ",", "token", ",", "t", ".", "getApiToken", "(", "))", ";", "/", "/", "test", "the", "authentication", "via", "Token", "WebClient", "wc", "=", "createClientForUser", "(", "\"", "foo", "\"", ");", "/", "/", "Make", "sure", "the", "UI", "shows", "the", "token", "to", "the", "user", "HtmlPage", "config", "=", "wc", ".", "goTo", "(", "u", ".", "getUrl", "(", ")", "+", "\"", "/", "configure", "\"", ");", "HtmlForm", "form", "=", "config", ".", "getFormByName", "(", "\"", "config", "\"", ");", "assertEquals", "(", "token", ",", "form", ".", "getInputByName", "(", "\"", "_", ".", "apiToken", "\"", ").", "getValueAttribute", "(", "))", ";", "/", "/", "round", "-", "trip", "shouldn", "'", "t", "change", "the", "API", "token", "submit", "(", "form", ")", ";", "assertSame", "(", "t", ",", "u", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "200", "\"", ")", "public", "void", "testAdminsShouldBeUnableToSeeTokensByDefault", "(", ")", "throws", "Exception", "{", "jenkins", ".", "setSecurityRealm", "(", "createDummySecurityRealm", "(", "))", ";", "User", "u", "=", "User", ".", "get", "(", "\"", "foo", "\"", ");", "final", "ApiTokenProperty", "t", "=", "u", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ";", "final", "String", "token", "=", "t", ".", "getApiToken", "(", ");", "/", "/", "Make", "sure", "the", "UI", "does", "not", "show", "the", "token", "to", "another", "user", "WebClient", "wc", "=", "createClientForUser", "(", "\"", "bar", "\"", ");", "HtmlPage", "config", "=", "wc", ".", "goTo", "(", "u", ".", "getUrl", "(", ")", "+", "\"", "/", "configure", "\"", ");", "HtmlForm", "form", "=", "config", ".", "getFormByName", "(", "\"", "config", "\"", ");", "assertEquals", "(", "Messages", ".", "ApiTokenProperty_ChangeToken_TokenIsHidden", "(", "),", "form", ".", "getInputByName", "(", "\"", "_", ".", "apiToken", "\"", ").", "getValueAttribute", "(", "))", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "200", "\"", ")", "public", "void", "testAdminsShouldBeUnableToChangeTokensByDefault", "(", ")", "throws", "Exception", "{", "jenkins", ".", "setSecurityRealm", "(", "createDummySecurityRealm", "(", "))", ";", "User", "foo", "=", "User", ".", "get", "(", "\"", "foo", "\"", ");", "User", "bar", "=", "User", ".", "get", "(", "\"", "bar", "\"", ");", "final", "ApiTokenProperty", "t", "=", "foo", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ";", "final", "ApiTokenProperty", ".", "DescriptorImpl", "descriptor", "=", "(", "ApiTokenProperty", ".", "DescriptorImpl", ")", "t", ".", "getDescriptor", "(", ");", "/", "/", "Make", "sure", "that", "Admin", "can", "reset", "a", "token", "of", "another", "user", "WebClient", "wc", "=", "createClientForUser", "(", "\"", "bar", "\"", ");", "HtmlPage", "res", "=", "wc", ".", "goTo", "(", "foo", ".", "getUrl", "(", ")", "+", "\"", "/\"", "+", "descriptor", ".", "getDescriptorUrl", "(", ")+", "\"", "/", "changeToken", "\"", ");", "assertEquals", "(", "\"", "Update", "token", "response", "is", "incorrect", "\"", ",", "Messages", ".", "ApiTokenProperty_ChangeToken_SuccessHidden", "(", "),", "\"", "<", "div", ">", "\"", "+", "res", ".", "getBody", "(", ").", "asText", "(", ")", "+", "\"", "</", "div", ">", "\")", ";", "}", "@", "Nonnull", "private", "WebClient", "createClientForUser", "(", "final", "String", "username", ")", "{", "User", "u", "=", "User", ".", "get", "(", "username", ")", ";", "final", "ApiTokenProperty", "t", "=", "u", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ";", "/", "/", "Yes", ",", "we", "use", "the", "insecure", "call", "in", "the", "test", "stuff", "final", "String", "token", "=", "t", ".", "getApiTokenInsecure", "(", ");", "WebClient", "wc", "=", "createWebClient", "(", ");", "wc", ".", "setCredentialsProvider", "(", "new", "CredentialsProvider", "(", ")", "{", "@", "Override", "public", "Credentials", "getCredentials", "(", "AuthScheme", "scheme", ",", "String", "host", ",", "int", "port", ",", "boolean", "proxy", ")", "throws", "CredentialsNotAvailableException", "{", "return", "new", "UsernamePasswordCredentials", "(", "username", ",", "token", ")", ";", "}", "}", ");", "wc", ".", "setWebConnection", "(", "new", "HttpWebConnection", "(", "wc", ")", "{", "@", "Override", "protected", "HttpClient", "getHttpClient", "(", ")", "{", "HttpClient", "c", "=", "super", ".", "getHttpClient", "(", ");", "c", ".", "getParams", "(", ").", "setAuthenticationPreemptive", "(", "true", ")", ";", "c", ".", "getState", "(", ").", "setCredentials", "(", "new", "AuthScope", "(", "\"", "localhost", "\"", ",", "localPort", ",", "AuthScope", ".", "ANY_REALM", ")", ",", "new", "UsernamePasswordCredentials", "(", "username", ",", "token", ")", ");", "return", "c", ";", "}", "}", ");", "return", "wc", ";", "}</s>return", "getApiToken", "(", ").", "equals", "(", "password", ")", ";", "return", "HttpResponses", ".", "html", "(", "Messages", ".", "ApiTokenProperty_ChangeToken_Success", "(", "))", ";", "ApiTokenProperty", ".", "ChangeToken", ".", "Success", "=", "<", "div", ">", "Updated", "<", "/", "div", ">", "ApiTokenProperty", "t", "=", "u", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ";", "/", "/", "make", "sure", "the", "UI", "shows", "the", "token", "HtmlPage", "config", "=", "createWebClient", "(", ").", "goTo", "(", "u", ".", "getUrl", "(", ")", "+", "\"", "/", "configure", "\"", ");", "HtmlForm", "form", "=", "config", ".", "getFormByName", "(", "\"", "config", "\"", ");", "assertEquals", "(", "token", ",", "form", ".", "getInputByName", "(", "\"", "_", ".", "apiToken", "\"", ").", "getValueAttribute", "(", "))", ";", "/", "/", "round", "-", "trip", "shouldn", "'", "t", "change", "the", "API", "token", "submit", "(", "form", ")", ";", "assertSame", "(", "t", ",", "u", ".", "getProperty", "(", "ApiTokenProperty", ".", "class", ")", ");", "WebClient", "wc", "=", "createWebClient", "(", ");", "wc", ".", "setCredentialsProvider", "(", "new", "CredentialsProvider", "(", ")", "{", "public", "Credentials", "getCredentials", "(", "AuthScheme", "scheme", ",", "String", "host", ",", "int", "port", ",", "boolean", "proxy", ")", "throws", "CredentialsNotAvailableException", "{", "return", "new", "UsernamePasswordCredentials", "(", "\"", "foo", "\"", ",", "token", ")", ";", "}", "}", ");", "wc", ".", "setWebConnection", "(", "new", "HttpWebConnection", "(", "wc", ")", "{", "protected", "HttpClient", "getHttpClient", "(", ")", "{", "HttpClient", "c", "=", "super", ".", "getHttpClient", "(", ");", "c", ".", "getParams", "(", ").", "setAuthenticationPreemptive", "(", "true", ")", ";", "c", ".", "getState", "(", ").", "setCredentials", "(", "new", "AuthScope", "(", "\"", "localhost", "\"", ",", "localPort", ",", "AuthScope", ".", "ANY_REALM", ")", ",", "new", "UsernamePasswordCredentials", "(", "\"", "foo", "\"", ",", "token", ")", ");", "return", "c", ";", "/", "/", "test", "the", "authentication"], "docstring_tokens": ["by", "using", "an", "API", "token", "of", "another", "user"]}
{"contents": ["[media]", "saa7164:", "fix", "double", "fetch", "PCIe", "access", "condition", "Avoid", "a", "double", "fetch", "by", "reusing", "the", "values", "from", "the", "prior", "transfer.", "Originally", "reported", "via", "https://bugzilla.kernel.org/show_bug.cgi?id=195559", "Thanks", "to", "Pengfei", "Wang", "<wpengfeinudt@gmail.com>", "for", "reporting.", "Signed-off-by:", "Steven", "Toth", "<stoth@kernellabs.com>", "Reported-by:", "Pengfei", "Wang", "<wpengfeinudt@gmail.com>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@s-opensource.com>"], "code_tokens": ["memcpy", "(", "msg", ",", "&", "msg_tmp", ",", "sizeof", "(", "*", "msg", ")", ");</s>memcpy", "(", "msg", ",", "&", "msg_tmp", ",", "sizeof", "(", "*", "msg", ")", ");", "/", "*", "msg", "wraps", "around", "the", "ring", "*", "/", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "space_rem", ")", ";", "memcpy_fromio", "(", "(", "u8", "*", ")", "msg", "+", "space_rem", ",", "bus", "-", ">", "m_pdwGetRing", ",", "sizeof", "(", "*", "msg", ")", "-", "space_rem", ")", ";", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "sizeof", "(", "*", "msg", ")", ");", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "sizeof", "(", "*", "msg", ")", ");", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "sizeof", "(", "*", "msg", ")", ");", "/", "*", "Convert", "from", "little", "endian", "to", "CPU", "*", "/", "msg", "-", ">", "size", "=", "le16_to_cpu", "(", "(", "__force", "__le16", ")", "msg", "-", ">", "size", ")", ";", "msg", "-", ">", "command", "=", "le32_to_cpu", "(", "(", "__force", "__le32", ")", "msg", "-", ">", "command", ")", ";", "msg", "-", ">", "controlselector", "=", "le16_to_cpu", "(", "(", "__force", "__le16", ")", "msg", "-", ">", "controlselector", ")", ";"], "docstring_tokens": ["by", "changing", "a", "certain", "sequence-number", "value"]}
{"contents": ["mwifiex:", "Fix", "heap", "overflow", "in", "mwifiex_uap_parse_tail_ies()", "A", "few", "places", "in", "mwifiex_uap_parse_tail_ies()", "perform", "memcpy()", "unconditionally,", "which", "may", "lead", "to", "either", "buffer", "overflow", "or", "read", "over", "boundary.", "This", "patch", "addresses", "the", "issues", "by", "checking", "the", "read", "size", "and", "the", "destination", "size", "at", "each", "place", "more", "properly.", "Along", "with", "the", "fixes,", "the", "patch", "cleans", "up", "the", "code", "slightly", "by", "introducing", "a", "temporary", "variable", "for", "the", "token", "size,", "and", "unifies", "the", "error", "path", "with", "the", "standard", "goto", "statement.", "Reported-by:", "huangwen", "<huangwen@venustech.com.cn>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>", "Signed-off-by:", "Kalle", "Valo", "<kvalo@codeaurora.org>"], "code_tokens": ["unsigned", "int", "token_len", ";", "int", "err", "=", "0", ";", "token_len", "=", "hdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ";", "if", "(", "token_len", ">", "left_len", ")", "{", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "token_len", ")", ")", "if", "(", "ie_len", "+", "token_len", ">", "IEEE_MAX_IE_SIZE", ")", "{", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "memcpy", "(", "gen_ie", "-", ">", "ie_buffer", "+", "ie_len", ",", "hdr", ",", "token_len", ")", ";", "ie_len", "+", "=", "token_len", ";", "left_len", "-", "=", "token_len", ";", "parsed_len", "+", "=", "token_len", ";", "token_len", "=", "vendorhdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ";", "if", "(", "ie_len", "+", "token_len", ">", "IEEE_MAX_IE_SIZE", ")", "{", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "memcpy", "(", "gen_ie", "-", ">", "ie_buffer", "+", "ie_len", ",", "vendorhdr", ",", "token_len", ")", ";", "ie_len", "+", "=", "token_len", ";", "if", "(", "!", "ie_len", ")", "goto", "out", ";", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "out", ":", "return", "err", ";</s>hdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", "))", "memcpy", "(", "gen_ie", "-", ">", "ie_buffer", "+", "ie_len", ",", "hdr", ",", "hdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ");", "ie_len", "+", "=", "hdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ";", "left_len", "-", "=", "hdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ";", "parsed_len", "+", "=", "hdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ";", "memcpy", "(", "gen_ie", "-", ">", "ie_buffer", "+", "ie_len", ",", "vendorhdr", ",", "vendorhdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ");", "ie_len", "+", "=", "vendorhdr", "-", ">", "len", "+", "sizeof", "(", "struct", "ieee_types_header", ")", ";", "if", "(", "!", "ie_len", ")", "{", "kfree", "(", "gen_ie", ")", ";", "return", "0", ";", "}", "kfree", "(", "gen_ie", ")", ";", "return", "-", "1", ";", "return", "0", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "call"]}
{"contents": ["Check", "that", "we", "have", "enough", "padding", "characters.", "Reviewed-by:", "Emilia", "K\u00e4sper", "<emilia@openssl.org>", "MR:", "#2572"], "code_tokens": ["#", "include", "\"", "constant_time_locl", ".", "h", "\"", "ret", "&", "=", "constant_time_ge", "(", "maxpad", ",", "pad", ")", ";", "#", "include", "\"", "constant_time_locl", ".", "h", "\"", "ret", "&", "=", "constant_time_ge", "(", "maxpad", ",", "pad", ")", ";</s>"], "docstring_tokens": ["supply", "very", "large", "amounts", "of", "input", "data"]}
{"contents": ["[SECURITY-1409]"], "code_tokens": ["import", "org", ".", "jenkinsci", ".", "plugins", ".", "pipeline", ".", "maven", ".", "util", ".", "XmlUtils", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "/", "/", "https", ":", "//", "github", ".", "com", "/", "OWASP", "/", "CheatSheetSeries", "/", "blob", "/", "master", "/", "cheatsheets", "/", "XML_External_Entity_Prevention_Cheat_Sheet", ".", "md", "#", "jaxp", "-", "documentbuilderfactory", "-", "saxparserfactory", "-", "and", "-", "dom4j", "dbf", ".", "setExpandEntityReferences", "(", "false", ")", ";", "dbf", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "/", "/", "This", "is", "the", "PRIMARY", "defense", ".", "If", "DTDs", "(", "doctypes", ")", "are", "disallowed", ",", "almost", "all", "/", "/", "XML", "entity", "attacks", "are", "prevented", "/", "/", "Xerces", "2", "only", "-", "http", ":", "//", "xerces", ".", "apache", ".", "org", "/", "xerces2", "-", "j", "/", "features", ".", "html", "#", "disallow", "-", "doctype", "-", "decl", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "/", "/", "If", "you", "can", "'", "t", "completely", "disable", "DTDs", ",", "then", "at", "least", "do", "the", "following", ":", "/", "/", "Xerces", "1", "-", "http", ":", "//", "xerces", ".", "apache", ".", "org", "/", "xerces", "-", "j", "/", "features", ".", "html", "#", "external", "-", "general", "-", "entities", "/", "/", "Xerces", "2", "-", "http", ":", "//", "xerces", ".", "apache", ".", "org", "/", "xerces2", "-", "j", "/", "features", ".", "html", "#", "external", "-", "general", "-", "entities", "/", "/", "JDK7", "+", "-", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "/", "/", "Xerces", "1", "-", "http", ":", "//", "xerces", ".", "apache", ".", "org", "/", "xerces", "-", "j", "/", "features", ".", "html", "#", "external", "-", "parameter", "-", "entities", "/", "/", "Xerces", "2", "-", "http", ":", "//", "xerces", ".", "apache", ".", "org", "/", "xerces2", "-", "j", "/", "features", ".", "html", "#", "external", "-", "parameter", "-", "entities", "/", "/", "JDK7", "+", "-", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "false", ")", ";", "/", "/", "Disable", "external", "DTDs", "as", "well", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "\"", ",", "false", ")", ";", "/", "/", "and", "these", "as", "well", ",", "per", "Timothy", "Morgan", "'", "s", "2014", "paper", ":", "\"", "XML", "Schema", ",", "DTD", ",", "and", "Entity", "Attacks", "\"", "dbf", ".", "setXIncludeAware", "(", "false", ")", ";", "documentBuilder", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "/", "/", "See", "https", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "jenkins", "/", "blob", "/", "jenkins", "-", "2", ".", "176", "/", "core", "/", "src", "/", "main", "/", "java", "/", "jenkins", "/", "util", "/", "xml", "/", "XMLUtils", ".", "java", "#", "L114", "documentBuilder", ".", "setEntityResolver", "(", "XmlUtils", ".", "RestrictiveEntityResolver", ".", "INSTANCE", ")", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "java", ".", "io", ".", "IOException", ";", "/", "**", "*", "Copy", "{", "@", "link", "jenkins", ".", "util", ".", "xml", ".", "RestrictiveEntityResolver", "}", "as", "it", "is", "secured", "by", "{", "@", "link", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", "}", ".", "*", "*", "@", "see", "jenkins", ".", "util", ".", "xml", ".", "RestrictiveEntityResolver", "*", "/", "public", "final", "static", "class", "RestrictiveEntityResolver", "implements", "EntityResolver", "{", "public", "final", "static", "RestrictiveEntityResolver", "INSTANCE", "=", "new", "RestrictiveEntityResolver", "(", ");", "private", "RestrictiveEntityResolver", "(", ")", "{", "/", "/", "prevent", "multiple", "instantiation", ".", "super", "(", ");", "}", "/", "**", "*", "Throws", "a", "SAXException", "if", "this", "tried", "to", "resolve", "any", "entity", ".", "*", "/", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "throws", "SAXException", ",", "IOException", "{", "throw", "new", "SAXException", "(", "\"", "Refusing", "to", "resolve", "entity", "with", "publicId", "(", "\"", "+", "publicId", "+", "\"", ")", "and", "systemId", "(", "\"", "+", "systemId", "+", "\"", ")\"", ");", "}", "}</s>import", "hudson", ".", "model", ".", "StreamBuildListener", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Objects", ";", "documentBuilder", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ").", "newDocumentBuilder", "(", ");"], "docstring_tokens": ["define", "a", "custom", "parser"]}
{"contents": ["new", "helper:", "copy_page_from_iter()", "parallel", "to", "copy_page_to_iter().", "pipe_write()", "switched", "to", "it", "(and", "became", "->write_iter()).", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["pipe_write", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "iov_iter", "*", "from", ")", "ssize_t", "ret", "=", "0", ";", "int", "do_wakeup", "=", "0", ";", "size_t", "total_len", "=", "iov_iter_count", "(", "from", ")", ";", "int", "error", "=", "ops", "-", ">", "confirm", "(", "pipe", ",", "buf", ")", ";", "ret", "=", "copy_page_from_iter", "(", "buf", "-", ">", "page", ",", "offset", ",", "chars", ",", "from", ")", ";", "if", "(", "unlikely", "(", "ret", "<", "chars", ")", ")", "{", "error", "=", "-", "EFAULT", ";", "do_wakeup", "=", "1", ";", "if", "(", "!", "iov_iter_count", "(", "from", ")", ")", "int", "copied", ";", "copied", "=", "copy_page_from_iter", "(", "page", ",", "0", ",", "PAGE_SIZE", ",", "from", ")", ";", "if", "(", "unlikely", "(", "copied", "<", "PAGE_SIZE", "&", "&", "iov_iter_count", "(", "from", ")", "))", "{", "ret", "=", "-", "EFAULT", ";", "ret", "+", "=", "copied", ";", "buf", "-", ">", "len", "=", "copied", ";", "if", "(", "!", "iov_iter_count", "(", "from", ")", ")", ".", "write", "=", "new_sync_write", ",", ".", "write_iter", "=", "pipe_write", ",", "size_t", "copy_page_from_iter", "(", "struct", "page", "*", "page", ",", "size_t", "offset", ",", "size_t", "bytes", ",", "struct", "iov_iter", "*", "i", ")", ";", "size_t", "copy_page_from_iter", "(", "struct", "page", "*", "page", ",", "size_t", "offset", ",", "size_t", "bytes", ",", "struct", "iov_iter", "*", "i", ")", "{", "size_t", "skip", ",", "copy", ",", "left", ",", "wanted", ";", "const", "struct", "iovec", "*", "iov", ";", "char", "__user", "*", "buf", ";", "void", "*", "kaddr", ",", "*", "to", ";", "if", "(", "unlikely", "(", "bytes", ">", "i", "-", ">", "count", ")", ")", "bytes", "=", "i", "-", ">", "count", ";", "if", "(", "unlikely", "(", "!", "bytes", ")", ")", "return", "0", ";", "wanted", "=", "bytes", ";", "iov", "=", "i", "-", ">", "iov", ";", "skip", "=", "i", "-", ">", "iov_offset", ";", "buf", "=", "iov", "-", ">", "iov_base", "+", "skip", ";", "copy", "=", "min", "(", "bytes", ",", "iov", "-", ">", "iov_len", "-", "skip", ")", ";", "if", "(", "!", "fault_in_pages_readable", "(", "buf", ",", "copy", ")", ")", "{", "kaddr", "=", "kmap_atomic", "(", "page", ")", ";", "to", "=", "kaddr", "+", "offset", ";", "/", "*", "first", "chunk", ",", "usually", "the", "only", "one", "*", "/", "left", "=", "__copy_from_user_inatomic", "(", "to", ",", "buf", ",", "copy", ")", ";", "copy", "-", "=", "left", ";", "skip", "+", "=", "copy", ";", "to", "+", "=", "copy", ";", "bytes", "-", "=", "copy", ";", "while", "(", "unlikely", "(", "!", "left", "&", "&", "bytes", ")", ")", "{", "iov", "+", "+;", "buf", "=", "iov", "-", ">", "iov_base", ";", "copy", "=", "min", "(", "bytes", ",", "iov", "-", ">", "iov_len", ")", ";", "left", "=", "__copy_from_user_inatomic", "(", "to", ",", "buf", ",", "copy", ")", ";", "copy", "-", "=", "left", ";", "skip", "=", "copy", ";", "to", "+", "=", "copy", ";", "bytes", "-", "=", "copy", ";", "}", "if", "(", "likely", "(", "!", "bytes", ")", ")", "{", "kunmap_atomic", "(", "kaddr", ")", ";", "goto", "done", ";", "}", "offset", "=", "to", "-", "kaddr", ";", "buf", "+", "=", "copy", ";", "kunmap_atomic", "(", "kaddr", ")", ";", "copy", "=", "min", "(", "bytes", ",", "iov", "-", ">", "iov_len", "-", "skip", ")", ";", "}", "/", "*", "Too", "bad", "-", "revert", "to", "non", "-", "atomic", "kmap", "*", "/", "kaddr", "=", "kmap", "(", "page", ")", ";", "to", "=", "kaddr", "+", "offset", ";", "left", "=", "__copy_from_user", "(", "to", ",", "buf", ",", "copy", ")", ";", "copy", "-", "=", "left", ";", "skip", "+", "=", "copy", ";", "to", "+", "=", "copy", ";", "bytes", "-", "=", "copy", ";", "while", "(", "unlikely", "(", "!", "left", "&", "&", "bytes", ")", ")", "{", "iov", "+", "+;", "buf", "=", "iov", "-", ">", "iov_base", ";", "copy", "=", "min", "(", "bytes", ",", "iov", "-", ">", "iov_len", ")", ";", "left", "=", "__copy_from_user", "(", "to", ",", "buf", ",", "copy", ")", ";", "copy", "-", "=", "left", ";", "skip", "=", "copy", ";", "to", "+", "=", "copy", ";", "bytes", "-", "=", "copy", ";", "}", "kunmap", "(", "page", ")", ";", "done", ":", "i", "-", ">", "count", "-", "=", "wanted", "-", "bytes", ";", "i", "-", ">", "nr_segs", "-", "=", "iov", "-", "i", "-", ">", "iov", ";", "i", "-", ">", "iov", "=", "iov", ";", "i", "-", ">", "iov_offset", "=", "skip", ";", "return", "wanted", "-", "bytes", ";", "}", "EXPORT_SYMBOL", "(", "copy_page_from_iter", ")", ";</s>static", "int", "pipe_iov_copy_from_user", "(", "void", "*", "to", ",", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "len", ",", "int", "atomic", ")", "{", "unsigned", "long", "copy", ";", "while", "(", "len", ">", "0", ")", "{", "while", "(", "!", "iov", "-", ">", "iov_len", ")", "iov", "+", "+;", "copy", "=", "min_t", "(", "unsigned", "long", ",", "len", ",", "iov", "-", ">", "iov_len", ")", ";", "if", "(", "atomic", ")", "{", "if", "(", "__copy_from_user_inatomic", "(", "to", ",", "iov", "-", ">", "iov_base", ",", "copy", ")", ")", "return", "-", "EFAULT", ";", "}", "else", "{", "if", "(", "copy_from_user", "(", "to", ",", "iov", "-", ">", "iov_base", ",", "copy", ")", ")", "return", "-", "EFAULT", ";", "}", "to", "+", "=", "copy", ";", "len", "-", "=", "copy", ";", "iov", "-", ">", "iov_base", "+", "=", "copy", ";", "iov", "-", ">", "iov_len", "-", "=", "copy", ";", "}", "return", "0", ";", "}", "/", "*", "*", "Pre", "-", "fault", "in", "the", "user", "memory", ",", "so", "we", "can", "use", "atomic", "copies", ".", "*", "/", "static", "void", "iov_fault_in_pages_read", "(", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "len", ")", "{", "while", "(", "!", "iov", "-", ">", "iov_len", ")", "iov", "+", "+;", "while", "(", "len", ">", "0", ")", "{", "unsigned", "long", "this_len", ";", "this_len", "=", "min_t", "(", "unsigned", "long", ",", "len", ",", "iov", "-", ">", "iov_len", ")", ";", "fault_in_pages_readable", "(", "iov", "-", ">", "iov_base", ",", "this_len", ")", ";", "len", "-", "=", "this_len", ";", "iov", "+", "+;", "}", "}", "pipe_write", "(", "struct", "kiocb", "*", "iocb", ",", "const", "struct", "iovec", "*", "_iov", ",", "unsigned", "long", "nr_segs", ",", "loff_t", "ppos", ")", "ssize_t", "ret", ";", "int", "do_wakeup", ";", "struct", "iovec", "*", "iov", "=", "(", "struct", "iovec", "*", ")", "_iov", ";", "size_t", "total_len", ";", "total_len", "=", "iov_length", "(", "iov", ",", "nr_segs", ")", ";", "do_wakeup", "=", "0", ";", "ret", "=", "0", ";", "int", "error", ",", "atomic", "=", "1", ";", "void", "*", "addr", ";", "error", "=", "ops", "-", ">", "confirm", "(", "pipe", ",", "buf", ")", ";", "iov_fault_in_pages_read", "(", "iov", ",", "chars", ")", ";", "redo1", ":", "if", "(", "atomic", ")", "addr", "=", "kmap_atomic", "(", "buf", "-", ">", "page", ")", ";", "else", "addr", "=", "kmap", "(", "buf", "-", ">", "page", ")", ";", "error", "=", "pipe_iov_copy_from_user", "(", "offset", "+", "addr", ",", "iov", ",", "chars", ",", "atomic", ")", ";", "if", "(", "atomic", ")", "kunmap_atomic", "(", "addr", ")", ";", "else", "kunmap", "(", "buf", "-", ">", "page", ")", ";", "ret", "=", "error", ";", "do_wakeup", "=", "1", ";", "if", "(", "error", ")", "{", "if", "(", "atomic", ")", "{", "atomic", "=", "0", ";", "goto", "redo1", ";", "}", "total_len", "-", "=", "chars", ";", "if", "(", "!", "total_len", ")", "char", "*", "src", ";", "int", "error", ",", "atomic", "=", "1", ";", "chars", "=", "PAGE_SIZE", ";", "if", "(", "chars", ">", "total_len", ")", "chars", "=", "total_len", ";", "iov_fault_in_pages_read", "(", "iov", ",", "chars", ")", ";", "redo2", ":", "if", "(", "atomic", ")", "src", "=", "kmap_atomic", "(", "page", ")", ";", "else", "src", "=", "kmap", "(", "page", ")", ";", "error", "=", "pipe_iov_copy_from_user", "(", "src", ",", "iov", ",", "chars", ",", "atomic", ")", ";", "if", "(", "atomic", ")", "kunmap_atomic", "(", "src", ")", ";", "else", "kunmap", "(", "page", ")", ";", "if", "(", "unlikely", "(", "error", ")", ")", "{", "if", "(", "atomic", ")", "{", "atomic", "=", "0", ";", "goto", "redo2", ";", "}", "ret", "=", "error", ";", "ret", "+", "=", "chars", ";", "buf", "-", ">", "len", "=", "chars", ";", "total_len", "-", "=", "chars", ";", "if", "(", "!", "total_len", ")", ".", "write", "=", "do_sync_write", ",", ".", "aio_write", "=", "pipe_write", ","], "docstring_tokens": ["via", "a", "crafted", "application"]}
{"contents": ["Ensure", "we", "secure", "hawtio-karaf-terminal's", "/term", "context"], "code_tokens": ["package", "io", ".", "hawt", ".", "web", ".", "plugin", ".", "karaf", ".", "terminal", ";", "import", "io", ".", "hawt", ".", "system", ".", "ConfigManager", ";", "import", "javax", ".", "servlet", ".", "ServletContextEvent", ";", "import", "javax", ".", "servlet", ".", "ServletContextListener", ";", "/", "**", "*", "@", "author", "Stan", "Lewis", "*", "/", "public", "class", "KarafTerminalContextListener", "implements", "ServletContextListener", "{", "private", "ConfigManager", "configManager", "=", "new", "ConfigManager", "(", ");", "@", "Override", "public", "void", "contextInitialized", "(", "ServletContextEvent", "sce", ")", "{", "try", "{", "configManager", ".", "init", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "createServletException", "(", "e", ")", ";", "}", "sce", ".", "getServletContext", "(", ").", "setAttribute", "(", "\"", "ConfigManager", "\"", ",", "configManager", ")", ";", "}", "@", "Override", "public", "void", "contextDestroyed", "(", "ServletContextEvent", "sce", ")", "{", "try", "{", "configManager", ".", "destroy", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "createServletException", "(", "e", ")", ";", "}", "}", "protected", "RuntimeException", "createServletException", "(", "Exception", "e", ")", "{", "return", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "@", "@", "-", "1", ",", "18", "+", "1", ",", "23", "@", "@", "import", "io", ".", "hawt", ".", "system", ".", "Helpers", ";", "import", "javax", ".", "security", ".", "auth", ".", "Subject", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpSession", ";", "import", "java", ".", "security", ".", "AccessControlContext", ";", "import", "java", ".", "security", ".", "AccessController", ";", "HttpSession", "session", "=", "request", ".", "getSession", "(", "false", ")", ";", "if", "(", "session", "=", "=", "null", ")", "{", "AccessControlContext", "acc", "=", "AccessController", ".", "getContext", "(", ");", "Subject", "subject", "=", "Subject", ".", "getSubject", "(", "acc", ")", ";", "if", "(", "subject", "=", "=", "null", ")", "{", "Helpers", ".", "doForbidden", "(", "response", ")", ";", "return", ";", "}", "session", "=", "request", ".", "getSession", "(", "true", ")", ";", "session", ".", "setAttribute", "(", "\"", "subject", "\"", ",", "subject", ")", ";", "}", "else", "{", "Subject", "subject", "=", "(", "Subject", ")", "session", ".", "getAttribute", "(", "\"", "subject", "\"", ");", "if", "(", "subject", "=", "=", "null", ")", "{", "session", ".", "invalidate", "(", ");", "Helpers", ".", "doForbidden", "(", "response", ")", ";", "return", ";", "}", "}", "SessionTerminal", "st", "=", "(", "SessionTerminal", ")", "session", ".", "getAttribute", "(", "\"", "terminal", "\"", ");", "session", ".", "setAttribute", "(", "\"", "terminal", "\"", ",", "st", ")", ";", "boolean", "doAuthenticate", "=", "true", ";", "LOG", ".", "warn", "(", "\"", "No", "authentication", "needed", "for", "path", "{", "}\"", ",", "path", ")", ";</s>SessionTerminal", "st", "=", "(", "SessionTerminal", ")", "request", ".", "getSession", "(", "true", ")", ".", "getAttribute", "(", "\"", "terminal", "\"", ");", "request", ".", "getSession", "(", ").", "setAttribute", "(", "\"", "terminal", "\"", ",", "st", ")", ";", "boolean", "doAuthenticate", "=", "path", ".", "startsWith", "(", "\"/", "auth", "\"", ")", "|", "|", "path", ".", "startsWith", "(", "\"/", "jolokia", "\"", ")", "|", "|", "path", ".", "startsWith", "(", "\"/", "upload", "\"", ");", "LOG", ".", "debug", "(", "\"", "No", "authentication", "needed", "for", "path", "{", "}\"", ",", "path", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request", "with", "k", "parameter"]}
{"contents": ["net:", "sk_add_backlog()", "take", "rmem_alloc", "into", "account", "Current", "socket", "backlog", "limit", "is", "not", "enough", "to", "really", "stop", "DDOS", "attacks,", "because", "user", "thread", "spend", "many", "time", "to", "process", "a", "full", "backlog", "each", "round,", "and", "user", "might", "crazy", "spin", "on", "socket", "lock.", "We", "should", "add", "backlog", "size", "and", "receive_queue", "size", "(aka", "rmem_alloc)", "to", "pace", "writers,", "and", "let", "user", "run", "without", "being", "slow", "down", "too", "much.", "Introduce", "a", "sk_rcvqueues_full()", "helper,", "to", "avoid", "taking", "socket", "lock", "in", "stress", "situations.", "Under", "huge", "stress", "from", "a", "multiqueue/RPS", "enabled", "NIC,", "a", "single", "flow", "udp", "receiver", "can", "now", "process", "~200.000", "pps", "(instead", "of", "~100", "pps", "before", "the", "patch)", "on", "a", "8", "core", "machine.", "Signed-off-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["/", "*", "*", "Take", "into", "account", "size", "of", "receive", "queue", "and", "backlog", "queue", "*", "/", "static", "inline", "bool", "sk_rcvqueues_full", "(", "const", "struct", "sock", "*", "sk", ",", "const", "struct", "sk_buff", "*", "skb", ")", "{", "unsigned", "int", "qsize", "=", "sk", "-", ">", "sk_backlog", ".", "len", "+", "atomic_read", "(", "&", "sk", "-", ">", "sk_rmem_alloc", ")", ";", "return", "qsize", "+", "skb", "-", ">", "truesize", ">", "sk", "-", ">", "sk_rcvbuf", ";", "}", "if", "(", "sk_rcvqueues_full", "(", "sk", ",", "skb", ")", ")", "if", "(", "sk_rcvqueues_full", "(", "sk", ",", "skb", ")", ")", "{", "atomic_inc", "(", "&", "sk", "-", ">", "sk_drops", ")", ";", "goto", "discard_and_relse", ";", "}", "if", "(", "sk_rcvqueues_full", "(", "sk", ",", "skb", ")", ")", "goto", "drop", ";", "if", "(", "sk_rcvqueues_full", "(", "sk", ",", "skb", ")", ")", "{", "kfree_skb", "(", "skb1", ")", ";", "goto", "drop", ";", "}", "if", "(", "sk_rcvqueues_full", "(", "sk", ",", "skb", ")", ")", "{", "sock_put", "(", "sk", ")", ";", "goto", "discard", ";", "}</s>int", "limit", ";", "if", "(", "sk", "-", ">", "sk_backlog", ".", "len", ">", "=", "max", "(", "sk", "-", ">", "sk_backlog", ".", "limit", ",", "sk", "-", ">", "sk_rcvbuf", "<", "<", "1", ")", ")", "sk", "-", ">", "sk_backlog", ".", "limit", "=", "sk", "-", ">", "sk_rcvbuf", "<", "<", "1", ";", "/", "*", "Set", "socket", "backlog", "limit", ".", "*", "/", "sk", "-", ">", "sk_backlog", ".", "limit", "=", "sysctl_sctp_rmem", "[", "1", "]", ";"], "docstring_tokens": ["sending", "an", "overly", "large", "amount", "of", "network", "traffic"]}
{"contents": ["[FIXED", "SECURITY-58]", "encryption", "of", "passphrases", "wasn't", "sufficiently", "secure."], "code_tokens": ["private", "final", "Secret", "password", ";", "/", "/", "for", "historical", "reasons", ",", "scrambled", "by", "base64", "in", "addition", "to", "using", "'", "Secret", "'", "this", ".", "password", "=", "Secret", ".", "fromString", "(", "Scrambler", ".", "scramble", "(", "password", ")", ");", "return", "new", "SVNSSHAuthentication", "(", "userName", ",", "getPassword", "(", "),", "-", "1", ",", "false", ")", ";", "return", "new", "SVNPasswordAuthentication", "(", "userName", ",", "getPassword", "(", "),", "false", ")", ";", "}", "private", "String", "getPassword", "(", ")", "{", "return", "Scrambler", ".", "descramble", "(", "Secret", ".", "toString", "(", "password", ")", ");", "private", "final", "Secret", "passphrase", ";", "/", "/", "for", "historical", "reasons", ",", "scrambled", "by", "base64", "in", "addition", "to", "using", "'", "Secret", "'", "this", ".", "passphrase", "=", "Secret", ".", "fromString", "(", "Scrambler", ".", "scramble", "(", "passphrase", ")", ");", "return", "new", "SVNSSHAuthentication", "(", "userName", ",", "privateKey", ".", "toCharArray", "(", "),", "Scrambler", ".", "descramble", "(", "Secret", ".", "toString", "(", "passphrase", ")", "),", "-", "1", ",", "false", ")", ";", "private", "final", "Secret", "password", ";", "/", "/", "for", "historical", "reasons", ",", "scrambled", "by", "base64", "in", "addition", "to", "using", "'", "Secret", "'", "this", ".", "password", "=", "Secret", ".", "fromString", "(", "Scrambler", ".", "scramble", "(", "password", ")", ");", "Scrambler", ".", "descramble", "(", "Secret", ".", "toString", "(", "password", ")", "),", "false", ")", ";</s>private", "final", "String", "password", ";", "/", "/", "scrambled", "by", "base64", "this", ".", "password", "=", "Scrambler", ".", "scramble", "(", "password", ")", ";", "return", "new", "SVNSSHAuthentication", "(", "userName", ",", "Scrambler", ".", "descramble", "(", "password", ")", ",-", "1", ",", "false", ")", ";", "return", "new", "SVNPasswordAuthentication", "(", "userName", ",", "Scrambler", ".", "descramble", "(", "password", ")", ",", "false", ")", ";", "private", "final", "String", "passphrase", ";", "/", "/", "scrambled", "by", "base64", "this", ".", "passphrase", "=", "Scrambler", ".", "scramble", "(", "passphrase", ")", ";", "return", "new", "SVNSSHAuthentication", "(", "userName", ",", "privateKey", ".", "toCharArray", "(", "),", "Scrambler", ".", "descramble", "(", "passphrase", ")", ",-", "1", ",", "false", ")", ";", "private", "final", "String", "password", ";", "/", "/", "scrambled", "by", "base64", "this", ".", "password", "=", "Scrambler", ".", "scramble", "(", "password", ")", ";", "Scrambler", ".", "descramble", "(", "password", ")", ",", "false", ")", ";"], "docstring_tokens": ["which", "allows", "local", "users", "to", "obtain", "passwords", "and", "SSH", "private", "keys", "by", "reading", "a", "subversion.credentials", "file", "."]}
{"contents": ["NIFI-7680", "Added", "convenience", "methods", "for", "creating", "XML", "DocumentBuilder", "instances.", "Added", "unit", "tests.", "NIFI-7680", "Duplicated", "DocumentBuilder", "creation", "method", "in", "NotificationServiceManager", "to", "avoid", "nifi-bootstrap", "dependency", "on", "nifi-security-utils.", "Explicitly", "added", "commons-lang3", "to", "lib/bootstrap/", "directory", "in", "nifi-assembly.", "NIFI-7680", "Reverted", "unnecessary", "dependency", "changes.", "Added", "explicit", "dependencies", "where", "necessary.", "Signed-off-by:", "Matthew", "Burgess", "<mattyb149@apache.org>", "This", "closes", "#4436"], "code_tokens": ["import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Executors", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ScheduledExecutorService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ThreadFactory", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "parameter", ".", "ParameterLookup", ";", "private", "static", "DocumentBuilder", "createSafeDocumentBuilder", "(", ")", "throws", "ParserConfigurationException", "{", "final", "DocumentBuilderFactory", "docFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "docFactory", ".", "setNamespaceAware", "(", "false", ")", ";", "/", "/", "These", "features", "are", "used", "to", "disable", "processing", "external", "entities", "in", "the", "DocumentBuilderFactory", "to", "protect", "against", "XXE", "attacks", "final", "String", "DISALLOW_DOCTYPES", "=", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ";", "final", "String", "ALLOW_EXTERNAL_GENERAL_ENTITIES", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "final", "String", "ALLOW_EXTERNAL_PARAM_ENTITIES", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ";", "final", "String", "ALLOW_EXTERNAL_DTD", "=", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "\"", ";", "/", "/", "Disable", "DTDs", "and", "external", "entities", "to", "protect", "against", "XXE", "docFactory", ".", "setAttribute", "(", "DISALLOW_DOCTYPES", ",", "true", ")", ";", "docFactory", ".", "setAttribute", "(", "ALLOW_EXTERNAL_DTD", ",", "false", ")", ";", "docFactory", ".", "setAttribute", "(", "ALLOW_EXTERNAL_GENERAL_ENTITIES", ",", "false", ")", ";", "docFactory", ".", "setAttribute", "(", "ALLOW_EXTERNAL_PARAM_ENTITIES", ",", "false", ")", ";", "docFactory", ".", "setXIncludeAware", "(", "false", ")", ";", "docFactory", ".", "setExpandEntityReferences", "(", "false", ")", ";", "return", "docFactory", ".", "newDocumentBuilder", "(", ");", "}", "final", "DocumentBuilder", "docBuilder", "=", "createSafeDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "/", "/", "These", "features", "are", "used", "to", "disable", "processing", "external", "entities", "in", "the", "DocumentBuilderFactory", "to", "protect", "against", "XXE", "attacks", "private", "static", "final", "String", "DISALLOW_DOCTYPES", "=", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ";", "private", "static", "final", "String", "ALLOW_EXTERNAL_GENERAL_ENTITIES", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "private", "static", "final", "String", "ALLOW_EXTERNAL_PARAM_ENTITIES", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ";", "private", "static", "final", "String", "ALLOW_EXTERNAL_DTD", "=", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "\"", ";", "xmlReader", ".", "setFeature", "(", "DISALLOW_DOCTYPES", ",", "true", ")", ";", "xmlReader", ".", "setFeature", "(", "ALLOW_EXTERNAL_GENERAL_ENTITIES", ",", "false", ")", ";", "xmlReader", ".", "setFeature", "(", "ALLOW_EXTERNAL_PARAM_ENTITIES", ",", "false", ")", ";", "public", "static", "DocumentBuilder", "createSafeDocumentBuilder", "(", "Schema", "schema", ",", "boolean", "isNamespaceAware", ")", "throws", "ParserConfigurationException", "{", "final", "DocumentBuilderFactory", "docFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "docFactory", ".", "setSchema", "(", "schema", ")", ";", "docFactory", ".", "setNamespaceAware", "(", "isNamespaceAware", ")", ";", "/", "/", "Disable", "DTDs", "and", "external", "entities", "to", "protect", "against", "XXE", "docFactory", ".", "setAttribute", "(", "DISALLOW_DOCTYPES", ",", "true", ")", ";", "docFactory", ".", "setAttribute", "(", "ALLOW_EXTERNAL_DTD", ",", "false", ")", ";", "docFactory", ".", "setAttribute", "(", "ALLOW_EXTERNAL_GENERAL_ENTITIES", ",", "false", ")", ";", "docFactory", ".", "setAttribute", "(", "ALLOW_EXTERNAL_PARAM_ENTITIES", ",", "false", ")", ";", "docFactory", ".", "setXIncludeAware", "(", "false", ")", ";", "docFactory", ".", "setExpandEntityReferences", "(", "false", ")", ";", "return", "docFactory", ".", "newDocumentBuilder", "(", ");", "}", "public", "static", "DocumentBuilder", "createSafeDocumentBuilder", "(", "Schema", "schema", ")", "throws", "ParserConfigurationException", "{", "return", "createSafeDocumentBuilder", "(", "schema", ",", "true", ")", ";", "}", "public", "static", "DocumentBuilder", "createSafeDocumentBuilder", "(", "boolean", "isNamespaceAware", ")", "throws", "ParserConfigurationException", "{", "return", "createSafeDocumentBuilder", "(", "null", ",", "isNamespaceAware", ")", ";", "}", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", "@", "Test", "void", "testShouldHandleXXEInDocumentBuilder", "(", ")", "{", "/", "/", "Arrange", "final", "String", "XXE_TEMPLATE_FILEPATH", "=", "\"", "src", "/", "test", "/", "resources", "/", "local_xxe_file", ".", "xml", "\"", "DocumentBuilder", "documentBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "null", ")", "/", "/", "Act", "def", "msg", "=", "shouldFail", "(", "SAXParseException", ")", "{", "def", "parsedFlow", "=", "documentBuilder", ".", "parse", "(", "new", "File", "(", "XXE_TEMPLATE_FILEPATH", ")", ")", "logger", ".", "info", "(", "\"", "Parsed", "$", "{", "parsedFlow", ".", "toString", "(", ")}", "\")", "}", "/", "/", "Assert", "logger", ".", "expected", "(", "msg", ")", "assert", "msg", "=", "~", "\"", "SAXParseException", ".", "*", "DOCTYPE", "is", "disallowed", "when", "the", "feature", "\"", "}", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "NONE", ")", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "12", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "null", ")", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "isA", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyNoMoreInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "Document", "document", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ".", "parse", "(", "new", "ByteArrayInputStream", "(", "successFlowFile", ".", "toByteArray", "(", "))", ");", "/", "**", "*", "Asserts", "a", "failure", "if", "the", "provided", "XML", "is", "not", "valid", ".", "<", "strong", ">", "This", "method", "does", "*", "not", "use", "the", "\"", "safe", "\"", "{", "@", "link", "DocumentBuilderFactory", "}", "from", "*", "{", "@", "code", "XmlUtils", "#", "createSafeDocumentBuilder", "(", "Schema", ",", "boolean", ")", "}", "because", "it", "checks", "*", "generated", "documentation", "which", "contains", "a", "doctype", ".", "<", "/", "strong", ">", "*", "*", "@", "param", "xml", "the", "XML", "to", "validate", "*", "/", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "text", ".", "DateFormat", ";", "import", "java", ".", "text", ".", "SimpleDateFormat", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "text", ".", "DateFormat", ";", "import", "java", ".", "text", ".", "SimpleDateFormat", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "private", "final", "Schema", "flowSchema", ";", "private", "final", "SchemaFactory", "schemaFactory", ";", "flowSchema", "=", "schemaFactory", ".", "newSchema", "(", "FlowParser", ".", "class", ".", "getResource", "(", "FLOW_XSD", ")", ");", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "flowSchema", ")", ";", "docBuilder", ".", "setErrorHandler", "(", "new", "LoggingXmlParserErrorHandler", "(", "\"", "Flow", "Configuration", "\"", ",", "logger", ")", ");", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "nifi", ".", "authorization", "import", "org", ".", "junit", ".", "After", "import", "org", ".", "junit", ".", "Before", "import", "org", ".", "junit", ".", "BeforeClass", "import", "org", ".", "junit", ".", "Test", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", "import", "org", ".", "junit", ".", "runners", ".", "JUnit4", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "slf4j", ".", "LoggerFactory", "@", "RunWith", "(", "JUnit4", ".", "class", ")", "class", "FlowParserTest", "extends", "GroovyTestCase", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "FlowParserTest", ".", "class", ")", "@", "BeforeClass", "static", "void", "setUpOnce", "(", ")", "throws", "Exception", "{", "logger", ".", "metaClass", ".", "methodMissing", "=", "{", "String", "name", ",", "args", "-", ">", "logger", ".", "info", "(", "\"[", "${", "name", "?", ".", "toUpperCase", "(", ")}", "]", "$", "{(", "args", "as", "List", ")", ".", "join", "(", "\"", "\"", ")}", "\")", "}", "}", "@", "Before", "void", "setUp", "(", ")", "throws", "Exception", "{", "}", "@", "After", "void", "tearDown", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "void", "testShouldHandleXXEInDocumentBuilder", "(", ")", "{", "/", "/", "Arrange", "final", "String", "XXE_TEMPLATE_FILEPATH", "=", "\"", "src", "/", "test", "/", "resources", "/", "flow", "-", "with", "-", "xxe", ".", "xml", ".", "gz", "\"", "FlowParser", "fp", "=", "new", "FlowParser", "(", ")", "/", "/", "Act", "def", "parsedFlow", "=", "fp", ".", "parse", "(", "new", "File", "(", "XXE_TEMPLATE_FILEPATH", ")", ")", "logger", ".", "info", "(", "\"", "Parsed", "$", "{", "parsedFlow", ".", "toString", "(", ")}", "\")", "/", "/", "Assert", "/", "/", "The", "existing", "logic", "logs", "&", "swallows", "any", "exceptions", "and", "returns", "null", "assert", "!", "parsedFlow", "}", "}", "@", "@", "-", "31", ",", "6", "+", "31", ",", "11", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "12", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "/", "dependency", ">", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "true", ")", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "adapters", ".", "XmlJavaTypeAdapter", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "cluster", ".", "protocol", ".", "jaxb", ".", "message", ".", "DataFlowAdapter", ";", "import", "org", ".", "apache", ".", "nifi", ".", "controller", ".", "serialization", ".", "FlowSerializationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "DefaultHandler", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "true", ")", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Optional", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "OutputKeys", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactoryConfigurationError", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "true", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "true", ")", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "DocumentBuilder", "builder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "null", ")", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "builder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "flowConfigDocBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "schema", ",", "true", ")", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "schema", ",", "true", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "12", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "/", "dependency", ">", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "DocumentBuilder", "documentBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "Document", "dom", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "true", ")", ".", "newDocument", "(", ");", "out", ".", "write", "(", "item", ".", "getStringValue", "(", ").", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "out", ".", "write", "(", "node", ".", "getStringValue", "(", ").", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "*", "Creates", "a", "new", "DocumentReaderCallback", ".", "DocumentBuilder", "builder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "isNamespaceAware", ")", ";", "}", "catch", "(", "ParserConfigurationException", "|", "SAXException", "pce", ")", "{", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "DocumentBuilder", "documentBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "12", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "scope", ">", "compile", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "DocumentBuilder", "documentBuilder", "=", "XmlUtils", ".", "createSafeDocumentBuilder", "(", "false", ")", ";", "Long", "dataQueueSizeL", "=", "Long", ".", "valueOf", "(", "dataQueueSize", ")", ";", "return", "args", ".", "length", "=", "=", "0", "|", "|", "args", "[", "0", "]", ".", "equalsIgnoreCase", "(", "\"-", "h", "\"", ")", "|", "|", "args", "[", "0", "]", ".", "equalsIgnoreCase", "(", "\"-", "-", "help", "\"", ");</s>import", "org", ".", "apache", ".", "nifi", ".", "parameter", ".", "ParameterLookup", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Executors", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ScheduledExecutorService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ThreadFactory", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "final", "DocumentBuilderFactory", "docBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "docBuilderFactory", ".", "setNamespaceAware", "(", "false", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "docBuilderFactory", ".", "newDocumentBuilder", "(", ");", "saxParserFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "saxParserFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "NONE", ")", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "static", "final", "DocumentBuilderFactory", "DOCUMENT_BUILDER_FACTORY", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "isA", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyNoMoreInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "public", "static", "final", "DocumentBuilderFactory", "DOCUMENT_BUILDER_FACTORY", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "Document", "document", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ").", "parse", "(", "new", "ByteArrayInputStream", "(", "successFlowFile", ".", "toByteArray", "(", "))", ");", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "text", ".", "DateFormat", ";", "import", "java", ".", "text", ".", "SimpleDateFormat", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "private", "static", "final", "DocumentBuilderFactory", "DOCUMENT_BUILDER_FACTORY", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "text", ".", "DateFormat", ";", "import", "java", ".", "text", ".", "SimpleDateFormat", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "private", "static", "final", "DocumentBuilderFactory", "DOCUMENT_BUILDER_FACTORY", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "StandardOpenOption", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "private", "Schema", "flowSchema", ";", "private", "SchemaFactory", "schemaFactory", ";", "flowSchema", "=", "schemaFactory", ".", "newSchema", "(", "FileAuthorizer", ".", "class", ".", "getResource", "(", "FLOW_XSD", ")", ");", "final", "DocumentBuilderFactory", "docFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "docFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "docFactory", ".", "setSchema", "(", "flowSchema", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "docFactory", ".", "newDocumentBuilder", "(", ");", "docBuilder", ".", "setErrorHandler", "(", "new", "LoggingXmlParserErrorHandler", "(", "\"", "Flow", "Configuration", "\"", ",", "logger", ")", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "Set", ";", "private", "static", "final", "DocumentBuilderFactory", "DOCUMENT_BUILDER_FACTORY", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ");", "import", "org", ".", "apache", ".", "nifi", ".", "cluster", ".", "protocol", ".", "jaxb", ".", "message", ".", "DataFlowAdapter", ";", "import", "org", ".", "apache", ".", "nifi", ".", "controller", ".", "serialization", ".", "FlowSerializationException", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "DefaultHandler", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "adapters", ".", "XmlJavaTypeAdapter", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "final", "DocumentBuilderFactory", "docFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "docFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "docFactory", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "OutputKeys", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactoryConfigurationError", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Optional", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "final", "DocumentBuilderFactory", "docFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "docFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "final", "DocumentBuilder", "docBuilder", "=", "docFactory", ".", "newDocumentBuilder", "(", ");", "final", "DocumentBuilderFactory", "docBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "docBuilderFactory", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "UUID", ";", "final", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "final", "DocumentBuilder", "builder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "final", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "factory", ".", "setNamespaceAware", "(", "false", ")", ";", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "final", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setSchema", "(", "schema", ")", ";", "flowConfigDocBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "final", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setSchema", "(", "schema", ")", ";", "DocumentBuilder", "docBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "final", "DocumentBuilderFactory", "docFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "docFactory", ".", "newDocumentBuilder", "(", ");", "final", "DocumentBuilderFactory", "docBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "docBuilderFactory", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "Set", ";", "private", "static", "final", "DocumentBuilderFactory", "DOCUMENT_BUILDER_FACTORY", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "final", "DocumentBuilder", "documentBuilder", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ");", "final", "DocumentBuilder", "docBuilder", "=", "DOCUMENT_BUILDER_FACTORY", ".", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "DocumentBuilderFactory", "dfactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dfactory", ".", "setNamespaceAware", "(", "true", ")", ";", "Document", "dom", "=", "dfactory", ".", "newDocumentBuilder", "(", ").", "newDocument", "(", ");", "out", ".", "write", "(", "item", ".", "getStringValue", "(", ").", "getBytes", "(", "UTF8", ")", ");", "out", ".", "write", "(", "node", ".", "getStringValue", "(", ").", "getBytes", "(", "UTF8", ")", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "*", "Creates", "a", "new", "DocumentReaderCallback", ".", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "factory", ".", "setNamespaceAware", "(", "isNamespaceAware", ")", ";", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "}", "catch", "(", "ParserConfigurationException", "pce", ")", "{", "}", "catch", "(", "SAXException", "saxe", ")", "{", "throw", "new", "IOException", "(", "saxe", ".", "getLocalizedMessage", "(", "),", "saxe", ")", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "final", "DocumentBuilder", "documentBuilder", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ").", "newDocumentBuilder", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilder", "documentBuilder", ";", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "Long", "dataQueueSizeL", "=", "new", "Long", "(", "dataQueueSize", ")", ";", "return", "args", ".", "length", "=", "=", "0", "|", "|", "(", "args", ".", "length", ">", "0", "&", "&", "(", "args", "[", "0", "]", ".", "equalsIgnoreCase", "(", "\"-", "h", "\"", ")", "|", "|", "args", "[", "0", "]", ".", "equalsIgnoreCase", "(", "\"-", "-", "help", "\"", "))", ");"], "docstring_tokens": ["provide", "a", "deterministic", "loggable", "value"]}
{"contents": ["Prevent", "recursive", "placeholders", "in", "whitelabel", "views", "This", "change", "prevents", "placeholders", "in", "model", "values", "from", "being", "recursively", "replaced", "(which", "is", "a", "feature", "of", "the", "placeholder", "utilities", "in", "Spring", "Core),", "so", "that", "user-provided", "data", "(e.g.", "an", "invalid", "response_type", "or", "a", "leaky", "exception", "message)", "cannot", "be", "used", "to", "inject", "SpEL", "into", "the", "view.", "N.B.", "this", "only", "affects", "apps", "that", "are", "using", "the", "whitelabel", "views", "for", "approval", "and", "error", "pages", "(i.e.", "probably", "nothing", "in", "production)."], "code_tokens": ["import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "private", "final", "String", "prefix", ";", "this", ".", "prefix", "=", "new", "RandomValueStringGenerator", "(", ").", "generate", "(", ")", "+", "\"", "{\"", ";", "String", "maskedTemplate", "=", "template", ".", "replace", "(", "\"$", "{\"", ",", "prefix", ")", ";", "PropertyPlaceholderHelper", "helper", "=", "new", "PropertyPlaceholderHelper", "(", "prefix", ",", "\"", "}\"", ");", "String", "result", "=", "helper", ".", "replacePlaceholders", "(", "maskedTemplate", ",", "resolver", ")", ";", "result", "=", "result", ".", "replace", "(", "prefix", ",", "\"", "${", "\")", ";", "/", "*", "*", "Copyright", "2012", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletResponse", ";", "/", "**", "*", "@", "author", "Dave", "Syer", "*", "*", "/", "public", "class", "SpelViewTests", "{", "private", "SpelView", "view", ";", "private", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "private", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "@", "Test", "public", "void", "sunnyDay", "(", ")", "throws", "Exception", "{", "view", "=", "new", "SpelView", "(", "\"$", "{", "hit", "}", "\")", ";", "view", ".", "render", "(", "Collections", ".", "singletonMap", "(", "\"", "hit", "\"", ",", "\"", "Ouch", "\"", "),", "request", ",", "response", ")", ";", "assertEquals", "(", "\"", "Ouch", "\"", ",", "response", ".", "getContentAsString", "(", "))", ";", "}", "@", "Test", "public", "void", "nonRecursive", "(", ")", "throws", "Exception", "{", "view", "=", "new", "SpelView", "(", "\"$", "{", "hit", "}", "\")", ";", "view", ".", "render", "(", "Collections", ".", "singletonMap", "(", "\"", "hit", "\"", ",", "\"", "${", "ouch", "}", "\")", ",", "request", ",", "response", ")", ";", "/", "/", "Expressions", "embedded", "in", "resolved", "values", "do", "not", "resolve", "recursively", "assertEquals", "(", "\"$", "{", "ouch", "}", "\",", "response", ".", "getContentAsString", "(", "))", ";", "}", "@", "Test", "public", "void", "recursive", "(", ")", "throws", "Exception", "{", "/", "/", "Recursive", "expressions", "in", "the", "template", "resolve", "view", "=", "new", "SpelView", "(", "\"$", "{$", "{", "hit", "}", "}\"", ");", "Map", "<", "String", ",", "Object", ">", "map", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ";", "map", ".", "put", "(", "\"", "hit", "\"", ",", "\"", "me", "\"", ");", "map", ".", "put", "(", "\"", "me", "\"", ",", "\"", "${", "ouch", "}", "\")", ";", "view", ".", "render", "(", "map", ",", "request", ",", "response", ")", ";", "/", "/", "But", "expressions", "embedded", "in", "resolved", "values", "do", "not", "assertEquals", "(", "\"$", "{", "ouch", "}", "\",", "response", ".", "getContentAsString", "(", "))", ";", "}", "}</s>private", "PropertyPlaceholderHelper", "helper", ";", "this", ".", "helper", "=", "new", "PropertyPlaceholderHelper", "(", "\"$", "{\"", ",", "\"", "}\"", ");", "String", "result", "=", "helper", ".", "replacePlaceholders", "(", "template", ",", "resolver", ")", ";"], "docstring_tokens": ["via", "the", "crafting", "of", "the", "value", "for", "response_type", "."]}
{"contents": ["Fix", "binary", "compatibility", "Change", "type", "of", "Cookie.maxAge", "back", "to", "int", "to", "maintain", "binary", "compatibility", "for", "drop", "in", "fixes."], "code_tokens": ["*", "@", "deprecated", "Use", "{", "@", "link", "org", ".", "jboss", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", "}", "instead", ".", "int", "getMaxAge", "(", ");", "*", "Returns", "the", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", "or", "{", "@", "link", "Integer", "#", "MIN_VALUE", "}", "if", "unspecified", "int", "maxAge", "(", ");", "*", "If", "{", "@", "link", "Integer", "#", "MIN_VALUE", "}", "is", "specified", ",", "this", "{", "@", "link", "Cookie", "}", "will", "be", "removed", "when", "the", "void", "setMaxAge", "(", "int", "maxAge", ")", ";", "int", "maxAge", "=", "Integer", ".", "MIN_VALUE", ";", "maxAge", "=", "(", "int", ")", "(", "maxAgeMillis", "/", "1000", "+", "(", "maxAgeMillis", "%", "1000", "!", "=", "0", "?", "1", ":", "0", ")", ");", "public", "int", "getMaxAge", "(", ")", "{", "private", "int", "maxAge", "=", "Integer", ".", "MIN_VALUE", ";", "private", "int", "mergeMaxAgeAndExpire", "(", "int", "maxAge", ",", "String", "expires", ")", "{", "if", "(", "maxAge", "!", "=", "Integer", ".", "MIN_VALUE", ")", "{", "return", "(", "int", ")", "(", "maxAgeMillis", "/", "1000", "+", "(", "maxAgeMillis", "%", "1000", "!", "=", "0", "?", "1", ":", "0", ")", ");", "return", "Integer", ".", "MIN_VALUE", ";", "maxAge", "=", "Math", ".", "max", "(", "Integer", ".", "valueOf", "(", "value", ")", ",", "0", ")", ";", "*", "Returns", "the", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", "or", "{", "@", "link", "Integer", "#", "MIN_VALUE", "}", "if", "unspecified", "int", "maxAge", "(", ");", "*", "If", "{", "@", "link", "Integer", "#", "MIN_VALUE", "}", "is", "specified", ",", "this", "{", "@", "link", "Cookie", "}", "will", "be", "removed", "when", "the", "void", "setMaxAge", "(", "int", "maxAge", ")", ";", "private", "int", "maxAge", "=", "Integer", ".", "MIN_VALUE", ";", "public", "int", "maxAge", "(", ")", "{", "public", "void", "setMaxAge", "(", "int", "maxAge", ")", "{", "if", "(", "cookie", ".", "maxAge", "(", ")", "!", "=", "Integer", ".", "MIN_VALUE", ")", "{", "assertEquals", "(", "Integer", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "assertEquals", "(", "Integer", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "assertEquals", "(", "Integer", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "assertEquals", "(", "Integer", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "cookieDate", ".", "set", "(", "2080", ",", "Calendar", ".", "DECEMBER", ",", "31", ",", "23", ",", "59", ",", "59", ")", ";", "int", "expectedMaxAge", "=", "(", "int", ")", "((", "cookieDate", ".", "getTimeInMillis", "(", ")", "-", "System", ".", "currentTimeMillis", "(", "))", "/", "1000", ")", ";", "String", "source", "=", "\"", "Format", "=", "EU", ";", "expires", "=", "Fri", ",", "31", "-", "Dec", "-", "2080", "23", ":", "59", ":", "59", "GMT", ";", "path", "=", "/\"", ";</s>*", "@", "deprecated", "Use", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", "}", "instead", ".", "long", "getMaxAge", "(", ");", "*", "Returns", "the", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", "or", "{", "@", "link", "Long", "#", "MIN_VALUE", "}", "if", "unspecified", "long", "maxAge", "(", ");", "*", "If", "{", "@", "link", "Long", "#", "MIN_VALUE", "}", "is", "specified", ",", "this", "{", "@", "link", "Cookie", "}", "will", "be", "removed", "when", "the", "void", "setMaxAge", "(", "long", "maxAge", ")", ";", "long", "maxAge", "=", "Long", ".", "MIN_VALUE", ";", "maxAge", "=", "maxAgeMillis", "/", "1000", "+", "(", "maxAgeMillis", "%", "1000", "!", "=", "0", "?", "1", ":", "0", ")", ";", "public", "long", "getMaxAge", "(", ")", "{", "private", "long", "maxAge", "=", "Long", ".", "MIN_VALUE", ";", "private", "long", "mergeMaxAgeAndExpire", "(", "long", "maxAge", ",", "String", "expires", ")", "{", "if", "(", "maxAge", "!", "=", "Long", ".", "MIN_VALUE", ")", "{", "return", "maxAgeMillis", "/", "1000", "+", "(", "maxAgeMillis", "%", "1000", "!", "=", "0", "?", "1", ":", "0", ")", ";", "return", "Long", ".", "MIN_VALUE", ";", "maxAge", "=", "Math", ".", "max", "(", "Long", ".", "valueOf", "(", "value", ")", ",", "0L", ")", ";", "*", "Returns", "the", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", "or", "{", "@", "link", "Long", "#", "MIN_VALUE", "}", "if", "unspecified", "long", "maxAge", "(", ");", "*", "If", "{", "@", "link", "Long", "#", "MIN_VALUE", "}", "is", "specified", ",", "this", "{", "@", "link", "Cookie", "}", "will", "be", "removed", "when", "the", "void", "setMaxAge", "(", "long", "maxAge", ")", ";", "private", "long", "maxAge", "=", "Long", ".", "MIN_VALUE", ";", "public", "long", "maxAge", "(", ")", "{", "public", "void", "setMaxAge", "(", "long", "maxAge", ")", "{", "if", "(", "cookie", ".", "maxAge", "(", ")", "!", "=", "Long", ".", "MIN_VALUE", ")", "{", "assertEquals", "(", "Long", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "assertEquals", "(", "Long", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "assertEquals", "(", "Long", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "assertEquals", "(", "Long", ".", "MIN_VALUE", ",", "c", ".", "getMaxAge", "(", "))", ";", "cookieDate", ".", "set", "(", "9999", ",", "Calendar", ".", "DECEMBER", ",", "31", ",", "23", ",", "59", ",", "59", ")", ";", "long", "expectedMaxAge", "=", "(", "cookieDate", ".", "getTimeInMillis", "(", ")", "-", "System", ".", "currentTimeMillis", "(", "))", "/", "1000", ";", "String", "source", "=", "\"", "Format", "=", "EU", ";", "expires", "=", "Fri", ",", "31", "-", "Dec", "-", "9999", "23", ":", "59", ":", "59", "GMT", ";", "path", "=", "/\"", ";"], "docstring_tokens": ["by", "leveraging", "improper", "validation", "of", "cookie", "name", "and", "value", "characters", "."]}
{"contents": ["STORM-3052:", "Allow", "for", "untar/unzip", "to", "work", "on", "older", "versions"], "code_tokens": ["private", "final", "boolean", "symLinksDisabled", ";", "this", ".", "symLinksDisabled", "=", "(", "boolean", ")", "conf", ".", "getOrDefault", "(", "Config", ".", "DISABLE_SYMLINKS", ",", "false", ")", ";", "ServerUtils", ".", "unpack", "(", "downloadFile", ".", "toFile", "(", "),", "finalLocation", ".", "toFile", "(", "),", "symLinksDisabled", ")", ";", "import", "java", ".", "nio", ".", "file", ".", "LinkOption", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "attribute", ".", "PosixFilePermission", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ")", "{", "extractZipFile", "(", "jar", ",", "toDir", ",", "null", ")", ";", "*", "@", "param", "symlinksDisabled", "true", "if", "symlinks", "should", "be", "disabled", ",", "else", "false", ".", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "ensureDirectory", "(", "untarDir", ")", ";", "if", "(", "Utils", ".", "isOnWindows", "(", ")", "|", "|", "symlinksDisabled", ")", "{", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ",", "symlinksDisabled", ")", ";", "boolean", "gzipped", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "final", "String", "base", "=", "untarDir", ".", "getCanonicalPath", "(", ");", "LOG", ".", "trace", "(", "\"", "java", "untar", "{", "}", "to", "{", "}\"", ",", "inFile", ",", "base", ")", ";", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ",", "base", ",", "symlinksDisabled", ")", ";", "TarArchiveEntry", "entry", ",", "File", "outputDir", ",", "final", "String", "base", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "File", "target", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "target", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "return", ";", "}", "LOG", ".", "trace", "(", "\"", "Extracting", "dir", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ")", ";", "unpackEntries", "(", "tis", ",", "e", ",", "target", ",", "base", ",", "symlinksDisabled", ")", ";", "}", "else", "if", "(", "entry", ".", "isSymbolicLink", "(", "))", "{", "if", "(", "symlinksDisabled", ")", "{", "LOG", ".", "info", "(", "\"", "Symlinks", "disabled", "skipping", "{", "}\"", ",", "target", ")", ";", "}", "else", "{", "Path", "src", "=", "target", ".", "toPath", "(", ");", "Path", "dest", "=", "Paths", ".", "get", "(", "entry", ".", "getLinkName", "(", "))", ";", "LOG", ".", "trace", "(", "\"", "Extracting", "sym", "link", "{", "}", "to", "{", "}\"", ",", "target", ",", "dest", ")", ";", "/", "/", "Create", "symbolic", "link", "relative", "to", "tar", "parent", "dir", "Files", ".", "createSymbolicLink", "(", "src", ",", "dest", ")", ";", "}", "}", "else", "if", "(", "entry", ".", "isFile", "(", "))", "{", "LOG", ".", "trace", "(", "\"", "Extracting", "file", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ".", "getParentFile", "(", "))", ";", "try", "(", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "target", ")", "))", "{", "IOUtils", ".", "copy", "(", "tis", ",", "outputStream", ")", ";", "}", "}", "else", "{", "LOG", ".", "error", "(", "\"{", "}", "is", "not", "a", "currently", "supported", "tar", "entry", "type", ".", "\",", "entry", ")", ";", "Path", "p", "=", "target", ".", "toPath", "(", ");", "if", "(", "Files", ".", "exists", "(", "p", ")", ")", "{", "try", "{", "/", "/", "We", "created", "it", "so", "lets", "chmod", "it", "properly", "int", "mode", "=", "entry", ".", "getMode", "(", ");", "Files", ".", "setPosixFilePermissions", "(", "p", ",", "parsePerms", "(", "mode", ")", ");", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "/", "/", "Ignored", "the", "file", "system", "we", "are", "on", "does", "not", "support", "this", ",", "so", "don", "'", "t", "do", "it", ".", "}", "private", "static", "Set", "<", "PosixFilePermission", ">", "parsePerms", "(", "int", "mode", ")", "{", "Set", "<", "PosixFilePermission", ">", "ret", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "(", "mode", "&", "0001", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0002", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0004", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0010", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_EXECUTE", ")", ";", "if", "(", "(", "mode", "&", "0020", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0040", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0100", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0200", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0400", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_READ", ")", ";", "}", "return", "ret", ";", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ",", "boolean", "symLinksDisabled", ")", "throws", "IOException", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_jar", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_zip", "\"", "))", "{", "lowerDst", ".", "endsWith", "(", "\"", "_tar_gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ",", "symLinksDisabled", ")", ";", "private", "static", "void", "extractZipFile", "(", "ZipFile", "zipFile", ",", "File", "toDir", ",", "String", "prefix", ")", "throws", "IOException", "{", "ensureDirectory", "(", "toDir", ")", ";", "final", "String", "base", "=", "toDir", ".", "getCanonicalPath", "(", ");", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "if", "(", "prefix", "!", "=", "null", "&", "&", "!", "entry", ".", "getName", "(", ").", "startsWith", "(", "prefix", ")", ")", "{", "/", "/", "No", "need", "to", "extract", "it", ",", "it", "is", "not", "what", "we", "are", "looking", "for", ".", "continue", ";", "}", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "file", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "continue", ";", "}", "try", "(", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "try", "(", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "}", "}", "*", "Given", "a", "File", "input", "it", "will", "unzip", "the", "file", "in", "a", "the", "unzip", "directory", "passed", "as", "the", "second", "parameter", ".", "*", "@", "param", "toDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ")", "{", "extractZipFile", "(", "zipFile", ",", "toDir", ",", "null", ")", ";", "extractZipFile", "(", "jarFile", ",", "destdir", ",", "dir", ")", ";</s>ServerUtils", ".", "unpack", "(", "downloadFile", ".", "toFile", "(", "),", "finalLocation", ".", "toFile", "(", "))", ";", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ";", "try", "{", "Enumeration", "<", "JarEntry", ">", "entries", "=", "jar", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "final", "JarEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "jar", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "copyBytes", "(", "in", ",", "out", ",", "8192", ")", ";", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "jar", ".", "close", "(", ");", "}", "}", "/", "**", "*", "Copies", "from", "one", "stream", "to", "another", ".", "*", "*", "@", "param", "in", "InputStream", "to", "read", "from", "*", "@", "param", "out", "OutputStream", "to", "write", "to", "*", "@", "param", "buffSize", "the", "size", "of", "the", "buffer", "*", "/", "public", "static", "void", "copyBytes", "(", "InputStream", "in", ",", "OutputStream", "out", ",", "int", "buffSize", ")", "throws", "IOException", "{", "PrintStream", "ps", "=", "out", "instanceof", "PrintStream", "?", "(", "PrintStream", ")", "out", ":", "null", ";", "byte", "buf", "[", "]", "=", "new", "byte", "[", "buffSize", "]", ";", "int", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "while", "(", "bytesRead", ">", "=", "0", ")", "{", "out", ".", "write", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "if", "(", "(", "ps", "!", "=", "null", ")", "&", "&", "ps", ".", "checkError", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "write", "to", "output", "stream", ".", "\")", ";", "}", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ")", "throws", "IOException", "{", "if", "(", "!", "untarDir", ".", "mkdirs", "(", "))", "{", "if", "(", "!", "untarDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "untarDir", ")", ";", "}", "}", "if", "(", "Utils", ".", "isOnWindows", "(", "))", "{", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ")", ";", "boolean", "gzipped", ")", "throws", "IOException", "{", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ")", ";", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "}", "unpackEntries", "(", "tis", ",", "e", ",", "subDir", ")", ";", "return", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "int", "count", ";", "byte", "data", "[", "]", "=", "new", "byte", "[", "2048", "]", ";", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "outputFile", ")", ");", "while", "(", "(", "count", "=", "tis", ".", "read", "(", "data", ")", ")", "!", "=", "-", "1", ")", "{", "outputStream", ".", "write", "(", "data", ",", "0", ",", "count", ")", ";", "outputStream", ".", "flush", "(", ");", "outputStream", ".", "close", "(", ");", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", "))", "{", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ")", ";", "*", "Given", "a", "File", "input", "it", "will", "unzip", "the", "file", "in", "a", "the", "unzip", "directory", "passed", "as", "the", "second", "parameter", "*", "@", "param", "unzipDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "}", "}", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "8192", "]", ";", "int", "i", ";", "while", "(", "(", "i", "=", "in", ".", "read", "(", "buffer", ")", ")", "!", "=", "-", "1", ")", "{", "out", ".", "write", "(", "buffer", ",", "0", ",", "i", ")", ";", "}", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "zipFile", ".", "close", "(", ");", "Enumeration", "<", "JarEntry", ">", "jarEnums", "=", "jarFile", ".", "entries", "(", ");", "while", "(", "jarEnums", ".", "hasMoreElements", "(", "))", "{", "JarEntry", "entry", "=", "jarEnums", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", ")", "&", "&", "entry", ".", "getName", "(", ").", "startsWith", "(", "dir", ")", ")", "{", "File", "aFile", "=", "new", "File", "(", "destdir", ",", "entry", ".", "getName", "(", "))", ";", "aFile", ".", "getParentFile", "(", ").", "mkdirs", "(", ");", "try", "(", "FileOutputStream", "out", "=", "new", "FileOutputStream", "(", "aFile", ")", ";", "InputStream", "in", "=", "jarFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}"], "docstring_tokens": ["using", "a", "specially", "crafted", "zip", "archive"]}
{"contents": ["Update", "lz4", "to", "1.8.3"], "code_tokens": ["Subproject", "commit", "641b453d9db536ee020851bfcb1dc39f61006f0a</s>Subproject", "commit", "dfed9fa1d77f0434306d377c4da1f7191d3ba08a"], "docstring_tokens": ["specify", "any", "desired", "offset", "to", "a", "write", "pointer"]}
{"contents": ["Fixed", "some", "SSL", "code"], "code_tokens": ["/", "*", "package", "protected", "*", "/", "static", "class", "EncryptedWriteRequest", "extends", "DefaultWriteRequest", "{", "import", "org", ".", "apache", ".", "mina", ".", "core", ".", "RuntimeIoException", ";", "import", "org", ".", "apache", ".", "mina", ".", "filter", ".", "ssl", ".", "SslFilter", ".", "EncryptedWriteRequest", ";", "switch", "(", "status", ")", "{", "case", "BUFFER_OVERFLOW", ":", "throw", "new", "SSLException", "(", "\"", "SSLEngine", "error", "during", "decrypt", ":", "\"", "+", "status", "+", "\"", "inNetBuffer", ":", "\"", "+", "inNetBuffer", "+", "\"", "appBuffer", ":", "\"", "+", "appBuffer", ")", ";", "case", "CLOSED", ":", "Exception", "exception", "=", "new", "RuntimeIoException", "(", "\"", "SSL", "/", "TLS", "close_notify", "received", "\"", ");", "/", "/", "Empty", "the", "Ssl", "queue", "for", "(", "IoFilterEvent", "event", ":", "filterWriteEventQueue", ")", "{", "EncryptedWriteRequest", "writeRequest", "=", "(", "EncryptedWriteRequest", ")", "event", ".", "getParameter", "(", ");", "WriteFuture", "writeFuture", "=", "writeRequest", ".", "getParentRequest", "(", ").", "getFuture", "(", ");", "writeFuture", ".", "setException", "(", "exception", ")", ";", "writeFuture", ".", "notifyAll", "(", ");", "}", "/", "/", "Empty", "the", "session", "queue", "while", "(", "!", "session", ".", "getWriteRequestQueue", "(", ").", "isEmpty", "(", "session", ")", ")", "{", "WriteRequest", "writeRequest", "=", "session", ".", "getWriteRequestQueue", "(", ").", "poll", "(", "session", ")", ";", "WriteFuture", "writeFuture", "=", "writeRequest", ".", "getFuture", "(", ");", "writeFuture", ".", "setException", "(", "exception", ")", ";", "writeFuture", ".", "notifyAll", "(", ");", "}", "/", "/", "We", "*", "must", "*", "shutdown", "session", "session", ".", "closeNow", "(", ");", "break", ";", "default", ":", "break", ";", "/", "/", "Since", "we", "cannot", "call", "wrap", "with", "data", "left", "on", "the", "buffer</s>private", "static", "class", "EncryptedWriteRequest", "extends", "DefaultWriteRequest", "{", "if", "(", "status", "=", "=", "SSLEngineResult", ".", "Status", ".", "BUFFER_OVERFLOW", ")", "{", "throw", "new", "SSLException", "(", "\"", "SSLEngine", "error", "during", "decrypt", ":", "\"", "+", "status", "+", "\"", "inNetBuffer", ":", "\"", "+", "inNetBuffer", "/", "/", "Since", "we", "/", "/", "cannot", "call", "wrap", "with", "data", "left", "on", "the", "buffer"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["Merge", "pull", "request", "#2326", "from", "square/jwilson_0207_backport_pinning_fixes", "Backport", "CertificatePinner", "fixes", "to", "the", "2.x", "branch"], "code_tokens": ["import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "HeldCertificate", ";", "public", "final", "class", "CertificateChainCleanerTest", "{", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "root", ".", "certificate", ")", ");", "assertEquals", "(", "list", "(", "root", ")", ",", "council", ".", "clean", "(", "list", "(", "root", ")", "))", ";", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "))", ";", "council", ".", "clean", "(", "list", "(", "root", ")", ");", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "root", ".", "certificate", ")", ");", "assertEquals", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "clean", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", "))", ";", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "root", ".", "certificate", ")", ");", "assertEquals", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "clean", "(", "list", "(", "certB", ",", "certA", ")", "))", ";", "/", "/", "Root", "is", "added", "!", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "root", ".", "certificate", ")", ");", "assertEquals", "(", "list", "(", "certC", ",", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "clean", "(", "list", "(", "certC", ",", "certA", ",", "root", ",", "certB", ")", "))", ";", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "root", ".", "certificate", ")", ");", "assertEquals", "(", "list", "(", "certC", ",", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "clean", "(", "list", "(", "certC", ",", "certA", ",", "certB", ")", "))", ";", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "root", ".", "certificate", ")", ");", "council", ".", "clean", "(", "list", "(", "certB", ",", "certUnnecessary", ",", "certA", ",", "root", ")", "))", ";", "CertificateChainCleaner", "council", "=", "new", "CertificateChainCleaner", "(", "new", "RealTrustRootIndex", "(", "superRoot", ".", "certificate", ",", "root", ".", "certificate", ")", ");", "assertEquals", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "clean", "(", "list", "(", "certB", ",", "certA", ",", "root", ",", "superRoot", ")", "))", ";", "this", ".", "hostnameToPins", "=", "Util", ".", "immutableMap", "(", "builder", ".", "hostnameToPins", ")", ";", "import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ".", "AndroidTrustRootIndex", ";", "import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ".", "RealTrustRootIndex", ";", "import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ".", "TrustRootIndex", ";", "public", "TrustRootIndex", "trustRootIndex", "(", "X509TrustManager", "trustManager", ")", "{", "return", "new", "RealTrustRootIndex", "(", "trustManager", ".", "getAcceptedIssuers", "(", "))", ";", "}", "if", "(", "context", "=", "=", "null", ")", "{", "/", "/", "If", "that", "didn", "'", "t", "work", ",", "try", "the", "Google", "Play", "Services", "SSL", "provider", "before", "giving", "up", ".", "This", "/", "/", "must", "be", "loaded", "by", "the", "SSLSocketFactory", "'", "s", "class", "loader", ".", "try", "{", "Class", "<", "?>", "gmsSslParametersClass", "=", "Class", ".", "forName", "(", "\"", "com", ".", "google", ".", "android", ".", "gms", ".", "org", ".", "conscrypt", ".", "SSLParametersImpl", "\"", ",", "false", ",", "sslSocketFactory", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "context", "=", "readFieldOrNull", "(", "sslSocketFactory", ",", "gmsSslParametersClass", ",", "\"", "sslParameters", "\"", ");", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "return", "null", ";", "}", "}", "@", "Override", "public", "TrustRootIndex", "trustRootIndex", "(", "X509TrustManager", "trustManager", ")", "{", "TrustRootIndex", "result", "=", "AndroidTrustRootIndex", ".", "get", "(", "trustManager", ")", ";", "if", "(", "result", "!", "=", "null", ")", "return", "result", ";", "return", "super", ".", "trustRootIndex", "(", "trustManager", ")", ";", "}", "import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ".", "CertificateChainCleaner", ";", "import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ".", "TrustRootIndex", ";", "TrustRootIndex", "trustRootIndex", "=", "trustRootIndex", "(", "address", ".", "getSslSocketFactory", "(", "))", ";", "List", "<", "Certificate", ">", "certificates", "=", "new", "CertificateChainCleaner", "(", "trustRootIndex", ")", ".", "clean", "(", "unverifiedHandshake", ".", "peerCertificates", "(", "))", ";", "private", "static", "TrustRootIndex", "lastTrustRootIndex", ";", "*", "Returns", "a", "trust", "root", "index", "for", "{", "@", "code", "sslSocketFactory", "}", ".", "This", "uses", "a", "static", ",", "single", "-", "element", "*", "cache", "to", "avoid", "redoing", "reflection", "and", "SSL", "indexing", "in", "the", "common", "case", "where", "most", "SSL", "*", "connections", "use", "the", "same", "SSL", "socket", "factory", ".", "private", "static", "synchronized", "TrustRootIndex", "trustRootIndex", "(", "SSLSocketFactory", "sslSocketFactory", ")", "{", "lastTrustRootIndex", "=", "Platform", ".", "get", "(", ").", "trustRootIndex", "(", "trustManager", ")", ";", "return", "lastTrustRootIndex", ";", "/", "*", "*", "Copyright", "(", "C", ")", "2016", "Square", ",", "Inc", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "cert", ".", "TrustAnchor", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "/", "**", "*", "A", "index", "of", "trusted", "root", "certificates", "that", "exploits", "knowledge", "of", "Android", "implementation", "details", ".", "*", "This", "class", "is", "potentially", "much", "faster", "to", "initialize", "than", "{", "@", "link", "RealTrustRootIndex", "}", "because", "*", "it", "doesn", "'", "t", "need", "to", "load", "and", "index", "trusted", "CA", "certificates", ".", "*", "/", "public", "final", "class", "AndroidTrustRootIndex", "implements", "TrustRootIndex", "{", "private", "final", "X509TrustManager", "trustManager", ";", "private", "final", "Method", "findByIssuerAndSignatureMethod", ";", "public", "AndroidTrustRootIndex", "(", "X509TrustManager", "trustManager", ",", "Method", "findByIssuerAndSignatureMethod", ")", "{", "this", ".", "findByIssuerAndSignatureMethod", "=", "findByIssuerAndSignatureMethod", ";", "this", ".", "trustManager", "=", "trustManager", ";", "}", "@", "Override", "public", "X509Certificate", "findByIssuerAndSignature", "(", "X509Certificate", "cert", ")", "{", "try", "{", "TrustAnchor", "trustAnchor", "=", "(", "TrustAnchor", ")", "findByIssuerAndSignatureMethod", ".", "invoke", "(", "trustManager", ",", "cert", ")", ";", "return", "trustAnchor", ".", "getTrustedCert", "(", ");", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "AssertionError", "(", ");", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "return", "null", ";", "}", "}", "public", "static", "TrustRootIndex", "get", "(", "X509TrustManager", "trustManager", ")", "{", "/", "/", "From", "org", ".", "conscrypt", ".", "TrustManagerImpl", ",", "we", "want", "the", "method", "with", "this", "signature", ":", "/", "/", "private", "TrustAnchor", "findTrustAnchorByIssuerAndSignature", "(", "X509Certificate", "lastCert", ")", ";", "try", "{", "Method", "method", "=", "trustManager", ".", "getClass", "(", ").", "getDeclaredMethod", "(", "\"", "findTrustAnchorByIssuerAndSignature", "\"", ",", "X509Certificate", ".", "class", ")", ";", "method", ".", "setAccessible", "(", "true", ")", ";", "return", "new", "AndroidTrustRootIndex", "(", "trustManager", ",", "method", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "return", "null", ";", "}", "}", "}", "@", "@", "-", "17", ",", "56", "+", "17", ",", "43", "@", "@", "*", "Computes", "the", "effective", "certificate", "chain", "from", "the", "raw", "array", "returned", "by", "Java", "'", "s", "built", "in", "TLS", "APIs", ".", "*", "Cleaning", "a", "chain", "returns", "a", "list", "of", "certificates", "where", "the", "first", "element", "is", "{", "@", "code", "chain", "[", "0", "]", "},", "each", "*", "certificate", "is", "signed", "by", "the", "certificate", "that", "follows", ",", "and", "the", "last", "certificate", "is", "a", "trusted", "CA", "*", "certificate", ".", "*", "*", "<", "p", ">", "Use", "of", "the", "chain", "cleaner", "is", "necessary", "to", "omit", "unexpected", "certificates", "that", "aren", "'", "t", "relevant", "to", "*", "the", "TLS", "handshake", "and", "to", "extract", "the", "trusted", "CA", "certificate", "for", "the", "benefit", "of", "certificate", "*", "pinning", ".", "public", "final", "class", "CertificateChainCleaner", "{", "private", "final", "TrustRootIndex", "trustRootIndex", ";", "public", "CertificateChainCleaner", "(", "TrustRootIndex", "trustRootIndex", ")", "{", "this", ".", "trustRootIndex", "=", "trustRootIndex", ";", "*", "Returns", "a", "cleaned", "chain", "for", "{", "@", "code", "chain", "}", ".", "*", "This", "is", "unexpected", "unless", "the", "trust", "root", "index", "in", "this", "class", "has", "a", "different", "trust", "manager", "than", "*", "what", "was", "used", "to", "establish", "{", "@", "code", "chain", "}", ".", "public", "List", "<", "Certificate", ">", "clean", "(", "List", "<", "Certificate", ">", "chain", ")", "throws", "SSLPeerUnverifiedException", "{", "X509Certificate", "caCert", "=", "trustRootIndex", ".", "findByIssuerAndSignature", "(", "toVerify", ")", ";", "if", "(", "caCert", "!", "=", "null", ")", "{", "/", "*", "*", "Copyright", "(", "C", ")", "2016", "Square", ",", "Inc", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ";", "import", "java", ".", "security", ".", "PublicKey", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "security", ".", "auth", ".", "x500", ".", "X500Principal", ";", "public", "final", "class", "RealTrustRootIndex", "implements", "TrustRootIndex", "{", "private", "final", "Map", "<", "X500Principal", ",", "List", "<", "X509Certificate", ">", ">", "subjectToCaCerts", ";", "public", "RealTrustRootIndex", "(", "X509Certificate", ".", "..", "caCerts", ")", "{", "subjectToCaCerts", "=", "new", "LinkedHashMap", "<", ">(", ");", "for", "(", "X509Certificate", "caCert", ":", "caCerts", ")", "{", "X500Principal", "subject", "=", "caCert", ".", "getSubjectX500Principal", "(", ");", "List", "<", "X509Certificate", ">", "subjectCaCerts", "=", "subjectToCaCerts", ".", "get", "(", "subject", ")", ";", "if", "(", "subjectCaCerts", "=", "=", "null", ")", "{", "subjectCaCerts", "=", "new", "ArrayList", "<", ">(", "1", ")", ";", "subjectToCaCerts", ".", "put", "(", "subject", ",", "subjectCaCerts", ")", ";", "}", "subjectCaCerts", ".", "add", "(", "caCert", ")", ";", "}", "}", "@", "Override", "public", "X509Certificate", "findByIssuerAndSignature", "(", "X509Certificate", "cert", ")", "{", "X500Principal", "issuer", "=", "cert", ".", "getIssuerX500Principal", "(", ");", "List", "<", "X509Certificate", ">", "subjectCaCerts", "=", "subjectToCaCerts", ".", "get", "(", "issuer", ")", ";", "if", "(", "subjectCaCerts", "=", "=", "null", ")", "return", "null", ";", "for", "(", "X509Certificate", "caCert", ":", "subjectCaCerts", ")", "{", "PublicKey", "publicKey", "=", "caCert", ".", "getPublicKey", "(", ");", "try", "{", "cert", ".", "verify", "(", "publicKey", ")", ";", "return", "caCert", ";", "}", "catch", "(", "Exception", "ignored", ")", "{", "}", "}", "return", "null", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "23", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2016", "Square", ",", "Inc", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "public", "interface", "TrustRootIndex", "{", "/", "**", "Returns", "the", "trusted", "CA", "certificate", "that", "signed", "{", "@", "code", "cert", "}", ".", "*", "/", "X509Certificate", "findByIssuerAndSignature", "(", "X509Certificate", "cert", ")", ";", "}</s>import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "HeldCertificate", ";", "public", "final", "class", "CertificateAuthorityCouncilTest", "{", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "root", ".", "certificate", ")", ";", "assertEquals", "(", "list", "(", "root", ")", ",", "council", ".", "normalizeCertificateChain", "(", "list", "(", "root", ")", "))", ";", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", ");", "council", ".", "normalizeCertificateChain", "(", "list", "(", "root", ")", ");", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "root", ".", "certificate", ")", ";", "assertEquals", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "normalizeCertificateChain", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", "))", ";", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "root", ".", "certificate", ")", ";", "assertEquals", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "normalizeCertificateChain", "(", "list", "(", "certB", ",", "certA", ")", "))", ";", "/", "/", "Root", "is", "added", "!", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "root", ".", "certificate", ")", ";", "assertEquals", "(", "list", "(", "certC", ",", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "normalizeCertificateChain", "(", "list", "(", "certC", ",", "certA", ",", "root", ",", "certB", ")", "))", ";", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "root", ".", "certificate", ")", ";", "assertEquals", "(", "list", "(", "certC", ",", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "normalizeCertificateChain", "(", "list", "(", "certC", ",", "certA", ",", "certB", ")", "))", ";", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "root", ".", "certificate", ")", ";", "council", ".", "normalizeCertificateChain", "(", "list", "(", "certB", ",", "certUnnecessary", ",", "certA", ",", "root", ")", "))", ";", "CertificateAuthorityCouncil", "council", "=", "new", "CertificateAuthorityCouncil", "(", "superRoot", ".", "certificate", ",", "root", ".", "certificate", ")", ";", "assertEquals", "(", "list", "(", "certB", ",", "certA", ",", "root", ")", ",", "council", ".", "normalizeCertificateChain", "(", "list", "(", "certB", ",", "certA", ",", "root", ",", "superRoot", ")", "))", ";", "hostnameToPins", "=", "Util", ".", "immutableMap", "(", "builder", ".", "hostnameToPins", ")", ";", "if", "(", "context", "=", "=", "null", ")", "return", "null", ";", "import", "com", ".", "squareup", ".", "okhttp", ".", "internal", ".", "tls", ".", "CertificateAuthorityCouncil", ";", "List", "<", "Certificate", ">", "certificates", "=", "certificateAuthorityCouncil", "(", "address", ".", "getSslSocketFactory", "(", "))", ".", "normalizeCertificateChain", "(", "unverifiedHandshake", ".", "peerCertificates", "(", "))", ";", "private", "static", "CertificateAuthorityCouncil", "lastCertificateAuthorityCouncil", ";", "*", "Returns", "a", "certificate", "authority", "council", "for", "{", "@", "code", "sslSocketFactory", "}", ".", "This", "uses", "a", "static", ",", "*", "single", "-", "element", "cache", "to", "avoid", "redoing", "reflection", "and", "SSL", "indexing", "in", "the", "common", "case", "where", "most", "*", "SSL", "connections", "use", "the", "same", "SSL", "socket", "factory", ".", "private", "static", "synchronized", "CertificateAuthorityCouncil", "certificateAuthorityCouncil", "(", "SSLSocketFactory", "sslSocketFactory", ")", "{", "lastCertificateAuthorityCouncil", "=", "new", "CertificateAuthorityCouncil", "(", "trustManager", ".", "getAcceptedIssuers", "(", "))", ";", "return", "lastCertificateAuthorityCouncil", ";", "import", "java", ".", "security", ".", "PublicKey", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "security", ".", "auth", ".", "x500", ".", "X500Principal", ";", "*", "A", "set", "of", "trusted", "Certificate", "Authority", "(", "CA", ")", "certificates", "that", "are", "trusted", "to", "verify", "the", "TLS", "*", "certificates", "offered", "by", "remote", "web", "servers", ".", "public", "final", "class", "CertificateAuthorityCouncil", "{", "private", "final", "Map", "<", "X500Principal", ",", "List", "<", "X509Certificate", ">", ">", "subjectToCaCerts", "=", "new", "LinkedHashMap", "<", ">(", ");", "public", "CertificateAuthorityCouncil", "(", "X509Certificate", ".", "..", "caCerts", ")", "{", "for", "(", "X509Certificate", "caCert", ":", "caCerts", ")", "{", "X500Principal", "subject", "=", "caCert", ".", "getSubjectX500Principal", "(", ");", "List", "<", "X509Certificate", ">", "subjectCaCerts", "=", "subjectToCaCerts", ".", "get", "(", "subject", ")", ";", "if", "(", "subjectCaCerts", "=", "=", "null", ")", "{", "subjectCaCerts", "=", "new", "ArrayList", "<", ">(", "1", ")", ";", "subjectToCaCerts", ".", "put", "(", "subject", ",", "subjectCaCerts", ")", ";", "}", "subjectCaCerts", ".", "add", "(", "caCert", ")", ";", "}", "*", "Computes", "the", "effective", "certificate", "chain", "from", "the", "raw", "array", "returned", "by", "Java", "'", "s", "built", "in", "TLS", "*", "APIs", ".", "This", "method", "returns", "a", "list", "of", "certificates", "where", "the", "first", "element", "is", "{", "@", "code", "chain", "[", "0", "]", "},", "*", "each", "certificate", "is", "signed", "by", "the", "certificate", "that", "follows", ",", "and", "the", "last", "certificate", "is", "a", "*", "trusted", "CA", "certificate", ".", "*", "*", "<", "p", ">", "Use", "of", "this", "method", "is", "necessary", "to", "omit", "unexpected", "certificates", "that", "aren", "'", "t", "relevant", "to", "the", "*", "TLS", "handshake", "and", "to", "extract", "the", "trusted", "CA", "certificate", "for", "the", "benefit", "of", "certificate", "pinning", ".", "*", "This", "is", "unexpected", "unless", "the", "X509", "trust", "manager", "in", "this", "class", "is", "different", "from", "the", "trust", "*", "manager", "that", "was", "used", "to", "establish", "{", "@", "code", "chain", "}", ".", "public", "List", "<", "Certificate", ">", "normalizeCertificateChain", "(", "List", "<", "Certificate", ">", "chain", ")", "throws", "SSLPeerUnverifiedException", "{", "X509Certificate", "caCert", "=", "findByIssuerAndSignature", "(", "toVerify", ")", ";", "if", "(", "caCert", "!", "=", "null", "&", "&", "verifySignature", "(", "toVerify", ",", "caCert", ")", ")", "{", "/", "**", "Returns", "the", "trusted", "CA", "certificate", "that", "signed", "{", "@", "code", "cert", "}", ".", "*", "/", "private", "X509Certificate", "findByIssuerAndSignature", "(", "X509Certificate", "cert", ")", "{", "X500Principal", "issuer", "=", "cert", ".", "getIssuerX500Principal", "(", ");", "List", "<", "X509Certificate", ">", "subjectCaCerts", "=", "subjectToCaCerts", ".", "get", "(", "issuer", ")", ";", "if", "(", "subjectCaCerts", "=", "=", "null", ")", "return", "null", ";", "for", "(", "X509Certificate", "caCert", ":", "subjectCaCerts", ")", "{", "PublicKey", "publicKey", "=", "caCert", ".", "getPublicKey", "(", ");", "try", "{", "cert", ".", "verify", "(", "publicKey", ")", ";", "return", "caCert", ";", "}", "catch", "(", "Exception", "ignored", ")", "{", "}", "}", "return", "null", ";", "}"], "docstring_tokens": ["by", "sending", "a", "certificate", "chain", "with", "a", "certificate", "from", "a", "non-pinned", "trusted", "CA", "and", "the", "pinned", "certificate", "."]}
{"contents": ["mm:", "get", "rid", "of", "vmacache_flush_all()", "entirely", "Jann", "Horn", "points", "out", "that", "the", "vmacache_flush_all()", "function", "is", "not", "only", "potentially", "expensive,", "it's", "buggy", "too.", "It", "also", "happens", "to", "be", "entirely", "unnecessary,", "because", "the", "sequence", "number", "overflow", "case", "can", "be", "avoided", "by", "simply", "making", "the", "sequence", "number", "be", "64-bit.", "That", "doesn't", "even", "grow", "the", "data", "structures", "in", "question,", "because", "the", "other", "adjacent", "fields", "are", "already", "64-bit.", "So", "simplify", "the", "whole", "thing", "by", "just", "making", "the", "sequence", "number", "overflow", "case", "go", "away", "entirely,", "which", "gets", "rid", "of", "all", "the", "complications", "and", "makes", "the", "code", "faster", "too.", "Win-win.", "[", "Oleg", "Nesterov", "points", "out", "that", "the", "VMACACHE_FULL_FLUSHES", "statistics", "also", "just", "goes", "away", "entirely", "with", "this", "]", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Suggested-by:", "Will", "Deacon", "<will.deacon@arm.com>", "Acked-by:", "Davidlohr", "Bueso", "<dave@stgolabs.net>", "Cc:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["u64", "vmacache_seqnum", ";", "/", "*", "per", "-", "thread", "vmacache", "*", "/", "u64", "seqnum", ";", "pr_emerg", "(", "\"", "mm", "%", "px", "mmap", "%", "px", "seqnum", "%", "llu", "task_size", "%", "lu", "\\", "n", "\"", "mm", ",", "mm", "-", ">", "mmap", ",", "(", "long", "long", ")", "mm", "-", ">", "vmacache_seqnum", ",", "mm", "-", ">", "task_size", ",</s>u32", "vmacache_seqnum", ";", "/", "*", "per", "-", "thread", "vmacache", "*", "/", "u32", "seqnum", ";", "VMACACHE_FULL_FLUSHES", ",", "extern", "void", "vmacache_flush_all", "(", "struct", "mm_struct", "*", "mm", ")", ";", "/", "*", "deal", "with", "overflows", "*", "/", "if", "(", "unlikely", "(", "mm", "-", ">", "vmacache_seqnum", "=", "=", "0", ")", ")", "vmacache_flush_all", "(", "mm", ")", ";", "pr_emerg", "(", "\"", "mm", "%", "px", "mmap", "%", "px", "seqnum", "%", "d", "task_size", "%", "lu", "\\", "n", "\"", "mm", ",", "mm", "-", ">", "mmap", ",", "mm", "-", ">", "vmacache_seqnum", ",", "mm", "-", ">", "task_size", ",", "/", "*", "*", "Flush", "vma", "caches", "for", "threads", "that", "share", "a", "given", "mm", ".", "*", "*", "The", "operation", "is", "safe", "because", "the", "caller", "holds", "the", "mmap_sem", "*", "exclusively", "and", "other", "threads", "accessing", "the", "vma", "cache", "will", "*", "have", "mmap_sem", "held", "at", "least", "for", "read", ",", "so", "no", "extra", "locking", "*", "is", "required", "to", "maintain", "the", "vma", "cache", ".", "*", "/", "void", "vmacache_flush_all", "(", "struct", "mm_struct", "*", "mm", ")", "{", "struct", "task_struct", "*", "g", ",", "*", "p", ";", "count_vm_vmacache_event", "(", "VMACACHE_FULL_FLUSHES", ")", ";", "/", "*", "*", "Single", "threaded", "tasks", "need", "not", "iterate", "the", "entire", "*", "list", "of", "process", ".", "We", "can", "avoid", "the", "flushing", "as", "well", "*", "since", "the", "mm", "'", "s", "seqnum", "was", "increased", "and", "don", "'", "t", "have", "*", "to", "worry", "about", "other", "threads", "'", "seqnum", ".", "Current", "'", "s", "*", "flush", "will", "occur", "upon", "the", "next", "lookup", ".", "*", "/", "if", "(", "atomic_read", "(", "&", "mm", "-", ">", "mm_users", ")", "=", "=", "1", ")", "return", ";", "rcu_read_lock", "(", ");", "for_each_process_thread", "(", "g", ",", "p", ")", "{", "/", "*", "*", "Only", "flush", "the", "vmacache", "pointers", "as", "the", "*", "mm", "seqnum", "is", "already", "set", "and", "curr", "'", "s", "will", "*", "be", "set", "upon", "invalidation", "when", "the", "next", "*", "lookup", "is", "done", ".", "*", "/", "if", "(", "mm", "=", "=", "p", "-", ">", "mm", ")", "vmacache_flush", "(", "p", ")", ";", "}", "rcu_read_unlock", "(", ");", "}"], "docstring_tokens": ["converting", "it", "to", "a", "64-bit", "counter", "and", "not", "dealing", "with", "overflows", "anymore"]}
{"contents": ["SOLR-12514:", "FIxed", "the", "test", "and", "another", "bug"], "code_tokens": ["import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "java", ".", "security", ".", "Principal", ";", "protected", "HttpServletRequest", "httpRequest", ";", "public", "SolrRequestInfo", "(", "HttpServletRequest", "httpReq", ",", "SolrQueryResponse", "rsp", ")", "{", "this", ".", "httpRequest", "=", "httpReq", ";", "this", ".", "rsp", "=", "rsp", ";", "}", "public", "Principal", "getUserPrincipal", "(", ")", "{", "if", "(", "req", "!", "=", "null", ")", "return", "req", ".", "getUserPrincipal", "(", ");", "if", "(", "httpRequest", "!", "=", "null", ")", "return", "httpRequest", ".", "getUserPrincipal", "(", ");", "return", "null", ";", "}", "Principal", "principal", "=", "reqInfo", ".", "getUserPrincipal", "(", ");", "SolrRequestInfo", ".", "setRequestInfo", "(", "new", "SolrRequestInfo", "(", "req", ",", "new", "SolrQueryResponse", "(", "))", ");", "UpdateRequest", "delQuery", "=", "null", ";", "delQuery", "=", "new", "UpdateRequest", "(", ").", "deleteByQuery", "(", "\"*", ":*", "\")", ";", "delQuery", ".", "setBasicAuthCredentials", "(", "\"", "harry", "\"", ",\"", "HarryIsUberCool", "\"", ");", "delQuery", ".", "process", "(", "aNewClient", ",", "COLLECTION", ")", ";/", "/", "this", "should", "succeed", "Principal", "principal", "=", "reqInfo", ".", "getUserPrincipal", "(", ");</s>Principal", "principal", "=", "reqInfo", ".", "getReq", "(", ").", "getUserPrincipal", "(", ");", "SolrRequestInfo", ".", "setRequestInfo", "(", "new", "SolrRequestInfo", "(", "solrReq", ",", "new", "SolrQueryResponse", "(", "))", ");", "@", "AwaitsFix", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "13098", "\"", ")", "UpdateRequest", "delQuery", "=", "null", ";", "delQuery", "=", "new", "UpdateRequest", "(", ").", "deleteByQuery", "(", "\"*", ":*", "\")", ";", "delQuery", ".", "setBasicAuthCredentials", "(", "\"", "harry", "\"", ",\"", "HarryIsUberCool", "\"", ");", "delQuery", ".", "process", "(", "aNewClient", ",", "COLLECTION", ")", ";/", "/", "this", "should", "succeed", "Principal", "principal", "=", "reqInfo", ".", "getReq", "(", ").", "getUserPrincipal", "(", ");"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["x86/iopl/64:", "Properly", "context-switch", "IOPL", "on", "Xen", "PV", "On", "Xen", "PV,", "regs->flags", "doesn't", "reliably", "reflect", "IOPL", "and", "the", "exit-to-userspace", "code", "doesn't", "change", "IOPL.", "We", "need", "to", "context", "switch", "it", "manually.", "I'm", "doing", "this", "without", "going", "through", "paravirt", "because", "this", "is", "specific", "to", "Xen", "PV.", "After", "the", "dust", "settles,", "we", "can", "merge", "this", "with", "the", "32-bit", "code,", "tidy", "up", "the", "iopl", "syscall", "implementation,", "and", "remove", "the", "set_iopl", "pvop", "entirely.", "Fixes", "XSA-171.", "Reviewewd-by:", "Jan", "Beulich", "<JBeulich@suse.com>", "Signed-off-by:", "Andy", "Lutomirski", "<luto@kernel.org>", "Cc:", "Andrew", "Cooper", "<andrew.cooper3@citrix.com>", "Cc:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Boris", "Ostrovsky", "<boris.ostrovsky@oracle.com>", "Cc:", "Borislav", "Petkov", "<bp@alien8.de>", "Cc:", "Brian", "Gerst", "<brgerst@gmail.com>", "Cc:", "David", "Vrabel", "<david.vrabel@citrix.com>", "Cc:", "Denys", "Vlasenko", "<dvlasenk@redhat.com>", "Cc:", "H.", "Peter", "Anvin", "<hpa@zytor.com>", "Cc:", "Jan", "Beulich", "<JBeulich@suse.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "stable@vger.kernel.org", "Link:", "http://lkml.kernel.org/r/693c3bd7aeb4d3c27c92c622b7d0f554a458173c.1458162709.git.luto@kernel.org", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["extern", "void", "xen_set_iopl_mask", "(", "unsigned", "mask", ")", ";", "#", "include", "<", "asm", "/", "xen", "/", "hypervisor", ".", "h", ">", "#", "ifdef", "CONFIG_XEN", "/", "*", "*", "On", "Xen", "PV", ",", "IOPL", "bits", "in", "pt_regs", "-", ">", "flags", "have", "no", "effect", ",", "and", "*", "current_pt_regs", "(", ")-", ">", "flags", "may", "not", "match", "the", "current", "task", "'", "s", "*", "intended", "IOPL", ".", "We", "need", "to", "switch", "it", "manually", ".", "*", "/", "if", "(", "unlikely", "(", "static_cpu_has", "(", "X86_FEATURE_XENPV", ")", "&", "&", "prev", "-", ">", "iopl", "!", "=", "next", "-", ">", "iopl", ")", ")", "xen_set_iopl_mask", "(", "next", "-", ">", "iopl", ")", ";", "#", "endif", "void", "xen_set_iopl_mask", "(", "unsigned", "mask", ")</s>static", "void", "xen_set_iopl_mask", "(", "unsigned", "mask", ")"], "docstring_tokens": ["code", "at", "a", "privilege", "level", "other", "than", "zero"]}
{"contents": ["tty:", "fix", "race", "in", "tty_fasync", "We", "need", "to", "keep", "the", "lock", "held", "over", "the", "call", "to", "__f_setown()", "to", "prevent", "a", "PID", "race.", "Thanks", "to", "Al", "Viro", "for", "pointing", "out", "the", "problem,", "and", "to", "Travis", "for", "making", "us", "look", "here", "in", "the", "first", "place.", "Cc:", "Eric", "W.", "Biederman", "<ebiederm@xmission.com>", "Cc:", "Al", "Viro", "<viro@ZenIV.linux.org.uk>", "Cc:", "Alan", "Cox", "<alan@lxorguk.ukuu.org.uk>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Tavis", "Ormandy", "<taviso@google.com>", "Cc:", "Jeff", "Dike", "<jdike@addtoit.com>", "Cc:", "Julien", "Tinnes", "<jln@google.com>", "Cc:", "Matt", "Mackall", "<mpm@selenic.com>", "Cc:", "stable", "<stable@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@suse.de>"], "code_tokens": ["spin_unlock_irqrestore", "(", "&", "tty", "-", ">", "ctrl_lock", ",", "flags", ")", ";</s>spin_unlock_irqrestore", "(", "&", "tty", "-", ">", "ctrl_lock", ",", "flags", ")", ";"], "docstring_tokens": ["related", "to", "the", "put_tty_queue", "and", "__f_setown", "functions", "."]}
{"contents": ["mm:", "migrate", "dirty", "page", "without", "clear_page_dirty_for_io", "etc", "clear_page_dirty_for_io()", "has", "accumulated", "writeback", "and", "memcg", "subtleties", "since", "v2.6.16", "first", "introduced", "page", "migration;", "and", "the", "set_page_dirty()", "which", "completed", "its", "migration", "of", "PageDirty,", "later", "had", "to", "be", "moderated", "to", "__set_page_dirty_nobuffers();", "then", "PageSwapBacked", "had", "to", "skip", "that", "too.", "No", "actual", "problems", "seen", "with", "this", "procedure", "recently,", "but", "if", "you", "look", "into", "what", "the", "clear_page_dirty_for_io(page)+set_page_dirty(newpage)", "is", "actually", "achieving,", "it", "turns", "out", "to", "be", "nothing", "more", "than", "moving", "the", "PageDirty", "flag,", "and", "its", "NR_FILE_DIRTY", "stat", "from", "one", "zone", "to", "another.", "It", "would", "be", "good", "to", "avoid", "a", "pile", "of", "irrelevant", "decrementations", "and", "incrementations,", "and", "improper", "event", "counting,", "and", "unnecessary", "descent", "of", "the", "radix_tree", "under", "tree_lock", "(to", "set", "the", "PAGECACHE_TAG_DIRTY", "which", "radix_tree_replace_slot()", "left", "in", "place", "anyway).", "Do", "the", "NR_FILE_DIRTY", "movement,", "like", "the", "other", "stats", "movements,", "while", "interrupts", "still", "disabled", "in", "migrate_page_move_mapping();", "and", "don't", "even", "bother", "if", "the", "zone", "is", "the", "same.", "Do", "the", "PageDirty", "movement", "there", "under", "tree_lock", "too,", "where", "old", "page", "is", "frozen", "and", "newpage", "not", "yet", "visible:", "bearing", "in", "mind", "that", "as", "soon", "as", "newpage", "becomes", "visible", "in", "radix_tree,", "an", "un-page-locked", "set_page_dirty()", "might", "interfere", "(or", "perhaps", "that's", "just", "not", "possible:", "anything", "doing", "so", "should", "already", "hold", "an", "additional", "reference", "to", "the", "old", "page,", "preventing", "its", "migration;", "but", "play", "safe).", "But", "we", "do", "still", "need", "to", "transfer", "PageDirty", "in", "migrate_page_copy(),", "for", "those", "who", "don't", "go", "the", "mapping", "route", "through", "migrate_page_move_mapping().", "Signed-off-by:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "Christoph", "Lameter", "<cl@linux.com>", "Cc:", "\"Kirill", "A.", "Shutemov\"", "<kirill.shutemov@linux.intel.com>", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "Vlastimil", "Babka", "<vbabka@suse.cz>", "Cc:", "Davidlohr", "Bueso", "<dave@stgolabs.net>", "Cc:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "Sasha", "Levin", "<sasha.levin@oracle.com>", "Cc:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "KOSAKI", "Motohiro", "<kosaki.motohiro@jp.fujitsu.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "include", "<", "linux", "/", "backing", "-", "dev", ".", "h", ">", "struct", "zone", "*", "oldzone", ",", "*", "newzone", ";", "int", "dirty", ";", "oldzone", "=", "page_zone", "(", "page", ")", ";", "newzone", "=", "page_zone", "(", "newpage", ")", ";", "/", "*", "Move", "dirty", "while", "page", "refs", "frozen", "and", "newpage", "not", "yet", "exposed", "*", "/", "dirty", "=", "PageDirty", "(", "page", ")", ";", "if", "(", "dirty", ")", "{", "ClearPageDirty", "(", "page", ")", ";", "SetPageDirty", "(", "newpage", ")", ";", "}", "spin_unlock", "(", "&", "mapping", "-", ">", "tree_lock", ")", ";", "/", "*", "Leave", "irq", "disabled", "to", "prevent", "preemption", "while", "updating", "stats", "*", "/", "if", "(", "newzone", "!", "=", "oldzone", ")", "{", "__dec_zone_state", "(", "oldzone", ",", "NR_FILE_PAGES", ")", ";", "__inc_zone_state", "(", "newzone", ",", "NR_FILE_PAGES", ")", ";", "if", "(", "PageSwapBacked", "(", "page", ")", "&", "&", "!", "PageSwapCache", "(", "page", ")", ")", "{", "__dec_zone_state", "(", "oldzone", ",", "NR_SHMEM", ")", ";", "__inc_zone_state", "(", "newzone", ",", "NR_SHMEM", ")", ";", "}", "if", "(", "dirty", "&", "&", "mapping_cap_account_dirty", "(", "mapping", ")", ")", "{", "__dec_zone_state", "(", "oldzone", ",", "NR_FILE_DIRTY", ")", ";", "__inc_zone_state", "(", "newzone", ",", "NR_FILE_DIRTY", ")", ";", "}", "local_irq_enable", "(", ");", "/", "*", "Move", "dirty", "on", "pages", "not", "done", "by", "migrate_page_move_mapping", "(", ")", "*", "/", "if", "(", "PageDirty", "(", "page", ")", ")", "SetPageDirty", "(", "newpage", ")", ";</s>__dec_zone_page_state", "(", "page", ",", "NR_FILE_PAGES", ")", ";", "__inc_zone_page_state", "(", "newpage", ",", "NR_FILE_PAGES", ")", ";", "if", "(", "!", "PageSwapCache", "(", "page", ")", "&", "&", "PageSwapBacked", "(", "page", ")", ")", "{", "__dec_zone_page_state", "(", "page", ",", "NR_SHMEM", ")", ";", "__inc_zone_page_state", "(", "newpage", ",", "NR_SHMEM", ")", ";", "spin_unlock_irq", "(", "&", "mapping", "-", ">", "tree_lock", ")", ";", "if", "(", "PageDirty", "(", "page", ")", ")", "{", "clear_page_dirty_for_io", "(", "page", ")", ";", "/", "*", "*", "Want", "to", "mark", "the", "page", "and", "the", "radix", "tree", "as", "dirty", ",", "and", "*", "redo", "the", "accounting", "that", "clear_page_dirty_for_io", "undid", ",", "*", "but", "we", "can", "'", "t", "use", "set_page_dirty", "because", "that", "function", "*", "is", "actually", "a", "signal", "that", "all", "of", "the", "page", "has", "become", "dirty", ".", "*", "Whereas", "only", "part", "of", "our", "page", "may", "be", "dirty", ".", "*", "/", "if", "(", "PageSwapBacked", "(", "page", ")", ")", "SetPageDirty", "(", "newpage", ")", ";", "else", "__set_page_dirty_nobuffers", "(", "newpage", ")", ";", "}"], "docstring_tokens": ["by", "triggering", "a", "certain", "page", "move", "."]}
{"contents": ["Ensuring", "secure", "XSLT", "processing", "everywhere"], "code_tokens": ["import", "org", ".", "apache", ".", "cxf", ".", "staxutils", ".", "StaxUtils", ";", "Document", "doc", "=", "StaxUtils", ".", "read", "(", "getClass", "(", ").", "getResource", "(", "\"/", "\"", "+", "authorizations", ")", ".", "openStream", "(", "))", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ".", "VoidURIResolver", ";", "private", "static", "final", "SAXTransformerFactory", "TRANSFORMER_FACTORY", ";", "static", "{", "TRANSFORMER_FACTORY", "=", "(", "SAXTransformerFactory", ")", "TransformerFactory", ".", "newInstance", "(", ");", "TRANSFORMER_FACTORY", ".", "setURIResolver", "(", "new", "VoidURIResolver", "(", "))", ";", "try", "{", "TRANSFORMER_FACTORY", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Could", "not", "enable", "secure", "XML", "processing", "\"", ",", "e", ")", ";", "}", "}", "handler", "=", "TRANSFORMER_FACTORY", ".", "newTransformerHandler", "(", ");", "createBean", "(", "reportletClass", ",", "AbstractBeanDefinition", ".", "AUTOWIRE_BY_TYPE", ",", "false", ")", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "XSLTTransformer", "xsl2html", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2html", ".", "xsl", "\"", "))", ");", "XSLTTransformer", "xsl2pdf", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ");", "XSLTTransformer", "xsl2rtf", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ");", "XSLTTransformer", "xsl2csv", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2csv", ".", "xsl", "\"", "))", ");", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "rest", ".", "controller", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Templates", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXTransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "TransformerHandler", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "SetupException", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "caching", ".", "CacheKey", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "component", ".", "CachingPipelineComponent", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "util", ".", "StringRepresentation", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "AbstractSAXTransformer", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "SAXConsumer", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "util", ".", "SAXConsumerAdapter", ";", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ".", "VoidURIResolver", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "public", "class", "XSLTTransformer", "extends", "AbstractSAXTransformer", "implements", "CachingPipelineComponent", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "XSLTTransformer", ".", "class", ")", ";", "/", "**", "*", "A", "generic", "transformer", "factory", "to", "parse", "XSLTs", ".", "*", "/", "private", "static", "final", "SAXTransformerFactory", "TRAX_FACTORY", "=", "createNewSAXTransformerFactory", "(", ");", "/", "**", "*", "The", "XSLT", "parameters", "name", "pattern", ".", "*", "/", "private", "static", "final", "Pattern", "XSLT_PARAMETER_NAME_PATTERN", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z_", "]", "[\\", "\\", "w", "\\", "\\-", "\\\\", ".]", "*\"", ");", "/", "**", "*", "The", "XSLT", "parameters", "reference", ".", "*", "/", "private", "Map", "<", "String", ",", "Object", ">", "parameters", ";", "/", "**", "*", "The", "XSLT", "Template", "reference", ".", "*", "/", "private", "Templates", "templates", ";", "private", "Source", "source", ";", "public", "XSLTTransformer", "(", "final", "Source", "source", ")", "{", "super", "(", ");", "this", ".", "load", "(", "source", ",", "null", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "transformer", "reading", "the", "XSLT", "from", "the", "Source", "source", "and", "setting", "the", "TransformerFactory", "attributes", ".", "*", "*", "This", "constructor", "is", "useful", "when", "users", "want", "to", "perform", "XSLT", "transformation", "using", "<", "a", "*", "href", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "-", "j", "/", "xsltc_usage", ".", "html", "\"", ">", "xsltc", "<", "/", "a", ">", ".", "*", "*", "@", "param", "source", "the", "XSLT", "source", "*", "@", "param", "attributes", "the", "Transformer", "Factory", "attributes", "*", "/", "public", "XSLTTransformer", "(", "final", "Source", "source", ",", "final", "Map", "<", "String", ",", "Object", ">", "attributes", ")", "{", "super", "(", ");", "this", ".", "load", "(", "source", ",", "attributes", ")", ";", "}", "/", "**", "*", "Method", "useful", "to", "create", "a", "new", "transformer", "reading", "the", "XSLT", "from", "the", "URL", "source", "and", "setting", "the", "Transformer", "*", "Factory", "attributes", ".", "*", "*", "This", "method", "is", "useful", "when", "users", "want", "to", "perform", "XSLT", "transformation", "using", "<", "a", "*", "href", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "-", "j", "/", "xsltc_usage", ".", "html", "\"", ">", "xsltc", "<", "/", "a", ">", ".", "*", "*", "@", "param", "source", "the", "XSLT", "source", "*", "@", "param", "attributes", "the", "Transformer", "Factory", "attributes", "*", "/", "private", "void", "load", "(", "final", "Source", "source", ",", "final", "Map", "<", "String", ",", "Object", ">", "attributes", ")", "{", "if", "(", "source", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "The", "parameter", "'", "source", "'", "mustn", "'", "t", "be", "null", ".", "\")", ";", "}", "this", ".", "source", "=", "source", ";", "this", ".", "load", "(", "this", ".", "source", ",", "this", ".", "source", ".", "toString", "(", "),", "attributes", ")", ";", "}", "private", "void", "load", "(", "final", "Source", "source", ",", "final", "String", "localCacheKey", ",", "final", "Map", "<", "String", ",", "Object", ">", "attributes", ")", "{", "LOG", ".", "debug", "(", "\"{", "}", "local", "cache", "miss", ":", "{", "}\"", ",", "getClass", "(", ").", "getSimpleName", "(", "),", "localCacheKey", ")", ";", "/", "/", "XSLT", "has", "to", "be", "parsed", "final", "SAXTransformerFactory", "transformerFactory", ";", "if", "(", "attributes", "=", "=", "null", "|", "|", "attributes", ".", "isEmpty", "(", "))", "{", "transformerFactory", "=", "TRAX_FACTORY", ";", "}", "else", "{", "transformerFactory", "=", "createNewSAXTransformerFactory", "(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "attribute", ":", "attributes", ".", "entrySet", "(", "))", "{", "transformerFactory", ".", "setAttribute", "(", "attribute", ".", "getKey", "(", "),", "attribute", ".", "getValue", "(", "))", ";", "}", "}", "try", "{", "this", ".", "templates", "=", "transformerFactory", ".", "newTemplates", "(", "source", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "SetupException", "(", "\"", "Impossible", "to", "read", "XSLT", "from", "'", "\"", "+", "source", "+", "\"", "',", "see", "nested", "exception", "\"", ",", "e", ")", ";", "}", "}", "/", "**", "*", "Sets", "the", "XSLT", "parameters", "to", "be", "applied", "to", "XSLT", "stylesheet", ".", "*", "*", "@", "param", "parameters", "the", "XSLT", "parameters", "to", "be", "applied", "to", "XSLT", "stylesheet", "*", "/", "public", "void", "setParameters", "(", "final", "Map", "<", "String", ",", "?", "extends", "Object", ">", "parameters", ")", "{", "if", "(", "parameters", "=", "=", "null", ")", "{", "this", ".", "parameters", "=", "null", ";", "}", "else", "{", "this", ".", "parameters", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "(", "parameters", ")", ";", "}", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "void", "setSAXConsumer", "(", "final", "SAXConsumer", "consumer", ")", "{", "TransformerHandler", "transformerHandler", ";", "try", "{", "transformerHandler", "=", "TRAX_FACTORY", ".", "newTransformerHandler", "(", "this", ".", "templates", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "SetupException", "(", "\"", "Could", "not", "initialize", "transformer", "handler", ".", "\",", "e", ")", ";", "}", "if", "(", "this", ".", "parameters", "!", "=", "null", ")", "{", "final", "Transformer", "transformer", "=", "transformerHandler", ".", "getTransformer", "(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "this", ".", "parameters", ".", "entrySet", "(", "))", "{", "final", "String", "name", "=", "entry", ".", "getKey", "(", ");", "/", "/", "is", "valid", "XSLT", "parameter", "name", "if", "(", "XSLT_PARAMETER_NAME_PATTERN", ".", "matcher", "(", "name", ")", ".", "matches", "(", "))", "{", "transformer", ".", "setParameter", "(", "name", ",", "entry", ".", "getValue", "(", "))", ";", "}", "}", "}", "final", "SAXResult", "result", "=", "new", "SAXResult", "(", ");", "result", ".", "setHandler", "(", "consumer", ")", ";", "/", "/", "According", "to", "TrAX", "specs", ",", "all", "TransformerHandlers", "are", "LexicalHandlers", "result", ".", "setLexicalHandler", "(", "consumer", ")", ";", "transformerHandler", ".", "setResult", "(", "result", ")", ";", "final", "SAXConsumerAdapter", "saxConsumerAdapter", "=", "new", "SAXConsumerAdapter", "(", ");", "saxConsumerAdapter", ".", "setContentHandler", "(", "transformerHandler", ")", ";", "super", ".", "setSAXConsumer", "(", "saxConsumerAdapter", ")", ";", "}", "@", "Override", "public", "CacheKey", "constructCacheKey", "(", ")", "{", "return", "null", ";", "}", "/", "**", "*", "Utility", "method", "to", "create", "a", "new", "transformer", "factory", ".", "*", "*", "@", "return", "a", "new", "transformer", "factory", "*", "/", "private", "static", "SAXTransformerFactory", "createNewSAXTransformerFactory", "(", ")", "{", "SAXTransformerFactory", "transformerFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setURIResolver", "(", "new", "VoidURIResolver", "(", "))", ";", "try", "{", "transformerFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Could", "not", "enable", "secure", "XML", "processing", "\"", ",", "e", ")", ";", "}", "return", "transformerFactory", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "StringRepresentation", ".", "buildString", "(", "this", ",", "\"", "src", "=", "<\"", "+", "this", ".", "source", "+", "\"", ">\"", ");", "}", "}", "@", "@", "-", "40", ",", "6", "+", "40", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "transformerFactory", ".", "setURIResolver", "(", "new", "VoidURIResolver", "(", "))", ";", "transformerFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "URIResolver", ";", "/", "**", "*", "This", "implementation", "disallows", "any", "XSLT", "include", ",", "for", "security", "reasons", ".", "*", "/", "public", "class", "VoidURIResolver", "implements", "URIResolver", "{", "@", "Override", "public", "Source", "resolve", "(", "final", "String", "href", ",", "final", "String", "base", ")", "throws", "TransformerException", "{", "return", "null", ";", "}", "}</s>import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setNamespaceAware", "(", "true", ")", ";", "DocumentBuilder", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "Document", "doc", "=", "db", ".", "parse", "(", "getClass", "(", ").", "getResource", "(", "\"/", "\"", "+", "authorizations", ")", ".", "openStream", "(", "))", ";", "SAXTransformerFactory", "tFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "handler", "=", "tFactory", ".", "newTransformerHandler", "(", ");", "createBean", "(", "reportletClass", ",", "AbstractBeanDefinition", ".", "AUTOWIRE_BY_TYPE", ",", "false", ")", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "component", ".", "XSLTTransformer", ";", "XSLTTransformer", "xsl2html", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2html", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2pdf", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2rtf", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2csv", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2csv", ".", "xsl", "\"", "))", ";"], "docstring_tokens": ["measuring", "how", "the", "results", "are", "returned", "the", "values", "of", "the", "desired", "fields"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/1225"], "code_tokens": ["string", "=", "GetMagickPropertyLetter", "(", "image_info", ",", "image", ",", "*", "p", ",", "exception", ")", ";", "image", "-", ">", "scene", ")", ";", "WarnNoImageReturn", "(", "\"\\", "\"%", "%[", "%", "s", "]", "\\\"", "\",", "property", ")", ";", "WarnNoImageReturn", "(", "\"\\", "\"%", "%[", "%", "s", "]", "\\\"", "\",", "property", ")", ";", "WarnNoImageReturn", "(", "\"\\", "\"%", "%[", "%", "s", "]", "\\\"", "\",", "property", ")", ";", "WarnNoImageReturn", "(", "\"\\", "\"%", "%[", "%", "s", "]", "\\\"", "\",", "property", ")", ";</s>string", "=", "GetMagickPropertyLetter", "(", "image_info", ",", "image", ",", "*", "p", ",", "exception", ")", ";", "image", "-", ">", "scene", ")", ";"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["Fixed", "bug", "#72479", "-", "same", "as", "#72434"], "code_tokens": ["static", "void", "php_snmp_internal", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "st", ",", "if", "(", "vars", "-", ">", "type", "=", "=", "SNMP_ENDOFMIBVIEW", "|", "|", "vars", "-", ">", "type", "=", "=", "SNMP_NOSUCHOBJECT", "|", "|", "if", "(", "(", "st", "&", "SNMP_CMD_WALK", ")", "&", "&", "}", "else", "{", "/", "*", "{", "{{", "proto", "mixed", "snmpget", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmpgetnext", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmpwalk", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "bool", "snmpset", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", ",", "mixed", "type", ",", "mixed", "value", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "}", "}", "/", "*", "{", "{{", "proto", "mixed", "snmp2_get", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmp2_getnext", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmp2_walk", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "bool", "snmp2_set", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", ",", "mixed", "type", ",", "mixed", "value", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "bool", "SNMP", ":", ":", "close", "(", ")", "/", "*", "{", "{{", "proto", "bool", "SNMP", ":", ":", "set", "(", "mixed", "object_id", ",", "mixed", "type", ",", "mixed", "value", ")", "/", "*", "{", "{{", "proto", "long", "SNMP", ":", ":", "getErrno", "(", ")", "/", "*", "{", "{{", "proto", "long", "SNMP", ":", ":", "getError", "(", ")", "static", "HashTable", "*", "php_snmp_get_gc", "(", "zval", "*", "object", ",", "zval", "*", "**", "gc_data", ",", "int", "*", "gc_data_count", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "*", "gc_data", "=", "NULL", ";", "*", "gc_data_count", "=", "0", ";", "return", "zend_std_get_properties", "(", "object", "TSRMLS_CC", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "snmp_object", "-", ">", "exceptions_enabled", "=", "Z_LVAL_P", "(", "newval", ")", ";", "php_snmp_object_handlers", ".", "get_gc", "=", "php_snmp_get_gc", ";", "-", "-", "TEST", "-", "-", "Bug", "#", "72479", ":", "Use", "After", "Free", "Vulnerability", "in", "SNMP", "with", "GC", "and", "unserialize", "(", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "dirname", "(", "__FILE__", ")", ".'", "/", "skipif", ".", "inc", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "arr", "=", "[", "1", ",", "[", "1", ",", "2", ",", "3", ",", "4", ",", "5", "]", ",", "3", ",", "4", ",", "5", "]", ";", "$", "poc", "=", "'", "a", ":", "3", ":", "{", "i", ":", "1", ";", "N", ";", "i", ":", "2", ";", "O", ":", "4", ":", "\"", "snmp", "\"", ":", "1", ":", "{", "s", ":", "11", ":", "\"", "quick_print", "\"", ";'", ".", "serialize", "(", "$", "arr", ")", ".'", "}", "i", ":", "1", ";", "R", ":", "7", ";", "}'", ";", "$", "out", "=", "unserialize", "(", "$", "poc", ")", ";", "gc_collect_cycles", "(", ");", "$", "fakezval", "=", "ptr2str", "(", "1122334455", ")", ";", "$", "fakezval", ".", "=", "ptr2str", "(", "0", ")", ";", "$", "fakezval", ".", "=", "\"", "\\", "x00", "\\", "x00", "\\", "x00", "\\", "x00", "\"", ";", "$", "fakezval", ".", "=", "\"", "\\", "x01", "\"", ";", "$", "fakezval", ".", "=", "\"", "\\", "x00", "\"", ";", "$", "fakezval", ".", "=", "\"", "\\", "x00", "\\", "x00", "\"", ";", "for", "(", "$", "i", "=", "0", ";", "$", "i", "<", "5", ";", "$", "i", "+", "+)", "{", "$", "v", "[", "$", "i", "]", "=", "$", "fakezval", ".", "$", "i", ";", "}", "var_dump", "(", "$", "out", "[", "1", "]", ");", "function", "ptr2str", "(", "$", "ptr", ")", "{", "$", "out", "=", "'", "';", "for", "(", "$", "i", "=", "0", ";", "$", "i", "<", "8", ";", "$", "i", "+", "+)", "{", "$", "out", ".", "=", "chr", "(", "$", "ptr", "&", "0xff", ")", ";", "$", "ptr", ">", ">=", "8", ";", "}", "return", "$", "out", ";", "}", "?", ">", "-", "-", "EXPECT", "-", "-", "int", "(", "1", ")</s>static", "void", "php_snmp_internal", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "int", "st", ",", "if", "(", "vars", "-", ">", "type", "=", "=", "SNMP_ENDOFMIBVIEW", "|", "|", "vars", "-", ">", "type", "=", "=", "SNMP_NOSUCHOBJECT", "|", "|", "if", "(", "(", "st", "&", "SNMP_CMD_WALK", ")", "&", "&", "}", "else", "{", "/", "*", "{", "{{", "proto", "mixed", "snmpget", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmpgetnext", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmpwalk", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "bool", "snmpset", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", ",", "mixed", "type", ",", "mixed", "value", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "}", "}", "/", "*", "{", "{{", "proto", "mixed", "snmp2_get", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmp2_getnext", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "mixed", "snmp2_walk", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "bool", "snmp2_set", "(", "string", "host", ",", "string", "community", ",", "mixed", "object_id", ",", "mixed", "type", ",", "mixed", "value", "[", ",", "int", "timeout", "[", ",", "int", "retries", "]", "])", "/", "*", "{", "{{", "proto", "bool", "SNMP", ":", ":", "close", "(", ")", "/", "*", "{", "{{", "proto", "bool", "SNMP", ":", ":", "set", "(", "mixed", "object_id", ",", "mixed", "type", ",", "mixed", "value", ")", "/", "*", "{", "{{", "proto", "long", "SNMP", ":", ":", "getErrno", "(", ")", "/", "*", "{", "{{", "proto", "long", "SNMP", ":", ":", "getError", "(", ")", "snmp_object", "-", ">", "exceptions_enabled", "=", "Z_LVAL_P", "(", "newval", ")", ";"], "docstring_tokens": ["using", "specially", "crafted", "serialized", "data"]}
{"contents": ["Identity", "zone", "creation", "checks", "for", "signing", "key", "with", "issuer", "[#157376547]", "https://www.pivotaltracker.com/story/show/157376547", "Signed-off-by:", "Jaskanwal", "Pawar", "<jpawar@pivotal.io>"], "code_tokens": ["if", "(", "!", "StringUtils", ".", "isEmpty", "(", "config", ".", "getIssuer", "(", "))", ")", "{", "if", "(", "tokenPolicy", "=", "=", "null", "|", "|", "StringUtils", ".", "isEmpty", "(", "tokenPolicy", ".", "getActiveKeyId", "(", "))", ")", "{", "throw", "new", "InvalidIdentityZoneConfigurationException", "(", "\"", "You", "cannot", "set", "issuer", "value", "unless", "you", "have", "set", "your", "own", "signing", "key", "for", "this", "identity", "zone", ".", "\")", ";", "}", "}", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "@", "Test", "public", "void", "testCreateZone_withCustomIssuerAndSigningKeyWorks", "(", ")", "throws", "Exception", "{", "IdentityZoneConfiguration", "identityZoneConfiguration", "=", "new", "IdentityZoneConfiguration", "(", ");", "identityZoneConfiguration", ".", "setIssuer", "(", "\"", "http", ":", "//", "my", "-", "custom", "-", "issuer", ".", "com", "\"", ");", "identityZoneConfiguration", ".", "setTokenPolicy", "(", "new", "TokenPolicy", "(", "))", ";", "createZone", "(", "\"", "should", "-", "not", "-", "exist", "\"", "+", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "),", "HttpStatus", ".", "CREATED", ",", "adminToken", ",", "identityZoneConfiguration", ")", ";", "}", "@", "Test", "public", "void", "testCreateZone_withCustomIssuerAndNoTokenPolicyShouldFail", "(", ")", "throws", "Exception", "{", "IdentityZoneConfiguration", "identityZoneConfiguration", "=", "new", "IdentityZoneConfiguration", "(", ");", "identityZoneConfiguration", ".", "setIssuer", "(", "\"", "http", ":", "//", "my", "-", "custom", "-", "issuer", ".", "com", "\"", ");", "identityZoneConfiguration", ".", "setTokenPolicy", "(", "null", ")", ";", "createZone", "(", "\"", "should", "-", "not", "-", "exist", "\"", "+", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "),", "HttpStatus", ".", "UNPROCESSABLE_ENTITY", ",", "\"", "You", "cannot", "set", "issuer", "value", "unless", "you", "have", "set", "your", "own", "signing", "key", "for", "this", "identity", "zone", ".", "\",", "adminToken", ",", "identityZoneConfiguration", ")", ";", "}", "@", "Test", "public", "void", "testCreateZone_withCustomIssuerAndNoActiveSigningKeyShouldFail", "(", ")", "throws", "Exception", "{", "IdentityZoneConfiguration", "identityZoneConfiguration", "=", "new", "IdentityZoneConfiguration", "(", ");", "identityZoneConfiguration", ".", "setIssuer", "(", "\"", "http", ":", "//", "my", "-", "custom", "-", "issuer", ".", "com", "\"", ");", "identityZoneConfiguration", ".", "setTokenPolicy", "(", "new", "TokenPolicy", "(", "))", ";", "createZone", "(", "\"", "should", "-", "not", "-", "exist", "\"", "+", "new", "RandomValueStringGenerator", "(", "5", ")", ".", "generate", "(", "),", "HttpStatus", ".", "UNPROCESSABLE_ENTITY", ",", "\"", "You", "cannot", "set", "issuer", "value", "unless", "you", "have", "set", "your", "own", "signing", "key", "for", "this", "identity", "zone", ".", "\",", "adminToken", ",", "identityZoneConfiguration", ")", ";", "}", "Map", "<", "String", ",", "String", ">", "keys", "=", "new", "HashMap", "<", ">(", ");", "keys", ".", "put", "(", "\"", "kid", "\"", ",", "\"", "key", "\"", ");", "zoneConfiguration", ".", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "zoneConfiguration", ".", "getTokenPolicy", "(", ").", "setActiveKeyId", "(", "\"", "kid", "\"", ");", "zoneConfiguration", ".", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "return", "createZone", "(", "id", ",", "expect", ",", "\"", "\"", ",", "token", ",", "zoneConfiguration", ")", ";", "}", "private", "IdentityZone", "createZone", "(", "String", "id", ",", "HttpStatus", "expect", ",", "String", "expectedContent", ",", "String", "token", ",", "IdentityZoneConfiguration", "zoneConfiguration", ")", "throws", "Exception", "{", ".", "andExpect", "(", "content", "(", ").", "string", "(", "containsString", "(", "expectedContent", ")", "))</s>Map", "<", "String", ",", "String", ">", "keys", "=", "new", "HashMap", "<", ">(", ");", "keys", ".", "put", "(", "\"", "kid", "\"", ",", "\"", "key", "\"", ");", "identityZone", ".", "getConfig", "(", ").", "getTokenPolicy", "(", ").", "setKeys", "(", "keys", ")", ";", "identityZone", ".", "getConfig", "(", ").", "getTokenPolicy", "(", ").", "setActiveKeyId", "(", "\"", "kid", "\"", ");"], "docstring_tokens": ["sending", "specially-crafted", "arguments"]}
{"contents": ["KEYS:", "prevent", "KEYCTL_READ", "on", "negative", "key", "Because", "keyctl_read_key()", "looks", "up", "the", "key", "with", "no", "permissions", "requested,", "it", "may", "find", "a", "negatively", "instantiated", "key.", "If", "the", "key", "is", "also", "possessed,", "we", "went", "ahead", "and", "called", "->read()", "on", "the", "key.", "But", "the", "key", "payload", "will", "actually", "contain", "the", "->reject_error", "rather", "than", "the", "normal", "payload.", "Thus,", "the", "kernel", "oopses", "trying", "to", "read", "the", "user_key_payload", "from", "memory", "address", "(int)-ENOKEY", "=", "0x00000000ffffff82.", "Fortunately", "the", "payload", "data", "is", "stored", "inline,", "so", "it", "shouldn't", "be", "possible", "to", "abuse", "this", "as", "an", "arbitrary", "memory", "read", "primitive...", "Reproducer:", "keyctl", "new_session", "keyctl", "request2", "user", "desc", "''", "@s", "keyctl", "read", "$(keyctl", "show", "|", "awk", "'/user:", "desc/", "{print", "$1}')", "It", "causes", "a", "crash", "like", "the", "following:", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "00000000ffffff92", "IP:", "user_read+0x33/0xa0", "PGD", "36a54067", "P4D", "36a54067", "PUD", "0", "Oops:", "0000", "[#1]", "SMP", "CPU:", "0", "PID:", "211", "Comm:", "keyctl", "Not", "tainted", "4.14.0-rc1", "#337", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "1.10.2-20170228_101828-anatol", "04/01/2014", "task:", "ffff90aa3b74c3c0", "task.stack:", "ffff9878c0478000", "RIP:", "0010:user_read+0x33/0xa0", "RSP:", "0018:ffff9878c047bee8", "EFLAGS:", "00010246", "RAX:", "0000000000000001", "RBX:", "ffff90aa3d7da340", "RCX:", "0000000000000017", "RDX:", "0000000000000000", "RSI:", "00000000ffffff82", "RDI:", "ffff90aa3d7da340", "RBP:", "ffff9878c047bf00", "R08:", "00000024f95da94f", "R09:", "0000000000000000", "R10:", "0000000000000001", "R11:", "0000000000000000", "R12:", "0000000000000000", "R13:", "0000000000000000", "R14:", "0000000000000000", "R15:", "0000000000000000", "FS:", "00007f58ece69740(0000)", "GS:ffff90aa3e200000(0000)", "knlGS:0000000000000000", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "CR2:", "00000000ffffff92", "CR3:", "0000000036adc001", "CR4:", "00000000003606f0", "Call", "Trace:", "keyctl_read_key+0xac/0xe0", "SyS_keyctl+0x99/0x120", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "RIP:", "0033:0x7f58ec787bb9", "RSP:", "002b:00007ffc8d401678", "EFLAGS:", "00000206", "ORIG_RAX:", "00000000000000fa", "RAX:", "ffffffffffffffda", "RBX:", "00007ffc8d402800", "RCX:", "00007f58ec787bb9", "RDX:", "0000000000000000", "RSI:", "00000000174a63ac", "RDI:", "000000000000000b", "RBP:", "0000000000000004", "R08:", "00007ffc8d402809", "R09:", "0000000000000020", "R10:", "0000000000000000", "R11:", "0000000000000206", "R12:", "00007ffc8d402800", "R13:", "00007ffc8d4016e0", "R14:", "0000000000000000", "R15:", "0000000000000000", "Code:", "e5", "41", "55", "49", "89", "f5", "41", "54", "49", "89", "d4", "53", "48", "89", "fb", "e8", "a4", "b4", "ad", "ff", "85", "c0", "74", "09", "80", "3d", "b9", "4c", "96", "00", "00", "74", "43", "48", "8b", "b3", "20", "01", "00", "00", "4d", "85", "ed", "<0f>", "b7", "5e", "10", "74", "29", "4d", "85", "e4", "74", "24", "4c", "39", "e3", "4c", "89", "e2", "4c", "89", "ef", "48", "RIP:", "user_read+0x33/0xa0", "RSP:", "ffff9878c047bee8", "CR2:", "00000000ffffff92", "Fixes:", "61ea0c0ba904", "(\"KEYS:", "Skip", "key", "state", "checks", "when", "checking", "for", "possession\")", "Cc:", "<stable@vger.kernel.org>", "[v3.13+]", "Signed-off-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>"], "code_tokens": ["if", "(", "test_bit", "(", "KEY_FLAG_NEGATIVE", ",", "&", "key", "-", ">", "flags", ")", ")", "{", "ret", "=", "-", "ENOKEY", ";", "goto", "error2", ";", "}</s>"], "docstring_tokens": ["issuing", "a", "KEYTCL_READ", "on", "negative", "key"]}
{"contents": ["SEC-1790:", "Disable", "use", "of", "spring-security-redirect", "by", "default", "for", "SimpleUrlLogoutSuccesshandler."], "code_tokens": ["*", "If", "a", "parameter", "matching", "the", "value", "of", "<", "tt", ">", "targetUrlParameter", "<", "/", "tt", ">", "has", "been", "set", "on", "the", "request", ",", "the", "value", "will", "be", "used", "*", "as", "the", "destination", ".", "By", "default", "this", "has", "the", "value", "\"", "spring", "-", "security", "-", "redirect", "\"", ".", "if", "(", "!", "StringUtils", ".", "hasText", "(", "targetUrlParameter", ")", ")", "{", "targetUrlParameter", "=", "null", ";", "}", "public", "SimpleUrlLogoutSuccessHandler", "(", ")", "{", "super", ".", "setTargetUrlParameter", "(", "null", ")", ";", "}</s>*", "If", "a", "parameter", "matching", "the", "<", "tt", ">", "targetUrlParameter", "<", "/", "tt", ">", "has", "been", "set", "on", "the", "request", ",", "the", "value", "will", "be", "used", "as", "*", "the", "destination", ".", "Assert", ".", "hasText", "(", "targetUrlParameter", ",", "\"", "targetUrlParameter", "cannot", "be", "null", "or", "empty", "\"", ");"], "docstring_tokens": ["via", "the", "spring-security-redirect", "parameter", "."]}
{"contents": ["mdesc:", "fix", "a", "missing-check", "bug", "in", "get_vdev_port_node_info()", "In", "get_vdev_port_node_info(),", "'node_info->vdev_port.name'", "is", "allcoated", "by", "kstrdup_const(),", "and", "it", "returns", "NULL", "when", "fails.", "So", "'node_info->vdev_port.name'", "should", "be", "checked.", "Signed-off-by:", "Gen", "Zhang", "<blackgod016574@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "node_info", "-", ">", "vdev_port", ".", "name", ")", "return", "-", "1", ";</s>"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["disallow", "proto", "keys"], "code_tokens": ["-", "windows", "-", "'", "12", "'", "-", "'", "11", "'", "-", "'", "10", "'", "#", "#", "Heads", "up", "!", "[", "Please", "update", "]", "[", "update", "]", "to", "version", "3", ".", "0", ".", "1", "or", "later", ",", "a", "critical", "bug", "was", "fixed", "in", "that", "version", ".", "const", "set", "=", "require", "(", "'{", "%=", "name", "%", "}'", ");", "const", "obj", "=", "{", "};", "If", "there", "are", "any", "regressions", "please", "create", "a", "[", "bug", "report", "]", "(.", "./", "..", "/", "issues", "/", "new", ")", ".", "Thanks", "!", "Copyright", "(", "c", ")", "2014", "-", "present", ",", "Jon", "Schlinkert", ".", "#", "set", "-", "value", "[", "![", "Donate", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "badge", "/", "Donate", "-", "PayPal", "-", "green", ".", "svg", ")", "](", "https", ":", "//", "www", ".", "paypal", ".", "com", "/", "cgi", "-", "bin", "/", "webscr", "?", "cmd", "=", "_s", "-", "xclick", "&", "hosted_button_id", "=", "W8YFZ425KND68", ")", "[", "![", "NPM", "version", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "npm", "/", "v", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", ")", "](", "https", ":", "//", "www", ".", "npmjs", ".", "com", "/", "package", "/", "set", "-", "value", ")", "[", "![", "NPM", "monthly", "downloads", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "npm", "/", "dm", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", ")", "](", "https", ":", "//", "npmjs", ".", "org", "/", "package", "/", "set", "-", "value", ")", "[", "![", "NPM", "total", "downloads", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "npm", "/", "dt", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", ")", "](", "https", ":", "//", "npmjs", ".", "org", "/", "package", "/", "set", "-", "value", ")", "[", "![", "Linux", "Build", "Status", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "travis", "/", "jonschlinkert", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", "&", "label", "=", "Travis", ")", "](", "https", ":", "//", "travis", "-", "ci", ".", "org", "/", "jonschlinkert", "/", "set", "-", "value", ")", "#", "#", "Heads", "up", "!", "[", "Please", "update", "]", "(", "https", ":", "//", "github", ".", "com", "/", "update", "/", "update", ")", "to", "version", "3", ".", "0", ".", "1", "or", "later", ",", "a", "critical", "bug", "was", "fixed", "in", "that", "version", ".", "const", "set", "=", "require", "(", "'", "set", "-", "value", "'", ");", "const", "obj", "=", "{", "};", "|", "*", "*", "Commits", "*", "*", "|", "*", "*", "Contributor", "*", "*", "|", "|", "-", "--", "|", "-", "--", "|", "|", "71", "|", "[", "jonschlinkert", "]", "(", "https", ":", "//", "github", ".", "com", "/", "jonschlinkert", ")", "|", "|", "2", "|", "[", "mbelsky", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mbelsky", ")", "|", "|", "1", "|", "[", "vadimdemedes", "]", "(", "https", ":", "//", "github", ".", "com", "/", "vadimdemedes", ")", "|", "|", "1", "|", "[", "wtgtybhertgeghgtwtg", "]", "(", "https", ":", "//", "github", ".", "com", "/", "wtgtybhertgeghgtwtg", ")", "|", "*", "[", "LinkedIn", "Profile", "]", "(", "https", ":", "//", "linkedin", ".", "com", "/", "in", "/", "jonschlinkert", ")", "Copyright", "\u00a9", "2019", ",", "[", "Jon", "Schlinkert", "]", "(", "https", ":", "//", "github", ".", "com", "/", "jonschlinkert", ")", ".", "_This", "file", "was", "generated", "by", "[", "verb", "-", "generate", "-", "readme", "]", "(", "https", ":", "//", "github", ".", "com", "/", "verbose", "/", "verb", "-", "generate", "-", "readme", ")", ",", "v0", ".", "8", ".", "0", ",", "on", "June", "19", ",", "2019", ".", "_", "const", "keys", "=", "(", "isArray", "?", "path", ":", "split", "(", "path", ",", "opts", ")", ").", "filter", "(", "isValidKey", ")", ";", "function", "isValidKey", "(", "key", ")", "{", "return", "key", "!", "==", "'", "__proto__", "'", "&", "&", "key", "!", "==", "'", "constructor", "'", "&", "&", "key", "!", "==", "'", "prototype", "'", ";", "}", "return", "val", "!", "==", "null", "&", "&", "(", "typeof", "val", "=", "==", "'", "object", "'", "|", "|", "typeof", "val", "=", "==", "'", "function", "'", ");", "\"", "gulp", "-", "format", "-", "md", "\"", ":", "\"", "^", "2", ".", "0", ".", "0", "\"", ",", "\"", "setvalue", "\"", ",", "\"", "split", "-", "string", "\"", ",", "\"", "update", "\"", "}</s>-", "linux", "-", "osx", "-", "node", "-", "'", "9", "'", "-", "'", "8", "'", "-", "'", "7", "'", "@", "@", "-", "1", ",", "7", "+", "1", ",", "11", "@", "@", "var", "set", "=", "require", "(", "'{", "%=", "name", "%", "}'", ");", "var", "obj", "=", "{", "};", "-", "Adds", "support", "for", "escaping", "with", "double", "or", "single", "quotes", ".", "See", "[", "escaping", "]", "(#", "escaping", ")", "for", "examples", ".", "-", "Will", "no", "longer", "split", "inside", "brackets", "or", "braces", ".", "See", "[", "bracket", "support", "]", "(#", "bracket", "-", "support", ")", "for", "examples", ".", "If", "there", "are", "any", "regressions", "please", "create", "a", "[", "bug", "report", "]", "(.", "./", "..", "/", "issues", "/", "new", ")", ".", "Thanks", "!", "Copyright", "(", "c", ")", "2014", "-", "2018", ",", "Jon", "Schlinkert", ".", "#", "set", "-", "value", "[", "![", "NPM", "version", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "npm", "/", "v", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", ")", "](", "https", ":", "//", "www", ".", "npmjs", ".", "com", "/", "package", "/", "set", "-", "value", ")", "[", "![", "NPM", "monthly", "downloads", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "npm", "/", "dm", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", ")", "](", "https", ":", "//", "npmjs", ".", "org", "/", "package", "/", "set", "-", "value", ")", "[", "![", "NPM", "total", "downloads", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "npm", "/", "dt", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", ")", "](", "https", ":", "//", "npmjs", ".", "org", "/", "package", "/", "set", "-", "value", ")", "[", "![", "Linux", "Build", "Status", "]", "(", "https", ":", "//", "img", ".", "shields", ".", "io", "/", "travis", "/", "jonschlinkert", "/", "set", "-", "value", ".", "svg", "?", "style", "=", "flat", "&", "label", "=", "Travis", ")", "](", "https", ":", "//", "travis", "-", "ci", ".", "org", "/", "jonschlinkert", "/", "set", "-", "value", ")", "var", "set", "=", "require", "(", "'", "set", "-", "value", "'", ");", "var", "obj", "=", "{", "};", "|", "*", "*", "Commits", "*", "*", "|", "*", "*", "Contributor", "*", "*", "|", "|", "-", "--", "|", "-", "--", "|", "|", "64", "|", "[", "jonschlinkert", "]", "(", "https", ":", "//", "github", ".", "com", "/", "jonschlinkert", ")", "|", "|", "1", "|", "[", "vadimdemedes", "]", "(", "https", ":", "//", "github", ".", "com", "/", "vadimdemedes", ")", "|", "|", "1", "|", "[", "wtgtybhertgeghgtwtg", "]", "(", "https", ":", "//", "github", ".", "com", "/", "wtgtybhertgeghgtwtg", ")", "|", "*", "[", "LinkedIn", "Profile", "]", "(", "https", ":", "//", "linkedin", ".", "com", "/", "in", "/", "jonschlinkert", ")", "Copyright", "\u00a9", "2018", ",", "[", "Jon", "Schlinkert", "]", "(", "https", ":", "//", "github", ".", "com", "/", "jonschlinkert", ")", ".", "_This", "file", "was", "generated", "by", "[", "verb", "-", "generate", "-", "readme", "]", "(", "https", ":", "//", "github", ".", "com", "/", "verbose", "/", "verb", "-", "generate", "-", "readme", ")", ",", "v0", ".", "6", ".", "0", ",", "on", "March", "05", ",", "2018", ".", "_", "const", "keys", "=", "isArray", "?", "path", ":", "split", "(", "path", ",", "opts", ")", ";", "switch", "(", "typeof", "val", ")", "{", "case", "'", "object", "'", ":", "return", "val", "!", "==", "null", ";", "case", "'", "function", "'", ":", "return", "true", ";", "default", ":", "{", "return", "false", ";", "}", "}", "\"", "gulp", "-", "format", "-", "md", "\"", ":", "\"", "^", "1", ".", "0", ".", "0", "\"", ",", "\"", "setvalue", "\"", "}"], "docstring_tokens": ["sending", "a", "specially-crafted", "request", "using", "a", "constructor", "payload"]}
{"contents": ["net:", "fix", "incorrect", "credentials", "passing", "Commit", "257b5358b32f", "(\"scm:", "Capture", "the", "full", "credentials", "of", "the", "scm", "sender\")", "changed", "the", "credentials", "passing", "code", "to", "pass", "in", "the", "effective", "uid/gid", "instead", "of", "the", "real", "uid/gid.", "Obviously", "this", "doesn't", "matter", "most", "of", "the", "time", "(since", "normally", "they", "are", "the", "same),", "but", "it", "results", "in", "differences", "for", "suid", "binaries", "when", "the", "wrong", "uid/gid", "ends", "up", "being", "used.", "This", "just", "undoes", "that", "(presumably", "unintentional)", "part", "of", "the", "commit.", "Reported-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Eric", "W.", "Biederman", "<ebiederm@xmission.com>", "Cc:", "Serge", "E.", "Hallyn", "<serge@hallyn.com>", "Cc:", "David", "S.", "Miller", "<davem@davemloft.net>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Acked-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["scm", "-", ">", "creds", ".", "uid", "=", "cred", "?", "cred", "-", ">", "uid", ":", "INVALID_UID", ";", "scm", "-", ">", "creds", ".", "gid", "=", "cred", "?", "cred", "-", ">", "gid", ":", "INVALID_GID", ";</s>scm", "-", ">", "creds", ".", "uid", "=", "cred", "?", "cred", "-", ">", "euid", ":", "INVALID_UID", ";", "scm", "-", ">", "creds", ".", "gid", "=", "cred", "?", "cred", "-", ">", "egid", ":", "INVALID_GID", ";"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Fix", "issues", "identified", "by", "CSW", "(#1561)"], "code_tokens": ["request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "StringUtils", ".", "escapeHTMLTags", "(", "cacheName", ")", "))", ");", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "alias", "}", "'/", ">\"", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "isTrustStore", "}", "'/", ">\"", "/>", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "var", "=", "\"", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "<", "title", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "title", "}", "\"/", "><", "/", "title", ">", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "search", "}", "'/", ">\"", "><", "/", "td", "></s>request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "cacheName", ")", "))", ";", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"$", "{", "param", ".", "alias", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"$", "{", "param", ".", "isTrustStore", "}", "\"/", ">", "<", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "</", "title", ">", "value", "=", "\"<", "%=", "((", "search", "!", "=", "null", ")", "?", "search", ":", "\"", "\")", "%>", "\">", "</", "td", ">"], "docstring_tokens": ["via", "alias", "to", "Manage", "Store", "Contents", "."]}
{"contents": ["Improve", "buffer", "flow", "sanity", "check"], "code_tokens": ["#", "include", "\"", "magick", "/", "memory", "-", "private", ".", "h", "\"", "if", "(", "HeapOverflowSanityCheck", "(", "rows", ",", "sizeof", "(", "*", "tile_pixels", ")", ")", "!", "=", "MagickFalse", ")", "tile_pixels", "=", "(", "uint32", "*", ")", "AcquireQuantumMemory", "(", "columns", ",", "rows", "*", "sizeof", "(", "*", "tile_pixels", ")", ");", "if", "(", "HeapOverflowSanityCheck", "(", "image", "-", ">", "rows", ",", "sizeof", "(", "*", "pixels", ")", ")", "!", "=", "MagickFalse", ")", "sizeof", "(", "*", "pixels", ")", ");</s>if", "(", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", ")", "!", "=", "(", "MagickSizeType", ")", "(", "(", "size_t", ")", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", "))", ")", "tile_pixels", "=", "(", "uint32", "*", ")", "AcquireQuantumMemory", "(", "number_pixels", ",", "sizeof", "(", "*", "tile_pixels", ")", ");", "if", "(", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", ")", "!", "=", "(", "MagickSizeType", ")", "(", "(", "size_t", ")", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", "))", ")", "sizeof", "(", "uint32", ")", ");"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially", "crafted", "file"]}
{"contents": ["DATACMNS-1282", "-", "Switched", "to", "SimpleEvaluationContext", "in", "MapDataBinder."], "code_tokens": ["import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "SimpleEvaluationContext", ";", "EvaluationContext", "context", "=", "SimpleEvaluationContext", "/", "/", ".", "forPropertyAccessors", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ")", "/", "/", ".", "withConversionService", "(", "conversionService", ")", "/", "/", ".", "withRootObject", "(", "map", ")", "/", "/", ".", "build", "(", ");", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";</s>import", "org", ".", "springframework", ".", "expression", ".", "EvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypeLocator", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelMessage", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardTypeConverter", ";", "private", "static", "final", "TypeLocator", "REJECTING_LOCATOR", "=", "new", "TypeLocator", "(", ")", "{", "@", "Override", "public", "Class", "<", "?>", "findType", "(", "String", "typeName", ")", "throws", "EvaluationException", "{", "throw", "new", "SpelEvaluationException", "(", "SpelMessage", ".", "TYPE_NOT_FOUND", ",", "typeName", ")", ";", "}", "}", ";", "StandardEvaluationContext", "context", "=", "new", "StandardEvaluationContext", "(", ");", "context", ".", "addPropertyAccessor", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ");", "context", ".", "setTypeConverter", "(", "new", "StandardTypeConverter", "(", "conversionService", ")", ");", "context", ".", "setTypeLocator", "(", "REJECTING_LOCATOR", ")", ";", "context", ".", "setRootObject", "(", "map", ")", ";", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";"], "docstring_tokens": ["sends", "a", "specially", "prepared", "form", "of", "a", "serialized", "object"]}
{"contents": ["Enforce", "the", "access", "token", "has", "an", "openid", "scope", "for", "the", "UserInfo", "endpoint", "(cherry", "picked", "from", "commit", "5e1a2a2257535e957b52ee721a81b741800a3171)"], "code_tokens": ["import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "common", ".", "OAuthPermission", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oidc", ".", "utils", ".", "OidcUtils", ";", "/", "/", "Check", "the", "access", "token", "has", "the", "\"", "openid", "\"", "scope", "if", "(", "!", "oauth", ".", "getPermissions", "(", ").", "stream", "(", ")", ".", "map", "(", "OAuthPermission", ":", ":", "getPermission", ")", ".", "anyMatch", "(", "OidcUtils", ".", "OPENID_SCOPE", ":", ":", "equals", ")", ")", "{", "Response", ".", "status", "(", "401", ")", ";", "}</s>"], "docstring_tokens": ["obtaining", "the", "authorization", "code", "issued", "to", "another", "client"]}
{"contents": ["[PATCH]", "fix", "memory", "corruption", "from", "misinterpreted", "bad_inode_ops", "return", "values", "is", "for", "a", "case", "where", "an", "inode", "can", "be", "marked", "bad,", "switching", "the", "ops", "to", "bad_inode_ops,", "which", "are", "all", "connected", "as:", "static", "int", "return_EIO(void)", "{", "return", "-EIO;", "}", "#define", "EIO_ERROR", "((void", "*)", "(return_EIO))", "static", "struct", "inode_operations", "bad_inode_ops", "=", "{", ".create", "=", "bad_inode_create", "...etc...", "The", "problem", "here", "is", "that", "the", "void", "cast", "causes", "return", "types", "to", "not", "be", "promoted,", "and", "for", "ops", "such", "as", "listxattr", "which", "expect", "more", "than", "32", "bits", "of", "return", "value,", "the", "32-bit", "-EIO", "is", "interpreted", "as", "a", "large", "positive", "64-bit", "number,", "i.e.", "0x00000000fffffffa", "instead", "of", "0xfffffffa.", "This", "goes", "particularly", "badly", "when", "the", "return", "value", "is", "taken", "as", "a", "number", "of", "bytes", "to", "copy", "into,", "say,", "a", "user's", "buffer", "for", "example...", "I", "originally", "had", "coded", "up", "the", "fix", "by", "creating", "a", "return_EIO_<TYPE>", "macro", "for", "each", "return", "type,", "like", "this:", "static", "int", "return_EIO_int(void)", "{", "return", "-EIO;", "}", "#define", "EIO_ERROR_INT", "((void", "*)", "(return_EIO_int))", "static", "struct", "inode_operations", "bad_inode_ops", "=", "{", ".create", "=", "EIO_ERROR_INT,", "...etc...", "but", "Al", "felt", "that", "it", "was", "probably", "better", "to", "create", "an", "EIO-returner", "for", "each", "actual", "op", "signature.", "Since", "so", "few", "ops", "share", "a", "signature,", "I", "just", "went", "ahead", "&", "created", "an", "EIO", "function", "for", "each", "individual", "file", "&", "inode", "op", "that", "returns", "a", "value.", "Signed-off-by:", "Eric", "Sandeen", "<sandeen@redhat.com>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["#", "include", "<", "linux", "/", "poll", ".", "h", ">", "static", "loff_t", "bad_file_llseek", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "int", "origin", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_read", "(", "struct", "file", "*", "filp", ",", "char", "__user", "*", "buf", ",", "size_t", "size", ",", "loff_t", "*", "ppos", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_write", "(", "struct", "file", "*", "filp", ",", "const", "char", "__user", "*", "buf", ",", "size_t", "siz", ",", "loff_t", "*", "ppos", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_aio_read", "(", "struct", "kiocb", "*", "iocb", ",", "const", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "nr_segs", ",", "loff_t", "pos", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_aio_write", "(", "struct", "kiocb", "*", "iocb", ",", "const", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "nr_segs", ",", "loff_t", "pos", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_readdir", "(", "struct", "file", "*", "filp", ",", "void", "*", "dirent", ",", "filldir_t", "filldir", ")", "{", "return", "-", "EIO", ";", "}", "static", "unsigned", "int", "bad_file_poll", "(", "struct", "file", "*", "filp", ",", "poll_table", "*", "wait", ")", "{", "return", "POLLERR", ";", "}", "static", "int", "bad_file_ioctl", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "return", "-", "EIO", ";", "}", "static", "long", "bad_file_unlocked_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "cmd", ",", "unsigned", "long", "arg", ")", "{", "return", "-", "EIO", ";", "}", "static", "long", "bad_file_compat_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_mmap", "(", "struct", "file", "*", "file", ",", "struct", "vm_area_struct", "*", "vma", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_flush", "(", "struct", "file", "*", "file", ",", "fl_owner_t", "id", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_release", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "filp", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_fsync", "(", "struct", "file", "*", "file", ",", "struct", "dentry", "*", "dentry", ",", "int", "datasync", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_aio_fsync", "(", "struct", "kiocb", "*", "iocb", ",", "int", "datasync", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_fasync", "(", "int", "fd", ",", "struct", "file", "*", "filp", ",", "int", "on", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_lock", "(", "struct", "file", "*", "file", ",", "int", "cmd", ",", "struct", "file_lock", "*", "fl", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_sendfile", "(", "struct", "file", "*", "in_file", ",", "loff_t", "*", "ppos", ",", "size_t", "count", ",", "read_actor_t", "actor", ",", "void", "*", "target", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_sendpage", "(", "struct", "file", "*", "file", ",", "struct", "page", "*", "page", ",", "int", "off", ",", "size_t", "len", ",", "loff_t", "*", "pos", ",", "int", "more", ")", "{", "return", "-", "EIO", ";", "}", "static", "unsigned", "long", "bad_file_get_unmapped_area", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "addr", ",", "unsigned", "long", "len", ",", "unsigned", "long", "pgoff", ",", "unsigned", "long", "flags", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_check_flags", "(", "int", "flags", ")", "static", "int", "bad_file_dir_notify", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "arg", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_file_flock", "(", "struct", "file", "*", "filp", ",", "int", "cmd", ",", "struct", "file_lock", "*", "fl", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_splice_write", "(", "struct", "pipe_inode_info", "*", "pipe", ",", "struct", "file", "*", "out", ",", "loff_t", "*", "ppos", ",", "size_t", "len", ",", "unsigned", "int", "flags", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_file_splice_read", "(", "struct", "file", "*", "in", ",", "loff_t", "*", "ppos", ",", "struct", "pipe_inode_info", "*", "pipe", ",", "size_t", "len", ",", "unsigned", "int", "flags", ")", "{", "return", "-", "EIO", ";", "}", ".", "llseek", "=", "bad_file_llseek", ",", ".", "read", "=", "bad_file_read", ",", ".", "write", "=", "bad_file_write", ",", ".", "aio_read", "=", "bad_file_aio_read", ",", ".", "aio_write", "=", "bad_file_aio_write", ",", ".", "readdir", "=", "bad_file_readdir", ",", ".", "poll", "=", "bad_file_poll", ",", ".", "ioctl", "=", "bad_file_ioctl", ",", ".", "unlocked_ioctl", "=", "bad_file_unlocked_ioctl", ",", ".", "compat_ioctl", "=", "bad_file_compat_ioctl", ",", ".", "mmap", "=", "bad_file_mmap", ",", ".", "open", "=", "bad_file_open", ",", ".", "flush", "=", "bad_file_flush", ",", ".", "release", "=", "bad_file_release", ",", ".", "fsync", "=", "bad_file_fsync", ",", ".", "aio_fsync", "=", "bad_file_aio_fsync", ",", ".", "fasync", "=", "bad_file_fasync", ",", ".", "lock", "=", "bad_file_lock", ",", ".", "sendfile", "=", "bad_file_sendfile", ",", ".", "sendpage", "=", "bad_file_sendpage", ",", ".", "get_unmapped_area", "=", "bad_file_get_unmapped_area", ",", ".", "check_flags", "=", "bad_file_check_flags", ",", ".", "dir_notify", "=", "bad_file_dir_notify", ",", ".", "flock", "=", "bad_file_flock", ",", ".", "splice_write", "=", "bad_file_splice_write", ",", ".", "splice_read", "=", "bad_file_splice_read", ",", "static", "int", "bad_inode_create", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ",", "int", "mode", ",", "struct", "nameidata", "*", "nd", ")", "{", "return", "-", "EIO", ";", "}", "static", "struct", "dentry", "*", "bad_inode_lookup", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ",", "struct", "nameidata", "*", "nd", ")", "{", "return", "ERR_PTR", "(", "-", "EIO", ")", ";", "}", "static", "int", "bad_inode_link", "(", "struct", "dentry", "*", "old_dentry", ",", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_unlink", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_symlink", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "symname", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_mkdir", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ",", "int", "mode", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_rmdir", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_mknod", "(", "struct", "inode", "*", "dir", ",", "struct", "dentry", "*", "dentry", ",", "int", "mode", ",", "dev_t", "rdev", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_rename", "(", "struct", "inode", "*", "old_dir", ",", "struct", "dentry", "*", "old_dentry", ",", "struct", "inode", "*", "new_dir", ",", "struct", "dentry", "*", "new_dentry", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_readlink", "(", "struct", "dentry", "*", "dentry", ",", "char", "__user", "*", "buffer", ",", "int", "buflen", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_permission", "(", "struct", "inode", "*", "inode", ",", "int", "mask", ",", "struct", "nameidata", "*", "nd", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_getattr", "(", "struct", "vfsmount", "*", "mnt", ",", "struct", "dentry", "*", "dentry", ",", "struct", "kstat", "*", "stat", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_setattr", "(", "struct", "dentry", "*", "direntry", ",", "struct", "iattr", "*", "attrs", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_setxattr", "(", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "name", ",", "const", "void", "*", "value", ",", "size_t", "size", ",", "int", "flags", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_inode_getxattr", "(", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "name", ",", "void", "*", "buffer", ",", "size_t", "size", ")", "{", "return", "-", "EIO", ";", "}", "static", "ssize_t", "bad_inode_listxattr", "(", "struct", "dentry", "*", "dentry", ",", "char", "*", "buffer", ",", "size_t", "buffer_size", ")", "{", "return", "-", "EIO", ";", "}", "static", "int", "bad_inode_removexattr", "(", "struct", "dentry", "*", "dentry", ",", "const", "char", "*", "name", ")", "{", "return", "-", "EIO", ";", "}", ".", "create", "=", "bad_inode_create", ",", ".", "lookup", "=", "bad_inode_lookup", ",", ".", "link", "=", "bad_inode_link", ",", ".", "unlink", "=", "bad_inode_unlink", ",", ".", "symlink", "=", "bad_inode_symlink", ",", ".", "mkdir", "=", "bad_inode_mkdir", ",", ".", "rmdir", "=", "bad_inode_rmdir", ",", ".", "mknod", "=", "bad_inode_mknod", ",", ".", "rename", "=", "bad_inode_rename", ",", ".", "readlink", "=", "bad_inode_readlink", ",", "/", "*", "put_link", "returns", "void", "*", "/", "/", "*", "truncate", "returns", "void", "*", "/", ".", "permission", "=", "bad_inode_permission", ",", ".", "getattr", "=", "bad_inode_getattr", ",", ".", "setattr", "=", "bad_inode_setattr", ",", ".", "setxattr", "=", "bad_inode_setxattr", ",", ".", "getxattr", "=", "bad_inode_getxattr", ",", ".", "listxattr", "=", "bad_inode_listxattr", ",", ".", "removexattr", "=", "bad_inode_removexattr", ",", "/", "*", "truncate_range", "returns", "void", "*", "/", "void", "make_bad_inode", "(", "struct", "inode", "*", "inode", ")", "int", "is_bad_inode", "(", "struct", "inode", "*", "inode", ")</s>static", "int", "return_EIO", "(", "void", ")", "#", "define", "EIO_ERROR", "(", "(", "void", "*", ")", "(", "return_EIO", ")", ")", ".", "llseek", "=", "EIO_ERROR", ",", ".", "aio_read", "=", "EIO_ERROR", ",", ".", "read", "=", "EIO_ERROR", ",", ".", "write", "=", "EIO_ERROR", ",", ".", "aio_write", "=", "EIO_ERROR", ",", ".", "readdir", "=", "EIO_ERROR", ",", ".", "poll", "=", "EIO_ERROR", ",", ".", "ioctl", "=", "EIO_ERROR", ",", ".", "mmap", "=", "EIO_ERROR", ",", ".", "open", "=", "EIO_ERROR", ",", ".", "flush", "=", "EIO_ERROR", ",", ".", "release", "=", "EIO_ERROR", ",", ".", "fsync", "=", "EIO_ERROR", ",", ".", "aio_fsync", "=", "EIO_ERROR", ",", ".", "fasync", "=", "EIO_ERROR", ",", ".", "lock", "=", "EIO_ERROR", ",", ".", "sendfile", "=", "EIO_ERROR", ",", ".", "sendpage", "=", "EIO_ERROR", ",", ".", "get_unmapped_area", "=", "EIO_ERROR", ",", ".", "create", "=", "EIO_ERROR", ",", ".", "lookup", "=", "EIO_ERROR", ",", ".", "link", "=", "EIO_ERROR", ",", ".", "unlink", "=", "EIO_ERROR", ",", ".", "symlink", "=", "EIO_ERROR", ",", ".", "mkdir", "=", "EIO_ERROR", ",", ".", "rmdir", "=", "EIO_ERROR", ",", ".", "mknod", "=", "EIO_ERROR", ",", ".", "rename", "=", "EIO_ERROR", ",", ".", "readlink", "=", "EIO_ERROR", ",", ".", "truncate", "=", "EIO_ERROR", ",", ".", "permission", "=", "EIO_ERROR", ",", ".", "getattr", "=", "EIO_ERROR", ",", ".", "setattr", "=", "EIO_ERROR", ",", ".", "setxattr", "=", "EIO_ERROR", ",", ".", "getxattr", "=", "EIO_ERROR", ",", ".", "listxattr", "=", "EIO_ERROR", ",", ".", "removexattr", "=", "EIO_ERROR", ",", "void", "make_bad_inode", "(", "struct", "inode", "*", "inode", ")", "int", "is_bad_inode", "(", "struct", "inode", "*", "inode", ")"], "docstring_tokens": ["via", "unknown", "vectors", "."]}
{"contents": ["random:", "fix", "bound", "check", "ordering", "(", ")", "If", "root", "raised", "the", "default", "wakeup", "threshold", "over", "the", "size", "of", "the", "output", "pool,", "the", "pool", "transfer", "function", "could", "overflow", "the", "stack", "with", "RNG", "bytes,", "causing", "a", "DoS", "or", "potential", "privilege", "escalation.", "(Bug", "reported", "by", "the", "PaX", "Team", "<pageexec@freemail.hu>)", "Cc:", "Theodore", "Tso", "<tytso@mit.edu>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Signed-off-by:", "Matt", "Mackall", "<mpm@selenic.com>", "Signed-off-by:", "Chris", "Wright", "<chrisw@sous-sol.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "If", "we", "'", "re", "limited", ",", "always", "leave", "two", "wakeup", "worth", "'", "s", "BITS", "*", "/", "int", "bytes", "=", "nbytes", ";", "/", "*", "pull", "at", "least", "as", "many", "as", "BYTES", "as", "wakeup", "BITS", "*", "/", "bytes", "=", "max_t", "(", "int", ",", "bytes", ",", "random_read_wakeup_thresh", "/", "8", ")", ";", "/", "*", "but", "never", "more", "than", "the", "buffer", "size", "*", "/", "bytes", "=", "min_t", "(", "int", ",", "bytes", ",", "sizeof", "(", "tmp", ")", ");</s>int", "bytes", "=", "max_t", "(", "int", ",", "random_read_wakeup_thresh", "/", "8", ",", "min_t", "(", "int", ",", "nbytes", ",", "sizeof", "(", "tmp", ")", "))", ";"], "docstring_tokens": ["by"]}
{"contents": ["Align", "behaviour", "for", "-ve", "stream", "timeouts", "with", "documentation", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@1852704", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["long", "writeTimeout", "=", "handler", ".", "getProtocol", "(", ").", "getStreamWriteTimeout", "(", ");", "if", "(", "writeTimeout", "<", "0", ")", "{", "wait", "(", ");", "}", "else", "{", "wait", "(", "writeTimeout", ")", ";", "}", "long", "readTimeout", "=", "handler", ".", "getProtocol", "(", ").", "getStreamReadTimeout", "(", ");", "if", "(", "readTimeout", "<", "0", ")", "{", "inBuffer", ".", "wait", "(", ");", "}", "else", "{", "inBuffer", ".", "wait", "(", "readTimeout", ")", ";", "}</s>wait", "(", "handler", ".", "getProtocol", "(", ").", "getStreamWriteTimeout", "(", "))", ";", "inBuffer", ".", "wait", "(", "handler", ".", "getProtocol", "(", ").", "getStreamReadTimeout", "(", "))", ";"], "docstring_tokens": ["sending", "excessive", "SETTINGS", "frames"]}
{"contents": ["HV-912", "Wrapping", "call", "to", "SchemaFactory#newSchema()", "into", "privileged", "action"], "code_tokens": ["/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", "*", "Copyright", "2010", ",", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", ",", "and", "individual", "contributors", "*", "by", "the", "@", "authors", "tag", ".", "See", "the", "copyright", ".", "txt", "in", "the", "distribution", "for", "a", "*", "full", "listing", "of", "individual", "contributors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "/", "**", "*", "Loads", "a", "given", "XML", "schema", ".", "*", "*", "@", "author", "Gunnar", "Morling", "*", "/", "public", "final", "class", "NewSchema", "implements", "PrivilegedExceptionAction", "<", "Schema", ">", "{", "private", "final", "SchemaFactory", "schemaFactory", ";", "private", "final", "URL", "url", ";", "public", "static", "NewSchema", "action", "(", "SchemaFactory", "schemaFactory", ",", "URL", "url", ")", "{", "return", "new", "NewSchema", "(", "schemaFactory", ",", "url", ")", ";", "}", "public", "NewSchema", "(", "SchemaFactory", "schemaFactory", ",", "URL", "url", ")", "{", "this", ".", "schemaFactory", "=", "schemaFactory", ";", "this", ".", "url", "=", "url", ";", "}", "@", "Override", "public", "Schema", "run", "(", ")", "throws", "SAXException", "{", "return", "schemaFactory", ".", "newSchema", "(", "url", ")", ";", "}", "}", "@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "java", ".", "security", ".", "PrivilegedExceptionAction", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "NewSchema", ";", "/", "**", "*", "Returns", "the", "XML", "schema", "identified", "by", "the", "given", "resource", "name", ".", "*", "*", "@", "param", "schemaResource", "*", "the", "resource", "name", "identifying", "the", "schema", ".", "*", "@", "return", "the", "schema", "identified", "by", "the", "given", "resource", "name", "or", "{", "@", "code", "null", "}", "if", "the", "resource", "was", "not", "found", "or", "could", "*", "not", "be", "loaded", ".", "*", "/", "if", "(", "schema", "!", "=", "null", ")", "{", "Schema", "previous", "=", "schemaCache", ".", "putIfAbsent", "(", "schemaResource", ",", "schema", ")", ";", "return", "previous", "!", "=", "null", "?", "previous", ":", "schema", ";", "}", "else", "{", "return", "null", ";", "}", "schema", "=", "run", "(", "NewSchema", ".", "action", "(", "sf", ",", "schemaUrl", ")", ")", ";", "catch", "(", "Exception", "e", ")", "{", "private", "<", "T", ">", "T", "run", "(", "PrivilegedExceptionAction", "<", "T", ">", "action", ")", "throws", "Exception", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}</s>import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "Schema", "previous", "=", "schemaCache", ".", "putIfAbsent", "(", "schemaResource", ",", "schema", ")", ";", "return", "previous", "!", "=", "null", "?", "previous", ":", "schema", ";", "schema", "=", "sf", ".", "newSchema", "(", "schemaUrl", ")", ";", "catch", "(", "SAXException", "e", ")", "{"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/120"], "code_tokens": ["ldblk", "+", "1", ",", "sizeof", "(", "*", "BImgBuff", ")", ");</s>ldblk", ",", "sizeof", "(", "*", "BImgBuff", ")", ");"], "docstring_tokens": ["via", "a", "crafted", "WPG", "file", "."]}
{"contents": ["Fix", "handling", "of", "unclosed", "interpolant", "in", "url", "Fixes", "#2661"], "code_tokens": ["if", "(", "!", "pp", ")", "return", "0", ";</s>"], "docstring_tokens": ["using", "a", "specially-crafted", "file"]}
{"contents": ["atm:", "fix", "info", "leak", "via", "getsockname()", "The", "ATM", "code", "fails", "to", "initialize", "the", "two", "padding", "bytes", "of", "struct", "sockaddr_atmpvc", "inserted", "for", "alignment.", "Add", "an", "explicit", "memset(0)", "before", "filling", "the", "structure", "to", "avoid", "the", "info", "leak.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "addr", ",", "0", ",", "sizeof", "(", "*", "addr", ")", ");</s>"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Fixed", "bug", "#68676", "(Explicit", "Double", "Free)"], "code_tokens": ["\ufeff", "PHP", "NEWS", ".", "Fixed", "bug", "#", "68676", "(", "Explicit", "Double", "Free", ")", ".", "(", "Kalle", ")", "tsrm_mutex_free", "(", "ht", "-", ">", "mx_writer", ")", ";</s>PHP", "NEWS", "-", "cURL", ":", "tsrm_mutex_free", "(", "ht", "-", ">", "mx_reader", ")", ";"], "docstring_tokens": ["via", "unknown", "vectors", "."]}
{"contents": ["proc:", "clean", "up", "and", "fix", "/proc/<pid>/mem", "handling", "J\u00fcri", "Aedla", "reported", "that", "the", "/proc/<pid>/mem", "handling", "really", "isn't", "very", "robust,", "and", "it", "also", "doesn't", "match", "the", "permission", "checking", "of", "any", "of", "the", "other", "related", "files.", "This", "changes", "it", "to", "do", "the", "permission", "checks", "at", "open", "time,", "and", "instead", "of", "tracking", "the", "process,", "it", "tracks", "the", "VM", "at", "the", "time", "of", "the", "open.", "That", "simplifies", "the", "code", "a", "lot,", "but", "does", "mean", "that", "if", "you", "hold", "the", "file", "descriptor", "open", "over", "an", "execve(),", "you'll", "continue", "to", "read", "from", "the", "_old_", "VM.", "That", "is", "different", "from", "our", "previous", "behavior,", "but", "much", "simpler.", "If", "somebody", "actually", "finds", "a", "load", "where", "this", "matters,", "we'll", "need", "to", "revert", "this", "commit.", "I", "suspect", "that", "nobody", "will", "ever", "notice", "-", "because", "the", "process", "mapping", "addresses", "will", "also", "have", "changed", "as", "part", "of", "the", "execve.", "So", "you", "cannot", "actually", "usefully", "access", "the", "fd", "across", "a", "VM", "change", "simply", "because", "all", "the", "offsets", "for", "IO", "would", "have", "changed", "too.", "Reported-by:", "J\u00fcri", "Aedla", "<asd@ut.ee>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["static", "struct", "mm_struct", "*", "mm_access", "(", "struct", "task_struct", "*", "task", ",", "unsigned", "int", "mode", ")", "!", "ptrace_may_access", "(", "task", ",", "mode", ")", ")", "{", "struct", "mm_struct", "*", "mm_for_maps", "(", "struct", "task_struct", "*", "task", ")", "{", "return", "mm_access", "(", "task", ",", "PTRACE_MODE_READ", ")", ";", "}", "struct", "task_struct", "*", "task", "=", "get_proc_task", "(", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "struct", "mm_struct", "*", "mm", ";", "if", "(", "!", "task", ")", "return", "-", "ESRCH", ";", "mm", "=", "mm_access", "(", "task", ",", "PTRACE_MODE_ATTACH", ")", ";", "put_task_struct", "(", "task", ")", ";", "if", "(", "IS_ERR", "(", "mm", ")", ")", "return", "PTR_ERR", "(", "mm", ")", ";", "file", "-", ">", "private_data", "=", "mm", ";", "int", "ret", ";", "struct", "mm_struct", "*", "mm", "=", "file", "-", ">", "private_data", ";", "if", "(", "!", "mm", ")", "return", "0", ";", "return", "-", "ENOMEM", ";", "struct", "mm_struct", "*", "mm", "=", "file", "-", ">", "private_data", ";", "if", "(", "!", "mm", ")", "return", "0", ";", "return", "-", "ENOMEM", ";", "static", "int", "mem_release", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "struct", "mm_struct", "*", "mm", "=", "file", "-", ">", "private_data", ";", "mmput", "(", "mm", ")", ";", "return", "0", ";", "}", ".", "release", "=", "mem_release", ",</s>static", "struct", "mm_struct", "*", "__check_mem_permission", "(", "struct", "task_struct", "*", "task", ")", "{", "struct", "mm_struct", "*", "mm", ";", "mm", "=", "get_task_mm", "(", "task", ")", ";", "if", "(", "!", "mm", ")", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "/", "*", "*", "A", "task", "can", "always", "look", "at", "itself", ",", "in", "case", "it", "chooses", "*", "to", "use", "system", "calls", "instead", "of", "load", "instructions", ".", "*", "/", "if", "(", "task", "=", "=", "current", ")", "return", "mm", ";", "/", "*", "*", "If", "current", "is", "actively", "ptrace", "'", "ing", ",", "and", "would", "also", "be", "*", "permitted", "to", "freshly", "attach", "with", "ptrace", "now", ",", "permit", "it", ".", "*", "/", "if", "(", "task_is_stopped_or_traced", "(", "task", ")", ")", "{", "int", "match", ";", "rcu_read_lock", "(", ");", "match", "=", "(", "ptrace_parent", "(", "task", ")", "=", "=", "current", ")", ";", "rcu_read_unlock", "(", ");", "if", "(", "match", "&", "&", "ptrace_may_access", "(", "task", ",", "PTRACE_MODE_ATTACH", ")", ")", "return", "mm", ";", "}", "/", "*", "*", "No", "one", "else", "is", "allowed", ".", "*", "/", "mmput", "(", "mm", ")", ";", "return", "ERR_PTR", "(", "-", "EPERM", ")", ";", "}", "/", "*", "*", "If", "current", "may", "access", "user", "memory", "in", "@", "task", "return", "a", "reference", "to", "the", "*", "corresponding", "mm", ",", "otherwise", "ERR_PTR", ".", "*", "/", "static", "struct", "mm_struct", "*", "check_mem_permission", "(", "struct", "task_struct", "*", "task", ")", "{", "struct", "mm_struct", "*", "mm", ";", "int", "err", ";", "/", "*", "*", "Avoid", "racing", "if", "task", "exec", "'", "s", "as", "we", "might", "get", "a", "new", "mm", "but", "validate", "*", "against", "old", "credentials", ".", "*", "/", "err", "=", "mutex_lock_killable", "(", "&", "task", "-", ">", "signal", "-", ">", "cred_guard_mutex", ")", ";", "if", "(", "err", ")", "return", "ERR_PTR", "(", "err", ")", ";", "mm", "=", "__check_mem_permission", "(", "task", ")", ";", "mutex_unlock", "(", "&", "task", "-", ">", "signal", "-", ">", "cred_guard_mutex", ")", ";", "return", "mm", ";", "}", "struct", "mm_struct", "*", "mm_for_maps", "(", "struct", "task_struct", "*", "task", ")", "!", "ptrace_may_access", "(", "task", ",", "PTRACE_MODE_READ", ")", ")", "{", "file", "-", ">", "private_data", "=", "(", "void", "*", ")(", "(", "long", ")", "current", "-", ">", "self_exec_id", ")", ";", "struct", "task_struct", "*", "task", "=", "get_proc_task", "(", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "int", "ret", "=", "-", "ESRCH", ";", "struct", "mm_struct", "*", "mm", ";", "if", "(", "!", "task", ")", "goto", "out_no_task", ";", "ret", "=", "-", "ENOMEM", ";", "goto", "out", ";", "mm", "=", "check_mem_permission", "(", "task", ")", ";", "ret", "=", "PTR_ERR", "(", "mm", ")", ";", "if", "(", "IS_ERR", "(", "mm", ")", ")", "goto", "out_free", ";", "ret", "=", "-", "EIO", ";", "if", "(", "file", "-", ">", "private_data", "!", "=", "(", "void", "*", ")(", "(", "long", ")", "current", "-", ">", "self_exec_id", ")", ")", "goto", "out_put", ";", "out_put", ":", "mmput", "(", "mm", ")", ";", "out_free", ":", "out", ":", "put_task_struct", "(", "task", ")", ";", "out_no_task", ":", "struct", "task_struct", "*", "task", "=", "get_proc_task", "(", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "struct", "mm_struct", "*", "mm", ";", "copied", "=", "-", "ESRCH", ";", "if", "(", "!", "task", ")", "goto", "out_no_task", ";", "copied", "=", "-", "ENOMEM", ";", "goto", "out_task", ";", "mm", "=", "check_mem_permission", "(", "task", ")", ";", "copied", "=", "PTR_ERR", "(", "mm", ")", ";", "if", "(", "IS_ERR", "(", "mm", ")", ")", "goto", "out_free", ";", "copied", "=", "-", "EIO", ";", "if", "(", "file", "-", ">", "private_data", "!", "=", "(", "void", "*", ")(", "(", "long", ")", "current", "-", ">", "self_exec_id", ")", ")", "goto", "out_mm", ";", "out_mm", ":", "mmput", "(", "mm", ")", ";", "out_free", ":", "out_task", ":", "put_task_struct", "(", "task", ")", ";", "out_no_task", ":"], "docstring_tokens": ["by", "modifying", "process", "memory"]}
{"contents": ["Fix", "bug", "#70976:", "fix", "boundary", "check", "on", "gdImageRotateInterpolated"], "code_tokens": ["-", "GD", ":", ".", "Fixed", "bug", "#", "70976", "(", "Memory", "Read", "via", "gdImageRotateInterpolated", "Array", "Index", "Out", "of", "Bounds", ")", ".", "(", "emmanuel", "dot", "law", "at", "gmail", "dot", "com", ")", ".", "if", "(", "bgcolor", "<", "0", "|", "|", "bgcolor", ">", "=", "gdMaxColors", ")", "{", "-", "-", "TEST", "-", "-", "Bug", "#", "70976", "(", "Memory", "Read", "via", "gdImageRotateInterpolated", "Array", "Index", "Out", "of", "Bounds", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "gd", "'", "))", "{", "die", "(", "'", "skip", "gd", "extension", "not", "available", "'", ");", "}", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "img", "=", "imagerotate", "(", "imagecreate", "(", "1", ",", "1", ")", ",", "45", ",", "0x7ffffff9", ")", ";", "var_dump", "(", "$", "img", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "bool", "(", "false", ")</s>-", "Phar", ":", "@", "@", "-", "2154", ",", "7", "+", "2154", ",", "7", "@", "@", "gdImagePtr", "gdImageRotateInterpolated", "(", "const", "gdImagePtr", "src", ",", "const", "float", "angle", ",", "in", "if", "(", "bgcolor", "<", "0", ")", "{"], "docstring_tokens": ["via", "a", "large", "bgd_color", "argument", "to", "the", "imagerotate", "function", "."]}
{"contents": ["[media]", "v4l:", "Share", "code", "between", "video_usercopy", "and", "video_ioctl2", "The", "two", "functions", "are", "mostly", "identical.", "They", "handle", "the", "copy_from_user", "and", "copy_to_user", "operations", "related", "with", "V4L2", "ioctls", "and", "call", "the", "real", "ioctl", "handler.", "Create", "a", "__video_usercopy", "function", "that", "implements", "the", "core", "of", "video_usercopy", "and", "video_ioctl2,", "and", "call", "that", "function", "from", "both.", "Signed-off-by:", "Laurent", "Pinchart", "<laurent.pinchart@ideasonboard.com>", "Acked-by:", "Hans", "Verkuil", "<hverkuil@xs4all.nl>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@redhat.com>"], "code_tokens": ["long", "video_usercopy", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ",", "v4l2_kioctl", "func", ")", "err", "=", "func", "(", "file", ",", "cmd", ",", "parg", ")", ";", "EXPORT_SYMBOL", "(", "video_usercopy", ")", ";", "long", "video_ioctl2", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "return", "video_usercopy", "(", "file", ",", "cmd", ",", "arg", ",", "__video_do_ioctl", ")", ";", "}</s>/", "*", "*", "helper", "function", "-", "-", "handles", "userspace", "copying", "for", "ioctl", "arguments", "*", "Obsolete", "usercopy", "function", "-", "Should", "be", "removed", "soon", "*", "/", "long", "video_usercopy", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ",", "v4l2_kioctl", "func", ")", "{", "char", "sbuf", "[", "128", "]", ";", "void", "*", "mbuf", "=", "NULL", ";", "void", "*", "parg", "=", "NULL", ";", "long", "err", "=", "-", "EINVAL", ";", "int", "is_ext_ctrl", ";", "size_t", "ctrls_size", "=", "0", ";", "void", "__user", "*", "user_ptr", "=", "NULL", ";", "is_ext_ctrl", "=", "(", "cmd", "=", "=", "VIDIOC_S_EXT_CTRLS", "|", "|", "cmd", "=", "=", "VIDIOC_G_EXT_CTRLS", "|", "|", "cmd", "=", "=", "VIDIOC_TRY_EXT_CTRLS", ")", ";", "/", "*", "Copy", "arguments", "into", "temp", "kernel", "buffer", "*", "/", "switch", "(", "_IOC_DIR", "(", "cmd", ")", ")", "{", "case", "_IOC_NONE", ":", "parg", "=", "NULL", ";", "break", ";", "case", "_IOC_READ", ":", "case", "_IOC_WRITE", ":", "case", "(", "_IOC_WRITE", "|", "_IOC_READ", ")", ":", "if", "(", "_IOC_SIZE", "(", "cmd", ")", "<", "=", "sizeof", "(", "sbuf", ")", ")", "{", "parg", "=", "sbuf", ";", "}", "else", "{", "/", "*", "too", "big", "to", "allocate", "from", "stack", "*", "/", "mbuf", "=", "kmalloc", "(", "_IOC_SIZE", "(", "cmd", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "NULL", "=", "=", "mbuf", ")", "return", "-", "ENOMEM", ";", "parg", "=", "mbuf", ";", "}", "err", "=", "-", "EFAULT", ";", "if", "(", "_IOC_DIR", "(", "cmd", ")", "&", "_IOC_WRITE", ")", "if", "(", "copy_from_user", "(", "parg", ",", "(", "void", "__user", "*", ")", "arg", ",", "_IOC_SIZE", "(", "cmd", ")", "))", "goto", "out", ";", "break", ";", "}", "if", "(", "is_ext_ctrl", ")", "{", "struct", "v4l2_ext_controls", "*", "p", "=", "parg", ";", "/", "*", "In", "case", "of", "an", "error", ",", "tell", "the", "caller", "that", "it", "wasn", "'", "t", "a", "specific", "control", "that", "caused", "it", ".", "*", "/", "p", "-", ">", "error_idx", "=", "p", "-", ">", "count", ";", "user_ptr", "=", "(", "void", "__user", "*", ")", "p", "-", ">", "controls", ";", "if", "(", "p", "-", ">", "count", ")", "{", "ctrls_size", "=", "sizeof", "(", "struct", "v4l2_ext_control", ")", "*", "p", "-", ">", "count", ";", "/", "*", "Note", ":", "v4l2_ext_controls", "fits", "in", "sbuf", "[", "]", "so", "mbuf", "is", "still", "NULL", ".", "*", "/", "mbuf", "=", "kmalloc", "(", "ctrls_size", ",", "GFP_KERNEL", ")", ";", "err", "=", "-", "ENOMEM", ";", "if", "(", "NULL", "=", "=", "mbuf", ")", "goto", "out_ext_ctrl", ";", "err", "=", "-", "EFAULT", ";", "if", "(", "copy_from_user", "(", "mbuf", ",", "user_ptr", ",", "ctrls_size", ")", ")", "goto", "out_ext_ctrl", ";", "p", "-", ">", "controls", "=", "mbuf", ";", "}", "}", "/", "*", "call", "driver", "*", "/", "err", "=", "func", "(", "file", ",", "cmd", ",", "parg", ")", ";", "if", "(", "err", "=", "=", "-", "ENOIOCTLCMD", ")", "err", "=", "-", "EINVAL", ";", "if", "(", "is_ext_ctrl", ")", "{", "struct", "v4l2_ext_controls", "*", "p", "=", "parg", ";", "p", "-", ">", "controls", "=", "(", "void", "*", ")", "user_ptr", ";", "if", "(", "p", "-", ">", "count", "&", "&", "err", "=", "=", "0", "&", "&", "copy_to_user", "(", "user_ptr", ",", "mbuf", ",", "ctrls_size", ")", ")", "err", "=", "-", "EFAULT", ";", "goto", "out_ext_ctrl", ";", "}", "if", "(", "err", "<", "0", ")", "goto", "out", ";", "out_ext_ctrl", ":", "/", "*", "Copy", "results", "into", "user", "buffer", "*", "/", "switch", "(", "_IOC_DIR", "(", "cmd", ")", ")", "{", "case", "_IOC_READ", ":", "case", "(", "_IOC_WRITE", "|", "_IOC_READ", ")", ":", "if", "(", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "parg", ",", "_IOC_SIZE", "(", "cmd", ")", "))", "err", "=", "-", "EFAULT", ";", "break", ";", "}", "out", ":", "kfree", "(", "mbuf", ")", ";", "return", "err", ";", "}", "EXPORT_SYMBOL", "(", "video_usercopy", ")", ";", "long", "video_ioctl2", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "err", "=", "__video_do_ioctl", "(", "file", ",", "cmd", ",", "parg", ")", ";"], "docstring_tokens": ["using", "a", "large", "value", "of", "a", "v4l2_ext_controls", "data", "structure"]}
{"contents": ["Limit", "CGI", "command", "line", "arguments", "Limit", "the", "decoded", "form", "of", "individual", "command", "line", "arguments.", "This", "is", "to", "work", "various", "issues", "passing", "command", "line", "arguments", "from", "Java", "to", "the", "OS", "on", "Windows.", "This", "restriction", "may", "be", "overridden", "by", "the", "new", "initialisation", "parameter", "cmdLineArgumentsDecoded.", "This", "is", "the", "fix", "for", "."], "code_tokens": ["<", "!-", "-", "cmdLineArgumentsDecoded", "-", "->", "<", "!-", "-", "Only", "used", "when", "enableCmdLineArguments", "is", "-", "->", "<", "!-", "-", "true", ".", "The", "pattern", "that", "individual", "decoded", "-", "->", "<", "!-", "-", "command", "line", "arguments", "must", "match", "else", "the", "-", "->", "<", "!-", "-", "request", "will", "be", "rejected", ".", "This", "is", "to", "-", "->", "<", "!-", "-", "work", "-", "around", "various", "issues", "when", "Java", "passes", "-", "->", "<", "!-", "-", "the", "arguments", "to", "the", "OS", ".", "See", "the", "CGI", "How", "-", "To", "-", "->", "<", "!-", "-", "for", "more", "details", ".", "The", "default", "varies", "by", "-", "->", "<", "!-", "-", "platform", ".", "-", "->", "<", "!-", "-", "Windows", ":", "[", "[", "a", "-", "zA", "-", "Z0", "-", "9", "\\", "Q", "-", "_", ".", "\\\\", "/:", "\\", "E", "]", "+]", "-", "->", "<", "!-", "-", "Others", ":", "[", ".*", "]", "-", "->", "<", "!-", "-", "Note", "that", "internally", "the", "CGI", "Servlet", "treats", "-", "->", "<", "!-", "-", "[", ".*", "]", "as", "a", "special", "case", "to", "improve", "performance", "-", "->", "<", "!-", "-", "-", "->", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JrePlatform", ";", "private", "static", "final", "Pattern", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", ";", "private", "static", "final", "String", "ALLOW_ANY_PATTERN", "=", "\"", ".*", "\";", "if", "(", "JrePlatform", ".", "IS_WINDOWS", ")", "{", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9", "\\", "\\", "Q", "-", "_", ".", "\\\\", "/:", "\\\\", "E", "]", "+\"", ");", "}", "else", "{", "/", "/", "No", "restrictions", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", "=", "null", ";", "}", "/", "**", "*", "Limits", "the", "decoded", "form", "of", "individual", "command", "line", "arguments", ".", "Default", "*", "varies", "by", "platform", ".", "*", "/", "private", "Pattern", "cmdLineArgumentsDecodedPattern", "=", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", ";", "String", "value", "=", "getServletConfig", "(", ").", "getInitParameter", "(", "\"", "cmdLineArgumentsDecoded", "\"", ");", "if", "(", "ALLOW_ANY_PATTERN", ".", "equals", "(", "value", ")", ")", "{", "/", "/", "Optimisation", "for", "case", "where", "anything", "is", "allowed", "cmdLineArgumentsDecodedPattern", "=", "null", ";", "}", "else", "if", "(", "value", "!", "=", "null", ")", "{", "cmdLineArgumentsDecodedPattern", "=", "Pattern", ".", "compile", "(", "value", ")", ";", "}", "if", "(", "cmdLineArgumentsDecodedPattern", "!", "=", "null", "&", "&", "!", "cmdLineArgumentsDecodedPattern", ".", "matcher", "(", "decodedArgument", ")", ".", "matches", "(", "))", "{", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "{", "log", ".", "debug", "(", "sm", ".", "getString", "(", "\"", "cgiServlet", ".", "invalidArgumentDecoded", "\"", ",", "decodedArgument", ",", "cmdLineArgumentsDecodedPattern", ".", "toString", "(", "))", ");", "}", "return", "false", ";", "}", "cgiServlet", ".", "invalidArgumentDecoded", "=", "The", "decoded", "command", "line", "argument", "[", "{", "0", "}", "]", "did", "not", "match", "the", "configured", "cmdLineArgumentsDecoded", "pattern", "[", "{", "1", "}", "]", "<", "li", ">", "<", "strong", ">", "cmdLineArgumentsDecoded", "<", "/", "strong", ">", "-", "If", "command", "line", "argumemnts", "are", "enabled", "(", "via", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", ")", "and", "Tomcat", "is", "running", "on", "Windows", "then", "each", "individual", "decoded", "command", "line", "argument", "must", "match", "this", "pattern", "else", "the", "request", "will", "be", "rejected", ".", "This", "is", "to", "protect", "against", "known", "issues", "passing", "command", "line", "arguments", "from", "Java", "to", "Windows", ".", "These", "issues", "can", "lead", "to", "remote", "code", "execution", ".", "For", "more", "information", "on", "these", "issues", "see", "<", "a", "href", "=", "\"", "https", ":", "//", "codewhitesec", ".", "blogspot", ".", "com", "/", "2016", "/", "02", "/", "java", "-", "and", "-", "command", "-", "line", "-", "injections", "-", "in", "-", "windows", ".", "html", "\"", ">", "Markus", "Wulftange", "&", "apos", ";", "s", "blog", "<", "/", "a", ">", "and", "this", "archived", "<", "a", "href", "=", "\"", "https", ":", "//", "web", ".", "archive", ".", "org", "/", "web", "/", "20161228144344", "/", "https", ":", "//", "blogs", ".", "msdn", ".", "microsoft", ".", "com", "/", "twistylittlepassagesallalike", "/", "2011", "/", "04", "/", "23", "/", "everyone", "-", "quotes", "-", "command", "-", "line", "-", "arguments", "-", "the", "-", "wrong", "-", "way", "/", "\">", "blog", "by", "Daniel", "Colascione", "<", "/", "a", ">", ".<", "/", "li", ">", "<", "li", ">", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", "-", "Are", "command", "line", "arguments", "<", "add", ">", "When", "the", "CGI", "Servlet", "is", "configured", "with", "<", "code", ">", "enableCmdLineArguments", "<", "/", "code", ">", "set", "to", "true", ",", "limit", "the", "decoded", "form", "of", "the", "individual", "command", "line", "arguments", "to", "known", "safe", "values", "when", "running", "on", "Windows", ".", "This", "restriction", "may", "be", "relaxed", "by", "the", "use", "of", "the", "new", "initialisation", "parameter", "<", "code", ">", "cmdLineArgumentsDecoded", "<", "/", "code", ">", ".", "This", "is", "the", "fix", "for", "CVE", "-", "2019", "-", "0232", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "p", ">", "When", "using", "the", "CGI", "Servlet", "on", "Windows", "with", "<", "code", ">", "enableCmdLineArguments", "<", "/", "code", ">", "enabled", ",", "review", "the", "setting", "of", "<", "code", ">", "cmdLineArgumentsDecoded", "<", "/", "code", ">", "carefully", "and", "ensure", "that", "it", "is", "appropriate", "for", "your", "environment", ".", "The", "default", "value", "is", "secure", ".", "Insecure", "configurations", "may", "expose", "the", "server", "to", "remote", "code", "execution", ".", "Further", "information", "on", "the", "potential", "risks", "and", "mitigations", "may", "be", "found", "by", "following", "the", "links", "in", "the", "<", "a", "href", "=", "\"", "cgi", "-", "howto", ".", "html", "\"", ">", "CGI", "How", "To", "<", "/", "a", ">", ".<", "/", "p", "></s><", "li", ">", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", "-", "Are", "command", "line", "parameters"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["vfs:", "Carefully", "propogate", "mounts", "across", "user", "namespaces", "As", "a", "matter", "of", "policy", "MNT_READONLY", "should", "not", "be", "changable", "if", "the", "original", "mounter", "had", "more", "privileges", "than", "creator", "of", "the", "mount", "namespace.", "Add", "the", "flag", "CL_UNPRIVILEGED", "to", "note", "when", "we", "are", "copying", "a", "mount", "from", "a", "mount", "namespace", "that", "requires", "more", "privileges", "to", "a", "mount", "namespace", "that", "requires", "fewer", "privileges.", "When", "the", "CL_UNPRIVILEGED", "flag", "is", "set", "cause", "clone_mnt", "to", "set", "MNT_NO_REMOUNT", "if", "any", "of", "the", "mnt", "flags", "that", "should", "never", "be", "changed", "are", "set.", "This", "protects", "both", "mount", "propagation", "and", "the", "initial", "creation", "of", "a", "less", "privileged", "mount", "namespace.", "Cc:", "stable@vger.kernel.org", "Acked-by:", "Serge", "Hallyn", "<serge.hallyn@canonical.com>", "Reported-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>"], "code_tokens": ["/", "*", "Don", "'", "t", "allow", "unprivileged", "users", "to", "change", "mount", "flags", "*", "/", "if", "(", "(", "flag", "&", "CL_UNPRIVILEGED", ")", "&", "&", "(", "mnt", "-", ">", "mnt", ".", "mnt_flags", "&", "MNT_READONLY", ")", ")", "mnt", "-", ">", "mnt", ".", "mnt_flags", "|", "=", "MNT_LOCK_READONLY", ";", "copy_flags", "|", "=", "CL_SHARED_TO_SLAVE", "|", "CL_UNPRIVILEGED", ";", "#", "include", "<", "linux", "/", "nsproxy", ".", "h", ">", "struct", "user_namespace", "*", "user_ns", "=", "current", "-", ">", "nsproxy", "-", ">", "mnt_ns", "-", ">", "user_ns", ";", "/", "*", "Notice", "when", "we", "are", "propagating", "across", "user", "namespaces", "*", "/", "if", "(", "m", "-", ">", "mnt_ns", "-", ">", "user_ns", "!", "=", "user_ns", ")", "type", "|", "=", "CL_UNPRIVILEGED", ";", "#", "define", "CL_UNPRIVILEGED", "0x40</s>copy_flags", "|", "=", "CL_SHARED_TO_SLAVE", ";"], "docstring_tokens": ["by", "leveraging", "a", "separate", "mount", "namespace", "."]}
{"contents": ["Merge", "pull", "request", "#4031", "from", "abacusresearch/KEYCLOAK-4736_http_header_x-xss-protection", "KEYCLOAK-4736", "Extend", "security", "defenses", "with", "X-XSS-Protection", "header"], "code_tokens": ["browserSecurityHeaders", ".", "put", "(", "\"", "xXSSProtection", "\"", ",", "\"", "1", ";", "mode", "=", "block", "\"", ");", "headerMap", ".", "put", "(", "\"", "xXSSProtection", "\"", ",", "\"", "X", "-", "XSS", "-", "Protection", "\"", ");", "dh", ".", "put", "(", "\"", "xXSSProtection", "\"", ",", "\"", "1", ";", "mode", "=", "block", "\"", ");", "x", "-", "xss", "-", "protection", "=", "X", "-", "XSS", "-", "Protection", "x", "-", "xss", "-", "protection", "-", "tooltip", "=", "This", "header", "configures", "the", "Cross", "-", "site", "scripting", "(", "XSS", ")", "filter", "in", "your", "browser", ".", "Using", "the", "default", "behavior", ",", "the", "browser", "will", "prevent", "rendering", "of", "the", "page", "when", "a", "XSS", "attack", "is", "detected", "(", "click", "label", "for", "more", "information", ")", "<", "div", "class", "=", "\"", "form", "-", "group", "\"", ">", "<", "label", "class", "=", "\"", "col", "-", "md", "-", "2", "control", "-", "label", "\"", "for", "=", "\"", "xXSSProtection", "\"", "><", "a", "href", "=", "\"", "https", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "OWASP_Secure_Headers_Project", "#", "xxxsp", "\"", "target", "=", "\"", "_blank", "\"", ">{", "{:", ":", "'", "x", "-", "xss", "-", "protection", "'", "|", "translate", "}", "}<", "/", "a", ">", "</", "label", ">", "<", "div", "class", "=", "\"", "col", "-", "sm", "-", "6", "\"", ">", "<", "input", "class", "=", "\"", "form", "-", "control", "\"", "id", "=", "\"", "xXSSProtection", "\"", "type", "=", "\"", "text", "\"", "ng", "-", "model", "=", "\"", "realm", ".", "browserSecurityHeaders", ".", "xXSSProtection", "\"", ">", "<", "/", "div", ">", "<", "kc", "-", "tooltip", ">", "{{", "::", "'", "x", "-", "xss", "-", "protection", "-", "tooltip", "'", "|", "translate", "}", "}<", "/", "kc", "-", "tooltip", ">", "<", "/", "div", "></s>"], "docstring_tokens": ["via", "a", "malicious", "server", "."]}
{"contents": ["LPS-97029", "Add", "the", "logic", "to", "check", "for", "whitelisted", "classes", "We", "don't", "need", "to", "check", "for", "whitelisted", "classes", "when:", "-", "The", "requested", "type", "is", "not", "assignable", "to", "the", "target", "type", "-", "The", "type", "matches", "the", "actual", "target", "type", "-", "The", "type", "is", "a", "translation", "from", "a", "model", "interface", "to", "a", "model", "implementation", "in", "other", "cases,", "when", "the", "requested", "type", "is", "a", "subclass", "or", "an", "implementation", "of", "an", "interface", "as", "the", "target", "type,", "the", "class", "needs", "to", "be", "whitelisted."], "code_tokens": ["import", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "util", ".", "ArrayUtil", ";", "import", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "util", ".", "PropsKeys", ";", "import", "com", ".", "liferay", ".", "portal", ".", "util", ".", "PropsUtil", ";", "import", "java", ".", "util", ".", "Objects", ";", "private", "void", "_checkTypeIsAssignable", "(", "int", "argumentPos", ",", "Class", "<", "?>", "targetClass", ",", "Class", "<", "?>", "parameterType", ")", "{", "if", "(", "Objects", ".", "equals", "(", "targetClass", ",", "parameterType", ")", ")", "{", "return", ";", "}", "String", "parameterTypeName", "=", "parameterType", ".", "getName", "(", ");", "if", "(", "!", "ReflectUtil", ".", "isTypeOf", "(", "parameterType", ",", "targetClass", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "StringBundler", ".", "concat", "(", "\"", "Unmatched", "argument", "type", "\"", ",", "parameterTypeName", ",", "\"", "for", "method", "argument", "\"", ",", "argumentPos", ")", ");", "}", "if", "(", "parameterTypeName", ".", "equals", "(", "_jsonWebServiceNaming", ".", "convertModelClassToImplClassName", "(", "targetClass", ")", "))", "{", "return", ";", "}", "if", "(", "ArrayUtil", ".", "contains", "(", "_JSONWS_WEB_SERVICE_PARAMETER_TYPE_WHITELIST_CLASS_NAMES", ",", "parameterTypeName", ")", ")", "{", "return", ";", "}", "throw", "new", "TypeConversionException", "(", "parameterTypeName", "+", "\"", "is", "not", "allowed", "to", "be", "instantiated", "\"", ");", "}", "Class", "<", "?>", "targetClass", "=", "methodParameters", "[", "i", "]", ".", "getType", "(", ");", "Class", "<", "?>", "parameterType", "=", "targetClass", ";", "_checkTypeIsAssignable", "(", "i", ",", "targetClass", ",", "parameterType", ")", ";", "private", "static", "final", "String", "[", "]", "_JSONWS_WEB_SERVICE_PARAMETER_TYPE_WHITELIST_CLASS_NAMES", "=", "PropsUtil", ".", "getArray", "(", "PropsKeys", ".", "JSONWS_WEB_SERVICE_PARAMETER_TYPE_WHITELIST_CLASS_NAMES", ")", ";</s>Class", "<", "?>", "parameterType", "=", "methodParameters", "[", "i", "]", ".", "getType", "(", ");", "if", "(", "!", "ReflectUtil", ".", "isTypeOf", "(", "parameterType", ",", "methodParameters", "[", "i", "]", ".", "getType", "(", "))", ")", "{", "throw", "new", "IllegalArgumentException", "(", "StringBundler", ".", "concat", "(", "\"", "Unmatched", "argument", "type", "\"", ",", "parameterType", ".", "getName", "(", "),", "\"", "for", "method", "argument", "\"", ",", "i", ")", ");", "}"], "docstring_tokens": ["sending", "specially-crafted", "request"]}
{"contents": ["WELD-1802", "RequestScopedCache", "-", "Make", "sure", "each", "request", "is", "ended", "before", "a", "new", "one", "is", "started"], "code_tokens": ["/", "/", "if", "the", "previous", "request", "was", "not", "ended", "properly", "for", "some", "reason", ",", "make", "sure", "it", "is", "ended", "now", "endRequest", "(", ");", "CACHE", ".", "remove", "(", ");</s>CACHE", ".", "remove", "(", ");"], "docstring_tokens": ["via", "vectors", "related", "to", "a", "stale", "thread", "state", "."]}
{"contents": ["userfaultfd:", "non-cooperative:", "fix", "fork", "use", "after", "free", "When", "reading", "the", "event", "from", "the", "uffd,", "we", "put", "it", "on", "a", "temporary", "fork_event", "list", "to", "detect", "if", "we", "can", "still", "access", "it", "after", "releasing", "and", "retaking", "the", "event_wqh.lock.", "If", "fork", "aborts", "and", "removes", "the", "event", "from", "the", "fork_event", "all", "is", "fine", "as", "long", "as", "we're", "still", "in", "the", "userfault", "read", "context", "and", "fork_event", "head", "is", "still", "alive.", "We've", "to", "put", "the", "event", "allocated", "in", "the", "fork", "kernel", "stack,", "back", "from", "fork_event", "list-head", "to", "the", "event_wqh", "head,", "before", "returning", "from", "userfaultfd_ctx_read,", "because", "the", "fork_event", "head", "lifetime", "is", "limited", "to", "the", "userfaultfd_ctx_read", "stack", "lifetime.", "Forgetting", "to", "move", "the", "event", "back", "to", "its", "event_wqh", "place", "then", "results", "in", "__remove_wait_queue(&ctx->event_wqh,", "&ewq->wq);", "in", "userfaultfd_event_wait_completion", "to", "remove", "it", "from", "a", "head", "that", "has", "been", "already", "freed", "from", "the", "reader", "stack.", "This", "could", "only", "happen", "if", "resolve_userfault_fork", "failed", "(for", "example", "if", "there", "are", "no", "file", "descriptors", "available", "to", "allocate", "the", "fork", "uffd).", "If", "it", "succeeded", "it", "was", "put", "back", "correctly.", "Furthermore,", "after", "find_userfault_evt", "receives", "a", "fork", "event,", "the", "forked", "userfault", "context", "in", "fork_nctx", "and", "uwq->msg.arg.reserved.reserved1", "can", "be", "released", "by", "the", "fork", "thread", "as", "soon", "as", "the", "event_wqh.lock", "is", "released.", "Taking", "a", "reference", "on", "the", "fork_nctx", "before", "dropping", "the", "lock", "prevents", "an", "use", "after", "free", "in", "resolve_userfault_fork().", "If", "the", "fork", "side", "aborted", "and", "it", "already", "released", "everything,", "we", "still", "try", "to", "succeed", "resolve_userfault_fork(),", "if", "possible.", "Fixes:", "893e26e61d04eac9", "(\"userfaultfd:", "non-cooperative:", "Add", "fork()", "event\")", "Link:", "http://lkml.kernel.org/r/20170920180413.26713-1-aarcange@redhat.com", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Reported-by:", "Mark", "Rutland", "<mark.rutland@arm.com>", "Tested-by:", "Mark", "Rutland", "<mark.rutland@arm.com>", "Cc:", "Pavel", "Emelyanov", "<xemul@virtuozzo.com>", "Cc:", "Mike", "Rapoport", "<rppt@linux.vnet.ibm.com>", "Cc:", "\"Dr.", "David", "Alan", "Gilbert\"", "<dgilbert@redhat.com>", "Cc:", "Mike", "Kravetz", "<mike.kravetz@oracle.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "*", "&", "ewq", "-", ">", "wq", "may", "be", "queued", "in", "fork_event", ",", "but", "*", "__remove_wait_queue", "ignores", "the", "head", "*", "parameter", ".", "It", "would", "be", "a", "problem", "if", "it", "*", "didn", "'", "t", ".", "*", "/", "/", "*", "*", "fork_nctx", "can", "be", "freed", "as", "soon", "as", "*", "we", "drop", "the", "lock", ",", "unless", "we", "take", "a", "*", "reference", "on", "it", ".", "*", "/", "userfaultfd_ctx_get", "(", "fork_nctx", ")", ";", "spin_lock", "(", "&", "ctx", "-", ">", "event_wqh", ".", "lock", ")", ";", "if", "(", "!", "list_empty", "(", "&", "fork_event", ")", ")", "{", "/", "*", "*", "The", "fork", "thread", "didn", "'", "t", "abort", ",", "so", "we", "can", "*", "drop", "the", "temporary", "refcount", ".", "*", "/", "userfaultfd_ctx_put", "(", "fork_nctx", ")", ";", "uwq", "=", "list_first_entry", "(", "&", "fork_event", ",", "typeof", "(", "*", "uwq", ")", ",", "wq", ".", "entry", ")", ";", "/", "*", "*", "If", "fork_event", "list", "wasn", "'", "t", "empty", "and", "in", "turn", "*", "the", "event", "wasn", "'", "t", "already", "released", "by", "fork", "*", "(", "the", "event", "is", "allocated", "on", "fork", "kernel", "*", "stack", ")", ",", "put", "the", "event", "back", "to", "its", "place", "in", "*", "the", "event_wq", ".", "fork_event", "head", "will", "be", "freed", "*", "as", "soon", "as", "we", "return", "so", "the", "event", "cannot", "*", "stay", "queued", "there", "no", "matter", "the", "current", "*", "\"", "ret", "\"", "value", ".", "*", "/", "list_del", "(", "&", "uwq", "-", ">", "wq", ".", "entry", ")", ";", "__add_wait_queue", "(", "&", "ctx", "-", ">", "event_wqh", ",", "&", "uwq", "-", ">", "wq", ")", ";", "/", "*", "*", "Leave", "the", "event", "in", "the", "waitqueue", "and", "report", "*", "error", "to", "userland", "if", "we", "failed", "to", "resolve", "*", "the", "userfault", "fork", ".", "*", "/", "if", "(", "likely", "(", "!", "ret", ")", ")", "}", "else", "{", "/", "*", "*", "Here", "the", "fork", "thread", "aborted", "and", "the", "*", "refcount", "from", "the", "fork", "thread", "on", "fork_nctx", "*", "has", "already", "been", "released", ".", "We", "still", "hold", "*", "the", "reference", "we", "took", "before", "releasing", "the", "*", "lock", "above", ".", "If", "resolve_userfault_fork", "*", "failed", "we", "'", "ve", "to", "drop", "it", "because", "the", "*", "fork_nctx", "has", "to", "be", "freed", "in", "such", "case", ".", "If", "*", "it", "succeeded", "we", "'", "ll", "hold", "it", "because", "the", "new", "*", "uffd", "references", "it", ".", "*", "/", "if", "(", "ret", ")", "userfaultfd_ctx_put", "(", "fork_nctx", ")", ";", "spin_unlock", "(", "&", "ctx", "-", ">", "event_wqh", ".", "lock", ")", ";</s>if", "(", "!", "ret", ")", "{", "spin_lock", "(", "&", "ctx", "-", ">", "event_wqh", ".", "lock", ")", ";", "if", "(", "!", "list_empty", "(", "&", "fork_event", ")", ")", "{", "uwq", "=", "list_first_entry", "(", "&", "fork_event", ",", "typeof", "(", "*", "uwq", ")", ",", "wq", ".", "entry", ")", ";", "list_del", "(", "&", "uwq", "-", ">", "wq", ".", "entry", ")", ";", "__add_wait_queue", "(", "&", "ctx", "-", ">", "event_wqh", ",", "&", "uwq", "-", ">", "wq", ")", ";", "}", "spin_unlock", "(", "&", "ctx", "-", ">", "event_wqh", ".", "lock", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["STORM-3052:", "Allow", "for", "blobs", "to", "be", "unzipped/untarred"], "code_tokens": ["Utils", ".", "unpack", "(", "new", "File", "(", "downloadFile", ")", ",", "new", "File", "(", "localFileWithVersion", ")", ",", "(", "boolean", ")", "OR", "(", "_conf", ".", "get", "(", "Config", ".", "DISABLE_SYMLINKS", ")", ",", "false", ")", ");", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ")", "{", "extractZipFile", "(", "jar", ",", "toDir", ",", "null", ")", ";", "*", "@", "param", "symlinksDisabled", "true", "if", "symlinks", "should", "be", "disabled", ",", "else", "false", ".", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "ensureDirectory", "(", "untarDir", ")", ";", "if", "(", "Utils", ".", "isOnWindows", "(", ")", "|", "|", "symlinksDisabled", ")", "{", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ",", "symlinksDisabled", ")", ";", "boolean", "gzipped", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "final", "String", "base", "=", "untarDir", ".", "getCanonicalPath", "(", ");", "LOG", ".", "trace", "(", "\"", "java", "untar", "{", "}", "to", "{", "}\"", ",", "inFile", ",", "base", ")", ";", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ",", "base", ",", "symlinksDisabled", ")", ";", "TarArchiveEntry", "entry", ",", "File", "outputDir", ",", "final", "String", "base", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "File", "target", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "target", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "return", ";", "}", "LOG", ".", "trace", "(", "\"", "Extracting", "dir", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ")", ";", "unpackEntries", "(", "tis", ",", "e", ",", "target", ",", "base", ",", "symlinksDisabled", ")", ";", "}", "else", "if", "(", "entry", ".", "isSymbolicLink", "(", "))", "{", "if", "(", "symlinksDisabled", ")", "{", "LOG", ".", "info", "(", "\"", "Symlinks", "disabled", "skipping", "{", "}\"", ",", "target", ")", ";", "}", "else", "{", "Path", "src", "=", "target", ".", "toPath", "(", ");", "Path", "dest", "=", "Paths", ".", "get", "(", "entry", ".", "getLinkName", "(", "))", ";", "LOG", ".", "trace", "(", "\"", "Extracting", "sym", "link", "{", "}", "to", "{", "}\"", ",", "target", ",", "dest", ")", ";", "/", "/", "Create", "symbolic", "link", "relative", "to", "tar", "parent", "dir", "Files", ".", "createSymbolicLink", "(", "src", ",", "dest", ")", ";", "}", "}", "else", "if", "(", "entry", ".", "isFile", "(", "))", "{", "LOG", ".", "trace", "(", "\"", "Extracting", "file", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ".", "getParentFile", "(", "))", ";", "try", "(", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "target", ")", "))", "{", "IOUtils", ".", "copy", "(", "tis", ",", "outputStream", ")", ";", "}", "}", "else", "{", "LOG", ".", "error", "(", "\"{", "}", "is", "not", "a", "currently", "supported", "tar", "entry", "type", ".", "\",", "entry", ")", ";", "Path", "p", "=", "target", ".", "toPath", "(", ");", "if", "(", "Files", ".", "exists", "(", "p", ")", ")", "{", "try", "{", "/", "/", "We", "created", "it", "so", "lets", "chmod", "it", "properly", "int", "mode", "=", "entry", ".", "getMode", "(", ");", "Files", ".", "setPosixFilePermissions", "(", "p", ",", "parsePerms", "(", "mode", ")", ");", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "/", "/", "Ignored", "the", "file", "system", "we", "are", "on", "does", "not", "support", "this", ",", "so", "don", "'", "t", "do", "it", ".", "}", "private", "static", "Set", "<", "PosixFilePermission", ">", "parsePerms", "(", "int", "mode", ")", "{", "Set", "<", "PosixFilePermission", ">", "ret", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "(", "mode", "&", "0001", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0002", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0004", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0010", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_EXECUTE", ")", ";", "if", "(", "(", "mode", "&", "0020", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0040", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0100", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0200", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0400", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_READ", ")", ";", "}", "return", "ret", ";", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ",", "boolean", "symLinksDisabled", ")", "throws", "IOException", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_jar", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_zip", "\"", "))", "{", "lowerDst", ".", "endsWith", "(", "\"", "_tar_gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ",", "symLinksDisabled", ")", ";", "private", "static", "void", "extractZipFile", "(", "ZipFile", "zipFile", ",", "File", "toDir", ",", "String", "prefix", ")", "throws", "IOException", "{", "ensureDirectory", "(", "toDir", ")", ";", "final", "String", "base", "=", "toDir", ".", "getCanonicalPath", "(", ");", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "if", "(", "prefix", "!", "=", "null", "&", "&", "!", "entry", ".", "getName", "(", ").", "startsWith", "(", "prefix", ")", ")", "{", "/", "/", "No", "need", "to", "extract", "it", ",", "it", "is", "not", "what", "we", "are", "looking", "for", ".", "continue", ";", "}", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "file", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "continue", ";", "}", "try", "(", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "try", "(", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "}", "}", "*", "@", "param", "toDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ")", "{", "extractZipFile", "(", "zipFile", ",", "toDir", ",", "null", ")", ";", "}", "extractZipFile", "(", "jarFile", ",", "destdir", ",", "dir", ")", ";</s>Utils", ".", "unpack", "(", "new", "File", "(", "downloadFile", ")", ",", "new", "File", "(", "localFileWithVersion", ")", ");", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ";", "try", "{", "Enumeration", "<", "JarEntry", ">", "entries", "=", "jar", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "final", "JarEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "jar", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "copyBytes", "(", "in", ",", "out", ",", "8192", ")", ";", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "jar", ".", "close", "(", ");", "}", "}", "/", "**", "*", "Copies", "from", "one", "stream", "to", "another", ".", "*", "*", "@", "param", "in", "InputStream", "to", "read", "from", "*", "@", "param", "out", "OutputStream", "to", "write", "to", "*", "@", "param", "buffSize", "the", "size", "of", "the", "buffer", "*", "/", "public", "static", "void", "copyBytes", "(", "InputStream", "in", ",", "OutputStream", "out", ",", "int", "buffSize", ")", "throws", "IOException", "{", "PrintStream", "ps", "=", "out", "instanceof", "PrintStream", "?", "(", "PrintStream", ")", "out", ":", "null", ";", "byte", "buf", "[", "]", "=", "new", "byte", "[", "buffSize", "]", ";", "int", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "while", "(", "bytesRead", ">", "=", "0", ")", "{", "out", ".", "write", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "if", "(", "(", "ps", "!", "=", "null", ")", "&", "&", "ps", ".", "checkError", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "write", "to", "output", "stream", ".", "\")", ";", "}", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ")", "throws", "IOException", "{", "if", "(", "!", "untarDir", ".", "mkdirs", "(", "))", "{", "if", "(", "!", "untarDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "untarDir", ")", ";", "}", "}", "if", "(", "isOnWindows", "(", "))", "{", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ")", ";", "boolean", "gzipped", ")", "throws", "IOException", "{", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ")", ";", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "}", "unpackEntries", "(", "tis", ",", "e", ",", "subDir", ")", ";", "return", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "int", "count", ";", "byte", "data", "[", "]", "=", "new", "byte", "[", "2048", "]", ";", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "outputFile", ")", ");", "while", "(", "(", "count", "=", "tis", ".", "read", "(", "data", ")", ")", "!", "=", "-", "1", ")", "{", "outputStream", ".", "write", "(", "data", ",", "0", ",", "count", ")", ";", "outputStream", ".", "flush", "(", ");", "outputStream", ".", "close", "(", ");", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", "))", "{", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ")", ";", "*", "@", "param", "unzipDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "}", "}", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "8192", "]", ";", "int", "i", ";", "while", "(", "(", "i", "=", "in", ".", "read", "(", "buffer", ")", ")", "!", "=", "-", "1", ")", "{", "out", ".", "write", "(", "buffer", ",", "0", ",", "i", ")", ";", "}", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "zipFile", ".", "close", "(", ");", "}", "Enumeration", "<", "JarEntry", ">", "jarEnums", "=", "jarFile", ".", "entries", "(", ");", "while", "(", "jarEnums", ".", "hasMoreElements", "(", "))", "{", "JarEntry", "entry", "=", "jarEnums", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", ")", "&", "&", "entry", ".", "getName", "(", ").", "startsWith", "(", "dir", ")", ")", "{", "File", "aFile", "=", "new", "File", "(", "destdir", ",", "entry", ".", "getName", "(", "))", ";", "aFile", ".", "getParentFile", "(", ").", "mkdirs", "(", ");", "try", "(", "FileOutputStream", "out", "=", "new", "FileOutputStream", "(", "aFile", ")", ";", "InputStream", "in", "=", "jarFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}"], "docstring_tokens": ["using", "a", "specially", "crafted", "zip", "archive"]}
{"contents": ["drivers/net/usb/hso.c:", "prevent", "reading", "uninitialized", "memory", "Fixed", "formatting", "(tabs", "and", "line", "breaks).", "The", "TIOCGICOUNT", "device", "ioctl", "allows", "unprivileged", "users", "to", "read", "uninitialized", "stack", "memory,", "because", "the", "\"reserved\"", "member", "of", "the", "serial_icounter_struct", "struct", "declared", "on", "the", "stack", "in", "hso_get_count()", "is", "not", "altered", "or", "zeroed", "before", "being", "copied", "back", "to", "the", "user.", "This", "patch", "takes", "care", "of", "it.", "Signed-off-by:", "Dan", "Rosenberg", "<dan.j.rosenberg@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "&", "icount", ",", "0", ",", "sizeof", "(", "struct", "serial_icounter_struct", ")", ");</s>"], "docstring_tokens": ["leaking", "uninitialized", "stack", "memory"]}
{"contents": ["-", "Fixed", "bug", "#53574", "(Integer", "overflow", "in", "SdnToJulian,", "sometimes", "leading", "to", "segfault)."], "code_tokens": ["-", "Calendar", "extension", ":", ".", "Fixed", "bug", "#", "53574", "(", "Integer", "overflow", "in", "SdnToJulian", ",", "sometimes", "leading", "to", "segfault", ")", ".", "(", "Gustavo", ")", "#", "include", "<", "limits", ".", "h", ">", "goto", "fail", ";", "/", "*", "Check", "for", "overflow", "*", "/", "if", "(", "sdn", ">", "(", "LONG_MAX", "-", "JULIAN_SDN_OFFSET", "*", "4", "+", "1", ")", "/", "4", "|", "|", "sdn", "<", "LONG_MIN", "/", "4", ")", "{", "goto", "fail", ";", "}", "temp", "=", "sdn", "*", "4", "+", "(", "JULIAN_SDN_OFFSET", "*", "4", "-", "1", ")", ";", "{", "long", "yearl", "=", "temp", "/", "DAYS_PER_4_YEARS", ";", "if", "(", "yearl", ">", "INT_MAX", "|", "|", "yearl", "<", "INT_MIN", ")", "{", "goto", "fail", ";", "}", "year", "=", "(", "int", ")", "yearl", ";", "}", "return", ";", "fail", ":", "*", "pYear", "=", "0", ";", "*", "pMonth", "=", "0", ";", "*", "pDay", "=", "0", ";", "-", "-", "TEST", "-", "-", "Bug", "#", "53574", "(", "Integer", "overflow", "in", "SdnToJulian", ";", "leads", "to", "segfault", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "include", "'", "skipif", ".", "inc", "'", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "if", "(", "PHP_INT_MAX", "=", "=", "0x7FFFFFFF", ")", "{", "$", "x", "=", "882858043", ";", "}", "else", "{", "$", "x", "=", "3315881921229094912", ";", "}", "var_dump", "(", "cal_from_jd", "(", "$", "x", ",", "CAL_JULIAN", ")", ");", "-", "-", "EXPECT", "-", "-", "array", "(", "9", ")", "{", "[", "\"", "date", "\"", "]=", ">", "string", "(", "5", ")", "\"", "0", "/", "0", "/", "0", "\"", "[", "\"", "month", "\"", "]=", ">", "int", "(", "0", ")", "[", "\"", "day", "\"", "]=", ">", "int", "(", "0", ")", "[", "\"", "year", "\"", "]=", ">", "int", "(", "0", ")", "[", "\"", "dow", "\"", "]=", ">", "int", "(", "3", ")", "[", "\"", "abbrevdayname", "\"", "]=", ">", "string", "(", "3", ")", "\"", "Wed", "\"", "[", "\"", "dayname", "\"", "]=", ">", "string", "(", "9", ")", "\"", "Wednesday", "\"", "[", "\"", "abbrevmonth", "\"", "]=", ">", "string", "(", "0", ")", "\"", "\"", "[", "\"", "monthname", "\"", "]=", ">", "string", "(", "0", ")", "\"", "\"", "}</s>-", "DateTime", "extension", ":", "*", "pYear", "=", "0", ";", "*", "pMonth", "=", "0", ";", "*", "pDay", "=", "0", ";", "return", ";", "temp", "=", "(", "sdn", "+", "JULIAN_SDN_OFFSET", ")", "*", "4", "-", "1", ";", "year", "=", "temp", "/", "DAYS_PER_4_YEARS", ";"], "docstring_tokens": ["via", "a", "large", "integer", "in", "the", "first", "argument", "to", "the", "cal_from_jd", "function", "."]}
{"contents": ["mm:", "memcg:", "Correct", "unregistring", "of", "events", "attached", "to", "the", "same", "eventfd", "There", "is", "an", "issue", "when", "memcg", "unregisters", "events", "that", "were", "attached", "to", "the", "same", "eventfd:", "-", "On", "the", "first", "call", "mem_cgroup_usage_unregister_event()", "removes", "all", "events", "attached", "to", "a", "given", "eventfd,", "and", "if", "there", "were", "no", "events", "left,", "thresholds->primary", "would", "become", "NULL;", "-", "Since", "there", "were", "several", "events", "registered,", "cgroups", "core", "will", "call", "mem_cgroup_usage_unregister_event()", "again,", "but", "now", "kernel", "will", "oops,", "as", "the", "function", "doesn't", "expect", "that", "threshold->primary", "may", "be", "NULL.", "That's", "a", "good", "question", "whether", "mem_cgroup_usage_unregister_event()", "should", "actually", "remove", "all", "events", "in", "one", "go,", "but", "nowadays", "it", "can't", "do", "any", "better", "as", "cftype->unregister_event", "callback", "doesn't", "pass", "any", "private", "event-associated", "cookie.", "So,", "let's", "fix", "the", "issue", "by", "simply", "checking", "for", "threshold->primary.", "FWIW,", "w/o", "the", "patch", "the", "following", "oops", "may", "be", "observed:", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000004", "IP:", "[<ffffffff810be32c>]", "mem_cgroup_usage_unregister_event+0x9c/0x1f0", "Pid:", "574,", "comm:", "kworker/0:2", "Not", "tainted", "3.3.0-rc4+", "#9", "Bochs", "Bochs", "RIP:", "0010:[<ffffffff810be32c>]", "[<ffffffff810be32c>]", "mem_cgroup_usage_unregister_event+0x9c/0x1f0", "RSP:", "0018:ffff88001d0b9d60", "EFLAGS:", "00010246", "Process", "kworker/0:2", "(pid:", "574,", "threadinfo", "ffff88001d0b8000,", "task", "ffff88001de91cc0)", "Call", "Trace:", "[<ffffffff8107092b>]", "cgroup_event_remove+0x2b/0x60", "[<ffffffff8103db94>]", "process_one_work+0x174/0x450", "[<ffffffff8103e413>]", "worker_thread+0x123/0x2d0", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Anton", "Vorontsov", "<anton.vorontsov@linaro.org>", "Acked-by:", "KAMEZAWA", "Hiroyuki", "<kamezawa.hiroyu@jp.fujitsu.com>", "Cc:", "Kirill", "A.", "Shutemov", "<kirill@shutemov.name>", "Cc:", "Michal", "Hocko", "<mhocko@suse.cz>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "!", "thresholds", "-", ">", "primary", ")", "goto", "unlock", ";", "unlock", ":</s>"], "docstring_tokens": ["by", "registering", "memory", "threshold", "events", "."]}
{"contents": ["Fixed", "bug", "#68044:", "Integer", "overflow", "in", "unserialize()", "(32-bits", "only)"], "code_tokens": [".", "Fixed", "bug", "#", "68044", "(", "Integer", "overflow", "in", "unserialize", "(", ")", "(", "32", "-", "bits", "only", ")", ").", "(", "CVE", "-", "2014", "-", "3669", ")", "(", "Stas", ")", ".", "Fixed", "bug", "#", "68027", "(", "Global", "buffer", "overflow", "in", "mkgmtime", "(", ")", "function", ")", ".", "(", "CVE", "-", "2014", "-", "3668", ")", "(", "Stas", ")", "-", "-", "TEST", "-", "-", "Bug", "#", "68044", "Integer", "overflow", "in", "unserialize", "(", ")", "(", "32", "-", "bits", "only", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "echo", "unserialize", "(", "'", "C", ":", "3", ":", "\"", "XYZ", "\"", ":", "18446744075857035259", ":", "{}", "')", ";", "?", ">", "=", "==", "DONE", "=", "=", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "Insufficient", "data", "for", "unserializing", "-", "%", "d", "required", ",", "1", "present", "in", "%", "s", "/", "bug68044", ".", "php", "on", "line", "2", "Notice", ":", "unserialize", "(", "):", "Error", "at", "offset", "32", "of", "33", "bytes", "in", "%", "s", "/", "bug68044", ".", "php", "on", "line", "2", "=", "==", "DONE", "=", "=", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "5", "*", "/", "+", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "if", "(", "datalen", "<", "0", "|", "|", "(", "max", "-", "(", "*", "p", ")", ")", "<", "=", "datalen", ")", "{", "if", "(", "datalen", "<", "0", "|", "|", "(", "max", "-", "(", "*", "p", ")", ")", "<", "=", "datalen", ")", "{</s>-", "Core", ":", "-", "OpenSSL", ":", "-", "XMLRPC", ":", ".", "Fixed", "bug", "#", "68027", "(", "Global", "buffer", "overflow", "in", "mkgmtime", "(", ")", "function", ")", ".", "(", "Stas", ")", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "5", "on", "Sat", "Jun", "21", "21", ":", "27", ":", "56", "2014", "*", "/", "if", "(", "datalen", "<", "0", "|", "|", "(", "*", "p", ")", "+", "datalen", ">", "=", "max", ")", "{", "if", "(", "datalen", "<", "0", "|", "|", "(", "*", "p", ")", "+", "datalen", ">", "=", "max", ")", "{"], "docstring_tokens": ["via", "an", "argument", "to", "the", "unserialize", "function", "that", "triggers", "calculation", "of", "a", "large", "length", "value", "."]}
{"contents": ["Fix", "bug", "#74603", "-", "use", "correct", "buffer", "size"], "code_tokens": ["0", "=", "0", "&", "~", "2000000000", "@", "@", "-", "0", ",", "0", "+", "1", ",", "15", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "74603", "(", "PHP", "INI", "Parsing", "Stack", "Buffer", "Overflow", "Vulnerability", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "PHP_INT_MAX", "!", "==", "2147483647", ")", "die", "(", "'", "skip", "for", "32", "-", "bit", "only", "'", ");", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "parse_ini_file", "(", "__DIR__", ".", "\"", "/", "bug74603", ".", "ini", "\"", ",", "true", ",", "INI_SCANNER_NORMAL", ")", ");", "?", ">", "-", "-", "EXPECT", "-", "-", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "string", "(", "1", ")", "\"", "0", "\"", "}", "@", "@", "-", "55", ",", "7", "+", "55", ",", "7", "@", "@", "static", "void", "zend_ini_do_op", "(", "char", "type", ",", "zval", "*", "result", ",", "zval", "*", "op1", ",", "zval", "*", "op2", ")", "char", "str_result", "[", "MAX_LENGTH_OF_LONG", "+", "1", "]", ";</s>char", "str_result", "[", "MAX_LENGTH_OF_LONG", "]", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "input"]}
{"contents": ["crypto:", "ghash", "-", "Avoid", "null", "pointer", "dereference", "if", "no", "key", "is", "set", "The", "ghash_update", "function", "passes", "a", "pointer", "to", "gf128mul_4k_lle", "which", "will", "be", "NULL", "if", "ghash_setkey", "is", "not", "called", "or", "if", "the", "most", "recent", "call", "to", "ghash_setkey", "failed", "to", "allocate", "memory.", "This", "causes", "an", "oops.", "Fix", "this", "up", "by", "returning", "an", "error", "code", "in", "the", "null", "case.", "This", "is", "trivially", "triggered", "from", "unprivileged", "userspace", "through", "the", "AF_ALG", "interface", "by", "simply", "writing", "to", "the", "socket", "without", "setting", "a", "key.", "The", "ghash_final", "function", "has", "a", "similar", "issue,", "but", "triggering", "it", "requires", "a", "memory", "allocation", "failure", "in", "ghash_setkey", "_after_", "at", "least", "one", "successful", "call", "to", "ghash_update.", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "00000670", "IP:", "[<d88c92d4>]", "gf128mul_4k_lle+0x23/0x60", "[gf128mul]", "*pde", "=", "00000000", "Oops:", "0000", "[#1]", "PREEMPT", "SMP", "Modules", "linked", "in:", "ghash_generic", "gf128mul", "algif_hash", "af_alg", "nfs", "lockd", "nfs_acl", "sunrpc", "bridge", "ipv6", "stp", "llc", "Pid:", "1502,", "comm:", "hashatron", "Tainted:", "G", "W", "3.1.0-rc9-00085-ge9308cf", "#32", "Bochs", "Bochs", "EIP:", "0060:[<d88c92d4>]", "EFLAGS:", "00000202", "CPU:", "0", "EIP", "is", "at", "gf128mul_4k_lle+0x23/0x60", "[gf128mul]", "EAX:", "d69db1f0", "EBX:", "d6b8ddac", "ECX:", "00000004", "EDX:", "00000000", "ESI:", "00000670", "EDI:", "d6b8ddac", "EBP:", "d6b8ddc8", "ESP:", "d6b8dda4", "DS:", "007b", "ES:", "007b", "FS:", "00d8", "GS:", "0033", "SS:", "0068", "Process", "hashatron", "(pid:", "1502,", "ti=d6b8c000", "task=d6810000", "task.ti=d6b8c000)", "Stack:", "00000000", "d69db1f0", "00000163", "00000000", "d6b8ddc8", "c101a520", "d69db1f0", "d52aa000", "00000ff0", "d6b8dde8", "d88d310f", "d6b8a3f8", "d52aa000", "00001000", "d88d502c", "d6b8ddfc", "00001000", "d6b8ddf4", "c11676ed", "d69db1e8", "d6b8de24", "c11679ad", "d52aa000", "00000000", "Call", "Trace:", "[<c101a520>]", "?", "kmap_atomic_prot+0x37/0xa6", "[<d88d310f>]", "ghash_update+0x85/0xbe", "[ghash_generic]", "[<c11676ed>]", "crypto_shash_update+0x18/0x1b", "[<c11679ad>]", "shash_ahash_update+0x22/0x36", "[<c11679cc>]", "shash_async_update+0xb/0xd", "[<d88ce0ba>]", "hash_sendpage+0xba/0xf2", "[algif_hash]", "[<c121b24c>]", "kernel_sendpage+0x39/0x4e", "[<d88ce000>]", "?", "0xd88cdfff", "[<c121b298>]", "sock_sendpage+0x37/0x3e", "[<c121b261>]", "?", "kernel_sendpage+0x4e/0x4e", "[<c10b4dbc>]", "pipe_to_sendpage+0x56/0x61", "[<c10b4e1f>]", "splice_from_pipe_feed+0x58/0xcd", "[<c10b4d66>]", "?", "splice_from_pipe_begin+0x10/0x10", "[<c10b51f5>]", "__splice_from_pipe+0x36/0x55", "[<c10b4d66>]", "?", "splice_from_pipe_begin+0x10/0x10", "[<c10b6383>]", "splice_from_pipe+0x51/0x64", "[<c10b63c2>]", "?", "default_file_splice_write+0x2c/0x2c", "[<c10b63d5>]", "generic_splice_sendpage+0x13/0x15", "[<c10b4d66>]", "?", "splice_from_pipe_begin+0x10/0x10", "[<c10b527f>]", "do_splice_from+0x5d/0x67", "[<c10b6865>]", "sys_splice+0x2bf/0x363", "[<c129373b>]", "?", "sysenter_exit+0xf/0x16", "[<c104dc1e>]", "?", "trace_hardirqs_on_caller+0x10e/0x13f", "[<c129370c>]", "sysenter_do_call+0x12/0x32", "Code:", "83", "c4", "0c", "5b", "5e", "5f", "c9", "c3", "55", "b9", "04", "00", "00", "00", "89", "e5", "57", "8d", "7d", "e4", "56", "53", "8d", "5d", "e4", "83", "ec", "18", "89", "45", "e0", "89", "55", "dc", "0f", "b6", "70", "0f", "c1", "e6", "04", "01", "d6", "<f3>", "a5", "be", "0f", "00", "00", "00", "4e", "89", "d8", "e8", "48", "ff", "ff", "ff", "8b", "45", "e0", "89", "da", "0f", "EIP:", "[<d88c92d4>]", "gf128mul_4k_lle+0x23/0x60", "[gf128mul]", "SS:ESP", "0068:d6b8dda4", "CR2:", "0000000000000670", "---[", "end", "trace", "4eaa2a86a8e2da24", "]---", "note:", "hashatron[1502]", "exited", "with", "preempt_count", "1", "BUG:", "scheduling", "while", "atomic:", "hashatron/1502/0x10000002", "INFO:", "lockdep", "is", "turned", "off.", "[...]", "Signed-off-by:", "Nick", "Bowler", "<nbowler@elliptictech.com>", "Cc:", "stable@kernel.org", "[2.6.37+]", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>"], "code_tokens": ["if", "(", "!", "ctx", "-", ">", "gf128", ")", "return", "-", "ENOKEY", ";", "if", "(", "!", "ctx", "-", ">", "gf128", ")", "return", "-", "ENOKEY", ";</s>"], "docstring_tokens": ["simply", "writing", "to", "the", "socket", "without", "setting", "a", "key"]}
{"contents": ["ath9k:", "protect", "tid->sched", "check", "We", "check", "tid->sched", "without", "a", "lock", "taken", "on", "ath_tx_aggr_sleep().", "That", "is", "race", "condition", "which", "can", "result", "of", "doing", "list_del(&tid->list)", "twice", "(second", "time", "with", "poisoned", "list", "node)", "and", "cause", "crash", "like", "shown", "below:", "[424271.637220]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "00100104", "[424271.637328]", "IP:", "[<f90fc072>]", "ath_tx_aggr_sleep+0x62/0xe0", "[ath9k]", "...", "[424271.639953]", "Call", "Trace:", "[424271.639998]", "[<f90f6900>]", "?", "ath9k_get_survey+0x110/0x110", "[ath9k]", "[424271.640083]", "[<f90f6942>]", "ath9k_sta_notify+0x42/0x50", "[ath9k]", "[424271.640177]", "[<f809cfef>]", "sta_ps_start+0x8f/0x1c0", "[mac80211]", "[424271.640258]", "[<c10f730e>]", "?", "free_compound_page+0x2e/0x40", "[424271.640346]", "[<f809e915>]", "ieee80211_rx_handlers+0x9d5/0x2340", "[mac80211]", "[424271.640437]", "[<c112f048>]", "?", "kmem_cache_free+0x1d8/0x1f0", "[424271.640510]", "[<c1345a84>]", "?", "kfree_skbmem+0x34/0x90", "[424271.640578]", "[<c10fc23c>]", "?", "put_page+0x2c/0x40", "[424271.640640]", "[<c1345a84>]", "?", "kfree_skbmem+0x34/0x90", "[424271.640706]", "[<c1345a84>]", "?", "kfree_skbmem+0x34/0x90", "[424271.640787]", "[<f809dde3>]", "?", "ieee80211_rx_handlers_result+0x73/0x1d0", "[mac80211]", "[424271.640897]", "[<f80a07a0>]", "ieee80211_prepare_and_rx_handle+0x520/0xad0", "[mac80211]", "[424271.641009]", "[<f809e22d>]", "?", "ieee80211_rx_handlers+0x2ed/0x2340", "[mac80211]", "[424271.641104]", "[<c13846ce>]", "?", "ip_output+0x7e/0xd0", "[424271.641182]", "[<f80a1057>]", "ieee80211_rx+0x307/0x7c0", "[mac80211]", "[424271.641266]", "[<f90fa6ee>]", "ath_rx_tasklet+0x88e/0xf70", "[ath9k]", "[424271.641358]", "[<f80a0f2c>]", "?", "ieee80211_rx+0x1dc/0x7c0", "[mac80211]", "[424271.641445]", "[<f90f82db>]", "ath9k_tasklet+0xcb/0x130", "[ath9k]", "Bug", "report:", "https://bugzilla.kernel.org/show_bug.cgi?id=70551", "Reported-and-tested-by:", "Max", "Sydorenko", "<maxim.stargazer@gmail.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Stanislaw", "Gruszka", "<sgruszka@redhat.com>", "Signed-off-by:", "John", "W.", "Linville", "<linville@tuxdriver.com>"], "code_tokens": ["if", "(", "!", "tid", "-", ">", "sched", ")", "{", "ath_txq_unlock", "(", "sc", ",", "txq", ")", ";", "continue", ";", "}</s>if", "(", "!", "tid", "-", ">", "sched", ")", "continue", ";"], "docstring_tokens": ["via", "a", "large", "amount", "of", "network", "traffic", "that", "triggers", "certain", "list", "deletions", "."]}
{"contents": ["HID:", "logitech:", "fix", "bounds", "checking", "on", "LED", "report", "size", "The", "check", "on", "report", "size", "for", "REPORT_TYPE_LEDS", "in", "logi_dj_ll_raw_request()", "is", "wrong;", "the", "current", "check", "doesn't", "make", "any", "sense", "--", "the", "report", "allocated", "by", "HID", "core", "in", "hid_hw_raw_request()", "can", "be", "much", "larger", "than", "DJREPORT_SHORT_LENGTH,", "and", "currently", "logi_dj_ll_raw_request()", "doesn't", "handle", "this", "properly", "at", "all.", "Fix", "the", "check", "by", "actually", "trimming", "down", "the", "report", "size", "properly", "if", "it", "is", "too", "large.", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Ben", "Hawkes", "<hawkes@google.com>", "Reviewed-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["if", "(", "count", ">", "DJREPORT_SHORT_LENGTH", "-", "2", ")</s>if", "(", "count", "<", "DJREPORT_SHORT_LENGTH", "-", "2", ")"], "docstring_tokens": ["via", "a", "crafted", "device", "that", "specifies", "a", "large", "report", "size", "for", "an", "LED", "report", "."]}
{"contents": ["Bluetooth:", "RFCOMM", "-", "Fix", "info", "leak", "via", "getsockname()", "The", "RFCOMM", "code", "fails", "to", "initialize", "the", "trailing", "padding", "byte", "of", "struct", "sockaddr_rc", "added", "for", "alignment.", "It", "that", "for", "leaks", "one", "byte", "kernel", "stack", "via", "the", "getsockname()", "syscall.", "Add", "an", "explicit", "memset(0)", "before", "filling", "the", "structure", "to", "avoid", "the", "info", "leak.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Cc:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Cc:", "Gustavo", "Padovan", "<gustavo@padovan.org>", "Cc:", "Johan", "Hedberg", "<johan.hedberg@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "sa", ",", "0", ",", "sizeof", "(", "*", "sa", ")", ");</s>"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["Additional", "check", "when", "unpacking", "archives.", "Contributed", "by", "Jason", "Lowe", "and", "Akira", "Ajisaka.", "(cherry", "picked", "from", "commit", "cedc28d4ab2a27ba47e15ab2711218d96ec88d23)"], "code_tokens": ["String", "targetDirPath", "=", "unzipDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "file", "outside", "of", "\"", "+", "unzipDir", ")", ";", "}", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "String", "targetDirPath", "=", "outputDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "entry", "outside", "of", "\"", "+", "outputDir", ")", ";", "}", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "/", "/", "make", "a", "simple", "zip", "/", "/", "successfully", "unzip", "it", "into", "an", "existing", "dir", ":", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip2", "(", ")", "throws", "IOException", "{", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "try", "(", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ")", "{", "/", "/", "Add", "an", "entry", "that", "contains", "invalid", "filename", "ZipEntry", "ze", "=", "new", "ZipEntry", "(", "\".", "./", "foo", "\"", ");", "byte", "[", "]", "data", "=", "\"", "some", "-", "content", "\"", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "ze", ".", "setSize", "(", "data", ".", "length", ")", ";", "tos", ".", "putNextEntry", "(", "ze", ")", ";", "tos", ".", "write", "(", "data", ")", ";", "tos", ".", "closeEntry", "(", ");", "tos", ".", "flush", "(", ");", "tos", ".", "finish", "(", ");", "}", "/", "/", "Unzip", "it", "into", "an", "existing", "dir", "try", "{", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "Assert", ".", "fail", "(", "\"", "unZip", "should", "throw", "IOException", ".", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "GenericTestUtils", ".", "assertExceptionContains", "(", "\"", "would", "create", "file", "outside", "of", "\"", ",", "e", ")", ";", "}", "}</s>File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "/", "/", "make", "sa", "simple", "zip", "/", "/", "make", "a", "simple", "tar", ":", "/", "/", "successfully", "untar", "it", "into", "an", "existing", "dir", ":", "}"], "docstring_tokens": ["the", "public", "archive"]}
{"contents": ["Fix", "bug", "#76248", "-", "Malicious", "LDAP-Server", "Response", "causes", "Crash"], "code_tokens": ["if", "(", "dn", ")", "{", "add_assoc_string", "(", "tmp1", ",", "\"", "dn", "\"", ",", "dn", ",", "1", ")", ";", "}", "else", "{", "add_assoc_null", "(", "tmp1", ",", "\"", "dn", "\"", ");", "}", "-", "-", "TEST", "-", "-", "Bug", "#", "76248", "(", "Malicious", "LDAP", "-", "Server", "Response", "causes", "Crash", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "'", "skipif", ".", "inc", "'", ");", "if", "(", "!", "function_exists", "(", "'", "pcntl_fork", "'", "))", "die", "(", "'", "skip", "fork", "not", "available", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "pid", "=", "pcntl_fork", "(", ");", "const", "PORT", "=", "12345", ";", "if", "(", "$", "pid", "=", "=", "0", ")", "{", "/", "/", "child", "$", "server", "=", "stream_socket_server", "(", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "12345", "\"", ");", "$", "socket", "=", "stream_socket_accept", "(", "$", "server", ",", "3", ")", ";", "fwrite", "(", "$", "socket", ",", "base64_decode", "(", "\"", "MAwCAQFhBwoBAAQABAAweQIBAmR0BJljbj1yb290LGRjPWV4YW1wbGUsZGM9Y29tMFcwIwQLb2JqZWN0Q2xhc3MxFAQSb3JnYW5pemF0aW9uYWxSb2xlMAwEAmNuMQYEBHJvb3QwIgQLZGVzY3JpcHRpb24xEwQRRGlyZWN0b3J5IE1hbmFnZXIwDAIBAmUHCgEABAAEADB5AgEDZHQEmWNuPXJvb3QsZGM9ZXhhbXBsZSxkYz1jb20wVzAjBAtvYmplY3RDbGFzczEUBBJvcmdhbml6YXRpb25hbFJvbGUwDAQCY24xBgQEcm9vdDAiBAtkZXNjcmlwdGlvbjETBBFEaXJlY3RvcnkgTWFuYWdlcjAMAgEDZQcKAQAEAAQA", "\"", "))", ";", "fflush", "(", "$", "socket", ")", ";", "}", "else", "{", "/", "/", "parent", "$", "ds", "=", "ldap_connect", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "PORT", ")", ";", "ldap_set_option", "(", "$", "ds", ",", "LDAP_OPT_PROTOCOL_VERSION", ",", "3", ")", ";", "$", "b", "=", "ldap_bind", "(", "$", "ds", ",", "\"", "cn", "=", "root", ",", "dc", "=", "example", ",", "dc", "=", "com", "\"", ",", "\"", "secret", "\"", ");", "$", "s", "=", "ldap_search", "(", "$", "ds", ",", "\"", "dc", "=", "example", ",", "dc", "=", "com", "\"", ",", "\"", "(", "cn", "=", "root", ")", "\")", ";", "$", "tt", "=", "ldap_get_entries", "(", "$", "ds", ",", "$", "s", ")", ";", "var_dump", "(", "$", "tt", ")", ";", "}", "?", ">", "-", "-", "EXPECT", "-", "-", "array", "(", "2", ")", "{", "[", "\"", "count", "\"", "]=", ">", "int", "(", "1", ")", "[", "0", "]", "=>", "array", "(", "2", ")", "{", "[", "\"", "count", "\"", "]=", ">", "int", "(", "0", ")", "[", "\"", "dn", "\"", "]=", ">", "NULL", "}", "}</s>add_assoc_string", "(", "tmp1", ",", "\"", "dn", "\"", ",", "dn", ",", "1", ")", ";"], "docstring_tokens": ["sending", "specially", "crafted", "data"]}
{"contents": ["mm:", "pmd_read_atomic:", "fix", "32bit", "PAE", "pmd", "walk", "vs", "pmd_populate", "SMP", "race", "condition", "When", "holding", "the", "mmap_sem", "for", "reading,", "pmd_offset_map_lock", "should", "only", "run", "on", "a", "pmd_t", "that", "has", "been", "read", "atomically", "from", "the", "pmdp", "pointer,", "otherwise", "we", "may", "read", "only", "half", "of", "it", "leading", "to", "this", "crash.", "PID:", "11679", "TASK:", "f06e8000", "CPU:", "3", "COMMAND:", "\"do_race_2_panic\"", "#0", "[f06a9dd8]", "crash_kexec", "at", "c049b5ec", "#1", "[f06a9e2c]", "oops_end", "at", "c083d1c2", "#2", "[f06a9e40]", "no_context", "at", "c0433ded", "#3", "[f06a9e64]", "bad_area_nosemaphore", "at", "c043401a", "#4", "[f06a9e6c]", "__do_page_fault", "at", "c0434493", "#5", "[f06a9eec]", "do_page_fault", "at", "c083eb45", "#6", "[f06a9f04]", "error_code", "(via", "page_fault)", "at", "c083c5d5", "EAX:", "01fb470c", "EBX:", "fff35000", "ECX:", "00000003", "EDX:", "00000100", "EBP:", "00000000", "DS:", "007b", "ESI:", "9e201000", "ES:", "007b", "EDI:", "01fb4700", "GS:", "00e0", "CS:", "0060", "EIP:", "c083bc14", "ERR:", "ffffffff", "EFLAGS:", "00010246", "#7", "[f06a9f38]", "_spin_lock", "at", "c083bc14", "#8", "[f06a9f44]", "sys_mincore", "at", "c0507b7d", "#9", "[f06a9fb0]", "system_call", "at", "c083becd", "start", "len", "EAX:", "ffffffda", "EBX:", "9e200000", "ECX:", "00001000", "EDX:", "6228537f", "DS:", "007b", "ESI:", "00000000", "ES:", "007b", "EDI:", "003d0f00", "SS:", "007b", "ESP:", "62285354", "EBP:", "62285388", "GS:", "0033", "CS:", "0073", "EIP:", "00291416", "ERR:", "000000da", "EFLAGS:", "00000286", "This", "should", "be", "a", "longstanding", "bug", "affecting", "x86", "32bit", "PAE", "without", "THP.", "Only", "archs", "with", "64bit", "large", "pmd_t", "and", "32bit", "unsigned", "long", "should", "be", "affected.", "With", "THP", "enabled", "the", "barrier()", "in", "pmd_none_or_trans_huge_or_clear_bad()", "would", "partly", "hide", "the", "bug", "when", "the", "pmd", "transition", "from", "none", "to", "stable,", "by", "forcing", "a", "re-read", "of", "the", "*pmd", "in", "pmd_offset_map_lock,", "but", "when", "THP", "is", "enabled", "a", "new", "set", "of", "problem", "arises", "by", "the", "fact", "could", "then", "transition", "freely", "in", "any", "of", "the", "none,", "pmd_trans_huge", "or", "pmd_trans_stable", "states.", "So", "making", "the", "barrier", "in", "pmd_none_or_trans_huge_or_clear_bad()", "unconditional", "isn't", "good", "idea", "and", "it", "would", "be", "a", "flakey", "solution.", "This", "should", "be", "fully", "fixed", "by", "introducing", "a", "pmd_read_atomic", "that", "reads", "the", "pmd", "in", "order", "with", "THP", "disabled,", "or", "by", "reading", "the", "pmd", "atomically", "with", "cmpxchg8b", "with", "THP", "enabled.", "Luckily", "this", "new", "race", "condition", "only", "triggers", "in", "the", "places", "that", "must", "already", "be", "covered", "by", "pmd_none_or_trans_huge_or_clear_bad()", "so", "the", "fix", "is", "localized", "there", "but", "this", "bug", "is", "not", "related", "to", "THP.", "NOTE:", "this", "can", "trigger", "on", "x86", "32bit", "systems", "with", "PAE", "enabled", "with", "more", "than", "4G", "of", "ram,", "otherwise", "the", "high", "part", "of", "the", "pmd", "will", "never", "risk", "to", "be", "truncated", "because", "it", "would", "be", "zero", "at", "all", "times,", "in", "turn", "so", "hiding", "the", "SMP", "race.", "This", "bug", "was", "discovered", "and", "fully", "debugged", "by", "Ulrich,", "quote:", "----", "[..]", "pmd_none_or_trans_huge_or_clear_bad()", "loads", "the", "content", "of", "edx", "and", "eax.", "496", "static", "inline", "int", "pmd_none_or_trans_huge_or_clear_bad(pmd_t", "*pmd)", "497", "{", "498", "/*", "depend", "on", "compiler", "for", "an", "atomic", "pmd", "read", "*/", "499", "pmd_t", "pmdval", "=", "*pmd;", "//", "edi", "=", "pmd", "pointer", "0xc0507a74", "<sys_mincore+548>:", "mov", "0x8(%esp),%edi", "...", "//", "edx", "=", "PTE", "page", "table", "high", "address", "0xc0507a84", "<sys_mincore+564>:", "mov", "0x4(%edi),%edx", "...", "//", "eax", "=", "PTE", "page", "table", "low", "address", "0xc0507a8e", "<sys_mincore+574>:", "mov", "(%edi),%eax", "[..]", "Please", "note", "that", "the", "PMD", "is", "not", "read", "atomically.", "These", "are", "two", "\"mov\"", "instructions", "where", "the", "high", "order", "bits", "of", "the", "PMD", "entry", "are", "fetched", "first.", "Hence,", "the", "above", "machine", "code", "is", "prone", "to", "the", "following", "race.", "-", "The", "PMD", "entry", "{high|low}", "is", "0x0000000000000000.", "The", "\"mov\"", "at", "0xc0507a84", "loads", "0x00000000", "into", "edx.", "-", "A", "page", "fault", "(on", "another", "CPU)", "sneaks", "in", "between", "the", "two", "\"mov\"", "instructions", "and", "instantiates", "the", "PMD.", "-", "The", "PMD", "entry", "{high|low}", "is", "now", "0x00000003fda38067.", "The", "\"mov\"", "at", "0xc0507a8e", "loads", "0xfda38067", "into", "eax.", "----", "Reported-by:", "Ulrich", "Obergfell", "<uobergfe@redhat.com>", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Cc:", "Mel", "Gorman", "<mgorman@suse.de>", "Cc:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "Larry", "Woodman", "<lwoodman@redhat.com>", "Cc:", "Petr", "Matousek", "<pmatouse@redhat.com>", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "define", "pmd_read_atomic", "pmd_read_atomic", "/", "*", "*", "pte_offset_map_lock", "on", "32bit", "PAE", "kernels", "was", "reading", "the", "pmd_t", "with", "*", "a", "\"", "*", "pmdp", "\"", "dereference", "done", "by", "gcc", ".", "Problem", "is", ",", "in", "certain", "places", "*", "where", "pte_offset_map_lock", "is", "called", ",", "concurrent", "page", "faults", "are", "*", "allowed", ",", "if", "the", "mmap_sem", "is", "hold", "for", "reading", ".", "An", "example", "is", "mincore", "*", "vs", "page", "faults", "vs", "MADV_DONTNEED", ".", "On", "the", "page", "fault", "side", "*", "pmd_populate", "rightfully", "does", "a", "set_64bit", ",", "but", "if", "we", "'", "re", "reading", "the", "*", "pmd_t", "with", "a", "\"", "*", "pmdp", "\"", "on", "the", "mincore", "side", ",", "a", "SMP", "race", "can", "happen", "*", "because", "gcc", "will", "not", "read", "the", "64bit", "of", "the", "pmd", "atomically", ".", "To", "fix", "*", "this", "all", "places", "running", "pmd_offset_map_lock", "(", ")", "while", "holding", "the", "*", "mmap_sem", "in", "read", "mode", ",", "shall", "read", "the", "pmdp", "pointer", "using", "this", "*", "function", "to", "know", "if", "the", "pmd", "is", "null", "nor", "not", ",", "and", "in", "turn", "to", "know", "if", "*", "they", "can", "run", "pmd_offset_map_lock", "or", "pmd_trans_huge", "or", "other", "pmd", "*", "operations", ".", "*", "*", "Without", "THP", "if", "the", "mmap_sem", "is", "hold", "for", "reading", ",", "the", "*", "pmd", "can", "only", "transition", "from", "null", "to", "not", "null", "while", "pmd_read_atomic", "runs", ".", "*", "So", "there", "'", "s", "no", "need", "of", "literally", "reading", "it", "atomically", ".", "*", "*", "With", "THP", "if", "the", "mmap_sem", "is", "hold", "for", "reading", ",", "the", "pmd", "can", "become", "*", "THP", "or", "null", "or", "point", "to", "a", "pte", "(", "and", "in", "turn", "become", "\"", "stable", "\"", ")", "at", "any", "*", "time", "under", "pmd_read_atomic", ",", "so", "it", "'", "s", "mandatory", "to", "read", "it", "atomically", "*", "with", "cmpxchg8b", ".", "*", "/", "#", "ifndef", "CONFIG_TRANSPARENT_HUGEPAGE", "static", "inline", "pmd_t", "pmd_read_atomic", "(", "pmd_t", "*", "pmdp", ")", "{", "pmdval_t", "ret", ";", "u32", "*", "tmp", "=", "(", "u32", "*", ")", "pmdp", ";", "ret", "=", "(", "pmdval_t", ")", "(", "*", "tmp", ")", ";", "if", "(", "ret", ")", "{", "/", "*", "*", "If", "the", "low", "part", "is", "null", ",", "we", "must", "not", "read", "the", "high", "part", "*", "or", "we", "can", "end", "up", "with", "a", "partial", "pmd", ".", "*", "/", "smp_rmb", "(", ");", "ret", "|", "=", "(", "(", "pmdval_t", ")", "*(", "tmp", "+", "1", ")", ")", "<", "<", "32", ";", "}", "return", "(", "pmd_t", ")", "{", "ret", "}", ";", "}", "#", "else", "/", "*", "CONFIG_TRANSPARENT_HUGEPAGE", "*", "/", "static", "inline", "pmd_t", "pmd_read_atomic", "(", "pmd_t", "*", "pmdp", ")", "{", "return", "(", "pmd_t", ")", "{", "atomic64_read", "(", "(", "atomic64_t", "*", ")", "pmdp", ")", "}", ";", "}", "#", "endif", "/", "*", "CONFIG_TRANSPARENT_HUGEPAGE", "*", "/", "#", "ifndef", "pmd_read_atomic", "static", "inline", "pmd_t", "pmd_read_atomic", "(", "pmd_t", "*", "pmdp", ")", "{", "/", "*", "*", "Depend", "on", "compiler", "for", "an", "atomic", "pmd", "read", ".", "NOTE", ":", "this", "is", "*", "only", "going", "to", "work", ",", "if", "the", "pmdval_t", "isn", "'", "t", "larger", "than", "*", "an", "unsigned", "long", ".", "*", "/", "return", "*", "pmdp", ";", "}", "#", "endif", "*", "*", "For", "32bit", "kernels", "with", "a", "64bit", "large", "pmd_t", "this", "automatically", "takes", "*", "care", "of", "reading", "the", "pmd", "atomically", "to", "avoid", "SMP", "race", "conditions", "*", "against", "pmd_populate", "(", ")", "when", "the", "mmap_sem", "is", "hold", "for", "reading", "by", "the", "*", "caller", "(", "a", "special", "atomic", "read", "not", "done", "by", "\"", "gcc", "\"", "as", "in", "the", "generic", "*", "version", "above", ",", "is", "also", "needed", "when", "THP", "is", "disabled", "because", "the", "page", "*", "fault", "can", "populate", "the", "pmd", "from", "under", "us", ")", ".", "pmd_t", "pmdval", "=", "pmd_read_atomic", "(", "pmd", ")", ";</s>/", "*", "depend", "on", "compiler", "for", "an", "atomic", "pmd", "read", "*", "/", "pmd_t", "pmdval", "=", "*", "pmd", ";"], "docstring_tokens": ["via", "a", "crafted", "application", "that", "triggers", "a", "race", "condition", "."]}
{"contents": ["[SECURITY-514]", "Restrict", "access", "to", "user", "properties", "via", "the", "api", "to", "admins"], "code_tokens": ["if", "(", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ")", "{", "return", "Collections", ".", "unmodifiableList", "(", "properties", ")", ";", "}", "return", "Collections", ".", "emptyList", "(", ");", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "collection", ".", "IsEmptyCollection", ".", "empty", ";", "import", "org", ".", "hamcrest", ".", "collection", ".", "IsEmptyCollection", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "MockAuthorizationStrategy", ";", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "514", "\"", ")", "public", "void", "getAllPropertiesRequiresAdmin", "(", ")", "{", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "new", "MockAuthorizationStrategy", "(", ")", ".", "grant", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "admin", ")", "\")", ".", "grant", "(", "Jenkins", ".", "READ", ")", ".", "everywhere", "(", ").", "toEveryone", "(", "))", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "User", "admin", "=", "User", ".", "get", "(", "\"", "admin", "\"", ");", "User", "alice", "=", "User", ".", "get", "(", "\"", "alice", "\"", ");", "User", "bob", "=", "User", ".", "get", "(", "\"", "bob", "\"", ");", "/", "/", "Admin", "can", "access", "user", "properties", "for", "all", "users", "ACL", ".", "impersonate", "(", "admin", ".", "impersonate", "(", "))", ";", "assertThat", "(", "alice", ".", "getAllProperties", "(", "),", "not", "(", "empty", "(", "))", ");", "assertThat", "(", "bob", ".", "getAllProperties", "(", "),", "not", "(", "empty", "(", "))", ");", "assertThat", "(", "admin", ".", "getAllProperties", "(", "),", "not", "(", "empty", "(", "))", ");", "/", "/", "Non", "admins", "can", "only", "view", "their", "own", "ACL", ".", "impersonate", "(", "alice", ".", "impersonate", "(", "))", ";", "assertThat", "(", "alice", ".", "getAllProperties", "(", "),", "not", "(", "empty", "(", "))", ");", "assertThat", "(", "bob", ".", "getAllProperties", "(", "),", "empty", "(", "))", ";", "assertThat", "(", "admin", ".", "getAllProperties", "(", "),", "empty", "(", "))", ";", "}</s>return", "Collections", ".", "unmodifiableList", "(", "properties", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["binder:", "fix", "race", "that", "allows", "malicious", "free", "of", "live", "buffer", "Malicious", "code", "can", "attempt", "to", "free", "buffers", "using", "the", "BC_FREE_BUFFER", "ioctl", "to", "binder.", "There", "are", "protections", "against", "a", "user", "freeing", "a", "buffer", "while", "in", "use", "by", "the", "kernel,", "however", "there", "was", "a", "window", "where", "BC_FREE_BUFFER", "could", "be", "used", "to", "free", "a", "recently", "allocated", "buffer", "that", "was", "not", "completely", "initialized.", "This", "resulted", "in", "a", "use-after-free", "detected", "by", "KASAN", "with", "a", "malicious", "test", "program.", "This", "window", "is", "closed", "by", "setting", "the", "buffer's", "allow_user_free", "attribute", "to", "0", "when", "the", "buffer", "is", "allocated", "or", "when", "the", "user", "has", "previously", "freed", "it", "instead", "of", "waiting", "for", "the", "caller", "to", "set", "it.", "The", "problem", "was", "that", "when", "the", "struct", "buffer", "was", "recycled,", "allow_user_free", "was", "stale", "and", "set", "to", "1", "allowing", "a", "free", "to", "go", "through.", "Signed-off-by:", "Todd", "Kjos", "<tkjos@google.com>", "Acked-by:", "Arve", "Hj\u00f8nnev\u00e5g", "<arve@android.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "4.14", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["if", "(", "IS_ERR_OR_NULL", "(", "buffer", ")", ")", "{", "if", "(", "PTR_ERR", "(", "buffer", ")", "=", "=", "-", "EPERM", ")", "{", "binder_user_error", "(", "\"", "%", "d", ":", "%", "d", "BC_FREE_BUFFER", "u", "%", "016llx", "matched", "unreturned", "or", "currently", "freeing", "buffer", "\\", "n", "\"", ",", "proc", "-", ">", "pid", ",", "thread", "-", ">", "pid", ",", "(", "u64", ")", "data_ptr", ")", ";", "}", "else", "{", "binder_user_error", "(", "\"", "%", "d", ":", "%", "d", "BC_FREE_BUFFER", "u", "%", "016llx", "no", "match", "\\", "n", "\"", ",", "proc", "-", ">", "pid", ",", "thread", "-", ">", "pid", ",", "(", "u64", ")", "data_ptr", ")", ";", "}", "*", "free", "the", "buffer", "when", "in", "use", "by", "kernel", "or", "*", "after", "it", "'", "s", "already", "been", "freed", ".", "if", "(", "!", "buffer", "-", ">", "allow_user_free", ")", "return", "ERR_PTR", "(", "-", "EPERM", ")", ";", "buffer", "-", ">", "allow_user_free", "=", "0", ";", "buffer", "-", ">", "allow_user_free", "=", "0", ";", "unsigned", "debug_id", ":", "29", ";</s>t", "-", ">", "buffer", "-", ">", "allow_user_free", "=", "0", ";", "if", "(", "buffer", "=", "=", "NULL", ")", "{", "binder_user_error", "(", "\"%", "d", ":", "%", "d", "BC_FREE_BUFFER", "u", "%", "016llx", "no", "match", "\\", "n", "\"", ",", "proc", "-", ">", "pid", ",", "thread", "-", ">", "pid", ",", "(", "u64", ")", "data_ptr", ")", ";", "break", ";", "}", "if", "(", "!", "buffer", "-", ">", "allow_user_free", ")", "{", "binder_user_error", "(", "\"%", "d", ":", "%", "d", "BC_FREE_BUFFER", "u", "%", "016llx", "matched", "unreturned", "buffer", "\\", "n", "\"", ",", "proc", "-", ">", "pid", ",", "thread", "-", ">", "pid", ",", "(", "u64", ")", "data_ptr", ")", ";", "*", "free", "the", "buffer", "twice", "if", "(", "buffer", "-", ">", "free_in_progress", ")", "{", "binder_alloc_debug", "(", "BINDER_DEBUG_USER_ERROR", ",", "\"", "%", "d", ":", "%", "d", "FREE_BUFFER", "u", "%", "016llx", "user", "freed", "buffer", "twice", "\\", "n", "\"", ",", "alloc", "-", ">", "pid", ",", "current", "-", ">", "pid", ",", "(", "u64", ")", "user_ptr", ")", ";", "return", "NULL", ";", "}", "buffer", "-", ">", "free_in_progress", "=", "1", ";", "buffer", "-", ">", "free_in_progress", "=", "0", ";", "unsigned", "free_in_progress", ":", "1", ";", "unsigned", "debug_id", ":", "28", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "application"]}
{"contents": ["HV-912", "Not", "exposing", "accessible-made", "members"], "code_tokens": ["import", "java", ".", "lang", ".", "reflect", ".", "AccessibleObject", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Member", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ConcurrentReferenceHashMap", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ConcurrentReferenceHashMap", ".", "ReferenceType", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredField", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "GetDeclaredMethod", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "SetAccessibility", ";", "/", "**", "*", "Keeps", "an", "accessible", "version", "for", "each", "non", "-", "accessible", "member", "whose", "value", "needs", "to", "be", "accessed", "during", "validation", ".", "*", "/", "private", "final", "ConcurrentMap", "<", "Member", ",", "Member", ">", "accessibleMembers", ";", "this", ".", "accessibleMembers", "=", "new", "ConcurrentReferenceHashMap", "<", "Member", ",", "Member", ">", "(", "100", ",", "ReferenceType", ".", "SOFT", ",", "ReferenceType", ".", "SOFT", ")", ";", "Object", "valueToValidate", "=", "getValue", "(", "metaConstraint", ".", "getLocation", "(", ").", "getMember", "(", "),", "valueContext", ".", "getCurrentBean", "(", ")", ")", ";", "Object", "value", "=", "getValue", "(", "valueContext", ".", "getCurrentBean", "(", "),", "cascadable", ")", ";", "newValue", "=", "newValue", "=", "=", "null", "?", "null", ":", "getValue", "(", "newValue", ",", "property", ")", ";", "private", "Object", "getValue", "(", "Object", "object", ",", "Cascadable", "cascadable", ")", "{", "if", "(", "cascadable", "instanceof", "PropertyMetaData", ")", "{", "Member", "member", "=", "getAccessible", "(", "(", "(", "PropertyMetaData", ")", "cascadable", ")", ".", "getCascadingMember", "(", ")", ")", ";", "return", "getValue", "(", "member", ",", "object", ")", ";", "}", "else", "if", "(", "cascadable", "instanceof", "ParameterMetaData", ")", "{", "return", "(", "(", "Object", "[", "])", "object", ")", "[(", "(", "ParameterMetaData", ")", "cascadable", ")", ".", "getIndex", "(", ")]", ";", "}", "else", "{", "return", "object", ";", "}", "}", "private", "Object", "getValue", "(", "Member", "member", ",", "Object", "object", ")", "{", "if", "(", "member", "=", "=", "null", ")", "{", "return", "object", ";", "}", "member", "=", "getAccessible", "(", "member", ")", ";", "if", "(", "member", "instanceof", "Method", ")", "{", "return", "ReflectionHelper", ".", "getValue", "(", "(", "Method", ")", "member", ",", "object", ")", ";", "}", "else", "if", "(", "member", "instanceof", "Field", ")", "{", "return", "ReflectionHelper", ".", "getValue", "(", "(", "Field", ")", "member", ",", "object", ")", ";", "}", "return", "null", ";", "}", "/", "**", "*", "Returns", "an", "accessible", "version", "of", "the", "given", "member", ".", "Will", "be", "the", "given", "member", "itself", "in", "case", "it", "is", "accessible", ",", "*", "otherwise", "a", "copy", "which", "is", "set", "accessible", ".", "These", "copies", "are", "maintained", "in", "the", "*", "{", "@", "link", "ValidatorImpl", "#", "accessibleMembers", "}", "cache", ".", "*", "/", "private", "Member", "getAccessible", "(", "Member", "original", ")", "{", "if", "(", "(", "(", "AccessibleObject", ")", "original", ")", ".", "isAccessible", "(", ")", ")", "{", "return", "original", ";", "}", "Member", "member", "=", "accessibleMembers", ".", "get", "(", "original", ")", ";", "if", "(", "member", "!", "=", "null", ")", "{", "return", "member", ";", "}", "Class", "<", "?>", "clazz", "=", "original", ".", "getDeclaringClass", "(", ");", "if", "(", "original", "instanceof", "Field", ")", "{", "member", "=", "run", "(", "GetDeclaredField", ".", "action", "(", "clazz", ",", "original", ".", "getName", "(", ")", ")", ")", ";", "}", "else", "{", "member", "=", "run", "(", "GetDeclaredMethod", ".", "action", "(", "clazz", ",", "original", ".", "getName", "(", ")", ")", ")", ";", "}", "run", "(", "SetAccessibility", ".", "action", "(", "member", ")", ")", ";", "Member", "cached", "=", "accessibleMembers", ".", "putIfAbsent", "(", "original", ",", "member", ")", ";", "if", "(", "cached", "!", "=", "null", ")", "{", "member", "=", "cached", ";", "}", "return", "member", ";", "}", "/", "**", "*", "Runs", "the", "given", "privileged", "action", ",", "using", "a", "privileged", "block", "if", "required", ".", "*", "<", "p", ">", "*", "<", "b", ">", "NOTE", ":", "</", "b", ">", "This", "must", "never", "be", "changed", "into", "a", "publicly", "available", "method", "to", "avoid", "execution", "of", "arbitrary", "*", "privileged", "actions", "within", "HV", "'", "s", "protection", "domain", ".", "*", "/", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "ReflectionHelper", ".", "getValue", "(", "persistenceUtilGetter", ",", "persistence", ")", ";", "public", "Member", "getCascadingMember", "(", ")", "{", "return", "cascadingMember", ";</s>Object", "valueToValidate", "=", "metaConstraint", ".", "getValue", "(", "valueContext", ".", "getCurrentBean", "(", ")", ")", ";", "Object", "value", "=", "cascadable", ".", "getValue", "(", "valueContext", ".", "getCurrentBean", "(", ")", ")", ";", "newValue", "=", "newValue", "=", "=", "null", "?", "null", ":", "property", ".", "getValue", "(", "newValue", ")", ";", "ReflectionHelper", ".", "getValue", "(", "persistenceUtilGetter", ",", "persistence", ")", ";", "@", "Override", "public", "Object", "getValue", "(", "Object", "parent", ")", "{", "return", "(", "(", "Object", "[", "])", "parent", ")", "[", "index", "]", ";", "}", "@", "Override", "public", "Object", "getValue", "(", "Object", "parent", ")", "{", "return", "ReflectionHelper", ".", "getValue", "(", "cascadingMember", ",", "parent", ")", ";", "@", "Override", "public", "Object", "getValue", "(", "Object", "parent", ")", "{", "return", "parent", ";", "}", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "ReflectionHelper", ";", "/", "**", "*", "@", "param", "o", "the", "object", "from", "which", "to", "retrieve", "the", "value", ".", "*", "*", "@", "return", "Returns", "the", "value", "for", "this", "constraint", "from", "the", "specified", "object", ".", "Depending", "on", "the", "type", "either", "the", "value", "itself", "*", "is", "returned", "of", "method", "or", "field", "access", "is", "used", "to", "access", "the", "value", ".", "*", "/", "public", "Object", "getValue", "(", "Object", "o", ")", "{", "if", "(", "location", ".", "getMember", "(", ")", "=", "=", "null", ")", "{", "return", "o", ";", "}", "else", "{", "return", "ReflectionHelper", ".", "getValue", "(", "location", ".", "getMember", "(", "),", "o", ")", ";", "}", "}", "/", "**", "*", "Retrieves", "the", "value", "of", "this", "element", "from", "the", "given", "object", ".", "*", "*", "@", "param", "parent", "The", "object", "to", "retrieve", "the", "value", "from", ".", "*", "*", "@", "return", "This", "element", "'", "s", "value", ".", "*", "/", "Object", "getValue", "(", "Object", "parent", ")", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "SetAccessibility", ";", "if", "(", "isConstrained", "(", ")", ")", "{", "run", "(", "SetAccessibility", ".", "action", "(", "location", ".", "getMember", "(", ")", ")", ")", ";", "}", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}", "import", "java", ".", "lang", ".", "reflect", ".", "Member", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "internal", ".", "util", ".", "privilegedactions", ".", "SetAccessibility", ";", "Member", "member", "=", "location", ".", "getMember", "(", ");", "if", "(", "member", "!", "=", "null", "&", "&", "isConstrained", "(", ")", ")", "{", "run", "(", "SetAccessibility", ".", "action", "(", "member", ")", ")", ";", "}", "private", "<", "T", ">", "T", "run", "(", "PrivilegedAction", "<", "T", ">", "action", ")", "{", "return", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "?", "AccessController", ".", "doPrivileged", "(", "action", ")", ":", "action", ".", "run", "(", ");", "}"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["avcodec/pngdec:", "Check", "trns", "more", "completely", "Fixes", "out", "of", "array", "access", "Fixes:", "546/clusterfuzz-testcase-4809433909559296", "Found-by:", "continuous", "fuzzing", "process", "https://github.com/google/oss-fuzz/tree/master/targets/ffmpeg", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["if", "(", "!(", "s", "-", ">", "state", "&", "PNG_IHDR", ")", ")", "{", "av_log", "(", "avctx", ",", "AV_LOG_ERROR", ",", "\"", "trns", "before", "IHDR", "\\", "n", "\"", ");", "return", "AVERROR_INVALIDDATA", ";", "}", "if", "(", "s", "-", ">", "state", "&", "PNG_IDAT", ")", "{", "av_log", "(", "avctx", ",", "AV_LOG_ERROR", ",", "\"", "trns", "after", "IDAT", "\\", "n", "\"", ");", "return", "AVERROR_INVALIDDATA", ";", "}", "(", "s", "-", ">", "color_type", "=", "=", "PNG_COLOR_TYPE_RGB", "&", "&", "length", "!", "=", "6", ")", "|", "|", "s", "-", ">", "bit_depth", "=", "=", "1", ")", "av_assert0", "(", "s", "-", ">", "bit_depth", ">", "1", ")", ";</s>(", "s", "-", ">", "color_type", "=", "=", "PNG_COLOR_TYPE_RGB", "&", "&", "length", "!", "=", "6", ")", ")"], "docstring_tokens": ["using", "a", "specially-crafted", "file"]}
{"contents": ["crypto:", "algif", "-", "suppress", "sending", "source", "address", "information", "in", "recvmsg", "The", "current", "code", "does", "not", "set", "the", "msg_namelen", "member", "to", "0", "and", "therefore", "makes", "net/socket.c", "leak", "the", "local", "sockaddr_storage", "variable", "to", "userland", "--", "128", "bytes", "of", "kernel", "stack", "memory.", "Fix", "that.", "Cc:", "<stable@vger.kernel.org>", "#", "2.6.38", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>"], "code_tokens": ["msg", "-", ">", "msg_namelen", "=", "0", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";</s>"], "docstring_tokens": ["using", "recvmsg(2)/recvfrom(2)"]}
{"contents": ["ext4:", "always", "initialize", "the", "crc32c", "checksum", "driver", "The", "extended", "attribute", "code", "now", "uses", "the", "crc32c", "checksum", "for", "hashing", "purposes,", "so", "we", "should", "just", "always", "always", "initialize", "it.", "We", "also", "want", "to", "prevent", "NULL", "pointer", "dereferences", "if", "one", "of", "the", "metadata", "checksum", "features", "is", "enabled", "after", "the", "file", "sytsem", "is", "originally", "mounted.", "This", "issue", "has", "been", "assigned", ".", "https://bugzilla.kernel.org/show_bug.cgi?id=199183", "https://bugzilla.redhat.com/show_bug.cgi?id=1560788", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>", "Cc:", "stable@vger.kernel.org"], "code_tokens": ["sbi", "-", ">", "s_chksum_driver", "=", "crypto_alloc_shash", "(", "\"", "crc32c", "\"", ",", "0", ",", "0", ")", ";", "if", "(", "IS_ERR", "(", "sbi", "-", ">", "s_chksum_driver", ")", ")", "{", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "Cannot", "load", "crc32c", "driver", ".", "\")", ";", "ret", "=", "PTR_ERR", "(", "sbi", "-", ">", "s_chksum_driver", ")", ";", "sbi", "-", ">", "s_chksum_driver", "=", "NULL", ";", "goto", "failed_mount", ";</s>if", "(", "ext4_has_feature_metadata_csum", "(", "sb", ")", "|", "|", "ext4_has_feature_ea_inode", "(", "sb", ")", ")", "{", "sbi", "-", ">", "s_chksum_driver", "=", "crypto_alloc_shash", "(", "\"", "crc32c", "\"", ",", "0", ",", "0", ")", ";", "if", "(", "IS_ERR", "(", "sbi", "-", ">", "s_chksum_driver", ")", ")", "{", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "Cannot", "load", "crc32c", "driver", ".", "\")", ";", "ret", "=", "PTR_ERR", "(", "sbi", "-", ">", "s_chksum_driver", ")", ";", "sbi", "-", ">", "s_chksum_driver", "=", "NULL", ";", "goto", "failed_mount", ";", "}"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "file"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/99"], "code_tokens": ["pixels", "=", "(", "unsigned", "char", "*", ")", "AcquireQuantumMemory", "(", "MagickMax", "(", "number_pixels", ",", "max_packets", ")", ",", "bytes_per_pixel", "*", "sizeof", "(", "*", "pixels", ")", ");</s>pixels", "=", "(", "unsigned", "char", "*", ")", "AcquireQuantumMemory", "(", "max_packets", ",", "bytes_per_pixel", "*", "sizeof", "(", "*", "pixels", ")", ");"], "docstring_tokens": ["via", "a", "crafted", "VIFF", "file", "."]}
{"contents": ["Allow", "a", "limit", "to", "be", "set", "on", "the", "decompressed", "buffer", "size", "for", "ZlibDecoders", "(#9924)", "Motivation:", "It", "is", "impossible", "to", "know", "in", "advance", "how", "much", "memory", "will", "be", "needed", "to", "decompress", "a", "stream", "of", "bytes", "that", "was", "compressed", "using", "the", "DEFLATE", "algorithm.", "In", "theory,", "up", "to", "1032", "times", "the", "compressed", "size", "could", "be", "needed.", "For", "untrusted", "input,", "an", "attacker", "could", "exploit", "this", "to", "exhaust", "the", "memory", "pool.", "Modifications:", "ZlibDecoder", "and", "its", "subclasses", "now", "support", "an", "optional", "limit", "on", "the", "size", "of", "the", "decompressed", "buffer.", "By", "default,", "if", "the", "limit", "is", "reached,", "decompression", "stops", "and", "a", "DecompressionException", "is", "thrown.", "Behavior", "upon", "reaching", "the", "limit", "is", "modifiable", "by", "subclasses", "in", "case", "they", "desire", "something", "else.", "Result:", "The", "decompressed", "buffer", "can", "now", "be", "limited", "to", "a", "configurable", "size,", "thus", "mitigating", "the", "possibility", "of", "memory", "pool", "exhaustion."], "code_tokens": ["import", "io", ".", "netty", ".", "buffer", ".", "ByteBufAllocator", ";", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "0", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "instance", "with", "the", "default", "wrapper", "(", "{@", "link", "ZlibWrapper", "#", "ZLIB", "}", ")", "*", "and", "specified", "maximum", "buffer", "allocation", ".", "*", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "*", "@", "throws", "DecompressionException", "if", "failed", "to", "initialize", "zlib", "*", "/", "public", "JZlibDecoder", "(", "int", "maxAllocation", ")", "{", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "maxAllocation", ")", ";", "this", "(", "wrapper", ",", "0", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "instance", "with", "the", "specified", "wrapper", "and", "maximum", "buffer", "allocation", ".", "*", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "*", "@", "throws", "DecompressionException", "if", "failed", "to", "initialize", "zlib", "*", "/", "public", "JZlibDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", "{", "super", "(", "maxAllocation", ")", ";", "this", "(", "dictionary", ",", "0", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "instance", "with", "the", "specified", "preset", "dictionary", "and", "maximum", "buffer", "allocation", ".", "*", "The", "wrapper", "is", "always", "{", "@", "link", "ZlibWrapper", "#", "ZLIB", "}", "because", "it", "is", "the", "only", "format", "that", "*", "supports", "the", "preset", "dictionary", ".", "*", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "*", "@", "throws", "DecompressionException", "if", "failed", "to", "initialize", "zlib", "*", "/", "public", "JZlibDecoder", "(", "byte", "[", "]", "dictionary", ",", "int", "maxAllocation", ")", "{", "super", "(", "maxAllocation", ")", ";", "this", ".", "dictionary", "=", "requireNonNull", "(", "dictionary", ",", "\"", "dictionary", "\"", ");", "ByteBuf", "decompressed", "=", "prepareDecompressBuffer", "(", "ctx", ",", "null", ",", "inputLength", "<", "<", "1", ")", ";", "decompressed", "=", "prepareDecompressBuffer", "(", "ctx", ",", "decompressed", ",", "z", ".", "avail_in", "<", "<", "1", ")", ";", "@", "Override", "protected", "void", "decompressionBufferExhausted", "(", "ByteBuf", "buffer", ")", "{", "finished", "=", "true", ";", "}", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBufAllocator", ";", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "null", ",", "false", ",", "0", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "instance", "with", "the", "default", "wrapper", "(", "{@", "link", "ZlibWrapper", "#", "ZLIB", "}", ")", "*", "and", "the", "specified", "maximum", "buffer", "allocation", ".", "*", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "/", "public", "JdkZlibDecoder", "(", "int", "maxAllocation", ")", "{", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "null", ",", "false", ",", "maxAllocation", ")", ";", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "dictionary", ",", "false", ",", "0", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "instance", "with", "the", "specified", "preset", "dictionary", "and", "maximum", "buffer", "allocation", ".", "*", "The", "wrapper", "is", "always", "{", "@", "link", "ZlibWrapper", "#", "ZLIB", "}", "because", "it", "is", "the", "only", "format", "that", "*", "supports", "the", "preset", "dictionary", ".", "*", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "/", "public", "JdkZlibDecoder", "(", "byte", "[", "]", "dictionary", ",", "int", "maxAllocation", ")", "{", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "dictionary", ",", "false", ",", "maxAllocation", ")", ";", "this", "(", "wrapper", ",", "null", ",", "false", ",", "0", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "instance", "with", "the", "specified", "wrapper", "and", "maximum", "buffer", "allocation", ".", "*", "Be", "aware", "that", "only", "{", "@", "link", "ZlibWrapper", "#", "GZIP", "}", ",", "{", "@", "link", "ZlibWrapper", "#", "ZLIB", "}", "and", "{", "@", "link", "ZlibWrapper", "#", "NONE", "}", "are", "*", "supported", "atm", ".", "*", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "/", "public", "JdkZlibDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", "{", "this", "(", "wrapper", ",", "null", ",", "false", ",", "maxAllocation", ")", ";", "this", "(", "wrapper", ",", "null", ",", "decompressConcatenated", ",", "0", ")", ";", "}", "public", "JdkZlibDecoder", "(", "ZlibWrapper", "wrapper", ",", "boolean", "decompressConcatenated", ",", "int", "maxAllocation", ")", "{", "this", "(", "wrapper", ",", "null", ",", "decompressConcatenated", ",", "maxAllocation", ")", ";", "this", "(", "ZlibWrapper", ".", "GZIP", ",", "null", ",", "decompressConcatenated", ",", "0", ")", ";", "}", "public", "JdkZlibDecoder", "(", "boolean", "decompressConcatenated", ",", "int", "maxAllocation", ")", "{", "this", "(", "ZlibWrapper", ".", "GZIP", ",", "null", ",", "decompressConcatenated", ",", "maxAllocation", ")", ";", "private", "JdkZlibDecoder", "(", "ZlibWrapper", "wrapper", ",", "byte", "[", "]", "dictionary", ",", "boolean", "decompressConcatenated", ",", "int", "maxAllocation", ")", "{", "super", "(", "maxAllocation", ")", ";", "ByteBuf", "decompressed", "=", "prepareDecompressBuffer", "(", "ctx", ",", "null", ",", "inflater", ".", "getRemaining", "(", ")", "<", "<", "1", ")", ";", "decompressed", "=", "prepareDecompressBuffer", "(", "ctx", ",", "decompressed", ",", "inflater", ".", "getRemaining", "(", ")", "<", "<", "1", ")", ";", "@", "Override", "protected", "void", "decompressionBufferExhausted", "(", "ByteBuf", "buffer", ")", "{", "finished", "=", "true", ";", "}", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBufAllocator", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandlerContext", ";", "/", "**", "*", "Maximum", "allowed", "size", "of", "the", "decompression", "buffer", ".", "*", "/", "protected", "final", "int", "maxAllocation", ";", "/", "**", "*", "Same", "as", "{", "@", "link", "#", "ZlibDecoder", "(", "int", ")", "}", "with", "maxAllocation", "=", "0", ".", "*", "/", "public", "ZlibDecoder", "(", ")", "{", "this", "(", "0", ")", ";", "}", "/", "**", "*", "Construct", "a", "new", "ZlibDecoder", ".", "*", "@", "param", "maxAllocation", "*", "Maximum", "size", "of", "the", "decompression", "buffer", ".", "Must", "be", "&", "gt", ";", "=", "0", ".", "*", "If", "zero", ",", "maximum", "size", "is", "decided", "by", "the", "{", "@", "link", "ByteBufAllocator", "}", ".", "*", "/", "public", "ZlibDecoder", "(", "int", "maxAllocation", ")", "{", "if", "(", "maxAllocation", "<", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "maxAllocation", "must", "be", ">", "=", "0", "\"", ");", "}", "this", ".", "maxAllocation", "=", "maxAllocation", ";", "}", "/", "**", "*", "Allocate", "or", "expand", "the", "decompression", "buffer", ",", "without", "exceeding", "the", "maximum", "allocation", ".", "*", "Calls", "{", "@", "link", "#", "decompressionBufferExhausted", "(", "ByteBuf", ")", "}", "if", "the", "buffer", "is", "full", "and", "cannot", "be", "expanded", "further", ".", "*", "/", "protected", "ByteBuf", "prepareDecompressBuffer", "(", "ChannelHandlerContext", "ctx", ",", "ByteBuf", "buffer", ",", "int", "preferredSize", ")", "{", "if", "(", "buffer", "=", "=", "null", ")", "{", "if", "(", "maxAllocation", "=", "=", "0", ")", "{", "return", "ctx", ".", "alloc", "(", ").", "heapBuffer", "(", "preferredSize", ")", ";", "}", "return", "ctx", ".", "alloc", "(", ").", "heapBuffer", "(", "Math", ".", "min", "(", "preferredSize", ",", "maxAllocation", ")", ",", "maxAllocation", ")", ";", "}", "/", "/", "this", "always", "expands", "the", "buffer", "if", "possible", ",", "even", "if", "the", "expansion", "is", "less", "than", "preferredSize", "/", "/", "we", "throw", "the", "exception", "only", "if", "the", "buffer", "could", "not", "be", "expanded", "at", "all", "/", "/", "this", "means", "that", "one", "final", "attempt", "to", "deserialize", "will", "always", "be", "made", "with", "the", "buffer", "at", "maxAllocation", "if", "(", "buffer", ".", "ensureWritable", "(", "preferredSize", ",", "true", ")", "=", "=", "1", ")", "{", "/", "/", "buffer", "must", "be", "consumed", "so", "subclasses", "don", "'", "t", "add", "it", "to", "output", "/", "/", "we", "therefore", "duplicate", "it", "when", "calling", "decompressionBufferExhausted", "(", ")", "to", "guarantee", "non", "-", "interference", "/", "/", "but", "wait", "until", "after", "to", "consume", "it", "so", "the", "subclass", "can", "tell", "how", "much", "output", "is", "really", "in", "the", "buffer", "decompressionBufferExhausted", "(", "buffer", ".", "duplicate", "(", "))", ";", "buffer", ".", "skipBytes", "(", "buffer", ".", "readableBytes", "(", "))", ";", "throw", "new", "DecompressionException", "(", "\"", "Decompression", "buffer", "has", "reached", "maximum", "size", ":", "\"", "+", "buffer", ".", "maxCapacity", "(", "))", ";", "}", "return", "buffer", ";", "}", "/", "**", "*", "Called", "when", "the", "decompression", "buffer", "cannot", "be", "expanded", "further", ".", "*", "Default", "implementation", "is", "a", "no", "-", "op", ",", "but", "subclasses", "can", "override", "in", "case", "they", "want", "to", "*", "do", "something", "before", "the", "{", "@", "link", "DecompressionException", "}", "is", "thrown", ",", "such", "as", "log", "the", "*", "data", "that", "was", "decompressed", "so", "far", ".", "*", "/", "protected", "void", "decompressionBufferExhausted", "(", "ByteBuf", "buffer", ")", "{", "}", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", "{", "return", "new", "JZlibDecoder", "(", "wrapper", ",", "maxAllocation", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", "{", "return", "new", "JdkZlibDecoder", "(", "wrapper", ",", "maxAllocation", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", "{", "return", "new", "JZlibDecoder", "(", "wrapper", ",", "maxAllocation", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", "{", "return", "new", "JdkZlibDecoder", "(", "wrapper", ",", "maxAllocation", ")", ";", "import", "io", ".", "netty", ".", "buffer", ".", "AbstractByteBufAllocator", ";", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBufAllocator", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ")", "{", "return", "createDecoder", "(", "wrapper", ",", "0", ")", ";", "}", "protected", "abstract", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ",", "int", "maxAllocation", ")", ";", "@", "Test", "public", "void", "testMaxAllocation", "(", ")", "throws", "Exception", "{", "int", "maxAllocation", "=", "1024", ";", "ZlibDecoder", "decoder", "=", "createDecoder", "(", "ZlibWrapper", ".", "ZLIB", ",", "maxAllocation", ")", ";", "EmbeddedChannel", "chDecoder", "=", "new", "EmbeddedChannel", "(", "decoder", ")", ";", "TestByteBufAllocator", "alloc", "=", "new", "TestByteBufAllocator", "(", "chDecoder", ".", "alloc", "(", "))", ";", "chDecoder", ".", "config", "(", ").", "setAllocator", "(", "alloc", ")", ";", "try", "{", "chDecoder", ".", "writeInbound", "(", "Unpooled", ".", "wrappedBuffer", "(", "deflate", "(", "BYTES_LARGE", ")", "))", ";", "fail", "(", "\"", "decompressed", "size", ">", "maxAllocation", ",", "so", "should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "DecompressionException", "e", ")", "{", "assertTrue", "(", "e", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "Decompression", "buffer", "has", "reached", "maximum", "size", "\"", "))", ";", "assertEquals", "(", "maxAllocation", ",", "alloc", ".", "getMaxAllocation", "(", "))", ";", "assertTrue", "(", "decoder", ".", "isClosed", "(", "))", ";", "assertFalse", "(", "chDecoder", ".", "finish", "(", "))", ";", "}", "}", "private", "static", "final", "class", "TestByteBufAllocator", "extends", "AbstractByteBufAllocator", "{", "private", "ByteBufAllocator", "wrapped", ";", "private", "int", "maxAllocation", ";", "TestByteBufAllocator", "(", "ByteBufAllocator", "wrapped", ")", "{", "this", ".", "wrapped", "=", "wrapped", ";", "}", "public", "int", "getMaxAllocation", "(", ")", "{", "return", "maxAllocation", ";", "}", "@", "Override", "public", "boolean", "isDirectBufferPooled", "(", ")", "{", "return", "wrapped", ".", "isDirectBufferPooled", "(", ");", "}", "@", "Override", "protected", "ByteBuf", "newHeapBuffer", "(", "int", "initialCapacity", ",", "int", "maxCapacity", ")", "{", "maxAllocation", "=", "Math", ".", "max", "(", "maxAllocation", ",", "maxCapacity", ")", ";", "return", "wrapped", ".", "heapBuffer", "(", "initialCapacity", ",", "maxCapacity", ")", ";", "}", "@", "Override", "protected", "ByteBuf", "newDirectBuffer", "(", "int", "initialCapacity", ",", "int", "maxCapacity", ")", "{", "maxAllocation", "=", "Math", ".", "max", "(", "maxAllocation", ",", "maxCapacity", ")", ";", "return", "wrapped", ".", "directBuffer", "(", "initialCapacity", ",", "maxCapacity", ")", ";", "}", "}</s>this", "(", "ZlibWrapper", ".", "ZLIB", ")", ";", "requireNonNull", "(", "dictionary", ",", "\"", "dictionary", "\"", ");", "this", ".", "dictionary", "=", "dictionary", ";", "ByteBuf", "decompressed", "=", "ctx", ".", "alloc", "(", ").", "heapBuffer", "(", "inputLength", "<", "<", "1", ")", ";", "decompressed", ".", "ensureWritable", "(", "z", ".", "avail_in", "<", "<", "1", ")", ";", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "null", ",", "false", ")", ";", "this", "(", "ZlibWrapper", ".", "ZLIB", ",", "dictionary", ",", "false", ")", ";", "this", "(", "wrapper", ",", "null", ",", "false", ")", ";", "this", "(", "wrapper", ",", "null", ",", "decompressConcatenated", ")", ";", "this", "(", "ZlibWrapper", ".", "GZIP", ",", "null", ",", "decompressConcatenated", ")", ";", "private", "JdkZlibDecoder", "(", "ZlibWrapper", "wrapper", ",", "byte", "[", "]", "dictionary", ",", "boolean", "decompressConcatenated", ")", "{", "ByteBuf", "decompressed", "=", "ctx", ".", "alloc", "(", ").", "heapBuffer", "(", "inflater", ".", "getRemaining", "(", ")", "<", "<", "1", ")", ";", "decompressed", ".", "ensureWritable", "(", "inflater", ".", "getRemaining", "(", ")", "<", "<", "1", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ")", "{", "return", "new", "JZlibDecoder", "(", "wrapper", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ")", "{", "return", "new", "JdkZlibDecoder", "(", "wrapper", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ")", "{", "return", "new", "JZlibDecoder", "(", "wrapper", ")", ";", "protected", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ")", "{", "return", "new", "JdkZlibDecoder", "(", "wrapper", ")", ";", "protected", "abstract", "ZlibDecoder", "createDecoder", "(", "ZlibWrapper", "wrapper", ")", ";"], "docstring_tokens": ["sending", "a", "large", "ZlibEncoded", "byte", "stream"]}
{"contents": ["CAMEL-10604", "-", "Camel-JacksonXML:", "Add", "an", "option", "to", "allow", "the", "UnmarshallType", "header", "use"], "code_tokens": ["@", "XmlAttribute", "private", "Boolean", "allowUnmarshallType", ";", "public", "Boolean", "getAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "*", "<", "p", "/", ">", "*", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "public", "void", "setAllowUnmarshallType", "(", "Boolean", "allowUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowUnmarshallType", ";", "}", "if", "(", "allowUnmarshallType", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "allowUnmarshallType", "\"", ",", "allowUnmarshallType", ")", ";", "}", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "*", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "*", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "private", "Boolean", "allowUnmarshallType", "=", "false", ";", "public", "Boolean", "getAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "public", "void", "setAllowUnmarshallType", "(", "Boolean", "allowUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowUnmarshallType", ";", "}", "The", "JacksonXML", "dataformat", "supports", "14", "options", "which", "are", "listed", "below", ".", "|", "allowUnmarshallType", "|", "false", "|", "Boolean", "|", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "private", "boolean", "allowUnmarshallType", ";", "String", "type", "=", "null", ";", "if", "(", "allowUnmarshallType", ")", "{", "type", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "JacksonXMLConstants", ".", "UNMARSHAL_TYPE", ",", "String", ".", "class", ")", ";", "}", "public", "boolean", "isAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "*", "<", "p", "/", ">", "*", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "public", "void", "setAllowUnmarshallType", "(", "boolean", "allowJacksonUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowJacksonUnmarshallType", ";", "}", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "jacksonxml", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "JacksonMarshalUnmarshalTypeHeaderNotAllowedTest", "extends", "CamelTestSupport", "{", "@", "Test", "public", "void", "testUnmarshalPojo", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "reversePojo", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "String", "json", "=", "\"", "<", "pojo", "name", "=", "\\\"", "Camel", "\\", "\"/", ">\"", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "backPojo", "\"", ",", "json", ",", "JacksonXMLConstants", ".", "UNMARSHAL_TYPE", ",", "TestPojo", ".", "class", ".", "getName", "(", "))", ";", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "JacksonXMLDataFormat", "format", "=", "new", "JacksonXMLDataFormat", "(", ");", "from", "(", "\"", "direct", ":", "backPojo", "\"", ").", "unmarshal", "(", "format", ")", ".", "to", "(", "\"", "mock", ":", "reversePojo", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "46", ",", "6", "+", "46", ",", "7", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "format", ".", "setAllowUnmarshallType", "(", "true", ")", ";</s>The", "JacksonXML", "dataformat", "supports", "13", "options", "which", "are", "listed", "below", ".", "String", "type", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "JacksonXMLConstants", ".", "UNMARSHAL_TYPE", ",", "String", ".", "class", ")", ";"], "docstring_tokens": ["using", "de-serializing", "untrusted", "data"]}
{"contents": ["Security", "fixes"], "code_tokens": ["private", "static", "final", "String", "[", "]", "FEATURE_DEFAULTS", "=", "new", "String", "[", "]", "{", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "#", "true", "\"", ",", "/", "/", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "#", "false", "\"", ",", "/", "/", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "#", "false", "\"", ",", "/", "/", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "nonvalidating", "/", "load", "-", "external", "-", "dtd", "#", "false", "\"", "}", ";", "throw", "new", "XBException", "(", "\"", "Error", "on", "creating", "document", "builder", "\"", ",", "e", ")", ";", "instance", ".", "setXIncludeAware", "(", "false", ")", ";", "for", "(", "String", "featureDefault", ":", "FEATURE_DEFAULTS", ")", "{", "String", "[", "]", "featureValue", "=", "featureDefault", ".", "split", "(", "\"#", "\")", ";", "try", "{", "instance", ".", "setFeature", "(", "featureValue", "[", "0", "]", ",", "Boolean", ".", "valueOf", "(", "featureValue", "[", "1", "]", "))", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "/", "/", "No", "worries", "if", "one", "feature", "is", "not", "supported", ".", "}", "}", "throw", "new", "XBException", "(", "\"", "Error", "on", "creating", "transformer", "\"", ",", "e", ")", ";</s>throw", "new", "RuntimeException", "(", "e", ")", ";", "throw", "new", "RuntimeException", "(", "e", ")", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request", "parameter"]}
{"contents": ["Issue", "#2529", "RFC2616", "vs", "RFC7230", "cleanup", "Signed-off-by:", "Greg", "Wilkins", "<gregw@webtide.com>"], "code_tokens": ["import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "CARRIAGE_RETURN", ";", "import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "LINE_FEED", ";", "import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "SPACE", ";", "import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "TAB", ";", "private", "final", "static", "int", "MAX_CHUNK_LENGTH", "=", "Integer", ".", "MAX_VALUE", "/", "16", "-", "16", ";", "private", "boolean", "_hasContentLength", ";", "this", "(", "code", ",", "message", ",", "null", ")", ";", "}", "private", "BadMessageException", "(", "int", "code", ",", "String", "message", ",", "Throwable", "cause", ")", "{", "super", "(", "message", ",", "cause", ")", ";", "{", "else", "if", "(", "ch", "!", "='", "\\", "n", "'", ")", "else", "if", "(", "version", "!", "=", "HttpVersion", ".", "HTTP_1_0", "&", "&", "version", "!", "=", "HttpVersion", ".", "HTTP_1_1", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Version", "\"", ");", "if", "(", "_version", "!", "=", "HttpVersion", ".", "HTTP_1_0", "&", "&", "_version", "!", "=", "HttpVersion", ".", "HTTP_1_1", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Version", "\"", ");", "if", "(", "_connectionFields", "=", "=", "null", "&", "&", "_version", ".", "getVersion", "(", ")=", "=", "HttpVersion", ".", "HTTP_1_1", ".", "getVersion", "(", "))", "if", "(", "_hasContentLength", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Lengths", "\"", ");", "_hasContentLength", "=", "true", ";", "if", "(", "_endOfContent", "=", "=", "EndOfContent", ".", "CHUNKED_CONTENT", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Length", "\"", ");", "try", "_contentLength", "=", "Long", ".", "parseLong", "(", "_valueString", ")", ";", "catch", "(", "NumberFormatException", "e", ")", "{", "LOG", ".", "ignore", "(", "e", ")", ";", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Length", "\"", ");", "}", "if", "(", "_contentLength", "<", "=", "0", ")", "_endOfContent", "=", "EndOfContent", ".", "NO_CONTENT", ";", "else", "_endOfContent", "=", "EndOfContent", ".", "CONTENT_LENGTH", ";", "if", "(", "_hasContentLength", "&", "&", "_endOfContent", "=", "=", "EndOfContent", ".", "CHUNKED_CONTENT", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "chunking", "\"", ");", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Host", "header", "\"", ",", "e", ")", ";", "{", "}", "{", "if", "(", "_chunkLength", ">", "MAX_CHUNK_LENGTH", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "REQUEST_ENTITY_TOO_LARGE_413", ")", ";", "}", "_hasContentLength", "=", "false", ";", "@", "Test", "public", "void", "testAllowedLinePreamble", "(", ")", "throws", "Exception", "{", "ByteBuffer", "buffer", "=", "BufferUtil", ".", "toBuffer", "(", "\"\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "HTTP", "/", "1", ".", "0", "\\", "r", "\\", "n", "\"", ");", "HttpParser", ".", "RequestHandler", "<", "ByteBuffer", ">", "handler", "=", "new", "Handler", "(", ");", "HttpParser", "parser", "=", "new", "HttpParser", "(", "handler", ")", ";", "parseAll", "(", "parser", ",", "buffer", ")", ";", "assertEquals", "(", "\"", "GET", "\"", ",", "_methodOrVersion", ")", ";", "assertEquals", "(", "\"/", "\",", "_uriOrStatus", ")", ";", "assertEquals", "(", "\"", "HTTP", "/", "1", ".", "0", "\"", ",", "_versionOrReason", ")", ";", "assertEquals", "(", "-", "1", ",", "_headers", ")", ";", "}", "@", "Test", "public", "void", "testDisallowedLinePreamble", "(", ")", "throws", "Exception", "{", "ByteBuffer", "buffer", "=", "BufferUtil", ".", "toBuffer", "(", "\"\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "HTTP", "/", "1", ".", "0", "\\", "r", "\\", "n", "\"", ");", "HttpParser", ".", "RequestHandler", "<", "ByteBuffer", ">", "handler", "=", "new", "Handler", "(", ");", "HttpParser", "parser", "=", "new", "HttpParser", "(", "handler", ")", ";", "parseAll", "(", "parser", ",", "buffer", ")", ";", "assertEquals", "(", "\"", "400", "\"", ",", "_bad", ")", ";", "}", "}", "assertEquals", "(", "\"", "Bad", "Version", "\"", ",", "_bad", ")", ";", "if", "(", "_state", ".", "unhandle", "(", ")=", "=", "Action", ".", "COMPLETE", ")", "_state", ".", "completed", "(", ");", "catch", "(", "Throwable", "e", ")", "_transport", ".", "abort", "(", ");", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CountDownLatch", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTester", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "anyOf", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "isEmptyOrNullString", ";", "HttpConfiguration", "config", "=", "new", "HttpConfiguration", "(", ");", "config", ".", "setRequestHeaderSize", "(", "1024", ")", ";", "config", ".", "setResponseHeaderSize", "(", "1024", ")", ";", "config", ".", "setSendDateHeader", "(", "true", ")", ";", "HttpConnectionFactory", "http", "=", "new", "HttpConnectionFactory", "(", "config", ")", ";", "/", "**", "*", "HTTP", "/", "0", ".", "9", "does", "not", "support", "HttpVersion", "(", "this", "is", "a", "bad", "request", ")", "*", "/", "@", "Test", "public", "void", "testHttp09_NoVersion", "(", ")", "throws", "Exception", "{", "String", "request", "=", "\"", "GET", "/", "HTTP", "/", "0", ".", "9", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "String", "response", "=", "connector", ".", "getResponses", "(", "request", ")", ";", "assertThat", "(", "response", ",", "containsString", "(", "\"", "400", "Bad", "Version", "\"", "))", ";", "}", "/", "**", "*", "HTTP", "/", "0", ".", "9", "does", "not", "support", "headers", "*", "/", "@", "Test", "public", "void", "testHttp09_NoHeaders", "(", ")", "throws", "Exception", "{", "/", "/", "header", "looking", "like", "another", "request", "is", "ignored", "String", "request", "=", "\"", "GET", "/", "one", "\\", "r", "\\", "nGET", ":", "/", "two", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "String", "response", "=", "connector", ".", "getResponses", "(", "request", ")", ";", "assertThat", "(", "response", ",", "containsString", "(", "\"", "pathInfo", "=", "/\"", "))", ";", "assertThat", "(", "response", ",", "not", "(", "containsString", "(", "\"", "two", "\"", "))", ");", "}", "/", "**", "*", "Http", "/", "0", ".", "9", "does", "not", "support", "pipelining", ".", "*", "/", "@", "Test", "public", "void", "testHttp09_MultipleRequests", "(", ")", "throws", "Exception", "{", "/", "/", "Verify", "that", "LocalConnector", "supports", "pipelining", "with", "HTTP", "/", "1", ".", "1", ".", "String", "requests", "=", "\"", "GET", "/", "?", "id", "=", "123", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "nHost", ":", "localhost", "\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "?", "id", "=", "456", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "nHost", ":", "localhost", "\\", "r", "\\", "nConnection", ":", "close", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "String", "responses", "=", "connector", ".", "getResponses", "(", "requests", ")", ";", "assertThat", "(", "responses", ",", "containsString", "(", "\"", "id", "=", "123", "\"", "))", ";", "assertThat", "(", "responses", ",", "containsString", "(", "\"", "id", "=", "456", "\"", "))", ";", "/", "/", "Verify", "that", "pipelining", "does", "not", "work", "with", "HTTP", "/", "0", ".", "9", ".", "requests", "=", "\"", "GET", "/", "?", "id", "=", "123", "\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "?", "id", "=", "456", "\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "?", "id", "=", "789", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "responses", "=", "connector", ".", "getResponses", "(", "requests", ")", ";", "assertThat", "(", "responses", ",", "containsString", "(", "\"", "id", "=", "123", "\"", "))", ";", "assertThat", "(", "responses", ",", "not", "(", "containsString", "(", "\"", "id", "=", "456", "\"", "))", ");", "assertThat", "(", "responses", ",", "not", "(", "containsString", "(", "\"", "id", "=", "789", "\"", "))", ");", "}", "/", "**", "*", "Ensure", "that", "excessively", "large", "hexadecimal", "chunk", "body", "length", "is", "parsed", "properly", ".", "*", "/", "@", "Test", "public", "void", "testHttp10_ChunkedBodyTruncation", "(", ")", "throws", "Exception", "{", "String", "request", "=", "\"", "POST", "/", "?", "id", "=", "123", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "local", "\\", "r", "\\", "n", "\"", "\"", "Transfer", "-", "Encoding", ":", "chunked", "\\", "r", "\\", "n", "\"", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "\\", "r", "\\", "n", "\"", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "1ff00000008", "\\", "r", "\\", "n", "\"", "\"", "abcdefgh", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "0", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "POST", "/", "?", "id", "=", "bogus", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Content", "-", "Length", ":", "5", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "dummy", "-", "host", ".", "example", ".", "com", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "12345", "\"", ";", "String", "responses", "=", "connector", ".", "getResponses", "(", "request", ")", ";", "assertThat", "(", "responses", ",", "anyOf", "(", "isEmptyOrNullString", "(", "),", "containsString", "(", "\"", "413", "\"", "),", "containsString", "(", "\"", "500", "\"", ")", ")", ");", "}", "/", "**", "*", "More", "then", "1", "Content", "-", "Length", "is", "a", "bad", "requests", "per", "HTTP", "rfcs", ".", "*", "/", "@", "Test", "public", "void", "testHttp11_MultipleContentLength", "(", ")", "throws", "Exception", "{", "HttpParser", ".", "LOG", ".", "info", "(", "\"", "badMessage", ":", "400", "Bad", "messages", "EXPECTED", ".", "..", "\")", ";", "int", "contentLengths", "[", "][", "]=", "{", "{", "0", ",", "8", "}", ",", "{", "8", ",", "0", "}", ",", "{", "8", ",", "8", "}", ",", "{", "0", ",", "8", ",", "0", "}", ",", "{", "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", "8", "}", ",", "{", "8", ",", "2", ",", "1", "}", ",", "{", "0", ",", "0", "}", ",", "{", "8", ",", "0", ",", "8", "}", ",", "{", "-", "1", ",", "8", "}", ",", "{", "8", ",", "-", "1", "}", ",", "{", "-", "1", ",", "8", ",", "-", "1", "}", ",", "{", "-", "1", ",", "-", "1", "}", ",", "{", "8", ",", "-", "1", ",", "8", "}", ",", "}", ";", "for", "(", "int", "x", "=", "0", ";", "x", "<", "contentLengths", ".", "length", ";", "x", "+", "+)", "{", "StringBuilder", "request", "=", "new", "StringBuilder", "(", ");", "request", ".", "append", "(", "\"", "POST", "/", "?", "id", "=", "\")", ".", "append", "(", "Integer", ".", "toString", "(", "x", ")", ").", "append", "(", "\"", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Host", ":", "local", "\\", "r", "\\", "n", "\"", ");", "int", "clen", "[", "]", "=", "contentLengths", "[", "x", "]", ";", "for", "(", "int", "n", "=", "0", ";", "n", "<", "clen", ".", "length", ";", "n", "+", "+)", "{", "request", ".", "append", "(", "\"", "Content", "-", "Length", ":", "\"", ").", "append", "(", "Integer", ".", "toString", "(", "clen", "[", "n", "]", "))", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "}", "request", ".", "append", "(", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "abcdefgh", "\"", ");", "/", "/", "actual", "content", "of", "8", "bytes", "String", "rawResponses", "=", "connector", ".", "getResponses", "(", "request", ".", "toString", "(", "))", ";", "HttpTester", ".", "Response", "response", "=", "HttpTester", ".", "parseResponse", "(", "rawResponses", ")", ";", "assertThat", "(", "\"", "Response", ".", "status", "\"", ",", "response", ".", "getStatus", "(", "),", "is", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ");", "}", "}", "/", "**", "*", "More", "then", "1", "Content", "-", "Length", "is", "a", "bad", "requests", "per", "HTTP", "rfcs", ".", "*", "/", "@", "Test", "public", "void", "testHttp11_ContentLengthAndChunk", "(", ")", "throws", "Exception", "{", "HttpParser", ".", "LOG", ".", "info", "(", "\"", "badMessage", ":", "400", "Bad", "messages", "EXPECTED", ".", "..", "\")", ";", "int", "contentLengths", "[", "][", "]=", "{", "{", "-", "1", ",", "8", "}", ",", "{", "8", ",", "-", "1", "}", ",", "{", "8", ",", "-", "1", ",", "8", "}", ",", "}", ";", "for", "(", "int", "x", "=", "0", ";", "x", "<", "contentLengths", ".", "length", ";", "x", "+", "+)", "{", "StringBuilder", "request", "=", "new", "StringBuilder", "(", ");", "request", ".", "append", "(", "\"", "POST", "/", "?", "id", "=", "\")", ".", "append", "(", "Integer", ".", "toString", "(", "x", ")", ").", "append", "(", "\"", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Host", ":", "local", "\\", "r", "\\", "n", "\"", ");", "int", "clen", "[", "]", "=", "contentLengths", "[", "x", "]", ";", "for", "(", "int", "n", "=", "0", ";", "n", "<", "clen", ".", "length", ";", "n", "+", "+)", "{", "if", "(", "clen", "[", "n", "]", "==", "-", "1", ")", "request", ".", "append", "(", "\"", "Transfer", "-", "Encoding", ":", "chunked", "\\", "r", "\\", "n", "\"", ");", "else", "request", ".", "append", "(", "\"", "Content", "-", "Length", ":", "\"", ").", "append", "(", "Integer", ".", "toString", "(", "clen", "[", "n", "]", "))", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "}", "request", ".", "append", "(", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "8", ";", "\\", "r", "\\", "n", "\"", ");", "/", "/", "chunk", "header", "request", ".", "append", "(", "\"", "abcdefgh", "\"", ");", "/", "/", "actual", "content", "of", "8", "bytes", "request", ".", "append", "(", "\"\\", "r", "\\", "n0", ";", "\\", "r", "\\", "n", "\"", ");", "/", "/", "last", "chunk", "String", "rawResponses", "=", "connector", ".", "getResponses", "(", "request", ".", "toString", "(", "))", ";", "HttpTester", ".", "Response", "response", "=", "HttpTester", ".", "parseResponse", "(", "rawResponses", ")", ";", "assertThat", "(", "\"", "Response", ".", "status", "\"", ",", "response", ".", "getStatus", "(", "),", "is", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ");", "}", "}", "@", "Test", "public", "void", "test4_1", "(", ")", "throws", "Exception", "{", "int", "offset", "=", "0", ";", "/", "/", "If", "_content", "length", "not", "used", ",", "second", "request", "will", "not", "be", "read", ".", "String", "response", "=", "connector", ".", "getResponses", "(", "\"", "\\", "r", "\\", "n", "\"", "\"", "GET", "/", "R1", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "localhost", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "GET", "/", "R2", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "localhost", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "GET", "/", "R3", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "localhost", "\\", "r", "\\", "n", "\"", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", ")", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "2", ".", "identity", "\"", ")+", "10", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R1", "\"", ",\"", "2", ".", "identity", "\"", ")+", "3", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "2", ".", "identity", "\"", ")+", "10", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R2", "\"", ",\"", "2", ".", "identity", "\"", ")+", "3", ";", "checkNotContained", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "2", ".", "identity", "\"", ");", "checkNotContained", "(", "response", ",", "offset", ",", "\"/", "R3", "\"", ",\"", "2", ".", "identity", "\"", ");", "}", "/", "/", "Due", "to", "smuggling", "concerns", ",", "handling", "has", "been", "changed", "to", "/", "/", "treat", "content", "length", "and", "chunking", "as", "a", "bad", "request", ".", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "400", "Bad", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "checkNotContained", "(", "response", ",", "offset", ",", "\"/", "R2", "\"", ",\"", "3", ".", "_content", "-", "length", "\"", ");", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "matchers", ".", "JUnitMatchers", ".", "containsString", ";", "/", "/", "Server", "-", "bad", "message", "to", "avoid", "smuggling", "concerns", "Assert", ".", "assertEquals", "(", "\"", "Response", "Count", "\"", ",", "1", ",", "responses", ".", "size", "(", "))", ";", "assertEquals", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Response", "Code", "\"", ",", "HttpStatus", ".", "BAD_REQUEST_400", ",", "response", ".", "getStatus", "(", "))", ";</s>import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "*;", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "StringUtil", ";", "super", "(", "message", ")", ";", "{", "else", "if", "(", "ch", "<", "0", ")", "else", "if", "(", "_connectionFields", "=", "=", "null", "&", "&", "_version", ".", "getVersion", "(", ")>", "=", "HttpVersion", ".", "HTTP_1_1", ".", "getVersion", "(", "))", "if", "(", "_endOfContent", "!", "=", "EndOfContent", ".", "CHUNKED_CONTENT", ")", "try", "{", "_contentLength", "=", "Long", ".", "parseLong", "(", "_valueString", ")", ";", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "LOG", ".", "ignore", "(", "e", ")", ";", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Length", "\"", ");", "}", "if", "(", "_contentLength", "<", "=", "0", ")", "_endOfContent", "=", "EndOfContent", ".", "NO_CONTENT", ";", "else", "_endOfContent", "=", "EndOfContent", ".", "CONTENT_LENGTH", ";", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Host", "header", "\"", ")", "{", "{", "initCause", "(", "e", ")", ";}", "};", "}", "assertTrue", "(", "_headerCompleted", ")", ";", "assertTrue", "(", "_messageCompleted", ")", ";", "assertEquals", "(", "\"", "PRI", "\"", ",", "_methodOrVersion", ")", ";", "assertEquals", "(", "\"*", "\",", "_uriOrStatus", ")", ";", "assertEquals", "(", "\"", "HTTP", "/", "2", ".", "0", "\"", ",", "_versionOrReason", ")", ";", "assertEquals", "(", "-", "1", ",", "_headers", ")", ";", "assertEquals", "(", "null", ",", "_bad", ")", ";", "catch", "(", "IOException", "e", ")", "}", "finally", "{", "if", "(", "_state", ".", "unhandle", "(", ")=", "=", "Action", ".", "COMPLETE", ")", "_state", ".", "completed", "(", ");", "else", "throw", "new", "IllegalStateException", "(", ");", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CountDownLatch", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "HttpConnectionFactory", "http", "=", "new", "HttpConnectionFactory", "(", ");", "http", ".", "getHttpConfiguration", "(", ").", "setRequestHeaderSize", "(", "1024", ")", ";", "http", ".", "getHttpConfiguration", "(", ").", "setResponseHeaderSize", "(", "1024", ")", ";", "connector", ".", "getConnectionFactory", "(", "HttpConnectionFactory", ".", "class", ")", ".", "getHttpConfiguration", "(", ").", "setSendDateHeader", "(", "true", ")", ";", "/", "/", "_content", "length", "is", "ignored", ",", "as", "chunking", "is", "used", ".", "If", "it", "is", "/", "/", "not", "ignored", ",", "the", "second", "request", "wont", "be", "seen", ".", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R1", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "123456", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R2", "\"", ",\"", "3", ".", "_content", "-", "length", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "abcdef", "\"", ",\"", "3", ".", "_content", "-", "length", "\"", ")+", "1", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "junit", ".", "matchers", ".", "JUnitMatchers", ".", "*;", "import", "java", ".", "util", ".", "Collections", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "MultiPartInputStreamParser", ";", "/", "/", "Server", "-", "ignore", "'", "Content", "-", "Length", "'", "if", "'", "Transfer", "-", "Encoding", "'", "is", "provided", ".", "Assert", ".", "assertEquals", "(", "\"", "Response", "Count", "\"", ",", "2", ",", "responses", ".", "size", "(", "))", ";", "assertEquals", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Response", "Code", "\"", ",", "HttpStatus", ".", "OK_200", ",", "response", ".", "getStatus", "(", "))", ";", "assertTrue", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Body", "\"", ",", "response", ".", "getContent", "(", ").", "contains", "(", "\"", "123456", "\\", "n", "\"", "))", ";", "response", "=", "responses", ".", "get", "(", "1", ")", ";", "/", "/", "response", "2", "assertEquals", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Response", "Code", "\"", ",", "HttpStatus", ".", "OK_200", ",", "response", ".", "getStatus", "(", "))", ";", "assertTrue", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Body", "\"", ",", "response", ".", "getContent", "(", ").", "contains", "(", "\"", "7890AB", "\\", "n", "\"", "))", ";"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["VM/Security:", "add", "security", "hook", "to", "do_brk", "Given", "a", "specifically", "crafted", "binary", "do_brk()", "can", "be", "used", "to", "get", "low", "pages", "available", "in", "userspace", "virtual", "memory", "and", "can", "thus", "be", "used", "to", "circumvent", "the", "mmap_min_addr", "low", "memory", "protection.", "Add", "security", "checks", "in", "do_brk().", "Signed-off-by:", "Eric", "Paris", "<eparis@redhat.com>", "Acked-by:", "Alan", "Cox", "<alan@redhat.com>", "Cc:", "Stephen", "Smalley", "<sds@tycho.nsa.gov>", "Cc:", "James", "Morris", "<jmorris@namei.org>", "Cc:", "Chris", "Wright", "<chrisw@sous-sol.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["error", "=", "security_file_mmap", "(", "0", ",", "0", ",", "0", ",", "0", ",", "addr", ",", "1", ")", ";", "if", "(", "error", ")", "return", "error", ";</s>"], "docstring_tokens": ["expanding", "the", "stack", "or", "using", "the", "do_brk()", "function", "in", "a", "specially-crafted", "binary"]}
{"contents": ["Insanity", "avoidance", "in", "/proc", "The", "old", "/proc", "interfaces", "were", "never", "updated", "to", "use", "loff_t,", "and", "are", "just", "generally", "broken.", "Now,", "we", "should", "be", "using", "the", "seq_file", "interface", "for", "all", "of", "the", "proc", "files,", "but", "converting", "the", "legacy", "functions", "is", "more", "work", "than", "most", "people", "care", "for", "and", "has", "little", "upside..", "But", "at", "least", "we", "can", "make", "the", "non-LFS", "rules", "explicit,", "rather", "than", "just", "insanely", "wrapping", "the", "offset", "or", "something.", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["unsigned", "long", "long", "pos", ";", "/", "*", "*", "Gaah", ",", "please", "just", "use", "\"", "seq_file", "\"", "instead", ".", "The", "legacy", "/", "proc", "*", "interfaces", "cut", "loff_t", "down", "to", "off_t", "for", "reads", ",", "and", "ignore", "*", "the", "offset", "entirely", "for", "writes", ".", ".", "*", "/", "pos", "=", "*", "ppos", ";", "if", "(", "pos", ">", "MAX_NON_LFS", ")", "return", "0", ";", "if", "(", "nbytes", ">", "MAX_NON_LFS", "-", "pos", ")", "nbytes", "=", "MAX_NON_LFS", "-", "pos", ";", "loff_t", "retval", "=", "-", "EINVAL", ";", "switch", "(", "orig", ")", "{", "case", "1", ":", "offset", "+", "=", "file", "-", ">", "f_pos", ";", "/", "*", "fallthrough", "*", "/", "case", "0", ":", "if", "(", "offset", "<", "0", "|", "|", "offset", ">", "MAX_NON_LFS", ")", "break", ";", "file", "-", ">", "f_pos", "=", "retval", "=", "offset", ";", "}", "return", "retval", ";</s>lock_kernel", "(", ");", "switch", "(", "orig", ")", "{", "case", "0", ":", "if", "(", "offset", "<", "0", ")", "goto", "out", ";", "file", "-", ">", "f_pos", "=", "offset", ";", "unlock_kernel", "(", ");", "return", "(", "file", "-", ">", "f_pos", ")", ";", "case", "1", ":", "if", "(", "offset", "+", "file", "-", ">", "f_pos", "<", "0", ")", "goto", "out", ";", "file", "-", ">", "f_pos", "+", "=", "offset", ";", "unlock_kernel", "(", ");", "return", "(", "file", "-", ">", "f_pos", ")", ";", "case", "2", ":", "goto", "out", ";", "default", ":", "goto", "out", ";", "}", "out", ":", "unlock_kernel", "(", ");", "return", "-", "EINVAL", ";"], "docstring_tokens": ["via", "unspecified", "vectors", "in", "which", "a", "signed", "value", "is", "added", "to", "an", "unsigned", "value", "."]}
{"contents": ["mm:", "avoid", "setting", "up", "anonymous", "pages", "into", "file", "mapping", "Reading", "page", "fault", "handler", "code", "I've", "noticed", "that", "under", "right", "circumstances", "kernel", "would", "map", "anonymous", "pages", "into", "file", "mappings:", "if", "the", "VMA", "doesn't", "have", "vm_ops->fault()", "and", "the", "VMA", "wasn't", "fully", "populated", "on", "->mmap(),", "kernel", "would", "handle", "page", "fault", "to", "not", "populated", "pte", "with", "do_anonymous_page().", "Let's", "change", "page", "fault", "handler", "to", "use", "do_anonymous_page()", "only", "on", "anonymous", "VMA", "(->vm_ops", "==", "NULL)", "and", "make", "sure", "that", "the", "VMA", "is", "not", "shared.", "For", "file", "mappings", "without", "vm_ops->fault()", "or", "shred", "VMA", "without", "vm_ops,", "page", "fault", "on", "pte_none()", "entry", "would", "lead", "to", "SIGBUS.", "Signed-off-by:", "Kirill", "A.", "Shutemov", "<kirill.shutemov@linux.intel.com>", "Acked-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "File", "mapping", "without", "-", ">", "vm_ops", "?", "*", "/", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_SHARED", ")", "return", "VM_FAULT_SIGBUS", ";", "/", "*", "The", "VMA", "was", "not", "fully", "populated", "on", "mmap", "(", ")", "or", "missing", "VM_DONTEXPAND", "*", "/", "if", "(", "!", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", "return", "VM_FAULT_SIGBUS", ";", "if", "(", "vma", "-", ">", "vm_ops", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";</s>-", "vma", "-", ">", "vm_start", ")", ">", ">", "PAGE_SHIFT", ")", "+", "vma", "-", ">", "vm_pgoff", ";", "if", "(", "vma", "-", ">", "vm_ops", ")", "{", "if", "(", "likely", "(", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "}", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";"], "docstring_tokens": ["via", "a", "crafted", "application", "that", "triggers", "writing", "to", "page", "zero", "."]}
{"contents": ["vfs:", "rename:", "check", "backing", "inode", "being", "equal", "If", "a", "file", "is", "renamed", "to", "a", "hardlink", "of", "itself", "POSIX", "specifies", "that", "rename(2)", "should", "do", "nothing", "and", "return", "success.", "This", "condition", "is", "checked", "in", "vfs_rename().", "However", "it", "won't", "detect", "hard", "links", "on", "overlayfs", "where", "these", "are", "given", "separate", "inodes", "on", "the", "overlayfs", "layer.", "Overlayfs", "itself", "detects", "this", "condition", "and", "returns", "success", "without", "doing", "anything,", "but", "then", "vfs_rename()", "will", "proceed", "as", "if", "this", "was", "a", "successful", "rename", "(detach_mounts(),", "d_move()).", "The", "correct", "thing", "to", "do", "is", "to", "detect", "this", "condition", "before", "even", "calling", "into", "overlayfs.", "This", "patch", "does", "this", "by", "calling", "vfs_select_inode()", "to", "get", "the", "underlying", "inodes.", "Signed-off-by:", "Miklos", "Szeredi", "<mszeredi@redhat.com>", "Cc:", "<stable@vger.kernel.org>", "#", "v4.2+"], "code_tokens": ["/", "*", "*", "Check", "source", "=", "=", "target", ".", "*", "On", "overlayfs", "need", "to", "look", "at", "underlying", "inodes", ".", "*", "/", "if", "(", "vfs_select_inode", "(", "old_dentry", ",", "0", ")", "=", "=", "vfs_select_inode", "(", "new_dentry", ",", "0", ")", ")</s>if", "(", "source", "=", "=", "target", ")"], "docstring_tokens": ["related", "to", "fs/namei.c", "and", "fs/open.c", "."]}
{"contents": ["floppy:", "Do", "not", "copy", "a", "kernel", "pointer", "to", "user", "memory", "in", "FDGETPRM", "ioctl", "The", "final", "field", "of", "a", "floppy_struct", "is", "the", "field", "\"name\",", "which", "is", "a", "pointer", "to", "a", "string", "in", "kernel", "memory.", "The", "kernel", "pointer", "should", "not", "be", "copied", "to", "user", "memory.", "The", "FDGETPRM", "ioctl", "copies", "a", "floppy_struct", "to", "user", "memory,", "including", "this", "\"name\"", "field.", "This", "pointer", "cannot", "be", "used", "by", "the", "user", "and", "it", "will", "leak", "a", "kernel", "address", "to", "user-space,", "which", "will", "reveal", "the", "location", "of", "kernel", "code", "and", "data", "and", "undermine", "KASLR", "protection.", "Model", "this", "code", "after", "the", "compat", "ioctl", "which", "copies", "the", "returned", "data", "to", "a", "previously", "cleared", "temporary", "structure", "on", "the", "stack", "(excluding", "the", "name", "pointer)", "and", "copy", "out", "to", "userspace", "from", "there.", "As", "we", "already", "have", "an", "inparam", "union", "with", "an", "appropriate", "member", "and", "that", "memory", "is", "already", "cleared", "even", "for", "read", "only", "calls", "make", "use", "of", "that", "as", "a", "temporary", "store.", "Based", "on", "an", "initial", "patch", "by", "Brian", "Belleville.", "Signed-off-by:", "Andy", "Whitcroft", "<apw@canonical.com>", "Broke", "up", "long", "line.", "Signed-off-by:", "Jens", "Axboe", "<axboe@kernel.dk>"], "code_tokens": ["memcpy", "(", "&", "inparam", ".", "g", ",", "outparam", ",", "offsetof", "(", "struct", "floppy_struct", ",", "name", ")", ");", "outparam", "=", "&", "inparam", ".", "g", ";</s>"], "docstring_tokens": ["using", "the", "FDGETPRM", "ioctl", "and", "use", "the", "obtained", "kernel", "pointer", "to", "discover", "the", "location", "of", "kernel", "code", "and", "data"]}
{"contents": ["XWIKI-14247:", "Gadgets", "are", "not", "executed", "the", "right", "way", "*", "Execute", "the", "gadgets", "with", "the", "right", "author", "*", "Add", "new", "test"], "code_tokens": ["<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "71", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "41", "<", "/", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "import", "org", ".", "xwiki", ".", "security", ".", "authorization", ".", "AuthorExecutor", ";", "protected", "static", "final", "EntityReference", "GADGET_CLASS", "=", "@", "Inject", "private", "AuthorExecutor", "authorExecutor", ";", "if", "(", "gadgetObjects", "=", "=", "null", "|", "|", "gadgetObjects", ".", "isEmpty", "(", "))", "{", "renderGadgetProperty", "(", "gadgetTitle", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "xObject", ".", "getOwnerDocument", "(", "),", "context", ")", ";", "renderGadgetProperty", "(", "content", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "xObject", ".", "getOwnerDocument", "(", "),", "context", ")", ";", "XWikiDocument", "ownerDocument", ",", "MacroTransformationContext", "context", ")", "throws", "Exception", "/", "/", "Ensure", "that", "the", "gadgets", "are", "executed", "with", "the", "proper", "rights", ".", "return", "authorExecutor", ".", "call", "(", "()", "-", ">", "{", "XDOM", "xdom", "=", "this", ".", "contentExecutor", ".", "execute", "(", "content", ",", "sourceSyntax", ",", "sourceReference", ",", "context", ")", ";", "List", "<", "Block", ">", "xdomBlocks", "=", "xdom", ".", "getChildren", "(", ");", "this", ".", "parserUtils", ".", "removeTopLevelParagraph", "(", "xdomBlocks", ")", ";", "return", "xdomBlocks", ";", "}", ",", "ownerDocument", ".", "getAuthorReference", "(", "),", "ownerDocument", ".", "getDocumentReference", "(", "))", ";", "/", "*", "*", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "*", "information", "regarding", "copyright", "ownership", ".", "*", "*", "This", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "*", "under", "the", "terms", "of", "the", "GNU", "Lesser", "General", "Public", "License", "as", "*", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", ".", "1", "of", "*", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "software", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "*", "Lesser", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "Lesser", "General", "Public", "*", "License", "along", "with", "this", "software", ";", "if", "not", ",", "write", "to", "the", "Free", "*", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "St", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "*", "02110", "-", "1301", "USA", ",", "or", "see", "the", "FSF", "site", ":", "http", ":", "//", "www", ".", "fsf", ".", "org", ".", "*", "/", "package", "org", ".", "xwiki", ".", "rendering", ".", "internal", ".", "macro", ".", "dashboard", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Callable", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "BeforeEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Test", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "org", ".", "mockito", ".", "invocation", ".", "InvocationOnMock", ";", "import", "org", ".", "mockito", ".", "stubbing", ".", "Answer", ";", "import", "org", ".", "xwiki", ".", "component", ".", "manager", ".", "ComponentLookupException", ";", "import", "org", ".", "xwiki", ".", "context", ".", "Execution", ";", "import", "org", ".", "xwiki", ".", "context", ".", "ExecutionContext", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "DocumentReference", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "DocumentReferenceResolver", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "EntityReference", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "WordBlock", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "XDOM", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "executor", ".", "ContentExecutor", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "macro", ".", "dashboard", ".", "Gadget", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "TransformationContext", ";", "import", "org", ".", "xwiki", ".", "security", ".", "authorization", ".", "AuthorExecutor", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "ComponentTest", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "InjectMockComponents", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "MockComponent", ";", "import", "org", ".", "xwiki", ".", "test", ".", "mockito", ".", "MockitoComponentManager", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityEngine", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityManager", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "XWikiVelocityException", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWiki", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWikiContext", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWikiException", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "doc", ".", "XWikiDocument", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "objects", ".", "BaseObject", ";", "import", "static", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Assertions", ".", "assertEquals", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "ComponentTest", "public", "class", "DefaultGadgetSourceTest", "{", "@", "InjectMockComponents", "private", "DefaultGadgetSource", "defaultGadgetSource", ";", "private", "static", "final", "String", "testSource", "=", "\"", "XWiki", ".", "Test", "\"", ";", "private", "static", "final", "String", "transformationId", "=", "\"", "fooId", "\"", ";", "@", "MockComponent", "private", "AuthorExecutor", "authorExecutor", ";", "@", "Mock", "private", "DocumentReference", "documentReference", ";", "@", "Mock", "private", "XWikiDocument", "xWikiDocument", ";", "@", "Mock", "private", "XWikiDocument", "ownerDocument", ";", "@", "Mock", "private", "DocumentReference", "ownerAuthorReference", ";", "@", "Mock", "private", "DocumentReference", "ownerSourceReference", ";", "@", "Mock", "private", "XWiki", "xwiki", ";", "@", "Mock", "private", "XWikiContext", "xWikiContext", ";", "@", "Mock", "private", "DocumentReference", "gadgetClassReference", ";", "@", "Mock", "private", "MacroTransformationContext", "macroTransformationContext", ";", "@", "BeforeEach", "public", "void", "setup", "(", "MockitoComponentManager", "componentManager", ")", "throws", "Exception", "{", "DocumentReferenceResolver", "<", "String", ">", "currentReferenceResolver", "=", "componentManager", ".", "getInstance", "(", "DocumentReferenceResolver", ".", "TYPE_STRING", ",", "\"", "current", "\"", ");", "when", "(", "currentReferenceResolver", ".", "resolve", "(", "testSource", ")", ").", "thenReturn", "(", "documentReference", ")", ";", "Execution", "execution", "=", "componentManager", ".", "getInstance", "(", "Execution", ".", "class", ")", ";", "ExecutionContext", "executionContext", "=", "mock", "(", "ExecutionContext", ".", "class", ")", ";", "when", "(", "execution", ".", "getContext", "(", "))", ".", "thenReturn", "(", "executionContext", ")", ";", "when", "(", "executionContext", ".", "getProperty", "(", "\"", "xwikicontext", "\"", "))", ".", "thenReturn", "(", "xWikiContext", ")", ";", "when", "(", "xWikiContext", ".", "getWiki", "(", "))", ".", "thenReturn", "(", "xwiki", ")", ";", "when", "(", "xwiki", ".", "getDocument", "(", "documentReference", ",", "xWikiContext", ")", ").", "thenReturn", "(", "xWikiDocument", ")", ";", "DocumentReferenceResolver", "<", "EntityReference", ">", "currentReferenceEntityResolver", "=", "componentManager", ".", "getInstance", "(", "DocumentReferenceResolver", ".", "TYPE_REFERENCE", ",", "\"", "current", "\"", ");", "when", "(", "currentReferenceEntityResolver", ".", "resolve", "(", "DefaultGadgetSource", ".", "GADGET_CLASS", ")", ").", "thenReturn", "(", "gadgetClassReference", ")", ";", "TransformationContext", "transformationContext", "=", "mock", "(", "TransformationContext", ".", "class", ")", ";", "when", "(", "macroTransformationContext", ".", "getTransformationContext", "(", "))", ".", "thenReturn", "(", "transformationContext", ")", ";", "when", "(", "transformationContext", ".", "getId", "(", "))", ".", "thenReturn", "(", "transformationId", ")", ";", "VelocityManager", "velocityManager", "=", "componentManager", ".", "getInstance", "(", "VelocityManager", ".", "class", ")", ";", "VelocityEngine", "velocityEngine", "=", "mock", "(", "VelocityEngine", ".", "class", ")", ";", "when", "(", "velocityManager", ".", "getVelocityEngine", "(", "))", ".", "thenReturn", "(", "velocityEngine", ")", ";", "when", "(", "velocityEngine", ".", "evaluate", "(", "any", "(", "),", "any", "(", "),", "any", "(", "),", "any", "(", "String", ".", "class", ")", "))", ".", "then", "(", "new", "Answer", "<", "Void", ">", "()", "{", "@", "Override", "public", "Void", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Object", "[", "]", "args", "=", "invocation", ".", "getArguments", "(", ");", "StringWriter", "stringWriter", "=", "(", "StringWriter", ")", "args", "[", "1", "]", ";", "String", "title", "=", "(", "String", ")", "args", "[", "3", "]", ";", "stringWriter", ".", "append", "(", "title", ")", ";", "return", "null", ";", "}", "}", ");", "AuthorExecutor", "authorExecutor", "=", "componentManager", ".", "getInstance", "(", "AuthorExecutor", ".", "class", ")", ";", "when", "(", "authorExecutor", ".", "call", "(", "any", "(", "),", "eq", "(", "ownerAuthorReference", ")", ",", "eq", "(", "ownerSourceReference", ")", "))", ".", "then", "(", "new", "Answer", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "throws", "Throwable", "{", "Callable", "callable", "=", "(", "Callable", ")", "invocationOnMock", ".", "getArguments", "(", ")[", "0", "]", ";", "return", "callable", ".", "call", "(", ");", "}", "}", ");", "ContentExecutor", "<", "MacroTransformationContext", ">", "contentExecutor", "=", "componentManager", ".", "getInstance", "(", "ContentExecutor", ".", "TYPE_MACRO_TRANSFORMATION", ")", ";", "when", "(", "contentExecutor", ".", "execute", "(", "any", "(", "),", "any", "(", "),", "any", "(", "),", "any", "(", "))", ").", "then", "(", "new", "Answer", "<", "XDOM", ">", "()", "{", "@", "Override", "public", "XDOM", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "throws", "Throwable", "{", "String", "content", "=", "invocationOnMock", ".", "getArgument", "(", "0", ")", ";", "XDOM", "xdom", "=", "new", "XDOM", "(", "Collections", ".", "singletonList", "(", "new", "WordBlock", "(", "content", ")", "))", ";", "return", "xdom", ";", "}", "}", ");", "when", "(", "ownerDocument", ".", "getAuthorReference", "(", "))", ".", "thenReturn", "(", "ownerAuthorReference", ")", ";", "when", "(", "ownerDocument", ".", "getDocumentReference", "(", "))", ".", "thenReturn", "(", "ownerSourceReference", ")", ";", "}", "@", "Test", "public", "void", "getGadgets", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "new", "ArrayList", "<", ">(", "),", "this", ".", "defaultGadgetSource", ".", "getGadgets", "(", "testSource", ",", "macroTransformationContext", ")", ");", "BaseObject", "gadgetObject1", "=", "mock", "(", "BaseObject", ".", "class", ")", ";", "when", "(", "xWikiDocument", ".", "getXObjects", "(", "gadgetClassReference", ")", ").", "thenReturn", "(", "Collections", ".", "singletonList", "(", "gadgetObject1", ")", ");", "when", "(", "gadgetObject1", ".", "getOwnerDocument", "(", "))", ".", "thenReturn", "(", "ownerDocument", ")", ";", "when", "(", "gadgetObject1", ".", "getStringValue", "(", "\"", "title", "\"", "))", ".", "thenReturn", "(", "\"", "Gadget", "1", "\"", ");", "when", "(", "gadgetObject1", ".", "getLargeStringValue", "(", "\"", "content", "\"", "))", ".", "thenReturn", "(", "\"", "Some", "content", "\"", ");", "when", "(", "gadgetObject1", ".", "getStringValue", "(", "\"", "position", "\"", "))", ".", "thenReturn", "(", "\"", "0", "\"", ");", "when", "(", "gadgetObject1", ".", "getNumber", "(", "))", ".", "thenReturn", "(", "42", ")", ";", "List", "<", "Gadget", ">", "gadgets", "=", "this", ".", "defaultGadgetSource", ".", "getGadgets", "(", "testSource", ",", "macroTransformationContext", ")", ";", "assertEquals", "(", "1", ",", "gadgets", ".", "size", "(", "))", ";", "Gadget", "gadget", "=", "gadgets", ".", "get", "(", "0", ")", ";", "assertEquals", "(", "\"", "Gadget", "1", "\"", ",", "gadget", ".", "getTitle", "(", ").", "get", "(", "0", ")", ".", "toString", "(", "))", ";", "assertEquals", "(", "\"", "Some", "content", "\"", ",", "gadget", ".", "getContent", "(", ").", "get", "(", "0", ")", ".", "toString", "(", "))", ";", "assertEquals", "(", "\"", "42", "\"", ",", "gadget", ".", "getId", "(", "))", ";", "}", "}", "@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "83", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "import", "org", ".", "xwiki", ".", "component", ".", "util", ".", "DefaultParameterizedType", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "/", "**", "*", "Type", "instance", "for", "{", "@", "code", "ContentExecutor", "<", "MacroTransformationContext", ">", "}.", "*", "*", "@", "since", "12", ".", "0RC1", ",", "11", ".", "10", ".", "3", ",", "11", ".", "3", ".", "7", "*", "/", "ParameterizedType", "TYPE_MACRO_TRANSFORMATION", "=", "new", "DefaultParameterizedType", "(", "null", ",", "ContentExecutor", ".", "class", ",", "MacroTransformationContext", ".", "class", ")", ";</s><", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "56", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "22", "<", "/", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "private", "static", "final", "EntityReference", "GADGET_CLASS", "=", "if", "(", "gadgetObjects", "=", "=", "null", ")", "{", "renderGadgetProperty", "(", "gadgetTitle", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "context", ")", ";", "renderGadgetProperty", "(", "content", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "context", ")", ";", "MacroTransformationContext", "context", ")", "throws", "MissingParserException", ",", "ParseException", ",", "ContentExecutorException", "XDOM", "xdom", "=", "this", ".", "contentExecutor", ".", "execute", "(", "content", ",", "sourceSyntax", ",", "sourceReference", ",", "context", ")", ";", "List", "<", "Block", ">", "xdomBlocks", "=", "xdom", ".", "getChildren", "(", ");", "this", ".", "parserUtils", ".", "removeTopLevelParagraph", "(", "xdomBlocks", ")", ";", "return", "xdomBlocks", ";", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "92", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">"], "docstring_tokens": ["editing", "personal", "dashboards"]}
{"contents": ["Properly", "check", "EVP_VerifyFinal()", "and", "similar", "return", "values", "(", ").", "Submitted", "by:", "Ben", "Laurie,", "Bodo", "Moeller,", "Google", "Security", "Team"], "code_tokens": ["*", ")", "Properly", "check", "EVP_VerifyFinal", "(", ")", "and", "similar", "return", "values", "(", "CVE", "-", "2008", "-", "5077", ")", ".", "[", "Ben", "Laurie", ",", "Bodo", "Moeller", ",", "Google", "Security", "Team", "]", "if", "(", "ret", "<", "=", "0", ")", "if", "(", "i", ">", "0", ")", "BIO_printf", "(", "bio_err", ",", "\"", "Signature", "OK", "\\", "n", "\"", ");", "if", "(", "i", ">", "0", ")", "if", "(", "!", "reqfile", "&", "&", "X509_verify_cert", "(", "&", "xsc", ")", "<", "=", "0", ")", "if", "(", "r", "<", "=", "0", ")", "if", "(", "(", "s", "-", ">", "verify_mode", "!", "=", "SSL_VERIFY_NONE", ")", "&", "&", "(", "i", "<", "=", "0", ")", ")", "if", "(", "i", ">", "0", ")", "/", "*", "we", "like", "the", "packet", ",", "now", "check", "the", "chksum", "*", "/", "if", "(", "i", ">", "0", ")", "if", "(", "(", "s", "-", ">", "verify_mode", "!", "=", "SSL_VERIFY_NONE", ")", "&", "&", "(", "i", "<", "=", "0", ")", "if", "(", "EVP_VerifyFinal", "(", "&", "md_ctx", ",", "p", ",", "(", "int", ")", "n", ",", "pkey", ")", "<", "=", "0", ")", "if", "(", "EVP_VerifyFinal", "(", "&", "md_ctx", ",", "p", ",", "(", "int", ")", "n", ",", "pkey", ")", "<", "=", "0", ")", "if", "(", "i", "<", "=", "0", ")", "if", "(", "ok", ">", "0", ")</s>if", "(", "ret", "=", "=", "0", ")", "if", "(", "i", ")", "BIO_printf", "(", "bio_err", ",", "\"", "Signature", "OK", "\\", "n", "\"", ");", "if", "(", "i", ")", "@", "@", "-", "1151", ",", "7", "+", "1151", ",", "7", "@", "@", "static", "int", "x509_certify", "(", "X509_STORE", "*", "ctx", ",", "char", "*", "CAfile", ",", "const", "EVP_MD", "*", "digest", ",", "if", "(", "!", "reqfile", "&", "&", "!", "X509_verify_cert", "(", "&", "xsc", ")", ")", "if", "(", "!", "r", ")", "if", "(", "(", "s", "-", ">", "verify_mode", "!", "=", "SSL_VERIFY_NONE", ")", "&", "&", "(", "!", "i", ")", ")", "if", "(", "i", ")", "/", "*", "we", "like", "the", "packet", ",", "now", "check", "the", "chksum", "*", "/", "if", "(", "i", ")", "if", "(", "(", "s", "-", ">", "verify_mode", "!", "=", "SSL_VERIFY_NONE", ")", "&", "&", "(", "!", "i", ")", "if", "(", "!", "EVP_VerifyFinal", "(", "&", "md_ctx", ",", "p", ",", "(", "int", ")", "n", ",", "pkey", ")", ")", "if", "(", "!", "EVP_VerifyFinal", "(", "&", "md_ctx", ",", "p", ",", "(", "int", ")", "n", ",", "pkey", ")", ")", "if", "(", "!", "i", ")", "if", "(", "ok", ")"], "docstring_tokens": ["a", "malformed", "signature"]}
{"contents": ["tcp:", "fix", "use", "after", "free", "in", "tcp_xmit_retransmit_queue()", "When", "tcp_sendmsg()", "allocates", "a", "fresh", "and", "empty", "skb,", "it", "puts", "it", "at", "the", "tail", "of", "the", "write", "queue", "using", "tcp_add_write_queue_tail()", "Then", "it", "attempts", "to", "copy", "user", "data", "into", "this", "fresh", "skb.", "If", "the", "copy", "fails,", "we", "undo", "the", "work", "and", "remove", "the", "fresh", "skb.", "Unfortunately,", "this", "undo", "lacks", "the", "change", "done", "to", "tp->highest_sack", "and", "we", "can", "leave", "a", "dangling", "pointer", "(to", "a", "freed", "skb)", "Later,", "tcp_xmit_retransmit_queue()", "can", "dereference", "this", "pointer", "and", "access", "freed", "memory.", "For", "regular", "kernels", "where", "memory", "is", "not", "unmapped,", "this", "might", "cause", "SACK", "bugs", "because", "tcp_highest_sack_seq()", "is", "buggy,", "returning", "garbage", "instead", "of", "tp->snd_nxt,", "but", "with", "various", "debug", "features", "like", "CONFIG_DEBUG_PAGEALLOC,", "this", "can", "crash", "the", "kernel.", "This", "bug", "was", "found", "by", "Marco", "Grassi", "thanks", "to", "syzkaller.", "Fixes:", "6859d49475d4", "(\"[TCP]:", "Abstract", "tp->highest_sack", "accessing", "&", "point", "to", "next", "skb\")", "Reported-by:", "Marco", "Grassi", "<marco.gra@gmail.com>", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Cc:", "Ilpo", "J\u00e4rvinen", "<ilpo.jarvinen@helsinki.fi>", "Cc:", "Yuchung", "Cheng", "<ycheng@google.com>", "Cc:", "Neal", "Cardwell", "<ncardwell@google.com>", "Acked-by:", "Neal", "Cardwell", "<ncardwell@google.com>", "Reviewed-by:", "Cong", "Wang", "<xiyou.wangcong@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "tcp_sk", "(", "sk", ")", "->", "highest_sack", "=", "=", "skb_unlinked", ")", "tcp_sk", "(", "sk", ")", "->", "highest_sack", "=", "NULL", ";</s>"], "docstring_tokens": ["executing", "a", "specially-crafted", "SACK", "option"]}
{"contents": ["[PATCH]", "Don't", "leak", "NT", "bit", "into", "next", "task", "SYSENTER", "can", "cause", "a", "NT", "to", "be", "set", "which", "might", "cause", "crashes", "on", "the", "IRET", "in", "the", "next", "task.", "Following", "similar", "i386", "patch", "from", "Linus.", "Signed-off-by:", "Andi", "Kleen", "<ak@suse.de>"], "code_tokens": ["push", "kernel_eflags", "(", "%", "rip", ")", "CFI_ADJUST_CFA_OFFSET", "4", "popf", "#", "reset", "kernel", "eflags", "CFI_ADJUST_CFA_OFFSET", "-", "4", "unsigned", "long", "kernel_eflags", ";", "raw_local_save_flags", "(", "kernel_eflags", ")", ";", "#", "define", "SAVE_CONTEXT", "\"", "pushf", ";", "pushq", "%", "%", "rbp", ";", "movq", "%", "%", "rsi", ",", "%%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "RESTORE_CONTEXT", "\"", "movq", "%", "%", "rbp", ",", "%%", "rsi", ";", "popq", "%", "%", "rbp", ";", "popf", "\\", "t", "\"", "/", "*", "Save", "restore", "flags", "to", "clear", "handle", "leaking", "NT", "*", "/</s>#", "define", "SAVE_CONTEXT", "\"", "pushq", "%", "%", "rbp", ";", "movq", "%", "%", "rsi", ",", "%%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "RESTORE_CONTEXT", "\"", "movq", "%", "%", "rbp", ",", "%%", "rsi", ";", "popq", "%", "%", "rbp", "\\", "n", "\\", "t", "\""], "docstring_tokens": ["initiating", "SYSENTER", "to", "set", "an", "NT", "flag"]}
{"contents": ["WW-3860", "Restrict", "accepted", "parameter", "name", "length", "Thanks", "to", "Johno", "Crawford", "for", "the", "patch.", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/trunk@1368841", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["*", "<", "li", ">", "acceptParamNames", "-", "a", "comma", "delimited", "list", "of", "regular", "expressions", "to", "describe", "a", "whitelist", "of", "accepted", "parameter", "names", ".", "*", "Don", "'", "t", "change", "the", "default", "unless", "you", "know", "what", "you", "are", "doing", "in", "terms", "of", "security", "implications", "<", "/", "li", ">", "*", "<", "li", ">", "excludeParams", "-", "a", "comma", "delimited", "list", "of", "regular", "expressions", "to", "describe", "a", "blacklist", "of", "not", "allowed", "parameter", "names", "<", "/", "li", ">", "*", "<", "li", ">", "paramNameMaxLength", "-", "the", "maximum", "length", "of", "parameter", "names", ";", "parameters", "with", "longer", "names", "will", "be", "ignored", ";", "the", "default", "is", "100", "characters", "<", "/", "li", ">", "protected", "static", "final", "int", "PARAM_NAME_MAX_LENGTH", "=", "100", ";", "private", "int", "paramNameMaxLength", "=", "PARAM_NAME_MAX_LENGTH", ";", "/", "**", "*", "Sets", "a", "comma", "-", "delimited", "list", "of", "regular", "expressions", "to", "match", "*", "parameters", "that", "are", "allowed", "in", "the", "parameter", "map", "(", "aka", "whitelist", ")", ".", "*", "<", "p", "/", ">", "*", "Don", "'", "t", "change", "the", "default", "unless", "you", "know", "what", "you", "are", "doing", "in", "terms", "*", "of", "security", "implications", ".", "*", "*", "@", "param", "commaDelim", "A", "comma", "-", "delimited", "list", "of", "regular", "expressions", "*", "/", "public", "void", "setAcceptParamNames", "(", "String", "commaDelim", ")", "{", "/", "**", "*", "If", "the", "param", "name", "exceeds", "the", "configured", "maximum", "length", "it", "will", "not", "be", "*", "accepted", ".", "*", "*", "@", "param", "paramNameMaxLength", "Maximum", "length", "of", "param", "names", "*", "/", "public", "void", "setParamNameMaxLength", "(", "int", "paramNameMaxLength", ")", "{", "this", ".", "paramNameMaxLength", "=", "paramNameMaxLength", ";", "}", "return", "isWithinLengthLimit", "(", "name", ")", "&", "&", "isAccepted", "(", "name", ")", "&", "&", "!", "isExcluded", "(", "name", ")", ";", "protected", "boolean", "isWithinLengthLimit", "(", "String", "name", ")", "{", "return", "name", ".", "length", "(", ")", "<", "=", "paramNameMaxLength", ";", "}", "protected", "boolean", "isAccepted", "(", "String", "paramName", ")", "{", "public", "void", "testLargeParameterNameWithDefaultLimit", "(", ")", "throws", "Exception", "{", "ParametersInterceptor", "parametersInterceptor", "=", "createParametersInterceptor", "(", ");", "doTestParameterNameLengthRestriction", "(", "parametersInterceptor", ",", "ParametersInterceptor", ".", "PARAM_NAME_MAX_LENGTH", ")", ";", "}", "public", "void", "testLargeParameterNameWithCustomLimit", "(", ")", "throws", "Exception", "{", "ParametersInterceptor", "parametersInterceptor", "=", "createParametersInterceptor", "(", ");", "int", "limit", "=", "20", ";", "parametersInterceptor", ".", "setParamNameMaxLength", "(", "limit", ")", ";", "doTestParameterNameLengthRestriction", "(", "parametersInterceptor", ",", "limit", ")", ";", "}", "private", "void", "doTestParameterNameLengthRestriction", "(", "ParametersInterceptor", "parametersInterceptor", ",", "int", "paramNameMaxLength", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "paramNameMaxLength", "+", "1", ";", "i", "+", "+)", "{", "sb", ".", "append", "(", "\"", "x", "\"", ");", "}", "Map", "<", "String", ",", "Object", ">", "actual", "=", "new", "LinkedHashMap", "<", "String", ",", "Object", ">", "()", ";", "parametersInterceptor", ".", "setValueStackFactory", "(", "createValueStackFactory", "(", "actual", ")", ");", "ValueStack", "stack", "=", "createStubValueStack", "(", "actual", ")", ";", "Map", "<", "String", ",", "Object", ">", "parameters", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ";", "parameters", ".", "put", "(", "sb", ".", "toString", "(", "),", "\"", "\")", ";", "parameters", ".", "put", "(", "\"", "huuhaa", "\"", ",", "\"", "\")", ";", "Action", "action", "=", "new", "SimpleAction", "(", ");", "parametersInterceptor", ".", "setParameters", "(", "action", ",", "stack", ",", "parameters", ")", ";", "assertEquals", "(", "1", ",", "actual", ".", "size", "(", "))", ";", "}", "public", "void", "testExcludedTrickyParameters", "(", ")", "throws", "Exception", "{</s>*", "<", "p", "/", ">", "*", "<", "p", "/", ">", "public", "void", "setAcceptParamNames", "(", "String", "commaDelim", ")", "{", "return", "isAccepted", "(", "name", ")", "&", "&", "!", "isExcluded", "(", "name", ")", ";", "protected", "boolean", "isAccepted", "(", "String", "paramName", ")", "{", "public", "void", "testExcludedTrickyParameters", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["via", "a", "long", "parameter", "name"]}
{"contents": ["fbdev:", "color", "map", "copying", "bounds", "checking", "Copying", "color", "maps", "to", "userspace", "doesn't", "check", "the", "value", "of", "to->start,", "which", "will", "cause", "kernel", "heap", "buffer", "OOB", "read", "due", "to", "signedness", "wraps.", "Link:", "http://lkml.kernel.org/r/20170105224249.GA50925@beast", "Fixes:", "1da177e4c3f4", "(\"Linux-2.6.12-rc2\")", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Reported-by:", "Peter", "Pi", "(@heisecode)", "of", "Trend", "Micro", "Cc:", "Min", "Chong", "<mchong@google.com>", "Cc:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Cc:", "Tomi", "Valkeinen", "<tomi.valkeinen@ti.com>", "Cc:", "Bartlomiej", "Zolnierkiewicz", "<b.zolnierkie@samsung.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["unsigned", "int", "tooff", "=", "0", ",", "fromoff", "=", "0", ";", "size_t", "size", ";", "if", "(", "fromoff", ">", "=", "from", "-", ">", "len", "|", "|", "tooff", ">", "=", "to", "-", ">", "len", ")", "return", "-", "EINVAL", ";", "size", "=", "min_t", "(", "size_t", ",", "to", "-", ">", "len", "-", "tooff", ",", "from", "-", ">", "len", "-", "fromoff", ")", ";", "if", "(", "size", "=", "=", "0", ")", "unsigned", "int", "tooff", "=", "0", ",", "fromoff", "=", "0", ";", "size_t", "size", ";", "if", "(", "fromoff", ">", "=", "from", "-", ">", "len", "|", "|", "tooff", ">", "=", "to", "-", ">", "len", ")", "return", "-", "EINVAL", ";", "size", "=", "min_t", "(", "size_t", ",", "to", "-", ">", "len", "-", "tooff", ",", "from", "-", ">", "len", "-", "fromoff", ")", ";", "if", "(", "size", "=", "=", "0", ")</s>int", "tooff", "=", "0", ",", "fromoff", "=", "0", ";", "int", "size", ";", "size", "=", "to", "-", ">", "len", "-", "tooff", ";", "if", "(", "size", ">", "(", "int", ")", "(", "from", "-", ">", "len", "-", "fromoff", ")", ")", "size", "=", "from", "-", ">", "len", "-", "fromoff", ";", "if", "(", "size", "<", "=", "0", ")", "int", "tooff", "=", "0", ",", "fromoff", "=", "0", ";", "int", "size", ";", "size", "=", "to", "-", ">", "len", "-", "tooff", ";", "if", "(", "size", ">", "(", "int", ")", "(", "from", "-", ">", "len", "-", "fromoff", ")", ")", "size", "=", "from", "-", ">", "len", "-", "fromoff", ";", "if", "(", "size", "<", "=", "0", ")"], "docstring_tokens": ["persuading", "a", "victim", "to", "open", "a", "specially-crafted", "application"]}
{"contents": ["net:", "Allow", "driver", "to", "limit", "number", "of", "GSO", "segments", "per", "skb", "A", "peer", "(or", "local", "user)", "may", "cause", "TCP", "to", "use", "a", "nominal", "MSS", "of", "as", "little", "as", "88", "(actual", "MSS", "of", "76", "with", "timestamps).", "Given", "that", "we", "have", "a", "sufficiently", "prodigious", "local", "sender", "and", "the", "peer", "ACKs", "quickly", "enough,", "it", "is", "nevertheless", "possible", "to", "grow", "the", "window", "for", "such", "a", "connection", "to", "the", "point", "that", "we", "will", "try", "to", "send", "just", "under", "64K", "at", "once.", "This", "results", "in", "a", "single", "skb", "that", "expands", "to", "861", "segments.", "In", "some", "drivers", "with", "TSO", "support,", "such", "an", "skb", "will", "require", "hundreds", "of", "DMA", "descriptors;", "a", "substantial", "fraction", "of", "a", "TX", "ring", "or", "even", "more", "than", "a", "full", "ring.", "The", "TX", "queue", "selected", "for", "the", "skb", "may", "stall", "and", "trigger", "the", "TX", "watchdog", "repeatedly", "(since", "the", "problem", "skb", "will", "be", "retried", "after", "the", "TX", "reset).", "This", "particularly", "affects", "sfc,", "for", "which", "the", "issue", "is", "designated", "as", ".", "Therefore:", "1.", "Add", "the", "field", "net_device::gso_max_segs", "holding", "the", "device-specific", "limit.", "2.", "In", "netif_skb_features(),", "if", "the", "number", "of", "segments", "is", "too", "high", "then", "mask", "out", "GSO", "features", "to", "force", "fall", "back", "to", "software", "GSO.", "Signed-off-by:", "Ben", "Hutchings", "<bhutchings@solarflare.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["#", "define", "GSO_MAX_SEGS", "65535", "u16", "gso_max_segs", ";", "if", "(", "skb_shinfo", "(", "skb", ")", "->", "gso_segs", ">", "skb", "-", ">", "dev", "-", ">", "gso_max_segs", ")", "features", "&", "=", "~", "NETIF_F_GSO_MASK", ";", "dev", "-", ">", "gso_max_segs", "=", "GSO_MAX_SEGS", ";</s>"], "docstring_tokens": ["making", "a", "temporary", "configuration", "change"]}
{"contents": ["net:", "packet:", "fix", "information", "leak", "to", "userland", "packet_getname_spkt()", "doesn't", "initialize", "all", "members", "of", "sa_data", "field", "of", "sockaddr", "struct", "if", "strlen(dev->name)", "<", "13.", "This", "structure", "is", "then", "copied", "to", "userland.", "It", "leads", "to", "leaking", "of", "contents", "of", "kernel", "stack", "memory.", "We", "have", "to", "fully", "fill", "sa_data", "with", "strncpy()", "instead", "of", "strlcpy().", "The", "same", "with", "packet_getname():", "it", "doesn't", "initialize", "sll_pkttype", "field", "of", "sockaddr_ll.", "Set", "it", "to", "zero.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segooon@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["strncpy", "(", "uaddr", "-", ">", "sa_data", ",", "dev", "-", ">", "name", ",", "14", ")", ";", "sll", "-", ">", "sll_pkttype", "=", "0", ";</s>strlcpy", "(", "uaddr", "-", ">", "sa_data", ",", "dev", "-", ">", "name", ",", "15", ")", ";"], "docstring_tokens": ["by", "leveraging", "the", "CAP_NET_RAW", "capability", "to", "read", "copies", "of", "the", "applicable", "structures", "."]}
{"contents": ["sctp:", "implement", "memory", "accounting", "on", "tx", "path", "Now", "when", "sending", "packets,", "sk_mem_charge()", "and", "sk_mem_uncharge()", "have", "been", "used", "to", "set", "sk_forward_alloc.", "We", "just", "need", "to", "call", "sk_wmem_schedule()", "to", "check", "if", "the", "allocated", "should", "be", "raised,", "and", "call", "sk_mem_reclaim()", "to", "check", "if", "the", "allocated", "should", "be", "reduced", "when", "it's", "under", "memory", "pressure.", "If", "sk_wmem_schedule()", "returns", "false,", "which", "means", "no", "memory", "is", "allowed", "to", "allocate,", "it", "will", "block", "and", "wait", "for", "memory", "to", "become", "available.", "Note", "different", "from", "tcp,", "sctp", "wait_for_buf", "happens", "before", "allocating", "any", "skb,", "so", "memory", "accounting", "check", "is", "done", "with", "the", "whole", "msg_len", "before", "it", "too.", "Reported-by:", "Matteo", "Croce", "<mcroce@redhat.com>", "Tested-by:", "Matteo", "Croce", "<mcroce@redhat.com>", "Acked-by:", "Neil", "Horman", "<nhorman@tuxdriver.com>", "Acked-by:", "Marcelo", "Ricardo", "Leitner", "<marcelo.leitner@gmail.com>", "Signed-off-by:", "Xin", "Long", "<lucien.xin@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "sk_under_memory_pressure", "(", "sk", ")", ")", "sk_mem_reclaim", "(", "sk", ")", ";", "if", "(", "sctp_wspace", "(", "asoc", ")", "<", "=", "0", "|", "|", "!", "sk_wmem_schedule", "(", "sk", ",", "msg_len", ")", ")", "{", "if", "(", "sk_under_memory_pressure", "(", "sk", ")", ")", "sk_mem_reclaim", "(", "sk", ")", ";", "if", "(", "(", "int", ")", "msg_len", "<", "=", "sctp_wspace", "(", "asoc", ")", "&", "&", "sk_wmem_schedule", "(", "sk", ",", "msg_len", ")", ")</s>if", "(", "sctp_wspace", "(", "asoc", ")", "<", "=", "0", ")", "{", "if", "(", "(", "int", ")", "msg_len", "<", "=", "sctp_wspace", "(", "asoc", ")", ")"], "docstring_tokens": ["sending", "a", "specially-crafted", "request"]}
{"contents": ["KVM:", "x86:", "fix", "missing", "checks", "in", "syscall", "emulation", "On", "hosts", "without", "this", "patch,", "32bit", "guests", "will", "crash", "(and", "64bit", "guests", "may", "behave", "in", "a", "wrong", "way)", "for", "example", "by", "simply", "executing", "following", "nasm-demo-application:", "[bits", "32]", "global", "_start", "SECTION", ".text", "_start:", "syscall", "(I", "tested", "it", "with", "winxp", "and", "linux", "-", "both", "always", "crashed)", "Disassembly", "of", "section", ".text:", "00000000", "<_start>:", "0:", "0f", "05", "syscall", "The", "reason", "seems", "a", "missing", "\"invalid", "opcode\"-trap", "(int6)", "for", "the", "syscall", "opcode", "\"0f05\",", "which", "is", "not", "available", "on", "Intel", "CPUs", "within", "non-longmodes,", "as", "also", "on", "some", "AMD", "CPUs", "within", "legacy-mode.", "(depending", "on", "CPU", "vendor,", "MSR_EFER", "and", "cpuid)", "Because", "previous", "mentioned", "OSs", "may", "not", "engage", "corresponding", "syscall", "target-registers", "(STAR,", "LSTAR,", "CSTAR),", "they", "remain", "NULL", "and", "(non", "trapping)", "syscalls", "are", "leading", "to", "multiple", "faults", "and", "finally", "crashs.", "Depending", "on", "the", "architecture", "(AMD", "or", "Intel)", "pretended", "by", "guests,", "various", "checks", "according", "to", "vendor's", "documentation", "are", "implemented", "to", "overcome", "the", "current", "issue", "and", "behave", "like", "the", "CPUs", "physical", "counterparts.", "[mtosatti:", "cleanup/beautify", "code]", "Signed-off-by:", "Stephan", "Baerwolf", "<stephan.baerwolf@tu-ilmenau.de>", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>"], "code_tokens": ["/", "*", "CPUID", "vendors", "*", "/", "#", "define", "X86EMUL_CPUID_VENDOR_AuthenticAMD_ebx", "0x68747541", "#", "define", "X86EMUL_CPUID_VENDOR_AuthenticAMD_ecx", "0x444d4163", "#", "define", "X86EMUL_CPUID_VENDOR_AuthenticAMD_edx", "0x69746e65", "#", "define", "X86EMUL_CPUID_VENDOR_AMDisbetterI_ebx", "0x69444d41", "#", "define", "X86EMUL_CPUID_VENDOR_AMDisbetterI_ecx", "0x21726574", "#", "define", "X86EMUL_CPUID_VENDOR_AMDisbetterI_edx", "0x74656273", "#", "define", "X86EMUL_CPUID_VENDOR_GenuineIntel_ebx", "0x756e6547", "#", "define", "X86EMUL_CPUID_VENDOR_GenuineIntel_ecx", "0x6c65746e", "#", "define", "X86EMUL_CPUID_VENDOR_GenuineIntel_edx", "0x49656e69", "static", "bool", "em_syscall_is_enabled", "(", "struct", "x86_emulate_ctxt", "*", "ctxt", ")", "{", "struct", "x86_emulate_ops", "*", "ops", "=", "ctxt", "-", ">", "ops", ";", "u32", "eax", ",", "ebx", ",", "ecx", ",", "edx", ";", "/", "*", "*", "syscall", "should", "always", "be", "enabled", "in", "longmode", "-", "so", "only", "become", "*", "vendor", "specific", "(", "cpuid", ")", "if", "other", "modes", "are", "active", ".", "..", "*", "/", "if", "(", "ctxt", "-", ">", "mode", "=", "=", "X86EMUL_MODE_PROT64", ")", "return", "true", ";", "eax", "=", "0x00000000", ";", "ecx", "=", "0x00000000", ";", "if", "(", "ops", "-", ">", "get_cpuid", "(", "ctxt", ",", "&", "eax", ",", "&", "ebx", ",", "&", "ecx", ",", "&", "edx", ")", ")", "{", "/", "*", "*", "Intel", "(", "\"", "GenuineIntel", "\"", ")", "*", "remark", ":", "Intel", "CPUs", "only", "support", "\"", "syscall", "\"", "in", "64bit", "*", "longmode", ".", "Also", "an", "64bit", "guest", "with", "a", "*", "32bit", "compat", "-", "app", "running", "will", "#", "UD", "!", "!", "While", "this", "*", "behaviour", "can", "be", "fixed", "(", "by", "emulating", ")", "into", "AMD", "*", "response", "-", "CPUs", "of", "AMD", "can", "'", "t", "behave", "like", "Intel", ".", "*", "/", "if", "(", "ebx", "=", "=", "X86EMUL_CPUID_VENDOR_GenuineIntel_ebx", "&", "&", "ecx", "=", "=", "X86EMUL_CPUID_VENDOR_GenuineIntel_ecx", "&", "&", "edx", "=", "=", "X86EMUL_CPUID_VENDOR_GenuineIntel_edx", ")", "return", "false", ";", "/", "*", "AMD", "(", "\"", "AuthenticAMD", "\"", ")", "*", "/", "if", "(", "ebx", "=", "=", "X86EMUL_CPUID_VENDOR_AuthenticAMD_ebx", "&", "&", "ecx", "=", "=", "X86EMUL_CPUID_VENDOR_AuthenticAMD_ecx", "&", "&", "edx", "=", "=", "X86EMUL_CPUID_VENDOR_AuthenticAMD_edx", ")", "return", "true", ";", "/", "*", "AMD", "(", "\"", "AMDisbetter", "!", "\")", "*", "/", "if", "(", "ebx", "=", "=", "X86EMUL_CPUID_VENDOR_AMDisbetterI_ebx", "&", "&", "ecx", "=", "=", "X86EMUL_CPUID_VENDOR_AMDisbetterI_ecx", "&", "&", "edx", "=", "=", "X86EMUL_CPUID_VENDOR_AMDisbetterI_edx", ")", "return", "true", ";", "}", "/", "*", "default", ":", "(", "not", "Intel", ",", "not", "AMD", ")", ",", "apply", "Intel", "'", "s", "stricter", "rules", ".", "..", "*", "/", "return", "false", ";", "}", "if", "(", "!(", "em_syscall_is_enabled", "(", "ctxt", ")", "))", "return", "emulate_ud", "(", "ctxt", ")", ";", "if", "(", "!(", "efer", "&", "EFER_SCE", ")", ")", "return", "emulate_ud", "(", "ctxt", ")", ";</s>"], "docstring_tokens": ["simply", "executing", "following", "nasm-demo-application", ":", "[bits", "32", "]", "global", "_start", "SECTION", ".text"]}
{"contents": ["Merge", "pull", "request", "#12", "from", "danielfernandez/cachekey", "Improved", "performance", "of", "getter/setter", "method", "caching", "in", "OgnlRuntime"], "code_tokens": ["static", "final", "ClassPropertyMethodCache", "cacheSetMethod", "=", "new", "ClassPropertyMethodCache", "(", ");", "static", "final", "ClassPropertyMethodCache", "cacheGetMethod", "=", "new", "ClassPropertyMethodCache", "(", ");", "public", "static", "Method", "getGetMethod", "(", "OgnlContext", "context", ",", "Class", "targetClass", ",", "String", "propertyName", ")", "throws", "IntrospectionException", ",", "OgnlException", "{", "/", "/", "Cache", "is", "a", "map", "in", "two", "levels", ",", "so", "we", "provide", "two", "keys", "(", "see", "comments", "in", "ClassPropertyMethodCache", "below", ")", "Method", "method", "=", "cacheGetMethod", ".", "get", "(", "targetClass", ",", "propertyName", ")", ";", "if", "(", "method", "!", "=", "null", ")", "return", "method", ";", "/", "/", "By", "checking", "key", "existence", "now", "and", "not", "before", "calling", "'", "get", "'", ",", "we", "will", "save", "a", "map", "resolution", "90", "%", "of", "the", "times", "if", "(", "cacheGetMethod", ".", "containsKey", "(", "targetClass", ",", "propertyName", ")", ")", "return", "null", ";", "method", "=", "_getGetMethod", "(", "context", ",", "targetClass", ",", "propertyName", ")", ";", "/", "/", "will", "be", "null", "if", "not", "found", "-", "will", "cache", "it", "anyway", "cacheGetMethod", ".", "put", "(", "targetClass", ",", "propertyName", ",", "method", ")", ";", "return", "method", ";", "public", "static", "Method", "getSetMethod", "(", "OgnlContext", "context", ",", "Class", "targetClass", ",", "String", "propertyName", ")", "throws", "IntrospectionException", ",", "OgnlException", "{", "/", "/", "Cache", "is", "a", "map", "in", "two", "levels", ",", "so", "we", "provide", "two", "keys", "(", "see", "comments", "in", "ClassPropertyMethodCache", "below", ")", "Method", "method", "=", "cacheSetMethod", ".", "get", "(", "targetClass", ",", "propertyName", ")", ";", "if", "(", "method", "!", "=", "null", ")", "return", "method", ";", "/", "/", "By", "checking", "key", "existence", "now", "and", "not", "before", "calling", "'", "get", "'", ",", "we", "will", "save", "a", "map", "resolution", "90", "%", "of", "the", "times", "if", "(", "cacheSetMethod", ".", "containsKey", "(", "targetClass", ",", "propertyName", ")", ")", "return", "null", ";", "method", "=", "_getSetMethod", "(", "context", ",", "targetClass", ",", "propertyName", ")", ";", "/", "/", "will", "be", "null", "if", "not", "found", "-", "will", "cache", "it", "anyway", "cacheSetMethod", ".", "put", "(", "targetClass", ",", "propertyName", ",", "method", ")", ";", "return", "method", ";", "/", "*", "*", "The", "idea", "behind", "this", "class", "is", "to", "provide", "a", "very", "fast", "way", "to", "cache", "getter", "/", "setter", "methods", "indexed", "by", "their", "class", "*", "and", "property", "name", ".", "*", "*", "Instead", "of", "creating", "any", "kind", "of", "complex", "key", "object", "(", "or", "a", "String", "key", "by", "appending", "class", "name", "and", "property", ")", ",", "this", "*", "class", "directly", "uses", "the", "Class", "clazz", "and", "the", "String", "propertyName", "as", "keys", "of", "two", "levels", "of", "ConcurrentHashMaps", ",", "*", "so", "that", "it", "takes", "advantage", "of", "the", "fact", "that", "these", "two", "classes", "are", "immutable", "and", "that", "their", "respective", "hashCode", "(", ")", "*", "and", "equals", "(", ")", "methods", "are", "extremely", "fast", "and", "optimized", ".", "These", "two", "aspects", "should", "improve", "Map", "access", "performance", ".", "*", "*", "Also", ",", "using", "these", "structure", "instead", "of", "any", "other", "kind", "of", "key", "on", "a", "single", "-", "level", "map", "should", "save", "a", "lot", "of", "memory", "*", "given", "no", "specialized", "cache", "objects", "(", "be", "them", "of", "a", "specific", "CacheKey", "class", "or", "mere", "Strings", ")", "ever", "have", "to", "be", "created", "*", "for", "simply", "accessing", "the", "cache", "in", "search", "for", "a", "getter", "/", "setter", "method", ".", "*", "*", "/", "private", "static", "final", "class", "ClassPropertyMethodCache", "{", "/", "/", "ConcurrentHashMaps", "do", "not", "allow", "null", "keys", "or", "values", ",", "so", "we", "will", "use", "one", "of", "this", "class", "'", "s", "own", "methods", "as", "/", "/", "a", "replacement", "for", "signaling", "when", "the", "true", "cached", "value", "is", "'", "null", "'", "private", "static", "final", "Method", "NULL_REPLACEMENT", ";", "private", "final", "ConcurrentHashMap", "<", "Class", "<", "?>", ",", "ConcurrentHashMap", "<", "String", ",", "Method", ">", ">", "cache", "=", "new", "ConcurrentHashMap", "<", "Class", "<", "?>", ",", "ConcurrentHashMap", "<", "String", ",", "Method", ">", ">(", ");", "static", "{", "try", "{", "NULL_REPLACEMENT", "=", "ClassPropertyMethodCache", ".", "class", ".", "getDeclaredMethod", "(", "\"", "get", "\"", ",", "new", "Class", "[", "]", "{", "Class", ".", "class", ",", "String", ".", "class", "}", ");", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "/", "/", "Will", "never", "happen", ",", "it", "'", "s", "our", "own", "method", ",", "we", "know", "it", "exists", "}", "}", "ClassPropertyMethodCache", "(", ")", "{", "super", "(", ");", "}", "Method", "get", "(", "Class", "clazz", ",", "String", "propertyName", ")", "{", "ConcurrentHashMap", "<", "String", ",", "Method", ">", "methodsByPropertyName", "=", "this", ".", "cache", ".", "get", "(", "clazz", ")", ";", "if", "(", "methodsByPropertyName", "=", "=", "null", ")", "{", "methodsByPropertyName", "=", "new", "ConcurrentHashMap", "<", "String", ",", "Method", ">", "()", ";", "this", ".", "cache", ".", "put", "(", "clazz", ",", "methodsByPropertyName", ")", ";", "}", "Method", "method", "=", "methodsByPropertyName", ".", "get", "(", "propertyName", ")", ";", "if", "(", "method", "=", "=", "NULL_REPLACEMENT", ")", "return", "null", ";", "return", "method", ";", "}", "void", "put", "(", "Class", "clazz", ",", "String", "propertyName", ",", "Method", "method", ")", "{", "ConcurrentHashMap", "<", "String", ",", "Method", ">", "methodsByPropertyName", "=", "this", ".", "cache", ".", "get", "(", "clazz", ")", ";", "if", "(", "methodsByPropertyName", "=", "=", "null", ")", "{", "methodsByPropertyName", "=", "new", "ConcurrentHashMap", "<", "String", ",", "Method", ">", "()", ";", "this", ".", "cache", ".", "put", "(", "clazz", ",", "methodsByPropertyName", ")", ";", "}", "methodsByPropertyName", ".", "put", "(", "propertyName", ",", "(", "method", "=", "=", "null", "?", "NULL_REPLACEMENT", ":", "method", ")", ");", "}", "boolean", "containsKey", "(", "Class", "clazz", ",", "String", "propertyName", ")", "{", "ConcurrentHashMap", "<", "String", ",", "Method", ">", "methodsByPropertyName", "=", "this", ".", "cache", ".", "get", "(", "clazz", ")", ";", "if", "(", "methodsByPropertyName", "=", "=", "null", ")", "return", "false", ";", "return", "methodsByPropertyName", ".", "containsKey", "(", "propertyName", ")", ";", "}", "}</s>static", "final", "Map", "cacheSetMethod", "=", "new", "HashMap", "(", ");", "static", "final", "Map", "cacheGetMethod", "=", "new", "HashMap", "(", ");", "public", "static", "Method", "getGetMethod", "(", "OgnlContext", "context", ",", "Class", "targetClass", ",", "String", "propertyName", ")", "throws", "IntrospectionException", ",", "OgnlException", "{", "Object", "cacheKey", "=", "buildCacheKey", "(", "targetClass", ",", "propertyName", ")", ";", "if", "(", "cacheGetMethod", ".", "containsKey", "(", "cacheKey", ")", ")", "{", "return", "(", "Method", ")", "cacheGetMethod", ".", "get", "(", "cacheKey", ")", ";", "}", "else", "{", "Method", "result", "=", "null", ";", "synchronized", "(", "cacheGetMethod", ")", "{", "if", "(", "!", "cacheGetMethod", ".", "containsKey", "(", "cacheKey", ")", ")", "{", "result", "=", "_getGetMethod", "(", "context", ",", "targetClass", ",", "propertyName", ")", ";", "cacheGetMethod", ".", "put", "(", "cacheKey", ",", "result", ")", ";", "}", "else", "{", "result", "=", "(", "Method", ")", "cacheGetMethod", ".", "get", "(", "cacheKey", ")", ";", "}", "}", "return", "result", ";", "}", "}", "private", "static", "Object", "buildCacheKey", "(", "Class", "targetClass", ",", "String", "propertyName", ")", "{", "return", "new", "CacheKey", "(", "targetClass", ",", "propertyName", ")", ";", "}", "private", "static", "final", "class", "CacheKey", "{", "private", "final", "Class", "clazz", ";", "private", "final", "String", "propertyName", ";", "public", "CacheKey", "(", "Class", "clazz", ",", "String", "propertyName", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "this", ".", "propertyName", "=", "propertyName", ";", "}", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "CacheKey", "cacheKey", "=", "(", "CacheKey", ")", "obj", ";", "return", "clazz", ".", "equals", "(", "cacheKey", ".", "clazz", ")", "&", "&", "propertyName", ".", "equals", "(", "cacheKey", ".", "propertyName", ")", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "clazz", ".", "hashCode", "(", ")", "*", "31", "+", "propertyName", ".", "hashCode", "(", ");", "}", "public", "static", "Method", "getSetMethod", "(", "OgnlContext", "context", ",", "Class", "targetClass", ",", "String", "propertyName", ")", "throws", "IntrospectionException", ",", "OgnlException", "{", "Object", "cacheKey", "=", "buildCacheKey", "(", "targetClass", ",", "propertyName", ")", ";", "if", "(", "cacheSetMethod", ".", "containsKey", "(", "cacheKey", ")", ")", "{", "return", "(", "Method", ")", "cacheSetMethod", ".", "get", "(", "cacheKey", ")", ";", "}", "else", "{", "Method", "result", "=", "null", ";", "synchronized", "(", "cacheSetMethod", ")", "{", "/", "/", "PATCHED", "if", "(", "!", "cacheSetMethod", ".", "containsKey", "(", "cacheKey", ")", ")", "{", "result", "=", "_getSetMethod", "(", "context", ",", "targetClass", ",", "propertyName", ")", ";", "cacheSetMethod", ".", "put", "(", "cacheKey", ",", "result", ")", ";", "}", "else", "{", "result", "=", "(", "Method", ")", "cacheSetMethod", ".", "get", "(", "cacheKey", ")", ";", "}", "}", "return", "result", ";", "}"], "docstring_tokens": ["via", "unspecified", "vectors", "."]}
{"contents": ["deal", "with", "deadlock", "in", "d_walk()", "...", "by", "not", "hitting", "rename_retry", "for", "reasons", "other", "than", "rename", "having", "happened.", "In", "other", "words,", "do", "_not_", "restart", "when", "finding", "that", "between", "unlocking", "the", "child", "and", "locking", "the", "parent", "the", "former", "got", "into", "__dentry_kill().", "Skip", "the", "killed", "siblings", "instead...", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["__list_del_entry", "(", "&", "dentry", "-", ">", "d_child", ")", ";", "rcu_read_lock", "(", ");", "ascend", ":", "/", "*", "might", "go", "back", "up", "the", "wrong", "parent", "if", "we", "have", "had", "a", "rename", ".", "*", "/", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "next", "=", "child", "-", ">", "d_child", ".", "next", ";", "while", "(", "unlikely", "(", "child", "-", ">", "d_flags", "&", "DCACHE_DENTRY_KILLED", ")", ")", "{", "if", "(", "next", "=", "=", "&", "this_parent", "-", ">", "d_subdirs", ")", "goto", "ascend", ";", "child", "=", "list_entry", "(", "next", ",", "struct", "dentry", ",", "d_child", ")", ";", "next", "=", "next", "-", ">", "next", ";", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "rcu_read_unlock", "(", ");", "spin_unlock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "rcu_read_unlock", "(", ");", "BUG_ON", "(", "seq", "&", "1", ")", ";</s>list_del", "(", "&", "dentry", "-", ">", "d_child", ")", ";", "rcu_read_lock", "(", ");", "/", "*", "*", "might", "go", "back", "up", "the", "wrong", "parent", "if", "we", "have", "had", "a", "rename", "*", "or", "deletion", "*", "/", "if", "(", "this_parent", "!", "=", "child", "-", ">", "d_parent", "|", "|", "(", "child", "-", ">", "d_flags", "&", "DCACHE_DENTRY_KILLED", ")", "|", "|", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "{", "spin_unlock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "rcu_read_unlock", "(", ");", "next", "=", "child", "-", ">", "d_child", ".", "next", ";", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "{", "spin_unlock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "}"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["BCryptPasswordEncoder", "rawPassword", "cannot", "be", "null", "Closes", "gh-8317"], "code_tokens": ["if", "(", "rawPassword", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "rawPassword", "cannot", "be", "null", "\"", ");", "}", "if", "(", "rawPassword", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "rawPassword", "cannot", "be", "null", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "encodeNullRawPassword", "(", ")", "{", "BCryptPasswordEncoder", "encoder", "=", "new", "BCryptPasswordEncoder", "(", ");", "encoder", ".", "encode", "(", "null", ")", ";", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "matchNullRawPassword", "(", ")", "{", "BCryptPasswordEncoder", "encoder", "=", "new", "BCryptPasswordEncoder", "(", ");", "encoder", ".", "matches", "(", "null", ",", "\"", "does", "-", "not", "-", "matter", "\"", ");", "}</s>"], "docstring_tokens": ["using", "dictionary", "attack", "techniques"]}
{"contents": ["agp:", "fix", "OOM", "and", "buffer", "overflow", "page_count", "is", "copied", "from", "userspace.", "agp_allocate_memory()", "tries", "to", "check", "whether", "this", "number", "is", "too", "big,", "but", "doesn't", "take", "into", "account", "the", "wrap", "case.", "Also", "agp_create_user_memory()", "doesn't", "check", "whether", "alloc_size", "is", "calculated", "from", "num_agp_pages", "variable", "without", "overflow.", "This", "may", "lead", "to", "allocation", "of", "too", "small", "buffer", "with", "following", "buffer", "overflow.", "Another", "problem", "in", "agp", "code", "is", "not", "addressed", "in", "the", "patch", "-", "kernel", "memory", "exhaustion", "(AGPIOC_RESERVE", "and", "AGPIOC_ALLOCATE", "ioctls).", "It", "is", "not", "checked", "whether", "requested", "pid", "is", "a", "pid", "of", "the", "caller", "(no", "check", "in", "agpioc_reserve_wrap()).", "Each", "allocation", "is", "limited", "to", "16KB,", "though,", "there", "is", "no", "per-process", "limit.", "This", "might", "lead", "to", "OOM", "situation,", "which", "is", "not", "even", "solved", "in", "case", "of", "the", "caller", "death", "by", "OOM", "killer", "-", "the", "memory", "is", "allocated", "for", "another", "(faked)", "process.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segoon@openwall.com>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["if", "(", "INT_MAX", "/", "sizeof", "(", "struct", "page", "*", ")", "<", "num_agp_pages", ")", "return", "NULL", ";", "int", "cur_memory", ";", "cur_memory", "=", "atomic_read", "(", "&", "bridge", "-", ">", "current_memory_agp", ")", ";", "if", "(", "(", "cur_memory", "+", "page_count", ">", "bridge", "-", ">", "max_memory_agp", ")", "|", "|", "(", "cur_memory", "+", "page_count", "<", "page_count", ")", ")</s>if", "(", "(", "atomic_read", "(", "&", "bridge", "-", ">", "current_memory_agp", ")", "+", "page_count", ")", ">", "bridge", "-", ">", "max_memory_agp", ")"], "docstring_tokens": ["via", "vectors", "related", "to", "calls", "that", "specify", "a", "large", "number", "of", "memory", "pages", "."]}
{"contents": ["tipc:", "fix", "info", "leaks", "via", "msg_name", "in", "recv_msg/recv_stream", "The", "code", "in", "set_orig_addr()", "does", "not", "initialize", "all", "of", "the", "members", "of", "struct", "sockaddr_tipc", "when", "filling", "the", "sockaddr", "info", "--", "namely", "the", "union", "is", "only", "partly", "filled.", "This", "will", "make", "recv_msg()", "and", "recv_stream()", "--", "the", "only", "users", "of", "this", "function", "--", "leak", "kernel", "stack", "memory", "as", "the", "msg_name", "member", "is", "a", "local", "variable", "in", "net/socket.c.", "Additionally", "to", "that", "both", "recv_msg()", "and", "recv_stream()", "fail", "to", "update", "the", "msg_namelen", "member", "to", "0", "while", "otherwise", "returning", "with", "0,", "i.e.", "\"success\".", "This", "is", "the", "case", "for,", "e.g.,", "non-blocking", "sockets.", "This", "will", "lead", "to", "a", "128", "byte", "kernel", "stack", "leak", "in", "net/socket.c.", "Fix", "the", "first", "issue", "by", "initializing", "the", "memory", "of", "the", "union", "with", "memset(0).", "Fix", "the", "second", "one", "by", "setting", "msg_namelen", "to", "0", "early", "as", "it", "will", "be", "updated", "later", "if", "we're", "going", "to", "fill", "the", "msg_name", "member.", "Cc:", "Jon", "Maloy", "<jon.maloy@ericsson.com>", "Cc:", "Allan", "Stephens", "<allan.stephens@windriver.com>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "&", "addr", "-", ">", "addr", ",", "0", ",", "sizeof", "(", "addr", "-", ">", "addr", ")", ");", "/", "*", "will", "be", "updated", "in", "set_orig_addr", "(", ")", "if", "needed", "*", "/", "m", "-", ">", "msg_namelen", "=", "0", ";", "/", "*", "will", "be", "updated", "in", "set_orig_addr", "(", ")", "if", "needed", "*", "/", "m", "-", ">", "msg_namelen", "=", "0", ";</s>"], "docstring_tokens": ["using", "recvmsg(2)/recvfrom(2)"]}
{"contents": ["DATACMNS-1282", "-", "Switched", "to", "SimpleEvaluationContext", "in", "MapDataBinder."], "code_tokens": ["import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "SimpleEvaluationContext", ";", "EvaluationContext", "context", "=", "SimpleEvaluationContext", "/", "/", ".", "forPropertyAccessors", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ")", "/", "/", ".", "withConversionService", "(", "conversionService", ")", "/", "/", ".", "withRootObject", "(", "map", ")", "/", "/", ".", "build", "(", ");", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";</s>import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelMessage", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardTypeConverter", ";", "StandardEvaluationContext", "context", "=", "new", "StandardEvaluationContext", "(", ");", "context", ".", "addPropertyAccessor", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ");", "context", ".", "setTypeConverter", "(", "new", "StandardTypeConverter", "(", "conversionService", ")", ");", "context", ".", "setTypeLocator", "(", "typeName", "-", ">", "{", "throw", "new", "SpelEvaluationException", "(", "SpelMessage", ".", "TYPE_NOT_FOUND", ",", "typeName", ")", ";", "}", ");", "context", ".", "setRootObject", "(", "map", ")", ";", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";"], "docstring_tokens": ["sends", "a", "specially", "prepared", "form", "of", "a", "serialized", "object"]}
{"contents": ["Fix", ":", "null", "pointer", "dereference", "when", "processing", "invalid", "XML-RPC", "requests", "(bug", "#51288)"], "code_tokens": ["-", "Fixed", "a", "NULL", "pointer", "dereference", "when", "processing", "invalid", "XML", "-", "RPC", "requests", "(", "Fixes", "CVE", "-", "2010", "-", "0397", ",", "bug", "#", "51288", ")", ".", "(", "Raphael", "Geissert", ")", "-", "-", "TEST", "-", "-", "Bug", "#", "51288", "(", "CVE", "-", "2010", "-", "0397", ",", "NULL", "pointer", "deref", "when", "no", "<", "methodName", ">", "in", "request", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "method", "=", "NULL", ";", "$", "req", "=", "'", "<?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "methodCall", ">", "</", "methodCall", ">", "';", "var_dump", "(", "xmlrpc_decode_request", "(", "$", "req", ",", "$", "method", ")", ");", "var_dump", "(", "$", "method", ")", ";", "echo", "\"", "Done", "\\", "n", "\"", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "NULL", "NULL", "Done", "@", "@", "-", "723", ",", "6", "+", "723", ",", "7", "@", "@", "zval", "*", "decode_request_worker", "(", "zval", "*", "xml_in", ",", "zval", "*", "encoding_in", ",", "zval", "*", "method_name_", "const", "char", "*", "method_name", ";", "method_name", "=", "XMLRPC_RequestGetMethodName", "(", "response", ")", ";", "if", "(", "method_name", ")", "{", "zval_dtor", "(", "method_name_out", ")", ";", "Z_TYPE_P", "(", "method_name_out", ")", "=", "IS_STRING", ";", "Z_STRVAL_P", "(", "method_name_out", ")", "=", "estrdup", "(", "method_name", ")", ";", "Z_STRLEN_P", "(", "method_name_out", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "method_name_out", ")", ");", "}", "else", "{", "retval", "=", "NULL", ";", "}</s>-", "Updated", "timezone", "database", "to", "version", "2010", ".", "3", ".", "(", "Derick", ")", "-", "Fixed", "bug", "#", "51269", "(", "zlib", ".", "output_compression", "Overwrites", "Vary", "Header", ")", ".", "(", "Adam", ")", "-", "Fixed", "bug", "#", "51237", "(", "milter", "SAPI", "crash", "on", "startup", ")", ".", "(", "igmar", "at", "palsenberg", "dot", "com", ")", "-", "Fixed", "bug", "#", "51213", "(", "pdo_mssql", "is", "trimming", "value", "of", "the", "money", "column", ")", ".", "(", "Ilia", ",", "@", "@", "-", "0", ",", "0", "+", "1", ",", "14", "@", "@", "zval_dtor", "(", "method_name_out", ")", ";", "Z_TYPE_P", "(", "method_name_out", ")", "=", "IS_STRING", ";", "Z_STRVAL_P", "(", "method_name_out", ")", "=", "estrdup", "(", "XMLRPC_RequestGetMethodName", "(", "response", ")", ");", "Z_STRLEN_P", "(", "method_name_out", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "method_name_out", ")", ");"], "docstring_tokens": ["a", "specially-crafted", "argument"]}
{"contents": ["QPID-8203:", "[Broker-J][AMQP", "0-9]", "Fix", "maximum", "message", "size", "check"], "code_tokens": ["else", "{", "publishContentHeader", "(", "new", "ContentHeaderBody", "(", "properties", ",", "bodySize", ")", ");", "}", "/", "*", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "/", "package", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "v0_8", ".", "extension", ".", "maxsize", ";", "import", "static", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerAdmin", ".", "KIND_BROKER_J", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "java", ".", "net", ".", "InetSocketAddress", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "java", ".", "util", ".", "stream", ".", "Stream", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "protocol", ".", "v0_8", ".", "transport", ".", "ChannelCloseBody", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "protocol", ".", "v0_8", ".", "transport", ".", "ChannelOpenOkBody", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "protocol", ".", "v0_8", ".", "transport", ".", "ConnectionCloseOkBody", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "ChannelClosedResponse", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "v0_8", ".", "FrameTransport", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "protocol", ".", "v0_8", ".", "Interaction", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerAdmin", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerAdminUsingTestBase", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "BrokerSpecific", ";", "import", "org", ".", "apache", ".", "qpid", ".", "tests", ".", "utils", ".", "ConfigItem", ";", "@", "BrokerSpecific", "(", "kind", "=", "KIND_BROKER_J", ")", "@", "ConfigItem", "(", "name", "=", "\"", "qpid", ".", "max_message_size", "\"", ",", "value", "=", "\"", "1000", "\"", ")", "public", "class", "MaximumMessageSize", "extends", "BrokerAdminUsingTestBase", "{", "private", "InetSocketAddress", "_brokerAddress", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "_brokerAddress", "=", "getBrokerAdmin", "(", ").", "getBrokerAddress", "(", "BrokerAdmin", ".", "PortType", ".", "ANONYMOUS_AMQP", ")", ";", "getBrokerAdmin", "(", ").", "createQueue", "(", "BrokerAdmin", ".", "TEST_QUEUE_NAME", ")", ";", "}", "@", "Test", "public", "void", "limitExceeded", "(", ")", "throws", "Exception", "{", "String", "content", "=", "Stream", ".", "generate", "(", "()", "-", ">", "String", ".", "valueOf", "(", "'.", "')", ").", "limit", "(", "1001", ")", ".", "collect", "(", "Collectors", ".", "joining", "(", "))", ";", "try", "(", "FrameTransport", "transport", "=", "new", "FrameTransport", "(", "_brokerAddress", ")", ".", "connect", "(", "))", "{", "final", "Interaction", "interaction", "=", "transport", ".", "newInteraction", "(", ");", "interaction", ".", "openAnonymousConnection", "(", ")", ".", "channel", "(", ").", "open", "(", ").", "consumeResponse", "(", "ChannelOpenOkBody", ".", "class", ")", ".", "basic", "(", ").", "contentHeaderPropertiesContentType", "(", "\"", "text", "/", "plain", "\"", ")", ".", "contentHeaderPropertiesDeliveryMode", "(", "(", "byte", ")", "1", ")", ".", "contentHeaderPropertiesPriority", "(", "(", "byte", ")", "1", ")", ".", "publishExchange", "(", "\"\"", ")", ".", "publishRoutingKey", "(", "BrokerAdmin", ".", "TEST_QUEUE_NAME", ")", ".", "content", "(", "content", ")", ".", "publishMessage", "(", ")", ".", "consumeResponse", "(", "ChannelCloseBody", ".", "class", ")", ".", "channel", "(", ").", "closeOk", "(", ")", ".", "connection", "(", ").", "close", "(", ")", ".", "consumeResponse", "(", "ConnectionCloseOkBody", ".", "class", ",", "ChannelClosedResponse", ".", "class", ")", ";", "assertThat", "(", "getBrokerAdmin", "(", ").", "getQueueDepthMessages", "(", "BrokerAdmin", ".", "TEST_QUEUE_NAME", ")", ",", "is", "(", "equalTo", "(", "0", ")", "))", ";", "}", "}", "}</s>publishContentHeader", "(", "new", "ContentHeaderBody", "(", "properties", ",", "bodySize", ")", ");"], "docstring_tokens": ["setting", "context", "variable", "\"qpid.max_message_size", "\"", "to", "\"0", "\"", "or", "any", "negative", "value"]}
{"contents": ["ecryptfs:", "forbid", "opening", "files", "without", "mmap", "handler", "This", "prevents", "users", "from", "triggering", "a", "stack", "overflow", "through", "a", "recursive", "invocation", "of", "pagefault", "handling", "that", "involves", "mapping", "procfs", "files", "into", "virtual", "memory.", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Acked-by:", "Tyler", "Hicks", "<tyhicks@canonical.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "include", "<", "linux", "/", "file", ".", "h", ">", "goto", "have_file", ";", "if", "(", "IS_ERR", "(", "*", "lower_file", ")", ")", "{", "goto", "out", ";", "}", "have_file", ":", "if", "(", "(*", "lower_file", ")", "->", "f_op", "-", ">", "mmap", "=", "=", "NULL", ")", "{", "fput", "(", "*", "lower_file", ")", ";", "*", "lower_file", "=", "NULL", ";", "rc", "=", "-", "EMEDIUMTYPE", ";", "}</s>goto", "out", ";", "if", "(", "IS_ERR", "(", "*", "lower_file", ")", ")"], "docstring_tokens": ["create", "a", "stack", "with", "a", "bounded", "length", "that", "is", "still", "too", "high"]}
{"contents": ["net:", "Use", "netlink_ns_capable", "to", "verify", "the", "permisions", "of", "netlink", "messages", "It", "is", "possible", "by", "passing", "a", "netlink", "socket", "to", "a", "more", "privileged", "executable", "and", "then", "to", "fool", "that", "executable", "into", "writing", "to", "the", "socket", "data", "that", "happens", "to", "be", "valid", "netlink", "message", "to", "do", "something", "that", "privileged", "executable", "did", "not", "intend", "to", "do.", "To", "keep", "this", "from", "happening", "replace", "bare", "capable", "and", "ns_capable", "calls", "with", "netlink_capable,", "netlink_net_calls", "and", "netlink_ns_capable", "calls.", "Which", "act", "the", "same", "as", "the", "previous", "calls", "except", "they", "verify", "that", "the", "opener", "of", "the", "socket", "had", "the", "desired", "permissions", "as", "well.", "Reported-by:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "__netlink_ns_capable", "(", "nsp", ",", "&", "init_user_ns", ",", "CAP_NET_ADMIN", ")", ")", "{", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_SYS_ADMIN", ")", ")", "{", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_AUDIT_CONTROL", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_AUDIT_WRITE", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "static", "int", "do_setlink", "(", "const", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "struct", "ifinfomsg", "*", "ifm", ",", "if", "(", "!", "netlink_ns_capable", "(", "skb", ",", "net", "-", ">", "user_ns", ",", "CAP_NET_ADMIN", ")", ")", "{", "err", "=", "do_setlink", "(", "skb", ",", "dev", ",", "ifm", ",", "tb", ",", "ifname", ",", "0", ")", ";", "static", "int", "rtnl_group_changelink", "(", "const", "struct", "sk_buff", "*", "skb", ",", "struct", "net", "*", "net", ",", "int", "group", ",", "err", "=", "do_setlink", "(", "skb", ",", "dev", ",", "ifm", ",", "tb", ",", "NULL", ",", "0", ")", ";", "return", "do_setlink", "(", "skb", ",", "dev", ",", "ifm", ",", "tb", ",", "ifname", ",", "modified", ")", ";", "return", "rtnl_group_changelink", "(", "skb", ",", "net", ",", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "kind", "!", "=", "2", "&", "&", "!", "netlink_net_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "nlh", "-", ">", "nlmsg_type", "=", "=", "RTM_SETDCB", ")", "&", "&", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_net_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "{", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "may_report_filterinfo", "=", "netlink_net_capable", "(", "cb", "-", ">", "skb", ",", "CAP_NET_ADMIN", ")", ";", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_SYS_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_SYS_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETACTION", ")", "&", "&", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETTFILTER", ")", "&", "&", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETQDISC", ")", "&", "&", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETTCLASS", ")", "&", "&", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "req_userhdr", "-", ">", "cmd", "&", "0xC000", ")", "&", "&", "(", "!", "netlink_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", "))", "if", "(", "!", "netlink_net_capable", "(", "skb", ",", "CAP_NET_ADMIN", ")", ")</s>if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "{", "if", "(", "!", "capable", "(", "CAP_SYS_ADMIN", ")", ")", "{", "if", "(", "!", "capable", "(", "CAP_AUDIT_CONTROL", ")", ")", "if", "(", "!", "capable", "(", "CAP_AUDIT_WRITE", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "static", "int", "do_setlink", "(", "struct", "net_device", "*", "dev", ",", "struct", "ifinfomsg", "*", "ifm", ",", "if", "(", "!", "ns_capable", "(", "net", "-", ">", "user_ns", ",", "CAP_NET_ADMIN", ")", ")", "{", "err", "=", "do_setlink", "(", "dev", ",", "ifm", ",", "tb", ",", "ifname", ",", "0", ")", ";", "static", "int", "rtnl_group_changelink", "(", "struct", "net", "*", "net", ",", "int", "group", ",", "err", "=", "do_setlink", "(", "dev", ",", "ifm", ",", "tb", ",", "NULL", ",", "0", ")", ";", "return", "do_setlink", "(", "dev", ",", "ifm", ",", "tb", ",", "ifname", ",", "modified", ")", ";", "return", "rtnl_group_changelink", "(", "net", ",", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "kind", "!", "=", "2", "&", "&", "!", "ns_capable", "(", "net", "-", ">", "user_ns", ",", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "nlh", "-", ">", "nlmsg_type", "=", "=", "RTM_SETDCB", ")", "&", "&", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "ns_capable", "(", "net", "-", ">", "user_ns", ",", "CAP_NET_ADMIN", ")", ")", "{", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "may_report_filterinfo", "=", "ns_capable", "(", "net", "-", ">", "user_ns", ",", "CAP_NET_ADMIN", ")", ";", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_SYS_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_SYS_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETACTION", ")", "&", "&", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETTFILTER", ")", "&", "&", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETQDISC", ")", "&", "&", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "n", "-", ">", "nlmsg_type", "!", "=", "RTM_GETTCLASS", ")", "&", "&", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "(", "req_userhdr", "-", ">", "cmd", "&", "0xC000", ")", "&", "&", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", "))", "if", "(", "!", "ns_capable", "(", "net", "-", ">", "user_ns", ",", "CAP_NET_ADMIN", ")", ")"], "docstring_tokens": ["looking", "at", "the", "networking", "stack"]}
{"contents": ["[S390]", ":", "prevent", "ptrace", "padding", "area", "read/write", "in", "31-bit", "mode", "When", "running", "a", "31-bit", "ptrace,", "on", "either", "an", "s390", "or", "s390x", "kernel,", "reads", "and", "writes", "into", "a", "padding", "area", "in", "struct", "user_regs_struct32", "will", "result", "in", "a", "kernel", "panic.", "This", "is", "also", "known", "as", ".", "Test", "case", "available", "here:", "http://sources.redhat.com/cgi-bin/cvsweb.cgi/~checkout~/tests/ptrace-tests/tests/user-area-padding.c?cvsroot=systemtap", "Steps", "to", "reproduce:", "1)", "wget", "the", "above", "2)", "gcc", "-o", "user-area-padding-31bit", "user-area-padding.c", "-Wall", "-ggdb2", "-D_GNU_SOURCE", "-m31", "3)", "./user-area-padding-31bit", "<panic>", "Test", "status", "-----------", "Without", "patch,", "both", "s390", "and", "s390x", "kernels", "panic.", "With", "patch,", "the", "test", "case,", "as", "well", "as", "the", "gdb", "testsuite,", "pass", "without", "incident,", "padding", "area", "reads", "returning", "zero,", "writes", "ignored.", "Nb:", "original", "version", "returned", "-EINVAL", "on", "write", "attempts,", "which", "broke", "the", "gdb", "test", "and", "made", "the", "test", "case", "slightly", "unhappy,", "Jan", "Kratochvil", "suggested", "the", "change", "to", "return", "0", "on", "write", "attempts.", "Signed-off-by:", "Jarod", "Wilson", "<jarod@redhat.com>", "Tested-by:", "Jan", "Kratochvil", "<jan.kratochvil@redhat.com>", "Signed-off-by:", "Martin", "Schwidefsky", "<schwidefsky@de.ibm.com>"], "code_tokens": ["/", "*", "nb", ":", "there", "'", "s", "a", "4", "-", "byte", "hole", "here", "*", "/", "}", "else", "if", "(", "addr", "<", "(", "addr_t", ")", "&", "dummy", "-", ">", "regs", ".", "fp_regs", ")", "{", "/", "*", "*", "prevent", "reads", "of", "padding", "hole", "between", "*", "orig_gpr2", "and", "fp_regs", "on", "s390", ".", "*", "/", "tmp", "=", "0", ";", "}", "else", "if", "(", "addr", "<", "(", "addr_t", ")", "&", "dummy", "-", ">", "regs", ".", "fp_regs", ")", "{", "/", "*", "*", "prevent", "writes", "of", "padding", "hole", "between", "*", "orig_gpr2", "and", "fp_regs", "on", "s390", ".", "*", "/", "return", "0", ";", "}", "else", "if", "(", "addr", "<", "(", "addr_t", ")", "&", "dummy32", "-", ">", "regs", ".", "fp_regs", ")", "{", "/", "*", "*", "prevent", "reads", "of", "padding", "hole", "between", "*", "orig_gpr2", "and", "fp_regs", "on", "s390", ".", "*", "/", "tmp", "=", "0", ";", "}", "else", "if", "(", "addr", "<", "(", "addr_t", ")", "&", "dummy32", "-", ">", "regs", ".", "fp_regs", ")", "{", "/", "*", "*", "prevent", "writess", "of", "padding", "hole", "between", "*", "orig_gpr2", "and", "fp_regs", "on", "s390", ".", "*", "/", "return", "0", ";</s>"], "docstring_tokens": ["using", "the", "user-area-padding", "test"]}
{"contents": ["Fix", "bug", "#71610:", "Type", "Confusion", "Vulnerability", "-", "SOAP", "/", "make_http_soap_request()"], "code_tokens": ["Z_TYPE_P", "(", "tmp", ")", "!", "=", "IS_STRING", "|", "|", "Z_TYPE_P", "(", "tmp", ")", "!", "=", "IS_STRING", "|", "|", "-", "-", "TEST", "-", "-", "SOAP", "Bug", "#", "71610", "-", "Type", "Confusion", "Vulnerability", "-", "SOAP", "/", "make_http_soap_request", "(", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "'", "skipif", ".", "inc", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "exploit", "=", "unserialize", "(", "'", "O", ":", "10", ":", "\"", "SoapClient", "\"", ":", "3", ":", "{", "s", ":", "3", ":", "\"", "uri", "\"", ";", "s", ":", "1", ":", "\"", "a", "\"", ";", "s", ":", "8", ":", "\"", "location", "\"", ";", "s", ":", "19", ":", "\"", "http", ":", "//", "testuri", ".", "org", "/", "\";", "s", ":", "8", ":", "\"", "_cookies", "\"", ";", "a", ":", "1", ":", "{", "s", ":", "8", ":", "\"", "manhluat", "\"", ";", "a", ":", "3", ":", "{", "i", ":", "0", ";", "s", ":", "0", ":", "\"\"", ";", "i", ":", "1", ";", "N", ";", "i", ":", "2", ";", "N", ";", "}}", "}}", "')", ";", "try", "{", "$", "exploit", "-", ">", "blahblah", "(", ");", "}", "catch", "(", "SoapFault", "$", "e", ")", "{", "echo", "$", "e", "-", ">", "getMessage", "(", ").", "\"\\", "n", "\"", ";", "}", "?", ">", "-", "-", "EXPECT", "-", "-", "looks", "like", "we", "got", "no", "XML", "document</s>"], "docstring_tokens": ["sending", "a", "specially", "crafted", "SOAP", "request"]}
{"contents": ["BCryptPasswordEncoder", "rawPassword", "cannot", "be", "null", "Closes", "gh-8317"], "code_tokens": ["if", "(", "rawPassword", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "rawPassword", "cannot", "be", "null", "\"", ");", "}", "if", "(", "rawPassword", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "rawPassword", "cannot", "be", "null", "\"", ");", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "encodeNullRawPassword", "(", ")", "{", "BCryptPasswordEncoder", "encoder", "=", "new", "BCryptPasswordEncoder", "(", ");", "encoder", ".", "encode", "(", "null", ")", ";", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "matchNullRawPassword", "(", ")", "{", "BCryptPasswordEncoder", "encoder", "=", "new", "BCryptPasswordEncoder", "(", ");", "encoder", ".", "matches", "(", "null", ",", "\"", "does", "-", "not", "-", "matter", "\"", ");", "}</s>"], "docstring_tokens": ["using", "dictionary", "attack", "techniques"]}
{"contents": ["ipvs:", "fix", "info", "leak", "in", "getsockopt(IP_VS_SO_GET_TIMEOUT)", "If", "at", "least", "one", "of", "CONFIG_IP_VS_PROTO_TCP", "or", "CONFIG_IP_VS_PROTO_UDP", "is", "not", "set,", "__ip_vs_get_timeouts()", "does", "not", "fully", "initialize", "the", "structure", "that", "gets", "copied", "to", "userland", "and", "that", "for", "leaks", "up", "to", "12", "bytes", "of", "kernel", "stack.", "Add", "an", "explicit", "memset(0)", "before", "passing", "the", "structure", "to", "__ip_vs_get_timeouts()", "to", "avoid", "the", "info", "leak.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Cc:", "Wensong", "Zhang", "<wensong@linux-vs.org>", "Cc:", "Simon", "Horman", "<horms@verge.net.au>", "Cc:", "Julian", "Anastasov", "<ja@ssi.bg>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "&", "t", ",", "0", ",", "sizeof", "(", "t", ")", ");</s>"], "docstring_tokens": ["via", "a", "crafted", "application", "."]}
{"contents": ["security:", "avoid", "calling", "a", "NULL", "function", "pointer", "in", "drivers/video/tvaudio.c", "NULL", "function", "pointers", "are", "very", "bad", "security", "wise.", "This", "one", "got", "caught", "by", "kerneloops.org", "quite", "a", "few", "times,", "so", "it's", "happening", "in", "the", "field....", "Fix", "is", "simple,", "check", "the", "function", "pointer", "for", "NULL,", "like", "6", "other", "places", "in", "the", "same", "function", "are", "already", "doing.", "Signed-off-by:", "Arjan", "van", "de", "Ven", "<arjan@linux.intel.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "desc", "-", ">", "checkmode", "&", "&", "desc", "-", ">", "setmode", ")", "{</s>if", "(", "desc", "-", ">", "checkmode", ")", "{"], "docstring_tokens": ["using", "register", "aliases"]}
{"contents": ["Fix", "various", "sendfile", "issues", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc5.5.x/trunk@1158244", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["if", "(", "sendfileData", ".", "socket", "=", "=", "0", ")", "{", "/", "/", "Didn", "'", "t", "send", "all", "the", "data", "but", "the", "socket", "is", "no", "longer", "/", "/", "set", ".", "Something", "went", "wrong", ".", "Close", "the", "connection", ".", "/", "/", "Too", "late", "to", "set", "status", "code", ".", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "{", "log", ".", "debug", "(", "sm", ".", "getString", "(", "\"", "http11processor", ".", "sendfile", ".", "error", "\"", "))", ";", "}", "openSocket", "=", "false", ";", "}", "else", "{", "openSocket", "=", "true", ";", "}", "http11processor", ".", "sendfile", ".", "error", "=", "Error", "sending", "data", "using", "sendfile", ".", "May", "be", "caused", "by", "invalid", "request", "attributes", "for", "start", "/", "end", "points", "Pool", ".", "destroy", "(", "data", ".", "fdpool", ")", ";", "/", "/", "No", "need", "to", "close", "socket", ",", "this", "will", "be", "done", "by", "/", "/", "calling", "code", "since", "data", ".", "socket", "=", "=", "0", "coyoteRequest", ".", "sendfileNotCanonical", "=", "Unable", "to", "determine", "canonical", "name", "of", "file", "[", "{", "0", "}", "]", "specified", "for", "use", "with", "sendfile", "import", "java", ".", "io", ".", "File", ";", "if", "(", "System", ".", "getSecurityManager", "(", ")", "!", "=", "null", "&", "&", "name", ".", "equals", "(", "\"", "org", ".", "apache", ".", "tomcat", ".", "sendfile", ".", "filename", "\"", "))", "{", "/", "/", "Use", "the", "canonical", "file", "name", "to", "avoid", "any", "possible", "symlink", "and", "/", "/", "relative", "path", "issues", "String", "canonicalPath", ";", "try", "{", "canonicalPath", "=", "new", "File", "(", "value", ".", "toString", "(", "))", ".", "getCanonicalPath", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "SecurityException", "se", "=", "new", "SecurityException", "(", "sm", ".", "getString", "(", "\"", "coyoteRequest", ".", "sendfileNotCanonical", "\"", ",", "value", ")", ");", "se", ".", "initCause", "(", "e", ")", ";", "throw", "se", ";", "}", "/", "/", "Sendfile", "is", "performed", "in", "Tomcat", "'", "s", "security", "context", "so", "need", "to", "/", "/", "check", "if", "the", "web", "app", "is", "permitted", "to", "access", "the", "file", "while", "still", "/", "/", "in", "the", "web", "app", "'", "s", "security", "context", "System", ".", "getSecurityManager", "(", ").", "checkRead", "(", "canonicalPath", ")", ";", "/", "/", "Update", "the", "value", "so", "the", "canonical", "path", "is", "used", "value", "=", "canonicalPath", ";", "}", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">", "<", "changelog", ">", "<", "fix", ">", "Fix", "CVE", "-", "2011", "-", "2526", ".", "Protect", "against", "crashes", "(", "HTTP", "APR", ")", "if", "sendfile", "is", "configured", "to", "send", "more", "data", "than", "is", "available", "in", "the", "file", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", "></s>*", "Fix", "various", "sendfile", "issues", ".", "CVE", "-", "2011", "-", "2526", "This", "is", "a", "port", "of", "r1145380", ",", "r1145694", "and", "r1146005", "http", ":", "//", "people", ".", "apache", ".", "org", "/", "~", "markt", "/", "patches", "/", "2011", "-", "07", "-", "13", "-", "cve", "-", "2011", "-", "2526", "-", "tc5", ".", "patch", "+", "1", ":", "markt", ",", "kfujino", ",", "kkolinko", "-", "1", ":", "openSocket", "=", "true", ";", "Socket", ".", "destroy", "(", "data", ".", "socket", ")", ";", "request", ".", "setAttribute", "(", "\"", "org", ".", "apache", ".", "tomcat", ".", "sendfile", ".", "token", "\"", ",", "this", ")", ";"], "docstring_tokens": ["by", "leveraging", "an", "untrusted", "web", "application", "."]}
{"contents": ["Validate", "authorization", "request", "on", "approval", "Fixes", "gh-1481"], "code_tokens": ["*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "GrantedAuthority", ";", "import", "org", ".", "springframework", ".", "util", ".", "ObjectUtils", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "SessionAttributes", "(", "{", "AuthorizationEndpoint", ".", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "AuthorizationEndpoint", ".", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", "}", ")", "static", "final", "String", "AUTHORIZATION_REQUEST_ATTR_NAME", "=", "\"", "authorizationRequest", "\"", ";", "static", "final", "String", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", "=", "\"", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "AuthorizationEndpoint", ".", "ORIGINAL_AUTHORIZATION_REQUEST", "\"", ";", "/", "/", "Store", "authorizationRequest", "AND", "an", "immutable", "Map", "of", "authorizationRequest", "in", "session", "/", "/", "which", "will", "be", "used", "to", "validate", "against", "in", "approveOrDeny", "(", ")", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "Map", "<", "String", ",", "Object", ">", "unmodifiableMap", "(", "AuthorizationRequest", "authorizationRequest", ")", "{", "Map", "<", "String", ",", "Object", ">", "authorizationRequestMap", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ";", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "CLIENT_ID", ",", "authorizationRequest", ".", "getClientId", "(", "))", ";", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "STATE", ",", "authorizationRequest", ".", "getState", "(", "))", ";", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "REDIRECT_URI", ",", "authorizationRequest", ".", "getRedirectUri", "(", "))", ";", "if", "(", "authorizationRequest", ".", "getResponseTypes", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "RESPONSE_TYPE", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "String", ">", "(", "authorizationRequest", ".", "getResponseTypes", "(", "))", "))", ";", "}", "if", "(", "authorizationRequest", ".", "getScope", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "SCOPE", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "String", ">", "(", "authorizationRequest", ".", "getScope", "(", "))", "))", ";", "}", "authorizationRequestMap", ".", "put", "(", "\"", "approved", "\"", ",", "authorizationRequest", ".", "isApproved", "(", "))", ";", "if", "(", "authorizationRequest", ".", "getResourceIds", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "\"", "resourceIds", "\"", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "String", ">", "(", "authorizationRequest", ".", "getResourceIds", "(", "))", "))", ";", "}", "if", "(", "authorizationRequest", ".", "getAuthorities", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "\"", "authorities", "\"", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "GrantedAuthority", ">", "(", "authorizationRequest", ".", "getAuthorities", "(", "))", "))", ";", "}", "return", "Collections", ".", "unmodifiableMap", "(", "authorizationRequestMap", ")", ";", "}", "AuthorizationRequest", "authorizationRequest", "=", "(", "AuthorizationRequest", ")", "model", ".", "get", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "/", "/", "Check", "to", "ensure", "the", "Authorization", "Request", "was", "not", "modified", "during", "the", "user", "approval", "step", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Map", "<", "String", ",", "Object", ">", "originalAuthorizationRequest", "=", "(", "Map", "<", "String", ",", "Object", ">", ")", "model", ".", "get", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "if", "(", "isAuthorizationRequestModified", "(", "authorizationRequest", ",", "originalAuthorizationRequest", ")", ")", "{", "throw", "new", "InvalidRequestException", "(", "\"", "Changes", "were", "detected", "from", "the", "original", "authorization", "request", ".", "\")", ";", "}", "private", "boolean", "isAuthorizationRequestModified", "(", "AuthorizationRequest", "authorizationRequest", ",", "Map", "<", "String", ",", "Object", ">", "originalAuthorizationRequest", ")", "{", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getClientId", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "CLIENT_ID", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getState", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "STATE", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getRedirectUri", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "REDIRECT_URI", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getResponseTypes", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "RESPONSE_TYPE", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getScope", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "SCOPE", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "isApproved", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "\"", "approved", "\"", "))", ")", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getResourceIds", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "\"", "resourceIds", "\"", "))", ")", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getAuthorities", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "\"", "authorities", "\"", "))", ")", "{", "return", "true", ";", "}", "return", "false", ";", "}", "webRequest", ",", "AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "*", "Copyright", "2006", "-", "2018", "the", "original", "author", "or", "authors", ".", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "AuthorizationEndpoint", ".", "AUTHORIZATION_REQUEST_ATTR_NAME", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "AuthorizationEndpoint", ".", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "authority", ".", "AuthorityUtils", ";", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "#", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "=", "?", "s", "\"", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "&", "bar", "=", "foo", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "b", "=", "&", "bar", "=", "f", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "path", "?", "foo", "=", "b", "%", "20", "%", "3D", "&", "bar", "=", "f", "%", "20", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", "?", "t", "=", "a", "%", "3Db", "%", "26ep", "%", "3Dtest", "%", "2540test", ".", "me", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedClientId", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setClientId", "(", "\"", "bar", "\"", ");", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedState", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setState", "(", "\"", "state", "-", "5678", "\"", ");", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedRedirectUri", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setRedirectUri", "(", "\"", "http", ":", "//", "somewhere", ".", "com", "\"", ");", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedResponseTypes", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setResponseTypes", "(", "Collections", ".", "singleton", "(", "\"", "implicit", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedScope", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setScope", "(", "Arrays", ".", "asList", "(", "\"", "read", "\"", ",", "\"", "write", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedApproved", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "authorizationRequest", ".", "setApproved", "(", "false", ")", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setApproved", "(", "true", ")", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedResourceIds", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setResourceIds", "(", "Collections", ".", "singleton", "(", "\"", "resource", "-", "other", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedAuthorities", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setAuthorities", "(", "AuthorityUtils", ".", "commaSeparatedStringToAuthorityList", "(", "\"", "authority", "-", "other", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";</s>*", "Copyright", "2002", "-", "2011", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "SessionAttributes", "(", "\"", "authorizationRequest", "\"", ")", "/", "/", "Place", "auth", "request", "into", "the", "model", "so", "that", "it", "is", "stored", "in", "the", "session", "/", "/", "for", "approveOrDeny", "to", "use", ".", "That", "way", "we", "make", "sure", "that", "auth", "request", "comes", "from", "the", "session", ",", "/", "/", "so", "any", "auth", "request", "parameters", "passed", "to", "approveOrDeny", "will", "be", "ignored", "and", "retrieved", "from", "the", "session", ".", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "authorizationRequest", ")", ";", "AuthorizationRequest", "authorizationRequest", "=", "(", "AuthorizationRequest", ")", "model", ".", "get", "(", "\"", "authorizationRequest", "\"", ");", "webRequest", ",", "\"", "authorizationRequest", "\"", ");", "*", "Copyright", "2006", "-", "2011", "the", "original", "author", "or", "authors", ".", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "#", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "=", "?", "s", "\"", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "&", "bar", "=", "foo", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "b", "=", "&", "bar", "=", "f", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "path", "?", "foo", "=", "b", "%", "20", "%", "3D", "&", "bar", "=", "f", "%", "20", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", "?", "t", "=", "a", "%", "3Db", "%", "26ep", "%", "3Dtest", "%", "2540test", ".", "me", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "request", ")", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "\"", "authorizationRequest", "\"", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "request", ")", ";"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request", "to", "the", "approval", "endpoint"]}
{"contents": ["ALSA:", "pcm", ":", "Call", "kill_fasync()", "in", "stream", "lock", "Currently", "kill_fasync()", "is", "called", "outside", "the", "stream", "lock", "in", "snd_pcm_period_elapsed().", "This", "is", "potentially", "racy,", "since", "the", "stream", "may", "get", "released", "even", "during", "the", "irq", "handler", "is", "running.", "Although", "snd_pcm_release_substream()", "calls", "snd_pcm_drop(),", "this", "doesn't", "guarantee", "that", "the", "irq", "handler", "finishes,", "thus", "the", "kill_fasync()", "call", "outside", "the", "stream", "spin", "lock", "may", "be", "invoked", "after", "the", "substream", "is", "detached,", "as", "recently", "reported", "by", "KASAN.", "As", "a", "quick", "workaround,", "move", "kill_fasync()", "call", "inside", "the", "stream", "lock.", "The", "fasync", "is", "rarely", "used", "interface,", "so", "this", "shouldn't", "have", "a", "big", "impact", "from", "the", "performance", "POV.", "Ideally,", "we", "should", "implement", "some", "sync", "mechanism", "for", "the", "proper", "finish", "of", "stream", "and", "irq", "handler.", "But", "this", "oneliner", "should", "suffice", "for", "most", "cases,", "so", "far.", "Reported-by:", "Baozeng", "Ding", "<sploving1@gmail.com>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["snd_pcm_stream_unlock_irqrestore", "(", "substream", ",", "flags", ")", ";</s>snd_pcm_stream_unlock_irqrestore", "(", "substream", ",", "flags", ")", ";"], "docstring_tokens": ["using", "a", "specially-crafted", "SNDRV_PCM_TRIGGER_START", "command"]}
{"contents": ["dccp/tcp:", "do", "not", "inherit", "mc_list", "from", "parent", "syzkaller", "found", "a", "way", "to", "trigger", "double", "frees", "from", "ip_mc_drop_socket()", "It", "turns", "out", "that", "leave", "a", "copy", "of", "parent", "mc_list", "at", "accept()", "time,", "which", "is", "very", "bad.", "Very", "similar", "to", "commit", "8b485ce69876", "(\"tcp:", "do", "not", "inherit", "fastopen_req", "from", "parent\")", "Initial", "report", "from", "Pray3r,", "completed", "by", "Andrey", "one.", "Thanks", "a", "lot", "to", "them", "!", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Reported-by:", "Pray3r", "<pray3r.z@gmail.com>", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Tested-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["inet_sk", "(", "newsk", ")", "->", "mc_list", "=", "NULL", ";</s>"], "docstring_tokens": ["by", "leveraging", "use", "of", "the", "accept", "system", "call", "."]}
{"contents": ["[SECURITY-186]", "check", "user", "permissions", "when", "calling", "QUEUE", "API"], "code_tokens": ["import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "List", "<", "Item", ">", "r", "=", "new", "ArrayList", "<", "Item", ">", "()", ";", "for", "(", "WaitingItem", "p", ":", "waitingList", ")", "{", "r", "=", "filterItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "for", "(", "BlockedItem", "p", ":", "blockedProjects", ".", "values", "(", "))", "{", "r", "=", "filterItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "for", "(", "BuildableItem", "p", ":", "reverse", "(", "buildables", ".", "values", "(", "))", ")", "{", "r", "=", "filterItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "for", "(", "BuildableItem", "p", ":", "reverse", "(", "pendings", ".", "values", "(", "))", ")", "{", "r", "=", "filterItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "Item", "[", "]", "items", "=", "new", "Item", "[", "r", ".", "size", "(", ")]", ";", "r", ".", "toArray", "(", "items", ")", ";", "return", "items", ";", "}", "private", "List", "<", "Item", ">", "filterItemListBasedOnPermissions", "(", "List", "<", "Item", ">", "r", ",", "Item", "t", ")", "{", "if", "(", "t", ".", "task", "instanceof", "hudson", ".", "model", ".", "Item", ")", "{", "if", "(", "((", "hudson", ".", "model", ".", "Item", ")", "t", ".", "task", ")", ".", "hasPermission", "(", "hudson", ".", "model", ".", "Item", ".", "READ", ")", ")", "{", "r", ".", "add", "(", "t", ")", ";", "}", "}", "return", "r", ";", "}", "/", "**", "*", "Returns", "an", "array", "of", "Item", "for", "which", "it", "is", "only", "visible", "the", "name", "of", "the", "task", ".", "*", "*", "Generally", "speaking", "the", "array", "is", "sorted", "such", "that", "the", "items", "that", "are", "most", "likely", "built", "sooner", "are", "*", "at", "the", "end", ".", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "Exported", "(", "inline", "=", "true", ")", "public", "synchronized", "StubItem", "[", "]", "getDiscoverableItems", "(", ")", "{", "List", "<", "StubItem", ">", "r", "=", "new", "ArrayList", "<", "StubItem", ">", "()", ";", "for", "(", "WaitingItem", "p", ":", "waitingList", ")", "{", "r", "=", "filterDiscoverableItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "for", "(", "BlockedItem", "p", ":", "blockedProjects", ".", "values", "(", "))", "{", "r", "=", "filterDiscoverableItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "for", "(", "BuildableItem", "p", ":", "reverse", "(", "buildables", ".", "values", "(", "))", ")", "{", "r", "=", "filterDiscoverableItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "for", "(", "BuildableItem", "p", ":", "reverse", "(", "pendings", ".", "values", "(", "))", ")", "{", "r", "=", "filterDiscoverableItemListBasedOnPermissions", "(", "r", ",", "p", ")", ";", "}", "StubItem", "[", "]", "items", "=", "new", "StubItem", "[", "r", ".", "size", "(", ")]", ";", "r", ".", "toArray", "(", "items", ")", ";", "return", "items", ";", "}", "private", "List", "<", "StubItem", ">", "filterDiscoverableItemListBasedOnPermissions", "(", "List", "<", "StubItem", ">", "r", ",", "Item", "t", ")", "{", "if", "(", "t", ".", "task", "instanceof", "hudson", ".", "model", ".", "Item", ")", "{", "if", "(", "!(", "(", "hudson", ".", "model", ".", "Item", ")", "t", ".", "task", ")", ".", "hasPermission", "(", "hudson", ".", "model", ".", "Item", ".", "READ", ")", "&", "&", "(", "(", "hudson", ".", "model", ".", "Item", ")", "t", ".", "task", ")", ".", "hasPermission", "(", "hudson", ".", "model", ".", "Item", ".", "DISCOVER", ")", ")", "{", "r", ".", "add", "(", "new", "StubItem", "(", "new", "StubTask", "(", "t", ".", "task", ")", "))", ";", "}", "}", "/", "**", "*", "A", "Stub", "class", "for", "{", "@", "link", "Task", "}", "which", "exposes", "only", "the", "name", "of", "the", "Task", "to", "be", "displayed", "when", "the", "user", "*", "has", "DISCOVERY", "permissions", "only", ".", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "ExportedBean", "(", "defaultVisibility", "=", "999", ")", "public", "static", "class", "StubTask", "{", "private", "String", "name", ";", "public", "StubTask", "(", "@", "Nonnull", "Queue", ".", "Task", "base", ")", "{", "this", ".", "name", "=", "base", ".", "getName", "(", ");", "}", "@", "Exported", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "}", "/", "**", "*", "A", "Stub", "class", "for", "{", "@", "link", "Item", "}", "which", "exposes", "only", "the", "name", "of", "the", "Task", "to", "be", "displayed", "when", "the", "user", "*", "has", "DISCOVERY", "permissions", "only", ".", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "ExportedBean", "(", "defaultVisibility", "=", "999", ")", "public", "class", "StubItem", "{", "@", "Exported", "public", "StubTask", "task", ";", "public", "StubItem", "(", "StubTask", "task", ")", "{", "this", ".", "task", "=", "task", ";", "}", "}", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "DomElement", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "DomNode", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "xml", ".", "XmlPage", ";", "import", "hudson", ".", "model", ".", "queue", ".", "CauseOfBlockage", ";", "import", "hudson", ".", "model", ".", "queue", ".", "QueueTaskDispatcher", ";", "import", "hudson", ".", "security", ".", "AuthorizationMatrixProperty", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "security", ".", "ProjectMatrixAuthorizationStrategy", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "SleepBuilder", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "assertSame", "(", "p", ",", "b", ".", "getProject", "(", "))", ";", "assertSame", "(", "b", ",", "b2", ")", ";", "public", "void", "testQueueApiOutputShouldBeFilteredByUserPermission", "(", ")", "throws", "Exception", "{", "jenkins", ".", "setSecurityRealm", "(", "createDummySecurityRealm", "(", "))", ";", "ProjectMatrixAuthorizationStrategy", "str", "=", "new", "ProjectMatrixAuthorizationStrategy", "(", ");", "str", ".", "add", "(", "Jenkins", ".", "READ", ",", "\"", "bob", "\"", ");", "str", ".", "add", "(", "Jenkins", ".", "READ", ",", "\"", "alice", "\"", ");", "str", ".", "add", "(", "Jenkins", ".", "READ", ",", "\"", "james", "\"", ");", "jenkins", ".", "setAuthorizationStrategy", "(", "str", ")", ";", "FreeStyleProject", "project", "=", "createFreeStyleProject", "(", "\"", "project", "\"", ");", "Map", "<", "Permission", ",", "Set", "<", "String", ">", ">", "permissions", "=", "new", "HashMap", "<", "Permission", ",", "Set", "<", "String", ">", ">(", ");", "permissions", ".", "put", "(", "Item", ".", "READ", ",", "Collections", ".", "singleton", "(", "\"", "bob", "\"", "))", ";", "permissions", ".", "put", "(", "Item", ".", "DISCOVER", ",", "Collections", ".", "singleton", "(", "\"", "james", "\"", "))", ";", "AuthorizationMatrixProperty", "prop1", "=", "new", "AuthorizationMatrixProperty", "(", "permissions", ")", ";", "project", ".", "addProperty", "(", "prop1", ")", ";", "project", ".", "getBuildersList", "(", ").", "add", "(", "new", "SleepBuilder", "(", "10", ")", ");", "project", ".", "scheduleBuild2", "(", "0", ")", ";", "WebClient", "webClient", "=", "new", "WebClient", "(", ");", "webClient", ".", "login", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", ");", "XmlPage", "p", "=", "webClient", ".", "goToXml", "(", "\"/", "queue", "/", "api", "/", "xml", "\"", ");", "/", "/", "bob", "has", "permission", "on", "the", "project", "and", "will", "be", "able", "to", "see", "it", "in", "the", "queue", "together", "with", "information", "such", "as", "the", "URL", "and", "the", "name", ".", "for", "(", "DomNode", "element", ":", "p", ".", "getFirstChild", "(", ").", "getFirstChild", "(", ").", "getChildNodes", "(", "))", "{", "if", "(", "element", ".", "getNodeName", "(", ").", "equals", "(", "\"", "task", "\"", "))", "{", "assertEquals", "(", "((", "DomElement", ")", "element", ")", ".", "getElementsByTagName", "(", "\"", "name", "\"", ").", "size", "(", "),", "1", ")", ";", "assertEquals", "(", "((", "DomElement", ")", "element", ")", ".", "getElementsByTagName", "(", "\"", "name", "\"", ").", "item", "(", "0", ")", ".", "getFirstChild", "(", ").", "toString", "(", "),", "\"", "project", "\"", ");", "assertEquals", "(", "((", "DomElement", ")", "element", ")", ".", "getElementsByTagName", "(", "\"", "url", "\"", ").", "size", "(", "),", "1", ")", ";", "}", "}", "WebClient", "webClient2", "=", "new", "WebClient", "(", ");", "webClient2", ".", "login", "(", "\"", "alice", "\"", ");", "XmlPage", "p2", "=", "webClient2", ".", "goToXml", "(", "\"/", "queue", "/", "api", "/", "xml", "\"", ");", "/", "/", "alice", "does", "not", "have", "permission", "on", "the", "project", "and", "will", "not", "see", "it", "in", "the", "queue", ".", "assertEquals", "(", "\"<", "queue", ">", "</", "queue", ">", "\",", "p2", ".", "getContent", "(", "))", ";", "WebClient", "webClient3", "=", "new", "WebClient", "(", ");", "webClient3", ".", "login", "(", "\"", "james", "\"", ");", "XmlPage", "p3", "=", "webClient3", ".", "goToXml", "(", "\"/", "queue", "/", "api", "/", "xml", "\"", ");", "/", "/", "james", "has", "DISCOVER", "permission", "on", "the", "project", "and", "will", "only", "be", "able", "to", "see", "the", "task", "name", ".", "assertEquals", "(", "\"<", "queue", ">", "<", "discoverableItem", ">", "<", "task", ">", "<", "name", ">", "project", "<", "/", "name", ">", "</", "task", ">", "</", "discoverableItem", ">", "</", "queue", ">", "\",", "p3", ".", "getContent", "(", "))", ";", "}", "/", "/", "we", "force", "the", "project", "not", "to", "be", "executed", "so", "that", "it", "stays", "in", "the", "queue", "@", "TestExtension", "(", "\"", "testQueueApiOutputShouldBeFilteredByUserPermission", "\"", ")", "public", "static", "class", "MyQueueTaskDispatcher", "extends", "QueueTaskDispatcher", "{", "@", "Override", "public", "CauseOfBlockage", "canTake", "(", "Node", "node", ",", "Queue", ".", "BuildableItem", "item", ")", "{", "return", "new", "CauseOfBlockage", "(", ")", "{", "@", "Override", "public", "String", "getShortDescription", "(", ")", "{", "return", "\"", "blocked", "by", "canTake", "\"", ";", "}", "}", ";", "}", "}</s>Item", "[", "]", "r", "=", "new", "Item", "[", "waitingList", ".", "size", "(", ")", "+", "blockedProjects", ".", "size", "(", ")", "+", "buildables", ".", "size", "(", ")", "+", "pendings", ".", "size", "(", ")]", ";", "waitingList", ".", "toArray", "(", "r", ")", ";", "int", "idx", "=", "waitingList", ".", "size", "(", ");", "for", "(", "BlockedItem", "p", ":", "blockedProjects", ".", "values", "(", "))", "r", "[", "idx", "+", "+]", "=", "p", ";", "for", "(", "BuildableItem", "p", ":", "reverse", "(", "buildables", ".", "values", "(", "))", ")", "r", "[", "idx", "+", "+]", "=", "p", ";", "for", "(", "BuildableItem", "p", ":", "reverse", "(", "pendings", ".", "values", "(", "))", ")", "r", "[", "idx", "+", "+]", "=", "p", ";", "assertSame", "(", "p", ",", "b", ".", "getProject", "(", "))", ";", "assertSame", "(", "b", ",", "b2", ")", ";"], "docstring_tokens": ["via", "a", "direct", "request", "to", "queue/api", "."]}
{"contents": ["Encode", "LDAP", "user", "names"], "code_tokens": ["*", "Copyright", "2017", "-", "2020", "Anton", "Tananaev", "(", "anton", "@", "traccar", ".", "org", ")", "String", "searchString", "=", "adminFilter", ".", "replace", "(", "\":", "login", "\"", ",", "encodeForLdap", "(", "accountName", ")", ");", "String", "searchString", "=", "searchFilter", ".", "replace", "(", "\":", "login", "\"", ",", "encodeForLdap", "(", "accountName", ")", ");", "public", "String", "encodeForLdap", "(", "String", "input", ")", "{", "if", "(", "input", "=", "=", "null", ")", "{", "return", "null", ";", "}", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "input", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "input", ".", "charAt", "(", "i", ")", ";", "switch", "(", "c", ")", "{", "case", "'", "\\\\", "':", "sb", ".", "append", "(", "\"\\", "\\", "5c", "\"", ");", "break", ";", "case", "'", "*'", ":", "sb", ".", "append", "(", "\"\\", "\\", "2a", "\"", ");", "break", ";", "case", "'", "('", ":", "sb", ".", "append", "(", "\"\\", "\\", "28", "\"", ");", "break", ";", "case", "'", ")'", ":", "sb", ".", "append", "(", "\"\\", "\\", "29", "\"", ");", "break", ";", "case", "'", "\\", "0", "'", ":", "sb", ".", "append", "(", "\"\\", "\\", "00", "\"", ");", "break", ";", "default", ":", "sb", ".", "append", "(", "c", ")", ";", "}", "}", "return", "sb", ".", "toString", "(", ");", "}</s>*", "Copyright", "2017", "Anton", "Tananaev", "(", "anton", "@", "traccar", ".", "org", ")", "String", "searchString", "=", "adminFilter", ".", "replace", "(", "\":", "login", "\"", ",", "accountName", ")", ";", "String", "searchString", "=", "searchFilter", ".", "replace", "(", "\":", "login", "\"", ",", "accountName", ")", ";"], "docstring_tokens": ["sending", "a", "specially", "crafted", "request"]}
{"contents": ["[POWERPC]", "Never", "panic", "when", "taking", "altivec", "exceptions", "from", "userspace", "At", "the", "moment", "we", "rely", "on", "a", "cpu", "feature", "bit", "or", "a", "firmware", "property", "to", "detect", "altivec.", "If", "we", "dont", "have", "either", "of", "these", "and", "the", "cpu", "does", "in", "fact", "support", "altivec", "we", "can", "cause", "a", "panic", "from", "userspace.", "It", "seems", "safer", "to", "always", "send", "a", "signal", "if", "we", "manage", "to", "get", "an", "0xf20", "exception", "from", "userspace.", "Signed-off-by:", "Anton", "Blanchard", "<anton@samba.org>", "Signed-off-by:", "Paul", "Mackerras", "<paulus@samba.org>"], "code_tokens": ["</s>#", "if", "!", "defined", "(", "CONFIG_ALTIVEC", ")", "#", "endif"], "docstring_tokens": ["by", "triggering", "execution", "of", "an", "Altivec", "instruction", "."]}
{"contents": ["Enchanced", "policy", "wr", "to", "origin", "handling.", "The", "Origin:", "can", "now", "be", "checked", "on", "the", "server", "side,", "too."], "code_tokens": ["*", "@", "param", "pStrictChecking", "whether", "to", "a", "strict", "check", "(", "i", ".", "e", ".", "server", "side", "check", ")", "*", "@", "return", "true", "if", "if", "cors", "access", "is", "allowed", "public", "boolean", "isOriginAllowed", "(", "String", "pOrigin", ",", "boolean", "pStrictChecking", ")", "{", "return", "restrictor", ".", "isOriginAllowed", "(", "pOrigin", ",", "pStrictChecking", ")", ";", "requestHandler", ".", "checkAccess", "(", "pReq", ".", "getRemoteHost", "(", "),", "pReq", ".", "getRemoteAddr", "(", "),", "getOriginOrReferer", "(", "pReq", ")", ");", "private", "String", "getOriginOrReferer", "(", "HttpServletRequest", "pReq", ")", "{", "String", "origin", "=", "pReq", ".", "getHeader", "(", "\"", "Origin", "\"", ");", "if", "(", "origin", "=", "=", "null", ")", "{", "origin", "=", "pReq", ".", "getHeader", "(", "\"", "Referer", "\"", ");", "}", "return", "origin", "!", "=", "null", "?", "origin", ".", "replaceAll", "(", "\"[", "\\\\", "n", "\\", "\\", "r", "]", "*\"", ",\"", "\")", ":", "null", ";", "}", "if", "(", "pOrigin", "!", "=", "null", "&", "&", "backendManager", ".", "isOriginAllowed", "(", "pOrigin", ",", "false", ")", ")", "{", "*", "@", "param", "pOrigin", "(", "optional", ")", "origin", "header", "to", "check", "also", ".", "public", "void", "checkAccess", "(", "String", "pHost", ",", "String", "pAddress", ",", "String", "pOrigin", ")", "{", "if", "(", "pOrigin", "!", "=", "null", "&", "&", "!", "backendManager", ".", "isOriginAllowed", "(", "pOrigin", ",", "true", ")", ")", "{", "throw", "new", "SecurityException", "(", "\"", "Origin", "\"", "+", "pOrigin", "+", "\"", "is", "not", "allowed", "to", "call", "this", "agent", "\"", ");", "}", "*", "Check", "whether", "for", "the", "given", "host", "is", "a", "cross", "-", "browser", "request", "allowed", ".", "This", "check", "is", "delegated", "to", "the", "if", "(", "backendManager", ".", "isOriginAllowed", "(", "origin", ",", "false", ")", ")", "{", "public", "boolean", "isOriginAllowed", "(", "String", "pOrigin", ",", "boolean", "pIsStrictCheck", ")", "{", "public", "boolean", "isOriginAllowed", "(", "String", "pOrigin", ",", "boolean", "pIsStrictCheck", ")", "{", "return", "corsChecker", ".", "check", "(", "pOrigin", ",", "pIsStrictCheck", ")", ";", "*", "@", "param", "pOrigin", "the", "\"", "Origin", ":", "\"", "header", "provided", "within", "the", "request", "*", "@", "param", "pIsStrictCheck", "whether", "doing", "a", "strict", "check", "boolean", "isOriginAllowed", "(", "String", "pOrigin", ",", "boolean", "pIsStrictCheck", ")", ";", "private", "boolean", "strictChecking", "=", "false", ";", "*", "*", "&", "lt", ";", "strict", "-", "checking", "/", "&", "gt", ";", "assertNodeName", "(", "node", ",", "\"", "allow", "-", "origin", "\"", ",\"", "strict", "-", "checking", "\"", ");", "if", "(", "node", ".", "getNodeName", "(", ").", "equals", "(", "\"", "allow", "-", "origin", "\"", "))", "{", "String", "p", "=", "node", ".", "getTextContent", "(", ").", "trim", "(", ").", "toLowerCase", "(", ");", "p", "=", "Pattern", ".", "quote", "(", "p", ")", ".", "replace", "(", "\"*", "\",", "\"", "\\\\", "E", ".", "*\\", "\\", "Q", "\"", ");", "patterns", ".", "add", "(", "Pattern", ".", "compile", "(", "\"^", "\"", "+", "p", "+", "\"", "$\"", "))", ";", "}", "else", "if", "(", "node", ".", "getNodeName", "(", ").", "equals", "(", "\"", "strict", "-", "checking", "\"", "))", "{", "strictChecking", "=", "true", ";", "}", "return", "check", "(", "pArg", ",", "false", ")", ";", "}", "public", "boolean", "check", "(", "String", "pOrigin", ",", "boolean", "pIsStrictCheck", ")", "{", "/", "/", "Method", "called", "during", "strict", "checking", "but", "we", "have", "not", "configured", "that", "/", "/", "So", "the", "check", "passes", "always", ".", "if", "(", "pIsStrictCheck", "&", "&", "!", "strictChecking", ")", "{", "return", "true", ";", "}", "if", "(", "pattern", ".", "matcher", "(", "pOrigin", ")", ".", "matches", "(", "))", "{", "assertTrue", "(", "backendManager", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "false", ")", ");", "expect", "(", "config", ".", "getServletContext", "(", "))", ".", "andStubReturn", "(", "context", ")", ";", "expect", "(", "config", ".", "getServletName", "(", "))", ".", "andStubReturn", "(", "\"", "jolokia", "\"", ");", "String", "url", "=", "\"", "http", ":", "//", "10", ".", "9", ".", "11", ".", "1", ":", "9876", "/", "jolokia", "\"", ";", "expect", "(", "request", ".", "getHeader", "(", "\"", "Origin", "\"", "))", ".", "andStubReturn", "(", "null", ")", ";", "expect", "(", "request", ".", "getHeader", "(", "\"", "Referer", "\"", "))", ".", "andStubReturn", "(", "null", ")", ";", "expect", "(", "request", ".", "getHeader", "(", "\"", "Origin", "\"", "))", ".", "andStubReturn", "(", "in", ")", ";", "expectLastCall", "(", ").", "asStub", "(", ");", "expect", "(", "config", ".", "getServletContext", "(", "))", ".", "andStubReturn", "(", "context", ")", ";", "expect", "(", "config", ".", "getServletName", "(", "))", ".", "andStubReturn", "(", "\"", "jolokia", "\"", ");", "expectLastCall", "(", ").", "asStub", "(", ");", "expect", "(", "request", ".", "getHeader", "(", "\"", "Origin", "\"", "))", ".", "andStubReturn", "(", "null", ")", ";", "expect", "(", "request", ".", "getHeader", "(", "\"", "Referer", "\"", "))", ".", "andStubReturn", "(", "null", ")", ";", "handler", ".", "checkAccess", "(", "\"", "localhost", "\"", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "null", ")", ";", "handler", ".", "checkAccess", "(", "\"", "localhost", "\"", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "null", ")", ";", "@", "Test", "(", "expectedExceptions", "=", "{", "SecurityException", ".", "class", "}", ")", "public", "void", "accessDeniedViaOrigin", "(", ")", "{", "expect", "(", "backend", ".", "isRemoteAccessAllowed", "(", "\"", "localhost", "\"", ",\"", "127", ".", "0", ".", "0", ".", "1", "\"", "))", ".", "andReturn", "(", "true", ")", ";", "expect", "(", "backend", ".", "isOriginAllowed", "(", "\"", "www", ".", "jolokia", ".", "org", "\"", ",", "true", ")", ").", "andReturn", "(", "false", ")", ";", "replay", "(", "backend", ")", ";", "handler", ".", "checkAccess", "(", "\"", "localhost", "\"", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",\"", "www", ".", "jolokia", ".", "org", "\"", ");", "}", "expect", "(", "backend", ".", "isOriginAllowed", "(", "origin", ",", "false", ")", ").", "andReturn", "(", "true", ")", ";", "expect", "(", "backend", ".", "isOriginAllowed", "(", "origin", ",", "false", ")", ").", "andReturn", "(", "false", ")", ";", "InputStream", "is", "=", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "allow", "-", "origin4", ".", "xml", "\"", ");", "PolicyRestrictor", "restrictor", "=", "new", "PolicyRestrictor", "(", "is", ")", ";", "for", "(", "boolean", "strict", ":", "new", "boolean", "[", "]", "{", "true", ",", "false", "}", ")", "{", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "strict", ")", ");", "assertFalse", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", ",", "strict", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "https", ":", "//", "www", ".", "consol", ".", "de", "\"", ",", "strict", ")", ");", "}", "}", "@", "Test", "public", "void", "corsStrictCheckingOff", "(", ")", "{", "/", "/", "Allways", "true", "since", "we", "want", "a", "strict", "check", "but", "strict", "checking", "is", "off", ".", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "true", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", ",", "true", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "https", ":", "//", "www", ".", "consol", ".", "de", "\"", ",", "true", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "consol", ".", "de", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "consol", ".", "de", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", ",", "false", ")", ");", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "https", ":", "//", "www", ".", "consol", ".", "de", "\"", ",", "false", ")", ");", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "~", "Copyright", "2009", "-", "2013", "Roland", "Huss", "~", "~", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "~", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "~", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "~", "~", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "~", "~", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "~", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "~", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "~", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "~", "limitations", "under", "the", "License", ".", "-", "->", "<", "restrict", ">", "<", "cors", ">", "<", "allow", "-", "origin", ">", "http", ":", "//", "bla", ".", "com", "<", "/", "allow", "-", "origin", ">", "<", "allow", "-", "origin", ">", "http", ":", "//", "blub", ".", "com", "<", "/", "allow", "-", "origin", ">", "<", "allow", "-", "origin", ">", "*:", "//", "*.", "consol", ".", "de", "<", "/", "allow", "-", "origin", ">", "<", "strict", "-", "checking", "/", ">", "<", "/", "cors", ">", "<", "/", "restrict", ">", "@", "@", "-", "165", ",", "7", "+", "165", ",", "8", "@", "@", "public", "void", "handle", "(", "HttpExchange", "pExchange", ")", "throws", "IOException", "{", "requestHandler", ".", "checkAccess", "(", "address", ".", "getHostName", "(", "),", "address", ".", "getAddress", "(", ").", "getHostAddress", "(", "),", "extractOriginOrReferer", "(", "pExchange", ")", ");", "/", "/", "Used", "for", "checking", "origin", "or", "referer", "is", "an", "origin", "policy", "is", "enabled", "private", "String", "extractOriginOrReferer", "(", "HttpExchange", "pExchange", ")", "{", "Headers", "headers", "=", "pExchange", ".", "getRequestHeaders", "(", ");", "String", "origin", "=", "headers", ".", "getFirst", "(", "\"", "Origin", "\"", ");", "if", "(", "origin", "=", "=", "null", ")", "{", "origin", "=", "headers", ".", "getFirst", "(", "\"", "Referer", "\"", ");", "}", "return", "origin", "!", "=", "null", "?", "origin", ".", "replaceAll", "(", "\"[", "\\\\", "n", "\\", "\\", "r", "]", "*\"", ",\"", "\")", ":", "null", ";", "}", "return", "restrictor", ".", "isOriginAllowed", "(", "(", "String", ")", "args", "[", "0", "]", ",", "(", "Boolean", ")", "args", "[", "1", "]", ");", "public", "boolean", "isOriginAllowed", "(", "String", "pOrigin", ",", "boolean", "pIsStrictCheck", ")", "{", "return", "checkRestrictorService", "(", "CORS_CHECK", ",", "pOrigin", ",", "pIsStrictCheck", ")", ";", "assertTrue", "(", "restrictor", ".", "isOriginAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", ",", "false", ")", ");", "public", "boolean", "isOriginAllowed", "(", "String", "pOrigin", ",", "boolean", "pIsStrictCheck", ")", "{", "<", "action", "dev", "=", "\"", "roland", "\"", "type", "=", "\"", "add", "\"", "date", "=", "\"", "2014", "-", "04", "-", "24", "\"", ">", "Added", "\"", "strict", "-", "checking", "\"", "for", "jolokia", "-", "access", ".", "xml", "in", "the", "CORS", "section", "in", "order", "to", "enable", "server", "side", "origin", "checking", ",", "too", ".", "<", "/", "action", ">", "<", "programlisting", "language", "=", "\"", "xml", "\"", "><", "![", "CDATA", "[", "<", "!-", "-", "Check", "for", "the", "proper", "origin", "on", "the", "server", "side", ",", "too", "-", "->", "<", "strict", "-", "checking", "/", ">", "<", "para", ">", "If", "the", "option", "<", "literal", ">", "&", "lt", ";", "strict", "-", "checking", "/", "&", "gt", ";", "</", "literal", ">", "is", "given", "in", "this", "section", ",", "too", ",", "then", "the", "given", "pattern", "are", "not", "only", "used", "for", "CORS", "checking", "but", "also", "every", "request", "ist", "checked", "on", "th", "server", "side", "whether", "the", "<", "literal", ">", "Origin", ":", "</", "literal", ">", "or", "<", "literal", ">", "Referer", ":", "</", "literal", ">", "header", "matches", "one", "of", "the", "given", "patterns", ".", "This", "useful", "for", "protecting", "against", "Cross", "-", "Site", "Request", "Forgery", ".", "<", "/", "para", ">", "<", "/", "section", "></s>*", "@", "return", "true", "if", "icors", "access", "is", "allowed", "public", "boolean", "isCorsAccessAllowed", "(", "String", "pOrigin", ")", "{", "return", "restrictor", ".", "isCorsAccessAllowed", "(", "pOrigin", ")", ";", "requestHandler", ".", "checkClientIPAccess", "(", "pReq", ".", "getRemoteHost", "(", "),", "pReq", ".", "getRemoteAddr", "(", "))", ";", "if", "(", "pOrigin", "!", "=", "null", "&", "&", "backendManager", ".", "isCorsAccessAllowed", "(", "pOrigin", ")", ")", "{", "public", "void", "checkClientIPAccess", "(", "String", "pHost", ",", "String", "pAddress", ")", "{", "*", "Check", "whether", "for", "the", "given", "host", "is", "a", "cross", "-", "browser", "request", "allowed", ".", "This", "check", "is", "deligated", "to", "the", "if", "(", "backendManager", ".", "isCorsAccessAllowed", "(", "origin", ")", ")", "{", "public", "boolean", "isCorsAccessAllowed", "(", "String", "pOrigin", ")", "{", "public", "boolean", "isCorsAccessAllowed", "(", "String", "pOrigin", ")", "{", "return", "corsChecker", ".", "check", "(", "pOrigin", ")", ";", "*", "@", "param", "pOrigin", "the", "\"", "Origin", ":", "\"", "URL", "provided", "within", "the", "request", "boolean", "isCorsAccessAllowed", "(", "String", "pOrigin", ")", ";", "assertNodeName", "(", "node", ",", "\"", "allow", "-", "origin", "\"", ");", "String", "p", "=", "node", ".", "getTextContent", "(", ").", "trim", "(", ").", "toLowerCase", "(", ");", "p", "=", "Pattern", ".", "quote", "(", "p", ")", ".", "replace", "(", "\"*", "\",", "\"\\", "\\", "E", ".", "*\\", "\\", "Q", "\"", ");", "patterns", ".", "add", "(", "Pattern", ".", "compile", "(", "\"^", "\"", "+", "p", "+", "\"", "$\"", "))", ";", "if", "(", "pattern", ".", "matcher", "(", "pArg", ")", ".", "matches", "(", "))", "{", "assertTrue", "(", "backendManager", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", "))", ";", "expect", "(", "config", ".", "getServletContext", "(", "))", ".", "andReturn", "(", "context", ")", ".", "anyTimes", "(", ");", "expect", "(", "config", ".", "getServletName", "(", "))", ".", "andReturn", "(", "\"", "jolokia", "\"", ").", "anyTimes", "(", ");", "String", "url", "=", "\"", "http", ":", "//", "pirx", ":", "9876", "/", "jolokia", "\"", ";", "expect", "(", "request", ".", "getHeader", "(", "\"", "Origin", "\"", "))", ".", "andReturn", "(", "null", ")", ";", "expect", "(", "request", ".", "getHeader", "(", "\"", "Origin", "\"", "))", ".", "andReturn", "(", "in", ")", ";", "expectLastCall", "(", ").", "anyTimes", "(", ");", "expect", "(", "config", ".", "getServletContext", "(", "))", ".", "andReturn", "(", "context", ")", ".", "anyTimes", "(", ");", "expect", "(", "config", ".", "getServletName", "(", "))", ".", "andReturn", "(", "\"", "jolokia", "\"", ").", "anyTimes", "(", ");", "expectLastCall", "(", ").", "anyTimes", "(", ");", "expect", "(", "request", ".", "getHeader", "(", "\"", "Origin", "\"", "))", ".", "andReturn", "(", "null", ")", ";", "handler", ".", "checkClientIPAccess", "(", "\"", "localhost", "\"", ",\"", "127", ".", "0", ".", "0", ".", "1", "\"", ");", "handler", ".", "checkClientIPAccess", "(", "\"", "localhost", "\"", ",\"", "127", ".", "0", ".", "0", ".", "1", "\"", ");", "expect", "(", "backend", ".", "isCorsAccessAllowed", "(", "origin", ")", ").", "andReturn", "(", "true", ")", ";", "expect", "(", "backend", ".", "isCorsAccessAllowed", "(", "origin", ")", ").", "andReturn", "(", "false", ")", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", "))", ";", "assertFalse", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "https", ":", "//", "www", ".", "consol", ".", "de", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "www", ".", "consol", ".", "de", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "www", ".", "consol", ".", "de", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "www", ".", "jolokia", ".", "org", "\"", "))", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "https", ":", "//", "www", ".", "consol", ".", "de", "\"", "))", ";", "requestHandler", ".", "checkClientIPAccess", "(", "address", ".", "getHostName", "(", "),", "address", ".", "getAddress", "(", ").", "getHostAddress", "(", "))", ";", "return", "restrictor", ".", "isCorsAccessAllowed", "(", "(", "String", ")", "args", "[", "0", "]", ");", "public", "boolean", "isCorsAccessAllowed", "(", "String", "pOrigin", ")", "{", "return", "checkRestrictorService", "(", "CORS_CHECK", ",", "pOrigin", ")", ";", "assertTrue", "(", "restrictor", ".", "isCorsAccessAllowed", "(", "\"", "http", ":", "//", "bla", ".", "com", "\"", "))", ";", "public", "boolean", "isCorsAccessAllowed", "(", "String", "pOrigin", ")", "{", "<", "/", "section", ">", "<", "programlisting", "language", "=", "\"", "xml", "\"", "><", "![", "CDATA", "["], "docstring_tokens": ["via", "a", "crafted", "web", "page", "."]}
{"contents": ["arm64:", "__clear_user:", "handle", "exceptions", "on", "strb", "ARM64", "currently", "doesn't", "fix", "up", "faults", "on", "the", "single-byte", "(strb)", "case", "of", "__clear_user...", "which", "means", "that", "we", "can", "cause", "a", "nasty", "kernel", "panic", "as", "an", "ordinary", "user", "with", "any", "multiple", "PAGE_SIZE+1", "read", "from", "/dev/zero.", "i.e.:", "dd", "if=/dev/zero", "of=foo", "ibs=1", "count=1", "(or", "ibs=65537,", "etc.)", "This", "is", "a", "pretty", "obscure", "bug", "in", "the", "general", "case", "since", "we'll", "only", "__do_kernel_fault", "(since", "there's", "no", "extable", "entry", "for", "pc)", "if", "the", "mmap_sem", "is", "contended.", "However,", "with", "CONFIG_DEBUG_VM", "enabled,", "we'll", "always", "fault.", "if", "(!down_read_trylock(&mm->mmap_sem))", "{", "if", "(!user_mode(regs)", "&&", "!search_exception_tables(regs->pc))", "goto", "no_context;", "retry:", "down_read(&mm->mmap_sem);", "}", "else", "{", "/*", "*", "The", "above", "down_read_trylock()", "might", "have", "succeeded", "in", "*", "which", "*", "case,", "we'll", "have", "missed", "the", "might_sleep()", "from", "*", "down_read().", "*/", "might_sleep();", "if", "(!user_mode(regs)", "&&", "!search_exception_tables(regs->pc))", "goto", "no_context;", "}", "Fix", "that", "by", "adding", "an", "extable", "entry", "for", "the", "strb", "instruction,", "since", "it", "touches", "user", "memory,", "similar", "to", "the", "other", "stores", "in", "__clear_user.", "Signed-off-by:", "Kyle", "McMartin", "<kyle@redhat.com>", "Reported-by:", "Milo\u0161", "Prchl\u00edk", "<mprchlik@redhat.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Catalin", "Marinas", "<catalin.marinas@arm.com>"], "code_tokens": ["USER", "(", "9f", ",", "strb", "wzr", ",", "[", "x0", "]", ")</s>strb", "wzr", ",", "[", "x0", "]"], "docstring_tokens": ["by", "reading", "one", "byte", "beyond", "a", "/dev/zero", "page", "boundary", "."]}
{"contents": ["NFSv4:", "include", "bitmap", "in", "nfsv4", "get", "acl", "data", "The", "NFSv4", "bitmap", "size", "is", "unbounded:", "a", "server", "can", "return", "an", "arbitrary", "sized", "bitmap", "in", "an", "FATTR4_WORD0_ACL", "request.", "Replace", "using", "the", "nfs4_fattr_bitmap_maxsz", "as", "a", "guess", "to", "the", "maximum", "bitmask", "returned", "by", "a", "server", "with", "the", "inclusion", "of", "the", "bitmap", "(xdr", "length", "plus", "bitmasks)", "and", "the", "acl", "data", "xdr", "length", "to", "the", "(cached)", "acl", "page", "data.", "This", "is", "a", "general", "solution", "to", "commit", "e5012d1f", "\"NFSv4.1:", "update", "nfs4_fattr_bitmap_maxsz\"", "and", "fixes", "hitting", "a", "BUG_ON", "in", "xdr_shrink_bufhead", "when", "getting", "ACLs.", "Fix", "a", "bug", "in", "decode_getacl", "that", "returned", "-EINVAL", "on", "ACLs", ">", "page", "when", "getxattr", "was", "called", "with", "a", "NULL", "buffer,", "preventing", "ACL", ">", "PAGE_SIZE", "from", "being", "retrieved.", "Cc:", "stable@kernel.org", "Signed-off-by:", "Andy", "Adamson", "<andros@netapp.com>", "Signed-off-by:", "Trond", "Myklebust", "<Trond.Myklebust@netapp.com>"], "code_tokens": ["/", "*", "*", "The", "getxattr", "API", "returns", "the", "required", "buffer", "length", "when", "called", "with", "a", "*", "NULL", "buf", ".", "The", "NFSv4", "acl", "tool", "then", "calls", "getxattr", "again", "after", "allocating", "*", "the", "required", "buf", ".", "On", "a", "NULL", "buf", ",", "we", "send", "a", "page", "of", "data", "to", "the", "server", "*", "guessing", "that", "the", "ACL", "request", "can", "be", "serviced", "by", "a", "page", ".", "If", "so", ",", "we", "cache", "*", "up", "to", "the", "page", "of", "ACL", "data", ",", "and", "the", "2nd", "call", "to", "getxattr", "is", "serviced", "by", "*", "the", "cache", ".", "If", "not", "so", ",", "we", "throw", "away", "the", "page", ",", "and", "cache", "the", "required", "*", "length", ".", "The", "next", "getxattr", "call", "will", "then", "produce", "another", "round", "trip", "to", "*", "the", "server", ",", "this", "time", "with", "the", "input", "buf", "of", "the", "required", "size", ".", "*", "/", "struct", "page", "*", "pages", "[", "NFS4ACL_MAXPAGES", "]", "=", "{", "NULL", ",", "}", ";", "int", "ret", "=", "-", "ENOMEM", ",", "npages", ",", "i", ",", "acl_len", "=", "0", ";", "npages", "=", "(", "buflen", "+", "PAGE_SIZE", "-", "1", ")", ">", ">", "PAGE_SHIFT", ";", "/", "*", "As", "long", "as", "we", "'", "re", "doing", "a", "round", "trip", "to", "the", "server", "anyway", ",", "*", "let", "'", "s", "be", "prepared", "for", "a", "page", "of", "acl", "data", ".", "*", "/", "if", "(", "npages", "=", "=", "0", ")", "npages", "=", "1", ";", "for", "(", "i", "=", "0", ";", "i", "<", "npages", ";", "i", "+", "+)", "{", "pages", "[", "i", "]", "=", "alloc_page", "(", "GFP_KERNEL", ")", ";", "if", "(", "!", "pages", "[", "i", "]", ")", "goto", "out_free", ";", "}", "if", "(", "npages", ">", "1", ")", "{", "/", "*", "for", "decoding", "across", "pages", "*", "/", "args", ".", "acl_scratch", "=", "alloc_page", "(", "GFP_KERNEL", ")", ";", "if", "(", "!", "args", ".", "acl_scratch", ")", "goto", "out_free", ";", "args", ".", "acl_len", "=", "npages", "*", "PAGE_SIZE", ";", "args", ".", "acl_pgbase", "=", "0", ";", "/", "*", "Let", "decode_getfacl", "know", "not", "to", "fail", "if", "the", "ACL", "data", "is", "larger", "than", "*", "the", "page", "we", "send", "as", "a", "guess", "*", "/", "if", "(", "buf", "=", "=", "NULL", ")", "res", ".", "acl_flags", "|", "=", "NFS4_ACL_LEN_REQUEST", ";", "resp_buf", "=", "page_address", "(", "pages", "[", "0", "]", ");", "dprintk", "(", "\"%", "s", "buf", "%", "p", "buflen", "%", "ld", "npages", "%", "d", "args", ".", "acl_len", "%", "ld", "\\", "n", "\"", ",", "__func__", ",", "buf", ",", "buflen", ",", "npages", ",", "args", ".", "acl_len", ")", ";", "ret", "=", "nfs4_call_sync", "(", "NFS_SERVER", "(", "inode", ")", "->", "client", ",", "NFS_SERVER", "(", "inode", ")", ",", "&", "msg", ",", "&", "args", ".", "seq_args", ",", "&", "res", ".", "seq_res", ",", "0", ")", ";", "acl_len", "=", "res", ".", "acl_len", "-", "res", ".", "acl_data_offset", ";", "if", "(", "acl_len", ">", "args", ".", "acl_len", ")", "nfs4_write_cached_acl", "(", "inode", ",", "NULL", ",", "acl_len", ")", ";", "nfs4_write_cached_acl", "(", "inode", ",", "resp_buf", "+", "res", ".", "acl_data_offset", ",", "acl_len", ")", ";", "if", "(", "acl_len", ">", "buflen", ")", "_copy_from_pages", "(", "buf", ",", "pages", ",", "res", ".", "acl_data_offset", ",", "res", ".", "acl_len", ")", ";", "ret", "=", "acl_len", ";", "for", "(", "i", "=", "0", ";", "i", "<", "npages", ";", "i", "+", "+)", "if", "(", "pages", "[", "i", "]", ")", "__free_page", "(", "pages", "[", "i", "]", ");", "if", "(", "args", ".", "acl_scratch", ")", "__free_page", "(", "args", ".", "acl_scratch", ")", ";", "/", "*", "-", "ENOENT", "is", "returned", "if", "there", "is", "no", "ACL", "or", "if", "there", "is", "an", "ACL", "*", "but", "no", "cached", "acl", "data", ",", "just", "the", "acl", "length", "*", "/", "replen", "=", "hdr", ".", "replen", "+", "op_decode_hdr_maxsz", "+", "1", ";", "xdr_set_scratch_buffer", "(", "xdr", ",", "page_address", "(", "args", "-", ">", "acl_scratch", ")", ",", "PAGE_SIZE", ")", ";", "struct", "nfs_getaclres", "*", "res", ")", "__be32", "*", "savep", ",", "*", "bm_p", ";", "res", "-", ">", "acl_len", "=", "0", ";", "bm_p", "=", "xdr", "-", ">", "p", ";", "/", "*", "The", "bitmap", "(", "xdr", "len", "+", "bitmaps", ")", "and", "the", "attr", "xdr", "len", "words", "*", "are", "stored", "with", "the", "acl", "data", "to", "handle", "the", "problem", "of", "*", "variable", "length", "bitmaps", ".", "*/", "xdr", "-", ">", "p", "=", "bm_p", ";", "res", "-", ">", "acl_data_offset", "=", "be32_to_cpup", "(", "bm_p", ")", "+", "2", ";", "res", "-", ">", "acl_data_offset", "<", "<=", "2", ";", "attrlen", "+", "=", "res", "-", ">", "acl_data_offset", ";", "if", "(", "res", "-", ">", "acl_flags", "&", "NFS4_ACL_LEN_REQUEST", ")", "{", "/", "*", "getxattr", "interface", "called", "with", "a", "NULL", "buf", "*", "/", "res", "-", ">", "acl_len", "=", "attrlen", ";", "goto", "out", ";", "}", "dprintk", "(", "\"", "NFS", ":", "acl", "reply", ":", "attrlen", "%", "u", ">", "recvd", "%", "u", "\\", "n", "\"", ",", "res", "-", ">", "acl_len", "=", "attrlen", ";", "status", "=", "decode_getacl", "(", "xdr", ",", "rqstp", ",", "res", ")", ";", "struct", "page", "*", "acl_scratch", ";", "/", "*", "getxattr", "ACL", "interface", "flags", "*", "/", "#", "define", "NFS4_ACL_LEN_REQUEST", "0x0001", "/", "*", "zero", "length", "getxattr", "buffer", "*", "/", "size_t", "acl_data_offset", ";", "int", "acl_flags", ";", "extern", "void", "_copy_from_pages", "(", "char", "*", "p", ",", "struct", "page", "*", "*", "pages", ",", "size_t", "pgbase", ",", "size_t", "len", ")", ";", "void", "EXPORT_SYMBOL_GPL", "(", "_copy_from_pages", ")", ";</s>static", "void", "buf_to_pages", "(", "const", "void", "*", "buf", ",", "size_t", "buflen", ",", "struct", "page", "*", "*", "pages", ",", "unsigned", "int", "*", "pgbase", ")", "{", "const", "void", "*", "p", "=", "buf", ";", "*", "pgbase", "=", "offset_in_page", "(", "buf", ")", ";", "p", "-", "=", "*", "pgbase", ";", "while", "(", "p", "<", "buf", "+", "buflen", ")", "{", "*", "(", "pages", "+", "+)", "=", "virt_to_page", "(", "p", ")", ";", "p", "+", "=", "PAGE_CACHE_SIZE", ";", "}", "}", "struct", "page", "*", "pages", "[", "NFS4ACL_MAXPAGES", "]", ";", "struct", "page", "*", "localpage", "=", "NULL", ";", "int", "ret", ";", "if", "(", "buflen", "<", "PAGE_SIZE", ")", "{", "/", "*", "As", "long", "as", "we", "'", "re", "doing", "a", "round", "trip", "to", "the", "server", "anyway", ",", "*", "let", "'", "s", "be", "prepared", "for", "a", "page", "of", "acl", "data", ".", "*", "/", "localpage", "=", "alloc_page", "(", "GFP_KERNEL", ")", ";", "resp_buf", "=", "page_address", "(", "localpage", ")", ";", "if", "(", "localpage", "=", "=", "NULL", ")", "return", "-", "ENOMEM", ";", "args", ".", "acl_pages", "[", "0", "]", "=", "localpage", ";", "args", ".", "acl_pgbase", "=", "0", ";", "args", ".", "acl_len", "=", "PAGE_SIZE", ";", "}", "else", "{", "resp_buf", "=", "buf", ";", "buf_to_pages", "(", "buf", ",", "buflen", ",", "args", ".", "acl_pages", ",", "&", "args", ".", "acl_pgbase", ")", ";", "ret", "=", "nfs4_call_sync", "(", "NFS_SERVER", "(", "inode", ")", "->", "client", ",", "NFS_SERVER", "(", "inode", ")", ",", "&", "msg", ",", "&", "args", ".", "seq_args", ",", "&", "res", ".", "seq_res", ",", "0", ")", ";", "if", "(", "res", ".", "acl_len", ">", "args", ".", "acl_len", ")", "nfs4_write_cached_acl", "(", "inode", ",", "NULL", ",", "res", ".", "acl_len", ")", ";", "nfs4_write_cached_acl", "(", "inode", ",", "resp_buf", ",", "res", ".", "acl_len", ")", ";", "if", "(", "res", ".", "acl_len", ">", "buflen", ")", "if", "(", "localpage", ")", "memcpy", "(", "buf", ",", "resp_buf", ",", "res", ".", "acl_len", ")", ";", "ret", "=", "res", ".", "acl_len", ";", "if", "(", "localpage", ")", "__free_page", "(", "localpage", ")", ";", "replen", "=", "hdr", ".", "replen", "+", "op_decode_hdr_maxsz", "+", "nfs4_fattr_bitmap_maxsz", "+", "1", ";", "size_t", "*", "acl_len", ")", "__be32", "*", "savep", ";", "*", "acl_len", "=", "0", ";", "dprintk", "(", "\"", "NFS", ":", "server", "cheating", "in", "getattr", "\"", "\"", "acl", "reply", ":", "attrlen", "%", "u", ">", "recvd", "%", "u", "\\", "n", "\"", ",", "*", "acl_len", "=", "attrlen", ";", "status", "=", "decode_getacl", "(", "xdr", ",", "rqstp", ",", "&", "res", "-", ">", "acl_len", ")", ";", "static", "void"], "docstring_tokens": ["by", "sending", "an", "excessive", "number", "of", "bitmap", "words", "."]}
{"contents": ["net:", "Compute", "protocol", "sequence", "numbers", "and", "fragment", "IDs", "using", "MD5.", "Computers", "have", "become", "a", "lot", "faster", "since", "we", "compromised", "on", "the", "partial", "MD4", "hash", "which", "we", "use", "currently", "for", "performance", "reasons.", "MD5", "is", "a", "much", "safer", "choice,", "and", "is", "inline", "with", "both", "RFC1948", "and", "other", "ISS", "generators", "(OpenBSD,", "Solaris,", "etc.)", "Furthermore,", "only", "having", "24-bits", "of", "the", "sequence", "number", "be", "truly", "unpredictable", "is", "a", "very", "serious", "limitation.", "So", "the", "periodic", "regeneration", "and", "8-bit", "counter", "have", "been", "removed.", "We", "compute", "and", "use", "a", "full", "32-bit", "sequence", "number.", "For", "ipv6,", "DCCP", "was", "found", "to", "use", "a", "32-bit", "truncated", "initial", "sequence", "number", "(it", "needs", "43-bits)", "and", "that", "is", "fixed", "here", "as", "well.", "Reported-by:", "Dan", "Kaminsky", "<dan@doxpara.com>", "Tested-by:", "Willy", "Tarreau", "<w@1wt.eu>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["static", "u32", "random_int_secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", "____cacheline_aligned", ";", "static", "int", "__init", "random_int_secret_init", "(", "void", ")", "get_random_bytes", "(", "random_int_secret", ",", "sizeof", "(", "random_int_secret", ")", ");", "late_initcall", "(", "random_int_secret_init", ")", ";", "DEFINE_PER_CPU", "(", "__u32", "[", "MD5_DIGEST_WORDS", "]", ",", "get_random_int_hash", ")", ";", "unsigned", "int", "ret", ";", "md5_transform", "(", "hash", ",", "random_int_secret", ")", ";", "ret", "=", "hash", "[", "0", "]", ";", "#", "ifndef", "_NET_SECURE_SEQ", "#", "define", "_NET_SECURE_SEQ", "#", "include", "<", "linux", "/", "types", ".", "h", ">", "extern", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", ";", "extern", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ");", "extern", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", ";", "extern", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "u64", "secure_dccpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "#", "endif", "/", "*", "_NET_SECURE_SEQ", "*", "/", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "gen_stats", ".", "o", "gen_estimator", ".", "o", "net_namespace", ".", "o", "secure_seq", ".", "o", "#", "include", "<", "linux", "/", "kernel", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "cryptohash", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "cache", ".", "h", ">", "#", "include", "<", "linux", "/", "random", ".", "h", ">", "#", "include", "<", "linux", "/", "hrtimer", ".", "h", ">", "#", "include", "<", "linux", "/", "ktime", ".", "h", ">", "#", "include", "<", "linux", "/", "string", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "static", "u32", "net_secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", "____cacheline_aligned", ";", "static", "int", "__init", "net_secret_init", "(", "void", ")", "{", "get_random_bytes", "(", "net_secret", ",", "sizeof", "(", "net_secret", ")", ");", "return", "0", ";", "}", "late_initcall", "(", "net_secret_init", ")", ";", "static", "u32", "seq_scale", "(", "u32", "seq", ")", "{", "/", "*", "*", "As", "close", "as", "possible", "to", "RFC", "793", ",", "which", "*", "suggests", "using", "a", "250", "kHz", "clock", ".", "*", "Further", "reading", "shows", "this", "assumes", "2", "Mb", "/", "s", "networks", ".", "*", "For", "10", "Mb", "/", "s", "Ethernet", ",", "a", "1", "MHz", "clock", "is", "appropriate", ".", "*", "For", "10", "Gb", "/", "s", "Ethernet", ",", "a", "1", "GHz", "clock", "should", "be", "ok", ",", "but", "*", "we", "also", "need", "to", "limit", "the", "resolution", "so", "that", "the", "u32", "seq", "*", "overlaps", "less", "than", "one", "time", "per", "MSL", "(", "2", "minutes", ")", ".", "*", "Choosing", "a", "clock", "of", "64", "ns", "period", "is", "OK", ".", "(", "period", "of", "274", "s", ")", "*", "/", "return", "seq", "+", "(", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ">", ">", "6", ")", ";", "}", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", ";", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u32", "i", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", "+", "daddr", "[", "i", "]", ";", "secret", "[", "4", "]", "=", "net_secret", "[", "4", "]", "(", "((", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ")", ";", "for", "(", "i", "=", "5", ";", "i", "<", "MD5_MESSAGE_BYTES", "/", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", ";", "md5_transform", "(", "hash", ",", "secret", ")", ";", "return", "seq_scale", "(", "hash", "[", "0", "]", ");", "}", "EXPORT_SYMBOL", "(", "secure_tcpv6_sequence_number", ")", ";", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", "{", "u32", "secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", ";", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u32", "i", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", "+", "(", "__force", "u32", ")", "daddr", "[", "i", "]", ";", "secret", "[", "4", "]", "=", "net_secret", "[", "4", "]", "+", "(", "__force", "u32", ")", "dport", ";", "for", "(", "i", "=", "5", ";", "i", "<", "MD5_MESSAGE_BYTES", "/", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", ";", "md5_transform", "(", "hash", ",", "secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "#", "endif", "#", "ifdef", "CONFIG_INET", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "hash", "[", "0", "]", "=", "(", "__force", "__u32", ")", "daddr", ";", "hash", "[", "1", "]", "=", "net_secret", "[", "13", "]", ";", "hash", "[", "2", "]", "=", "net_secret", "[", "14", "]", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ")", "{", "__u32", "hash", "[", "4", "]", ";", "memcpy", "(", "hash", ",", "daddr", ",", "16", ")", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "seq_scale", "(", "hash", "[", "0", "]", ");", "}", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "__force", "u32", ")", "dport", "^", "net_secret", "[", "14", "]", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "EXPORT_SYMBOL_GPL", "(", "secure_ipv4_port_ephemeral", ")", ";", "#", "endif", "#", "if", "defined", "(", "CONFIG_IP_DCCP", ")", "|", "|", "defined", "(", "CONFIG_IP_DCCP_MODULE", ")", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u64", "seq", ";", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "seq", "=", "hash", "[", "0", "]", "|", "(", "((", "u64", ")", "hash", "[", "1", "]", ")", "<", "<", "32", ")", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "seq", "&", "=", "(", "1ull", "<", "<", "48", ")", "-", "1", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_dccp_sequence_number", ")", ";", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "u64", "secure_dccpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", ";", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u64", "seq", ";", "u32", "i", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", "+", "daddr", "[", "i", "]", ";", "secret", "[", "4", "]", "=", "net_secret", "[", "4", "]", "(", "((", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ")", ";", "for", "(", "i", "=", "5", ";", "i", "<", "MD5_MESSAGE_BYTES", "/", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", ";", "md5_transform", "(", "hash", ",", "secret", ")", ";", "seq", "=", "hash", "[", "0", "]", "|", "(", "((", "u64", ")", "hash", "[", "1", "]", ")", "<", "<", "32", ")", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "seq", "&", "=", "(", "1ull", "<", "<", "48", ")", "-", "1", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_dccpv6_sequence_number", ")", ";", "#", "endif", "#", "endif", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "static", "inline", "__u64", "dccp_v6_init_sequence", "(", "struct", "sk_buff", "*", "skb", ")", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", "></s>/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Random", "functions", "for", "networking", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "*", "TCP", "initial", "sequence", "number", "picking", ".", "This", "uses", "the", "random", "number", "*", "generator", "to", "pick", "an", "initial", "secret", "value", ".", "This", "value", "is", "hashed", "*", "along", "with", "the", "TCP", "endpoint", "information", "to", "provide", "a", "unique", "*", "starting", "point", "for", "each", "pair", "of", "TCP", "endpoints", ".", "This", "defeats", "*", "attacks", "which", "rely", "on", "guessing", "the", "initial", "TCP", "sequence", "number", ".", "*", "This", "algorithm", "was", "suggested", "by", "Steve", "Bellovin", ".", "*", "*", "Using", "a", "very", "strong", "hash", "was", "taking", "an", "appreciable", "amount", "of", "the", "total", "*", "TCP", "connection", "establishment", "time", ",", "so", "this", "is", "a", "weaker", "hash", ",", "*", "compensated", "for", "by", "changing", "the", "secret", "periodically", ".", "*", "/", "/", "*", "F", ",", "G", "and", "H", "are", "basic", "MD4", "functions", ":", "selection", ",", "majority", ",", "parity", "*", "/", "#", "define", "F", "(", "x", ",", "y", ",", "z", ")", "(", "(", "z", ")", "^", "(", "(", "x", ")", "&", "(", "(", "y", ")", "^", "(", "z", ")", "))", ")", "#", "define", "G", "(", "x", ",", "y", ",", "z", ")", "(", "((", "x", ")", "&", "(", "y", ")", ")", "+", "(", "((", "x", ")", "^", "(", "y", ")", ")", "&", "(", "z", ")", "))", "#", "define", "H", "(", "x", ",", "y", ",", "z", ")", "(", "(", "x", ")", "^", "(", "y", ")", "^", "(", "z", ")", ")", "/", "*", "*", "The", "generic", "round", "function", ".", "The", "application", "is", "so", "specific", "that", "*", "we", "don", "'", "t", "bother", "protecting", "all", "the", "arguments", "with", "parens", ",", "as", "is", "generally", "*", "good", "macro", "practice", ",", "in", "favor", "of", "extra", "legibility", ".", "*", "Rotation", "is", "separate", "from", "addition", "to", "prevent", "recomputation", "*", "/", "#", "define", "ROUND", "(", "f", ",", "a", ",", "b", ",", "c", ",", "d", ",", "x", ",", "s", ")", "\\", "(", "a", "+", "=", "f", "(", "b", ",", "c", ",", "d", ")", "+", "x", ",", "a", "=", "(", "a", "<", "<", "s", ")", "|", "(", "a", ">", ">", "(", "32", "-", "s", ")", "))", "#", "define", "K1", "0", "#", "define", "K2", "013240474631UL", "#", "define", "K3", "015666365641UL", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "static", "__u32", "twothirdsMD4Transform", "(", "__u32", "const", "buf", "[", "4", "]", ",", "__u32", "const", "in", "[", "12", "]", ")", "{", "__u32", "a", "=", "buf", "[", "0", "]", ",", "b", "=", "buf", "[", "1", "]", ",", "c", "=", "buf", "[", "2", "]", ",", "d", "=", "buf", "[", "3", "]", ";", "/", "*", "Round", "1", "*", "/", "ROUND", "(", "F", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "0", "]", "+", "K1", ",", "3", ")", ";", "ROUND", "(", "F", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "1", "]", "+", "K1", ",", "7", ")", ";", "ROUND", "(", "F", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "2", "]", "+", "K1", ",", "11", ")", ";", "ROUND", "(", "F", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "3", "]", "+", "K1", ",", "19", ")", ";", "ROUND", "(", "F", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "K1", ",", "3", ")", ";", "ROUND", "(", "F", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "5", "]", "+", "K1", ",", "7", ")", ";", "ROUND", "(", "F", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "6", "]", "+", "K1", ",", "11", ")", ";", "ROUND", "(", "F", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "7", "]", "+", "K1", ",", "19", ")", ";", "ROUND", "(", "F", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "8", "]", "+", "K1", ",", "3", ")", ";", "ROUND", "(", "F", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "9", "]", "+", "K1", ",", "7", ")", ";", "ROUND", "(", "F", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "10", "]", "+", "K1", ",", "11", ")", ";", "ROUND", "(", "F", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "11", "]", "+", "K1", ",", "19", ")", ";", "/", "*", "Round", "2", "*", "/", "ROUND", "(", "G", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "1", "]", "+", "K2", ",", "3", ")", ";", "ROUND", "(", "G", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "3", "]", "+", "K2", ",", "5", ")", ";", "ROUND", "(", "G", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "5", "]", "+", "K2", ",", "9", ")", ";", "ROUND", "(", "G", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "7", "]", "+", "K2", ",", "13", ")", ";", "ROUND", "(", "G", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "K2", ",", "3", ")", ";", "ROUND", "(", "G", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "11", "]", "+", "K2", ",", "5", ")", ";", "ROUND", "(", "G", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "0", "]", "+", "K2", ",", "9", ")", ";", "ROUND", "(", "G", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "2", "]", "+", "K2", ",", "13", ")", ";", "ROUND", "(", "G", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "K2", ",", "3", ")", ";", "ROUND", "(", "G", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "6", "]", "+", "K2", ",", "5", ")", ";", "ROUND", "(", "G", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "8", "]", "+", "K2", ",", "9", ")", ";", "ROUND", "(", "G", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "10", "]", "+", "K2", ",", "13", ")", ";", "/", "*", "Round", "3", "*", "/", "ROUND", "(", "H", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "3", "]", "+", "K3", ",", "3", ")", ";", "ROUND", "(", "H", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "7", "]", "+", "K3", ",", "9", ")", ";", "ROUND", "(", "H", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "11", "]", "+", "K3", ",", "11", ")", ";", "ROUND", "(", "H", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "2", "]", "+", "K3", ",", "15", ")", ";", "ROUND", "(", "H", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "6", "]", "+", "K3", ",", "3", ")", ";", "ROUND", "(", "H", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "10", "]", "+", "K3", ",", "9", ")", ";", "ROUND", "(", "H", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "1", "]", "+", "K3", ",", "11", ")", ";", "ROUND", "(", "H", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "5", "]", "+", "K3", ",", "15", ")", ";", "ROUND", "(", "H", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "K3", ",", "3", ")", ";", "ROUND", "(", "H", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "0", "]", "+", "K3", ",", "9", ")", ";", "ROUND", "(", "H", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "4", "]", "+", "K3", ",", "11", ")", ";", "ROUND", "(", "H", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "8", "]", "+", "K3", ",", "15", ")", ";", "return", "buf", "[", "1", "]", "+", "b", ";", "/", "*", "\"", "most", "hashed", "\"", "word", "*", "/", "/", "*", "Alternative", ":", "return", "sum", "of", "all", "words", "?", "*", "/", "}", "#", "endif", "#", "undef", "ROUND", "#", "undef", "F", "#", "undef", "G", "#", "undef", "H", "#", "undef", "K1", "#", "undef", "K2", "#", "undef", "K3", "/", "*", "This", "should", "not", "be", "decreased", "so", "low", "that", "ISNs", "wrap", "too", "fast", ".", "*", "/", "#", "define", "REKEY_INTERVAL", "(", "300", "*", "HZ", ")", "/", "*", "*", "Bit", "layout", "of", "the", "tcp", "sequence", "numbers", "(", "before", "adding", "current", "time", ")", ":", "*", "bit", "24", "-", "31", ":", "increased", "after", "every", "key", "exchange", "*", "bit", "0", "-", "23", ":", "hash", "(", "source", ",", "dest", ")", "*", "*", "The", "implementation", "is", "similar", "to", "the", "algorithm", "described", "*", "in", "the", "Appendix", "of", "RFC", "1185", ",", "except", "that", "*", "-", "it", "uses", "a", "1", "MHz", "clock", "instead", "of", "a", "250", "kHz", "clock", "*", "-", "it", "performs", "a", "rekey", "every", "5", "minutes", ",", "which", "is", "equivalent", "*", "to", "a", "(", "source", ",", "dest", ")", "tulple", "dependent", "forward", "jump", "of", "the", "*", "clock", "by", "0", ".", ".", "2", "^", "(", "HASH_BITS", "+", "1", ")", "*", "*", "Thus", "the", "average", "ISN", "wraparound", "time", "is", "68", "minutes", "instead", "of", "*", "4", ".", "55", "hours", ".", "*", "*", "SMP", "cleanup", "and", "lock", "avoidance", "with", "poor", "man", "'", "s", "RCU", ".", "*", "Manfred", "Spraul", "<", "manfred", "@", "colorfullife", ".", "com", ">", "*", "*", "/", "#", "define", "COUNT_BITS", "8", "#", "define", "COUNT_MASK", "(", "(", "1", "<", "<", "COUNT_BITS", ")", "-", "1", ")", "#", "define", "HASH_BITS", "24", "#", "define", "HASH_MASK", "(", "(", "1", "<", "<", "HASH_BITS", ")", "-", "1", ")", "static", "struct", "keydata", "{", "__u32", "count", ";", "/", "*", "already", "shifted", "to", "the", "final", "position", "*", "/", "__u32", "secret", "[", "12", "]", ";", "}", "____cacheline_aligned", "ip_keydata", "[", "2", "]", ";", "static", "unsigned", "int", "ip_cnt", ";", "static", "void", "rekey_seq_generator", "(", "struct", "work_struct", "*", "work", ")", ";", "static", "DECLARE_DELAYED_WORK", "(", "rekey_work", ",", "rekey_seq_generator", ")", ";", "/", "*", "*", "Lock", "avoidance", ":", "*", "The", "ISN", "generation", "runs", "lockless", "-", "it", "'", "s", "just", "a", "hash", "over", "random", "data", ".", "*", "State", "changes", "happen", "every", "5", "minutes", "when", "the", "random", "key", "is", "replaced", ".", "*", "Synchronization", "is", "performed", "by", "having", "two", "copies", "of", "the", "hash", "function", "*", "state", "and", "rekey_seq_generator", "always", "updates", "the", "inactive", "copy", ".", "*", "The", "copy", "is", "then", "activated", "by", "updating", "ip_cnt", ".", "*", "The", "implementation", "breaks", "down", "if", "someone", "blocks", "the", "thread", "*", "that", "processes", "SYN", "requests", "for", "more", "than", "5", "minutes", ".", "Should", "never", "*", "happen", ",", "and", "even", "if", "that", "happens", "only", "a", "not", "perfectly", "compliant", "*", "ISN", "is", "generated", ",", "nothing", "fatal", ".", "*", "/", "static", "void", "rekey_seq_generator", "(", "struct", "work_struct", "*", "work", ")", "struct", "keydata", "*", "keyptr", "=", "&", "ip_keydata", "[", "1", "^", "(", "ip_cnt", "&", "1", ")", "];", "get_random_bytes", "(", "keyptr", "-", ">", "secret", ",", "sizeof", "(", "keyptr", "-", ">", "secret", ")", ");", "keyptr", "-", ">", "count", "=", "(", "ip_cnt", "&", "COUNT_MASK", ")", "<", "<", "HASH_BITS", ";", "smp_wmb", "(", ");", "ip_cnt", "+", "+;", "schedule_delayed_work", "(", "&", "rekey_work", ",", "round_jiffies_relative", "(", "REKEY_INTERVAL", ")", ");", "}", "static", "inline", "struct", "keydata", "*", "get_keyptr", "(", "void", ")", "{", "struct", "keydata", "*", "keyptr", "=", "&", "ip_keydata", "[", "ip_cnt", "&", "1", "]", ";", "smp_rmb", "(", ");", "return", "keyptr", ";", "}", "static", "__init", "int", "seqgen_init", "(", "void", ")", "{", "rekey_seq_generator", "(", "NULL", ")", ";", "late_initcall", "(", "seqgen_init", ")", ";", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "__u32", "seq", ";", "__u32", "hash", "[", "12", "]", ";", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "/", "*", "The", "procedure", "is", "the", "same", "as", "for", "IPv4", ",", "but", "addresses", "are", "longer", ".", "*", "Thus", "we", "must", "use", "twothirdsMD4Transform", ".", "*", "/", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "hash", "[", "4", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "memcpy", "(", "&", "hash", "[", "5", "]", ",", "keyptr", "-", ">", "secret", ",", "sizeof", "(", "__u32", ")", "*", "7", ")", ";", "seq", "=", "twothirdsMD4Transform", "(", "(", "const", "__u32", "*", ")", "daddr", ",", "hash", ")", "&", "HASH_MASK", ";", "seq", "+", "=", "keyptr", "-", ">", "count", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_tcpv6_sequence_number", ")", ";", "#", "endif", "/", "*", "The", "code", "below", "is", "shamelessly", "stolen", "from", "secure_tcp_sequence_number", "(", ").", "*", "All", "blames", "to", "Andrey", "V", ".", "Savochkin", "<", "saw", "@", "msu", ".", "ru", ">", ".", "*", "/", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", "{", "struct", "keydata", "*", "keyptr", ";", "__u32", "hash", "[", "4", "]", ";", "keyptr", "=", "get_keyptr", "(", ");", "/", "*", "*", "Pick", "a", "unique", "starting", "offset", "for", "each", "IP", "destination", ".", "*", "The", "dest", "ip", "address", "is", "placed", "in", "the", "starting", "vector", ",", "*", "which", "is", "then", "hashed", "with", "random", "data", ".", "*", "/", "hash", "[", "0", "]", "=", "(", "__force", "__u32", ")", "daddr", ";", "hash", "[", "1", "]", "=", "keyptr", "-", ">", "secret", "[", "9", "]", ";", "hash", "[", "2", "]", "=", "keyptr", "-", ">", "secret", "[", "10", "]", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "return", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "}", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ")", "{", "const", "struct", "keydata", "*", "keyptr", ";", "__u32", "hash", "[", "4", "]", ";", "keyptr", "=", "get_keyptr", "(", ");", "hash", "[", "0", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "0", "]", ";", "hash", "[", "1", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "1", "]", ";", "hash", "[", "2", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "2", "]", ";", "hash", "[", "3", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "3", "]", ";", "return", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "}", "#", "ifdef", "CONFIG_INET", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "__u32", "seq", ";", "__u32", "hash", "[", "4", "]", ";", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "/", "*", "*", "Pick", "a", "unique", "starting", "offset", "for", "each", "TCP", "connection", "endpoints", "*", "(", "saddr", ",", "daddr", ",", "sport", ",", "dport", ")", ".", "*", "Note", "that", "the", "words", "are", "placed", "into", "the", "starting", "vector", ",", "which", "is", "*", "then", "mixed", "with", "a", "partial", "MD4", "over", "random", "data", ".", "*", "/", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "seq", "=", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", "&", "HASH_MASK", ";", "seq", "+", "=", "keyptr", "-", ">", "count", ";", "/", "*", "*", "As", "close", "as", "possible", "to", "RFC", "793", ",", "which", "*", "suggests", "using", "a", "250", "kHz", "clock", ".", "*", "Further", "reading", "shows", "this", "assumes", "2", "Mb", "/", "s", "networks", ".", "*", "For", "10", "Mb", "/", "s", "Ethernet", ",", "a", "1", "MHz", "clock", "is", "appropriate", ".", "*", "For", "10", "Gb", "/", "s", "Ethernet", ",", "a", "1", "GHz", "clock", "should", "be", "ok", ",", "but", "*", "we", "also", "need", "to", "limit", "the", "resolution", "so", "that", "the", "u32", "seq", "*", "overlaps", "less", "than", "one", "time", "per", "MSL", "(", "2", "minutes", ")", ".", "*", "Choosing", "a", "clock", "of", "64", "ns", "period", "is", "OK", ".", "(", "period", "of", "274", "s", ")", "*", "/", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ">", ">", "6", ";", "return", "seq", ";", "}", "/", "*", "Generate", "secure", "starting", "point", "for", "ephemeral", "IPV4", "transport", "port", "search", "*", "/", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", "{", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "u32", "hash", "[", "4", "]", ";", "/", "*", "*", "Pick", "a", "unique", "starting", "offset", "for", "each", "ephemeral", "port", "search", "*", "(", "saddr", ",", "daddr", ",", "dport", ")", "and", "48bits", "of", "random", "data", ".", "*", "/", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "__force", "u32", ")", "dport", "^", "keyptr", "-", ">", "secret", "[", "10", "]", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "return", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "secure_ipv4_port_ephemeral", ")", ";", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", "{", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "u32", "hash", "[", "12", "]", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "hash", "[", "4", "]", "=", "(", "__force", "u32", ")", "dport", ";", "memcpy", "(", "&", "hash", "[", "5", "]", ",", "keyptr", "-", ">", "secret", ",", "sizeof", "(", "__u32", ")", "*", "7", ")", ";", "return", "twothirdsMD4Transform", "(", "(", "const", "__u32", "*", ")", "daddr", ",", "hash", ")", ";", "}", "#", "endif", "#", "if", "defined", "(", "CONFIG_IP_DCCP", ")", "|", "|", "defined", "(", "CONFIG_IP_DCCP_MODULE", ")", "/", "*", "Similar", "to", "secure_tcp_sequence_number", "but", "generate", "a", "48", "bit", "value", "*", "bit", "'", "s", "32", "-", "47", "increase", "every", "key", "exchange", "*", "0", "-", "31", "hash", "(", "source", ",", "dest", ")", "*", "/", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u64", "seq", ";", "__u32", "hash", "[", "4", "]", ";", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "seq", "=", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "seq", "|", "=", "(", "(", "u64", ")", "keyptr", "-", ">", "count", ")", "<", "<", "(", "32", "-", "HASH_BITS", ")", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "seq", "&", "=", "(", "1ull", "<", "<", "48", ")", "-", "1", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_dccp_sequence_number", ")", ";", "#", "endif", "#", "endif", "/", "*", "CONFIG_INET", "*", "/", "DEFINE_PER_CPU", "(", "__u32", "[", "4", "]", ",", "get_random_int_hash", ")", ";", "struct", "keydata", "*", "keyptr", ";", "int", "ret", ";", "keyptr", "=", "get_keyptr", "(", ");", "ret", "=", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "extern", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", ";", "extern", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ");", "extern", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", ";", "extern", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "gen_stats", ".", "o", "gen_estimator", ".", "o", "net_namespace", ".", "o", "static", "inline", "__u32", "secure_dccpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "return", "secure_tcpv6_sequence_number", "(", "saddr", ",", "daddr", ",", "sport", ",", "dport", ")", ";", "}", "static", "inline", "__u32", "dccp_v6_init_sequence", "(", "struct", "sk_buff", "*", "skb", ")"], "docstring_tokens": ["by", "predicting", "these", "values", "and", "sending", "crafted", "packets", "."]}
{"contents": ["[KARAF-6230]", "Prevent", "use", "of", "relative", "path", "in", "config:install", "and", "ConfigMBean#install()"], "code_tokens": ["if", "(", "finalname", ".", "contains", "(", "\".", ".\"", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "For", "security", "reason", ",", "relative", "path", "is", "not", "allowed", "in", "config", "file", "final", "name", "\"", ");", "}", "if", "(", "finalname", ".", "contains", "(", "\".", ".\"", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "For", "security", "reason", ",", "relative", "path", "is", "not", "allowed", "in", "config", "file", "final", "name", "\"", ");", "}", "/", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "karaf", ".", "config", ".", "core", ".", "impl", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileReader", ";", "public", "class", "ConfigMBeanImplTest", "{", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testInstallWithNonAuthorizePath", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "karaf", ".", "etc", "\"", ",", "\"", ".\"", ");", "ConfigMBeanImpl", "configMBean", "=", "new", "ConfigMBeanImpl", "(", ");", "configMBean", ".", "install", "(", "\"", "file", ":", "foo", ".", "cfg", "\"", ",", "\"", "..", "/", "test", ".", "cfg", "\"", ",", "false", ")", ";", "}", "@", "Test", "public", "void", "testInstall", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "karaf", ".", "etc", "\"", ",", "\"", "./", "target", "/", "test", "-", "classes", "\"", ");", "ConfigMBeanImpl", "configMBean", "=", "new", "ConfigMBeanImpl", "(", ");", "configMBean", ".", "install", "(", "\"", "file", ":", "./", "target", "/", "test", "-", "classes", "/", "test", ".", "cfg", "\"", ",", "\"", "foo", ".", "cfg", "\"", ",", "true", ")", ";", "File", "output", "=", "new", "File", "(", "\"", "target", "/", "test", "-", "classes", "/", "foo", ".", "cfg", "\"", ");", "Assert", ".", "assertTrue", "(", "output", ".", "exists", "(", "))", ";", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "FileReader", "(", "output", ")", ");", "String", "line", "=", "null", ";", "while", "(", "(", "line", "=", "reader", ".", "readLine", "(", "))", "!", "=", "null", ")", "{", "builder", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "}", "Assert", ".", "assertTrue", "(", "builder", ".", "toString", "(", ").", "contains", "(", "\"", "foo", "=", "bar", "\"", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "#", "#", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "#", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "#", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "#", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "#", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "#", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "#", "#", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "#", "#", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "#", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "#", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "#", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "#", "limitations", "under", "the", "License", ".", "#", "foo", "=", "bar</s>"], "docstring_tokens": ["checking", "the", "path", "argument", "of", "the", "method", "and", "prevent", "use", "of", "\"..\"", "in", "the", "path"]}
{"contents": ["[SCSI]", "bfa:", "fix", "system", "crash", "when", "reading", "sysfs", "fc_host", "statistics", "The", "port", "data", "structure", "related", "to", "fc_host", "statistics", "collection", "is", "not", "initialized.", "This", "causes", "system", "crash", "when", "reading", "the", "fc_host", "statistics.", "The", "fix", "is", "to", "initialize", "port", "structure", "during", "driver", "attach.", "Signed-off-by:", "Krishna", "Gudipati", "<kgudipat@brocade.com>", "Signed-off-by:", "James", "Bottomley", "<James.Bottomley@suse.de>"], "code_tokens": ["dm_len", "+", "=", "bfa_port_meminfo", "(", ");", "static", "void", "bfa_com_port_attach", "(", "struct", "bfa_s", "*", "bfa", ",", "struct", "bfa_meminfo_s", "*", "mi", ")", "{", "struct", "bfa_port_s", "*", "port", "=", "&", "bfa", "-", ">", "modules", ".", "port", ";", "uint32_t", "dm_len", ";", "uint8_t", "*", "dm_kva", ";", "uint64_t", "dm_pa", ";", "dm_len", "=", "bfa_port_meminfo", "(", ");", "dm_kva", "=", "bfa_meminfo_dma_virt", "(", "mi", ")", ";", "dm_pa", "=", "bfa_meminfo_dma_phys", "(", "mi", ")", ";", "memset", "(", "port", ",", "0", ",", "sizeof", "(", "struct", "bfa_port_s", ")", ");", "bfa_port_attach", "(", "port", ",", "&", "bfa", "-", ">", "ioc", ",", "bfa", ",", "bfa", "-", ">", "trcmod", ",", "bfa", "-", ">", "logm", ")", ";", "bfa_port_mem_claim", "(", "port", ",", "dm_kva", ",", "dm_pa", ")", ";", "bfa_meminfo_dma_virt", "(", "mi", ")", "=", "dm_kva", "+", "dm_len", ";", "bfa_meminfo_dma_phys", "(", "mi", ")", "=", "dm_pa", "+", "dm_len", ";", "}", "bfa_com_port_attach", "(", "bfa", ",", "meminfo", ")", ";</s>"], "docstring_tokens": ["via", "read", "operations", "on", "an", "fc_host", "statistics", "file", "."]}
{"contents": ["De-pessimize", "rds_page_copy_user", "Don't", "try", "to", "\"optimize\"", "rds_page_copy_user()", "by", "using", "kmap_atomic()", "and", "the", "unsafe", "atomic", "user", "mode", "accessor", "functions.", "It's", "actually", "slower", "than", "the", "straightforward", "code", "on", "any", "reasonable", "modern", "CPU.", "Back", "when", "the", "code", "was", "written", "(although", "probably", "not", "by", "the", "time", "it", "was", "actually", "merged,", "though),", "32-bit", "x86", "may", "have", "been", "the", "dominant", "architecture.", "And", "there", "kmap_atomic()", "can", "be", "a", "lot", "faster", "than", "kmap()", "(unless", "you", "have", "very", "good", "locality,", "in", "which", "case", "the", "virtual", "address", "caching", "by", "kmap()", "can", "overcome", "all", "the", "downsides).", "But", "these", "days,", "x86-64", "may", "not", "be", "more", "populous,", "but", "it's", "getting", "there", "(and", "if", "you", "care", "about", "performance,", "it's", "definitely", "already", "there", "-", "you'd", "have", "upgraded", "your", "CPU's", "already", "in", "the", "last", "few", "years).", "And", "on", "x86-64,", "the", "non-kmap_atomic()", "version", "is", "faster,", "simply", "because", "the", "code", "is", "simpler", "and", "doesn't", "have", "the", "\"re-try", "page", "fault\"", "case.", "People", "with", "old", "hardware", "are", "not", "likely", "to", "care", "about", "RDS", "anyway,", "and", "the", "optimization", "for", "the", "32-bit", "case", "is", "simply", "buggy,", "since", "it", "doesn't", "verify", "the", "user", "addresses", "properly.", "Reported-by:", "Dan", "Rosenberg", "<drosenberg@vsecurity.com>", "Acked-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["addr", "=", "kmap", "(", "page", ")", ";", "if", "(", "to_user", ")", "{", "ret", "=", "copy_to_user", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "}", "else", "{", "ret", "=", "copy_from_user", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap", "(", "page", ")", ";", "return", "ret", "?", "-", "EFAULT", ":", "0", ";</s>if", "(", "to_user", ")", "else", "addr", "=", "kmap_atomic", "(", "page", ",", "KM_USER0", ")", ";", "if", "(", "to_user", ")", "ret", "=", "__copy_to_user_inatomic", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "else", "ret", "=", "__copy_from_user_inatomic", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap_atomic", "(", "addr", ",", "KM_USER0", ")", ";", "if", "(", "ret", ")", "{", "addr", "=", "kmap", "(", "page", ")", ";", "if", "(", "to_user", ")", "ret", "=", "copy_to_user", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "else", "ret", "=", "copy_from_user", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap", "(", "page", ")", ";", "if", "(", "ret", ")", "return", "-", "EFAULT", ";", "return", "0", ";"], "docstring_tokens": ["via", "crafted", "use", "of", "the", "sendmsg", "and", "recvmsg", "system", "calls", "."]}
