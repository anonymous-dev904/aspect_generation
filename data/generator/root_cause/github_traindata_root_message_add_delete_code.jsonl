{"contents": ["sunrpc:", "use-after-free", "in", "svc_process_common()", "if", "node", "have", "NFSv41+", "mounts", "inside", "several", "net", "namespaces", "it", "can", "lead", "to", "use-after-free", "in", "svc_process_common()", "svc_process_common()", "/*", "Setup", "reply", "header", "*/", "rqstp->rq_xprt->xpt_ops->xpo_prep_reply_hdr(rqstp);", "<<<", "HERE", "svc_process_common()", "can", "use", "incorrect", "rqstp->rq_xprt,", "its", "caller", "function", "bc_svc_process()", "takes", "it", "from", "serv->sv_bc_xprt.", "The", "problem", "is", "that", "serv", "is", "global", "structure", "but", "sv_bc_xprt", "is", "assigned", "per-netnamespace.", "According", "to", "Trond,", "the", "whole", "\"let's", "set", "up", "rqstp->rq_xprt", "for", "the", "back", "channel\"", "is", "nothing", "but", "a", "giant", "hack", "in", "order", "to", "work", "around", "the", "fact", "that", "svc_process_common()", "uses", "it", "to", "find", "the", "xpt_ops,", "and", "perform", "a", "couple", "of", "(meaningless", "for", "the", "back", "channel)", "tests", "of", "xpt_flags.", "All", "we", "really", "need", "in", "svc_process_common()", "is", "to", "be", "able", "to", "run", "rqstp->rq_xprt->xpt_ops->xpo_prep_reply_hdr()", "Bruce", "J", "Fields", "points", "that", "this", "xpo_prep_reply_hdr()", "call", "is", "an", "awfully", "roundabout", "way", "just", "to", "do", "\"svc_putnl(resv,", "0);\"", "in", "the", "tcp", "case.", "This", "patch", "does", "not", "initialiuze", "rqstp->rq_xprt", "in", "bc_svc_process(),", "now", "it", "calls", "svc_process_common()", "with", "rqstp->rq_xprt", "=", "NULL.", "To", "adjust", "reply", "header", "svc_process_common()", "just", "check", "rqstp->rq_prot", "and", "calls", "svc_tcp_prep_reply_hdr()", "for", "tcp", "case.", "To", "handle", "rqstp->rq_xprt", "=", "NULL", "case", "in", "functions", "called", "from", "svc_process_common()", "patch", "intruduces", "net", "namespace", "pointer", "svc_rqst->rq_bc_net", "and", "adjust", "SVC_NET()", "definition.", "Some", "other", "function", "was", "also", "adopted", "to", "properly", "handle", "described", "case.", "Signed-off-by:", "Vasily", "Averin", "<vvs@virtuozzo.com>", "Cc:", "stable@vger.kernel.org", "Fixes:", "23c20ecd4475", "(\"NFS:", "callback", "up", "-", "users", "counting", "cleanup\")", "Signed-off-by:", "J.", "Bruce", "Fields", "<bfields@redhat.com>"], "code_tokens": ["struct", "net", "*", "rq_bc_net", ";", "/", "*", "pointer", "to", "backchannel", "'", "s", "*", "net", "namespace", "*", "/", "#", "define", "SVC_NET", "(", "rqst", ")", "(", "rqst", "-", ">", "rq_xprt", "?", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_net", ":", "rqst", "-", ">", "rq_bc_net", ")", "__string", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "?", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ":", "\"", "(", "null", ")", "\")", "__assign_str", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "?", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ":", "\"", "(", "null", ")", "\")", ";", "if", "(", "rqstp", "-", ">", "rq_prot", "=", "=", "IPPROTO_TCP", ")", "svc_tcp_prep_reply_hdr", "(", "rqstp", ")", ";", "if", "(", "versp", "-", ">", "vs_need_cong_ctrl", "&", "&", "rqstp", "-", ">", "rq_xprt", "&", "&", "if", "(", "rqstp", "-", ">", "rq_xprt", "&", "&", "test_bit", "(", "XPT_TEMP", ",", "&", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_flags", ")", ")", "rqstp", "-", ">", "rq_bc_net", "=", "req", "-", ">", "rq_xprt", "-", ">", "xprt_net", ";", "struct", "svc_xprt", "*", "xprt", "=", "rqstp", "-", ">", "rq_xprt", ";", "if", "(", "xprt", "&", "&", "space", "<", "rqstp", "-", ">", "rq_reserved", ")", "{", "void", "svc_tcp_prep_reply_hdr", "(", "struct", "svc_rqst", "*", "rqstp", ")</s>#", "define", "SVC_NET", "(", "svc_rqst", ")", "(", "svc_rqst", "-", ">", "rq_xprt", "-", ">", "xpt_net", ")", "__string", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ")", "__assign_str", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ")", ";", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_ops", "-", ">", "xpo_prep_reply_hdr", "(", "rqstp", ")", ";", "if", "(", "versp", "-", ">", "vs_need_cong_ctrl", "&", "&", "if", "(", "test_bit", "(", "XPT_TEMP", ",", "&", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_flags", ")", ")", "rqstp", "-", ">", "rq_xprt", "=", "serv", "-", ">", "sv_bc_xprt", ";", "if", "(", "space", "<", "rqstp", "-", ">", "rq_reserved", ")", "{", "struct", "svc_xprt", "*", "xprt", "=", "rqstp", "-", ">", "rq_xprt", ";", "static", "void", "svc_tcp_prep_reply_hdr", "(", "struct", "svc_rqst", "*", "rqstp", ")"], "docstring_tokens": ["use", "wrong", "back-channel"]}
{"contents": ["Allows", "define", "allowed", "classes", "per", "action"], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "struts2", ".", "rest", ".", "handler", ";", "import", "java", ".", "util", ".", "Set", ";", "public", "interface", "AllowedClassNames", "{", "Set", "<", "String", ">", "allowedClassNames", "(", ");", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "26", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "struts2", ".", "rest", ".", "handler", ";", "import", "java", ".", "util", ".", "Set", ";", "public", "interface", "AllowedClasses", "{", "Set", "<", "Class", "<", "?>", ">", "allowedClasses", "(", ");", "}", "@", "@", "-", "22", ",", "39", "+", "22", ",", "114", "@", "@", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "ModelDriven", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ArrayTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ExplicitTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NoTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NullPermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "PrimitiveTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "TypePermission", ";", "import", "org", ".", "apache", ".", "logging", ".", "log4j", ".", "LogManager", ";", "import", "org", ".", "apache", ".", "logging", ".", "log4j", ".", "Logger", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "private", "static", "final", "Logger", "LOG", "=", "LogManager", ".", "getLogger", "(", "XStreamHandler", ".", "class", ")", ";", "XStream", "xstream", "=", "createXStream", "(", "invocation", ")", ";", "XStream", "xstream", "=", "createXStream", "(", "invocation", ")", ";", "/", "**", "*", "@", "deprecated", "use", "version", "with", "{", "@", "link", "ActionInvocation", "}", "*", "/", "@", "Deprecated", "LOG", ".", "warn", "(", "\"", "You", "are", "using", "a", "deprecated", "API", "!", "\")", ";", "protected", "XStream", "createXStream", "(", "ActionInvocation", "invocation", ")", "{", "XStream", "stream", "=", "new", "XStream", "(", ");", "LOG", ".", "debug", "(", "\"", "Clears", "existing", "permissions", "\"", ");", "stream", ".", "addPermission", "(", "NoTypePermission", ".", "NONE", ")", ";", "LOG", ".", "debug", "(", "\"", "Adds", "per", "action", "permissions", "\"", ");", "addPerActionPermission", "(", "invocation", ",", "stream", ")", ";", "LOG", ".", "debug", "(", "\"", "Adds", "default", "permissions", "\"", ");", "addDefaultPermissions", "(", "invocation", ",", "stream", ")", ";", "return", "stream", ";", "}", "private", "void", "addPerActionPermission", "(", "ActionInvocation", "invocation", ",", "XStream", "stream", ")", "{", "Object", "action", "=", "invocation", ".", "getAction", "(", ");", "if", "(", "action", "instanceof", "AllowedClasses", ")", "{", "Set", "<", "Class", "<", "?>", ">", "allowedClasses", "=", "(", "(", "AllowedClasses", ")", "action", ")", ".", "allowedClasses", "(", ");", "stream", ".", "addPermission", "(", "new", "ExplicitTypePermission", "(", "allowedClasses", ".", "toArray", "(", "new", "Class", "[", "allowedClasses", ".", "size", "(", ")]", "))", ");", "}", "if", "(", "action", "instanceof", "AllowedClassNames", ")", "{", "Set", "<", "String", ">", "allowedClassNames", "=", "(", "(", "AllowedClassNames", ")", "action", ")", ".", "allowedClassNames", "(", ");", "stream", ".", "addPermission", "(", "new", "ExplicitTypePermission", "(", "allowedClassNames", ".", "toArray", "(", "new", "String", "[", "allowedClassNames", ".", "size", "(", ")]", "))", ");", "}", "if", "(", "action", "instanceof", "XStreamPermissionProvider", ")", "{", "Collection", "<", "TypePermission", ">", "permissions", "=", "(", "(", "XStreamPermissionProvider", ")", "action", ")", ".", "getTypePermissions", "(", ");", "for", "(", "TypePermission", "permission", ":", "permissions", ")", "{", "stream", ".", "addPermission", "(", "permission", ")", ";", "}", "}", "}", "protected", "void", "addDefaultPermissions", "(", "ActionInvocation", "invocation", ",", "XStream", "stream", ")", "{", "stream", ".", "addPermission", "(", "new", "ExplicitTypePermission", "(", "new", "Class", "[", "]{", "invocation", ".", "getAction", "(", ").", "getClass", "(", ")}", "))", ";", "if", "(", "invocation", ".", "getAction", "(", ")", "instanceof", "ModelDriven", ")", "{", "stream", ".", "addPermission", "(", "new", "ExplicitTypePermission", "(", "new", "Class", "[", "]{", "((", "ModelDriven", ")", "invocation", ".", "getAction", "(", "))", ".", "getModel", "(", ").", "getClass", "(", ")}", "))", ";", "}", "stream", ".", "addPermission", "(", "NullPermission", ".", "NULL", ")", ";", "stream", ".", "addPermission", "(", "PrimitiveTypePermission", ".", "PRIMITIVES", ")", ";", "stream", ".", "addPermission", "(", "ArrayTypePermission", ".", "ARRAYS", ")", ";", "stream", ".", "addPermission", "(", "CollectionTypePermission", ".", "COLLECTIONS", ")", ";", "stream", ".", "addPermission", "(", "new", "ExplicitTypePermission", "(", "new", "Class", "[", "]{", "Date", ".", "class", "}", "))", ";", "}", "private", "static", "class", "CollectionTypePermission", "implements", "TypePermission", "{", "private", "static", "final", "TypePermission", "COLLECTIONS", "=", "new", "CollectionTypePermission", "(", ");", "@", "Override", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "&", "type", ".", "isInterface", "(", ")", "&", "&", "(", "Collection", ".", "class", ".", "isAssignableFrom", "(", "type", ")", "|", "|", "Map", ".", "class", ".", "isAssignableFrom", "(", "type", ")", ");", "}", "}", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "struts2", ".", "rest", ".", "handler", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "TypePermission", ";", "import", "java", ".", "util", ".", "Collection", ";", "public", "interface", "XStreamPermissionProvider", "{", "Collection", "<", "TypePermission", ">", "getTypePermissions", "(", ");", "}</s>XStream", "xstream", "=", "createXStream", "(", ");", "XStream", "xstream", "=", "createXStream", "(", ");"], "docstring_tokens": ["the", "deserialization", "of", "untrusted", "data"]}
{"contents": ["xfs:", "remove", "block", "number", "from", "inode", "lookup", "code", "The", "block", "number", "comes", "from", "bulkstat", "based", "inode", "lookups", "to", "shortcut", "the", "mapping", "calculations.", "We", "ar", "enot", "able", "to", "trust", "anything", "from", "bulkstat,", "so", "drop", "the", "block", "number", "as", "well", "so", "that", "the", "correct", "lookups", "and", "mappings", "are", "always", "done.", "Signed-off-by:", "Dave", "Chinner", "<dchinner@redhat.com>", "Reviewed-by:", "Christoph", "Hellwig", "<hch@lst.de>"], "code_tokens": ["XFS_ILOCK_SHARED", ",", "&", "ip", ")", ";", "xfs_bulkstat_one_fmt_compat", ",", "sizeof", "(", "compat_xfs_bstat_t", ")", ",", "0", ",", "&", "res", ")", ";", "if", "(", "(", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "0", ",", "XFS_ILOCK_EXCL", ",", "&", "ip", ")", "))", "{", "0", ",", "0", ",", "&", "uip", ")", "))", "0", ",", "0", ",", "&", "gip", ")", "))", "{", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "mp", "-", ">", "m_sb", ".", "sb_uquotino", ",", "0", ",", "0", ",", "&", "qip", ")", ";", "error2", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "mp", "-", ">", "m_sb", ".", "sb_gquotino", ",", "0", ",", "0", ",", "&", "qip", ")", ";", "0", ",", "0", ",", "&", "uip", ")", "=", "=", "0", ")", "0", ",", "0", ",", "&", "gip", ")", "=", "=", "0", ")", "if", "(", "(", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "0", ",", "lock_flags", ",", "&", "ip", ")", "))", "{", "error", "=", "xfs_iread", "(", "mp", ",", "tp", ",", "ip", ",", "flags", ")", ";", "xfs_inode_t", "*", "*", "ipp", ")", "error", "=", "xfs_iget_cache_miss", "(", "mp", ",", "pag", ",", "tp", ",", "ino", ",", "&", "ip", ",", "uint", ",", "uint", ",", "xfs_inode_t", "*", "*)", ";", "struct", "xfs_inode", "*", ",", "uint", ")", ";", "XFS_IGET_UNTRUSTED", ",", "XFS_ILOCK_SHARED", ",", "&", "ip", ")", ";", "xfs_bulkstat_one_fmt", ",", "ubused", ",", "stat", ")", ";", "error", "=", "formatter", "(", "mp", ",", "ino", ",", "ubufp", ",", "ubleft", ",", "error", "=", "xfs_bulkstat_one", "(", "mp", ",", "ino", ",", "buffer", ",", "sizeof", "(", "xfs_bstat_t", ")", ",", "0", ",", "&", "res", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "0", ",", "0", ",", "&", "ip", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "sbp", "-", ">", "sb_rootino", ",", "0", ",", "XFS_ILOCK_EXCL", ",", "&", "rip", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "sbp", "-", ">", "sb_rbmino", ",", "0", ",", "0", ",", "&", "mp", "-", ">", "m_rbmip", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "sbp", "-", ">", "sb_rsumino", ",", "0", ",", "0", ",", "&", "mp", "-", ">", "m_rsumip", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "tp", ",", "ino", ",", "flags", ",", "lock_flags", ",", "ipp", ")", ";", "error", "=", "xfs_iget", "(", "dp", "-", ">", "i_mount", ",", "NULL", ",", "inum", ",", "0", ",", "0", ",", "ipp", ")", ";</s>XFS_ILOCK_SHARED", ",", "&", "ip", ",", "0", ")", ";", "xfs_daddr_t", "bno", ",", "/", "*", "starting", "bno", "of", "inode", "cluster", "*", "/", "xfs_bulkstat_one_fmt_compat", ",", "bno", ",", "sizeof", "(", "compat_xfs_bstat_t", ")", ",", "0", ",", "NULL", ",", "&", "res", ")", ";", "xfs_daddr_t", "bno", ",", "/", "*", "starting", "block", "of", "inode", "cluster", "*", "/", "if", "(", "(", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "0", ",", "XFS_ILOCK_EXCL", ",", "&", "ip", ",", "bno", ")", "))", "{", "0", ",", "0", ",", "&", "uip", ",", "0", ")", "))", "0", ",", "0", ",", "&", "gip", ",", "0", ")", "))", "{", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "mp", "-", ">", "m_sb", ".", "sb_uquotino", ",", "0", ",", "0", ",", "&", "qip", ",", "0", ")", ";", "error2", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "mp", "-", ">", "m_sb", ".", "sb_gquotino", ",", "0", ",", "0", ",", "&", "qip", ",", "0", ")", ";", "0", ",", "0", ",", "&", "uip", ",", "0", ")", "=", "=", "0", ")", "0", ",", "0", ",", "&", "gip", ",", "0", ")", "=", "=", "0", ")", "xfs_daddr_t", "bno", ",", "/", "*", "starting", "block", "of", "inode", "cluster", "*", "/", "if", "(", "(", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "0", ",", "lock_flags", ",", "&", "ip", ",", "bno", ")", "))", "{", "/", "*", "*", "If", "we", "get", "a", "block", "number", "passed", "we", "can", "use", "it", "to", "*", "find", "the", "buffer", "easily", ".", "*", "/", "if", "(", "imap", "-", ">", "im_blkno", ")", "{", "offset", "=", "XFS_INO_TO_OFFSET", "(", "mp", ",", "ino", ")", ";", "ASSERT", "(", "offset", "<", "mp", "-", ">", "m_sb", ".", "sb_inopblock", ")", ";", "cluster_agbno", "=", "xfs_daddr_to_agbno", "(", "mp", ",", "imap", "-", ">", "im_blkno", ")", ";", "offset", "+", "=", "(", "agbno", "-", "cluster_agbno", ")", "*", "mp", "-", ">", "m_sb", ".", "sb_inopblock", ";", "imap", "-", ">", "im_len", "=", "XFS_FSB_TO_BB", "(", "mp", ",", "blks_per_cluster", ")", ";", "imap", "-", ">", "im_boffset", "=", "(", "ushort", ")", "(", "offset", "<", "<", "mp", "-", ">", "m_sb", ".", "sb_inodelog", ")", ";", "return", "0", ";", "}", "xfs_daddr_t", "bno", ",", "error", "=", "xfs_iread", "(", "mp", ",", "tp", ",", "ip", ",", "bno", ",", "flags", ")", ";", "*", "bno", "-", "-", "the", "block", "number", "starting", "the", "buffer", "containing", "the", "inode", ",", "*", "if", "known", "(", "as", "by", "bulkstat", ")", ",", "else", "0", ".", "xfs_inode_t", "*", "*", "ipp", ",", "xfs_daddr_t", "bno", ")", "error", "=", "xfs_iget_cache_miss", "(", "mp", ",", "pag", ",", "tp", ",", "ino", ",", "&", "ip", ",", "bno", ",", "xfs_daddr_t", "bno", ",", "ip", "-", ">", "i_imap", ".", "im_blkno", "=", "bno", ";", "ASSERT", "(", "bno", "=", "=", "0", "|", "|", "bno", "=", "=", "ip", "-", ">", "i_imap", ".", "im_blkno", ")", ";", "uint", ",", "uint", ",", "xfs_inode_t", "*", "*,", "xfs_daddr_t", ")", ";", "struct", "xfs_inode", "*", ",", "xfs_daddr_t", ",", "uint", ")", ";", "xfs_daddr_t", "bno", ",", "/", "*", "starting", "bno", "of", "cluster", "*", "/", "XFS_IGET_UNTRUSTED", ",", "XFS_ILOCK_SHARED", ",", "&", "ip", ",", "bno", ")", ";", "xfs_daddr_t", "bno", ",", "/", "*", "starting", "bno", "of", "inode", "cluster", "*", "/", "xfs_bulkstat_one_fmt", ",", "bno", ",", "ubused", ",", "stat", ")", ";", "error", "=", "formatter", "(", "mp", ",", "ino", ",", "ubufp", ",", "ubleft", ",", "bno", ",", "error", "=", "xfs_bulkstat_one", "(", "mp", ",", "ino", ",", "buffer", ",", "sizeof", "(", "xfs_bstat_t", ")", ",", "0", ",", "NULL", ",", "&", "res", ")", ";", "xfs_daddr_t", "bno", ",", "xfs_daddr_t", "bno", ",", "xfs_daddr_t", "bno", ",", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "0", ",", "0", ",", "&", "ip", ",", "0", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "sbp", "-", ">", "sb_rootino", ",", "0", ",", "XFS_ILOCK_EXCL", ",", "&", "rip", ",", "0", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "sbp", "-", ">", "sb_rbmino", ",", "0", ",", "0", ",", "&", "mp", "-", ">", "m_rbmip", ",", "0", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "sbp", "-", ">", "sb_rsumino", ",", "0", ",", "0", ",", "&", "mp", "-", ">", "m_rsumip", ",", "0", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "tp", ",", "ino", ",", "flags", ",", "lock_flags", ",", "ipp", ",", "0", ")", ";", "error", "=", "xfs_iget", "(", "dp", "-", ">", "i_mount", ",", "NULL", ",", "inum", ",", "0", ",", "0", ",", "ipp", ",", "0", ")", ";"], "docstring_tokens": ["does", "not", "look", "up", "inode", "allocation", "btrees", "before", "reading", "inode", "buffers"]}
{"contents": ["Fix", "bug", "#75981:", "prevent", "reading", "beyond", "buffer", "start"], "code_tokens": ["if", "(", "tmp_line_len", ">", "=", "1", "&", "&", "tmp_line", "[", "tmp_line_len", "-", "1", "]", "=", "=", "'", "\\", "n", "'", ")", "{", "if", "(", "tmp_line_len", ">", "=", "1", "&", "&", "tmp_line", "[", "tmp_line_len", "-", "1", "]", "=", "=", "'", "\\", "r", "'", ")", "{", "-", "-", "TEST", "-", "-", "Bug", "#", "75981", "(", "stack", "-", "buffer", "-", "overflow", "while", "parsing", "HTTP", "response", ")", "-", "-", "INI", "-", "-", "allow_url_fopen", "=", "1", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require", "'", "server", ".", "inc", "'", ";", "http_server_skipif", "(", "'", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "12342", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "require", "'", "server", ".", "inc", "'", ";", "$", "options", "=", "[", "'", "http", "'", "=", ">", "[", "'", "protocol_version", "'", "=", ">", "'", "1", ".", "1", "'", ",", "'", "header", "'", "=", ">", "'", "Connection", ":", "Close", "'", "]", ",", "]", ";", "$", "ctx", "=", "stream_context_create", "(", "$", "options", ")", ";", "$", "responses", "=", "[", "\"", "data", ":", "//", "text", "/", "plain", ",", "000000000100", "\\", "xA", "\\", "xA", "\"", "]", ";", "$", "pid", "=", "http_server", "(", "'", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "12342", "'", ",", "$", "responses", ")", ";", "echo", "@", "file_get_contents", "(", "'", "http", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "12342", "/", "',", "false", ",", "$", "ctx", ")", ";", "http_server_kill", "(", "$", "pid", ")", ";", "?", ">", "DONE", "-", "-", "EXPECT", "-", "-", "DONE</s>if", "(", "tmp_line", "[", "tmp_line_len", "-", "1", "]", "=", "=", "'", "\\", "n", "'", ")", "{", "-", "-", "tmp_line_len", ";", "if", "(", "tmp_line", "[", "tmp_line_len", "-", "1", "]", "=", "=", "'", "\\", "r", "'", ")", "{", "-", "-", "tmp_line_len", ";"], "docstring_tokens": ["stack-based", "buffer", "under-read"]}
{"contents": ["added", "extra", "check", "if", "it", "is", "a", "liveNode"], "code_tokens": ["if", "(", "!", "cores", ".", "getZkController", "(", ").", "getZkStateReader", "(", ").", "getClusterState", "(", ").", "getLiveNodes", "(", ").", "contains", "(", "nodename", ")", ")", "return", "null", ";</s>"], "docstring_tokens": ["create", "a", "specially", "crafted", "node", "name", "that", "does", "not", "exist", "as", "part", "of", "the", "cluster", "and", "point", "it", "to", "a", "malicious", "node"]}
{"contents": ["xen/netback:", "don't", "leak", "pages", "on", "failure", "in", "xen_netbk_tx_check_gop.", "Signed-off-by:", "Matthew", "Daley", "<mattjd@gmail.com>", "Reviewed-by:", "Konrad", "Rzeszutek", "Wilk", "<konrad.wilk@oracle.com>", "Acked-by:", "Ian", "Campbell", "<ian.campbell@citrix.com>", "Acked-by:", "Jan", "Beulich", "<JBeulich@suse.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["static", "void", "xen_netbk_idx_release", "(", "struct", "xen_netbk", "*", "netbk", ",", "u16", "pending_idx", ",", "u8", "status", ")", ";", "if", "(", "unlikely", "(", "err", ")", ")", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_ERROR", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_OKAY", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_ERROR", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_OKAY", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_OKAY", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_OKAY", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ",", "XEN_NETIF_RSP_OKAY", ")", ";", "static", "void", "xen_netbk_idx_release", "(", "struct", "xen_netbk", "*", "netbk", ",", "u16", "pending_idx", ",", "u8", "status", ")", "make_tx_response", "(", "vif", ",", "&", "pending_tx_info", "-", ">", "req", ",", "status", ")", ";</s>static", "void", "xen_netbk_idx_release", "(", "struct", "xen_netbk", "*", "netbk", ",", "u16", "pending_idx", ")", ";", "struct", "pending_tx_info", "*", "pending_tx_info", "=", "netbk", "-", ">", "pending_tx_info", ";", "struct", "xenvif", "*", "vif", "=", "pending_tx_info", "[", "pending_idx", "]", ".", "vif", ";", "struct", "xen_netif_tx_request", "*", "txp", ";", "if", "(", "unlikely", "(", "err", ")", ")", "{", "pending_ring_idx_t", "index", ";", "index", "=", "pending_index", "(", "netbk", "-", ">", "pending_prod", "+", "+)", ";", "txp", "=", "&", "pending_tx_info", "[", "pending_idx", "]", ".", "req", ";", "make_tx_response", "(", "vif", ",", "txp", ",", "XEN_NETIF_RSP_ERROR", ")", ";", "netbk", "-", ">", "pending_ring", "[", "index", "]", "=", "pending_idx", ";", "xenvif_put", "(", "vif", ")", ";", "}", "pending_ring_idx_t", "index", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ")", ";", "txp", "=", "&", "netbk", "-", ">", "pending_tx_info", "[", "pending_idx", "]", ".", "req", ";", "make_tx_response", "(", "vif", ",", "txp", ",", "XEN_NETIF_RSP_ERROR", ")", ";", "index", "=", "pending_index", "(", "netbk", "-", ">", "pending_prod", "+", "+)", ";", "netbk", "-", ">", "pending_ring", "[", "index", "]", "=", "pending_idx", ";", "xenvif_put", "(", "vif", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ")", ";", "xen_netbk_idx_release", "(", "netbk", ",", "pending_idx", ")", ";", "static", "void", "xen_netbk_idx_release", "(", "struct", "xen_netbk", "*", "netbk", ",", "u16", "pending_idx", ")", "make_tx_response", "(", "vif", ",", "&", "pending_tx_info", "-", ">", "req", ",", "XEN_NETIF_RSP_OKAY", ")", ";"], "docstring_tokens": ["a", "failure", "to", "sanity", "check", "the", "ring", "producer/consumer", "pointers"]}
{"contents": ["[FIXED", "JENKINS-25019]", "A", "truly", "conforming", "servlet", "3.0", "container", "does", "not", "allow", "us", "to", "set", "\"secure", "cookie\"", "flag", "beyond", "ServletContextListener.onInitialized().", "If", "we", "see", "that,", "don't", "scare", "the", "users."], "code_tokens": ["import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "markCookieAsHttpOnly", "(", "context", ")", ";", "/", "**", "*", "Set", "the", "session", "cookie", "as", "HTTP", "only", ".", "*", "*", "@", "see", "<", "a", "href", "=", "\"", "https", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "HttpOnly", "\"", ">", "discussion", "of", "this", "topic", "in", "OWASP", "<", "/", "a", ">", "*", "/", "private", "void", "markCookieAsHttpOnly", "(", "ServletContext", "context", ")", "{", "try", "{", "Method", "m", ";", "try", "{", "m", "=", "context", ".", "getClass", "(", ").", "getMethod", "(", "\"", "getSessionCookieConfig", "\"", ");", "}", "catch", "(", "NoSuchMethodException", "x", ")", "{", "/", "/", "3", ".", "0", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Failed", "to", "set", "secure", "cookie", "flag", "\"", ",", "x", ")", ";", "return", ";", "}", "Object", "sessionCookieConfig", "=", "m", ".", "invoke", "(", "context", ")", ";", "/", "/", "not", "exposing", "session", "cookie", "to", "JavaScript", "to", "mitigate", "damage", "caused", "by", "XSS", "Class", "scc", "=", "Class", ".", "forName", "(", "\"", "javax", ".", "servlet", ".", "SessionCookieConfig", "\"", ");", "Method", "setHttpOnly", "=", "scc", ".", "getMethod", "(", "\"", "setHttpOnly", "\"", ",", "boolean", ".", "class", ")", ";", "setHttpOnly", ".", "invoke", "(", "sessionCookieConfig", ",", "true", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Failed", "to", "set", "HTTP", "-", "only", "cookie", "flag", "\"", ",", "e", ")", ";", "}", "}", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "Method", "setSecure", "=", "scc", ".", "getMethod", "(", "\"", "setSecure", "\"", ",", "boolean", ".", "class", ")", ";", "setSecure", ".", "invoke", "(", "sessionCookieConfig", ",", "v", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "if", "(", "e", ".", "getTargetException", "(", ")", "instanceof", "IllegalStateException", ")", "{", "/", "/", "servlet", "3", ".", "0", "spec", "seems", "to", "prohibit", "this", "from", "getting", "set", "at", "runtime", ",", "/", "/", "though", "Winstone", "is", "happy", "to", "accept", "i", ".", "see", "JENKINS", "-", "25019", "return", ";", "}", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Failed", "to", "set", "secure", "cookie", "flag", "\"", ",", "e", ")", ";</s>/", "/", "not", "exposing", "session", "cookie", "to", "JavaScript", "to", "mitigate", "damage", "caused", "by", "XSS", "Method", "setHttpOnly", "=", "scc", ".", "getMethod", "(", "\"", "setHttpOnly", "\"", ",", "boolean", ".", "class", ")", ";", "setHttpOnly", ".", "invoke", "(", "sessionCookieConfig", ",", "true", ")", ";", "Method", "setSecure", "=", "scc", ".", "getMethod", "(", "\"", "setSecure", "\"", ",", "boolean", ".", "class", ")", ";", "setSecure", ".", "invoke", "(", "sessionCookieConfig", ",", "v", ")", ";"], "docstring_tokens": ["makes", "it", "easier", "for", "remote", "attackers", "to", "obtain", "potentially", "sensitive", "information", "via", "script", "access", "to", "cookies", "."]}
{"contents": ["isdn:", "avoid", "copying", "overly-long", "strings", "Addresses", "http://bugzilla.kernel.org/show_bug.cgi?id=9416", "Signed-off-by:", "Karsten", "Keil", "<kkeil@suse.de>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["char", "nr", "[", "ISDN_MSNLEN", "]", ";", "strlcpy", "(", "nr", ",", "setup", "-", ">", "phone", ",", "ISDN_MSNLEN", ")", ";", "strlcpy", "(", "lp", "-", ">", "msn", ",", "cfg", "-", ">", "eaz", ",", "sizeof", "(", "lp", "-", ">", "msn", ")", ");", "strlcpy", "(", "n", "-", ">", "num", ",", "phone", "-", ">", "phone", ",", "sizeof", "(", "n", "-", ">", "num", ")", ");</s>char", "nr", "[", "32", "]", ";", "strcpy", "(", "nr", ",", "setup", "-", ">", "phone", ")", ";", "strcpy", "(", "lp", "-", ">", "msn", ",", "cfg", "-", ">", "eaz", ")", ";", "strcpy", "(", "n", "-", ">", "num", ",", "phone", "-", ">", "phone", ")", ";"], "docstring_tokens": ["improper", "bounds", "checking"]}
{"contents": ["sctp:", "Fix", "kernel", "panic", "while", "process", "protocol", "violation", "parameter", "Since", "call", "to", "function", "sctp_sf_abort_violation()", "need", "paramter", "'arg'", "with", "'struct", "sctp_chunk'", "type,", "it", "will", "read", "the", "chunk", "type", "and", "chunk", "length", "from", "the", "chunk_hdr", "member", "of", "chunk.", "But", "call", "to", "sctp_sf_violation_paramlen()", "always", "with", "'struct", "sctp_paramhdr'", "type's", "parameter,", "it", "will", "be", "passed", "to", "sctp_sf_abort_violation().", "This", "may", "cause", "kernel", "panic.", "sctp_sf_violation_paramlen()", "|--", "sctp_sf_abort_violation()", "|--", "sctp_make_abort_violation()", "This", "patch", "fixed", "this", "problem.", "This", "patch", "also", "fix", "two", "place", "which", "called", "sctp_sf_violation_paramlen()", "with", "wrong", "paramter", "type.", "Signed-off-by:", "Wei", "Yongjun", "<yjwei@cn.fujitsu.com>", "Signed-off-by:", "Vlad", "Yasevich", "<vladislav.yasevich@hp.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["struct", "sctp_chunk", "*", "sctp_make_violation_paramlen", "(", "const", "struct", "sctp_association", "*", ",", "const", "struct", "sctp_chunk", "*", ",", "struct", "sctp_paramhdr", "*", ");", "struct", "sctp_chunk", "*", "sctp_make_violation_paramlen", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "const", "struct", "sctp_chunk", "*", "chunk", ",", "struct", "sctp_paramhdr", "*", "param", ")", "{", "struct", "sctp_chunk", "*", "retval", ";", "static", "const", "char", "error", "[", "]", "=", "\"", "The", "following", "parameter", "had", "invalid", "length", ":", "\";", "size_t", "payload_len", "=", "sizeof", "(", "error", ")", "+", "sizeof", "(", "sctp_errhdr_t", ")", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "retval", "=", "sctp_make_abort", "(", "asoc", ",", "chunk", ",", "payload_len", ")", ";", "if", "(", "!", "retval", ")", "goto", "nodata", ";", "sctp_init_cause", "(", "retval", ",", "SCTP_ERROR_PROTO_VIOLATION", ",", "sizeof", "(", "error", ")", "+", "sizeof", "(", "sctp_paramhdr_t", ")", ");", "sctp_addto_chunk", "(", "retval", ",", "sizeof", "(", "error", ")", ",", "error", ")", ";", "sctp_addto_param", "(", "retval", ",", "sizeof", "(", "sctp_paramhdr_t", ")", ",", "param", ")", ";", "nodata", ":", "return", "retval", ";", "}", "*", "errp", "=", "sctp_make_violation_paramlen", "(", "asoc", ",", "chunk", ",", "param", ")", ";", "void", "*", "arg", ",", "void", "*", "ext", ",", "return", "sctp_sf_violation_paramlen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "return", "sctp_sf_violation_paramlen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "(", "void", "*", ")", "err_param", ",", "commands", ")", ";", "return", "sctp_sf_violation_paramlen", "(", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "(", "void", "*", ")", "err_param", ",", "commands", ")", ";", "void", "*", "arg", ",", "void", "*", "ext", ",", "sctp_cmd_seq_t", "*", "commands", ")", "{", "struct", "sctp_chunk", "*", "chunk", "=", "arg", ";", "struct", "sctp_paramhdr", "*", "param", "=", "ext", ";", "struct", "sctp_chunk", "*", "abort", "=", "NULL", ";", "if", "(", "sctp_auth_recv_cid", "(", "SCTP_CID_ABORT", ",", "asoc", ")", ")", "goto", "discard", ";", "/", "*", "Make", "the", "abort", "chunk", ".", "*", "/", "abort", "=", "sctp_make_violation_paramlen", "(", "asoc", ",", "chunk", ",", "param", ")", ";", "if", "(", "!", "abort", ")", "goto", "nomem", ";", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_REPLY", ",", "SCTP_CHUNK", "(", "abort", ")", ");", "SCTP_INC_STATS", "(", "SCTP_MIB_OUTCTRLCHUNKS", ")", ";", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_SET_SK_ERR", ",", "SCTP_ERROR", "(", "ECONNABORTED", ")", ");", "sctp_add_cmd_sf", "(", "commands", ",", "SCTP_CMD_ASSOC_FAILED", ",", "SCTP_PERR", "(", "SCTP_ERROR_PROTO_VIOLATION", ")", ");", "SCTP_DEC_STATS", "(", "SCTP_MIB_CURRESTAB", ")", ";", "discard", ":", "sctp_sf_pdiscard", "(", "ep", ",", "asoc", ",", "SCTP_ST_CHUNK", "(", "0", ")", ",", "arg", ",", "commands", ")", ";", "SCTP_INC_STATS", "(", "SCTP_MIB_ABORTEDS", ")", ";", "return", "SCTP_DISPOSITION_ABORT", ";", "nomem", ":", "return", "SCTP_DISPOSITION_NOMEM", ";</s>static", "const", "char", "error", "[", "]", "=", "\"", "The", "following", "parameter", "had", "invalid", "length", ":", "\";", "size_t", "payload_len", "=", "WORD_ROUND", "(", "sizeof", "(", "error", ")", ")", "+", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "*", "errp", "=", "sctp_make_op_error_space", "(", "asoc", ",", "chunk", ",", "payload_len", ")", ";", "if", "(", "*", "errp", ")", "{", "sctp_init_cause", "(", "*", "errp", ",", "SCTP_ERROR_PROTO_VIOLATION", ",", "sizeof", "(", "error", ")", "+", "sizeof", "(", "sctp_paramhdr_t", ")", ");", "sctp_addto_chunk", "(", "*", "errp", ",", "sizeof", "(", "error", ")", ",", "error", ")", ";", "sctp_addto_param", "(", "*", "errp", ",", "sizeof", "(", "sctp_paramhdr_t", ")", ",", "param", ")", ";", "}", "void", "*", "arg", ",", "return", "sctp_sf_violation_paramlen", "(", "ep", ",", "asoc", ",", "type", ",", "return", "sctp_sf_violation_paramlen", "(", "ep", ",", "asoc", ",", "type", ",", "(", "void", "*", ")&", "err_param", ",", "commands", ")", ";", "return", "sctp_sf_violation_paramlen", "(", "ep", ",", "asoc", ",", "type", ",", "(", "void", "*", ")&", "err_param", ",", "commands", ")", ";", "void", "*", "arg", ",", "sctp_cmd_seq_t", "*", "commands", ")", "{", "static", "const", "char", "err_str", "[", "]", "=", "\"", "The", "following", "parameter", "had", "invalid", "length", ":", "\";", "return", "sctp_sf_abort_violation", "(", "ep", ",", "asoc", ",", "arg", ",", "commands", ",", "err_str", ",", "sizeof", "(", "err_str", ")", ");"], "docstring_tokens": ["the", "improper", "handling", "of", "a", "protocol", "violation", "involving", "a", "parameter", "with", "an", "invalid", "length"]}
{"contents": ["Additional", "check", "when", "unpacking", "archives.", "Contributed", "by", "Jason", "Lowe", "and", "Akira", "Ajisaka.", "(cherry", "picked", "from", "commit", "cedc28d4ab2a27ba47e15ab2711218d96ec88d23)"], "code_tokens": ["String", "targetDirPath", "=", "unzipDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "file", "outside", "of", "\"", "+", "unzipDir", ")", ";", "}", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "String", "targetDirPath", "=", "outputDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "entry", "outside", "of", "\"", "+", "outputDir", ")", ";", "}", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "/", "/", "make", "a", "simple", "zip", "/", "/", "successfully", "unzip", "it", "into", "an", "existing", "dir", ":", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip2", "(", ")", "throws", "IOException", "{", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "try", "(", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ")", "{", "/", "/", "Add", "an", "entry", "that", "contains", "invalid", "filename", "ZipEntry", "ze", "=", "new", "ZipEntry", "(", "\".", "./", "foo", "\"", ");", "byte", "[", "]", "data", "=", "\"", "some", "-", "content", "\"", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "ze", ".", "setSize", "(", "data", ".", "length", ")", ";", "tos", ".", "putNextEntry", "(", "ze", ")", ";", "tos", ".", "write", "(", "data", ")", ";", "tos", ".", "closeEntry", "(", ");", "tos", ".", "flush", "(", ");", "tos", ".", "finish", "(", ");", "}", "/", "/", "Unzip", "it", "into", "an", "existing", "dir", "try", "{", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "Assert", ".", "fail", "(", "\"", "unZip", "should", "throw", "IOException", ".", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "GenericTestUtils", ".", "assertExceptionContains", "(", "\"", "would", "create", "file", "outside", "of", "\"", ",", "e", ")", ";", "}", "}</s>File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "/", "/", "make", "sa", "simple", "zip", "/", "/", "make", "a", "simple", "tar", ":", "/", "/", "successfully", "untar", "it", "into", "an", "existing", "dir", ":", "}"], "docstring_tokens": ["leverage", "public", "archives", "in", "the", "distributed", "cache", "Impact", ":", "Vulnerability", "allows", "a", "cluster", "user", "to", "publish", "a", "public", "archive"]}
{"contents": ["futex:", "Fix", "errors", "in", "nested", "key", "ref-counting", "futex_wait()", "is", "leaking", "key", "references", "due", "to", "futex_wait_setup()", "acquiring", "an", "additional", "reference", "via", "the", "queue_lock()", "routine.", "The", "nested", "key", "ref-counting", "has", "been", "masking", "bugs", "and", "complicating", "code", "analysis.", "queue_lock()", "is", "only", "called", "with", "a", "previously", "ref-counted", "key,", "so", "remove", "the", "additional", "ref-counting", "from", "the", "queue_(un)lock()", "functions.", "Also", "futex_wait_requeue_pi()", "drops", "one", "key", "reference", "too", "many", "in", "unqueue_me_pi().", "Remove", "the", "key", "reference", "handling", "from", "unqueue_me_pi().", "This", "was", "paired", "with", "a", "queue_lock()", "in", "futex_lock_pi(),", "so", "the", "count", "remains", "unchanged.", "Document", "remaining", "nested", "key", "ref-counting", "sites.", "Signed-off-by:", "Darren", "Hart", "<dvhart@linux.intel.com>", "Reported-and-tested-by:", "Matthieu", "Fertr\u00e9<matthieu.fertre@kerlabs.com>", "Reported-by:", "Louis", "Rilling<louis.rilling@kerlabs.com>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Cc:", "John", "Kacur", "<jkacur@redhat.com>", "Cc:", "Rusty", "Russell", "<rusty@rustcorp.com.au>", "LKML-Reference:", "<4CBB17A8.70401@linux.intel.com>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "stable@kernel.org"], "code_tokens": ["/", "*", "*", "Prepare", "to", "wait", "on", "uaddr", ".", "On", "success", ",", "holds", "hb", "lock", "and", "increments", "*", "q", ".", "key", "refs", ".", "*", "/", "/", "*", "unqueue_me", "(", ")", "drops", "q", ".", "key", "ref", "*", "/", "goto", "out", ";", "goto", "out", ";", "if", "(", "!", "signal_pending", "(", "current", ")", ")", "goto", "out", ";", "/", "*", "*", "Prepare", "to", "wait", "on", "uaddr", ".", "On", "success", ",", "increments", "q", ".", "key", "(", "key1", ")", "ref", "*", "count", ".", "*", "/", "*", "race", "with", "the", "atomic", "proxy", "lock", "acquisition", "by", "the", "requeue", "code", ".", "The", "*", "futex_requeue", "dropped", "our", "key1", "reference", "and", "incremented", "our", "key2", "*", "reference", "count", ".</s>get_futex_key_refs", "(", "&", "q", "-", ">", "key", ")", ";", "drop_futex_key_refs", "(", "&", "q", "-", ">", "key", ")", ";", "drop_futex_key_refs", "(", "&", "q", "-", ">", "key", ")", ";", "/", "*", "Prepare", "to", "wait", "on", "uaddr", ".", "*", "/", "goto", "out_put_key", ";", "goto", "out_put_key", ";", "if", "(", "!", "signal_pending", "(", "current", ")", ")", "{", "put_futex_key", "(", "fshared", ",", "&", "q", ".", "key", ")", ";", "}", "goto", "out_put_key", ";", "out_put_key", ":", "put_futex_key", "(", "fshared", ",", "&", "q", ".", "key", ")", ";", "/", "*", "Prepare", "to", "wait", "on", "uaddr", ".", "*", "/", "*", "race", "with", "the", "atomic", "proxy", "lock", "acquition", "by", "the", "requeue", "code", "."], "docstring_tokens": ["does", "not", "properly", "maintain", "a", "certain", "reference", "count", "during", "requeue", "operations"]}
{"contents": ["[SECURITY-166]", "Prevent", "the", "creation", "of", "anonymous,", "system", "or", "unknown", "users.", "These", "users", "can", "still", "be", "instantiated,", "as", "would", "happen", "if", "there", "is", "no", "security", "and", "an", "anonymous", "user", "triggers", "a", "build", "--", "the", "anonymous", "user", "would", "correctly", "be", "created", "and", "added", "to", "the", "User", "list.", "This", "fix", "merely", "prevents", "the", "saving", "of", "that", "user,", "and", "therefore", "prevents", "them", "from", "logging", "in.", "There", "may", "be", "some", "plugins", "which", "trigger", "a", "build", "as", "the", "SYSTEM", "user,", "and", "that", "is", "not", "prohibited", "here.", "Also", "prevent", "full", "names", "of", "'anonymous',", "'system'", "or", "'uknown'.", "As", "discussed", "on", "SECURITY-166", "this", "may", "encumber", "auditing", "since", "full", "names", "are", "used", "in", "most", "places", "in", "the", "UI"], "code_tokens": ["import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "/", "**", "*", "These", "usernames", "should", "not", "be", "used", "by", "real", "users", "logging", "into", "Jenkins", ".", "Therefore", ",", "we", "prevent", "*", "users", "with", "these", "names", "from", "being", "saved", ".", "*", "/", "public", "static", "final", "String", "[", "]", "ILLEGAL_PERSISTED_USERNAMES", "=", "new", "String", "[", "]{", "\"", "anonymous", "\"", ",", "\"", "system", "\"", ",", "\"", "unknown", "\"", "};", "/", "**", "*", "Is", "the", "ID", "allowed", "?", "Some", "are", "prohibited", "for", "security", "reasons", ".", "See", "SECURITY", "-", "166", ".", "*", "<", "p", "/", ">", "*", "Note", "that", "this", "is", "only", "enforced", "when", "saving", ".", "These", "users", "are", "often", "created", "*", "via", "the", "constructor", "(", "and", "even", "listed", "on", "/", "asynchPeople", ")", ",", "but", "our", "goal", "is", "to", "*", "prevent", "anyone", "from", "logging", "in", "as", "these", "users", ".", "Therefore", ",", "we", "prevent", "*", "saving", "a", "User", "with", "one", "of", "these", "ids", ".", "*", "*", "@", "return", "true", "if", "the", "username", "or", "fullname", "is", "valid", "*", "/", "/", "/", "TODO", ":", "Remove", "Restricted", "and", "add", "@", "since", "when", "merging", "to", "stable", "-", "rc", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "boolean", "isIdOrFullnameAllowed", "(", "String", "id", ")", "{", "for", "(", "String", "invalidId", ":", "ILLEGAL_PERSISTED_USERNAMES", ")", "{", "if", "(", "id", ".", "equalsIgnoreCase", "(", "invalidId", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "public", "synchronized", "void", "save", "(", ")", "throws", "IOException", ",", "FormValidation", "{", "if", "(", "!", "isIdOrFullnameAllowed", "(", "id", ")", ")", "{", "throw", "FormValidation", ".", "error", "(", "Messages", ".", "User_IllegalUsername", "(", "id", ")", ");", "}", "if", "(", "!", "isIdOrFullnameAllowed", "(", "fullName", ")", ")", "{", "throw", "FormValidation", ".", "error", "(", "Messages", ".", "User_IllegalFullname", "(", "fullName", ")", ");", "}", "if", "(", "!", "User", ".", "isIdOrFullnameAllowed", "(", "si", ".", "username", ")", ")", "{", "si", ".", "errorMessage", "=", "hudson", ".", "model", ".", "Messages", ".", "User_IllegalUsername", "(", "si", ".", "username", ")", ";", "}", "if", "(", "!", "User", ".", "isIdOrFullnameAllowed", "(", "si", ".", "fullname", ")", ")", "{", "si", ".", "errorMessage", "=", "hudson", ".", "model", ".", "Messages", ".", "User_IllegalFullname", "(", "si", ".", "fullname", ")", ";", "}", "User", ".", "IllegalUsername", "=", "\"{", "0", "}", "\"", "is", "prohibited", "as", "a", "username", "for", "security", "reasons", ".", "User", ".", "IllegalFullname", "=", "\"{", "0", "}", "\"", "is", "prohibited", "as", "a", "full", "name", "for", "security", "reasons", ".", "package", "hudson", ".", "security", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "security", ".", "pages", ".", "SignupPage", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "Tests", "the", "signup", "page", "of", "{", "@", "link", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "}", "*", "TODO", ":", "Add", "to", "{", "@", "link", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealmTest", "}", "going", "forward", "*", "/", "public", "class", "HudsonPrivateSecurityRealm2Test", "{", "@", "Rule", "public", "JenkinsRule", "rule", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "public", "void", "signup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "alice", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "alice", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "Alice", "User", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "alice", "@", "nowhere", ".", "com", "\"", ");", "HtmlPage", "success", "=", "signup", ".", "submit", "(", "rule", ")", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "\"", "Success", "\"", "))", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "login", "-", "field", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "\"", "Alice", "User", "\"", "))", ";", "assertEquals", "(", "\"", "Alice", "User", "\"", ",", "securityRealm", ".", "getUser", "(", "\"", "alice", "\"", ").", "getDisplayName", "(", "))", ";", "}", "/", "/", "@", "Issue", "(", "\"", "SECURITY", "-", "166", "\"", ")", "@", "Test", "public", "void", "anonymousCantSignup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "anonymous", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "Bob", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "nothing", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "noone", "@", "nowhere", ".", "com", "\"", ");", "signup", "=", "new", "SignupPage", "(", "signup", ".", "submit", "(", "rule", ")", ");", "signup", ".", "assertErrorContains", "(", "\"", "prohibited", "as", "a", "username", "\"", ");", "assertNull", "(", "User", ".", "get", "(", "\"", "anonymous", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ");", "}", "/", "/", "@", "Issue", "(", "\"", "SECURITY", "-", "166", "\"", ")", "@", "Test", "public", "void", "systemCantSignup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "system", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "Bob", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "nothing", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "noone", "@", "nowhere", ".", "com", "\"", ");", "signup", "=", "new", "SignupPage", "(", "signup", ".", "submit", "(", "rule", ")", ");", "signup", ".", "assertErrorContains", "(", "\"", "prohibited", "as", "a", "username", "\"", ");", "assertNull", "(", "User", ".", "get", "(", "\"", "system", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ");", "}", "/", "**", "*", "We", "don", "'", "t", "allow", "prohibited", "fullnames", "since", "this", "may", "encumber", "auditing", ".", "*", "/", "/", "/", "@", "Issue", "(", "\"", "SECURITY", "-", "166", "\"", ")", "@", "Test", "public", "void", "fullNameOfUnknownCantSignup", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "rule", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "rule", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "\"", "unknown2", "\"", ");", "signup", ".", "enterPassword", "(", "\"", "unknown2", "\"", ");", "signup", ".", "enterFullName", "(", "\"", "unknown", "\"", ");", "signup", ".", "enterEmail", "(", "\"", "noone", "@", "nowhere", ".", "com", "\"", ");", "signup", "=", "new", "SignupPage", "(", "signup", ".", "submit", "(", "rule", ")", ");", "signup", ".", "assertErrorContains", "(", "\"", "prohibited", "as", "a", "full", "name", "\"", ");", "assertNull", "(", "User", ".", "get", "(", "\"", "unknown2", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "package", "hudson", ".", "security", ".", "pages", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "The", "the", "signup", "page", "for", "{", "@", "link", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "}", "*", "/", "public", "class", "SignupPage", "{", "public", "HtmlForm", "signupForm", ";", "public", "final", "HtmlPage", "signupPage", ";", "public", "SignupPage", "(", "HtmlPage", "signupPage", ")", "{", "this", ".", "signupPage", "=", "signupPage", ";", "assertNotNull", "(", "\"", "The", "sign", "up", "page", "has", "a", "username", "field", ".", "\",", "this", ".", "signupPage", ".", "getElementById", "(", "\"", "username", "\"", "))", ";", "for", "(", "HtmlForm", "signupForm", ":", "this", ".", "signupPage", ".", "getForms", "(", "))", "{", "if", "(", "signupForm", ".", "getInputsByName", "(", "\"", "username", "\"", ").", "size", "(", ")", "=", "=", "0", ")", "continue", ";", "this", ".", "signupForm", "=", "signupForm", ";", "}", "}", "public", "void", "enterUsername", "(", "String", "username", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "username", "\"", ").", "setValueAttribute", "(", "username", ")", ";", "}", "/", "**", "*", "Enters", "the", "password", "in", "password1", "and", "password2", ".", "*", "You", "can", "then", "call", "{", "@", "link", "#", "enterPassword2", "(", "String", ")", "}", "if", "you", "want", "them", "to", "be", "different", ".", "*", "@", "param", "password", "*", "/", "public", "void", "enterPassword", "(", "String", "password", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "password1", "\"", ").", "setValueAttribute", "(", "password", ")", ";", "signupForm", ".", "getInputByName", "(", "\"", "password2", "\"", ").", "setValueAttribute", "(", "password", ")", ";", "}", "public", "void", "enterPassword2", "(", "String", "password2", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "password2", "\"", ").", "setValueAttribute", "(", "password2", ")", ";", "}", "public", "void", "enterFullName", "(", "String", "fullName", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "fullname", "\"", ").", "setValueAttribute", "(", "fullName", ")", ";", "}", "public", "void", "enterEmail", "(", "String", "email", ")", "{", "signupForm", ".", "getInputByName", "(", "\"", "email", "\"", ").", "setValueAttribute", "(", "email", ")", ";", "}", "public", "HtmlPage", "submit", "(", "JenkinsRule", "rule", ")", "throws", "Exception", "{", "return", "rule", ".", "submit", "(", "signupForm", ")", ";", "}", "public", "void", "assertErrorContains", "(", "String", "msg", ")", "{", "assertThat", "(", "signupForm", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "msg", ")", ");", "}", "}</s>public", "synchronized", "void", "save", "(", ")", "throws", "IOException", "{"], "docstring_tokens": ["the", "improper", "restriction", "of", "database", "permissions"]}
{"contents": ["proc:", "fix", "oops", "on", "invalid", "/proc/<pid>/maps", "access", "When", "m_start", "returns", "an", "error,", "the", "seq_file", "logic", "will", "still", "call", "m_stop", "with", "that", "error", "entry,", "so", "we'd", "better", "make", "sure", "that", "we", "check", "it", "before", "using", "it", "as", "a", "vma.", "Introduced", "by", "commit", "ec6fd8a4355c", "(\"report", "errors", "in", "/proc/*/*map*", "sanely\"),", "which", "replaced", "NULL", "with", "various", "ERR_PTR()", "cases.", "(On", "ia64,", "you", "happen", "to", "get", "a", "unaligned", "fault", "instead", "of", "a", "page", "fault,", "since", "the", "address", "used", "is", "generally", "some", "random", "error", "code", "like", "-EPERM)", "Reported-by:", "Anca", "Emanuel", "<anca.emanuel@gmail.com>", "Reported-by:", "Tony", "Luck", "<tony.luck@intel.com>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Cc:", "Am\u00e9rico", "Wang", "<xiyou.wangcong@gmail.com>", "Cc:", "Stephen", "Wilson", "<wilsons@start.ca>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "!", "IS_ERR", "(", "vma", ")", ")", "vma_stop", "(", "priv", ",", "vma", ")", ";</s>vma_stop", "(", "priv", ",", "vma", ")", ";"], "docstring_tokens": ["does", "not", "even", "ask", "you", "for", "the", "password"]}
{"contents": ["[SECURITY-201]", "-", "ParameterizedDependency", "graph", "should", "consult", "with", "BUILD", "permissions"], "code_tokens": ["/", "/", "TODO", ":", "It", "would", "be", "also", "great", "to", "print", "it", "to", "the", "build", "log", ",", "but", "there", "is", "no", "TaskListener", "if", "(", "!", "canTriggerProject", "(", "build", ",", "project", ",", "null", ")", ")", "{", "/", "**", "*", "Checks", "if", "the", "build", "can", "trigger", "a", "project", ".", "*", "@", "param", "build", "Build", ",", "which", "is", "about", "to", "trigger", "the", "project", "*", "@", "param", "job", "Job", "to", "be", "triggered", "*", "@", "param", "taskListener", "Optional", "task", "listener", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "project", "can", "be", "scheduled", ".", "*", "{", "@", "code", "false", "}", "if", "there", "is", "a", "lack", "of", "permissions", ",", "details", "will", "be", "printed", "to", "the", "logs", "then", ".", "*", "/", "/", "*", "package", "*", "/", "static", "boolean", "canTriggerProject", "(", "@", "Nonnull", "AbstractBuild", "<", "?,", "?", ">", "build", ",", "@", "Nonnull", "final", "Job", "job", ",", "@", "CheckForNull", "TaskListener", "taskListener", ")", "{", "if", "(", "!", "job", ".", "hasPermission", "(", "Item", ".", "BUILD", ")", ")", "{", "/", "/", "TODO", ":", "It", "would", "be", "also", "great", "to", "print", "it", "to", "the", "build", "log", ",", "but", "there", "is", "no", "TaskListener", "String", "message", "=", "null", ";", "if", "(", "LOGGER", ".", "isLoggable", "(", "Level", ".", "WARNING", ")", "|", "|", "taskListener", "!", "=", "null", ")", "{", "message", "=", "String", ".", "format", "(", "\"", "Cannot", "schedule", "the", "build", "of", "%", "s", "from", "%", "s", ".", "\"", "+", "\"", "The", "authenticated", "build", "user", "%", "s", "has", "no", "Item", ".", "BUILD", "permission", "\"", ",", "job", ",", "build", ",", "Jenkins", ".", "getAuthentication", "(", "))", ";", "}", "if", "(", "message", "!", "=", "null", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "message", ")", ";", "}", "if", "(", "taskListener", "!", "=", "null", ")", "{", "taskListener", ".", "error", "(", "message", ")", ";", "}", "return", "false", ";", "}", "return", "true", ";", "}", "if", "(", "!", "BuildTriggerConfig", ".", "canTriggerProject", "(", "build", ",", "getDownstreamProject", "(", "),", "listener", ")", ")", "{", "return", "false", ";", "}</s>if", "(", "!", "project", ".", "hasPermission", "(", "Item", ".", "BUILD", ")", ")", "{", "/", "/", "TODO", ":", "It", "would", "be", "also", "great", "to", "print", "it", "to", "the", "build", "log", ",", "but", "there", "is", "no", "TaskListener", "if", "(", "LOGGER", ".", "isLoggable", "(", "Level", ".", "WARNING", ")", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Cannot", "schedule", "the", "build", "of", "{", "0", "}", "from", "{", "1", "}", ".", "\"", "+", "\"", "The", "authenticated", "build", "user", "{", "2", "}", "has", "no", "Item", ".", "BUILD", "permission", "\"", ",", "new", "Object", "[", "]", "{", "project", ",", "build", ",", "Jenkins", ".", "getAuthentication", "(", ")}", ");", "}"], "docstring_tokens": ["improper", "validation", "of", "Item/Build", "permission"]}
{"contents": ["Merge", "pull", "request", "#101", "from", "hintjens/master", "Problem:", "issue", "#1273,", "protocol", "downgrade", "attack"], "code_tokens": ["0MQ", "version", "4", ".", "0", ".", "6", "stable", ",", "released", "on", "2015", "/", "12", "/", "xx", "*", "Fixed", "#", "1273", "-", "V3", "protocol", "handler", "vulnerable", "to", "downgrade", "attacks", ".", "bool", "zmq", ":", ":", "session_base_t", ":", ":", "zap_enabled", "(", ")", "{", "return", "(", "options", ".", "mechanism", "!", "=", "ZMQ_NULL", "|", "|", "(", "options", ".", "mechanism", "=", "=", "ZMQ_NULL", "&", "&", "options", ".", "zap_domain", ".", "length", "(", ")", ">", "0", ")", ")", ";", "}", "bool", "zap_enabled", "(", ");", "if", "(", "session", "-", ">", "zap_enabled", "(", "))", "{", "/", "/", "Reject", "ZMTP", "1", ".", "0", "connections", "if", "ZAP", "is", "enabled", "error", "(", ");", "return", "false", ";", "}", "if", "(", "session", "-", ">", "zap_enabled", "(", "))", "{", "/", "/", "Reject", "ZMTP", "1", ".", "0", "connections", "if", "ZAP", "is", "enabled", "error", "(", ");", "return", "false", ";", "}", "if", "(", "session", "-", ">", "zap_enabled", "(", "))", "{", "/", "/", "Reject", "ZMTP", "1", ".", "0", "connections", "if", "ZAP", "is", "enabled", "error", "(", ");", "return", "false", ";", "}", "#", "if", "defined", "(", "ZMQ_HAVE_WINDOWS", ")", "#", "include", "<", "winsock2", ".", "h", ">", "#", "include", "<", "ws2tcpip", ".", "h", ">", "#", "include", "<", "stdexcept", ">", "#", "define", "close", "closesocket", "#", "else", "#", "include", "<", "sys", "/", "socket", ".", "h", ">", "#", "include", "<", "netinet", "/", "in", ".", "h", ">", "#", "include", "<", "arpa", "/", "inet", ".", "h", ">", "#", "include", "<", "unistd", ".", "h", ">", "#", "endif", "static", "char", "client_public", "[", "41", "]", ";", "static", "char", "client_secret", "[", "41", "]", ";", "static", "char", "server_public", "[", "41", "]", ";", "static", "char", "server_secret", "[", "41", "]", ";", "char", "client_key_text", "[", "41", "]", ";", "char", "bogus_public", "[", "41", "]", ";", "char", "bogus_secret", "[", "41", "]", ";", "/", "/", "Unauthenticated", "messages", "from", "a", "vanilla", "socket", "shouldn", "'", "t", "be", "received", "struct", "sockaddr_in", "ip4addr", ";", "int", "s", ";", "ip4addr", ".", "sin_family", "=", "AF_INET", ";", "ip4addr", ".", "sin_port", "=", "htons", "(", "9998", ")", ";", "inet_pton", "(", "AF_INET", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "&", "ip4addr", ".", "sin_addr", ")", ";", "s", "=", "socket", "(", "AF_INET", ",", "SOCK_STREAM", ",", "IPPROTO_TCP", ")", ";", "rc", "=", "connect", "(", "s", ",", "(", "struct", "sockaddr", "*", ")", "&", "ip4addr", ",", "sizeof", "(", "ip4addr", ")", ");", "assert", "(", "rc", ">", "-", "1", ")", ";", "/", "/", "send", "anonymous", "ZMTP", "/", "1", ".", "0", "greeting", "send", "(", "s", ",", "\"", "\\", "x01", "\\", "x00", "\"", ",", "2", ",", "0", ")", ";", "/", "/", "send", "sneaky", "message", "that", "shouldn", "'", "t", "be", "received", "send", "(", "s", ",", "\"", "\\", "x08", "\\", "x00sneaky", "\\", "0", "\"", ",", "9", ",", "0", ")", ";", "int", "timeout", "=", "150", ";", "zmq_setsockopt", "(", "server", ",", "ZMQ_RCVTIMEO", ",", "&", "timeout", ",", "sizeof", "(", "timeout", ")", ");", "char", "*", "buf", "=", "s_recv", "(", "server", ")", ";", "if", "(", "buf", "!", "=", "NULL", ")", "{", "printf", "(", "\"", "Received", "unauthenticated", "message", ":", "%", "s", "\\", "n", "\"", ",", "buf", ")", ";", "assert", "(", "buf", "=", "=", "NULL", ")", ";", "}", "close", "(", "s", ")", ";", "/", "/", "Check", "return", "codes", "for", "invalid", "buffer", "sizes", "client", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "assert", "(", "client", ")", ";", "errno", "=", "0", ";", "rc", "=", "zmq_setsockopt", "(", "client", ",", "ZMQ_CURVE_SERVERKEY", ",", "server_public", ",", "123", ")", ";", "assert", "(", "rc", "=", "=", "-", "1", "&", "&", "errno", "=", "=", "EINVAL", ")", ";", "errno", "=", "0", ";", "rc", "=", "zmq_setsockopt", "(", "client", ",", "ZMQ_CURVE_PUBLICKEY", ",", "client_public", ",", "123", ")", ";", "assert", "(", "rc", "=", "=", "-", "1", "&", "&", "errno", "=", "=", "EINVAL", ")", ";", "errno", "=", "0", ";", "rc", "=", "zmq_setsockopt", "(", "client", ",", "ZMQ_CURVE_SECRETKEY", ",", "client_secret", ",", "123", ")", ";", "assert", "(", "rc", "=", "=", "-", "1", "&", "&", "errno", "=", "=", "EINVAL", ")", ";", "rc", "=", "zmq_close", "(", "client", ")", ";", "assert", "(", "rc", "=", "=", "0", ")", ";", "Copyright", "(", "c", ")", "2007", "-", "2014", "Contributors", "as", "noted", "in", "the", "AUTHORS", "file", "#", "if", "defined", "(", "ZMQ_HAVE_WINDOWS", ")", "#", "include", "<", "winsock2", ".", "h", ">", "#", "include", "<", "ws2tcpip", ".", "h", ">", "#", "include", "<", "stdexcept", ">", "#", "define", "close", "closesocket", "#", "else", "#", "include", "<", "sys", "/", "socket", ".", "h", ">", "#", "include", "<", "netinet", "/", "in", ".", "h", ">", "#", "include", "<", "arpa", "/", "inet", ".", "h", ">", "#", "include", "<", "unistd", ".", "h", ">", "#", "endif", "close_zero_linger", "(", "handler", ")", ";", "/", "/", "We", "first", "test", "client", "/", "server", "with", "no", "ZAP", "domain", "/", "/", "Libzmq", "does", "not", "call", "our", "ZAP", "handler", ",", "the", "connect", "must", "succeed", "rc", "=", "zmq_connect", "(", "client", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9000", "\"", ");", "close_zero_linger", "(", "client", ")", ";", "close_zero_linger", "(", "server", ")", ";", "server", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "assert", "(", "server", ")", ";", "client", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "assert", "(", "client", ")", ";", "rc", "=", "zmq_setsockopt", "(", "server", ",", "ZMQ_ZAP_DOMAIN", ",", "\"", "WRONG", "\"", ",", "5", ")", ";", "assert", "(", "rc", "=", "=", "0", ")", ";", "rc", "=", "zmq_bind", "(", "server", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9001", "\"", ");", "assert", "(", "rc", "=", "=", "0", ")", ";", "rc", "=", "zmq_connect", "(", "client", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9001", "\"", ");", "assert", "(", "rc", "=", "=", "0", ")", ";", "expect_bounce_fail", "(", "server", ",", "client", ")", ";", "close_zero_linger", "(", "client", ")", ";", "close_zero_linger", "(", "server", ")", ";", "server", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "assert", "(", "server", ")", ";", "client", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "assert", "(", "client", ")", ";", "rc", "=", "zmq_connect", "(", "client", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9002", "\"", ");", "/", "/", "Unauthenticated", "messages", "from", "a", "vanilla", "socket", "shouldn", "'", "t", "be", "received", "server", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "assert", "(", "server", ")", ";", "rc", "=", "zmq_setsockopt", "(", "server", ",", "ZMQ_ZAP_DOMAIN", ",", "\"", "WRONG", "\"", ",", "5", ")", ";", "rc", "=", "zmq_bind", "(", "server", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9003", "\"", ");", "assert", "(", "rc", "=", "=", "0", ")", ";", "struct", "sockaddr_in", "ip4addr", ";", "int", "s", ";", "ip4addr", ".", "sin_family", "=", "AF_INET", ";", "ip4addr", ".", "sin_port", "=", "htons", "(", "9003", ")", ";", "inet_pton", "(", "AF_INET", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "&", "ip4addr", ".", "sin_addr", ")", ";", "s", "=", "socket", "(", "AF_INET", ",", "SOCK_STREAM", ",", "IPPROTO_TCP", ")", ";", "rc", "=", "connect", "(", "s", ",", "(", "struct", "sockaddr", "*", ")", "&", "ip4addr", ",", "sizeof", "ip4addr", ")", ";", "assert", "(", "rc", ">", "-", "1", ")", ";", "/", "/", "send", "anonymous", "ZMTP", "/", "1", ".", "0", "greeting", "send", "(", "s", ",", "\"", "\\", "x01", "\\", "x00", "\"", ",", "2", ",", "0", ")", ";", "/", "/", "send", "sneaky", "message", "that", "shouldn", "'", "t", "be", "received", "send", "(", "s", ",", "\"", "\\", "x08", "\\", "x00sneaky", "\\", "0", "\"", ",", "9", ",", "0", ")", ";", "int", "timeout", "=", "150", ";", "zmq_setsockopt", "(", "server", ",", "ZMQ_RCVTIMEO", ",", "&", "timeout", ",", "sizeof", "(", "timeout", ")", ");", "char", "*", "buf", "=", "s_recv", "(", "server", ")", ";", "if", "(", "buf", "!", "=", "NULL", ")", "{", "printf", "(", "\"", "Received", "unauthenticated", "message", ":", "%", "s", "\\", "n", "\"", ",", "buf", ")", ";", "assert", "(", "buf", "=", "=", "NULL", ")", ";", "}", "close", "(", "s", ")", ";", "close_zero_linger", "(", "server", ")", ";", "/", "/", "Shutdown", "rc", "=", "zmq_ctx_term", "(", "ctx", ")", ";", "assert", "(", "rc", "=", "=", "0", ")", ";", "/", "/", "Wait", "until", "ZAP", "handler", "terminates", "Copyright", "(", "c", ")", "2007", "-", "2014", "Contributors", "as", "noted", "in", "the", "AUTHORS", "file", "#", "if", "defined", "(", "ZMQ_HAVE_WINDOWS", ")", "#", "include", "<", "winsock2", ".", "h", ">", "#", "include", "<", "ws2tcpip", ".", "h", ">", "#", "include", "<", "stdexcept", ">", "#", "define", "close", "closesocket", "#", "else", "#", "include", "<", "sys", "/", "socket", ".", "h", ">", "#", "include", "<", "netinet", "/", "in", ".", "h", ">", "#", "include", "<", "arpa", "/", "inet", ".", "h", ">", "#", "include", "<", "unistd", ".", "h", ">", "#", "endif", "/", "/", "Unauthenticated", "messages", "from", "a", "vanilla", "socket", "shouldn", "'", "t", "be", "received", "struct", "sockaddr_in", "ip4addr", ";", "int", "s", ";", "ip4addr", ".", "sin_family", "=", "AF_INET", ";", "ip4addr", ".", "sin_port", "=", "htons", "(", "9998", ")", ";", "inet_pton", "(", "AF_INET", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "&", "ip4addr", ".", "sin_addr", ")", ";", "s", "=", "socket", "(", "AF_INET", ",", "SOCK_STREAM", ",", "IPPROTO_TCP", ")", ";", "rc", "=", "connect", "(", "s", ",", "(", "struct", "sockaddr", "*", ")", "&", "ip4addr", ",", "sizeof", "(", "ip4addr", ")", ");", "assert", "(", "rc", ">", "-", "1", ")", ";", "/", "/", "send", "anonymous", "ZMTP", "/", "1", ".", "0", "greeting", "send", "(", "s", ",", "\"", "\\", "x01", "\\", "x00", "\"", ",", "2", ",", "0", ")", ";", "/", "/", "send", "sneaky", "message", "that", "shouldn", "'", "t", "be", "received", "send", "(", "s", ",", "\"", "\\", "x08", "\\", "x00sneaky", "\\", "0", "\"", ",", "9", ",", "0", ")", ";", "int", "timeout", "=", "150", ";", "zmq_setsockopt", "(", "server", ",", "ZMQ_RCVTIMEO", ",", "&", "timeout", ",", "sizeof", "(", "timeout", ")", ");", "char", "*", "buf", "=", "s_recv", "(", "server", ")", ";", "if", "(", "buf", "!", "=", "NULL", ")", "{", "printf", "(", "\"", "Received", "unauthenticated", "message", ":", "%", "s", "\\", "n", "\"", ",", "buf", ")", ";", "assert", "(", "buf", "=", "=", "NULL", ")", ";", "}", "close", "(", "s", ")", ";</s>0MQ", "version", "4", ".", "0", ".", "6", "stable", ",", "released", "on", "2015", "/", "xx", "/", "xx", "static", "char", "client_public", "[", "40", "]", ";", "static", "char", "client_secret", "[", "40", "]", ";", "static", "char", "server_public", "[", "40", "]", ";", "static", "char", "server_secret", "[", "40", "]", ";", "char", "client_key_text", "[", "40", "]", ";", "char", "bogus_public", "[", "40", "]", ";", "char", "bogus_secret", "[", "40", "]", ";", "Copyright", "(", "c", ")", "2007", "-", "2013", "Contributors", "as", "noted", "in", "the", "AUTHORS", "file", "zmq_close", "(", "handler", ")", ";", "/", "/", "We", "first", "test", "client", "/", "server", "with", "no", "ZAP", "domain", "/", "/", "Libzmq", "does", "not", "call", "our", "ZAP", "handler", ",", "the", "connect", "must", "succeed", "rc", "=", "zmq_connect", "(", "client", ",", "\"", "tcp", ":", "//", "localhost", ":", "9000", "\"", ");", "zmq_unbind", "(", "server", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9000", "\"", ");", "zmq_disconnect", "(", "client", ",", "\"", "tcp", ":", "//", "localhost", ":", "9000", "\"", ");", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "PH", ":", "the", "following", "causes", "libzmq", "to", "get", "confused", ",", "so", "that", "the", "/", "/", "next", "step", "fails", ".", "To", "reproduce", ",", "uncomment", "this", "block", ".", "Note", "that", "/", "/", "even", "creating", "a", "new", "client", "/", "server", "socket", "pair", ",", "the", "behaviour", "/", "/", "does", "not", "change", ".", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Destroying", "the", "old", "sockets", "and", "creating", "new", "ones", "isn", "'", "t", "needed", ",", "/", "/", "but", "it", "shows", "that", "the", "problem", "isn", "'", "t", "related", "to", "specific", "sockets", ".", "/", "/", "close_zero_linger", "(", "client", ")", ";", "/", "/", "close_zero_linger", "(", "server", ")", ";", "/", "/", "server", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "/", "/", "assert", "(", "server", ")", ";", "/", "/", "client", "=", "zmq_socket", "(", "ctx", ",", "ZMQ_DEALER", ")", ";", "/", "/", "assert", "(", "client", ")", ";", "/", "//", "/", "The", "above", "code", "should", "not", "be", "required", "/", "/", "rc", "=", "zmq_setsockopt", "(", "server", ",", "ZMQ_ZAP_DOMAIN", ",", "\"", "WRONG", "\"", ",", "5", ")", ";", "/", "/", "assert", "(", "rc", "=", "=", "0", ")", ";", "/", "/", "rc", "=", "zmq_bind", "(", "server", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9001", "\"", ");", "/", "/", "assert", "(", "rc", "=", "=", "0", ")", ";", "/", "/", "rc", "=", "zmq_connect", "(", "client", ",", "\"", "tcp", ":", "//", "localhost", ":", "9001", "\"", ");", "/", "/", "assert", "(", "rc", "=", "=", "0", ")", ";", "/", "/", "expect_bounce_fail", "(", "server", ",", "client", ")", ";", "/", "/", "zmq_unbind", "(", "server", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9001", "\"", ");", "/", "/", "zmq_disconnect", "(", "client", ",", "\"", "tcp", ":", "//", "localhost", ":", "9001", "\"", ");", "rc", "=", "zmq_connect", "(", "client", ",", "\"", "tcp", ":", "//", "localhost", ":", "9002", "\"", ");", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "PH", ":", "it", "fails", "here", ";", "though", "the", "ZAP", "reply", "is", "200", "OK", ",", "and", "/", "/", "null_mechanism", ".", "cpp", "correctly", "parses", "that", ",", "the", "connection", "/", "/", "never", "succeeds", "and", "the", "test", "hangs", ".", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "zmq_unbind", "(", "server", ",", "\"", "tcp", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "9002", "\"", ");", "zmq_disconnect", "(", "client", ",", "\"", "tcp", ":", "//", "localhost", ":", "9002", "\"", ");", "/", "/", "Shutdown", "rc", "=", "zmq_ctx_term", "(", "ctx", ")", ";", "/", "/", "Wait", "until", "ZAP", "handler", "terminates", ".", "Copyright", "(", "c", ")", "2007", "-", "2013", "Contributors", "as", "noted", "in", "the", "AUTHORS", "file"], "docstring_tokens": ["the", "acceptance", "of", "malicious", "connections"]}
{"contents": ["Implement", "read", "timeout", "for", "direct", "read", "of", "request", "body", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc8.5.x/trunk@1852713", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["stream", ".", "inputBuffer", ".", "readTimeout", "=", "Timeout", "waiting", "to", "read", "data", "from", "client", "inBuffer", ".", "wait", "(", "handler", ".", "getProtocol", "(", ").", "getStreamReadTimeout", "(", "))", ";", "if", "(", "inBuffer", ".", "position", "(", ")", "=", "=", "0", ")", "{", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "inputBuffer", ".", "readTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "coyoteResponse", ".", "setError", "(", ");", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";", "}", "import", "java", ".", "util", ".", "Map", ";", "protected", "void", "sendParameterPostRequest", "(", "int", "streamId", ",", "byte", "[", "]", "padding", ",", "String", "body", ",", "long", "contentLength", ",", "boolean", "useExpectation", ")", "throws", "IOException", "{", "byte", "[", "]", "headersFrameHeader", "=", "new", "byte", "[", "9", "]", ";", "ByteBuffer", "headersPayload", "=", "ByteBuffer", ".", "allocate", "(", "128", ")", ";", "byte", "[", "]", "dataFrameHeader", "=", "new", "byte", "[", "9", "]", ";", "ByteBuffer", "dataPayload", "=", "ByteBuffer", ".", "allocate", "(", "128", ")", ";", "buildPostRequest", "(", "headersFrameHeader", ",", "headersPayload", ",", "useExpectation", ",", "\"", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", ",", "contentLength", ",", "\"", "/", "parameter", "\"", ",", "dataFrameHeader", ",", "dataPayload", ",", "padding", ",", "null", ",", "null", ",", "streamId", ")", ";", "writeFrame", "(", "headersFrameHeader", ",", "headersPayload", ")", ";", "if", "(", "body", "!", "=", "null", ")", "{", "dataPayload", ".", "put", "(", "body", ".", "getBytes", "(", "StandardCharsets", ".", "ISO_8859_1", ")", ");", "writeFrame", "(", "dataFrameHeader", ",", "dataPayload", ")", ";", "}", "}", "buildPostRequest", "(", "headersFrameHeader", ",", "headersPayload", ",", "useExpectation", ",", "null", ",", "-", "1", ",", "\"", "/", "simple", "\"", ",", "dataFrameHeader", ",", "dataPayload", ",", "padding", ",", "trailersFrameHeader", ",", "trailersPayload", ",", "streamId", ")", ";", "}", "protected", "void", "buildPostRequest", "(", "byte", "[", "]", "headersFrameHeader", ",", "ByteBuffer", "headersPayload", ",", "boolean", "useExpectation", ",", "String", "contentType", ",", "long", "contentLength", ",", "String", "path", ",", "byte", "[", "]", "dataFrameHeader", ",", "ByteBuffer", "dataPayload", ",", "byte", "[", "]", "padding", ",", "byte", "[", "]", "trailersFrameHeader", ",", "ByteBuffer", "trailersPayload", ",", "int", "streamId", ")", "{", "headers", ".", "addValue", "(", "\":", "path", "\"", ").", "setString", "(", "path", ")", ";", "if", "(", "contentType", "!", "=", "null", ")", "{", "headers", ".", "addValue", "(", "\"", "content", "-", "type", "\"", ").", "setString", "(", "contentType", ")", ";", "}", "if", "(", "contentLength", ">", "-", "1", ")", "{", "headers", ".", "addValue", "(", "\"", "content", "-", "length", "\"", ").", "setLong", "(", "contentLength", ")", ";", "}", "Tomcat", ".", "addServlet", "(", "ctxt", ",", "\"", "parameter", "\"", ",", "new", "ParameterServlet", "(", "))", ";", "ctxt", ".", "addServletMappingDecoded", "(", "\"/", "parameter", "\"", ",", "\"", "parameter", "\"", ");", "static", "class", "ParameterServlet", "extends", "HttpServlet", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "Override", "protected", "void", "doPost", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "ServletException", ",", "IOException", "{", "Map", "<", "String", ",", "String", "[", "]>", "params", "=", "req", ".", "getParameterMap", "(", ");", "resp", ".", "setContentType", "(", "\"", "text", "/", "plain", "\"", ");", "resp", ".", "setCharacterEncoding", "(", "\"", "UTF", "-", "8", "\"", ");", "resp", ".", "getWriter", "(", ").", "print", "(", "params", ".", "size", "(", "))", ";", "}", "}", "sendSettings", "(", "0", ",", "false", ",", "new", "SettingValue", "(", "Setting", ".", "INITIAL_WINDOW_SIZE", ".", "getId", "(", "),", "0", ")", ");", "sendSettings", "(", "0", ",", "false", ",", "new", "SettingValue", "(", "Setting", ".", "INITIAL_WINDOW_SIZE", ".", "getId", "(", "),", "0", ")", ");", "/", "*", "*", "Timeout", "with", "app", "reading", "request", "body", "directly", ".", "*", "/", "@", "Test", "public", "void", "testClientPostsNoBody", "(", ")", "throws", "Exception", "{", "sendSimplePostRequest", "(", "3", ",", "null", ",", "false", ")", ";", "/", "/", "Headers", "parser", ".", "readFrame", "(", "false", ")", ";", "output", ".", "clearTrace", "(", ");", "parser", ".", "readFrame", "(", "false", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "3", "-", "RST", "-", "[", "11", "]", "\\", "n", "\"", ",", "output", ".", "getTrace", "(", "))", ";", "}", "/", "*", "*", "Timeout", "with", "app", "processing", "parameters", ".", "*", "/", "@", "Test", "public", "void", "testClientPostsNoParameters", "(", ")", "throws", "Exception", "{", "sendParameterPostRequest", "(", "3", ",", "null", ",", "null", ",", "10", ",", "false", ")", ";", "/", "/", "Headers", "parser", ".", "readFrame", "(", "false", ")", ";", "output", ".", "clearTrace", "(", ");", "parser", ".", "readFrame", "(", "false", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "3", "-", "RST", "-", "[", "11", "]", "\\", "n", "\"", ",", "output", ".", "getTrace", "(", "))", ";", "}</s>inBuffer", ".", "wait", "(", ");", "headers", ".", "addValue", "(", "\":", "path", "\"", ").", "setString", "(", "\"/", "simple", "\"", ");", "sendSettings", "(", "0", ",", "false", ",", "new", "SettingValue", "(", "Setting", ".", "INITIAL_WINDOW_SIZE", ".", "getId", "(", "),", "0", ")", ");"], "docstring_tokens": ["the", "acceptance", "of", "streams", "with", "excessive", "numbers", "of", "SETTINGS", "frames", "and", "the", "permitting", "of", "clients", "to", "keep", "streams", "open", "without", "reading/writing", "request", "data"]}
{"contents": ["Avoid", "latency", "problems", "converting", "decimal", "to", "time.", "Fixes", "https://github.com/FasterXML/jackson-databind/issues/2141"], "code_tokens": ["import", "java", ".", "util", ".", "function", ".", "BiFunction", ";", "/", "/", "for", "general", "case", ",", "/", "**", "*", "@", "Deprecated", "due", "to", "potential", "unbounded", "latency", "on", "some", "JRE", "releases", ".", "*", "/", "/", "**", "*", "Extracts", "the", "seconds", "and", "nanoseconds", "component", "of", "{", "@", "code", "seconds", "}", "as", "{", "@", "code", "long", "}", "and", "{", "@", "code", "int", "}", "*", "values", ",", "passing", "them", "to", "the", "given", "converter", ".", "The", "implementation", "avoids", "latency", "issues", "present", "*", "on", "some", "JRE", "releases", ".", "*", "*", "@", "since", "2", ".", "9", ".", "8", "*", "/", "public", "static", "<", "T", ">", "T", "extractSecondsAndNanos", "(", "BigDecimal", "seconds", ",", "BiFunction", "<", "Long", ",", "Integer", ",", "T", ">", "convert", ")", "{", "/", "/", "Complexity", "is", "here", "to", "workaround", "unbounded", "latency", "in", "some", "BigDecimal", "operations", ".", "/", "/", "https", ":", "//", "github", ".", "com", "/", "FasterXML", "/", "jackson", "-", "databind", "/", "issues", "/", "2141", "long", "secondsOnly", ";", "int", "nanosOnly", ";", "BigDecimal", "nanoseconds", "=", "seconds", ".", "scaleByPowerOfTen", "(", "9", ")", ";", "if", "(", "nanoseconds", ".", "precision", "(", ")", "-", "nanoseconds", ".", "scale", "(", ")", "<", "=", "0", ")", "{", "/", "/", "There", "are", "no", "non", "-", "zero", "digits", "to", "the", "left", "of", "the", "decimal", "point", ".", "/", "/", "This", "protects", "against", "very", "negative", "exponents", ".", "secondsOnly", "=", "nanosOnly", "=", "0", ";", "}", "else", "if", "(", "seconds", ".", "scale", "(", ")", "<", "-", "63", ")", "{", "/", "/", "There", "would", "be", "no", "low", "-", "order", "bits", "once", "we", "chop", "to", "a", "long", ".", "/", "/", "This", "protects", "against", "very", "positive", "exponents", ".", "secondsOnly", "=", "nanosOnly", "=", "0", ";", "}", "else", "{", "/", "/", "Now", "we", "know", "that", "seconds", "has", "reasonable", "scale", ",", "we", "can", "safely", "chop", "it", "apart", ".", "secondsOnly", "=", "seconds", ".", "longValue", "(", ");", "nanosOnly", "=", "nanoseconds", ".", "subtract", "(", "new", "BigDecimal", "(", "secondsOnly", ")", ".", "scaleByPowerOfTen", "(", "9", ")", ").", "intValue", "(", ");", "}", "return", "convert", ".", "apply", "(", "secondsOnly", ",", "nanosOnly", ")", ";", "}", "return", "DecimalUtils", ".", "extractSecondsAndNanos", "(", "value", ",", "Duration", ":", ":", "ofSeconds", ")", ";", "FromDecimalArguments", "args", "=", "DecimalUtils", ".", "extractSecondsAndNanos", "(", "value", ",", "(", "s", ",", "ns", ")", "-", ">", "new", "FromDecimalArguments", "(", "s", ",", "ns", ",", "getZone", "(", "context", ")", "))", ";", "return", "fromNanoseconds", ".", "apply", "(", "args", ")", ";", "private", "void", "checkExtractSecondsAndNanos", "(", "long", "expectedSeconds", ",", "int", "expectedNanos", ",", "BigDecimal", "decimal", ")", "{", "DecimalUtils", ".", "extractSecondsAndNanos", "(", "decimal", ",", "(", "Long", "s", ",", "Integer", "ns", ")", "-", ">", "{", "assertEquals", "(", "\"", "The", "second", "part", "is", "not", "correct", ".", "\",", "expectedSeconds", ",", "s", ".", "longValue", "(", "))", ";", "assertEquals", "(", "\"", "The", "nanosecond", "part", "is", "not", "correct", ".", "\",", "expectedNanos", ",", "ns", ".", "intValue", "(", "))", ";", "return", "null", ";", "}", ");", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos01", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "0", "\"", ");", "checkExtractSecondsAndNanos", "(", "0L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos02", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "15", ".", "000000072", "\"", ");", "checkExtractSecondsAndNanos", "(", "15L", ",", "72", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos03", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "15", ".", "72", "\"", ");", "checkExtractSecondsAndNanos", "(", "15L", ",", "720000000", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos04", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", ".", "192837465", "\"", ");", "checkExtractSecondsAndNanos", "(", "19827342231L", ",", "192837465", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos05", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", "\"", ");", "checkExtractSecondsAndNanos", "(", "19827342231L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "public", "void", "testExtractSecondsAndNanos06", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "19827342231", ".", "999999999", "\"", ");", "checkExtractSecondsAndNanos", "(", "19827342231L", ",", "999999999", ",", "value", ")", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "public", "void", "testExtractSecondsAndNanos07", "(", ")", "{", "BigDecimal", "value", "=", "new", "BigDecimal", "(", "\"", "1e10000000", "\"", ");", "checkExtractSecondsAndNanos", "(", "0L", ",", "0", ",", "value", ")", ";", "}", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")", "@", "Test", "(", "timeout", "=", "100", ")</s>/", "/", "for", "general", "case", ",", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "return", "Duration", ".", "ofSeconds", "(", "seconds", ",", "nanoseconds", ")", ";", "long", "seconds", "=", "value", ".", "longValue", "(", ");", "int", "nanoseconds", "=", "DecimalUtils", ".", "extractNanosecondDecimal", "(", "value", ",", "seconds", ")", ";", "return", "fromNanoseconds", ".", "apply", "(", "new", "FromDecimalArguments", "(", "seconds", ",", "nanoseconds", ",", "getZone", "(", "context", ")", "))", ";", "@", "Test", "@", "Test", "@", "Test", "@", "Test", "@", "Test", "@", "Test", "@", "Test", "@", "Test"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["Escape", "spreadsheet", "formula", "in", "CSV", "export", "git-svn-id:", "https://svn.apache.org/repos/asf/directory/studio/trunk@1721232", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["String", "value", "=", "record", ".", "getDnLine", "(", ").", "getValueAsString", "(", ");", "appendValue", "(", "quoteCharacter", ",", "sb", ",", "value", ")", ";", "appendValue", "(", "quoteCharacter", ",", "sb", ",", "value", ")", ";", "private", "static", "void", "appendValue", "(", "String", "quoteCharacter", ",", "StringBuffer", "sb", ",", "String", "value", ")", "{", "/", "/", "escape", "quote", "character", "value", "=", "value", ".", "replaceAll", "(", "quoteCharacter", ",", "quoteCharacter", "+", "quoteCharacter", ")", ";", "/", "/", "prefix", "values", "starting", "with", "'", "='", "with", "a", "single", "quote", "to", "avoid", "interpretation", "as", "formula", "if", "(", "value", ".", "startsWith", "(", "\"", "=\"", ")", ")", "{", "value", "=", "\"", "'\"", "+", "value", ";", "}", "/", "/", "always", "quote", "sb", ".", "append", "(", "quoteCharacter", ")", ";", "sb", ".", "append", "(", "value", ")", ";", "sb", ".", "append", "(", "quoteCharacter", ")", ";", "}", "import", "org", ".", "apache", ".", "poi", ".", "ss", ".", "usermodel", ".", "Cell", ";", "createStringCell", "(", "headerRow", ",", "cellNum", ")", ".", "setCellValue", "(", "\"", "dn", "\"", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "HSSFCell", "cell", "=", "createStringCell", "(", "row", ",", "0", ")", ";", "HSSFCell", "cell", "=", "createStringCell", "(", "headerRow", ",", "cellNum", ")", ";", "HSSFCell", "cell", "=", "createStringCell", "(", "row", ",", "cellNum", ")", ";", "private", "static", "HSSFCell", "createStringCell", "(", "HSSFRow", "row", ",", "int", "cellNum", ")", "{", "HSSFCell", "cell", "=", "row", ".", "createCell", "(", "cellNum", ")", ";", "cell", ".", "setCellType", "(", "Cell", ".", "CELL_TYPE_STRING", ")", ";", "return", "cell", ";", "}", "/", "**", "*", "Export", "to", "CSV", "and", "checks", "that", "spreadsheet", "formulas", "are", "prefixed", "with", "an", "apostrophe", ".", "*", "/", "@", "Test", "public", "void", "testExportCsvShouldPrefixFormulaWithApostrophe", "(", ")", "throws", "Exception", "{", "URL", "url", "=", "Platform", ".", "getInstanceLocation", "(", ").", "getURL", "(", ");", "final", "String", "file", "=", "url", ".", "getFile", "(", ")", "+", "\"", "ImportExportTest", ".", "csv", "\"", ";", "System", ".", "out", ".", "println", "(", "file", ")", ";", "browserViewBot", ".", "selectEntry", "(", "\"", "DIT", "\"", ",", "\"", "Root", "DSE", "\"", ",", "\"", "ou", "=", "system", "\"", ",", "\"", "ou", "=", "users", "\"", ",", "\"", "cn", "=", "Wolfgang", "K", "\\", "u00f6lbel", "\"", ")", ";", "/", "/", "export", "LDIF", "ExportWizardBot", "wizardBot", "=", "browserViewBot", ".", "openExportCsvWizard", "(", ");", "assertTrue", "(", "wizardBot", ".", "isVisible", "(", ")", ")", ";", "wizardBot", ".", "typeReturningAttributes", "(", "\"", "cn", ",", "description", "\"", ")", ";", "wizardBot", ".", "clickNextButton", "(", ");", "wizardBot", ".", "typeFile", "(", "file", ")", ";", "wizardBot", ".", "clickFinishButton", "(", ");", "wizardBot", ".", "waitTillExportFinished", "(", "file", ",", "80", ")", ";", "/", "/", "is", "actually", "86", "bytes", "List", "<", "String", ">", "lines", "=", "FileUtils", ".", "readLines", "(", "new", "File", "(", "file", ")", ")", ";", "/", "/", "verify", "that", "the", "first", "line", "is", "header", "assertEquals", "(", "\"", "dn", ",", "cn", ",", "description", "\"", ",", "lines", ".", "get", "(", "0", ")", ")", ";", "/", "/", "verify", "that", "the", "second", "line", "is", "actual", "content", "and", "the", "formula", "is", "prefixed", "with", "an", "apostrophe", "assertEquals", "(", "\"", "\\\"", "cn", "=", "Wolfgang", "K", "\\", "u00f6lbel", ",", "ou", "=", "users", ",", "ou", "=", "system", "\\", "\",", "\\\"", "Wolfgang", "K", "\\", "u00f6lbel", "\\", "\",", "\\\"", "'=", "1", "+", "1", "\\", "\"\"", ",", "lines", ".", "get", "(", "1", ")", ")", ";", "}", "public", "ExportWizardBot", "openExportCsvWizard", "(", ")", "{", "ContextMenuHelper", ".", "clickContextMenu", "(", "browserBot", ".", "getTree", "(", "),", "\"", "Export", "\"", ",", "\"", "CSV", "Export", ".", "..", "\"", ")", ";", "return", "new", "ExportWizardBot", "(", "ExportWizardBot", ".", "EXPORT_CSV_TITLE", ")", ";", "}", "public", "static", "final", "String", "EXPORT_CSV_TITLE", "=", "\"", "CSV", "Export", "\"", ";", "public", "void", "typeReturningAttributes", "(", "String", "returningAttributes", ")", "{", "bot", ".", "comboBoxWithLabel", "(", "\"", "Returning", "Attributes", ":", "\"", ")", ".", "setText", "(", "returningAttributes", ")", ";", "}", "description", ":", "=", "1", "+", "1</s>sb", ".", "append", "(", "quoteCharacter", ")", ";", "sb", ".", "append", "(", "record", ".", "getDnLine", "(", ").", "getValueAsString", "(", ")", ")", ";", "sb", ".", "append", "(", "quoteCharacter", ")", ";", "/", "/", "escape", "value", "=", "value", ".", "replaceAll", "(", "quoteCharacter", ",", "quoteCharacter", "+", "quoteCharacter", ")", ";", "/", "/", "always", "quote", "sb", ".", "append", "(", "quoteCharacter", ")", ";", "sb", ".", "append", "(", "value", ")", ";", "sb", ".", "append", "(", "quoteCharacter", ")", ";", "headerRow", ".", "createCell", "(", "cellNum", ")", ".", "setCellValue", "(", "\"", "dn", "\"", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "HSSFCell", "cell", "=", "row", ".", "createCell", "(", "0", ")", ";", "HSSFCell", "cell", "=", "headerRow", ".", "createCell", "(", "cellNum", ")", ";", "HSSFCell", "cell", "=", "row", ".", "createCell", "(", "cellNum", ")", ";"], "docstring_tokens": ["the", "failure", "to", "properly", "escape", "the", "fields"]}
{"contents": ["[PATCH]", "sys_get_thread_area", "does", "not", "clear", "the", "returned", "argument", "sys_get_thread_area", "does", "not", "memset", "to", "0", "its", "struct", "user_desc", "info", "before", "copying", "it", "to", "user", "space...", "since", "sizeof(struct", "user_desc)", "is", "16", "while", "the", "actual", "datas", "which", "are", "filled", "are", "only", "12", "bytes", "+", "9", "bits", "(across", "the", "bitfields),", "there", "is", "a", "(small)", "information", "leak.", "Signed-off-by:", "Paolo", "'Blaisorblade'", "Giarrusso", "<blaisorblade@yahoo.it>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["memset", "(", "&", "info", ",", "0", ",", "sizeof", "(", "info", ")", ");</s>"], "docstring_tokens": ["does", "not", "clear", "a", "data", "structure", "before", "copying", "it", "to", "userspace"]}
{"contents": ["Fix", "#69975:", "PHP", "segfaults", "when", "accessing", "nvarchar(max)", "defined", "columns", "The", "SQL", "Server", "Native", "Client", "11.0", "and", "maybe", "other", "ODBC", "drivers", "report", "NVARCHAR(MAX)", "columns", "as", "SQL_WVARCHAR", "with", "size", "0.", "This", "causes", "too", "small", "a", "buffer", "to", "be", "emalloc'd,", "likely", "causing", "a", "segfault", "in", "the", "following.", "As", "we", "don't", "know", "the", "real", "size", "of", "the", "column", "data,", "we", "treat", "such", "colums", "as", "SQL_WLONGVARCHAR.", "The", "related", "bug", "#67437", "suggests", "that", "some", "drivers", "report", "a", "size", "of", "~4GB.", "It", "is", "not", "certain", "that", "this", "is", "really", "the", "case", "(there", "might", "be", "some", "integer", "overflow", "involved,", "and", "anyway,", "there", "has", "been", "no", "feedback),", "so", "we", "do", "not", "cater", "for", "this", "now.", "However,", "it", "would", "not", "be", "hard", "to", "treat", "all", "sizes", "above", "a", "certain", "threshold", "in", "a", "similar", "way,", "i.e.", "as", "SQL_WLONGVARCHAR."], "code_tokens": ["/", "*", "Workaround", "for", "drivers", "that", "report", "NVARCHAR", "(", "MAX", ")", "columns", "as", "SQL_WVARCHAR", "with", "size", "0", "(", "bug", "#", "69975", ")", "*", "/", "if", "(", "result", "-", ">", "values", "[", "i", "]", ".", "coltype", "=", "=", "SQL_WVARCHAR", "&", "&", "displaysize", "=", "=", "0", ")", "{", "result", "-", ">", "values", "[", "i", "]", ".", "coltype", "=", "SQL_WLONGVARCHAR", ";", "result", "-", ">", "values", "[", "i", "]", ".", "value", "=", "NULL", ";", "break", ";", "}", "-", "-", "TEST", "-", "-", "Bug", "#", "69975", "(", "PHP", "segfaults", "when", "accessing", "nvarchar", "(", "max", ")", "defined", "columns", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "include", "'", "skipif", ".", "inc", "'", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "include", "'", "config", ".", "inc", "'", ";", "$", "conn", "=", "odbc_connect", "(", "$", "dsn", ",", "$", "user", ",", "$", "pass", ")", ";", "@", "odbc_exec", "(", "$", "conn", ",", "'", "CREATE", "DATABASE", "odbcTEST", "'", ");", "odbc_exec", "(", "$", "conn", ",", "'", "CREATE", "TABLE", "FOO", "(", "ID", "INT", ",", "VARCHAR_COL", "NVARCHAR", "(", "MAX", ")", ")'", ");", "odbc_exec", "(", "$", "conn", ",", "\"", "INSERT", "INTO", "FOO", "VALUES", "(", "1", ",", "'", "foo", "'", ")\"", ");", "$", "result", "=", "odbc_exec", "(", "$", "conn", ",", "\"", "SELECT", "VARCHAR_COL", "FROM", "FOO", "\"", ");", "var_dump", "(", "odbc_fetch_array", "(", "$", "result", ")", ");", "echo", "\"", "ready", "\"", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "array", "(", "1", ")", "{", "[", "\"", "VARCHAR_COL", "\"", "]=", ">", "string", "(", "3", ")", "\"", "foo", "\"", "}", "ready", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "include", "'", "config", ".", "inc", "'", ";", "$", "conn", "=", "odbc_connect", "(", "$", "dsn", ",", "$", "user", ",", "$", "pass", ")", ";", "odbc_exec", "(", "$", "conn", ",", "'", "DROP", "TABLE", "FOO", "'", ");", "odbc_exec", "(", "$", "conn", ",", "'", "DROP", "DATABASE", "odbcTEST", "'", ");", "?", "></s>"], "docstring_tokens": ["the", "improper", "handling", "of", "driver", "behavior"]}
{"contents": ["[SECURITY-278]", "prevent", "information", "disclosure"], "code_tokens": ["import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "/", "**", "*", "<", "p", ">", "Retrieve", "an", "array", "with", "the", "directories", "required", "to", "go", "from", "parent", "to", "file", ".", "Like", "in", "a", "network", "where", "you", "can", "*", "trace", "for", "hops", ".", "</", "p", ">", "*", "*", "<", "p", ">", "For", "example", ",", "from", "/", "home", "/", "silb", "/", "archives", "to", "/", "home", "/", "silb", "/", "archives", "/", "images", "/", "1", ".", "png", ",", "the", "method", "will", "return", "an", "array", "*", "with", "images", "and", "1", ".", "png", ".", "</", "p", ">", "*", "@", "param", "file", "target", "file", "*", "@", "param", "parent", "parent", "file", "*", "@", "return", "an", "array", "with", "directories", "to", "go", "from", "{", "@", "code", "parent", "}", "to", "{", "@", "code", "file", "}", ".", "*", "/", "protected", "List", "<", "String", ">", "getRelativeFrom", "(", "FilePath", "file", ",", "FilePath", "parent", ")", "{", "String", "fileRemote", "=", "file", ".", "getRemote", "(", ");", "String", "parentRemote", "=", "parent", ".", "getRemote", "(", ");", "Path", "filePath", "=", "Paths", ".", "get", "(", "fileRemote", ")", ";", "Path", "parentPath", "=", "Paths", ".", "get", "(", "parentRemote", ")", ";", "Path", "relativePath", "=", "parentPath", ".", "relativize", "(", "filePath", ")", ";", "String", "[", "]", "paths", "=", "relativePath", ".", "toString", "(", ").", "split", "(", "\"/", "\")", ";", "List", "<", "String", ">", "list", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "list", ".", "add", "(", "\"/", "\")", ";", "for", "(", "String", "path", ":", "paths", ")", "{", "if", "(", "!", "path", ".", "trim", "(", ").", "equals", "(", "\"\"", "))", "{", "list", ".", "add", "(", "path", ")", ";", "}", "}", "return", "list", ";", "}", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "hudson", ".", "AbortException", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "import", "hudson", ".", "model", ".", "BuildListener", ";", "import", "hudson", ".", "model", ".", "Result", ";", "private", "static", "final", "long", "serialVersionUID", "=", "5537875107916417555L", ";", "File", "artifactsRootDir", "=", "build", ".", "getArtifactsDir", "(", ").", "getAbsoluteFile", "(", ");", "File", "artifactsDir", "=", "new", "File", "(", "artifactsRootDir", ",", "getBaseRootFolder", "(", "))", ";", "/", "/", "abort", "build", "if", "the", "gallery", "is", "using", "a", "file", "outside", "of", "the", "project", "artifacts", "directory", "if", "(", "!", "isChild", "(", "artifactsRootDir", ",", "artifactsDir", ")", ")", "{", "throw", "new", "AbortException", "(", "\"", "Invalid", "base", "root", "folder", ":", "\"", "+", "getBaseRootFolder", "(", "))", ";", "}", "FilePath", "artifactsPath", "=", "new", "FilePath", "(", "artifactsDir", ")", ";", "List", "<", "String", ">", "artifactsRelativeFile", "=", "getRelativeFrom", "(", "path", ",", "artifactsPath", ")", ";", "/", "**", "*", "Verify", "that", "the", "{", "@", "code", "child", "}", "file", "is", "a", "child", "node", "of", "the", "{", "@", "code", "parent", "}", "directory", "tree", ".", "File", "names", "are", "*", "normalised", "before", "the", "comparison", "(", "i", ".", "e", ".", ".", "./", "and", ".", "/", "are", "evaluated", ")", ".", "Uses", "Java", "8", "{", "@", "link", "java", ".", "nio", ".", "file", ".", "Path", "}", "*", "methods", ".", "*", "*", "@", "param", "parent", "parent", "file", "*", "@", "param", "child", "child", "file", "*", "@", "return", "{", "@", "code", "true", "}", "iff", "child", "is", "child", "directory", "of", "parent", "directory", "tree", "*", "/", "private", "boolean", "isChild", "(", "File", "parent", ",", "File", "child", ")", "{", "Path", "parentPath", "=", "Paths", ".", "get", "(", "parent", ".", "getAbsolutePath", "(", "))", ".", "normalize", "(", ").", "toAbsolutePath", "(", ");", "Path", "childPath", "=", "Paths", ".", "get", "(", "child", ".", "getAbsolutePath", "(", "))", ".", "normalize", "(", ").", "toAbsolutePath", "(", ");", "return", "childPath", ".", "startsWith", "(", "parentPath", ")", ";", "}", "public", "Object", "readResolve", "(", ")", "{</s>protected", "List", "<", "String", ">", "getRelativeFrom", "(", "FilePath", "file", ",", "FilePath", "parent", ")", "{", "List", "<", "String", ">", "path", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "FilePath", "temp", "=", "file", ";", "while", "(", "temp", ".", "getParent", "(", ")", "!", "=", "null", "&", "&", "!", "temp", ".", "getParent", "(", ").", "equals", "(", "parent", ")", ")", "{", "path", ".", "add", "(", "0", ",", "temp", ".", "getParent", "(", ").", "getName", "(", "))", ";", "temp", "=", "temp", ".", "getParent", "(", ");", "}", "path", ".", "add", "(", "file", ".", "getName", "(", "))", ";", "return", "path", ";", "}", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "model", ".", "BuildListener", ";", "import", "hudson", ".", "model", ".", "Result", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "private", "static", "final", "long", "serialVersionUID", "=", "5537875107916417554L", ";", "File", "artifactsDir", "=", "build", ".", "getArtifactsDir", "(", ").", "getAbsoluteFile", "(", ");", "FilePath", "artifactsPath", "=", "new", "FilePath", "(", "new", "File", "(", "artifactsDir", ".", "getAbsoluteFile", "(", "),", "getBaseRootFolder", "(", "))", ");", "List", "<", "String", ">", "artifactsRelativeFile", "=", "getRelativeFrom", "(", "path", ",", "artifactsPath", ".", "getParent", "(", "))", ";", "public", "Object", "readResolve", "(", ")", "{"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["binder:", "fix", "proc->files", "use-after-free", "proc->files", "cleanup", "is", "initiated", "by", "binder_vma_close.", "Therefore", "a", "reference", "on", "the", "binder_proc", "is", "not", "enough", "to", "prevent", "the", "files_struct", "from", "being", "released", "while", "the", "binder_proc", "still", "has", "a", "reference.", "This", "can", "lead", "to", "an", "attempt", "to", "dereference", "the", "stale", "pointer", "obtained", "from", "proc->files", "prior", "to", "proc->files", "cleanup.", "This", "has", "been", "seen", "once", "in", "task_get_unused_fd_flags()", "when", "__alloc_fd()", "is", "called", "with", "a", "stale", "\"files\".", "The", "fix", "is", "to", "protect", "proc->files", "with", "a", "mutex", "to", "prevent", "cleanup", "while", "in", "use.", "Signed-off-by:", "Todd", "Kjos", "<tkjos@google.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "4.14", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["*", "(", "protected", "by", "@", "files_lock", ")", "*", "@", "files_lock", "mutex", "to", "protect", "@", "files", "struct", "mutex", "files_lock", ";", "int", "ret", ";", "mutex_lock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "if", "(", "proc", "-", ">", "files", "=", "=", "NULL", ")", "{", "ret", "=", "-", "ESRCH", ";", "goto", "err", ";", "}", "if", "(", "!", "lock_task_sighand", "(", "proc", "-", ">", "tsk", ",", "&", "irqs", ")", ")", "{", "ret", "=", "-", "EMFILE", ";", "goto", "err", ";", "}", "ret", "=", "__alloc_fd", "(", "proc", "-", ">", "files", ",", "0", ",", "rlim_cur", ",", "flags", ")", ";", "err", ":", "mutex_unlock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "return", "ret", ";", "mutex_lock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_unlock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_lock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "if", "(", "proc", "-", ">", "files", "=", "=", "NULL", ")", "{", "retval", "=", "-", "ESRCH", ";", "goto", "err", ";", "}", "err", ":", "mutex_unlock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_lock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_unlock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_init", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_lock", "(", "&", "proc", "-", ">", "files_lock", ")", ";", "mutex_unlock", "(", "&", "proc", "-", ">", "files_lock", ")", ";</s>*", "(", "invariant", "after", "initialized", ")", "struct", "files_struct", "*", "files", "=", "proc", "-", ">", "files", ";", "if", "(", "files", "=", "=", "NULL", ")", "return", "-", "ESRCH", ";", "if", "(", "!", "lock_task_sighand", "(", "proc", "-", ">", "tsk", ",", "&", "irqs", ")", ")", "return", "-", "EMFILE", ";", "return", "__alloc_fd", "(", "files", ",", "0", ",", "rlim_cur", ",", "flags", ")", ";", "if", "(", "proc", "-", ">", "files", "=", "=", "NULL", ")", "return", "-", "ESRCH", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["Merge", "pull", "request", "from", "GHSA-8pc4-gvfw-634p", "Advisory", "fix", "1"], "code_tokens": ["import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringEscapeUtils", ";", "this", ".", "userName", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "userName", ")", ";", "this", ".", "storeCode", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "storeCode", ")", ";", "this", ".", "emailAddress", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "emailAddress", ")", ";", "this", ".", "language", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "language", ")", ";", "this", ".", "gender", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "gender", ")", ";", "this", ".", "firstName", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "firstName", ")", ";", "this", ".", "lastName", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "lastName", ")", ";", "this", ".", "provider", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "provider", ")", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringEscapeUtils", ";", "*", "this", ".", "stateProvince", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "stateProvince", ")", ";", "this", ".", "country", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "country", ")", ";", "this", ".", "company", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "company", ")", ";", "this", ".", "address", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "address", ")", ";", "this", ".", "city", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "city", ")", ";", "this", ".", "zone", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "zone", ")", ";", "this", ".", "phone", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "phone", ")", ";", "this", ".", "firstName", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "firstName", ")", ";", "this", ".", "lastName", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "lastName", ")", ";", "this", ".", "bilstateOther", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "bilstateOther", ")", ";", "this", ".", "latitude", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "latitude", ")", ";", "this", ".", "longitude", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "longitude", ")", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringEscapeUtils", ";", "return", "StringEscapeUtils", ".", "escapeHtml4", "(", "countryCode", ")", ";", "return", "StringEscapeUtils", ".", "escapeHtml4", "(", "zoneCode", ")", ";", "try", "{", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringEscapeUtils", ";", "review", ".", "setDescription", "(", "StringEscapeUtils", ".", "escapeHtml4", "(", "review", ".", "getDescription", "(", "))", ");", "<", "http", "pattern", "=", "\"/", "admin", "/", "**", "\"", "auto", "-", "config", "=", "\"", "true", "\"", "<", "intercept", "-", "url", "pattern", "=", "\"/", "admin", "/", "users", "/", "resetPasswordSecurityQtn", ".", "html", "*", "\"", "access", "=", "\"", "permitAll", "\"", "/", ">", "username", "-", "parameter", "=", "\"", "username", "\"", "password", "-", "parameter", "=", "\"", "password", "\"", "login", "-", "processing", "-", "url", "=", "\"/", "login", "\"", "authentication", "-", "failure", "-", "url", "=", "\"/", "admin", "/", "logon", ".", "html", "?", "login_error", "=", "true", "\"", "<", "logout", "invalidate", "-", "session", "=", "\"", "true", "\"", "logout", "-", "success", "-", "url", "=", "\"/", "admin", "/", "home", ".", "html", "\"", "<", "http", "pattern", "=", "\"/", "shop", "/", "**", "\"", "auto", "-", "config", "=", "\"", "true", "\"", "entry", "-", "point", "-", "ref", "=", "\"", "shopAuthenticationEntryPoint", "\"", "<", "logout", "invalidate", "-", "session", "=", "\"", "false", "\"", "logout", "-", "success", "-", "url", "=", "\"/", "shop", "/", "\"", "<", "headers", ">", "<", "header", "name", "=", "\"", "X", "-", "Content", "-", "Security", "-", "Policy", "\"", "value", "=", "\"", "default", "-", "src", "'", "self", "'", "\"/", ">", "<", "/", "headers", ">", "<", "http", "pattern", "=", "\"/", "services", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "adminAuthenticationManager", "\"", "<", "http", "pattern", "=", "\"/", "api", "/", "v1", "/", "services", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "adminAuthenticationManager", "\"", "<", "http", "pattern", "=", "\"/", "api", "/", "v1", "/", "private", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "jwtAdminAuthenticationManager", "\"", "<", "!-", "-", "<", "http", "pattern", "=", "\"/", "api", "/", "v1", "/", "auth", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", "<", "intercept", "-", "url", "pattern", "=", "\"/", "api", "/", "v1", "/", "auth", "/", "**", "\"", "method", "=", "\"", "OPTIONS", "\"", "access", "=", "\"", "permitAll", "\"", "/>", "<", "!-", "-", "This", "bean", "encrypts", "the", "authorization", "details", "of", "the", "connection", ".", "In", "our", "example", ",", "the", "authorization", "details", "are", "stored", "as", "plain", "text", ".", "DO", "NOT", "USE", "<", "/", "beans", ":", "beans", "></s>this", ".", "userName", "=", "userName", ";", "this", ".", "storeCode", "=", "storeCode", ";", "this", ".", "emailAddress", "=", "emailAddress", ";", "this", ".", "language", "=", "language", ";", "this", ".", "gender", "=", "gender", ";", "this", ".", "firstName", "=", "firstName", ";", "this", ".", "lastName", "=", "lastName", ";", "this", ".", "provider", "=", "provider", ";", "*", "this", ".", "stateProvince", "=", "stateProvince", ";", "this", ".", "country", "=", "country", ";", "this", ".", "company", "=", "company", ";", "this", ".", "address", "=", "address", ";", "this", ".", "city", "=", "city", ";", "this", ".", "zone", "=", "zone", ";", "this", ".", "phone", "=", "phone", ";", "this", ".", "firstName", "=", "firstName", ";", "this", ".", "lastName", "=", "lastName", ";", "this", ".", "bilstateOther", "=", "bilstateOther", ";", "this", ".", "latitude", "=", "latitude", ";", "this", ".", "longitude", "=", "longitude", ";", "return", "countryCode", ";", "return", "zoneCode", ";", "try", "{", "-", "->", "<", "http", "pattern", "=", "\"/", "admin", "/", "**", "\"", "auto", "-", "config", "=", "\"", "true", "\"", "<", "intercept", "-", "url", "pattern", "=", "\"/", "admin", "/", "users", "/", "resetPasswordSecurityQtn", ".", "html", "*", "\"", "access", "=", "\"", "permitAll", "\"", "/", ">", "username", "-", "parameter", "=", "\"", "username", "\"", "password", "-", "parameter", "=", "\"", "password", "\"", "login", "-", "processing", "-", "url", "=", "\"/", "login", "\"", "authentication", "-", "failure", "-", "url", "=", "\"/", "admin", "/", "logon", ".", "html", "?", "login_error", "=", "true", "\"", "<", "logout", "invalidate", "-", "session", "=", "\"", "true", "\"", "logout", "-", "success", "-", "url", "=", "\"/", "admin", "/", "home", ".", "html", "\"", "<", "http", "pattern", "=", "\"/", "shop", "/", "**", "\"", "auto", "-", "config", "=", "\"", "true", "\"", "entry", "-", "point", "-", "ref", "=", "\"", "shopAuthenticationEntryPoint", "\"", "<", "logout", "invalidate", "-", "session", "=", "\"", "false", "\"", "logout", "-", "success", "-", "url", "=", "\"/", "shop", "/", "\"", "<", "csrf", "disabled", "=", "\"", "true", "\"", "/>", "<!", "--", "Spring", "security", "4", "-", "->", "<", "http", "pattern", "=", "\"/", "services", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "adminAuthenticationManager", "\"", "<", "http", "pattern", "=", "\"/", "api", "/", "v1", "/", "services", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "adminAuthenticationManager", "\"", "<", "http", "pattern", "=", "\"/", "api", "/", "v1", "/", "private", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "authentication", "-", "manager", "-", "ref", "=", "\"", "jwtAdminAuthenticationManager", "\"", "<", "!-", "-", "-", "->", "-", "->", "<", "http", "pattern", "=", "\"/", "api", "/", "v1", "/", "auth", "/", "**", "\"", "create", "-", "session", "=", "\"", "stateless", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", "<", "intercept", "-", "url", "pattern", "=", "\"/", "api", "/", "v1", "/", "auth", "/", "**", "\"", "method", "=", "\"", "OPTIONS", "\"", "access", "=", "\"", "permitAll", "\"", "/>", "<", "!-", "-", "This", "bean", "encrypts", "the", "authorization", "details", "of", "the", "connection", ".", "In", "our", "example", ",", "the", "authorization", "details", "are", "stored", "as", "plain", "text", ".", "DO", "NOT", "USE", "<", "/", "beans", ":", "beans", ">"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["tcp:", "Increase", "TCP_MAXSEG", "socket", "option", "minimum.", "As", "noted", "by", "Steve", "Chen,", "since", "commit", "f5fff5dc8a7a3f395b0525c02ba92c95d42b7390", "(\"tcp:", "advertise", "MSS", "requested", "by", "user\")", "we", "can", "end", "up", "with", "a", "situation", "where", "tcp_select_initial_window()", "does", "a", "divide", "by", "a", "zero", "(or", "even", "negative)", "mss", "value.", "The", "problem", "is", "that", "sometimes", "we", "effectively", "subtract", "TCPOLEN_TSTAMP_ALIGNED", "and/or", "TCPOLEN_MD5SIG_ALIGNED", "from", "the", "mss.", "Fix", "this", "by", "increasing", "the", "minimum", "from", "8", "to", "64.", "Reported-by:", "Steve", "Chen", "<schen@mvista.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "val", "<", "64", "|", "|", "val", ">", "MAX_TCP_WINDOW", ")", "{</s>if", "(", "val", "<", "8", "|", "|", "val", ">", "MAX_TCP_WINDOW", ")", "{"], "docstring_tokens": ["does", "not", "properly", "restrict", "TCP_MAXSEG", "(aka", "MSS", ")", "values"]}
{"contents": ["Use", "a", "hostname", "verifier", "that", "does", "hostname", "verification,", "backport", "#510,", "close", "#197"], "code_tokens": ["import", "com", ".", "ning", ".", "http", ".", "util", ".", "DefaultHostnameVerifier", ";", "return", "new", "DefaultHostnameVerifier", "(", ");", "/", "*", "*", "To", "the", "extent", "possible", "under", "law", ",", "Kevin", "Locke", "has", "waived", "all", "copyright", "and", "*", "related", "or", "neighboring", "rights", "to", "this", "work", ".", "*", "<", "p", "/", ">", "*", "A", "legal", "description", "of", "this", "waiver", "is", "available", "in", "<", "a", "href", "=", "\"", "https", ":", "//", "gist", ".", "github", ".", "com", "/", "kevinoid", "/", "3829665", "\"", ">", "LICENSE", ".", "txt", "<", "/", "a", ">", "*", "/", "package", "com", ".", "ning", ".", "http", ".", "util", ";", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLPeerUnverifiedException", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLSession", ";", "import", "javax", ".", "security", ".", "auth", ".", "kerberos", ".", "KerberosPrincipal", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "Certificate", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "/", "**", "*", "Uses", "the", "internal", "HostnameChecker", "to", "verify", "the", "server", "'", "s", "hostname", "matches", "with", "the", "*", "certificate", ".", "This", "is", "a", "requirement", "for", "HTTPS", ",", "but", "the", "raw", "SSLEngine", "does", "not", "have", "*", "this", "functionality", ".", "As", "such", ",", "it", "has", "to", "be", "added", "in", "manually", ".", "For", "a", "more", "complete", "*", "description", "of", "hostname", "verification", "and", "why", "it", "'", "s", "important", ",", "*", "please", "read", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "tersesystems", ".", "com", "/", "2014", "/", "03", "/", "23", "/", "fixing", "-", "hostname", "-", "verification", "/", "\">", "Fixing", "*", "Hostname", "Verification", "<", "/", "a", ">", ".", "*", "<", "p", "/", ">", "*", "This", "code", "is", "based", "on", "Kevin", "Locke", "'", "s", "<", "a", "href", "=", "\"", "http", ":", "//", "kevinlocke", ".", "name", "/", "bits", "/", "2012", "/", "10", "/", "03", "/", "ssl", "-", "certificate", "-", "verification", "-", "in", "-", "dispatch", "-", "and", "-", "asynchttpclient", "/", "\">", "guide", "<", "/", "a", ">", ".", "*", "<", "p", "/", ">", "*", "/", "public", "class", "DefaultHostnameVerifier", "implements", "HostnameVerifier", "{", "private", "HostnameChecker", "checker", ";", "private", "HostnameVerifier", "extraHostnameVerifier", ";", "/", "/", "Logger", "to", "log", "exceptions", ".", "private", "static", "final", "Logger", "log", "=", "Logger", ".", "getLogger", "(", "DefaultHostnameVerifier", ".", "class", ".", "getName", "(", "))", ";", "/", "**", "*", "A", "hostname", "verifier", "that", "uses", "the", "{", "{", "sun", ".", "security", ".", "util", ".", "HostnameChecker", "}", "}", "under", "the", "hood", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", ")", "{", "this", ".", "checker", "=", "new", "ProxyHostnameChecker", "(", ");", "}", "/", "**", "*", "A", "hostname", "verifier", "that", "takes", "an", "external", "hostname", "checker", ".", "Useful", "for", "testing", ".", "*", "*", "@", "param", "checker", "a", "hostnamechecker", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameChecker", "checker", ")", "{", "this", ".", "checker", "=", "checker", ";", "}", "/", "**", "*", "A", "hostname", "verifier", "that", "falls", "back", "to", "another", "hostname", "verifier", "if", "not", "found", ".", "*", "*", "@", "param", "extraHostnameVerifier", "another", "hostname", "verifier", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameVerifier", "extraHostnameVerifier", ")", "{", "this", ".", "checker", "=", "new", "ProxyHostnameChecker", "(", ");", "this", ".", "extraHostnameVerifier", "=", "extraHostnameVerifier", ";", "}", "/", "**", "*", "A", "hostname", "verifier", "with", "a", "hostname", "checker", ",", "that", "falls", "back", "to", "another", "hostname", "verifier", "if", "not", "found", ".", "*", "*", "@", "param", "checker", "a", "custom", "HostnameChecker", ".", "*", "@", "param", "extraHostnameVerifier", "another", "hostname", "verifier", ".", "*", "/", "public", "DefaultHostnameVerifier", "(", "HostnameChecker", "checker", ",", "HostnameVerifier", "extraHostnameVerifier", ")", "{", "this", ".", "checker", "=", "checker", ";", "this", ".", "extraHostnameVerifier", "=", "extraHostnameVerifier", ";", "}", "/", "**", "*", "Matches", "the", "hostname", "against", "the", "peer", "certificate", "in", "the", "session", ".", "*", "*", "@", "param", "hostname", "the", "IP", "address", "or", "hostname", "of", "the", "expected", "server", ".", "*", "@", "param", "session", "the", "SSL", "session", "containing", "the", "certificates", "with", "the", "ACTUAL", "hostname", "/", "ipaddress", ".", "*", "@", "return", "true", "if", "the", "hostname", "matches", ",", "false", "otherwise", ".", "*", "/", "private", "boolean", "hostnameMatches", "(", "String", "hostname", ",", "SSLSession", "session", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "hostname", "=", "{", "0", "}", ",", "session", "=", "{", "1", "}", "\",", "new", "Object", "[", "]", "{", "hostname", ",", "Base64", ".", "encode", "(", "session", ".", "getId", "(", "))", "}", ");", "try", "{", "final", "Certificate", "[", "]", "peerCertificates", "=", "session", ".", "getPeerCertificates", "(", ");", "if", "(", "peerCertificates", ".", "length", "=", "=", "0", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "No", "peer", "certificates", "\"", ");", "return", "false", ";", "}", "if", "(", "peerCertificates", "[", "0", "]", "instanceof", "X509Certificate", ")", "{", "X509Certificate", "peerCertificate", "=", "(", "X509Certificate", ")", "peerCertificates", "[", "0", "]", ";", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "peerCertificate", "=", "{", "0", "}", "\",", "peerCertificate", ")", ";", "try", "{", "checker", ".", "match", "(", "hostname", ",", "peerCertificate", ")", ";", "/", "/", "Certificate", "matches", "hostname", "if", "no", "exception", "is", "thrown", ".", "return", "true", ";", "}", "catch", "(", "CertificateException", "ex", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Certificate", "does", "not", "match", "hostname", "\"", ",", "ex", ")", ";", "}", "}", "else", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Peer", "does", "not", "have", "any", "certificates", "or", "they", "aren", "'", "t", "X", ".", "509", "\"", ");", "}", "return", "false", ";", "}", "catch", "(", "SSLPeerUnverifiedException", "ex", ")", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Not", "using", "certificates", "for", "peers", ",", "try", "verifying", "the", "principal", "\"", ");", "try", "{", "Principal", "peerPrincipal", "=", "session", ".", "getPeerPrincipal", "(", ");", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "peerPrincipal", "=", "{", "0", "}", "\",", "peerPrincipal", ")", ";", "if", "(", "peerPrincipal", "instanceof", "KerberosPrincipal", ")", "{", "return", "checker", ".", "match", "(", "hostname", ",", "(", "KerberosPrincipal", ")", "peerPrincipal", ")", ";", "}", "else", "{", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Can", "'", "t", "verify", "principal", ",", "not", "Kerberos", "\"", ");", "}", "}", "catch", "(", "SSLPeerUnverifiedException", "ex2", ")", "{", "/", "/", "Can", "'", "t", "verify", "principal", ",", "no", "principal", "log", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Can", "'", "t", "verify", "principal", ",", "no", "principal", "\"", ",", "ex2", ")", ";", "}", "return", "false", ";", "}", "}", "/", "**", "*", "Verifies", "the", "hostname", "against", "the", "peer", "certificates", "in", "a", "session", ".", "Falls", "back", "to", "extraHostnameVerifier", "if", "*", "there", "is", "no", "match", ".", "*", "*", "@", "param", "hostname", "the", "IP", "address", "or", "hostname", "of", "the", "expected", "server", ".", "*", "@", "param", "session", "the", "SSL", "session", "containing", "the", "certificates", "with", "the", "ACTUAL", "hostname", "/", "ipaddress", ".", "*", "@", "return", "true", "if", "the", "hostname", "matches", ",", "false", "otherwise", ".", "*", "/", "public", "boolean", "verify", "(", "String", "hostname", ",", "SSLSession", "session", ")", "{", "if", "(", "hostnameMatches", "(", "hostname", ",", "session", ")", ")", "{", "return", "true", ";", "}", "else", "{", "return", "extraHostnameVerifier", "!", "=", "null", "&", "&", "extraHostnameVerifier", ".", "verify", "(", "hostname", ",", "session", ")", ";", "}", "}", "}", "/", "*", "*", "Copyright", "(", "c", ")", "Will", "Sargent", ".", "All", "rights", "reserved", ".", "*", "*", "This", "program", "is", "licensed", "to", "you", "under", "the", "Apache", "License", "Version", "2", ".", "0", ",", "*", "and", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "Apache", "License", "Version", "2", ".", "0", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "Apache", "License", "Version", "2", ".", "0", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ".", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "Apache", "License", "Version", "2", ".", "0", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "Apache", "License", "Version", "2", ".", "0", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "there", "under", ".", "*", "/", "package", "com", ".", "ning", ".", "http", ".", "util", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "/", "**", "*", "Hostname", "checker", "interface", ".", "*", "/", "public", "interface", "HostnameChecker", "{", "public", "void", "match", "(", "String", "hostname", ",", "X509Certificate", "peerCertificate", ")", "throws", "CertificateException", ";", "public", "boolean", "match", "(", "String", "hostname", ",", "Principal", "principal", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "Will", "Sargent", ".", "All", "rights", "reserved", ".", "*", "*", "This", "program", "is", "licensed", "to", "you", "under", "the", "Apache", "License", "Version", "2", ".", "0", ",", "*", "and", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "Apache", "License", "Version", "2", ".", "0", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "Apache", "License", "Version", "2", ".", "0", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ".", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "Apache", "License", "Version", "2", ".", "0", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "Apache", "License", "Version", "2", ".", "0", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "there", "under", ".", "*", "/", "package", "com", ".", "ning", ".", "http", ".", "util", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "/", "**", "*", "A", "HostnameChecker", "proxy", ".", "*", "/", "public", "class", "ProxyHostnameChecker", "implements", "HostnameChecker", "{", "public", "final", "static", "byte", "TYPE_TLS", "=", "1", ";", "private", "final", "Object", "checker", "=", "getHostnameChecker", "(", ");", "public", "ProxyHostnameChecker", "(", ")", "{", "}", "private", "Object", "getHostnameChecker", "(", ")", "{", "final", "ClassLoader", "classLoader", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "try", "{", "final", "Class", "<", "Object", ">", "hostnameCheckerClass", "=", "(", "Class", "<", "Object", ">", ")", "classLoader", ".", "loadClass", "(", "\"", "sun", ".", "security", ".", "util", ".", "HostnameChecker", "\"", ");", "final", "Method", "instanceMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "getInstance", "\"", ",", "Byte", ".", "TYPE", ")", ";", "return", "instanceMethod", ".", "invoke", "(", "null", ",", "TYPE_TLS", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "public", "void", "match", "(", "String", "hostname", ",", "X509Certificate", "peerCertificate", ")", "throws", "CertificateException", "{", "try", "{", "final", "Class", "<", "?>", "hostnameCheckerClass", "=", "checker", ".", "getClass", "(", ");", "final", "Method", "checkMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "match", "\"", ",", "String", ".", "class", ",", "X509Certificate", ".", "class", ")", ";", "checkMethod", ".", "invoke", "(", "checker", ",", "hostname", ",", "peerCertificate", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "Throwable", "t", "=", "e", ".", "getCause", "(", ");", "if", "(", "t", "instanceof", "CertificateException", ")", "{", "throw", "(", "CertificateException", ")", "t", ";", "}", "else", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "public", "boolean", "match", "(", "String", "hostname", ",", "Principal", "principal", ")", "{", "try", "{", "final", "Class", "<", "?>", "hostnameCheckerClass", "=", "checker", ".", "getClass", "(", ");", "final", "Method", "checkMethod", "=", "hostnameCheckerClass", ".", "getMethod", "(", "\"", "match", "\"", ",", "String", ".", "class", ",", "Principal", ".", "class", ")", ";", "return", "(", "Boolean", ")", "checkMethod", ".", "invoke", "(", "null", ",", "hostname", ",", "principal", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "}</s>import", "com", ".", "ning", ".", "http", ".", "util", ".", "AllowAllHostnameVerifier", ";", "return", "new", "AllowAllHostnameVerifier", "(", ");"], "docstring_tokens": ["an", "unexpected/improper", "decision", "process"]}
{"contents": ["[SECURITY-784]", "Properly", "sanitize", "report", "names"], "code_tokens": ["import", "com", ".", "google", ".", "common", ".", "base", ".", "Charsets", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "binary", ".", "Hex", ";", "/", "**", "*", "Actually", "not", "safe", ",", "this", "allowed", "directory", "traversal", "(", "SECURITY", "-", "784", ")", ".", "*", "@", "return", "*", "/", "private", "String", "getLegacySanitizedName", "(", ")", "{", "public", "String", "getSanitizedName", "(", ")", "{", "return", "sanitizeReportName", "(", "this", ".", "reportName", ")", ";", "}", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "String", "sanitizeReportName", "(", "String", "reportName", ")", "{", "Pattern", "p", "=", "Pattern", ".", "compile", "(", "\"[", "^", "a", "-", "zA", "-", "Z0", "-", "9", "-", "]\"", ");", "Matcher", "m", "=", "p", ".", "matcher", "(", "reportName", ")", ";", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", ");", "while", "(", "m", ".", "find", "(", "))", "{", "String", "match", "=", "m", ".", "group", "(", ");", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "_", "\"", "+", "Hex", ".", "encodeHexString", "(", "match", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", "))", ";", "}", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "sb", ".", "toString", "(", ");", "}", "return", "getProjectArchiveDir", "(", "project", ",", "getSanitizedName", "(", "))", ";", "}", "private", "File", "getProjectArchiveDir", "(", "AbstractItem", "project", ",", "String", "dirName", ")", "{", "return", "new", "File", "(", "new", "File", "(", "project", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "dirName", ")", ";", "return", "getBuildArchiveDir", "(", "run", ",", "getSanitizedName", "(", "))", ";", "}", "private", "File", "getBuildArchiveDir", "(", "Run", "run", ",", "String", "dirName", ")", "{", "return", "new", "File", "(", "new", "File", "(", "run", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "dirName", ")", ";", "return", "dir", "(", ").", "getName", "(", ");", "if", "(", "!", "javadocDir", ".", "exists", "(", "))", "{", "javadocDir", "=", "getBuildArchiveDir", "(", "run", ",", "getLegacySanitizedName", "(", "))", ";", "}", "/", "/", "TODO", "not", "sure", "about", "this", "change", "/", "/", "SECURITY", "-", "784", ":", "prefer", "safe", "over", "legacy", ",", "but", "if", "neither", "exists", ",", "return", "safe", "dir", "File", "projectArchiveDir", "=", "getProjectArchiveDir", "(", "this", ".", "project", ")", ";", "if", "(", "projectArchiveDir", ".", "exists", "(", "))", "{", "return", "projectArchiveDir", ";", "}", "File", "legacyProjectArchiveDir", "=", "getProjectArchiveDir", "(", "this", ".", "project", ",", "getLegacySanitizedName", "(", "))", ";", "if", "(", "legacyProjectArchiveDir", ".", "exists", "(", "))", "{", "return", "legacyProjectArchiveDir", ";", "}", "return", "projectArchiveDir", ";", "/", "/", "SECURITY", "-", "784", ":", "prefer", "safe", "over", "legacy", ",", "but", "if", "neither", "exists", ",", "return", "safe", "dir", "File", "buildArchiveDir", "=", "getBuildArchiveDir", "(", "this", ".", "build", ")", ";", "if", "(", "buildArchiveDir", ".", "exists", "(", "))", "{", "return", "buildArchiveDir", ";", "}", "File", "legacyBuildArchiveDir", "=", "getBuildArchiveDir", "(", "this", ".", "build", ",", "getLegacySanitizedName", "(", "))", ";", "if", "(", "legacyBuildArchiveDir", ".", "exists", "(", "))", "{", "return", "legacyBuildArchiveDir", ";", "}", "return", "buildArchiveDir", ";", "package", "htmlpublisher", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "CreateFileBuilder", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "util", ".", "Date", ";", "public", "class", "Security784Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "LocalData", "@", "Test", "public", "void", "security784upgradeTest", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "job", "=", "j", ".", "jenkins", ".", "getItemByFullName", "(", "\"", "thejob", "\"", ",", "FreeStyleProject", ".", "class", ")", ";", "Assert", ".", "assertTrue", "(", "new", "File", "(", "job", ".", "getRootDir", "(", "),", "\"", "htmlreports", "/", "foo", "!", "!!", "!", "bar", "/", "index", ".", "html", "\"", ").", "exists", "(", "))", ";", "HtmlPublisherTarget", ".", "HTMLAction", "action", "=", "job", ".", "getAction", "(", "HtmlPublisherTarget", ".", "HTMLAction", ".", "class", ")", ";", "Assert", ".", "assertNotNull", "(", "action", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", ",", "action", ".", "getHTMLTarget", "(", ").", "getReportName", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", ",", "action", ".", "getUrlName", "(", "))", ";", "/", "/", "legacy", "JenkinsRule", ".", "WebClient", "client", "=", "j", ".", "createWebClient", "(", ");", "HtmlPage", "page", "=", "client", ".", "getPage", "(", "job", ",", "\"", "foo", "!", "!!", "!", "bar", "/", "index", ".", "html", "\"", ");", "String", "text", "=", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "Assert", ".", "assertEquals", "(", "\"", "Sun", "Mar", "25", "15", ":", "42", ":", "10", "CEST", "2018", "\"", ",", "text", ".", "trim", "(", "))", ";", "job", ".", "getBuildersList", "(", ").", "clear", "(", ");", "String", "newDate", "=", "new", "Date", "(", ").", "toString", "(", ");", "job", ".", "getBuildersList", "(", ").", "add", "(", "new", "CreateFileBuilder", "(", "\"", "index", ".", "html", "\"", ",", "newDate", ")", ");", "job", ".", "save", "(", ");", "j", ".", "buildAndAssertSuccess", "(", "job", ")", ";", "Assert", ".", "assertTrue", "(", "new", "File", "(", "job", ".", "getRootDir", "(", "),", "\"", "htmlreports", "/", "foo_21_21_21_21bar", "/", "index", ".", "html", "\"", ").", "exists", "(", "))", ";", "action", "=", "job", ".", "getAction", "(", "HtmlPublisherTarget", ".", "HTMLAction", ".", "class", ")", ";", "Assert", ".", "assertNotNull", "(", "action", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", ",", "action", ".", "getHTMLTarget", "(", ").", "getReportName", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "foo_21_21_21_21bar", "\"", ",", "action", ".", "getUrlName", "(", "))", ";", "/", "/", "new", "text", "=", "client", ".", "goTo", "(", "\"", "job", "/", "thejob", "/", "foo_21_21_21_21bar", "/", "index", ".", "html", "\"", ").", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "Assert", ".", "assertEquals", "(", "newDate", ",", "text", ".", "trim", "(", "))", ";", "/", "/", "leftovers", "from", "legacy", "naming", "Assert", ".", "assertTrue", "(", "new", "File", "(", "job", ".", "getRootDir", "(", "),", "\"", "htmlreports", "/", "foo", "!", "!!", "!", "bar", "/", "index", ".", "html", "\"", ").", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testReportNameSanitization", "(", ")", "throws", "Exception", "{", "/", "/", "start", "with", "general", "'", "sanity", "'", "requirements", "/", "/", "failed", "in", "previous", "releases", "Assert", ".", "assertNotEquals", "(", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "bar", "\"", "),", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo_bar", "\"", "))", ";", "/", "/", "don", "'", "t", "collapse", "repeated", "chars", "Assert", ".", "assertNotEquals", "(", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "!", "bar", "\"", "),", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", "))", ";", "/", "/", "now", "be", "specific", "-", "-", "we", "escape", "non", "alphanumeric", "UTF", "-", "8", "chars", "to", "their", "hex", "code", "with", "a", "'", "_", "'", "prefix", "Assert", ".", "assertEquals", "(", "\"", "foo_21bar", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "!", "bar", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "foo_20bar", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "bar", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "_20foo_20bar_20", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "bar", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "_e5b79d_e58fa3", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"\u5ddd", "\u53e3\"", "))", ";", "/", "/", "U", "+", "5DDD", "U", "+", "53E3", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "project", ">", "<", "description", ">", "</", "description", ">", "<", "keepDependencies", ">", "false", "<", "/", "keepDependencies", ">", "<", "properties", "/", ">", "<", "scm", "class", "=", "\"", "hudson", ".", "scm", ".", "NullSCM", "\"", "/>", "<", "canRoam", ">", "true", "<", "/", "canRoam", ">", "<", "disabled", ">", "false", "<", "/", "disabled", ">", "<", "blockBuildWhenDownstreamBuilding", ">", "false", "<", "/", "blockBuildWhenDownstreamBuilding", ">", "<", "blockBuildWhenUpstreamBuilding", ">", "false", "<", "/", "blockBuildWhenUpstreamBuilding", ">", "<", "triggers", "/", ">", "<", "concurrentBuild", ">", "false", "<", "/", "concurrentBuild", ">", "<", "builders", ">", "<", "hudson", ".", "tasks", ".", "Shell", ">", "<", "command", ">", "date", "&", "gt", ";", "index", ".", "html", "<", "/", "command", ">", "<", "/", "hudson", ".", "tasks", ".", "Shell", ">", "<", "/", "builders", ">", "<", "publishers", ">", "<", "htmlpublisher", ".", "HtmlPublisher", "plugin", "=", "\"", "htmlpublisher", "@", "1", ".", "14", "\"", ">", "<", "reportTargets", ">", "<", "htmlpublisher", ".", "HtmlPublisherTarget", ">", "<", "reportName", ">", "foo", "!", "!!", "!", "bar", "<", "/", "reportName", ">", "<", "reportDir", ">", "</", "reportDir", ">", "<", "reportFiles", ">", "index", ".", "html", "<", "/", "reportFiles", ">", "<", "alwaysLinkToLastBuild", ">", "false", "<", "/", "alwaysLinkToLastBuild", ">", "<", "reportTitles", ">", "</", "reportTitles", ">", "<", "keepAll", ">", "false", "<", "/", "keepAll", ">", "<", "allowMissing", ">", "false", "<", "/", "allowMissing", ">", "<", "includes", ">", "**", "/*", "</", "includes", ">", "<", "/", "htmlpublisher", ".", "HtmlPublisherTarget", ">", "<", "/", "reportTargets", ">", "<", "/", "htmlpublisher", ".", "HtmlPublisher", ">", "<", "/", "publishers", ">", "<", "buildWrappers", "/", ">", "<", "/", "project", ">", "<", "!", "DOCTYPE", "html", "PUBLIC", "\"", "-/", "/", "W3C", "/", "/", "DTD", "XHTML", "1", ".", "0", "Strict", "/", "/", "EN", "\"", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xhtml1", "/", "DTD", "/", "xhtml1", "-", "strict", ".", "dtd", "\"", ">", "<", "html", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\"", "xml", ":", "lang", "=", "\"", "en", "\"", "lang", "=", "\"", "en", "\"", ">", "<", "head", ">", "<", "meta", "http", "-", "equiv", "=", "\"", "Content", "-", "Type", "\"", "content", "=", "\"", "text", "/", "html", "\"", "/", ">", "<", "!-", "-", "CSS", "Tabs", "is", "licensed", "under", "Creative", "Commons", "Attribution", "3", ".", "0", "-", "http", ":", "//", "creativecommons", ".", "org", "/", "licenses", "/", "by", "/", "3", ".", "0", "/", "-", "->", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "body", "{", "font", ":", "100", "%", "verdana", ",", "arial", ",", "sans", "-", "serif", ";", "background", "-", "color", ":", "#", "fff", ";", "}", "/", "*", "begin", "css", "tabs", "*", "/", "ul", "#", "tabnav", "{", "/", "*", "general", "settings", "*", "/", "text", "-", "align", ":", "left", ";", "/", "*", "set", "to", "left", ",", "right", "or", "center", "*", "/", "margin", ":", "8px", "0", "0", "0", ";", "/", "*", "set", "margins", "as", "desired", "*", "/", "font", ":", "bold", "11px", "verdana", ",", "arial", ",", "sans", "-", "serif", ";", "/", "*", "set", "font", "as", "desired", "*", "/", "border", "-", "bottom", ":", "1px", "solid", "#", "6c6", ";", "/", "*", "set", "border", "COLOR", "as", "desired", "*", "/", "list", "-", "style", "-", "type", ":", "none", ";", "padding", ":", "3px", "10px", "3px", "10px", ";", "/", "*", "THIRD", "number", "must", "change", "with", "respect", "to", "padding", "-", "top", "(", "X", ")", "below", "*", "/", "}", "ul", "#", "tabnav", "li", "{", "/", "*", "do", "not", "change", "*", "/", "display", ":", "inline", ";", "}", "ul", "#", "tabnav", "li", ".", "selected", "{", "/", "*", "settings", "for", "selected", "tab", "*", "/", "border", "-", "bottom", ":", "1px", "solid", "#", "fff", ";", "/", "*", "set", "border", "color", "to", "page", "background", "color", "*", "/", "background", "-", "color", ":", "#", "fff", ";", "/", "*", "set", "background", "color", "to", "match", "above", "border", "color", "*", "/", "}", "ul", "#", "tabnav", "li", "{", "/", "*", "settings", "for", "all", "tab", "links", "*", "/", "padding", ":", "3px", "4px", ";", "/", "*", "set", "padding", "(", "tab", "size", ")", "as", "desired", ";", "FIRST", "number", "must", "change", "with", "respect", "to", "padding", "-", "top", "(", "X", ")", "above", "*", "/", "border", ":", "1px", "solid", "#", "6c6", ";", "/", "*", "set", "border", "COLOR", "as", "desired", ";", "usually", "matches", "border", "color", "specified", "in", "#", "tabnav", "*", "/", "background", "-", "color", ":", "#", "cfc", ";", "/", "*", "set", "unselected", "tab", "background", "color", "as", "desired", "*", "/", "color", ":", "#", "666", ";", "/", "*", "set", "unselected", "tab", "link", "color", "as", "desired", "*", "/", "margin", "-", "right", ":", "0px", ";", "/", "*", "set", "additional", "spacing", "between", "tabs", "as", "desired", "*", "/", "text", "-", "decoration", ":", "none", ";", "border", "-", "bottom", ":", "none", ";", "cursor", ":", "pointer", ";", "}", "ul", "#", "tabnav", "li", ":", "hover", "{", "/", "*", "settings", "for", "hover", "effect", "*", "/", "background", ":", "#", "afa", ";", "/", "*", "set", "desired", "hover", "color", "*", "/", "}", "/", "*", "end", "css", "tabs", "*", "/", "/", "*", "FF", "100", "%", "height", "iframe", "*", "/", "html", ",", "body", ",", "div", ",", "iframe", "{", "margin", ":", "0", ";", "padding", ":", "0", ";", "}", "iframe", "{", "display", ":", "block", ";", "width", ":", "100", "%", ";", "border", ":", "none", ";", "}", "h1", "{", "display", ":", "inline", ";", "float", ":", "left", ";", "font", "-", "size", ":", "small", ";", "margin", ":", "0", ";", "padding", ":", "0", "10px", ";", "}", "h2", "{", "display", ":", "inline", ";", "float", ":", "right", ";", "font", "-", "size", ":", "small", ";", "margin", ":", "0", ";", "padding", ":", "0", "10px", ";", "}", "<", "/", "style", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "function", "updateBody", "(", "tabId", ",", "page", ")", "{", "document", ".", "getElementById", "(", "selectedTab", ")", ".", "setAttribute", "(", "\"", "class", "\"", ",", "\"", "unselected", "\"", ");", "tab", "=", "document", ".", "getElementById", "(", "tabId", ")", "tab", ".", "setAttribute", "(", "\"", "class", "\"", ",", "\"", "selected", "\"", ");", "selectedTab", "=", "tabId", ";", "iframe", "=", "document", ".", "getElementById", "(", "\"", "myframe", "\"", ");", "iframe", ".", "src", "=", "tab", ".", "getAttribute", "(", "\"", "value", "\"", ");", "}", "function", "init", "(", "tabId", ")", "{", "updateBody", "(", "tabId", ")", ";", "updateViewport", "(", ");", "window", ".", "onresize", "=", "updateViewport", ";", "}", "function", "updateViewport", "(", "){", "var", "viewportheight", ";", "/", "/", "the", "more", "standards", "compliant", "browsers", "(", "mozilla", "/", "netscape", "/", "opera", "/", "IE7", ")", "use", "window", ".", "innerWidth", "and", "window", ".", "innerHeight", "if", "(", "typeof", "window", ".", "innerWidth", "!", "=", "'", "undefined", "'", ")", "{", "viewportheight", "=", "window", ".", "innerHeight", "}", "/", "/", "IE6", "in", "standards", "compliant", "mode", "(", "i", ".", "e", ".", "with", "a", "valid", "doctype", "as", "the", "first", "line", "in", "the", "document", ")", "else", "if", "(", "typeof", "document", ".", "documentElement", "!", "=", "'", "undefined", "'", "&", "&", "typeof", "document", ".", "documentElement", ".", "clientWidth", "!", "=", "'", "undefined", "'", "&", "&", "document", ".", "documentElement", ".", "clientWidth", "!", "=", "0", ")", "{", "viewportheight", "=", "document", ".", "documentElement", ".", "clientHeight", "}", "/", "/", "older", "versions", "of", "IE", "else", "{", "viewportheight", "=", "document", ".", "getElementsByTagName", "(", "'", "body", "'", ")[", "0", "]", ".", "clientHeight", "}", "iframe", "=", "document", ".", "getElementById", "(", "\"", "myframe", "\"", ");", "iframe", ".", "style", ".", "height", "=", "(", "viewportheight", "-", "30", ")", "+'", "px", "'", ";", "}", "var", "selectedTab", "=", "\"", "tab1", "\"", "<", "/", "script", ">", "<", "/", "head", ">", "<", "body", "onload", "=", "\"", "init", "(", "'", "tab1", "'", ");", "\">", "<", "h1", ">", "<", "a", "id", "=", "\"", "hudson_link", "\"", "href", "=", "\"#", "\">", "</", "a", ">", "</", "h1", ">", "<", "h2", ">", "<", "a", "id", "=", "\"", "zip_link", "\"", "href", "=", "\"#", "\">", "Zip", "<", "/", "a", ">", "</", "h2", ">", "<", "ul", "id", "=", "\"", "tabnav", "\"", ">", "<", "li", "id", "=", "\"", "tab1", "\"", "class", "=", "\"", "unselected", "\"", "onclick", "=", "\"", "updateBody", "(", "'", "tab1", "'", ");", "\"", "value", "=", "\"", "index", ".", "html", "\"", ">", "index", "<", "/", "li", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "document", ".", "getElementById", "(", "\"", "hudson_link", "\"", ").", "innerHTML", "=", "\"", "Back", "to", "ffff", "\"", ";<", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "document", ".", "getElementById", "(", "\"", "hudson_link", "\"", ").", "onclick", "=", "function", "(", ")", "{", "history", ".", "go", "(", "-", "1", ")", ";", "return", "false", ";", "}", ";<", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "document", ".", "getElementById", "(", "\"", "zip_link", "\"", ").", "href", "=", "\"*", "zip", "*", "/", "foo", "!", "!!", "!", "bar", ".", "zip", "\"", ";<", "/", "script", ">", "<", "/", "ul", ">", "<", "div", ">", "<", "iframe", "id", "=", "\"", "myframe", "\"", "height", "=", "\"", "100", "%", "\"", "width", "=", "\"", "100", "%", "\"", "frameborder", "=", "\"", "0", "\"", "><", "/", "iframe", ">", "<", "/", "div", ">", "<", "/", "body", ">", "<", "/", "html", ">", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "Sun", "Mar", "25", "15", ":", "42", ":", "10", "CEST", "2018", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "2</s>public", "String", "getSanitizedName", "(", ")", "{", "return", "new", "File", "(", "new", "File", "(", "project", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "this", ".", "getSanitizedName", "(", "))", ";", "return", "new", "File", "(", "new", "File", "(", "run", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "this", ".", "getSanitizedName", "(", "))", ";", "return", "actualHtmlPublisherTarget", ".", "getSanitizedName", "(", ");", "return", "getProjectArchiveDir", "(", "this", ".", "project", ")", ";", "return", "getBuildArchiveDir", "(", "this", ".", "build", ")", ";"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["appletalk:", "fix", "atalk_getname()", "leak", "atalk_getname()", "can", "leak", "8", "bytes", "of", "kernel", "memory", "to", "user", "Signed-off-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "&", "sat", ".", "sat_zero", ",", "0", ",", "sizeof", "(", "sat", ".", "sat_zero", ")", ");</s>"], "docstring_tokens": ["does", "not", "initialize", "certain", "data", "structures", "within", "getname", "functions"]}
{"contents": ["Move", "\"exit_robust_list\"", "into", "mm_release()", "We", "don't", "want", "to", "get", "rid", "of", "the", "futexes", "just", "at", "exit()", "time,", "we", "want", "to", "drop", "them", "when", "doing", "an", "execve()", "too,", "since", "that", "gets", "rid", "of", "the", "previous", "VM", "image", "too.", "Doing", "it", "at", "mm_release()", "time", "means", "that", "we", "automatically", "always", "do", "it", "when", "we", "disassociate", "a", "VM", "map", "from", "the", "task.", "Reported-by:", "pageexec@freemail.hu", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Nick", "Piggin", "<npiggin@suse.de>", "Cc:", "Hugh", "Dickins", "<hugh@veritas.com>", "Cc:", "Ingo", "Molnar", "<mingo@elte.hu>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "Brad", "Spengler", "<spender@grsecurity.net>", "Cc:", "Alex", "Efros", "<powerman@powerman.name>", "Cc:", "Peter", "Zijlstra", "<a.p.zijlstra@chello.nl>", "Cc:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "include", "<", "linux", "/", "compat", ".", "h", ">", "/", "*", "Get", "rid", "of", "any", "futexes", "when", "releasing", "the", "mm", "*", "/", "#", "ifdef", "CONFIG_FUTEX", "if", "(", "unlikely", "(", "tsk", "-", ">", "robust_list", ")", ")", "exit_robust_list", "(", "tsk", ")", ";", "#", "ifdef", "CONFIG_COMPAT", "if", "(", "unlikely", "(", "tsk", "-", ">", "compat_robust_list", ")", ")", "compat_exit_robust_list", "(", "tsk", ")", ";", "#", "endif", "#", "endif</s>#", "include", "<", "linux", "/", "compat", ".", "h", ">", "#", "ifdef", "CONFIG_FUTEX", "if", "(", "unlikely", "(", "tsk", "-", ">", "robust_list", ")", ")", "exit_robust_list", "(", "tsk", ")", ";", "#", "ifdef", "CONFIG_COMPAT", "if", "(", "unlikely", "(", "tsk", "-", ">", "compat_robust_list", ")", ")", "compat_exit_robust_list", "(", "tsk", ")", ";", "#", "endif", "#", "endif"], "docstring_tokens": ["does", "not", "properly", "handle", "processes", "that", "make", "exec", "system", "calls"]}
{"contents": ["isofs:", "Fix", "unchecked", "printing", "of", "ER", "records", "We", "didn't", "check", "length", "of", "rock", "ridge", "ER", "records", "before", "printing", "them.", "Thus", "corrupted", "isofs", "image", "can", "cause", "us", "to", "access", "and", "print", "some", "memory", "behind", "the", "buffer", "with", "obvious", "consequences.", "Reported-and-tested-by:", "Carl", "Henrik", "Lunde", "<chlunde@ping.uio.no>", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Jan", "Kara", "<jack@suse.cz>"], "code_tokens": ["/", "*", "Invalid", "length", "of", "ER", "tag", "id", "?", "*", "/", "if", "(", "rr", "-", ">", "u", ".", "ER", ".", "len_id", "+", "offsetof", "(", "struct", "rock_ridge", ",", "u", ".", "ER", ".", "data", ")", ">", "rr", "-", ">", "len", ")", "goto", "out", ";</s>"], "docstring_tokens": ["does", "not", "validate", "a", "length", "value", "in", "the", "Extensions", "Reference", "(ER", ")", "System", "Use", "Field"]}
{"contents": ["bridge:", "fix", "mdb", "info", "leaks", "The", "bridging", "code", "discloses", "heap", "and", "stack", "bytes", "via", "the", "RTM_GETMDB", "netlink", "interface", "and", "via", "the", "notify", "messages", "send", "to", "group", "RTNLGRP_MDB", "afer", "a", "successful", "add/del.", "Fix", "both", "cases", "by", "initializing", "all", "unset", "members/padding", "bytes", "with", "memset(0).", "Cc:", "Stephen", "Hemminger", "<stephen@networkplumber.org>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "&", "e", ",", "0", ",", "sizeof", "(", "e", ")", ");", "memset", "(", "bpm", ",", "0", ",", "sizeof", "(", "*", "bpm", ")", ");", "memset", "(", "bpm", ",", "0", ",", "sizeof", "(", "*", "bpm", ")", ");", "memset", "(", "&", "entry", ",", "0", ",", "sizeof", "(", "entry", ")", ");</s>"], "docstring_tokens": ["does", "not", "initialize", "certain", "structures"]}
{"contents": ["[SECURITY-506]", "Require", "admin", "permission", "to", "validate", "proxy", "config."], "code_tokens": ["Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";</s>"], "docstring_tokens": ["an", "improper", "authorization", "vulnerability"]}
{"contents": ["Fixed", "DoS", "attack", "that", "could", "bring", "the", "server", "down.", "JM-1289", "git-svn-id:", "http://svn.igniterealtime.org/svn/repos/openfire/branches/openfire_3_5_0@10031", "b35dd754-fafc-0310-a699-88a17e54d16e"], "code_tokens": ["<", "li", ">", "[<", "a", "href", "=", "'", "http", ":", "//", "www", ".", "igniterealtime", ".", "org", "/", "issues", "/", "browse", "/", "JM", "-", "1289", "'", ">", "JM", "-", "1289", "<", "/", "a", ">", "]", "-", "<", "font", "color", "=", "\"", "red", "\"", "><", "b", ">", "!<", "/", "b", ">", "</", "font", ">", "Fixed", "DoS", "attack", "that", "could", "bring", "the", "server", "down", ".", "</", "li", ">", "/", "**", "*", "$", "RCSfile", ":", "ConnectionManagerImpl", ".", "java", ",", "v", "$", "*", "$", "Revision", ":", "$", "*", "$", "Date", ":", "$", "*", "*", "Copyright", "(", "C", ")", "2008", "Jive", "Software", ".", "All", "rights", "reserved", ".", "*", "*", "This", "software", "is", "published", "under", "the", "terms", "of", "the", "GNU", "Public", "License", "(", "GPL", ")", ",", "*", "a", "copy", "of", "which", "is", "included", "in", "this", "distribution", ".", "*", "/", "package", "org", ".", "jivesoftware", ".", "openfire", ".", "net", ";", "import", "org", ".", "apache", ".", "mina", ".", "common", ".", "IoFilterAdapter", ";", "import", "org", ".", "apache", ".", "mina", ".", "common", ".", "IoSession", ";", "import", "org", ".", "jivesoftware", ".", "util", ".", "Log", ";", "import", "org", ".", "jivesoftware", ".", "util", ".", "JiveGlobals", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Date", ";", "/", "**", "*", "MINA", "filter", "that", "will", "close", "sessions", "that", "are", "failing", "to", "read", "outgoing", "traffic", "*", "and", "whose", "outgoing", "queue", "is", "around", "5MB", ".", "Use", "the", "system", "property", "<", "tt", ">", "session", ".", "stalled", ".", "cap", "<", "/", "tt", ">", "*", "to", "set", "the", "max", "number", "of", "bytes", "allowed", "in", "the", "outgoing", "queue", "of", "a", "session", "before", "considering", "*", "it", "stalled", ".", "*", "*", "@", "author", "Gaston", "Dombiak", "*", "/", "public", "class", "StalledSessionsFilter", "extends", "IoFilterAdapter", "{", "private", "static", "final", "int", "bytesCap", "=", "JiveGlobals", ".", "getIntProperty", "(", "\"", "session", ".", "stalled", ".", "cap", "\"", ",", "5242880", ")", ";", "public", "void", "filterWrite", "(", "NextFilter", "nextFilter", ",", "IoSession", "session", ",", "WriteRequest", "writeRequest", ")", "throws", "Exception", "{", "/", "/", "Get", "number", "of", "pending", "requests", "int", "pendingBytes", "=", "session", ".", "getScheduledWriteBytes", "(", ");", "if", "(", "pendingBytes", ">", "bytesCap", ")", "{", "/", "/", "Get", "last", "time", "we", "were", "able", "to", "send", "something", "to", "the", "connected", "client", "long", "writeTime", "=", "session", ".", "getLastWriteTime", "(", ");", "int", "pendingRequests", "=", "session", ".", "getScheduledWriteRequests", "(", ");", "Log", ".", "debug", "(", "\"", "About", "to", "kill", "session", "with", "pendingBytes", ":", "\"", "+", "pendingBytes", "+", "\"", "pendingWrites", ":", "\"", "+", "pendingRequests", "+", "\"", "lastWrite", ":", "\"", "+", "new", "Date", "(", "writeTime", ")", "+", "\"", "session", ":", "\"", "+", "session", ")", ";", "/", "/", "Close", "the", "session", "and", "throw", "an", "exception", "session", ".", "close", "(", ");", "throw", "new", "IOException", "(", "\"", "Closing", "session", "that", "seems", "to", "be", "stalled", ".", "Preventing", "OOM", "\"", ");", "}", "/", "/", "Call", "next", "filter", "(", "everything", "is", "fine", ")", "super", ".", "filterWrite", "(", "nextFilter", ",", "session", ",", "writeRequest", ")", ";", "}", "}", "@", "@", "-", "1", ",", "9", "+", "1", ",", "9", "@", "@", "*", "$", "Revision", ":", "$", "*", "$", "Date", ":", "$", "*", "Copyright", "(", "C", ")", "2008", "Jive", "Software", ".", "All", "rights", "reserved", ".", "/", "/", "Kill", "sessions", "whose", "outgoing", "queues", "keep", "growing", "and", "fail", "to", "send", "traffic", "socketAcceptor", ".", "getFilterChain", "(", ").", "addAfter", "(", "\"", "xmpp", "\"", ",", "\"", "outCap", "\"", ",", "new", "StalledSessionsFilter", "(", "))", ";", "/", "/", "Kill", "sessions", "whose", "outgoing", "queues", "keep", "growing", "and", "fail", "to", "send", "traffic", "sslSocketAcceptor", ".", "getFilterChain", "(", ").", "addAfter", "(", "\"", "xmpp", "\"", ",", "\"", "outCap", "\"", ",", "new", "StalledSessionsFilter", "(", "))", ";</s>*", "$", "Revision", ":", "3159", "$", "*", "$", "Date", ":", "2005", "-", "12", "-", "04", "22", ":", "56", ":", "40", "-", "0300", "(", "Sun", ",", "04", "Dec", "2005", ")", "$", "*", "Copyright", "(", "C", ")", "2007", "Jive", "Software", ".", "All", "rights", "reserved", "."], "docstring_tokens": ["without", "reading", "messages"]}
{"contents": ["ALSA:", "seq:", "Fix", "missing", "NULL", "check", "at", "remove_events", "ioctl", "snd_seq_ioctl_remove_events()", "calls", "snd_seq_fifo_clear()", "unconditionally", "even", "if", "there", "is", "no", "FIFO", "assigned,", "and", "this", "leads", "to", "an", "Oops", "due", "to", "NULL", "dereference.", "The", "fix", "is", "just", "to", "add", "a", "proper", "NULL", "check.", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Tested-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["if", "(", "client", "-", ">", "type", "=", "=", "USER_CLIENT", "&", "&", "client", "-", ">", "data", ".", "user", ".", "fifo", ")</s>if", "(", "client", "-", ">", "type", "=", "=", "USER_CLIENT", ")"], "docstring_tokens": ["missing", "NULL", "check"]}
{"contents": ["[PATCH]", "i386", "vDSO:", "use", "install_special_mapping", "This", "patch", "uses", "install_special_mapping", "for", "the", "i386", "vDSO", "setup,", "consolidating", "duplicated", "code.", "Signed-off-by:", "Roland", "McGrath", "<roland@redhat.com>", "Cc:", "Ingo", "Molnar", "<mingo@elte.hu>", "Cc:", "Paul", "Mackerras", "<paulus@samba.org>", "Cc:", "Benjamin", "Herrenschmidt", "<benh@kernel.crashing.org>", "Cc:", "Andi", "Kleen", "<ak@suse.de>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["static", "struct", "page", "*", "syscall_pages", "[", "1", "]", ";", "void", "*", "syscall_page", "=", "(", "void", "*", ")", "get_zeroed_page", "(", "GFP_ATOMIC", ")", ";", "syscall_pages", "[", "0", "]", "=", "virt_to_page", "(", "syscall_page", ")", ";", "*", "MAYWRITE", "to", "allow", "gdb", "to", "COW", "and", "set", "breakpoints", "*", "ret", "=", "install_special_mapping", "(", "mm", ",", "addr", ",", "PAGE_SIZE", ",", "VM_READ", "|", "VM_EXEC", "|", "VM_MAYREAD", "|", "VM_MAYWRITE", "|", "VM_MAYEXEC", "|", "VM_ALWAYSDUMP", ",", "syscall_pages", ")", ";", "if", "(", "ret", ")</s>static", "void", "*", "syscall_page", ";", "syscall_page", "=", "(", "void", "*", ")", "get_zeroed_page", "(", "GFP_ATOMIC", ")", ";", "static", "struct", "page", "*", "syscall_nopage", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "adr", ",", "int", "*", "type", ")", "{", "struct", "page", "*", "p", "=", "virt_to_page", "(", "adr", "-", "vma", "-", ">", "vm_start", "+", "syscall_page", ")", ";", "get_page", "(", "p", ")", ";", "return", "p", ";", "}", "/", "*", "Prevent", "VMA", "merging", "*", "/", "static", "void", "syscall_vma_close", "(", "struct", "vm_area_struct", "*", "vma", ")", "{", "}", "static", "struct", "vm_operations_struct", "syscall_vm_ops", "=", "{", ".", "close", "=", "syscall_vma_close", ",", ".", "nopage", "=", "syscall_nopage", ",", "}", ";", "struct", "vm_area_struct", "*", "vma", ";", "vma", "=", "kmem_cache_zalloc", "(", "vm_area_cachep", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "vma", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "up_fail", ";", "}", "vma", "-", ">", "vm_start", "=", "addr", ";", "vma", "-", ">", "vm_end", "=", "addr", "+", "PAGE_SIZE", ";", "/", "*", "MAYWRITE", "to", "allow", "gdb", "to", "COW", "and", "set", "breakpoints", "*", "/", "vma", "-", ">", "vm_flags", "=", "VM_READ", "|", "VM_EXEC", "|", "VM_MAYREAD", "|", "VM_MAYEXEC", "|", "VM_MAYWRITE", ";", "vma", "-", ">", "vm_flags", "|", "=", "VM_ALWAYSDUMP", ";", "vma", "-", ">", "vm_flags", "|", "=", "mm", "-", ">", "def_flags", ";", "vma", "-", ">", "vm_page_prot", "=", "protection_map", "[", "vma", "-", ">", "vm_flags", "&", "7", "]", ";", "vma", "-", ">", "vm_ops", "=", "&", "syscall_vm_ops", ";", "vma", "-", ">", "vm_mm", "=", "mm", ";", "ret", "=", "insert_vm_struct", "(", "mm", ",", "vma", ")", ";", "if", "(", "unlikely", "(", "ret", ")", ")", "{", "kmem_cache_free", "(", "vm_area_cachep", ",", "vma", ")", ";", "}", "mm", "-", ">", "total_vm", "+", "+;"], "docstring_tokens": ["does", "not", "properly", "check", "boundaries"]}
{"contents": ["Fix", "for", "#981,", "patch", "2"], "code_tokens": ["import", "spark", ".", "utils", ".", "ResourceUtils", ";", "Assert", ".", "isTrue", "(", "isValid", "(", "path", ")", ",", "\"", "Path", "is", "not", "valid", "\"", ");", "private", "static", "boolean", "isValid", "(", "final", "String", "path", ")", "{", "return", "!", "isInvalidPath", "(", "path", ")", ";", "}", "private", "static", "boolean", "isInvalidPath", "(", "String", "path", ")", "{", "if", "(", "path", ".", "contains", "(", "\"", "WEB", "-", "INF", "\"", ")", "|", "|", "path", ".", "contains", "(", "\"", "META", "-", "INF", "\"", "))", "{", "return", "true", ";", "}", "if", "(", "path", ".", "contains", "(", "\":", "/\"", "))", "{", "String", "relativePath", "=", "(", "path", ".", "charAt", "(", "0", ")", "=", "=", "'", "/'", "?", "path", ".", "substring", "(", "1", ")", ":", "path", ")", ";", "if", "(", "ResourceUtils", ".", "isUrl", "(", "relativePath", ")", "|", "|", "relativePath", ".", "startsWith", "(", "\"", "url", ":", "\")", ")", "{", "return", "true", ";", "}", "}", "if", "(", "path", ".", "contains", "(", "\"\"", "))", "{", "path", "=", "StringUtils", ".", "cleanPath", "(", "path", ")", ";", "if", "(", "path", ".", "contains", "(", "\".", "./", "\")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "thisLoader", ".", "equals", "(", "otherLoader", ")", "&", "&", "this", ".", "clazz", ".", "equals", "(", "otherRes", ".", "clazz", ")", ");", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyNoMoreInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "when", "(", "jettyServerFactory", ".", "create", "(", "100", ",", "10", ",", "10000", ")", ").", "thenReturn", "(", "new", "Server", "(", "))", ";", "embeddedServer", ".", "ignite", "(", "\"", "localhost", "\"", ",", "6757", ",", "null", ",", "100", ",", "10", ",", "10000", ")", ";", "verify", "(", "jettyServerFactory", ",", "times", "(", "1", ")", ").", "create", "(", "100", ",", "10", ",", "10000", ")", ";", "embeddedServer", ".", "ignite", "(", "\"", "localhost", "\"", ",", "6758", ",", "null", ",", "0", ",", "0", ",", "0", ")", ";", "when", "(", "jettyServerFactory", ".", "create", "(", "100", ",", "10", ",", "10000", ")", ").", "thenReturn", "(", "new", "Server", "(", "))", ";", "embeddedServer", ".", "ignite", "(", "\"", "localhost", "\"", ",", "6759", ",", "null", ",", "100", ",", "10", ",", "10000", ")", ";", "verify", "(", "jettyServerFactory", ",", "times", "(", "1", ")", ").", "create", "(", "100", ",", "10", ",", "10000", ")", ";", "if", "(", "embeddedServer", "!", "=", "null", ")", "{", "embeddedServer", ".", "extinguish", "(", ");", "}", "import", "static", "spark", ".", "Spark", ".", "staticFiles", ";", "staticFiles", ".", "location", "(", "\"/", "public", "\"", ");</s>Assert", ".", "state", "(", "doesNotContainFileColon", "(", "path", ")", ",", "\"", "Path", "must", "not", "contain", "'", "file", ":", "'\"", ");", "private", "static", "boolean", "doesNotContainFileColon", "(", "String", "path", ")", "{", "return", "!", "path", ".", "contains", "(", "\"", "file", ":", "\")", ";", "thisLoader", ".", "equals", "(", "otherLoader", ")", "&", "&", "this", ".", "clazz", ".", "equals", "(", "otherRes", ".", "clazz", ")", ");", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "*;", "when", "(", "jettyServerFactory", ".", "create", "(", "100", ",", "10", ",", "10000", ")", ").", "thenReturn", "(", "new", "Server", "(", "))", ";", "embeddedServer", ".", "ignite", "(", "\"", "localhost", "\"", ",", "8080", ",", "null", ",", "100", ",", "10", ",", "10000", ")", ";", "verify", "(", "jettyServerFactory", ",", "times", "(", "1", ")", ").", "create", "(", "100", ",", "10", ",", "10000", ")", ";", "embeddedServer", ".", "ignite", "(", "\"", "localhost", "\"", ",", "8080", ",", "null", ",", "0", ",", "0", ",", "0", ")", ";", "when", "(", "jettyServerFactory", ".", "create", "(", "100", ",", "10", ",", "10000", ")", ").", "thenReturn", "(", "new", "Server", "(", "))", ";", "embeddedServer", ".", "ignite", "(", "\"", "localhost", "\"", ",", "8080", ",", "null", ",", "100", ",", "10", ",", "10000", ")", ";", "verify", "(", "jettyServerFactory", ",", "times", "(", "1", ")", ").", "create", "(", "100", ",", "10", ",", "10000", ")", ";", "if", "(", "embeddedServer", "!", "=", "null", ")", "embeddedServer", ".", "extinguish", "(", ");", "import", "static", "spark", ".", "Spark", ".", "staticFileLocation", ";", "staticFileLocation", "(", "\"/", "public", "\"", ");"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["Added", "check", "for", "out", "of", "bounds", "read", "(https://github.com/ImageMagick/ImageMagick/issues/108)."], "code_tokens": ["ssize_t", "cnt", ";", "return", ";", "cnt", "=", "PSDQuantum", "(", "count", ")", ";", "if", "(", "cnt", "<", "0", ")", "return", ";", "if", "(", "(", "id", "=", "=", "0x000003ed", ")", "&", "&", "(", "cnt", "<", "(", "ssize_t", ")", "(", "length", "-", "12", ")", "))", "(", "void", ")", "CopyMagickMemory", "(", "q", ",", "q", "+", "cnt", "+", "12", ",", "length", "-", "(", "cnt", "+", "12", ")", "-(", "q", "-", "datum", ")", ");", "SetStringInfoLength", "(", "bim_profile", ",", "length", "-", "(", "cnt", "+", "12", ")", ");", "static", "MagickBooleanType", "WritePSDImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ",", "ExceptionInfo", "*", "exception", ")</s>break", ";", "if", "(", "(", "id", "=", "=", "0x000003ed", ")", "&", "&", "(", "PSDQuantum", "(", "count", ")", "<", "(", "ssize_t", ")", "(", "length", "-", "12", ")", "))", "(", "void", ")", "CopyMagickMemory", "(", "q", ",", "q", "+", "PSDQuantum", "(", "count", ")", "+", "12", ",", "length", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", "-(", "q", "-", "datum", ")", ");", "SetStringInfoLength", "(", "bim_profile", ",", "length", "-", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", ");", "static", "MagickBooleanType", "WritePSDImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ",", "ExceptionInfo", "*", "exception", ")"], "docstring_tokens": ["not", "releasing", "memory"]}
{"contents": ["Review", "fields", "usable", "for", "search", "and", "orderBy"], "code_tokens": ["\"", "propagationTOs", "\"", ",", "\"", "propagationStatusMap", "\"", ",", "\"", "securityAnswer", "\"", ",", "\"", "token", "\"", ",", "\"", "tokenExpireTime", "\"", "private", "static", "final", "String", "[", "]", "ORDER_BY_NOT_ALLOWED", "=", "{", "\"", "serialVersionUID", "\"", ",", "\"", "password", "\"", ",", "\"", "securityQuestion", "\"", ",", "\"", "securityAnswer", "\"", ",", "\"", "token", "\"", ",", "\"", "tokenExpireTime", "\"", "}", ";", "protected", "List", "<", "OrderByClause", ">", "filterOrderBy", "(", "final", "List", "<", "OrderByClause", ">", "orderBy", ")", "{", "List", "<", "OrderByClause", ">", "result", "=", "new", "ArrayList", "<", "OrderByClause", ">", "()", ";", "for", "(", "OrderByClause", "clause", ":", "orderBy", ")", "{", "if", "(", "!", "ArrayUtils", ".", "contains", "(", "ORDER_BY_NOT_ALLOWED", ",", "clause", ".", "getField", "(", "))", ")", "{", "result", ".", "add", "(", "clause", ")", ";", "}", "}", "return", "result", ";", "}", "private", "OrderBySupport", "parseOrderBy", "(", "final", "SearchSupport", "svs", ",", "final", "List", "<", "OrderByClause", ">", "orderBy", ")", "{", "for", "(", "OrderByClause", "clause", ":", "filterOrderBy", "(", "orderBy", ")", ")", "{", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "RandomStringUtils", ";", "@", "Test", "public", "void", "searchBySecurityAnswer", "(", ")", "{", "String", "securityAnswer", "=", "RandomStringUtils", ".", "randomAlphanumeric", "(", "10", ")", ";", "UserTO", "userTO", "=", "UserTestITCase", ".", "getUniqueSampleTO", "(", "\"", "securityAnswer", "@", "syncope", ".", "apache", ".", "org", "\"", ");", "userTO", ".", "setSecurityQuestion", "(", "1L", ")", ";", "userTO", ".", "setSecurityAnswer", "(", "securityAnswer", ")", ";", "userTO", "=", "createUser", "(", "userTO", ")", ";", "assertNotNull", "(", "userTO", ".", "getSecurityQuestion", "(", "))", ";", "PagedResult", "<", "UserTO", ">", "matchingUsers", "=", "userService", ".", "search", "(", "SyncopeClient", ".", "getUserSearchConditionBuilder", "(", ").", "is", "(", "\"", "securityAnswer", "\"", ").", "equalTo", "(", "securityAnswer", ")", ".", "query", "(", "))", ";", "assertNotNull", "(", "matchingUsers", ")", ";", "assertTrue", "(", "matchingUsers", ".", "getResult", "(", ").", "isEmpty", "(", "))", ";", "}</s>\"", "propagationTOs", "\"", ",", "\"", "propagationStatusMap", "\"", "private", "OrderBySupport", "parseOrderBy", "(", "final", "SearchSupport", "svs", ",", "final", "List", "<", "OrderByClause", ">", "orderByClauses", ")", "{", "for", "(", "OrderByClause", "clause", ":", "orderByClauses", ")", "{"], "docstring_tokens": ["the", "value", "\"ta", "\"", "being", "before", "the", "value", "\"test\""]}
{"contents": ["LPS-97029", "Add", "the", "logic", "to", "check", "for", "whitelisted", "classes", "We", "don't", "need", "to", "check", "for", "whitelisted", "classes", "when:", "-", "The", "requested", "type", "is", "not", "assignable", "to", "the", "target", "type", "-", "The", "type", "matches", "the", "actual", "target", "type", "-", "The", "type", "is", "a", "translation", "from", "a", "model", "interface", "to", "a", "model", "implementation", "in", "other", "cases,", "when", "the", "requested", "type", "is", "a", "subclass", "or", "an", "implementation", "of", "an", "interface", "as", "the", "target", "type,", "the", "class", "needs", "to", "be", "whitelisted."], "code_tokens": ["import", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "util", ".", "ArrayUtil", ";", "import", "com", ".", "liferay", ".", "portal", ".", "kernel", ".", "util", ".", "PropsKeys", ";", "import", "com", ".", "liferay", ".", "portal", ".", "util", ".", "PropsUtil", ";", "import", "java", ".", "util", ".", "Objects", ";", "private", "void", "_checkTypeIsAssignable", "(", "int", "argumentPos", ",", "Class", "<", "?>", "targetClass", ",", "Class", "<", "?>", "parameterType", ")", "{", "if", "(", "Objects", ".", "equals", "(", "targetClass", ",", "parameterType", ")", ")", "{", "return", ";", "}", "String", "parameterTypeName", "=", "parameterType", ".", "getName", "(", ");", "if", "(", "!", "ReflectUtil", ".", "isTypeOf", "(", "parameterType", ",", "targetClass", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "StringBundler", ".", "concat", "(", "\"", "Unmatched", "argument", "type", "\"", ",", "parameterTypeName", ",", "\"", "for", "method", "argument", "\"", ",", "argumentPos", ")", ");", "}", "if", "(", "parameterTypeName", ".", "equals", "(", "_jsonWebServiceNaming", ".", "convertModelClassToImplClassName", "(", "targetClass", ")", "))", "{", "return", ";", "}", "if", "(", "ArrayUtil", ".", "contains", "(", "_JSONWS_WEB_SERVICE_PARAMETER_TYPE_WHITELIST_CLASS_NAMES", ",", "parameterTypeName", ")", ")", "{", "return", ";", "}", "throw", "new", "TypeConversionException", "(", "parameterTypeName", "+", "\"", "is", "not", "allowed", "to", "be", "instantiated", "\"", ");", "}", "Class", "<", "?>", "targetClass", "=", "methodParameters", "[", "i", "]", ".", "getType", "(", ");", "Class", "<", "?>", "parameterType", "=", "targetClass", ";", "_checkTypeIsAssignable", "(", "i", ",", "targetClass", ",", "parameterType", ")", ";", "private", "static", "final", "String", "[", "]", "_JSONWS_WEB_SERVICE_PARAMETER_TYPE_WHITELIST_CLASS_NAMES", "=", "PropsUtil", ".", "getArray", "(", "PropsKeys", ".", "JSONWS_WEB_SERVICE_PARAMETER_TYPE_WHITELIST_CLASS_NAMES", ")", ";</s>Class", "<", "?>", "parameterType", "=", "methodParameters", "[", "i", "]", ".", "getType", "(", ");", "if", "(", "!", "ReflectUtil", ".", "isTypeOf", "(", "parameterType", ",", "methodParameters", "[", "i", "]", ".", "getType", "(", "))", ")", "{", "throw", "new", "IllegalArgumentException", "(", "StringBundler", ".", "concat", "(", "\"", "Unmatched", "argument", "type", "\"", ",", "parameterType", ".", "getName", "(", "),", "\"", "for", "method", "argument", "\"", ",", "i", ")", ");", "}"], "docstring_tokens": ["an", "unsafe", "deserialization"]}
{"contents": ["Another", "EncryptBeforeSigning", "fix", "git-svn-id:", "https://svn.apache.org/repos/asf/cxf/trunk@1564724", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["secondRefList", "=", "(", "(", "WSSecEncrypt", ")", "encr", ")", ".", "encryptForRef", "(", "null", ",", "secondEncrParts", ")", ";", "@", "org", ".", "junit", ".", "Test", "public", "void", "testSymmetricUsernameToken", "(", ")", "throws", "Exception", "{", "SpringBusFactory", "bf", "=", "new", "SpringBusFactory", "(", ");", "URL", "busFile", "=", "X509TokenTest", ".", "class", ".", "getResource", "(", "\"", "client", ".", "xml", "\"", ");", "Bus", "bus", "=", "bf", ".", "createBus", "(", "busFile", ".", "toString", "(", "))", ";", "SpringBusFactory", ".", "setDefaultBus", "(", "bus", ")", ";", "SpringBusFactory", ".", "setThreadDefaultBus", "(", "bus", ")", ";", "URL", "wsdl", "=", "X509TokenTest", ".", "class", ".", "getResource", "(", "\"", "DoubleItX509", ".", "wsdl", "\"", ");", "Service", "service", "=", "Service", ".", "create", "(", "wsdl", ",", "SERVICE_QNAME", ")", ";", "QName", "portQName", "=", "new", "QName", "(", "NAMESPACE", ",", "\"", "DoubleItSymmetricUsernameTokenPort", "\"", ");", "DoubleItPortType", "x509Port", "=", "service", ".", "getPort", "(", "portQName", ",", "DoubleItPortType", ".", "class", ")", ";", "updateAddressPort", "(", "x509Port", ",", "test", ".", "getPort", "(", "))", ";", "if", "(", "test", ".", "isStreaming", "(", "))", "{", "SecurityTestUtil", ".", "enableStreaming", "(", "x509Port", ")", ";", "}", "x509Port", ".", "doubleIt", "(", "25", ")", ";", "(", "(", "java", ".", "io", ".", "Closeable", ")", "x509Port", ")", ".", "close", "(", ");", "bus", ".", "shutdown", "(", "true", ")", ";", "}", "<", "wsdl", ":", "binding", "name", "=", "\"", "DoubleItSymmetricUsernameTokenBinding", "\"", "type", "=", "\"", "tns", ":", "DoubleItPortType", "\"", ">", "<", "wsp", ":", "PolicyReference", "URI", "=", "\"#", "DoubleItSymmetricUsernameTokenPolicy", "\"", "/>", "<", "soap", ":", "binding", "style", "=", "\"", "document", "\"", "transport", "=", "\"", "http", ":", "//", "schemas", ".", "xmlsoap", ".", "org", "/", "soap", "/", "http", "\"", "/>", "<", "wsdl", ":", "operation", "name", "=", "\"", "DoubleIt", "\"", ">", "<", "soap", ":", "operation", "soapAction", "=", "\"\"", "/>", "<", "wsdl", ":", "input", ">", "<", "soap", ":", "body", "use", "=", "\"", "literal", "\"", "/>", "<", "wsp", ":", "PolicyReference", "URI", "=", "\"#", "DoubleItBinding_DoubleIt_Input_Policy", "\"", "/>", "<", "/", "wsdl", ":", "input", ">", "<", "wsdl", ":", "output", ">", "<", "soap", ":", "body", "use", "=", "\"", "literal", "\"", "/>", "<", "wsp", ":", "PolicyReference", "URI", "=", "\"#", "DoubleItBinding_DoubleIt_Output_Policy", "\"", "/>", "<", "/", "wsdl", ":", "output", ">", "<", "wsdl", ":", "fault", "name", "=", "\"", "DoubleItFault", "\"", ">", "<", "soap", ":", "body", "use", "=", "\"", "literal", "\"", "name", "=", "\"", "DoubleItFault", "\"", "/>", "<", "/", "wsdl", ":", "fault", ">", "<", "/", "wsdl", ":", "operation", ">", "<", "/", "wsdl", ":", "binding", ">", "<", "wsdl", ":", "port", "name", "=", "\"", "DoubleItSymmetricUsernameTokenPort", "\"", "binding", "=", "\"", "tns", ":", "DoubleItSymmetricUsernameTokenBinding", "\"", ">", "<", "soap", ":", "address", "location", "=", "\"", "http", ":", "//", "localhost", ":", "9001", "/", "DoubleItX509SymmetricUsernameToken", "\"", "/>", "<", "/", "wsdl", ":", "port", ">", "<", "wsp", ":", "Policy", "wsu", ":", "Id", "=", "\"", "DoubleItSymmetricUsernameTokenPolicy", "\"", ">", "<", "wsp", ":", "ExactlyOne", ">", "<", "wsp", ":", "All", ">", "<", "sp", ":", "SymmetricBinding", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "ProtectionToken", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "X509Token", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "Never", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "WssX509V3Token11", "/", ">", "<", "sp", ":", "RequireThumbprintReference", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "X509Token", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "ProtectionToken", ">", "<", "sp", ":", "Layout", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Lax", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "Layout", ">", "<", "sp", ":", "IncludeTimestamp", "/", ">", "<", "sp", ":", "OnlySignEntireHeadersAndBody", "/", ">", "<", "sp", ":", "EncryptBeforeSigning", "/", ">", "<", "sp", ":", "AlgorithmSuite", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "Basic128", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "AlgorithmSuite", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "SymmetricBinding", ">", "<", "sp", ":", "EncryptedSupportingTokens", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "UsernameToken", "sp", ":", "IncludeToken", "=", "\"", "http", ":", "//", "docs", ".", "oasis", "-", "open", ".", "org", "/", "ws", "-", "sx", "/", "ws", "-", "securitypolicy", "/", "200702", "/", "IncludeToken", "/", "AlwaysToRecipient", "\"", ">", "<", "wsp", ":", "Policy", ">", "<", "sp", ":", "WssUsernameToken11", "/", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "UsernameToken", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "/", "sp", ":", "EncryptedSupportingTokens", ">", "<", "/", "wsp", ":", "All", ">", "<", "/", "wsp", ":", "ExactlyOne", ">", "<", "/", "wsp", ":", "Policy", ">", "<", "jaxws", ":", "client", "name", "=", "\"{", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "}", "DoubleItSymmetricUsernameTokenPort", "\"", "createdFromAPI", "=", "\"", "true", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "encryption", ".", "properties", "\"", "value", "=", "\"", "bob", ".", "properties", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "encryption", ".", "username", "\"", "value", "=", "\"", "bob", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "username", "\"", "value", "=", "\"", "alice", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "KeystorePasswordCallback", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "/", "jaxws", ":", "client", ">", "<", "jaxws", ":", "endpoint", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "id", "=", "\"", "SymmetricUsernameToken", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "Server", "}", "/", "DoubleItX509SymmetricUsernameToken", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItSymmetricUsernameTokenPort", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "x509", "/", "DoubleItX509", ".", "wsdl", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "KeystorePasswordCallback", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "properties", "\"", "value", "=", "\"", "bob", ".", "properties", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "/", "jaxws", ":", "endpoint", ">", "<", "jaxws", ":", "endpoint", "xmlns", ":", "s", "=", "\"", "http", ":", "//", "www", ".", "example", ".", "org", "/", "contract", "/", "DoubleIt", "\"", "id", "=", "\"", "SymmetricUsernameToken", "\"", "address", "=", "\"", "http", ":", "//", "localhost", ":", "${", "testutil", ".", "ports", ".", "StaxServer", "}", "/", "DoubleItX509SymmetricUsernameToken", "\"", "serviceName", "=", "\"", "s", ":", "DoubleItService", "\"", "endpointName", "=", "\"", "s", ":", "DoubleItSymmetricUsernameTokenPort", "\"", "implementor", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "DoubleItImpl", "\"", "wsdlLocation", "=", "\"", "org", "/", "apache", "/", "cxf", "/", "systest", "/", "ws", "/", "x509", "/", "DoubleItX509", ".", "wsdl", "\"", ">", "<", "jaxws", ":", "properties", ">", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "callback", "-", "handler", "\"", "value", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "systest", ".", "ws", ".", "common", ".", "KeystorePasswordCallback", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "signature", ".", "properties", "\"", "value", "=", "\"", "bob", ".", "properties", "\"", "/>", "<", "entry", "key", "=", "\"", "ws", "-", "security", ".", "enable", ".", "streaming", "\"", "value", "=", "\"", "true", "\"", "/>", "<", "/", "jaxws", ":", "properties", ">", "<", "/", "jaxws", ":", "endpoint", "></s>secondRefList", "=", "(", "(", "WSSecEncrypt", ")", "encr", ")", ".", "encryptForRef", "(", "null", ",", "encrParts", ")", ";"], "docstring_tokens": ["the", "transmittal", "of", "the", "UsernameToken", "in", "cleartext"]}
{"contents": ["SECURITY-976"], "code_tokens": ["import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "POST", "if", "(", "project", "=", "=", "null", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "}", "else", "{", "project", ".", "checkPermission", "(", "Item", ".", "CONFIGURE", ")", ";", "}</s>"], "docstring_tokens": ["not", "properly", "escape", "resource", "names", "in", "generated", "JavaScript", "code"]}
{"contents": ["Fix", "potential", "XSS", "vulnerability", "(#307)", "*", "Escape", "text", "coming", "from", "URL", "that", "is", "used", "in", "the", "page", "*", "Comment", "out", "the", "contents", "of", "unit.html", "*", "Prevent", "remote", "scripts", "being", "executed", "*", "Remove", "remote", "URLs", "from", "unit", "test", "file"], "code_tokens": ["\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", "];", "<", "!-", "-<", "html", ">", "var", "escapes", "=", "{", "\"", "&\"", ":", "\"", "&", "amp", ";", "\",", "\"", "<\"", ":", "\"", "&", "lt", ";", "\",", "\"", ">\"", ":", "\"", "&", "gt", ";", "\",", "\"", "\\\"", "\":", "\"", "&", "quot", ";", "\",", "\"", "'\"", ":", "\"", "&#", "039", ";", "\"", "}", ";", "function", "escape", "(", "unsafe", ")", "{", "return", "unsafe", ".", "replace", "(", "/[", "&<", ">\"", "']", "/", "g", ",", "function", "(", "match", ")", "{", "return", "escapes", "[", "match", "]", ";", "}", ");", "}", "if", "(", "(/", "^", "http", "/", "i", ")", ".", "test", "(", "i18nTestLocation", ")", ")", "{", "return", ";", "}", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "+", "=", "escape", "(", "hashInfo", ")", ";", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "=", "escape", "(", "text", ")", ";", "/", "/", "If", "a", "user", "passes", "a", "remote", "URL", ",", "force", "it", "to", "use", "the", "local", "dojo", "node", ".", "src", "=", "(", "(/", "^", "http", "/", "i", ")", ".", "test", "(", "dojoLocation", ")", "?", "'", "..", "/", "dojo", "'", ":", "\"", "..", "/\"", "+", "dojoLocation", ")", "+", "\"", "/", "dojo", ".", "js", "\"", ";", "<", "/", "html", ">", "--", ">", "@", "@", "-", "59", ",", "6", "+", "59", ",", "6", "@", "@", "The", "various", "built", "module", "and", "loaders", "are", "constructed", "by", "the", "v1", ".", "7", "builder", ".", "The", "sh", "exercise", "a", "particular", "set", "of", "modules", ".", "Its", "contents", "must", "be", "uncommented", "before", "running", "the", "tests", ".</s>\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", "];", "<", "html", ">", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "+", "=", "hashInfo", ";", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "=", "text", ";", "node", ".", "src", "=", "(", "/^", "http", "/", ".", "test", "(", "dojoLocation", ")", "?", "dojoLocation", ":", "\"", "..", "/\"", "+", "dojoLocation", ")", "+", "\"", "/", "dojo", ".", "js", "\"", ";", "<", "/", "html", ">", "exercise", "a", "particular", "set", "of", "modules", "."], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["USB:", "iowarrior:", "fix", "NULL-deref", "at", "probe", "Make", "sure", "to", "check", "for", "the", "required", "interrupt-in", "endpoint", "to", "avoid", "dereferencing", "a", "NULL-pointer", "should", "a", "malicious", "device", "lack", "such", "an", "endpoint.", "Note", "that", "a", "fairly", "recent", "change", "purported", "to", "fix", "this", "issue,", "but", "added", "an", "insufficient", "test", "on", "the", "number", "of", "endpoints", "only,", "a", "test", "which", "can", "now", "be", "removed.", "Fixes:", "4ec0ef3a8212", "(\"USB:", "iowarrior:", "fix", "oops", "with", "malicious", "USB", "descriptors\")", "Fixes:", "946b960d13c1", "(\"USB:", "add", "driver", "for", "iowarrior", "devices.\")", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "2.6.21", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["if", "(", "!", "dev", "-", ">", "int_in_endpoint", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "no", "interrupt", "-", "in", "endpoint", "found", "\\", "n", "\"", ");", "retval", "=", "-", "ENODEV", ";", "goto", "error", ";", "}</s>if", "(", "iface_desc", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "Invalid", "number", "of", "endpoints", "\\", "n", "\"", ");", "retval", "=", "-", "EINVAL", ";", "goto", "error", ";", "}"], "docstring_tokens": ["no", "security", "patch", "was", "provided", "by", "the", "vendor", "."]}
{"contents": ["Fix", "bug", "#69248", "-", "heap", "overflow", "vulnerability", "in", "regcomp.c", "Merged", "from", "https://github.com/garyhouston/regex/commit/70bc2965604b6b8aaf260049e64c708dddf85334"], "code_tokens": ["-", "Ereg", ":", ".", "Fixed", "bug", "#", "69248", "(", "heap", "overflow", "vulnerability", "in", "regcomp", ".", "c", ")", ".", "(", "Stas", ")", "{", "/", "*", "Patched", "for", "CERT", "Vulnerability", "Note", "VU", "#", "695940", ",", "Feb", "2015", ".", "*", "/", "size_t", "new_ssize", "=", "len", "/", "(", "size_t", ")", "2", "*", "(", "size_t", ")", "3", "+", "(", "size_t", ")", "1", ";", "/", "*", "ugh", "*", "/", "if", "(", "new_ssize", "<", "len", "|", "|", "new_ssize", ">", "LONG_MAX", "/", "sizeof", "(", "sop", ")", ")", "{", "free", "(", "(", "char", "*", ")", "g", ")", ";", "return", "REG_INVARG", ";", "}", "p", "-", ">", "ssize", "=", "new_ssize", ";", "}</s>-", "SOAP", ":", "p", "-", ">", "ssize", "=", "len", "/", "(", "size_t", ")", "2", "*", "(", "size_t", ")", "3", "+", "(", "size_t", ")", "1", ";", "/", "*", "ugh", "*", "/"], "docstring_tokens": ["does", "not", "permit", "arbitrary", "code", "execution", "by", "ordinary", "mailbox", "owners"]}
{"contents": ["wan:", "Missing", "capability", "checks", "in", "sbni_ioctl()", "There", "are", "missing", "capability", "checks", "in", "the", "following", "code:", "1300", "static", "int", "1301", "sbni_ioctl(", "struct", "net_device", "*dev,", "struct", "ifreq", "*ifr,", "int", "cmd)", "1302", "{", "[...]", "1319", "case", "SIOCDEVRESINSTATS", ":", "1320", "if(", "current->euid", "!=", "0", ")", "/*", "root", "only", "*/", "1321", "return", "-EPERM;", "[...]", "1336", "case", "SIOCDEVSHWSTATE", ":", "1337", "if(", "current->euid", "!=", "0", ")", "/*", "root", "only", "*/", "1338", "return", "-EPERM;", "[...]", "1357", "case", "SIOCDEVENSLAVE", ":", "1358", "if(", "current->euid", "!=", "0", ")", "/*", "root", "only", "*/", "1359", "return", "-EPERM;", "[...]", "1372", "case", "SIOCDEVEMANSIPATE", ":", "1373", "if(", "current->euid", "!=", "0", ")", "/*", "root", "only", "*/", "1374", "return", "-EPERM;", "Here's", "my", "proposed", "fix:", "Missing", "capability", "checks.", "Signed-off-by:", "Eugene", "Teo", "<eugeneteo@kernel.sg>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")", "if", "(", "!", "capable", "(", "CAP_NET_ADMIN", ")", ")</s>if", "(", "current", "-", ">", "euid", "!", "=", "0", ")", "/", "*", "root", "only", "*", "/", "if", "(", "current", "-", ">", "euid", "!", "=", "0", ")", "/", "*", "root", "only", "*", "/", "if", "(", "current", "-", ">", "euid", "!", "=", "0", ")", "/", "*", "root", "only", "*", "/", "if", "(", "current", "-", ">", "euid", "!", "=", "0", ")", "/", "*", "root", "only", "*", "/"], "docstring_tokens": ["the", "failure", "to", "verify", "CAP_NET_ADMIN", "capabilities", "prior", "to", "processing", "specific", "ioctl", "requests"]}
{"contents": ["Fix", "DTLS", "buffered", "message", "DoS", "attack", "DTLS", "can", "handle", "out", "of", "order", "record", "delivery.", "Additionally", "since", "handshake", "messages", "can", "be", "bigger", "than", "will", "fit", "into", "a", "single", "packet,", "the", "messages", "can", "be", "fragmented", "across", "multiple", "records", "(as", "with", "normal", "TLS).", "That", "means", "that", "the", "messages", "can", "arrive", "mixed", "up,", "and", "we", "have", "to", "reassemble", "them.", "We", "keep", "a", "queue", "of", "buffered", "messages", "that", "are", "\"from", "the", "future\",", "i.e.", "messages", "we're", "not", "ready", "to", "deal", "with", "yet", "but", "have", "arrived", "early.", "The", "messages", "held", "there", "may", "not", "be", "full", "yet", "-", "they", "could", "be", "one", "or", "more", "fragments", "that", "are", "still", "in", "the", "process", "of", "being", "reassembled.", "The", "code", "assumes", "that", "we", "will", "eventually", "complete", "the", "reassembly", "and", "when", "that", "occurs", "the", "complete", "message", "is", "removed", "from", "the", "queue", "at", "the", "point", "that", "we", "need", "to", "use", "it.", "However,", "DTLS", "is", "also", "tolerant", "of", "packet", "loss.", "To", "get", "around", "that", "DTLS", "messages", "can", "be", "retransmitted.", "If", "we", "receive", "a", "full", "(non-fragmented)", "message", "from", "the", "peer", "after", "previously", "having", "received", "a", "fragment", "of", "that", "message,", "then", "we", "ignore", "the", "message", "in", "the", "queue", "and", "just", "use", "the", "non-fragmented", "version.", "At", "that", "point", "the", "queued", "message", "will", "never", "get", "removed.", "Additionally", "the", "peer", "could", "send", "\"future\"", "messages", "that", "we", "never", "get", "to", "in", "order", "to", "complete", "the", "handshake.", "Each", "message", "has", "a", "sequence", "number", "(starting", "from", "0).", "We", "will", "accept", "a", "message", "fragment", "for", "the", "current", "message", "sequence", "number,", "or", "for", "any", "sequence", "up", "to", "10", "into", "the", "future.", "However", "if", "the", "Finished", "message", "has", "a", "sequence", "number", "of", "2,", "anything", "greater", "than", "that", "in", "the", "queue", "is", "just", "left", "there.", "So,", "in", "those", "two", "ways", "we", "can", "end", "up", "with", "\"orphaned\"", "data", "in", "the", "queue", "that", "will", "never", "get", "removed", "-", "except", "when", "the", "connection", "is", "closed.", "At", "that", "point", "all", "the", "queues", "are", "flushed.", "An", "attacker", "could", "seek", "to", "exploit", "this", "by", "filling", "up", "the", "queues", "with", "lots", "of", "large", "messages", "that", "are", "never", "going", "to", "be", "used", "in", "order", "to", "attempt", "a", "DoS", "by", "memory", "exhaustion.", "I", "will", "assume", "that", "we", "are", "only", "concerned", "with", "servers", "here.", "It", "does", "not", "seem", "reasonable", "to", "be", "concerned", "about", "a", "memory", "exhaustion", "attack", "on", "a", "client.", "They", "are", "unlikely", "to", "process", "enough", "connections", "for", "this", "to", "be", "an", "issue.", "A", "\"long\"", "handshake", "with", "many", "messages", "might", "be", "5", "messages", "long", "(in", "the", "incoming", "direction),", "e.g.", "ClientHello,", "Certificate,", "ClientKeyExchange,", "CertificateVerify,", "Finished.", "So", "this", "would", "be", "message", "sequence", "numbers", "0", "to", "4.", "Additionally", "we", "can", "buffer", "up", "to", "10", "messages", "in", "the", "future.", "Therefore", "the", "maximum", "number", "of", "messages", "that", "an", "attacker", "could", "send", "that", "could", "get", "orphaned", "would", "typically", "be", "15.", "The", "maximum", "size", "that", "a", "DTLS", "message", "is", "allowed", "to", "be", "is", "defined", "by", "max_cert_list,", "which", "by", "default", "is", "100k.", "Therefore", "the", "maximum", "amount", "of", "\"orphaned\"", "memory", "per", "connection", "is", "1500k.", "Message", "sequence", "numbers", "get", "reset", "after", "the", "Finished", "message,", "so", "renegotiation", "will", "not", "extend", "the", "maximum", "number", "of", "messages", "that", "can", "be", "orphaned", "per", "connection.", "As", "noted", "above,", "the", "queues", "do", "get", "cleared", "when", "the", "connection", "is", "closed.", "Therefore", "in", "order", "to", "mount", "an", "effective", "attack,", "an", "attacker", "would", "have", "to", "open", "many", "simultaneous", "connections.", "Issue", "reported", "by", "Quan", "Luo.", "Reviewed-by:", "Richard", "Levitte", "<levitte@openssl.org>"], "code_tokens": ["do", "{", "item", "=", "pqueue_peek", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ")", ";", "if", "(", "item", "=", "=", "NULL", ")", "return", "0", ";", "frag", "=", "(", "hm_fragment", "*", ")", "item", "-", ">", "data", ";", "if", "(", "frag", "-", ">", "msg_header", ".", "seq", "<", "s", "-", ">", "d1", "-", ">", "handshake_read_seq", ")", "{", "/", "*", "This", "is", "a", "stale", "message", "that", "has", "been", "buffered", "so", "clear", "it", "*", "/", "pqueue_pop", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ")", ";", "dtls1_hm_fragment_free", "(", "frag", ")", ";", "pitem_free", "(", "item", ")", ";", "item", "=", "NULL", ";", "frag", "=", "NULL", ";", "}", "}", "while", "(", "item", "=", "=", "NULL", ")", ";", "dtls1_clear_received_buffer", "(", "s", ")", ";", "while", "(", "(", "item", "=", "pqueue_pop", "(", "s", "-", ">", "d1", "-", ">", "buffered_app_data", ".", "q", ")", ")", "!", "=", "NULL", ")", "{", "rdata", "=", "(", "DTLS1_RECORD_DATA", "*", ")", "item", "-", ">", "data", ";", "if", "(", "rdata", "-", ">", "rbuf", ".", "buf", ")", "{", "OPENSSL_free", "(", "rdata", "-", ">", "rbuf", ".", "buf", ")", ";", "}", "OPENSSL_free", "(", "item", "-", ">", "data", ")", ";", "pitem_free", "(", "item", ")", ";", "}", "dtls1_clear_received_buffer", "(", "s", ")", ";", "dtls1_clear_sent_buffer", "(", "s", ")", ";", "}", "void", "dtls1_clear_received_buffer", "(", "SSL", "*", "s", ")", "{", "pitem", "*", "item", "=", "NULL", ";", "hm_fragment", "*", "frag", "=", "NULL", ";", "}", "void", "dtls1_clear_sent_buffer", "(", "SSL", "*", "s", ")", "{", "pitem", "*", "item", "=", "NULL", ";", "hm_fragment", "*", "frag", "=", "NULL", ";", "dtls1_clear_sent_buffer", "(", "s", ")", ";", "dtls1_clear_sent_buffer", "(", "s", ")", ";", "dtls1_clear_received_buffer", "(", "s", ")", ";", "void", "dtls1_clear_received_buffer", "(", "SSL", "*", "s", ")", ";", "void", "dtls1_clear_sent_buffer", "(", "SSL", "*", "s", ")", ";</s>item", "=", "pqueue_peek", "(", "s", "-", ">", "d1", "-", ">", "buffered_messages", ")", ";", "if", "(", "item", "=", "=", "NULL", ")", "return", "0", ";", "frag", "=", "(", "hm_fragment", "*", ")", "item", "-", ">", "data", ";", "/", "*", "call", "this", "function", "when", "the", "buffered", "messages", "are", "no", "longer", "needed", "*", "/", "void", "dtls1_clear_record_buffer", "(", "SSL", "*", "s", ")", "{", "pitem", "*", "item", ";", "for", "(", "item", "=", "pqueue_pop", "(", "s", "-", ">", "d1", "-", ">", "sent_messages", ")", ";", "item", "!", "=", "NULL", ";", "item", "=", "pqueue_pop", "(", "s", "-", ">", "d1", "-", ">", "sent_messages", ")", ")", "{", "dtls1_hm_fragment_free", "(", "(", "hm_fragment", "*", ")", "item", "-", ">", "data", ")", ";", "pitem_free", "(", "item", ")", ";", "}", "}", "hm_fragment", "*", "frag", "=", "NULL", ";", "while", "(", "(", "item", "=", "pqueue_pop", "(", "s", "-", ">", "d1", "-", ">", "buffered_app_data", ".", "q", ")", ")", "!", "=", "NULL", ")", "{", "rdata", "=", "(", "DTLS1_RECORD_DATA", "*", ")", "item", "-", ">", "data", ";", "if", "(", "rdata", "-", ">", "rbuf", ".", "buf", ")", "{", "OPENSSL_free", "(", "rdata", "-", ">", "rbuf", ".", "buf", ")", ";", "}", "OPENSSL_free", "(", "item", "-", ">", "data", ")", ";", "pitem_free", "(", "item", ")", ";", "}", "dtls1_clear_record_buffer", "(", "s", ")", ";", "dtls1_clear_record_buffer", "(", "s", ")", ";", "void", "dtls1_clear_record_buffer", "(", "SSL", "*", "s", ")", ";"], "docstring_tokens": ["the", "failure", "to", "properly", "restrict", "the", "lifetime", "of", "queue", "entries", "associated", "with", "unused", "out-of-order", "messages"]}
{"contents": ["Avoid", "'names_cache'", "memory", "leak", "with", "CONFIG_AUDITSYSCALL", "The", "nameidata", "\"last.name\"", "is", "always", "allocated", "with", "\"__getname()\",", "and", "should", "always", "be", "free'd", "with", "\"__putname()\".", "Using", "\"putname()\"", "without", "the", "underscores", "will", "leak", "memory,", "because", "the", "allocation", "will", "have", "been", "hidden", "from", "the", "AUDITSYSCALL", "code.", "Arguably", "the", "real", "bug", "is", "that", "the", "AUDITSYSCALL", "code", "is", "really", "broken,", "but", "in", "the", "meantime", "this", "fixes", "the", "problem", "people", "see.", "Reported", "by", "Robert", "Derr,", "patch", "by", "Rick", "Lindsley.", "Acked-by:", "Al", "Viro", "<viro@ftp.linux.org.uk>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["__putname", "(", "nd", "-", ">", "last", ".", "name", ")", ";", "__putname", "(", "nd", "-", ">", "last", ".", "name", ")", ";", "__putname", "(", "nd", "-", ">", "last", ".", "name", ")", ";</s>putname", "(", "nd", "-", ">", "last", ".", "name", ")", ";", "putname", "(", "nd", "-", ">", "last", ".", "name", ")", ";", "putname", "(", "nd", "-", ">", "last", ".", "name", ")", ";"], "docstring_tokens": ["uses", "an", "incorrect", "function", "to", "free", "names_cache", "memory"]}
{"contents": ["Merge", "remote-tracking", "branch", "'remotes/origin/candidate'", "into", "release", "#", "Conflicts:", "#", "resetPassword-share/pom.xml", "#", "resetPassword/pom.xml"], "code_tokens": ["public", "class", "EmailHelper", "extends", "BaseScopableProcessorExtension", "{", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ";", "import", "org", ".", "alfresco", ".", "error", ".", "AlfrescoRuntimeException", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "jscript", ".", "BaseScopableProcessorExtension", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "security", ".", "crypto", ".", "bcrypt", ".", "BCrypt", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "UUID", ";", "public", "class", "TokenGenerator", "extends", "BaseScopableProcessorExtension", "{", "private", "static", "final", "String", "SALT_KEY", "=", "\"", "fs", ".", "passreset", ".", "salt", "\"", ";", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "TokenGenerator", ".", "class", ")", ";", "private", "Properties", "globalProps", ";", "public", "String", "genToken", "(", "String", "userName", ")", "{", "String", "salt", "=", "globalProps", ".", "getProperty", "(", "SALT_KEY", ")", ";", "if", "(", "salt", "=", "=", "null", "|", "|", "salt", ".", "equals", "(", "\"\"", "))", "{", "logger", ".", "error", "(", "\"", "Property", "fs", ".", "passreset", ".", "salt", "is", "missing", "\"", ");", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Reset", "Password", "addon", "is", "not", "configured", "\"", ");", "}", "String", "token", "=", "BCrypt", ".", "hashpw", "(", "userName", ",", "salt", ")", ".", "substring", "(", "salt", ".", "length", "(", "))", ";", "return", "token", "+", "UUID", ".", "randomUUID", "(", ").", "toString", "(", ").", "substring", "(", "0", ",", "14", ")", ";", "}", "public", "String", "getHashFromToken", "(", "String", "token", ")", "{", "return", "token", ".", "substring", "(", "0", ",", "token", ".", "length", "(", ")", "-", "14", ")", ";", "}", "public", "void", "setGlobalProps", "(", "Properties", "globalProps", ")", "{", "this", ".", "globalProps", "=", "globalProps", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "89", "@", "@", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ";", "import", "org", ".", "activiti", ".", "engine", ".", "HistoryService", ";", "import", "org", ".", "activiti", ".", "engine", ".", "history", ".", "HistoricTaskInstance", ";", "import", "org", ".", "activiti", ".", "engine", ".", "history", ".", "HistoricTaskInstanceQuery", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "workflow", ".", "activiti", ".", "ActivitiConstants", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowTask", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowTaskQuery", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowTaskState", ";", "import", "org", ".", "alfresco", ".", "util", ".", "Pair", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "java", ".", "util", ".", "List", ";", "public", "class", "WorkflowHelper", "{", "private", "static", "WorkflowService", "workflowService", ";", "private", "static", "Logger", "logger", "=", "Logger", ".", "getLogger", "(", "WorkflowHelper", ".", "class", ")", ";", "private", "static", "HistoryService", "activitiHistoryService", ";", "public", "static", "void", "cancelPreviousWorkflows", "(", "final", "String", "userName", ")", "{", "Pair", "<", "String", ",", "String", ">", "userTenant", "=", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ";", "final", "String", "tenantDomain", "=", "userTenant", ".", "getSecond", "(", ");", "TenantUtil", ".", "runAsUserTenant", "(", "new", "TenantUtil", ".", "TenantRunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "List", "<", "WorkflowTask", ">", "workflowTasks", "=", "getTasksInProgress", "(", "userName", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Found", "workflow", "tasks", "=", "\"", "+", "workflowTasks", ".", "size", "(", "))", ";", "}", "for", "(", "WorkflowTask", "task", ":", "workflowTasks", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Current", "task", ":", "\"", "+", "task", ".", "getName", "(", "))", ";", "}", "if", "(", "\"", "fs", "-", "reset", ":", "review", "\"", ".", "equals", "(", "task", ".", "getName", "(", "))", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Try", "to", "end", "task", "\"", "+", "task", ".", "toString", "(", "))", ";", "}", "workflowService", ".", "cancelWorkflow", "(", "task", ".", "getPath", "(", ").", "getInstance", "(", ").", "getId", "(", "))", ";", "}", "}", "return", "null", ";", "}", "}", ",", "userName", ",", "tenantDomain", ")", ";", "}", "public", "static", "List", "<", "HistoricTaskInstance", ">", "getResetPassTasksByUserTokenAcrossTenants", "(", "String", "token", ")", "{", "HistoricTaskInstanceQuery", "query", "=", "activitiHistoryService", ".", "createHistoricTaskInstanceQuery", "(", ")", ".", "includeProcessVariables", "(", ")", ".", "unfinished", "(", ")", ".", "processVariableValueEquals", "(", "\"", "fs", "-", "reset", ":", "token", "\"", ",", "token", ")", ";", "return", "query", ".", "list", "(", ");", "}", "private", "static", "List", "<", "WorkflowTask", ">", "getTasksInProgress", "(", "String", "userName", ")", "{", "WorkflowTaskQuery", "query", "=", "new", "WorkflowTaskQuery", "(", ");", "query", ".", "setEngineId", "(", "ActivitiConstants", ".", "ENGINE_ID", ")", ";", "query", ".", "setTaskState", "(", "WorkflowTaskState", ".", "IN_PROGRESS", ")", ";", "query", ".", "setActorId", "(", "userName", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Try", "to", "delete", "workflows", ".", "..", "\")", ";", "}", "return", "workflowService", ".", "queryTasks", "(", "query", ",", "true", ")", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "WorkflowHelper", ".", "workflowService", "=", "workflowService", ";", "}", "public", "void", "setActivitiHistoryService", "(", "HistoryService", "activitiHistoryService", ")", "{", "WorkflowHelper", ".", "activitiHistoryService", "=", "activitiHistoryService", ";", "}", "}", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "webscripts", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ".", "TokenGenerator", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ".", "WorkflowHelper", ";", "import", "org", ".", "activiti", ".", "engine", ".", "history", ".", "HistoricTaskInstance", ";", "import", "org", ".", "alfresco", ".", "error", ".", "AlfrescoRuntimeException", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "workflow", ".", "activiti", ".", "ActivitiConstants", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "security", ".", "MutableAuthenticationService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowService", ";", "import", "org", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "surf", ".", "util", ".", "Content", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "*;", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Objects", ";", "public", "class", "ApplyChangedPasswordPost", "extends", "DeclarativeWebScript", "{", "public", "static", "final", "String", "NEW_PAS", "=", "\"", "new", "-", "password", "\"", ";", "public", "static", "final", "String", "NEW_PAS_CONFIRM", "=", "\"", "new", "-", "password", "-", "confirm", "\"", ";", "public", "static", "final", "String", "TOKEN", "=", "\"", "userToken", "\"", ";", "private", "WorkflowService", "workflowService", ";", "private", "MutableAuthenticationService", "authenticationService", ";", "private", "TokenGenerator", "tokenGenerator", ";", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ApplyChangedPasswordPost", ".", "class", ")", ";", "@", "Override", "protected", "Map", "<", "String", ",", "Object", ">", "executeImpl", "(", "WebScriptRequest", "req", ",", "Status", "status", ",", "Cache", "cache", ")", "{", "final", "Map", "<", "String", ",", "String", ">", "data", "=", "getDataFromRequest", "(", "req", ")", ";", "String", "pass", "=", "data", ".", "get", "(", "NEW_PAS", ")", ";", "String", "confirmPass", "=", "data", ".", "get", "(", "NEW_PAS_CONFIRM", ")", ";", "if", "(", "!", "Objects", ".", "equals", "(", "pass", ",", "confirmPass", ")", ")", "{", "logger", ".", "error", "(", "\"", "Password", "and", "confirm", "password", "are", "not", "equal", "\"", ");", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Password", "and", "confirm", "password", "are", "not", "equal", "\"", ");", "}", "String", "incomingToken", "=", "data", ".", "get", "(", "TOKEN", ")", ";", "List", "<", "HistoricTaskInstance", ">", "candidateTasks", "=", "WorkflowHelper", ".", "getResetPassTasksByUserTokenAcrossTenants", "(", "incomingToken", ")", ";", "if", "(", "candidateTasks", ".", "isEmpty", "(", "))", "{", "logger", ".", "error", "(", "\"", "Invalid", "'", "change", "password", "'", "request", "received", ".", "Process", "by", "token", "=", "{}", "does", "not", "exist", "or", "has", "been", "finished", "\"", ",", "incomingToken", ")", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "if", "(", "candidateTasks", ".", "size", "(", ")", "!", "=", "1", ")", "{", "logger", ".", "error", "(", "\"", "Found", "more", "than", "one", "process", "by", "token", "=", "{}", "\",", "incomingToken", ")", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "final", "HistoricTaskInstance", "historicTaskInstance", "=", "candidateTasks", ".", "get", "(", "0", ")", ";", "String", "assignee", "=", "historicTaskInstance", ".", "getAssignee", "(", ");", "String", "hashForCurrentAssignee", "=", "tokenGenerator", ".", "getHashFromToken", "(", "tokenGenerator", ".", "genToken", "(", "assignee", ")", ");", "if", "(", "!", "hashForCurrentAssignee", ".", "equals", "(", "tokenGenerator", ".", "getHashFromToken", "(", "incomingToken", ")", "))", "{", "logger", ".", "error", "(", "\"", "Invalid", "'", "change", "password", "'", "request", "received", ".", "Token", "=", "{}", "is", "not", "valid", "for", "user", "{", "}\"", ",", "incomingToken", ",", "assignee", ")", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "String", "tenant_domain", "=", "(", "String", ")", "historicTaskInstance", ".", "getProcessVariables", "(", ").", "get", "(", "ActivitiConstants", ".", "VAR_TENANT_DOMAIN", ")", ";", "if", "(", "tenant_domain", "=", "=", "null", ")", "{", "tenant_domain", "=", "\"", "\";", "}", "/", "/", "clear", "context", "-", "to", "avoid", "MT", "concurrency", "issue", "(", "causing", "domain", "mismatch", ")", "AuthenticationUtil", ".", "clearCurrentSecurityContext", "(", ");", "TenantUtil", ".", "runAsSystemTenant", "(", "new", "TenantUtil", ".", "TenantRunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "String", "activitiTaskId", "=", "\"", "activiti", "$", "\"", "+", "historicTaskInstance", ".", "getId", "(", ");", "authenticationService", ".", "setAuthentication", "(", "assignee", ",", "pass", ".", "toCharArray", "(", "))", ";", "workflowService", ".", "endTask", "(", "activitiTaskId", ",", "null", ")", ";", "return", "null", ";", "}", "}", ",", "tenant_domain", ")", ";", "return", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "message", "\"", ",", "\"", "OK", "\"", ");", "}", "};", "}", "private", "Map", "<", "String", ",", "String", ">", "getDataFromRequest", "(", "WebScriptRequest", "req", ")", "{", "HashMap", "<", "String", ",", "String", ">", "result", "=", "new", "HashMap", "<", ">(", ");", "Content", "content", "=", "req", ".", "getContent", "(", ");", "try", "{", "JSONObject", "jsonObject", "=", "new", "JSONObject", "(", "content", ".", "getContent", "(", "))", ";", "result", ".", "put", "(", "TOKEN", ",", "jsonObject", ".", "getString", "(", "TOKEN", ")", ");", "result", ".", "put", "(", "NEW_PAS", ",", "jsonObject", ".", "getString", "(", "NEW_PAS", ")", ");", "result", ".", "put", "(", "NEW_PAS_CONFIRM", ",", "jsonObject", ".", "getString", "(", "NEW_PAS_CONFIRM", ")", ");", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "throw", "new", "WebScriptException", "(", "\"", "Failed", "to", "get", "data", "from", "request", ".", "Please", ",", "contact", "system", "administrator", "\"", ");", "}", "return", "result", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "this", ".", "workflowService", "=", "workflowService", ";", "}", "public", "void", "setAuthenticationService", "(", "MutableAuthenticationService", "authenticationService", ")", "{", "this", ".", "authenticationService", "=", "authenticationService", ";", "}", "public", "void", "setTokenGenerator", "(", "TokenGenerator", "tokenGenerator", ")", "{", "this", ".", "tokenGenerator", "=", "tokenGenerator", ";", "}", "}", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "webscripts", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ".", "WorkflowHelper", ";", "import", "org", ".", "alfresco", ".", "model", ".", "ContentModel", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "model", ".", "Repository", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantContextHolder", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "workflow", ".", "WorkflowModel", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "repository", ".", "*;", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "search", ".", "SearchService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "security", ".", "PersonService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowDefinition", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "namespace", ".", "NamespaceService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "namespace", ".", "QName", ";", "import", "org", ".", "json", ".", "JSONException", ";", "import", "org", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "surf", ".", "util", ".", "Content", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "*;", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "ResetPasswordPost", "extends", "DeclarativeWebScript", "{", "@", "Autowired", "private", "ContentService", "contentService", ";", "@", "Autowired", "private", "NodeService", "nodeService", ";", "@", "Autowired", "private", "Repository", "repository", ";", "@", "Autowired", "private", "SearchService", "searchService", ";", "@", "Autowired", "private", "NamespaceService", "namespaceService", ";", "private", "WorkflowService", "workflowService", ";", "private", "PersonService", "personService", ";", "private", "static", "final", "String", "RESET_PASS_EMAIL_TEMPLATE_XPATH", "=", "\"", "app", ":", "dictionary", "/", "app", ":", "email_templates", "/", "cm", ":", "workflownotification", "/", "cm", ":", "reset", "-", "password", ".", "ftl", "\"", ";", "private", "static", "final", "String", "WORKFLOW_NOTIFICATION_XPATH", "=", "\"", "app", ":", "dictionary", "/", "app", ":", "email_templates", "/", "cm", ":", "workflownotification", "\"", ";", "private", "static", "final", "String", "RESET_PASS_FILE_NAME", "=", "\"", "reset", "-", "password", ".", "ftl", "\"", ";", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ResetPasswordPost", ".", "class", ")", ";", "@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "executeImpl", "(", "WebScriptRequest", "req", ",", "Status", "status", ",", "Cache", "cache", ")", "{", "final", "String", "userName", "=", "getUserNameFromRequest", "(", "req", ")", ";", "/", "/", "clear", "context", "-", "to", "avoid", "MT", "concurrency", "issue", "(", "causing", "domain", "mismatch", ")", "AuthenticationUtil", ".", "clearCurrentSecurityContext", "(", ");", "final", "String", "tenantDomain", "=", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ".", "getSecond", "(", ");", "createEmailTemplateIfNotExists", "(", "tenantDomain", ")", ";", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "AuthenticationUtil", ".", "setRunAsUser", "(", "userName", ")", ";", "NodeRef", "user", "=", "getUserByUserName", "(", "userName", ")", ";", "WorkflowHelper", ".", "cancelPreviousWorkflows", "(", "userName", ")", ";", "logger", ".", "debug", "(", "\"", "Try", "to", "start", "workflow", "with", "user", "\"", "+", "userName", ")", ";", "startWorkFlow", "(", "user", ")", ";", "logger", ".", "debug", "(", "\"", "Workflow", "has", "been", "started", "\"", ");", "return", "null", ";", "}", "private", "void", "createEmailTemplateIfNotExists", "(", "String", "tenantDomain", ")", "{", "AuthenticationUtil", ".", "runAsSystem", "(", "new", "AuthenticationUtil", ".", "RunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "if", "(", "!", "emailTemplateExists", "(", "tenantDomain", ")", ")", "{", "addEmailTemplate", "(", "tenantDomain", ")", ";", "}", "return", "null", ";", "}", "}", ");", "}", "private", "boolean", "emailTemplateExists", "(", "String", "tenantDomain", ")", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "NodeRef", "companyHome", "=", "repository", ".", "getCompanyHome", "(", ");", "List", "<", "NodeRef", ">", "emailTemplateFiles", "=", "searchService", ".", "selectNodes", "(", "companyHome", ",", "RESET_PASS_EMAIL_TEMPLATE_XPATH", ",", "null", ",", "namespaceService", ",", "false", ")", ";", "return", "!", "emailTemplateFiles", ".", "isEmpty", "(", ");", "}", "private", "void", "addEmailTemplate", "(", "String", "tenantDomain", ")", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "NodeRef", "companyHome", "=", "repository", ".", "getCompanyHome", "(", ");", "List", "<", "NodeRef", ">", "workflowNotificationFolder", "=", "searchService", ".", "selectNodes", "(", "companyHome", ",", "WORKFLOW_NOTIFICATION_XPATH", ",", "null", ",", "namespaceService", ",", "false", ")", ";", "Map", "<", "QName", ",", "Serializable", ">", "properties", "=", "new", "HashMap", "<", ">(", ");", "properties", ".", "put", "(", "ContentModel", ".", "PROP_NAME", ",", "RESET_PASS_FILE_NAME", ")", ";", "ChildAssociationRef", "newEmailTemplateCreated", "=", "nodeService", ".", "createNode", "(", "workflowNotificationFolder", ".", "get", "(", "0", ")", ",", "ContentModel", ".", "ASSOC_CONTAINS", ",", "QName", ".", "createQName", "(", "NamespaceService", ".", "CONTENT_MODEL_1_0_URI", ",", "QName", ".", "createValidLocalName", "(", "RESET_PASS_FILE_NAME", ")", "),", "ContentModel", ".", "TYPE_CONTENT", ",", "properties", ")", ";", "ContentWriter", "invWriter", "=", "contentService", ".", "getWriter", "(", "newEmailTemplateCreated", ".", "getChildRef", "(", "),", "ContentModel", ".", "PROP_CONTENT", ",", "true", ")", ";", "String", "adminTenant", "=", "\"", "\";", "TenantContextHolder", ".", "setTenantDomain", "(", "adminTenant", ")", ";", "companyHome", "=", "repository", ".", "getCompanyHome", "(", ");", "List", "<", "NodeRef", ">", "emailTemplateFiles", "=", "searchService", ".", "selectNodes", "(", "companyHome", ",", "RESET_PASS_EMAIL_TEMPLATE_XPATH", ",", "null", ",", "namespaceService", ",", "false", ")", ";", "NodeRef", "emailTemplate", "=", "emailTemplateFiles", ".", "get", "(", "0", ")", ";", "ContentReader", "reader", "=", "contentService", ".", "getReader", "(", "emailTemplate", ",", "ContentModel", ".", "PROP_CONTENT", ")", ";", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "invWriter", ".", "putContent", "(", "reader", ")", ";", "}", "private", "void", "startWorkFlow", "(", "final", "NodeRef", "user", ")", "{", "WorkflowDefinition", "workflowDefinition", "=", "workflowService", ".", "getDefinitionByName", "(", "\"", "activiti", "$", "resetPasswordFlex", "\"", ");", "if", "(", "workflowDefinition", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "Workflow", "definition", "is", "not", "found", "activiti", "$", "resetPasswordFlex", "\"", ");", "throw", "new", "WebScriptException", "(", "500", ",", "\"", "Sorry", ".", "Internal", "error", ".", "Try", "later", "\"", ");", "}", "Map", "<", "QName", ",", "Serializable", ">", "param", "=", "new", "HashMap", "<", ">(", ");", "logger", ".", "debug", "(", "\"", "Try", "to", "set", "assignee", "\"", ");", "param", ".", "put", "(", "WorkflowModel", ".", "ASSOC_ASSIGNEE", ",", "user", ")", ";", "logger", ".", "debug", "(", "\"", "Assignee", ":", "{", "}\"", ",", "param", ".", "get", "(", "WorkflowModel", ".", "ASSOC_ASSIGNEE", ")", ");", "logger", ".", "debug", "(", "\"", "Try", "to", "set", "description", "\"", ");", "param", ".", "put", "(", "WorkflowModel", ".", "PROP_DESCRIPTION", ",", "\"", "Request", "to", "change", "password", "\"", ");", "logger", ".", "debug", "(", "\"", "Try", "to", "set", "owner", "\"", ");", "param", ".", "put", "(", "ContentModel", ".", "PROP_OWNER", ",", "AuthenticationUtil", ".", "getAdminUserName", "(", "))", ";", "logger", ".", "debug", "(", "\"", "Try", "to", "start", "workflow", ".", "..", "\")", ";", "workflowService", ".", "startWorkflow", "(", "workflowDefinition", ".", "getId", "(", "),", "param", ")", ";", "}", "private", "NodeRef", "getUserByUserName", "(", "final", "String", "userName", ")", "{", "return", "AuthenticationUtil", ".", "runAsSystem", "(", "new", "AuthenticationUtil", ".", "RunAsWork", "<", "NodeRef", ">", "()", "{", "@", "Override", "public", "NodeRef", "doWork", "(", ")", "throws", "Exception", "{", "NodeRef", "user", "=", "personService", ".", "getPersonOrNull", "(", "userName", ")", ";", "if", "(", "user", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "Failed", "to", "find", "user", "with", "username", "=", "{}", "\",", "userName", ")", ";", "throw", "new", "WebScriptException", "(", "404", ",", "\"", "error", ".", "userNotFound", "\"", ");", "}", "return", "user", ";", "}", "}", ");", "}", "private", "String", "getUserNameFromRequest", "(", "WebScriptRequest", "request", ")", "{", "Content", "content", "=", "request", ".", "getContent", "(", ");", "String", "userName", ";", "try", "{", "JSONObject", "jsonObject", "=", "new", "JSONObject", "(", "content", ".", "getContent", "(", "))", ";", "userName", "=", "jsonObject", ".", "getString", "(", "\"", "userName", "\"", ");", "}", "catch", "(", "JSONException", "|", "IOException", "e", ")", "{", "logger", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "throw", "new", "WebScriptException", "(", "500", ",", "\"", "Sorry", ".", "Internal", "error", ".", "Try", "later", "\"", ");", "}", "return", "userName", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "this", ".", "workflowService", "=", "workflowService", ";", "}", "public", "void", "setPersonService", "(", "PersonService", "personService", ")", "{", "this", ".", "personService", "=", "personService", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "54", "@", "@", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "webscripts", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ".", "WorkflowHelper", ";", "import", "org", ".", "activiti", ".", "engine", ".", "history", ".", "HistoricTaskInstance", ";", "import", "org", ".", "alfresco", ".", "error", ".", "AlfrescoRuntimeException", ";", "import", "org", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "surf", ".", "util", ".", "Content", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "Cache", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "DeclarativeWebScript", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "Status", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "WebScriptRequest", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "TaskIsCompletePost", "extends", "DeclarativeWebScript", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "TaskIsCompletePost", ".", "class", ")", ";", "@", "Override", "protected", "Map", "<", "String", ",", "Object", ">", "executeImpl", "(", "WebScriptRequest", "req", ",", "Status", "status", ",", "Cache", "cache", ")", "{", "try", "{", "Content", "content", "=", "req", ".", "getContent", "(", ");", "final", "JSONObject", "jsonObject", "=", "new", "JSONObject", "(", "content", ".", "getContent", "(", "))", ";", "final", "String", "resetPasswordToken", "=", "jsonObject", ".", "getString", "(", "\"", "token", "\"", ");", "if", "(", "resetPasswordToken", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "Invalid", "'", "change", "password", "'", "request", "received", ".", "User", "token", "is", "null", "\"", ");", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "List", "<", "HistoricTaskInstance", ">", "cnadidateTasks", "=", "WorkflowHelper", ".", "getResetPassTasksByUserTokenAcrossTenants", "(", "resetPasswordToken", ")", ";", "if", "(", "cnadidateTasks", ".", "isEmpty", "(", "))", "{", "logger", ".", "error", "(", "\"", "Invalid", "'", "change", "password", "'", "request", "received", ".", "Process", "by", "token", "=", "{}", "does", "not", "exist", "or", "has", "been", "finished", "\"", ",", "resetPasswordToken", ")", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "if", "(", "cnadidateTasks", ".", "size", "(", ")", "!", "=", "1", ")", "{", "logger", ".", "error", "(", "\"", "Found", "more", "than", "one", "process", "by", "token", "=", "{}", "\",", "resetPasswordToken", ")", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "return", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{{", "put", "(", "\"", "message", "\"", ",", "\"", "OK", "\"", ");", "}", "};", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Failed", "to", "retrieve", "data", "from", "json", "\"", ");", "}", "}", "}</s>public", "class", "EmailHelper", "extends", "BaseScopableProcessorExtension", "{", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "jscript", ".", "BaseScopableProcessorExtension", ";", "import", "java", ".", "util", ".", "UUID", ";", "public", "class", "TokenGenerator", "extends", "BaseScopableProcessorExtension", "{", "public", "String", "genToken", "(", ")", "{", "return", "UUID", ".", "randomUUID", "(", ").", "toString", "(", ");", "}", "}", "@", "@", "-", "1", ",", "147", "+", "0", ",", "0", "@", "@", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "model", ".", "Repository", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantContextHolder", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "workflow", ".", "activiti", ".", "ActivitiConstants", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "repository", ".", "NodeRef", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "repository", ".", "NodeService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "search", ".", "ResultSet", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "search", ".", "SearchParameters", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "search", ".", "SearchService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "*;", "import", "org", ".", "alfresco", ".", "service", ".", "namespace", ".", "QName", ";", "import", "org", ".", "alfresco", ".", "util", ".", "Pair", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "WebScriptException", ";", "import", "java", ".", "util", ".", "List", ";", "public", "class", "WorkflowHelper", "{", "private", "static", "WorkflowService", "workflowService", ";", "private", "static", "final", "String", "SEARCH_QUERY", "=", "\"", "TYPE", ":", "\\\"", "bpm", ":", "workflowdefinition", "\\", "\"", "AND", "=", "@", "cm", "\\", "\\:", "name", ":", "\\\"", "ResetPasswordProcess", ".", "bpmn20", ".", "xml", "\\", "\"\"", ";", "private", "static", "final", "String", "DEPLOY_DEFINITION_ERROR", "=", "\"", "Failed", "to", "load", "'", "activiti", "$", "resetPassword", "'", "definition", ":", "file", "'", "ResetPasswordProcess", ".", "bpmn20", ".", "xml", "'", "not", "found", "\"", ";", "private", "static", "final", "QName", "ENGINE_ID", "=", "QName", ".", "createQName", "(", "\"", "http", ":", "//", "www", ".", "alfresco", ".", "org", "/", "model", "/", "bpm", "/", "1", ".", "0", "\"", ",", "\"", "engineId", "\"", ");", "private", "static", "Logger", "logger", "=", "Logger", ".", "getLogger", "(", "WorkflowHelper", ".", "class", ")", ";", "private", "static", "SearchService", "searchService", ";", "private", "static", "Repository", "repository", ";", "private", "static", "NodeService", "nodeService", ";", "public", "static", "void", "cancelPreviousWorkflows", "(", "final", "String", "userName", ")", "{", "Pair", "<", "String", ",", "String", ">", "userTenant", "=", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ";", "final", "String", "tenantDomain", "=", "userTenant", ".", "getSecond", "(", ");", "TenantUtil", ".", "runAsUserTenant", "(", "new", "TenantUtil", ".", "TenantRunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "List", "<", "WorkflowTask", ">", "workflowTasks", "=", "getTasksInProgress", "(", "userName", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Found", "workflow", "tasks", "=", "\"", "+", "workflowTasks", ".", "size", "(", "))", ";", "}", "for", "(", "WorkflowTask", "task", ":", "workflowTasks", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Current", "task", ":", "\"", "+", "task", ".", "getName", "(", "))", ";", "}", "if", "(", "\"", "fs", "-", "reset", ":", "review", "\"", ".", "equals", "(", "task", ".", "getName", "(", "))", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Try", "to", "end", "task", "\"", "+", "task", ".", "toString", "(", "))", ";", "}", "workflowService", ".", "cancelWorkflow", "(", "task", ".", "getPath", "(", ").", "getInstance", "(", ").", "getId", "(", "))", ";", "}", "}", "return", "null", ";", "}", "}", ",", "userName", ",", "tenantDomain", ")", ";", "}", "public", "static", "WorkflowDefinition", "deployResetPasswordWorkflow", "(", ")", "{", "workflowService", ".", "deployDefinition", "(", "getWorkflowDefinitionNodeRef", "(", "))", ";", "return", "workflowService", ".", "getDefinitionByName", "(", "\"", "activiti", "$", "resetPasswordFlex", "\"", ");", "}", "private", "static", "NodeRef", "getWorkflowDefinitionNodeRef", "(", ")", "{", "ResultSet", "results", "=", "null", ";", "try", "{", "results", "=", "searchService", ".", "query", "(", "getSearchParameters", "(", "))", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Result", "length", "\"", "+", "results", ".", "length", "(", "))", ";", "}", "if", "(", "results", ".", "length", "(", ")", "<", "1", ")", "{", "logger", ".", "error", "(", "DEPLOY_DEFINITION_ERROR", ")", ";", "throw", "new", "WebScriptException", "(", "404", ",", "DEPLOY_DEFINITION_ERROR", ")", ";", "}", "NodeRef", "wfDefNode", "=", "results", ".", "getNodeRef", "(", "0", ")", ";", "nodeService", ".", "setProperty", "(", "wfDefNode", ",", "ENGINE_ID", ",", "ActivitiConstants", ".", "ENGINE_ID", ")", ";", "return", "wfDefNode", ";", "}", "finally", "{", "if", "(", "results", "!", "=", "null", ")", "{", "results", ".", "close", "(", ");", "}", "}", "}", "private", "static", "SearchParameters", "getSearchParameters", "(", ")", "{", "SearchParameters", "parameters", "=", "new", "SearchParameters", "(", ");", "parameters", ".", "addStore", "(", "repository", ".", "getCompanyHome", "(", ").", "getStoreRef", "(", "))", ";", "parameters", ".", "setLanguage", "(", "SearchService", ".", "LANGUAGE_FTS_ALFRESCO", ")", ";", "parameters", ".", "setQuery", "(", "SEARCH_QUERY", ")", ";", "return", "parameters", ";", "}", "private", "static", "List", "<", "WorkflowTask", ">", "getTasksInProgress", "(", "String", "userName", ")", "{", "WorkflowTaskQuery", "query", "=", "new", "WorkflowTaskQuery", "(", ");", "query", ".", "setEngineId", "(", "ActivitiConstants", ".", "ENGINE_ID", ")", ";", "query", ".", "setTaskState", "(", "WorkflowTaskState", ".", "IN_PROGRESS", ")", ";", "query", ".", "setActorId", "(", "userName", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Try", "to", "delete", "workflows", ".", "..", "\")", ";", "}", "return", "workflowService", ".", "queryTasks", "(", "query", ",", "true", ")", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "WorkflowHelper", ".", "workflowService", "=", "workflowService", ";", "}", "public", "void", "setSearchService", "(", "SearchService", "searchService", ")", "{", "WorkflowHelper", ".", "searchService", "=", "searchService", ";", "}", "public", "void", "setRepository", "(", "Repository", "repository", ")", "{", "WorkflowHelper", ".", "repository", "=", "repository", ";", "}", "public", "void", "setNodeService", "(", "NodeService", "nodeService", ")", "{", "WorkflowHelper", ".", "nodeService", "=", "nodeService", ";", "}", "}", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "webscripts", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "namespaces", ".", "ResetPasswordNameSpace", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantContextHolder", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantUtil", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowTask", ";", "import", "org", ".", "alfresco", ".", "service", ".", "namespace", ".", "QName", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "org", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "surf", ".", "util", ".", "Content", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "*;", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "ApplyChangedPasswordPost", "extends", "DeclarativeWebScript", "{", "public", "static", "final", "String", "DOMAIN_PROP", "=", "\"", "domain", "\"", ";", "public", "static", "final", "String", "TASK_ID", "=", "\"", "taskId", "\"", ";", "public", "static", "final", "String", "NEW_PAS", "=", "\"", "new", "-", "password", "\"", ";", "public", "static", "final", "String", "NEW_PAS_CONFIRM", "=", "\"", "new", "-", "password", "-", "confirm", "\"", ";", "public", "static", "final", "String", "USER_NAME", "=", "\"", "userName", "\"", ";", "public", "static", "final", "String", "USER_TOKEN", "=", "\"", "userToken", "\"", ";", "private", "WorkflowService", "workflowService", ";", "private", "static", "final", "Logger", "logger", "=", "Logger", ".", "getLogger", "(", "ApplyChangedPasswordPost", ".", "class", ")", ";", "@", "Override", "protected", "Map", "<", "String", ",", "Object", ">", "executeImpl", "(", "WebScriptRequest", "req", ",", "Status", "status", ",", "Cache", "cache", ")", "{", "/", "/", "clear", "context", "-", "to", "avoid", "MT", "concurrency", "issue", "(", "causing", "domain", "mismatch", ")", "AuthenticationUtil", ".", "clearCurrentSecurityContext", "(", ");", "final", "Map", "<", "String", ",", "String", ">", "data", "=", "getDataFromRequest", "(", "req", ")", ";", "TenantUtil", ".", "runAsUserTenant", "(", "new", "TenantUtil", ".", "TenantRunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "data", ".", "get", "(", "DOMAIN_PROP", ")", ");", "WorkflowTask", "task", "=", "workflowService", ".", "getTaskById", "(", "data", ".", "get", "(", "TASK_ID", ")", ");", "final", "Map", "<", "QName", ",", "Serializable", ">", "properties", "=", "task", ".", "getProperties", "(", ");", "properties", ".", "put", "(", "ResetPasswordNameSpace", ".", "QNAME_PASSWORD", ",", "data", ".", "get", "(", "NEW_PAS", ")", ");", "properties", ".", "put", "(", "ResetPasswordNameSpace", ".", "QNAME_CONFIRM_PASS", ",", "data", ".", "get", "(", "NEW_PAS_CONFIRM", ")", ");", "AuthenticationUtil", ".", "runAsSystem", "(", "new", "AuthenticationUtil", ".", "RunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "workflowService", ".", "updateTask", "(", "data", ".", "get", "(", "TASK_ID", ")", ",", "properties", ",", "null", ",", "null", ")", ";", "workflowService", ".", "endTask", "(", "data", ".", "get", "(", "TASK_ID", ")", ",", "null", ")", ";", "return", "null", ";", "}", "}", ");", "return", "null", ";", "}", "}", ",", "data", ".", "get", "(", "USER_NAME", ")", ",", "data", ".", "get", "(", "DOMAIN_PROP", ")", ");", "return", "new", "HashMap", "<", ">(", ");", "}", "private", "Map", "<", "String", ",", "String", ">", "getDataFromRequest", "(", "WebScriptRequest", "req", ")", "{", "HashMap", "<", "String", ",", "String", ">", "result", "=", "new", "HashMap", "<", ">(", ");", "Content", "content", "=", "req", ".", "getContent", "(", ");", "try", "{", "JSONObject", "jsonObject", "=", "new", "JSONObject", "(", "content", ".", "getContent", "(", "))", ";", "String", "userName", "=", "jsonObject", ".", "getString", "(", "USER_TOKEN", ")", ";", "result", ".", "put", "(", "USER_NAME", ",", "userName", ")", ";", "result", ".", "put", "(", "DOMAIN_PROP", ",", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ".", "getSecond", "(", "))", ";", "result", ".", "put", "(", "NEW_PAS", ",", "jsonObject", ".", "getString", "(", "NEW_PAS", ")", ");", "result", ".", "put", "(", "NEW_PAS_CONFIRM", ",", "jsonObject", ".", "getString", "(", "NEW_PAS_CONFIRM", ")", ");", "result", ".", "put", "(", "TASK_ID", ",", "jsonObject", ".", "getString", "(", "TASK_ID", ")", ");", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "e", ")", ";", "throw", "new", "WebScriptException", "(", "\"", "Failed", "to", "get", "data", "from", "request", ".", "Please", ",", "contact", "system", "administrator", "\"", ");", "}", "return", "result", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "this", ".", "workflowService", "=", "workflowService", ";", "}", "}", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "webscripts", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "util", ".", "WorkflowHelper", ";", "import", "org", ".", "alfresco", ".", "model", ".", "ContentModel", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "model", ".", "Repository", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantContextHolder", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "workflow", ".", "WorkflowModel", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "repository", ".", "*;", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "search", ".", "SearchService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "security", ".", "PersonService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "*;", "import", "org", ".", "alfresco", ".", "service", ".", "namespace", ".", "NamespaceService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "namespace", ".", "QName", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "org", ".", "json", ".", "JSONException", ";", "import", "org", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "surf", ".", "util", ".", "Content", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "*;", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "ResetPasswordPost", "extends", "DeclarativeWebScript", "{", "@", "Autowired", "private", "ContentService", "contentService", ";", "@", "Autowired", "private", "NodeService", "nodeService", ";", "@", "Autowired", "private", "Repository", "repository", ";", "@", "Autowired", "private", "SearchService", "searchService", ";", "@", "Autowired", "private", "NamespaceService", "namespaceService", ";", "private", "WorkflowService", "workflowService", ";", "private", "PersonService", "personService", ";", "private", "static", "final", "String", "RESET_PASS_EMAIL_TEMPLATE_XPATH", "=", "\"", "app", ":", "dictionary", "/", "app", ":", "email_templates", "/", "cm", ":", "workflownotification", "/", "cm", ":", "reset", "-", "password", ".", "ftl", "\"", ";", "private", "static", "final", "String", "WORKFLOW_NOTIFICATION_XPATH", "=", "\"", "app", ":", "dictionary", "/", "app", ":", "email_templates", "/", "cm", ":", "workflownotification", "\"", ";", "private", "static", "final", "String", "RESET_PASS_FILE_NAME", "=", "\"", "reset", "-", "password", ".", "ftl", "\"", ";", "private", "static", "final", "Logger", "logger", "=", "Logger", ".", "getLogger", "(", "ResetPasswordPost", ".", "class", ")", ";", "@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "executeImpl", "(", "WebScriptRequest", "req", ",", "Status", "status", ",", "Cache", "cache", ")", "{", "final", "String", "userName", "=", "getUserNameFromRequest", "(", "req", ")", ";", "/", "/", "clear", "context", "-", "to", "avoid", "MT", "concurrency", "issue", "(", "causing", "domain", "mismatch", ")", "AuthenticationUtil", ".", "clearCurrentSecurityContext", "(", ");", "final", "String", "tenantDomain", "=", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ".", "getSecond", "(", ");", "createEmailTemplateIfNotExists", "(", "tenantDomain", ")", ";", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "NodeRef", "user", "=", "getUserByUserName", "(", "userName", ")", ";", "WorkflowHelper", ".", "cancelPreviousWorkflows", "(", "userName", ")", ";", "logger", ".", "debug", "(", "\"", "Try", "to", "start", "workflow", "with", "user", "\"", "+", "userName", ")", ";", "startWorkFlow", "(", "user", ",", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ".", "getSecond", "(", "))", ";", "logger", ".", "debug", "(", "\"", "Workflow", "has", "been", "started", "\"", ");", "return", "null", ";", "}", "private", "void", "createEmailTemplateIfNotExists", "(", "String", "tenantDomain", ")", "{", "AuthenticationUtil", ".", "runAsSystem", "(", "new", "AuthenticationUtil", ".", "RunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "if", "(", "!", "emailTemplateExists", "(", "tenantDomain", ")", "){", "addEmailTemplate", "(", "tenantDomain", ")", ";", "}", "return", "null", ";", "}", "}", ");", "}", "private", "boolean", "emailTemplateExists", "(", "String", "tenantDomain", ")", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "NodeRef", "companyHome", "=", "repository", ".", "getCompanyHome", "(", ");", "List", "<", "NodeRef", ">", "emailTemplateFiles", "=", "searchService", ".", "selectNodes", "(", "companyHome", ",", "RESET_PASS_EMAIL_TEMPLATE_XPATH", ",", "null", ",", "namespaceService", ",", "false", ")", ";", "return", "!", "emailTemplateFiles", ".", "isEmpty", "(", ");", "}", "private", "void", "addEmailTemplate", "(", "String", "tenantDomain", ")", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "NodeRef", "companyHome", "=", "repository", ".", "getCompanyHome", "(", ");", "List", "<", "NodeRef", ">", "workflowNotificationFolder", "=", "searchService", ".", "selectNodes", "(", "companyHome", ",", "WORKFLOW_NOTIFICATION_XPATH", ",", "null", ",", "namespaceService", ",", "false", ")", ";", "Map", "<", "QName", ",", "Serializable", ">", "properties", "=", "new", "HashMap", "<", ">(", ");", "properties", ".", "put", "(", "ContentModel", ".", "PROP_NAME", ",", "RESET_PASS_FILE_NAME", ")", ";", "ChildAssociationRef", "newEmailTemplateCreated", "=", "nodeService", ".", "createNode", "(", "workflowNotificationFolder", ".", "get", "(", "0", ")", ",", "ContentModel", ".", "ASSOC_CONTAINS", ",", "QName", ".", "createQName", "(", "NamespaceService", ".", "CONTENT_MODEL_1_0_URI", ",", "QName", ".", "createValidLocalName", "(", "RESET_PASS_FILE_NAME", ")", "),", "ContentModel", ".", "TYPE_CONTENT", ",", "properties", ")", ";", "ContentWriter", "invWriter", "=", "contentService", ".", "getWriter", "(", "newEmailTemplateCreated", ".", "getChildRef", "(", "),", "ContentModel", ".", "PROP_CONTENT", ",", "true", ")", ";", "String", "adminTenant", "=", "\"", "\";", "TenantContextHolder", ".", "setTenantDomain", "(", "adminTenant", ")", ";", "companyHome", "=", "repository", ".", "getCompanyHome", "(", ");", "List", "<", "NodeRef", ">", "emailTemplateFiles", "=", "searchService", ".", "selectNodes", "(", "companyHome", ",", "RESET_PASS_EMAIL_TEMPLATE_XPATH", ",", "null", ",", "namespaceService", ",", "false", ")", ";", "NodeRef", "emailTemplate", "=", "emailTemplateFiles", ".", "get", "(", "0", ")", ";", "ContentReader", "reader", "=", "contentService", ".", "getReader", "(", "emailTemplate", ",", "ContentModel", ".", "PROP_CONTENT", ")", ";", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "invWriter", ".", "putContent", "(", "reader", ")", ";", "}", "private", "void", "startWorkFlow", "(", "final", "NodeRef", "user", ",", "final", "String", "tenantDomain", ")", "{", "AuthenticationUtil", ".", "runAsSystem", "(", "new", "AuthenticationUtil", ".", "RunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "tenantDomain", ")", ";", "WorkflowDefinition", "workflowDefinition", "=", "workflowService", ".", "getDefinitionByName", "(", "\"", "activiti", "$", "resetPasswordFlex", "\"", ");", "if", "(", "workflowDefinition", "=", "=", "null", ")", "{", "workflowDefinition", "=", "WorkflowHelper", ".", "deployResetPasswordWorkflow", "(", ");", "}", "Map", "<", "QName", ",", "Serializable", ">", "param", "=", "new", "HashMap", "<", ">(", ");", "logger", ".", "debug", "(", "\"", "Try", "to", "set", "assignee", "\"", ");", "param", ".", "put", "(", "WorkflowModel", ".", "ASSOC_ASSIGNEE", ",", "user", ")", ";", "logger", ".", "debug", "(", "\"", "Assignee", ":", "\"", "+", "param", ".", "get", "(", "WorkflowModel", ".", "ASSOC_ASSIGNEE", ")", ");", "logger", ".", "debug", "(", "\"", "Try", "to", "set", "description", "\"", ");", "param", ".", "put", "(", "WorkflowModel", ".", "PROP_DESCRIPTION", ",", "\"", "Request", "to", "change", "password", "\"", ");", "logger", ".", "debug", "(", "\"", "Try", "to", "set", "owner", "\"", ");", "param", ".", "put", "(", "ContentModel", ".", "PROP_OWNER", ",", "user", ")", ";", "logger", ".", "debug", "(", "\"", "Try", "to", "start", "workflow", ".", "..", "\")", ";", "workflowService", ".", "startWorkflow", "(", "workflowDefinition", ".", "getId", "(", "),", "param", ")", ";", "return", "null", ";", "}", "}", ");", "}", "private", "NodeRef", "getUserByUserName", "(", "final", "String", "userName", ")", "{", "return", "AuthenticationUtil", ".", "runAsSystem", "(", "new", "AuthenticationUtil", ".", "RunAsWork", "<", "NodeRef", ">", "()", "{", "@", "Override", "public", "NodeRef", "doWork", "(", ")", "throws", "Exception", "{", "NodeRef", "user", "=", "personService", ".", "getPersonOrNull", "(", "userName", ")", ";", "if", "(", "user", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "Failed", "to", "find", "user", "with", "username", "\"", "+", "userName", ")", ";", "throw", "new", "WebScriptException", "(", "404", ",", "\"", "error", ".", "userNotFound", "\"", ");", "}", "return", "user", ";", "}", "}", ");", "}", "private", "String", "getUserNameFromRequest", "(", "WebScriptRequest", "request", ")", "{", "Content", "content", "=", "request", ".", "getContent", "(", ");", "String", "userName", ";", "try", "{", "JSONObject", "jsonObject", "=", "new", "JSONObject", "(", "content", ".", "getContent", "(", "))", ";", "userName", "=", "jsonObject", ".", "getString", "(", "\"", "userName", "\"", ");", "}", "catch", "(", "JSONException", "|", "IOException", "e", ")", "{", "logger", ".", "error", "(", "e", ")", ";", "throw", "new", "WebScriptException", "(", "500", ",", "\"", "Sorry", ".", "Internal", "error", ".", "Try", "later", "\"", ");", "}", "return", "userName", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "this", ".", "workflowService", "=", "workflowService", ";", "}", "public", "void", "setPersonService", "(", "PersonService", "personService", ")", "{", "this", ".", "personService", "=", "personService", ";", "}", "}", "@", "@", "-", "1", ",", "69", "+", "0", ",", "0", "@", "@", "package", "com", ".", "flexsolution", ".", "resetpassword", ".", "webscripts", ";", "import", "com", ".", "flexsolution", ".", "resetpassword", ".", "namespaces", ".", "ResetPasswordNameSpace", ";", "import", "org", ".", "alfresco", ".", "error", ".", "AlfrescoRuntimeException", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "security", ".", "authentication", ".", "AuthenticationUtil", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantContextHolder", ";", "import", "org", ".", "alfresco", ".", "repo", ".", "tenant", ".", "TenantUtil", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowService", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowTask", ";", "import", "org", ".", "alfresco", ".", "service", ".", "cmr", ".", "workflow", ".", "WorkflowTaskState", ";", "import", "org", ".", "apache", ".", "log4j", ".", "Logger", ";", "import", "org", ".", "json", ".", "JSONException", ";", "import", "org", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "surf", ".", "util", ".", "Content", ";", "import", "org", ".", "springframework", ".", "extensions", ".", "webscripts", ".", "*;", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "TaskIsCompletePost", "extends", "DeclarativeWebScript", "{", "private", "WorkflowService", "workflowService", ";", "private", "static", "final", "Logger", "logger", "=", "Logger", ".", "getLogger", "(", "TaskIsCompletePost", ".", "class", ")", ";", "@", "Override", "protected", "Map", "<", "String", ",", "Object", ">", "executeImpl", "(", "WebScriptRequest", "req", ",", "Status", "status", ",", "Cache", "cache", ")", "{", "/", "/", "clear", "context", "-", "to", "avoid", "MT", "concurrency", "issue", "(", "causing", "domain", "mismatch", ")", "AuthenticationUtil", ".", "clearCurrentSecurityContext", "(", ");", "Content", "content", "=", "req", ".", "getContent", "(", ");", "try", "{", "final", "JSONObject", "jsonObject", "=", "new", "JSONObject", "(", "content", ".", "getContent", "(", "))", ";", "final", "String", "userName", "=", "jsonObject", ".", "getString", "(", "\"", "user", "\"", ");", "final", "String", "domain", "=", "AuthenticationUtil", ".", "getUserTenant", "(", "userName", ")", ".", "getSecond", "(", ");", "TenantUtil", ".", "runAsUserTenant", "(", "new", "TenantUtil", ".", "TenantRunAsWork", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "doWork", "(", ")", "throws", "Exception", "{", "TenantContextHolder", ".", "setTenantDomain", "(", "domain", ")", ";", "WorkflowTask", "task", "=", "workflowService", ".", "getTaskById", "(", "jsonObject", ".", "getString", "(", "\"", "taskId", "\"", "))", ";", "if", "(", "task", "=", "=", "null", "|", "|", "task", ".", "getState", "(", ").", "equals", "(", "WorkflowTaskState", ".", "COMPLETED", ")", "|", "|", "!", "task", ".", "getProperties", "(", ").", "get", "(", "ResetPasswordNameSpace", ".", "QNAME_TOKEN", ")", ".", "equals", "(", "jsonObject", ".", "getString", "(", "\"", "token", "\"", "))", "){", "logger", ".", "warn", "(", "\"", "Invalid", "'", "change", "password", "'", "request", "received", "\"", ");", "if", "(", "task", "!", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "Details", "can", "be", "found", "in", "this", "task", ":", "\"", "+", "task", ".", "toString", "(", "))", ";", "}", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Request", "to", "change", "password", "is", "not", "valid", "\"", ");", "}", "return", "null", ";", "}", "}", ",", "userName", ",", "domain", ")", ";", "}", "catch", "(", "JSONException", "|", "IOException", "e", ")", "{", "logger", ".", "error", "(", "e", ")", ";", "throw", "new", "AlfrescoRuntimeException", "(", "\"", "Failed", "to", "retrieve", "data", "from", "json", "\"", ");", "}", "return", "null", ";", "}", "public", "void", "setWorkflowService", "(", "WorkflowService", "workflowService", ")", "{", "this", ".", "workflowService", "=", "workflowService", ";", "}", "}"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["Convert", "snd-page-alloc", "proc", "file", "to", "use", "seq_file", "Use", "seq_file", "for", "the", "proc", "file", "read/write", "of", "snd-page-alloc", "module.", "This", "automatically", "fixes", "bugs", "in", "the", "old", "proc", "code.", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "include", "<", "linux", "/", "seq_file", ".", "h", ">", "static", "int", "snd_mem_proc_read", "(", "struct", "seq_file", "*", "seq", ",", "void", "*", "offset", ")", "seq_printf", "(", "seq", ",", "\"", "pages", ":", "%", "li", "bytes", "(", "%", "li", "pages", "per", "%", "likB", ")", "\\", "n", "\"", ",", "pages", "*", "PAGE_SIZE", ",", "pages", ",", "PAGE_SIZE", "/", "1024", ")", ";", "seq_printf", "(", "seq", ",", "\"", "buffer", "%", "d", ":", "ID", "%", "08x", ":", "type", "%", "s", "\\", "n", "\"", ",", "devno", ",", "mem", "-", ">", "id", ",", "types", "[", "mem", "-", ">", "buffer", ".", "dev", ".", "type", "]", ");", "seq_printf", "(", "seq", ",", "\"", "addr", "=", "0x", "%", "lx", ",", "size", "=", "%", "d", "bytes", "\\", "n", "\"", ",", "(", "unsigned", "long", ")", "mem", "-", ">", "buffer", ".", "addr", ",", "(", "int", ")", "mem", "-", ">", "buffer", ".", "bytes", ")", ";", "return", "0", ";", "}", "static", "int", "snd_mem_proc_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "return", "single_open", "(", "file", ",", "snd_mem_proc_read", ",", "NULL", ")", ";", "static", "ssize_t", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "if", "(", "count", ">", "sizeof", "(", "buf", ")", "-", "1", ")", "return", "-", "EINVAL", ";", "buf", "[", "count", "]", "=", "'", "\\", "0", "'", ";", "return", "count", ";", "return", "count", ";", "return", "count", ";", "return", "count", ";", "return", "count", ";", "static", "const", "struct", "file_operations", "snd_mem_proc_fops", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "open", "=", "snd_mem_proc_open", ",", ".", "read", "=", "seq_read", ",", "#", "ifdef", "CONFIG_PCI", ".", "write", "=", "snd_mem_proc_write", ",", "#", "endif", ".", "llseek", "=", "seq_lseek", ",", ".", "release", "=", "single_release", ",", "}", ";", "if", "(", "snd_mem_proc", ")", "snd_mem_proc", "-", ">", "proc_fops", "=", "&", "snd_mem_proc_fops", ";</s>static", "int", "snd_mem_proc_read", "(", "char", "*", "page", ",", "char", "*", "*", "start", ",", "off_t", "off", ",", "int", "count", ",", "int", "*", "eof", ",", "void", "*", "data", ")", "int", "len", "=", "0", ";", "len", "+", "=", "snprintf", "(", "page", "+", "len", ",", "count", "-", "len", ",", "\"", "pages", ":", "%", "li", "bytes", "(", "%", "li", "pages", "per", "%", "likB", ")", "\\", "n", "\"", ",", "pages", "*", "PAGE_SIZE", ",", "pages", ",", "PAGE_SIZE", "/", "1024", ")", ";", "len", "+", "=", "snprintf", "(", "page", "+", "len", ",", "count", "-", "len", ",", "\"", "buffer", "%", "d", ":", "ID", "%", "08x", ":", "type", "%", "s", "\\", "n", "\"", ",", "devno", ",", "mem", "-", ">", "id", ",", "types", "[", "mem", "-", ">", "buffer", ".", "dev", ".", "type", "]", ");", "len", "+", "=", "snprintf", "(", "page", "+", "len", ",", "count", "-", "len", ",", "\"", "addr", "=", "0x", "%", "lx", ",", "size", "=", "%", "d", "bytes", "\\", "n", "\"", ",", "(", "unsigned", "long", ")", "mem", "-", ">", "buffer", ".", "addr", ",", "(", "int", ")", "mem", "-", ">", "buffer", ".", "bytes", ")", ";", "return", "len", ";", "static", "int", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "unsigned", "long", "count", ",", "void", "*", "data", ")", "if", "(", "count", ">", "ARRAY_SIZE", "(", "buf", ")", "-", "1", ")", "count", "=", "ARRAY_SIZE", "(", "buf", ")", "-", "1", ";", "buf", "[", "ARRAY_SIZE", "(", "buf", ")", "-", "1", "]", "=", "'", "\\", "0", "'", ";", "return", "(", "int", ")", "count", ";", "return", "(", "int", ")", "count", ";", "return", "(", "int", ")", "count", ";", "return", "(", "int", ")", "count", ";", "return", "(", "int", ")", "count", ";", "if", "(", "snd_mem_proc", ")", "{", "snd_mem_proc", "-", ">", "read_proc", "=", "snd_mem_proc_read", ";", "#", "ifdef", "CONFIG_PCI", "snd_mem_proc", "-", ">", "write_proc", "=", "snd_mem_proc_write", ";", "#", "endif", "}"], "docstring_tokens": ["does", "not", "return", "the", "correct", "write", "size"]}
{"contents": ["[OPENMEETINGS-1355]", "random", "UUID", "is", "used", "to", "generate", "password", "reset", "hash"], "code_tokens": ["import", "java", ".", "util", ".", "UUID", ";", "us", ".", "setResethash", "(", "UUID", ".", "randomUUID", "(", ").", "toString", "(", "))", ";</s>import", "java", ".", "util", ".", "Date", ";", "import", "org", ".", "apache", ".", "openmeetings", ".", "util", ".", "crypt", ".", "ManageCryptStyle", ";", "String", "loginData", "=", "us", ".", "getLogin", "(", ")", "+", "new", "Date", "(", ");", "us", ".", "setResethash", "(", "ManageCryptStyle", ".", "getInstanceOfCrypt", "(", ").", "createPassPhrase", "(", "loginData", ")", ");"], "docstring_tokens": ["generates", "predictable", "password", "reset", "tokens"]}
{"contents": ["HttpRange", "validates", "requested", "ranges", "Issue:", "SPR-17318"], "code_tokens": ["*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "/", "**", "Maximum", "ranges", "per", "request", ".", "*", "/", "private", "static", "final", "int", "MAX_RANGES", "=", "100", ";", "long", "contentLength", "=", "getLengthFor", "(", "resource", ")", ";", "long", "start", "=", "getRangeStart", "(", "contentLength", ")", ";", "long", "end", "=", "getRangeEnd", "(", "contentLength", ")", ";", "return", "new", "ResourceRegion", "(", "resource", ",", "start", ",", "end", "-", "start", "+", "1", ")", ";", "}", "private", "static", "long", "getLengthFor", "(", "Resource", "resource", ")", "{", "long", "contentLength", ";", "contentLength", "=", "resource", ".", "contentLength", "(", ");", "throw", "new", "IllegalArgumentException", "(", "\"", "Failed", "to", "obtain", "Resource", "content", "length", "\"", ",", "ex", ")", ";", "return", "contentLength", ";", "*", "@", "throws", "IllegalArgumentException", "if", "the", "string", "cannot", "be", "parsed", ",", "or", "if", "*", "the", "number", "of", "ranges", "is", "greater", "than", "100", ".", "Assert", ".", "isTrue", "(", "tokens", ".", "length", "<", "=", "MAX_RANGES", ",", "(", ")", "-", ">", "\"", "Too", "many", "ranges", "\"", "+", "tokens", ".", "length", ")", ";", "*", "@", "throws", "IllegalArgumentException", "if", "the", "sum", "of", "all", "ranges", "exceeds", "the", "*", "resource", "length", ".", "if", "(", "ranges", ".", "size", "(", ")", ">", "1", ")", "{", "long", "length", "=", "getLengthFor", "(", "resource", ")", ";", "long", "total", "=", "regions", ".", "stream", "(", ").", "map", "(", "ResourceRegion", ":", ":", "getCount", ")", ".", "reduce", "(", "0L", ",", "(", "count", ",", "sum", ")", "-", ">", "sum", "+", "count", ")", ";", "Assert", ".", "isTrue", "(", "total", "<", "length", ",", "(", ")", "-", ">", "\"", "The", "sum", "of", "all", "ranges", "(", "\"", "+", "total", "+", "\"", ")", "\"", "\"", "should", "be", "less", "than", "the", "resource", "length", "(", "\"", "+", "length", "+", "\"", ")\"", ");", "}", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "stream", ".", "Stream", ";", "@", "Test", "public", "void", "parseRangesValidations", "(", ")", "{", "/", "/", "1", ".", "At", "limit", ".", ".", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "\"", "bytes", "=", "0", "-", "0", "\"", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "99", ";", "i", "+", "+)", "{", "sb", ".", "append", "(", "\",", "\")", ".", "append", "(", "i", ")", ".", "append", "(", "\"-", "\")", ".", "append", "(", "i", "+", "1", ")", ";", "}", "List", "<", "HttpRange", ">", "ranges", "=", "HttpRange", ".", "parseRanges", "(", "sb", ".", "toString", "(", "))", ";", "assertEquals", "(", "100", ",", "ranges", ".", "size", "(", "))", ";", "/", "/", "2", ".", "Above", "limit", ".", ".", "sb", "=", "new", "StringBuilder", "(", "\"", "bytes", "=", "0", "-", "0", "\"", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "100", ";", "i", "+", "+)", "{", "sb", ".", "append", "(", "\",", "\")", ".", "append", "(", "i", ")", ".", "append", "(", "\"-", "\")", ".", "append", "(", "i", "+", "1", ")", ";", "}", "try", "{", "HttpRange", ".", "parseRanges", "(", "sb", ".", "toString", "(", "))", ";", "fail", "(", ");", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "/", "/", "Expected", "}", "}", "@", "Test", "public", "void", "toResourceRegionsValidations", "(", ")", "{", "byte", "[", "]", "bytes", "=", "\"", "12345", "\"", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "ByteArrayResource", "resource", "=", "new", "ByteArrayResource", "(", "bytes", ")", ";", "/", "/", "1", ".", "Below", "length", "List", "<", "HttpRange", ">", "ranges", "=", "HttpRange", ".", "parseRanges", "(", "\"", "bytes", "=", "0", "-", "1", ",", "2", "-", "3", "\"", ");", "List", "<", "ResourceRegion", ">", "regions", "=", "HttpRange", ".", "toResourceRegions", "(", "ranges", ",", "resource", ")", ";", "assertEquals", "(", "2", ",", "regions", ".", "size", "(", "))", ";", "/", "/", "2", ".", "At", "length", "ranges", "=", "HttpRange", ".", "parseRanges", "(", "\"", "bytes", "=", "0", "-", "1", ",", "2", "-", "4", "\"", ");", "try", "{", "HttpRange", ".", "toResourceRegions", "(", "ranges", ",", "resource", ")", ";", "fail", "(", ");", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "/", "/", "Expected", ".", ".", "}", "}</s>*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "long", "contentLength", "=", "resource", ".", "contentLength", "(", ");", "long", "start", "=", "getRangeStart", "(", "contentLength", ")", ";", "long", "end", "=", "getRangeEnd", "(", "contentLength", ")", ";", "return", "new", "ResourceRegion", "(", "resource", ",", "start", ",", "end", "-", "start", "+", "1", ")", ";", "throw", "new", "IllegalArgumentException", "(", "\"", "Failed", "to", "convert", "Resource", "to", "ResourceRegion", "\"", ",", "ex", ")", ";", "*", "@", "throws", "IllegalArgumentException", "if", "the", "string", "cannot", "be", "parsed", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", "."], "docstring_tokens": ["improper", "handling", "of", "range", "request"]}
{"contents": ["ipv6:", "only", "static", "routes", "qualify", "for", "equal", "cost", "multipathing", "Static", "routes", "in", "this", "case", "are", "non-expiring", "routes", "which", "did", "not", "get", "configured", "by", "autoconf", "or", "by", "icmpv6", "redirects.", "To", "make", "sure", "we", "actually", "get", "an", "ecmp", "route", "while", "searching", "for", "the", "first", "one", "in", "this", "fib6_node's", "leafs,", "also", "make", "sure", "it", "matches", "the", "ecmp", "route", "assumptions.", "v2:", "a)", "Removed", "RTF_EXPIRE", "check", "in", "dst.from", "chain.", "The", "check", "of", "RTF_ADDRCONF", "already", "ensures", "that", "this", "route,", "even", "if", "added", "again", "without", "RTF_EXPIRES", "(in", "case", "of", "a", "RA", "announcement", "with", "infinite", "timeout),", "does", "not", "cause", "the", "rt6i_nsiblings", "logic", "to", "go", "wrong", "if", "a", "later", "RA", "updates", "the", "expiration", "time", "later.", "v3:", "a)", "Allow", "RTF_EXPIRES", "routes", "to", "enter", "the", "ecmp", "route", "set.", "We", "have", "to", "do", "so,", "because", "an", "pmtu", "event", "could", "update", "the", "RTF_EXPIRES", "flag", "and", "we", "would", "not", "count", "this", "route,", "if", "another", "route", "joins", "this", "set.", "We", "now", "filter", "only", "for", "RTF_GATEWAY|RTF_ADDRCONF|RTF_DYNAMIC,", "which", "are", "flags", "that", "don't", "get", "changed", "after", "rt6_info", "construction.", "Cc:", "Nicolas", "Dichtel", "<nicolas.dichtel@6wind.com>", "Signed-off-by:", "Hannes", "Frederic", "Sowa", "<hannes@stressinduktion.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["static", "inline", "bool", "rt6_qualify_for_ecmp", "(", "struct", "rt6_info", "*", "rt", ")", "{", "return", "(", "rt", "-", ">", "rt6i_flags", "&", "(", "RTF_GATEWAY", "|", "RTF_ADDRCONF", "|", "RTF_DYNAMIC", ")", ")", "=", "=", "RTF_GATEWAY", ";", "}", "bool", "rt_can_ecmp", "=", "rt6_qualify_for_ecmp", "(", "rt", ")", ";", "if", "(", "rt_can_ecmp", "&", "&", "rt6_qualify_for_ecmp", "(", "iter", ")", ")", "if", "(", "sibling", "-", ">", "rt6i_metric", "=", "=", "rt", "-", ">", "rt6i_metric", "&", "&", "rt6_qualify_for_ecmp", "(", "sibling", ")", ")", "{</s>if", "(", "rt", "-", ">", "rt6i_flags", "&", "RTF_GATEWAY", "&", "&", "!", "(", "rt", "-", ">", "rt6i_flags", "&", "RTF_EXPIRES", ")", "&", "&", "!", "(", "iter", "-", ">", "rt6i_flags", "&", "RTF_EXPIRES", ")", ")", "if", "(", "sibling", "-", ">", "rt6i_metric", "=", "=", "rt", "-", ">", "rt6i_metric", ")", "{"], "docstring_tokens": ["the", "improper", "handling", "of", "Router", "Advertisement", "(RA", ")", "messages"]}
{"contents": ["Bluetooth:", "l2cap", "and", "rfcomm:", "fix", "1", "byte", "infoleak", "to", "userspace.", "Structures", "\"l2cap_conninfo\"", "and", "\"rfcomm_conninfo\"", "have", "one", "padding", "byte", "each.", "This", "byte", "in", "\"cinfo\"", "is", "copied", "to", "userspace", "uninitialized.", "Signed-off-by:", "Filip", "Palian", "<filip.palian@pjwstk.edu.pl>", "Acked-by:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Signed-off-by:", "Gustavo", "F.", "Padovan", "<padovan@profusion.mobi>"], "code_tokens": ["memset", "(", "&", "cinfo", ",", "0", ",", "sizeof", "(", "cinfo", ")", ");", "memset", "(", "&", "cinfo", ",", "0", ",", "sizeof", "(", "cinfo", ")", ");</s>"], "docstring_tokens": ["does", "not", "properly", "initialize", "certain", "data", "structures"]}
{"contents": ["Consistent", "encoded", "path", "evaluation", "in", "reactive", "ResourceWebHandler", "and", "co", "Issue:", "SPR-16616"], "code_tokens": ["*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "return", "(", "resourcePath", ".", "startsWith", "(", "locationPath", ")", "&", "&", "!", "isInvalidEncodedPath", "(", "resourcePath", ")", ");", "}", "private", "boolean", "isInvalidEncodedPath", "(", "String", "resourcePath", ")", "{", "try", "{", "String", "decodedPath", "=", "URLDecoder", ".", "decode", "(", "resourcePath", ",", "\"", "UTF", "-", "8", "\"", ");", "return", "(", "decodedPath", ".", "contains", "(", "\".", "./", "\")", "|", "|", "decodedPath", ".", "contains", "(", "\".", ".\\", "\\\"", "))", ";", "}", "catch", "(", "UnsupportedEncodingException", "ex", ")", "{", "/", "/", "Should", "never", "happen", ".", "..", "return", "false", ";", "if", "(", "isInvalidEncodedPath", "(", "path", ")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Ignoring", "invalid", "resource", "path", "with", "escape", "sequences", "[", "\"", "+", "path", "+", "\"", "]\"", ");", "return", "Mono", ".", "empty", "(", ");", "/", "**", "*", "Check", "whether", "the", "given", "path", "contains", "invalid", "escape", "sequences", ".", "*", "@", "param", "path", "the", "path", "to", "validate", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "path", "is", "invalid", ",", "{", "@", "code", "false", "}", "otherwise", "*", "/", "private", "boolean", "isInvalidEncodedPath", "(", "String", "path", ")", "{", "if", "(", "path", ".", "contains", "(", "\"%", "\")", ")", "{", "try", "{", "/", "/", "Use", "URLDecoder", "(", "vs", "UriUtils", ")", "to", "preserve", "potentially", "decoded", "UTF", "-", "8", "chars", "String", "decodedPath", "=", "URLDecoder", ".", "decode", "(", "path", ",", "\"", "UTF", "-", "8", "\"", ");", "if", "(", "isInvalidPath", "(", "decodedPath", ")", ")", "{", "return", "true", ";", "}", "decodedPath", "=", "processPath", "(", "decodedPath", ")", ";", "if", "(", "isInvalidPath", "(", "decodedPath", ")", ")", "{", "return", "true", ";", "}", "}", "catch", "(", "IllegalArgumentException", "|", "UnsupportedEncodingException", "ex", ")", "{", "/", "/", "Should", "never", "happen", ".", "..", "}", "}", "return", "false", ";", "}</s>*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "if", "(", "!", "resourcePath", ".", "startsWith", "(", "locationPath", ")", ")", "{", "return", "false", ";", "}", "if", "(", "URLDecoder", ".", "decode", "(", "resourcePath", ",", "\"", "UTF", "-", "8", "\"", ").", "contains", "(", "\".", "./", "\")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Resolved", "resource", "path", "contains", "\\", "\".", "./", "\\\"", "after", "decoding", ":", "\"", "+", "resourcePath", ")", ";", "}", "return", "false", ";", "return", "true", ";", "import", "reactor", ".", "core", ".", "Exceptions", ";", "if", "(", "path", ".", "contains", "(", "\"%", "\")", ")", "{", "try", "{", "/", "/", "Use", "URLDecoder", "(", "vs", "UriUtils", ")", "to", "preserve", "potentially", "decoded", "UTF", "-", "8", "chars", "String", "decodedPath", "=", "URLDecoder", ".", "decode", "(", "path", ",", "\"", "UTF", "-", "8", "\"", ");", "if", "(", "isInvalidPath", "(", "decodedPath", ")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Ignoring", "invalid", "resource", "path", "with", "escape", "sequences", "[", "\"", "+", "path", "+", "\"", "].", "\")", ";", "}", "return", "Mono", ".", "empty", "(", ");", "}", "decodedPath", "=", "processPath", "(", "decodedPath", ")", ";", "if", "(", "isInvalidPath", "(", "decodedPath", ")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Ignoring", "invalid", "resource", "path", "with", "escape", "sequences", "[", "\"", "+", "path", "+", "\"", "].", "\")", ";", "}", "return", "Mono", ".", "empty", "(", ");", "}", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "/", "/", "ignore", "}", "catch", "(", "UnsupportedEncodingException", "ex", ")", "{", "return", "Mono", ".", "error", "(", "Exceptions", ".", "propagate", "(", "ex", ")", ");"], "docstring_tokens": ["improper", "validation", "of", "user", "request"]}
{"contents": ["Escape", "output", "[#153420213]", "https://www.pivotaltracker.com/story/show/153420213", "Signed-off-by:", "Filip", "Hanik", "<fhanik@pivotal.io>"], "code_tokens": ["import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "JsonUtils", ";", "model", ".", "addAttribute", "(", "\"", "clientId", "\"", ",", "escape", "(", "clientId", ")", ");", "model", ".", "addAttribute", "(", "\"", "messageOrigin", "\"", ",", "escape", "(", "messageOrigin", ")", ");", "private", "String", "escape", "(", "String", "s", ")", "{", "return", "JsonUtils", ".", "writeValueAsString", "(", "s", ")", ";", "}", "var", "origin", "=", "[", "[$", "{", "messageOrigin", "}", "]]", ";", "var", "expectedClientId", "=", "[", "[$", "{", "clientId", "}", "]]", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "containsString", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "model", ";", "public", "void", "sessionController_escapesClientIdValue", "(", ")", "throws", "Exception", "{", "String", "input", "=", "\"", "1", "'", "\\\"", "\";", ".", "param", "(", "\"", "clientId", "\"", ",", "input", ")", ".", "andExpect", "(", "view", "(", ").", "name", "(", "\"", "session", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ".", "andExpect", "(", "model", "(", ").", "size", "(", "2", ")", ")", ".", "andExpect", "(", "model", "(", ").", "attribute", "(", "\"", "clientId", "\"", ",", "\"", "\\\"", "1", "'", "\\\\", "\\\"", "\\\"", "\")", ")", ".", "andExpect", "(", "content", "(", ").", "string", "(", "containsString", "(", "\"\\", "\"", "1", "'", "\\\\", "\\\"", "\\\"", "\")", "))", ";", "}", "@", "Test", "public", "void", "sessionController_escapesMessageOriginValue", "(", ")", "throws", "Exception", "{", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "session", "\"", ")", ".", "param", "(", "\"", "clientId", "\"", ",\"", "1", "\"", ")", ".", "param", "(", "\"", "messageOrigin", "\"", ",", "\"", "origin", "\\", "\"\"", "))", ".", "andExpect", "(", "view", "(", ").", "name", "(", "\"", "session", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ".", "andExpect", "(", "model", "(", ").", "attribute", "(", "\"", "messageOrigin", "\"", ",", "\"", "\\\"", "origin", "\\", "\\\\", "\"\\", "\"\"", "))", ".", "andExpect", "(", "content", "(", ").", "string", "(", "containsString", "(", "\"\\", "\"", "origin", "\\", "\\\\", "\"\\", "\"\"", "))", ");</s>model", ".", "addAttribute", "(", "\"", "clientId", "\"", ",", "clientId", ")", ";", "model", ".", "addAttribute", "(", "\"", "messageOrigin", "\"", ",", "messageOrigin", ")", ";", "var", "origin", "=", "'", "[[", "${", "messageOrigin", "}", "]]", "';", "var", "expectedClientId", "=", "'", "[[", "${", "clientId", "}", "]]", "';", "public", "void", "sessionControllerReturnsSessionView", "(", ")", "throws", "Exception", "{", ".", "param", "(", "\"", "clientId", "\"", ",\"", "1", "\"", ")", ".", "andExpect", "(", "view", "(", ").", "name", "(", "\"", "session", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["drm/radeon/kms:", "check", "AA", "resolve", "registers", "on", "r300", "This", "is", "an", "important", "security", "fix", "because", "we", "allowed", "arbitrary", "values", "to", "be", "passed", "to", "AARESOLVE_OFFSET.", "This", "also", "puts", "the", "right", "buffer", "address", "in", "the", "register.", "Signed-off-by:", "Marek", "Ol\u0161\u00e1k", "<maraeo@gmail.com>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["if", "(", "track", "-", ">", "aa_dirty", "&", "&", "track", "-", ">", "aaresolve", ")", "{", "if", "(", "track", "-", ">", "aa", ".", "robj", "=", "=", "NULL", ")", "{", "DRM_ERROR", "(", "\"[", "drm", "]", "No", "buffer", "for", "AA", "resolve", "buffer", "%", "d", "!", "\\", "n", "\"", ",", "i", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "I", "believe", "the", "format", "comes", "from", "colorbuffer0", ".", "*", "/", "size", "=", "track", "-", ">", "aa", ".", "pitch", "*", "track", "-", ">", "cb", "[", "0", "]", ".", "cpp", "*", "track", "-", ">", "maxy", ";", "size", "+", "=", "track", "-", ">", "aa", ".", "offset", ";", "if", "(", "size", ">", "radeon_bo_size", "(", "track", "-", ">", "aa", ".", "robj", ")", ")", "{", "DRM_ERROR", "(", "\"[", "drm", "]", "Buffer", "too", "small", "for", "AA", "resolve", "buffer", "%", "d", "\"", "\"", "(", "need", "%", "lu", "have", "%", "lu", ")", "!", "\\", "n", "\"", ",", "i", ",", "size", ",", "radeon_bo_size", "(", "track", "-", ">", "aa", ".", "robj", ")", ");", "DRM_ERROR", "(", "\"[", "drm", "]", "AA", "resolve", "buffer", "%", "d", "(", "%", "u", "%", "u", "%", "u", "%", "u", ")", "\\", "n", "\"", ",", "i", ",", "track", "-", ">", "aa", ".", "pitch", ",", "track", "-", ">", "cb", "[", "0", "]", ".", "cpp", ",", "track", "-", ">", "aa", ".", "offset", ",", "track", "-", ">", "maxy", ")", ";", "return", "-", "EINVAL", ";", "}", "}", "track", "-", ">", "aa_dirty", "=", "false", ";", "track", "-", ">", "aa_dirty", "=", "true", ";", "track", "-", ">", "aaresolve", "=", "true", ";", "track", "-", ">", "aa", ".", "robj", "=", "NULL", ";", "struct", "r100_cs_track_cb", "aa", ";", "bool", "aa_dirty", ";", "bool", "aaresolve", ";", "case", "R300_RB3D_AARESOLVE_OFFSET", ":", "r", "=", "r100_cs_packet_next_reloc", "(", "p", ",", "&", "reloc", ")", ";", "if", "(", "r", ")", "{", "DRM_ERROR", "(", "\"", "No", "reloc", "for", "ib", "[", "%", "d", "]", "=", "0x", "%", "04X", "\\", "n", "\"", ",", "idx", ",", "reg", ")", ";", "r100_cs_dump_packet", "(", "p", ",", "pkt", ")", ";", "return", "r", ";", "}", "track", "-", ">", "aa", ".", "robj", "=", "reloc", "-", ">", "robj", ";", "track", "-", ">", "aa", ".", "offset", "=", "idx_value", ";", "track", "-", ">", "aa_dirty", "=", "true", ";", "ib", "[", "idx", "]", "=", "idx_value", "+", "(", "(", "u32", ")", "reloc", "-", ">", "lobj", ".", "gpu_offset", ")", ";", "break", ";", "case", "R300_RB3D_AARESOLVE_PITCH", ":", "track", "-", ">", "aa", ".", "pitch", "=", "idx_value", "&", "0x3FFE", ";", "track", "-", ">", "aa_dirty", "=", "true", ";", "break", ";", "case", "R300_RB3D_AARESOLVE_CTL", ":", "track", "-", ">", "aaresolve", "=", "idx_value", "&", "0x1", ";", "track", "-", ">", "aa_dirty", "=", "true", ";", "break", ";", "#", "define", "R300_RB3D_AARESOLVE_OFFSET", "0x4E80", "#", "define", "R300_RB3D_AARESOLVE_PITCH", "0x4E84</s>0x4E80", "RB3D_AARESOLVE_OFFSET", "0x4E84", "RB3D_AARESOLVE_PITCH", "0x4E88", "RB3D_AARESOLVE_CTL", "0x4E80", "RB3D_AARESOLVE_OFFSET", "0x4E84", "RB3D_AARESOLVE_PITCH", "0x4E88", "RB3D_AARESOLVE_CTL", "0x4E80", "RB3D_AARESOLVE_OFFSET", "0x4E84", "RB3D_AARESOLVE_PITCH", "0x4E88", "RB3D_AARESOLVE_CTL", "0x4E80", "RB3D_AARESOLVE_OFFSET", "0x4E84", "RB3D_AARESOLVE_PITCH", "0x4E88", "RB3D_AARESOLVE_CTL"], "docstring_tokens": ["the", "improper", "validation", "of", "input", "passed", "to", "the", "AARESOLVE_OFFSET", "registers"]}
{"contents": ["mnt:", "Fail", "collect_mounts", "when", "applied", "to", "unmounted", "mounts", "The", "only", "users", "of", "collect_mounts", "are", "in", "audit_tree.c", "In", "audit_trim_trees", "and", "audit_add_tree_rule", "the", "path", "passed", "into", "collect_mounts", "is", "generated", "from", "kern_path", "passed", "an", "audit_tree", "pathname", "which", "is", "guaranteed", "to", "be", "an", "absolute", "path.", "In", "those", "cases", "collect_mounts", "is", "obviously", "intended", "to", "work", "on", "mounted", "paths", "and", "if", "a", "race", "results", "in", "paths", "that", "are", "unmounted", "when", "collect_mounts", "it", "is", "reasonable", "to", "fail", "early.", "The", "paths", "passed", "into", "audit_tag_tree", "don't", "have", "the", "absolute", "path", "check.", "But", "are", "used", "to", "play", "with", "fsnotify", "and", "otherwise", "interact", "with", "the", "audit_trees,", "so", "again", "operating", "only", "on", "mounted", "paths", "appears", "reasonable.", "Avoid", "having", "to", "worry", "about", "what", "happens", "when", "we", "try", "and", "audit", "unmounted", "filesystems", "by", "restricting", "collect_mounts", "to", "mounts", "that", "appear", "in", "the", "mount", "tree.", "Signed-off-by:", "\"Eric", "W.", "Biederman\"", "<ebiederm@xmission.com>"], "code_tokens": ["if", "(", "!", "check_mnt", "(", "real_mount", "(", "path", "-", ">", "mnt", ")", "))", "tree", "=", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "else", "tree", "=", "copy_tree", "(", "real_mount", "(", "path", "-", ">", "mnt", ")", ",", "path", "-", ">", "dentry", ",", "CL_COPY_ALL", "|", "CL_PRIVATE", ")", ";</s>tree", "=", "copy_tree", "(", "real_mount", "(", "path", "-", ">", "mnt", ")", ",", "path", "-", ">", "dentry", ",", "CL_COPY_ALL", "|", "CL_PRIVATE", ")", ";"], "docstring_tokens": ["does", "not", "properly", "consider", "that", "it", "may", "execute", "after", "a", "path", "has", "been", "unmounted"]}
{"contents": ["Staging:", "sb105x:", "info", "leak", "in", "mp_get_count()", "The", "icount.reserved[]", "array", "isn't", "initialized", "so", "it", "leaks", "stack", "information", "to", "userspace.", "Reported-by:", "Nico", "Golde", "<nico@ngolde.de>", "Reported-by:", "Fabian", "Yamaguchi", "<fabs@goesec.de>", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["struct", "serial_icounter_struct", "icount", "=", "{", "};</s>struct", "serial_icounter_struct", "icount", ";"], "docstring_tokens": ["the", "failure", "to", "initialize", "a", "certain", "data", "structure"]}
{"contents": ["Fixed", "bug", "#66060", "(Heap", "buffer", "over-read", "in", "DateInterval)"], "code_tokens": ["-", "Date", ":", ".", "Fixed", "bug", "#", "66060", "(", "Heap", "buffer", "over", "-", "read", "in", "DateInterval", ")", ".", "(", "Remi", ")", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "5", "on", "Wed", "Nov", "27", "11", ":", "10", ":", "58", "2013", "*", "/", "+", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "}", "while", "(", "!", "s", "-", ">", "errors", "-", ">", "error_count", "&", "&", "*", "ptr", ")", ";", "}", "while", "(", "!", "s", "-", ">", "errors", "-", ">", "error_count", "&", "&", "*", "ptr", ")", ";</s>-", "Core", ":", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "5", "on", "Mon", "Dec", "5", "22", ":", "02", ":", "27", "2011", "*", "/", "}", "while", "(", "*", "ptr", ")", ";", "}", "while", "(", "*", "ptr", ")", ";"], "docstring_tokens": ["does", "not", "properly", "restrict", "creation", "of", "DateInterval", "objects"]}
{"contents": ["Introduce", "HandlerMapping", "introspection", "API", "Issue:", "SPR-14321"], "code_tokens": ["import", "org", ".", "springframework", ".", "web", ".", "HttpRequestHandler", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfiguration", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfigurationSource", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsProcessor", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "DefaultCorsProcessor", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "UrlBasedCorsConfigurationSource", ";", "private", "class", "PreFlightHandler", "implements", "HttpRequestHandler", ",", "CorsConfigurationSource", "{", "@", "Override", "public", "CorsConfiguration", "getCorsConfiguration", "(", "HttpServletRequest", "request", ")", "{", "return", "this", ".", "config", ";", "}", "private", "class", "CorsInterceptor", "extends", "HandlerInterceptorAdapter", "implements", "CorsConfigurationSource", "{", "@", "Override", "public", "CorsConfiguration", "getCorsConfiguration", "(", "HttpServletRequest", "request", ")", "{", "return", "this", ".", "config", ";", "}", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ".", "MatchableHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ".", "RequestMatchResult", ";", "public", "abstract", "class", "AbstractUrlHandlerMapping", "extends", "AbstractHandlerMapping", "implements", "MatchableHandlerMapping", "{", "@", "Override", "public", "RequestMatchResult", "match", "(", "HttpServletRequest", "request", ",", "String", "pattern", ")", "{", "String", "lookupPath", "=", "getUrlPathHelper", "(", ").", "getLookupPathForRequest", "(", "request", ")", ";", "if", "(", "getPathMatcher", "(", ").", "match", "(", "pattern", ",", "lookupPath", ")", ")", "{", "return", "new", "RequestMatchResult", "(", "pattern", ",", "lookupPath", ",", "getPathMatcher", "(", "))", ";", "}", "else", "if", "(", "useTrailingSlashMatch", "(", "))", "{", "if", "(", "!", "pattern", ".", "endsWith", "(", "\"/", "\")", "&", "&", "getPathMatcher", "(", ").", "match", "(", "pattern", "+", "\"", "/\"", ",", "lookupPath", ")", ")", "{", "return", "new", "RequestMatchResult", "(", "pattern", "+", "\"", "/\"", ",", "lookupPath", ",", "getPathMatcher", "(", "))", ";", "}", "}", "return", "null", ";", "}", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ".", "MatchableHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ".", "RequestMatchResult", ";", "implements", "EmbeddedValueResolverAware", ",", "MatchableHandlerMapping", "{", "@", "Override", "public", "RequestMatchResult", "match", "(", "HttpServletRequest", "request", ",", "String", "pattern", ")", "{", "RequestMappingInfo", "info", "=", "RequestMappingInfo", ".", "paths", "(", "pattern", ")", ".", "options", "(", "this", ".", "config", ")", ".", "build", "(", ");", "RequestMappingInfo", "matchingInfo", "=", "info", ".", "getMatchingCondition", "(", "request", ")", ";", "if", "(", "matchingInfo", "=", "=", "null", ")", "{", "return", "null", ";", "}", "Set", "<", "String", ">", "patterns", "=", "matchingInfo", ".", "getPatternsCondition", "(", ").", "getPatterns", "(", ");", "String", "lookupPath", "=", "getUrlPathHelper", "(", ").", "getLookupPathForRequest", "(", "request", ")", ";", "return", "new", "RequestMatchResult", "(", "patterns", ".", "iterator", "(", ").", "next", "(", "),", "lookupPath", ",", "getPathMatcher", "(", "))", ";", "}", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequestWrapper", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "BeanFactoryUtils", ";", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "import", "org", ".", "springframework", ".", "core", ".", "annotation", ".", "AnnotationAwareOrderComparator", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "support", ".", "PropertiesLoaderUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "ClassUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfiguration", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfigurationSource", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "DispatcherServlet", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerExecutionChain", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerInterceptor", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerMapping", ";", "/", "**", "*", "Helper", "class", "to", "get", "information", "from", "the", "{", "@", "code", "HandlerMapping", "}", "that", "would", "*", "serve", "a", "specific", "request", ".", "*", "*", "<", "p", ">", "Provides", "the", "following", "methods", ":", "*", "<", "ul", ">", "*", "<", "li", ">", "{@", "link", "#", "getMatchableHandlerMapping", "}", "-", "-", "obtain", "a", "{", "@", "code", "HandlerMapping", "}", "*", "to", "check", "request", "-", "matching", "criteria", "against", ".", "*", "<", "li", ">", "{@", "link", "#", "getCorsConfiguration", "}", "-", "-", "obtain", "the", "CORS", "configuration", "for", "the", "*", "request", ".", "*", "<", "/", "ul", ">", "*", "*", "@", "author", "Rossen", "Stoyanchev", "*", "@", "since", "4", ".", "3", "*", "/", "public", "class", "HandlerMappingIntrospector", "implements", "CorsConfigurationSource", "{", "private", "final", "List", "<", "HandlerMapping", ">", "handlerMappings", ";", "/", "**", "*", "Constructor", "that", "detects", "the", "configured", "{", "@", "code", "HandlerMapping", "}", "s", "in", "the", "*", "given", "{", "@", "code", "ApplicationContext", "}", "or", "falling", "back", "on", "*", "\"", "DispatcherServlet", ".", "properties", "\"", "like", "the", "{", "@", "code", "DispatcherServlet", "}", ".", "*", "/", "public", "HandlerMappingIntrospector", "(", "ApplicationContext", "context", ")", "{", "this", ".", "handlerMappings", "=", "initHandlerMappings", "(", "context", ")", ";", "}", "private", "static", "List", "<", "HandlerMapping", ">", "initHandlerMappings", "(", "ApplicationContext", "context", ")", "{", "Map", "<", "String", ",", "HandlerMapping", ">", "beans", "=", "BeanFactoryUtils", ".", "beansOfTypeIncludingAncestors", "(", "context", ",", "HandlerMapping", ".", "class", ",", "true", ",", "false", ")", ";", "if", "(", "!", "beans", ".", "isEmpty", "(", "))", "{", "List", "<", "HandlerMapping", ">", "mappings", "=", "new", "ArrayList", "<", "HandlerMapping", ">", "(", "beans", ".", "values", "(", "))", ";", "AnnotationAwareOrderComparator", ".", "sort", "(", "mappings", ")", ";", "return", "mappings", ";", "}", "return", "initDefaultHandlerMappings", "(", "context", ")", ";", "}", "private", "static", "List", "<", "HandlerMapping", ">", "initDefaultHandlerMappings", "(", "ApplicationContext", "context", ")", "{", "Properties", "props", ";", "String", "path", "=", "\"", "DispatcherServlet", ".", "properties", "\"", ";", "try", "{", "Resource", "resource", "=", "new", "ClassPathResource", "(", "path", ",", "DispatcherServlet", ".", "class", ")", ";", "props", "=", "PropertiesLoaderUtils", ".", "loadProperties", "(", "resource", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Could", "not", "load", "'", "\"", "+", "path", "+", "\"", "':", "\"", "+", "ex", ".", "getMessage", "(", "))", ";", "}", "String", "value", "=", "props", ".", "getProperty", "(", "HandlerMapping", ".", "class", ".", "getName", "(", "))", ";", "String", "[", "]", "names", "=", "StringUtils", ".", "commaDelimitedListToStringArray", "(", "value", ")", ";", "List", "<", "HandlerMapping", ">", "result", "=", "new", "ArrayList", "<", "HandlerMapping", ">", "(", "names", ".", "length", ")", ";", "for", "(", "String", "name", ":", "names", ")", "{", "try", "{", "Class", "<", "?>", "clazz", "=", "ClassUtils", ".", "forName", "(", "name", ",", "DispatcherServlet", ".", "class", ".", "getClassLoader", "(", "))", ";", "Object", "mapping", "=", "context", ".", "getAutowireCapableBeanFactory", "(", ").", "createBean", "(", "clazz", ")", ";", "result", ".", "add", "(", "(", "HandlerMapping", ")", "mapping", ")", ";", "}", "catch", "(", "ClassNotFoundException", "ex", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Could", "not", "find", "default", "HandlerMapping", "[", "\"", "+", "name", "+", "\"", "]\"", ");", "}", "}", "return", "result", ";", "}", "/", "**", "*", "Return", "the", "configured", "HandlerMapping", "'", "s", ".", "*", "/", "public", "List", "<", "HandlerMapping", ">", "getHandlerMappings", "(", ")", "{", "return", "this", ".", "handlerMappings", ";", "}", "/", "**", "*", "Find", "the", "{", "@", "link", "HandlerMapping", "}", "that", "would", "handle", "the", "given", "request", "and", "*", "return", "it", "as", "a", "{", "@", "link", "MatchableHandlerMapping", "}", "that", "can", "be", "used", "to", "*", "test", "request", "-", "matching", "criteria", ".", "If", "the", "matching", "HandlerMapping", "is", "not", "an", "*", "instance", "of", "{", "@", "link", "MatchableHandlerMapping", "}", ",", "an", "IllegalStateException", "is", "*", "raised", ".", "*", "*", "@", "param", "request", "the", "current", "request", "*", "@", "return", "the", "resolved", "matcher", ",", "or", "{", "@", "code", "null", "}", "*", "@", "throws", "Exception", "if", "any", "of", "the", "HandlerMapping", "'", "s", "raise", "an", "exception", "*", "/", "public", "MatchableHandlerMapping", "getMatchableHandlerMapping", "(", "HttpServletRequest", "request", ")", "throws", "Exception", "{", "HttpServletRequest", "wrapper", "=", "new", "RequestAttributeChangeIgnoringWrapper", "(", "request", ")", ";", "for", "(", "HandlerMapping", "handlerMapping", ":", "this", ".", "handlerMappings", ")", "{", "Object", "handler", "=", "handlerMapping", ".", "getHandler", "(", "wrapper", ")", ";", "if", "(", "handler", "=", "=", "null", ")", "{", "continue", ";", "}", "if", "(", "handlerMapping", "instanceof", "MatchableHandlerMapping", ")", "{", "return", "(", "(", "MatchableHandlerMapping", ")", "handlerMapping", ")", ";", "}", "throw", "new", "IllegalStateException", "(", "\"", "HandlerMapping", "is", "not", "a", "MatchableHandlerMapping", "\"", ");", "}", "return", "null", ";", "}", "@", "Override", "public", "CorsConfiguration", "getCorsConfiguration", "(", "HttpServletRequest", "request", ")", "{", "HttpServletRequest", "wrapper", "=", "new", "RequestAttributeChangeIgnoringWrapper", "(", "request", ")", ";", "for", "(", "HandlerMapping", "handlerMapping", ":", "this", ".", "handlerMappings", ")", "{", "HandlerExecutionChain", "handler", "=", "null", ";", "try", "{", "handler", "=", "handlerMapping", ".", "getHandler", "(", "wrapper", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "/", "/", "Ignore", "}", "if", "(", "handler", "=", "=", "null", ")", "{", "continue", ";", "}", "if", "(", "handler", ".", "getInterceptors", "(", ")", "!", "=", "null", ")", "{", "for", "(", "HandlerInterceptor", "interceptor", ":", "handler", ".", "getInterceptors", "(", "))", "{", "if", "(", "interceptor", "instanceof", "CorsConfigurationSource", ")", "{", "return", "(", "(", "CorsConfigurationSource", ")", "interceptor", ")", ".", "getCorsConfiguration", "(", "wrapper", ")", ";", "}", "}", "}", "if", "(", "handler", ".", "getHandler", "(", ")", "instanceof", "CorsConfigurationSource", ")", "{", "return", "(", "(", "CorsConfigurationSource", ")", "handler", ".", "getHandler", "(", "))", ".", "getCorsConfiguration", "(", "wrapper", ")", ";", "}", "}", "return", "null", ";", "}", "/", "**", "*", "Request", "wrapper", "that", "ignores", "request", "attribute", "changes", ".", "*", "/", "private", "static", "class", "RequestAttributeChangeIgnoringWrapper", "extends", "HttpServletRequestWrapper", "{", "private", "RequestAttributeChangeIgnoringWrapper", "(", "HttpServletRequest", "request", ")", "{", "super", "(", "request", ")", ";", "}", "@", "Override", "public", "void", "setAttribute", "(", "String", "name", ",", "Object", "value", ")", "{", "/", "/", "Ignore", "attribute", "change", "}", "}", "}", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerMapping", ";", "/", "**", "*", "Additional", "interface", "that", "a", "{", "@", "link", "HandlerMapping", "}", "can", "implement", "to", "expose", "*", "a", "request", "matching", "API", "aligned", "with", "its", "internal", "request", "matching", "*", "configuration", "and", "implementation", ".", "*", "*", "@", "author", "Rossen", "Stoyanchev", "*", "@", "since", "4", ".", "3", "*", "@", "see", "HandlerMappingIntrospector", "*", "/", "public", "interface", "MatchableHandlerMapping", "{", "/", "**", "*", "Whether", "the", "given", "request", "matches", "the", "request", "criteria", ".", "*", "@", "param", "request", "the", "current", "request", "*", "@", "param", "pattern", "the", "pattern", "to", "match", "*", "@", "return", "the", "result", "from", "request", "matching", "or", "{", "@", "code", "null", "}", "*", "/", "RequestMatchResult", "match", "(", "HttpServletRequest", "request", ",", "String", "pattern", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "77", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "PathMatcher", ";", "/", "**", "*", "Container", "for", "the", "result", "from", "request", "pattern", "matching", "via", "*", "{", "@", "link", "MatchableHandlerMapping", "}", "with", "a", "method", "to", "further", "extract", "URI", "template", "*", "variables", "from", "the", "pattern", ".", "*", "*", "@", "author", "Rossen", "Stoyanchev", "*", "@", "since", "4", ".", "3", "*", "/", "public", "class", "RequestMatchResult", "{", "private", "final", "String", "matchingPattern", ";", "private", "final", "String", "lookupPath", ";", "private", "final", "PathMatcher", "pathMatcher", ";", "/", "**", "*", "Create", "an", "instance", "with", "a", "matching", "pattern", ".", "*", "@", "param", "matchingPattern", "the", "matching", "pattern", ",", "possibly", "not", "the", "same", "as", "the", "*", "input", "pattern", ",", "e", ".", "g", ".", "inputPattern", "=", "\"/", "foo", "\"", "and", "matchingPattern", "=", "\"/", "foo", "/", "\".", "*", "@", "param", "lookupPath", "the", "lookup", "path", "extracted", "from", "the", "request", "*", "@", "param", "pathMatcher", "the", "PathMatcher", "used", "*", "/", "public", "RequestMatchResult", "(", "String", "matchingPattern", ",", "String", "lookupPath", ",", "PathMatcher", "pathMatcher", ")", "{", "Assert", ".", "hasText", "(", "matchingPattern", ",", "\"", "'", "matchingPattern", "'", "is", "required", "\"", ");", "Assert", ".", "hasText", "(", "lookupPath", ",", "\"", "'", "lookupPath", "'", "is", "required", "\"", ");", "Assert", ".", "notNull", "(", "pathMatcher", ",", "\"", "'", "pathMatcher", "'", "is", "required", "\"", ");", "this", ".", "matchingPattern", "=", "matchingPattern", ";", "this", ".", "lookupPath", "=", "lookupPath", ";", "this", ".", "pathMatcher", "=", "pathMatcher", ";", "}", "/", "**", "*", "Whether", "the", "pattern", "was", "matched", "to", "the", "request", ".", "*", "/", "public", "boolean", "isMatch", "(", ")", "{", "return", "(", "this", ".", "matchingPattern", "!", "=", "null", ")", ";", "}", "/", "**", "*", "Extract", "URI", "template", "variables", "from", "the", "matching", "pattern", "as", "defined", "in", "*", "{", "@", "link", "PathMatcher", "#", "extractUriTemplateVariables", "}", ".", "*", "@", "return", "a", "map", "with", "URI", "template", "variables", "*", "/", "public", "Map", "<", "String", ",", "String", ">", "extractUriTemplateVariables", "(", ")", "{", "if", "(", "!", "isMatch", "(", "))", "{", "return", "Collections", ".", "<", "String", ",", "String", ">", "emptyMap", "(", ");", "}", "return", "this", ".", "pathMatcher", ".", "extractUriTemplateVariables", "(", "this", ".", "matchingPattern", ",", "this", ".", "lookupPath", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "190", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "support", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "beans", ".", "MutablePropertyValues", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Bean", ";", "import", "org", ".", "springframework", ".", "context", ".", "annotation", ".", "Configuration", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpHeaders", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Controller", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "CrossOrigin", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "PostMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "context", ".", "support", ".", "AnnotationConfigWebApplicationContext", ";", "import", "org", ".", "springframework", ".", "web", ".", "context", ".", "support", ".", "StaticWebApplicationContext", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfiguration", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerExecutionChain", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "BeanNameUrlHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "SimpleUrlHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "mvc", ".", "annotation", ".", "DefaultAnnotationHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "mvc", ".", "method", ".", "annotation", ".", "RequestMappingHandlerMapping", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerMapping", ".", "BEST_MATCHING_PATTERN_ATTRIBUTE", ";", "/", "**", "*", "Unit", "tests", "for", "{", "@", "link", "HandlerMappingIntrospector", "}", ".", "*", "@", "author", "Rossen", "Stoyanchev", "*", "/", "public", "class", "HandlerMappingIntrospectorTests", "{", "@", "Test", "public", "void", "detectHandlerMappings", "(", ")", "throws", "Exception", "{", "StaticWebApplicationContext", "cxt", "=", "new", "StaticWebApplicationContext", "(", ");", "cxt", ".", "registerSingleton", "(", "\"", "hmA", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ")", ";", "cxt", ".", "registerSingleton", "(", "\"", "hmB", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ")", ";", "cxt", ".", "registerSingleton", "(", "\"", "hmC", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ")", ";", "cxt", ".", "refresh", "(", ");", "List", "<", "?>", "expected", "=", "Arrays", ".", "asList", "(", "cxt", ".", "getBean", "(", "\"", "hmA", "\"", "),", "cxt", ".", "getBean", "(", "\"", "hmB", "\"", "),", "cxt", ".", "getBean", "(", "\"", "hmC", "\"", "))", ";", "List", "<", "HandlerMapping", ">", "actual", "=", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getHandlerMappings", "(", ");", "assertEquals", "(", "expected", ",", "actual", ")", ";", "}", "@", "Test", "public", "void", "detectHandlerMappingsOrdered", "(", ")", "throws", "Exception", "{", "StaticWebApplicationContext", "cxt", "=", "new", "StaticWebApplicationContext", "(", ");", "MutablePropertyValues", "pvs", "=", "new", "MutablePropertyValues", "(", "Collections", ".", "singletonMap", "(", "\"", "order", "\"", ",", "\"", "3", "\"", "))", ";", "cxt", ".", "registerSingleton", "(", "\"", "hmA", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ",", "pvs", ")", ";", "pvs", "=", "new", "MutablePropertyValues", "(", "Collections", ".", "singletonMap", "(", "\"", "order", "\"", ",", "\"", "2", "\"", "))", ";", "cxt", ".", "registerSingleton", "(", "\"", "hmB", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ",", "pvs", ")", ";", "pvs", "=", "new", "MutablePropertyValues", "(", "Collections", ".", "singletonMap", "(", "\"", "order", "\"", ",", "\"", "1", "\"", "))", ";", "cxt", ".", "registerSingleton", "(", "\"", "hmC", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ",", "pvs", ")", ";", "cxt", ".", "refresh", "(", ");", "List", "<", "?>", "expected", "=", "Arrays", ".", "asList", "(", "cxt", ".", "getBean", "(", "\"", "hmC", "\"", "),", "cxt", ".", "getBean", "(", "\"", "hmB", "\"", "),", "cxt", ".", "getBean", "(", "\"", "hmA", "\"", "))", ";", "List", "<", "HandlerMapping", ">", "actual", "=", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getHandlerMappings", "(", ");", "assertEquals", "(", "expected", ",", "actual", ")", ";", "}", "@", "Test", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "public", "void", "defaultHandlerMappings", "(", ")", "throws", "Exception", "{", "StaticWebApplicationContext", "cxt", "=", "new", "StaticWebApplicationContext", "(", ");", "cxt", ".", "refresh", "(", ");", "List", "<", "HandlerMapping", ">", "actual", "=", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getHandlerMappings", "(", ");", "assertEquals", "(", "2", ",", "actual", ".", "size", "(", "))", ";", "assertEquals", "(", "BeanNameUrlHandlerMapping", ".", "class", ",", "actual", ".", "get", "(", "0", ")", ".", "getClass", "(", "))", ";", "assertEquals", "(", "DefaultAnnotationHandlerMapping", ".", "class", ",", "actual", ".", "get", "(", "1", ")", ".", "getClass", "(", "))", ";", "}", "@", "Test", "public", "void", "getMatchable", "(", ")", "throws", "Exception", "{", "MutablePropertyValues", "pvs", "=", "new", "MutablePropertyValues", "(", "Collections", ".", "singletonMap", "(", "\"", "urlMap", "\"", ",", "Collections", ".", "singletonMap", "(", "\"/", "path", "\"", ",", "new", "Object", "(", "))", "))", ";", "StaticWebApplicationContext", "cxt", "=", "new", "StaticWebApplicationContext", "(", ");", "cxt", ".", "registerSingleton", "(", "\"", "hm", "\"", ",", "SimpleUrlHandlerMapping", ".", "class", ",", "pvs", ")", ";", "cxt", ".", "refresh", "(", ");", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "GET", "\"", ",", "\"", "/", "path", "\"", ");", "MatchableHandlerMapping", "hm", "=", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getMatchableHandlerMapping", "(", "request", ")", ";", "assertEquals", "(", "cxt", ".", "getBean", "(", "\"", "hm", "\"", "),", "hm", ")", ";", "assertNull", "(", "\"", "Attributes", "changes", "not", "ignored", "\"", ",", "request", ".", "getAttribute", "(", "BEST_MATCHING_PATTERN_ATTRIBUTE", ")", ");", "}", "@", "Test", "(", "expected", "=", "IllegalStateException", ".", "class", ")", "public", "void", "getMatchableWhereHandlerMappingDoesNotImplementMatchableInterface", "(", ")", "throws", "Exception", "{", "StaticWebApplicationContext", "cxt", "=", "new", "StaticWebApplicationContext", "(", ");", "cxt", ".", "registerSingleton", "(", "\"", "hm1", "\"", ",", "TestHandlerMapping", ".", "class", ")", ";", "cxt", ".", "refresh", "(", ");", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getMatchableHandlerMapping", "(", "request", ")", ";", "}", "@", "Test", "public", "void", "getCorsConfigurationPreFlight", "(", ")", "throws", "Exception", "{", "AnnotationConfigWebApplicationContext", "cxt", "=", "new", "AnnotationConfigWebApplicationContext", "(", ");", "cxt", ".", "register", "(", "TestConfig", ".", "class", ")", ";", "cxt", ".", "refresh", "(", ");", "/", "/", "PRE", "-", "FLIGHT", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "OPTIONS", "\"", ",", "\"", "/", "path", "\"", ");", "request", ".", "addHeader", "(", "\"", "Origin", "\"", ",", "\"", "http", ":", "//", "localhost", ":", "9000", "\"", ");", "request", ".", "addHeader", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ",", "\"", "POST", "\"", ");", "CorsConfiguration", "corsConfig", "=", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getCorsConfiguration", "(", "request", ")", ";", "assertNotNull", "(", "corsConfig", ")", ";", "assertEquals", "(", "Collections", ".", "singletonList", "(", "\"", "http", ":", "//", "localhost", ":", "9000", "\"", "),", "corsConfig", ".", "getAllowedOrigins", "(", "))", ";", "assertEquals", "(", "Collections", ".", "singletonList", "(", "\"", "POST", "\"", "),", "corsConfig", ".", "getAllowedMethods", "(", "))", ";", "}", "@", "Test", "public", "void", "getCorsConfigurationActual", "(", ")", "throws", "Exception", "{", "AnnotationConfigWebApplicationContext", "cxt", "=", "new", "AnnotationConfigWebApplicationContext", "(", ");", "cxt", ".", "register", "(", "TestConfig", ".", "class", ")", ";", "cxt", ".", "refresh", "(", ");", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "path", "\"", ");", "request", ".", "addHeader", "(", "\"", "Origin", "\"", ",", "\"", "http", ":", "//", "localhost", ":", "9000", "\"", ");", "CorsConfiguration", "corsConfig", "=", "new", "HandlerMappingIntrospector", "(", "cxt", ")", ".", "getCorsConfiguration", "(", "request", ")", ";", "assertNotNull", "(", "corsConfig", ")", ";", "assertEquals", "(", "Collections", ".", "singletonList", "(", "\"", "http", ":", "//", "localhost", ":", "9000", "\"", "),", "corsConfig", ".", "getAllowedOrigins", "(", "))", ";", "assertEquals", "(", "Collections", ".", "singletonList", "(", "\"", "POST", "\"", "),", "corsConfig", ".", "getAllowedMethods", "(", "))", ";", "}", "private", "static", "class", "TestHandlerMapping", "implements", "HandlerMapping", "{", "@", "Override", "public", "HandlerExecutionChain", "getHandler", "(", "HttpServletRequest", "request", ")", "throws", "Exception", "{", "return", "new", "HandlerExecutionChain", "(", "new", "Object", "(", "))", ";", "}", "}", "@", "Configuration", "@", "SuppressWarnings", "(", "{\"", "WeakerAccess", "\"", ",", "\"", "unused", "\"", "})", "static", "class", "TestConfig", "{", "@", "Bean", "public", "RequestMappingHandlerMapping", "handlerMapping", "(", ")", "{", "return", "new", "RequestMappingHandlerMapping", "(", ");", "}", "@", "Bean", "public", "TestController", "testController", "(", ")", "{", "return", "new", "TestController", "(", ");", "}", "}", "@", "CrossOrigin", "(", "\"", "http", ":", "//", "localhost", ":", "9000", "\"", ")", "@", "Controller", "private", "static", "class", "TestController", "{", "@", "PostMapping", "(", "\"/", "path", "\"", ")", "public", "void", "handle", "(", ")", "{", "}", "}", "}</s>import", "org", ".", "springframework", ".", "web", ".", "HttpRequestHandler", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "UrlBasedCorsConfigurationSource", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsProcessor", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfiguration", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsConfigurationSource", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "DefaultCorsProcessor", ";", "import", "org", ".", "springframework", ".", "web", ".", "cors", ".", "CorsUtils", ";", "private", "class", "PreFlightHandler", "implements", "HttpRequestHandler", "{", "private", "class", "CorsInterceptor", "extends", "HandlerInterceptorAdapter", "{", "public", "abstract", "class", "AbstractUrlHandlerMapping", "extends", "AbstractHandlerMapping", "{", "implements", "EmbeddedValueResolverAware", "{"], "docstring_tokens": ["the", "difference", "in", "the", "strictness", "of", "the", "pattern", "matching", "mechanisms"]}
{"contents": ["fix", "for:", "https://issues.apache.org/jira/browse/AMQ-3693", "fix", "for:", "https://issues.apache.org/jira/browse/AMQ-3508", "Upgrades", "Jetty", "to", "v7.6.1", "git-svn-id:", "https://svn.apache.org/repos/asf/activemq/trunk@1293432", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "ssl", ".", "SslContextFactory", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "<", "bean", "id", "=", "\"", "securityConstraint", "\"", "class", "=", "\"", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "security", ".", "Constraint", "\"", ">", "<", "jetty", "-", "version", ">", "7", ".", "6", ".", "1", ".", "v20120215", "<", "/", "jetty", "-", "version", "></s>import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "ssl", ".", "SslContextFactory", ";", "<", "bean", "id", "=", "\"", "securityConstraint", "\"", "class", "=", "\"", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "security", ".", "Constraint", "\"", ">", "<", "jetty", "-", "version", ">", "7", ".", "5", ".", "1", ".", "v20110908", "<", "/", "jetty", "-", "version", ">"], "docstring_tokens": ["computes", "hash", "values", "for", "form", "parameters", "without", "restricting", "the", "ability", "to", "trigger", "hash", "collisions", "predictably"]}
{"contents": ["http://java.net/jira/browse/JAVASERVERFACES-3150", "I", "assert", "the", "cause", "of", "this", "bug", "is", "the", "dontEscape", "ivar", "of", "HtmlResponseWriter", "is", "too", "agressively", "set", "as", "a", "side", "effect", "in", "isScriptOrStyle(String", "name).", "I", "don't", "even", "understand", "why", "the", "ivar", "is", "set", "as", "a", "side", "effect,", "but", "I'm", "not", "going", "to", "change", "that.", "What", "I", "will", "do", "is", "add", "an", "extra", "assignment", "of", "false", "to", "the", "value", "of", "that", "ivar", "in", "endElement(String).", "SECTION:", "Modified", "Files", "----------------------------", "M", "jsf-ri/src/main/java/com/sun/faces/renderkit/html_basic/HtmlResponseWriter.java", "-", "in", "endElement(String)", "set", "dontEscape", "to", "false", "after", "writing", "the", "closing", "script", "block.", "M", "test/agnostic/facelets/processing/pom.xml", "A", "test/agnostic/facelets/processing/escaping01", "A", "test/agnostic/facelets/processing/escaping01/src", "A", "test/agnostic/facelets/processing/escaping01/src/test", "A", "test/agnostic/facelets/processing/escaping01/src/test/java", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces/test", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces/test/agnostic", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces/test/agnostic/facelets", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces/test/agnostic/facelets/processing", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces/test/agnostic/facelets/processing/escaping01", "A", "test/agnostic/facelets/processing/escaping01/src/test/java/com/sun/faces/test/agnostic/facelets/processing/escaping01/Issue3150IT.java", "A", "test/agnostic/facelets/processing/escaping01/src/main", "A", "test/agnostic/facelets/processing/escaping01/src/main/java", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun/faces", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun/faces/test", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun/faces/test/agnostic", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun/faces/test/agnostic/facelets", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun/faces/test/agnostic/facelets/processing", "A", "test/agnostic/facelets/processing/escaping01/src/main/java/com/sun/faces/test/agnostic/facelets/processing/escaping01", "A", "test/agnostic/facelets/processing/escaping01/src/main/resources", "A", "test/agnostic/facelets/processing/escaping01/src/main/webapp", "A", "test/agnostic/facelets/processing/escaping01/src/main/webapp/index.xhtml", "A", "test/agnostic/facelets/processing/escaping01/src/main/webapp/WEB-INF", "A", "test/agnostic/facelets/processing/escaping01/src/main/webapp/WEB-INF/web.xml", "A", "test/agnostic/facelets/processing/escaping01/src/main/webapp/WEB-INF/glassfish-web.xml", "A", "test/agnostic/facelets/processing/escaping01/src/main/webapp/WEB-INF/faces-config.xml", "A", "test/agnostic/facelets/processing/escaping01/pom.xml", "A", "test/agnostic/facelets/processing/escaping01/nbactions.xml", "-", "New", "test", "content", "git-svn-id:", "https://svn.java.net/svn/mojarra~svn/branches/MOJARRA_2_2X_ROLLING@12793", "761efcf2-d34d-6b61-9145-99dcacc3edf1"], "code_tokens": ["dontEscape", "=", "false", ";", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "actions", ">", "<", "action", ">", "<", "actionName", ">", "debug", ".", "test", ".", "single", "<", "/", "actionName", ">", "<", "packagings", ">", "<", "packaging", ">", "*<", "/", "packaging", ">", "<", "/", "packagings", ">", "<", "goals", ">", "<", "goal", ">", "test", "-", "compile", "<", "/", "goal", ">", "<", "goal", ">", "surefire", ":", "test", "<", "/", "goal", ">", "<", "/", "goals", ">", "<", "properties", ">", "<", "test", ">", "${", "packageClassName", "}", "</", "test", ">", "<", "forkMode", ">", "once", "<", "/", "forkMode", ">", "<", "maven", ".", "surefire", ".", "debug", ">", "-", "Xdebug", "-", "Xrunjdwp", ":", "transport", "=", "dt_socket", ",", "server", "=", "n", ",", "address", "=", "${", "jpda", ".", "address", "}", "</", "maven", ".", "surefire", ".", "debug", ">", "<", "jpda", ".", "listen", ">", "true", "<", "/", "jpda", ".", "listen", ">", "<", "integration", ".", "url", ">", "http", ":", "//", "localhost", ":", "8080", "/", "test", "-", "agnostic", "-", "facelets", "-", "escaping01", "/", "</", "integration", ".", "url", ">", "<", "/", "properties", ">", "<", "/", "action", ">", "<", "/", "actions", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "63", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "DO", "NOT", "ALTER", "OR", "REMOVE", "COPYRIGHT", "NOTICES", "OR", "THIS", "HEADER", ".", "Copyright", "(", "c", ")", "1997", "-", "2013", "Oracle", "and", "/", "or", "its", "affiliates", ".", "All", "rights", "reserved", ".", "The", "contents", "of", "this", "file", "are", "subject", "to", "the", "terms", "of", "either", "the", "GNU", "General", "Public", "License", "Version", "2", "only", "(", "\"", "GPL", "\"", ")", "or", "the", "Common", "Development", "and", "Distribution", "License", "(", "\"", "CDDL", "\"", ")", "(", "collectively", ",", "the", "\"", "License", "\"", ").", "You", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "can", "obtain", "a", "copy", "of", "the", "License", "at", "https", ":", "//", "glassfish", ".", "dev", ".", "java", ".", "net", "/", "public", "/", "CDDL", "+", "GPL_1_1", ".", "html", "or", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "When", "distributing", "the", "software", ",", "include", "this", "License", "Header", "Notice", "in", "each", "file", "and", "include", "the", "License", "file", "at", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "GPL", "Classpath", "Exception", ":", "Oracle", "designates", "this", "particular", "file", "as", "subject", "to", "the", "\"", "Classpath", "\"", "exception", "as", "provided", "by", "Oracle", "in", "the", "GPL", "Version", "2", "section", "of", "the", "License", "file", "that", "accompanied", "this", "code", ".", "Modifications", ":", "If", "applicable", ",", "add", "the", "following", "below", "the", "License", "Header", ",", "with", "the", "fields", "enclosed", "by", "brackets", "[", "]", "replaced", "by", "your", "own", "identifying", "information", ":", "\"", "Portions", "Copyright", "[", "year", "]", "[", "name", "of", "copyright", "owner", "]", "\"", "Contributor", "(", "s", ")", ":", "If", "you", "wish", "your", "version", "of", "this", "file", "to", "be", "governed", "by", "only", "the", "CDDL", "or", "only", "the", "GPL", "Version", "2", ",", "indicate", "your", "decision", "by", "adding", "\"", "[", "Contributor", "]", "elects", "to", "include", "this", "software", "in", "this", "distribution", "under", "the", "[", "CDDL", "or", "GPL", "Version", "2", "]", "license", ".", "\"", "If", "you", "don", "'", "t", "indicate", "a", "single", "choice", "of", "license", ",", "a", "recipient", "has", "the", "option", "to", "distribute", "your", "version", "of", "this", "file", "under", "either", "the", "CDDL", ",", "the", "GPL", "Version", "2", "or", "to", "extend", "the", "choice", "of", "license", "to", "its", "licensees", "as", "provided", "above", ".", "However", ",", "if", "you", "add", "GPL", "Version", "2", "code", "and", "therefore", ",", "elected", "the", "GPL", "Version", "2", "license", ",", "then", "the", "option", "applies", "only", "if", "the", "new", "code", "is", "made", "subject", "to", "such", "option", "by", "the", "copyright", "holder", ".", "-", "->", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "xsd", "/", "maven", "-", "4", ".", "0", ".", "0", ".", "xsd", "\"", ">", "<", "modelVersion", ">", "4", ".", "0", ".", "0", "<", "/", "modelVersion", ">", "<", "parent", ">", "<", "groupId", ">", "com", ".", "sun", ".", "faces", ".", "test", ".", "agnostic", ".", "facelets", ".", "processing", "<", "/", "groupId", ">", "<", "artifactId", ">", "pom", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "2", ".", "6", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "/", "parent", ">", "<", "groupId", ">", "com", ".", "sun", ".", "faces", ".", "test", ".", "agnostic", ".", "facelets", ".", "processing", "<", "/", "groupId", ">", "<", "artifactId", ">", "escaping01", "<", "/", "artifactId", ">", "<", "packaging", ">", "war", "<", "/", "packaging", ">", "<", "name", ">", "Mojarra", "$", "{", "project", ".", "version", "}", "-", "Test", "-", "Agnostic", "-", "Facelets", "-", "Processing", "-", "escaping01", "<", "/", "name", ">", "<", "build", ">", "<", "finalName", ">", "test", "-", "agnostic", "-", "facelets", "-", "escaping01", "<", "/", "finalName", ">", "<", "/", "build", ">", "<", "properties", ">", "<", "netbeans", ".", "hint", ".", "deploy", ".", "server", ">", "gfv3ee6", "<", "/", "netbeans", ".", "hint", ".", "deploy", ".", "server", ">", "<", "project", ".", "build", ".", "sourceEncoding", ">", "UTF", "-", "8", "<", "/", "project", ".", "build", ".", "sourceEncoding", ">", "<", "/", "properties", ">", "<", "/", "project", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "14", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "faces", "-", "config", "xmlns", "=", "\"", "http", ":", "//", "xmlns", ".", "jcp", ".", "org", "/", "xml", "/", "ns", "/", "javaee", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "xmlns", ".", "jcp", ".", "org", "/", "xml", "/", "ns", "/", "javaee", "http", ":", "//", "xmlns", ".", "jcp", ".", "org", "/", "xml", "/", "ns", "/", "javaee", "/", "web", "-", "facesconfig_2_2", ".", "xsd", "\"", "version", "=", "\"", "2", ".", "2", "\"", ">", "<", "faces", "-", "config", "-", "extension", ">", "<", "facelets", "-", "processing", ">", "<", "file", "-", "extension", ">", ".", "xhtml", "<", "/", "file", "-", "extension", ">", "<", "process", "-", "as", ">", "html5", "<", "/", "process", "-", "as", ">", "<", "/", "facelets", "-", "processing", ">", "<", "/", "faces", "-", "config", "-", "extension", ">", "<", "/", "faces", "-", "config", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "11", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!", "DOCTYPE", "glassfish", "-", "web", "-", "app", "PUBLIC", "\"", "-/", "/", "GlassFish", ".", "org", "/", "/", "DTD", "GlassFish", "Application", "Server", "3", ".", "1", "Servlet", "3", ".", "0", "/", "/", "EN", "\"", "\"", "http", ":", "//", "glassfish", ".", "org", "/", "dtds", "/", "glassfish", "-", "web", "-", "app_3_0", "-", "1", ".", "dtd", "\"", ">", "<", "glassfish", "-", "web", "-", "app", "error", "-", "url", "=", "\"\"", ">", "<", "context", "-", "root", ">", "/", "test", "-", "agnostic", "-", "facelets", "-", "escaping01", "<", "/", "context", "-", "root", ">", "<", "class", "-", "loader", "delegate", "=", "\"", "true", "\"", "/>", "<", "jsp", "-", "config", ">", "<", "property", "name", "=", "\"", "keepgenerated", "\"", "value", "=", "\"", "true", "\"", ">", "<", "description", ">", "Keep", "a", "copy", "of", "the", "generated", "servlet", "class", "'", "java", "code", ".", "</", "description", ">", "<", "/", "property", ">", "<", "/", "jsp", "-", "config", ">", "<", "/", "glassfish", "-", "web", "-", "app", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "75", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "DO", "NOT", "ALTER", "OR", "REMOVE", "COPYRIGHT", "NOTICES", "OR", "THIS", "HEADER", ".", "Copyright", "(", "c", ")", "1997", "-", "2013", "Oracle", "and", "/", "or", "its", "affiliates", ".", "All", "rights", "reserved", ".", "The", "contents", "of", "this", "file", "are", "subject", "to", "the", "terms", "of", "either", "the", "GNU", "General", "Public", "License", "Version", "2", "only", "(", "\"", "GPL", "\"", ")", "or", "the", "Common", "Development", "and", "Distribution", "License", "(", "\"", "CDDL", "\"", ")", "(", "collectively", ",", "the", "\"", "License", "\"", ").", "You", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "can", "obtain", "a", "copy", "of", "the", "License", "at", "https", ":", "//", "glassfish", ".", "dev", ".", "java", ".", "net", "/", "public", "/", "CDDL", "+", "GPL_1_1", ".", "html", "or", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "When", "distributing", "the", "software", ",", "include", "this", "License", "Header", "Notice", "in", "each", "file", "and", "include", "the", "License", "file", "at", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "GPL", "Classpath", "Exception", ":", "Oracle", "designates", "this", "particular", "file", "as", "subject", "to", "the", "\"", "Classpath", "\"", "exception", "as", "provided", "by", "Oracle", "in", "the", "GPL", "Version", "2", "section", "of", "the", "License", "file", "that", "accompanied", "this", "code", ".", "Modifications", ":", "If", "applicable", ",", "add", "the", "following", "below", "the", "License", "Header", ",", "with", "the", "fields", "enclosed", "by", "brackets", "[", "]", "replaced", "by", "your", "own", "identifying", "information", ":", "\"", "Portions", "Copyright", "[", "year", "]", "[", "name", "of", "copyright", "owner", "]", "\"", "Contributor", "(", "s", ")", ":", "If", "you", "wish", "your", "version", "of", "this", "file", "to", "be", "governed", "by", "only", "the", "CDDL", "or", "only", "the", "GPL", "Version", "2", ",", "indicate", "your", "decision", "by", "adding", "\"", "[", "Contributor", "]", "elects", "to", "include", "this", "software", "in", "this", "distribution", "under", "the", "[", "CDDL", "or", "GPL", "Version", "2", "]", "license", ".", "\"", "If", "you", "don", "'", "t", "indicate", "a", "single", "choice", "of", "license", ",", "a", "recipient", "has", "the", "option", "to", "distribute", "your", "version", "of", "this", "file", "under", "either", "the", "CDDL", ",", "the", "GPL", "Version", "2", "or", "to", "extend", "the", "choice", "of", "license", "to", "its", "licensees", "as", "provided", "above", ".", "However", ",", "if", "you", "add", "GPL", "Version", "2", "code", "and", "therefore", ",", "elected", "the", "GPL", "Version", "2", "license", ",", "then", "the", "option", "applies", "only", "if", "the", "new", "code", "is", "made", "subject", "to", "such", "option", "by", "the", "copyright", "holder", ".", "-", "->", "<", "web", "-", "app", "version", "=", "\"", "3", ".", "0", "\"", "xmlns", "=", "\"", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "http", ":", "//", "java", ".", "sun", ".", "com", "/", "xml", "/", "ns", "/", "javaee", "/", "web", "-", "app_3_0", ".", "xsd", "\"", ">", "<", "context", "-", "param", ">", "<", "param", "-", "name", ">", "javax", ".", "faces", ".", "PROJECT_STAGE", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "${", "webapp", ".", "projectStage", "}", "</", "param", "-", "value", ">", "<", "/", "context", "-", "param", ">", "<", "context", "-", "param", ">", "<", "param", "-", "name", ">", "javax", ".", "faces", ".", "PARTIAL_STATE_SAVING", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "${", "webapp", ".", "partialStateSaving", "}", "</", "param", "-", "value", ">", "<", "/", "context", "-", "param", ">", "<", "context", "-", "param", ">", "<", "param", "-", "name", ">", "javax", ".", "faces", ".", "STATE_SAVING_METHOD", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "${", "webapp", ".", "stateSavingMethod", "}", "</", "param", "-", "value", ">", "<", "/", "context", "-", "param", ">", "<", "servlet", ">", "<", "servlet", "-", "name", ">", "Faces", "Servlet", "<", "/", "servlet", "-", "name", ">", "<", "servlet", "-", "class", ">", "javax", ".", "faces", ".", "webapp", ".", "FacesServlet", "<", "/", "servlet", "-", "class", ">", "<", "load", "-", "on", "-", "startup", ">", "1", "<", "/", "load", "-", "on", "-", "startup", ">", "<", "/", "servlet", ">", "<", "servlet", "-", "mapping", ">", "<", "servlet", "-", "name", ">", "Faces", "Servlet", "<", "/", "servlet", "-", "name", ">", "<", "url", "-", "pattern", ">", "/", "faces", "/", "*<", "/", "url", "-", "pattern", ">", "<", "/", "servlet", "-", "mapping", ">", "<", "session", "-", "config", ">", "<", "session", "-", "timeout", ">", "30", "<", "/", "session", "-", "timeout", ">", "<", "/", "session", "-", "config", ">", "<", "welcome", "-", "file", "-", "list", ">", "<", "welcome", "-", "file", ">", "faces", "/", "index", ".", "xhtml", "<", "/", "welcome", "-", "file", ">", "<", "/", "welcome", "-", "file", "-", "list", ">", "<", "/", "web", "-", "app", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "77", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "DO", "NOT", "ALTER", "OR", "REMOVE", "COPYRIGHT", "NOTICES", "OR", "THIS", "HEADER", ".", "Copyright", "(", "c", ")", "1997", "-", "2013", "Oracle", "and", "/", "or", "its", "affiliates", ".", "All", "rights", "reserved", ".", "The", "contents", "of", "this", "file", "are", "subject", "to", "the", "terms", "of", "either", "the", "GNU", "General", "Public", "License", "Version", "2", "only", "(", "\"", "GPL", "\"", ")", "or", "the", "Common", "Development", "and", "Distribution", "License", "(", "\"", "CDDL", "\"", ")", "(", "collectively", ",", "the", "\"", "License", "\"", ").", "You", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "can", "obtain", "a", "copy", "of", "the", "License", "at", "https", ":", "//", "glassfish", ".", "dev", ".", "java", ".", "net", "/", "public", "/", "CDDL", "+", "GPL_1_1", ".", "html", "or", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "When", "distributing", "the", "software", ",", "include", "this", "License", "Header", "Notice", "in", "each", "file", "and", "include", "the", "License", "file", "at", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "GPL", "Classpath", "Exception", ":", "Oracle", "designates", "this", "particular", "file", "as", "subject", "to", "the", "\"", "Classpath", "\"", "exception", "as", "provided", "by", "Oracle", "in", "the", "GPL", "Version", "2", "section", "of", "the", "License", "file", "that", "accompanied", "this", "code", ".", "Modifications", ":", "If", "applicable", ",", "add", "the", "following", "below", "the", "License", "Header", ",", "with", "the", "fields", "enclosed", "by", "brackets", "[", "]", "replaced", "by", "your", "own", "identifying", "information", ":", "\"", "Portions", "Copyright", "[", "year", "]", "[", "name", "of", "copyright", "owner", "]", "\"", "Contributor", "(", "s", ")", ":", "If", "you", "wish", "your", "version", "of", "this", "file", "to", "be", "governed", "by", "only", "the", "CDDL", "or", "only", "the", "GPL", "Version", "2", ",", "indicate", "your", "decision", "by", "adding", "\"", "[", "Contributor", "]", "elects", "to", "include", "this", "software", "in", "this", "distribution", "under", "the", "[", "CDDL", "or", "GPL", "Version", "2", "]", "license", ".", "\"", "If", "you", "don", "'", "t", "indicate", "a", "single", "choice", "of", "license", ",", "a", "recipient", "has", "the", "option", "to", "distribute", "your", "version", "of", "this", "file", "under", "either", "the", "CDDL", ",", "the", "GPL", "Version", "2", "or", "to", "extend", "the", "choice", "of", "license", "to", "its", "licensees", "as", "provided", "above", ".", "However", ",", "if", "you", "add", "GPL", "Version", "2", "code", "and", "therefore", ",", "elected", "the", "GPL", "Version", "2", "license", ",", "then", "the", "option", "applies", "only", "if", "the", "new", "code", "is", "made", "subject", "to", "such", "option", "by", "the", "copyright", "holder", ".", "-", "->", "<", "!", "DOCTYPE", "html", "PUBLIC", "\"", "-/", "/", "W3C", "/", "/", "DTD", "XHTML", "1", ".", "0", "Transitional", "/", "/", "EN", "\"", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xhtml1", "/", "DTD", "/", "xhtml1", "-", "transitional", ".", "dtd", "\"", ">", "<", "html", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\"", "xmlns", ":", "h", "=", "\"", "http", ":", "//", "xmlns", ".", "jcp", ".", "org", "/", "jsf", "/", "html", "\"", ">", "<", "!-", "-", "Case", "1", "-", "->", "<", "h", ":", "outputText", "id", "=", "\"", "id", "\"", "value", "=", "\"#", "{", "param", "[", "'", "id", "'", "]}", "\">", "</", "h", ":", "outputText", ">", "<", "!-", "-", "Case", "2", "-", "->", "<", "h", ":", "inputHidden", "id", "=", "\"", "id", "\"", "value", "=", "\"#", "{", "param", "[", "'", "id", "'", "]}", "\">", "</", "h", ":", "inputHidden", ">", "<", "!-", "-", "Case", "3", "-", "->", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "id", "\"", "id", "=", "\"", "id", "\"", "value", "=", "\"#", "{", "param", "[", "'", "id", "'", "]}", "\"/", ">", "beforeScriptBlock", ":", "#", "{", "param", "[", "'", "id", "'", "]}", "<", "script", ">", "/", "/", "case", "4", "var", "paramId", "=", "#", "{", "param", "[", "'", "id2", "'", "]}", ";", "/", "/", "case", "5", "var", "paramIdd", "=", "\"", "<", "h", ":", "outputText", "value", "=", "\"#", "{", "param", "[", "'", "id3", "'", "]}", "\"", "/", ">\"", ";", "<", "/", "script", ">", "<", "!-", "-", "Case", "6", "-", "->", "#", "{", "param", "[", "'", "id4", "'", "]}", "<", "/", "html", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "89", "@", "@", "/", "*", "*", "DO", "NOT", "ALTER", "OR", "REMOVE", "COPYRIGHT", "NOTICES", "OR", "THIS", "HEADER", ".", "*", "*", "Copyright", "(", "c", ")", "1997", "-", "2013", "Oracle", "and", "/", "or", "its", "affiliates", ".", "All", "rights", "reserved", ".", "*", "*", "The", "contents", "of", "this", "file", "are", "subject", "to", "the", "terms", "of", "either", "the", "GNU", "*", "General", "Public", "License", "Version", "2", "only", "(", "\"", "GPL", "\"", ")", "or", "the", "Common", "Development", "*", "and", "Distribution", "License", "(", "\"", "CDDL", "\"", ")", "(", "collectively", ",", "the", "\"", "License", "\"", ").", "You", "*", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "can", "*", "obtain", "a", "copy", "of", "the", "License", "at", "*", "https", ":", "//", "glassfish", ".", "dev", ".", "java", ".", "net", "/", "public", "/", "CDDL", "+", "GPL_1_1", ".", "html", "*", "or", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "See", "the", "License", "for", "the", "specific", "*", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "*", "*", "When", "distributing", "the", "software", ",", "include", "this", "License", "Header", "Notice", "in", "each", "*", "file", "and", "include", "the", "License", "file", "at", "packager", "/", "legal", "/", "LICENSE", ".", "txt", ".", "*", "*", "GPL", "Classpath", "Exception", ":", "*", "Oracle", "designates", "this", "particular", "file", "as", "subject", "to", "the", "\"", "Classpath", "\"", "*", "exception", "as", "provided", "by", "Oracle", "in", "the", "GPL", "Version", "2", "section", "of", "the", "License", "*", "file", "that", "accompanied", "this", "code", ".", "*", "*", "Modifications", ":", "*", "If", "applicable", ",", "add", "the", "following", "below", "the", "License", "Header", ",", "with", "the", "fields", "*", "enclosed", "by", "brackets", "[", "]", "replaced", "by", "your", "own", "identifying", "information", ":", "*", "\"", "Portions", "Copyright", "[", "year", "]", "[", "name", "of", "copyright", "owner", "]", "\"", "*", "*", "Contributor", "(", "s", ")", ":", "*", "If", "you", "wish", "your", "version", "of", "this", "file", "to", "be", "governed", "by", "only", "the", "CDDL", "or", "*", "only", "the", "GPL", "Version", "2", ",", "indicate", "your", "decision", "by", "adding", "\"", "[", "Contributor", "]", "*", "elects", "to", "include", "this", "software", "in", "this", "distribution", "under", "the", "[", "CDDL", "or", "GPL", "*", "Version", "2", "]", "license", ".", "\"", "If", "you", "don", "'", "t", "indicate", "a", "single", "choice", "of", "license", ",", "a", "*", "recipient", "has", "the", "option", "to", "distribute", "your", "version", "of", "this", "file", "under", "*", "either", "the", "CDDL", ",", "the", "GPL", "Version", "2", "or", "to", "extend", "the", "choice", "of", "license", "to", "*", "its", "licensees", "as", "provided", "above", ".", "However", ",", "if", "you", "add", "GPL", "Version", "2", "code", "*", "and", "therefore", ",", "elected", "the", "GPL", "Version", "2", "license", ",", "then", "the", "option", "applies", "*", "only", "if", "the", "new", "code", "is", "made", "subject", "to", "such", "option", "by", "the", "copyright", "*", "holder", ".", "*", "/", "package", "com", ".", "sun", ".", "faces", ".", "test", ".", "agnostic", ".", "facelets", ".", "processing", ".", "escaping01", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebClient", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "com", ".", "sun", ".", "faces", ".", "test", ".", "junit", ".", "JsfTestRunner", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "@", "RunWith", "(", "JsfTestRunner", ".", "class", ")", "public", "class", "Issue3150IT", "{", "private", "String", "webUrl", ";", "private", "WebClient", "webClient", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "webUrl", "=", "System", ".", "getProperty", "(", "\"", "integration", ".", "url", "\"", ");", "webClient", "=", "new", "WebClient", "(", ");", "}", "@", "After", "public", "void", "tearDown", "(", ")", "{", "webClient", ".", "closeAllWindows", "(", ");", "}", "@", "Test", "public", "void", "testEscaping", "(", ")", "throws", "Exception", "{", "HtmlPage", "page", "=", "webClient", ".", "getPage", "(", "webUrl", "+", "\"", "faces", "/", "index", ".", "xhtml", "?", "id4", "=", "%", "3Cscript", "%", "3Ealert", "%", "28", "%", "27hi", "%", "27", "%", "29", ";", "%", "3C", "/", "script", "%", "3E", "&", "id", "=", "myId", "&", "id2", "=", "\\\"", "myId2", "\\", "\"&", "id3", "=", "myId3", "\"", ");", "String", "pageMarkup", "=", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"<", "span", "id", "=", "\\\"", "id", "\\", "\">", "myId", "<", "/", "span", ">", "\")", ");", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"<", "input", "id", "=", "\\\"", "id", "\\", "\"", "type", "=", "\\\"", "hidden", "\\", "\"", "name", "=", "\\\"", "id", "\\", "\"", "value", "=", "\\\"", "myId", "\\", "\"", "/", ">\"", "))", ";", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"<", "input", "type", "=", "\\\"", "hidden", "\\", "\"", "name", "=", "\\\"", "id", "\\", "\"", "id", "=", "\\\"", "id", "\\", "\"", "value", "=", "\\\"", "myId", "\\", "\"", "/", ">\"", "))", ";", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"", "beforeScriptBlock", ":", "myId", "\"", "))", ";", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"", "var", "paramId", "=", "\\", "\"", "myId2", "\\", "\";", "\")", ");", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"", "var", "paramIdd", "=", "\\", "\"", "myId3", "\\", "\";", "\")", ");", "assertTrue", "(", "pageMarkup", ".", "contains", "(", "\"&", "lt", ";", "script", "&", "gt", ";", "alert", "(", "'", "hi", "'", ");", "&", "lt", ";", "/", "script", "&", "gt", ";", "\")", ");", "}", "}", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "<", "groupId", ">", "com", ".", "sun", ".", "faces", ".", "test", ".", "agnostic", ".", "facelets", "<", "/", "groupId", "></s>-", "->", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "xsd", "/", "maven", "-", "4", ".", "0", ".", "0", ".", "xsd", "\"", ">", "<", "groupId", ">", "com", ".", "sun", ".", "faces", ".", "test", ".", "agnostic", "<", "/", "groupId", ">"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["ALSA:", "seq:", "Fix", "race", "at", "timer", "setup", "and", "close", "ALSA", "sequencer", "code", "has", "an", "open", "race", "between", "the", "timer", "setup", "ioctl", "and", "the", "close", "of", "the", "client.", "This", "was", "triggered", "by", "syzkaller", "fuzzer,", "and", "a", "use-after-free", "was", "caught", "there", "as", "a", "result.", "This", "patch", "papers", "over", "it", "by", "adding", "a", "proper", "queue->timer_mutex", "lock", "around", "the", "timer-related", "calls", "in", "the", "relevant", "code", "path.", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Tested-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["mutex_lock", "(", "&", "q", "-", ">", "timer_mutex", ")", ";", "mutex_unlock", "(", "&", "q", "-", ">", "timer_mutex", ")", ";</s>"], "docstring_tokens": ["missing", "NULL", "check"]}
{"contents": ["NFS:", "Fix", "an", "Oops", "in", "encode_lookup()", "It", "doesn't", "look", "as", "if", "the", "NFS", "file", "name", "limit", "is", "being", "initialised", "correctly", "in", "the", "struct", "nfs_server.", "Make", "sure", "that", "we", "limit", "whatever", "is", "being", "set", "in", "nfs_probe_fsinfo()", "and", "nfs_init_server().", "Also", "ensure", "that", "readdirplus", "and", "nfs4_path_walk", "respect", "our", "file", "name", "limits.", "Signed-off-by:", "Trond", "Myklebust", "<Trond.Myklebust@netapp.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "server", "-", ">", "nfs_client", "-", ">", "rpc_ops", "-", ">", "version", "=", "=", "3", ")", "{", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS3_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS3_MAXNAMLEN", ";", "if", "(", "!(", "data", "-", ">", "flags", "&", "NFS_MOUNT_NORDIRPLUS", ")", ")", "server", "-", ">", "caps", "|", "=", "NFS_CAP_READDIRPLUS", ";", "}", "else", "{", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS2_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS2_MAXNAMLEN", ";", "}", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS4_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS4_MAXNAMLEN", ";", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS4_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS4_MAXNAMLEN", ";", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS4_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS4_MAXNAMLEN", ";", "if", "(", "name", ".", "len", ">", "NFS_SERVER", "(", "dir", ")", "->", "namelen", ")", "return", "NULL", ";", "if", "(", "name", ".", "len", ">", "NFS4_MAXNAMLEN", ")", "return", "-", "ENAMETOOLONG", ";</s>if", "(", "clp", "-", ">", "cl_nfsversion", "=", "=", "3", ")", "{", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS3_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS3_MAXNAMLEN", ";", "if", "(", "!(", "data", "-", ">", "flags", "&", "NFS_MOUNT_NORDIRPLUS", ")", ")", "server", "-", ">", "caps", "|", "=", "NFS_CAP_READDIRPLUS", ";", "}", "else", "{", "if", "(", "server", "-", ">", "namelen", "=", "=", "0", "|", "|", "server", "-", ">", "namelen", ">", "NFS2_MAXNAMLEN", ")", "server", "-", ">", "namelen", "=", "NFS2_MAXNAMLEN", ";", "}"], "docstring_tokens": ["does", "not", "properly", "initialize", "a", "certain", "structure", "member", "that", "stores", "the", "maximum", "NFS", "filename", "length"]}
{"contents": ["Issue", "#2529", "RFC2616", "vs", "RFC7230", "cleanup", "Signed-off-by:", "Greg", "Wilkins", "<gregw@webtide.com>"], "code_tokens": ["import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "CARRIAGE_RETURN", ";", "import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "LINE_FEED", ";", "import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "SPACE", ";", "import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "TAB", ";", "private", "final", "static", "int", "MAX_CHUNK_LENGTH", "=", "Integer", ".", "MAX_VALUE", "/", "16", "-", "16", ";", "private", "boolean", "_hasContentLength", ";", "this", "(", "code", ",", "message", ",", "null", ")", ";", "}", "private", "BadMessageException", "(", "int", "code", ",", "String", "message", ",", "Throwable", "cause", ")", "{", "super", "(", "message", ",", "cause", ")", ";", "{", "else", "if", "(", "ch", "!", "='", "\\", "n", "'", ")", "else", "if", "(", "version", "!", "=", "HttpVersion", ".", "HTTP_1_0", "&", "&", "version", "!", "=", "HttpVersion", ".", "HTTP_1_1", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Version", "\"", ");", "if", "(", "_version", "!", "=", "HttpVersion", ".", "HTTP_1_0", "&", "&", "_version", "!", "=", "HttpVersion", ".", "HTTP_1_1", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Version", "\"", ");", "if", "(", "_connectionFields", "=", "=", "null", "&", "&", "_version", ".", "getVersion", "(", ")=", "=", "HttpVersion", ".", "HTTP_1_1", ".", "getVersion", "(", "))", "if", "(", "_hasContentLength", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Lengths", "\"", ");", "_hasContentLength", "=", "true", ";", "if", "(", "_endOfContent", "=", "=", "EndOfContent", ".", "CHUNKED_CONTENT", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Length", "\"", ");", "try", "_contentLength", "=", "Long", ".", "parseLong", "(", "_valueString", ")", ";", "catch", "(", "NumberFormatException", "e", ")", "{", "LOG", ".", "ignore", "(", "e", ")", ";", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Length", "\"", ");", "}", "if", "(", "_contentLength", "<", "=", "0", ")", "_endOfContent", "=", "EndOfContent", ".", "NO_CONTENT", ";", "else", "_endOfContent", "=", "EndOfContent", ".", "CONTENT_LENGTH", ";", "if", "(", "_hasContentLength", "&", "&", "_endOfContent", "=", "=", "EndOfContent", ".", "CHUNKED_CONTENT", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "chunking", "\"", ");", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Host", "header", "\"", ",", "e", ")", ";", "{", "}", "{", "if", "(", "_chunkLength", ">", "MAX_CHUNK_LENGTH", ")", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "REQUEST_ENTITY_TOO_LARGE_413", ")", ";", "}", "_hasContentLength", "=", "false", ";", "@", "Test", "public", "void", "testAllowedLinePreamble", "(", ")", "throws", "Exception", "{", "ByteBuffer", "buffer", "=", "BufferUtil", ".", "toBuffer", "(", "\"\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "HTTP", "/", "1", ".", "0", "\\", "r", "\\", "n", "\"", ");", "HttpParser", ".", "RequestHandler", "<", "ByteBuffer", ">", "handler", "=", "new", "Handler", "(", ");", "HttpParser", "parser", "=", "new", "HttpParser", "(", "handler", ")", ";", "parseAll", "(", "parser", ",", "buffer", ")", ";", "assertEquals", "(", "\"", "GET", "\"", ",", "_methodOrVersion", ")", ";", "assertEquals", "(", "\"/", "\",", "_uriOrStatus", ")", ";", "assertEquals", "(", "\"", "HTTP", "/", "1", ".", "0", "\"", ",", "_versionOrReason", ")", ";", "assertEquals", "(", "-", "1", ",", "_headers", ")", ";", "}", "@", "Test", "public", "void", "testDisallowedLinePreamble", "(", ")", "throws", "Exception", "{", "ByteBuffer", "buffer", "=", "BufferUtil", ".", "toBuffer", "(", "\"\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "HTTP", "/", "1", ".", "0", "\\", "r", "\\", "n", "\"", ");", "HttpParser", ".", "RequestHandler", "<", "ByteBuffer", ">", "handler", "=", "new", "Handler", "(", ");", "HttpParser", "parser", "=", "new", "HttpParser", "(", "handler", ")", ";", "parseAll", "(", "parser", ",", "buffer", ")", ";", "assertEquals", "(", "\"", "400", "\"", ",", "_bad", ")", ";", "}", "}", "assertEquals", "(", "\"", "Bad", "Version", "\"", ",", "_bad", ")", ";", "if", "(", "_state", ".", "unhandle", "(", ")=", "=", "Action", ".", "COMPLETE", ")", "_state", ".", "completed", "(", ");", "catch", "(", "Throwable", "e", ")", "_transport", ".", "abort", "(", ");", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CountDownLatch", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTester", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "anyOf", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "isEmptyOrNullString", ";", "HttpConfiguration", "config", "=", "new", "HttpConfiguration", "(", ");", "config", ".", "setRequestHeaderSize", "(", "1024", ")", ";", "config", ".", "setResponseHeaderSize", "(", "1024", ")", ";", "config", ".", "setSendDateHeader", "(", "true", ")", ";", "HttpConnectionFactory", "http", "=", "new", "HttpConnectionFactory", "(", "config", ")", ";", "/", "**", "*", "HTTP", "/", "0", ".", "9", "does", "not", "support", "HttpVersion", "(", "this", "is", "a", "bad", "request", ")", "*", "/", "@", "Test", "public", "void", "testHttp09_NoVersion", "(", ")", "throws", "Exception", "{", "String", "request", "=", "\"", "GET", "/", "HTTP", "/", "0", ".", "9", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "String", "response", "=", "connector", ".", "getResponses", "(", "request", ")", ";", "assertThat", "(", "response", ",", "containsString", "(", "\"", "400", "Bad", "Version", "\"", "))", ";", "}", "/", "**", "*", "HTTP", "/", "0", ".", "9", "does", "not", "support", "headers", "*", "/", "@", "Test", "public", "void", "testHttp09_NoHeaders", "(", ")", "throws", "Exception", "{", "/", "/", "header", "looking", "like", "another", "request", "is", "ignored", "String", "request", "=", "\"", "GET", "/", "one", "\\", "r", "\\", "nGET", ":", "/", "two", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "String", "response", "=", "connector", ".", "getResponses", "(", "request", ")", ";", "assertThat", "(", "response", ",", "containsString", "(", "\"", "pathInfo", "=", "/\"", "))", ";", "assertThat", "(", "response", ",", "not", "(", "containsString", "(", "\"", "two", "\"", "))", ");", "}", "/", "**", "*", "Http", "/", "0", ".", "9", "does", "not", "support", "pipelining", ".", "*", "/", "@", "Test", "public", "void", "testHttp09_MultipleRequests", "(", ")", "throws", "Exception", "{", "/", "/", "Verify", "that", "LocalConnector", "supports", "pipelining", "with", "HTTP", "/", "1", ".", "1", ".", "String", "requests", "=", "\"", "GET", "/", "?", "id", "=", "123", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "nHost", ":", "localhost", "\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "?", "id", "=", "456", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "nHost", ":", "localhost", "\\", "r", "\\", "nConnection", ":", "close", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "String", "responses", "=", "connector", ".", "getResponses", "(", "requests", ")", ";", "assertThat", "(", "responses", ",", "containsString", "(", "\"", "id", "=", "123", "\"", "))", ";", "assertThat", "(", "responses", ",", "containsString", "(", "\"", "id", "=", "456", "\"", "))", ";", "/", "/", "Verify", "that", "pipelining", "does", "not", "work", "with", "HTTP", "/", "0", ".", "9", ".", "requests", "=", "\"", "GET", "/", "?", "id", "=", "123", "\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "?", "id", "=", "456", "\\", "r", "\\", "n", "\\", "r", "\\", "nGET", "/", "?", "id", "=", "789", "\\", "r", "\\", "n", "\\", "r", "\\", "n", "\"", ";", "responses", "=", "connector", ".", "getResponses", "(", "requests", ")", ";", "assertThat", "(", "responses", ",", "containsString", "(", "\"", "id", "=", "123", "\"", "))", ";", "assertThat", "(", "responses", ",", "not", "(", "containsString", "(", "\"", "id", "=", "456", "\"", "))", ");", "assertThat", "(", "responses", ",", "not", "(", "containsString", "(", "\"", "id", "=", "789", "\"", "))", ");", "}", "/", "**", "*", "Ensure", "that", "excessively", "large", "hexadecimal", "chunk", "body", "length", "is", "parsed", "properly", ".", "*", "/", "@", "Test", "public", "void", "testHttp10_ChunkedBodyTruncation", "(", ")", "throws", "Exception", "{", "String", "request", "=", "\"", "POST", "/", "?", "id", "=", "123", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "local", "\\", "r", "\\", "n", "\"", "\"", "Transfer", "-", "Encoding", ":", "chunked", "\\", "r", "\\", "n", "\"", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "\\", "r", "\\", "n", "\"", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "1ff00000008", "\\", "r", "\\", "n", "\"", "\"", "abcdefgh", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "0", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "POST", "/", "?", "id", "=", "bogus", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Content", "-", "Length", ":", "5", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "dummy", "-", "host", ".", "example", ".", "com", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "12345", "\"", ";", "String", "responses", "=", "connector", ".", "getResponses", "(", "request", ")", ";", "assertThat", "(", "responses", ",", "anyOf", "(", "isEmptyOrNullString", "(", "),", "containsString", "(", "\"", "413", "\"", "),", "containsString", "(", "\"", "500", "\"", ")", ")", ");", "}", "/", "**", "*", "More", "then", "1", "Content", "-", "Length", "is", "a", "bad", "requests", "per", "HTTP", "rfcs", ".", "*", "/", "@", "Test", "public", "void", "testHttp11_MultipleContentLength", "(", ")", "throws", "Exception", "{", "HttpParser", ".", "LOG", ".", "info", "(", "\"", "badMessage", ":", "400", "Bad", "messages", "EXPECTED", ".", "..", "\")", ";", "int", "contentLengths", "[", "][", "]=", "{", "{", "0", ",", "8", "}", ",", "{", "8", ",", "0", "}", ",", "{", "8", ",", "8", "}", ",", "{", "0", ",", "8", ",", "0", "}", ",", "{", "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", "8", "}", ",", "{", "8", ",", "2", ",", "1", "}", ",", "{", "0", ",", "0", "}", ",", "{", "8", ",", "0", ",", "8", "}", ",", "{", "-", "1", ",", "8", "}", ",", "{", "8", ",", "-", "1", "}", ",", "{", "-", "1", ",", "8", ",", "-", "1", "}", ",", "{", "-", "1", ",", "-", "1", "}", ",", "{", "8", ",", "-", "1", ",", "8", "}", ",", "}", ";", "for", "(", "int", "x", "=", "0", ";", "x", "<", "contentLengths", ".", "length", ";", "x", "+", "+)", "{", "StringBuilder", "request", "=", "new", "StringBuilder", "(", ");", "request", ".", "append", "(", "\"", "POST", "/", "?", "id", "=", "\")", ".", "append", "(", "Integer", ".", "toString", "(", "x", ")", ").", "append", "(", "\"", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Host", ":", "local", "\\", "r", "\\", "n", "\"", ");", "int", "clen", "[", "]", "=", "contentLengths", "[", "x", "]", ";", "for", "(", "int", "n", "=", "0", ";", "n", "<", "clen", ".", "length", ";", "n", "+", "+)", "{", "request", ".", "append", "(", "\"", "Content", "-", "Length", ":", "\"", ").", "append", "(", "Integer", ".", "toString", "(", "clen", "[", "n", "]", "))", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "}", "request", ".", "append", "(", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "abcdefgh", "\"", ");", "/", "/", "actual", "content", "of", "8", "bytes", "String", "rawResponses", "=", "connector", ".", "getResponses", "(", "request", ".", "toString", "(", "))", ";", "HttpTester", ".", "Response", "response", "=", "HttpTester", ".", "parseResponse", "(", "rawResponses", ")", ";", "assertThat", "(", "\"", "Response", ".", "status", "\"", ",", "response", ".", "getStatus", "(", "),", "is", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ");", "}", "}", "/", "**", "*", "More", "then", "1", "Content", "-", "Length", "is", "a", "bad", "requests", "per", "HTTP", "rfcs", ".", "*", "/", "@", "Test", "public", "void", "testHttp11_ContentLengthAndChunk", "(", ")", "throws", "Exception", "{", "HttpParser", ".", "LOG", ".", "info", "(", "\"", "badMessage", ":", "400", "Bad", "messages", "EXPECTED", ".", "..", "\")", ";", "int", "contentLengths", "[", "][", "]=", "{", "{", "-", "1", ",", "8", "}", ",", "{", "8", ",", "-", "1", "}", ",", "{", "8", ",", "-", "1", ",", "8", "}", ",", "}", ";", "for", "(", "int", "x", "=", "0", ";", "x", "<", "contentLengths", ".", "length", ";", "x", "+", "+)", "{", "StringBuilder", "request", "=", "new", "StringBuilder", "(", ");", "request", ".", "append", "(", "\"", "POST", "/", "?", "id", "=", "\")", ".", "append", "(", "Integer", ".", "toString", "(", "x", ")", ").", "append", "(", "\"", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Host", ":", "local", "\\", "r", "\\", "n", "\"", ");", "int", "clen", "[", "]", "=", "contentLengths", "[", "x", "]", ";", "for", "(", "int", "n", "=", "0", ";", "n", "<", "clen", ".", "length", ";", "n", "+", "+)", "{", "if", "(", "clen", "[", "n", "]", "==", "-", "1", ")", "request", ".", "append", "(", "\"", "Transfer", "-", "Encoding", ":", "chunked", "\\", "r", "\\", "n", "\"", ");", "else", "request", ".", "append", "(", "\"", "Content", "-", "Length", ":", "\"", ").", "append", "(", "Integer", ".", "toString", "(", "clen", "[", "n", "]", "))", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "}", "request", ".", "append", "(", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"\\", "r", "\\", "n", "\"", ");", "request", ".", "append", "(", "\"", "8", ";", "\\", "r", "\\", "n", "\"", ");", "/", "/", "chunk", "header", "request", ".", "append", "(", "\"", "abcdefgh", "\"", ");", "/", "/", "actual", "content", "of", "8", "bytes", "request", ".", "append", "(", "\"\\", "r", "\\", "n0", ";", "\\", "r", "\\", "n", "\"", ");", "/", "/", "last", "chunk", "String", "rawResponses", "=", "connector", ".", "getResponses", "(", "request", ".", "toString", "(", "))", ";", "HttpTester", ".", "Response", "response", "=", "HttpTester", ".", "parseResponse", "(", "rawResponses", ")", ";", "assertThat", "(", "\"", "Response", ".", "status", "\"", ",", "response", ".", "getStatus", "(", "),", "is", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ");", "}", "}", "@", "Test", "public", "void", "test4_1", "(", ")", "throws", "Exception", "{", "int", "offset", "=", "0", ";", "/", "/", "If", "_content", "length", "not", "used", ",", "second", "request", "will", "not", "be", "read", ".", "String", "response", "=", "connector", ".", "getResponses", "(", "\"", "\\", "r", "\\", "n", "\"", "\"", "GET", "/", "R1", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "localhost", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "GET", "/", "R2", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "localhost", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", "\"", "GET", "/", "R3", "HTTP", "/", "1", ".", "1", "\\", "r", "\\", "n", "\"", "\"", "Host", ":", "localhost", "\\", "r", "\\", "n", "\"", "\"", "Connection", ":", "close", "\\", "r", "\\", "n", "\"", "\"", "\\", "r", "\\", "n", "\"", ")", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "2", ".", "identity", "\"", ")+", "10", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R1", "\"", ",\"", "2", ".", "identity", "\"", ")+", "3", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "2", ".", "identity", "\"", ")+", "10", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R2", "\"", ",\"", "2", ".", "identity", "\"", ")+", "3", ";", "checkNotContained", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "2", ".", "identity", "\"", ");", "checkNotContained", "(", "response", ",", "offset", ",", "\"/", "R3", "\"", ",\"", "2", ".", "identity", "\"", ");", "}", "/", "/", "Due", "to", "smuggling", "concerns", ",", "handling", "has", "been", "changed", "to", "/", "/", "treat", "content", "length", "and", "chunking", "as", "a", "bad", "request", ".", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "400", "Bad", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "checkNotContained", "(", "response", ",", "offset", ",", "\"/", "R2", "\"", ",\"", "3", ".", "_content", "-", "length", "\"", ");", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "matchers", ".", "JUnitMatchers", ".", "containsString", ";", "/", "/", "Server", "-", "bad", "message", "to", "avoid", "smuggling", "concerns", "Assert", ".", "assertEquals", "(", "\"", "Response", "Count", "\"", ",", "1", ",", "responses", ".", "size", "(", "))", ";", "assertEquals", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Response", "Code", "\"", ",", "HttpStatus", ".", "BAD_REQUEST_400", ",", "response", ".", "getStatus", "(", "))", ";</s>import", "static", "org", ".", "eclipse", ".", "jetty", ".", "http", ".", "HttpTokens", ".", "*;", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "StringUtil", ";", "super", "(", "message", ")", ";", "{", "else", "if", "(", "ch", "<", "0", ")", "else", "if", "(", "_connectionFields", "=", "=", "null", "&", "&", "_version", ".", "getVersion", "(", ")>", "=", "HttpVersion", ".", "HTTP_1_1", ".", "getVersion", "(", "))", "if", "(", "_endOfContent", "!", "=", "EndOfContent", ".", "CHUNKED_CONTENT", ")", "try", "{", "_contentLength", "=", "Long", ".", "parseLong", "(", "_valueString", ")", ";", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "LOG", ".", "ignore", "(", "e", ")", ";", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Content", "-", "Length", "\"", ");", "}", "if", "(", "_contentLength", "<", "=", "0", ")", "_endOfContent", "=", "EndOfContent", ".", "NO_CONTENT", ";", "else", "_endOfContent", "=", "EndOfContent", ".", "CONTENT_LENGTH", ";", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "\"", "Bad", "Host", "header", "\"", ")", "{", "{", "initCause", "(", "e", ")", ";}", "};", "}", "assertTrue", "(", "_headerCompleted", ")", ";", "assertTrue", "(", "_messageCompleted", ")", ";", "assertEquals", "(", "\"", "PRI", "\"", ",", "_methodOrVersion", ")", ";", "assertEquals", "(", "\"*", "\",", "_uriOrStatus", ")", ";", "assertEquals", "(", "\"", "HTTP", "/", "2", ".", "0", "\"", ",", "_versionOrReason", ")", ";", "assertEquals", "(", "-", "1", ",", "_headers", ")", ";", "assertEquals", "(", "null", ",", "_bad", ")", ";", "catch", "(", "IOException", "e", ")", "}", "finally", "{", "if", "(", "_state", ".", "unhandle", "(", ")=", "=", "Action", ".", "COMPLETE", ")", "_state", ".", "completed", "(", ");", "else", "throw", "new", "IllegalStateException", "(", ");", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CountDownLatch", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "HttpConnectionFactory", "http", "=", "new", "HttpConnectionFactory", "(", ");", "http", ".", "getHttpConfiguration", "(", ").", "setRequestHeaderSize", "(", "1024", ")", ";", "http", ".", "getHttpConfiguration", "(", ").", "setResponseHeaderSize", "(", "1024", ")", ";", "connector", ".", "getConnectionFactory", "(", "HttpConnectionFactory", ".", "class", ")", ".", "getHttpConfiguration", "(", ").", "setSendDateHeader", "(", "true", ")", ";", "/", "/", "_content", "length", "is", "ignored", ",", "as", "chunking", "is", "used", ".", "If", "it", "is", "/", "/", "not", "ignored", ",", "the", "second", "request", "wont", "be", "seen", ".", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R1", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "123456", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "HTTP", "/", "1", ".", "1", "200", "OK", "\"", ",\"", "3", ".", "ignore", "c", "-", "l", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"/", "R2", "\"", ",\"", "3", ".", "_content", "-", "length", "\"", ")+", "1", ";", "offset", "=", "checkContains", "(", "response", ",", "offset", ",", "\"", "abcdef", "\"", ",\"", "3", ".", "_content", "-", "length", "\"", ")+", "1", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "junit", ".", "matchers", ".", "JUnitMatchers", ".", "*;", "import", "java", ".", "util", ".", "Collections", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "MultiPartInputStreamParser", ";", "/", "/", "Server", "-", "ignore", "'", "Content", "-", "Length", "'", "if", "'", "Transfer", "-", "Encoding", "'", "is", "provided", ".", "Assert", ".", "assertEquals", "(", "\"", "Response", "Count", "\"", ",", "2", ",", "responses", ".", "size", "(", "))", ";", "assertEquals", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Response", "Code", "\"", ",", "HttpStatus", ".", "OK_200", ",", "response", ".", "getStatus", "(", "))", ";", "assertTrue", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Body", "\"", ",", "response", ".", "getContent", "(", ").", "contains", "(", "\"", "123456", "\\", "n", "\"", "))", ";", "response", "=", "responses", ".", "get", "(", "1", ")", ";", "/", "/", "response", "2", "assertEquals", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Response", "Code", "\"", ",", "HttpStatus", ".", "OK_200", ",", "response", ".", "getStatus", "(", "))", ";", "assertTrue", "(", "\"", "4", ".", "4", ".", "3", "Ignore", "Content", "-", "Length", "/", "Body", "\"", ",", "response", ".", "getContent", "(", ").", "contains", "(", "\"", "7890AB", "\\", "n", "\"", "))", ";"], "docstring_tokens": ["a", "flaw", "when", "handling", "more", "than", "one", "Content-Length", "headers"]}
{"contents": ["iucv:", "Fix", "missing", "msg_namelen", "update", "in", "iucv_sock_recvmsg()", "The", "current", "code", "does", "not", "fill", "the", "msg_name", "member", "in", "case", "it", "is", "set.", "It", "also", "does", "not", "set", "the", "msg_namelen", "member", "to", "0", "and", "therefore", "makes", "net/socket.c", "leak", "the", "local,", "uninitialized", "sockaddr_storage", "variable", "to", "userland", "--", "128", "bytes", "of", "kernel", "stack", "memory.", "Fix", "that", "by", "simply", "setting", "msg_namelen", "to", "0", "as", "obviously", "nobody", "cared", "about", "iucv_sock_recvmsg()", "not", "filling", "the", "msg_name", "in", "case", "it", "was", "set.", "Cc:", "Ursula", "Braun", "<ursula.braun@de.ibm.com>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["msg", "-", ">", "msg_namelen", "=", "0", ";</s>"], "docstring_tokens": ["does", "not", "initialize", "a", "certain", "length", "variable"]}
{"contents": ["[FIXED", "SECURITY-136]", "[extra-columns]", "Project", "Description", "column", "tooltip", "shows", "unsafe", "HTML"], "code_tokens": ["<", "div", "tooltip", "=", "\"$", "{", "app", ".", "markupFormatter", ".", "translate", "(", "tooltipdesc", ")", "}\"", "style", "=", "\"$", "{", "it", ".", "isForceWidth", "(", ")", "?", "widthAttribute", ":", "null", "}", "\"></s><", "div", "tooltip", "=", "\"$", "{", "tooltipdesc", "}", "\"", "style", "=", "\"$", "{", "it", ".", "isForceWidth", "(", ")", "?", "widthAttribute", ":", "null", "}", "\">"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["V4L/DVB", "(6237):", "Oops", "in", "pwc", "v4l", "driver", "The", "pwc", "driver", "is", "defficient", "in", "locking,", "which", "can", "trigger", "an", "oops", "when", "disconnecting.", "Signed-off-by:", "Oliver", "Neukum", "<oneukum@suse.de>", "CC:", "Luc", "Saillard", "<luc@saillard.org>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@infradead.org>"], "code_tokens": ["static", "void", "pwc_iso_stop", "(", "struct", "pwc_device", "*", "pdev", ")", "PWC_DEBUG_MEMORY", "(", "\"", "Unlinking", "URB", "%", "p", "\\", "n", "\"", ",", "urb", ")", ";", "usb_kill_urb", "(", "urb", ")", ";", "}", "}", "}", "static", "void", "pwc_iso_free", "(", "struct", "pwc_device", "*", "pdev", ")", "{", "int", "i", ";", "/", "*", "Freeing", "ISOC", "buffers", "one", "by", "one", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "MAX_ISO_BUFS", ";", "i", "+", "+)", "{", "struct", "urb", "*", "urb", ";", "urb", "=", "pdev", "-", ">", "sbuf", "[", "i", "]", ".", "urb", ";", "if", "(", "urb", "!", "=", "0", ")", "{", "}", "void", "pwc_isoc_cleanup", "(", "struct", "pwc_device", "*", "pdev", ")", "{", "PWC_DEBUG_OPEN", "(", "\">", ">", "pwc_isoc_cleanup", "(", ")\\", "n", "\"", ");", "if", "(", "pdev", "=", "=", "NULL", ")", "return", ";", "if", "(", "pdev", "-", ">", "iso_init", "=", "=", "0", ")", "return", ";", "pwc_iso_stop", "(", "pdev", ")", ";", "pwc_iso_free", "(", "pdev", ")", ";", "lock_kernel", "(", ");", "int", "bytes_to_read", ",", "rv", "=", "0", ";", "mutex_lock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "if", "(", "pdev", "-", ">", "error_status", ")", "{", "rv", "=", "-", "pdev", "-", ">", "error_status", ";", "/", "*", "Something", "happened", ",", "report", "what", ".", "*", "/", "goto", "err_out", ";", "}", "rv", "=", "-", "pdev", "-", ">", "error_status", ";", "goto", "err_out", ";", "rv", "=", "-", "EWOULDBLOCK", ";", "goto", "err_out", ";", "rv", "=", "-", "ERESTARTSYS", ";", "goto", "err_out", ";", "if", "(", "pwc_handle_frame", "(", "pdev", ")", ")", "{", "rv", "=", "-", "EFAULT", ";", "goto", "err_out", ";", "}", "if", "(", "copy_to_user", "(", "buf", ",", "image_buffer_addr", ",", "count", ")", ")", "{", "rv", "=", "-", "EFAULT", ";", "goto", "err_out", ";", "}", "mutex_unlock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "err_out", ":", "mutex_unlock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "return", "rv", ";", "struct", "video_device", "*", "vdev", "=", "file", "-", ">", "private_data", ";", "struct", "pwc_device", "*", "pdev", ";", "int", "r", "=", "-", "ENODEV", ";", "if", "(", "!", "vdev", ")", "goto", "out", ";", "pdev", "=", "vdev", "-", ">", "priv", ";", "mutex_lock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "if", "(", "!", "pdev", "-", ">", "unplugged", ")", "r", "=", "video_usercopy", "(", "inode", ",", "file", ",", "cmd", ",", "arg", ",", "pwc_video_do_ioctl", ")", ";", "mutex_unlock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "out", ":", "return", "r", ";", "mutex_lock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "mutex_unlock", "(", "&", "pdev", "-", ">", "modlock", ")", ";", "pwc_iso_stop", "(", "pdev", ")", ";</s>void", "pwc_isoc_cleanup", "(", "struct", "pwc_device", "*", "pdev", ")", "PWC_DEBUG_OPEN", "(", "\">", ">", "pwc_isoc_cleanup", "(", ")\\", "n", "\"", ");", "if", "(", "pdev", "=", "=", "NULL", ")", "return", ";", "if", "(", "pdev", "-", ">", "iso_init", "=", "=", "0", ")", "return", ";", "if", "(", "pdev", "-", ">", "iso_init", ")", "{", "PWC_DEBUG_MEMORY", "(", "\"", "Unlinking", "URB", "%", "p", "\\", "n", "\"", ",", "urb", ")", ";", "usb_kill_urb", "(", "urb", ")", ";", "}", "lock_kernel", "(", ");", "int", "bytes_to_read", ";", "if", "(", "pdev", "-", ">", "error_status", ")", "return", "-", "pdev", "-", ">", "error_status", ";", "/", "*", "Something", "happened", ",", "report", "what", ".", "*", "/", "return", "-", "pdev", "-", ">", "error_status", ";", "return", "-", "EWOULDBLOCK", ";", "return", "-", "ERESTARTSYS", ";", "if", "(", "pwc_handle_frame", "(", "pdev", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "buf", ",", "image_buffer_addr", ",", "count", ")", ")", "return", "-", "EFAULT", ";", "return", "video_usercopy", "(", "inode", ",", "file", ",", "cmd", ",", "arg", ",", "pwc_video_do_ioctl", ")", ";"], "docstring_tokens": ["relies", "on", "user", "space", "to", "close", "the", "device"]}
{"contents": ["Fix", "XXE", "vulnerability", "for", "JDom", "parsers."], "code_tokens": ["documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "reader", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "/", "**", "*", "Create", "and", "initialize", "the", "SAX", "builder", ".", "*", "*", "@", "return", "the", "SAX", "builder", "instance", ".", "*", "@", "since", "upcoming", "*", "/", "protected", "SAXBuilder", "createBuilder", "(", ")", "{", "final", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "builder", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "return", "builder", ";", "}", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "reader", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "final", "SAXBuilder", "builder", "=", "createBuilder", "(", ");", "final", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "/", "**", "*", "Create", "and", "initialize", "the", "SAX", "builder", ".", "*", "*", "@", "return", "the", "SAX", "builder", "instance", ".", "*", "@", "since", "upcoming", "*", "/", "protected", "SAXBuilder", "createBuilder", "(", ")", "{", "final", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "builder", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "return", "builder", ";", "}", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2015", "XStream", "Committers", ".", "final", "String", "message", "=", "e", ".", "getMessage", "(", ");", "if", "(", "!", "message", ".", "contains", "(", "\"", "DOCTYPE", "\"", "))", "{", "fail", "(", "\"", "Thrown", "\"", "+", "XStreamException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "if", "(", "!", "message", ".", "contains", "(", "\"", "DOCTYPE", "\"", "))", "{", "fail", "(", "\"", "Thrown", "\"", "+", "XStreamException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "if", "(", "!", "message", ".", "contains", "(", "\"", "DOCTYPE", "\"", "))", "{", "super", ".", "testIsXXEVulnerable", "(", ");", "if", "(", "!", "message", ".", "contains", "(", "\"", "external", "entity", "\"", "))", "{", "if", "(", "!", "message", ".", "contains", "(", "\"", "external", "entity", "\"", "))", "{</s>documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "false", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "reader", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "reader", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "in", ")", ";", "todoIsXXEVulnerable", "(", ");", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", "XStream", "Committers", ".", "final", "String", "message", "=", "e", ".", "getMessage", "(", ").", "toLowerCase", "(", ");", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "import", "org", ".", "jdom2", ".", "input", ".", "JDOMParseException", ";", "fail", "(", "\"", "Thrown", "\"", "+", "JDOMParseException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "JDOMParseException", "e", ")", "{", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "import", "org", ".", "jdom", ".", "input", ".", "JDOMParseException", ";", "fail", "(", "\"", "Thrown", "\"", "+", "JDOMParseException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "JDOMParseException", "e", ")", "{", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "@", "Override", "public", "void", "testIsXXEVulnerable", "(", ")", "throws", "Exception", "{", "try", "{", "super", ".", "testIsXXEVulnerable", "(", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "final", "String", "message", "=", "e", ".", "getMessage", "(", ");", "if", "(", "message", ".", "contains", "(", "\"", "ParseError", "\"", ")", "&", "&", "message", ".", "contains", "(", "\"[", "1", ",", "1", "]", "\")", ")", "{", "throw", "e", ";", "}", "}", "}", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "XStreamException", ";", "try", "{", "super", ".", "testIsXXEVulnerable", "(", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "final", "String", "message", "=", "e", ".", "getMessage", "(", ");", "if", "(", "message", ".", "contains", "(", "\"", "ParseError", "\"", ")", "&", "&", "message", ".", "contains", "(", "\"[", "1", ",", "1", "]", "\")", ")", "{", "throw", "e", ";", "}", "}", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{"], "docstring_tokens": ["does", "not", "parse", "entities", "at", "all"]}
{"contents": ["https://issues.apache.org/jira/browse/AMQ-6013", "-", "restrict", "classes", "which", "can", "be", "serialized", "inside", "the", "broker"], "code_tokens": ["import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Map", ";", "private", "static", "String", "[", "]", "serializablePackages", ";", "Class", "clazz", "=", "load", "(", "classDesc", ".", "getName", "(", "),", "cl", ",", "inLoader", ")", ";", "checkSecurity", "(", "clazz", ")", ";", "return", "clazz", ";", "Class", "clazz", "=", "null", ";", "clazz", "=", "Proxy", ".", "getProxyClass", "(", "cl", ",", "cinterfaces", ")", ";", "clazz", "=", "Proxy", ".", "getProxyClass", "(", "inLoader", ",", "cinterfaces", ")", ";", "clazz", "=", "Proxy", ".", "getProxyClass", "(", "FALLBACK_CLASS_LOADER", ",", "cinterfaces", ")", ";", "}", "if", "(", "clazz", "!", "=", "null", ")", "{", "checkSecurity", "(", "clazz", ")", ";", "return", "clazz", ";", "}", "else", "{", "throw", "new", "ClassNotFoundException", "(", "null", ")", ";", "}", "}", "public", "static", "String", "[", "]", "getSerialziablePackages", "(", ")", "{", "if", "(", "serializablePackages", "=", "=", "null", ")", "{", "serializablePackages", "=", "System", ".", "getProperty", "(", "\"", "org", ".", "apache", ".", "activemq", ".", "SERIALIZABLE_PACKAGES", "\"", ",", "\"", "java", ".", "lang", ",", "java", ".", "util", ",", "org", ".", "apache", ".", "activemq", ",", "org", ".", "fusesource", ".", "hawtbuf", ",", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", "\"", ").", "split", "(", "\",", "\")", ";", "}", "return", "serializablePackages", ";", "}", ";", "public", "static", "boolean", "isAllAllowed", "(", ")", "{", "return", "getSerialziablePackages", "(", ").", "length", "=", "=", "1", "&", "&", "getSerialziablePackages", "(", ")[", "0", "]", ".", "equals", "(", "\"*", "\")", ";", "}", "private", "void", "checkSecurity", "(", "Class", "clazz", ")", "throws", "ClassNotFoundException", "{", "if", "(", "!", "clazz", ".", "isPrimitive", "(", "))", "{", "if", "(", "clazz", ".", "getPackage", "(", ")", "!", "=", "null", "&", "&", "!", "isAllAllowed", "(", "))", "{", "boolean", "found", "=", "false", ";", "for", "(", "String", "packageName", ":", "getSerialziablePackages", "(", "))", "{", "if", "(", "clazz", ".", "getPackage", "(", ").", "getName", "(", ").", "equals", "(", "packageName", ")", "|", "|", "clazz", ".", "getPackage", "(", ").", "getName", "(", ").", "startsWith", "(", "packageName", "+", "\"", ".\"", "))", "{", "found", "=", "true", ";", "break", ";", "}", "}", "if", "(", "!", "found", ")", "{", "throw", "new", "ClassNotFoundException", "(", "\"", "Forbidden", "\"", "+", "clazz", "+", "\"", "!", "This", "class", "is", "not", "allowed", "to", "be", "serialized", ".", "Add", "package", "with", "'", "org", ".", "apache", ".", "activemq", ".", "SERIALIZABLE_PACKAGES", "'", "system", "property", ".", "\")", ";", "}", "}", "<", "<<", "<<", "<<", "HEAD", "=", "==", "==", "==", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "converters", ".", "Converter", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "converters", ".", "MarshallingContext", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "converters", ".", "UnmarshallingContext", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamReader", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamWriter", ";", ">", ">>", ">>", ">>", "a7e2a44", ".", "..", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "AMQ", "-", "6013", "-", "restrict", "classes", "which", "can", "be", "serialized", "inside", "the", "broker", "import", "org", ".", "apache", ".", "activemq", ".", "transport", ".", "stomp", ".", "XStreamSupport", ";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "activemq", "-", "http", "/", "src", "/", "main", "/", "java", "/", "org", "/", "apache", "/", "activemq", "/", "transport", "/", "xstream", "/", "XStreamWireFormat", ".", "java", "final", "XStream", "xstream", "=", "XStreamSupport", ".", "createXStream", "(", ");", "throw", "new", "Exception", "(", "\"", "Unknown", "transformation", ":", "\"", "+", "transformation", ")", ";", "xstream", "=", "XStreamSupport", ".", "createXStream", "(", ");", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "activemq", ".", "transport", ".", "stomp", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "XStream", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "AnyTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NoTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "PrimitiveTypePermission", ";", "import", "org", ".", "apache", ".", "activemq", ".", "util", ".", "ClassLoadingAwareObjectInputStream", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "XStreamSupport", "{", "public", "static", "XStream", "createXStream", "(", ")", "{", "XStream", "stream", "=", "new", "XStream", "(", ");", "stream", ".", "addPermission", "(", "NoTypePermission", ".", "NONE", ")", ";", "stream", ".", "addPermission", "(", "PrimitiveTypePermission", ".", "PRIMITIVES", ")", ";", "stream", ".", "allowTypeHierarchy", "(", "Collection", ".", "class", ")", ";", "stream", ".", "allowTypeHierarchy", "(", "Map", ".", "class", ")", ";", "stream", ".", "allowTypes", "(", "new", "Class", "[", "]{", "String", ".", "class", "}", ");", "if", "(", "ClassLoadingAwareObjectInputStream", ".", "isAllAllowed", "(", "))", "{", "stream", ".", "addPermission", "(", "AnyTypePermission", ".", "ANY", ")", ";", "}", "else", "{", "for", "(", "String", "packageName", ":", "ClassLoadingAwareObjectInputStream", ".", "getSerialziablePackages", "(", "))", "{", "stream", ".", "allowTypesByWildcard", "(", "new", "String", "[", "]{", "packageName", "+", "\"", ".*", "*\"", "})", ";", "}", "}", "return", "stream", ";", "}", "}", "@", "@", "-", "111", ",", "7", "+", "111", ",", "7", "@", "@", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "org", ".", "apache", ".", "activemq", ".", "SERIALIZABLE_PACKAGES", "\"", ",", "\"", "*\"", ");", "import", "org", ".", "apache", ".", "activemq", ".", "transport", ".", "stomp", ".", "XStreamSupport", ";", "XStream", "stream", "=", "XStreamSupport", ".", "createXStream", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "new", "String", "(", "\"", "Cannot", "display", "ObjectMessage", "body", ".", "Reason", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ";</s>return", "load", "(", "classDesc", ".", "getName", "(", "),", "cl", ",", "inLoader", ")", ";", "return", "Proxy", ".", "getProxyClass", "(", "cl", ",", "cinterfaces", ")", ";", "return", "Proxy", ".", "getProxyClass", "(", "inLoader", ",", "cinterfaces", ")", ";", "return", "Proxy", ".", "getProxyClass", "(", "FALLBACK_CLASS_LOADER", ",", "cinterfaces", ")", ";", "throw", "new", "ClassNotFoundException", "(", "null", ",", "e", ")", ";", "/", "/", "public", "XStream", "getXStream", "(", ")", "{", "XStream", "xstream", "=", "new", "XStream", "(", ");", "throw", "new", "Exception", "(", "\"", "Unkown", "transformation", ":", "\"", "+", "transformation", ")", ";", "xstream", "=", "new", "XStream", "(", ");", "XStream", "stream", "=", "new", "XStream", "(", ");", "}", "catch", "(", "JMSException", "e", ")", "{", "return", "e", ";"], "docstring_tokens": ["the", "failure", "to", "restrict", "the", "classes", "that", "can", "be", "serialized", "in", "the", "broker"]}
{"contents": ["TINY-4511:", "Fixed", "HTML", "comments", "ending", "with", "\"--!>\"", "not", "being", "treated", "as", "closed"], "code_tokens": ["Version", "5", ".", "1", ".", "4", "(", "TBD", ")", "Fixed", "HTML", "comments", "incorrectly", "being", "parsed", "in", "certain", "cases", "#", "TINY", "-", "4511", "import", "Entities", "from", "'", "./", "Entities", "'", ";", "import", "Schema", "from", "'", "./", "Schema", "'", ";", "'", "(?", ":!", "--", "([", "\\\\", "w", "\\", "\\", "W", "]", "*?", ")-", "-!", "?>", ")|", "'", "+", "/", "/", "Comment", "export", "default", "SaxParser", ";", "@", "@", "-", "1", ",", "10", "+", "1", ",", "10", "@", "@", "import", "{", "UnitTest", "}", "from", "'", "@", "ephox", "/", "bedrock", "'", ";", "import", "{", "LegacyUnit", "}", "from", "'", "@", "ephox", "/", "mcagar", "'", ";", "import", "Writer", "from", "'", "tinymce", "/", "core", "/", "api", "/", "html", "/", "Writer", "'", ";", "counter", "=", "createCounter", "(", "writer", ")", ";", "parser", "=", "SaxParser", "(", "counter", ",", "schema", ")", ";", "writer", ".", "reset", "(", ");", "parser", ".", "parse", "(", "'<", "!-", "-", "value", "-", "-!", ">'", ");", "LegacyUnit", ".", "equal", "(", "writer", ".", "getContent", "(", "),", "'", "<!", "--", "value", "-", "->", "',", "'", "Parse", "comment", "with", "exclamation", "in", "end", "value", ".", "')", ";", "LegacyUnit", ".", "deepEqual", "(", "counter", ".", "counts", ",", "{", "comment", ":", "1", "}", ",", "'", "Parse", "comment", "with", "exclamation", "in", "end", "value", "counts", ".", "')", ";</s>import", "Schema", "from", "'", "./", "Schema", "'", ";", "import", "Entities", "from", "'", "./", "Entities", "'", ";", "'", "(?", ":!", "--", "([", "\\\\", "w", "\\", "\\", "W", "]", "*?", ")-", "->", ")|", "'", "+", "/", "/", "Comment", "export", "default", "SaxParser", ";", "import", "{", "LegacyUnit", "}", "from", "'", "@", "ephox", "/", "mcagar", "'", ";", "import", "Writer", "from", "'", "tinymce", "/", "core", "/", "api", "/", "html", "/", "Writer", "'", ";", "import", "{", "UnitTest", "}", "from", "'", "@", "ephox", "/", "bedrock", "'", ";"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["Bug", "#67412", "fileinfo:", "cdf_count_chain", "insufficient", "boundary", "check", "Upstream:", "https://github.com/file/file/commit/40bade80cbe2af1d0b2cd0420cebd5d5905a2382"], "code_tokens": ["cdf_secid_t", "maxsector", "=", "(", "cdf_secid_t", ")", "((", "sat", "-", ">", "sat_len", "*", "size", ")", "/", "sizeof", "(", "maxsector", ")", ");", "if", "(", "sid", ">", "=", "maxsector", ")", "{", "DPRINTF", "(", "(\"", "Sector", "%", "d", ">", "=", "%", "d", "\\", "n", "\"", ",", "sid", ",", "maxsector", ")", ");</s>cdf_secid_t", "maxsector", "=", "(", "cdf_secid_t", ")", "(", "sat", "-", ">", "sat_len", "*", "size", ")", ";", "if", "(", "sid", ">", "maxsector", ")", "{", "DPRINTF", "(", "(\"", "Sector", "%", "d", ">", "%", "d", "\\", "n", "\"", ",", "sid", ",", "maxsector", ")", ");"], "docstring_tokens": ["does", "not", "properly", "validate", "sector-count", "data"]}
{"contents": ["Fix", "sql", "injection", "issue"], "code_tokens": ["import", "org", ".", "apache", ".", "kylin", ".", "metrics", ".", "MetricsManager", ";", "import", "org", ".", "apache", ".", "kylin", ".", "rest", ".", "request", ".", "PrepareSqlRequest", ";", "if", "(", "cube", ".", "getStorageType", "(", ")", "=", "=", "IStorageAware", ".", "ID_HBASE", "|", "|", "cube", ".", "getStorageType", "(", ")", "=", "=", "IStorageAware", ".", "ID_SHARDED_HBASE", "|", "|", "cube", ".", "getStorageType", "(", ")", "=", "=", "IStorageAware", ".", "ID_REALTIME_AND_HBASE", ")", "{", "toDelHDFSPaths", ".", "add", "(", "JobBuilderSupport", ".", "getJobWorkingDir", "(", "seg", ".", "getConfig", "(", ").", "getHdfsWorkingDirectory", "(", "),", "seg", ".", "getLastBuildJobID", "(", "))", ");", "private", "boolean", "isMergingJobBeenDiscarded", "(", "CubeInstance", "cubeInstance", ",", "String", "cubeName", ",", "String", "projectName", ",", "SegmentRange", "offsets", ")", "{", "final", "List", "<", "CubingJob", ">", "jobInstanceList", "=", "jobService", ".", "listJobsByRealizationName", "(", "cubeName", ",", "projectName", ",", "EnumSet", ".", "of", "(", "ExecutableState", ".", "DISCARDED", ")", ");", "long", "rowCount", "=", "(", "rowCountMap", "=", "=", "null", "|", "|", "rowCountMap", ".", "size", "(", ")", "=", "=", "0", ")", "?", "0L", ":", "rowCountMap", ".", "get", "(", "cuboidId", ")", ";", "+", "\"", "from", "\"", "+", "table", "/", "/", "+", "\"", "where", "\"", "+", "QueryCubePropertyEnum", ".", "CUBE", ".", "toString", "(", ")", "+", "\"", "=", "?", "\"", "/", "/", "+", "\"", "group", "by", "\"", "+", "cuboidColumn", ";", "List", "<", "List", "<", "String", ">", ">", "orgHitFrequency", "=", "getPrepareQueryResult", "(", "cubeName", ",", "sql", ")", ";", "+", "\"", "from", "\"", "+", "table", "/", "/", "+", "\"", "where", "\"", "+", "QueryCubePropertyEnum", ".", "CUBE", ".", "toString", "(", ")", "+", "\"", "=", "?", "\"", "/", "/", "+", "\"", "group", "by", "\"", "+", "cuboidSource", "+", "\"", ",", "\"", "+", "cuboidTgt", ";", "List", "<", "List", "<", "String", ">", ">", "orgRollingUpCount", "=", "getPrepareQueryResult", "(", "cubeName", ",", "sql", ")", ";", "+", "\"", "from", "\"", "+", "table", "/", "/", "+", "\"", "where", "\"", "+", "QueryCubePropertyEnum", ".", "CUBE", ".", "toString", "(", ")", "+", "\"", "=", "?", "\"", "/", "/", "+", "\"", "and", "\"", "+", "QueryCubePropertyEnum", ".", "IF_MATCH", ".", "toString", "(", ")", "+", "\"", "=", "true", "\"", "/", "/", "+", "\"", "group", "by", "\"", "+", "cuboidSource", ";", "List", "<", "List", "<", "String", ">", ">", "orgMatchHitFrequency", "=", "getPrepareQueryResult", "(", "cubeName", ",", "sql", ")", ";", "private", "List", "<", "List", "<", "String", ">", ">", "getPrepareQueryResult", "(", "String", "cubeName", ",", "String", "sql", ")", "{", "PrepareSqlRequest", "sqlRequest", "=", "new", "PrepareSqlRequest", "(", ");", "sqlRequest", ".", "setProject", "(", "MetricsManager", ".", "SYSTEM_PROJECT", ")", ";", "PrepareSqlRequest", ".", "StateParam", "[", "]", "params", "=", "new", "PrepareSqlRequest", ".", "StateParam", "[", "1", "]", ";", "params", "[", "0", "]", "=", "new", "PrepareSqlRequest", ".", "StateParam", "(", ");", "params", "[", "0", "]", ".", "setClassName", "(", "\"", "java", ".", "lang", ".", "String", "\"", ");", "params", "[", "0", "]", ".", "setValue", "(", "cubeName", ")", ";", "sqlRequest", ".", "setParams", "(", "params", ")", ";", "sqlRequest", ".", "setSql", "(", "sql", ")", ";", "return", "queryService", ".", "doQueryWithCache", "(", "sqlRequest", ",", "false", ")", ".", "getResults", "(", ");", "}", "+", "\"", "or", "hasPermission", "(", "#", "cube", ",", "'", "ADMINISTRATION", "'", ")", "or", "hasPermission", "(", "#", "cube", ",", "'", "MANAGEMENT", "'", ")\"", ")", "private", "class", "HTableInfoSyncListener", "extends", "Broadcaster", ".", "Listener", "{", "@", "Override", "public", "void", "onClearAll", "(", "Broadcaster", "broadcaster", ")", "throws", "IOException", "{", "htableInfoCache", ".", "invalidateAll", "(", ");", "}", "@", "Override", "public", "void", "onEntityChange", "(", "Broadcaster", "broadcaster", ",", "String", "entity", ",", "Broadcaster", ".", "Event", "event", ",", "String", "cacheKey", ")", "throws", "IOException", "{", "String", "cubeName", "=", "cacheKey", ";", "String", "keyPrefix", "=", "cubeName", "+", "\"", "/\"", ";", "for", "(", "String", "k", ":", "htableInfoCache", ".", "asMap", "(", ").", "keySet", "(", "))", "{", "if", "(", "k", ".", "startsWith", "(", "keyPrefix", ")", ")", "htableInfoCache", ".", "invalidate", "(", "k", ")", ";", "}", "}", "}</s>if", "(", "cube", ".", "getStorageType", "(", ")", "=", "=", "IStorageAware", ".", "ID_HBASE", "|", "|", "cube", ".", "getStorageType", "(", ")", "=", "=", "IStorageAware", ".", "ID_SHARDED_HBASE", "|", "|", "cube", ".", "getStorageType", "(", ")", "=", "=", "IStorageAware", ".", "ID_REALTIME_AND_HBASE", ")", "{", "toDelHDFSPaths", ".", "add", "(", "JobBuilderSupport", ".", "getJobWorkingDir", "(", "seg", ".", "getConfig", "(", ").", "getHdfsWorkingDirectory", "(", "),", "seg", ".", "getLastBuildJobID", "(", "))", ");", "private", "boolean", "isMergingJobBeenDiscarded", "(", "CubeInstance", "cubeInstance", ",", "String", "cubeName", ",", "String", "projectName", ",", "SegmentRange", "offsets", ")", "{", "final", "List", "<", "CubingJob", ">", "jobInstanceList", "=", "jobService", ".", "listJobsByRealizationName", "(", "cubeName", ",", "projectName", ",", "EnumSet", ".", "of", "(", "ExecutableState", ".", "DISCARDED", ")", ");", "private", "class", "HTableInfoSyncListener", "extends", "Broadcaster", ".", "Listener", "{", "@", "Override", "public", "void", "onClearAll", "(", "Broadcaster", "broadcaster", ")", "throws", "IOException", "{", "htableInfoCache", ".", "invalidateAll", "(", ");", "}", "@", "Override", "public", "void", "onEntityChange", "(", "Broadcaster", "broadcaster", ",", "String", "entity", ",", "Broadcaster", ".", "Event", "event", ",", "String", "cacheKey", ")", "throws", "IOException", "{", "String", "cubeName", "=", "cacheKey", ";", "String", "keyPrefix", "=", "cubeName", "+", "\"", "/\"", ";", "for", "(", "String", "k", ":", "htableInfoCache", ".", "asMap", "(", ").", "keySet", "(", "))", "{", "if", "(", "k", ".", "startsWith", "(", "keyPrefix", ")", ")", "htableInfoCache", ".", "invalidate", "(", "k", ")", ";", "}", "}", "}", "long", "rowCount", "=", "rowCountMap", "=", "=", "null", "?", "0L", ":", "rowCountMap", ".", "get", "(", "cuboidId", ")", ";", "+", "\"", "where", "\"", "+", "QueryCubePropertyEnum", ".", "CUBE", ".", "toString", "(", ")", "+", "\"", "=", "'", "\"", "+", "cubeName", "+", "\"", "'\"", "/", "/", "List", "<", "List", "<", "String", ">", ">", "orgHitFrequency", "=", "queryService", ".", "querySystemCube", "(", "sql", ")", ".", "getResults", "(", ");", "+", "\"", "where", "\"", "+", "QueryCubePropertyEnum", ".", "CUBE", ".", "toString", "(", ")", "+", "\"", "=", "'", "\"", "+", "cubeName", "+", "\"", "'", "\"", "/", "/", "List", "<", "List", "<", "String", ">", ">", "orgRollingUpCount", "=", "queryService", ".", "querySystemCube", "(", "sql", ")", ".", "getResults", "(", ");", "+", "\"", "where", "\"", "+", "QueryCubePropertyEnum", ".", "CUBE", ".", "toString", "(", ")", "+", "\"", "=", "'", "\"", "+", "cubeName", "+", "\"", "'\"", "/", "/", "List", "<", "List", "<", "String", ">", ">", "orgMatchHitFrequency", "=", "queryService", ".", "querySystemCube", "(", "sql", ")", ".", "getResults", "(", ");"], "docstring_tokens": ["run", "malicious", "database", "queries"]}
{"contents": ["Merge", "pull", "request", "from", "GHSA-7557-4v29-rqw6", "Fix", "directory", "traversal"], "code_tokens": ["import", "org", ".", "loklak", ".", "tools", ".", "IO", ";", "assets", "=", "new", "File", "(", "datadir", ",", "\"", "assets", "\"", ").", "getAbsoluteFile", "(", ");", "Path", "storage_path", "=", "IO", ".", "resolvePath", "(", "assets", ".", "toPath", "(", "),", "letter0", ",", "letter1", ",", "screen_name", ")", ";", "return", "IO", ".", "resolvePath", "(", "storage_path", ",", "id_str", "+", "\"", "_", "\"", "+", "file", ")", ".", "toFile", "(", ");", "/", "/", "all", "assets", "for", "one", "user", "in", "one", "file", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "/", "**", "*", "Resolves", "an", "untrusted", "user", "-", "specified", "path", "against", "the", "API", "'", "s", "base", "directory", ".", "*", "Paths", "that", "try", "to", "escape", "the", "base", "directory", "are", "rejected", ".", "*", "*", "@", "param", "baseDirPath", "the", "absolute", "path", "of", "the", "base", "directory", "that", "all", "*", "user", "-", "specified", "paths", "should", "be", "within", "*", "@", "param", "userPath", "the", "untrusted", "path", "provided", "by", "the", "API", "user", ",", "expected", "to", "be", "*", "relative", "to", "{", "@", "code", "baseDirPath", "}", "*", "/", "public", "static", "Path", "resolvePath", "(", "final", "Path", "baseDirPath", ",", "final", "Path", "userPath", ")", "{", "if", "(", "!", "baseDirPath", ".", "isAbsolute", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Base", "path", "must", "be", "absolute", "\"", ");", "}", "if", "(", "userPath", ".", "isAbsolute", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "User", "path", "must", "be", "relative", "\"", ");", "}", "/", "/", "Join", "the", "two", "paths", "together", ",", "then", "normalize", "so", "that", "any", "\"", "..", "\"", "elements", "/", "/", "in", "the", "userPath", "can", "remove", "parts", "of", "baseDirPath", ".", "/", "/", "(", "e", ".", "g", ".", "\"", "/", "foo", "/", "bar", "/", "baz", "\"", "+", "\"", "..", "/", "attack", "\"", "-", ">", "\"", "/", "foo", "/", "bar", "/", "attack", "\"", ")", "final", "Path", "resolvedPath", "=", "baseDirPath", ".", "resolve", "(", "userPath", ")", ".", "normalize", "(", ");", "/", "/", "Make", "sure", "the", "resulting", "path", "is", "still", "within", "the", "required", "directory", ".", "/", "/", "(", "In", "the", "example", "above", ",", "\"", "/", "foo", "/", "bar", "/", "attack", "\"", "is", "not", ".", ")", "if", "(", "!", "resolvedPath", ".", "startsWith", "(", "baseDirPath", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "User", "path", "escapes", "the", "base", "path", "\"", ");", "}", "return", "resolvedPath", ";", "}", "public", "static", "Path", "resolvePath", "(", "final", "Path", "baseDirPath", ",", "final", "String", "userPath", ")", "{", "return", "resolvePath", "(", "baseDirPath", ",", "Paths", ".", "get", "(", "userPath", ")", ");", "}", "/", "**", "*", "Checks", "each", "subsequent", "path", "to", "be", "strictly", "within", "the", "baseDirPath", "so", "that", "*", "no", "path", "argument", "leads", "to", "directory", "traversal", "attack", "*", "*", "E", ".", "g", ".", "/", "models", "/", "+", "req", ".", "model", "+", "'", "/'", "+", "req", ".", "lang", "+", "/", "images", "/", "+", "req", ".", "image", "*", "Should", "be", "checked", "for", "(", "'", "models", "'", ",", "req", ".", "model", ",", "req", ".", "lang", ",", "'", "images", "'", ",", "req", ".", "image", ")", "*", "that", "each", "subsequent", "element", "is", "within", "the", "previous", "and", "not", "breaking", "out", "by", "passing", "*", "req", ".", "model", "=", ">", ".", ".", "*", "req", ".", "lang", "=", ">", ".", ".", "*", "req", ".", "image", "=", ">", ".", "./", "..", "/", "private", "/", "data", ".", "json", "*", "*", "Since", "just", "checking", "the", "last", "argument", "isn", "'", "t", "enough", "*", "*", "@", "param", "baseDirPath", "the", "absolute", "path", "of", "the", "base", "directory", "that", "all", "*", "user", "-", "specified", "paths", "should", "be", "within", "*", "@", "param", "paths", "the", "untrusted", "paths", "provided", "by", "the", "API", "user", ",", "expected", "to", "be", "*", "relative", "to", "{", "@", "code", "baseDirPath", "}", "*", "/", "public", "static", "Path", "resolvePath", "(", "final", "Path", "baseDirPath", ",", "final", "String", ".", "..", "paths", ")", "{", "Path", "resolved", "=", "baseDirPath", ";", "for", "(", "String", "path", ":", "paths", ")", "{", "resolved", "=", "resolvePath", "(", "resolved", ",", "path", ")", ";", "}", "return", "resolved", ";", "}</s>assets", "=", "new", "File", "(", "datadir", ",", "\"", "assets", "\"", ");", "File", "storage_path", "=", "new", "File", "(", "new", "File", "(", "new", "File", "(", "assets", ",", "letter0", ")", ",", "letter1", ")", ",", "screen_name", ")", ";", "return", "new", "File", "(", "storage_path", ",", "id_str", "+", "\"", "_", "\"", "+", "file", ")", ";", "/", "/", "all", "assets", "for", "one", "user", "in", "one", "file"], "docstring_tokens": ["insufficient", "input", "validation"]}
{"contents": ["Use", "the", "Index", "Access", "Control", "from", "the", "scroll", "search", "context", "(#60640)", "When", "the", "RBACEngine", "authorizes", "scroll", "searches", "it", "sets", "the", "index", "access", "control", "to", "the", "very", "limiting", "IndicesAccessControl.ALLOW_NO_INDICES", "value.", "This", "change", "will", "set", "it", "to", "the", "value", "for", "the", "index", "access", "control", "that", "was", "produced", "during", "the", "authorization", "of", "the", "initial", "search", "that", "created", "the", "scroll,", "which", "is", "now", "stored", "in", "the", "scroll", "context."], "code_tokens": ["/", "/", "RBACEngine", "simply", "authorizes", "scroll", "related", "actions", "without", "filling", "in", "any", "DLS", "/", "FLS", "permissions", ".", "/", "/", "Scroll", "related", "actions", "have", "special", "security", "logic", ",", "where", "the", "security", "context", "of", "the", "initial", "search", "/", "/", "request", "is", "attached", "to", "the", "scroll", "context", "upon", "creation", "in", "{", "@", "code", "SecuritySearchOperationListener", "#", "onNewScrollContext", "}", "/", "/", "and", "it", "is", "then", "verified", ",", "before", "every", "use", "of", "the", "scroll", ",", "in", "/", "/", "{", "@", "code", "SecuritySearchOperationListener", "#", "validateSearchContext", "}", ".", "/", "/", "The", "DLS", "/", "FLS", "permissions", "are", "used", "inside", "the", "{", "@", "code", "DirectoryReader", "}", "that", "{", "@", "code", "SecurityIndexReaderWrapper", "}", "/", "/", "built", "while", "handling", "the", "initial", "search", "request", ".", "In", "addition", ",", "for", "consistency", ",", "the", "DLS", "/", "FLS", "permissions", "from", "/", "/", "the", "originating", "search", "request", "are", "attached", "to", "the", "thread", "context", "upon", "validating", "the", "scroll", ".", "listener", ".", "onResponse", "(", "new", "IndexAuthorizationResult", "(", "true", ",", "null", ")", ");", "import", "org", ".", "elasticsearch", ".", "ElasticsearchSecurityException", ";", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "AuthorizationServiceField", ";", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "accesscontrol", ".", "IndicesAccessControl", ";", "/", "/", "store", "the", "DLS", "and", "FLS", "permissions", "of", "the", "initial", "search", "request", "that", "created", "the", "scroll", "/", "/", "this", "is", "then", "used", "to", "assert", "the", "DLS", "/", "FLS", "permission", "for", "the", "scroll", "search", "action", "IndicesAccessControl", "indicesAccessControl", "=", "securityContext", ".", "getThreadContext", "(", ").", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "assert", "indicesAccessControl", "!", "=", "null", ":", "\"", "thread", "context", "does", "not", "contain", "index", "access", "control", "\"", ";", "searchContext", ".", "scrollContext", "(", ").", "putInContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "indicesAccessControl", ")", ";", "/", "/", "piggyback", "on", "context", "validation", "to", "assert", "the", "DLS", "/", "FLS", "permissions", "on", "the", "thread", "context", "of", "the", "scroll", "search", "handler", "if", "(", "null", "=", "=", "securityContext", ".", "getThreadContext", "(", ").", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ")", "{", "/", "/", "fill", "in", "the", "DLS", "and", "FLS", "permissions", "for", "the", "scroll", "search", "action", "from", "the", "scroll", "context", "IndicesAccessControl", "scrollIndicesAccessControl", "=", "searchContext", ".", "scrollContext", "(", ").", "getFromContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "assert", "scrollIndicesAccessControl", "!", "=", "null", ":", "\"", "scroll", "does", "not", "contain", "index", "access", "control", "\"", ";", "securityContext", ".", "getThreadContext", "(", ").", "putTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "scrollIndicesAccessControl", ")", ";", "}", "}", "}", "}", "@", "Override", "public", "void", "onPreFetchPhase", "(", "SearchContext", "searchContext", ")", "{", "ensureIndicesAccessControlForScrollThreadContext", "(", "searchContext", ")", ";", "}", "@", "Override", "public", "void", "onPreQueryPhase", "(", "SearchContext", "searchContext", ")", "{", "ensureIndicesAccessControlForScrollThreadContext", "(", "searchContext", ")", ";", "}", "void", "ensureIndicesAccessControlForScrollThreadContext", "(", "SearchContext", "searchContext", ")", "{", "if", "(", "licenseState", ".", "isSecurityEnabled", "(", ")", "&", "&", "searchContext", ".", "scrollContext", "(", ")", "!", "=", "null", ")", "{", "IndicesAccessControl", "scrollIndicesAccessControl", "=", "searchContext", ".", "scrollContext", "(", ").", "getFromContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "IndicesAccessControl", "threadIndicesAccessControl", "=", "securityContext", ".", "getThreadContext", "(", ").", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ";", "if", "(", "scrollIndicesAccessControl", "!", "=", "threadIndicesAccessControl", ")", "{", "throw", "new", "ElasticsearchSecurityException", "(", "\"[", "\"", "+", "searchContext", ".", "id", "(", ")", "+", "\"", "]", "expected", "scroll", "indices", "access", "control", "[", "\"", "scrollIndicesAccessControl", ".", "toString", "(", ")", "+", "\"", "]", "but", "found", "[", "\"", "+", "threadIndicesAccessControl", ".", "toString", "(", ")", "+", "\"", "]", "in", "thread", "\"", "\"", "context", "\"", ");", "import", "org", ".", "elasticsearch", ".", "index", ".", "query", ".", "QueryBuilder", ";", "public", "void", "testScrollWithQueryCache", "(", ")", "{", "assertAcked", "(", "client", "(", ").", "admin", "(", ").", "indices", "(", ").", "prepareCreate", "(", "\"", "test", "\"", ")", ".", "setSettings", "(", "Settings", ".", "builder", "(", ").", "put", "(", "IndexModule", ".", "INDEX_QUERY_CACHE_EVERYTHING_SETTING", ".", "getKey", "(", "),", "true", ")", ")", ".", "setMapping", "(", "\"", "field1", "\"", ",", "\"", "type", "=", "text", "\"", ",", "\"", "field2", "\"", ",", "\"", "type", "=", "text", "\"", ")", ")", ";", "final", "int", "numDocs", "=", "scaledRandomIntBetween", "(", "2", ",", "4", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numDocs", ";", "i", "+", "+)", "{", "client", "(", ").", "prepareIndex", "(", "\"", "test", "\"", ").", "setId", "(", "String", ".", "valueOf", "(", "i", ")", ")", ".", "setSource", "(", "\"", "field1", "\"", ",", "\"", "value1", "\"", ",", "\"", "field2", "\"", ",", "\"", "value2", "\"", ")", ".", "get", "(", ");", "}", "refresh", "(", "\"", "test", "\"", ");", "final", "QueryBuilder", "cacheableQueryBuilder", "=", "constantScoreQuery", "(", "termQuery", "(", "\"", "field1", "\"", ",", "\"", "value1", "\"", "))", ";", "SearchResponse", "user1SearchResponse", "=", "null", ";", "SearchResponse", "user2SearchResponse", "=", "null", ";", "int", "scrolledDocsUser1", "=", "0", ";", "final", "int", "numScrollSearch", "=", "scaledRandomIntBetween", "(", "20", ",", "30", ")", ";", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numScrollSearch", ";", "i", "+", "+)", "{", "if", "(", "randomBoolean", "(", "))", "{", "if", "(", "user2SearchResponse", "=", "=", "null", ")", "{", "user2SearchResponse", "=", "client", "(", ").", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user2", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearch", "(", "\"", "test", "\"", ")", ".", "setQuery", "(", "cacheableQueryBuilder", ")", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "setSize", "(", "1", ")", ".", "setFetchSource", "(", "true", ")", ".", "get", "(", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "0", ")", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "0", ")", ");", "}", "else", "{", "/", "/", "make", "sure", "scroll", "is", "empty", "user2SearchResponse", "=", "client", "(", ")", ".", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user2", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearchScroll", "(", "user2SearchResponse", ".", "getScrollId", "(", "))", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "get", "(", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "0", ")", ");", "assertThat", "(", "user2SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "0", ")", ");", "if", "(", "randomBoolean", "(", "))", "{", "/", "/", "maybe", "reuse", "the", "scroll", "even", "if", "empty", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "user2SearchResponse", ".", "getScrollId", "(", "))", ".", "get", "(", ");", "user2SearchResponse", "=", "null", ";", "}", "}", "}", "else", "{", "if", "(", "user1SearchResponse", "=", "=", "null", ")", "{", "user1SearchResponse", "=", "client", "(", ").", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user1", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearch", "(", "\"", "test", "\"", ")", ".", "setQuery", "(", "cacheableQueryBuilder", ")", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "setSize", "(", "1", ")", ".", "setFetchSource", "(", "true", ")", ".", "get", "(", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "numDocs", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "get", "(", "\"", "field1", "\"", "),", "is", "(", "\"", "value1", "\"", "))", ";", "scrolledDocsUser1", "+", "+;", "}", "else", "{", "user1SearchResponse", "=", "client", "(", ")", ".", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "BASIC_AUTH_HEADER", ",", "basicAuthHeaderValue", "(", "\"", "user1", "\"", ",", "USERS_PASSWD", ")", "))", ".", "prepareSearchScroll", "(", "user1SearchResponse", ".", "getScrollId", "(", "))", ".", "setScroll", "(", "TimeValue", ".", "timeValueMinutes", "(", "10L", ")", ")", ".", "get", "(", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getTotalHits", "(", ").", "value", ",", "is", "(", "(", "long", ")", "numDocs", ")", ");", "if", "(", "scrolledDocsUser1", "<", "numDocs", ")", "{", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getAt", "(", "0", ")", ".", "getSourceAsMap", "(", ").", "get", "(", "\"", "field1", "\"", "),", "is", "(", "\"", "value1", "\"", "))", ";", "scrolledDocsUser1", "+", "+;", "}", "else", "{", "assertThat", "(", "user1SearchResponse", ".", "getHits", "(", ").", "getHits", "(", ").", "length", ",", "is", "(", "0", ")", ");", "if", "(", "randomBoolean", "(", "))", "{", "/", "/", "maybe", "reuse", "the", "scroll", "even", "if", "empty", "if", "(", "user1SearchResponse", ".", "getScrollId", "(", ")", "!", "=", "null", ")", "{", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "user1SearchResponse", ".", "getScrollId", "(", "))", ".", "get", "(", ");", "}", "user1SearchResponse", "=", "null", ";", "scrolledDocsUser1", "=", "0", ";", "}", "}", "}", "}", "}", "}", "finally", "{", "if", "(", "user1SearchResponse", "!", "=", "null", ")", "{", "String", "scrollId", "=", "user1SearchResponse", ".", "getScrollId", "(", ");", "if", "(", "scrollId", "!", "=", "null", ")", "{", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "scrollId", ")", ".", "get", "(", ");", "}", "}", "if", "(", "user2SearchResponse", "!", "=", "null", ")", "{", "String", "scrollId", "=", "user2SearchResponse", ".", "getScrollId", "(", ");", "if", "(", "scrollId", "!", "=", "null", ")", "{", "client", "(", ").", "prepareClearScroll", "(", ").", "addScrollId", "(", "scrollId", ")", ".", "get", "(", ");", "}", "}", "}", "}", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "AuthorizationServiceField", ";", "import", "org", ".", "elasticsearch", ".", "xpack", ".", "core", ".", "security", ".", "authz", ".", "accesscontrol", ".", "IndicesAccessControl", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "nullValue", ";", "IndicesAccessControl", "indicesAccessControl", "=", "mock", "(", "IndicesAccessControl", ".", "class", ")", ";", "threadContext", ".", "putTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "indicesAccessControl", ")", ";", "assertThat", "(", "testSearchContext", ".", "scrollContext", "(", ").", "getFromContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "final", "IndicesAccessControl", "indicesAccessControl", "=", "mock", "(", "IndicesAccessControl", ".", "class", ")", ";", "testSearchContext", ".", "scrollContext", "(", ").", "putInContext", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ",", "indicesAccessControl", ")", ";", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "nullValue", "(", "))", ";", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "is", "(", "indicesAccessControl", ")", ");", "assertThat", "(", "threadContext", ".", "getTransient", "(", "AuthorizationServiceField", ".", "INDICES_PERMISSIONS_KEY", ")", ",", "nullValue", "(", "))", ";</s>/", "/", "we", "store", "the", "request", "as", "a", "transient", "in", "the", "ThreadContext", "in", "case", "of", "a", "authorization", "failure", "at", "the", "shard", "/", "/", "level", ".", "If", "authorization", "fails", "we", "will", "audit", "a", "access_denied", "message", "and", "will", "use", "the", "request", "to", "retrieve", "/", "/", "information", "such", "as", "the", "index", "and", "the", "incoming", "address", "of", "the", "request", "listener", ".", "onResponse", "(", "new", "IndexAuthorizationResult", "(", "true", ",", "IndicesAccessControl", ".", "ALLOW_NO_INDICES", ")", ");"], "docstring_tokens": ["a", "field", "disclosure", "flaw", "was", "found", "when", "running", "a", "scrolling", "search", "with", "Field", "Level", "Security", "."]}
{"contents": ["netfilter:", "x_tables:", "fix", "unconditional", "helper", "Ben", "Hawkes", "says:", "In", "the", "mark_source_chains", "function", "(net/ipv4/netfilter/ip_tables.c)", "it", "is", "possible", "for", "a", "user-supplied", "ipt_entry", "structure", "to", "have", "a", "large", "next_offset", "field.", "This", "field", "is", "not", "bounds", "checked", "prior", "to", "writing", "a", "counter", "value", "at", "the", "supplied", "offset.", "Problem", "is", "that", "mark_source_chains", "should", "not", "have", "been", "called", "--", "the", "rule", "doesn't", "have", "a", "next", "entry,", "so", "its", "supposed", "to", "return", "an", "absolute", "verdict", "of", "either", "ACCEPT", "or", "DROP.", "However,", "the", "function", "conditional()", "doesn't", "work", "as", "the", "name", "implies.", "It", "only", "checks", "that", "the", "rule", "is", "using", "wildcard", "address", "matching.", "However,", "an", "unconditional", "rule", "must", "also", "not", "be", "using", "any", "matches", "(no", "-m", "args).", "The", "underflow", "validator", "only", "checked", "the", "addresses,", "therefore", "passing", "the", "'unconditional", "absolute", "verdict'", "test,", "while", "mark_source_chains", "also", "tested", "for", "presence", "of", "matches,", "and", "thus", "proceeeded", "to", "the", "next", "(not-existent)", "rule.", "Unify", "this", "so", "that", "all", "the", "callers", "have", "same", "idea", "of", "'unconditional", "rule'.", "Reported-by:", "Ben", "Hawkes", "<hawkes@google.com>", "Signed-off-by:", "Florian", "Westphal", "<fw@strlen.de>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["static", "inline", "bool", "unconditional", "(", "const", "struct", "arpt_entry", "*", "e", ")", "return", "e", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "arpt_entry", ")", "&", "&", "memcmp", "(", "&", "e", "-", ">", "arp", ",", "&", "uncond", ",", "sizeof", "(", "uncond", ")", ")", "=", "=", "0", ";", "if", "(", "(", "unconditional", "(", "e", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", ")", "|", "|", "visited", ")", "{", "if", "(", "!", "unconditional", "(", "e", ")", ")", "pr_debug", "(", "\"", "Underflows", "must", "be", "unconditional", "and", "\"", "\"", "use", "the", "STANDARD", "target", "with", "\"", "\"", "ACCEPT", "/", "DROP", "\\", "n", "\"", ");", "static", "inline", "bool", "unconditional", "(", "const", "struct", "ipt_entry", "*", "e", ")", "return", "e", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "ipt_entry", ")", "&", "&", "memcmp", "(", "&", "e", "-", ">", "ip", ",", "&", "uncond", ",", "sizeof", "(", "uncond", ")", ")", "=", "=", "0", ";", "if", "(", "unconditional", "(", "s", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", ")", "{", "if", "(", "(", "unconditional", "(", "e", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", ")", "|", "|", "visited", ")", "{", "if", "(", "!", "unconditional", "(", "e", ")", ")", "pr_debug", "(", "\"", "Underflows", "must", "be", "unconditional", "and", "\"", "\"", "use", "the", "STANDARD", "target", "with", "\"", "\"", "ACCEPT", "/", "DROP", "\\", "n", "\"", ");", "static", "inline", "bool", "unconditional", "(", "const", "struct", "ip6t_entry", "*", "e", ")", "return", "e", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "ip6t_entry", ")", "&", "&", "memcmp", "(", "&", "e", "-", ">", "ipv6", ",", "&", "uncond", ",", "sizeof", "(", "uncond", ")", ")", "=", "=", "0", ";", "if", "(", "unconditional", "(", "s", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", ")", "{", "if", "(", "(", "unconditional", "(", "e", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", ")", "|", "|", "visited", ")", "{", "if", "(", "!", "unconditional", "(", "e", ")", ")", "pr_debug", "(", "\"", "Underflows", "must", "be", "unconditional", "and", "\"", "\"", "use", "the", "STANDARD", "target", "with", "\"", "\"", "ACCEPT", "/", "DROP", "\\", "n", "\"", ");</s>static", "inline", "bool", "unconditional", "(", "const", "struct", "arpt_arp", "*", "arp", ")", "return", "memcmp", "(", "arp", ",", "&", "uncond", ",", "sizeof", "(", "uncond", ")", ")", "=", "=", "0", ";", "if", "(", "(", "e", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "arpt_entry", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", "&", "&", "unconditional", "(", "&", "e", "-", ">", "arp", ")", ")", "|", "|", "visited", ")", "{", "if", "(", "!", "unconditional", "(", "&", "e", "-", ">", "arp", ")", ")", "pr_err", "(", "\"", "Underflows", "must", "be", "unconditional", "and", "\"", "\"", "use", "the", "STANDARD", "target", "with", "\"", "\"", "ACCEPT", "/", "DROP", "\\", "n", "\"", ");", "static", "inline", "bool", "unconditional", "(", "const", "struct", "ipt_ip", "*", "ip", ")", "return", "memcmp", "(", "ip", ",", "&", "uncond", ",", "sizeof", "(", "uncond", ")", ")", "=", "=", "0", ";", "if", "(", "s", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "ipt_entry", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", "&", "&", "unconditional", "(", "&", "s", "-", ">", "ip", ")", ")", "{", "if", "(", "(", "e", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "ipt_entry", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", "&", "&", "unconditional", "(", "&", "e", "-", ">", "ip", ")", ")", "|", "|", "visited", ")", "{", "if", "(", "!", "unconditional", "(", "&", "e", "-", ">", "ip", ")", ")", "pr_err", "(", "\"", "Underflows", "must", "be", "unconditional", "and", "\"", "\"", "use", "the", "STANDARD", "target", "with", "\"", "\"", "ACCEPT", "/", "DROP", "\\", "n", "\"", ");", "static", "inline", "bool", "unconditional", "(", "const", "struct", "ip6t_ip6", "*", "ipv6", ")", "return", "memcmp", "(", "ipv6", ",", "&", "uncond", ",", "sizeof", "(", "uncond", ")", ")", "=", "=", "0", ";", "if", "(", "s", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "ip6t_entry", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", "&", "&", "unconditional", "(", "&", "s", "-", ">", "ipv6", ")", ")", "{", "if", "(", "(", "e", "-", ">", "target_offset", "=", "=", "sizeof", "(", "struct", "ip6t_entry", ")", "&", "&", "t", "-", ">", "verdict", "<", "0", "&", "&", "unconditional", "(", "&", "e", "-", ">", "ipv6", ")", ")", "|", "|", "visited", ")", "{", "if", "(", "!", "unconditional", "(", "&", "e", "-", ">", "ipv6", ")", ")", "pr_err", "(", "\"", "Underflows", "must", "be", "unconditional", "and", "\"", "\"", "use", "the", "STANDARD", "target", "with", "\"", "\"", "ACCEPT", "/", "DROP", "\\", "n", "\"", ");"], "docstring_tokens": ["does", "not", "validate", "certain", "offset", "fields"]}
{"contents": ["fixed", "cross", "site", "scripting,", "and", "changed", "packages", "around..."], "code_tokens": ["<", "artifactId", ">", "jamon", "<", "/", "artifactId", ">", "private", "static", "final", "String", "DEFAULT_SUMMARY", "=", "\"", "default", ",", "response", ".", "getStatus", "(", ").", "value", ".", "httpStatus", ",", "request", ".", "contextpath", ".", "ms", "\"", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*,", "net", ".", "sf", ".", "xsshtmlfilter", ".", "HTMLFilter", "\"", "%", ">", "HTMLFilter", "vFilter", "=", "new", "HTMLFilter", "(", ");", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "vFilter", ".", "filter", "(", "value", ")", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*,", "net", ".", "sf", ".", "xsshtmlfilter", ".", "HTMLFilter", "\"", "%", ">", "HTMLFilter", "vFilter", "=", "new", "HTMLFilter", "(", ");", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "vFilter", ".", "filter", "(", "value", ")", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*,", "net", ".", "sf", ".", "xsshtmlfilter", ".", "HTMLFilter", "\"", "%", ">", "String", "[", "]", "bufferSizeHeader", "=", "{\"", "bufferSize", "\"", ",\"", "bufferSizeDisplay", "\"", "};", "Object", "[", "][", "]", "bufferSizeBody", "=", "{", "{", "\"", "No", "Action", "\"", ",", "\"", "No", "Action", "\"", "},", "{", "\"", "50", "\"", ",", "\"", "50", "rows", "\"", "},", "{", "\"", "100", "\"", ",", "\"", "100", "rows", "\"", "},", "{", "\"", "250", "\"", ",", "\"", "250", "rows", "\"", "},", "{", "\"", "500", "\"", ",\"", "500", "rows", "\"", "},", "{", "\"", "1000", "\"", ",\"", "1000", "rows", "\"", "},", "{", "\"", "2000", "\"", ",\"", "2000", "rows", "\"", "},", "}", ";", "else", "if", "(", "\"", "100", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "100", ")", ";", "else", "if", "(", "\"", "250", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "250", ")", ";", "else", "if", "(", "\"", "500", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "500", ")", ";", "else", "if", "(", "\"", "1000", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "1000", ")", ";", "else", "if", "(", "\"", "2000", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "2000", ")", ";", "HTMLFilter", "vFilter", "=", "new", "HTMLFilter", "(", ");", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "vFilter", ".", "filter", "(", "value", ")", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*,", "net", ".", "sf", ".", "xsshtmlfilter", ".", "HTMLFilter", "\"", "%", ">", "HTMLFilter", "vFilter", "=", "new", "HTMLFilter", "(", ");", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "vFilter", ".", "filter", "(", "value", ")", ";", "/", "/", "convert", "arg", "to", "an", "int", "or", "return", "the", "default", "retValue", "=", "defaultValue", ";", "return", "Integer", ".", "parseInt", "(", "retValue", ")", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "sql", ".", "*,", "javax", ".", "sql", ".", "*,", "java", ".", "util", ".", "*,", "java", ".", "text", ".", "*,", "javax", ".", "naming", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*,", "net", ".", "sf", ".", "xsshtmlfilter", ".", "HTMLFilter", "\"", "%", ">", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*,", "net", ".", "sf", ".", "xsshtmlfilter", ".", "HTMLFilter", "\"", "%", ">", "private", "static", "String", "getValue", "(", "String", "value", ",", "String", "defaultValue", ")", "{", "HTMLFilter", "vFilter", "=", "new", "HTMLFilter", "(", ");", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "vFilter", ".", "filter", "(", "value", ")", ";", "}", "<", "module", ">", "jamon", "<", "/", "module", ">", "<", "title", ">", "HTTP", "Monitoring", "<", "/", "title", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Tomcat", "6", ",", "7", ",", "8", "+", "</", "b", ">", "</", "li", ">", "<", "li", ">", "<", "b", ">", "Jetty", "6", ".", "1", ".", "5", "<", "/", "b", ">", "-", "The", "package", "and", "approach", "to", "handlers", "changed", "on", "following", "versions", "of", "jetty", ".", "Contact", "me", "if", "you", "would", "like", "to", "work", "with", "a", "later", "version", ".", "</", "li", ">", "<", "li", ">", "Put", "jamon", "-", "2", ".", "7", ".", "jar", "(", "or", "higher", ")", "in", "the", "jetty", "'", "lib", "'", "directory", ".", "(", "note", "in", "later", "versions", "of", "jetty", "the", "jamon", "jar", "should", "be", "put", "in", "lib", "/", "ext", ")", "</", "li", ">", "<", "!", "DOCTYPE", "HTML", "PUBLIC", "\"", "-/", "/", "W3C", "/", "/", "DTD", "HTML", "4", ".", "01", "Transitional", "/", "/", "EN", "\"", ">", "<", "html", ">", "<", "head", ">", "<", "meta", "name", "=", "\"", "keywords", "\"", "lang", "=", "\"", "en", "-", "us", "\"", "content", "=", "\"", "spring", ",", "aop", ",", "jamonaspect", ",", "java", ",", "performance", "tuning", ",", "jamonlistener", ",", "log4j", ",", "jboss", ",", "appender", ",", "JAMonAppender", ",", "listener", ",", "monitor", ",", "bottleneck", ",", "scale", ",", "scalability", ",", "monitoring", "tools", ",", "page", "hits", ",", "page", "counter", ",", "currentTimeMillis", ",", "benchmark", ",", "jamonapi", ",", "free", ",", "freeware", ",", "shareware", ",", "open", "source", ",", "measure", ",", "fdsapi", ",", "http", ",", "valve", ",", "tomcat", ",", "jetty", ",", "jboss", ",", "appserver", ",", "webserver", ",", "formatteddataset", ",", "servlet", "filter", "\"", ">", "<", "meta", "name", "=", "\"", "description", "\"", "content", "=", "\"", "The", "Java", "Application", "Monitor", "(", "JAMon", ")", "is", "a", "free", ",", "simple", ",", "high", "performance", ",", "thread", "safe", ",", "Java", "API", "that", "allows", "developers", "to", "easily", "monitor", "production", "applications", ".", "\">", "<", "title", ">", "Spring", "and", "Jamon", "using", "AOP", "<", "/", "title", ">", "<", "/", "head", ">", "<", "body", "bgcolor", "=", "\"#", "FFFFFF", "\"", ">", "<", "div", "align", "=", "\"", "center", "\"", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "><", "!-", "-", "google_ad_client", "=", "\"", "pub", "-", "2677015225815089", "\"", ";", "google_ad_width", "=", "728", ";", "google_ad_height", "=", "90", ";", "google_ad_format", "=", "\"", "728x90_as", "\"", ";", "google_ad_type", "=", "\"", "text_image", "\"", ";", "google_ad_channel", "=", "\"\"", ";", "google_color_border", "=", "\"", "336699", "\"", ";", "google_color_bg", "=", "\"", "FFFFFF", "\"", ";", "google_color_link", "=", "\"", "0000FF", "\"", ";", "google_color_url", "=", "\"", "008000", "\"", ";", "google_color_text", "=", "\"", "000000", "\"", ";", "/", "/-", "->", "</", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "http", ":", "//", "pagead2", ".", "googlesyndication", ".", "com", "/", "pagead", "/", "show_ads", ".", "js", "\"", ">", "<", "/", "script", ">", "<", "/", "div", ">", "<", "hr", ">", "<", "p", "align", "=", "\"", "center", "\"", ">", "<", "img", "src", "=", "\"", "jamon1", ".", "jpg", "\"", "id", "=", "\"", "fdsbanner1", "\"", "border", "=", "\"", "0", "\"", "/", "><", "/", "a", ">", "<", "/", "p", ">", "<", "h2", "align", "=", "'", "center", "'", ">", "Using", "Spring", "and", "JAMon", "together", "-", "Monitoring", "with", "AOP", "<", "/", "h2", ">", "<", "!-", "-", "START", "JAMON", "SPECIFIC", "HTML", "-", "->", "<", "table", "border", "=", "\"", "0", "\"", "width", "=", "\"", "80", "%", "\"", "align", "=", "\"", "center", "\"", ">", "<", "tr", ">", "<", "/", "tr", ">", "<", "tr", "align", "=", "\"", "left", "\"", ">", "<", "th", ">", "<", "ol", ">", "<", "li", ">", "<", "a", "href", "=", "\"#", "intro", "\"", ">", "Introduction", "<", "/", "a", ">", "</", "li", ">", "<", "li", ">", "<", "a", "href", "=", "\"#", "interpretting", "\"", ">", "Show", "me", "how", "it", "works", "?", "</", "a", ">", "</", "li", ">", "<", "li", ">", "<", "a", "href", "=", "\"#", "configuring", "\"", ">", "Configuring", "the", "JAMon", "HTTP", "Monitor", "<", "/", "a", ">", "</", "li", ">", "<", "li", ">", "<", "a", "href", "=", "\"", "tomcat6_server", ".", "xml", "\"", ">", "Sample", "Tomcat", "6", "server", ".", "xml", "file", "<", "/", "a", ">", "</", "li", ">", "<", "li", ">", "<", "a", "href", "=", "\"", "jboss_server", ".", "xml", "\"", ">", "Sample", "JBoss", "4", ".", "0", ".", "5", "server", ".", "xml", "file", "<", "/", "a", ">", "</", "li", ">", "<", "li", ">", "<", "a", "href", "=", "\"", "jetty", ".", "xml", "\"", ">", "Sample", "Jetty", "6", ".", "1", ".", "5", "jetty", ".", "xml", "file", "<", "/", "a", ">", "</", "li", ">", "<", "/", "ol", ">", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "br", ">", "<", "br", ">", "</", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "table", "border", "=", "\"", "0", "\"", "width", "=", "\"", "80", "%", "\"", "align", "=", "\"", "center", "\"", ">", "<", "tr", ">", "<", "th", "align", "=", "\"", "left", "\"", "><", "h2", ">", "<", "a", "name", "=", "\"", "intro", "\"", ">", "1", ".", "Introduction", "<", "/", "a", ">", "</", "h2", ">", "</", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "p", ">", "JAMon", "and", "Aspect", "Oriented", "Programming", "are", "a", "perfect", "pairing", ".", "JAMon", "can", "wrap", "any", "method", "call", "and", "track", "concurrency", ",", "performance", ",", "exceptions", "and", "also", "view", "the", "N", "most", "recent", "invocations", "to", "name", "only", "a", "few", "of", "the", "possibilities", ".", "Combined", "with", "Spring", "you", "can", "monitor", "all", "of", "your", "spring", "beans", "using", "either", "annotations", "or", "by", "putting", "a", "few", "lines", "in", "your", "applicationContext", ".", "xml", "file", ".", "JAMon", "2", ".", "7", "introduces", "HTTP", "monitoring", ".", "This", "page", "will", "give", "information", "on", "how", "to", "use", "JAMon", "and", "Spring", "together", ".", "<", "/", "p", ">", "<", "p", ">", "Spring", "comes", "with", "the", "<", "a", "href", "=", "\"", "http", ":", "//", "docs", ".", "spring", ".", "io", "/", "spring", "/", "docs", "/", "3", ".", "0", ".", "x", "/", "api", "/", "org", "/", "springframework", "/", "aop", "/", "interceptor", "/", "JamonPerformanceMonitorInterceptor", ".", "html", "\"", ">", "JamonPerformanceMonitorInterceptor", "<", "/", "a", ">", "which", "also", "allows", "you", "to", "monitor", "your", "Spring", "beans", "with", "JAMon", ".", "Feel", "free", "to", "use", "it", "if", "you", "wish", ".", "However", ",", "JamonAspect", "has", "a", "few", "advantages", "over", "JamonPerformanceMonitorInterceptor", "<", "/", "p", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Track", "Specific", "Exceptions", "<", "/", "b", ">", "-", "If", "the", "method", "you", "are", "monitoring", "throws", "an", "exception", "JamonAspect", "counts", "the", "specific", "exception", "(", "i", ".", "e", ".", "java", ".", "io", ".", "FileNotFoundException", ")", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "Track", "General", "Exceptions", "<", "/", "b", ">", "-", "JamonAspect", "also", "counts", "a", "total", "for", "all", "exceptions", "(", "the", "label", "is", "com", ".", "jamonapi", ".", "Exceptions", ")", "</", "li", ">", "<", "li", ">", "<", "b", ">", "View", "stacktraces", "<", "/", "b", ">", "-", "By", "default", "JamonAspect", "lets", "you", "view", "the", "50", "most", "recent", "stacktraces", "that", "have", "occured", "in", "your", "application", "via", "the", "JAMon", "webapp", "viewer", ".", "This", "feature", "can", "be", "configured", "to", "view", "more", "exceptions", ".", "It", "can", "also", "be", "configured", "to", "view", "the", "stack", "traces", "of", "specific", "exceptions", "(", "i", ".", "e", ".", "java", ".", "io", ".", "FileNotFoundException", ")", ".<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "View", "method", "parameters", "<", "/", "b", ">", "-", "JamonAspect", "can", "be", "configured", "to", "display", "the", "most", "recent", "method", "parameters", "in", "the", "JAMon", "webapp", "viewer", ".", "This", "is", "particularly", "useful", "in", "a", "development", "or", "staging", "environment", ".", "This", "is", "disabled", "by", "default", ".", "</", "li", ">", "<", "li", ">", "<", "b", ">", "View", "method", "parameters", "when", "exceptions", "are", "thrown", "<", "/", "b", ">", "-", "JamonAspect", "can", "be", "configured", "to", "display", "the", "most", "recent", "method", "parameters", "for", "any", "methods", "that", "throw", "and", "exception", ".", "This", "is", "disabled", "by", "default", ".", "</", "li", ">", "<", "/", "ul", ">", "<", "p", ">", "Note", ":", "It", "should", "be", "noted", "that", "it", "would", "be", "easy", "to", "change", "the", "code", "in", "JamonPerformanceMonitorInterceptor", "to", "perform", "all", "of", "the", "above", ",", "or", "you", "could", "even", "write", "it", "yourself", ".", "In", "the", "future", ",", "I", "will", "try", "to", "work", "with", "the", "Spring", "team", "to", "get", "them", "to", "enhance", "their", "code", ".", "<", "/", "p", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Tomcat", "4", "/", "5", "/", "5", ".", "5", "<", "/", "b", ">", "</", "li", ">", "<", "ul", ">", "<", "li", ">", "Put", "jamon", "-", "2", ".", "7", ".", "jar", "(", "or", "higher", ")", "in", "the", "tomcat", "'", "common", "/", "lib", "'", "directory", ".", "<", "/", "li", ">", "<", "li", ">", "Put", "jamontomcat", "-", "2", ".", "7", ".", "jar", "(", "or", "higher", ")", "in", "the", "tomcat", "'", "server", "/", "lib", "'", "directory", ".", "(", "Note", "this", "is", "not", "jamon", "-", "2", ".", "7", ".", "jar", ")", "</", "li", ">", "<", "li", ">", "Put", "jamon", ".", "war", "(", "or", "higher", ")", "in", "the", "tomcat", "'", "webapps", "'", "directory", ".", "<", "/", "li", ">", "<", "li", ">", "Add", "the", "following", "Valve", "line", "to", "Tomcat", "'", "s", "server", ".", "xml", "file", "using", "the", "appropriate", "version", ".", "Note", "only", "one", "of", "the", "valve", "lines", "should", "be", "used", ",", "and", "also", "note", "the", "package", "is", "'", "com", ".", "jamontomcat", "'", "and", "not", "'", "com", ".", "jamonapi", "'", ".", "The", "'", "Engine", "'", "line", "is", "used", "to", "show", "context", ".", "</", "li", ">", "<", "ul", ">", "<", "code", ">", "&", "lt", ";", "Engine", "name", "=", "\"", "Catalina", "\"", "defaultHost", "=", "\"", "localhost", "\"", "&", "gt", ";", "<", "br", ">", "&", "lt", ";", "Valve", "className", "=", "\"", "com", ".", "jamontomcat", ".", "JAMonTomcat55Valve", "\"", "/&", "gt", ";", "<", "br", ">", "</", "code", ">", "<", "/", "ul", ">", "<", "/", "ul", ">", "<", "/", "ul", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "JBoss", "4", ".", "0", ".", "5", "/", "4", ".", "2", "<", "/", "b", ">", "-", "Other", "versions", "may", "work", "too", ".", "</", "li", ">", "<", "ul", ">", "<", "li", ">", "Put", "jamon", "-", "2", ".", "7", ".", "jar", "(", "or", "higher", ")", "in", "the", "jboss", "instance", "'", "lib", "'", "directory", "(", "ex", ".", "default", "/", "lib", ")", ".", "<", "/", "li", ">", "<", "li", ">", "Put", "jamon", ".", "war", "(", "or", "higher", ")", "in", "the", "jboss", "instance", "'", "deploy", "'", "directory", ".", "(", "ex", ".", "default", "/", "deploy", ")", ".<", "/", "li", ">", "<", "li", ">", "Add", "the", "following", "Valve", "line", "to", "Tomcat", "'", "s", "server", ".", "xml", "file", "(", "i", ".", "e", ".", "jbossweb", "-", "tomcat55", ".", "sar", "/", "server", ".", "xml", ")", ".", "The", "'", "Engine", "'", "line", "is", "used", "to", "show", "context", ".", "</", "li", ">", "<", "ul", ">", "<", "code", ">", "&", "lt", ";", "Engine", "name", "=", "\"", "Catalina", "\"", "defaultHost", "=", "\"", "localhost", "\"", "&", "gt", ";", "<", "br", ">", "&", "lt", ";", "Valve", "className", "=", "\"", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", "\"", "/&", "gt", ";", "</", "code", ">", "<", "/", "ul", ">", "<", "/", "ul", ">", "<", "/", "ul", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Jetty", "6", ".", "1", ".", "5", "<", "/", "b", ">", "-", "The", "package", "and", "approach", "to", "handlers", "changed", "on", "following", "versions", "of", "jetty", ".", "Contact", "me", "if", "you", "would", "like", "to", "work", "with", "a", "later", "version", ".", "</", "li", ">", "<", "ul", ">", "<", "li", ">", "Put", "jamon", "-", "2", ".", "7", ".", "jar", "(", "or", "higher", ")", "in", "the", "jetty", "'", "lib", "'", "directory", ".", "(", "note", "in", "later", "versions", "of", "jetty", "the", "jamon", "jar", "should", "be", "put", "in", "lib", "/", "ext", ")", "</", "li", ">", "<", "li", ">", "Put", "jamon", ".", "war", "in", "the", "jetty", "'", "webapps", "'", "directory", ".", "</", "li", ">", "<", "li", ">", "Add", "the", "following", "Handler", "line", "to", "Jetty", "'", "s", "jetty", ".", "xml", "file", "(", "i", ".", "e", ".", "etc", "/", "jetty", ".", "xml", ")", ".", "The", "'", "Engine", "'", "line", "is", "used", "to", "show", "context", ".", "</", "li", ">", "<", "ul", ">", "<", "code", ">", "&", "lt", ";", "Set", "name", "=", "\"", "handler", "\"", "&", "gt", ";", "<", "br", ">", ".", "..", "<", "br", ">", "&", "lt", ";", "Item", "&", "gt", ";", "<", "br", ">", "&", "lt", ";", "New", "id", "=", "\"", "JAMonHandler", "\"", "class", "=", "\"", "com", ".", "jamonapi", ".", "http", ".", "JAMonJettyHandler", "\"", "/&", "gt", ";", "<", "br", ">", "&", "lt", ";", "/", "Item", "&", "gt", ";", "<", "br", ">", "&", "lt", ";", "/", "Set", "&", "gt", ";", "<", "br", ">", "</", "code", ">", "<", "/", "ul", ">", "<", "/", "ul", ">", "<", "/", "ul", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Web", "Application", "<", "/", "b", ">", "-", "Add", "the", "appropriate", "servlet", "filter", "(", "com", ".", "jamonapi", ".", "http", ".", "JAMonServletFilter", ")", "to", "he", "applications", "web", ".", "xml", "file", "<", "/", "li", ">", "<", "/", "ul", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Custom", "monitoring", "<", "/", "b", ">", "-", "Should", "you", "use", "another", "container", "you", "can", "use", "the", "com", ".", "jamonapi", ".", "http", ".", "HttpMonFactory", "class", "to", "easily", "monitor", "any", "web", "container", "<", "/", "li", ">", "</", "ul", ">", "<", "/", "ul", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "br", ">", "<", "br", ">", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", "align", "=", "\"", "left", "\"", "><", "h2", ">", "<", "a", "name", "=", "\"", "interpretting", "\"", ">", "2", ".", "Interpretting", "JAMon", "HTTP", "Data", "<", "/", "a", ">", "</", "h2", ">", "</", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "p", ">", "By", "default", "JAMon", "will", "track", "something", "similar", "to", "the", "following", "(", "The", "screen", "snapshot", "was", "taken", "while", "monitoring", "tomcat6", ")", ".", "However", ",", "with", "simple", "configuration", "via", "server", ".", "xml", ",", "or", "jetty", ".", "xml", "-", "any", "HttpServletRequest", ",", "or", "HttpServletResponse", "method", "that", "takes", "no", "arguments", ",", "and", "returns", "an", "Object", "can", "be", "monitored", "(", "i", ".", "e", ".", "request", ".", "getRequestURI", "(", ")", "for", "example", ")", ".", "This", "is", "covered", "in", "more", "detail", "later", "in", "this", "document", ".", "Note", "all", "HTTP", "monitors", "can", "be", "seen", "by", "entering", "'", "http", "'", "into", "the", "jamonadmin", ".", "jsp", "'", "filter", "'", "field", ".", "<", "/", "p", ">", "<", "p", ">", "The", "following", "describes", "JAMon", "'", "s", "default", "HTTP", "Monitors", ":", "<", "/", "p", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "allPages", ",", "ms", ".", "<", "/", "b", ">", "-", "Stats", "for", "all", "resources", "/", "pages", "executed", "by", "the", "container", ".", "As", "is", "the", "case", "for", "all", "JAMon", "monitors", "hits", ",", "avg", ",", "min", ",", "max", ",", "currently", "active", "and", "more", "stats", "are", "tracked", ".", "Anytime", "the", "units", "are", "ms", "(", "milliseconds", ")", "the", "label", "tracks", "execution", "time", ".", "</", "li", ">", "<", "li", ">", "<", "b", ">", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "contextpath", ":", "/", "jamon", ",", "ms", ".", "</", "b", ">", "-", "Page", "execution", "stats", "for", "all", "pages", "in", "a", "context", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "page", ".", "value", ":", "/", "jamon", "/", "jamonadmin", ".", "jsp", ",", "ms", ".", "</", "b", ">", "-", "Page", "execution", "stats", "for", "individual", "pages", "in", "the", "container", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "response", ".", "getContentCount", "(", "),", "bytes", "<", "/", "b", ">", "-", "Size", "in", "bytes", "of", "all", "pages", ".", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "response", ".", "getStatus", "(", ").", "value", ":", "200", ",", "httpStatus", "<", "/", "b", ">", "-", "Number", "of", "resources", "that", "return", "a", "particular", "http", "status", "code", ".", "In", "this", "example", "the", "http", "status", "code", "is", "200", ".", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "ServletException", "<", "/", "b", ">", "-", "Number", "of", "servlet", "exceptions", "thrown", "by", "the", "container", ".", "(", "Not", "in", "the", "report", "below", ")", "<", "/", "li", ">", "<", "/", "ul", ">", "<", "p", ">", "<", "img", "src", "=", "\"", "jamon_httpmon", ".", "jpg", "\"", "border", "=", "\"", "1", "\"", ">", "<", "/", "p", ">", "<", "p", ">", "Any", "JAMon", "buffer", "listener", "can", "be", "attached", "to", "any", "JAMon", "monitor", ".", "This", "allows", "you", "to", "not", "only", "look", "at", "the", "aggregate", "stats", "above", ",", "but", "look", "at", "interesting", "details", "such", "as", "the", "details", "of", "when", "the", "slowest", "page", "was", "executed", ",", "or", "the", "ServletException", "stack", "trace", ",", "or", "the", "most", "recent", "N", "page", "requests", ".", "See", "other", "parts", "of", "the", "JAMon", "documenation", "to", "learn", "more", "about", "JAMon", "Buffer", "Listeners", ".", "JAMon", "2", ".", "7", "introduces", "the", "HttpBufferListener", "which", "puts", "a", "stack", "trace", "in", "the", "details", "buffer", "should", "one", "occur", "during", "a", "page", "request", ".", "The", "following", "is", "an", "example", "of", "what", "one", "might", "look", "like", ".", "(", "Note", "stack", "traces", "can", "also", "be", "seen", "in", "any", "of", "the", "other", "buffer", "listeners", ",", "however", "not", "as", "a", "separate", "column", ")", ".", "The", "following", "buffer", "listener", "was", "attached", "to", "'", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "allPages", "'", ",", "and", "so", "would", "have", "a", "FIFOBuffer", "of", "the", "last", "N", "requests", ".", "As", "always", "JAMon", "buffer", "listeners", "can", "be", "added", "/", "removed", "at", "runtime", ".", "<", "/", "p", ">", "<", "p", ">", "The", "first", "4", "lines", "of", "the", "report", "show", "successful", "page", "invocations", ".", "The", "columns", "represent", "the", "row", "number", "in", "the", "report", "(", "RowNum", ")", ",", "the", "resource", "/", "page", "name", "(", "Label", ")", ",", "the", "stack", "trace", "if", "one", "occurred", "(", "Exception", ")", ",", "the", "execution", "time", "in", "ms", ".", "(", "LastValue", ")", ",", "the", "number", "of", "pages", "that", "were", "executing", "when", "this", "one", "was", "(", "Active", ")", ",", "and", "the", "date", "-", "time", "when", "the", "resource", "/", "page", "was", "invoked", ".", "The", "5th", "line", "shows", "a", "page", "that", "had", "a", "stack", "trace", ".", "<", "p", ">", "<", "p", ">", "<", "img", "src", "=", "\"", "jamon_httpmon_details", ".", "jpg", "\"", "border", "=", "\"", "1", "\"", ">", "<", "/", "p", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "br", ">", "<", "br", ">", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", "align", "=", "\"", "left", "\"", "><", "h2", ">", "<", "a", "name", "=", "\"", "configuring", "\"", ">", "3", ".", "Configuring", "the", "JAMon", "HTTP", "Monitor", "<", "/", "a", ">", "</", "h2", ">", "</", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "p", ">", "JAMon", "can", "monitor", "various", "aspects", "of", "servlet", "requests", "and", "responses", "via", "declarative", "configuration", ".", "This", "is", "done", "via", "specifying", "a", "comma", "delimitted", "string", "in", "the", "server", ".", "xml", ",", "or", "jetty", ".", "mxl", "files", ",", "or", "programattically", "by", "calling", "the", "'", "setSummaryLabel", "(", "String", ")", "'", "method", ".", "What", "follows", "is", "a", "sample", "tomcat", "valve", "that", "specifies", "the", "default", "monitors", "explicitly", ":", "<", "/", "p", ">", "<", "p", ">", "<", "code", ">", "&", "lt", ";", "Engine", "name", "=", "\"", "Catalina", "\"", "defaultHost", "=", "\"", "localhost", "\"", "&", "gt", ";", "<", "br", ">", "&", "lt", ";", "Valve", "className", "=", "\"", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", "\"", "summaryLabels", "=", "\"", "request", ".", "getRequestURI", "(", ").", "ms", "as", "allPages", ",", "request", ".", "getRequestURI", "(", ").", "value", ".", "ms", "as", "page", ",", "response", ".", "getContentCount", "(", ").", "bytes", ",", "response", ".", "getStatus", "(", ").", "value", ".", "httpStatus", ",", "request", ".", "contextpath", ".", "ms", "\"", "/", "&", "gt", ";", "<", "/", "code", ">", "<", "/", "p", ">", "<", "p", ">", "The", "above", "causes", "the", "JAMonTomcatValve", ".", "setSummaryLabels", "method", "to", "be", "called", "with", "the", "comma", "delimitted", "String", "passed", "as", "an", "argument", ".", "A", "'", ".'", "separates", "tokens", "within", "one", "monitor", ".", "The", "String", "is", "parsed", "to", "the", "following", "5", "monitors", ".", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "request", ".", "getRequestURI", "(", ").", "ms", "as", "allPages", "<", "/", "b", ">", "-", "Each", "monitor", "begins", "with", "either", "'", "request", "'", ",", "or", "'", "response", "'", "followed", "by", "a", "method", "name", ".", "Any", "method", "that", "is", "in", "HttpServletRequest", ",", "HttpServletResponse", "that", "takes", "no", "arguments", "and", "returns", "a", "value", "can", "be", "called", ".", "In", "this", "example", "getRequestURI", "(", ")", "is", "called", ".", "Because", "the", "method", "name", "you", "specify", "is", "used", "to", "make", "a", "call", "based", "on", "reflection", "it", "is", "important", "you", "get", "the", "case", "right", "and", "have", "no", "typos", ".", "In", "addition", "any", "method", "can", "also", "be", "called", "that", "matches", "these", "criterion", "and", "also", "inherits", "from", "these", "classes", ".", "For", "example", "any", "method", "from", "Tomcat", "'", "s", "org", ".", "apache", ".", "catalina", ".", "connector", ".", "Request", ",", "or", "org", ".", "apache", ".", "catalina", ".", "connector", ".", "Response", ".", "The", "next", "value", "specifies", "to", "use", "the", "units", "of", "'", "ms", ".", "'", "(", "milliseconds", ")", ".", "Implicitly", "these", "units", "also", "tell", "JAMon", "to", "time", "the", "request", ".", "'", "ms", ".", "'", "are", "the", "only", "units", "that", "will", "time", "the", "request", ".", "'", "as", "allPages", "'", "is", "an", "optional", "alias", "that", "will", "can", "be", "used", "to", "make", "the", "JAMon", "label", "more", "readable", ".", "Example", "JAMon", "Label", ":", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "allPages", ",", "ms", ".", "</", "li", ">", "<", "li", ">", "<", "b", ">", "request", ".", "getRequestURI", "(", ").", "value", ".", "ms", "as", "page", "<", "/", "b", ">", "-", "This", "monitor", "is", "similar", "to", "the", "above", "except", "for", "the", "use", "of", "the", "keyword", "'", "value", "'", ".", "In", "this", "caes", "'", "value", "'", "tells", "JAMon", "to", "take", "the", "value", "that", "the", "'", "request", ".", "getRequestURI", "(", ")'", "method", "returns", "and", "use", "it", "in", "the", "JAMon", "label", ".", "'", "getRequestURI", "(", ")'", "returns", "the", "requested", "page", "name", "such", "as", "'", "/", "jamon", "/", "jamonadmin", ".", "jsp", "'", ".", "The", "effect", "of", "this", "summary", "label", "is", "to", "create", "a", "JAMon", "label", "of", "the", "following", "format", ":", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "page", ".", "value", ":", "/", "jamon", "/", "jamonadmin", ".", "jsp", ",", "ms", ".", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "response", ".", "getContentCount", "(", ").", "bytes", "<", "/", "b", ">", "-", "This", "label", "calls", "the", "HttpServletResponse", ".", "getContentCount", "(", ")", "method", "and", "passes", "its", "return", "value", "(", "an", "int", "indicating", "bytes", "in", "the", "response", ")", "to", "the", "monitor", ".", "This", "allows", "JAMon", "to", "track", "such", "stats", "as", "the", "average", ",", "and", "max", "bytes", "in", "a", "response", ".", "The", "units", "are", "in", "'", "bytes", "'", ".", "Note", "any", "unit", "that", "is", "not", "'", "ms", ".", "'", "will", "take", "the", "return", "value", "and", "use", "it", "as", "the", "JAMon", "value", "if", "it", "is", "a", "number", "or", "if", "the", "method", "returns", "a", "String", "it", "will", "simply", "pass", "the", "number", "1", "to", "JAMon", "having", "the", "effect", "of", "only", "'", "counting", "'", "the", "label", ".", "This", "summary", "label", "creates", "the", "JAMon", "label", ":", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "response", ".", "getContentCount", "(", "),", "bytes", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "response", ".", "getStatus", "(", ").", "value", ".", "httpStatus", "<", "/", "b", ">", "-", "This", "label", "calls", "the", "HttpServletResponse", ".", "getStatus", "(", ")", "method", "which", "returns", "the", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "Protocols", "/", "HTTP", "/", "HTRESP", ".", "html", "\"", ">", "http", "status", "code", "<", "/", "a", ">", "of", "the", "request", "(", "i", ".", "e", ".", "200", "=", "ok", ",", "404", "=", "file", "not", "found", ")", ".", "It", "uses", "the", "special", "token", "'", "value", "'", "to", "indicate", "that", "the", "value", "returned", "from", "the", "function", "(", "200", ",", "404", "etc", ")", "will", "be", "used", "as", "part", "of", "the", "JAMon", "key", ".", "Remember", "JAMon", "depends", "on", "keys", "being", "relatively", "unique", ",", "so", "don", "'", "t", "use", "'", "value", "'", "for", "something", "that", "can", "potentially", "generate", "a", "large", "number", "of", "keys", "(", "request", ".", "getQueryString", "(", ")", "for", "example", ")", ".", "By", "default", "JAMon", "will", "not", "add", "any", "new", "HTTP", "Monitoring", "labels", "if", "the", "total", "number", "of", "JAMon", "monitor", "labels", "is", "greater", "than", "5000", ".", "However", ",", "any", "existing", "JAMon", "entries", "will", "still", "be", "updated", ".", "In", "the", "Tomcat", "Valve", ",", "Jetty", "Handler", ",", "and", "Servlet", "filter", "this", "value", "can", "be", "changed", "by", "calling", "the", "'", "setSize", "(", "int", "size", ")", "'", "method", ".", "If", "'", "0", "'", "is", "passed", "the", "number", "of", "HTTP", "monitors", "can", "grow", "unbounded", ".", "The", "units", "in", "this", "example", "are", "'", "httpStatus", "'", ".", "An", "example", "JAMon", "label", ":", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "response", ".", "getStatus", "(", ").", "value", ":", "404", ",", "httpStatus", ".", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "request", ".", "contextpath", ".", "ms", "<", "/", "b", ">", "-", "In", "addition", "to", "'", "value", "'", "there", "are", "two", "other", "keywords", "that", "allow", "you", "to", "generate", "a", "JAMon", "key", ".", "They", "are", "'", "url", "'", ",", "and", "'", "contextpath", "'", ".", "'", "contextpath", "'", "will", "use", "the", "return", "value", "from", "'", "request", ".", "getContextPath", "(", ")'", "as", "part", "of", "the", "key", ".", "An", "example", "of", "a", "return", "value", "is", "'", "/", "jamon", "'", ".", "'", "url", "'", "will", "use", "'", "request", ".", "getRequestURI", "(", ")'", "as", "part", "of", "the", "key", ".", "Any", "value", "other", "than", "'", "request", "'", ",", "'", "response", "'", ",", "'", "methodName", "(", ")'", ",", "'", "value", "'", ",", "'", "contextpath", "'", ",", "'", "url", "'", "and", "'", ".'", "will", "be", "used", "as", "the", "units", ".", "'", "value", "'", ",", "'", "contextpath", "'", ",", "and", "'", "url", "'", "can", "be", "used", "in", "combination", ".", "They", "will", "be", "used", "as", "part", "of", "the", "key", "in", "the", "order", "they", "are", "specified", ".", "An", "example", "JAMon", "label", ":", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "contextpath", ":", "/", "jamon", ",", "ms", ".", ".", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "An", "additional", "example", "-", "request", ".", "getStatus", "(", ").", "contextpath", ".", "value", ".", "ms", "<", "/", "b", ">", "Using", "the", "above", "mentioned", "keyworeds", "this", "summary", "label", "would", "return", "the", "following", "representative", "JAMon", "label", ":", "com", ".", "jamonapi", ".", "http", ".", "JAMonTomcatValve", ".", "request", ".", "getStatus", "(", ").", "contextpath", ":", "/", "jamon", ",", "value", ":", "404", "(", "i", ".", "e", ".", "shows", "how", "many", "404", "errors", "occured", "in", "the", "jamon", "context", ")", ".", "<", "/", "li", ">", "<", "li", ">", "<", "b", ">", "'", "default", "'", "and", "'", "demo", "'", "</", "b", ">", "-", "Using", "either", "'", "default", "'", "or", "'", "demo", "'", "as", "the", "summary", "label", "has", "special", "meaning", "to", "JAMon", ".", "'", "default", "'", "uses", "the", "HTTP", "monitors", "defaults", "as", "you", "would", "expect", ".", "However", "you", "can", "also", "add", "to", "default", "by", "providing", "a", "string", "like", "the", "following", ":", "default", ",", "request", ".", "getStatus", "(", ").", "contextpath", ".", "value", ".", "ms", ".", "'", "demo", "'", "is", "only", "to", "be", "used", "so", "you", "can", "see", "many", "of", "the", "possible", "monitors", "and", "shouldn", "'", "t", "be", "used", "in", "production", ".", "'", "demo", "'", "is", "an", "easy", "way", "to", "see", "what", "other", "summary", "labels", "you", "may", "want", "to", "add", ".", "Keep", "in", "mind", "some", "of", "the", "'", "demo", "'", "labels", "may", "not", "be", "very", "helpful", "as", "it", "is", "really", "a", "dumb", "cartesian", "product", "of", "possibilities", "ignoring", "whether", "or", "not", "they", "are", "useful", ".", "<", "/", "li", ">", "<", "/", "ul", ">", "<", "p", ">", "Regardless", "which", "summary", "label", "you", "use", "JAMon", "will", "always", "put", "the", "page", "name", ",", "and", "stack", "trace", "(", "should", "there", "be", "one", ")", "in", "the", "details", "buffer", ".", "Note", "other", "methods", "that", "are", "part", "of", "the", "JAMonTomcatValve", "'", "s", "and", "the", "JAMonJettyHandler", "can", "also", "be", "called", "in", "the", "same", "way", "'", "setSummaryLabel", "'", "was", "called", ".", "</", "p", ">", "<", "/", "p", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "br", ">", "<", "br", ">", "</", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "p", "align", "=", "\"", "center", "\"", ">", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "fdsapi", ".", "com", "\"", "><", "img", "src", "=", "\"", "fds_logo_fulltext_blue2_150", ".", "jpg", "\"", "id", "=", "\"", "fdsbanner", "\"", "border", "=", "\"", "1", "\"", "/", "><", "/", "a", ">", "<", "a", "href", "=", "\"", "http", ":", "//", "sourceforge", ".", "net", "\"", "><", "img", "src", "=", "\"", "http", ":", "//", "sourceforge", ".", "net", "/", "sflogo", ".", "php", "?", "group_id", "=", "96550", "&", "amp", ";", "type", "=", "4", "\"", "width", "=", "\"", "125", "\"", "height", "=", "\"", "37", "\"", "border", "=", "\"", "0", "\"", "alt", "=", "\"", "SourceForge", ".", "net", "Logo", "\"", "/", "><", "/", "a", ">", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "jamonapi", ".", "com", "\"", "><", "img", "src", "=", "\"", "jamon_banner3", ".", "jpg", "\"", "id", "=", "\"", "jamonbanner", "\"", "border", "=", "\"", "1", "\"", "/", "><", "/", "a", ">", "<", "/", "p", ">", "<", "!-", "-", "END", "JAMON", "SPECIFIC", "HTML", "-", "->", "<", "/", "body", ">", "<", "/", "html", "></s><", "artifactId", ">", "jamon_core", "<", "/", "artifactId", ">", "private", "static", "final", "String", "DEFAULT_SUMMARY", "=", "\"", "default", ",", "response", ".", "getContentCount", "(", ").", "bytes", ",", "response", ".", "getStatus", "(", ").", "value", ".", "httpStatus", ",", "request", ".", "contextpath", ".", "ms", "\"", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*\"", "%", ">", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "value", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*\"", "%", ">", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "value", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*\"", "%", ">", "String", "[", "]", "bufferSizeHeader", "=", "{\"", "bufferSize", "\"", ",\"", "bufferSizeDisplay", "\"", "};", "Object", "[", "][", "]", "bufferSizeBody", "=", "{", "{", "\"", "No", "Action", "\"", ",", "\"", "No", "Action", "\"", "},", "{", "\"", "50", "\"", ",", "\"", "50", "rows", "\"", "},", "{", "\"", "100", "\"", ",", "\"", "100", "rows", "\"", "},", "{", "\"", "250", "\"", ",", "\"", "250", "rows", "\"", "},", "{", "\"", "500", "\"", ",\"", "500", "rows", "\"", "},", "{", "\"", "1000", "\"", ",\"", "1000", "rows", "\"", "},", "{", "\"", "2000", "\"", ",\"", "2000", "rows", "\"", "},", "}", ";", "else", "if", "(", "\"", "100", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "100", ")", ";", "else", "if", "(", "\"", "250", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "250", ")", ";", "else", "if", "(", "\"", "500", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "500", ")", ";", "else", "if", "(", "\"", "1000", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "1000", ")", ";", "else", "if", "(", "\"", "2000", "\"", ".", "equals", "(", "bufferSize", ")", ")", "listener", ".", "getBufferList", "(", ").", "setBufferSize", "(", "2000", ")", ";", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "value", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*\"", "%", ">", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "value", ";", "/", "/", "convert", "arg", "to", "an", "int", "or", "return", "the", "default", "retValue", "=", "defaultValue", ";", "return", "Integer", ".", "parseInt", "(", "retValue", ")", ";", "<", "%@", "page", "import", "=", "\"", "java", ".", "sql", ".", "*,", "javax", ".", "sql", ".", "*,", "java", ".", "util", ".", "*,", "java", ".", "text", ".", "*,", "javax", ".", "naming", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*\"", "%", ">", "<", "%@", "page", "import", "=", "\"", "java", ".", "util", ".", "*,", "java", ".", "util", ".", "regex", ".", "*,", "java", ".", "text", ".", "*,", "com", ".", "jamonapi", ".", "*,", "com", ".", "jamonapi", ".", "proxy", ".", "*,", "com", ".", "jamonapi", ".", "utils", ".", "*,", "com", ".", "fdsapi", ".", "*,", "com", ".", "fdsapi", ".", "arrays", ".", "*\"", "%", ">", "private", "static", "String", "getValue", "(", "String", "value", ",", "String", "defaultValue", ")", "{", "return", "(", "value", "=", "=", "null", "|", "|", "\"", "\".", "equals", "(", "value", ".", "trim", "(", "))", ")", "?", "defaultValue", ":", "value", ";", "}", "<", "module", ">", "jamon_core", "<", "/", "module", ">", "<", "title", ">", "JAMon", "-", "JAMonAppender", "for", "Log4j", "<", "/", "title", ">", "<", "ul", ">", "<", "li", ">", "<", "b", ">", "Tomcat", "6", "<", "/", "b", ">", "</", "li", ">", "<", "li", ">", "<", "b", ">", "Jetty", "6", ".", "1", ".", "5", "<", "/", "b", ">", "-", "Other", "versions", "may", "work", "too", ".", "</", "li", ">", "<", "li", ">", "Put", "jamon", "-", "2", ".", "7", ".", "jar", "(", "or", "higher", ")", "in", "the", "jetty", "'", "lib", "'", "directory", ".", "<", "/", "li", ">"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["HID:", "logitech:", "perform", "bounds", "checking", "on", "device_id", "early", "enough", "device_index", "is", "a", "char", "type", "and", "the", "size", "of", "paired_dj_deivces", "is", "7", "elements,", "therefore", "proper", "bounds", "checking", "has", "to", "be", "applied", "to", "device_index", "before", "it", "is", "used.", "We", "are", "currently", "performing", "the", "bounds", "checking", "in", "logi_dj_recv_add_djhid_device(),", "which", "is", "too", "late,", "as", "malicious", "device", "could", "send", "REPORT_TYPE_NOTIF_DEVICE_UNPAIRED", "early", "enough", "and", "trigger", "the", "problem", "in", "one", "of", "the", "report", "forwarding", "functions", "called", "from", "logi_dj_raw_event().", "Fix", "this", "by", "performing", "the", "check", "at", "the", "earliest", "possible", "ocasion", "in", "logi_dj_raw_event().", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Ben", "Hawkes", "<hawkes@google.com>", "Reviewed-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["if", "(", "(", "dj_report", "-", ">", "device_index", "<", "DJ_DEVICE_INDEX_MIN", ")", "|", "|", "(", "dj_report", "-", ">", "device_index", ">", "DJ_DEVICE_INDEX_MAX", ")", ")", "{", "dev_err", "(", "&", "hdev", "-", ">", "dev", ",", "\"", "%", "s", ":", "invalid", "device", "index", ":", "%", "d", "\\", "n", "\"", ",", "__func__", ",", "dj_report", "-", ">", "device_index", ")", ";", "return", "false", ";", "}</s>if", "(", "(", "dj_report", "-", ">", "device_index", "<", "DJ_DEVICE_INDEX_MIN", ")", "|", "|", "(", "dj_report", "-", ">", "device_index", ">", "DJ_DEVICE_INDEX_MAX", ")", ")", "{", "dev_err", "(", "&", "djrcv_hdev", "-", ">", "dev", ",", "\"", "%", "s", ":", "invalid", "device", "index", ":", "%", "d", "\\", "n", "\"", ",", "__func__", ",", "dj_report", "-", ">", "device_index", ")", ";", "return", ";", "}"], "docstring_tokens": ["improper", "bounds", "checking"]}
{"contents": ["Verifies", "resources", "are", "in", "allowed", "locations"], "code_tokens": ["import", "java", ".", "util", ".", "ArrayList", ";", "ArrayList", "<", "Resource", ">", "locationResources", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "!", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "locationResources", ".", "add", "(", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ");", "}", "}", "for", "(", "Resource", "location", ":", "locationResources", ")", "{", "Resource", "file", "=", "location", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", ")", "&", "&", "PathUtils", ".", "checkResource", "(", "file", ",", "location", ",", "locationResources", ")", ")", "{", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "/", "**", "*", "Perform", "additional", "checks", "on", "a", "resolved", "resource", "beyond", "checking", "whether", "the", "*", "resources", "exists", "and", "is", "readable", ".", "The", "default", "implementation", "also", "verifies", "the", "*", "resource", "is", "either", "under", "the", "location", "relative", "to", "which", "it", "was", "found", "or", "is", "under", "*", "one", "of", "the", "{", "@", "link", "#", "setAllowedLocations", "allowed", "locations", "}", ".", "*", "@", "param", "resource", "the", "resource", "to", "check", "*", "@", "param", "location", "the", "location", "relative", "to", "which", "the", "resource", "was", "found", "*", "@", "param", "allowedLocations", "set", "of", "allowed", "locations", "*", "@", "return", "\"", "true", "\"", "if", "resource", "is", "in", "a", "valid", "location", ",", "\"", "false", "\"", "otherwise", ".", "*", "@", "throws", "IOException", "if", "Resource", "URLS", "fail", "to", "parse", ".", "*", "@", "since", "4", ".", "1", ".", "2", "*", "/", "public", "static", "boolean", "checkResource", "(", "Resource", "resource", ",", "Resource", "location", ",", "List", "<", "Resource", ">", "allowedLocations", ")", "throws", "IOException", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "location", ")", ")", "{", "return", "true", ";", "}", "if", "(", "allowedLocations", "!", "=", "null", ")", "{", "for", "(", "Resource", "current", ":", "allowedLocations", ")", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "current", ")", ")", "{", "return", "true", ";", "}", "}", "}", "if", "(", "logger", ".", "isWarnEnabled", "(", "))", "{", "logger", ".", "warn", "(", "\"", "Resource", "path", "\\", "\"\"", "+", "location", ".", "getURI", "(", ")", "+", "\"", "\\\"", "was", "successfully", "resolved", "\"", "+", "\"", "but", "resource", "\\", "\"\"", "+", "resource", ".", "getURL", "(", ")", "+", "\"", "\\\"", "is", "neither", "under", "the", "\"", "+", "\"", "current", "location", "\\", "\"\"", "+", "location", ".", "getURL", "(", ")", "+", "\"", "\\\"", "nor", "under", "any", "of", "the", "\"", "+", "\"", "allowed", "locations", "\"", "+", "(", "allowedLocations", "!", "=", "null", "?", "allowedLocations", ":", "\"", "[]", "\")", ");", "}", "return", "false", ";", "}", "private", "static", "boolean", "isResourceUnderLocation", "(", "Resource", "resource", ",", "Resource", "location", ")", "throws", "IOException", "{", "if", "(", "resource", ".", "getClass", "(", ")", "!", "=", "location", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "String", "resourcePath", ";", "String", "locationPath", ";", "if", "(", "resource", "instanceof", "UrlResource", ")", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "toString", "(", "))", ";", "}", "else", "if", "(", "resource", "instanceof", "ClassPathResource", ")", "{", "resourcePath", "=", "(", "(", "ClassPathResource", ")", "resource", ")", ".", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "((", "ClassPathResource", ")", "location", ")", ".", "getPath", "(", "))", ";", "}", "else", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "getPath", "(", "))", ";", "}", "if", "(", "locationPath", ".", "equals", "(", "resourcePath", ")", ")", "{", "return", "true", ";", "}", "locationPath", "=", "(", "locationPath", ".", "endsWith", "(", "\"/", "\")", "|", "|", "locationPath", ".", "isEmpty", "(", ")", "?", "locationPath", ":", "locationPath", "+", "\"", "/\"", ");", "return", "(", "resourcePath", ".", "startsWith", "(", "locationPath", ")", "&", "&", "!", "isInvalidEncodedPath", "(", "resourcePath", ")", ");", "}", "@", "Test", "public", "void", "invalidPathEncodedSlash", "(", ")", "{", "String", "file", "=", "System", ".", "getProperty", "(", "\"", "user", ".", "dir", "\"", ");", "file", "=", "file", ".", "replaceFirst", "(", "\"\\", "\\/", "\",", "\"", "%", "2f", "\"", ");", "file", "+", "=", "\"", "/", "src", "/", "test", "/", "resources", "/", "ssh", "/", "key", "\"", ";", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "\")", ";", "this", ".", "output", ".", "expect", "(", "containsString", "(", "\"", "is", "neither", "under", "the", "current", "location", "\"", "))", ";", "this", ".", "repository", ".", "findOne", "(", "\"", "blah", "\"", ",", "\"", "local", "\"", ",", "\"", "master", "\"", ",", "file", ")", ";", "}</s>for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "continue", ";", "}", "Resource", "file", "=", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", "))", "{"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "request"]}
{"contents": ["usermodehelper:", "implement", "UMH_KILLABLE", "Implement", "UMH_KILLABLE,", "should", "be", "used", "along", "with", "UMH_WAIT_EXEC/PROC.", "The", "caller", "must", "ensure", "that", "subprocess_info->path/etc", "can", "not", "go", "away", "until", "call_usermodehelper_freeinfo().", "call_usermodehelper_exec(UMH_KILLABLE)", "does", "wait_for_completion_killable.", "If", "it", "fails,", "it", "uses", "xchg(&sub_info->complete,", "NULL)", "to", "serialize", "with", "umh_complete()", "which", "does", "the", "same", "xhcg()", "to", "access", "sub_info->complete.", "If", "call_usermodehelper_exec", "wins,", "it", "can", "safely", "return.", "umh_complete()", "should", "get", "NULL", "and", "call", "call_usermodehelper_freeinfo().", "Otherwise", "we", "know", "that", "umh_complete()", "was", "already", "called,", "in", "this", "case", "call_usermodehelper_exec()", "falls", "back", "to", "wait_for_completion()", "which", "should", "succeed", "\"very", "soon\".", "Note:", "UMH_NO_WAIT", "==", "-1", "but", "it", "obviously", "should", "not", "be", "used", "with", "UMH_KILLABLE.", "We", "delay", "the", "neccessary", "cleanup", "to", "simplify", "the", "back", "porting.", "Signed-off-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "Tetsuo", "Handa", "<penguin-kernel@I-love.SAKURA.ne.jp>", "Cc:", "Rusty", "Russell", "<rusty@rustcorp.com.au>", "Cc:", "Tejun", "Heo", "<tj@kernel.org>", "Cc:", "David", "Rientjes", "<rientjes@google.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "define", "UMH_KILLABLE", "4", "/", "*", "wait", "for", "EXEC", "/", "PROC", "killable", "*", "/", "struct", "completion", "*", "comp", "=", "xchg", "(", "&", "sub_info", "-", ">", "complete", ",", "NULL", ")", ";", "/", "*", "*", "See", "call_usermodehelper_exec", "(", ").", "If", "xchg", "(", ")", "returns", "NULL", "*", "we", "own", "sub_info", ",", "the", "UMH_KILLABLE", "caller", "has", "gone", "away", ".", "*", "/", "if", "(", "comp", ")", "complete", "(", "comp", ")", ";", "else", "call_usermodehelper_freeinfo", "(", "sub_info", ")", ";", "if", "(", "wait", "!", "=", "UMH_NO_WAIT", ")", "wait", "&", "=", "~", "UMH_KILLABLE", ";", "if", "(", "wait", "&", "UMH_KILLABLE", ")", "{", "retval", "=", "wait_for_completion_killable", "(", "&", "done", ")", ";", "if", "(", "!", "retval", ")", "goto", "wait_done", ";", "/", "*", "umh_complete", "(", ")", "will", "see", "NULL", "and", "free", "sub_info", "*", "/", "if", "(", "xchg", "(", "&", "sub_info", "-", ">", "complete", ",", "NULL", ")", ")", "goto", "unlock", ";", "/", "*", "fallthrough", ",", "umh_complete", "(", ")", "was", "already", "called", "*", "/", "}", "wait_done", ":</s>complete", "(", "sub_info", "-", ">", "complete", ")", ";"], "docstring_tokens": ["does", "not", "set", "a", "certain", "killable", "attribute"]}
{"contents": ["...", "actual", "#2704", "fix", "here", "(forgot", "to", "commit", "change)"], "code_tokens": ["/", "/", "[", "databind", "#", "2469", "]", ":", "xalan", "/", "/", "[", "databind", "#", "2704", "]", ":", "xalan2", "s", ".", "add", "(", "\"", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "lib", ".", "sql", ".", "JNDIConnectionPool", "\"", ");</s>/", "/", "[", "databind", "#", "2469", "]", ":", "xalan2"], "docstring_tokens": ["an", "unsafe", "deserialization"]}
{"contents": ["Fix", "out", "of", "bounds", "write"], "code_tokens": ["if", "(", "y", ">", "=", "m_height", ")", "break", ";</s>"], "docstring_tokens": ["do", "not", "check", "the", "input", "length"]}
{"contents": ["no", "jira:", "User", "name", "should", "be", "escaped", "in", "chat", "message", "JSON"], "code_tokens": ["import", "static", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringEscapeUtils", ".", "escapeHtml4", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringEscapeUtils", ";", "private", "static", "String", "getName", "(", "User", "u", ")", "{", "return", "escapeHtml4", "(", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "u", ".", "getFirstname", "(", "),", "u", ".", "getLastname", "(", "))", ");", "}", "scopeName", "=", "getName", "(", "u", ")", ";", ".", "put", "(", "\"", "name", "\"", ",", "getName", "(", "m", ".", "getFromUser", "(", "))", ");</s>scopeName", "=", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "u", ".", "getFirstname", "(", "),", "u", ".", "getLastname", "(", "))", ";", ".", "put", "(", "\"", "name", "\"", ",", "m", ".", "getFromUser", "(", ").", "getFirstname", "(", ")", "+", "\"", "\"", "+", "m", ".", "getFromUser", "(", ").", "getLastname", "(", "))", ";"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["Add", "test", "for", "response", "header", "validation"], "code_tokens": ["/", "*", "*", "Copyright", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "ratpack", ".", "http", "import", "ratpack", ".", "test", ".", "internal", ".", "RatpackGroovyDslSpec", "class", "ResponseHeaderValidationSpec", "extends", "RatpackGroovyDslSpec", "{", "def", "\"", "invalid", "header", "values", "yield", "exception", "\"", "()", "{", "when", ":", "handlers", "{", "all", "{", "try", "{", "header", "(", "\"", "Test", "\"", ",", "\"", "value", "\\", "r", "\\", "nAnotherHeader", ":", "another", "value", "\"", ")", "render", "\"", "ok", "\"", "}", "catch", "(", "e", ")", "{", "render", "e", ".", "toString", "(", ")", "}", "}", "}", "then", ":", "def", "response", "=", "get", "(", ")", "response", ".", "headers", ".", "names", "=", "=", "[", "'", "content", "-", "type", "'", ",", "'", "content", "-", "length", "'", "].", "toSet", "(", ")", "response", ".", "body", ".", "text", "=", "=", "\"", "java", ".", "lang", ".", "IllegalArgumentException", ":", "only", "'", "'", "and", "'", "\\\\", "t", "'", "are", "allowed", "after", "'", "\\\\", "n", "'", ":", "value", "\\", "r", "\\", "nAnotherHeader", ":", "another", "value", "\"", "}", "}</s>"], "docstring_tokens": ["improper", "validation", "of", "input"]}
{"contents": ["Add", "encoding", "for", "the", "default", "action", "in", "FormTag", "Issue:", "SPR-11426"], "code_tokens": ["*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UriUtils", ";", "String", "encoding", "=", "pageContext", ".", "getResponse", "(", ").", "getCharacterEncoding", "(", ");", "try", "{", "requestUri", "=", "UriUtils", ".", "encodePath", "(", "requestUri", ",", "encoding", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "throw", "new", "JspException", "(", "e", ")", ";", "}", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "public", "void", "testDefaultActionEncoded", "(", ")", "throws", "Exception", "{", "this", ".", "request", ".", "setRequestURI", "(", "\"/", "a", "b", "c", "\"", ");", "request", ".", "setQueryString", "(", "\"\"", ");", "this", ".", "tag", ".", "doStartTag", "(", ");", "this", ".", "tag", ".", "doEndTag", "(", ");", "this", ".", "tag", ".", "doFinally", "(", ");", "String", "output", "=", "getOutput", "(", ");", "String", "formOutput", "=", "getFormTag", "(", "output", ")", ";", "assertContainsAttribute", "(", "formOutput", ",", "\"", "action", "\"", ",", "\"", "/", "a", "%", "20b", "%", "20c", "\"", ");", "}</s>*", "Copyright", "2002", "-", "2013", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2013", "the", "original", "author", "or", "authors", "."], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["62104:", "Fix", "programmatic", "login", "regression", "as", "the", "NonLoginAuthenticator", "has", "to", "be", "set", "for", "it", "to", "work", "(if", "no", "login", "method", "is", "specified).", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@1824323", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["if", "(", "loginConfig", "=", "=", "null", ")", "{", "/", "/", "Security", "constraints", "present", ".", "Need", "an", "authenticator", "to", "/", "/", "support", "them", ".", "loginConfig", "=", "DUMMY_LOGIN_CONFIG", ";", "context", ".", "setLoginConfig", "(", "loginConfig", ")", ";", "<", "fix", ">", "<", "bug", ">", "62104", "<", "/", "bug", ">", ":", "Fix", "programmatic", "login", "regression", "as", "the", "NonLoginAuthenticator", "has", "to", "be", "set", "for", "it", "to", "work", "(", "if", "no", "login", "method", "is", "specified", ")", ".", "(", "remm", ")", "<", "/", "fix", "></s>SecurityConstraint", "constraints", "[", "]", "=", "context", ".", "findConstraints", "(", ");", "if", "(", "(", "constraints", "=", "=", "null", "|", "|", "constraints", ".", "length", "=", "=", "0", ")", "&", "&", "!", "context", ".", "getPreemptiveAuthentication", "(", "))", "{", "/", "/", "No", "need", "for", "an", "authenticator", "return", ";", "}", "else", "{", "if", "(", "loginConfig", "=", "=", "null", ")", "{", "/", "/", "Security", "constraints", "present", ".", "Need", "an", "authenticator", "to", "/", "/", "support", "them", ".", "loginConfig", "=", "DUMMY_LOGIN_CONFIG", ";", "context", ".", "setLoginConfig", "(", "loginConfig", ")", ";", "}"], "docstring_tokens": ["the", "failure", "to", "properly", "enforce", "security", "constraints"]}
{"contents": ["PKCS#7:", "Fix", "NULL", "dereference", "with", "missing", "EncryptedContent.", "Reviewed-by:", "Rich", "Salz", "<rsalz@openssl.org>"], "code_tokens": ["/", "*", "*", "p7", "-", ">", "d", ".", "sign", "-", ">", "contents", "is", "a", "PKCS7", "structure", "consisting", "of", "a", "contentType", "*", "field", "and", "optional", "content", ".", "*", "data_body", "is", "NULL", "if", "that", "structure", "has", "no", "(", "=", "detached", ")", "content", "*", "or", "if", "the", "contentType", "is", "wrong", "(", "i", ".", "e", ".", ",", "not", "\"", "data", "\"", ").", "*", "/", "/", "*", "data_body", "is", "NULL", "if", "the", "optional", "EncryptedContent", "is", "missing", ".", "*", "/", "/", "*", "data_body", "is", "NULL", "if", "the", "optional", "EncryptedContent", "is", "missing", ".", "*", "/", "/", "*", "Detached", "content", "must", "be", "supplied", "via", "in_bio", "instead", ".", "*", "/", "if", "(", "data_body", "=", "=", "NULL", "&", "&", "in_bio", "=", "=", "NULL", ")", "{", "PKCS7err", "(", "PKCS7_F_PKCS7_DATADECODE", ",", "PKCS7_R_NO_CONTENT", ")", ";", "goto", "err", ";", "}", "if", "(", "in_bio", "!", "=", "NULL", ")", "{</s>if", "(", "PKCS7_is_detached", "(", "p7", ")", "|", "|", "(", "in_bio", "!", "=", "NULL", ")", ")", "{"], "docstring_tokens": ["the", "improper", "handling", "of", "missing", "inner", "EncryptedContent"]}
{"contents": ["iFixed", "bug", "#72446", "-", "Integer", "Overflow", "in", "gdImagePaletteToTrueColor()", "resulting", "in", "heap", "overflow"], "code_tokens": [".", "Fixed", "bug", "#", "72446", "(", "Integer", "Overflow", "in", "gdImagePaletteToTrueColor", "(", ")", "resulting", "in", "heap", "overflow", ")", ".", "(", "Pierre", ")", "if", "(", "overflow2", "(", "sizeof", "(", "unsigned", "char", "*", "),", "sx", ")", ")", "{", "return", "NULL", ";", "}", "/", "*", "gdImageAALine", "(", "im", ",", "x1", ",", "y1", ",", "x2", ",", "y2", ",", "im", "-", ">", "AA_color", ")", ";", "alphablending_bak", "=", "im", "-", ">", "alphaBlendingFlag", ";", "im", "-", ">", "alphaBlendingFlag", "=", "alphablending_bak", ";", "im", "-", ">", "alphaBlendingFlag", "=", "alphablending_bak", ";</s>-", "mbstring", ":", "/", "*", "gdImageAALine", "(", "im", ",", "x1", ",", "y1", ",", "x2", ",", "y2", ",", "im", "-", ">", "AA_color", ")", ";", "alphablending_bak", "=", "im", "-", ">", "alphaBlendingFlag", ";", "im", "-", ">", "alphaBlendingFlag", "=", "alphablending_bak", ";", "im", "-", ">", "alphaBlendingFlag", "=", "alphablending_bak", ";"], "docstring_tokens": ["integer", "overflows)"]}
{"contents": ["Fix", "#73280:", "Stack", "Buffer", "Overflow", "in", "GD", "dynamicGetbuf", "We", "make", "sure", "to", "never", "pass", "a", "negative", "`rlen`", "as", "size", "to", "memcpy().", "Cf.", "<https://github.com/libgd/libgd/commit/53110871>."], "code_tokens": [".", "Fixed", "bug", "#", "73280", "(", "Stack", "Buffer", "Overflow", "in", "GD", "dynamicGetbuf", ")", ".", "(", "cmb", ")", "if", "(", "remain", "<", "=", "0", ")", "{</s>-", "SOAP", ":", "if", "(", "remain", "=", "=", "0", ")", "{"], "docstring_tokens": ["improper", "bounds", "checking"]}
{"contents": ["Add", "cofactor", "validation", "after", "point", "decompression"], "code_tokens": ["ECPoint", "p", "=", "this", ".", "createRawPoint", "(", "x", ",", "y", ",", "true", ")", ";", "if", "(", "!", "p", ".", "satisfiesCofactor", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Invalid", "point", "\"", ");", "}", "return", "p", ";", "ECFieldElement", "x", "=", "fromBigInteger", "(", "X1", ")", ",", "y", "=", "null", ";", "if", "(", "x", ".", "isZero", "(", "))", "y", "=", "b", ".", "sqrt", "(", ");", "ECFieldElement", "beta", "=", "x", ".", "square", "(", ").", "invert", "(", ").", "multiply", "(", "b", ")", ".", "add", "(", "a", ")", ".", "add", "(", "x", ")", ";", "y", "=", "z", ".", "add", "(", "x", ")", ";", "y", "=", "z", ".", "multiply", "(", "x", ")", ";", "if", "(", "y", "=", "=", "null", ")", "ECPoint", "p", "=", "this", ".", "createRawPoint", "(", "x", ",", "y", ",", "true", ")", ";", "if", "(", "!", "p", ".", "satisfiesCofactor", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Invalid", "point", "\"", ");", "}", "return", "p", ";", "protected", "boolean", "satisfiesCofactor", "(", ")", "{", "BigInteger", "h", "=", "curve", ".", "getCofactor", "(", ");", "return", "h", "=", "=", "null", "|", "|", "h", ".", "equals", "(", "ECConstants", ".", "ONE", ")", "|", "|", "!", "ECAlgorithms", ".", "referenceMultiply", "(", "this", ",", "h", ")", ".", "isInfinity", "(", ");", "}", "if", "(", "!", "satisfiesCofactor", "(", "))</s>return", "this", ".", "createRawPoint", "(", "x", ",", "y", ",", "true", ")", ";", "ECFieldElement", "xp", "=", "fromBigInteger", "(", "X1", ")", ",", "yp", "=", "null", ";", "if", "(", "xp", ".", "isZero", "(", "))", "yp", "=", "b", ".", "sqrt", "(", ");", "ECFieldElement", "beta", "=", "xp", ".", "square", "(", ").", "invert", "(", ").", "multiply", "(", "b", ")", ".", "add", "(", "a", ")", ".", "add", "(", "xp", ")", ";", "yp", "=", "z", ".", "add", "(", "xp", ")", ";", "yp", "=", "z", ".", "multiply", "(", "xp", ")", ";", "if", "(", "yp", "=", "=", "null", ")", "return", "createRawPoint", "(", "xp", ",", "yp", ",", "true", ")", ";", "BigInteger", "h", "=", "curve", ".", "getCofactor", "(", ");", "if", "(", "h", "!", "=", "null", "&", "&", "!", "h", ".", "equals", "(", "ECConstants", ".", "ONE", ")", "&", "&", "ECAlgorithms", ".", "referenceMultiply", "(", "this", ",", "h", ")", ".", "isInfinity", "(", "))"], "docstring_tokens": ["an", "invalid", "curve", "attack"]}
{"contents": ["KVM:", "Validate", "userspace_addr", "of", "memslot", "when", "registered", "This", "way,", "we", "can", "avoid", "checking", "the", "user", "space", "address", "many", "times", "when", "we", "read", "the", "guest", "memory.", "Although", "we", "can", "do", "the", "same", "for", "write", "if", "we", "check", "which", "slots", "are", "writable,", "we", "do", "not", "care", "write", "now:", "reading", "the", "guest", "memory", "happens", "more", "often", "than", "writing.", "[avi:", "change", "VERIFY_READ", "to", "VERIFY_WRITE]", "Signed-off-by:", "Takuya", "Yoshikawa", "<yoshikawa.takuya@oss.ntt.co.jp>", "Signed-off-by:", "Avi", "Kivity", "<avi@redhat.com>"], "code_tokens": ["if", "(", "unlikely", "(", "__copy_from_user", "(", "&", "pte", ",", "ptep_user", ",", "sizeof", "(", "pte", ")", "))", ")", "{", "/", "*", "We", "can", "read", "the", "guest", "memory", "with", "__xxx_user", "(", ")", "later", "on", ".", "*", "/", "if", "(", "user_alloc", "&", "&", "(", "(", "mem", "-", ">", "userspace_addr", "&", "(", "PAGE_SIZE", "-", "1", ")", ")", "|", "|", "!", "access_ok", "(", "VERIFY_WRITE", ",", "mem", "-", ">", "userspace_addr", ",", "mem", "-", ">", "memory_size", ")", "))", "r", "=", "__copy_from_user", "(", "data", ",", "(", "void", "__user", "*", ")", "addr", "+", "offset", ",", "len", ")", ";</s>if", "(", "unlikely", "(", "copy_from_user", "(", "&", "pte", ",", "ptep_user", ",", "sizeof", "(", "pte", ")", "))", ")", "{", "if", "(", "user_alloc", "&", "&", "(", "mem", "-", ">", "userspace_addr", "&", "(", "PAGE_SIZE", "-", "1", ")", "))", "r", "=", "copy_from_user", "(", "data", ",", "(", "void", "__user", "*", ")", "addr", "+", "offset", ",", "len", ")", ";"], "docstring_tokens": ["does", "not", "check", "whether", "kernel", "addresses", "are", "specified", "during", "allocation", "of", "memory", "slots", "for", "use", "in", "a", "guest's", "physical", "address", "space"]}
{"contents": ["Btrfs:", "fix", "hash", "overflow", "handling", "The", "handling", "for", "directory", "crc", "hash", "overflows", "was", "fairly", "obscure,", "split_leaf", "returns", "EOVERFLOW", "when", "we", "try", "to", "extend", "the", "item", "and", "that", "is", "supposed", "to", "bubble", "up", "to", "userland.", "For", "a", "while", "it", "did", "so,", "but", "along", "the", "way", "we", "added", "better", "handling", "of", "errors", "and", "forced", "the", "FS", "readonly", "if", "we", "hit", "IO", "errors", "during", "the", "directory", "insertion.", "Along", "the", "way,", "we", "started", "testing", "only", "for", "EEXIST", "and", "the", "EOVERFLOW", "case", "was", "dropped.", "The", "end", "result", "is", "that", "we", "may", "force", "the", "FS", "readonly", "if", "we", "catch", "a", "directory", "hash", "bucket", "overflow.", "This", "fixes", "a", "few", "problem", "spots.", "First", "I", "add", "tests", "for", "EOVERFLOW", "in", "the", "places", "where", "we", "can", "safely", "just", "return", "the", "error", "up", "the", "chain.", "btrfs_rename", "is", "harder", "though,", "because", "it", "tries", "to", "insert", "the", "new", "directory", "item", "only", "after", "it", "has", "already", "unlinked", "anything", "the", "rename", "was", "going", "to", "overwrite.", "Rather", "than", "adding", "very", "complex", "logic,", "I", "added", "a", "helper", "to", "test", "for", "the", "hash", "overflow", "case", "early", "while", "it", "is", "still", "safe", "to", "bail", "out.", "Snapshot", "and", "subvolume", "creation", "had", "a", "similar", "problem,", "so", "they", "are", "using", "the", "new", "helper", "now", "too.", "Signed-off-by:", "Chris", "Mason", "<chris.mason@fusionio.com>", "Reported-by:", "Pascal", "Junod", "<pascal@junod.info>"], "code_tokens": ["int", "btrfs_check_dir_item_collision", "(", "struct", "btrfs_root", "*", "root", ",", "u64", "dir", ",", "const", "char", "*", "name", ",", "int", "name_len", ")", ";", "int", "btrfs_check_dir_item_collision", "(", "struct", "btrfs_root", "*", "root", ",", "u64", "dir", ",", "const", "char", "*", "name", ",", "int", "name_len", ")", "{", "int", "ret", ";", "struct", "btrfs_key", "key", ";", "struct", "btrfs_dir_item", "*", "di", ";", "int", "data_size", ";", "struct", "extent_buffer", "*", "leaf", ";", "int", "slot", ";", "struct", "btrfs_path", "*", "path", ";", "path", "=", "btrfs_alloc_path", "(", ");", "if", "(", "!", "path", ")", "return", "-", "ENOMEM", ";", "key", ".", "objectid", "=", "dir", ";", "btrfs_set_key_type", "(", "&", "key", ",", "BTRFS_DIR_ITEM_KEY", ")", ";", "key", ".", "offset", "=", "btrfs_name_hash", "(", "name", ",", "name_len", ")", ";", "ret", "=", "btrfs_search_slot", "(", "NULL", ",", "root", ",", "&", "key", ",", "path", ",", "0", ",", "0", ")", ";", "/", "*", "return", "back", "any", "errors", "*", "/", "if", "(", "ret", "<", "0", ")", "goto", "out", ";", "/", "*", "nothing", "found", ",", "we", "'", "re", "safe", "*", "/", "if", "(", "ret", ">", "0", ")", "{", "ret", "=", "0", ";", "goto", "out", ";", "}", "/", "*", "we", "found", "an", "item", ",", "look", "for", "our", "name", "in", "the", "item", "*", "/", "di", "=", "btrfs_match_dir_item_name", "(", "root", ",", "path", ",", "name", ",", "name_len", ")", ";", "if", "(", "di", ")", "{", "/", "*", "our", "exact", "name", "was", "found", "*", "/", "ret", "=", "-", "EEXIST", ";", "goto", "out", ";", "}", "/", "*", "*", "see", "if", "there", "is", "room", "in", "the", "item", "to", "insert", "this", "*", "name", "*", "/", "data_size", "=", "sizeof", "(", "*", "di", ")", "+", "name_len", "+", "sizeof", "(", "struct", "btrfs_item", ")", ";", "leaf", "=", "path", "-", ">", "nodes", "[", "0", "]", ";", "slot", "=", "path", "-", ">", "slots", "[", "0", "]", ";", "if", "(", "data_size", "+", "btrfs_item_size_nr", "(", "leaf", ",", "slot", ")", "sizeof", "(", "struct", "btrfs_item", ")", ">", "BTRFS_LEAF_DATA_SIZE", "(", "root", ")", ")", "{", "ret", "=", "-", "EOVERFLOW", ";", "}", "else", "{", "/", "*", "plenty", "of", "insertion", "room", "*", "/", "ret", "=", "0", ";", "}", "out", ":", "btrfs_free_path", "(", "path", ")", ";", "return", "ret", ";", "}", "if", "(", "ret", "=", "=", "-", "EEXIST", "|", "|", "ret", "=", "=", "-", "EOVERFLOW", ")", "/", "*", "check", "for", "collisions", ",", "even", "if", "the", "name", "isn", "'", "t", "there", "*", "/", "ret", "=", "btrfs_check_dir_item_collision", "(", "root", ",", "new_dir", "-", ">", "i_ino", ",", "new_dentry", "-", ">", "d_name", ".", "name", ",", "new_dentry", "-", ">", "d_name", ".", "len", ")", ";", "if", "(", "ret", ")", "{", "if", "(", "ret", "=", "=", "-", "EEXIST", ")", "{", "/", "*", "we", "shouldn", "'", "t", "get", "*", "eexist", "without", "a", "new_inode", "*", "/", "if", "(", "!", "new_inode", ")", "{", "WARN_ON", "(", "1", ")", ";", "return", "ret", ";", "}", "}", "else", "{", "/", "*", "maybe", "-", "EOVERFLOW", "*", "/", "return", "ret", ";", "}", "}", "ret", "=", "0", ";", "/", "*", "*", "even", "if", "this", "name", "doesn", "'", "t", "exist", ",", "we", "may", "get", "hash", "collisions", ".", "*", "check", "for", "them", "now", "when", "we", "can", "safely", "fail", "*", "/", "error", "=", "btrfs_check_dir_item_collision", "(", "BTRFS_I", "(", "dir", ")", "->", "root", ",", "dir", "-", ">", "i_ino", ",", "name", ",", "namelen", ")", ";", "if", "(", "error", ")", "goto", "out_dput", ";", "BUG_ON", "(", "ret", "=", "=", "-", "EEXIST", "|", "|", "ret", "=", "=", "-", "EOVERFLOW", ")", ";</s>if", "(", "ret", "=", "=", "-", "EEXIST", ")", "BUG_ON", "(", "ret", "=", "=", "-", "EEXIST", ")", ";"], "docstring_tokens": ["not", "investigate", "the", "code", "to", "determine", "whether", "an", "infinite", "loop", "was", "actually", "occurring"]}
{"contents": ["Validate", "cookie", "name", "and", "value", "characters", "Motivation:", "RFC6265", "specifies", "which", "characters", "are", "allowed", "in", "a", "cookie", "name", "and", "value.", "Netty", "is", "currently", "too", "lax,", "which", "can", "used", "for", "HttpOnly", "escaping.", "Modification:", "In", "ServerCookieDecoder:", "discard", "cookie", "key-value", "pairs", "that", "contain", "invalid", "characters.", "In", "ClientCookieEncoder:", "throw", "an", "exception", "when", "trying", "to", "encode", "cookies", "with", "invalid", "characters.", "Result:", "The", "problem", "described", "in", "the", "motivation", "section", "is", "fixed."], "code_tokens": ["@", "Deprecated", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", ".", "LAX", ".", "encode", "(", "name", ",", "value", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", ".", "LAX", ".", "encode", "(", "cookie", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", ".", "LAX", ".", "encode", "(", "cookies", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", ".", "LAX", ".", "encode", "(", "cookies", ")", ";", "*", "@", "deprecated", "Use", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", "}", "instead", ".", "@", "Deprecated", "public", "interface", "Cookie", "extends", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", "{", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "void", "setVersion", "(", "int", "version", ")", ";", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "*", "*", "@", "deprecated", "Not", "part", "of", "RFC6265", "@", "Deprecated", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieUtil", ".", "firstInvalidCookieNameOctet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieUtil", ".", "firstInvalidCookieValueOctet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieUtil", ".", "unwrapValue", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieHeaderNames", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "logging", ".", "InternalLogger", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "logging", ".", "InternalLoggerFactory", ";", "*", "@", "deprecated", "Use", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieDecoder", "}", "*", "or", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", "}", "instead", ".", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieDecoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", "private", "final", "InternalLogger", "logger", "=", "InternalLoggerFactory", ".", "getInstance", "(", "getClass", "(", "))", ";", "private", "static", "final", "CookieDecoder", "STRICT", "=", "new", "CookieDecoder", "(", "true", ")", ";", "private", "static", "final", "CookieDecoder", "LAX", "=", "new", "CookieDecoder", "(", "false", ")", ";", "private", "static", "final", "String", "COMMENT", "=", "\"", "Comment", "\"", ";", "private", "static", "final", "String", "COMMENTURL", "=", "\"", "CommentURL", "\"", ";", "private", "static", "final", "String", "DISCARD", "=", "\"", "Discard", "\"", ";", "private", "static", "final", "String", "PORT", "=", "\"", "Port", "\"", ";", "private", "static", "final", "String", "VERSION", "=", "\"", "Version", "\"", ";", "private", "final", "boolean", "strict", ";", "public", "static", "Set", "<", "Cookie", ">", "decode", "(", "String", "header", ")", "{", "return", "decode", "(", "header", ",", "true", ")", ";", "}", "public", "static", "Set", "<", "Cookie", ">", "decode", "(", "String", "header", ",", "boolean", "strict", ")", "{", "return", "(", "strict", "?", "STRICT", ":", "LAX", ")", ".", "doDecode", "(", "header", ")", ";", "}", "private", "Set", "<", "Cookie", ">", "doDecode", "(", "String", "header", ")", "{", "if", "(", "names", ".", "get", "(", "0", ")", ".", "equalsIgnoreCase", "(", "VERSION", ")", ")", "{", "Cookie", "c", "=", "initCookie", "(", "name", ",", "value", ")", ";", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "if", "(", "DISCARD", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "COMMENT", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "COMMENTURL", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "VERSION", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "PORT", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "private", "CookieDecoder", "(", "boolean", "strict", ")", "{", "this", ".", "strict", "=", "strict", ";", "}", "private", "DefaultCookie", "initCookie", "(", "String", "name", ",", "String", "value", ")", "{", "if", "(", "name", "=", "=", "null", "|", "|", "name", ".", "length", "(", ")", "=", "=", "0", ")", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "with", "null", "name", "\"", ");", "return", "null", ";", "}", "if", "(", "value", "=", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "with", "null", "value", "\"", ");", "return", "null", ";", "}", "CharSequence", "unwrappedValue", "=", "unwrapValue", "(", "value", ")", ";", "if", "(", "unwrappedValue", "=", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "because", "starting", "quotes", "are", "not", "properly", "balanced", "in", "'", "{}", "'\"", ",", "unwrappedValue", ")", ";", "return", "null", ";", "}", "int", "invalidOctetPos", ";", "if", "(", "strict", "&", "&", "(", "invalidOctetPos", "=", "firstInvalidCookieNameOctet", "(", "name", ")", ")", ">", "=", "0", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "because", "name", "'", "{}", "'", "contains", "invalid", "char", "'", "{}", "'\"", ",", "name", ",", "name", ".", "charAt", "(", "invalidOctetPos", ")", ");", "}", "return", "null", ";", "}", "final", "boolean", "wrap", "=", "unwrappedValue", ".", "length", "(", ")", "!", "=", "value", ".", "length", "(", ");", "if", "(", "strict", "&", "&", "(", "invalidOctetPos", "=", "firstInvalidCookieValueOctet", "(", "unwrappedValue", ")", ")", ">", "=", "0", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "because", "value", "'", "{}", "'", "contains", "invalid", "char", "'", "{}", "'\"", ",", "unwrappedValue", ",", "unwrappedValue", ".", "charAt", "(", "invalidOctetPos", ")", ");", "}", "return", "null", ";", "}", "DefaultCookie", "cookie", "=", "new", "DefaultCookie", "(", "name", ",", "unwrappedValue", ".", "toString", "(", "))", ";", "cookie", ".", "setWrap", "(", "wrap", ")", ";", "return", "cookie", ";", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "import", "java", ".", "util", ".", "BitSet", ";", "/", "**", "*", "@", "deprecated", "Duplicate", "of", "package", "private", "$", "{@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", "}", "*", "/", "@", "Deprecated", "final", "class", "CookieUtil", "{", "private", "static", "final", "BitSet", "VALID_COOKIE_VALUE_OCTETS", "=", "validCookieValueOctets", "(", ");", "private", "static", "final", "BitSet", "VALID_COOKIE_NAME_OCTETS", "=", "validCookieNameOctets", "(", "VALID_COOKIE_VALUE_OCTETS", ")", ";", "/", "/", "US", "-", "ASCII", "characters", "excluding", "CTLs", ",", "whitespace", ",", "DQUOTE", ",", "comma", ",", "semicolon", ",", "and", "backslash", "private", "static", "BitSet", "validCookieValueOctets", "(", ")", "{", "BitSet", "bits", "=", "new", "BitSet", "(", "8", ")", ";", "for", "(", "int", "i", "=", "35", ";", "i", "<", "127", ";", "i", "+", "+)", "{", "/", "/", "US", "-", "ASCII", "characters", "excluding", "CTLs", "(", "%", "x00", "-", "1F", "/", "%", "x7F", ")", "bits", ".", "set", "(", "i", ")", ";", "}", "bits", ".", "set", "(", "'\"", "',", "false", ")", ";", "/", "/", "exclude", "DQUOTE", "=", "%", "x22", "bits", ".", "set", "(", "',", "',", "false", ")", ";", "/", "/", "exclude", "comma", "=", "%", "x2C", "bits", ".", "set", "(", "';", "',", "false", ")", ";", "/", "/", "exclude", "semicolon", "=", "%", "x3B", "bits", ".", "set", "(", "'\\", "\\'", ",", "false", ")", ";", "/", "/", "exclude", "backslash", "=", "%", "x5C", "return", "bits", ";", "}", "/", "/", "token", "=", "1", "*", "<", "any", "CHAR", "except", "CTLs", "or", "separators", ">", "/", "/", "separators", "=", "\"", "(\"", "|", "\"", ")\"", "|", "\"", "<\"", "|", "\"", ">\"", "|", "\"", "@\"", "/", "/", "|", "\"", ",\"", "|", "\"", ";\"", "|", "\"", ":\"", "|", "\"", "\\\"", "|", "<", "\">", "/", "/", "|", "\"", "/\"", "|", "\"", "[\"", "|", "\"", "]\"", "|", "\"", "?\"", "|", "\"", "=\"", "/", "/", "|", "\"", "{\"", "|", "\"", "}\"", "|", "SP", "|", "HT", "private", "static", "BitSet", "validCookieNameOctets", "(", "BitSet", "validCookieValueOctets", ")", "{", "BitSet", "bits", "=", "new", "BitSet", "(", "8", ")", ";", "bits", ".", "or", "(", "validCookieValueOctets", ")", ";", "bits", ".", "set", "(", "'(", "',", "false", ")", ";", "bits", ".", "set", "(", "')", "',", "false", ")", ";", "bits", ".", "set", "(", "'<", "',", "false", ")", ";", "bits", ".", "set", "(", "'>", "',", "false", ")", ";", "bits", ".", "set", "(", "'@", "',", "false", ")", ";", "bits", ".", "set", "(", "':", "',", "false", ")", ";", "bits", ".", "set", "(", "'/", "',", "false", ")", ";", "bits", ".", "set", "(", "'[", "',", "false", ")", ";", "bits", ".", "set", "(", "']", "',", "false", ")", ";", "bits", ".", "set", "(", "'?", "',", "false", ")", ";", "bits", ".", "set", "(", "'=", "',", "false", ")", ";", "bits", ".", "set", "(", "'{", "',", "false", ")", ";", "bits", ".", "set", "(", "'}", "',", "false", ")", ";", "bits", ".", "set", "(", "'", "'", ",", "false", ")", ";", "bits", ".", "set", "(", "'\\", "t", "'", ",", "false", ")", ";", "return", "bits", ";", "}", "static", "int", "firstInvalidCookieNameOctet", "(", "CharSequence", "cs", ")", "{", "return", "firstInvalidOctet", "(", "cs", ",", "VALID_COOKIE_NAME_OCTETS", ")", ";", "}", "static", "int", "firstInvalidCookieValueOctet", "(", "CharSequence", "cs", ")", "{", "return", "firstInvalidOctet", "(", "cs", ",", "VALID_COOKIE_VALUE_OCTETS", ")", ";", "}", "static", "int", "firstInvalidOctet", "(", "CharSequence", "cs", ",", "BitSet", "bits", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "cs", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "cs", ".", "charAt", "(", "i", ")", ";", "if", "(", "!", "bits", ".", "get", "(", "c", ")", ")", "{", "return", "i", ";", "}", "}", "return", "-", "1", ";", "}", "static", "CharSequence", "unwrapValue", "(", "CharSequence", "cs", ")", "{", "final", "int", "len", "=", "cs", ".", "length", "(", ");", "if", "(", "len", ">", "0", "&", "&", "cs", ".", "charAt", "(", "0", ")", "=", "=", "'", "\"'", ")", "{", "if", "(", "len", ">", "=", "2", "&", "&", "cs", ".", "charAt", "(", "len", "-", "1", ")", "=", "=", "'", "\"'", ")", "{", "/", "/", "properly", "balanced", "return", "len", "=", "=", "2", "?", "\"", "\"", ":", "cs", ".", "subSequence", "(", "1", ",", "len", "-", "1", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "return", "cs", ";", "}", "private", "CookieUtil", "(", ")", "{", "/", "/", "Unused", "}", "}", "@", "@", "-", "19", ",", "63", "+", "19", ",", "26", "@", "@", "*", "*", "@", "deprecated", "Use", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "DefaultCookie", "}", "instead", ".", "@", "Deprecated", "public", "class", "DefaultCookie", "extends", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "DefaultCookie", "implements", "Cookie", "{", "super", "(", "name", ",", "value", ")", ";", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "@", "Deprecated", "public", "final", "class", "HttpHeaderDateFormat", "extends", "SimpleDateFormat", "{", "public", "static", "HttpHeaderDateFormat", "get", "(", ")", "{", "*", "{", "@", "link", "QueryStringEncoder", "}", "and", "{", "@", "link", "QueryStringDecoder", "}", ".", "*", "*", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", "}", "support", "is", "also", "provided", "*", "separately", "via", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", "}", ",", "*", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieDecoder", "}", ",", "*", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", "}", ",", "*", "and", "{", "@", "link", "@", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", "}", ".", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieDecoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", "*", "Unlike", "the", "Servlet", "API", ",", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", "}", "support", "is", "provided", "*", "separately", "via", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", "}", ",", "*", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieDecoder", "}", ",", "*", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", "}", ",", "*", "and", "{", "@", "link", "@", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", "}", ".", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieDecoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", "*", "@", "see", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", "*", "*", "@", "deprecated", "Use", "{", "@", "link", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", "}", "instead", "@", "Deprecated", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ".", "LAX", ".", "encode", "(", "name", ",", "value", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ".", "LAX", ".", "encode", "(", "cookie", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ".", "LAX", ".", "encode", "(", "cookies", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ".", "LAX", ".", "encode", "(", "cookies", ")", ";", "@", "Deprecated", "return", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ".", "LAX", ".", "encode", "(", "cookies", ")", ";", "*", "Copyright", "2015", "The", "Netty", "Project", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ".", "checkNotNull", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpHeaderDateFormat", ";", "*", "It", "will", "store", "the", "way", "the", "raw", "value", "was", "wrapped", "in", "{", "@", "link", "Cookie", "#", "setWrap", "(", "boolean", ")", "}", "so", "it", "can", "be", "public", "final", "class", "ClientCookieDecoder", "extends", "CookieDecoder", "{", "/", "**", "*", "Strict", "encoder", "that", "validates", "that", "name", "and", "value", "chars", "are", "in", "the", "valid", "scope", "*", "defined", "in", "RFC6265", "*", "/", "public", "static", "final", "ClientCookieDecoder", "STRICT", "=", "new", "ClientCookieDecoder", "(", "true", ")", ";", "/", "**", "*", "Lax", "instance", "that", "doesn", "'", "t", "validate", "name", "and", "value", "*", "/", "public", "static", "final", "ClientCookieDecoder", "LAX", "=", "new", "ClientCookieDecoder", "(", "false", ")", ";", "private", "ClientCookieDecoder", "(", "boolean", "strict", ")", "{", "super", "(", "strict", ")", ";", "}", "public", "Cookie", "decode", "(", "String", "header", ")", "{", "final", "int", "headerLen", "=", "checkNotNull", "(", "header", ",", "\"", "header", "\"", ").", "length", "(", ");", "int", "nameBegin", "=", "i", ";", "int", "nameEnd", "=", "i", ";", "int", "valueBegin", "=", "-", "1", ";", "int", "valueEnd", "=", "-", "1", ";", "if", "(", "i", "!", "=", "headerLen", ")", "{", "nameEnd", "=", "i", ";", "valueBegin", "=", "valueEnd", "=", "-", "1", ";", "nameEnd", "=", "i", ";", "valueBegin", "=", "valueEnd", "=", "0", ";", "valueBegin", "=", "i", ";", "/", "/", "NAME", "=", "VALUE", ";", "int", "semiPos", "=", "header", ".", "indexOf", "(", "';", "',", "i", ")", ";", "valueEnd", "=", "i", "=", "semiPos", ">", "0", "?", "semiPos", ":", "headerLen", ";", "nameEnd", "=", "headerLen", ";", "valueBegin", "=", "valueEnd", "=", "-", "1", ";", "if", "(", "valueEnd", ">", "0", "&", "&", "header", ".", "charAt", "(", "valueEnd", "-", "1", ")", "=", "=", "'", ",'", ")", "{", "/", "/", "old", "multiple", "cookies", "separator", ",", "skipping", "it", "valueEnd", "-", "-;", "}", "/", "/", "cookie", "name", "-", "value", "pair", "DefaultCookie", "cookie", "=", "initCookie", "(", "header", ",", "nameBegin", ",", "nameEnd", ",", "valueBegin", ",", "valueEnd", ")", ";", "if", "(", "cookie", "=", "=", "null", ")", "{", "return", "null", ";", "}", "cookieBuilder", "=", "new", "CookieBuilder", "(", "cookie", ")", ";", "/", "/", "cookie", "attribute", "String", "attrValue", "=", "valueBegin", "=", "=", "-", "1", "?", "null", ":", "header", ".", "substring", "(", "valueBegin", ",", "valueEnd", ")", ";", "cookieBuilder", ".", "appendAttribute", "(", "header", ",", "nameBegin", ",", "nameEnd", ",", "attrValue", ")", ";", "private", "final", "DefaultCookie", "cookie", ";", "public", "CookieBuilder", "(", "DefaultCookie", "cookie", ")", "{", "this", ".", "cookie", "=", "cookie", ";", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "CookieHeaderNames", ".", "PATH", ",", "0", ",", "4", ")", ")", "{", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "CookieHeaderNames", ".", "DOMAIN", ",", "0", ",", "5", ")", ")", "{", "domain", "=", "value", ".", "length", "(", ")", ">", "0", "?", "value", ".", "toString", "(", ")", ":", "null", ";", "}", "else", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "CookieHeaderNames", ".", "SECURE", ",", "0", ",", "5", ")", ")", "{", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "CookieHeaderNames", ".", "EXPIRES", ",", "0", ",", "7", ")", ")", "{", "}", "else", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "CookieHeaderNames", ".", "MAX_AGE", ",", "0", ",", "7", ")", ")", "{", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "CookieHeaderNames", ".", "HTTPONLY", ",", "0", ",", "8", ")", ")", "{", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "*;", "import", "static", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ".", "checkNotNull", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpRequest", ";", "/", "**", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "tools", ".", "ietf", ".", "org", "/", "html", "/", "rfc6265", "\"", ">", "RFC6265", "<", "/", "a", ">", "compliant", "cookie", "encoder", "to", "be", "used", "client", "side", ",", "*", "so", "only", "name", "=", "value", "pairs", "are", "sent", ".", "*", "*", "User", "-", "Agents", "are", "not", "supposed", "to", "interpret", "cookies", ",", "so", ",", "if", "present", ",", "{", "@", "link", "Cookie", "#", "rawValue", "(", ")}", "will", "be", "used", ".", "*", "Otherwise", ",", "{", "@", "link", "Cookie", "#", "value", "(", ")}", "will", "be", "used", "unquoted", ".", "*", "*", "Note", "that", "multiple", "cookies", "are", "supposed", "to", "be", "sent", "at", "once", "in", "a", "single", "\"", "Cookie", "\"", "header", ".", "*", "*", "<", "pre", ">", "*", "/", "/", "Example", "*", "{", "@", "link", "HttpRequest", "}", "req", "=", ".", "..", ";", "*", "res", ".", "setHeader", "(", "\"", "Cookie", "\"", ",", "{", "@", "link", "ClientCookieEncoder", "}", ".", "encode", "(", "\"", "JSESSIONID", "\"", ",", "\"", "1234", "\"", "))", ";", "*", "<", "/", "pre", ">", "*", "*", "@", "see", "ClientCookieDecoder", "*", "/", "public", "final", "class", "ClientCookieEncoder", "extends", "CookieEncoder", "{", "/", "**", "*", "Strict", "encoder", "that", "validates", "that", "name", "and", "value", "chars", "are", "in", "the", "valid", "scope", "*", "defined", "in", "RFC6265", "*", "/", "public", "static", "final", "ClientCookieEncoder", "STRICT", "=", "new", "ClientCookieEncoder", "(", "true", ")", ";", "/", "**", "*", "Lax", "instance", "that", "doesn", "'", "t", "validate", "name", "and", "value", "*", "/", "public", "static", "final", "ClientCookieEncoder", "LAX", "=", "new", "ClientCookieEncoder", "(", "false", ")", ";", "private", "ClientCookieEncoder", "(", "boolean", "strict", ")", "{", "super", "(", "strict", ")", ";", "}", "/", "**", "*", "Encodes", "the", "specified", "cookie", "into", "a", "Cookie", "header", "value", ".", "*", "*", "@", "param", "name", "the", "cookie", "name", "*", "@", "param", "value", "the", "cookie", "value", "*", "@", "return", "a", "Rfc6265", "style", "Cookie", "header", "value", "*", "/", "public", "String", "encode", "(", "String", "name", ",", "String", "value", ")", "{", "return", "encode", "(", "new", "DefaultCookie", "(", "name", ",", "value", ")", ");", "}", "/", "**", "*", "Encodes", "the", "specified", "cookie", "into", "a", "Cookie", "header", "value", ".", "*", "*", "@", "param", "specified", "the", "cookie", "*", "@", "return", "a", "Rfc6265", "style", "Cookie", "header", "value", "*", "/", "public", "String", "encode", "(", "Cookie", "cookie", ")", "{", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "encode", "(", "buf", ",", "checkNotNull", "(", "cookie", ",", "\"", "cookie", "\"", "))", ";", "return", "stripTrailingSeparator", "(", "buf", ")", ";", "}", "/", "**", "*", "Encodes", "the", "specified", "cookies", "into", "a", "single", "Cookie", "header", "value", ".", "*", "*", "@", "param", "cookies", "some", "cookies", "*", "@", "return", "a", "Rfc6265", "style", "Cookie", "header", "value", ",", "null", "if", "no", "cookies", "are", "passed", ".", "*", "/", "public", "String", "encode", "(", "Cookie", ".", "..", "cookies", ")", "{", "if", "(", "checkNotNull", "(", "cookies", ",", "\"", "cookies", "\"", ").", "length", "=", "=", "0", ")", "{", "return", "null", ";", "}", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encode", "(", "buf", ",", "c", ")", ";", "}", "return", "stripTrailingSeparatorOrNull", "(", "buf", ")", ";", "}", "/", "**", "*", "Encodes", "the", "specified", "cookies", "into", "a", "single", "Cookie", "header", "value", ".", "*", "*", "@", "param", "cookies", "some", "cookies", "*", "@", "return", "a", "Rfc6265", "style", "Cookie", "header", "value", ",", "null", "if", "no", "cookies", "are", "passed", ".", "*", "/", "public", "String", "encode", "(", "Iterable", "<", "?", "extends", "Cookie", ">", "cookies", ")", "{", "Iterator", "<", "?", "extends", "Cookie", ">", "cookiesIt", "=", "checkNotNull", "(", "cookies", ",", "\"", "cookies", "\"", ").", "iterator", "(", ");", "if", "(", "!", "cookiesIt", ".", "hasNext", "(", "))", "{", "return", "null", ";", "}", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "while", "(", "cookiesIt", ".", "hasNext", "(", "))", "{", "Cookie", "c", "=", "cookiesIt", ".", "next", "(", ");", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encode", "(", "buf", ",", "c", ")", ";", "}", "return", "stripTrailingSeparatorOrNull", "(", "buf", ")", ";", "}", "private", "void", "encode", "(", "StringBuilder", "buf", ",", "Cookie", "c", ")", "{", "final", "String", "name", "=", "c", ".", "name", "(", ");", "final", "String", "value", "=", "c", ".", "value", "(", ")", "!", "=", "null", "?", "c", ".", "value", "(", ")", ":", "\"", "\";", "validateCookie", "(", "name", ",", "value", ")", ";", "if", "(", "c", ".", "wrap", "(", "))", "{", "addQuoted", "(", "buf", ",", "name", ",", "value", ")", ";", "}", "else", "{", "add", "(", "buf", ",", "name", ",", "value", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "141", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "/", "**", "*", "An", "interface", "defining", "an", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "en", ".", "wikipedia", ".", "org", "/", "wiki", "/", "HTTP_cookie", "\"", ">", "HTTP", "cookie", "<", "/", "a", ">", ".", "*", "/", "public", "interface", "Cookie", "extends", "Comparable", "<", "Cookie", ">", "{", "/", "**", "*", "Returns", "the", "name", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "name", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "name", "(", ");", "/", "**", "*", "Returns", "the", "value", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "value", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "value", "(", ");", "/", "**", "*", "Sets", "the", "value", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "value", "The", "value", "to", "set", "*", "/", "void", "setValue", "(", "String", "value", ")", ";", "/", "**", "*", "Returns", "true", "if", "the", "raw", "value", "of", "this", "{", "@", "link", "Cookie", "}", ",", "*", "was", "wrapped", "with", "double", "quotes", "in", "original", "Set", "-", "Cookie", "header", ".", "*", "*", "@", "return", "If", "the", "value", "of", "this", "{", "@", "link", "Cookie", "}", "is", "to", "be", "wrapped", "*", "/", "boolean", "wrap", "(", ");", "/", "**", "*", "Sets", "true", "if", "the", "value", "of", "this", "{", "@", "link", "Cookie", "}", "*", "is", "to", "be", "wrapped", "with", "double", "quotes", ".", "*", "*", "@", "param", "wrap", "true", "if", "wrap", "*", "/", "void", "setWrap", "(", "boolean", "wrap", ")", ";", "/", "**", "*", "Returns", "the", "domain", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "domain", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "domain", "(", ");", "/", "**", "*", "Sets", "the", "domain", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "domain", "The", "domain", "to", "use", "*", "/", "void", "setDomain", "(", "String", "domain", ")", ";", "/", "**", "*", "Returns", "the", "path", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "{", "@", "link", "Cookie", "}", "'", "s", "path", "*", "/", "String", "path", "(", ");", "/", "**", "*", "Sets", "the", "path", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "path", "The", "path", "to", "use", "for", "this", "{", "@", "link", "Cookie", "}", "*", "/", "void", "setPath", "(", "String", "path", ")", ";", "/", "**", "*", "Returns", "the", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", "or", "{", "@", "link", "Long", "#", "MIN_VALUE", "}", "if", "unspecified", "*", "*", "@", "return", "The", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "long", "maxAge", "(", ");", "/", "**", "*", "Sets", "the", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", ".", "*", "If", "an", "age", "of", "{", "@", "code", "0", "}", "is", "specified", ",", "this", "{", "@", "link", "Cookie", "}", "will", "be", "*", "automatically", "removed", "by", "browser", "because", "it", "will", "expire", "immediately", ".", "*", "If", "{", "@", "link", "Long", "#", "MIN_VALUE", "}", "is", "specified", ",", "this", "{", "@", "link", "Cookie", "}", "will", "be", "removed", "when", "the", "*", "browser", "is", "closed", ".", "*", "*", "@", "param", "maxAge", "The", "maximum", "age", "of", "this", "{", "@", "link", "Cookie", "}", "in", "seconds", "*", "/", "void", "setMaxAge", "(", "long", "maxAge", ")", ";", "/", "**", "*", "Checks", "to", "see", "if", "this", "{", "@", "link", "Cookie", "}", "is", "secure", "*", "*", "@", "return", "True", "if", "this", "{", "@", "link", "Cookie", "}", "is", "secure", ",", "otherwise", "false", "*", "/", "boolean", "isSecure", "(", ");", "/", "**", "*", "Sets", "the", "security", "getStatus", "of", "this", "{", "@", "link", "Cookie", "}", "*", "*", "@", "param", "secure", "True", "if", "this", "{", "@", "link", "Cookie", "}", "is", "to", "be", "secure", ",", "otherwise", "false", "*", "/", "void", "setSecure", "(", "boolean", "secure", ")", ";", "/", "**", "*", "Checks", "to", "see", "if", "this", "{", "@", "link", "Cookie", "}", "can", "only", "be", "accessed", "via", "HTTP", ".", "*", "If", "this", "returns", "true", ",", "the", "{", "@", "link", "Cookie", "}", "cannot", "be", "accessed", "through", "*", "client", "side", "script", "-", "But", "only", "if", "the", "browser", "supports", "it", ".", "*", "For", "more", "information", ",", "please", "look", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "HTTPOnly", "\"", ">", "here", "<", "/", "a", ">", "*", "*", "@", "return", "True", "if", "this", "{", "@", "link", "Cookie", "}", "is", "HTTP", "-", "only", "or", "false", "if", "it", "isn", "'", "t", "*", "/", "boolean", "isHttpOnly", "(", ");", "/", "**", "*", "Determines", "if", "this", "{", "@", "link", "Cookie", "}", "is", "HTTP", "only", ".", "*", "If", "set", "to", "true", ",", "this", "{", "@", "link", "Cookie", "}", "cannot", "be", "accessed", "by", "a", "client", "*", "side", "script", ".", "However", ",", "this", "works", "only", "if", "the", "browser", "supports", "it", ".", "*", "For", "for", "information", ",", "please", "look", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "HTTPOnly", "\"", ">", "here", "<", "/", "a", ">", ".", "*", "*", "@", "param", "httpOnly", "True", "if", "the", "{", "@", "link", "Cookie", "}", "is", "HTTP", "only", ",", "otherwise", "false", ".", "*", "/", "void", "setHttpOnly", "(", "boolean", "httpOnly", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "84", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "firstInvalidCookieNameOctet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "firstInvalidCookieValueOctet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "unwrapValue", ";", "import", "java", ".", "nio", ".", "CharBuffer", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "logging", ".", "InternalLogger", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "logging", ".", "InternalLoggerFactory", ";", "/", "**", "*", "Parent", "of", "Client", "and", "Server", "side", "cookie", "decoders", "*", "/", "public", "abstract", "class", "CookieDecoder", "{", "private", "final", "InternalLogger", "logger", "=", "InternalLoggerFactory", ".", "getInstance", "(", "getClass", "(", "))", ";", "private", "final", "boolean", "strict", ";", "protected", "CookieDecoder", "(", "boolean", "strict", ")", "{", "this", ".", "strict", "=", "strict", ";", "}", "protected", "DefaultCookie", "initCookie", "(", "String", "header", ",", "int", "nameBegin", ",", "int", "nameEnd", ",", "int", "valueBegin", ",", "int", "valueEnd", ")", "{", "if", "(", "nameBegin", "=", "=", "-", "1", "|", "|", "nameBegin", "=", "=", "nameEnd", ")", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "with", "null", "name", "\"", ");", "return", "null", ";", "}", "if", "(", "valueBegin", "=", "=", "-", "1", ")", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "with", "null", "value", "\"", ");", "return", "null", ";", "}", "CharSequence", "wrappedValue", "=", "CharBuffer", ".", "wrap", "(", "header", ",", "valueBegin", ",", "valueEnd", ")", ";", "CharSequence", "unwrappedValue", "=", "unwrapValue", "(", "wrappedValue", ")", ";", "if", "(", "unwrappedValue", "=", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "because", "starting", "quotes", "are", "not", "properly", "balanced", "in", "'", "{}", "'\"", ",", "wrappedValue", ")", ";", "return", "null", ";", "}", "final", "String", "name", "=", "header", ".", "substring", "(", "nameBegin", ",", "nameEnd", ")", ";", "int", "invalidOctetPos", ";", "if", "(", "strict", "&", "&", "(", "invalidOctetPos", "=", "firstInvalidCookieNameOctet", "(", "name", ")", ")", ">", "=", "0", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "because", "name", "'", "{}", "'", "contains", "invalid", "char", "'", "{}", "'\"", ",", "name", ",", "name", ".", "charAt", "(", "invalidOctetPos", ")", ");", "}", "return", "null", ";", "}", "final", "boolean", "wrap", "=", "unwrappedValue", ".", "length", "(", ")", "!", "=", "valueEnd", "-", "valueBegin", ";", "if", "(", "strict", "&", "&", "(", "invalidOctetPos", "=", "firstInvalidCookieValueOctet", "(", "unwrappedValue", ")", ")", ">", "=", "0", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Skipping", "cookie", "because", "value", "'", "{}", "'", "contains", "invalid", "char", "'", "{}", "'\"", ",", "unwrappedValue", ",", "unwrappedValue", ".", "charAt", "(", "invalidOctetPos", ")", ");", "}", "return", "null", ";", "}", "DefaultCookie", "cookie", "=", "new", "DefaultCookie", "(", "name", ",", "unwrappedValue", ".", "toString", "(", "))", ";", "cookie", ".", "setWrap", "(", "wrap", ")", ";", "return", "cookie", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "51", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "firstInvalidCookieNameOctet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "firstInvalidCookieValueOctet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "unwrapValue", ";", "/", "**", "*", "Parent", "of", "Client", "and", "Server", "side", "cookie", "encoders", "*", "/", "public", "abstract", "class", "CookieEncoder", "{", "private", "final", "boolean", "strict", ";", "protected", "CookieEncoder", "(", "boolean", "strict", ")", "{", "this", ".", "strict", "=", "strict", ";", "}", "protected", "void", "validateCookie", "(", "String", "name", ",", "String", "value", ")", "{", "if", "(", "strict", ")", "{", "int", "pos", ";", "if", "(", "(", "pos", "=", "firstInvalidCookieNameOctet", "(", "name", ")", ")", ">", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cookie", "name", "contains", "an", "invalid", "char", ":", "\"", "+", "name", ".", "charAt", "(", "pos", ")", ");", "}", "CharSequence", "unwrappedValue", "=", "unwrapValue", "(", "value", ")", ";", "if", "(", "unwrappedValue", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cookie", "value", "wrapping", "quotes", "are", "not", "balanced", ":", "\"", "+", "value", ")", ";", "}", "if", "(", "(", "pos", "=", "firstInvalidCookieValueOctet", "(", "unwrappedValue", ")", ")", ">", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cookie", "value", "contains", "an", "invalid", "char", ":", "\"", "+", "value", ".", "charAt", "(", "pos", ")", ");", "}", "}", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "*", "Copyright", "2015", "The", "Netty", "Project", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "public", "final", "class", "CookieHeaderNames", "{", "public", "static", "final", "String", "PATH", "=", "\"", "Path", "\"", ";", "public", "static", "final", "String", "EXPIRES", "=", "\"", "Expires", "\"", ";", "public", "static", "final", "String", "MAX_AGE", "=", "\"", "Max", "-", "Age", "\"", ";", "public", "static", "final", "String", "DOMAIN", "=", "\"", "Domain", "\"", ";", "public", "static", "final", "String", "SECURE", "=", "\"", "Secure", "\"", ";", "public", "static", "final", "String", "HTTPONLY", "=", "\"", "HTTPOnly", "\"", ";", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpConstants", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "InternalThreadLocalMap", ";", "import", "java", ".", "util", ".", "BitSet", ";", "final", "class", "CookieUtil", "{", "private", "static", "final", "BitSet", "VALID_COOKIE_VALUE_OCTETS", "=", "validCookieValueOctets", "(", ");", "private", "static", "final", "BitSet", "VALID_COOKIE_NAME_OCTETS", "=", "validCookieNameOctets", "(", "VALID_COOKIE_VALUE_OCTETS", ")", ";", "/", "/", "US", "-", "ASCII", "characters", "excluding", "CTLs", ",", "whitespace", ",", "DQUOTE", ",", "comma", ",", "semicolon", ",", "and", "backslash", "private", "static", "BitSet", "validCookieValueOctets", "(", ")", "{", "BitSet", "bits", "=", "new", "BitSet", "(", "8", ")", ";", "for", "(", "int", "i", "=", "35", ";", "i", "<", "127", ";", "i", "+", "+)", "{", "/", "/", "US", "-", "ASCII", "characters", "excluding", "CTLs", "(", "%", "x00", "-", "1F", "/", "%", "x7F", ")", "bits", ".", "set", "(", "i", ")", ";", "}", "bits", ".", "set", "(", "'\"", "',", "false", ")", ";", "/", "/", "exclude", "DQUOTE", "=", "%", "x22", "bits", ".", "set", "(", "',", "',", "false", ")", ";", "/", "/", "exclude", "comma", "=", "%", "x2C", "bits", ".", "set", "(", "';", "',", "false", ")", ";", "/", "/", "exclude", "semicolon", "=", "%", "x3B", "bits", ".", "set", "(", "'\\", "\\'", ",", "false", ")", ";", "/", "/", "exclude", "backslash", "=", "%", "x5C", "return", "bits", ";", "}", "/", "/", "token", "=", "1", "*", "<", "any", "CHAR", "except", "CTLs", "or", "separators", ">", "/", "/", "separators", "=", "\"", "(\"", "|", "\"", ")\"", "|", "\"", "<\"", "|", "\"", ">\"", "|", "\"", "@\"", "/", "/", "|", "\"", ",\"", "|", "\"", ";\"", "|", "\"", ":\"", "|", "\"", "\\\"", "|", "<", "\">", "/", "/", "|", "\"", "/\"", "|", "\"", "[\"", "|", "\"", "]\"", "|", "\"", "?\"", "|", "\"", "=\"", "/", "/", "|", "\"", "{\"", "|", "\"", "}\"", "|", "SP", "|", "HT", "private", "static", "BitSet", "validCookieNameOctets", "(", "BitSet", "validCookieValueOctets", ")", "{", "BitSet", "bits", "=", "new", "BitSet", "(", "8", ")", ";", "bits", ".", "or", "(", "validCookieValueOctets", ")", ";", "bits", ".", "set", "(", "'(", "',", "false", ")", ";", "bits", ".", "set", "(", "')", "',", "false", ")", ";", "bits", ".", "set", "(", "'<", "',", "false", ")", ";", "bits", ".", "set", "(", "'>", "',", "false", ")", ";", "bits", ".", "set", "(", "'@", "',", "false", ")", ";", "bits", ".", "set", "(", "':", "',", "false", ")", ";", "bits", ".", "set", "(", "'/", "',", "false", ")", ";", "bits", ".", "set", "(", "'[", "',", "false", ")", ";", "bits", ".", "set", "(", "']", "',", "false", ")", ";", "bits", ".", "set", "(", "'?", "',", "false", ")", ";", "bits", ".", "set", "(", "'=", "',", "false", ")", ";", "bits", ".", "set", "(", "'{", "',", "false", ")", ";", "bits", ".", "set", "(", "'}", "',", "false", ")", ";", "bits", ".", "set", "(", "'", "'", ",", "false", ")", ";", "bits", ".", "set", "(", "'\\", "t", "'", ",", "false", ")", ";", "return", "bits", ";", "}", "static", "StringBuilder", "stringBuilder", "(", ")", "{", "return", "InternalThreadLocalMap", ".", "get", "(", ").", "stringBuilder", "(", ");", "}", "/", "**", "*", "@", "param", "buf", "a", "buffer", "where", "some", "cookies", "were", "maybe", "encoded", "*", "@", "return", "the", "buffer", "String", "without", "the", "trailing", "separator", ",", "or", "null", "if", "no", "cookie", "was", "appended", ".", "*", "/", "static", "String", "stripTrailingSeparatorOrNull", "(", "StringBuilder", "buf", ")", "{", "return", "buf", ".", "length", "(", ")", "=", "=", "0", "?", "null", ":", "stripTrailingSeparator", "(", "buf", ")", ";", "}", "static", "String", "stripTrailingSeparator", "(", "StringBuilder", "buf", ")", "{", "if", "(", "buf", ".", "length", "(", ")", ">", "0", ")", "{", "buf", ".", "setLength", "(", "buf", ".", "length", "(", ")", "-", "2", ")", ";", "}", "return", "buf", ".", "toString", "(", ");", "}", "static", "void", "add", "(", "StringBuilder", "sb", ",", "String", "name", ",", "long", "val", ")", "{", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "EQUALS", ")", ";", "sb", ".", "append", "(", "val", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "static", "void", "add", "(", "StringBuilder", "sb", ",", "String", "name", ",", "String", "val", ")", "{", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "EQUALS", ")", ";", "sb", ".", "append", "(", "val", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "static", "void", "add", "(", "StringBuilder", "sb", ",", "String", "name", ")", "{", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "static", "void", "addQuoted", "(", "StringBuilder", "sb", ",", "String", "name", ",", "String", "val", ")", "{", "if", "(", "val", "=", "=", "null", ")", "{", "val", "=", "\"", "\";", "}", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "EQUALS", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "DOUBLE_QUOTE", ")", ";", "sb", ".", "append", "(", "val", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "DOUBLE_QUOTE", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "static", "int", "firstInvalidCookieNameOctet", "(", "CharSequence", "cs", ")", "{", "return", "firstInvalidOctet", "(", "cs", ",", "VALID_COOKIE_NAME_OCTETS", ")", ";", "}", "static", "int", "firstInvalidCookieValueOctet", "(", "CharSequence", "cs", ")", "{", "return", "firstInvalidOctet", "(", "cs", ",", "VALID_COOKIE_VALUE_OCTETS", ")", ";", "}", "static", "int", "firstInvalidOctet", "(", "CharSequence", "cs", ",", "BitSet", "bits", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "cs", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "cs", ".", "charAt", "(", "i", ")", ";", "if", "(", "!", "bits", ".", "get", "(", "c", ")", ")", "{", "return", "i", ";", "}", "}", "return", "-", "1", ";", "}", "static", "CharSequence", "unwrapValue", "(", "CharSequence", "cs", ")", "{", "final", "int", "len", "=", "cs", ".", "length", "(", ");", "if", "(", "len", ">", "0", "&", "&", "cs", ".", "charAt", "(", "0", ")", "=", "=", "'", "\"'", ")", "{", "if", "(", "len", ">", "=", "2", "&", "&", "cs", ".", "charAt", "(", "len", "-", "1", ")", "=", "=", "'", "\"'", ")", "{", "/", "/", "properly", "balanced", "return", "len", "=", "=", "2", "?", "\"", "\"", ":", "cs", ".", "subSequence", "(", "1", ",", "len", "-", "1", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "return", "cs", ";", "}", "private", "CookieUtil", "(", ")", "{", "/", "/", "Unused", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "268", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "stringBuilder", ";", "import", "static", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ".", "checkNotNull", ";", "/", "**", "*", "The", "default", "{", "@", "link", "Cookie", "}", "implementation", ".", "*", "/", "public", "class", "DefaultCookie", "implements", "Cookie", "{", "private", "final", "String", "name", ";", "private", "String", "value", ";", "private", "boolean", "wrap", ";", "private", "String", "domain", ";", "private", "String", "path", ";", "private", "long", "maxAge", "=", "Long", ".", "MIN_VALUE", ";", "private", "boolean", "secure", ";", "private", "boolean", "httpOnly", ";", "/", "**", "*", "Creates", "a", "new", "cookie", "with", "the", "specified", "name", "and", "value", ".", "*", "/", "public", "DefaultCookie", "(", "String", "name", ",", "String", "value", ")", "{", "name", "=", "checkNotNull", "(", "name", ",", "\"", "name", "\"", ").", "trim", "(", ");", "if", "(", "name", ".", "isEmpty", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "empty", "name", "\"", ");", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "name", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "name", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", ">", "127", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "name", "contains", "non", "-", "ascii", "character", ":", "\"", "+", "name", ")", ";", "}", "/", "/", "Check", "prohibited", "characters", ".", "switch", "(", "c", ")", "{", "case", "'", "\\", "t", "'", ":", "case", "'", "\\", "n", "'", ":", "case", "0x0b", ":", "case", "'", "\\", "f", "'", ":", "case", "'", "\\", "r", "'", ":", "case", "'", "'", ":", "case", "'", ",'", ":", "case", "'", ";'", ":", "case", "'", "='", ":", "throw", "new", "IllegalArgumentException", "(", "\"", "name", "contains", "one", "of", "the", "following", "prohibited", "characters", ":", "\"", "\"", "=,", ";", "\\", "\\", "t", "\\", "\\", "r", "\\", "\\", "n", "\\", "\\", "v", "\\", "\\", "f", ":", "\"", "+", "name", ")", ";", "}", "}", "if", "(", "name", ".", "charAt", "(", "0", ")", "=", "=", "'", "$'", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "name", "starting", "with", "'", "$'", "not", "allowed", ":", "\"", "+", "name", ")", ";", "}", "this", ".", "name", "=", "name", ";", "setValue", "(", "value", ")", ";", "}", "@", "Override", "public", "String", "name", "(", ")", "{", "return", "name", ";", "}", "@", "Override", "public", "String", "value", "(", ")", "{", "return", "value", ";", "}", "@", "Override", "public", "void", "setValue", "(", "String", "value", ")", "{", "this", ".", "value", "=", "checkNotNull", "(", "value", ",", "\"", "value", "\"", ");", "}", "@", "Override", "public", "boolean", "wrap", "(", ")", "{", "return", "wrap", ";", "}", "@", "Override", "public", "void", "setWrap", "(", "boolean", "wrap", ")", "{", "this", ".", "wrap", "=", "wrap", ";", "}", "@", "Override", "public", "String", "domain", "(", ")", "{", "return", "domain", ";", "}", "@", "Override", "public", "void", "setDomain", "(", "String", "domain", ")", "{", "this", ".", "domain", "=", "validateValue", "(", "\"", "domain", "\"", ",", "domain", ")", ";", "}", "@", "Override", "public", "String", "path", "(", ")", "{", "return", "path", ";", "}", "@", "Override", "public", "void", "setPath", "(", "String", "path", ")", "{", "this", ".", "path", "=", "validateValue", "(", "\"", "path", "\"", ",", "path", ")", ";", "}", "@", "Override", "public", "long", "maxAge", "(", ")", "{", "return", "maxAge", ";", "}", "@", "Override", "public", "void", "setMaxAge", "(", "long", "maxAge", ")", "{", "this", ".", "maxAge", "=", "maxAge", ";", "}", "@", "Override", "public", "boolean", "isSecure", "(", ")", "{", "return", "secure", ";", "}", "@", "Override", "public", "void", "setSecure", "(", "boolean", "secure", ")", "{", "this", ".", "secure", "=", "secure", ";", "}", "@", "Override", "public", "boolean", "isHttpOnly", "(", ")", "{", "return", "httpOnly", ";", "}", "@", "Override", "public", "void", "setHttpOnly", "(", "boolean", "httpOnly", ")", "{", "this", ".", "httpOnly", "=", "httpOnly", ";", "}", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "name", "(", ").", "hashCode", "(", ");", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "{", "return", "true", ";", "}", "if", "(", "!(", "o", "instanceof", "Cookie", ")", ")", "{", "return", "false", ";", "}", "Cookie", "that", "=", "(", "Cookie", ")", "o", ";", "if", "(", "!", "name", "(", ").", "equalsIgnoreCase", "(", "that", ".", "name", "(", "))", ")", "{", "return", "false", ";", "}", "if", "(", "path", "(", ")", "=", "=", "null", ")", "{", "if", "(", "that", ".", "path", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "that", ".", "path", "(", ")", "=", "=", "null", ")", "{", "return", "false", ";", "}", "else", "if", "(", "!", "path", "(", ").", "equals", "(", "that", ".", "path", "(", "))", ")", "{", "return", "false", ";", "}", "if", "(", "domain", "(", ")", "=", "=", "null", ")", "{", "if", "(", "that", ".", "domain", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "that", ".", "domain", "(", ")", "=", "=", "null", ")", "{", "return", "false", ";", "}", "else", "{", "return", "domain", "(", ").", "equalsIgnoreCase", "(", "that", ".", "domain", "(", "))", ";", "}", "return", "true", ";", "}", "@", "Override", "public", "int", "compareTo", "(", "Cookie", "c", ")", "{", "int", "v", "=", "name", "(", ").", "compareToIgnoreCase", "(", "c", ".", "name", "(", "))", ";", "if", "(", "v", "!", "=", "0", ")", "{", "return", "v", ";", "}", "if", "(", "path", "(", ")", "=", "=", "null", ")", "{", "if", "(", "c", ".", "path", "(", ")", "!", "=", "null", ")", "{", "return", "-", "1", ";", "}", "}", "else", "if", "(", "c", ".", "path", "(", ")", "=", "=", "null", ")", "{", "return", "1", ";", "}", "else", "{", "v", "=", "path", "(", ").", "compareTo", "(", "c", ".", "path", "(", "))", ";", "if", "(", "v", "!", "=", "0", ")", "{", "return", "v", ";", "}", "}", "if", "(", "domain", "(", ")", "=", "=", "null", ")", "{", "if", "(", "c", ".", "domain", "(", ")", "!", "=", "null", ")", "{", "return", "-", "1", ";", "}", "}", "else", "if", "(", "c", ".", "domain", "(", ")", "=", "=", "null", ")", "{", "return", "1", ";", "}", "else", "{", "v", "=", "domain", "(", ").", "compareToIgnoreCase", "(", "c", ".", "domain", "(", "))", ";", "return", "v", ";", "}", "return", "0", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "StringBuilder", "buf", "=", "stringBuilder", "(", ")", ".", "append", "(", "name", "(", "))", ".", "append", "(", "'=", "')", ".", "append", "(", "value", "(", "))", ";", "if", "(", "domain", "(", ")", "!", "=", "null", ")", "{", "buf", ".", "append", "(", "\",", "domain", "=", "\")", ".", "append", "(", "domain", "(", "))", ";", "}", "if", "(", "path", "(", ")", "!", "=", "null", ")", "{", "buf", ".", "append", "(", "\",", "path", "=", "\")", ".", "append", "(", "path", "(", "))", ";", "}", "if", "(", "maxAge", "(", ")", ">", "=", "0", ")", "{", "buf", ".", "append", "(", "\",", "maxAge", "=", "\")", ".", "append", "(", "maxAge", "(", "))", ".", "append", "(", "'", "s", "'", ");", "}", "if", "(", "isSecure", "(", "))", "{", "buf", ".", "append", "(", "\",", "secure", "\"", ");", "}", "if", "(", "isHttpOnly", "(", "))", "{", "buf", ".", "append", "(", "\",", "HTTPOnly", "\"", ");", "}", "return", "buf", ".", "toString", "(", ");", "}", "protected", "String", "validateValue", "(", "String", "name", ",", "String", "value", ")", "{", "if", "(", "value", "=", "=", "null", ")", "{", "return", "null", ";", "}", "value", "=", "value", ".", "trim", "(", ");", "if", "(", "value", ".", "isEmpty", "(", "))", "{", "return", "null", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "value", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "value", ".", "charAt", "(", "i", ")", ";", "switch", "(", "c", ")", "{", "case", "'", "\\", "r", "'", ":", "case", "'", "\\", "n", "'", ":", "case", "'", "\\", "f", "'", ":", "case", "0x0b", ":", "case", "'", ";'", ":", "throw", "new", "IllegalArgumentException", "(", "name", "+", "\"", "contains", "one", "of", "the", "following", "prohibited", "characters", ":", "\"", "\"", ";\\", "\\", "r", "\\", "\\", "n", "\\", "\\", "f", "\\", "\\", "v", "(", "\"", "+", "value", "+", "'", ")'", ");", "}", "}", "return", "value", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "157", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ".", "checkNotNull", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "/", "**", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "tools", ".", "ietf", ".", "org", "/", "html", "/", "rfc6265", "\"", ">", "RFC6265", "<", "/", "a", ">", "compliant", "cookie", "decoder", "to", "be", "used", "server", "side", ".", "*", "*", "Only", "name", "and", "value", "fields", "are", "expected", ",", "so", "old", "fields", "are", "not", "populated", "(", "path", ",", "domain", ",", "etc", ")", ".", "*", "*", "Old", "<", "a", "href", "=", "\"", "http", ":", "//", "tools", ".", "ietf", ".", "org", "/", "html", "/", "rfc2965", "\"", ">", "RFC2965", "<", "/", "a", ">", "cookies", "are", "still", "supported", ",", "*", "old", "fields", "will", "simply", "be", "ignored", ".", "*", "*", "@", "see", "ServerCookieEncoder", "*", "/", "public", "final", "class", "ServerCookieDecoder", "extends", "CookieDecoder", "{", "private", "static", "final", "String", "RFC2965_VERSION", "=", "\"", "$", "Version", "\"", ";", "private", "static", "final", "String", "RFC2965_PATH", "=", "\"", "$\"", "+", "CookieHeaderNames", ".", "PATH", ";", "private", "static", "final", "String", "RFC2965_DOMAIN", "=", "\"", "$\"", "+", "CookieHeaderNames", ".", "DOMAIN", ";", "private", "static", "final", "String", "RFC2965_PORT", "=", "\"", "$", "Port", "\"", ";", "/", "**", "*", "Strict", "encoder", "that", "validates", "that", "name", "and", "value", "chars", "are", "in", "the", "valid", "scope", "*", "defined", "in", "RFC6265", "*", "/", "public", "static", "final", "ServerCookieDecoder", "STRICT", "=", "new", "ServerCookieDecoder", "(", "true", ")", ";", "/", "**", "*", "Lax", "instance", "that", "doesn", "'", "t", "validate", "name", "and", "value", "*", "/", "public", "static", "final", "ServerCookieDecoder", "LAX", "=", "new", "ServerCookieDecoder", "(", "false", ")", ";", "private", "ServerCookieDecoder", "(", "boolean", "strict", ")", "{", "super", "(", "strict", ")", ";", "}", "/", "**", "*", "Decodes", "the", "specified", "Set", "-", "Cookie", "HTTP", "header", "value", "into", "a", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "the", "decoded", "{", "@", "link", "Cookie", "}", "*", "/", "public", "Set", "<", "Cookie", ">", "decode", "(", "String", "header", ")", "{", "final", "int", "headerLen", "=", "checkNotNull", "(", "header", ",", "\"", "header", "\"", ").", "length", "(", ");", "if", "(", "headerLen", "=", "=", "0", ")", "{", "return", "Collections", ".", "emptySet", "(", ");", "}", "Set", "<", "Cookie", ">", "cookies", "=", "new", "TreeSet", "<", "Cookie", ">", "()", ";", "int", "i", "=", "0", ";", "boolean", "rfc2965Style", "=", "false", ";", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "0", ",", "RFC2965_VERSION", ",", "0", ",", "RFC2965_VERSION", ".", "length", "(", "))", ")", "{", "/", "/", "RFC", "2965", "style", "cookie", ",", "move", "to", "after", "version", "value", "i", "=", "header", ".", "indexOf", "(", "';", "')", "+", "1", ";", "rfc2965Style", "=", "true", ";", "}", "loop", ":", "for", "(", ";;", ")", "{", "/", "/", "Skip", "spaces", "and", "separators", ".", "for", "(", ";;", ")", "{", "if", "(", "i", "=", "=", "headerLen", ")", "{", "break", "loop", ";", "}", "char", "c", "=", "header", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", "=", "=", "'", "\\", "t", "'", "|", "|", "c", "=", "=", "'", "\\", "n", "'", "|", "|", "c", "=", "=", "0x0b", "|", "|", "c", "=", "=", "'", "\\", "f", "'", "|", "|", "c", "=", "=", "'", "\\", "r", "'", "|", "|", "c", "=", "=", "'", "'", "|", "|", "c", "=", "=", "'", ",'", "|", "|", "c", "=", "=", "'", ";'", ")", "{", "i", "+", "+;", "continue", ";", "}", "break", ";", "}", "int", "nameBegin", "=", "i", ";", "int", "nameEnd", "=", "i", ";", "int", "valueBegin", "=", "-", "1", ";", "int", "valueEnd", "=", "-", "1", ";", "if", "(", "i", "!", "=", "headerLen", ")", "{", "keyValLoop", ":", "for", "(", ";;", ")", "{", "char", "curChar", "=", "header", ".", "charAt", "(", "i", ")", ";", "if", "(", "curChar", "=", "=", "'", ";'", ")", "{", "/", "/", "NAME", ";", "(", "no", "value", "till", "'", ";'", ")", "nameEnd", "=", "i", ";", "valueBegin", "=", "valueEnd", "=", "-", "1", ";", "break", "keyValLoop", ";", "}", "else", "if", "(", "curChar", "=", "=", "'", "='", ")", "{", "/", "/", "NAME", "=", "VALUE", "nameEnd", "=", "i", ";", "i", "+", "+;", "if", "(", "i", "=", "=", "headerLen", ")", "{", "/", "/", "NAME", "=", "(", "empty", "value", ",", "i", ".", "e", ".", "nothing", "after", "'", "='", ")", "valueBegin", "=", "valueEnd", "=", "0", ";", "break", "keyValLoop", ";", "}", "valueBegin", "=", "i", ";", "/", "/", "NAME", "=", "VALUE", ";", "int", "semiPos", "=", "header", ".", "indexOf", "(", "';", "',", "i", ")", ";", "valueEnd", "=", "i", "=", "semiPos", ">", "0", "?", "semiPos", ":", "headerLen", ";", "break", "keyValLoop", ";", "}", "else", "{", "i", "+", "+;", "}", "if", "(", "i", "=", "=", "headerLen", ")", "{", "/", "/", "NAME", "(", "no", "value", "till", "the", "end", "of", "string", ")", "nameEnd", "=", "headerLen", ";", "valueBegin", "=", "valueEnd", "=", "-", "1", ";", "break", ";", "}", "}", "}", "if", "(", "rfc2965Style", "&", "&", "(", "header", ".", "regionMatches", "(", "nameBegin", ",", "RFC2965_PATH", ",", "0", ",", "RFC2965_PATH", ".", "length", "(", "))", "|", "|", "header", ".", "regionMatches", "(", "nameBegin", ",", "RFC2965_DOMAIN", ",", "0", ",", "RFC2965_DOMAIN", ".", "length", "(", "))", "|", "|", "header", ".", "regionMatches", "(", "nameBegin", ",", "RFC2965_PORT", ",", "0", ",", "RFC2965_PORT", ".", "length", "(", "))", "))", "{", "/", "/", "skip", "obsolete", "RFC2965", "fields", "continue", ";", "}", "DefaultCookie", "cookie", "=", "initCookie", "(", "header", ",", "nameBegin", ",", "nameEnd", ",", "valueBegin", ",", "valueEnd", ")", ";", "if", "(", "cookie", "!", "=", "null", ")", "{", "cookies", ".", "add", "(", "cookie", ")", ";", "}", "}", "return", "cookies", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "179", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "CookieUtil", ".", "*;", "import", "static", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ".", "checkNotNull", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpHeaderDateFormat", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpRequest", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "tools", ".", "ietf", ".", "org", "/", "html", "/", "rfc6265", "\"", ">", "RFC6265", "<", "/", "a", ">", "compliant", "cookie", "encoder", "to", "be", "used", "server", "side", ",", "*", "so", "some", "fields", "are", "sent", "(", "Version", "is", "typically", "ignored", ")", ".", "*", "*", "As", "Netty", "'", "s", "Cookie", "merges", "Expires", "and", "MaxAge", "into", "one", "single", "field", ",", "only", "Max", "-", "Age", "field", "is", "sent", ".", "*", "*", "Note", "that", "multiple", "cookies", "are", "supposed", "to", "be", "sent", "at", "once", "in", "a", "single", "\"", "Set", "-", "Cookie", "\"", "header", ".", "*", "*", "<", "pre", ">", "*", "/", "/", "Example", "*", "{", "@", "link", "HttpRequest", "}", "req", "=", ".", "..", ";", "*", "res", ".", "setHeader", "(", "\"", "Cookie", "\"", ",", "{", "@", "link", "ServerCookieEncoder", "}", ".", "encode", "(", "\"", "JSESSIONID", "\"", ",", "\"", "1234", "\"", "))", ";", "*", "<", "/", "pre", ">", "*", "*", "@", "see", "ServerCookieDecoder", "*", "/", "public", "final", "class", "ServerCookieEncoder", "extends", "CookieEncoder", "{", "/", "**", "*", "Strict", "encoder", "that", "validates", "that", "name", "and", "value", "chars", "are", "in", "the", "valid", "scope", "*", "defined", "in", "RFC6265", "*", "/", "public", "static", "final", "ServerCookieEncoder", "STRICT", "=", "new", "ServerCookieEncoder", "(", "true", ")", ";", "/", "**", "*", "Lax", "instance", "that", "doesn", "'", "t", "validate", "name", "and", "value", "*", "/", "public", "static", "final", "ServerCookieEncoder", "LAX", "=", "new", "ServerCookieEncoder", "(", "false", ")", ";", "private", "ServerCookieEncoder", "(", "boolean", "strict", ")", "{", "super", "(", "strict", ")", ";", "}", "/", "**", "*", "Encodes", "the", "specified", "cookie", "name", "-", "value", "pair", "into", "a", "Set", "-", "Cookie", "header", "value", ".", "*", "*", "@", "param", "name", "the", "cookie", "name", "*", "@", "param", "value", "the", "cookie", "value", "*", "@", "return", "a", "single", "Set", "-", "Cookie", "header", "value", "*", "/", "public", "String", "encode", "(", "String", "name", ",", "String", "value", ")", "{", "return", "encode", "(", "new", "DefaultCookie", "(", "name", ",", "value", ")", ");", "}", "/", "**", "*", "Encodes", "the", "specified", "cookie", "into", "a", "Set", "-", "Cookie", "header", "value", ".", "*", "*", "@", "param", "cookie", "the", "cookie", "*", "@", "return", "a", "single", "Set", "-", "Cookie", "header", "value", "*", "/", "public", "String", "encode", "(", "Cookie", "cookie", ")", "{", "final", "String", "name", "=", "checkNotNull", "(", "cookie", ",", "\"", "cookie", "\"", ").", "name", "(", ");", "final", "String", "value", "=", "cookie", ".", "value", "(", ")", "!", "=", "null", "?", "cookie", ".", "value", "(", ")", ":", "\"", "\";", "validateCookie", "(", "name", ",", "value", ")", ";", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "if", "(", "cookie", ".", "wrap", "(", "))", "{", "addQuoted", "(", "buf", ",", "name", ",", "value", ")", ";", "}", "else", "{", "add", "(", "buf", ",", "name", ",", "value", ")", ";", "}", "if", "(", "cookie", ".", "maxAge", "(", ")", "!", "=", "Long", ".", "MIN_VALUE", ")", "{", "add", "(", "buf", ",", "CookieHeaderNames", ".", "MAX_AGE", ",", "cookie", ".", "maxAge", "(", "))", ";", "Date", "expires", "=", "new", "Date", "(", "cookie", ".", "maxAge", "(", ")", "*", "1000", "+", "System", ".", "currentTimeMillis", "(", "))", ";", "add", "(", "buf", ",", "CookieHeaderNames", ".", "EXPIRES", ",", "HttpHeaderDateFormat", ".", "get", "(", ").", "format", "(", "expires", ")", ");", "}", "if", "(", "cookie", ".", "path", "(", ")", "!", "=", "null", ")", "{", "add", "(", "buf", ",", "CookieHeaderNames", ".", "PATH", ",", "cookie", ".", "path", "(", "))", ";", "}", "if", "(", "cookie", ".", "domain", "(", ")", "!", "=", "null", ")", "{", "add", "(", "buf", ",", "CookieHeaderNames", ".", "DOMAIN", ",", "cookie", ".", "domain", "(", "))", ";", "}", "if", "(", "cookie", ".", "isSecure", "(", "))", "{", "add", "(", "buf", ",", "CookieHeaderNames", ".", "SECURE", ")", ";", "}", "if", "(", "cookie", ".", "isHttpOnly", "(", "))", "{", "add", "(", "buf", ",", "CookieHeaderNames", ".", "HTTPONLY", ")", ";", "}", "return", "stripTrailingSeparator", "(", "buf", ")", ";", "}", "/", "**", "*", "Batch", "encodes", "cookies", "into", "Set", "-", "Cookie", "header", "values", ".", "*", "*", "@", "param", "cookies", "a", "bunch", "of", "cookies", "*", "@", "return", "the", "corresponding", "bunch", "of", "Set", "-", "Cookie", "headers", "*", "/", "public", "List", "<", "String", ">", "encode", "(", "Cookie", ".", "..", "cookies", ")", "{", "if", "(", "checkNotNull", "(", "cookies", ",", "\"", "cookies", "\"", ").", "length", "=", "=", "0", ")", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "encoded", "=", "new", "ArrayList", "<", "String", ">", "(", "cookies", ".", "length", ")", ";", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encoded", ".", "add", "(", "encode", "(", "c", ")", ");", "}", "return", "encoded", ";", "}", "/", "**", "*", "Batch", "encodes", "cookies", "into", "Set", "-", "Cookie", "header", "values", ".", "*", "*", "@", "param", "cookies", "a", "bunch", "of", "cookies", "*", "@", "return", "the", "corresponding", "bunch", "of", "Set", "-", "Cookie", "headers", "*", "/", "public", "List", "<", "String", ">", "encode", "(", "Collection", "<", "?", "extends", "Cookie", ">", "cookies", ")", "{", "if", "(", "checkNotNull", "(", "cookies", ",", "\"", "cookies", "\"", ").", "isEmpty", "(", "))", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "encoded", "=", "new", "ArrayList", "<", "String", ">", "(", "cookies", ".", "size", "(", "))", ";", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encoded", ".", "add", "(", "encode", "(", "c", ")", ");", "}", "return", "encoded", ";", "}", "/", "**", "*", "Batch", "encodes", "cookies", "into", "Set", "-", "Cookie", "header", "values", ".", "*", "*", "@", "param", "cookies", "a", "bunch", "of", "cookies", "*", "@", "return", "the", "corresponding", "bunch", "of", "Set", "-", "Cookie", "headers", "*", "/", "public", "List", "<", "String", ">", "encode", "(", "Iterable", "<", "?", "extends", "Cookie", ">", "cookies", ")", "{", "if", "(", "!", "checkNotNull", "(", "cookies", ",", "\"", "cookies", "\"", ").", "iterator", "(", ").", "hasNext", "(", "))", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "encoded", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encoded", ".", "add", "(", "encode", "(", "c", ")", ");", "}", "return", "encoded", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "20", "@", "@", "/", "*", "*", "Copyright", "2015", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "/", "**", "*", "This", "package", "contains", "Cookie", "related", "classes", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "@", "@", "-", "1", ",", "228", "+", "0", ",", "0", "@", "@", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpHeaderDateFormat", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "+", "\"", ";", "secure", ";", "comment", "=", "this", "is", "a", "comment", ";", "version", "=", "1", ";", "\";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "+", "\"", "domain", "=", ".", "adomainsomewhere", ";", "secure", ";", "comment", "=", "this", "is", "a", "comment", ";", "version", "=", "1", ";", "\"", "+", "\"", "commentURL", "=", "http", ":", "//", "aurl", ".", "com", ";", "port", "=", "'", "80", ",", "8080", "'", ";", "discard", ";", "\";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "+", "\"", "domain", "=", ".", "adomainsomewhere", ";", "secure", ";", "comment", "=", "this", "is", "a", "comment", ";", "version", "=", "2", ";", "\"", "+", "\"", "commentURL", "=", "http", ":", "//", "aurl", ".", "com", ";", "port", "=", "\\\"", "80", ",", "8080", "\\", "\";", "discard", ";", "\";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "+", "\"", "domain", "=", ".", "adomainsomewhere", ";", "secure", ";", "comment", "=", "this", "is", "a", "comment", ";", "version", "=", "2", ";", "\"", "+", "\"", "commentURL", "=", "\\\"", "http", ":", "//", "aurl", ".", "com", "\\", "\";", "port", "=", "'", "80", ",", "8080", "'", ";", "discard", ";", "\";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "c1", ")", ";", "cookies", ".", "add", "(", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "source", ")", ");", "+", "\"", "__utmb", "=", "48461872", ".", "13", ".", "10", ".", "1258140131", ";", "__utmc", "=", "48461872", ";", "\"", "+", "\"", "__utmz", "=", "48461872", ".", "1258140131", ".", "1", ".", "1", ".", "utmcsr", "=", "overstock", ".", "com", "|", "utmccn", "=", "(", "referral", ")", "|\"", "+", "\"", "utmcmd", "=", "referral", "|", "utmcct", "=", "/", "Home", "-", "Garden", "/", "Furniture", "/", "Clearance", ",", "/", "clearance", ",", "/", "32", "/", "dept", ".", "html", "\"", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "source", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "source", ")", ";", "public", "void", "testDecodingValueWithCommaFails", "(", ")", "{", "+", "\"", "expires", "=", "Sat", ",", "01", "-", "Dec", "-", "2012", "10", ":", "53", ":", "31", "GMT", ";", "path", "=", "/\"", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "source", ")", ";", "assertNull", "(", "cookie", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "src", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "src", ")", ";", "public", "void", "testDecodingValuesWithCommasAndEqualsFails", "(", ")", "{", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "src", ")", ";", "assertNull", "(", "cookie", ")", ";", "String", "longValue", "=", "\"", "b___", "$", "Q__", "$", "ha__", "<", "NC", "=", "MN", "(", "F__", "%", "#", "4__", "<", "NC", "=", "MN", "(", "F__2_d____", "#", "=", "IvZB__2_F____", "'", "=", "KqtH__2", "-", "9____", "\"", "\"", "'=", "IvZM__3f", ":", "____", "$", "=", "HbQW__3g", "'", "____", "%", "=", "J", "^", "wI__3g", "-", "____", "%", "=", "J", "^", "wI__3g1____", "$", "=", "HbQW__3g2____", "\"", "\"", "$=", "HbQW__3g5____", "%", "=", "J", "^", "wI__3g9____", "$", "=", "HbQW__3gT____", "$", "=", "HbQW__3gX____", "#", "=", "J", "^", "wI__3gY____", "\"", "\"", "#=", "J", "^", "wI__3gh____", "$", "=", "HbQW__3gj____", "$", "=", "HbQW__3gr____", "$", "=", "HbQW__3gx____", "#", "=", "J", "^", "wI__3h_____", "\"", "\"", "$=", "HbQW__3h", "$", "____", "#", "=", "J", "^", "wI__3h", "'", "____", "$", "=", "HbQW__3h_____", "$", "=", "HbQW__3h0____", "%", "=", "J", "^", "wI__3h1____", "\"", "\"", "#=", "J", "^", "wI__3h2____", "$", "=", "HbQW__3h4____", "$", "=", "HbQW__3h7____", "$", "=", "HbQW__3h8____", "%", "=", "J", "^", "wI__3h", ":", "____", "\"", "\"", "#=", "J", "^", "wI__3h", "@", "____", "%", "=", "J", "^", "wI__3hB____", "$", "=", "HbQW__3hC____", "$", "=", "HbQW__3hL____", "$", "=", "HbQW__3hQ____", "\"", "\"", "$=", "HbQW__3hS____", "%", "=", "J", "^", "wI__3hU____", "$", "=", "HbQW__3h", "[", "____", "$", "=", "HbQW__3h", "^", "____", "$", "=", "HbQW__3hd____", "\"", "\"", "%=", "J", "^", "wI__3he____", "%", "=", "J", "^", "wI__3hf____", "%", "=", "J", "^", "wI__3hg____", "$", "=", "HbQW__3hh____", "%", "=", "J", "^", "wI__3hi____", "\"", "\"", "%=", "J", "^", "wI__3hv____", "$", "=", "HbQW__3i", "/", "____", "#", "=", "J", "^", "wI__3i2____", "#", "=", "J", "^", "wI__3i3____", "%", "=", "J", "^", "wI__3i4____", "\"", "\"", "$=", "HbQW__3i7____", "$", "=", "HbQW__3i8____", "$", "=", "HbQW__3i9____", "%", "=", "J", "^", "wI__3i", "=", "____", "#", "=", "J", "^", "wI__3i", ">", "____", "\"", "\"", "%=", "J", "^", "wI__3iD____", "$", "=", "HbQW__3iF____", "#", "=", "J", "^", "wI__3iH____", "%", "=", "J", "^", "wI__3iM____", "%", "=", "J", "^", "wI__3iS____", "\"", "\"", "#=", "J", "^", "wI__3iU____", "%", "=", "J", "^", "wI__3iZ____", "#", "=", "J", "^", "wI__3i", "]", "____", "%", "=", "J", "^", "wI__3ig____", "%", "=", "J", "^", "wI__3ij____", "\"", "\"", "%=", "J", "^", "wI__3ik____", "#", "=", "J", "^", "wI__3il____", "$", "=", "HbQW__3in____", "%", "=", "J", "^", "wI__3ip____", "$", "=", "HbQW__3iq____", "\"", "\"", "$=", "HbQW__3it____", "%", "=", "J", "^", "wI__3ix____", "#", "=", "J", "^", "wI__3j_____", "$", "=", "HbQW__3j", "%", "____", "$", "=", "HbQW__3j", "'", "____", "\"", "\"", "%=", "J", "^", "wI__3j", "(", "____", "%", "=", "J", "^", "wI__9mJ____", "'", "=", "KqtH__", "=", "SE__", "<", "NC", "=", "MN", "(", "F__", "?", "VS__", "<", "NC", "=", "MN", "(", "F__Zw", "`", "____", "\"", "\"", "%=", "KqtH__j", "+", "C__", "<", "NC", "=", "MN", "(", "F__j", "+", "M__", "<", "NC", "=", "MN", "(", "F__j", "+", "a__", "<", "NC", "=", "MN", "(", "F__j_", ".", "__", "<", "NC", "=", "MN", "(", "F__n", ">", "M____", "\"", "\"", "'=", "KqtH__s1X____", "$", "=", "MMyc__s1_____", "#", "=", "MN", "#", "O__ypn____", "'", "=", "KqtH__ypr____", "'", "=", "KqtH_", "#", "%", "h_____", "\"", "\"", "%=", "KqtH_", "#", "%", "o_____", "'", "=", "KqtH_", "#", ")", "H6__", "<", "NC", "=", "MN", "(", "F_", "#", "*%", "'", "____", "%", "=", "KqtH_", "#", "+", "k", "(", "____", "'", "=", "KqtH_", "#", "-", "E_____", "\"", "\"", "'=", "KqtH_", "#", "1", ")", "w____", "'", "=", "KqtH_", "#", "1", ")", "y____", "'", "=", "KqtH_", "#", "1", "*", "M____", "#", "=", "KqtH_", "#", "1", "*", "p____", "'", "=", "KqtH_", "#", "14Q__", "<", "N", "\"", "\"", "C", "=", "MN", "(", "F_", "#", "14S__", "<", "NC", "=", "MN", "(", "F_", "#", "16I__", "<", "NC", "=", "MN", "(", "F_", "#", "16N__", "<", "NC", "=", "MN", "(", "F_", "#", "16X__", "<", "NC", "=", "MN", "(", "F_", "#", "16k__", "<", "N", "\"", "\"", "C", "=", "MN", "(", "F_", "#", "17", "@", "__", "<", "NC", "=", "MN", "(", "F_", "#", "17A__", "<", "NC", "=", "MN", "(", "F_", "#", "1Cq____", "'", "=", "KqtH_", "#", "7", ")", "_____", "#", "=", "KqtH_", "#", "7", ")", "b____", "\"", "\"", "#=", "KqtH_", "#", "7Ww____", "'", "=", "KqtH_", "#", "?", "cQ____", "'", "=", "KqtH_", "#", "His____", "'", "=", "KqtH_", "#", "Jrh____", "'", "=", "KqtH_", "#", "O", "@", "M__", "<", "N", "\"", "\"", "C", "=", "MN", "(", "F_", "#", "O", "@", "O__", "<", "NC", "=", "MN", "(", "F_", "#", "OC6__", "<", "NC", "=", "MN", "(", "F_", "#", "Os", ".", "____", "#", "=", "KqtH_", "#", "YOW____", "#", "=", "H", "/", "Li_", "#", "Zat____", "\"", "\"", "'=", "KqtH_", "#", "ZbI____", "%", "=", "KqtH_", "#", "Zbc____", "'", "=", "KqtH_", "#", "Zbs____", "%", "=", "KqtH_", "#", "Zby____", "'", "=", "KqtH_", "#", "Zce____", "\"", "\"", "'=", "KqtH_", "#", "Zdc____", "%", "=", "KqtH_", "#", "Zea____", "'", "=", "KqtH_", "#", "ZhI____", "#", "=", "KqtH_", "#", "ZiD____", "'", "=", "KqtH_", "#", "Zis____", "\"", "\"", "'=", "KqtH_", "#", "Zj0____", "#", "=", "KqtH_", "#", "Zj1____", "'", "=", "KqtH_", "#", "Zj", "[", "____", "'", "=", "KqtH_", "#", "Zj", "]", "____", "'", "=", "KqtH_", "#", "Zj", "^", "____", "\"", "\"", "'=", "KqtH_", "#", "Zjb____", "'", "=", "KqtH_", "#", "Zk_____", "'", "=", "KqtH_", "#", "Zk6____", "#", "=", "KqtH_", "#", "Zk9____", "%", "=", "KqtH_", "#", "Zk", "<", "____", "\"", "\"", "'=", "KqtH_", "#", "Zl", ">", "____", "'", "=", "KqtH_", "#", "]", "9R____", "$", "=", "H", "/", "Lt_", "#", "]", "I6____", "#", "=", "KqtH_", "#", "]", "Z", "#", "____", "%", "=", "KqtH_", "#", "^*", "N____", "\"", "\"", "#=", "KqtH_", "#", "^:", "m____", "#", "=", "KqtH_", "#", "_", "*", "_____", "%", "=", "J", "^", "wI_", "#", "`-", "7____", "#", "=", "KqtH_", "#", "`", "T", ">", "____", "'", "=", "KqtH_", "#", "`", "T", "?", "____", "\"", "\"", "'=", "KqtH_", "#", "`", "TA____", "'", "=", "KqtH_", "#", "`", "TB____", "'", "=", "KqtH_", "#", "`", "TG____", "'", "=", "KqtH_", "#", "`", "TP____", "#", "=", "KqtH_", "#", "`", "U_____", "\"", "\"", "'=", "KqtH_", "#", "`", "U", "/", "____", "'", "=", "KqtH_", "#", "`", "U0____", "#", "=", "KqtH_", "#", "`", "U9____", "'", "=", "KqtH_", "#", "aEQ____", "%", "=", "KqtH_", "#", "b", "<", ")", "____", "\"", "\"", "'=", "KqtH_", "#", "c9", "-", "____", "%", "=", "KqtH_", "#", "dxC____", "%", "=", "KqtH_", "#", "dxE____", "%", "=", "KqtH_", "#", "ev", "$", "____", "'", "=", "KqtH_", "#", "fBi____", "\"", "\"", "#=", "KqtH_", "#", "fBj____", "'", "=", "KqtH_", "#", "fG", ")", "____", "'", "=", "KqtH_", "#", "fG", "+", "____", "'", "=", "KqtH_", "#", "g", "<", "d____", "'", "=", "KqtH_", "#", "g", "<", "e____", "\"", "\"", "'=", "KqtH_", "#", "g", "=", "J____", "'", "=", "KqtH_", "#", "gat____", "#", "=", "KqtH_", "#", "s", "`", "D____", "#", "=", "J_", "#", "p_", "#", "sg", "?", "____", "#", "=", "J_", "#", "p_", "#", "t", "<", "a____", "\"", "\"", "#=", "KqtH_", "#", "t", "<", "c____", "#", "=", "KqtH_", "#", "trY____", "$", "=", "JiYj_", "#", "vA", "$", "____", "'", "=", "KqtH_", "#", "xs_____", "'", "=", "KqtH_", "$", "$", "rO____", "\"", "\"", "#=", "KqtH_", "$", "$", "rP____", "#", "=", "KqtH_", "$", "(", "_", "%", "____", "'", "=", "KqtH_", "$", ")]", "o____", "%", "=", "KqtH_", "$", "_", "@", ")", "____", "'", "=", "KqtH_", "$", "_k", "]", "____", "\"", "\"", "'=", "KqtH_", "$", "1", "]", "+", "____", "%", "=", "KqtH_", "$", "3IO____", "%", "=", "KqtH_", "$", "3J", "#", "____", "'", "=", "KqtH_", "$", "3J", ".", "____", "'", "=", "KqtH_", "$", "3J", ":", "____", "\"", "\"", "#=", "KqtH_", "$", "3JH____", "#", "=", "KqtH_", "$", "3JI____", "#", "=", "KqtH_", "$", "3JK____", "%", "=", "KqtH_", "$", "3JL____", "'", "=", "KqtH_", "$", "3JS____", "\"", "\"", "'=", "KqtH_", "$", "8", "+", "M____", "#", "=", "KqtH_", "$", "99d____", "%", "=", "KqtH_", "$", ":", "Lw____", "#", "=", "LK", "+", "x_", "$", ":", "N", "@", "____", "#", "=", "KqtG_", "$", ":", "NC____", "\"", "\"", "#=", "KqtG_", "$", ":", "hW____", "'", "=", "KqtH_", "$", ":", "i", "[", "____", "'", "=", "KqtH_", "$", ":", "ih____", "'", "=", "KqtH_", "$", ":", "it____", "'", "=", "KqtH_", "$", ":", "kO____", "\"", "\"", "'=", "KqtH_", "$", ">*", "B____", "'", "=", "KqtH_", "$", ">", "hD____", "+", "=", "J", "^", "x0_", "$", "?", "lW____", "'", "=", "KqtH_", "$", "?", "ll____", "'", "=", "KqtH_", "$", "?", "lm____", "\"", "\"", "%=", "KqtH_", "$", "?", "mi____", "'", "=", "KqtH_", "$", "?", "mx____", "'", "=", "KqtH_", "$", "D7", "]", "____", "#", "=", "J_", "#", "p_", "$", "D", "@", "T____", "#", "=", "J_", "#", "p_", "$", "V", "<", "g____", "\"", "\"", "'=", "KqtH", "\"", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "\"", "bh", "=", "\\\"", "\"", "+", "longValue", "+", "\"", "\\\"", ";\"", ");", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "STRICT", ".", "decode", "(", "emptyDomain", ")", ";", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "String", "encodedCookie", "=", "ClientCookieEncoder", ".", "STRICT", ".", "encode", "(", "cookie", ",", "cookie2", ",", "cookie3", ")", ";", "@", "Test", "public", "void", "testWrappedCookieValue", "(", ")", "{", "ClientCookieEncoder", ".", "STRICT", ".", "encode", "(", "new", "DefaultCookie", "(", "\"", "myCookie", "\"", ",", "\"", "\\\"", "foo", "\\", "\"\"", "))", ";", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "public", "void", "testRejectCookieValueWithSemicolon", "(", ")", "{", "ClientCookieEncoder", ".", "STRICT", ".", "encode", "(", "new", "DefaultCookie", "(", "\"", "myCookie", "\"", ",", "\"", "foo", ";", "bar", "\"", "))", ";", "}", "/", "*", "*", "Copyright", "2014", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpHeaderDateFormat", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "public", "class", "ServerCookieDecoderTest", "{", "@", "Test", "public", "void", "testDecodingSingleCookie", "(", ")", "{", "String", "cookieString", "=", "\"", "myCookie", "=", "myValue", "\"", ";", "cookieString", "=", "cookieString", ".", "replace", "(", "\"", "XXX", "\"", ",", "HttpHeaderDateFormat", ".", "get", "(", ").", "format", "(", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "50000", ")", "))", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "assertEquals", "(", "1", ",", "cookies", ".", "size", "(", "))", ";", "Cookie", "cookie", "=", "cookies", ".", "iterator", "(", ").", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue", "\"", ",", "cookie", ".", "value", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingMultipleCookies", "(", ")", "{", "String", "c1", "=", "\"", "myCookie", "=", "myValue", ";", "\";", "String", "c2", "=", "\"", "myCookie2", "=", "myValue2", ";", "\";", "String", "c3", "=", "\"", "myCookie3", "=", "myValue3", ";", "\";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "c1", "+", "c2", "+", "c3", ")", ";", "assertEquals", "(", "3", ",", "cookies", ".", "size", "(", "))", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "cookie", "=", "it", ".", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue", "\"", ",", "cookie", ".", "value", "(", "))", ";", "cookie", "=", "it", ".", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue2", "\"", ",", "cookie", ".", "value", "(", "))", ";", "cookie", "=", "it", ".", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue3", "\"", ",", "cookie", ".", "value", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingGoogleAnalyticsCookie", "(", ")", "{", "String", "source", "=", "\"", "ARPT", "=", "LWUKQPSWRTUN04CKKJI", ";", "\"", "\"", "kw", "-", "2E343B92", "-", "B097", "-", "442c", "-", "BFA5", "-", "BE371E0325A2", "=", "unfinished_furniture", ";", "\"", "\"", "__utma", "=", "48461872", ".", "1094088325", ".", "1258140131", ".", "1258140131", ".", "1258140131", ".", "1", ";", "\"", "\"", "__utmb", "=", "48461872", ".", "13", ".", "10", ".", "1258140131", ";", "__utmc", "=", "48461872", ";", "\"", "\"", "__utmz", "=", "48461872", ".", "1258140131", ".", "1", ".", "1", ".", "utmcsr", "=", "overstock", ".", "com", "|", "utmccn", "=", "(", "referral", ")", "|\"", "\"", "utmcmd", "=", "referral", "|", "utmcct", "=", "/", "Home", "-", "Garden", "/", "Furniture", "/", "Clearance", "/", "clearance", "/", "32", "/", "dept", ".", "html", "\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "source", ")", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "c", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utma", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", ".", "1094088325", ".", "1258140131", ".", "1258140131", ".", "1258140131", ".", "1", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utmb", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", ".", "13", ".", "10", ".", "1258140131", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utmc", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utmz", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", ".", "1258140131", ".", "1", ".", "1", ".", "utmcsr", "=", "overstock", ".", "com", "|", "\"", "\"", "utmccn", "=", "(", "referral", ")", "|", "utmcmd", "=", "referral", "|", "utmcct", "=", "/", "Home", "-", "Garden", "/", "Furniture", "/", "Clearance", "/", "clearance", "/", "32", "/", "dept", ".", "html", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "ARPT", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "LWUKQPSWRTUN04CKKJI", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "kw", "-", "2E343B92", "-", "B097", "-", "442c", "-", "BFA5", "-", "BE371E0325A2", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "unfinished_furniture", "\"", ",", "c", ".", "value", "(", "))", ";", "assertFalse", "(", "it", ".", "hasNext", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingLongValue", "(", ")", "{", "String", "longValue", "=", "\"", "b___", "$", "Q__", "$", "ha__", "<", "NC", "=", "MN", "(", "F__", "%", "#", "4__", "<", "NC", "=", "MN", "(", "F__2_d____", "#", "=", "IvZB__2_F____", "'", "=", "KqtH__2", "-", "9____", "\"", "\"", "'=", "IvZM__3f", ":", "____", "$", "=", "HbQW__3g", "'", "____", "%", "=", "J", "^", "wI__3g", "-", "____", "%", "=", "J", "^", "wI__3g1____", "$", "=", "HbQW__3g2____", "\"", "\"", "$=", "HbQW__3g5____", "%", "=", "J", "^", "wI__3g9____", "$", "=", "HbQW__3gT____", "$", "=", "HbQW__3gX____", "#", "=", "J", "^", "wI__3gY____", "\"", "\"", "#=", "J", "^", "wI__3gh____", "$", "=", "HbQW__3gj____", "$", "=", "HbQW__3gr____", "$", "=", "HbQW__3gx____", "#", "=", "J", "^", "wI__3h_____", "\"", "\"", "$=", "HbQW__3h", "$", "____", "#", "=", "J", "^", "wI__3h", "'", "____", "$", "=", "HbQW__3h_____", "$", "=", "HbQW__3h0____", "%", "=", "J", "^", "wI__3h1____", "\"", "\"", "#=", "J", "^", "wI__3h2____", "$", "=", "HbQW__3h4____", "$", "=", "HbQW__3h7____", "$", "=", "HbQW__3h8____", "%", "=", "J", "^", "wI__3h", ":", "____", "\"", "\"", "#=", "J", "^", "wI__3h", "@", "____", "%", "=", "J", "^", "wI__3hB____", "$", "=", "HbQW__3hC____", "$", "=", "HbQW__3hL____", "$", "=", "HbQW__3hQ____", "\"", "\"", "$=", "HbQW__3hS____", "%", "=", "J", "^", "wI__3hU____", "$", "=", "HbQW__3h", "[", "____", "$", "=", "HbQW__3h", "^", "____", "$", "=", "HbQW__3hd____", "\"", "\"", "%=", "J", "^", "wI__3he____", "%", "=", "J", "^", "wI__3hf____", "%", "=", "J", "^", "wI__3hg____", "$", "=", "HbQW__3hh____", "%", "=", "J", "^", "wI__3hi____", "\"", "\"", "%=", "J", "^", "wI__3hv____", "$", "=", "HbQW__3i", "/", "____", "#", "=", "J", "^", "wI__3i2____", "#", "=", "J", "^", "wI__3i3____", "%", "=", "J", "^", "wI__3i4____", "\"", "\"", "$=", "HbQW__3i7____", "$", "=", "HbQW__3i8____", "$", "=", "HbQW__3i9____", "%", "=", "J", "^", "wI__3i", "=", "____", "#", "=", "J", "^", "wI__3i", ">", "____", "\"", "\"", "%=", "J", "^", "wI__3iD____", "$", "=", "HbQW__3iF____", "#", "=", "J", "^", "wI__3iH____", "%", "=", "J", "^", "wI__3iM____", "%", "=", "J", "^", "wI__3iS____", "\"", "\"", "#=", "J", "^", "wI__3iU____", "%", "=", "J", "^", "wI__3iZ____", "#", "=", "J", "^", "wI__3i", "]", "____", "%", "=", "J", "^", "wI__3ig____", "%", "=", "J", "^", "wI__3ij____", "\"", "\"", "%=", "J", "^", "wI__3ik____", "#", "=", "J", "^", "wI__3il____", "$", "=", "HbQW__3in____", "%", "=", "J", "^", "wI__3ip____", "$", "=", "HbQW__3iq____", "\"", "\"", "$=", "HbQW__3it____", "%", "=", "J", "^", "wI__3ix____", "#", "=", "J", "^", "wI__3j_____", "$", "=", "HbQW__3j", "%", "____", "$", "=", "HbQW__3j", "'", "____", "\"", "\"", "%=", "J", "^", "wI__3j", "(", "____", "%", "=", "J", "^", "wI__9mJ____", "'", "=", "KqtH__", "=", "SE__", "<", "NC", "=", "MN", "(", "F__", "?", "VS__", "<", "NC", "=", "MN", "(", "F__Zw", "`", "____", "\"", "\"", "%=", "KqtH__j", "+", "C__", "<", "NC", "=", "MN", "(", "F__j", "+", "M__", "<", "NC", "=", "MN", "(", "F__j", "+", "a__", "<", "NC", "=", "MN", "(", "F__j_", ".", "__", "<", "NC", "=", "MN", "(", "F__n", ">", "M____", "\"", "\"", "'=", "KqtH__s1X____", "$", "=", "MMyc__s1_____", "#", "=", "MN", "#", "O__ypn____", "'", "=", "KqtH__ypr____", "'", "=", "KqtH_", "#", "%", "h_____", "\"", "\"", "%=", "KqtH_", "#", "%", "o_____", "'", "=", "KqtH_", "#", ")", "H6__", "<", "NC", "=", "MN", "(", "F_", "#", "*%", "'", "____", "%", "=", "KqtH_", "#", "+", "k", "(", "____", "'", "=", "KqtH_", "#", "-", "E_____", "\"", "\"", "'=", "KqtH_", "#", "1", ")", "w____", "'", "=", "KqtH_", "#", "1", ")", "y____", "'", "=", "KqtH_", "#", "1", "*", "M____", "#", "=", "KqtH_", "#", "1", "*", "p____", "'", "=", "KqtH_", "#", "14Q__", "<", "N", "\"", "\"", "C", "=", "MN", "(", "F_", "#", "14S__", "<", "NC", "=", "MN", "(", "F_", "#", "16I__", "<", "NC", "=", "MN", "(", "F_", "#", "16N__", "<", "NC", "=", "MN", "(", "F_", "#", "16X__", "<", "NC", "=", "MN", "(", "F_", "#", "16k__", "<", "N", "\"", "\"", "C", "=", "MN", "(", "F_", "#", "17", "@", "__", "<", "NC", "=", "MN", "(", "F_", "#", "17A__", "<", "NC", "=", "MN", "(", "F_", "#", "1Cq____", "'", "=", "KqtH_", "#", "7", ")", "_____", "#", "=", "KqtH_", "#", "7", ")", "b____", "\"", "\"", "#=", "KqtH_", "#", "7Ww____", "'", "=", "KqtH_", "#", "?", "cQ____", "'", "=", "KqtH_", "#", "His____", "'", "=", "KqtH_", "#", "Jrh____", "'", "=", "KqtH_", "#", "O", "@", "M__", "<", "N", "\"", "\"", "C", "=", "MN", "(", "F_", "#", "O", "@", "O__", "<", "NC", "=", "MN", "(", "F_", "#", "OC6__", "<", "NC", "=", "MN", "(", "F_", "#", "Os", ".", "____", "#", "=", "KqtH_", "#", "YOW____", "#", "=", "H", "/", "Li_", "#", "Zat____", "\"", "\"", "'=", "KqtH_", "#", "ZbI____", "%", "=", "KqtH_", "#", "Zbc____", "'", "=", "KqtH_", "#", "Zbs____", "%", "=", "KqtH_", "#", "Zby____", "'", "=", "KqtH_", "#", "Zce____", "\"", "\"", "'=", "KqtH_", "#", "Zdc____", "%", "=", "KqtH_", "#", "Zea____", "'", "=", "KqtH_", "#", "ZhI____", "#", "=", "KqtH_", "#", "ZiD____", "'", "=", "KqtH_", "#", "Zis____", "\"", "\"", "'=", "KqtH_", "#", "Zj0____", "#", "=", "KqtH_", "#", "Zj1____", "'", "=", "KqtH_", "#", "Zj", "[", "____", "'", "=", "KqtH_", "#", "Zj", "]", "____", "'", "=", "KqtH_", "#", "Zj", "^", "____", "\"", "\"", "'=", "KqtH_", "#", "Zjb____", "'", "=", "KqtH_", "#", "Zk_____", "'", "=", "KqtH_", "#", "Zk6____", "#", "=", "KqtH_", "#", "Zk9____", "%", "=", "KqtH_", "#", "Zk", "<", "____", "\"", "\"", "'=", "KqtH_", "#", "Zl", ">", "____", "'", "=", "KqtH_", "#", "]", "9R____", "$", "=", "H", "/", "Lt_", "#", "]", "I6____", "#", "=", "KqtH_", "#", "]", "Z", "#", "____", "%", "=", "KqtH_", "#", "^*", "N____", "\"", "\"", "#=", "KqtH_", "#", "^:", "m____", "#", "=", "KqtH_", "#", "_", "*", "_____", "%", "=", "J", "^", "wI_", "#", "`-", "7____", "#", "=", "KqtH_", "#", "`", "T", ">", "____", "'", "=", "KqtH_", "#", "`", "T", "?", "____", "\"", "\"", "'=", "KqtH_", "#", "`", "TA____", "'", "=", "KqtH_", "#", "`", "TB____", "'", "=", "KqtH_", "#", "`", "TG____", "'", "=", "KqtH_", "#", "`", "TP____", "#", "=", "KqtH_", "#", "`", "U_____", "\"", "\"", "'=", "KqtH_", "#", "`", "U", "/", "____", "'", "=", "KqtH_", "#", "`", "U0____", "#", "=", "KqtH_", "#", "`", "U9____", "'", "=", "KqtH_", "#", "aEQ____", "%", "=", "KqtH_", "#", "b", "<", ")", "____", "\"", "\"", "'=", "KqtH_", "#", "c9", "-", "____", "%", "=", "KqtH_", "#", "dxC____", "%", "=", "KqtH_", "#", "dxE____", "%", "=", "KqtH_", "#", "ev", "$", "____", "'", "=", "KqtH_", "#", "fBi____", "\"", "\"", "#=", "KqtH_", "#", "fBj____", "'", "=", "KqtH_", "#", "fG", ")", "____", "'", "=", "KqtH_", "#", "fG", "+", "____", "'", "=", "KqtH_", "#", "g", "<", "d____", "'", "=", "KqtH_", "#", "g", "<", "e____", "\"", "\"", "'=", "KqtH_", "#", "g", "=", "J____", "'", "=", "KqtH_", "#", "gat____", "#", "=", "KqtH_", "#", "s", "`", "D____", "#", "=", "J_", "#", "p_", "#", "sg", "?", "____", "#", "=", "J_", "#", "p_", "#", "t", "<", "a____", "\"", "\"", "#=", "KqtH_", "#", "t", "<", "c____", "#", "=", "KqtH_", "#", "trY____", "$", "=", "JiYj_", "#", "vA", "$", "____", "'", "=", "KqtH_", "#", "xs_____", "'", "=", "KqtH_", "$", "$", "rO____", "\"", "\"", "#=", "KqtH_", "$", "$", "rP____", "#", "=", "KqtH_", "$", "(", "_", "%", "____", "'", "=", "KqtH_", "$", ")]", "o____", "%", "=", "KqtH_", "$", "_", "@", ")", "____", "'", "=", "KqtH_", "$", "_k", "]", "____", "\"", "\"", "'=", "KqtH_", "$", "1", "]", "+", "____", "%", "=", "KqtH_", "$", "3IO____", "%", "=", "KqtH_", "$", "3J", "#", "____", "'", "=", "KqtH_", "$", "3J", ".", "____", "'", "=", "KqtH_", "$", "3J", ":", "____", "\"", "\"", "#=", "KqtH_", "$", "3JH____", "#", "=", "KqtH_", "$", "3JI____", "#", "=", "KqtH_", "$", "3JK____", "%", "=", "KqtH_", "$", "3JL____", "'", "=", "KqtH_", "$", "3JS____", "\"", "\"", "'=", "KqtH_", "$", "8", "+", "M____", "#", "=", "KqtH_", "$", "99d____", "%", "=", "KqtH_", "$", ":", "Lw____", "#", "=", "LK", "+", "x_", "$", ":", "N", "@", "____", "#", "=", "KqtG_", "$", ":", "NC____", "\"", "\"", "#=", "KqtG_", "$", ":", "hW____", "'", "=", "KqtH_", "$", ":", "i", "[", "____", "'", "=", "KqtH_", "$", ":", "ih____", "'", "=", "KqtH_", "$", ":", "it____", "'", "=", "KqtH_", "$", ":", "kO____", "\"", "\"", "'=", "KqtH_", "$", ">*", "B____", "'", "=", "KqtH_", "$", ">", "hD____", "+", "=", "J", "^", "x0_", "$", "?", "lW____", "'", "=", "KqtH_", "$", "?", "ll____", "'", "=", "KqtH_", "$", "?", "lm____", "\"", "\"", "%=", "KqtH_", "$", "?", "mi____", "'", "=", "KqtH_", "$", "?", "mx____", "'", "=", "KqtH_", "$", "D7", "]", "____", "#", "=", "J_", "#", "p_", "$", "D", "@", "T____", "#", "=", "J_", "#", "p_", "$", "V", "<", "g____", "\"", "\"", "'=", "KqtH", "\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "\"", "bh", "=", "\\\"", "\"", "+", "longValue", "+", "\"", "\\\"", ";\"", ");", "assertEquals", "(", "1", ",", "cookies", ".", "size", "(", "))", ";", "Cookie", "c", "=", "cookies", ".", "iterator", "(", ").", "next", "(", ");", "assertEquals", "(", "\"", "bh", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "longValue", ",", "c", ".", "value", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingOldRFC2965Cookies", "(", ")", "{", "String", "source", "=", "\"", "$", "Version", "=", "\\\"", "1", "\\", "\";", "\"", "\"", "Part_Number1", "=", "\\\"", "Riding_Rocket_0023", "\\", "\";", "$", "Path", "=", "\\\"", "/", "acme", "/", "ammo", "\\", "\";", "\"", "\"", "Part_Number2", "=", "\\\"", "Rocket_Launcher_0001", "\\", "\";", "$", "Path", "=", "\\\"", "/", "acme", "\\", "\"\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "source", ")", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "c", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "Part_Number1", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "Riding_Rocket_0023", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "Part_Number2", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "Rocket_Launcher_0001", "\"", ",", "c", ".", "value", "(", "))", ";", "assertFalse", "(", "it", ".", "hasNext", "(", "))", ";", "}", "@", "Test", "public", "void", "testRejectCookieValueWithSemicolon", "(", ")", "{", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "\"", "name", "=", "\\\"", "foo", ";", "bar", "\\", "\";", "\")", ";", "assertTrue", "(", "cookies", ".", "isEmpty", "(", "))", ";", "}", "}", "@", "@", "-", "13", ",", "10", "+", "13", ",", "12", "@", "@", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "HttpHeaderDateFormat", ";", "String", "encodedCookie", "=", "ServerCookieEncoder", ".", "STRICT", ".", "encode", "(", "cookie", ")", ";", "String", "encodedCookie1", "=", "ClientCookieEncoder", ".", "STRICT", ".", "encode", "(", ");", "List", "<", "String", ">", "encodedCookie2", "=", "ServerCookieEncoder", ".", "STRICT", ".", "encode", "(", ");", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "DefaultCookie", ";", "ClientCookieEncoder", ".", "STRICT", ".", "encode", "(", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "cookieString", ")", ";", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "STRICT", ".", "encode", "(", "cookie", ")", ");", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "STRICT", ".", "encode", "(", "\"", "key1", "\"", ",", "\"", "value1", "\"", "))", ";", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "STRICT", ".", "encode", "(", "\"", "key2", "\"", ",", "\"", "value2", "\"", "))", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ClientCookieEncoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "DefaultCookie", ";", "HttpHeaderNames", ".", "COOKIE", ",", "ClientCookieEncoder", ".", "STRICT", ".", "encode", "(", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "Cookie", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "cookie", ".", "ServerCookieEncoder", ";", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "value", ")", ";", "cookies", "=", "ServerCookieDecoder", ".", "STRICT", ".", "decode", "(", "value", ")", ";", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "STRICT", ".", "encode", "(", "cookie", ")", ");</s>import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieEncoderUtil", ".", "*;", "return", "encode", "(", "new", "DefaultCookie", "(", "name", ",", "value", ")", ");", "if", "(", "cookie", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookie", "\"", ");", "}", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "encode", "(", "buf", ",", "cookie", ")", ";", "return", "stripTrailingSeparator", "(", "buf", ")", ";", "if", "(", "cookies", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookies", "\"", ");", "}", "if", "(", "cookies", ".", "length", "=", "=", "0", ")", "{", "return", "null", ";", "}", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encode", "(", "buf", ",", "c", ")", ";", "}", "return", "stripTrailingSeparatorOrNull", "(", "buf", ")", ";", "if", "(", "cookies", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookies", "\"", ");", "}", "if", "(", "!", "cookies", ".", "iterator", "(", ").", "hasNext", "(", "))", "{", "return", "null", ";", "}", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encode", "(", "buf", ",", "c", ")", ";", "}", "return", "stripTrailingSeparatorOrNull", "(", "buf", ")", ";", "}", "private", "static", "void", "encode", "(", "StringBuilder", "buf", ",", "Cookie", "c", ")", "{", "/", "/", "rawValue", ">", "value", ">", "\"", "\"", "String", "value", "=", "c", ".", "rawValue", "(", ")", "!", "=", "null", "?", "c", ".", "rawValue", "(", ")", ":", "c", ".", "value", "(", ")", "!", "=", "null", "?", "c", ".", "value", "(", ")", ":", "\"", "\";", "addUnquoted", "(", "buf", ",", "c", ".", "name", "(", "),", "value", ")", ";", "public", "interface", "Cookie", "extends", "Comparable", "<", "Cookie", ">", "{", "/", "**", "*", "Returns", "the", "name", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "name", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "name", "(", ");", "/", "**", "*", "Returns", "the", "value", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "value", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "value", "(", ");", "/", "**", "*", "Sets", "the", "value", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "value", "The", "value", "to", "set", "*", "/", "void", "setValue", "(", "String", "value", ")", ";", "/", "**", "*", "Returns", "the", "raw", "value", "of", "this", "{", "@", "link", "Cookie", "}", ",", "*", "as", "it", "was", "set", "in", "original", "Set", "-", "Cookie", "header", ".", "*", "*", "@", "return", "The", "raw", "value", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "rawValue", "(", ");", "/", "**", "*", "Sets", "the", "raw", "value", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "rawValue", "The", "raw", "value", "to", "set", "*", "/", "void", "setRawValue", "(", "String", "rawValue", ")", ";", "/", "**", "*", "Returns", "the", "domain", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "domain", "of", "this", "{", "@", "link", "Cookie", "}", "*", "/", "String", "domain", "(", ");", "/", "**", "*", "Sets", "the", "domain", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "domain", "The", "domain", "to", "use", "*", "/", "void", "setDomain", "(", "String", "domain", ")", ";", "/", "**", "*", "Returns", "the", "path", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "The", "{", "@", "link", "Cookie", "}", "'", "s", "path", "*", "/", "String", "path", "(", ");", "/", "**", "*", "Sets", "the", "path", "of", "this", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "param", "path", "The", "path", "to", "use", "for", "this", "{", "@", "link", "Cookie", "}", "*", "/", "void", "setPath", "(", "String", "path", ")", ";", "*", "/", "void", "setVersion", "(", "int", "version", ")", ";", "/", "**", "*", "Checks", "to", "see", "if", "this", "{", "@", "link", "Cookie", "}", "is", "secure", "*", "*", "@", "return", "True", "if", "this", "{", "@", "link", "Cookie", "}", "is", "secure", ",", "otherwise", "false", "*", "/", "boolean", "isSecure", "(", ");", "/", "**", "*", "Sets", "the", "security", "getStatus", "of", "this", "{", "@", "link", "Cookie", "}", "*", "@", "param", "secure", "True", "if", "this", "{", "@", "link", "Cookie", "}", "is", "to", "be", "secure", ",", "otherwise", "false", "void", "setSecure", "(", "boolean", "secure", ")", ";", "/", "**", "*", "Checks", "to", "see", "if", "this", "{", "@", "link", "Cookie", "}", "can", "only", "be", "accessed", "via", "HTTP", ".", "*", "If", "this", "returns", "true", ",", "the", "{", "@", "link", "Cookie", "}", "cannot", "be", "accessed", "through", "*", "client", "side", "script", "-", "But", "only", "if", "the", "browser", "supports", "it", ".", "*", "For", "more", "information", ",", "please", "look", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "HTTPOnly", "\"", ">", "here", "<", "/", "a", ">", "*", "*", "@", "return", "True", "if", "this", "{", "@", "link", "Cookie", "}", "is", "HTTP", "-", "only", "or", "false", "if", "it", "isn", "'", "t", "*", "/", "boolean", "isHttpOnly", "(", ");", "/", "**", "*", "Determines", "if", "this", "{", "@", "link", "Cookie", "}", "is", "HTTP", "only", ".", "*", "If", "set", "to", "true", ",", "this", "{", "@", "link", "Cookie", "}", "cannot", "be", "accessed", "by", "a", "client", "*", "side", "script", ".", "However", ",", "this", "works", "only", "if", "the", "browser", "supports", "it", ".", "*", "For", "for", "information", ",", "please", "look", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "HTTPOnly", "\"", ">", "here", "<", "/", "a", ">", ".", "*", "*", "@", "param", "httpOnly", "True", "if", "the", "{", "@", "link", "Cookie", "}", "is", "HTTP", "only", ",", "otherwise", "false", ".", "*", "/", "void", "setHttpOnly", "(", "boolean", "httpOnly", ")", ";", "*", "@", "deprecated", "Use", "{", "@", "link", "ClientCookieDecoder", "}", "or", "{", "@", "link", "ServerCookieDecoder", "}", "instead", ".", "*", "@", "see", "ClientCookieEncoder", "*", "@", "see", "ServerCookieEncoder", "public", "static", "Set", "<", "Cookie", ">", "decode", "(", "String", "header", ")", "{", "if", "(", "names", ".", "get", "(", "0", ")", ".", "equalsIgnoreCase", "(", "CookieHeaderNames", ".", "VERSION", ")", ")", "{", "Cookie", "c", "=", "new", "DefaultCookie", "(", "name", ",", "value", ")", ";", "if", "(", "CookieHeaderNames", ".", "DISCARD", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "CookieHeaderNames", ".", "COMMENT", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "CookieHeaderNames", ".", "COMMENTURL", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "CookieHeaderNames", ".", "VERSION", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "}", "else", "if", "(", "CookieHeaderNames", ".", "PORT", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "private", "CookieDecoder", "(", ")", "{", "/", "/", "Unused", "/", "*", "*", "Copyright", "2012", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "InternalThreadLocalMap", ";", "final", "class", "CookieEncoderUtil", "{", "static", "StringBuilder", "stringBuilder", "(", ")", "{", "return", "InternalThreadLocalMap", ".", "get", "(", ").", "stringBuilder", "(", ");", "}", "/", "**", "*", "@", "param", "buf", "a", "buffer", "where", "some", "cookies", "were", "maybe", "encoded", "*", "@", "return", "the", "buffer", "String", "without", "the", "trailing", "separator", ",", "or", "null", "if", "no", "cookie", "was", "appended", ".", "*", "/", "static", "String", "stripTrailingSeparatorOrNull", "(", "StringBuilder", "buf", ")", "{", "return", "buf", ".", "length", "(", ")", "=", "=", "0", "?", "null", ":", "stripTrailingSeparator", "(", "buf", ")", ";", "}", "static", "String", "stripTrailingSeparator", "(", "StringBuilder", "buf", ")", "{", "if", "(", "buf", ".", "length", "(", ")", ">", "0", ")", "{", "buf", ".", "setLength", "(", "buf", ".", "length", "(", ")", "-", "2", ")", ";", "}", "return", "buf", ".", "toString", "(", ");", "}", "static", "void", "add", "(", "StringBuilder", "sb", ",", "String", "name", ",", "String", "val", ")", "{", "if", "(", "val", "=", "=", "null", ")", "{", "addQuoted", "(", "sb", ",", "name", ",", "\"", "\")", ";", "return", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "val", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "val", ".", "charAt", "(", "i", ")", ";", "switch", "(", "c", ")", "{", "case", "'", "\\", "t", "'", ":", "case", "'", "'", ":", "case", "'", "\"'", ":", "case", "'", "('", ":", "case", "'", ")'", ":", "case", "'", ",'", ":", "case", "'", "/'", ":", "case", "'", ":'", ":", "case", "'", ";'", ":", "case", "'", "<'", ":", "case", "'", "='", ":", "case", "'", ">'", ":", "case", "'", "?'", ":", "case", "'", "@'", ":", "case", "'", "['", ":", "case", "'", "\\\\", "':", "case", "'", "]'", ":", "case", "'", "{'", ":", "case", "'", "}'", ":", "addQuoted", "(", "sb", ",", "name", ",", "val", ")", ";", "return", ";", "}", "}", "addUnquoted", "(", "sb", ",", "name", ",", "val", ")", ";", "}", "static", "void", "addUnquoted", "(", "StringBuilder", "sb", ",", "String", "name", ",", "String", "val", ")", "{", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "EQUALS", ")", ";", "sb", ".", "append", "(", "val", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "static", "void", "addQuoted", "(", "StringBuilder", "sb", ",", "String", "name", ",", "String", "val", ")", "{", "if", "(", "val", "=", "=", "null", ")", "{", "val", "=", "\"", "\";", "}", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "EQUALS", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "DOUBLE_QUOTE", ")", ";", "sb", ".", "append", "(", "val", ".", "replace", "(", "\"\\", "\\\"", ",", "\"", "\\\\", "\\\\", "\")", ".", "replace", "(", "\"\\", "\"\"", ",", "\"", "\\\\", "\\\"", "\")", ");", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "DOUBLE_QUOTE", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "static", "void", "add", "(", "StringBuilder", "sb", ",", "String", "name", ",", "long", "val", ")", "{", "sb", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "EQUALS", ")", ";", "sb", ".", "append", "(", "val", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "sb", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "private", "CookieEncoderUtil", "(", ")", "{", "/", "/", "Unused", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "104", "@", "@", "public", "class", "DefaultCookie", "implements", "Cookie", "{", "private", "final", "String", "name", ";", "private", "String", "value", ";", "private", "String", "rawValue", ";", "private", "String", "domain", ";", "private", "String", "path", ";", "private", "long", "maxAge", "=", "Long", ".", "MIN_VALUE", ";", "private", "boolean", "secure", ";", "private", "boolean", "httpOnly", ";", "if", "(", "name", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "name", "\"", ");", "}", "name", "=", "name", ".", "trim", "(", ");", "if", "(", "name", ".", "isEmpty", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "empty", "name", "\"", ");", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "name", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "name", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", ">", "127", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "name", "contains", "non", "-", "ascii", "character", ":", "\"", "+", "name", ")", ";", "}", "/", "/", "Check", "prohibited", "characters", ".", "switch", "(", "c", ")", "{", "case", "'", "\\", "t", "'", ":", "case", "'", "\\", "n", "'", ":", "case", "0x0b", ":", "case", "'", "\\", "f", "'", ":", "case", "'", "\\", "r", "'", ":", "case", "'", "'", ":", "case", "'", ",'", ":", "case", "'", ";'", ":", "case", "'", "='", ":", "throw", "new", "IllegalArgumentException", "(", "\"", "name", "contains", "one", "of", "the", "following", "prohibited", "characters", ":", "\"", "+", "\"", "=,", ";", "\\", "\\", "t", "\\", "\\", "r", "\\", "\\", "n", "\\", "\\", "v", "\\", "\\", "f", ":", "\"", "+", "name", ")", ";", "}", "}", "if", "(", "name", ".", "charAt", "(", "0", ")", "=", "=", "'", "$'", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "name", "starting", "with", "'", "$'", "not", "allowed", ":", "\"", "+", "name", ")", ";", "}", "this", ".", "name", "=", "name", ";", "setValue", "(", "value", ")", ";", "@", "Override", "public", "String", "name", "(", ")", "{", "return", "name", ";", "}", "@", "Override", "public", "String", "value", "(", ")", "{", "return", "value", ";", "}", "@", "Override", "public", "void", "setValue", "(", "String", "value", ")", "{", "if", "(", "value", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "value", "\"", ");", "}", "this", ".", "value", "=", "value", ";", "}", "@", "Override", "public", "String", "rawValue", "(", ")", "{", "return", "rawValue", ";", "}", "@", "Override", "public", "void", "setRawValue", "(", "String", "rawValue", ")", "{", "if", "(", "value", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "rawValue", "\"", ");", "}", "this", ".", "rawValue", "=", "rawValue", ";", "}", "@", "Override", "public", "String", "domain", "(", ")", "{", "return", "domain", ";", "}", "@", "Override", "public", "void", "setDomain", "(", "String", "domain", ")", "{", "this", ".", "domain", "=", "validateValue", "(", "\"", "domain", "\"", ",", "domain", ")", ";", "}", "@", "Override", "public", "String", "path", "(", ")", "{", "return", "path", ";", "}", "@", "Override", "public", "void", "setPath", "(", "String", "path", ")", "{", "this", ".", "path", "=", "validateValue", "(", "\"", "path", "\"", ",", "path", ")", ";", "}", "@", "Override", "public", "long", "maxAge", "(", ")", "{", "return", "maxAge", ";", "}", "@", "Override", "public", "void", "setMaxAge", "(", "long", "maxAge", ")", "{", "this", ".", "maxAge", "=", "maxAge", ";", "}", "@", "Override", "public", "boolean", "isSecure", "(", ")", "{", "return", "secure", ";", "}", "@", "Override", "public", "void", "setSecure", "(", "boolean", "secure", ")", "{", "this", ".", "secure", "=", "secure", ";", "}", "@", "Override", "public", "boolean", "isHttpOnly", "(", ")", "{", "return", "httpOnly", ";", "}", "@", "Override", "public", "void", "setHttpOnly", "(", "boolean", "httpOnly", ")", "{", "this", ".", "httpOnly", "=", "httpOnly", ";", "}", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "name", "(", ").", "hashCode", "(", ");", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "!(", "o", "instanceof", "Cookie", ")", ")", "{", "return", "false", ";", "}", "Cookie", "that", "=", "(", "Cookie", ")", "o", ";", "if", "(", "!", "name", "(", ").", "equalsIgnoreCase", "(", "that", ".", "name", "(", "))", ")", "{", "return", "false", ";", "}", "if", "(", "path", "(", ")", "=", "=", "null", ")", "{", "if", "(", "that", ".", "path", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "that", ".", "path", "(", ")", "=", "=", "null", ")", "{", "return", "false", ";", "}", "else", "if", "(", "!", "path", "(", ").", "equals", "(", "that", ".", "path", "(", "))", ")", "{", "return", "false", ";", "}", "if", "(", "domain", "(", ")", "=", "=", "null", ")", "{", "if", "(", "that", ".", "domain", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "that", ".", "domain", "(", ")", "=", "=", "null", ")", "{", "return", "false", ";", "}", "else", "{", "return", "domain", "(", ").", "equalsIgnoreCase", "(", "that", ".", "domain", "(", "))", ";", "}", "return", "true", ";", "}", "@", "Override", "public", "int", "compareTo", "(", "Cookie", "c", ")", "{", "int", "v", ";", "v", "=", "name", "(", ").", "compareToIgnoreCase", "(", "c", ".", "name", "(", "))", ";", "if", "(", "v", "!", "=", "0", ")", "{", "return", "v", ";", "}", "if", "(", "path", "(", ")", "=", "=", "null", ")", "{", "if", "(", "c", ".", "path", "(", ")", "!", "=", "null", ")", "{", "return", "-", "1", ";", "}", "}", "else", "if", "(", "c", ".", "path", "(", ")", "=", "=", "null", ")", "{", "return", "1", ";", "}", "else", "{", "v", "=", "path", "(", ").", "compareTo", "(", "c", ".", "path", "(", "))", ";", "if", "(", "v", "!", "=", "0", ")", "{", "return", "v", ";", "}", "}", "if", "(", "domain", "(", ")", "=", "=", "null", ")", "{", "if", "(", "c", ".", "domain", "(", ")", "!", "=", "null", ")", "{", "return", "-", "1", ";", "}", "}", "else", "if", "(", "c", ".", "domain", "(", ")", "=", "=", "null", ")", "{", "return", "1", ";", "}", "else", "{", "v", "=", "domain", "(", ").", "compareToIgnoreCase", "(", "c", ".", "domain", "(", "))", ";", "return", "v", ";", "}", "return", "0", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", ")", ".", "append", "(", "name", "(", "))", ".", "append", "(", "'=", "')", ".", "append", "(", "value", "(", "))", ";", "if", "(", "domain", "(", ")", "!", "=", "null", ")", "{", "buf", ".", "append", "(", "\",", "domain", "=", "\")", ".", "append", "(", "domain", "(", "))", ";", "}", "if", "(", "path", "(", ")", "!", "=", "null", ")", "{", "buf", ".", "append", "(", "\",", "path", "=", "\")", ".", "append", "(", "path", "(", "))", ";", "}", "if", "(", "comment", "(", ")", "!", "=", "null", ")", "{", "buf", ".", "append", "(", "\",", "comment", "=", "\")", ".", "append", "(", "comment", "(", "))", ";", "}", "if", "(", "maxAge", "(", ")", ">", "=", "0", ")", "{", "buf", ".", "append", "(", "\",", "maxAge", "=", "\")", ".", "append", "(", "maxAge", "(", "))", ".", "append", "(", "'", "s", "'", ");", "}", "if", "(", "isSecure", "(", "))", "{", "buf", ".", "append", "(", "\",", "secure", "\"", ");", "}", "if", "(", "isHttpOnly", "(", "))", "{", "buf", ".", "append", "(", "\",", "HTTPOnly", "\"", ");", "}", "return", "buf", ".", "toString", "(", ");", "}", "private", "static", "String", "validateValue", "(", "String", "name", ",", "String", "value", ")", "{", "if", "(", "value", "=", "=", "null", ")", "{", "return", "null", ";", "}", "value", "=", "value", ".", "trim", "(", ");", "if", "(", "value", ".", "isEmpty", "(", "))", "{", "return", "null", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "value", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "value", ".", "charAt", "(", "i", ")", ";", "switch", "(", "c", ")", "{", "case", "'", "\\", "r", "'", ":", "case", "'", "\\", "n", "'", ":", "case", "'", "\\", "f", "'", ":", "case", "0x0b", ":", "case", "'", ";'", ":", "throw", "new", "IllegalArgumentException", "(", "name", "+", "\"", "contains", "one", "of", "the", "following", "prohibited", "characters", ":", "\"", "+", "\"", ";\\", "\\", "r", "\\", "\\", "n", "\\", "\\", "f", "\\", "\\", "v", "(", "\"", "+", "value", "+", "'", ")'", ");", "}", "}", "return", "value", ";", "}", "final", "class", "HttpHeaderDateFormat", "extends", "SimpleDateFormat", "{", "static", "HttpHeaderDateFormat", "get", "(", ")", "{", "*", "{", "@", "link", "QueryStringEncoder", "}", "and", "{", "@", "link", "QueryStringDecoder", "}", ".", "{", "@", "link", "Cookie", "}", "*", "support", "is", "also", "provided", "separately", "via", "{", "@", "link", "ClientCookieDecoder", "}", ",", "{", "@", "link", "ServerCookieDecoder", "}", ",", "*", "{", "@", "link", "ClientCookieEncoder", "}", ",", "and", "{", "@", "link", "@", "ServerCookieEncoder", "}", ".", "*", "@", "see", "ClientCookieEncoder", "*", "@", "see", "ServerCookieEncoder", "*", "@", "see", "ClientCookieDecoder", "*", "@", "see", "ServerCookieDecoder", "*", "Unlike", "the", "Servlet", "API", ",", "{", "@", "link", "Cookie", "}", "support", "is", "provided", "separately", "via", "{", "@", "link", "ClientCookieDecoder", "}", ",", "*", "{", "@", "link", "ServerCookieDecoder", "}", ",", "{", "@", "link", "ClientCookieEncoder", "}", ",", "and", "{", "@", "link", "@", "ServerCookieEncoder", "}", ".", "*", "@", "see", "ClientCookieEncoder", "*", "@", "see", "ServerCookieEncoder", "*", "@", "see", "ClientCookieDecoder", "*", "@", "see", "ServerCookieDecoder", "/", "*", "*", "Copyright", "2014", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieEncoderUtil", ".", "*;", "/", "**", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "tools", ".", "ietf", ".", "org", "/", "html", "/", "rfc6265", "\"", ">", "RFC6265", "<", "/", "a", ">", "compliant", "cookie", "decoder", "to", "be", "used", "server", "side", ".", "*", "*", "Only", "name", "and", "value", "fields", "are", "expected", ",", "so", "old", "fields", "are", "not", "populated", "(", "path", ",", "domain", ",", "etc", ")", ".", "*", "*", "Old", "<", "a", "href", "=", "\"", "http", ":", "//", "tools", ".", "ietf", ".", "org", "/", "html", "/", "rfc2965", "\"", ">", "RFC2965", "<", "/", "a", ">", "cookies", "are", "still", "supported", ",", "*", "old", "fields", "will", "simply", "be", "ignored", ".", "*", "*", "@", "see", "ServerCookieEncoder", "*", "/", "public", "final", "class", "ServerCookieDecoder", "{", "/", "**", "*", "Decodes", "the", "specified", "Set", "-", "Cookie", "HTTP", "header", "value", "into", "a", "{", "@", "link", "Cookie", "}", ".", "*", "*", "@", "return", "the", "decoded", "{", "@", "link", "Cookie", "}", "*", "/", "public", "static", "Set", "<", "Cookie", ">", "decode", "(", "String", "header", ")", "{", "if", "(", "header", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "header", "\"", ");", "}", "final", "int", "headerLen", "=", "header", ".", "length", "(", ");", "if", "(", "headerLen", "=", "=", "0", ")", "{", "return", "Collections", ".", "emptySet", "(", ");", "}", "Set", "<", "Cookie", ">", "cookies", "=", "new", "TreeSet", "<", "Cookie", ">", "()", ";", "int", "i", "=", "0", ";", "boolean", "rfc2965Style", "=", "false", ";", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "0", ",", "\"", "$", "Version", "\"", ",", "0", ",", "8", ")", ")", "{", "/", "/", "RFC", "2965", "style", "cookie", ",", "move", "to", "after", "version", "value", "i", "=", "header", ".", "indexOf", "(", "';", "')", "+", "1", ";", "rfc2965Style", "=", "true", ";", "}", "loop", ":", "for", "(", ";;", ")", "{", "/", "/", "Skip", "spaces", "and", "separators", ".", "for", "(", ";;", ")", "{", "if", "(", "i", "=", "=", "headerLen", ")", "{", "break", "loop", ";", "}", "char", "c", "=", "header", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", "=", "=", "'", "\\", "t", "'", "|", "|", "c", "=", "=", "'", "\\", "n", "'", "|", "|", "c", "=", "=", "0x0b", "|", "|", "c", "=", "=", "'", "\\", "f", "'", "|", "|", "c", "=", "=", "'", "\\", "r", "'", "|", "|", "c", "=", "=", "'", "'", "|", "|", "c", "=", "=", "'", ",'", "|", "|", "c", "=", "=", "'", ";'", ")", "{", "i", "+", "+;", "continue", ";", "}", "break", ";", "}", "int", "newNameStart", "=", "i", ";", "int", "newNameEnd", "=", "i", ";", "String", "value", ";", "if", "(", "i", "=", "=", "headerLen", ")", "{", "value", "=", "null", ";", "}", "else", "{", "keyValLoop", ":", "for", "(", ";;", ")", "{", "char", "curChar", "=", "header", ".", "charAt", "(", "i", ")", ";", "if", "(", "curChar", "=", "=", "'", ";'", ")", "{", "/", "/", "NAME", ";", "(", "no", "value", "till", "'", ";'", ")", "newNameEnd", "=", "i", ";", "value", "=", "null", ";", "break", "keyValLoop", ";", "}", "else", "if", "(", "curChar", "=", "=", "'", "='", ")", "{", "/", "/", "NAME", "=", "VALUE", "newNameEnd", "=", "i", ";", "i", "+", "+;", "if", "(", "i", "=", "=", "headerLen", ")", "{", "/", "/", "NAME", "=", "(", "empty", "value", ",", "i", ".", "e", ".", "nothing", "after", "'", "='", ")", "value", "=", "\"", "\";", "break", "keyValLoop", ";", "}", "int", "newValueStart", "=", "i", ";", "char", "c", "=", "header", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", "=", "=", "'", "\"'", ")", "{", "/", "/", "NAME", "=", "\"", "VALUE", "\"", "StringBuilder", "newValueBuf", "=", "stringBuilder", "(", ");", "final", "char", "q", "=", "c", ";", "boolean", "hadBackslash", "=", "false", ";", "i", "+", "+;", "for", "(", ";;", ")", "{", "if", "(", "i", "=", "=", "headerLen", ")", "{", "value", "=", "newValueBuf", ".", "toString", "(", ");", "break", "keyValLoop", ";", "}", "if", "(", "hadBackslash", ")", "{", "hadBackslash", "=", "false", ";", "c", "=", "header", ".", "charAt", "(", "i", "+", "+)", ";", "if", "(", "c", "=", "=", "'", "\\\\", "'", "|", "|", "c", "=", "=", "'", "\"'", ")", "{", "/", "/", "Escape", "last", "backslash", ".", "newValueBuf", ".", "setCharAt", "(", "newValueBuf", ".", "length", "(", ")", "-", "1", ",", "c", ")", ";", "}", "else", "{", "/", "/", "Do", "not", "escape", "last", "backslash", ".", "newValueBuf", ".", "append", "(", "c", ")", ";", "}", "}", "else", "{", "c", "=", "header", ".", "charAt", "(", "i", "+", "+)", ";", "if", "(", "c", "=", "=", "q", ")", "{", "value", "=", "newValueBuf", ".", "toString", "(", ");", "break", "keyValLoop", ";", "}", "newValueBuf", ".", "append", "(", "c", ")", ";", "if", "(", "c", "=", "=", "'", "\\\\", "')", "{", "hadBackslash", "=", "true", ";", "}", "}", "}", "}", "else", "{", "/", "/", "NAME", "=", "VALUE", ";", "int", "semiPos", "=", "header", ".", "indexOf", "(", "';", "',", "i", ")", ";", "if", "(", "semiPos", ">", "0", ")", "{", "value", "=", "header", ".", "substring", "(", "newValueStart", ",", "semiPos", ")", ";", "i", "=", "semiPos", ";", "}", "else", "{", "value", "=", "header", ".", "substring", "(", "newValueStart", ")", ";", "i", "=", "headerLen", ";", "}", "}", "break", "keyValLoop", ";", "}", "else", "{", "i", "+", "+;", "}", "if", "(", "i", "=", "=", "headerLen", ")", "{", "/", "/", "NAME", "(", "no", "value", "till", "the", "end", "of", "string", ")", "newNameEnd", "=", "headerLen", ";", "value", "=", "null", ";", "break", ";", "}", "}", "}", "if", "(", "!", "rfc2965Style", "|", "|", "(", "!", "header", ".", "regionMatches", "(", "newNameStart", ",", "\"", "$", "Path", "\"", ",", "0", ",", "\"", "$", "Path", "\"", ".", "length", "(", "))", "&", "&", "!", "header", ".", "regionMatches", "(", "newNameStart", ",", "\"", "$", "Domain", "\"", ",", "0", ",", "\"", "$", "Domain", "\"", ".", "length", "(", "))", "&", "&", "!", "header", ".", "regionMatches", "(", "newNameStart", ",", "\"", "$", "Port", "\"", ",", "0", ",", "\"", "$", "Port", "\"", ".", "length", "(", "))", "))", "{", "/", "/", "skip", "obsolete", "RFC2965", "fields", "String", "name", "=", "header", ".", "substring", "(", "newNameStart", ",", "newNameEnd", ")", ";", "cookies", ".", "add", "(", "new", "DefaultCookie", "(", "name", ",", "value", ")", ");", "}", "}", "return", "cookies", ";", "}", "private", "ServerCookieDecoder", "(", ")", "{", "/", "/", "unused", "}", "}", "@", "@", "-", "15", ",", "12", "+", "15", ",", "7", "@", "@", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieEncoderUtil", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "return", "encode", "(", "new", "DefaultCookie", "(", "name", ",", "value", ")", ");", "if", "(", "cookie", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookie", "\"", ");", "}", "StringBuilder", "buf", "=", "stringBuilder", "(", ");", "addUnquoted", "(", "buf", ",", "cookie", ".", "name", "(", "),", "cookie", ".", "value", "(", "))", ";", "if", "(", "cookie", ".", "maxAge", "(", ")", "!", "=", "Long", ".", "MIN_VALUE", ")", "{", "add", "(", "buf", ",", "CookieHeaderNames", ".", "MAX_AGE", ",", "cookie", ".", "maxAge", "(", "))", ";", "Date", "expires", "=", "new", "Date", "(", "cookie", ".", "maxAge", "(", ")", "*", "1000", "+", "System", ".", "currentTimeMillis", "(", "))", ";", "addUnquoted", "(", "buf", ",", "CookieHeaderNames", ".", "EXPIRES", ",", "HttpHeaderDateFormat", ".", "get", "(", ").", "format", "(", "expires", ")", ");", "}", "if", "(", "cookie", ".", "path", "(", ")", "!", "=", "null", ")", "{", "addUnquoted", "(", "buf", ",", "CookieHeaderNames", ".", "PATH", ",", "cookie", ".", "path", "(", "))", ";", "}", "if", "(", "cookie", ".", "domain", "(", ")", "!", "=", "null", ")", "{", "addUnquoted", "(", "buf", ",", "CookieHeaderNames", ".", "DOMAIN", ",", "cookie", ".", "domain", "(", "))", ";", "}", "if", "(", "cookie", ".", "isSecure", "(", "))", "{", "buf", ".", "append", "(", "CookieHeaderNames", ".", "SECURE", ")", ";", "buf", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "buf", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "if", "(", "cookie", ".", "isHttpOnly", "(", "))", "{", "buf", ".", "append", "(", "CookieHeaderNames", ".", "HTTPONLY", ")", ";", "buf", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SEMICOLON", ")", ";", "buf", ".", "append", "(", "(", "char", ")", "HttpConstants", ".", "SP", ")", ";", "}", "return", "stripTrailingSeparator", "(", "buf", ")", ";", "if", "(", "cookies", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookies", "\"", ");", "}", "if", "(", "cookies", ".", "length", "=", "=", "0", ")", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "encoded", "=", "new", "ArrayList", "<", "String", ">", "(", "cookies", ".", "length", ")", ";", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encoded", ".", "add", "(", "encode", "(", "c", ")", ");", "}", "return", "encoded", ";", "if", "(", "cookies", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookies", "\"", ");", "}", "if", "(", "cookies", ".", "isEmpty", "(", "))", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "encoded", "=", "new", "ArrayList", "<", "String", ">", "(", "cookies", ".", "size", "(", "))", ";", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encoded", ".", "add", "(", "encode", "(", "c", ")", ");", "}", "return", "encoded", ";", "if", "(", "cookies", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "cookies", "\"", ");", "}", "if", "(", "!", "cookies", ".", "iterator", "(", ").", "hasNext", "(", "))", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "encoded", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "Cookie", "c", ":", "cookies", ")", "{", "if", "(", "c", "=", "=", "null", ")", "{", "break", ";", "}", "encoded", ".", "add", "(", "encode", "(", "c", ")", ");", "}", "return", "encoded", ";", "*", "Copyright", "2014", "The", "Netty", "Project", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "import", "static", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "CookieEncoderUtil", ".", "*;", "*", "It", "will", "store", "the", "raw", "value", "in", "{", "@", "link", "Cookie", "#", "setRawValue", "(", "String", ")", "}", "so", "it", "can", "be", "public", "final", "class", "ClientCookieDecoder", "{", "public", "static", "Cookie", "decode", "(", "String", "header", ")", "{", "if", "(", "header", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "\"", "header", "\"", ");", "}", "final", "int", "headerLen", "=", "header", ".", "length", "(", ");", "int", "newNameStart", "=", "i", ";", "int", "newNameEnd", "=", "i", ";", "String", "value", ",", "rawValue", ";", "if", "(", "i", "=", "=", "headerLen", ")", "{", "value", "=", "rawValue", "=", "null", ";", "}", "else", "{", "newNameEnd", "=", "i", ";", "value", "=", "rawValue", "=", "null", ";", "newNameEnd", "=", "i", ";", "value", "=", "rawValue", "=", "\"", "\";", "int", "newValueStart", "=", "i", ";", "char", "c", "=", "header", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", "=", "=", "'", "\"'", ")", "{", "/", "/", "NAME", "=", "\"", "VALUE", "\"", "StringBuilder", "newValueBuf", "=", "stringBuilder", "(", ");", "int", "rawValueStart", "=", "i", ";", "int", "rawValueEnd", "=", "i", ";", "final", "char", "q", "=", "c", ";", "boolean", "hadBackslash", "=", "false", ";", "i", "+", "+;", "for", "(", ";;", ")", "{", "if", "(", "i", "=", "=", "headerLen", ")", "{", "value", "=", "newValueBuf", ".", "toString", "(", ");", "/", "/", "only", "need", "to", "compute", "raw", "value", "for", "cookie", "/", "/", "value", "which", "is", "in", "first", "position", "rawValue", "=", "header", ".", "substring", "(", "rawValueStart", ",", "rawValueEnd", ")", ";", "break", "keyValLoop", ";", "}", "if", "(", "hadBackslash", ")", "{", "hadBackslash", "=", "false", ";", "c", "=", "header", ".", "charAt", "(", "i", "+", "+)", ";", "rawValueEnd", "=", "i", ";", "if", "(", "c", "=", "=", "'", "\\\\", "'", "|", "|", "c", "=", "=", "'", "\"'", ")", "{", "newValueBuf", ".", "setCharAt", "(", "newValueBuf", ".", "length", "(", ")", "-", "1", ",", "c", ")", ";", "}", "else", "{", "/", "/", "Do", "not", "escape", "last", "backslash", ".", "newValueBuf", ".", "append", "(", "c", ")", ";", "}", "}", "else", "{", "c", "=", "header", ".", "charAt", "(", "i", "+", "+)", ";", "rawValueEnd", "=", "i", ";", "if", "(", "c", "=", "=", "q", ")", "{", "value", "=", "newValueBuf", ".", "toString", "(", ");", "/", "/", "only", "need", "to", "compute", "raw", "value", "for", "/", "/", "cookie", "value", "which", "is", "in", "first", "/", "/", "position", "rawValue", "=", "header", ".", "substring", "(", "rawValueStart", ",", "rawValueEnd", ")", ";", "break", "keyValLoop", ";", "}", "newValueBuf", ".", "append", "(", "c", ")", ";", "if", "(", "c", "=", "=", "'", "\\\\", "')", "{", "hadBackslash", "=", "true", ";", "}", "}", "}", "}", "else", "{", "/", "/", "NAME", "=", "VALUE", ";", "int", "semiPos", "=", "header", ".", "indexOf", "(", "';", "',", "i", ")", ";", "if", "(", "semiPos", ">", "0", ")", "{", "value", "=", "rawValue", "=", "header", ".", "substring", "(", "newValueStart", ",", "semiPos", ")", ";", "i", "=", "semiPos", ";", "}", "else", "{", "value", "=", "rawValue", "=", "header", ".", "substring", "(", "newValueStart", ")", ";", "i", "=", "headerLen", ";", "}", "}", "newNameEnd", "=", "i", ";", "value", "=", "rawValue", "=", "null", ";", "cookieBuilder", "=", "new", "CookieBuilder", "(", "header", ",", "newNameStart", ",", "newNameEnd", ",", "value", ",", "rawValue", ")", ";", "cookieBuilder", ".", "appendAttribute", "(", "header", ",", "newNameStart", ",", "newNameEnd", ",", "value", ")", ";", "private", "final", "String", "name", ";", "private", "final", "String", "value", ";", "private", "final", "String", "rawValue", ";", "public", "CookieBuilder", "(", "String", "header", ",", "int", "keyStart", ",", "int", "keyEnd", ",", "String", "value", ",", "String", "rawValue", ")", "{", "name", "=", "header", ".", "substring", "(", "keyStart", ",", "keyEnd", ")", ";", "this", ".", "value", "=", "value", ";", "this", ".", "rawValue", "=", "rawValue", ";", "if", "(", "name", "=", "=", "null", ")", "{", "return", "null", ";", "}", "DefaultCookie", "cookie", "=", "new", "DefaultCookie", "(", "name", ",", "value", ")", ";", "cookie", ".", "setValue", "(", "value", ")", ";", "cookie", ".", "setRawValue", "(", "rawValue", ")", ";", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "\"", "Path", "\"", ",", "0", ",", "4", ")", ")", "{", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "\"", "Domain", "\"", ",", "0", ",", "5", ")", ")", "{", "domain", "=", "value", ".", "isEmpty", "(", ")", "?", "null", ":", "value", ";", "}", "else", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "\"", "Secure", "\"", ",", "0", ",", "5", ")", ")", "{", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "\"", "Expires", "\"", ",", "0", ",", "7", ")", ")", "{", "}", "else", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "\"", "Max", "-", "Age", "\"", ",", "0", ",", "7", ")", ")", "{", "if", "(", "header", ".", "regionMatches", "(", "true", ",", "nameStart", ",", "\"", "HttpOnly", "\"", ",", "0", ",", "8", ")", ")", "{", "private", "ClientCookieDecoder", "(", ")", "{", "/", "/", "unused", "}", "*", "Copyright", "2012", "The", "Netty", "Project", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "final", "class", "CookieHeaderNames", "{", "static", "final", "String", "PATH", "=", "\"", "Path", "\"", ";", "static", "final", "String", "EXPIRES", "=", "\"", "Expires", "\"", ";", "static", "final", "String", "MAX_AGE", "=", "\"", "Max", "-", "Age", "\"", ";", "static", "final", "String", "DOMAIN", "=", "\"", "Domain", "\"", ";", "static", "final", "String", "SECURE", "=", "\"", "Secure", "\"", ";", "static", "final", "String", "HTTPONLY", "=", "\"", "HTTPOnly", "\"", ";", "static", "final", "String", "COMMENT", "=", "\"", "Comment", "\"", ";", "static", "final", "String", "COMMENTURL", "=", "\"", "CommentURL", "\"", ";", "static", "final", "String", "DISCARD", "=", "\"", "Discard", "\"", ";", "static", "final", "String", "PORT", "=", "\"", "Port", "\"", ";", "static", "final", "String", "VERSION", "=", "\"", "Version", "\"", ";", "/", "*", "*", "Copyright", "2014", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "*", "version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "public", "class", "ServerCookieDecoderTest", "{", "@", "Test", "public", "void", "testDecodingSingleCookie", "(", ")", "{", "String", "cookieString", "=", "\"", "myCookie", "=", "myValue", "\"", ";", "cookieString", "=", "cookieString", ".", "replace", "(", "\"", "XXX", "\"", ",", "HttpHeaderDateFormat", ".", "get", "(", ").", "format", "(", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "+", "50000", ")", "))", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "assertEquals", "(", "1", ",", "cookies", ".", "size", "(", "))", ";", "Cookie", "cookie", "=", "cookies", ".", "iterator", "(", ").", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue", "\"", ",", "cookie", ".", "value", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingMultipleCookies", "(", ")", "{", "String", "c1", "=", "\"", "myCookie", "=", "myValue", ";", "\";", "String", "c2", "=", "\"", "myCookie2", "=", "myValue2", ";", "\";", "String", "c3", "=", "\"", "myCookie3", "=", "myValue3", ";", "\";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "c1", "+", "c2", "+", "c3", ")", ";", "assertEquals", "(", "3", ",", "cookies", ".", "size", "(", "))", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "cookie", "=", "it", ".", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue", "\"", ",", "cookie", ".", "value", "(", "))", ";", "cookie", "=", "it", ".", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue2", "\"", ",", "cookie", ".", "value", "(", "))", ";", "cookie", "=", "it", ".", "next", "(", ");", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "\"", "myValue3", "\"", ",", "cookie", ".", "value", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingQuotedCookie", "(", ")", "{", "String", "source", "=", "\"", "a", "=", "\\\"", "\\\"", ";\"", "+", "\"", "b", "=", "\\\"", "1", "\\", "\";", "\"", "+", "\"", "c", "=", "\\\"", "\\\\", "\\\"", "1", "\\", "\\\\", "\"", "2", "\\", "\\\\", "\"\\", "\";", "\"", "+", "\"", "d", "=", "\\\"", "1", "\\", "\\\\", "\"", "2", "\\", "\\\\", "\"", "3", "\\", "\";", "\"", "+", "\"", "e", "=", "\\\"", "\\\\", "\\\"", "\\\\", "\\\"", "\\\"", ";\"", "+", "\"", "f", "=", "\\\"", "1", "\\", "\\\\", "\"\\", "\\\\", "\"", "2", "\\", "\";", "\"", "+", "\"", "g", "=", "\\\"", "\\\\", "\\\\", "\\\"", ";\"", "+", "\"", "h", "=", "\\\"", "';", ",\\", "\\", "x", "\\", "\"\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "source", ")", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "c", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "a", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "b", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "1", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "c", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\\", "\"", "1", "\\", "\"", "2", "\\", "\"\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "d", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "1", "\\", "\"", "2", "\\", "\"", "3", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "e", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\\", "\"\\", "\"\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "f", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "1", "\\", "\"\\", "\"", "2", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "g", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\\", "\\\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "h", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"'", ";,", "\\\\", "x", "\"", ",", "c", ".", "value", "(", "))", ";", "assertFalse", "(", "it", ".", "hasNext", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingGoogleAnalyticsCookie", "(", ")", "{", "String", "source", "=", "\"", "ARPT", "=", "LWUKQPSWRTUN04CKKJI", ";", "\"", "+", "\"", "kw", "-", "2E343B92", "-", "B097", "-", "442c", "-", "BFA5", "-", "BE371E0325A2", "=", "unfinished", "furniture", ";", "\"", "+", "\"", "__utma", "=", "48461872", ".", "1094088325", ".", "1258140131", ".", "1258140131", ".", "1258140131", ".", "1", ";", "\"", "+", "\"", "__utmb", "=", "48461872", ".", "13", ".", "10", ".", "1258140131", ";", "__utmc", "=", "48461872", ";", "\"", "+", "\"", "__utmz", "=", "48461872", ".", "1258140131", ".", "1", ".", "1", ".", "utmcsr", "=", "overstock", ".", "com", "|", "utmccn", "=", "(", "referral", ")", "|\"", "+", "\"", "utmcmd", "=", "referral", "|", "utmcct", "=", "/", "Home", "-", "Garden", "/", "Furniture", "/", "Clearance", ",", "/", "clearance", ",", "/", "32", "/", "dept", ".", "html", "\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "source", ")", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "c", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utma", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", ".", "1094088325", ".", "1258140131", ".", "1258140131", ".", "1258140131", ".", "1", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utmb", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", ".", "13", ".", "10", ".", "1258140131", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utmc", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "__utmz", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "48461872", ".", "1258140131", ".", "1", ".", "1", ".", "utmcsr", "=", "overstock", ".", "com", "|", "\"", "+", "\"", "utmccn", "=", "(", "referral", ")", "|", "utmcmd", "=", "referral", "|", "utmcct", "=", "/", "Home", "-", "Garden", "/", "Furniture", "/", "Clearance", ",", "/", "clearance", ",", "/", "32", "/", "dept", ".", "html", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "ARPT", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "LWUKQPSWRTUN04CKKJI", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "kw", "-", "2E343B92", "-", "B097", "-", "442c", "-", "BFA5", "-", "BE371E0325A2", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "unfinished", "furniture", "\"", ",", "c", ".", "value", "(", "))", ";", "assertFalse", "(", "it", ".", "hasNext", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingLongValue", "(", ")", "{", "String", "longValue", "=", "\"", "b", "!", "!!", "$", "Q", "!", "!$", "ha", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!%", "#", "4", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "2", "!", "d", "!", "!!", "!#", "=", "IvZB", "!", "!", "2", ",", "F", "!", "!!", "!'", "=", "KqtH", "!", "!", "2", "-", "9", "!", "!!", "!\"", "+", "\"", "'=", "IvZM", "!", "!", "3f", ":", "!!", "!!", "$=", "HbQW", "!", "!", "3g", "'", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3g", "-", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3g1", "!", "!!", "!$", "=", "HbQW", "!", "!", "3g2", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3g5", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3g9", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gT", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gX", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3gY", "!", "!!", "!\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3gh", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gj", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gr", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gx", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3h", "!", "!!", "!!", "\"", "+", "\"", "$=", "HbQW", "!", "!", "3h", "$", "!!", "!!", "#=", "J", "^", "wI", "!", "!", "3h", "'", "!!", "!!", "$=", "HbQW", "!", "!", "3h", ",", "!!", "!!", "$=", "HbQW", "!", "!", "3h0", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3h1", "!", "!!", "!\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3h2", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h4", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h7", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h8", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3h", ":", "!!", "!!", "\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3h", "@", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3hB", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hC", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hL", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hQ", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3hS", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hU", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h", "[", "!!", "!!", "$=", "HbQW", "!", "!", "3h", "^", "!!", "!!", "$=", "HbQW", "!", "!", "3hd", "!", "!!", "!\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3he", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hf", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hg", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hh", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hi", "!", "!!", "!\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3hv", "!", "!!", "!$", "=", "HbQW", "!", "!", "3i", "/", "!!", "!!", "#=", "J", "^", "wI", "!", "!", "3i2", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3i3", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3i4", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3i7", "!", "!!", "!$", "=", "HbQW", "!", "!", "3i8", "!", "!!", "!$", "=", "HbQW", "!", "!", "3i9", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3i", "=", "!!", "!!", "#=", "J", "^", "wI", "!", "!", "3i", ">", "!!", "!!", "\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3iD", "!", "!!", "!$", "=", "HbQW", "!", "!", "3iF", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3iH", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3iM", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3iS", "!", "!!", "!\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3iU", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3iZ", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3i", "]", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3ig", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3ij", "!", "!!", "!\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3ik", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3il", "!", "!!", "!$", "=", "HbQW", "!", "!", "3in", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3ip", "!", "!!", "!$", "=", "HbQW", "!", "!", "3iq", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3it", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3ix", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3j", "!", "!!", "!!", "$=", "HbQW", "!", "!", "3j", "%", "!!", "!!", "$=", "HbQW", "!", "!", "3j", "'", "!!", "!!", "\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3j", "(", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "9mJ", "!", "!!", "!'", "=", "KqtH", "!", "!=", "SE", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!?", "VS", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "Zw", "`", "!!", "!!", "\"", "+", "\"", "%=", "KqtH", "!", "!", "j", "+", "C", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "j", "+", "M", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "j", "+", "a", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "j", ",", ".!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "n", ">", "M", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "!", "s1X", "!", "!!", "!$", "=", "MMyc", "!", "!", "s1_", "!", "!!", "!#", "=", "MN", "#", "O", "!", "!", "ypn", "!", "!!", "!'", "=", "KqtH", "!", "!", "ypr", "!", "!!", "!'", "=", "KqtH", "!", "#%", "h", "!", "!!", "!!", "\"", "+", "\"", "%=", "KqtH", "!", "#%", "o", "!", "!!", "!!", "'=", "KqtH", "!", "#)", "H6", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#*", "%'", "!!", "!!", "%=", "KqtH", "!", "#+", "k", "(", "!!", "!!", "'=", "KqtH", "!", "#-", "E", "!", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#", "1", ")", "w", "!", "!!", "!'", "=", "KqtH", "!", "#", "1", ")", "y", "!", "!!", "!'", "=", "KqtH", "!", "#", "1", "*", "M", "!", "!!", "!#", "=", "KqtH", "!", "#", "1", "*", "p", "!", "!!", "!'", "=", "KqtH", "!", "#", "14Q", "!", "!<", "N", "\"", "+", "\"", "C", "=", "MN", "(", "F", "!", "#", "14S", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16I", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16N", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16X", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16k", "!", "!<", "N", "\"", "+", "\"", "C", "=", "MN", "(", "F", "!", "#", "17", "@", "!!", "<", "NC", "=", "MN", "(", "F", "!", "#", "17A", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "1Cq", "!", "!!", "!'", "=", "KqtH", "!", "#", "7", ")", ",!", "!!", "!#", "=", "KqtH", "!", "#", "7", ")", "b", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#", "7Ww", "!", "!!", "!'", "=", "KqtH", "!", "#?", "cQ", "!", "!!", "!'", "=", "KqtH", "!", "#", "His", "!", "!!", "!'", "=", "KqtH", "!", "#", "Jrh", "!", "!!", "!'", "=", "KqtH", "!", "#", "O", "@", "M", "!", "!<", "N", "\"", "+", "\"", "C", "=", "MN", "(", "F", "!", "#", "O", "@", "O", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "OC6", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "Os", ".", "!!", "!!", "#=", "KqtH", "!", "#", "YOW", "!", "!!", "!#", "=", "H", "/", "Li", "!", "#", "Zat", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "ZbI", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zbc", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zbs", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zby", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zce", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "Zdc", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zea", "!", "!!", "!'", "=", "KqtH", "!", "#", "ZhI", "!", "!!", "!#", "=", "KqtH", "!", "#", "ZiD", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zis", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "Zj0", "!", "!!", "!#", "=", "KqtH", "!", "#", "Zj1", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zj", "[", "!!", "!!", "'=", "KqtH", "!", "#", "Zj", "]", "!!", "!!", "'=", "KqtH", "!", "#", "Zj", "^", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#", "Zjb", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zk", "!", "!!", "!!", "'=", "KqtH", "!", "#", "Zk6", "!", "!!", "!#", "=", "KqtH", "!", "#", "Zk9", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zk", "<", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#", "Zl", ">", "!!", "!!", "'=", "KqtH", "!", "#]", "9R", "!", "!!", "!$", "=", "H", "/", "Lt", "!", "#]", "I6", "!", "!!", "!#", "=", "KqtH", "!", "#]", "Z", "#", "!!", "!!", "%=", "KqtH", "!", "#^", "*", "N", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#^", ":", "m", "!", "!!", "!#", "=", "KqtH", "!", "#", "_", "*", "_", "!", "!!", "!%", "=", "J", "^", "wI", "!", "#`", "-", "7", "!", "!!", "!#", "=", "KqtH", "!", "#`", "T", ">", "!!", "!!", "'=", "KqtH", "!", "#`", "T", "?", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#`", "TA", "!", "!!", "!'", "=", "KqtH", "!", "#`", "TB", "!", "!!", "!'", "=", "KqtH", "!", "#`", "TG", "!", "!!", "!'", "=", "KqtH", "!", "#`", "TP", "!", "!!", "!#", "=", "KqtH", "!", "#`", "U", ",", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#`", "U", "/", "!!", "!!", "'=", "KqtH", "!", "#`", "U0", "!", "!!", "!#", "=", "KqtH", "!", "#`", "U9", "!", "!!", "!'", "=", "KqtH", "!", "#", "aEQ", "!", "!!", "!%", "=", "KqtH", "!", "#", "b", "<", ")!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "c9", "-", "!!", "!!", "%=", "KqtH", "!", "#", "dxC", "!", "!!", "!%", "=", "KqtH", "!", "#", "dxE", "!", "!!", "!%", "=", "KqtH", "!", "#", "ev", "$", "!!", "!!", "'=", "KqtH", "!", "#", "fBi", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#", "fBj", "!", "!!", "!'", "=", "KqtH", "!", "#", "fG", ")", "!!", "!!", "'=", "KqtH", "!", "#", "fG", "+", "!!", "!!", "'=", "KqtH", "!", "#", "g", "<", "d", "!", "!!", "!'", "=", "KqtH", "!", "#", "g", "<", "e", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "g", "=", "J", "!", "!!", "!'", "=", "KqtH", "!", "#", "gat", "!", "!!", "!#", "=", "KqtH", "!", "#", "s", "`", "D", "!", "!!", "!#", "=", "J_", "#", "p", "!", "#", "sg", "?", "!!", "!!", "#=", "J_", "#", "p", "!", "#", "t", "<", "a", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#", "t", "<", "c", "!", "!!", "!#", "=", "KqtH", "!", "#", "trY", "!", "!!", "!$", "=", "JiYj", "!", "#", "vA", "$", "!!", "!!", "'=", "KqtH", "!", "#", "xs_", "!", "!!", "!'", "=", "KqtH", "!", "$$", "rO", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "$$", "rP", "!", "!!", "!#", "=", "KqtH", "!", "$(", "!%", "!!", "!!", "'=", "KqtH", "!", "$)", "]", "o", "!", "!!", "!%", "=", "KqtH", "!", "$,", "@)", "!!", "!!", "'=", "KqtH", "!", "$,", "k", "]", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "$", "1", "]", "+!", "!!", "!%", "=", "KqtH", "!", "$", "3IO", "!", "!!", "!%", "=", "KqtH", "!", "$", "3J", "#", "!!", "!!", "'=", "KqtH", "!", "$", "3J", ".", "!!", "!!", "'=", "KqtH", "!", "$", "3J", ":", "!!", "!!", "\"", "+", "\"", "#=", "KqtH", "!", "$", "3JH", "!", "!!", "!#", "=", "KqtH", "!", "$", "3JI", "!", "!!", "!#", "=", "KqtH", "!", "$", "3JK", "!", "!!", "!%", "=", "KqtH", "!", "$", "3JL", "!", "!!", "!'", "=", "KqtH", "!", "$", "3JS", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "$", "8", "+", "M", "!", "!!", "!#", "=", "KqtH", "!", "$", "99d", "!", "!!", "!%", "=", "KqtH", "!", "$:", "Lw", "!", "!!", "!#", "=", "LK", "+", "x", "!", "$:", "N", "@", "!!", "!!", "#=", "KqtG", "!", "$:", "NC", "!", "!!", "!\"", "+", "\"", "#=", "KqtG", "!", "$:", "hW", "!", "!!", "!'", "=", "KqtH", "!", "$:", "i", "[", "!!", "!!", "'=", "KqtH", "!", "$:", "ih", "!", "!!", "!'", "=", "KqtH", "!", "$:", "it", "!", "!!", "!'", "=", "KqtH", "!", "$:", "kO", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "$>", "*", "B", "!", "!!", "!'", "=", "KqtH", "!", "$>", "hD", "!", "!!", "!+", "=", "J", "^", "x0", "!", "$?", "lW", "!", "!!", "!'", "=", "KqtH", "!", "$?", "ll", "!", "!!", "!'", "=", "KqtH", "!", "$?", "lm", "!", "!!", "!\"", "+", "\"", "%=", "KqtH", "!", "$?", "mi", "!", "!!", "!'", "=", "KqtH", "!", "$?", "mx", "!", "!!", "!'", "=", "KqtH", "!", "$", "D7", "]", "!!", "!!", "#=", "J_", "#", "p", "!", "$", "D", "@", "T", "!", "!!", "!#", "=", "J_", "#", "p", "!", "$", "V", "<", "g", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "\"", "bh", "=", "\\\"", "\"", "+", "longValue", "+", "\"", "\\\"", ";\"", ");", "assertEquals", "(", "1", ",", "cookies", ".", "size", "(", "))", ";", "Cookie", "c", "=", "cookies", ".", "iterator", "(", ").", "next", "(", ");", "assertEquals", "(", "\"", "bh", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "longValue", ",", "c", ".", "value", "(", "))", ";", "}", "@", "Test", "public", "void", "testDecodingOldRFC2965Cookies", "(", ")", "{", "String", "source", "=", "\"", "$", "Version", "=", "\\\"", "1", "\\", "\";", "\"", "+", "\"", "Part_Number1", "=", "\\\"", "Riding_Rocket_0023", "\\", "\";", "$", "Path", "=", "\\\"", "/", "acme", "/", "ammo", "\\", "\";", "\"", "+", "\"", "Part_Number2", "=", "\\\"", "Rocket_Launcher_0001", "\\", "\";", "$", "Path", "=", "\\\"", "/", "acme", "\\", "\"\"", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "source", ")", ";", "Iterator", "<", "Cookie", ">", "it", "=", "cookies", ".", "iterator", "(", ");", "Cookie", "c", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "Part_Number1", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "Riding_Rocket_0023", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "Part_Number2", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "Rocket_Launcher_0001", "\"", ",", "c", ".", "value", "(", "))", ";", "assertFalse", "(", "it", ".", "hasNext", "(", "))", ";", "}", "}", "@", "@", "-", "13", ",", "7", "+", "13", ",", "7", "@", "@", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "import", "org", ".", "junit", ".", "Test", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "c1", ")", ";", "sources", ".", "add", "(", "\"", "c", "=", "\\\"", "\\\\", "\\\"", "1", "\\", "\\\\", "\"", "2", "\\", "\\\\", "\"\\", "\",", "\")", ";", "sources", ".", "add", "(", "\"", "d", "=", "\\\"", "1", "\\", "\\\\", "\"", "2", "\\", "\\\\", "\"", "3", "\\", "\",", "\")", ";", "sources", ".", "add", "(", "\"", "e", "=", "\\\"", "\\\\", "\\\"", "\\\\", "\\\"", "\\\"", ",\"", ");", "sources", ".", "add", "(", "\"", "f", "=", "\\\"", "1", "\\", "\\\\", "\"\\", "\\\\", "\"", "2", "\\", "\",", "\")", ";", "sources", ".", "add", "(", "\"", "g", "=", "\\\"", "\\\\", "\\\\", "\\\"", ",\"", ");", "sources", ".", "add", "(", "\"", "h", "=", "\\\"", "';", ",\\", "\\", "x", "\\", "\"\"", ");", "cookies", ".", "add", "(", "ClientCookieDecoder", ".", "decode", "(", "source", ")", ");", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "c", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\\", "\"", "1", "\\", "\"", "2", "\\", "\"\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "d", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "1", "\\", "\"", "2", "\\", "\"", "3", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "e", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\\", "\"\\", "\"\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "f", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "1", "\\", "\"\\", "\"", "2", "\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "g", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"\\", "\\\"", ",", "c", ".", "value", "(", "))", ";", "c", "=", "it", ".", "next", "(", ");", "assertEquals", "(", "\"", "h", "\"", ",", "c", ".", "name", "(", "))", ";", "assertEquals", "(", "\"'", ";,", "\\\\", "x", "\"", ",", "c", ".", "value", "(", "))", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "source", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "source", ")", ";", "public", "void", "testDecodingValueWithComma", "(", ")", "{", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "source", ")", ";", "assertEquals", "(", "\"", "timeZoneName", "=", "(", "GMT", "+", "04", ":", "00", ")", "Moscow", ",", "St", ".", "Petersburg", ",", "Volgograd", "&", "promocode", "=", "&", "region", "=", "BE", "\"", ",", "cookie", ".", "value", "(", "))", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "src", ")", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "src", ")", ";", "public", "void", "testDecodingValuesWithCommasAndEquals", "(", ")", "{", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "src", ")", ";", "assertEquals", "(", "\"", "A", "\"", ",", "cookie", ".", "name", "(", "))", ";", "assertEquals", "(", "\"", "v", "=", "1", "&", "lg", "=", "en", "-", "US", ",", "it", "-", "IT", ",", "it", "&", "intl", "=", "it", "&", "np", "=", "1", "\"", ",", "cookie", ".", "value", "(", "))", ";", "String", "longValue", "=", "\"", "b", "!", "!!", "$", "Q", "!", "!$", "ha", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!%", "#", "4", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "2", "!", "d", "!", "!!", "!#", "=", "IvZB", "!", "!", "2", ",", "F", "!", "!!", "!'", "=", "KqtH", "!", "!", "2", "-", "9", "!", "!!", "!\"", "+", "\"", "'=", "IvZM", "!", "!", "3f", ":", "!!", "!!", "$=", "HbQW", "!", "!", "3g", "'", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3g", "-", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3g1", "!", "!!", "!$", "=", "HbQW", "!", "!", "3g2", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3g5", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3g9", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gT", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gX", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3gY", "!", "!!", "!\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3gh", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gj", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gr", "!", "!!", "!$", "=", "HbQW", "!", "!", "3gx", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3h", "!", "!!", "!!", "\"", "+", "\"", "$=", "HbQW", "!", "!", "3h", "$", "!!", "!!", "#=", "J", "^", "wI", "!", "!", "3h", "'", "!!", "!!", "$=", "HbQW", "!", "!", "3h", ",", "!!", "!!", "$=", "HbQW", "!", "!", "3h0", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3h1", "!", "!!", "!\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3h2", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h4", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h7", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h8", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3h", ":", "!!", "!!", "\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3h", "@", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3hB", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hC", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hL", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hQ", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3hS", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hU", "!", "!!", "!$", "=", "HbQW", "!", "!", "3h", "[", "!!", "!!", "$=", "HbQW", "!", "!", "3h", "^", "!!", "!!", "$=", "HbQW", "!", "!", "3hd", "!", "!!", "!\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3he", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hf", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hg", "!", "!!", "!$", "=", "HbQW", "!", "!", "3hh", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3hi", "!", "!!", "!\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3hv", "!", "!!", "!$", "=", "HbQW", "!", "!", "3i", "/", "!!", "!!", "#=", "J", "^", "wI", "!", "!", "3i2", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3i3", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3i4", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3i7", "!", "!!", "!$", "=", "HbQW", "!", "!", "3i8", "!", "!!", "!$", "=", "HbQW", "!", "!", "3i9", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3i", "=", "!!", "!!", "#=", "J", "^", "wI", "!", "!", "3i", ">", "!!", "!!", "\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3iD", "!", "!!", "!$", "=", "HbQW", "!", "!", "3iF", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3iH", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3iM", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3iS", "!", "!!", "!\"", "+", "\"", "#=", "J", "^", "wI", "!", "!", "3iU", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3iZ", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3i", "]", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "3ig", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3ij", "!", "!!", "!\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3ik", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3il", "!", "!!", "!$", "=", "HbQW", "!", "!", "3in", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3ip", "!", "!!", "!$", "=", "HbQW", "!", "!", "3iq", "!", "!!", "!\"", "+", "\"", "$=", "HbQW", "!", "!", "3it", "!", "!!", "!%", "=", "J", "^", "wI", "!", "!", "3ix", "!", "!!", "!#", "=", "J", "^", "wI", "!", "!", "3j", "!", "!!", "!!", "$=", "HbQW", "!", "!", "3j", "%", "!!", "!!", "$=", "HbQW", "!", "!", "3j", "'", "!!", "!!", "\"", "+", "\"", "%=", "J", "^", "wI", "!", "!", "3j", "(", "!!", "!!", "%=", "J", "^", "wI", "!", "!", "9mJ", "!", "!!", "!'", "=", "KqtH", "!", "!=", "SE", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!?", "VS", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "Zw", "`", "!!", "!!", "\"", "+", "\"", "%=", "KqtH", "!", "!", "j", "+", "C", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "j", "+", "M", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "j", "+", "a", "!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "j", ",", ".!", "!<", "NC", "=", "MN", "(", "F", "!", "!", "n", ">", "M", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "!", "s1X", "!", "!!", "!$", "=", "MMyc", "!", "!", "s1_", "!", "!!", "!#", "=", "MN", "#", "O", "!", "!", "ypn", "!", "!!", "!'", "=", "KqtH", "!", "!", "ypr", "!", "!!", "!'", "=", "KqtH", "!", "#%", "h", "!", "!!", "!!", "\"", "+", "\"", "%=", "KqtH", "!", "#%", "o", "!", "!!", "!!", "'=", "KqtH", "!", "#)", "H6", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#*", "%'", "!!", "!!", "%=", "KqtH", "!", "#+", "k", "(", "!!", "!!", "'=", "KqtH", "!", "#-", "E", "!", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#", "1", ")", "w", "!", "!!", "!'", "=", "KqtH", "!", "#", "1", ")", "y", "!", "!!", "!'", "=", "KqtH", "!", "#", "1", "*", "M", "!", "!!", "!#", "=", "KqtH", "!", "#", "1", "*", "p", "!", "!!", "!'", "=", "KqtH", "!", "#", "14Q", "!", "!<", "N", "\"", "+", "\"", "C", "=", "MN", "(", "F", "!", "#", "14S", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16I", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16N", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16X", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "16k", "!", "!<", "N", "\"", "+", "\"", "C", "=", "MN", "(", "F", "!", "#", "17", "@", "!!", "<", "NC", "=", "MN", "(", "F", "!", "#", "17A", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "1Cq", "!", "!!", "!'", "=", "KqtH", "!", "#", "7", ")", ",!", "!!", "!#", "=", "KqtH", "!", "#", "7", ")", "b", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#", "7Ww", "!", "!!", "!'", "=", "KqtH", "!", "#?", "cQ", "!", "!!", "!'", "=", "KqtH", "!", "#", "His", "!", "!!", "!'", "=", "KqtH", "!", "#", "Jrh", "!", "!!", "!'", "=", "KqtH", "!", "#", "O", "@", "M", "!", "!<", "N", "\"", "+", "\"", "C", "=", "MN", "(", "F", "!", "#", "O", "@", "O", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "OC6", "!", "!<", "NC", "=", "MN", "(", "F", "!", "#", "Os", ".", "!!", "!!", "#=", "KqtH", "!", "#", "YOW", "!", "!!", "!#", "=", "H", "/", "Li", "!", "#", "Zat", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "ZbI", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zbc", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zbs", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zby", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zce", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "Zdc", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zea", "!", "!!", "!'", "=", "KqtH", "!", "#", "ZhI", "!", "!!", "!#", "=", "KqtH", "!", "#", "ZiD", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zis", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "Zj0", "!", "!!", "!#", "=", "KqtH", "!", "#", "Zj1", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zj", "[", "!!", "!!", "'=", "KqtH", "!", "#", "Zj", "]", "!!", "!!", "'=", "KqtH", "!", "#", "Zj", "^", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#", "Zjb", "!", "!!", "!'", "=", "KqtH", "!", "#", "Zk", "!", "!!", "!!", "'=", "KqtH", "!", "#", "Zk6", "!", "!!", "!#", "=", "KqtH", "!", "#", "Zk9", "!", "!!", "!%", "=", "KqtH", "!", "#", "Zk", "<", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#", "Zl", ">", "!!", "!!", "'=", "KqtH", "!", "#]", "9R", "!", "!!", "!$", "=", "H", "/", "Lt", "!", "#]", "I6", "!", "!!", "!#", "=", "KqtH", "!", "#]", "Z", "#", "!!", "!!", "%=", "KqtH", "!", "#^", "*", "N", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#^", ":", "m", "!", "!!", "!#", "=", "KqtH", "!", "#", "_", "*", "_", "!", "!!", "!%", "=", "J", "^", "wI", "!", "#`", "-", "7", "!", "!!", "!#", "=", "KqtH", "!", "#`", "T", ">", "!!", "!!", "'=", "KqtH", "!", "#`", "T", "?", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#`", "TA", "!", "!!", "!'", "=", "KqtH", "!", "#`", "TB", "!", "!!", "!'", "=", "KqtH", "!", "#`", "TG", "!", "!!", "!'", "=", "KqtH", "!", "#`", "TP", "!", "!!", "!#", "=", "KqtH", "!", "#`", "U", ",", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "#`", "U", "/", "!!", "!!", "'=", "KqtH", "!", "#`", "U0", "!", "!!", "!#", "=", "KqtH", "!", "#`", "U9", "!", "!!", "!'", "=", "KqtH", "!", "#", "aEQ", "!", "!!", "!%", "=", "KqtH", "!", "#", "b", "<", ")!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "c9", "-", "!!", "!!", "%=", "KqtH", "!", "#", "dxC", "!", "!!", "!%", "=", "KqtH", "!", "#", "dxE", "!", "!!", "!%", "=", "KqtH", "!", "#", "ev", "$", "!!", "!!", "'=", "KqtH", "!", "#", "fBi", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#", "fBj", "!", "!!", "!'", "=", "KqtH", "!", "#", "fG", ")", "!!", "!!", "'=", "KqtH", "!", "#", "fG", "+", "!!", "!!", "'=", "KqtH", "!", "#", "g", "<", "d", "!", "!!", "!'", "=", "KqtH", "!", "#", "g", "<", "e", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "#", "g", "=", "J", "!", "!!", "!'", "=", "KqtH", "!", "#", "gat", "!", "!!", "!#", "=", "KqtH", "!", "#", "s", "`", "D", "!", "!!", "!#", "=", "J_", "#", "p", "!", "#", "sg", "?", "!!", "!!", "#=", "J_", "#", "p", "!", "#", "t", "<", "a", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "#", "t", "<", "c", "!", "!!", "!#", "=", "KqtH", "!", "#", "trY", "!", "!!", "!$", "=", "JiYj", "!", "#", "vA", "$", "!!", "!!", "'=", "KqtH", "!", "#", "xs_", "!", "!!", "!'", "=", "KqtH", "!", "$$", "rO", "!", "!!", "!\"", "+", "\"", "#=", "KqtH", "!", "$$", "rP", "!", "!!", "!#", "=", "KqtH", "!", "$(", "!%", "!!", "!!", "'=", "KqtH", "!", "$)", "]", "o", "!", "!!", "!%", "=", "KqtH", "!", "$,", "@)", "!!", "!!", "'=", "KqtH", "!", "$,", "k", "]", "!!", "!!", "\"", "+", "\"", "'=", "KqtH", "!", "$", "1", "]", "+!", "!!", "!%", "=", "KqtH", "!", "$", "3IO", "!", "!!", "!%", "=", "KqtH", "!", "$", "3J", "#", "!!", "!!", "'=", "KqtH", "!", "$", "3J", ".", "!!", "!!", "'=", "KqtH", "!", "$", "3J", ":", "!!", "!!", "\"", "+", "\"", "#=", "KqtH", "!", "$", "3JH", "!", "!!", "!#", "=", "KqtH", "!", "$", "3JI", "!", "!!", "!#", "=", "KqtH", "!", "$", "3JK", "!", "!!", "!%", "=", "KqtH", "!", "$", "3JL", "!", "!!", "!'", "=", "KqtH", "!", "$", "3JS", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "$", "8", "+", "M", "!", "!!", "!#", "=", "KqtH", "!", "$", "99d", "!", "!!", "!%", "=", "KqtH", "!", "$:", "Lw", "!", "!!", "!#", "=", "LK", "+", "x", "!", "$:", "N", "@", "!!", "!!", "#=", "KqtG", "!", "$:", "NC", "!", "!!", "!\"", "+", "\"", "#=", "KqtG", "!", "$:", "hW", "!", "!!", "!'", "=", "KqtH", "!", "$:", "i", "[", "!!", "!!", "'=", "KqtH", "!", "$:", "ih", "!", "!!", "!'", "=", "KqtH", "!", "$:", "it", "!", "!!", "!'", "=", "KqtH", "!", "$:", "kO", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "!", "$>", "*", "B", "!", "!!", "!'", "=", "KqtH", "!", "$>", "hD", "!", "!!", "!+", "=", "J", "^", "x0", "!", "$?", "lW", "!", "!!", "!'", "=", "KqtH", "!", "$?", "ll", "!", "!!", "!'", "=", "KqtH", "!", "$?", "lm", "!", "!!", "!\"", "+", "\"", "%=", "KqtH", "!", "$?", "mi", "!", "!!", "!'", "=", "KqtH", "!", "$?", "mx", "!", "!!", "!'", "=", "KqtH", "!", "$", "D7", "]", "!!", "!!", "#=", "J_", "#", "p", "!", "$", "D", "@", "T", "!", "!!", "!#", "=", "J_", "#", "p", "!", "$", "V", "<", "g", "!", "!!", "!\"", "+", "\"", "'=", "KqtH", "\"", ";", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "\"", "bh", "=", "\\\"", "\"", "+", "longValue", "Cookie", "cookie", "=", "ClientCookieDecoder", ".", "decode", "(", "emptyDomain", ")", ";", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "cookie", ".", "setVersion", "(", "1", ")", ";", "cookie", ".", "setComment", "(", "\"", "this", "is", "a", "Comment", "\"", ");", "cookie", ".", "setCommentUrl", "(", "\"", "http", ":", "//", "aurl", ".", "com", "\"", ");", "cookie", ".", "setDiscard", "(", "true", ")", ";", "cookie", ".", "setPorts", "(", "80", ",", "8080", ")", ";", "cookie2", ".", "setVersion", "(", "1", ")", ";", "cookie2", ".", "setComment", "(", "\"", "this", "is", "another", "Comment", "\"", ");", "cookie2", ".", "setCommentUrl", "(", "\"", "http", ":", "//", "anotherurl", ".", "com", "\"", ");", "cookie2", ".", "setDiscard", "(", "false", ")", ";", "cookie3", ".", "setVersion", "(", "1", ")", ";", "String", "encodedCookie", "=", "ClientCookieEncoder", ".", "encode", "(", "cookie", ",", "cookie2", ",", "cookie3", ")", ";", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ";", "String", "encodedCookie", "=", "ServerCookieEncoder", ".", "encode", "(", "cookie", ")", ";", "String", "encodedCookie1", "=", "ClientCookieEncoder", ".", "encode", "(", ");", "List", "<", "String", ">", "encodedCookie2", "=", "ServerCookieEncoder", ".", "encode", "(", ");", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "ClientCookieEncoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "DefaultCookie", ";", "ClientCookieEncoder", ".", "encode", "(", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "Cookie", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "ServerCookieDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "ServerCookieEncoder", ";", "Set", "<", "Cookie", ">", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "cookieString", ")", ";", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "encode", "(", "cookie", ")", ");", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "encode", "(", "\"", "key1", "\"", ",", "\"", "value1", "\"", "))", ";", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "encode", "(", "\"", "key2", "\"", ",", "\"", "value2", "\"", "))", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "ClientCookieEncoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "DefaultCookie", ";", "HttpHeaderNames", ".", "COOKIE", ",", "ClientCookieEncoder", ".", "encode", "(", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "Cookie", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "ServerCookieDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http", ".", "ServerCookieEncoder", ";", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "value", ")", ";", "cookies", "=", "ServerCookieDecoder", ".", "decode", "(", "value", ")", ";", "response", ".", "headers", "(", ").", "add", "(", "HttpHeaderNames", ".", "SET_COOKIE", ",", "ServerCookieEncoder", ".", "encode", "(", "cookie", ")", ");"], "docstring_tokens": ["the", "improper", "validation", "of", "characters", "in", "a", "cookie", "name"]}
{"contents": ["Wrap", "trustmanager", "in", "custom", "trustmanager", "Signed-off-by:", "Priyata", "Agrawal", "<pagrawal@pivotal.io>"], "code_tokens": ["-", ".", "/", "gradlew", "-", "Dspring", ".", "profiles", ".", "active", "=", "$", "TESTENV", "-", "Djavax", ".", "net", ".", "ssl", ".", "trustStore", "=", "$", "TRAVIS_BUILD_DIR", "/", "scripts", "/", "ldap", "/", "truststore", "-", "with", "-", "ldap", "-", "certs", ".", "jks", "-", "Djavax", ".", "net", ".", "ssl", ".", "trustStoreType", "=", "JKS", "jacocoRootReport", "import", "java", ".", "security", ".", "KeyManagementException", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "public", "static", "final", "String", "EXPIRY_CHECKING_SOCKET_FACTORY", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "LdapSocketFactory", "\"", ";", "public", "Map", "process", "(", "Map", "map", ")", "throws", "KeyManagementException", ",", "NoSuchAlgorithmException", "{", "if", "(", "isLdapsUrl", "(", "))", "{", "if", "(", "isDisableSslVerification", "(", "))", "{", "result", ".", "put", "(", "LDAP_SOCKET_FACTORY", ",", "SKIP_SSL_VERIFICATION_SOCKET_FACTORY", ")", ";", "}", "else", "{", "result", ".", "put", "(", "LDAP_SOCKET_FACTORY", ",", "EXPIRY_CHECKING_SOCKET_FACTORY", ")", ";", "}", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ";", "import", "javax", ".", "net", ".", "SocketFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLSocketFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "public", "class", "LdapSocketFactory", "extends", "SSLSocketFactory", "{", "private", "static", "SocketFactory", "instance", ";", "private", "SSLSocketFactory", "delegate", ";", "public", "static", "SocketFactory", "getDefault", "(", ")", "{", "if", "(", "instance", "=", "=", "null", ")", "{", "instance", "=", "new", "LdapSocketFactory", "(", ");", "}", "return", "instance", ";", "}", "public", "LdapSocketFactory", "(", ")", "{", "try", "{", "X509TrustManager", "trustManager", "=", "new", "X509ExpiryCheckingTrustManager", "(", ");", "TrustManager", "[", "]", "tma", "=", "new", "TrustManager", "[", "]{", "trustManager", "}", ";", "SSLContext", "sc", "=", "SSLContext", ".", "getInstance", "(", "\"", "TLS", "\"", ");", "sc", ".", "init", "(", "null", ",", "tma", ",", "new", "SecureRandom", "(", "))", ";", "this", ".", "delegate", "=", "sc", ".", "getSocketFactory", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "}", "}", "@", "Override", "public", "String", "[", "]", "getDefaultCipherSuites", "(", ")", "{", "return", "delegate", ".", "getDefaultCipherSuites", "(", ");", "}", "@", "Override", "public", "String", "[", "]", "getSupportedCipherSuites", "(", ")", "{", "return", "delegate", ".", "getSupportedCipherSuites", "(", ");", "}", "@", "Override", "public", "Socket", "createSocket", "(", "Socket", "socket", ",", "String", "s", ",", "int", "i", ",", "boolean", "b", ")", "throws", "IOException", "{", "return", "delegate", ".", "createSocket", "(", "socket", ",", "s", ",", "i", ",", "b", ")", ";", "}", "@", "Override", "public", "Socket", "createSocket", "(", "String", "s", ",", "int", "i", ")", "throws", "IOException", "{", "return", "delegate", ".", "createSocket", "(", "s", ",", "i", ")", ";", "}", "@", "Override", "public", "Socket", "createSocket", "(", "String", "s", ",", "int", "i", ",", "InetAddress", "inetAddress", ",", "int", "i1", ")", "throws", "IOException", "{", "return", "delegate", ".", "createSocket", "(", "s", ",", "i", ",", "inetAddress", ",", "i1", ")", ";", "}", "@", "Override", "public", "Socket", "createSocket", "(", "InetAddress", "inetAddress", ",", "int", "i", ")", "throws", "IOException", "{", "return", "delegate", ".", "createSocket", "(", "inetAddress", ",", "i", ")", ";", "}", "@", "Override", "public", "Socket", "createSocket", "(", "InetAddress", "inetAddress", ",", "int", "i", ",", "InetAddress", "inetAddress1", ",", "int", "i1", ")", "throws", "IOException", "{", "return", "delegate", ".", "createSocket", "(", "inetAddress", ",", "i", ",", "inetAddress1", ",", "i1", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManagerFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "java", ".", "security", ".", "KeyStoreException", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "public", "class", "X509ExpiryCheckingTrustManager", "implements", "X509TrustManager", "{", "private", "X509TrustManager", "delegate", ";", "public", "X509ExpiryCheckingTrustManager", "(", ")", "{", "try", "{", "TrustManagerFactory", "tmf", ";", "tmf", "=", "TrustManagerFactory", ".", "getInstance", "(", "TrustManagerFactory", ".", "getDefaultAlgorithm", "(", "))", ";", "tmf", ".", "init", "(", "(", "KeyStore", ")", "null", ")", ";", "X509TrustManager", "x509Tm", "=", "null", ";", "for", "(", "TrustManager", "tm", ":", "tmf", ".", "getTrustManagers", "(", "))", "{", "if", "(", "tm", "instanceof", "X509TrustManager", ")", "{", "x509Tm", "=", "(", "X509TrustManager", ")", "tm", ";", "break", ";", "}", "}", "delegate", "=", "x509Tm", ";", "}", "catch", "(", "NoSuchAlgorithmException", "|", "KeyStoreException", "e", ")", "{", "}", "}", "protected", "void", "setDelegate", "(", "X509TrustManager", "delegate", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "}", "@", "Override", "public", "void", "checkClientTrusted", "(", "X509Certificate", "[", "]", "x509Certificates", ",", "String", "s", ")", "throws", "CertificateException", "{", "if", "(", "delegate", "=", "=", "null", ")", "{", "throw", "new", "CertificateException", "(", ");", "}", "else", "{", "delegate", ".", "checkClientTrusted", "(", "x509Certificates", ",", "s", ")", ";", "}", "}", "@", "Override", "public", "void", "checkServerTrusted", "(", "X509Certificate", "[", "]", "x509Certificates", ",", "String", "s", ")", "throws", "CertificateException", "{", "if", "(", "delegate", "=", "=", "null", ")", "{", "throw", "new", "CertificateException", "(", ");", "}", "else", "{", "delegate", ".", "checkServerTrusted", "(", "x509Certificates", ",", "s", ")", ";", "}", "for", "(", "X509Certificate", "certificate", ":", "x509Certificates", ")", "{", "certificate", ".", "checkValidity", "(", ");", "}", "}", "@", "Override", "public", "X509Certificate", "[", "]", "getAcceptedIssuers", "(", ")", "{", "if", "(", "delegate", "!", "=", "null", ")", "{", "return", "delegate", ".", "getAcceptedIssuers", "(", ");", "}", "return", "new", "X509Certificate", "[", "0", "]", ";", "}", "}", "@", "@", "-", "35", ",", "4", "+", "35", ",", "15", "@", "@", "public", "void", "testProcess", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "process_whenSslValidationIsEnabled", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "properties", "=", "new", "HashMap", "<", ">(", ");", "ProcessLdapProperties", "process", "=", "new", "ProcessLdapProperties", "(", "\"", "ldap", ":", "//", "localhost", ":", "389", "\"", ",", "false", ")", ";", "assertNull", "(", "process", ".", "process", "(", "properties", ")", ".", "get", "(", "LDAP_SOCKET_FACTORY", ")", ");", "process", ".", "setDisableSslVerification", "(", "false", ")", ";", "assertNull", "(", "process", ".", "process", "(", "properties", ")", ".", "get", "(", "LDAP_SOCKET_FACTORY", ")", ");", "process", ".", "setBaseUrl", "(", "\"", "ldaps", ":", "//", "localhost", ":", "636", "\"", ");", "assertEquals", "(", "ProcessLdapProperties", ".", "EXPIRY_CHECKING_SOCKET_FACTORY", ",", "process", ".", "process", "(", "properties", ")", ".", "get", "(", "LDAP_SOCKET_FACTORY", ")", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "7", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "public", "class", "LdapSocketFactoryTest", "{", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "59", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "import", "org", ".", "springframework", ".", "security", ".", "saml", ".", "trust", ".", "X509TrustManager", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateExpiredException", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doNothing", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doThrow", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "public", "class", "X509ExpiryCheckingTrustManagerTest", "{", "@", "Test", "public", "void", "checkServerTrusted_throwsExceptionWhenCertIsExpired", "(", ")", "throws", "Exception", "{", "X509ExpiryCheckingTrustManager", "manager", "=", "new", "X509ExpiryCheckingTrustManager", "(", ");", "X509TrustManager", "mockedDelegate", "=", "Mockito", ".", "mock", "(", "X509TrustManager", ".", "class", ")", ";", "manager", ".", "setDelegate", "(", "mockedDelegate", ")", ";", "X509Certificate", "certificate", "=", "Mockito", ".", "mock", "(", "X509Certificate", ".", "class", ")", ";", "X509Certificate", "[", "]", "x509Certificates", "=", "{", "certificate", "}", ";", "doNothing", "(", ").", "when", "(", "mockedDelegate", ")", ".", "checkServerTrusted", "(", "x509Certificates", ",", "\"", "string", "\"", ");", "doThrow", "(", "new", "CertificateExpiredException", "(", "))", ".", "when", "(", "certificate", ")", ".", "checkValidity", "(", ");", "try", "{", "manager", ".", "checkServerTrusted", "(", "x509Certificates", ",", "\"", "string", "\"", ");", "Assert", ".", "fail", "(", ");", "}", "catch", "(", "CertificateExpiredException", "e", ")", "{", "verify", "(", "mockedDelegate", ")", ".", "checkServerTrusted", "(", "x509Certificates", ",", "\"", "string", "\"", ");", "verify", "(", "certificate", ")", ".", "checkValidity", "(", ");", "}", "}", "@", "Test", "public", "void", "checkClientTrusted_callsDelegate", "(", ")", "throws", "Exception", "{", "X509ExpiryCheckingTrustManager", "manager", "=", "new", "X509ExpiryCheckingTrustManager", "(", ");", "X509TrustManager", "mockedDelegate", "=", "Mockito", ".", "mock", "(", "X509TrustManager", ".", "class", ")", ";", "manager", ".", "setDelegate", "(", "mockedDelegate", ")", ";", "X509Certificate", "certificate", "=", "Mockito", ".", "mock", "(", "X509Certificate", ".", "class", ")", ";", "X509Certificate", "[", "]", "x509Certificates", "=", "{", "certificate", "}", ";", "doNothing", "(", ").", "when", "(", "mockedDelegate", ")", ".", "checkClientTrusted", "(", "x509Certificates", ",", "\"", "string", "\"", ");", "manager", ".", "checkClientTrusted", "(", "x509Certificates", ",", "\"", "string", "\"", ");", "verify", "(", "mockedDelegate", ")", ".", "checkClientTrusted", "(", "x509Certificates", ",", "\"", "string", "\"", ");", "}", "@", "Test", "public", "void", "checkAcceptedIssuers_callsDelegate", "(", ")", "throws", "Exception", "{", "X509ExpiryCheckingTrustManager", "manager", "=", "new", "X509ExpiryCheckingTrustManager", "(", ");", "X509TrustManager", "mockedDelegate", "=", "Mockito", ".", "mock", "(", "X509TrustManager", ".", "class", ")", ";", "manager", ".", "setDelegate", "(", "mockedDelegate", ")", ";", "manager", ".", "getAcceptedIssuers", "(", ");", "verify", "(", "mockedDelegate", ")", ".", "getAcceptedIssuers", "(", ");", "}", "}", "@", "@", "-", "1", ",", "8", "+", "1", ",", "8", "@", "@", "#", "Configuration", "in", "this", "file", "ixs", "overridden", "by", "an", "external", "file", "#", "spring_profiles", ":", "mysql", ",", "default", ",", "ldap", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "feature", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "ServerRunning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "ScreenshotOnFail", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "login", ".", "test", ".", "LoginServerClassRunner", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProvider", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "LdapIdentityProviderDefinition", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "UaaTestAccounts", ";", "import", "org", ".", "hamcrest", ".", "Matchers", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "openqa", ".", "selenium", ".", "By", ";", "import", "org", ".", "openqa", ".", "selenium", ".", "WebDriver", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Value", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "client", ".", "test", ".", "TestAccounts", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "import", "org", ".", "springframework", ".", "test", ".", "context", ".", "ContextConfiguration", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestOperations", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestTemplate", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ".", "doesSupportZoneDNS", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assume", ".", "assumeTrue", ";", "@", "RunWith", "(", "LoginServerClassRunner", ".", "class", ")", "@", "ContextConfiguration", "(", "classes", "=", "DefaultIntegrationTestConfig", ".", "class", ")", "public", "class", "LdapLoginIT", "{", "@", "Autowired", "@", "Rule", "public", "IntegrationTestRule", "integrationTestRule", ";", "@", "Rule", "public", "ScreenshotOnFail", "screenShootRule", "=", "new", "ScreenshotOnFail", "(", ");", "@", "Autowired", "RestOperations", "restOperations", ";", "@", "Autowired", "WebDriver", "webDriver", ";", "@", "Value", "(", "\"$", "{", "integration", ".", "test", ".", "base_url", "}", "\")", "String", "baseUrl", ";", "@", "Autowired", "TestClient", "testClient", ";", "ServerRunning", "serverRunning", "=", "ServerRunning", ".", "isRunning", "(", ");", "@", "Before", "public", "void", "clearWebDriverOfCookies", "(", ")", "throws", "Exception", "{", "screenShootRule", ".", "setWebDriver", "(", "webDriver", ")", ";", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "logout", ".", "do", "\"", ");", "webDriver", ".", "get", "(", "baseUrl", ".", "replace", "(", "\"", "localhost", "\"", ",", "\"", "testzone1", ".", "localhost", "\"", ")", "+", "\"", "/", "logout", ".", "do", "\"", ");", "webDriver", ".", "get", "(", "baseUrl", ".", "replace", "(", "\"", "localhost", "\"", ",", "\"", "testzone2", ".", "localhost", "\"", ")", "+", "\"", "/", "logout", ".", "do", "\"", ");", "webDriver", ".", "manage", "(", ").", "deleteAllCookies", "(", ");", "}", "@", "Test", "public", "void", "ldapLogin_withValidSelfSignedCert", "(", ")", "throws", "Exception", "{", "/", "/", "ensure", "we", "are", "able", "to", "resolve", "DNS", "for", "hostname", "testzone2", ".", "localhost", "assumeTrue", "(", "\"", "Expected", "testzone1", "/", "2", "/", "3", "/", "4", ".", "localhost", "to", "resolve", "to", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "doesSupportZoneDNS", "(", "))", ";", "String", "zoneId", "=", "\"", "testzone2", "\"", ";", "String", "zoneUrl", "=", "baseUrl", ".", "replace", "(", "\"", "localhost", "\"", ",", "\"", "testzone2", ".", "localhost", "\"", ");", "/", "/", "identity", "client", "token", "RestTemplate", "identityClient", "=", "IntegrationTestUtils", ".", "getClientCredentialsTemplate", "(", "IntegrationTestUtils", ".", "getClientCredentialsResource", "(", "baseUrl", ",", "new", "String", "[", "]{", "\"", "zones", ".", "write", "\"", ",", "\"", "zones", ".", "read", "\"", ",", "\"", "scim", ".", "zones", "\"", "},", "\"", "identity", "\"", ",", "\"", "identitysecret", "\"", ")", ")", ";", "/", "/", "admin", "client", "token", "-", "to", "create", "users", "RestTemplate", "adminClient", "=", "IntegrationTestUtils", ".", "getClientCredentialsTemplate", "(", "IntegrationTestUtils", ".", "getClientCredentialsResource", "(", "baseUrl", ",", "new", "String", "[", "0", "]", ",", "\"", "admin", "\"", ",", "\"", "adminsecret", "\"", ")", ")", ";", "/", "/", "create", "the", "zone", "IntegrationTestUtils", ".", "createZoneOrUpdateSubdomain", "(", "identityClient", ",", "baseUrl", ",", "zoneId", ",", "zoneId", ")", ";", "/", "/", "create", "a", "zone", "admin", "user", "String", "email", "=", "new", "RandomValueStringGenerator", "(", ").", "generate", "(", ")", "+", "\"@", "samltesting", ".", "org", "\"", ";", "ScimUser", "user", "=", "IntegrationTestUtils", ".", "createUser", "(", "adminClient", ",", "baseUrl", ",", "email", ",", "\"", "firstname", "\"", ",", "\"", "lastname", "\"", ",", "email", ",", "true", ")", ";", "IntegrationTestUtils", ".", "makeZoneAdmin", "(", "identityClient", ",", "baseUrl", ",", "user", ".", "getId", "(", "),", "zoneId", ")", ";", "/", "/", "get", "the", "zone", "admin", "token", "String", "zoneAdminToken", "=", "IntegrationTestUtils", ".", "getAuthorizationCodeToken", "(", "serverRunning", ",", "UaaTestAccounts", ".", "standard", "(", "serverRunning", ")", ",", "\"", "identity", "\"", ",", "\"", "identitysecret", "\"", ",", "email", ",", "\"", "secr3T", "\"", ");", "LdapIdentityProviderDefinition", "ldapIdentityProviderDefinition", "=", "LdapIdentityProviderDefinition", ".", "searchAndBindMapGroupToScopes", "(", "\"", "ldaps", ":", "//", "52", ".", "87", ".", "212", ".", "253", ":", "636", "/", "\",", "\"", "cn", "=", "admin", ",", "dc", "=", "test", ",", "dc", "=", "com", "\"", ",", "\"", "password", "\"", ",", "\"", "dc", "=", "test", ",", "dc", "=", "com", "\"", ",", "\"", "cn", "=", "{", "0", "}", "\",", "\"", "ou", "=", "scopes", ",", "dc", "=", "test", ",", "dc", "=", "com", "\"", ",", "\"", "member", "=", "{", "0", "}", "\",", "\"", "mail", "\"", ",", "null", ",", "false", ",", "true", ",", "true", ",", "100", ",", "false", ")", ";", "IdentityProvider", "provider", "=", "new", "IdentityProvider", "(", ");", "provider", ".", "setIdentityZoneId", "(", "zoneId", ")", ";", "provider", ".", "setType", "(", "OriginKeys", ".", "LDAP", ")", ";", "provider", ".", "setActive", "(", "true", ")", ";", "provider", ".", "setConfig", "(", "ldapIdentityProviderDefinition", ")", ";", "provider", ".", "setOriginKey", "(", "OriginKeys", ".", "LDAP", ")", ";", "provider", ".", "setName", "(", "\"", "simplesamlphp", "for", "uaa", "\"", ");", "provider", "=", "IntegrationTestUtils", ".", "createOrUpdateProvider", "(", "zoneAdminToken", ",", "baseUrl", ",", "provider", ")", ";", "webDriver", ".", "get", "(", "zoneUrl", "+", "\"", "/", "login", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "username", "\"", "))", ".", "sendKeys", "(", "\"", "marissa4", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "password", "\"", "))", ".", "sendKeys", "(", "\"", "ldap4", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "xpath", "(", "\"/", "/", "input", "[", "@", "value", "=", "'", "Sign", "in", "'", "]\"", "))", ".", "click", "(", ");", "assertThat", "(", "webDriver", ".", "findElement", "(", "By", ".", "cssSelector", "(", "\"", "h1", "\"", "))", ".", "getText", "(", "),", "Matchers", ".", "containsString", "(", "\"", "Where", "to", "\"", "))", ";", "}", "@", "Test", "public", "void", "ldapLogin_withExpiredSelfSignedCert", "(", ")", "throws", "Exception", "{", "/", "/", "ensure", "we", "are", "able", "to", "resolve", "DNS", "for", "hostname", "testzone1", ".", "localhost", "assumeTrue", "(", "\"", "Expected", "testzone1", "/", "2", "/", "3", "/", "4", ".", "localhost", "to", "resolve", "to", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "doesSupportZoneDNS", "(", "))", ";", "String", "zoneId", "=", "\"", "testzone1", "\"", ";", "String", "zoneUrl", "=", "baseUrl", ".", "replace", "(", "\"", "localhost", "\"", ",", "\"", "testzone1", ".", "localhost", "\"", ");", "/", "/", "identity", "client", "token", "RestTemplate", "identityClient", "=", "IntegrationTestUtils", ".", "getClientCredentialsTemplate", "(", "IntegrationTestUtils", ".", "getClientCredentialsResource", "(", "baseUrl", ",", "new", "String", "[", "]{", "\"", "zones", ".", "write", "\"", ",", "\"", "zones", ".", "read", "\"", ",", "\"", "scim", ".", "zones", "\"", "},", "\"", "identity", "\"", ",", "\"", "identitysecret", "\"", ")", ")", ";", "/", "/", "admin", "client", "token", "-", "to", "create", "users", "RestTemplate", "adminClient", "=", "IntegrationTestUtils", ".", "getClientCredentialsTemplate", "(", "IntegrationTestUtils", ".", "getClientCredentialsResource", "(", "baseUrl", ",", "new", "String", "[", "0", "]", ",", "\"", "admin", "\"", ",", "\"", "adminsecret", "\"", ")", ")", ";", "/", "/", "create", "the", "zone", "IntegrationTestUtils", ".", "createZoneOrUpdateSubdomain", "(", "identityClient", ",", "baseUrl", ",", "zoneId", ",", "zoneId", ")", ";", "/", "/", "create", "a", "zone", "admin", "user", "String", "email", "=", "new", "RandomValueStringGenerator", "(", ").", "generate", "(", ")", "+", "\"@", "samltesting", ".", "org", "\"", ";", "ScimUser", "user", "=", "IntegrationTestUtils", ".", "createUser", "(", "adminClient", ",", "baseUrl", ",", "email", ",", "\"", "firstname", "\"", ",", "\"", "lastname", "\"", ",", "email", ",", "true", ")", ";", "IntegrationTestUtils", ".", "makeZoneAdmin", "(", "identityClient", ",", "baseUrl", ",", "user", ".", "getId", "(", "),", "zoneId", ")", ";", "/", "/", "get", "the", "zone", "admin", "token", "String", "zoneAdminToken", "=", "IntegrationTestUtils", ".", "getAuthorizationCodeToken", "(", "serverRunning", ",", "UaaTestAccounts", ".", "standard", "(", "serverRunning", ")", ",", "\"", "identity", "\"", ",", "\"", "identitysecret", "\"", ",", "email", ",", "\"", "secr3T", "\"", ");", "LdapIdentityProviderDefinition", "ldapIdentityProviderDefinition", "=", "LdapIdentityProviderDefinition", ".", "searchAndBindMapGroupToScopes", "(", "\"", "ldaps", ":", "//", "52", ".", "20", ".", "5", ".", "106", ":", "636", "/", "\",", "\"", "cn", "=", "admin", ",", "dc", "=", "test", ",", "dc", "=", "com", "\"", ",", "\"", "password", "\"", ",", "\"", "dc", "=", "test", ",", "dc", "=", "com", "\"", ",", "\"", "cn", "=", "{", "0", "}", "\",", "\"", "ou", "=", "scopes", ",", "dc", "=", "test", ",", "dc", "=", "com", "\"", ",", "\"", "member", "=", "{", "0", "}", "\",", "\"", "mail", "\"", ",", "null", ",", "false", ",", "true", ",", "true", ",", "100", ",", "false", ")", ";", "IdentityProvider", "provider", "=", "new", "IdentityProvider", "(", ");", "provider", ".", "setIdentityZoneId", "(", "zoneId", ")", ";", "provider", ".", "setType", "(", "OriginKeys", ".", "LDAP", ")", ";", "provider", ".", "setActive", "(", "true", ")", ";", "provider", ".", "setConfig", "(", "ldapIdentityProviderDefinition", ")", ";", "provider", ".", "setOriginKey", "(", "OriginKeys", ".", "LDAP", ")", ";", "provider", ".", "setName", "(", "\"", "simplesamlphp", "for", "uaa", "\"", ");", "provider", "=", "IntegrationTestUtils", ".", "createOrUpdateProvider", "(", "zoneAdminToken", ",", "baseUrl", ",", "provider", ")", ";", "webDriver", ".", "get", "(", "zoneUrl", "+", "\"", "/", "login", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "username", "\"", "))", ".", "sendKeys", "(", "\"", "marissa4", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "password", "\"", "))", ".", "sendKeys", "(", "\"", "ldap4", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "xpath", "(", "\"/", "/", "input", "[", "@", "value", "=", "'", "Sign", "in", "'", "]\"", "))", ".", "click", "(", ");", "assertThat", "(", "webDriver", ".", "findElement", "(", "By", ".", "cssSelector", "(", "\"", "h1", "\"", "))", ".", "getText", "(", "),", "Matchers", ".", "containsString", "(", "\"", "Welcome", "to", "The", "Twiglet", "Zone", "[", "\"", "+", "zoneId", "+", "\"", "]!", "\")", ");", "}", "}</s>-", "mkdir", "-", "p", "$", "HOME", "/", "build", "/", "cloudfoundry", "/", "uaa", "/", "uaa", "/", "build", "/", "reports", "/", "tests", ".", "/", "gradlew", "-", "Dspring", ".", "profiles", ".", "active", "=", "$", "TESTENV", "jacocoRootReport", "-", ".", "/", "gradlew", "coveralls", "-", "for", "i", "in", "$", "(", "find", "$", "HOME", "/", "build", "/", "cloudfoundry", "/", "uaa", "/", "-", "name", "reports", "-", "type", "d", ")", ";", "do", "rm", "-", "rf", "$", "i", ";", "done", "@", "@", "-", "14", ",", "13", "+", "14", ",", "16", "@", "@", "public", "Map", "process", "(", "Map", "map", ")", "{", "if", "(", "isDisableSslVerification", "(", ")", "&", "&", "isLdapsUrl", "(", "))", "{", "result", ".", "put", "(", "LDAP_SOCKET_FACTORY", ",", "SKIP_SSL_VERIFICATION_SOCKET_FACTORY", ")", ";", "}", "#", "Configuration", "in", "this", "file", "is", "overridden", "by", "an", "external", "file", "#", "spring_profiles", ":", "mysql", ",", "default"], "docstring_tokens": ["improper", "validation", "of", "certificate", "expiration"]}
{"contents": ["BZ-1049109:", "escaping", "task", "name", "html", "inputs"], "code_tokens": ["import", "com", ".", "google", ".", "gwt", ".", "safehtml", ".", "shared", ".", "SafeHtmlUtils", ";", "view", ".", "getTaskIdAndName", "(", ").", "setText", "(", "SafeHtmlUtils", ".", "htmlEscape", "(", "String", ".", "valueOf", "(", "selectedTaskId", ")", "+", "\"", "-", "\"", "+", "selectedTaskName", ")", ");</s>view", ".", "getTaskIdAndName", "(", ").", "setText", "(", "String", ".", "valueOf", "(", "selectedTaskId", ")", "+", "\"", "-", "\"", "+", "selectedTaskName", ")", ";"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["SONAR-11305", "Return", "external", "identity", "only", "to", "sys", "admin", "in", "api/users/search"], "code_tokens": ["new", "Change", "(", "\"", "7", ".", "4", "\"", ",", "\"", "External", "identity", "is", "only", "returned", "to", "system", "administrators", "\"", "),", "setIfNeeded", "(", "FIELD_EXTERNAL_IDENTITY", ",", "fields", ",", "user", ".", "getExternalLogin", "(", "),", "userBuilder", ":", ":", "setExternalIdentity", ")", ";", "@", "Test", "public", "void", "return_external_information", "(", ")", "{", "UserDto", "user", "=", "db", ".", "users", "(", ").", "insertUser", "(", ");", "userIndexer", ".", "indexOnStartup", "(", "null", ")", ";", "userSession", ".", "logIn", "(", ").", "setSystemAdministrator", "(", ");", "SearchWsResponse", "response", "=", "ws", ".", "newRequest", "(", ")", ".", "executeProtobuf", "(", "SearchWsResponse", ".", "class", ")", ";", "assertThat", "(", "response", ".", "getUsersList", "(", "))", ".", "extracting", "(", "User", ":", ":", "getLogin", ",", "User", ":", ":", "getExternalIdentity", ",", "User", ":", ":", "getExternalProvider", ")", ".", "containsExactlyInAnyOrder", "(", "tuple", "(", "user", ".", "getLogin", "(", "),", "user", ".", "getExternalLogin", "(", "),", "user", ".", "getExternalIdentityProvider", "(", "))", ");", "}", "@", "Test", "public", "void", "return_external_identity_only_when_system_administer", "(", ")", "{", "UserDto", "user", "=", "db", ".", "users", "(", ").", "insertUser", "(", ");", "userIndexer", ".", "indexOnStartup", "(", "null", ")", ";", "userSession", ".", "logIn", "(", ").", "setSystemAdministrator", "(", ");", "assertThat", "(", "ws", ".", "newRequest", "(", ")", ".", "executeProtobuf", "(", "SearchWsResponse", ".", "class", ")", ".", "getUsersList", "(", "))", ".", "extracting", "(", "User", ":", ":", "getLogin", ",", "User", ":", ":", "getExternalIdentity", ")", ".", "containsExactlyInAnyOrder", "(", "tuple", "(", "user", ".", "getLogin", "(", "),", "user", ".", "getExternalLogin", "(", "))", ");", "userSession", ".", "logIn", "(", ");", "assertThat", "(", "ws", ".", "newRequest", "(", ")", ".", "executeProtobuf", "(", "SearchWsResponse", ".", "class", ")", ".", "getUsersList", "(", "))", ".", "extracting", "(", "User", ":", ":", "getLogin", ",", "User", ":", ":", "hasExternalIdentity", ")", ".", "containsExactlyInAnyOrder", "(", "tuple", "(", "user", ".", "getLogin", "(", "),", "false", ")", ");", "}</s>setIfNeeded", "(", "FIELD_EXTERNAL_IDENTITY", ",", "fields", ",", "user", ".", "getExternalLogin", "(", "),", "userBuilder", ":", ":", "setExternalIdentity", ")", ";"], "docstring_tokens": ["improperly", "configured", "access", "control"]}
{"contents": ["ALSA:", "usb-audio:", "Fix", "NULL", "dereference", "in", "create_fixed_stream_quirk()", "create_fixed_stream_quirk()", "may", "cause", "a", "NULL-pointer", "dereference", "by", "accessing", "the", "non-existing", "endpoint", "when", "a", "USB", "device", "with", "a", "malformed", "USB", "descriptor", "is", "used.", "This", "patch", "avoids", "it", "simply", "by", "adding", "a", "sanity", "check", "of", "bNumEndpoints", "before", "the", "accesses.", "Bugzilla:", "https://bugzilla.suse.com/show_bug.cgi?id=971125", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["if", "(", "altsd", "-", ">", "bNumEndpoints", "<", "1", ")", "{", "kfree", "(", "fp", ")", ";", "kfree", "(", "rate_table", ")", ";", "return", "-", "EINVAL", ";", "}</s>"], "docstring_tokens": ["no", "security", "patch", "was", "provided", "by", "the", "vendor", "."]}
{"contents": ["ext4:", "Fix", "insufficient", "checks", "in", "EXT4_IOC_MOVE_EXT", "This", "patch", "fixes", "three", "problems", "in", "the", "handling", "of", "the", "EXT4_IOC_MOVE_EXT", "ioctl:", "1.", "In", "current", "EXT4_IOC_MOVE_EXT,", "there", "are", "read", "access", "mode", "checks", "for", "original", "and", "donor", "files,", "but", "they", "allow", "the", "illegal", "write", "access", "to", "donor", "file,", "since", "donor", "file", "is", "overwritten", "by", "original", "file", "data.", "To", "fix", "this", "problem,", "change", "access", "mode", "checks", "of", "original", "(r->r/w)", "and", "donor", "(r->w)", "files.", "2.", "Disallow", "the", "use", "of", "donor", "files", "that", "have", "a", "setuid", "or", "setgid", "bits.", "3.", "Call", "mnt_want_write()", "and", "mnt_drop_write()", "before", "and", "after", "ext4_move_extents()", "calling", "to", "get", "write", "access", "to", "a", "mount.", "Signed-off-by:", "Akira", "Fujita", "<a-fujita@rs.jp.nec.com>", "Signed-off-by:", "\"Theodore", "Ts'o\"", "<tytso@mit.edu>"], "code_tokens": ["if", "(", "!(", "filp", "-", ">", "f_mode", "&", "FMODE_READ", ")", "|", "|", "!", "(", "filp", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", ")", "return", "-", "EBADF", ";", "me", ".", "moved_len", "=", "0", ";", "if", "(", "!(", "donor_filp", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", ")", "{", "err", "=", "-", "EBADF", ";", "goto", "mext_out", ";", "err", "=", "mnt_want_write", "(", "filp", "-", ">", "f_path", ".", "mnt", ")", ";", "if", "(", "err", ")", "goto", "mext_out", ";", "mnt_drop_write", "(", "filp", "-", ">", "f_path", ".", "mnt", ")", ";", "if", "(", "me", ".", "moved_len", ">", "0", ")", "file_remove_suid", "(", "donor_filp", ")", ";", "err", "=", "-", "EFAULT", ";", "mext_out", ":", "fput", "(", "donor_filp", ")", ";", "if", "(", "donor_inode", "-", ">", "i_mode", "&", "(", "S_ISUID", "|", "S_ISGID", ")", ")", "{", "ext4_debug", "(", "\"", "ext4", "move", "extent", ":", "suid", "or", "sgid", "is", "set", "\"", "\"", "to", "donor", "file", "[", "ino", ":", "orig", "%", "lu", ",", "donor", "%", "lu", "]", "\\", "n", "\"", ",", "orig_inode", "-", ">", "i_ino", ",", "donor_inode", "-", ">", "i_ino", ")", ";", "return", "-", "EINVAL", ";", "}</s>if", "(", "!", "capable", "(", "CAP_DAC_OVERRIDE", ")", ")", "{", "if", "(", "(", "current", "-", ">", "real_cred", "-", ">", "fsuid", "!", "=", "inode", "-", ">", "i_uid", ")", "|", "|", "!", "(", "inode", "-", ">", "i_mode", "&", "S_IRUSR", ")", "|", "|", "!", "(", "donor_filp", "-", ">", "f_dentry", "-", ">", "d_inode", "-", ">", "i_mode", "&", "S_IRUSR", ")", ")", "{", "fput", "(", "donor_filp", ")", ";", "return", "-", "EACCES", ";", "}", "me", ".", "moved_len", "=", "0", ";", "fput", "(", "donor_filp", ")", ";", "return", "-", "EFAULT", ";"], "docstring_tokens": ["the", "software", "fails", "to", "verify", "access", "permissions"]}
{"contents": ["drm/r128:", "Add", "test", "for", "initialisation", "to", "all", "ioctls", "that", "require", "it", "Almost", "all", "r128's", "private", "ioctls", "require", "that", "the", "CCE", "state", "has", "already", "been", "initialised.", "However,", "most", "do", "not", "test", "that", "this", "has", "been", "done,", "and", "will", "proceed", "to", "dereference", "a", "null", "pointer.", "This", "may", "result", "in", "a", "security", "vulnerability,", "since", "some", "ioctls", "are", "unprivileged.", "This", "adds", "a", "macro", "for", "the", "common", "initialisation", "test", "and", "changes", "all", "ioctl", "implementations", "that", "require", "prior", "initialisation", "to", "use", "that", "macro.", "Also,", "r128_do_init_cce()", "does", "not", "test", "that", "the", "CCE", "state", "has", "not", "been", "initialised", "already.", "Repeated", "initialisation", "may", "lead", "to", "a", "crash", "or", "resource", "leak.", "This", "adds", "that", "test.", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["if", "(", "dev", "-", ">", "dev_private", ")", "{", "DRM_DEBUG", "(", "\"", "called", "when", "already", "initialized", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev", "-", ">", "dev_private", ")", ";", "#", "define", "DEV_INIT_TEST_WITH_RETURN", "(", "_dev_priv", ")", "\\", "do", "{", "\\", "if", "(", "!", "_dev_priv", ")", "{", "\\", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "\\", "return", "-", "EINVAL", ";", "\\", "}", "\\", "}", "while", "(", "0", ")", "drm_r128_sarea_t", "*", "sarea_priv", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "sarea_priv", "=", "dev_priv", "-", ">", "sarea_priv", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";</s>if", "(", "!", "dev_priv", ")", "{", "DRM_DEBUG", "(", "\"", "called", "before", "init", "done", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "drm_r128_sarea_t", "*", "sarea_priv", "=", "dev_priv", "-", ">", "sarea_priv", ";", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}"], "docstring_tokens": ["improper", "verification", "of", "the", "Concurrent", "Command", "Engine", "(CCE", ")", "state", "initialization"]}
{"contents": ["isdn/i4l:", "fix", "buffer", "overflow", "This", "fixes", "a", "potential", "buffer", "overflow", "in", "isdn_net.c", "caused", "by", "an", "unbounded", "strcpy.", "[", "ISDN", "seems", "to", "be", "effectively", "unmaintained,", "and", "the", "I4L", "driver", "in", "particular", "is", "long", "deprecated,", "but", "in", "case", "somebody", "uses", "this..", "-", "Linus", "]", "Signed-off-by:", "Jiten", "Thakkar", "<jitenmt@gmail.com>", "Signed-off-by:", "Annie", "Cherkaev", "<annie.cherk@gmail.com>", "Cc:", "Karsten", "Keil", "<isdn@linux-pingi.de>", "Cc:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["bname", "[", "sizeof", "(", "bname", ")", "-", "1", "]", "=", "0", ";", "/", "*", "Slave", "-", "Name", "MUST", "not", "be", "empty", "or", "overflow", "'", "newname", "'", "*", "/", "if", "(", "strscpy", "(", "newname", ",", "p", "+", "1", ",", "sizeof", "(", "newname", ")", ")", "<", "=", "0", ")</s>/", "*", "Slave", "-", "Name", "MUST", "not", "be", "empty", "*", "/", "if", "(", "!", "strlen", "(", "p", "+", "1", ")", ")", "strcpy", "(", "newname", ",", "p", "+", "1", ")", ";"], "docstring_tokens": ["is", "copied", "into", "a", "local", "buffer", "of", "constant", "size", "using", "strcpy", "without", "a", "length", "check"]}
{"contents": ["Fix", "length", "of", "buffer", "copied", "in", "__nfs4_get_acl_uncached", "_copy_from_pages()", "used", "to", "copy", "data", "from", "the", "temporary", "buffer", "to", "the", "user", "passed", "buffer", "is", "passed", "the", "wrong", "size", "parameter", "when", "copying", "data.", "res.acl_len", "contains", "both", "the", "bitmap", "and", "acl", "lenghts", "while", "acl_len", "contains", "the", "acl", "length", "after", "adjusting", "for", "the", "bitmap", "size.", "Signed-off-by:", "Sachin", "Prabhu", "<sprabhu@redhat.com>", "Signed-off-by:", "Trond", "Myklebust", "<Trond.Myklebust@netapp.com>"], "code_tokens": ["acl_len", ")", ";</s>res", ".", "acl_len", ")", ";"], "docstring_tokens": ["the", "use", "of", "an", "incorrect", "length", "variable", "during", "a", "copy", "operation"]}
{"contents": ["add", "@POST", "and", "admin", "permission", "check", "to", "methods"], "code_tokens": ["import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "POST", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "POST", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "POST", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "POST", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";</s>"], "docstring_tokens": ["does", "not", "escape", "a", "tool", "path", "in", "the", "`checkVncServ", "`", "form", "validation", "endpoint", "accessed", "e.g", ".", "via", "job", "configuration", "forms"]}
{"contents": ["staging:", "wlags49_h2:", "buffer", "overflow", "setting", "station", "name", "We", "need", "to", "check", "the", "length", "parameter", "before", "doing", "the", "memcpy().", "I've", "actually", "changed", "it", "to", "strlcpy()", "as", "well", "so", "that", "it's", "NUL", "terminated.", "You", "need", "CAP_NET_ADMIN", "to", "trigger", "these", "so", "it's", "not", "the", "end", "of", "the", "world.", "Reported-by:", "Nico", "Golde", "<nico@ngolde.de>", "Reported-by:", "Fabian", "Yamaguchi", "<fabs@goesec.de>", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["size_t", "len", ";", "len", "=", "min_t", "(", "size_t", ",", "pLtv", "-", ">", "u", ".", "u16", "[", "0", "]", ",", "sizeof", "(", "lp", "-", ">", "StationName", ")", ");", "strlcpy", "(", "lp", "-", ">", "StationName", ",", "&", "pLtv", "-", ">", "u", ".", "u8", "[", "2", "]", ",", "len", ")", ";", "size_t", "len", ";", "len", "=", "min_t", "(", "size_t", ",", "wrqu", "-", ">", "data", ".", "length", ",", "sizeof", "(", "lp", "-", ">", "StationName", ")", ");", "strlcpy", "(", "lp", "-", ">", "StationName", ",", "extra", ",", "len", ")", ";</s>memcpy", "(", "(", "void", "*", ")", "lp", "-", ">", "StationName", ",", "(", "void", "*", ")&", "pLtv", "-", ">", "u", ".", "u8", "[", "2", "]", ",", "(", "size_t", ")", "pLtv", "-", ">", "u", ".", "u16", "[", "0", "]", ");", "memcpy", "(", "lp", "-", ">", "StationName", ",", "extra", ",", "wrqu", "-", ">", "data", ".", "length", ")", ";"], "docstring_tokens": ["uninitialized", "structure", "members"]}
{"contents": ["l2tp:", "Fix", "potential", "memory", "corruption", "in", "pppol2tp_recvmsg()", "This", "patch", "fixes", "a", "potential", "memory", "corruption", "in", "pppol2tp_recvmsg().", "If", "skb->len", "is", "bigger", "than", "the", "caller's", "buffer", "length,", "memcpy_toiovec()", "will", "go", "into", "unintialized", "data", "on", "the", "kernel", "heap,", "interpret", "it", "as", "an", "iovec", "and", "start", "modifying", "memory.", "The", "fix", "is", "to", "change", "the", "memcpy_toiovec()", "call", "to", "skb_copy_datagram_iovec()", "so", "that", "paged", "packets", "(rare", "for", "PPPOL2TP)", "are", "handled", "properly.", "Also", "check", "that", "the", "caller's", "buffer", "is", "big", "enough", "for", "the", "data", "and", "set", "the", "MSG_TRUNC", "flag", "if", "it", "is", "not", "so.", "Reported-by:", "Ilja", "<ilja@netric.org>", "Signed-off-by:", "James", "Chapman", "<jchapman@katalix.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "skb", ")", "goto", "end", ";", "if", "(", "len", ">", "skb", "-", ">", "len", ")", "len", "=", "skb", "-", ">", "len", ";", "else", "if", "(", "len", "<", "skb", "-", ">", "len", ")", "msg", "-", ">", "msg_flags", "|", "=", "MSG_TRUNC", ";", "err", "=", "skb_copy_datagram_iovec", "(", "skb", ",", "0", ",", "msg", "-", ">", "msg_iov", ",", "len", ")", ";", "if", "(", "likely", "(", "err", "=", "=", "0", ")", ")", "err", "=", "len", ";</s>if", "(", "skb", ")", "{", "err", "=", "memcpy_toiovec", "(", "msg", "-", ">", "msg_iov", ",", "(", "unsigned", "char", "*", ")", "skb", "-", ">", "data", ",", "skb", "-", ">", "len", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "do_skb_free", ";", "err", "=", "skb", "-", ">", "len", ";", "}", "do_skb_free", ":"], "docstring_tokens": ["improper", "bounds", "checking"]}
{"contents": ["nfsd4:", "fix", "null", "dereference", "creating", "nfsv4", "callback", "client", "On", "setting", "up", "the", "callback", "to", "the", "client,", "we", "attempt", "to", "use", "the", "same", "authentication", "flavor", "the", "client", "did.", "We", "find", "an", "rpc", "cred", "to", "use", "by", "calling", "rpcauth_lookup_credcache(),", "which", "assumes", "that", "the", "given", "authentication", "flavor", "has", "a", "credentials", "cache.", "However,", "this", "is", "not", "required", "to", "be", "true--in", "particular,", "auth_null", "does", "not", "use", "one.", "Instead,", "we", "should", "call", "the", "auth's", "lookup_cred()", "method.", "Without", "this,", "a", "client", "attempting", "to", "mount", "using", "nfsv4", "and", "auth_null", "triggers", "a", "null", "dereference.", "Cc:", "stable@kernel.org", "Signed-off-by:", "J.", "Bruce", "Fields", "<bfields@citi.umich.edu>"], "code_tokens": ["struct", "rpc_auth", "*", "auth", "=", "cb", "-", ">", "cb_client", "-", ">", "cl_auth", ";", "return", "auth", "-", ">", "au_ops", "-", ">", "lookup_cred", "(", "auth", ",", "&", "acred", ",", "RPCAUTH_LOOKUP_NEW", ")", ";</s>return", "rpcauth_lookup_credcache", "(", "cb", "-", ">", "cb_client", "-", ">", "cl_auth", ",", "&", "acred", ",", "RPCAUTH_LOOKUP_NEW", ")", ";"], "docstring_tokens": ["the", "attempt", "to", "access", "a", "credentials", "cache", "although", "the", "client", "has", "already", "specified", "the", "AUTH_NULL", "authentication", "flavor"]}
{"contents": ["Fix", "encrypt", "overflow", "An", "overflow", "can", "occur", "in", "the", "EVP_EncryptUpdate", "function.", "If", "an", "attacker", "is", "able", "to", "supply", "very", "large", "amounts", "of", "input", "data", "after", "a", "previous", "call", "to", "EVP_EncryptUpdate", "with", "a", "partial", "block", "then", "a", "length", "check", "can", "overflow", "resulting", "in", "a", "heap", "corruption.", "Following", "an", "analysis", "of", "all", "OpenSSL", "internal", "usage", "of", "the", "EVP_EncryptUpdate", "function", "all", "usage", "is", "one", "of", "two", "forms.", "The", "first", "form", "is", "like", "this:", "EVP_EncryptInit()", "EVP_EncryptUpdate()", "i.e.", "where", "the", "EVP_EncryptUpdate()", "call", "is", "known", "to", "be", "the", "first", "called", "function", "after", "an", "EVP_EncryptInit(),", "and", "therefore", "that", "specific", "call", "must", "be", "safe.", "The", "second", "form", "is", "where", "the", "length", "passed", "to", "EVP_EncryptUpdate()", "can", "be", "seen", "from", "the", "code", "to", "be", "some", "small", "value", "and", "therefore", "there", "is", "no", "possibility", "of", "an", "overflow.", "Since", "all", "instances", "are", "one", "of", "these", "two", "forms,", "I", "believe", "that", "there", "can", "be", "no", "overflows", "in", "internal", "code", "due", "to", "this", "problem.", "It", "should", "be", "noted", "that", "EVP_DecryptUpdate()", "can", "call", "EVP_EncryptUpdate()", "in", "certain", "code", "paths.", "Also", "EVP_CipherUpdate()", "is", "a", "synonym", "for", "EVP_EncryptUpdate().", "Therefore", "I", "have", "checked", "all", "instances", "of", "these", "calls", "too,", "and", "came", "to", "the", "same", "conclusion,", "i.e.", "there", "are", "no", "instances", "in", "internal", "usage", "where", "an", "overflow", "could", "occur.", "This", "could", "still", "represent", "a", "security", "issue", "for", "end", "user", "code", "that", "calls", "this", "function", "directly.", "Issue", "reported", "by", "Guido", "Vranken.", "Reviewed-by:", "Tim", "Hudson", "<tjh@openssl.org>"], "code_tokens": ["if", "(", "bl", "-", "i", ">", "inl", ")", "{</s>if", "(", "i", "+", "inl", "<", "bl", ")", "{"], "docstring_tokens": ["making", "sure", "that", "always", "the", "same", "bytes", "are", "read", "and", "compared", "against", "either", "the", "MAC", "or", "padding", "bytes"]}
{"contents": ["atl2:", "Disable", "unimplemented", "scatter/gather", "feature", "atl2", "includes", "NETIF_F_SG", "in", "hw_features", "even", "though", "it", "has", "no", "support", "for", "non-linear", "skbs.", "This", "bug", "was", "originally", "harmless", "since", "the", "driver", "does", "not", "claim", "to", "implement", "checksum", "offload", "and", "that", "used", "to", "be", "a", "requirement", "for", "SG.", "Now", "that", "SG", "and", "checksum", "offload", "are", "independent", "features,", "if", "you", "explicitly", "enable", "SG", "*and*", "use", "one", "of", "the", "rare", "protocols", "that", "can", "use", "SG", "without", "checkusm", "offload,", "this", "potentially", "leaks", "sensitive", "information", "(before", "you", "notice", "that", "it", "just", "isn't", "working).", "Therefore", "this", "obscure", "bug", "has", "been", "designated", ".", "Reported-by:", "Justin", "Yackoski", "<jyackoski@crypto-nite.com>", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Fixes:", "ec5f06156423", "(\"net:", "Kill", "link", "between", "CSUM", "and", "SG", "features.\")", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["netdev", "-", ">", "hw_features", "=", "NETIF_F_HW_VLAN_CTAG_RX", ";</s>netdev", "-", ">", "hw_features", "=", "NETIF_F_SG", "|", "NETIF_F_HW_VLAN_CTAG_RX", ";"], "docstring_tokens": ["incorrectly", "enables", "scatter/gather", "I/O"]}
{"contents": ["USB:", "mct_u232:", "add", "sanity", "checking", "in", "probe", "An", "attack", "using", "the", "lack", "of", "sanity", "checking", "in", "probe", "is", "known.", "This", "patch", "checks", "for", "the", "existence", "of", "a", "second", "port.", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "CC:", "stable@vger.kernel.org", "[johan:", "add", "error", "message", "]", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["struct", "usb_serial", "*", "serial", "=", "port", "-", ">", "serial", ";", "/", "*", "check", "first", "to", "simplify", "error", "handling", "*", "/", "if", "(", "!", "serial", "-", ">", "port", "[", "1", "]", "|", "|", "!", "serial", "-", ">", "port", "[", "1", "]", "->", "interrupt_in_urb", ")", "{", "dev_err", "(", "&", "port", "-", ">", "dev", ",", "\"", "expected", "endpoint", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "priv", "-", ">", "read_urb", "=", "serial", "-", ">", "port", "[", "1", "]", "->", "interrupt_in_urb", ";</s>priv", "-", ">", "read_urb", "=", "port", "-", ">", "serial", "-", ">", "port", "[", "1", "]", "->", "interrupt_in_urb", ";"], "docstring_tokens": ["no", "security", "patch", "was", "provided", "by", "the", "vendor", "."]}
{"contents": ["[SPARK-20922][CORE][HOTFIX]", "Don't", "use", "Java", "8", "lambdas", "in", "older", "branches.", "Author:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>", "Closes", "#18178", "from", "vanzin/SPARK-20922-hotfix."], "code_tokens": ["boolean", "isValid", "=", "false", ";", "for", "(", "String", "p", ":", "ALLOWED_PACKAGES", ")", "{", "if", "(", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ")", "{", "isValid", "=", "true", ";", "break", ";", "}", "}</s>boolean", "isValid", "=", "ALLOWED_PACKAGES", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ");"], "docstring_tokens": ["performs", "unsafe", "deserialization", "of", "data", "received", "by", "its", "socket", "."]}
{"contents": ["ocfs2:", "subsystem.su_mutex", "is", "required", "while", "accessing", "the", "item->ci_parent", "The", "subsystem.su_mutex", "is", "required", "while", "accessing", "the", "item->ci_parent,", "otherwise,", "NULL", "pointer", "dereference", "to", "the", "item->ci_parent", "will", "be", "triggered", "in", "the", "following", "situation:", "add", "node", "delete", "node", "sys_write", "vfs_write", "configfs_write_file", "o2nm_node_store", "o2nm_node_local_write", "do_rmdir", "vfs_rmdir", "configfs_rmdir", "mutex_lock(&subsys->su_mutex);", "unlink_obj", "item->ci_group", "=", "NULL;", "item->ci_parent", "=", "NULL;", "to_o2nm_cluster_from_node", "node->nd_item.ci_parent->ci_parent", "BUG", "since", "of", "NULL", "pointer", "dereference", "to", "nd_item.ci_parent", "Moreover,", "the", "o2nm_cluster", "also", "should", "be", "protected", "by", "the", "subsystem.su_mutex.", "[alex.chen@huawei.com:", "v2]", "Link:", "http://lkml.kernel.org/r/59EEAA69.9080703@huawei.com", "Link:", "http://lkml.kernel.org/r/59E9B36A.10700@huawei.com", "Signed-off-by:", "Alex", "Chen", "<alex.chen@huawei.com>", "Reviewed-by:", "Jun", "Piao", "<piaojun@huawei.com>", "Reviewed-by:", "Joseph", "Qi", "<jiangqi903@gmail.com>", "Cc:", "Mark", "Fasheh", "<mfasheh@versity.com>", "Cc:", "Joel", "Becker", "<jlbec@evilplan.org>", "Cc:", "Junxiao", "Bi", "<junxiao.bi@oracle.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["static", "inline", "void", "o2nm_lock_subsystem", "(", "void", ")", ";", "static", "inline", "void", "o2nm_unlock_subsystem", "(", "void", ")", ";", "if", "(", "node", "-", ">", "nd_item", ".", "ci_parent", ")", "return", "to_o2nm_cluster", "(", "node", "-", ">", "nd_item", ".", "ci_parent", "-", ">", "ci_parent", ")", ";", "else", "return", "NULL", ";", "struct", "o2nm_cluster", "*", "cluster", ";", "o2nm_lock_subsystem", "(", ");", "cluster", "=", "to_o2nm_cluster_from_node", "(", "node", ")", ";", "if", "(", "!", "cluster", ")", "{", "o2nm_unlock_subsystem", "(", ");", "return", "-", "EINVAL", ";", "}", "o2nm_unlock_subsystem", "(", ");", "struct", "o2nm_cluster", "*", "cluster", ";", "o2nm_lock_subsystem", "(", ");", "cluster", "=", "to_o2nm_cluster_from_node", "(", "node", ")", ";", "if", "(", "!", "cluster", ")", "{", "o2nm_unlock_subsystem", "(", ");", "return", "-", "EINVAL", ";", "}", "o2nm_unlock_subsystem", "(", ");", "struct", "o2nm_cluster", "*", "cluster", ";", "o2nm_lock_subsystem", "(", ");", "cluster", "=", "to_o2nm_cluster_from_node", "(", "node", ")", ";", "if", "(", "!", "cluster", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "cluster", "-", ">", "cl_local_node", "!", "=", "node", "-", ">", "nd_num", ")", "{", "ret", "=", "-", "EBUSY", ";", "goto", "out", ";", "}", "goto", "out", ";", "ret", "=", "count", ";", "out", ":", "o2nm_unlock_subsystem", "(", ");", "return", "ret", ";", "static", "inline", "void", "o2nm_lock_subsystem", "(", "void", ")", "{", "mutex_lock", "(", "&", "o2nm_cluster_group", ".", "cs_subsys", ".", "su_mutex", ")", ";", "}", "static", "inline", "void", "o2nm_unlock_subsystem", "(", "void", ")", "{", "mutex_unlock", "(", "&", "o2nm_cluster_group", ".", "cs_subsys", ".", "su_mutex", ")", ";", "}</s>return", "to_o2nm_cluster", "(", "node", "-", ">", "nd_item", ".", "ci_parent", "-", ">", "ci_parent", ")", ";", "struct", "o2nm_cluster", "*", "cluster", "=", "to_o2nm_cluster_from_node", "(", "node", ")", ";", "struct", "o2nm_cluster", "*", "cluster", "=", "to_o2nm_cluster_from_node", "(", "node", ")", ";", "struct", "o2nm_cluster", "*", "cluster", "=", "to_o2nm_cluster_from_node", "(", "node", ")", ";", "cluster", "-", ">", "cl_local_node", "!", "=", "node", "-", ">", "nd_num", ")", "return", "-", "EBUSY", ";", "return", "ret", ";", "return", "count", ";"], "docstring_tokens": ["because", "a", "required", "mutex", "is", "not", "used", "."]}
{"contents": ["x86/mm/xen:", "Suppress", "hugetlbfs", "in", "PV", "guests", "Huge", "pages", "are", "not", "normally", "available", "to", "PV", "guests.", "Not", "suppressing", "hugetlbfs", "use", "results", "in", "an", "endless", "loop", "of", "page", "faults", "when", "user", "mode", "code", "tries", "to", "access", "a", "hugetlbfs", "mapped", "area", "(since", "the", "hypervisor", "denies", "such", "PTEs", "to", "be", "created,", "but", "error", "indications", "can't", "be", "propagated", "out", "of", "xen_set_pte_at(),", "just", "like", "for", "various", "of", "its", "siblings),", "and", "-", "once", "killed", "in", "an", "oops", "like", "this:", "kernel", "BUG", "at", ".../fs/hugetlbfs/inode.c:428!", "invalid", "opcode:", "0000", "[#1]", "SMP", "...", "RIP:", "e030:[<ffffffff811c333b>]", "[<ffffffff811c333b>]", "remove_inode_hugepages+0x25b/0x320", "...", "Call", "Trace:", "[<ffffffff811c3415>]", "hugetlbfs_evict_inode+0x15/0x40", "[<ffffffff81167b3d>]", "evict+0xbd/0x1b0", "[<ffffffff8116514a>]", "__dentry_kill+0x19a/0x1f0", "[<ffffffff81165b0e>]", "dput+0x1fe/0x220", "[<ffffffff81150535>]", "__fput+0x155/0x200", "[<ffffffff81079fc0>]", "task_work_run+0x60/0xa0", "[<ffffffff81063510>]", "do_exit+0x160/0x400", "[<ffffffff810637eb>]", "do_group_exit+0x3b/0xa0", "[<ffffffff8106e8bd>]", "get_signal+0x1ed/0x470", "[<ffffffff8100f854>]", "do_signal+0x14/0x110", "[<ffffffff810030e9>]", "prepare_exit_to_usermode+0xe9/0xf0", "[<ffffffff814178a5>]", "retint_user+0x8/0x13", "This", "is", "/", "XSA-174.", "Reported-by:", "Vitaly", "Kuznetsov", "<vkuznets@redhat.com>", "Signed-off-by:", "Jan", "Beulich", "<jbeulich@suse.com>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Andy", "Lutomirski", "<luto@amacapital.net>", "Cc:", "Boris", "Ostrovsky", "<boris.ostrovsky@oracle.com>", "Cc:", "Borislav", "Petkov", "<bp@alien8.de>", "Cc:", "Brian", "Gerst", "<brgerst@gmail.com>", "Cc:", "David", "Vrabel", "<david.vrabel@citrix.com>", "Cc:", "Denys", "Vlasenko", "<dvlasenk@redhat.com>", "Cc:", "H.", "Peter", "Anvin", "<hpa@zytor.com>", "Cc:", "Juergen", "Gross", "<JGross@suse.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Luis", "R.", "Rodriguez", "<mcgrof@suse.com>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "Toshi", "Kani", "<toshi.kani@hp.com>", "Cc:", "stable@vger.kernel.org", "Cc:", "xen-devel", "<xen-devel@lists.xenproject.org>", "Link:", "http://lkml.kernel.org/r/57188ED802000078000E431C@prv-mh.provo.novell.com", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["#", "define", "hugepages_supported", "(", ")", "cpu_has_pse</s>"], "docstring_tokens": ["an", "infinite", "page", "fault", "loop"]}
{"contents": ["s390:", "fix", "kernel", "crash", "due", "to", "linkage", "stack", "instructions", "The", "kernel", "currently", "crashes", "with", "a", "low-address-protection", "exception", "if", "a", "user", "space", "process", "executes", "an", "instruction", "that", "tries", "to", "use", "the", "linkage", "stack.", "Set", "the", "base-ASTE", "origin", "and", "the", "subspace-ASTE", "origin", "of", "the", "dispatchable-unit-control-table", "to", "point", "to", "a", "dummy", "ASTE.", "Set", "up", "control", "register", "15", "to", "point", "to", "an", "empty", "linkage", "stack", "with", "no", "room", "left.", "A", "user", "space", "process", "with", "a", "linkage", "stack", "instruction", "will", "still", "crash", "but", "with", "a", "different", "exception", "which", "is", "correctly", "translated", "to", "a", "segmentation", "fault", "instead", "of", "a", "kernel", "oops.", "Signed-off-by:", "Martin", "Schwidefsky", "<schwidefsky@de.ibm.com>"], "code_tokens": [".", "quad", ".", "Llinkage_stack", "#", "cr15", ":", "linkage", "stack", "operations", ".", "Lduct", ":", ".", "long", "0", ",", ".", "Laste", ",", ".", "Laste", ",", "0", ",", ".", "Lduald", ",", "0", ",", "0", ",", "0", ".", "Laste", ":", ".", "quad", "0", ",", "0xffffffffffffffff", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ".", "Llinkage_stack", ":", ".", "long", "0", ",", "0", ",", "0x89000000", ",", "0", ",", "0", ",", "0", ",", "0x8a000000", ",", "0</s>.", "quad", "0", "#", "cr15", ":", "linkage", "stack", "operations", ".", "Lduct", ":", ".", "long", "0", ",", "0", ",", "0", ",", "0", ",", ".", "Lduald", ",", "0", ",", "0", ",", "0"], "docstring_tokens": ["does", "not", "properly", "handle", "attempted", "use", "of", "the", "linkage", "stack"]}
{"contents": ["[UNDERTOW-1709][JBEAP-19266]", "NullPointerException", "when", "calling", "the", "AJP", "port", "with", "invalid", "request"], "code_tokens": ["@", "LogMessage", "(", "level", "=", "DEBUG", ")", "private", "HttpString", "requestMethod", "=", "HttpString", ".", "EMPTY", ";</s>@", "LogMessage", "(", "level", "=", "ERROR", ")", "private", "HttpString", "requestMethod", ";"], "docstring_tokens": ["a", "flaw", "when", "processing", "large", "chunk", "sizes", "requests"]}
{"contents": ["nfsd4:", "bug", "in", "read_buf", "When", "read_buf", "is", "called", "to", "move", "over", "to", "the", "next", "page", "in", "the", "pagelist", "of", "an", "NFSv4", "request,", "it", "sets", "argp->end", "to", "essentially", "a", "random", "number,", "certainly", "not", "an", "address", "within", "the", "page", "which", "argp->p", "now", "points", "to.", "So", "subsequent", "calls", "to", "READ_BUF", "will", "think", "there", "is", "much", "more", "than", "a", "page", "of", "spare", "space", "(the", "cast", "to", "u32", "ensures", "an", "unsigned", "comparison)", "so", "we", "can", "expect", "to", "fall", "off", "the", "end", "of", "the", "second", "page.", "We", "never", "encountered", "thsi", "in", "testing", "because", "typically", "the", "only", "operations", "which", "use", "more", "than", "two", "pages", "are", "write-like", "operations,", "which", "have", "their", "own", "decoding", "logic.", "Something", "like", "a", "getattr", "after", "a", "write", "may", "cross", "a", "page", "boundary,", "but", "it", "would", "be", "very", "unusual", "for", "it", "to", "cross", "another", "boundary", "after", "that.", "Cc:", "stable@kernel.org", "Signed-off-by:", "J.", "Bruce", "Fields", "<bfields@citi.umich.edu>"], "code_tokens": ["argp", "-", ">", "end", "=", "argp", "-", ">", "p", "+", "(", "argp", "-", ">", "pagelen", ">", ">", "2", ")", ";", "argp", "-", ">", "end", "=", "argp", "-", ">", "p", "+", "(", "PAGE_SIZE", ">", ">", "2", ")", ";", "argp", "-", ">", "end", "=", "argp", "-", ">", "p", "+", "(", "argp", "-", ">", "pagelen", ">", ">", "2", ")", ";", "argp", "-", ">", "end", "=", "argp", "-", ">", "p", "+", "(", "PAGE_SIZE", ">", ">", "2", ")", ";</s>argp", "-", ">", "end", "=", "p", "+", "(", "argp", "-", ">", "pagelen", ">", ">", "2", ")", ";", "argp", "-", ">", "end", "=", "p", "+", "(", "PAGE_SIZE", ">", ">", "2", ")", ";", "argp", "-", ">", "end", "=", "p", "+", "(", "argp", "-", ">", "pagelen", ">", ">", "2", ")", ";", "argp", "-", ">", "end", "=", "p", "+", "(", "PAGE_SIZE", ">", ">", "2", ")", ";"], "docstring_tokens": ["improper", "bounds", "checking"]}
{"contents": ["Json", "parse", "on", "forms", "Co-authored-by:", "James", "Roper", "<james@jazzy.id.au>", "Co-authored-by:", "Ignasi", "Marimon-Clos", "<ignasi@lightbend.com>"], "code_tokens": ["import", "akka", ".", "annotation", ".", "InternalApi", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "slf4j", ".", "LoggerFactory", "import", "scala", ".", "language", ".", "existentials", "private", "val", "logger", ":", "Logger", "=", "LoggerFactory", ".", "getLogger", "(", "classOf", "[", "Form", "[", "T", "]", "])", "@", "deprecated", "(", "\"", "Use", "bind", "(", "JsValue", ",", "Int", ")", "instead", "to", "specify", "the", "maximum", "chars", "that", "should", "be", "consumed", "by", "the", "flattened", "form", "representation", "of", "the", "JSON", "\"", ",", "\"", "2", ".", "8", ".", "3", "\"", ")", "def", "bind", "(", "data", ":", "JsValue", ")", ":", "Form", "[", "T", "]", "=", "{", "logger", ".", "warn", "(", "s", "\"", "Binding", "json", "field", "from", "form", "with", "a", "hardcoded", "max", "size", "of", "$", "{", "Form", ".", "FromJsonMaxChars", "}", "bytes", ".", "This", "is", "deprecated", ".", "Use", "bind", "(", "JsValue", ",", "Int", ")", "instead", ".", "\"", ")", "bind", "(", "FormUtils", ".", "fromJson", "(", "data", ",", "Form", ".", "FromJsonMaxChars", ")", ")", "}", "/", "**", "*", "Binds", "data", "to", "this", "form", ",", "i", ".", "e", ".", "handles", "form", "submission", ".", "*", "*", "@", "param", "data", "Json", "data", "to", "submit", "*", "@", "param", "maxChars", "The", "maximum", "number", "of", "chars", "allowed", "to", "be", "used", "in", "the", "intermediate", "map", "representation", "*", "of", "the", "JSON", ".", "`", "parse", ".", "DefaultMaxTextLength", "`", "is", "recommended", "to", "passed", "for", "this", "parameter", ".", "*", "@", "return", "a", "copy", "of", "this", "form", ",", "filled", "with", "the", "new", "data", "*", "/", "def", "bind", "(", "data", ":", "JsValue", ",", "maxChars", ":", "Int", ")", ":", "Form", "[", "T", "]", "=", "bind", "(", "FormUtils", ".", "fromJson", "(", "data", ",", "maxChars", ")", ")", "val", "data", ":", "Map", "[", "String", ",", "Seq", "[", "String", "]", "]", "=", "unwrap", "match", "{", "case", "body", ":", "play", ".", "api", ".", "libs", ".", "json", ".", "JsValue", "=", ">", "FormUtils", ".", "fromJson", "(", "body", ",", "Form", ".", "FromJsonMaxChars", ")", ".", "mapValues", "(", "Seq", "(", "_", ")", ").", "toMap", "val", "method", ":", "Map", "[", "_", "<", ":", "String", ",", "Seq", "[", "String", "]", "]", "=", "request", ".", "method", ".", "toUpperCase", "match", "{", "/", "**", "*", "INTERNAL", "API", "*", "*", "Default", "maximum", "number", "of", "chars", "allowed", "to", "be", "used", "in", "the", "intermediate", "map", "representation", "of", "the", "*", "JSON", ".", "Defaults", "to", "100k", "which", "is", "the", "default", "of", "parser", ".", "maxMemoryBuffer", "*", "/", "@", "InternalApi", "val", "FromJsonMaxChars", ":", "Long", "=", "102400", "def", "fromJson", "(", "js", ":", "JsValue", ",", "maxChars", ":", "Long", ")", ":", "Map", "[", "String", ",", "String", "]", "=", "doFromJson", "(", "FromJsonRoot", "(", "js", ")", ",", "Map", ".", "empty", ",", "0", ",", "maxChars", ")", "@", "annotation", ".", "tailrec", "private", "def", "doFromJson", "(", "context", ":", "FromJsonContext", ",", "form", ":", "Map", "[", "String", ",", "String", "]", ",", "cumulativeChars", ":", "Int", ",", "maxChars", ":", "Long", ")", ":", "Map", "[", "String", ",", "String", "]", "=", "context", "match", "{", "case", "FromJsonTerm", "=", ">", "form", "case", "ctx", ":", "FromJsonContextValue", "=", ">", "/", "/", "Ensure", "this", "contexts", "next", "is", "initialised", ",", "this", "prevents", "unbounded", "recursion", ".", "ctx", ".", "next", "ctx", ".", "value", "match", "{", "case", "obj", ":", "JsObject", "if", "obj", ".", "fields", ".", "nonEmpty", "=", ">", "doFromJson", "(", "FromJsonObject", "(", "ctx", ",", "obj", ".", "fields", ".", "toIndexedSeq", ",", "0", ")", ",", "form", ",", "cumulativeChars", ",", "maxChars", ")", "case", "JsArray", "(", "values", ")", "if", "values", ".", "nonEmpty", "=", ">", "doFromJson", "(", "FromJsonArray", "(", "ctx", ",", "values", ",", "0", ")", ",", "form", ",", "cumulativeChars", ",", "maxChars", ")", "case", "JsNull", "|", "JsArray", "(", "_", ")", "|", "JsObject", "(", "_", ")", "=", ">", "doFromJson", "(", "ctx", ".", "next", ",", "form", ",", "cumulativeChars", ",", "maxChars", ")", "case", "simple", "=", ">", "val", "value", "=", "simple", "match", "{", "case", "JsString", "(", "v", ")", "=", ">", "v", "case", "JsNumber", "(", "v", ")", "=", ">", "v", ".", "toString", "case", "JsBoolean", "(", "v", ")", "=", ">", "v", ".", "toString", "}", "val", "prefix", "=", "ctx", ".", "prefix", "val", "newCumulativeChars", "=", "cumulativeChars", "+", "prefix", ".", "length", "+", "value", ".", "length", "if", "(", "newCumulativeChars", ">", "maxChars", ")", "{", "throw", "FormJsonExpansionTooLarge", "(", "maxChars", ")", "}", "doFromJson", "(", "ctx", ".", "next", ",", "form", ".", "updated", "(", "prefix", ",", "value", ")", ",", "newCumulativeChars", ",", "maxChars", ")", "}", "}", "private", "sealed", "trait", "FromJsonContext", "private", "sealed", "trait", "FromJsonContextValue", "extends", "FromJsonContext", "{", "def", "value", ":", "JsValue", "def", "prefix", ":", "String", "def", "next", ":", "FromJsonContext", "}", "private", "case", "object", "FromJsonTerm", "extends", "FromJsonContext", "private", "case", "class", "FromJsonRoot", "(", "value", ":", "JsValue", ")", "extends", "FromJsonContextValue", "{", "override", "def", "prefix", "=", "\"", "\"", "override", "def", "next", ":", "FromJsonContext", "=", "FromJsonTerm", "}", "private", "case", "class", "FromJsonArray", "(", "parent", ":", "FromJsonContextValue", ",", "values", ":", "scala", ".", "collection", ".", "IndexedSeq", "[", "JsValue", "]", ",", "idx", ":", "Int", ")", "extends", "FromJsonContextValue", "{", "override", "def", "value", ":", "JsValue", "=", "values", "(", "idx", ")", "override", "val", "prefix", ":", "String", "=", "s", "\"", "${", "parent", ".", "prefix", "}", "[$", "idx", "]", "\"", "override", "lazy", "val", "next", ":", "FromJsonContext", "=", "if", "(", "idx", "+", "1", "<", "values", ".", "length", ")", "{", "FromJsonArray", "(", "parent", ",", "values", ",", "idx", "+", "1", ")", "}", "else", "{", "parent", ".", "next", "}", "}", "private", "case", "class", "FromJsonObject", "(", "parent", ":", "FromJsonContextValue", ",", "fields", ":", "IndexedSeq", "[", "(", "String", ",", "JsValue", ")", "],", "idx", ":", "Int", ")", "extends", "FromJsonContextValue", "{", "override", "def", "value", ":", "JsValue", "=", "fields", "(", "idx", ")", ".", "_2", "override", "val", "prefix", ":", "String", "=", "if", "(", "parent", ".", "prefix", ".", "isEmpty", ")", "{", "fields", "(", "idx", ")", ".", "_1", "}", "else", "{", "parent", ".", "prefix", "+", "\"", ".\"", "+", "fields", "(", "idx", ")", ".", "_1", "}", "override", "lazy", "val", "next", ":", "FromJsonContext", "=", "if", "(", "idx", "+", "1", "<", "fields", ".", "length", ")", "{", "FromJsonObject", "(", "parent", ",", "fields", ",", "idx", "+", "1", ")", "}", "else", "{", "parent", ".", "next", "}", "case", "class", "FormJsonExpansionTooLarge", "(", "limit", ":", "Long", ")", "extends", "RuntimeException", "(", "s", "\"", "Binding", "form", "from", "JSON", "exceeds", "form", "expansion", "limit", "of", "$", "limit", "\"", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "123", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "api", ".", "data", "import", "org", ".", "specs2", ".", "mutable", ".", "Specification", "import", "play", ".", "api", ".", "libs", ".", "json", ".", "JsNull", "import", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", "class", "FormUtilsSpec", "extends", "Specification", "{", "\"", "FormUtils", ".", "fromJson", "\"", "should", "{", "\"", "convert", "a", "complex", "json", "structure", "to", "a", "map", "\"", "in", "{", "val", "json", "=", "Json", ".", "obj", "(", "\"", "arr", "\"", "-", ">", "Json", ".", "arr", "(", "Json", ".", "obj", "(", "\"", "a", "\"", "-", ">", "\"", "an", "-", "a", "\"", ",", "\"", "b", "\"", "-", ">", "true", ",", "\"", "c", "\"", "-", ">", "JsNull", ",", "\"", "d", "\"", "-", ">", "10", ")", ",", "\"", "str", "\"", ",", "20", ",", "\"", "blah", "\"", ")", ",", "\"", "e", "\"", "-", ">", "Json", ".", "obj", "(", "\"", "f", "\"", "-", ">", "\"", "an", "-", "f", "\"", ",", "\"", "g", "\"", "-", ">", "false", ",", ")", ",", "\"", "h", "\"", "-", ">", "\"", "an", "-", "h", "\"", ",", "\"", "i", "\"", "-", ">", "30", ",", "\"", "j", "\"", "-", ">", "Json", ".", "arr", "(", "Json", ".", "arr", "(", "40", ")", ")", ")", "val", "expected", "=", "Seq", "(", "\"", "arr", "[", "0", "]", ".", "a", "\"", "-", ">", "\"", "an", "-", "a", "\"", ",", "\"", "arr", "[", "0", "]", ".", "b", "\"", "-", ">", "\"", "true", "\"", ",", "\"", "arr", "[", "0", "]", ".", "d", "\"", "-", ">", "\"", "10", "\"", ",", "\"", "arr", "[", "1", "]", "\"", "-", ">", "\"", "str", "\"", ",", "\"", "arr", "[", "2", "]", "\"", "-", ">", "\"", "20", "\"", ",", "\"", "arr", "[", "3", "]", "\"", "-", ">", "\"", "blah", "\"", ",", "\"", "e", ".", "f", "\"", "-", ">", "\"", "an", "-", "f", "\"", ",", "\"", "e", ".", "g", "\"", "-", ">", "\"", "false", "\"", ",", "\"", "h", "\"", "-", ">", "\"", "an", "-", "h", "\"", ",", "\"", "i", "\"", "-", ">", "\"", "30", "\"", ",", "\"", "j", "[", "0", "]", "[", "0", "]", "\"", "-", ">", "\"", "40", "\"", ",", ")", "val", "map", "=", "FormUtils", ".", "fromJson", "(", "json", ",", "1000", ")", "map", ".", "toSeq", "must", "containTheSameElementsAs", "(", "expected", ")", "}", "\"", "not", "stack", "overflow", "when", "converting", "heavily", "nested", "arrays", "\"", "in", "{", "try", "{", "FormUtils", ".", "fromJson", "(", "Json", ".", "parse", "(", "\"{", "\\\"", "arr", "\\", "\":", "\"", "+", "(", "\"[", "\"", "*", "10000", ")", "+", "\"", "1", "\"", "+", "(", "\"]", "\"", "*", "10000", ")", "+", "\"", "}\"", "),", "1000000", ")", "}", "catch", "{", "case", "e", ":", "StackOverflowError", "=", ">", "ko", "(", "\"", "StackOverflowError", "thrown", "\"", ")", "}", "ok", "}", "\"", "parse", "normally", "when", "the", "input", "is", "small", "enough", "\"", "in", "{", "val", "keyLength", "=", "10", "val", "itemCount", "=", "10", "val", "maxChars", "=", "500", "*", "1000", "/", "/", "a", "limit", "we", "'", "re", "not", "reaching", "try", "{", "FormUtils", ".", "fromJson", "(", "Json", ".", "obj", "(", "\"", "a", "\"", "*", "keyLength", "-", ">", "Json", ".", "arr", "(", "0", "to", "itemCount", ")", "),", "maxChars", ")", "}", "catch", "{", "case", "_", ":", "OutOfMemoryError", "=", ">", "ko", "(", "\"", "OutOfMemoryError", "\"", ")", "}", "ok", "}", "\"", "abort", "parsing", "when", "maximum", "memory", "is", "used", "\"", "in", "{", "/", "/", "Even", "when", "the", "JSON", "is", "small", ",", "if", "the", "memory", "limit", "is", "exceed", "the", "parsing", "must", "stop", ".", "val", "keyLength", "=", "10", "val", "itemCount", "=", "10", "val", "maxChars", "=", "3", "/", "/", "yeah", ",", "maxChars", "is", "only", "3", "chars", ".", "We", "want", "to", "hit", "the", "limit", ".", "(", "try", "{", "FormUtils", ".", "fromJson", "(", "Json", ".", "obj", "(", "\"", "a", "\"", "*", "keyLength", "-", ">", "Json", ".", "arr", "(", "0", "to", "itemCount", ")", "),", "maxChars", ")", "}", "catch", "{", "case", "_", ":", "OutOfMemoryError", "=", ">", "ko", "(", "\"", "OutOfMemoryError", "\"", ")", "}", ")", "must", "throwA", "[", "FormJsonExpansionTooLarge", "]", "}", "\"", "not", "run", "out", "of", "heap", "when", "converting", "arrays", "with", "very", "long", "keys", "\"", "in", "{", "/", "/", "a", "similar", "scenario", "to", "the", "previous", "one", "but", "this", "would", "cause", "OOME", "if", "it", "weren", "'", "t", "for", "the", "limit", "val", "keyLength", "=", "10000", "val", "itemCount", "=", "100000", "val", "maxChars", "=", "keyLength", "/", "/", "some", "value", "we", "'", "re", "likely", "to", "exceed", ".", "We", "want", "this", "limit", "to", "kick", "in", ".", "(", "try", "{", "FormUtils", ".", "fromJson", "(", "/", "/", "A", "JSON", "object", "with", "a", "key", "of", "length", "10000", ",", "pointing", "to", "a", "list", "with", "100000", "elements", ".", "/", "/", "In", "memory", ",", "this", "will", "consume", "at", "most", "a", "few", "MB", "of", "space", ".", "When", "expanded", ",", "will", "consume", "/", "/", "many", "GB", "of", "space", ".", "Json", ".", "obj", "(", "\"", "a", "\"", "*", "keyLength", "-", ">", "Json", ".", "arr", "(", "0", "to", "itemCount", ")", "),", "maxChars", ")", "}", "catch", "{", "case", "_", ":", "OutOfMemoryError", "=", ">", "/", "/", "No", "guarantee", "we", "'", "ll", "be", "the", "thread", "that", "gets", "this", ",", "or", "that", "our", "handling", "will", "be", "graceful", ",", "/", "/", "but", "at", "least", "try", ".", "ko", "(", "\"", "OutOfMemoryError", "\"", ")", "}", ")", "must", "throwA", "[", "FormJsonExpansionTooLarge", "]", "}", "}", "}", "@", "@", "-", "209", ",", "7", "+", "209", ",", "9", "@", "@", "object", "BuildSettings", "{", "/", "/", "Limit", "JSON", "parsing", "resources", "ProblemFilters", ".", "exclude", "[", "DirectMissingMethodProblem", "]", "(\"", "play", ".", "api", ".", "data", ".", "FormUtils", ".", "fromJson", "$", "default", "$", "1", "\"", "),", "ProblemFilters", ".", "exclude", "[", "IncompatibleMethTypeProblem", "]", "(\"", "play", ".", "api", ".", "data", ".", "FormUtils", ".", "fromJson", "\"", "),", "/", "/", "is", "private", "@", "Deprecated", "logger", ".", "warn", "(", "\"", "Binding", "json", "field", "from", "form", "with", "a", "hardcoded", "max", "size", "of", "{", "}", "bytes", ".", "This", "is", "deprecated", ".", "Use", "bind", "(", "Lang", ",", "TypedMap", ",", "JsonNode", ",", "Int", ",", "String", ".", "..", ")", "instead", ".", "\",", "FROM_JSON_MAX_CHARS", ")", ";", "return", "bind", "(", "lang", ",", "attrs", ",", "data", ",", "FROM_JSON_MAX_CHARS", ",", "allowedFields", ")", ";", "}", "@", "Override", "public", "DynamicForm", "bind", "(", "Lang", "lang", ",", "TypedMap", "attrs", ",", "JsonNode", "data", ",", "long", "maxChars", ",", "String", ".", "..", "allowedFields", ")", "{", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "),", "maxChars", ")", "),", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "play", ".", "api", ".", "data", ".", "Form", "$", ";", "protected", "static", "final", "long", "FROM_JSON_MAX_CHARS", "=", "Form", "$", ".", "MODULE", "$", ".", "FromJsonMaxChars", "(", ");", "protected", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "getClass", "(", "))", ";", "long", "maxMemoryBuffer", "=", "config", ".", "getMemorySize", "(", "\"", "play", ".", "http", ".", "parser", ".", "maxMemoryBuffer", "\"", ").", "toBytes", "(", ");", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "request", ".", "body", "(", ").", "asJson", "(", "))", "),", "maxMemoryBuffer", ")", ");", "*", "@", "deprecated", "Deprecated", "as", "of", "2", ".", "8", ".", "3", ".", "Use", "{", "@", "link", "#", "bind", "(", "Lang", ",", "TypedMap", ",", "JsonNode", ",", "int", ",", "String", ".", "..", ")}", "*", "instead", "to", "specify", "the", "maximum", "chars", "that", "should", "be", "consumed", "by", "the", "flattened", "form", "*", "representation", "of", "the", "JSON", ".", "@", "Deprecated", "logger", ".", "warn", "(", "\"", "Binding", "json", "field", "from", "form", "with", "a", "hardcoded", "max", "size", "of", "{", "}", "bytes", ".", "This", "is", "deprecated", ".", "Use", "bind", "(", "Lang", ",", "TypedMap", ",", "JsonNode", ",", "Int", ",", "String", ".", "..", ")", "instead", ".", "\",", "FROM_JSON_MAX_CHARS", ")", ";", "return", "bind", "(", "lang", ",", "attrs", ",", "data", ",", "FROM_JSON_MAX_CHARS", ",", "allowedFields", ")", ";", "}", "/", "**", "*", "Binds", "Json", "data", "to", "this", "form", "-", "that", "is", ",", "handles", "form", "submission", ".", "*", "*", "@", "param", "lang", "used", "for", "validators", "and", "formatters", "during", "binding", "and", "is", "part", "of", "{", "@", "link", "*", "ValidationPayload", "}", ".", "Later", "also", "used", "for", "formatting", "when", "retrieving", "a", "field", "(", "via", "{", "@", "link", "*", "#", "field", "(", "String", ")", "}", "or", "{", "@", "link", "#", "apply", "(", "String", ")", "})", "and", "for", "translations", "in", "{", "@", "link", "#", "errorsAsJson", "(", ")}", ".", "*", "For", "these", "methods", "the", "lang", "can", "be", "change", "via", "{", "@", "link", "#", "withLang", "(", "Lang", ")", "}.", "*", "@", "param", "attrs", "will", "be", "passed", "to", "validators", "via", "{", "@", "link", "ValidationPayload", "}", "*", "@", "param", "data", "data", "to", "submit", "*", "@", "param", "maxChars", "The", "maximum", "number", "of", "chars", "allowed", "to", "be", "used", "in", "the", "intermediate", "map", "*", "representation", "of", "the", "JSON", ".", "`", "parse", ".", "DefaultMaxTextLength", "`", "is", "recommended", "to", "passed", "for", "this", "*", "parameter", ".", "*", "@", "param", "allowedFields", "the", "fields", "that", "should", "be", "bound", "to", "the", "form", ",", "all", "fields", "if", "not", "specified", ".", "*", "@", "return", "a", "copy", "of", "this", "form", "filled", "with", "the", "new", "data", "*", "/", "public", "Form", "<", "T", ">", "bind", "(", "Lang", "lang", ",", "TypedMap", "attrs", ",", "JsonNode", "data", ",", "long", "maxChars", ",", "String", ".", "..", "allowedFields", ")", "{", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "),", "maxChars", ")", "),</s>import", "scala", ".", "language", ".", "existentials", "def", "bind", "(", "data", ":", "JsValue", ")", ":", "Form", "[", "T", "]", "=", "bind", "(", "FormUtils", ".", "fromJson", "(", "js", "=", "data", ")", ")", "val", "data", "=", "unwrap", "match", "{", "case", "body", ":", "play", ".", "api", ".", "libs", ".", "json", ".", "JsValue", "=", ">", "FormUtils", ".", "fromJson", "(", "js", "=", "body", ")", ".", "mapValues", "(", "Seq", "(", "_", ")", ")", "val", "method", "=", "request", ".", "method", ".", "toUpperCase", "match", "{", "def", "fromJson", "(", "prefix", ":", "String", "=", "\"", "\",", "js", ":", "JsValue", ")", ":", "Map", "[", "String", ",", "String", "]", "=", "js", "match", "{", "case", "JsObject", "(", "fields", ")", "=", ">", "val", "prefix2", "=", "Option", "(", "prefix", ")", ".", "filterNot", "(", "_", ".", "isEmpty", ")", ".", "map", "(", "_", "+", "\"", ".\"", ").", "getOrElse", "(", "\"\"", ")", "fields", ".", "iterator", ".", "map", "{", "case", "(", "key", ",", "value", ")", "=", ">", "fromJson", "(", "prefix2", "+", "key", ",", "value", ")", "}", ".", "foldLeft", "(", "Map", ".", "empty", "[", "String", ",", "String", "]", ")(", "_", "+", "+", "_", ")", "case", "JsArray", "(", "values", ")", "=", ">", "values", ".", "zipWithIndex", ".", "iterator", ".", "map", "{", "case", "(", "value", ",", "i", ")", "=", ">", "fromJson", "(", "s", "\"", "$", "prefix", "[", "$", "i", "]", "\",", "value", ")", "}", ".", "foldLeft", "(", "Map", ".", "empty", "[", "String", ",", "String", "]", ")(", "_", "+", "+", "_", ")", "case", "JsNull", "=", ">", "Map", ".", "empty", "case", "JsUndefined", "(", ")", "=", ">", "Map", ".", "empty", "case", "JsBoolean", "(", "value", ")", "=", ">", "Map", "(", "prefix", "-", ">", "value", ".", "toString", ")", "case", "JsNumber", "(", "value", ")", "=", ">", "Map", "(", "prefix", "-", ">", "value", ".", "toString", ")", "case", "JsString", "(", "value", ")", "=", ">", "Map", "(", "prefix", "-", ">", "value", ".", "toString", ")", "/", "/", "Add", "mima", "filters", "here", "\"", "\",", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "))", "),", "\"", "\",", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "request", ".", "body", "(", ").", "asJson", "(", "))", "))", ");", "\"", "\",", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "))", "),"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["Fix", "bug", "#69207", "-", "move_uploaded_file", "allows", "nulls", "in", "path"], "code_tokens": ["-", "Core", ":", ".", "Fixed", "bug", "#", "69207", "(", "move_uploaded_file", "allows", "nulls", "in", "path", ")", ".", "(", "Stas", ")", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "sp", "\"", ",", "&", "path", ",", "&", "path_len", ",", "&", "new_path", ",", "&", "new_path_len", ")", "=", "=", "FAILURE", ")", "{</s>-", "Core", ":", "@", "@", "-", "5775", ",", "7", "+", "5775", ",", "7", "@", "@", "PHP_FUNCTION", "(", "move_uploaded_file", ")", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "\"", ",", "&", "path", ",", "&", "path_len", ",", "&", "new_path", ",", "&", "new_path_len", ")", "=", "=", "FAILURE", ")", "{"], "docstring_tokens": ["truncates", "a", "pathname", "upon", "encountering", "a", "\\x00", "character"]}
{"contents": ["Fix", "Jenkins", "issue", "SECURITY-260", "-", "credentials", "stored", "in", "plaintext.", "Removed", "the", "\"user\"", "and", "\"password\"", "which", "were", "stored", "as", "plain", "text.", "If", "the", "previous", "configuration", "still", "contains", "plaintext", "user", "and", "password,", "these", "information", "will", "be", "migrated", "into", "Credentials", "once.", "Fix:", "109522,", "108097"], "code_tokens": ["import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "*;", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "UsernamePasswordCredentialsImpl", ";", "import", "edu", ".", "umd", ".", "cs", ".", "findbugs", ".", "annotations", ".", "NonNull", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "/", "/", "deprecated", "fields", "which", "were", "removed", "in", "plugin", "version", "1", ".", "11", "private", "transient", "String", "user", ";", "private", "transient", "String", "password", ";", "private", "static", "final", "String", "migratedCredentialId", "=", "\"", "Migrated", "-", "Coverity", "-", "Credential", "\"", ";", "protected", "Object", "readResolve", "(", ")", "{", "createCredentials", "(", "user", ",", "password", ")", ";", "/", "/", "Setting", "the", "migrated", "credential", "to", "use", "if", "(", "StringUtils", ".", "isEmpty", "(", "credentialId", ")", ")", "{", "credentialId", "=", "migratedCredentialId", ";", "}", "return", "this", ";", "}", "private", "void", "createCredentials", "(", "String", "username", ",", "String", "password", ")", "{", "try", "{", "UsernamePasswordCredentialsImpl", "credential", "=", "new", "UsernamePasswordCredentialsImpl", "(", "CredentialsScope", ".", "GLOBAL", ",", "name", "+", "\"", "_", "\"", "+", "username", ",", "\"", "Migrated", "Coverity", "Credential", "\"", ",", "username", ",", "password", ")", ";", "CredentialsStore", "store", "=", "CredentialsProvider", ".", "lookupStores", "(", "Jenkins", ".", "getInstance", "(", "))", ".", "iterator", "(", ").", "next", "(", ");", "store", ".", "addCredentials", "(", "Domain", ".", "global", "(", "),", "credential", ")", ";", "}", "catch", "(", "IOException", "ioe", ")", "{", "logger", ".", "warning", "(", "\"", "Migrating", "username", "and", "password", "into", "credentials", "encountered", "IOException", "\"", "+", "\"", "\\", "nPlease", "try", "to", "resolve", "this", "issue", "by", "adding", "credentials", "manually", "\"", ");", "}", "}", "<", "f", ":", "entry", "title", "=", "\"", "Credentials", "\"", "field", "=", "\"", "credentialId", "\"", ">", "with", "=", "\"", "host", ",", "port", ",", "useSSL", ",", "credentialId", "\"", "/>", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "@", "PrepareForTest", "(", "{", "WebServiceFactory", ".", "class", ",", "Client", ".", "class", ",", "SSLContext", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "cim", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "true", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "true", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "Credentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatcher", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "UsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "DomainRequirement", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "UsernamePasswordCredentialsImpl", ";", "import", "hudson", ".", "model", ".", "ItemGroup", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "org", ".", "acegisecurity", ".", "Authentication", ";", "import", "org", ".", "mockito", ".", "Matchers", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "Executor", ".", "class", ",", "ToolLocationNodeProperty", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "@", "Mock", "UsernamePasswordCredentials", "credentials", ";", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "protected", "void", "setCredentialManager", "(", "String", "username", ",", "String", "password", ")", "{", "PowerMockito", ".", "mockStatic", "(", "CredentialsMatchers", ".", "class", ")", ";", "PowerMockito", ".", "mockStatic", "(", "CredentialsProvider", ".", "class", ")", ";", "credentials", "=", "Mockito", ".", "mock", "(", "UsernamePasswordCredentialsImpl", ".", "class", ")", ";", "Secret", "secret", "=", "PowerMockito", ".", "mock", "(", "Secret", ".", "class", ")", ";", "PowerMockito", ".", "when", "(", "secret", ".", "getPlainText", "(", "))", ".", "thenReturn", "(", "password", ")", ";", "PowerMockito", ".", "when", "(", "credentials", ".", "getPassword", "(", "))", ".", "thenReturn", "(", "secret", ")", ";", "PowerMockito", ".", "when", "(", "credentials", ".", "getUsername", "(", "))", ".", "thenReturn", "(", "username", ")", ";", "PowerMockito", ".", "when", "(", "CredentialsProvider", ".", "lookupCredentials", "(", "Matchers", ".", "<", "Class", "<", "Credentials", ">", ">", "any", "(", "),", "Matchers", ".", "any", "(", "ItemGroup", ".", "class", ")", ",", "Matchers", ".", "any", "(", "Authentication", ".", "class", ")", ",", "Matchers", ".", "anyListOf", "(", "DomainRequirement", ".", "class", ")", ")", ").", "thenReturn", "(", "new", "ArrayList", "<", "Credentials", ">", "()", "{", "}", ");", "PowerMockito", ".", "when", "(", "CredentialsMatchers", ".", "firstOrNull", "(", "Matchers", ".", "anyListOf", "(", "StandardCredentials", ".", "class", ")", ",", "Matchers", ".", "any", "(", "CredentialsMatcher", ".", "class", ")", "))", ".", "thenReturn", "(", "(", "StandardUsernamePasswordCredentials", ")", "credentials", ")", ";", "}", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "true", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "SaveableListener", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "TestUser", "\"", ",", "\"", "TestPassword", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "TestUser", "\"", ",", "\"", "TestPassword", "\"", ");", ".", "withUseSSL", "(", "true", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "TestUser", "\"", ",", "\"", "TestPassword", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "TestUser", "\"", ",", "\"", "TestPassword", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "TestUser", "\"", ",", "\"", "TestPassword", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ")", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Client", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Client", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "public", "CIMInstanceBuilder", "withDefaultCredentialId", "(", ")", "{", "this", ".", "credentialId", "=", "\"", "DefaultCredentialId", "\"", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Copyright", "(", "c", ")", "2018", "Synopsys", ",", "Inc", "*", "All", "rights", "reserved", ".", "This", "program", "and", "the", "accompanying", "materials", "*", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "v1", ".", "0", "*", "which", "accompanies", "this", "distribution", ",", "and", "is", "available", "at", "*", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", "*", "*", "Contributors", ":", "*", "Synopsys", ",", "Inc", "-", "initial", "implementation", "and", "documentation", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "Credentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatcher", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "UsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "DomainRequirement", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "UsernamePasswordCredentialsImpl", ";", "import", "hudson", ".", "model", ".", "ItemGroup", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "org", ".", "acegisecurity", ".", "Authentication", ";", "import", "org", ".", "mockito", ".", "Matchers", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "import", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "public", "class", "CredentialUtil", "{", "public", "static", "void", "setCredentialManager", "(", "String", "username", ",", "String", "password", ")", "{", "PowerMockito", ".", "mockStatic", "(", "CredentialsMatchers", ".", "class", ")", ";", "PowerMockito", ".", "mockStatic", "(", "CredentialsProvider", ".", "class", ")", ";", "UsernamePasswordCredentials", "credentials", "=", "Mockito", ".", "mock", "(", "UsernamePasswordCredentialsImpl", ".", "class", ")", ";", "Secret", "secret", "=", "PowerMockito", ".", "mock", "(", "Secret", ".", "class", ")", ";", "PowerMockito", ".", "when", "(", "secret", ".", "getPlainText", "(", "))", ".", "thenReturn", "(", "password", ")", ";", "PowerMockito", ".", "when", "(", "credentials", ".", "getPassword", "(", "))", ".", "thenReturn", "(", "secret", ")", ";", "PowerMockito", ".", "when", "(", "credentials", ".", "getUsername", "(", "))", ".", "thenReturn", "(", "username", ")", ";", "PowerMockito", ".", "when", "(", "CredentialsProvider", ".", "lookupCredentials", "(", "Matchers", ".", "<", "Class", "<", "Credentials", ">", ">", "any", "(", "),", "Matchers", ".", "any", "(", "ItemGroup", ".", "class", ")", ",", "Matchers", ".", "any", "(", "Authentication", ".", "class", ")", ",", "Matchers", ".", "anyListOf", "(", "DomainRequirement", ".", "class", ")", ")", ").", "thenReturn", "(", "new", "ArrayList", "<", "Credentials", ">", "()", "{", "}", ");", "PowerMockito", ".", "when", "(", "CredentialsMatchers", ".", "firstOrNull", "(", "Matchers", ".", "anyListOf", "(", "StandardCredentials", ".", "class", ")", ",", "Matchers", ".", "any", "(", "CredentialsMatcher", ".", "class", ")", "))", ".", "thenReturn", "(", "(", "StandardUsernamePasswordCredentials", ")", "credentials", ")", ";", "}", "}", "@", "@", "-", "18", ",", "7", "+", "18", ",", "11", "@", "@", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "@", "PrepareForTest", "(", "{", "WebServiceFactory", ".", "class", ",", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "admin", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "plugins", ".", "coverity", ".", "Utils", ".", "CredentialUtil", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "powermock", ".", "core", ".", "classloader", ".", "annotations", ".", "PrepareForTest", ";", "import", "org", ".", "powermock", ".", "modules", ".", "junit4", ".", "PowerMockRunner", ";", "@", "RunWith", "(", "PowerMockRunner", ".", "class", ")", "@", "PrepareForTest", "(", "{", "Secret", ".", "class", ",", "CredentialsMatchers", ".", "class", ",", "CredentialsProvider", ".", "class", "}", ")", ".", "withUseSSL", "(", "false", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "test", "-", "user", "\"", ",", "\"", "password", "\"", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "test", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "true", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");", "CredentialUtil", ".", "setCredentialManager", "(", "\"", "test", "-", "user", "\"", ",", "\"", "password", "\"", ");", ".", "withUseSSL", "(", "true", ")", ".", "withDefaultCredentialId", "(", ").", "build", "(", ");</s>import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatchers", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "/", "**", "*", "Username", "for", "connecting", "to", "the", "CIM", "server", "*", "Deprecated", "since", "1", ".", "10", "*", "/", "@", "Deprecated", "private", "String", "user", ";", "/", "**", "*", "Password", "for", "connecting", "to", "the", "CIM", "server", "*", "Deprecated", "since", "1", ".", "10", "*", "/", "@", "Deprecated", "private", "String", "password", ";", "/", "*", "*", "Deprecated", "since", "1", ".", "10", ".", "Use", "credentialId", "*", "/", "@", "Deprecated", "public", "String", "getUser", "(", ")", "{", "return", "user", ";", "}", "@", "DataBoundSetter", "public", "void", "setUser", "(", "String", "user", ")", "{", "this", ".", "user", "=", "user", ";", "}", "/", "*", "*", "Deprecated", "since", "1", ".", "10", ".", "Use", "credentialId", "*", "/", "@", "Deprecated", "public", "String", "getPassword", "(", ")", "{", "return", "password", ";", "}", "@", "DataBoundSetter", "public", "void", "setPassword", "(", "String", "password", ")", "{", "this", ".", "password", "=", "password", ";", "}", "instance", ".", "setUser", "(", "user", ")", ";", "instance", ".", "setPassword", "(", "password", ")", ";", "@", "QueryParameter", "String", "user", ",", "@", "QueryParameter", "String", "password", ",", "instance", ".", "setUser", "(", "user", ")", ";", "instance", ".", "setPassword", "(", "password", ")", ";", "<", "f", ":", "entry", "title", "=", "\"", "Credentials", "(", "Recommended", ")", "\"", "field", "=", "\"", "credentialId", "\"", ">", "<", "f", ":", "entry", "title", "=", "\"", "Username", "(", "Deprecated", ")", "\"", "field", "=", "\"", "user", "\"", ">", "<", "f", ":", "textbox", "/", ">", "<", "/", "f", ":", "entry", ">", "<", "f", ":", "entry", "title", "=", "\"", "Password", "(", "Deprecated", ")", "\"", "field", "=", "\"", "password", "\"", ">", "<", "f", ":", "password", "/", ">", "<", "/", "f", ":", "entry", ">", "with", "=", "\"", "host", ",", "port", ",", "user", ",", "password", ",", "useSSL", ",", "credentialId", "\"", "/>", "@", "PrepareForTest", "(", "{", "WebServiceFactory", ".", "class", ",", "Client", ".", "class", ",", "SSLContext", ".", "class", "}", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "cim", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "true", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "true", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", ".", "withUser", "(", "\"", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "Executor", ".", "class", ",", "ToolLocationNodeProperty", ".", "class", ",", "WebServiceFactory", ".", "class", "}", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "WebServiceFactory", ".", "class", "}", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "true", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "SaveableListener", ".", "class", ",", "WebServiceFactory", ".", "class", "}", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "Credentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsMatcher", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "StandardUsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "common", ".", "UsernamePasswordCredentials", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "DomainRequirement", ";", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "impl", ".", "UsernamePasswordCredentialsImpl", ";", "import", "hudson", ".", "model", ".", "ItemGroup", ";", "import", "org", ".", "acegisecurity", ".", "Authentication", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "@", "Mock", "UsernamePasswordCredentials", "credentials", ";", "protected", "void", "setCredentialManager", "(", "String", "username", ",", "String", "password", ")", "{", "PowerMockito", ".", "mockStatic", "(", "CredentialsMatchers", ".", "class", ")", ";", "PowerMockito", ".", "mockStatic", "(", "CredentialsProvider", ".", "class", ")", ";", "credentials", "=", "Mockito", ".", "mock", "(", "UsernamePasswordCredentialsImpl", ".", "class", ")", ";", "Secret", "secret", "=", "PowerMockito", ".", "mock", "(", "Secret", ".", "class", ")", ";", "when", "(", "secret", ".", "getPlainText", "(", "))", ".", "thenReturn", "(", "password", ")", ";", "when", "(", "credentials", ".", "getPassword", "(", "))", ".", "thenReturn", "(", "secret", ")", ";", "when", "(", "credentials", ".", "getUsername", "(", "))", ".", "thenReturn", "(", "username", ")", ";", "when", "(", "CredentialsProvider", ".", "lookupCredentials", "(", "Matchers", ".", "<", "Class", "<", "Credentials", ">", ">", "any", "(", "),", "Matchers", ".", "any", "(", "ItemGroup", ".", "class", ")", ",", "Matchers", ".", "any", "(", "Authentication", ".", "class", ")", ",", "Matchers", ".", "anyListOf", "(", "DomainRequirement", ".", "class", ")", ")", ").", "thenReturn", "(", "new", "ArrayList", "<", "Credentials", ">", "()", "{", "})", ";", "when", "(", "CredentialsMatchers", ".", "firstOrNull", "(", "Matchers", ".", "anyListOf", "(", "StandardCredentials", ".", "class", ")", ",", "Matchers", ".", "any", "(", "CredentialsMatcher", ".", "class", ")", "))", ".", "thenReturn", "(", "(", "StandardUsernamePasswordCredentials", ")", "credentials", ")", ";", "}", ".", "withUser", "(", "\"", "TestUser", "\"", ").", "withPassword", "(", "\"", "TestPassword", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "TestUser", "\"", ").", "withPassword", "(", "\"", "TestPassword", "\"", ").", "withUseSSL", "(", "true", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "TestUser", "\"", ").", "withPassword", "(", "\"", "TestPassword", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", "InvocationAssistance", "invocationAssistance", "=", "new", "InvocationAssistanceBuilder", "(", ").", "withCommitArguments", "(", "\"", "AdditionalCommitArguments", "\"", ").", "build", "(", ");", "CoverityPublisher", "publisher", "=", "new", "CoverityPublisherBuilder", "(", ").", "withCimStream", "(", "cimStream", ")", ".", "withInvocationAssistance", "(", "invocationAssistance", ")", ".", "build", "(", ");", "Command", "covCommitDefectsCommand", "=", "new", "CovCommitDefectsCommand", "(", "build", ",", "launcher", ",", "listener", ",", "publisher", ",", "StringUtils", ".", "EMPTY", ",", "envVars", ",", "cimStream", ",", "cimInstance", ")", ";", "setExpectedArguments", "(", "new", "String", "[", "]", "{", "\"", "cov", "-", "commit", "-", "defects", "\"", ",", "\"", "--", "dir", "\"", ",", "\"", "TestDir", "\"", ",", "\"", "--", "host", "\"", ",", "\"", "Localhost", "\"", ",", "\"", "--", "port", "\"", ",", "\"", "8080", "\"", ",", "\"", "--", "stream", "\"", ",", "\"", "TestStream", "\"", ",", "\"", "--", "user", "\"", ",", "\"", "TestUser", "\"", ",", "\"", "AdditionalCommitArguments", "\"", "}", ");", "covCommitDefectsCommand", ".", "runCommand", "(", ");", "assertEquals", "(", "\"", "TestPassword", "\"", ",", "envVars", ".", "get", "(", "\"", "COVERITY_PASSPHRASE", "\"", "))", ";", "consoleLogger", ".", "verifyLastMessage", "(", "\"[", "Coverity", "]", "cov", "-", "commit", "-", "defects", "command", "line", "arguments", ":", "\"", "+", "actualArguments", ".", "toString", "(", "))", ";", "}", "@", "Test", "public", "void", "addCommitArgumentsTest_WithCredentials", "(", ")", "throws", "IOException", ",", "InterruptedException", "{", "setCredentialManager", "(", "\"", "TestUser", "\"", ",", "\"", "TestPassword", "\"", ");", "CIMStream", "cimStream", "=", "new", "CIMStream", "(", "\"", "TestInstance", "\"", ",", "\"", "TestProject", "\"", ",", "\"", "TestStream", "\"", ");", "CIMInstance", "cimInstance", "=", "new", "CIMInstanceBuilder", "(", ").", "withName", "(", "\"", "TestInstance", "\"", ").", "withHost", "(", "\"", "Localhost", "\"", ").", "withPort", "(", "8080", ")", ".", "withUser", "(", "\"\"", ").", "withPassword", "(", "\"\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"", "TestCredentialId", "\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "TestUser", "\"", ").", "withPassword", "(", "\"", "TestPassword", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "withUser", "(", "\"", "TestUser", "\"", ").", "withPassword", "(", "\"", "TestPassword", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Client", ".", "class", "}", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "WebServiceFactory", ".", "class", ",", "Client", ".", "class", "}", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ").", "build", "(", ");", "private", "String", "user", ";", "private", "String", "password", ";", "public", "CIMInstanceBuilder", "withUser", "(", "String", "user", ")", "{", "this", ".", "user", "=", "user", ";", "return", "this", ";", "}", "public", "CIMInstanceBuilder", "withPassword", "(", "String", "password", ")", "{", "this", ".", "password", "=", "password", ";", "instance", ".", "setUser", "(", "user", ")", ";", "instance", ".", "setPassword", "(", "password", ")", ";", "@", "PrepareForTest", "(", "WebServiceFactory", ".", "class", ")", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "admin", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "test", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "false", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "test", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "true", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");", ".", "withUser", "(", "\"", "test", "-", "user", "\"", ").", "withPassword", "(", "\"", "password", "\"", ").", "withUseSSL", "(", "true", ")", ".", "withCredentialId", "(", "\"\"", ")", ".", "build", "(", ");"], "docstring_tokens": ["the", "storage", "of", "passwords", "unencrypted"]}
{"contents": ["mm:", "avoid", "setting", "up", "anonymous", "pages", "into", "file", "mapping", "Reading", "page", "fault", "handler", "code", "I've", "noticed", "that", "under", "right", "circumstances", "kernel", "would", "map", "anonymous", "pages", "into", "file", "mappings:", "if", "the", "VMA", "doesn't", "have", "vm_ops->fault()", "and", "the", "VMA", "wasn't", "fully", "populated", "on", "->mmap(),", "kernel", "would", "handle", "page", "fault", "to", "not", "populated", "pte", "with", "do_anonymous_page().", "Let's", "change", "page", "fault", "handler", "to", "use", "do_anonymous_page()", "only", "on", "anonymous", "VMA", "(->vm_ops", "==", "NULL)", "and", "make", "sure", "that", "the", "VMA", "is", "not", "shared.", "For", "file", "mappings", "without", "vm_ops->fault()", "or", "shred", "VMA", "without", "vm_ops,", "page", "fault", "on", "pte_none()", "entry", "would", "lead", "to", "SIGBUS.", "Signed-off-by:", "Kirill", "A.", "Shutemov", "<kirill.shutemov@linux.intel.com>", "Acked-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Willy", "Tarreau", "<w@1wt.eu>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "File", "mapping", "without", "-", ">", "vm_ops", "?", "*", "/", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_SHARED", ")", "return", "VM_FAULT_SIGBUS", ";", "/", "*", "The", "VMA", "was", "not", "fully", "populated", "on", "mmap", "(", ")", "or", "missing", "VM_DONTEXPAND", "*", "/", "if", "(", "!", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", "return", "VM_FAULT_SIGBUS", ";", "if", "(", "vma", "-", ">", "vm_ops", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";</s>-", "vma", "-", ">", "vm_start", ")", ">", ">", "PAGE_SHIFT", ")", "+", "vma", "-", ">", "vm_pgoff", ";", "if", "(", "vma", "-", ">", "vm_ops", ")", "{", "if", "(", "likely", "(", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "}", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";"], "docstring_tokens": ["mishandles", "anonymous", "pages"]}
{"contents": ["..."], "code_tokens": ["/", "*", "Verify", "that", "file", "size", "large", "enough", "to", "contain", "a", "JPEG", "datastream", ".", "*", "/", "if", "(", "GetBlobSize", "(", "image", ")", "<", "107", ")", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "InsufficientImageDataInFile", "\"", ");", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";</s>"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["ovl:", "verify", "upper", "dentry", "before", "unlink", "and", "rename", "Unlink", "and", "rename", "in", "overlayfs", "checked", "the", "upper", "dentry", "for", "staleness", "by", "verifying", "upper->d_parent", "against", "upperdir.", "However", "the", "dentry", "can", "go", "stale", "also", "by", "being", "unhashed,", "for", "example.", "Expand", "the", "verification", "to", "actually", "look", "up", "the", "name", "again", "(under", "parent", "lock)", "and", "check", "if", "it", "matches", "the", "upper", "dentry.", "This", "matches", "what", "the", "VFS", "does", "before", "passing", "the", "dentry", "to", "filesytem's", "unlink/rename", "methods,", "which", "excludes", "any", "inconsistency", "caused", "by", "overlayfs.", "Signed-off-by:", "Miklos", "Szeredi", "<mszeredi@redhat.com>"], "code_tokens": ["struct", "dentry", "*", "upper", ";", "upper", "=", "lookup_one_len", "(", "dentry", "-", ">", "d_name", ".", "name", ",", "upperdir", ",", "dentry", "-", ">", "d_name", ".", "len", ")", ";", "err", "=", "PTR_ERR", "(", "upper", ")", ";", "if", "(", "IS_ERR", "(", "upper", ")", ")", "goto", "out_unlock", ";", "if", "(", "upper", "=", "=", "ovl_dentry_upper", "(", "dentry", ")", ")", "{", "dput", "(", "upper", ")", ";", "out_unlock", ":", "olddentry", "=", "lookup_one_len", "(", "old", "-", ">", "d_name", ".", "name", ",", "old_upperdir", ",", "old", "-", ">", "d_name", ".", "len", ")", ";", "err", "=", "PTR_ERR", "(", "olddentry", ")", ";", "if", "(", "IS_ERR", "(", "olddentry", ")", ")", "goto", "out_unlock", ";", "err", "=", "-", "ESTALE", ";", "if", "(", "olddentry", "!", "=", "ovl_dentry_upper", "(", "old", ")", ")", "goto", "out_dput_old", ";", "newdentry", "=", "lookup_one_len", "(", "new", "-", ">", "d_name", ".", "name", ",", "new_upperdir", ",", "new", "-", ">", "d_name", ".", "len", ")", ";", "err", "=", "PTR_ERR", "(", "newdentry", ")", ";", "if", "(", "IS_ERR", "(", "newdentry", ")", ")", "goto", "out_dput_old", ";", "err", "=", "-", "ESTALE", ";", "if", "(", "ovl_dentry_upper", "(", "new", ")", ")", "{", "if", "(", "newdentry", "!", "=", "opaquedir", ")", "goto", "out_dput", ";", "if", "(", "newdentry", "!", "=", "ovl_dentry_upper", "(", "new", ")", ")", "goto", "out_dput", ";", "if", "(", "!", "d_is_negative", "(", "newdentry", ")", "&", "&", "(", "!", "new_opaque", "|", "|", "!", "ovl_is_whiteout", "(", "newdentry", ")", "))", "goto", "out_dput", ";", "out_dput_old", ":", "dput", "(", "olddentry", ")", ";</s>struct", "dentry", "*", "upper", "=", "ovl_dentry_upper", "(", "dentry", ")", ";", "if", "(", "upper", "-", ">", "d_parent", "=", "=", "upperdir", ")", "{", "/", "*", "Don", "'", "t", "let", "d_delete", "(", ")", "think", "it", "can", "reset", "d_inode", "*", "/", "dget", "(", "upper", ")", ";", "dput", "(", "upper", ")", ";", "olddentry", "=", "ovl_dentry_upper", "(", "old", ")", ";", "newdentry", "=", "ovl_dentry_upper", "(", "new", ")", ";", "if", "(", "newdentry", ")", "{", "newdentry", "=", "opaquedir", ";", "opaquedir", "=", "NULL", ";", "dget", "(", "newdentry", ")", ";", "newdentry", "=", "lookup_one_len", "(", "new", "-", ">", "d_name", ".", "name", ",", "new_upperdir", ",", "new", "-", ">", "d_name", ".", "len", ")", ";", "err", "=", "PTR_ERR", "(", "newdentry", ")", ";", "if", "(", "IS_ERR", "(", "newdentry", ")", ")", "goto", "out_unlock", ";", "err", "=", "-", "ESTALE", ";", "if", "(", "olddentry", "-", ">", "d_parent", "!", "=", "old_upperdir", ")", "goto", "out_dput", ";", "if", "(", "newdentry", "-", ">", "d_parent", "!", "=", "new_upperdir", ")", "goto", "out_dput", ";"], "docstring_tokens": ["does", "not", "properly", "verify", "the", "upper", "dentry", "before", "proceeding", "with", "unlink", "and", "rename", "system-call", "processing"]}
{"contents": ["net:", "Compute", "protocol", "sequence", "numbers", "and", "fragment", "IDs", "using", "MD5.", "Computers", "have", "become", "a", "lot", "faster", "since", "we", "compromised", "on", "the", "partial", "MD4", "hash", "which", "we", "use", "currently", "for", "performance", "reasons.", "MD5", "is", "a", "much", "safer", "choice,", "and", "is", "inline", "with", "both", "RFC1948", "and", "other", "ISS", "generators", "(OpenBSD,", "Solaris,", "etc.)", "Furthermore,", "only", "having", "24-bits", "of", "the", "sequence", "number", "be", "truly", "unpredictable", "is", "a", "very", "serious", "limitation.", "So", "the", "periodic", "regeneration", "and", "8-bit", "counter", "have", "been", "removed.", "We", "compute", "and", "use", "a", "full", "32-bit", "sequence", "number.", "For", "ipv6,", "DCCP", "was", "found", "to", "use", "a", "32-bit", "truncated", "initial", "sequence", "number", "(it", "needs", "43-bits)", "and", "that", "is", "fixed", "here", "as", "well.", "Reported-by:", "Dan", "Kaminsky", "<dan@doxpara.com>", "Tested-by:", "Willy", "Tarreau", "<w@1wt.eu>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["static", "u32", "random_int_secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", "____cacheline_aligned", ";", "static", "int", "__init", "random_int_secret_init", "(", "void", ")", "get_random_bytes", "(", "random_int_secret", ",", "sizeof", "(", "random_int_secret", ")", ");", "late_initcall", "(", "random_int_secret_init", ")", ";", "DEFINE_PER_CPU", "(", "__u32", "[", "MD5_DIGEST_WORDS", "]", ",", "get_random_int_hash", ")", ";", "unsigned", "int", "ret", ";", "md5_transform", "(", "hash", ",", "random_int_secret", ")", ";", "ret", "=", "hash", "[", "0", "]", ";", "#", "ifndef", "_NET_SECURE_SEQ", "#", "define", "_NET_SECURE_SEQ", "#", "include", "<", "linux", "/", "types", ".", "h", ">", "extern", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", ";", "extern", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ");", "extern", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", ";", "extern", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "u64", "secure_dccpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "#", "endif", "/", "*", "_NET_SECURE_SEQ", "*", "/", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "gen_stats", ".", "o", "gen_estimator", ".", "o", "net_namespace", ".", "o", "secure_seq", ".", "o", "#", "include", "<", "linux", "/", "kernel", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "cryptohash", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "cache", ".", "h", ">", "#", "include", "<", "linux", "/", "random", ".", "h", ">", "#", "include", "<", "linux", "/", "hrtimer", ".", "h", ">", "#", "include", "<", "linux", "/", "ktime", ".", "h", ">", "#", "include", "<", "linux", "/", "string", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "static", "u32", "net_secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", "____cacheline_aligned", ";", "static", "int", "__init", "net_secret_init", "(", "void", ")", "{", "get_random_bytes", "(", "net_secret", ",", "sizeof", "(", "net_secret", ")", ");", "return", "0", ";", "}", "late_initcall", "(", "net_secret_init", ")", ";", "static", "u32", "seq_scale", "(", "u32", "seq", ")", "{", "/", "*", "*", "As", "close", "as", "possible", "to", "RFC", "793", ",", "which", "*", "suggests", "using", "a", "250", "kHz", "clock", ".", "*", "Further", "reading", "shows", "this", "assumes", "2", "Mb", "/", "s", "networks", ".", "*", "For", "10", "Mb", "/", "s", "Ethernet", ",", "a", "1", "MHz", "clock", "is", "appropriate", ".", "*", "For", "10", "Gb", "/", "s", "Ethernet", ",", "a", "1", "GHz", "clock", "should", "be", "ok", ",", "but", "*", "we", "also", "need", "to", "limit", "the", "resolution", "so", "that", "the", "u32", "seq", "*", "overlaps", "less", "than", "one", "time", "per", "MSL", "(", "2", "minutes", ")", ".", "*", "Choosing", "a", "clock", "of", "64", "ns", "period", "is", "OK", ".", "(", "period", "of", "274", "s", ")", "*", "/", "return", "seq", "+", "(", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ">", ">", "6", ")", ";", "}", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", ";", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u32", "i", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", "+", "daddr", "[", "i", "]", ";", "secret", "[", "4", "]", "=", "net_secret", "[", "4", "]", "(", "((", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ")", ";", "for", "(", "i", "=", "5", ";", "i", "<", "MD5_MESSAGE_BYTES", "/", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", ";", "md5_transform", "(", "hash", ",", "secret", ")", ";", "return", "seq_scale", "(", "hash", "[", "0", "]", ");", "}", "EXPORT_SYMBOL", "(", "secure_tcpv6_sequence_number", ")", ";", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", "{", "u32", "secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", ";", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u32", "i", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", "+", "(", "__force", "u32", ")", "daddr", "[", "i", "]", ";", "secret", "[", "4", "]", "=", "net_secret", "[", "4", "]", "+", "(", "__force", "u32", ")", "dport", ";", "for", "(", "i", "=", "5", ";", "i", "<", "MD5_MESSAGE_BYTES", "/", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", ";", "md5_transform", "(", "hash", ",", "secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "#", "endif", "#", "ifdef", "CONFIG_INET", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "hash", "[", "0", "]", "=", "(", "__force", "__u32", ")", "daddr", ";", "hash", "[", "1", "]", "=", "net_secret", "[", "13", "]", ";", "hash", "[", "2", "]", "=", "net_secret", "[", "14", "]", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ")", "{", "__u32", "hash", "[", "4", "]", ";", "memcpy", "(", "hash", ",", "daddr", ",", "16", ")", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "seq_scale", "(", "hash", "[", "0", "]", ");", "}", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "__force", "u32", ")", "dport", "^", "net_secret", "[", "14", "]", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "return", "hash", "[", "0", "]", ";", "}", "EXPORT_SYMBOL_GPL", "(", "secure_ipv4_port_ephemeral", ")", ";", "#", "endif", "#", "if", "defined", "(", "CONFIG_IP_DCCP", ")", "|", "|", "defined", "(", "CONFIG_IP_DCCP_MODULE", ")", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u64", "seq", ";", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "net_secret", "[", "15", "]", ";", "md5_transform", "(", "hash", ",", "net_secret", ")", ";", "seq", "=", "hash", "[", "0", "]", "|", "(", "((", "u64", ")", "hash", "[", "1", "]", ")", "<", "<", "32", ")", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "seq", "&", "=", "(", "1ull", "<", "<", "48", ")", "-", "1", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_dccp_sequence_number", ")", ";", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "u64", "secure_dccpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u32", "secret", "[", "MD5_MESSAGE_BYTES", "/", "4", "]", ";", "u32", "hash", "[", "MD5_DIGEST_WORDS", "]", ";", "u64", "seq", ";", "u32", "i", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", "+", "daddr", "[", "i", "]", ";", "secret", "[", "4", "]", "=", "net_secret", "[", "4", "]", "(", "((", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ")", ";", "for", "(", "i", "=", "5", ";", "i", "<", "MD5_MESSAGE_BYTES", "/", "4", ";", "i", "+", "+)", "secret", "[", "i", "]", "=", "net_secret", "[", "i", "]", ";", "md5_transform", "(", "hash", ",", "secret", ")", ";", "seq", "=", "hash", "[", "0", "]", "|", "(", "((", "u64", ")", "hash", "[", "1", "]", ")", "<", "<", "32", ")", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "seq", "&", "=", "(", "1ull", "<", "<", "48", ")", "-", "1", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_dccpv6_sequence_number", ")", ";", "#", "endif", "#", "endif", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "static", "inline", "__u64", "dccp_v6_init_sequence", "(", "struct", "sk_buff", "*", "skb", ")", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", ">", "#", "include", "<", "net", "/", "secure_seq", ".", "h", "></s>/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Random", "functions", "for", "networking", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "*", "TCP", "initial", "sequence", "number", "picking", ".", "This", "uses", "the", "random", "number", "*", "generator", "to", "pick", "an", "initial", "secret", "value", ".", "This", "value", "is", "hashed", "*", "along", "with", "the", "TCP", "endpoint", "information", "to", "provide", "a", "unique", "*", "starting", "point", "for", "each", "pair", "of", "TCP", "endpoints", ".", "This", "defeats", "*", "attacks", "which", "rely", "on", "guessing", "the", "initial", "TCP", "sequence", "number", ".", "*", "This", "algorithm", "was", "suggested", "by", "Steve", "Bellovin", ".", "*", "*", "Using", "a", "very", "strong", "hash", "was", "taking", "an", "appreciable", "amount", "of", "the", "total", "*", "TCP", "connection", "establishment", "time", ",", "so", "this", "is", "a", "weaker", "hash", ",", "*", "compensated", "for", "by", "changing", "the", "secret", "periodically", ".", "*", "/", "/", "*", "F", ",", "G", "and", "H", "are", "basic", "MD4", "functions", ":", "selection", ",", "majority", ",", "parity", "*", "/", "#", "define", "F", "(", "x", ",", "y", ",", "z", ")", "(", "(", "z", ")", "^", "(", "(", "x", ")", "&", "(", "(", "y", ")", "^", "(", "z", ")", "))", ")", "#", "define", "G", "(", "x", ",", "y", ",", "z", ")", "(", "((", "x", ")", "&", "(", "y", ")", ")", "+", "(", "((", "x", ")", "^", "(", "y", ")", ")", "&", "(", "z", ")", "))", "#", "define", "H", "(", "x", ",", "y", ",", "z", ")", "(", "(", "x", ")", "^", "(", "y", ")", "^", "(", "z", ")", ")", "/", "*", "*", "The", "generic", "round", "function", ".", "The", "application", "is", "so", "specific", "that", "*", "we", "don", "'", "t", "bother", "protecting", "all", "the", "arguments", "with", "parens", ",", "as", "is", "generally", "*", "good", "macro", "practice", ",", "in", "favor", "of", "extra", "legibility", ".", "*", "Rotation", "is", "separate", "from", "addition", "to", "prevent", "recomputation", "*", "/", "#", "define", "ROUND", "(", "f", ",", "a", ",", "b", ",", "c", ",", "d", ",", "x", ",", "s", ")", "\\", "(", "a", "+", "=", "f", "(", "b", ",", "c", ",", "d", ")", "+", "x", ",", "a", "=", "(", "a", "<", "<", "s", ")", "|", "(", "a", ">", ">", "(", "32", "-", "s", ")", "))", "#", "define", "K1", "0", "#", "define", "K2", "013240474631UL", "#", "define", "K3", "015666365641UL", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "static", "__u32", "twothirdsMD4Transform", "(", "__u32", "const", "buf", "[", "4", "]", ",", "__u32", "const", "in", "[", "12", "]", ")", "{", "__u32", "a", "=", "buf", "[", "0", "]", ",", "b", "=", "buf", "[", "1", "]", ",", "c", "=", "buf", "[", "2", "]", ",", "d", "=", "buf", "[", "3", "]", ";", "/", "*", "Round", "1", "*", "/", "ROUND", "(", "F", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "0", "]", "+", "K1", ",", "3", ")", ";", "ROUND", "(", "F", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "1", "]", "+", "K1", ",", "7", ")", ";", "ROUND", "(", "F", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "2", "]", "+", "K1", ",", "11", ")", ";", "ROUND", "(", "F", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "3", "]", "+", "K1", ",", "19", ")", ";", "ROUND", "(", "F", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "K1", ",", "3", ")", ";", "ROUND", "(", "F", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "5", "]", "+", "K1", ",", "7", ")", ";", "ROUND", "(", "F", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "6", "]", "+", "K1", ",", "11", ")", ";", "ROUND", "(", "F", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "7", "]", "+", "K1", ",", "19", ")", ";", "ROUND", "(", "F", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "8", "]", "+", "K1", ",", "3", ")", ";", "ROUND", "(", "F", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "9", "]", "+", "K1", ",", "7", ")", ";", "ROUND", "(", "F", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "10", "]", "+", "K1", ",", "11", ")", ";", "ROUND", "(", "F", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "11", "]", "+", "K1", ",", "19", ")", ";", "/", "*", "Round", "2", "*", "/", "ROUND", "(", "G", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "1", "]", "+", "K2", ",", "3", ")", ";", "ROUND", "(", "G", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "3", "]", "+", "K2", ",", "5", ")", ";", "ROUND", "(", "G", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "5", "]", "+", "K2", ",", "9", ")", ";", "ROUND", "(", "G", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "7", "]", "+", "K2", ",", "13", ")", ";", "ROUND", "(", "G", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "K2", ",", "3", ")", ";", "ROUND", "(", "G", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "11", "]", "+", "K2", ",", "5", ")", ";", "ROUND", "(", "G", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "0", "]", "+", "K2", ",", "9", ")", ";", "ROUND", "(", "G", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "2", "]", "+", "K2", ",", "13", ")", ";", "ROUND", "(", "G", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "4", "]", "+", "K2", ",", "3", ")", ";", "ROUND", "(", "G", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "6", "]", "+", "K2", ",", "5", ")", ";", "ROUND", "(", "G", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "8", "]", "+", "K2", ",", "9", ")", ";", "ROUND", "(", "G", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "10", "]", "+", "K2", ",", "13", ")", ";", "/", "*", "Round", "3", "*", "/", "ROUND", "(", "H", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "3", "]", "+", "K3", ",", "3", ")", ";", "ROUND", "(", "H", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "7", "]", "+", "K3", ",", "9", ")", ";", "ROUND", "(", "H", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "11", "]", "+", "K3", ",", "11", ")", ";", "ROUND", "(", "H", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "2", "]", "+", "K3", ",", "15", ")", ";", "ROUND", "(", "H", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "6", "]", "+", "K3", ",", "3", ")", ";", "ROUND", "(", "H", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "10", "]", "+", "K3", ",", "9", ")", ";", "ROUND", "(", "H", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "1", "]", "+", "K3", ",", "11", ")", ";", "ROUND", "(", "H", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "5", "]", "+", "K3", ",", "15", ")", ";", "ROUND", "(", "H", ",", "a", ",", "b", ",", "c", ",", "d", ",", "in", "[", "9", "]", "+", "K3", ",", "3", ")", ";", "ROUND", "(", "H", ",", "d", ",", "a", ",", "b", ",", "c", ",", "in", "[", "0", "]", "+", "K3", ",", "9", ")", ";", "ROUND", "(", "H", ",", "c", ",", "d", ",", "a", ",", "b", ",", "in", "[", "4", "]", "+", "K3", ",", "11", ")", ";", "ROUND", "(", "H", ",", "b", ",", "c", ",", "d", ",", "a", ",", "in", "[", "8", "]", "+", "K3", ",", "15", ")", ";", "return", "buf", "[", "1", "]", "+", "b", ";", "/", "*", "\"", "most", "hashed", "\"", "word", "*", "/", "/", "*", "Alternative", ":", "return", "sum", "of", "all", "words", "?", "*", "/", "}", "#", "endif", "#", "undef", "ROUND", "#", "undef", "F", "#", "undef", "G", "#", "undef", "H", "#", "undef", "K1", "#", "undef", "K2", "#", "undef", "K3", "/", "*", "This", "should", "not", "be", "decreased", "so", "low", "that", "ISNs", "wrap", "too", "fast", ".", "*", "/", "#", "define", "REKEY_INTERVAL", "(", "300", "*", "HZ", ")", "/", "*", "*", "Bit", "layout", "of", "the", "tcp", "sequence", "numbers", "(", "before", "adding", "current", "time", ")", ":", "*", "bit", "24", "-", "31", ":", "increased", "after", "every", "key", "exchange", "*", "bit", "0", "-", "23", ":", "hash", "(", "source", ",", "dest", ")", "*", "*", "The", "implementation", "is", "similar", "to", "the", "algorithm", "described", "*", "in", "the", "Appendix", "of", "RFC", "1185", ",", "except", "that", "*", "-", "it", "uses", "a", "1", "MHz", "clock", "instead", "of", "a", "250", "kHz", "clock", "*", "-", "it", "performs", "a", "rekey", "every", "5", "minutes", ",", "which", "is", "equivalent", "*", "to", "a", "(", "source", ",", "dest", ")", "tulple", "dependent", "forward", "jump", "of", "the", "*", "clock", "by", "0", ".", ".", "2", "^", "(", "HASH_BITS", "+", "1", ")", "*", "*", "Thus", "the", "average", "ISN", "wraparound", "time", "is", "68", "minutes", "instead", "of", "*", "4", ".", "55", "hours", ".", "*", "*", "SMP", "cleanup", "and", "lock", "avoidance", "with", "poor", "man", "'", "s", "RCU", ".", "*", "Manfred", "Spraul", "<", "manfred", "@", "colorfullife", ".", "com", ">", "*", "*", "/", "#", "define", "COUNT_BITS", "8", "#", "define", "COUNT_MASK", "(", "(", "1", "<", "<", "COUNT_BITS", ")", "-", "1", ")", "#", "define", "HASH_BITS", "24", "#", "define", "HASH_MASK", "(", "(", "1", "<", "<", "HASH_BITS", ")", "-", "1", ")", "static", "struct", "keydata", "{", "__u32", "count", ";", "/", "*", "already", "shifted", "to", "the", "final", "position", "*", "/", "__u32", "secret", "[", "12", "]", ";", "}", "____cacheline_aligned", "ip_keydata", "[", "2", "]", ";", "static", "unsigned", "int", "ip_cnt", ";", "static", "void", "rekey_seq_generator", "(", "struct", "work_struct", "*", "work", ")", ";", "static", "DECLARE_DELAYED_WORK", "(", "rekey_work", ",", "rekey_seq_generator", ")", ";", "/", "*", "*", "Lock", "avoidance", ":", "*", "The", "ISN", "generation", "runs", "lockless", "-", "it", "'", "s", "just", "a", "hash", "over", "random", "data", ".", "*", "State", "changes", "happen", "every", "5", "minutes", "when", "the", "random", "key", "is", "replaced", ".", "*", "Synchronization", "is", "performed", "by", "having", "two", "copies", "of", "the", "hash", "function", "*", "state", "and", "rekey_seq_generator", "always", "updates", "the", "inactive", "copy", ".", "*", "The", "copy", "is", "then", "activated", "by", "updating", "ip_cnt", ".", "*", "The", "implementation", "breaks", "down", "if", "someone", "blocks", "the", "thread", "*", "that", "processes", "SYN", "requests", "for", "more", "than", "5", "minutes", ".", "Should", "never", "*", "happen", ",", "and", "even", "if", "that", "happens", "only", "a", "not", "perfectly", "compliant", "*", "ISN", "is", "generated", ",", "nothing", "fatal", ".", "*", "/", "static", "void", "rekey_seq_generator", "(", "struct", "work_struct", "*", "work", ")", "struct", "keydata", "*", "keyptr", "=", "&", "ip_keydata", "[", "1", "^", "(", "ip_cnt", "&", "1", ")", "];", "get_random_bytes", "(", "keyptr", "-", ">", "secret", ",", "sizeof", "(", "keyptr", "-", ">", "secret", ")", ");", "keyptr", "-", ">", "count", "=", "(", "ip_cnt", "&", "COUNT_MASK", ")", "<", "<", "HASH_BITS", ";", "smp_wmb", "(", ");", "ip_cnt", "+", "+;", "schedule_delayed_work", "(", "&", "rekey_work", ",", "round_jiffies_relative", "(", "REKEY_INTERVAL", ")", ");", "}", "static", "inline", "struct", "keydata", "*", "get_keyptr", "(", "void", ")", "{", "struct", "keydata", "*", "keyptr", "=", "&", "ip_keydata", "[", "ip_cnt", "&", "1", "]", ";", "smp_rmb", "(", ");", "return", "keyptr", ";", "}", "static", "__init", "int", "seqgen_init", "(", "void", ")", "{", "rekey_seq_generator", "(", "NULL", ")", ";", "late_initcall", "(", "seqgen_init", ")", ";", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "__u32", "seq", ";", "__u32", "hash", "[", "12", "]", ";", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "/", "*", "The", "procedure", "is", "the", "same", "as", "for", "IPv4", ",", "but", "addresses", "are", "longer", ".", "*", "Thus", "we", "must", "use", "twothirdsMD4Transform", ".", "*", "/", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "hash", "[", "4", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "memcpy", "(", "&", "hash", "[", "5", "]", ",", "keyptr", "-", ">", "secret", ",", "sizeof", "(", "__u32", ")", "*", "7", ")", ";", "seq", "=", "twothirdsMD4Transform", "(", "(", "const", "__u32", "*", ")", "daddr", ",", "hash", ")", "&", "HASH_MASK", ";", "seq", "+", "=", "keyptr", "-", ">", "count", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_tcpv6_sequence_number", ")", ";", "#", "endif", "/", "*", "The", "code", "below", "is", "shamelessly", "stolen", "from", "secure_tcp_sequence_number", "(", ").", "*", "All", "blames", "to", "Andrey", "V", ".", "Savochkin", "<", "saw", "@", "msu", ".", "ru", ">", ".", "*", "/", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", "{", "struct", "keydata", "*", "keyptr", ";", "__u32", "hash", "[", "4", "]", ";", "keyptr", "=", "get_keyptr", "(", ");", "/", "*", "*", "Pick", "a", "unique", "starting", "offset", "for", "each", "IP", "destination", ".", "*", "The", "dest", "ip", "address", "is", "placed", "in", "the", "starting", "vector", ",", "*", "which", "is", "then", "hashed", "with", "random", "data", ".", "*", "/", "hash", "[", "0", "]", "=", "(", "__force", "__u32", ")", "daddr", ";", "hash", "[", "1", "]", "=", "keyptr", "-", ">", "secret", "[", "9", "]", ";", "hash", "[", "2", "]", "=", "keyptr", "-", ">", "secret", "[", "10", "]", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "return", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "}", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ")", "{", "const", "struct", "keydata", "*", "keyptr", ";", "__u32", "hash", "[", "4", "]", ";", "keyptr", "=", "get_keyptr", "(", ");", "hash", "[", "0", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "0", "]", ";", "hash", "[", "1", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "1", "]", ";", "hash", "[", "2", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "2", "]", ";", "hash", "[", "3", "]", "=", "(", "__force", "__u32", ")", "daddr", "[", "3", "]", ";", "return", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "}", "#", "ifdef", "CONFIG_INET", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "__u32", "seq", ";", "__u32", "hash", "[", "4", "]", ";", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "/", "*", "*", "Pick", "a", "unique", "starting", "offset", "for", "each", "TCP", "connection", "endpoints", "*", "(", "saddr", ",", "daddr", ",", "sport", ",", "dport", ")", ".", "*", "Note", "that", "the", "words", "are", "placed", "into", "the", "starting", "vector", ",", "which", "is", "*", "then", "mixed", "with", "a", "partial", "MD4", "over", "random", "data", ".", "*", "/", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "seq", "=", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", "&", "HASH_MASK", ";", "seq", "+", "=", "keyptr", "-", ">", "count", ";", "/", "*", "*", "As", "close", "as", "possible", "to", "RFC", "793", ",", "which", "*", "suggests", "using", "a", "250", "kHz", "clock", ".", "*", "Further", "reading", "shows", "this", "assumes", "2", "Mb", "/", "s", "networks", ".", "*", "For", "10", "Mb", "/", "s", "Ethernet", ",", "a", "1", "MHz", "clock", "is", "appropriate", ".", "*", "For", "10", "Gb", "/", "s", "Ethernet", ",", "a", "1", "GHz", "clock", "should", "be", "ok", ",", "but", "*", "we", "also", "need", "to", "limit", "the", "resolution", "so", "that", "the", "u32", "seq", "*", "overlaps", "less", "than", "one", "time", "per", "MSL", "(", "2", "minutes", ")", ".", "*", "Choosing", "a", "clock", "of", "64", "ns", "period", "is", "OK", ".", "(", "period", "of", "274", "s", ")", "*", "/", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ">", ">", "6", ";", "return", "seq", ";", "}", "/", "*", "Generate", "secure", "starting", "point", "for", "ephemeral", "IPV4", "transport", "port", "search", "*", "/", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", "{", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "u32", "hash", "[", "4", "]", ";", "/", "*", "*", "Pick", "a", "unique", "starting", "offset", "for", "each", "ephemeral", "port", "search", "*", "(", "saddr", ",", "daddr", ",", "dport", ")", "and", "48bits", "of", "random", "data", ".", "*", "/", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "__force", "u32", ")", "dport", "^", "keyptr", "-", ">", "secret", "[", "10", "]", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "return", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "secure_ipv4_port_ephemeral", ")", ";", "#", "if", "defined", "(", "CONFIG_IPV6", ")", "|", "|", "defined", "(", "CONFIG_IPV6_MODULE", ")", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", "{", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "u32", "hash", "[", "12", "]", ";", "memcpy", "(", "hash", ",", "saddr", ",", "16", ")", ";", "hash", "[", "4", "]", "=", "(", "__force", "u32", ")", "dport", ";", "memcpy", "(", "&", "hash", "[", "5", "]", ",", "keyptr", "-", ">", "secret", ",", "sizeof", "(", "__u32", ")", "*", "7", ")", ";", "return", "twothirdsMD4Transform", "(", "(", "const", "__u32", "*", ")", "daddr", ",", "hash", ")", ";", "}", "#", "endif", "#", "if", "defined", "(", "CONFIG_IP_DCCP", ")", "|", "|", "defined", "(", "CONFIG_IP_DCCP_MODULE", ")", "/", "*", "Similar", "to", "secure_tcp_sequence_number", "but", "generate", "a", "48", "bit", "value", "*", "bit", "'", "s", "32", "-", "47", "increase", "every", "key", "exchange", "*", "0", "-", "31", "hash", "(", "source", ",", "dest", ")", "*", "/", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "u64", "seq", ";", "__u32", "hash", "[", "4", "]", ";", "struct", "keydata", "*", "keyptr", "=", "get_keyptr", "(", ");", "hash", "[", "0", "]", "=", "(", "__force", "u32", ")", "saddr", ";", "hash", "[", "1", "]", "=", "(", "__force", "u32", ")", "daddr", ";", "hash", "[", "2", "]", "=", "(", "(", "__force", "u16", ")", "sport", "<", "<", "16", ")", "+", "(", "__force", "u16", ")", "dport", ";", "hash", "[", "3", "]", "=", "keyptr", "-", ">", "secret", "[", "11", "]", ";", "seq", "=", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "seq", "|", "=", "(", "(", "u64", ")", "keyptr", "-", ">", "count", ")", "<", "<", "(", "32", "-", "HASH_BITS", ")", ";", "seq", "+", "=", "ktime_to_ns", "(", "ktime_get_real", "(", "))", ";", "seq", "&", "=", "(", "1ull", "<", "<", "48", ")", "-", "1", ";", "return", "seq", ";", "}", "EXPORT_SYMBOL", "(", "secure_dccp_sequence_number", ")", ";", "#", "endif", "#", "endif", "/", "*", "CONFIG_INET", "*", "/", "DEFINE_PER_CPU", "(", "__u32", "[", "4", "]", ",", "get_random_int_hash", ")", ";", "struct", "keydata", "*", "keyptr", ";", "int", "ret", ";", "keyptr", "=", "get_keyptr", "(", ");", "ret", "=", "half_md4_transform", "(", "hash", ",", "keyptr", "-", ">", "secret", ")", ";", "extern", "__u32", "secure_ip_id", "(", "__be32", "daddr", ")", ";", "extern", "__u32", "secure_ipv6_id", "(", "const", "__be32", "daddr", "[", "4", "]", ");", "extern", "u32", "secure_ipv4_port_ephemeral", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "dport", ")", ";", "extern", "u32", "secure_ipv6_port_ephemeral", "(", "const", "__be32", "*", "saddr", ",", "const", "__be32", "*", "daddr", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "__u32", "secure_tcpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "extern", "u64", "secure_dccp_sequence_number", "(", "__be32", "saddr", ",", "__be32", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", ";", "gen_stats", ".", "o", "gen_estimator", ".", "o", "net_namespace", ".", "o", "static", "inline", "__u32", "secure_dccpv6_sequence_number", "(", "__be32", "*", "saddr", ",", "__be32", "*", "daddr", ",", "__be16", "sport", ",", "__be16", "dport", ")", "{", "return", "secure_tcpv6_sequence_number", "(", "saddr", ",", "daddr", ",", "sport", ",", "dport", ")", ";", "}", "static", "inline", "__u32", "dccp_v6_init_sequence", "(", "struct", "sk_buff", "*", "skb", ")"], "docstring_tokens": ["doesn't", "use", "cryptographic", "hashing", "at", "all", "for", "people", "in", "protected", "environments", "where", "that", "might", "be", "safe", "to", "do)"]}
{"contents": ["AMQP-830", "Enable", "Hostname", "Verification", "JIRA:", "https://jira.spring.io/browse/AMQP-830", "*", "Fix", "typos", "and", "non-relevant", "sentences"], "code_tokens": ["*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ".", "MethodCallback", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ".", "MethodFilter", ";", "*", "{", "@", "code", "JKS", "}", "truststore", "using", "the", "supplied", "properties", "and", "initializes", "{", "@", "code", "SunX509", "}", "key", "private", "static", "final", "Method", "enableHostnameVerificationNoArgMethod", ";", "static", "{", "final", "AtomicReference", "<", "Method", ">", "method1", "=", "new", "AtomicReference", "<", ">(", ");", "ReflectionUtils", ".", "doWithMethods", "(", "ConnectionFactory", ".", "class", ",", "m", "-", ">", "{", "if", "(", "m", ".", "getParameterTypes", "(", ").", "length", "=", "=", "0", ")", "{", "method1", ".", "set", "(", "m", ")", ";", "}", "}", ",", "m", "-", ">", "m", ".", "getName", "(", ").", "equals", "(", "\"", "enableHostnameVerification", "\"", "))", ";", "enableHostnameVerificationNoArgMethod", "=", "method1", ".", "get", "(", ");", "}", "private", "String", "keyStore", ";", "private", "String", "trustStore", ";", "private", "Resource", "keyStoreResource", ";", "private", "Resource", "trustStoreResource", ";", "private", "String", "keyStorePassphrase", ";", "private", "String", "trustStorePassphrase", ";", "private", "String", "keyStoreType", ";", "private", "String", "trustStoreType", ";", "private", "String", "sslAlgorithm", "=", "TLS_V1_1", ";", "private", "boolean", "sslAlgorithmSet", ";", "private", "SecureRandom", "secureRandom", ";", "private", "boolean", "enableHostnameVerification", ";", "/", "**", "*", "Enable", "server", "hostname", "verification", "for", "TLS", "connections", ".", "*", "<", "p", ">", "*", "This", "enables", "hostname", "verification", "regardless", "of", "the", "IO", "mode", "used", "(", "blocking", "or", "*", "non", "-", "blocking", "IO", ")", ".", "*", "Requires", "amqp", "-", "client", "5", ".", "4", ".", "0", "or", "later", ".", "*", "@", "param", "enable", "true", "to", "enable", ".", "*", "@", "since", "1", ".", "7", ".", "10", "*", "/", "public", "void", "setEnableHostnameVerification", "(", "boolean", "enable", ")", "{", "Assert", ".", "notNull", "(", "enableHostnameVerificationNoArgMethod", ",", "\"", "Host", "name", "verification", "requires", "amqp", "-", "client", "5", ".", "4", ".", "0", "or", "later", "\"", ");", "this", ".", "enableHostnameVerification", "=", "enable", ";", "}", "checkHostVerification", "(", ");", "private", "void", "useDefaultTrustStoreMechanism", "(", ")", "throws", "Exception", "{", "checkHostVerification", "(", ");", "}", "private", "void", "checkHostVerification", "(", ")", "throws", "Exception", "{", "if", "(", "this", ".", "enableHostnameVerification", ")", "{", "enableHostnameVerificationNoArgMethod", ".", "invoke", "(", "this", ".", "connectionFactory", ")", ";", "}", "=", "==", "==", "Connection", "Factory", "Bean", "Changes", "The", "`", "RabbitConnectionFactoryBean", "`", "now", "provides", "an", "`", "enableHostnameVerification", "`", "property", ";", "set", "it", "to", "`", "true", "`", "to", "enable", "host", "name", "verification", ".", "Host", "name", "verification", "requires", "overriding", "the", "`", "amqp", "-", "client", "`", "to", "5", ".", "4", ".", "0", "or", "later", ".</s>*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "security", ".", "KeyStoreException", ";", "*", "{", "@", "code", "JKS", "}", "truststore", "using", "the", "supplied", "properties", "and", "intializes", "{", "@", "code", "SunX509", "}", "key", "private", "volatile", "String", "keyStore", ";", "private", "volatile", "String", "trustStore", ";", "private", "volatile", "Resource", "keyStoreResource", ";", "private", "volatile", "Resource", "trustStoreResource", ";", "private", "volatile", "String", "keyStorePassphrase", ";", "private", "volatile", "String", "trustStorePassphrase", ";", "private", "volatile", "String", "keyStoreType", ";", "private", "volatile", "String", "trustStoreType", ";", "private", "volatile", "String", "sslAlgorithm", "=", "TLS_V1_1", ";", "private", "volatile", "boolean", "sslAlgorithmSet", ";", "private", "volatile", "SecureRandom", "secureRandom", ";", "private", "void", "useDefaultTrustStoreMechanism", "(", ")", "throws", "NoSuchAlgorithmException", ",", "KeyManagementException", ",", "KeyStoreException", "{"], "docstring_tokens": ["lack", "of", "hostname", "validation", "."]}
{"contents": ["Merge", "branch", "'feature/stateless_csrf_upon_login'", "into", "develop"], "code_tokens": ["/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "Cloud", "Foundry", "*", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2015", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "CsrfToken", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "CsrfTokenRepository", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "DefaultCsrfToken", ";", "import", "javax", ".", "servlet", ".", "http", ".", "Cookie", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "public", "class", "CookieBasedCsrfTokenRepository", "implements", "CsrfTokenRepository", "{", "public", "static", "final", "String", "DEFAULT_CSRF_HEADER_NAME", "=", "\"", "X", "-", "CSRF", "-", "TOKEN", "\"", ";", "public", "static", "final", "String", "DEFAULT_CSRF_COOKIE_NAME", "=", "\"", "X", "-", "Uaa", "-", "Csrf", "\"", ";", "public", "static", "final", "int", "DEFAULT_COOKIE_MAX_AGE", "=", "300", ";", "private", "RandomValueStringGenerator", "generator", "=", "new", "RandomValueStringGenerator", "(", "6", ")", ";", "private", "String", "parameterName", "=", "DEFAULT_CSRF_COOKIE_NAME", ";", "private", "String", "headerName", "=", "DEFAULT_CSRF_HEADER_NAME", ";", "private", "int", "cookieMaxAge", "=", "DEFAULT_COOKIE_MAX_AGE", ";", "public", "int", "getCookieMaxAge", "(", ")", "{", "return", "cookieMaxAge", ";", "}", "public", "void", "setCookieMaxAge", "(", "int", "cookieMaxAge", ")", "{", "this", ".", "cookieMaxAge", "=", "cookieMaxAge", ";", "}", "public", "String", "getHeaderName", "(", ")", "{", "return", "headerName", ";", "}", "public", "void", "setHeaderName", "(", "String", "headerName", ")", "{", "this", ".", "headerName", "=", "headerName", ";", "}", "public", "String", "getParameterName", "(", ")", "{", "return", "parameterName", ";", "}", "public", "void", "setParameterName", "(", "String", "parameterName", ")", "{", "this", ".", "parameterName", "=", "parameterName", ";", "}", "public", "void", "setGenerator", "(", "RandomValueStringGenerator", "generator", ")", "{", "this", ".", "generator", "=", "generator", ";", "}", "public", "RandomValueStringGenerator", "getGenerator", "(", ")", "{", "return", "generator", ";", "}", "@", "Override", "public", "CsrfToken", "generateToken", "(", "HttpServletRequest", "request", ")", "{", "String", "token", "=", "generator", ".", "generate", "(", ");", "return", "new", "DefaultCsrfToken", "(", "getHeaderName", "(", "),", "getParameterName", "(", "),", "token", ")", ";", "}", "@", "Override", "public", "void", "saveToken", "(", "CsrfToken", "token", ",", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "boolean", "expire", "=", "false", ";", "if", "(", "token", "=", "=", "null", ")", "{", "token", "=", "generateToken", "(", "request", ")", ";", "expire", "=", "true", ";", "}", "Cookie", "csrfCookie", "=", "new", "Cookie", "(", "token", ".", "getParameterName", "(", "),", "token", ".", "getToken", "(", "))", ";", "csrfCookie", ".", "setHttpOnly", "(", "true", ")", ";", "if", "(", "expire", ")", "{", "csrfCookie", ".", "setMaxAge", "(", "0", ")", ";", "}", "else", "{", "csrfCookie", ".", "setMaxAge", "(", "getCookieMaxAge", "(", "))", ";", "}", "response", ".", "addCookie", "(", "csrfCookie", ")", ";", "}", "@", "Override", "public", "CsrfToken", "loadToken", "(", "HttpServletRequest", "request", ")", "{", "Cookie", "[", "]", "cookies", "=", "request", ".", "getCookies", "(", ");", "if", "(", "cookies", "!", "=", "null", ")", "{", "for", "(", "Cookie", "cookie", ":", "request", ".", "getCookies", "(", "))", "{", "if", "(", "getParameterName", "(", ").", "equals", "(", "cookie", ".", "getName", "(", "))", ")", "{", "return", "new", "DefaultCsrfToken", "(", "getHeaderName", "(", "),", "getParameterName", "(", "),", "cookie", ".", "getValue", "(", "))", ";", "}", "}", "}", "return", "null", ";", "}", "}", "@", "@", "-", "272", ",", "9", "+", "272", ",", "11", "@", "@", "public", "String", "getUrl", "(", "String", "path", ")", "{", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "for", "(", "String", "cookie", ":", "exchange", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "Cloud", "Foundry", "*", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2015", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletResponse", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "CsrfToken", ";", "import", "javax", ".", "servlet", ".", "http", ".", "Cookie", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "public", "class", "CookieBasedCsrfTokenRepositoryTests", "{", "@", "Test", "public", "void", "testGetHeader_and_Parameter_Name", "(", ")", "throws", "Exception", "{", "CookieBasedCsrfTokenRepository", "repo", "=", "new", "CookieBasedCsrfTokenRepository", "(", ");", "assertEquals", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "repo", ".", "getParameterName", "(", "))", ";", "repo", ".", "setParameterName", "(", "\"", "testcookie", "\"", ");", "assertEquals", "(", "\"", "testcookie", "\"", ",", "repo", ".", "getParameterName", "(", "))", ";", "assertEquals", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_HEADER_NAME", ",", "repo", ".", "getHeaderName", "(", "))", ";", "repo", ".", "setHeaderName", "(", "\"", "testheader", "\"", ");", "assertEquals", "(", "\"", "testheader", "\"", ",", "repo", ".", "getHeaderName", "(", "))", ";", "repo", ".", "setGenerator", "(", "new", "RandomValueStringGenerator", "(", ")", "{", "@", "Override", "public", "String", "generate", "(", ")", "{", "return", "\"", "token", "-", "id", "\"", ";", "}", "}", ");", "CsrfToken", "token", "=", "repo", ".", "generateToken", "(", "new", "MockHttpServletRequest", "(", "))", ";", "assertEquals", "(", "\"", "testheader", "\"", ",", "token", ".", "getHeaderName", "(", "))", ";", "assertEquals", "(", "\"", "testcookie", "\"", ",", "token", ".", "getParameterName", "(", "))", ";", "assertEquals", "(", "\"", "token", "-", "id", "\"", ",", "token", ".", "getToken", "(", "))", ";", "}", "@", "Test", "public", "void", "testSave_and_Load_Token", "(", ")", "throws", "Exception", "{", "CookieBasedCsrfTokenRepository", "repo", "=", "new", "CookieBasedCsrfTokenRepository", "(", ");", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "CsrfToken", "token", "=", "repo", ".", "generateToken", "(", "request", ")", ";", "repo", ".", "saveToken", "(", "token", ",", "request", ",", "response", ")", ";", "Cookie", "cookie", "=", "response", ".", "getCookie", "(", "token", ".", "getParameterName", "(", "))", ";", "assertNotNull", "(", "cookie", ")", ";", "assertEquals", "(", "token", ".", "getToken", "(", "),", "cookie", ".", "getValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cookie", ".", "isHttpOnly", "(", "))", ";", "request", ".", "setCookies", "(", "cookie", ")", ";", "CsrfToken", "saved", "=", "repo", ".", "loadToken", "(", "request", ")", ";", "assertEquals", "(", "token", ".", "getToken", "(", "),", "saved", ".", "getToken", "(", "))", ";", "assertEquals", "(", "token", ".", "getHeaderName", "(", "),", "saved", ".", "getHeaderName", "(", "))", ";", "assertEquals", "(", "token", ".", "getParameterName", "(", "),", "saved", ".", "getParameterName", "(", "))", ";", "}", "}", "<", "bean", "id", "=", "\"", "uiLoginRequestMatcher", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "login", ".", "do", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "uiLogoutRequestMatcher", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "logout", ".", "do", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "uiAuthorizeRequestMatcher", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "oauth", "/", "authorize", "*", "*\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "uiRequestMatcher", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "OrRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", ">", "<", "list", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "oauth", "/", "**", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "login", "*", "*\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "logout", ".", "do", "*", "*\"", "/", ">", "<", "/", "bean", ">", "<", "/", "list", ">", "<", "/", "constructor", "-", "arg", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "loginCookieCsrfRepository", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", "\"", "/>", "<", "bean", "id", "=", "\"", "logoutFilter", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "authentication", ".", "logout", ".", "LogoutFilter", "\"", ">", "<", "constructor", "-", "arg", "index", "=", "\"", "0", "\"", "ref", "=", "\"", "logoutHandler", "\"", "/>", "<", "constructor", "-", "arg", "index", "=", "\"", "1", "\"", ">", "<", "util", ":", "list", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "authentication", ".", "logout", ".", "SecurityContextLogoutHandler", "\"", "/>", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "CsrfLogoutHandler", "\"", ">", "<", "constructor", "-", "arg", "ref", "=", "\"", "loginCookieCsrfRepository", "\"", "/>", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "authentication", ".", "logout", ".", "CookieClearingLogoutHandler", "\"", ">", "<", "constructor", "-", "arg", "index", "=", "\"", "0", "\"", ">", "<", "util", ":", "list", ">", "<", "value", ">", "JSESSIONID", "<", "/", "value", ">", "</", "util", ":", "list", ">", "<", "/", "constructor", "-", "arg", ">", "<", "/", "bean", ">", "<", "/", "util", ":", "list", ">", "<", "/", "constructor", "-", "arg", ">", "<", "property", "name", "=", "\"", "logoutRequestMatcher", "\"", "ref", "=", "\"", "uiLogoutRequestMatcher", "\"", "/>", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "savedRequestCache", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "savedrequest", ".", "HttpSessionRequestCache", "\"", ">", "<", "property", "name", "=", "\"", "requestMatcher", "\"", "ref", "=", "\"", "uiAuthorizeRequestMatcher", "\"", "/>", "<", "/", "bean", ">", "<", "form", "-", "login", "login", "-", "page", "=", "\"/", "login", "\"", "username", "-", "parameter", "=", "\"", "username", "\"", "password", "-", "parameter", "=", "\"", "password", "\"", "login", "-", "processing", "-", "url", "=", "\"/", "login", ".", "do", "\"", "authentication", "-", "failure", "-", "handler", "-", "ref", "=", "\"", "loginAuthenticationFailureHandler", "\"", "authentication", "-", "details", "-", "source", "-", "ref", "=", "\"", "authenticationDetailsSource", "\"", "default", "-", "target", "-", "url", "=", "\"/", "\"/", ">", "<", "!-", "-<", "logout", "logout", "-", "url", "=", "\"/", "logout", ".", "do", "\"", "success", "-", "handler", "-", "ref", "=", "\"", "logoutHandler", "\"", "invalidate", "-", "session", "=", "\"", "true", "\"", "/>", "--", ">", "<", "custom", "-", "filter", "ref", "=", "\"", "logoutFilter", "\"", "before", "=", "\"", "LOGOUT_FILTER", "\"", "/>", "<", "csrf", "disabled", "=", "\"", "false", "\"", "token", "-", "repository", "-", "ref", "=", "\"", "loginCookieCsrfRepository", "\"", "request", "-", "matcher", "-", "ref", "=", "\"", "uiLoginRequestMatcher", "\"", "/>", "<", "access", "-", "denied", "-", "handler", "error", "-", "page", "=", "\"/", "login", "?", "error", "=", "invalid_login_request", "\"", "/>", "<", "request", "-", "cache", "ref", "=", "\"", "savedRequestCache", "\"", "/>", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "IntegrationTestContextLoader", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "ResponseEntity", "<", "String", ">", "result", ";", "result", "=", "serverRunning", ".", "getForString", "(", "\"/", "id", "\"", ",", "appHeaders", ")", ";", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "appHeaders", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "result", "=", "serverRunning", ".", "getForString", "(", "location", ",", "uaaHeaders", ")", ";", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "uaaHeaders", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "result", "=", "serverRunning", ".", "getForString", "(", "location", ",", "uaaHeaders", ")", ";", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "uaaHeaders", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "extractCookieCsrf", "(", "result", ".", "getBody", "(", "))", ");", "result", "=", "serverRunning", ".", "postForString", "(", "location", ",", "formData", ",", "uaaHeaders", ")", ";", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "uaaHeaders", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "result", "=", "serverRunning", ".", "getForString", "(", "location", ",", "uaaHeaders", ")", ";", "result", "=", "serverRunning", ".", "postForString", "(", "location", ",", "formData", ",", "uaaHeaders", ")", ";", "result", "=", "serverRunning", ".", "getForString", "(", "location", ",", "appHeaders", ")", ";", "public", "static", "String", "extractCookieCsrf", "(", "String", "body", ")", "{", "String", "pattern", "=", "\"", "\\\\", "<", "input", "type", "=", "\\\\", "\\\"", "hidden", "\\", "\\\\", "\"", "name", "=", "\\\\", "\\\"", "X", "-", "Uaa", "-", "Csrf", "\\", "\\\\", "\"", "value", "=", "\\\\", "\\\"", "(.", "*?", ")\\", "\\\\", "\"\"", ";", "Pattern", "linkPattern", "=", "Pattern", ".", "compile", "(", "pattern", ")", ";", "Matcher", "matcher", "=", "linkPattern", ".", "matcher", "(", "body", ")", ";", "if", "(", "matcher", ".", "find", "(", "))", "{", "return", "matcher", ".", "group", "(", "1", ")", ";", "}", "return", "null", ";", "}", "login", ".", "invalid_login_request", "=", "Invalid", "login", "attempt", ",", "request", "does", "not", "meet", "our", "security", "standards", ",", "please", "try", "again", ".", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "cookie", ":", "response", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "}", "String", "csrf", "=", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "csrf", ")", ";", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "import", "org", ".", "apache", ".", "http", ".", "Header", ";", "import", "org", ".", "apache", ".", "http", ".", "HttpHeaders", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "config", ".", "RequestConfig", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "CloseableHttpResponse", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "HttpGet", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "HttpPost", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "HttpUriRequest", ";", "import", "org", ".", "apache", ".", "http", ".", "client", ".", "methods", ".", "RequestBuilder", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "BasicCookieStore", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "CloseableHttpClient", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "HttpClients", ";", "import", "org", ".", "apache", ".", "http", ".", "message", ".", "BasicHeader", ";", "import", "org", ".", "apache", ".", "http", ".", "util", ".", "EntityUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ".", "FOUND", ";", "import", "static", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ".", "OK", ";", "Header", "header", "=", "new", "BasicHeader", "(", "HttpHeaders", ".", "ACCEPT", ",", "MediaType", ".", "TEXT_HTML_VALUE", ")", ";", "List", "<", "Header", ">", "headers", "=", "Arrays", ".", "asList", "(", "header", ")", ";", "BasicCookieStore", "cookieStore", "=", "new", "BasicCookieStore", "(", ");", "CloseableHttpClient", "httpclient", ";", "@", "Before", "public", "void", "createHttpClient", "(", ")", "throws", "Exception", "{", "httpclient", "=", "HttpClients", ".", "custom", "(", ")", ".", "setDefaultRequestConfig", "(", "RequestConfig", ".", "DEFAULT", ")", ".", "setDefaultHeaders", "(", "headers", ")", ".", "setDefaultCookieStore", "(", "cookieStore", ")", ".", "build", "(", ");", "}", "@", "After", "public", "void", "closeClient", "(", ")", "throws", "Exception", "{", "httpclient", ".", "close", "(", ");", "}", "@", "Test", "public", "void", "testUnauthenticatedRedirect", "(", ")", "throws", "Exception", "{", "String", "location", "=", "serverRunning", ".", "getBaseUrl", "(", ")", "+", "\"", "/\"", ";", "HttpGet", "httpget", "=", "new", "HttpGet", "(", "location", ")", ";", "httpget", ".", "setConfig", "(", "RequestConfig", ".", "custom", "(", ").", "setRedirectsEnabled", "(", "false", ")", ".", "build", "(", ")", ")", ";", "CloseableHttpResponse", "response", "=", "httpclient", ".", "execute", "(", "httpget", ")", ";", "assertEquals", "(", "FOUND", ".", "value", "(", "),", "response", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "location", "=", "response", ".", "getFirstHeader", "(", "\"", "Location", "\"", ").", "getValue", "(", ");", "response", ".", "close", "(", ");", "httpget", ".", "completed", "(", ");", "/", "/", "request", "home", "page", "/", "String", "location", "=", "serverRunning", ".", "getBaseUrl", "(", ")", "+", "\"", "/\"", ";", "HttpGet", "httpget", "=", "new", "HttpGet", "(", "location", ")", ";", "CloseableHttpResponse", "response", "=", "httpclient", ".", "execute", "(", "httpget", ")", ";", "assertEquals", "(", "OK", ".", "value", "(", "),", "response", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "String", "body", "=", "EntityUtils", ".", "toString", "(", "response", ".", "getEntity", "(", "))", ";", "EntityUtils", ".", "consume", "(", "response", ".", "getEntity", "(", "))", ";", "response", ".", "close", "(", ");", "httpget", ".", "completed", "(", ");", "assertTrue", "(", "body", ".", "contains", "(", "\"/", "login", ".", "do", "\"", "))", ";", "assertTrue", "(", "body", ".", "contains", "(", "\"", "username", "\"", "))", ";", "assertTrue", "(", "body", ".", "contains", "(", "\"", "password", "\"", "))", ";", "String", "csrf", "=", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "body", ")", ";", "HttpUriRequest", "loginPost", "=", "RequestBuilder", ".", "post", "(", ")", ".", "setUri", "(", "serverRunning", ".", "getBaseUrl", "(", ")", "+", "\"", "/", "login", ".", "do", "\"", ")", ".", "addParameter", "(", "\"", "username", "\"", ",", "testAccounts", ".", "getUserName", "(", "))", ".", "addParameter", "(", "\"", "password", "\"", ",", "testAccounts", ".", "getPassword", "(", "))", ".", "addParameter", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "csrf", ")", ".", "build", "(", ");", "response", "=", "httpclient", ".", "execute", "(", "loginPost", ")", ";", "assertEquals", "(", "FOUND", ".", "value", "(", "),", "response", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "location", "=", "response", ".", "getFirstHeader", "(", "\"", "Location", "\"", ").", "getValue", "(", ");", "response", ".", "close", "(", ");", "httpget", "=", "new", "HttpGet", "(", "location", ")", ";", "response", "=", "httpclient", ".", "execute", "(", "httpget", ")", ";", "assertEquals", "(", "OK", ".", "value", "(", "),", "response", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "body", "=", "EntityUtils", ".", "toString", "(", "response", ".", "getEntity", "(", "))", ";", "response", ".", "close", "(", ");", "assertTrue", "(", "body", ".", "contains", "(", "\"", "Sign", "Out", "\"", "))", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "c", ":", "response", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "c", ")", ";", "}", "}", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ");", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "cookie", ":", "response", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "}", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ");", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "c", ":", "response", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "c", ")", ";", "}", "}", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ");", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "for", "(", "String", "c", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "c", ")", ";", "}", "assertEquals", "(", "HttpStatus", ".", "FOUND", ",", "result", ".", "getStatusCode", "(", "))", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "String", "cookie", "=", "response", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ");", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "headers", ".", "set", "(", "headers", ".", "ACCEPT", ",", "MediaType", ".", "TEXT_HTML_VALUE", ")", ";", "ResponseEntity", "<", "String", ">", "loginResponse", "=", "template", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", "\"", ",", "HttpMethod", ".", "GET", ",", "new", "HttpEntity", "<", ">(", "null", ",", "headers", ")", ",", "String", ".", "class", ")", ";", "if", "(", "loginResponse", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "cookie", ":", "loginResponse", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "}", "String", "csrf", "=", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "loginResponse", ".", "getBody", "(", "))", ";", "requestBody", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "csrf", ")", ";", "loginResponse", "=", "restOperations", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", ".", "do", "\"", ",", "String", ".", "class", ")", ";", "assertEquals", "(", "2", ",", "cookies", ".", "size", "(", "))", ";", "for", "(", "String", "cookie", ":", "loginResponse", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "integration", ".", "util", ".", "IntegrationTestUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpHeaders", ";", "import", "org", ".", "springframework", ".", "http", ".", "MediaType", ";", "import", "org", ".", "springframework", ".", "http", ".", "client", ".", "ClientHttpResponse", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "ResponseErrorHandler", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "@", "Test", "public", "void", "testAccessDeniedIfCsrfIsMissing", "(", ")", "throws", "Exception", "{", "RestTemplate", "template", "=", "new", "RestTemplate", "(", ");", "template", ".", "setErrorHandler", "(", "new", "ResponseErrorHandler", "(", ")", "{", "@", "Override", "public", "boolean", "hasError", "(", "ClientHttpResponse", "response", ")", "throws", "IOException", "{", "return", "response", ".", "getRawStatusCode", "(", ")", ">", "=", "500", ";", "}", "@", "Override", "public", "void", "handleError", "(", "ClientHttpResponse", "response", ")", "throws", "IOException", "{", "}", "}", ");", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "body", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "body", ".", "add", "(", "\"", "username", "\"", ",", "testAccounts", ".", "getUserName", "(", "))", ";", "body", ".", "add", "(", "\"", "password", "\"", ",", "testAccounts", ".", "getPassword", "(", "))", ";", "HttpHeaders", "headers", "=", "new", "HttpHeaders", "(", ");", "headers", ".", "add", "(", "headers", ".", "ACCEPT", ",", "MediaType", ".", "TEXT_HTML_VALUE", ")", ";", "ResponseEntity", "<", "String", ">", "loginResponse", "=", "template", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", ".", "do", "\"", ",", "HttpMethod", ".", "POST", ",", "new", "HttpEntity", "<", ">(", "body", ",", "headers", ")", ",", "String", ".", "class", ")", ";", "assertEquals", "(", "HttpStatus", ".", "FORBIDDEN", ",", "loginResponse", ".", "getStatusCode", "(", "))", ";", "assertTrue", "(", "\"", "CSRF", "message", "should", "be", "shown", "\"", ",", "loginResponse", ".", "getBody", "(", ").", "contains", "(", "\"", "Invalid", "login", "attempt", ",", "request", "does", "not", "meet", "our", "security", "standards", ",", "please", "try", "again", ".", "\")", ");", "}", "HttpHeaders", "headers", "=", "new", "HttpHeaders", "(", ");", "headers", ".", "set", "(", "headers", ".", "ACCEPT", ",", "MediaType", ".", "TEXT_HTML_VALUE", ")", ";", "ResponseEntity", "<", "String", ">", "loginResponse", "=", "template", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", "\"", ",", "HttpMethod", ".", "GET", ",", "new", "HttpEntity", "<", ">(", "null", ",", "headers", ")", ",", "String", ".", "class", ")", ";", "if", "(", "loginResponse", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "cookie", ":", "loginResponse", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "}", "String", "csrf", "=", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "loginResponse", ".", "getBody", "(", "))", ";", "body", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "csrf", ")", ";", "loginResponse", "=", "template", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", ".", "do", "\"", ",", "new", "HttpEntity", "<", ">(", "body", ",", "headers", ")", ",", "String", ".", "class", ")", ";", "assertTrue", "(", "webDriver", ".", "findElement", "(", "By", ".", "cssSelector", "(", "\".", "footer", ".", "copyright", "\"", "))", ".", "getAttribute", "(", "\"", "title", "\"", ").", "matches", "(", "regex", ")", ");", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "String", "uri", "=", "loginUrl", "\"", "/", "oauth", "/", "authorize", "?", "response_type", "=", "{", "response_type", "}", "&\"", "\"", "state", "=", "{", "state", "}", "&", "client_id", "=", "{", "client_id", "}", "&", "redirect_uri", "=", "{", "redirect_uri", "}", "\";", "String", "csrf", "=", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ";", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "cookie", ":", "response", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "}", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "csrf", ")", ";", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "resource", ".", "setAccessTokenUri", "(", "url", "+", "\"", "/", "oauth", "/", "token", "\"", ");", "headers", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "bearer", "\"", "+", "zoneAdminToken", ")", ";", "headers", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "bearer", "\"", "+", "zoneAdminToken", ")", ";", "ResponseEntity", "<", "ScimGroup", ">", "group", "=", "client", ".", "getForEntity", "(", "url", "+", "\"", "/", "Groups", "/", "{", "id", "}", "\",", "ScimGroup", ".", "class", ",", "id", ")", ";", "identityZone", ".", "setName", "(", "\"", "The", "Twiglet", "Zone", "[", "\"", "+", "id", "+", "\"", "]\"", ");", "identityZone", ".", "setDescription", "(", "\"", "Like", "the", "Twilight", "Zone", "but", "tastier", "[", "\"", "+", "id", "+", "\"", "].", "\")", ";", "return", "getAuthorizationCodeTokenMap", "(", "serverRunning", ",", "testAccounts", ",", "clientId", ",", "clientSecret", ",", "username", ",", "password", ")", ".", "get", "(", "\"", "access_token", "\"", ");", "}", "public", "static", "Map", "<", "String", ",", "String", ">", "getAuthorizationCodeTokenMap", "(", "ServerRunning", "serverRunning", ",", "UaaTestAccounts", "testAccounts", ",", "String", "clientId", ",", "String", "clientSecret", ",", "String", "username", ",", "String", "password", ")", "throws", "Exception", "{", "/", "/", "TODO", "Fix", "to", "use", "json", "API", "rather", "than", "HTML", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "if", "(", "response", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "for", "(", "String", "cookie", ":", "response", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "}", "String", "csrf", "=", "IntegrationTestUtils", ".", "extractCookieCsrf", "(", "response", ".", "getBody", "(", "))", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "formData", ".", "add", "(", "CookieBasedCsrfTokenRepository", ".", "DEFAULT_CSRF_COOKIE_NAME", ",", "csrf", ")", ";", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "for", "(", "String", "cookie", ":", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "OAuth2AccessToken", "accessToken", "=", "DefaultOAuth2AccessToken", ".", "valueOf", "(", "tokenResponse", ".", "getBody", "(", "))", ";", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "headers", ".", "set", "(", "\"", "Authorization", "\"", ",", "testAccounts", ".", "getAuthorizationHeader", "(", "resource", ".", "getClientId", "(", "),", "resource", ".", "getClientSecret", "(", "))", ");", "formData", ".", "add", "(", "\"", "token", "\"", ",", "accessToken", ".", "getValue", "(", "))", ";", "tokenResponse", "=", "serverRunning", ".", "postForMap", "(", "\"/", "check_token", "\"", ",", "formData", ",", "headers", ")", ";", "assertEquals", "(", "HttpStatus", ".", "OK", ",", "tokenResponse", ".", "getStatusCode", "(", "))", ";", "/", "/", "System", ".", "err", ".", "println", "(", "tokenResponse", ".", "getBody", "(", "))", ";", "assertNotNull", "(", "tokenResponse", ".", "getBody", "(", ").", "get", "(", "\"", "iss", "\"", "))", ";", "return", "body", ";", "public", "static", "String", "extractCookieCsrf", "(", "String", "body", ")", "{", "String", "pattern", "=", "\"", "\\\\", "<", "input", "type", "=", "\\\\", "\\\"", "hidden", "\\", "\\\\", "\"", "name", "=", "\\\\", "\\\"", "X", "-", "Uaa", "-", "Csrf", "\\", "\\\\", "\"", "value", "=", "\\\\", "\\\"", "(.", "*?", ")\\", "\\\\", "\"\"", ";", "Pattern", "linkPattern", "=", "Pattern", ".", "compile", "(", "pattern", ")", ";", "Matcher", "matcher", "=", "linkPattern", ".", "matcher", "(", "body", ")", ";", "if", "(", "matcher", ".", "find", "(", "))", "{", "return", "matcher", ".", "group", "(", "1", ")", ";", "}", "return", "null", ";", "}", "public", "static", "void", "clearAllButJsessionID", "(", "HttpHeaders", "headers", ")", "{", "String", "jsessionid", "=", "null", ";", "List", "<", "String", ">", "cookies", "=", "headers", ".", "get", "(", "\"", "Cookie", "\"", ");", "if", "(", "cookies", "!", "=", "null", ")", "{", "for", "(", "String", "cookie", ":", "cookies", ")", "{", "if", "(", "cookie", ".", "contains", "(", "\"", "JSESSIONID", "\"", "))", "{", "jsessionid", "=", "cookie", ";", "}", "}", "}", "if", "(", "jsessionid", "!", "=", "null", ")", "{", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "jsessionid", ")", ";", "}", "else", "{", "headers", ".", "remove", "(", "\"", "Cookie", "\"", ");", "}", "}", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "CookieCsrfPostProcessor", ".", "cookieCsrf", ";", "logoutSuccessHandler", ".", "setWhitelist", "(", "Collections", ".", "EMPTY_LIST", ")", ";", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "username", "\"", ",", "userToLockout", ".", "getUserName", "(", "))", ".", "param", "(", "\"", "password", "\"", ",", "userToLockout", ".", "getPassword", "(", "))", ")", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "account_locked", "\"", "))", ";", ".", "with", "(", "new", "SetServerNameRequestPostProcessor", "(", "subdomain", "+", "\"", ".", "localhost", "\"", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "username", "\"", ",", "userToLockout", ".", "getUserName", "(", "))", ".", "param", "(", "\"", "password", "\"", ",", "userToLockout", ".", "getPassword", "(", "))", ")", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "account_locked", "\"", "))", ";", ".", "with", "(", "new", "SetServerNameRequestPostProcessor", "(", "requestDomain", ")", ")", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "username", "\"", ",", "username", ")", ".", "param", "(", "\"", "password", "\"", ",", "\"", "wrong_password", "\"", ");", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "login_failure", "\"", "))", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "CookieCsrfPostProcessor", ".", "cookieCsrf", ";", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "CookieCsrfPostProcessor", ".", "cookieCsrf", ";", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "new", "SetServerNameRequestPostProcessor", "(", "zone", ".", "getSubdomain", "(", ")", "+", "\"", ".", "localhost", "\"", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "username", "\"", ",", "\"", "marissa", "\"", ")", ".", "param", "(", "\"", "password", "\"", ",", "\"", "koaladsada", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "login_failure", "\"", "))", ";", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "username", "\"", ",", "\"", "marissa2", "\"", ")", ".", "param", "(", "\"", "password", "\"", ",", "\"", "ldap", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "\")", ");", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mock", ".", "util", ".", "MockMvcUtils", ".", "CookieCsrfPostProcessor", ".", "cookieCsrf", ";", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", ".", "with", "(", "cookieCsrf", "(", "))", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "CookieBasedCsrfTokenRepository", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletResponse", ";", "import", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "SecurityMockMvcRequestPostProcessors", ";", "import", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "support", ".", "WebTestUtils", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "CsrfToken", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "csrf", ".", "CsrfTokenRepository", ";", "import", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "RequestPostProcessor", ";", "import", "javax", ".", "servlet", ".", "http", ".", "Cookie", ";", "public", "static", "class", "CookieCsrfPostProcessor", "implements", "RequestPostProcessor", "{", "private", "boolean", "useInvalidToken", "=", "false", ";", "public", "CookieCsrfPostProcessor", "useInvalidToken", "(", ")", "{", "useInvalidToken", "=", "true", ";", "return", "this", ";", "}", "public", "MockHttpServletRequest", "postProcessRequest", "(", "MockHttpServletRequest", "request", ")", "{", "CsrfTokenRepository", "repository", "=", "new", "CookieBasedCsrfTokenRepository", "(", ");", "CsrfToken", "token", "=", "repository", ".", "generateToken", "(", "request", ")", ";", "repository", ".", "saveToken", "(", "token", ",", "request", ",", "new", "MockHttpServletResponse", "(", "))", ";", "String", "tokenValue", "=", "useInvalidToken", "?", "\"", "invalid", "\"", "+", "token", ".", "getToken", "(", ")", ":", "token", ".", "getToken", "(", ");", "Cookie", "cookie", "=", "new", "Cookie", "(", "token", ".", "getParameterName", "(", "),", "tokenValue", ")", ";", "cookie", ".", "setHttpOnly", "(", "true", ")", ";", "Cookie", "[", "]", "cookies", "=", "request", ".", "getCookies", "(", ");", "if", "(", "cookies", "=", "=", "null", ")", "{", "request", ".", "setCookies", "(", "cookie", ")", ";", "}", "else", "{", "Cookie", "[", "]", "newcookies", "=", "new", "Cookie", "[", "cookies", ".", "length", "+", "1", "]", ";", "System", ".", "arraycopy", "(", "cookies", ",", "0", ",", "newcookies", ",", "0", ",", "cookies", ".", "length", ")", ";", "newcookies", "[", "cookies", ".", "length", "]", "=", "cookie", ";", "request", ".", "setCookies", "(", "newcookies", ")", ";", "}", "request", ".", "setParameter", "(", "token", ".", "getParameterName", "(", "),", "tokenValue", ")", ";", "return", "request", ";", "}", "public", "static", "CookieCsrfPostProcessor", "cookieCsrf", "(", ")", "{", "return", "new", "CookieCsrfPostProcessor", "(", ");", "}", "}</s>/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Cloud", "Foundry", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2014", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "web", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "RequestMatcher", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "/", "**", "*", "@", "author", "Luke", "Taylor", "*", "/", "public", "class", "DelegatingRequestMatcher", "implements", "RequestMatcher", "{", "private", "final", "List", "<", "RequestMatcher", ">", "matchers", ";", "public", "DelegatingRequestMatcher", "(", "List", "<", "RequestMatcher", ">", "matchers", ")", "{", "this", ".", "matchers", "=", "new", "ArrayList", "<", ">(", "matchers", ")", ";", "}", "@", "Override", "public", "boolean", "matches", "(", "HttpServletRequest", "request", ")", "{", "for", "(", "RequestMatcher", "m", ":", "matchers", ")", "{", "if", "(", "m", ".", "matches", "(", "request", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "105", "@", "@", "String", "cookie", "=", "exchange", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "<", "access", "-", "denied", "-", "handler", "error", "-", "page", "=", "\"/", "\"/", ">", "<", "form", "-", "login", "login", "-", "page", "=", "\"/", "login", "\"", "username", "-", "parameter", "=", "\"", "username", "\"", "password", "-", "parameter", "=", "\"", "password", "\"", "login", "-", "processing", "-", "url", "=", "\"/", "login", ".", "do", "\"", "authentication", "-", "failure", "-", "handler", "-", "ref", "=", "\"", "loginAuthenticationFailureHandler", "\"", "authentication", "-", "details", "-", "source", "-", "ref", "=", "\"", "authenticationDetailsSource", "\"", "/>", "<", "logout", "logout", "-", "url", "=", "\"/", "logout", ".", "do", "\"", "success", "-", "handler", "-", "ref", "=", "\"", "logoutHandler", "\"", "/", ">", "<", "csrf", "disabled", "=", "\"", "true", "\"", "/>", "ResponseEntity", "<", "Void", ">", "result", ";", "String", "cookie", ";", "result", "=", "serverRunning", ".", "getForResponse", "(", "\"/", "id", "\"", ",", "appHeaders", ")", ";", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "appHeaders", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "result", "=", "serverRunning", ".", "getForResponse", "(", "location", ",", "uaaHeaders", ")", ";", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "uaaHeaders", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "formData", "=", "new", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "()", ";", "result", "=", "serverRunning", ".", "postForResponse", "(", "location", ",", "uaaHeaders", ",", "formData", ")", ";", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "assertNotNull", "(", "\"", "Expected", "cookie", "in", "\"", "+", "result", ".", "getHeaders", "(", "),", "cookie", ")", ";", "uaaHeaders", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "result", "=", "serverRunning", ".", "getForResponse", "(", "location", ",", "uaaHeaders", ")", ";", "result", "=", "serverRunning", ".", "postForResponse", "(", "location", ",", "uaaHeaders", ",", "formData", ")", ";", "result", "=", "serverRunning", ".", "getForResponse", "(", "location", ",", "appHeaders", ")", ";", "<", "bean", "id", "=", "\"", "uiRequestMatcher", "\"", "class", "=", "\"", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "web", ".", "DelegatingRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", ">", "<", "list", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "spring_security_login", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "oauth", "/", "**", "\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "login", "*", "*\"", "/", ">", "<", "/", "bean", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "AntPathRequestMatcher", "\"", ">", "<", "constructor", "-", "arg", "value", "=", "\"/", "logout", ".", "do", "*", "\"", "/", ">", "<", "/", "bean", ">", "<", "/", "list", ">", "<", "/", "constructor", "-", "arg", ">", "<", "/", "bean", ">", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "()", ";", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpHeaders", ";", "import", "org", ".", "springframework", ".", "http", ".", "ResponseEntity", ";", "import", "org", ".", "springframework", ".", "util", ".", "LinkedMultiValueMap", ";", "import", "org", ".", "springframework", ".", "util", ".", "MultiValueMap", ";", "/", "**", "*", "@", "author", "Dave", "Syer", "*", "/", "@", "Test", "public", "void", "testUnauthenticatedRedirect", "(", ")", "throws", "Exception", "{", "HttpHeaders", "headers", "=", "new", "HttpHeaders", "(", ");", "headers", ".", "setAccept", "(", "Arrays", ".", "asList", "(", "MediaType", ".", "TEXT_HTML", ",", "MediaType", ".", "ALL", ")", ");", "String", "location", "=", "\"", "/\"", ";", "ResponseEntity", "<", "Void", ">", "result", "=", "serverRunning", ".", "getForResponse", "(", "location", ",", "headers", ")", ";", "/", "/", "should", "be", "directed", "to", "the", "login", "screen", ".", "..", "assertEquals", "(", "HttpStatus", ".", "FOUND", ",", "result", ".", "getStatusCode", "(", "))", ";", "location", "=", "result", ".", "getHeaders", "(", ").", "getLocation", "(", ").", "toString", "(", ");", "HttpHeaders", "headers", "=", "new", "HttpHeaders", "(", ");", "headers", ".", "setAccept", "(", "Arrays", ".", "asList", "(", "MediaType", ".", "TEXT_HTML", ",", "MediaType", ".", "ALL", ")", ");", "String", "location", "=", "\"", "/\"", ";", "ResponseEntity", "<", "Void", ">", "result", "=", "serverRunning", ".", "getForResponse", "(", "location", ",", "headers", ")", ";", "/", "/", "should", "be", "directed", "to", "the", "login", "screen", ".", "..", "assertEquals", "(", "HttpStatus", ".", "FOUND", ",", "result", ".", "getStatusCode", "(", "))", ";", "location", "=", "result", ".", "getHeaders", "(", ").", "getLocation", "(", ").", "toString", "(", ");", "ResponseEntity", "<", "String", ">", "response", "=", "serverRunning", ".", "getForString", "(", "location", ",", "headers", ")", ";", "assertTrue", "(", "response", ".", "getBody", "(", ").", "contains", "(", "\"/", "login", ".", "do", "\"", "))", ";", "assertTrue", "(", "response", ".", "getBody", "(", ").", "contains", "(", "\"", "username", "\"", "))", ";", "assertTrue", "(", "response", ".", "getBody", "(", ").", "contains", "(", "\"", "password", "\"", "))", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", ">(", ");", "formData", ".", "add", "(", "\"", "username", "\"", ",", "testAccounts", ".", "getUserName", "(", "))", ";", "formData", ".", "add", "(", "\"", "password", "\"", ",", "testAccounts", ".", "getPassword", "(", "))", ";", "/", "/", "Should", "be", "redirected", "to", "the", "original", "URL", ",", "but", "now", "authenticated", "result", "=", "serverRunning", ".", "postForResponse", "(", "\"/", "login", ".", "do", "\"", ",", "headers", ",", "formData", ")", ";", "assertEquals", "(", "HttpStatus", ".", "FOUND", ",", "result", ".", "getStatusCode", "(", "))", ";", "if", "(", "result", ".", "getHeaders", "(", ").", "containsKey", "(", "\"", "Set", "-", "Cookie", "\"", "))", "{", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "}", "response", "=", "serverRunning", ".", "getForString", "(", "result", ".", "getHeaders", "(", ").", "getLocation", "(", ").", "toString", "(", "),", "headers", ")", ";", "assertEquals", "(", "HttpStatus", ".", "OK", ",", "response", ".", "getStatusCode", "(", "))", ";", "/", "/", "The", "home", "page", "should", "be", "returned", "assertTrue", "(", "response", ".", "getBody", "(", ").", "contains", "(", "\"", "Sign", "Out", "\"", "))", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "()", ";", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "assertEquals", "(", "HttpStatus", ".", "FOUND", ",", "result", ".", "getStatusCode", "(", "))", ";", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "()", ";", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "ResponseEntity", "<", "Void", ">", "loginResponse", "=", "restOperations", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", ".", "do", "\"", ",", "Void", ".", "class", ")", ";", "assertEquals", "(", "1", ",", "cookies", ".", "size", "(", "))", ";", "headers", ".", "add", "(", "\"", "Cookie", "\"", ",", "cookies", ".", "get", "(", "0", ")", ");", "ResponseEntity", "<", "Void", ">", "loginResponse", "=", "template", ".", "exchange", "(", "baseUrl", "+", "\"", "/", "login", ".", "do", "\"", ",", "new", "HttpEntity", "<", ">(", "body", ",", "null", ")", ",", "Void", ".", "class", ")", ";", "Assert", ".", "assertTrue", "(", "webDriver", ".", "findElement", "(", "By", ".", "cssSelector", "(", "\".", "footer", ".", "copyright", "\"", "))", ".", "getAttribute", "(", "\"", "title", "\"", ").", "matches", "(", "regex", ")", ");", "String", "uri", "=", "loginUrl", "+", "\"", "/", "oauth", "/", "authorize", "?", "response_type", "=", "{", "response_type", "}", "&\"", "+", "\"", "state", "=", "{", "state", "}", "&", "client_id", "=", "{", "client_id", "}", "&", "redirect_uri", "=", "{", "redirect_uri", "}", "\";", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "resource", ".", "setAccessTokenUri", "(", "url", "+", "\"/", "oauth", "/", "token", "\"", ");", "headers", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "bearer", "\"", "+", "zoneAdminToken", ")", ";", "headers", ".", "add", "(", "\"", "Authorization", "\"", ",", "\"", "bearer", "\"", "+", "zoneAdminToken", ")", ";", "ResponseEntity", "<", "ScimGroup", ">", "group", "=", "client", ".", "getForEntity", "(", "url", "+", "\"/", "Groups", "/", "{", "id", "}", "\",", "ScimGroup", ".", "class", ",", "id", ")", ";", "identityZone", ".", "setName", "(", "\"", "The", "Twiglet", "Zone", "[", "\"+", "id", "+", "\"]", "\")", ";", "identityZone", ".", "setDescription", "(", "\"", "Like", "the", "Twilight", "Zone", "but", "tastier", "[", "\"+", "id", "+", "\"]", ".\"", ");", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "MultiValueMap", "<", "String", ",", "String", ">", "formData", "=", "new", "LinkedMultiValueMap", "<", "String", ",", "String", ">", "()", ";", "String", "cookie", "=", "result", ".", "getHeaders", "(", ").", "getFirst", "(", "\"", "Set", "-", "Cookie", "\"", ");", "headers", ".", "set", "(", "\"", "Cookie", "\"", ",", "cookie", ")", ";", "return", "body", ".", "get", "(", "\"", "access_token", "\"", ");", "logoutSuccessHandler", ".", "setWhitelist", "(", "Collections", ".", "<", "String", ">", "emptyList", "(", "))", ";", ".", "param", "(", "\"", "username", "\"", ",", "userToLockout", ".", "getUserName", "(", "))", ".", "param", "(", "\"", "password", "\"", ",", "userToLockout", ".", "getPassword", "(", "))", ")", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "account_locked", "\"", "))", ";", ".", "with", "(", "new", "SetServerNameRequestPostProcessor", "(", "subdomain", "+", "\"", ".", "localhost", "\"", "))", ".", "param", "(", "\"", "username", "\"", ",", "userToLockout", ".", "getUserName", "(", "))", ".", "param", "(", "\"", "password", "\"", ",", "userToLockout", ".", "getPassword", "(", "))", ")", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "account_locked", "\"", "))", ";", ".", "with", "(", "new", "SetServerNameRequestPostProcessor", "(", "requestDomain", ")", ")", ".", "param", "(", "\"", "username", "\"", ",", "username", ")", ".", "param", "(", "\"", "password", "\"", ",", "\"", "wrong_password", "\"", ");", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "login_failure", "\"", "))", ";", ".", "with", "(", "new", "SetServerNameRequestPostProcessor", "(", "zone", ".", "getSubdomain", "(", ")+", "\".", "localhost", "\"", "))", ".", "param", "(", "\"", "username", "\"", ",", "\"", "marissa", "\"", ")", ".", "param", "(", "\"", "password", "\"", ",", "\"", "koaladsada", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "login", "?", "error", "=", "login_failure", "\"", "))", ";", ".", "param", "(", "\"", "username", "\"", ",", "\"", "marissa2", "\"", ")", ".", "param", "(", "\"", "password", "\"", ",", "\"", "ldap", "\"", "))", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "redirectedUrl", "(", "\"/", "\")", ");", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultHandlers", ".", "print", ";", ".", "andDo", "(", "print", "(", "))", ".", "andDo", "(", "print", "(", "))", "import", "org", ".", "junit", ".", "Assert", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultHandlers", ".", "print", ";", ".", "andDo", "(", "print", "(", "))"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["[SECURITY-1046]"], "code_tokens": ["import", "hudson", ".", "Util", ";", "&", "&", "Util", ".", "fixNull", "(", "request", ".", "getCollaboratorNames", "(", "))", ".", "contains", "(", "head", ".", "getOriginOwner", "(", "))", ";", "@", "NonNull", "@", "Override", "public", "SCMRevision", "getTrustedRevision", "(", "@", "NonNull", "SCMRevision", "revision", ",", "@", "NonNull", "TaskListener", "listener", ")", "throws", "IOException", ",", "InterruptedException", "{", "if", "(", "revision", "instanceof", "PullRequestSCMRevision", ")", "{", "PullRequestSCMHead", "head", "=", "(", "PullRequestSCMHead", ")", "revision", ".", "getHead", "(", ");", "try", "(", "GiteaConnection", "c", "=", "gitea", "(", ").", "open", "(", "))", "{", "try", "(", "GiteaSCMSourceRequest", "request", "=", "new", "GiteaSCMSourceContext", "(", "null", ",", "SCMHeadObserver", ".", "none", "(", "))", ".", "withTraits", "(", "getTraits", "(", "))", ".", "newRequest", "(", "this", ",", "listener", ")", ")", "{", "request", ".", "setConnection", "(", "c", ")", ";", "Set", "<", "String", ">", "names", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "GiteaUser", "u", ":", "c", ".", "fetchCollaborators", "(", "giteaRepository", ")", ")", "{", "names", ".", "add", "(", "u", ".", "getUsername", "(", "))", ";", "}", "request", ".", "setCollaboratorNames", "(", "names", ")", ";", "if", "(", "request", ".", "isTrusted", "(", "head", ")", ")", "{", "return", "revision", ";", "}", "}", "PullRequestSCMRevision", "rev", "=", "(", "PullRequestSCMRevision", ")", "revision", ";", "listener", ".", "getLogger", "(", ").", "format", "(", "\"", "Loading", "trusted", "files", "from", "base", "branch", "%", "s", "at", "%", "s", "rather", "than", "%", "s", "%", "n", "\"", ",", "head", ".", "getTarget", "(", ").", "getName", "(", "),", "(", "(", "SCMRevisionImpl", ")", "rev", ".", "getTarget", "(", "))", ".", "getHash", "(", "),", "rev", ".", "getOrigin", "(", ").", "getHash", "(", "))", ";", "return", "rev", ".", "getTarget", "(", ");", "}", "}", "return", "revision", ";", "}</s>&", "&", "request", ".", "getCollaboratorNames", "(", ").", "contains", "(", "head", ".", "getOriginOwner", "(", "))", ";"], "docstring_tokens": ["provides", "a", "custom", "Script", "Security", "whitelist"]}
{"contents": ["Merge", "pull", "request", "#10492", "from", "ncteisen/error-overflow", "Fix", "Error", "Overflow", "Bug"], "code_tokens": ["(", "*", "err", ")", "->", "arena_capacity", "=", "(", "uint8_t", ")", "GPR_MIN", "(", "UINT8_MAX", "-", "1", ",", "(", "3", "*", "(", "*", "err", ")", "->", "arena_capacity", "/", "2", ")", ");", "if", "(", "(*", "err", ")", "->", "arena_size", "+", "slots", ">", "(", "*", "err", ")", "->", "arena_capacity", ")", "{", "return", "UINT8_MAX", ";", "}", "if", "(", "slot", "=", "=", "UINT8_MAX", ")", "{", "gpr_log", "(", "GPR_ERROR", ",", "\"", "Error", "%", "p", "is", "full", ",", "dropping", "int", "{", "\\\"", "%", "s", "\\", "\":", "%\"", "PRIiPTR", "\"", "}\"", ",", "*", "err", ",", "error_int_name", "(", "which", ")", ",", "value", ")", ";", "return", ";", "}", "if", "(", "slot", "=", "=", "UINT8_MAX", ")", "{", "const", "char", "*", "str", "=", "grpc_slice_to_c_string", "(", "value", ")", ";", "gpr_log", "(", "GPR_ERROR", ",", "\"", "Error", "%", "p", "is", "full", ",", "dropping", "string", "{", "\\\"", "%", "s", "\\", "\":", "\\\"", "%", "s", "\\", "\"}", "\",", "*", "err", ",", "error_str_name", "(", "which", ")", ",", "str", ")", ";", "gpr_free", "(", "(", "void", "*", ")", "str", ")", ";", "return", ";", "}", "static", "char", "*", "fmt_time", "(", "gpr_timespec", "tm", ")", ";", "if", "(", "slot", "=", "=", "UINT8_MAX", ")", "{", "const", "char", "*", "time_str", "=", "fmt_time", "(", "value", ")", ";", "gpr_log", "(", "GPR_ERROR", ",", "\"", "Error", "%", "p", "is", "full", ",", "dropping", "\\", "\"%", "s", "\\", "\":", "\\\"", "%", "s", "\\", "\"}", "\",", "*", "err", ",", "error_time_name", "(", "which", ")", ",", "time_str", ")", ";", "gpr_free", "(", "(", "void", "*", ")", "time_str", ")", ";", "return", ";", "}", "if", "(", "slot", "=", "=", "UINT8_MAX", ")", "{", "gpr_log", "(", "GPR_ERROR", ",", "\"", "Error", "%", "p", "is", "full", ",", "dropping", "error", "%", "p", "=", "%", "s", "\"", ",", "*", "err", ",", "new", ",", "grpc_error_string", "(", "new", ")", ");", "GRPC_ERROR_UNREF", "(", "new", ")", ";", "return", ";", "}", "static", "void", "test_overflow", "(", ")", "{", "grpc_error", "*", "error", "=", "GRPC_ERROR_CREATE_FROM_STATIC_STRING", "(", "\"", "Overflow", "\"", ");", "for", "(", "size_t", "i", "=", "0", ";", "i", "<", "150", ";", "+", "+", "i", ")", "{", "error", "=", "grpc_error_add_child", "(", "error", ",", "GRPC_ERROR_CREATE_FROM_STATIC_STRING", "(", "\"", "Child", "\"", "))", ";", "}", "error", "=", "grpc_error_set_int", "(", "error", ",", "GRPC_ERROR_INT_HTTP2_ERROR", ",", "5", ")", ";", "error", "=", "grpc_error_set_str", "(", "error", ",", "GRPC_ERROR_STR_GRPC_MESSAGE", ",", "grpc_slice_from_static_string", "(", "\"", "message", "for", "child", "2", "\"", "))", ";", "error", "=", "grpc_error_set_int", "(", "error", ",", "GRPC_ERROR_INT_GRPC_STATUS", ",", "5", ")", ";", "intptr_t", "i", ";", "GPR_ASSERT", "(", "grpc_error_get_int", "(", "error", ",", "GRPC_ERROR_INT_HTTP2_ERROR", ",", "&", "i", ")", ");", "GPR_ASSERT", "(", "i", "=", "=", "5", ")", ";", "GPR_ASSERT", "(", "!", "grpc_error_get_int", "(", "error", ",", "GRPC_ERROR_INT_GRPC_STATUS", ",", "&", "i", ")", ");", "error", "=", "grpc_error_set_int", "(", "error", ",", "GRPC_ERROR_INT_HTTP2_ERROR", ",", "10", ")", ";", "GPR_ASSERT", "(", "grpc_error_get_int", "(", "error", ",", "GRPC_ERROR_INT_HTTP2_ERROR", ",", "&", "i", ")", ");", "GPR_ASSERT", "(", "i", "=", "=", "10", ")", ";", "GRPC_ERROR_UNREF", "(", "error", ")", ";", ";", "}", "test_overflow", "(", ");", "{", "\"", "args", "\"", ":", "[", "\"", "test", "/", "core", "/", "end2end", "/", "fuzzers", "/", "server_fuzzer_corpus", "/", "clusterfuzz", "-", "testcase", "-", "6312731374256128", "\"", "]", ",", "\"", "ci_platforms", "\"", ":", "[", "\"", "linux", "\"", "]", ",", "\"", "cpu_cost", "\"", ":", "0", ".", "1", ",", "\"", "exclude_configs", "\"", ":", "[", "\"", "tsan", "\"", "]", ",", "\"", "exclude_iomgrs", "\"", ":", "[", "\"", "uv", "\"", "]", ",", "\"", "flaky", "\"", ":", "false", ",", "\"", "language", "\"", ":", "\"", "c", "\"", ",", "\"", "name", "\"", ":", "\"", "server_fuzzer_one_entry", "\"", ",", "\"", "platforms", "\"", ":", "[", "\"", "mac", "\"", ",", "\"", "linux", "\"", "]", ",", "\"", "uses_polling", "\"", ":", "false", "}", ",</s>(", "*", "err", ")", "->", "arena_capacity", "=", "(", "uint8_t", ")", "(", "3", "*", "(", "*", "err", ")", "->", "arena_capacity", "/", "2", ")", ";", "/", "/", "GPR_ASSERT", "(", "(*", "err", ")", "->", "ints", "[", "which", "]", "=", "=", "UINT8_MAX", ")", ";", "/", "/", "TODO", ",", "enforce", "this", "/", "/", "GPR_ASSERT", "(", "(*", "err", ")", "->", "strs", "[", "which", "]", "=", "=", "UINT8_MAX", ")", ";", "/", "/", "TODO", ",", "enforce", "this", "/", "/", "GPR_ASSERT", "(", "(*", "err", ")", "->", "times", "[", "which", "]", "=", "=", "UINT8_MAX", ")", ";", "/", "/", "TODO", ",", "enforce", "this", "gpr_log", "(", "GPR_DEBUG", ",", "\"", "%", "s", "\"", ",", "grpc_error_string", "(", "parent", ")", ");"], "docstring_tokens": ["has", "an", "out-of-bounds", "write", "caused"]}
{"contents": ["VSOCK:", "vmci", "-", "fix", "possible", "info", "leak", "in", "vmci_transport_dgram_dequeue()", "In", "case", "we", "received", "no", "data", "on", "the", "call", "to", "skb_recv_datagram(),", "i.e.", "skb->data", "is", "NULL,", "vmci_transport_dgram_dequeue()", "will", "return", "with", "0", "without", "updating", "msg_namelen", "leading", "to", "net/socket.c", "leaking", "the", "local,", "uninitialized", "sockaddr_storage", "variable", "to", "userland", "--", "128", "bytes", "of", "kernel", "stack", "memory.", "Fix", "this", "by", "moving", "the", "already", "existing", "msg_namelen", "assignment", "a", "few", "lines", "above.", "Cc:", "Andy", "King", "<acking@vmware.com>", "Cc:", "Dmitry", "Torokhov", "<dtor@vmware.com>", "Cc:", "George", "Zhang", "<georgezhang@vmware.com>", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["msg", "-", ">", "msg_namelen", "=", "0", ";</s>msg", "-", ">", "msg_namelen", "=", "0", ";"], "docstring_tokens": ["does", "not", "properly", "initialize", "a", "certain", "length", "variable"]}
{"contents": ["Ensuring", "secure", "XSLT", "processing", "everywhere"], "code_tokens": ["}", "catch", "(", "final", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "configuration", "\"", ",", "ex", ")", ";", "configurationResultManager", ".", "genericError", "(", "ex", ".", "getMessage", "(", "))", ";", "private", "static", "final", "String", "EXPORT_EXECUTION_HELP_MESSAGE", "=", "\"", "report", "-", "-", "export", "-", "execution", "-", "result", "{", "EXECUTION", "-", "KEY", "}", "{", "EXECUTION", "-", "KEY", "}", "[", "..", ".]", "{", "FORMAT", "}", "\\", "n", "\"", "+", "\"", "Format", ":", "CSV", "/", "HTML", "/", "PDF", "/", "XML", "/", "RTF", "\"", ";", "String", "result", "=", "reportSyncopeOperations", ".", "exportExecutionResult", "(", "parameter", ",", "input", ".", "lastParameter", "(", "))", ";", "}", "catch", "(", "final", "WebServiceException", "|", "SyncopeClientException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "execution", "\"", ",", "e", ")", ";", "if", "(", "e", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "NotFound", "\"", "))", "{", "reportResultManager", ".", "genericError", "(", "e", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "final", "Exception", "e", ")", "{", "throws", "Exception", "{", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "org", ".", "w3c", ".", "dom", ".", "bootstrap", ".", "DOMImplementationRegistry", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "DOMImplementationLS", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSInput", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSParser", ";", "public", "static", "void", "createXMLFile", "(", "final", "InputStream", "sis", ",", "final", "String", "filePath", ")", "throws", "Exception", "{", "DOMImplementationRegistry", "reg", "=", "DOMImplementationRegistry", ".", "newInstance", "(", ");", "DOMImplementationLS", "domImpl", "=", "(", "DOMImplementationLS", ")", "reg", ".", "getDOMImplementation", "(", "\"", "LS", "\"", ");", "LSInput", "lsinput", "=", "domImpl", ".", "createLSInput", "(", ");", "lsinput", ".", "setByteStream", "(", "sis", ")", ";", "LSParser", "parser", "=", "domImpl", ".", "createLSParser", "(", "DOMImplementationLS", ".", "MODE_SYNCHRONOUS", ",", "null", ")", ";", "tf", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "tf", ".", "newTransformer", "(", ").", "transform", "(", "new", "DOMSource", "(", "parser", ".", "parse", "(", "lsinput", ")", "),", "new", "StreamResult", "(", "new", "File", "(", "filePath", ")", "))", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "this", ".", "parameters", ".", "forEach", "(", "(", "name", ",", "values", ")", "-", ">", "{", "SAXTransformerFactory", "transformerFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setURIResolver", "(", "(", "href", ",", "base", ")", "-", ">", "null", ")", ";", "try", "{", "transformerFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Could", "not", "enable", "secure", "XML", "processing", "\"", ",", "e", ")", ";", "}", "return", "transformerFactory", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "SAXTransformerFactory", "transformerFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "private", "static", "final", "SAXTransformerFactory", "TRANSFORMER_FACTORY", ";", "static", "{", "TRANSFORMER_FACTORY", "=", "(", "SAXTransformerFactory", ")", "TransformerFactory", ".", "newInstance", "(", ");", "TRANSFORMER_FACTORY", ".", "setURIResolver", "(", "(", "href", ",", "base", ")", "-", ">", "null", ")", ";", "try", "{", "TRANSFORMER_FACTORY", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Could", "not", "enable", "secure", "XML", "processing", "\"", ",", "e", ")", ";", "}", "}", "handler", "=", "TRANSFORMER_FACTORY", ".", "newTransformerHandler", "(", ");", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "org", ".", "apache", ".", "cxf", ".", "staxutils", ".", "StaxUtils", ";", "tf", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "tf", ".", "setURIResolver", "(", "(", "href", ",", "base", ")", "-", ">", "null", ")", ";", "Document", "doc", "=", "StaxUtils", ".", "read", "(", "resource", ".", "getInputStream", "(", "))", ";", "TRANSFORMER_FACTORY", ".", "setURIResolver", "(", "(", "href", ",", "base", ")", "-", ">", "null", ")", ";", "SignatureAlgorithm", ".", "valueOf", "(", "loader", ".", "getSignatureAlgorithm", "(", "))", ";", "loader", ".", "getSignatureAlgorithm", "(", "))", ";", "protected", "static", "String", "execReport", "(", "final", "String", "reportKey", ")", "{", "ReportTO", "reportTO", "=", "reportService", ".", "read", "(", "reportKey", ")", ";", "assertNotNull", "(", "reportTO", ")", ";", "assertNotNull", "(", "reportTO", ".", "getExecutions", "(", "))", ";", "int", "preExecSize", "=", "reportTO", ".", "getExecutions", "(", ").", "size", "(", ");", "ExecTO", "exec", "=", "reportService", ".", "execute", "(", "new", "ExecuteQuery", ".", "Builder", "(", ").", "key", "(", "reportKey", ")", ".", "build", "(", "))", ";", "assertNotNull", "(", "exec", ")", ";", "int", "i", "=", "0", ";", "int", "maxit", "=", "50", ";", "/", "/", "wait", "for", "completion", "(", "executions", "incremented", ")", "do", "{", "try", "{", "Thread", ".", "sleep", "(", "1000", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "reportTO", "=", "reportService", ".", "read", "(", "reportKey", ")", ";", "assertNotNull", "(", "reportTO", ")", ";", "assertNotNull", "(", "reportTO", ".", "getExecutions", "(", "))", ";", "i", "+", "+;", "}", "while", "(", "preExecSize", "=", "=", "reportTO", ".", "getExecutions", "(", ").", "size", "(", ")", "&", "&", "i", "<", "maxit", ")", ";", "if", "(", "i", "=", "=", "maxit", ")", "{", "fail", "(", "\"", "Timeout", "when", "executing", "report", "\"", "+", "reportKey", ")", ";", "}", "exec", "=", "reportTO", ".", "getExecutions", "(", ").", "get", "(", "reportTO", ".", "getExecutions", "(", ").", "size", "(", ")", "-", "1", ")", ";", "assertEquals", "(", "ReportExecStatus", ".", "SUCCESS", ".", "name", "(", "),", "exec", ".", "getStatus", "(", "))", ";", "return", "exec", ".", "getKey", "(", ");", "}", "execReport", "(", "reportTO", ".", "getKey", "(", "))", ";", "String", "execKey", "=", "execReport", "(", "reportTO", ".", "getKey", "(", "))", ";", "String", "execKey", "=", "execReport", "(", "reportTO", ".", "getKey", "(", "))", ";", "String", "execKey", "=", "execReport", "(", "report", ".", "getKey", "(", "))", ";", "import", "org", ".", "apache", ".", "syncope", ".", "common", ".", "lib", ".", "types", ".", "ReportExecExportFormat", ";", "@", "Test", "public", "void", "safeTemplate", "(", ")", "throws", "IOException", "{", "Response", "response", "=", "reportTemplateService", ".", "getFormat", "(", "\"", "sample", "\"", ",", "ReportTemplateFormat", ".", "HTML", ")", ";", "String", "before", "=", "IOUtils", ".", "toString", "(", "(", "InputStream", ")", "response", ".", "getEntity", "(", "),", "StandardCharsets", ".", "UTF_8", ")", ";", "assertNotNull", "(", "before", ")", ";", "String", "execKey", "=", "ReportITCase", ".", "execReport", "(", "\"", "0062ea9c", "-", "924d", "-", "4ecf", "-", "9961", "-", "4492a8cc6d1b", "\"", ");", "assertNotNull", "(", "execKey", ")", ";", "response", "=", "reportService", ".", "exportExecutionResult", "(", "execKey", ",", "ReportExecExportFormat", ".", "HTML", ")", ";", "String", "result", "=", "IOUtils", ".", "toString", "(", "(", "InputStream", ")", "response", ".", "getEntity", "(", "),", "StandardCharsets", ".", "UTF_8", ")", ";", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", ".", "startsWith", "(", "\"<", "?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"?", ">\"", "+", "\"", "<!", "DOCTYPE", "html", "PUBLIC", "\\", "\"-", "//", "W3C", "/", "/", "DTD", "XHTML", "1", ".", "0", "Strict", "/", "/", "EN", "\\", "\"", "\"", "+", "\"", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xhtml1", "/", "DTD", "/", "xhtml1", "-", "strict", ".", "dtd", "\\", "\">", "\")", ");", "String", "malicious", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "utf", "-", "8", "\\", "\"?", ">\\", "n", "\"", "+", "\"", "<!", "DOCTYPE", "xsl", ":", "stylesheet", "\"", "+", "\"", "[<", "!", "ENTITY", "file", "SYSTEM", "\\", "\"", "webapps", "/", "syncope", "/", "WEB", "-", "INF", "/", "classes", "/", "security", ".", "properties", "\\", "\">", "]>", "\\", "n", "\"", "+", "\"", "<", "xsl", ":", "stylesheet", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "xmlns", ":", "xsl", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\\", "\">", "\\", "n", "\"", "+", "\"", "<", "xsl", ":", "template", "match", "=", "\\\"", "/\\", "\">", "&", "file", ";", "</", "xsl", ":", "template", ">", "\\", "n", "\"", "+", "\"", "</", "xsl", ":", "stylesheet", ">", "\";", "try", "{", "reportTemplateService", ".", "setFormat", "(", "\"", "sample", "\"", ",", "ReportTemplateFormat", ".", "HTML", ",", "IOUtils", ".", "toInputStream", "(", "malicious", ",", "StandardCharsets", ".", "UTF_8", ")", ");", "response", "=", "reportService", ".", "exportExecutionResult", "(", "execKey", ",", "ReportExecExportFormat", ".", "HTML", ")", ";", "result", "=", "IOUtils", ".", "toString", "(", "(", "InputStream", ")", "response", ".", "getEntity", "(", "),", "StandardCharsets", ".", "UTF_8", ")", ";", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", ".", "isEmpty", "(", "))", ";", "}", "finally", "{", "reportTemplateService", ".", "setFormat", "(", "\"", "sample", "\"", ",", "ReportTemplateFormat", ".", "HTML", ",", "IOUtils", ".", "toInputStream", "(", "before", ",", "StandardCharsets", ".", "UTF_8", ")", ");", "}", "}", "if", "(", "isProxyEnabled", "&", "&", "mavenProxyAutoconf", ")", "{", "try", "{", "customMavenProxySettings", "=", "MavenUtils", ".", "createSettingsWithProxy", "(", "installPath", ",", "proxyHost", ",", "proxyPort", ",", "proxyUser", ",", "proxyPwd", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "Error", "during", "creation", "of", "custom", "Maven", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "if", "(", "isProxyEnabled", "&", "&", "mavenProxyAutoconf", ")", "{", "try", "{", "}", "catch", "(", "Exception", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "Error", "during", "creation", "of", "custom", "Maven", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "factory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "org", ".", "w3c", ".", "dom", ".", "bootstrap", ".", "DOMImplementationRegistry", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "DOMImplementationLS", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSInput", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSParser", ";", "anonymousKey", ",", "jwsKey", ",", "adminPassword", ")", ";", "final", "String", "proxyUser", ",", "final", "String", "proxyPassword", ")", "throws", "Exception", "{", "DOMImplementationRegistry", "reg", "=", "DOMImplementationRegistry", ".", "newInstance", "(", ");", "DOMImplementationLS", "domImpl", "=", "(", "DOMImplementationLS", ")", "reg", ".", "getDOMImplementation", "(", "\"", "LS", "\"", ");", "LSInput", "lsinput", "=", "domImpl", ".", "createLSInput", "(", ");", "lsinput", ".", "setByteStream", "(", "new", "FileInputStream", "(", "settingsXML", ")", ");", "LSParser", "parser", "=", "domImpl", ".", "createLSParser", "(", "DOMImplementationLS", ".", "MODE_SYNCHRONOUS", ",", "null", ")", ";", "final", "Document", "settings", "=", "parser", ".", "parse", "(", "lsinput", ")", ";</s>import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "}", "catch", "(", "final", "IOException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "configuration", "\"", ",", "ex", ")", ";", "configurationResultManager", ".", "genericError", "(", "ex", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "ParserConfigurationException", "|", "SAXException", "|", "TransformerConfigurationException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "configuration", "\"", ",", "ex", ")", ";", "configurationResultManager", ".", "genericError", "(", "\"", "Error", "creating", "\"", "+", "input", ".", "firstParameter", "(", ")", "+", "EXPORT_FILE_NAME", "+", "\"", "\"", "+", "ex", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "final", "TransformerException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "configuration", "\"", ",", "ex", ")", ";", "if", "(", "ex", ".", "getCause", "(", ")", "instanceof", "FileNotFoundException", ")", "{", "configurationResultManager", ".", "genericError", "(", "\"", "Permission", "denied", "on", "\"", "+", "input", ".", "firstParameter", "(", "))", ";", "}", "else", "{", "configurationResultManager", ".", "genericError", "(", "\"", "Error", "creating", "\"", "+", "input", ".", "firstParameter", "(", ")", "+", "EXPORT_FILE_NAME", "+", "\"", "\"", "+", "ex", ".", "getMessage", "(", "))", ";", "}", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "apache", ".", "syncope", ".", "client", ".", "cli", ".", "util", ".", "CommandUtils", ";", "import", "org", ".", "apache", ".", "syncope", ".", "common", ".", "lib", ".", "types", ".", "ReportExecExportFormat", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "private", "static", "final", "String", "EXPORT_EXECUTION_HELP_MESSAGE", "=", "\"", "report", "-", "-", "export", "-", "execution", "-", "result", "{", "EXECUTION", "-", "KEY", "}", "{", "EXECUTION", "-", "KEY", "}", "[", "..", ".]", "{", "FORMAT", "}", "\\", "n", "\"", "final", "String", "result", "=", "reportSyncopeOperations", ".", "exportExecutionResult", "(", "parameter", ",", "input", ".", "lastParameter", "(", "))", ";", "}", "catch", "(", "final", "WebServiceException", "|", "SyncopeClientException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "execution", "\"", ",", "ex", ")", ";", "if", "(", "ex", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "NotFound", "\"", "))", "{", "reportResultManager", ".", "genericError", "(", "ex", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "final", "NumberFormatException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "execution", "\"", ",", "ex", ")", ";", "reportResultManager", ".", "numberFormatException", "(", "\"", "report", "\"", ",", "parameter", ")", ";", "}", "catch", "(", "IOException", "|", "ParserConfigurationException", "|", "SAXException", "|", "TransformerException", "e", ")", "{", "}", "catch", "(", "final", "IllegalArgumentException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "Error", "exporting", "execution", "\"", ",", "ex", ")", ";", "reportResultManager", ".", "typeNotValidError", "(", "\"", "format", "\"", ",", "input", ".", "firstParameter", "(", "),", "CommandUtils", ".", "fromEnumToArray", "(", "ReportExecExportFormat", ".", "class", ")", ");", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "throws", "TransformerException", ",", "SAXException", ",", "IOException", ",", "ParserConfigurationException", "{", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "apache", ".", "cxf", ".", "helpers", ".", "IOUtils", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "public", "static", "void", "createXMLFile", "(", "final", "InputStream", "sis", ",", "final", "String", "filePath", ")", "throws", "TransformerException", ",", "SAXException", ",", "IOException", ",", "ParserConfigurationException", "{", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "tf", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "tf", ".", "newTransformer", "(", ").", "transform", "(", "new", "DOMSource", "(", "dbf", ".", "newDocumentBuilder", "(", ").", "parse", "(", "new", "InputSource", "(", "new", "StringReader", "(", "IOUtils", ".", "toString", "(", "sis", ")", "))", "))", ",", "new", "StreamResult", "(", "new", "File", "(", "filePath", ")", "))", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "this", ".", "parameters", ".", "forEach", "(", "(", "name", ",", "values", ")", "->", "{", "return", "(", "SAXTransformerFactory", ")", "TransformerFactory", ".", "newInstance", "(", ");", "final", "SAXTransformerFactory", "transformerFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "SAXTransformerFactory", "tFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "tFactory", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "handler", "=", "tFactory", ".", "newTransformerHandler", "(", ");", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "tf", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "DocumentBuilderFactory", "dbFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbFactory", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "DocumentBuilder", "dBuilder", "=", "dbFactory", ".", "newDocumentBuilder", "(", ");", "Document", "doc", "=", "dBuilder", ".", "parse", "(", "resource", ".", "getInputStream", "(", "))", ";", "SignatureAlgorithm", ".", "valueOf", "(", "loader", ".", "getSignatureAlgorithm", "(", "))", ";", "loader", ".", "getSignatureAlgorithm", "(", "))", ";", "private", "String", "execute", "(", "final", "String", "reportKey", ")", "{", "ExecTO", "execution", "=", "reportService", ".", "execute", "(", "new", "ExecuteQuery", ".", "Builder", "(", ").", "key", "(", "reportKey", ")", ".", "build", "(", "))", ";", "assertNotNull", "(", "execution", ")", ";", "int", "i", "=", "0", ";", "int", "maxit", "=", "50", ";", "ReportTO", "reportTO", ";", "/", "/", "wait", "for", "report", "execution", "completion", "(", "executions", "incremented", ")", "do", "{", "try", "{", "Thread", ".", "sleep", "(", "1000", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "reportTO", "=", "reportService", ".", "read", "(", "reportKey", ")", ";", "assertNotNull", "(", "reportTO", ")", ";", "assertNotNull", "(", "reportTO", ".", "getExecutions", "(", "))", ";", "i", "+", "+;", "}", "while", "(", "reportTO", ".", "getExecutions", "(", ").", "isEmpty", "(", ")", "|", "|", "(", "!", "ReportExecStatus", ".", "SUCCESS", ".", "name", "(", ").", "equals", "(", "reportTO", ".", "getExecutions", "(", ").", "get", "(", "0", ")", ".", "getStatus", "(", "))", "&", "&", "i", "<", "maxit", ")", ");", "assertEquals", "(", "ReportExecStatus", ".", "SUCCESS", ".", "name", "(", "),", "reportTO", ".", "getExecutions", "(", ").", "get", "(", "0", ")", ".", "getStatus", "(", "))", ";", "return", "reportTO", ".", "getExecutions", "(", ").", "get", "(", "0", ")", ".", "getKey", "(", ");", "}", "execute", "(", "reportTO", ".", "getKey", "(", "))", ";", "String", "execKey", "=", "execute", "(", "reportTO", ".", "getKey", "(", "))", ";", "String", "execKey", "=", "execute", "(", "reportTO", ".", "getKey", "(", "))", ";", "String", "execKey", "=", "execute", "(", "report", ".", "getKey", "(", "))", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "try", "{", "if", "(", "isProxyEnabled", "&", "&", "mavenProxyAutoconf", ")", "{", "customMavenProxySettings", "=", "MavenUtils", ".", "createSettingsWithProxy", "(", "installPath", ",", "proxyHost", ",", "proxyPort", ",", "proxyUser", ",", "proxyPwd", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "I", "/", "O", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "Parser", "configuration", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "Transformer", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "XML", "parsing", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "try", "{", "if", "(", "isProxyEnabled", "&", "&", "mavenProxyAutoconf", ")", "{", "}", "catch", "(", "IOException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "I", "/", "O", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "Parser", "configuration", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "Transformer", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "StringBuilder", "message", "=", "new", "StringBuilder", "(", "\"", "XML", "parsing", "error", "during", "creation", "of", "Maven", "custom", "settings", ".", "xml", "\"", ");", "handler", ".", "emitError", "(", "message", ".", "toString", "(", "),", "e", ".", "getMessage", "(", "))", ";", "InstallLog", ".", "getInstance", "(", ").", "error", "(", "message", ".", "append", "(", "'\\", "n", "'", ").", "append", "(", "e", ".", "getMessage", "(", "))", ".", "toString", "(", "))", ";", "factory", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "anonymousKey", ",", "jwsKey", ",", "adminPassword", ")", ";", "final", "String", "proxyUser", ",", "final", "String", "proxyPassword", ")", "throws", "IOException", ",", "ParserConfigurationException", ",", "TransformerException", ",", "SAXException", "{", "final", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setFeature", "(", "javax", ".", "xml", ".", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "final", "DocumentBuilder", "builder", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "final", "Document", "settings", "=", "builder", ".", "parse", "(", "settingsXML", ")", ";"], "docstring_tokens": ["not", "assign", "report", "and", "template", "entitlements", "to", "any", "administrator"]}
{"contents": ["Validate", "client", "headers"], "code_tokens": ["this", ".", "nettyHeaders", "=", "new", "DefaultHttpHeaders", "(", ");</s>this", ".", "nettyHeaders", "=", "new", "DefaultHttpHeaders", "(", "false", ")", ";"], "docstring_tokens": ["due", "to", "not", "validating", "request", "headers", "passed", "to", "the", "client", "."]}
{"contents": ["x86/entry/64:", "Remove", "%ebx", "handling", "from", "error_entry/exit", "error_entry", "and", "error_exit", "communicate", "the", "user", "vs.", "kernel", "status", "of", "the", "frame", "using", "%ebx.", "This", "is", "unnecessary", "--", "the", "information", "is", "in", "regs->cs.", "Just", "use", "regs->cs.", "This", "makes", "error_entry", "simpler", "and", "makes", "error_exit", "more", "robust.", "It", "also", "fixes", "a", "nasty", "bug.", "Before", "all", "the", "Spectre", "nonsense,", "the", "xen_failsafe_callback", "entry", "point", "returned", "like", "this:", "ALLOC_PT_GPREGS_ON_STACK", "SAVE_C_REGS", "SAVE_EXTRA_REGS", "ENCODE_FRAME_POINTER", "jmp", "error_exit", "And", "it", "did", "not", "go", "through", "error_entry.", "This", "was", "bogus:", "RBX", "contained", "garbage,", "and", "error_exit", "expected", "a", "flag", "in", "RBX.", "Fortunately,", "it", "generally", "contained", "*nonzero*", "garbage,", "so", "the", "correct", "code", "path", "was", "used.", "As", "part", "of", "the", "Spectre", "fixes,", "code", "was", "added", "to", "clear", "RBX", "to", "mitigate", "certain", "speculation", "attacks.", "Now,", "depending", "on", "kernel", "configuration,", "RBX", "got", "zeroed", "and,", "when", "running", "some", "Wine", "workloads,", "the", "kernel", "crashes.", "This", "was", "introduced", "by:", "commit", "3ac6d8c787b8", "(\"x86/entry/64:", "Clear", "registers", "for", "exceptions/interrupts,", "to", "reduce", "speculation", "attack", "surface\")", "With", "this", "patch", "applied,", "RBX", "is", "no", "longer", "needed", "as", "a", "flag,", "and", "the", "problem", "goes", "away.", "I", "suspect", "that", "malicious", "userspace", "could", "use", "this", "bug", "to", "crash", "the", "kernel", "even", "without", "the", "offending", "patch", "applied,", "though.", "[", "Historical", "note:", "I", "wrote", "this", "patch", "as", "a", "cleanup", "before", "I", "was", "aware", "of", "the", "bug", "it", "fixed.", "]", "[", "Note", "to", "stable", "maintainers:", "this", "should", "probably", "get", "applied", "to", "all", "kernels.", "If", "you're", "nervous", "about", "that,", "a", "more", "conservative", "fix", "to", "add", "xorl", "%ebx,%ebx;", "incl", "%ebx", "before", "the", "jump", "to", "error_exit", "should", "also", "fix", "the", "problem.", "]", "Reported-and-tested-by:", "M.", "Vefa", "Bicakci", "<m.v.b@runbox.com>", "Signed-off-by:", "Andy", "Lutomirski", "<luto@kernel.org>", "Cc:", "Boris", "Ostrovsky", "<boris.ostrovsky@oracle.com>", "Cc:", "Borislav", "Petkov", "<bp@alien8.de>", "Cc:", "Brian", "Gerst", "<brgerst@gmail.com>", "Cc:", "Dave", "Hansen", "<dave.hansen@linux.intel.com>", "Cc:", "Denys", "Vlasenko", "<dvlasenk@redhat.com>", "Cc:", "Dominik", "Brodowski", "<linux@dominikbrodowski.net>", "Cc:", "Greg", "KH", "<gregkh@linuxfoundation.org>", "Cc:", "H.", "Peter", "Anvin", "<hpa@zytor.com>", "Cc:", "Josh", "Poimboeuf", "<jpoimboe@redhat.com>", "Cc:", "Juergen", "Gross", "<jgross@suse.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "stable@vger.kernel.org", "Cc:", "xen-devel@lists.xenproject.org", "Fixes:", "3ac6d8c787b8", "(\"x86/entry/64:", "Clear", "registers", "for", "exceptions/interrupts,", "to", "reduce", "speculation", "attack", "surface\")", "Link:", "http://lkml.kernel.org/r/b5010a090d3586b2d6e06c7ad3ec5542d1241c45.1532282627.git.luto@kernel.org", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["jmp", "error_exit", "*", "as", "if", "we", "faulted", "immediately", "after", "IRET", ".", "testb", "$", "3", ",", "CS", "(", "%", "rsp", ")", "jz", "retint_kernel</s>jmp", "error_exit", "/", "*", "%", "ebx", ":", "no", "swapgs", "flag", "*", "/", "*", "Return", ":", "EBX", "=", "0", ":", "came", "from", "user", "mode", ";", "EBX", "=", "1", ":", "otherwise", "incl", "%", "ebx", "*", "as", "if", "we", "faulted", "immediately", "after", "IRET", "and", "clear", "EBX", "so", "that", "*", "error_exit", "knows", "that", "we", "will", "be", "returning", "to", "user", "mode", ".", "decl", "%", "ebx", "/", "*", "*", "On", "entry", ",", "EBX", "is", "a", "\"", "return", "to", "kernel", "mode", "\"", "flag", ":", "*", "1", ":", "already", "in", "kernel", "mode", ",", "don", "'", "t", "need", "SWAPGS", "*", "0", ":", "user", "gsbase", "is", "loaded", ",", "we", "need", "SWAPGS", "and", "standard", "preparation", "for", "return", "to", "usermode", "*", "/", "testl", "%", "ebx", ",", "%", "ebx", "jnz", "retint_kernel"], "docstring_tokens": ["does", "not", "properly", "maintain", "RBX"]}
{"contents": ["Fix", "#167"], "code_tokens": ["assert", ".", "equal", "(", "'", "font", "/", "otf", "'", ",", "mime", ".", "lookup", "(", "'", "file", ".", "otf", "'", "))", ";", "var", "ext", "=", "path", ".", "replace", "(", "/^", ".*", "[\\", ".\\", "/\\", "\\]", "/,", "'", "')", ".", "toLowerCase", "(", ");</s>assert", ".", "equal", "(", "'", "font", "/", "opentype", "'", ",", "mime", ".", "lookup", "(", "'", "file", ".", "otf", "'", "))", ";", "var", "ext", "=", "path", ".", "replace", "(", "/.", "*[", "\\.", "\\/", "\\\\", "]/", ",", "'", "')", ".", "toLowerCase", "(", ");"], "docstring_tokens": ["untrusted", "user", "input"]}
{"contents": ["KVM:", "svm:", "unconditionally", "intercept", "#DB", "This", "is", "needed", "to", "avoid", "the", "possibility", "that", "the", "guest", "triggers", "an", "infinite", "stream", "of", "#DB", "exceptions", "(", ").", "VMX", "is", "not", "affected:", "because", "it", "does", "not", "save", "DR6", "in", "the", "VMCS,", "it", "already", "intercepts", "#DB", "unconditionally.", "Reported-by:", "Jan", "Beulich", "<jbeulich@suse.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["set_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "static", "void", "update_bp_intercept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", ".", "update_db_bp_intercept", "=", "update_bp_intercept", ",</s>static", "void", "update_db_bp_intercept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "clr_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "if", "(", "svm", "-", ">", "nmi_singlestep", ")", "set_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "if", "(", "vcpu", "-", ">", "guest_debug", "&", "(", "KVM_GUESTDBG_SINGLESTEP", "|", "KVM_GUESTDBG_USE_HW_BP", ")", ")", "set_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "update_db_bp_intercept", "(", "&", "svm", "-", ">", "vcpu", ")", ";", "update_db_bp_intercept", "(", "vcpu", ")", ";", ".", "update_db_bp_intercept", "=", "update_db_bp_intercept", ","], "docstring_tokens": ["disabling", "loadable", "modules", "etc", ")", "or", "from", "using", "other", "mechanisms", "which", "allow", "them", "to", "run", "code", "at", "kernel", "privilege"]}
{"contents": ["Protect", "against", "symlink", "attacks", "Update", "embedded", "launch", "script", "to", "no", "longer", "change", "ownership", "of", "files", "or", "folders", "that", "already", "exist.", "Fixes", "gh-11397"], "code_tokens": ["@", "Test", "public", "void", "pidFolderOwnership", "(", ")", "throws", "Exception", "{", "String", "output", "=", "doTest", "(", "\"", "pid", "-", "folder", "-", "ownership", ".", "sh", "\"", ");", "System", ".", "err", ".", "println", "(", "output", ")", ";", "assertThat", "(", "output", ")", ".", "contains", "(", "\"", "phil", "root", "\"", ");", "}", "@", "Test", "public", "void", "pidFileOwnership", "(", ")", "throws", "Exception", "{", "String", "output", "=", "doTest", "(", "\"", "pid", "-", "file", "-", "ownership", ".", "sh", "\"", ");", "assertThat", "(", "output", ")", ".", "contains", "(", "\"", "phil", "root", "\"", ");", "}", "@", "Test", "public", "void", "logFileOwnership", "(", ")", "throws", "Exception", "{", "String", "output", "=", "doTest", "(", "\"", "log", "-", "file", "-", "ownership", ".", "sh", "\"", ");", "assertThat", "(", "output", ")", ".", "contains", "(", "\"", "phil", "root", "\"", ");", "}", "source", ".", "/", "test", "-", "functions", ".", "sh", "install_service", "chmod", "o", "+", "w", "/", "var", "/", "log", "useradd", "phil", "mkdir", "/", "phil", "-", "files", "chown", "phil", "/", "phil", "-", "files", "useradd", "andy", "chown", "andy", "/", "test", "-", "service", "/", "spring", "-", "boot", "-", "app", ".", "jar", "start_service", "stop_service", "su", "-", "andy", "-", "c", "\"", "ln", "-", "s", "-", "f", "/", "phil", "-", "files", "/", "var", "/", "log", "/", "spring", "-", "boot", "-", "app", ".", "log", "\"", "start_service", "ls", "-", "ld", "/", "phil", "-", "files", "@", "@", "-", "0", ",", "0", "+", "1", ",", "18", "@", "@", "source", ".", "/", "test", "-", "functions", ".", "sh", "install_service", "useradd", "phil", "mkdir", "/", "phil", "-", "files", "chown", "phil", "/", "phil", "-", "files", "useradd", "andy", "chown", "andy", "/", "test", "-", "service", "/", "spring", "-", "boot", "-", "app", ".", "jar", "start_service", "stop_service", "su", "-", "andy", "-", "c", "\"", "ln", "-", "s", "/", "phil", "-", "files", "/", "var", "/", "run", "/", "spring", "-", "boot", "-", "app", "/", "spring", "-", "boot", "-", "app", ".", "pid", "\"", "start_service", "ls", "-", "ld", "/", "phil", "-", "files", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "source", ".", "/", "test", "-", "functions", ".", "sh", "install_service", "chmod", "o", "+", "w", "/", "var", "/", "run", "useradd", "phil", "mkdir", "/", "phil", "-", "files", "chown", "phil", "/", "phil", "-", "files", "useradd", "andy", "chown", "andy", "/", "test", "-", "service", "/", "spring", "-", "boot", "-", "app", ".", "jar", "su", "-", "andy", "-", "c", "\"", "ln", "-", "s", "-", "f", "/", "phil", "-", "files", "/", "var", "/", "run", "/", "spring", "-", "boot", "-", "app", "\"", "start_service", "ls", "-", "ld", "/", "phil", "-", "files", "@", "@", "-", "146", ",", "12", "+", "146", ",", "12", "@", "@", "start", "(", ")", "{", "if", "[", "[", "!", "-", "e", "\"", "$", "PID_FOLDER", "\"", "]", "];", "then", "mkdir", "-", "p", "\"", "$", "PID_FOLDER", "\"", "&", ">", "/", "dev", "/", "null", "chown", "\"", "$", "run_user", "\"", "\"", "$", "PID_FOLDER", "\"", "fi</s>mkdir", "-", "p", "\"", "$", "PID_FOLDER", "\"", "&", ">", "/", "dev", "/", "null", "chown", "\"", "$", "run_user", "\"", "\"", "$", "PID_FOLDER", "\"", "chown", "\"", "$", "run_user", "\"", "\"", "$", "pid_file", "\"", "chown", "\"", "$", "run_user", "\"", "\"", "$", "log_file", "\"", "-", "-", "chuid", "\"", "$", "run_user", "\"", "\\"], "docstring_tokens": ["is", "susceptible", "to", "a", "symlink", "attack"]}
{"contents": ["USB:", "digi_acceleport:", "do", "sanity", "checking", "for", "the", "number", "of", "ports", "The", "driver", "can", "be", "crashed", "with", "devices", "that", "expose", "crafted", "descriptors", "with", "too", "few", "endpoints.", "See:", "http://seclists.org/bugtraq/2016/Mar/61", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "[johan:", "fix", "OOB", "endpoint", "check", "and", "add", "error", "messages", "]", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["struct", "device", "*", "dev", "=", "&", "serial", "-", ">", "interface", "-", ">", "dev", ";", "int", "i", ";", "/", "*", "check", "whether", "the", "device", "has", "the", "expected", "number", "of", "endpoints", "*", "/", "if", "(", "serial", "-", ">", "num_port_pointers", "<", "serial", "-", ">", "type", "-", ">", "num_ports", "+", "1", ")", "{", "dev_err", "(", "dev", ",", "\"", "OOB", "endpoints", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "serial", "-", ">", "type", "-", ">", "num_ports", "+", "1", ";", "i", "+", "+)", "{", "if", "(", "!", "serial", "-", ">", "port", "[", "i", "]", "->", "read_urb", ")", "{", "dev_err", "(", "dev", ",", "\"", "bulk", "-", "in", "endpoint", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "if", "(", "!", "serial", "-", ">", "port", "[", "i", "]", "->", "write_urb", ")", "{", "dev_err", "(", "dev", ",", "\"", "bulk", "-", "out", "endpoint", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "}</s>"], "docstring_tokens": ["no", "security", "patch", "was", "provided", "by", "the", "vendor", "."]}
{"contents": ["Fix", "for", "#981", "(#987)"], "code_tokens": ["<", "version", ">", "2", ".", "7", ".", "2", "-", "SNAPSHOT", "<", "/", "version", ">", "Assert", ".", "state", "(", "doesNotContainFileColon", "(", "path", ")", ",", "\"", "Path", "must", "not", "contain", "'", "file", ":", "'\"", ");", "private", "static", "boolean", "doesNotContainFileColon", "(", "String", "path", ")", "{", "return", "!", "path", ".", "contains", "(", "\"", "file", ":", "\")", ";", "}", "*", "@", "return", "if", "exists", ".", "*", "@", "return", "the", "input", "stream", ".", "*", "@", "return", "the", "url", ".", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "applyRelativePath", "(", "String", ",", "String", ")", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "getFilename", "(", "String", ")", "thisLoader", ".", "equals", "(", "otherLoader", ")", "&", "&", "this", ".", "clazz", ".", "equals", "(", "otherRes", ".", "clazz", ")", ");</s><", "version", ">", "3", ".", "0", ".", "0", "-", "SNAPSHOT", "<", "/", "version", ">", "*", "*", "@", "return", "if", "exists", ".", "*", "*", "@", "return", "the", "input", "stream", ".", "*", "*", "@", "return", "the", "url", ".", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "applyRelativePath", "(", "String", ",", "String", ")", "*", "*", "@", "see", "spark", ".", "utils", ".", "StringUtils", "#", "getFilename", "(", "String", ")", "*", "thisLoader", ".", "equals", "(", "otherLoader", ")", "&", "&", "this", ".", "clazz", ".", "equals", "(", "otherRes", ".", "clazz", ")", ");"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["[SECURITY-1293]", "Secure", "the", "script", "check", "in", "StringScriptSource"], "code_tokens": ["<", "version", ">", "3", ".", "21", "<", "/", "version", ">", "<", "jenkins", ".", "version", ">", "2", ".", "7", ".", "3", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "7", "<", "/", "java", ".", "level", ">", "<", "version", ">", "1", ".", "50", "<", "/", "version", ">", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "scriptsecurity", ".", "sandbox", ".", "groovy", ".", "GroovySandbox", ";", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ".", "parse", "(", "command", ")", ";", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2019", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "plugins", ".", "groovy", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "StringScriptSourceTest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "1293", "\"", ")", "@", "Test", "public", "void", "blockASTTest", "(", ")", "throws", "Exception", "{", "StringScriptSource", ".", "DescriptorImpl", "d", "=", "j", ".", "jenkins", ".", "getDescriptorByType", "(", "StringScriptSource", ".", "DescriptorImpl", ".", "class", ")", ";", "assertThat", "(", "d", ".", "doCheckScript", "(", "\"", "import", "groovy", ".", "transform", ".", "*\\", "n", "\"", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "import", "hudson", ".", "model", ".", "FreeStyleProject", "\\", "n", "\"", "\"", "@", "ASTTest", "(", "value", "=", "{", "assert", "Jenkins", ".", "getInstance", "(", ").", "createProject", "(", "FreeStyleProject", ".", "class", ",", "\\", "\"", "should", "-", "not", "-", "exist", "\\", "\")", "}", ")\\", "n", "\"", "\"", "@", "Field", "int", "x", "\\", "n", "\"", "\"", "echo", "'", "hello", "'", "\\", "n", "\"", ").", "toString", "(", "),", "containsString", "(", "\"", "Annotation", "ASTTest", "cannot", "be", "used", "in", "the", "sandbox", "\"", "))", ";", "assertNull", "(", "j", ".", "jenkins", ".", "getItem", "(", "\"", "should", "-", "not", "-", "exist", "\"", "))", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1293", "\"", ")", "@", "Test", "public", "void", "blockGrab", "(", ")", "throws", "Exception", "{", "StringScriptSource", ".", "DescriptorImpl", "d", "=", "j", ".", "jenkins", ".", "getDescriptorByType", "(", "StringScriptSource", ".", "DescriptorImpl", ".", "class", ")", ";", "assertThat", "(", "d", ".", "doCheckScript", "(", "\"@", "Grab", "(", "group", "=", "'", "foo", "'", ",", "module", "=", "'", "bar", "'", ",", "version", "=", "'", "1", ".", "0", "'", ")\\", "ndef", "foo", "\\", "n", "\"", ").", "toString", "(", "),", "containsString", "(", "\"", "Annotation", "Grab", "cannot", "be", "used", "in", "the", "sandbox", "\"", "))", ";", "}", "}</s><", "version", ">", "2", ".", "19", "<", "/", "version", ">", "<", "jenkins", ".", "version", ">", "1", ".", "580", ".", "3", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "6", "<", "/", "java", ".", "level", ">", "<", "version", ">", "1", ".", "24", "<", "/", "version", ">", "new", "GroovyShell", "(", ").", "parse", "(", "command", ")", ";"], "docstring_tokens": ["the", "circumvention", "of", "sandbox", "protection", "during", "the", "script", "compilation", "phase"]}
{"contents": ["[SECURITY-1071]"], "code_tokens": ["import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerProxy", ";", "public", "abstract", "class", "PluginManager", "extends", "AbstractModelObject", "implements", "OnMaster", ",", "StaplerOverridable", ",", "StaplerProxy", "{", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "}", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "PluginManager", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "import", "hudson", ".", "PluginManager", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerProxy", ";", "public", "class", "LogRecorderManager", "extends", "AbstractModelObject", "implements", "ModelObjectWithChildren", ",", "StaplerProxy", "{", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "}", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "LogRecorderManager", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerProxy", ";", "public", "abstract", "class", "AbstractItem", "extends", "Actionable", "implements", "Item", ",", "HttpDeletable", ",", "AccessControlled", ",", "DescriptorByNameOwner", ",", "StaplerProxy", "{", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "getACL", "(", ").", "checkPermission", "(", "Item", ".", "READ", ")", ";", "}", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "AbstractItem", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "checkPermission", "(", "CONNECT", ")", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerProxy", ";", "public", "class", "UpdateCenter", "extends", "AbstractModelObject", "implements", "Saveable", ",", "OnMaster", ",", "StaplerProxy", "{", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "}", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "UpdateCenter", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerProxy", ";", "public", "class", "User", "extends", "AbstractModelObject", "implements", "AccessControlled", ",", "DescriptorByNameOwner", ",", "Saveable", ",", "Comparable", "<", "User", ">", ",", "ModelObjectWithContextMenu", ",", "StaplerProxy", "{", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "READ", ")", ";", "}", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "getOwner", "(", ").", "checkPermission", "(", "Item", ".", "CREATE", ")", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerProxy", ";", "public", "class", "Search", "implements", "StaplerProxy", "{", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "READ", ")", ";", "}", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "Search", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");</s>public", "abstract", "class", "PluginManager", "extends", "AbstractModelObject", "implements", "OnMaster", ",", "StaplerOverridable", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "public", "class", "LogRecorderManager", "extends", "AbstractModelObject", "implements", "ModelObjectWithChildren", "{", "public", "abstract", "class", "AbstractItem", "extends", "Actionable", "implements", "Item", ",", "HttpDeletable", ",", "AccessControlled", ",", "DescriptorByNameOwner", "{", "public", "class", "UpdateCenter", "extends", "AbstractModelObject", "implements", "Saveable", ",", "OnMaster", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "public", "class", "User", "extends", "AbstractModelObject", "implements", "AccessControlled", ",", "DescriptorByNameOwner", ",", "Saveable", ",", "Comparable", "<", "User", ">", ",", "ModelObjectWithContextMenu", "{", "getOwner", "(", ").", "checkPermission", "(", "Item", ".", "CREATE", ")", ";", "/", "/", "TODO", "do", "we", "need", "a", "permissions", "check", "here", "?", "public", "class", "Search", "{", "jenkins", ".", "checkPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ";"], "docstring_tokens": ["did", "not", "disable", "the", "processing", "of", "previously", "set", "\"Remember", "me", "\"", "cookies"]}
{"contents": ["regset:", "Prevent", "null", "pointer", "reference", "on", "readonly", "regsets", "The", "regset", "common", "infrastructure", "assumed", "that", "regsets", "would", "always", "have", ".get", "and", ".set", "methods,", "but", "not", "necessarily", ".active", "methods.", "Unfortunately", "people", "have", "since", "written", "regsets", "without", ".set", "methods.", "Rather", "than", "putting", "in", "stub", "functions", "everywhere,", "handle", "regsets", "with", "null", ".get", "or", ".set", "methods", "explicitly.", "Signed-off-by:", "H.", "Peter", "Anvin", "<hpa@zytor.com>", "Reviewed-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Acked-by:", "Roland", "McGrath", "<roland@hack.frob.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "regset", "-", ">", "core_note_type", "&", "&", "regset", "-", ">", "get", "&", "&", "if", "(", "!", "regset", "-", ">", "get", ")", "return", "-", "EOPNOTSUPP", ";", "if", "(", "!", "regset", "-", ">", "set", ")", "return", "-", "EOPNOTSUPP", ";</s>if", "(", "regset", "-", ">", "core_note_type", "&", "&"], "docstring_tokens": ["does", "not", "properly", "handle", "the", "absence", "of", ".get", "and", ".set", "methods"]}
{"contents": ["HID:", "lenovo-tpkbd:", "validate", "output", "report", "details", "A", "HID", "device", "could", "send", "a", "malicious", "output", "report", "that", "would", "cause", "the", "lenovo-tpkbd", "HID", "driver", "to", "write", "just", "beyond", "the", "output", "report", "allocation", "during", "initialization,", "causing", "a", "heap", "overflow:", "[", "76.109807]", "usb", "1-1:", "New", "USB", "device", "found,", "idVendor=17ef,", "idProduct=6009", "...", "[", "80.462540]", "BUG", "kmalloc-192", "(Tainted:", "G", "W", "):", "Redzone", "overwritten", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["int", "i", ",", "ret", ";", "/", "*", "Validate", "required", "reports", ".", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "i", "+", "+)", "{", "if", "(", "!", "hid_validate_values", "(", "hdev", ",", "HID_FEATURE_REPORT", ",", "4", ",", "i", ",", "1", ")", ")", "return", "-", "ENODEV", ";", "}", "if", "(", "!", "hid_validate_values", "(", "hdev", ",", "HID_OUTPUT_REPORT", ",", "3", ",", "0", ",", "2", ")", ")", "return", "-", "ENODEV", ";</s>int", "ret", ";"], "docstring_tokens": ["Requires", "CONFIG_HID", "Memory", "write", "via", "arbitrary", "heap", "array", "index"]}
{"contents": ["[SECURITY-906]"], "code_tokens": ["<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "antisamy", "-", "markup", "-", "formatter", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "5", "<", "/", "version", ">", "<", "/", "dependency", ">", "import", "hudson", ".", "markup", ".", "RawHtmlMarkupFormatter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "BadgeSummaryAction", ".", "class", ".", "getName", "(", "))", ";", "public", "String", "getRawText", "(", ")", "{", "return", "summaryText", ";", "}", "try", "{", "return", "new", "RawHtmlMarkupFormatter", "(", "false", ")", ".", "translate", "(", "summaryText", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Error", "preparing", "summary", "text", "for", "ui", "\"", ",", "e", ")", ";", "return", "\"", "<", "b", ">", "<", "font", "color", "=", "\\\"", "red", "\\", "\">", "ERROR", "<", "/", "font", ">", "</", "b", ">", "\";", "}", "import", "hudson", ".", "markup", ".", "RawHtmlMarkupFormatter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "BadgeSummaryAction", ".", "class", ".", "getName", "(", "))", ";", "public", "String", "getRawHtml", "(", ")", "{", "@", "Exported", "public", "String", "getHtml", "(", ")", "{", "try", "{", "return", "new", "RawHtmlMarkupFormatter", "(", "false", ")", ".", "translate", "(", "html", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Error", "preparing", "html", "content", "for", "ui", "\"", ",", "e", ")", ";", "return", "\"", "<", "b", ">", "<", "font", "color", "=", "\\\"", "red", "\\", "\">", "ERROR", "<", "/", "font", ">", "</", "b", ">", "\";", "}", "}", "testAddHtmlBadge", "(", "html", ",", "html", ")", ";", "}", "@", "Test", "public", "void", "addHtmlBadge_remove_script", "(", ")", "throws", "Exception", "{", "String", "uuid", "=", "UUID", ".", "randomUUID", "(", ").", "toString", "(", ");", "String", "html", "=", "uuid", "+", "\"", "<", "script", ">", "alert", "(", "'", "exploit", "!", "')", ";<", "/", "script", ">", "\";", "testAddHtmlBadge", "(", "html", ",", "uuid", ")", ";", "}", "private", "void", "testAddHtmlBadge", "(", "String", "html", ",", "String", "expected", ")", "throws", "Exception", "{", "assertEquals", "(", "expected", ",", "action", ".", "getHtml", "(", "))", ";", "assertEquals", "(", "html", ",", "action", ".", "getRawHtml", "(", "))", ";", "@", "Test", "public", "void", "createSummary_html_unescaped_remove_script", "(", ")", "throws", "Exception", "{", "String", "text", "=", "randomUUID", "(", ").", "toString", "(", ");", "String", "html", "=", "\"", "<", "li", ">", "\"", "+", "text", "+", "\"", "</", "li", ">", "<", "script", ">", "alert", "(", "\\\"", "exploit", "!", "\\\"", ");", "</", "script", ">", "\";", "BadgeSummaryAction", "action", "=", "createSummary", "(", "\"", "summary", ".", "appendText", "(", "'\"", "+", "html", "+", "\"", "',", "false", ")", ";\"", ");", "assertEquals", "(", "\"<", "li", ">", "\"", "+", "text", "+", "\"", "</", "li", ">", "\",", "action", ".", "getText", "(", "))", ";", "assertEquals", "(", "html", ",", "action", ".", "getRawText", "(", "))", ";", "}", "p", ".", "setDefinition", "(", "new", "CpsFlowDefinition", "(", "\"", "def", "summary", "=", "createSummary", "(", "icon", ":", "\\\"", "\"", "+", "icon", "+", "\"", "\\\"", ",", "text", ":", "\\\"", "\"", "+", "text", "+", "\"", "\\\"", ")\"", ",", "true", ")", ");</s>return", "summaryText", ";", "@", "Exported", "public", "String", "getHtml", "(", ")", "{", "assertEquals", "(", "html", ",", "action", ".", "getHtml", "(", "))", ";", "p", ".", "setDefinition", "(", "new", "CpsFlowDefinition", "(", "\"", "def", "summary", "=", "createSummary", "(", "icon", ":", "\\\"", "\"", "+", "icon", "+", "\"", "\\\"", ",", "text", ":", "\\\"", "\"+", "text", "+", "\"\\", "\")", "\",", "true", ")", ");"], "docstring_tokens": ["did", "not", "check", "the", "permission", "of", "the", "user", "accessing", "it"]}
{"contents": ["MimeTypeUtils", "uses", "SecureRandom", "The", "prevailing", "current", "wisdom", "is", "to", "use", "the", "default", "constructor", "for", "secure", "and", "let", "it", "pick", "the", "best", "algorithm", "for", "the", "OS.", "On", "Java", "8", "(Oracle),", "Linux", "this", "results", "in", "\"NativePRNG\"", "which", "uses", "/dev/random", "(potentially", "blocking)", "for", "the", "initial", "seed,", "and", "/dev/urandom", "(non-blocking)", "for", "subsequent", "calls", "to", "nextInt.", "Issue:", "SPR-16635"], "code_tokens": ["*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "security", ".", "SecureRandom", ";", "private", "static", "final", "Random", "RND", "=", "new", "SecureRandom", "(", ");</s>*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "private", "static", "final", "Random", "RND", "=", "new", "Random", "(", ");"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["[LOG4J2-1863]", "Add", "class", "filtering", "to", "AbstractSocketServer", "This", "allows", "a", "whitelist", "of", "class", "names", "to", "be", "specified", "to", "configure", "which", "classes", "are", "allowed", "to", "be", "deserialized", "in", "both", "TcpSocketServer", "and", "UdpSocketServer."], "code_tokens": ["import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "@", "Parameter", "(", "names", "=", "{", "\"-", "-", "classes", "\"", ",", "\"", "-", "C", "\"", "},", "description", "=", "\"", "Additional", "classes", "to", "allow", "deserialization", "\"", ")", "private", "List", "<", "String", ">", "allowedClasses", ";", "List", "<", "String", ">", "getAllowedClasses", "(", ")", "{", "return", "allowedClasses", "=", "=", "null", "?", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ":", "allowedClasses", ";", "}", "void", "setAllowedClasses", "(", "final", "List", "<", "String", ">", "allowedClasses", ")", "{", "this", ".", "allowedClasses", "=", "allowedClasses", ";", "}", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "logging", ".", "log4j", ".", "core", ".", "util", ".", "FilteredObjectInputStream", ";", "private", "final", "List", "<", "String", ">", "allowedClasses", ";", "public", "ObjectInputStreamLogEventBridge", "(", ")", "{", "this", "(", "Collections", ".", "<", "String", ">", "emptyList", "(", "))", ";", "}", "/", "**", "*", "Constructs", "an", "ObjectInputStreamLogEventBridge", "with", "additional", "allowed", "classes", "to", "deserialize", ".", "*", "*", "@", "param", "allowedClasses", "class", "names", "to", "also", "allow", "for", "deserialization", "*", "@", "since", "2", ".", "8", ".", "2", "*", "/", "public", "ObjectInputStreamLogEventBridge", "(", "final", "List", "<", "String", ">", "allowedClasses", ")", "{", "this", ".", "allowedClasses", "=", "allowedClasses", ";", "}", "throws", "IOException", "{", "return", "new", "FilteredObjectInputStream", "(", "inputStream", ",", "allowedClasses", ")", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "return", "createSerializedSocketServer", "(", "port", ",", "backlog", ",", "localBindAddress", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", "))", ";", "}", "/", "**", "*", "Creates", "a", "socket", "server", "that", "reads", "serialized", "log", "events", ".", "*", "*", "@", "param", "port", "the", "port", "to", "listen", "*", "@", "param", "localBindAddress", "The", "server", "socket", "'", "s", "local", "bin", "address", "*", "@", "param", "allowedClasses", "additional", "class", "names", "to", "allow", "for", "deserialization", "*", "@", "return", "a", "new", "a", "socket", "server", "*", "@", "throws", "IOException", "*", "if", "an", "I", "/", "O", "error", "occurs", "when", "opening", "the", "socket", ".", "*", "@", "since", "2", ".", "8", ".", "2", "*", "/", "public", "static", "TcpSocketServer", "<", "ObjectInputStream", ">", "createSerializedSocketServer", "(", "final", "int", "port", ",", "final", "int", "backlog", ",", "final", "InetAddress", "localBindAddress", ",", "final", "List", "<", "String", ">", "allowedClasses", ")", "throws", "IOException", "{", "new", "ObjectInputStreamLogEventBridge", "(", "allowedClasses", ")", ");", "final", "TcpSocketServer", "<", "ObjectInputStream", ">", "socketServer", "=", "TcpSocketServer", ".", "createSerializedSocketServer", "(", "cla", ".", "getPort", "(", "),", "cla", ".", "getBacklog", "(", "),", "cla", ".", "getLocalBindAddress", "(", "),", "cla", ".", "getAllowedClasses", "(", "))", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "Creates", "a", "socket", "server", "that", "reads", "serialized", "log", "events", ".", "*", "*", "@", "param", "port", "the", "port", "to", "listen", "*", "@", "param", "allowedClasses", "additional", "classes", "to", "allow", "for", "deserialization", "*", "@", "return", "a", "new", "a", "socket", "server", "*", "@", "throws", "IOException", "if", "an", "I", "/", "O", "error", "occurs", "when", "opening", "the", "socket", ".", "*", "@", "since", "2", ".", "8", ".", "2", "*", "/", "public", "static", "UdpSocketServer", "<", "ObjectInputStream", ">", "createSerializedSocketServer", "(", "final", "int", "port", ",", "final", "List", "<", "String", ">", "allowedClasses", ")", "throws", "IOException", "{", "return", "new", "UdpSocketServer", "<", ">(", "port", ",", "new", "ObjectInputStreamLogEventBridge", "(", "allowedClasses", ")", ");", "}", ".", "createSerializedSocketServer", "(", "cla", ".", "getPort", "(", "),", "cla", ".", "getAllowedClasses", "(", "))", ";", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "license", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "license", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "license", ".", "*", "/", "package", "org", ".", "apache", ".", "logging", ".", "log4j", ".", "core", ".", "util", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InvalidObjectException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "Extended", "ObjectInputStream", "that", "only", "allows", "certain", "classes", "to", "be", "deserialized", ".", "*", "*", "@", "since", "2", ".", "8", ".", "2", "*", "/", "public", "class", "FilteredObjectInputStream", "extends", "ObjectInputStream", "{", "private", "static", "final", "List", "<", "String", ">", "REQUIRED_JAVA_CLASSES", "=", "Arrays", ".", "asList", "(", "/", "/", "for", "StandardLevel", "\"", "java", ".", "lang", ".", "Enum", "\"", ",", "/", "/", "for", "location", "information", "\"", "java", ".", "lang", ".", "StackTraceElement", "\"", ",", "/", "/", "for", "Message", "delegate", "\"", "java", ".", "rmi", ".", "MarshalledObject", "\"", ",", "\"", "[", "B", "\"", ")", ";", "private", "final", "Collection", "<", "String", ">", "allowedClasses", ";", "public", "FilteredObjectInputStream", "(", "final", "InputStream", "in", ",", "final", "Collection", "<", "String", ">", "allowedClasses", ")", "throws", "IOException", "{", "super", "(", "in", ")", ";", "this", ".", "allowedClasses", "=", "allowedClasses", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "final", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "String", "name", "=", "desc", ".", "getName", "(", ");", "if", "(", "!(", "isAllowedByDefault", "(", "name", ")", "|", "|", "allowedClasses", ".", "contains", "(", "name", ")", "))", "{", "throw", "new", "InvalidObjectException", "(", "\"", "Class", "is", "not", "allowed", "for", "deserialization", ":", "\"", "+", "name", ")", ";", "}", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "private", "static", "boolean", "isAllowedByDefault", "(", "final", "String", "name", ")", "{", "return", "name", ".", "startsWith", "(", "\"", "org", ".", "apache", ".", "logging", ".", "log4j", ".", "\")", "|", "|", "name", ".", "startsWith", "(", "\"[", "Lorg", ".", "apache", ".", "logging", ".", "log4j", ".", "\")", "|", "|", "REQUIRED_JAVA_CLASSES", ".", "contains", "(", "name", ")", ";", "}", "}</s>throws", "IOException", "{", "return", "new", "ObjectInputStream", "(", "inputStream", ")", ";", "new", "ObjectInputStreamLogEventBridge", "(", "))", ";", "final", "TcpSocketServer", "<", "ObjectInputStream", ">", "socketServer", "=", "TcpSocketServer", ".", "createSerializedSocketServer", "(", "cla", ".", "getPort", "(", "),", "cla", ".", "getBacklog", "(", "),", "cla", ".", "getLocalBindAddress", "(", "))", ";", ".", "createSerializedSocketServer", "(", "cla", ".", "getPort", "(", "))", ";"], "docstring_tokens": ["an", "error", "when", "using", "the", "TCP", "socket", "server", "or", "UDP", "socket", "server", "to", "receive", "serialized", "log", "events", "from", "another", "application"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/122"], "code_tokens": ["(", "void", ")", "strncpy", "(", "clone_info", "-", ">", "magick", ",", "magic_info", "-", ">", "name", ",", "MaxTextExtent", ")", ";</s>(", "void", ")", "CopyMagickMemory", "(", "clone_info", "-", ">", "magick", ",", "magic_info", "-", ">", "name", ",", "MaxTextExtent", ")", ";"], "docstring_tokens": ["not", "releasing", "memory"]}
{"contents": ["ALSA:", "control:", "Handle", "numid", "overflow", "Each", "control", "gets", "automatically", "assigned", "its", "numids", "when", "the", "control", "is", "created.", "The", "allocation", "is", "done", "by", "incrementing", "the", "numid", "by", "the", "amount", "of", "allocated", "numids", "per", "allocation.", "This", "means", "that", "excessive", "creation", "and", "destruction", "of", "controls", "(e.g.", "via", "SNDRV_CTL_IOCTL_ELEM_ADD/REMOVE)", "can", "cause", "the", "id", "to", "eventually", "overflow.", "Currently", "when", "this", "happens", "for", "the", "control", "that", "caused", "the", "overflow", "kctl->id.numid", "+", "kctl->count", "will", "also", "over", "flow", "causing", "it", "to", "be", "smaller", "than", "kctl->id.numid.", "Most", "of", "the", "code", "assumes", "that", "this", "is", "something", "that", "can", "not", "happen,", "so", "we", "need", "to", "make", "sure", "that", "it", "won't", "happen", "Signed-off-by:", "Lars-Peter", "Clausen", "<lars@metafoo.de>", "Acked-by:", "Jaroslav", "Kysela", "<perex@perex.cz>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["/", "*", "Make", "sure", "that", "the", "ids", "assigned", "to", "the", "control", "do", "not", "wrap", "around", "*", "/", "if", "(", "card", "-", ">", "last_numid", ">", "=", "UINT_MAX", "-", "count", ")", "card", "-", ">", "last_numid", "=", "0", ";</s>"], "docstring_tokens": ["does", "not", "check", "if", "the", "control", "is", "actually", "a", "user", "control"]}
{"contents": ["[PATCH]", "Fix", "sysctl", "unregistration", "oops", "(", ")", "You", "could", "open", "the", "/proc/sys/net/ipv4/conf/<if>/<whatever>", "file,", "then", "wait", "for", "interface", "to", "go", "away,", "try", "to", "grab", "as", "much", "memory", "as", "possible", "in", "hope", "to", "hit", "the", "(kfreed)", "ctl_table.", "Then", "fill", "it", "with", "pointers", "to", "your", "function.", "Then", "do", "read", "from", "file", "you've", "opened", "and", "if", "you", "are", "lucky,", "you'll", "get", "it", "called", "as", "->proc_handler()", "in", "kernel", "mode.", "So", "this", "is", "at", "least", "an", "Oops", "and", "possibly", "more.", "It", "does", "depend", "on", "an", "interface", "going", "away", "though,", "so", "less", "of", "a", "security", "risk", "than", "it", "would", "otherwise", "be.", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@suse.de>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["void", "*", "table", ";", "/", "*", "at", "that", "point", "any", "incoming", "access", "will", "fail", "*", "/", "table", "=", "ops", "-", ">", "ctl_table", ";", "unregister_sysctl_table", "(", "ops", "-", ">", "sysctl_header", ")", ";", "kfree", "(", "table", ")", ";", "void", "*", "set", ";", "struct", "completion", ";", "int", "used", ";", "struct", "completion", "*", "unregistering", ";", "static", "void", "register_proc_table", "(", "ctl_table", "*", ",", "struct", "proc_dir_entry", "*", ",", "void", "*", ");", "static", "DEFINE_SPINLOCK", "(", "sysctl_lock", ")", ";", "/", "*", "called", "under", "sysctl_lock", "*", "/", "static", "int", "use_table", "(", "struct", "ctl_table_header", "*", "p", ")", "{", "if", "(", "unlikely", "(", "p", "-", ">", "unregistering", ")", ")", "return", "0", ";", "p", "-", ">", "used", "+", "+;", "return", "1", ";", "}", "/", "*", "called", "under", "sysctl_lock", "*", "/", "static", "void", "unuse_table", "(", "struct", "ctl_table_header", "*", "p", ")", "{", "if", "(", "!-", "-", "p", "-", ">", "used", ")", "if", "(", "unlikely", "(", "p", "-", ">", "unregistering", ")", ")", "complete", "(", "p", "-", ">", "unregistering", ")", ";", "}", "/", "*", "called", "under", "sysctl_lock", ",", "will", "reacquire", "if", "has", "to", "wait", "*", "/", "static", "void", "start_unregistering", "(", "struct", "ctl_table_header", "*", "p", ")", "{", "/", "*", "*", "if", "p", "-", ">", "used", "is", "0", ",", "nobody", "will", "ever", "touch", "that", "entry", "again", ";", "*", "we", "'", "ll", "eliminate", "all", "paths", "to", "it", "before", "dropping", "sysctl_lock", "*", "/", "if", "(", "unlikely", "(", "p", "-", ">", "used", ")", ")", "{", "struct", "completion", "wait", ";", "init_completion", "(", "&", "wait", ")", ";", "p", "-", ">", "unregistering", "=", "&", "wait", ";", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "wait_for_completion", "(", "&", "wait", ")", ";", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "}", "/", "*", "*", "do", "not", "remove", "from", "the", "list", "until", "nobody", "holds", "it", ";", "walking", "the", "*", "list", "in", "do_sysctl", "(", ")", "relies", "on", "that", ".", "*", "/", "list_del_init", "(", "&", "p", "-", ">", "ctl_entry", ")", ";", "}", "register_proc_table", "(", "root_table", ",", "proc_sys_root", ",", "&", "root_table_header", ")", ";", "int", "error", "=", "-", "ENOTDIR", ";", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "if", "(", "!", "use_table", "(", "head", ")", ")", "continue", ";", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "error", "=", "parse_table", "(", "name", ",", "nlen", ",", "oldval", ",", "oldlenp", ",", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "unuse_table", "(", "head", ")", ";", "break", ";", "}", "while", "(", "(", "tmp", "=", "tmp", "-", ">", "next", ")", "!", "=", "&", "root_table_header", ".", "ctl_entry", ")", ";", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "return", "error", ";", "tmp", "-", ">", "used", "=", "0", ";", "tmp", "-", ">", "unregistering", "=", "NULL", ";", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "register_proc_table", "(", "table", ",", "proc_sys_root", ",", "tmp", ")", ";", "might_sleep", "(", ");", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "start_unregistering", "(", "header", ")", ";", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "static", "void", "register_proc_table", "(", "ctl_table", "*", "table", ",", "struct", "proc_dir_entry", "*", "root", ",", "void", "*", "set", ")", "de", "-", ">", "set", "=", "set", ";", "register_proc_table", "(", "table", "-", ">", "child", ",", "de", ",", "set", ")", ";", "/", "*", "*", "In", "any", "case", ",", "mark", "the", "entry", "as", "goner", ";", "we", "'", "ll", "keep", "it", "*", "around", "if", "it", "'", "s", "busy", ",", "but", "we", "'", "ll", "know", "to", "do", "nothing", "with", "*", "its", "fields", ".", "We", "are", "under", "sysctl_lock", "here", ".", "*", "/", "de", "-", ">", "data", "=", "NULL", ";", "struct", "proc_dir_entry", "*", "de", "=", "PDE", "(", "file", "-", ">", "f_dentry", "-", ">", "d_inode", ")", ";", "ssize_t", "error", "=", "-", "ENOTDIR", ";", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "if", "(", "de", "&", "&", "de", "-", ">", "data", "&", "&", "use_table", "(", "de", "-", ">", "set", ")", ")", "{", "/", "*", "*", "at", "that", "point", "we", "know", "that", "sysctl", "was", "not", "unregistered", "*", "and", "won", "'", "t", "be", "until", "we", "finish", "*", "/", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "table", "=", "(", "struct", "ctl_table", "*", ")", "de", "-", ">", "data", ";", "if", "(", "!", "table", "|", "|", "!", "table", "-", ">", "proc_handler", ")", "goto", "out", ";", "error", "=", "-", "EPERM", ";", "op", "=", "(", "write", "?", "002", ":", "004", ")", ";", "if", "(", "ctl_perm", "(", "table", ",", "op", ")", ")", "goto", "out", ";", "/", "*", "careful", ":", "calling", "conventions", "are", "nasty", "here", "*", "/", "res", "=", "count", ";", "error", "=", "(", "*", "table", "-", ">", "proc_handler", ")", "(", "table", ",", "write", ",", "file", ",", "buf", ",", "&", "res", ",", "ppos", ")", ";", "if", "(", "!", "error", ")", "error", "=", "res", ";", "out", ":", "spin_lock", "(", "&", "sysctl_lock", ")", ";", "unuse_table", "(", "de", "-", ">", "set", ")", ";", "}", "spin_unlock", "(", "&", "sysctl_lock", ")", ";", "return", "error", ";</s>unregister_sysctl_table", "(", "ops", "-", ">", "sysctl_header", ")", ";", "kfree", "(", "ops", "-", ">", "ctl_table", ")", ";", "static", "void", "register_proc_table", "(", "ctl_table", "*", ",", "struct", "proc_dir_entry", "*", ");", "register_proc_table", "(", "root_table", ",", "proc_sys_root", ")", ";", "int", "error", "=", "parse_table", "(", "name", ",", "nlen", ",", "oldval", ",", "oldlenp", ",", "return", "error", ";", "tmp", "=", "tmp", "-", ">", "next", ";", "}", "while", "(", "tmp", "!", "=", "&", "root_table_header", ".", "ctl_entry", ")", ";", "return", "-", "ENOTDIR", ";", "register_proc_table", "(", "table", ",", "proc_sys_root", ")", ";", "list_del", "(", "&", "header", "-", ">", "ctl_entry", ")", ";", "static", "void", "register_proc_table", "(", "ctl_table", "*", "table", ",", "struct", "proc_dir_entry", "*", "root", ")", "register_proc_table", "(", "table", "-", ">", "child", ",", "de", ")", ";", "struct", "proc_dir_entry", "*", "de", ";", "ssize_t", "error", ";", "de", "=", "PDE", "(", "file", "-", ">", "f_dentry", "-", ">", "d_inode", ")", ";", "if", "(", "!", "de", "|", "|", "!", "de", "-", ">", "data", ")", "return", "-", "ENOTDIR", ";", "table", "=", "(", "struct", "ctl_table", "*", ")", "de", "-", ">", "data", ";", "if", "(", "!", "table", "|", "|", "!", "table", "-", ">", "proc_handler", ")", "return", "-", "ENOTDIR", ";", "op", "=", "(", "write", "?", "002", ":", "004", ")", ";", "if", "(", "ctl_perm", "(", "table", ",", "op", ")", ")", "return", "-", "EPERM", ";", "res", "=", "count", ";", "error", "=", "(", "*", "table", "-", ">", "proc_handler", ")", "(", "table", ",", "write", ",", "file", ",", "buf", ",", "&", "res", ",", "ppos", ")", ";", "if", "(", "error", ")", "return", "error", ";", "return", "res", ";"], "docstring_tokens": ["a", "failure", "to", "properly", "unregister", "kernel", "resources", "when", "network", "devices", "are", "removed"]}
{"contents": ["https://issues.apache.org/jira/browse/AMQ-5345", "-", "improve", "ldap", "communication"], "code_tokens": ["if", "(", "user", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "user", ")", ")", "{", "env", ".", "put", "(", "Context", ".", "SECURITY_PRINCIPAL", ",", "user", ")", ";", "}", "else", "{", "throw", "new", "Exception", "(", "\"", "Empty", "username", "is", "not", "allowed", "\"", ");", "}", "if", "(", "password", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "password", ")", ")", "{", "env", ".", "put", "(", "Context", ".", "SECURITY_CREDENTIALS", ",", "password", ")", ";", "}", "else", "{", "throw", "new", "Exception", "(", "\"", "Empty", "password", "is", "not", "allowed", "\"", ");", "}", "if", "(", "connectionUsername", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "connectionUsername", ")", ")", "{", "}", "else", "{", "throw", "new", "NamingException", "(", "\"", "Empty", "username", "is", "not", "allowed", "\"", ");", "if", "(", "connectionPassword", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "connectionPassword", ")", ")", "{", "}", "else", "{", "throw", "new", "NamingException", "(", "\"", "Empty", "password", "is", "not", "allowed", "\"", ");", "if", "(", "connectionUsername", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "connectionUsername", ")", ")", "{", "}", "else", "{", "throw", "new", "NamingException", "(", "\"", "Empty", "username", "is", "not", "allowed", "\"", ");", "if", "(", "connectionPassword", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "connectionPassword", ")", ")", "{", "}", "else", "{", "throw", "new", "NamingException", "(", "\"", "Empty", "password", "is", "not", "allowed", "\"", ");", "doRFC2254Encoding", "(", "username", ")", "doRFC2254Encoding", "(", "dn", ")", ",", "doRFC2254Encoding", "(", "username", ")", "}", "else", "{", "throw", "new", "NamingException", "(", "\"", "Empty", "username", "is", "not", "allowed", "\"", ");", "}", "else", "{", "throw", "new", "NamingException", "(", "\"", "Empty", "password", "is", "not", "allowed", "\"", ");", "if", "(", "config", "[", "i", "]", ".", "getPropertyName", "(", ")", "=", "=", "propertyName", "&", "&", "(", "config", "[", "i", "]", ".", "getPropertyValue", "(", ")", "!", "=", "null", "&", "&", "!", "\"\"", ".", "equals", "(", "config", "[", "i", "]", ".", "getPropertyValue", "(", "))", "))", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "@", "Test", "public", "void", "testUnauthenticated", "(", ")", "throws", "LoginException", "{", "LoginContext", "context", "=", "new", "LoginContext", "(", "\"", "UnAuthenticatedLDAPLogin", "\"", ",", "new", "CallbackHandler", "(", ")", "{", "public", "void", "handle", "(", "Callback", "[", "]", "callbacks", ")", "throws", "IOException", ",", "UnsupportedCallbackException", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "callbacks", ".", "length", ";", "i", "+", "+)", "{", "if", "(", "callbacks", "[", "i", "]", "instanceof", "NameCallback", ")", "{", "(", "(", "NameCallback", ")", "callbacks", "[", "i", "]", ").", "setName", "(", "\"", "first", "\"", ");", "}", "else", "if", "(", "callbacks", "[", "i", "]", "instanceof", "PasswordCallback", ")", "{", "(", "(", "PasswordCallback", ")", "callbacks", "[", "i", "]", ").", "setPassword", "(", "\"", "secret", "\"", ".", "toCharArray", "(", "))", ";", "}", "else", "{", "throw", "new", "UnsupportedCallbackException", "(", "callbacks", "[", "i", "]", ");", "}", "}", "}", "}", ");", "try", "{", "context", ".", "login", "(", ");", "}", "catch", "(", "LoginException", "le", ")", "{", "assertEquals", "(", "le", ".", "getCause", "(", ").", "getMessage", "(", "),", "\"", "Empty", "password", "is", "not", "allowed", "\"", ");", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "authenticating", "\"", ");", "}", "UnAuthenticatedLDAPLogin", "{", "org", ".", "apache", ".", "activemq", ".", "jaas", ".", "LDAPLoginModule", "required", "debug", "=", "true", "initialContextFactory", "=", "com", ".", "sun", ".", "jndi", ".", "ldap", ".", "LdapCtxFactory", "connectionURL", "=", "\"", "ldap", ":", "//", "localhost", ":", "1024", "\"", "connectionUsername", "=", "\"", "uid", "=", "admin", ",", "ou", "=", "system", "\"", "connectionPassword", "=", "\"\"", "connectionProtocol", "=", "s", "authentication", "=", "simple", "userBase", "=", "\"", "ou", "=", "system", "\"", "userSearchMatching", "=", "\"(", "uid", "=", "{", "0", "}", ")\"", "userSearchSubtree", "=", "false", "roleBase", "=", "\"", "ou", "=", "system", "\"", "roleName", "=", "dummyRoleName", "roleSearchMatching", "=", "\"(", "uid", "=", "{", "1", "}", ")\"", "roleSearchSubtree", "=", "false", ";", "}", ";", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "activemq", ".", "security", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "javax", ".", "jms", ".", "Connection", ";", "import", "javax", ".", "jms", ".", "Destination", ";", "import", "javax", ".", "jms", ".", "JMSException", ";", "import", "javax", ".", "jms", ".", "Message", ";", "import", "javax", ".", "jms", ".", "MessageConsumer", ";", "import", "javax", ".", "jms", ".", "MessageProducer", ";", "import", "javax", ".", "jms", ".", "Queue", ";", "import", "javax", ".", "jms", ".", "Session", ";", "import", "org", ".", "apache", ".", "activemq", ".", "ActiveMQConnectionFactory", ";", "import", "org", ".", "apache", ".", "activemq", ".", "broker", ".", "BrokerFactory", ";", "import", "org", ".", "apache", ".", "activemq", ".", "broker", ".", "BrokerService", ";", "import", "org", ".", "apache", ".", "directory", ".", "server", ".", "annotations", ".", "CreateLdapServer", ";", "import", "org", ".", "apache", ".", "directory", ".", "server", ".", "annotations", ".", "CreateTransport", ";", "import", "org", ".", "apache", ".", "directory", ".", "server", ".", "core", ".", "annotations", ".", "ApplyLdifFiles", ";", "import", "org", ".", "apache", ".", "directory", ".", "server", ".", "core", ".", "integ", ".", "AbstractLdapTestUnit", ";", "import", "org", ".", "apache", ".", "directory", ".", "server", ".", "core", ".", "integ", ".", "FrameworkRunner", ";", "import", "org", ".", "apache", ".", "directory", ".", "server", ".", "ldap", ".", "LdapServer", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "@", "RunWith", "(", "FrameworkRunner", ".", "class", ")", "@", "CreateLdapServer", "(", "transports", "=", "{", "@", "CreateTransport", "(", "protocol", "=", "\"", "LDAP", "\"", ",", "port", "=", "1024", ")", "})", "@", "ApplyLdifFiles", "(", "\"", "org", "/", "apache", "/", "activemq", "/", "security", "/", "activemq", ".", "ldif", "\"", ")", "public", "class", "LDAPAuthenticationTest", "extends", "AbstractLdapTestUnit", "{", "public", "BrokerService", "broker", ";", "public", "static", "LdapServer", "ldapServer", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "ldapPort", "\"", ",", "String", ".", "valueOf", "(", "getLdapServer", "(", ").", "getPort", "(", "))", ");", "broker", "=", "BrokerFactory", ".", "createBroker", "(", "\"", "xbean", ":", "org", "/", "apache", "/", "activemq", "/", "security", "/", "activemq", "-", "ldap", "-", "auth", ".", "xml", "\"", ");", "broker", ".", "start", "(", ");", "broker", ".", "waitUntilStarted", "(", ");", "}", "@", "After", "public", "void", "shutdown", "(", ")", "throws", "Exception", "{", "broker", ".", "stop", "(", ");", "broker", ".", "waitUntilStopped", "(", ");", "}", "@", "Test", "public", "void", "testWildcard", "(", ")", "throws", "Exception", "{", "ActiveMQConnectionFactory", "factory", "=", "new", "ActiveMQConnectionFactory", "(", "\"", "tcp", ":", "//", "localhost", ":", "61616", "\"", ");", "Connection", "conn", "=", "factory", ".", "createQueueConnection", "(", "\"*", "\",", "\"", "sunflower", "\"", ");", "try", "{", "conn", ".", "createSession", "(", "false", ",", "Session", ".", "AUTO_ACKNOWLEDGE", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "return", ";", "}", "fail", "(", "\"", "Should", "have", "failed", "connecting", "\"", ");", "}", "}", "@", "CreateLdapServer", "(", "transports", "=", "{", "@", "CreateTransport", "(", "protocol", "=", "\"", "LDAP", "\"", ",", "port", "=", "1024", ")", "})", "}", ";", "LDAPLogin", "{", "org", ".", "apache", ".", "activemq", ".", "jaas", ".", "LDAPLoginModule", "required", "debug", "=", "true", "initialContextFactory", "=", "com", ".", "sun", ".", "jndi", ".", "ldap", ".", "LdapCtxFactory", "connectionURL", "=", "\"", "ldap", ":", "//", "localhost", ":", "1024", "\"", "connectionUsername", "=", "\"", "uid", "=", "admin", ",", "ou", "=", "system", "\"", "connectionPassword", "=", "secret", "connectionProtocol", "=", "s", "authentication", "=", "simple", "userBase", "=", "\"", "ou", "=", "User", ",", "ou", "=", "ActiveMQ", ",", "ou", "=", "system", "\"", "userSearchMatching", "=", "\"(", "uid", "=", "{", "0", "}", ")\"", "userSearchSubtree", "=", "false", "roleBase", "=", "\"", "ou", "=", "Group", ",", "ou", "=", "ActiveMQ", ",", "ou", "=", "system", "\"", "roleName", "=", "cn", "roleSearchMatching", "=", "\"(", "uid", "=", "{", "1", "}", ")\"", "roleSearchSubtree", "=", "true", ";", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "-", "->", "<", "!-", "-", "START", "SNIPPET", ":", "xbean", "-", "->", "<", "beans", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "\"", "xmlns", ":", "amq", "=", "\"", "http", ":", "//", "activemq", ".", "apache", ".", "org", "/", "schema", "/", "core", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "/", "spring", "-", "beans", "-", "2", ".", "0", ".", "xsd", "http", ":", "//", "activemq", ".", "apache", ".", "org", "/", "schema", "/", "core", "http", ":", "//", "activemq", ".", "apache", ".", "org", "/", "schema", "/", "core", "/", "activemq", "-", "core", ".", "xsd", "\"", ">", "<", "bean", "class", "=", "\"", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "config", ".", "PropertyPlaceholderConfigurer", "\"", "/>", "<", "broker", "useJmx", "=", "\"", "false", "\"", "xmlns", "=", "\"", "http", ":", "//", "activemq", ".", "apache", ".", "org", "/", "schema", "/", "core", "\"", "persistent", "=", "\"", "false", "\"", ">", "<", "destinations", ">", "<", "queue", "physicalName", "=", "\"", "ADMIN", ".", "FOO", "\"", "/", ">", "<", "/", "destinations", ">", "<", "plugins", ">", "<", "jaasAuthenticationPlugin", "configuration", "=", "\"", "LDAPLogin", "\"", "/>", "<", "/", "plugins", ">", "<", "transportConnectors", ">", "<", "transportConnector", "uri", "=", "\"", "tcp", ":", "//", "localhost", ":", "61616", "\"", "/>", "<", "/", "transportConnectors", ">", "<", "/", "broker", ">", "<", "/", "beans", ">", "<", "!-", "-", "END", "SNIPPET", ":", "xbean", "-", "-></s>env", ".", "put", "(", "Context", ".", "SECURITY_PRINCIPAL", ",", "user", ")", ";", "env", ".", "put", "(", "Context", ".", "SECURITY_CREDENTIALS", ",", "password", ")", ";", "if", "(", "connectionUsername", "!", "=", "null", "|", "|", "!", "\"\"", ".", "equals", "(", "connectionUsername", ")", ")", "{", "if", "(", "connectionPassword", "!", "=", "null", "|", "|", "!", "\"\"", ".", "equals", "(", "connectionPassword", ")", ")", "{", "if", "(", "connectionUsername", "!", "=", "null", "|", "|", "!", "\"\"", ".", "equals", "(", "connectionUsername", ")", ")", "{", "if", "(", "connectionPassword", "!", "=", "null", "|", "|", "!", "\"\"", ".", "equals", "(", "connectionPassword", ")", ")", "{", "username", "doRFC2254Encoding", "(", "dn", ")", ",", "username", "if", "(", "config", "[", "i", "]", ".", "getPropertyName", "(", ")", "=", "=", "propertyName", "&", "&", "config", "[", "i", "]", ".", "getPropertyValue", "(", ")", "!", "=", "null", ")", "@", "CreateLdapServer", "(", "transports", "=", "{", "@", "CreateTransport", "(", "protocol", "=", "\"", "LDAP", "\"", ")}", ")"], "docstring_tokens": ["allows", "wildcard", "operators", "in", "usernames"]}
{"contents": ["KVM:", "x86:", "fix", "for", "buffer", "overflow", "in", "handling", "of", "MSR_KVM_SYSTEM_TIME", "(", ")", "If", "the", "guest", "sets", "the", "GPA", "of", "the", "time_page", "so", "that", "the", "request", "to", "update", "the", "time", "straddles", "a", "page", "then", "KVM", "will", "write", "onto", "an", "incorrect", "page.", "The", "write", "is", "done", "byusing", "kmap", "atomic", "to", "get", "a", "pointer", "to", "the", "page", "for", "the", "time", "structure", "and", "then", "performing", "a", "memcpy", "to", "that", "page", "starting", "at", "an", "offset", "that", "the", "guest", "controls.", "Well", "behaved", "guests", "always", "provide", "a", "32-byte", "aligned", "address,", "however", "a", "malicious", "guest", "could", "use", "this", "to", "corrupt", "host", "kernel", "memory.", "Tested:", "Tested", "against", "kvmclock", "unit", "test.", "Signed-off-by:", "Andrew", "Honig", "<ahonig@google.com>", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>"], "code_tokens": ["/", "*", "Check", "that", "the", "address", "is", "32", "-", "byte", "aligned", ".", "*", "/", "if", "(", "vcpu", "-", ">", "arch", ".", "time_offset", "&", "(", "sizeof", "(", "struct", "pvclock_vcpu_time_info", ")", "-", "1", ")", ")", "break", ";</s>"], "docstring_tokens": ["does", "not", "ensure", "a", "required", "time_page", "alignment", "during", "an", "MSR_KVM_SYSTEM_TIME", "operation"]}
{"contents": ["CAMEL-10567:", "Camel-Jackson:", "Add", "an", "option", "to", "allow", "the", "UnmarshallType", "header", "use"], "code_tokens": ["private", "boolean", "allowJacksonUnmarshallType", ";", "String", "type", "=", "null", ";", "if", "(", "allowJacksonUnmarshallType", ")", "{", "type", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "JacksonConstants", ".", "UNMARSHAL_TYPE", ",", "String", ".", "class", ")", ";", "}", "public", "boolean", "isAllowJacksonUnmarshallType", "(", ")", "{", "return", "allowJacksonUnmarshallType", ";", "}", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "*", "<", "p", "/", ">", "*", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "public", "void", "setAllowJacksonUnmarshallType", "(", "boolean", "allowJacksonUnmarshallType", ")", "{", "this", ".", "allowJacksonUnmarshallType", "=", "allowJacksonUnmarshallType", ";", "}", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "jackson", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "JacksonMarshalUnmarshalTypeHeaderNotAllowedTest", "extends", "CamelTestSupport", "{", "@", "Test", "public", "void", "testUnmarshalPojo", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "reversePojo", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "mock", ".", "message", "(", "0", ")", ".", "body", "(", ").", "isInstanceOf", "(", "LinkedHashMap", ".", "class", ")", ";", "String", "json", "=", "\"", "{\\", "\"", "name", "\\", "\":", "\\\"", "Camel", "\\", "\"}", "\";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "backPojo", "\"", ",", "json", ",", "JacksonConstants", ".", "UNMARSHAL_TYPE", ",", "TestPojo", ".", "class", ".", "getName", "(", "))", ";", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "JacksonDataFormat", "format", "=", "new", "JacksonDataFormat", "(", ");", "from", "(", "\"", "direct", ":", "backPojo", "\"", ").", "unmarshal", "(", "format", ")", ".", "to", "(", "\"", "mock", ":", "reversePojo", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "46", ",", "6", "+", "46", ",", "7", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "format", ".", "setAllowJacksonUnmarshallType", "(", "true", ")", ";</s>String", "type", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "JacksonConstants", ".", "UNMARSHAL_TYPE", ",", "String", ".", "class", ")", ";"], "docstring_tokens": ["Insufficiently", "restricting", "the", "types", "that", "can", "be", "used", "there", "however", "means", "that", "an", "attacker", "can", "trigger", "these", "behaviors", "on", "more", "or", "less", "arbitrary", "types", "on", "the", "classpath"]}
{"contents": ["rxrpc:", "Fix", "several", "cases", "where", "a", "padded", "len", "isn't", "checked", "in", "ticket", "decode", "This", "fixes", ".", "When", "a", "kerberos", "5", "ticket", "is", "being", "decoded", "so", "that", "it", "can", "be", "loaded", "into", "an", "rxrpc-type", "key,", "there", "are", "several", "places", "in", "which", "the", "length", "of", "a", "variable-length", "field", "is", "checked", "to", "make", "sure", "that", "it's", "not", "going", "to", "overrun", "the", "available", "data", "-", "but", "the", "data", "is", "padded", "to", "the", "nearest", "four-byte", "boundary", "and", "the", "code", "doesn't", "check", "for", "this", "extra.", "This", "could", "lead", "to", "the", "size-remaining", "variable", "wrapping", "and", "the", "data", "pointer", "going", "over", "the", "end", "of", "the", "buffer.", "Fix", "this", "by", "making", "the", "various", "variable-length", "data", "checks", "use", "the", "padded", "length.", "Reported-by:", "\u77f3\u78ca", "<shilei-c@360.cn>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Reviewed-by:", "Marc", "Dionne", "<marc.c.dionne@auristor.com>", "Reviewed-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["unsigned", "int", "toklen", "=", "*", "_toklen", ",", "n_parts", ",", "loop", ",", "tmp", ",", "paddedlen", ";", "paddedlen", "=", "(", "tmp", "+", "3", ")", "&", "~", "3", ";", "if", "(", "paddedlen", ">", "toklen", ")", "toklen", "-", "=", "paddedlen", ";", "xdr", "+", "=", "paddedlen", ">", ">", "2", ";", "paddedlen", "=", "(", "tmp", "+", "3", ")", "&", "~", "3", ";", "if", "(", "paddedlen", ">", "toklen", ")", "toklen", "-", "=", "paddedlen", ";", "xdr", "+", "=", "paddedlen", ">", ">", "2", ";", "unsigned", "int", "toklen", "=", "*", "_toklen", ",", "len", ",", "paddedlen", ";", "paddedlen", "=", "(", "len", "+", "3", ")", "&", "~", "3", ";", "if", "(", "paddedlen", ">", "toklen", ")", "return", "-", "EINVAL", ";", "toklen", "-", "=", "paddedlen", ";", "xdr", "+", "=", "paddedlen", ">", ">", "2", ";", "unsigned", "int", "toklen", "=", "*", "_toklen", ",", "len", ",", "paddedlen", ";", "paddedlen", "=", "(", "len", "+", "3", ")", "&", "~", "3", ";", "if", "(", "paddedlen", ">", "toklen", ")", "return", "-", "EINVAL", ";", "toklen", "-", "=", "paddedlen", ";", "xdr", "+", "=", "paddedlen", ">", ">", "2", ";", "unsigned", "int", "len", ",", "paddedlen", ",", "loop", ",", "ntoken", ",", "toklen", ",", "sec_ix", ";", "paddedlen", "=", "(", "len", "+", "3", ")", "&", "~", "3", ";", "if", "(", "paddedlen", ">", "datalen", ")", "for", "(", ";", "loop", "<", "paddedlen", ";", "loop", "+", "+)", "if", "(", "cp", "[", "loop", "]", ")", "goto", "not_xdr", ";", "len", ",", "paddedlen", ",", "len", ",", "len", ",", "(", "const", "char", "*", ")", "xdr", ")", ";", "datalen", "-", "=", "paddedlen", ";", "xdr", "+", "=", "paddedlen", ">", ">", "2", ";", "paddedlen", "=", "(", "toklen", "+", "3", ")", "&", "~", "3", ";", "if", "(", "toklen", "<", "20", "|", "|", "toklen", ">", "datalen", "|", "|", "paddedlen", ">", "datalen", ")", "datalen", "-", "=", "paddedlen", ";", "xdr", "+", "=", "paddedlen", ">", ">", "2", ";</s>unsigned", "int", "toklen", "=", "*", "_toklen", ",", "n_parts", ",", "loop", ",", "tmp", ";", "if", "(", "tmp", ">", "toklen", ")", "tmp", "=", "(", "tmp", "+", "3", ")", "&", "~", "3", ";", "toklen", "-", "=", "tmp", ";", "xdr", "+", "=", "tmp", ">", ">", "2", ";", "if", "(", "tmp", ">", "toklen", ")", "tmp", "=", "(", "tmp", "+", "3", ")", "&", "~", "3", ";", "toklen", "-", "=", "tmp", ";", "xdr", "+", "=", "tmp", ">", ">", "2", ";", "unsigned", "int", "toklen", "=", "*", "_toklen", ",", "len", ";", "len", "=", "(", "len", "+", "3", ")", "&", "~", "3", ";", "toklen", "-", "=", "len", ";", "xdr", "+", "=", "len", ">", ">", "2", ";", "unsigned", "int", "toklen", "=", "*", "_toklen", ",", "len", ";", "len", "=", "(", "len", "+", "3", ")", "&", "~", "3", ";", "toklen", "-", "=", "len", ";", "xdr", "+", "=", "len", ">", ">", "2", ";", "unsigned", "int", "len", ",", "tmp", ",", "loop", ",", "ntoken", ",", "toklen", ",", "sec_ix", ";", "tmp", "=", "(", "len", "+", "3", ")", "&", "~", "3", ";", "if", "(", "tmp", ">", "datalen", ")", "if", "(", "len", "<", "tmp", ")", "for", "(", ";", "loop", "<", "tmp", ";", "loop", "+", "+)", "if", "(", "cp", "[", "loop", "]", ")", "goto", "not_xdr", ";", "len", ",", "tmp", ",", "len", ",", "len", ",", "(", "const", "char", "*", ")", "xdr", ")", ";", "datalen", "-", "=", "tmp", ";", "xdr", "+", "=", "tmp", ">", ">", "2", ";", "if", "(", "toklen", "<", "20", "|", "|", "toklen", ">", "datalen", ")", "datalen", "-", "=", "(", "toklen", "+", "3", ")", "&", "~", "3", ";", "xdr", "+", "=", "(", "toklen", "+", "3", ")", ">", ">", "2", ";"], "docstring_tokens": ["the", "length", "of", "a", "variable-length", "field", "is", "checked", "to", "make", "sure", "that", "it's", "not", "going", "to", "overrun", "the", "available", "data"]}
{"contents": ["[IPV6]:", "Fix", "SKB", "leak", "in", "ip6_input_finish()", "Changing", "it", "to", "how", "ip_input", "handles", "should", "fix", "it.", "Signed-off-by:", "Patrick", "McHardy", "<kaber@trash.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["icmpv6_send", "(", "skb", ",", "ICMPV6_PARAMPROB", ",", "ICMPV6_UNK_NEXTHDR", ",", "nhoff", ",", "skb", "-", ">", "dev", ")", ";", "}", "else", "kfree_skb", "(", "skb", ")", ";</s>icmpv6_param_prob", "(", "skb", ",", "ICMPV6_UNK_NEXTHDR", ",", "nhoff", ")", ";", "}", "else", "{", "kfree_skb", "(", "skb", ")", ";", "}"], "docstring_tokens": ["prevents", "the", "SKB", "from", "being", "freed", "."]}
{"contents": ["Fix", "and", "document", "."], "code_tokens": ["<", "dependency", ">", "<", "groupId", ">", "com", ".", "sun", ".", "xml", ".", "ws", "<", "/", "groupId", ">", "<", "artifactId", ">", "jaxws", "-", "rt", "<", "/", "artifactId", ">", "<", "version", ">", "${", "version", ".", "javax", ".", "xml", ".", "ws", ".", "jaxws", ".", "rt", "}", "</", "version", ">", "<", "/", "dependency", ">", "<", "version", ".", "javax", ".", "xml", ".", "ws", ".", "jaxws", ".", "rt", ">", "2", ".", "2", "<", "/", "version", ".", "javax", ".", "xml", ".", "ws", ".", "jaxws", ".", "rt", ">", "<!", "--", "Java", "5", "-", "->", "<", "version", ".", "org", ".", "ops4j", ".", "pax", ".", "exam", ">", "3", ".", "5", ".", "0", "<", "/", "version", ".", "org", ".", "ops4j", ".", "pax", ".", "exam", ">", "<!", "--", "Java", "6", "-", "->", "<", "html", ">", "<", "!-", "-", "Copyright", "(", "C", ")", "2020", "XStream", "committers", ".", "All", "rights", "reserved", ".", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "style", "license", "a", "copy", "of", "which", "has", "been", "included", "with", "this", "distribution", "in", "the", "LICENSE", ".", "txt", "file", ".", "Created", "on", "06", ".", "December", "2020", "by", "Joerg", "Schaible", "-", "->", "<", "head", ">", "<", "title", ">", "CVE", "-", "2020", "-", "26259", "<", "/", "title", ">", "<", "/", "head", ">", "<", "body", ">", "<", "h2", "id", "=", "\"", "vulnerability", "\"", ">", "Vulnerability", "<", "/", "h2", ">", "<", "p", ">", "CVE", "-", "2020", "-", "26259", ":", "XStream", "is", "vulnerable", "to", "an", "Arbitrary", "File", "Deletion", "on", "the", "local", "host", "when", "unmarshalling", "as", "long", "as", "the", "executing", "process", "has", "sufficient", "rights", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "affected_versions", "\"", ">", "Affected", "Versions", "<", "/", "h2", ">", "<", "p", ">", "All", "versions", "until", "and", "including", "version", "1", ".", "4", ".", "14", "are", "affected", "running", "in", "a", "Java", "environment", "containing", "the", "JAX", "-", "WS", "runtime", ",", "if", "using", "the", "version", "out", "of", "the", "box", ".", "No", "user", "is", "affected", ",", "who", "followed", "the", "recommendation", "to", "setup", "<", "a", "href", "=", "\"", "security", ".", "html", "#", "framework", "\"", ">", "XStream", "'", "s", "security", "framework", "<", "/", "a", ">", "with", "a", "whitelist", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "description", "\"", ">", "Description", "<", "/", "h2", ">", "<", "p", ">", "The", "processed", "stream", "at", "unmarshalling", "time", "contains", "type", "information", "to", "recreate", "the", "formerly", "written", "objects", ".", "XStream", "creates", "therefore", "new", "instances", "based", "on", "these", "type", "information", ".", "An", "attacker", "can", "manipulate", "the", "processed", "input", "stream", "and", "replace", "or", "inject", "objects", ",", "that", "result", "in", "a", "server", "-", "side", "forgery", "request", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "reproduction", "\"", ">", "Steps", "to", "Reproduce", "<", "/", "h2", ">", "<", "p", ">", "Create", "a", "simple", "HashMap", "and", "use", "XStream", "to", "marshal", "it", "to", "XML", ".", "Replace", "the", "XML", "with", "following", "snippet", "and", "unmarshal", "it", "again", "with", "XStream", ":", "</", "p", ">", "<", "div", "class", "=", "\"", "Source", "XML", "\"", "><", "pre", ">", "&", "lt", ";", "map", "&", "gt", ";", "&", "lt", ";", "entry", "&", "gt", ";", "&", "lt", ";", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "&", "gt", ";", "&", "lt", ";", "flags", "&", "gt", ";", "0", "&", "lt", ";", "/", "flags", "&", "gt", ";", "&", "lt", ";", "value", "class", "=", "'", "com", ".", "sun", ".", "xml", ".", "internal", ".", "bind", ".", "v2", ".", "runtime", ".", "unmarshaller", ".", "Base64Data", "'", "&", "gt", ";", "&", "lt", ";", "dataHandler", "&", "gt", ";", "&", "lt", ";", "dataSource", "class", "=", "'", "com", ".", "sun", ".", "xml", ".", "internal", ".", "ws", ".", "encoding", ".", "xml", ".", "XMLMessage", "$", "XmlDataSource", "'", "&", "gt", ";", "&", "lt", ";", "contentType", "&", "gt", ";", "text", "/", "plain", "&", "lt", ";", "/", "contentType", "&", "gt", ";", "&", "lt", ";", "is", "class", "=", "'", "com", ".", "sun", ".", "xml", ".", "internal", ".", "ws", ".", "util", ".", "ReadAllStream", "$", "FileStream", "'", "&", "gt", ";", "&", "lt", ";", "tempFile", "&", "gt", ";", "/", "etc", "/", "hosts", "&", "lt", ";", "/", "tempFile", "&", "gt", ";", "&", "lt", ";", "/", "is", "&", "gt", ";", "&", "lt", ";", "/", "dataSource", "&", "gt", ";", "&", "lt", ";", "transferFlavors", "/", "&", "gt", ";", "&", "lt", ";", "/", "dataHandler", "&", "gt", ";", "&", "lt", ";", "dataLen", "&", "gt", ";", "0", "&", "lt", ";", "/", "dataLen", "&", "gt", ";", "&", "lt", ";", "/", "value", "&", "gt", ";", "&", "lt", ";", "/", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "&", "gt", ";", "&", "lt", ";", "string", "&", "gt", ";", "test", "&", "lt", ";", "/", "string", "&", "gt", ";", "&", "lt", ";", "/", "entry", "&", "gt", ";", "&", "lt", ";", "/", "map", "&", "gt", ";", "<", "/", "pre", ">", "</", "div", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", "><", "pre", ">", "XStream", "xstream", "=", "new", "XStream", "(", ");", "xstream", ".", "fromXML", "(", "xml", ")", ";", "<", "/", "pre", ">", "</", "div", ">", "<", "p", ">", "As", "soon", "as", "the", "XML", "gets", "unmarshalled", ",", "the", "payload", "gets", "executed", "and", "the", "references", "file", "is", "deleted", ".", "</", "p", ">", "<", "p", ">", "Note", ",", "this", "example", "uses", "XML", ",", "but", "the", "attack", "can", "be", "performed", "for", "any", "supported", "format", ",", "e", ".", "g", ".", "JSON", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "impact", "\"", ">", "Impact", "<", "/", "h2", ">", "<", "p", ">", "The", "vulnerability", "may", "allow", "a", "remote", "attacker", "to", "delete", "arbitrary", "know", "files", "on", "the", "host", "as", "log", "as", "the", "executing", "process", "has", "sufficient", "rights", "only", "by", "manipulating", "the", "processed", "input", "stream", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "workaround", "\"", ">", "Workaround", "<", "/", "h2", ">", "<", "p", ">", "As", "recommended", ",", "use", "XStream", "'", "s", "security", "framework", "to", "implement", "a", "whitelist", "for", "the", "allowed", "types", ".", "</", "p", ">", "<", "p", ">", "Users", "of", "XStream", "1", ".", "4", ".", "14", "who", "insist", "to", "use", "XStream", "default", "blacklist", "-", "despite", "that", "clear", "recommendation", "-", "can", "simply", "add", "two", "lines", "to", "XStream", "'", "s", "setup", "code", ":", "</", "p", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", "><", "pre", ">", "xstream", ".", "denyTypes", "(", "new", "String", "[", "]{", "\"", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "\"", "}", ");", "xstream", ".", "denyTypesByRegExp", "(", "new", "String", "[", "]{", "\"", ".*", "\\\\", ".", "ReadAllStream", "\\", "\\$", "FileStream", "\"", "}", ");", "<", "/", "pre", ">", "</", "div", ">", "<", "p", ">", "Users", "of", "XStream", "1", ".", "4", ".", "13", "who", "want", "to", "use", "XStream", "default", "blacklist", "can", "simply", "add", "three", "lines", "to", "XStream", "'", "s", "setup", "code", ":", "</", "p", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", "><", "pre", ">", "xstream", ".", "denyTypes", "(", "new", "String", "[", "]{", "\"", "javax", ".", "imageio", ".", "ImageIO", "$", "ContainsFilter", "\"", ",", "\"", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "\"", "}", ");", "xstream", ".", "denyTypes", "(", "new", "Class", "[", "]{", "java", ".", "lang", ".", "ProcessBuilder", ".", "class", "}", ");", "xstream", ".", "denyTypesByRegExp", "(", "new", "String", "[", "]{", "\"", ".*", "\\\\", ".", "ReadAllStream", "\\", "\\$", "FileStream", "\"", "}", ");", "<", "/", "pre", ">", "</", "div", ">", "<", "p", ">", "Users", "of", "XStream", "1", ".", "4", ".", "12", "to", "1", ".", "4", ".", "7", "who", "want", "to", "use", "XStream", "with", "a", "blacklist", "will", "have", "to", "setup", "such", "a", "list", "from", "scratch", "and", "deny", "at", "least", "the", "following", "types", ":", "<", "em", ">", "javax", ".", "imageio", ".", "ImageIO", "$", "ContainsFilter", "<", "/", "em", ">", ",", "<", "em", ">", "java", ".", "beans", ".", "EventHandler", "<", "/", "em", ">", ",", "<", "em", ">", "java", ".", "lang", ".", "ProcessBuilder", "<", "/", "em", ">", ",", "<", "em", ">", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "<", "/", "em", ">", ",", "<", "em", ">", "java", ".", "lang", ".", "Void", "<", "/", "em", ">", "and", "<", "em", ">", "void", "<", "/", "em", ">", "and", "deny", "several", "types", "by", "name", "pattern", ".", "</", "p", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", "><", "pre", ">", "xstream", ".", "denyTypes", "(", "new", "String", "[", "]{", "\"", "javax", ".", "imageio", ".", "ImageIO", "$", "ContainsFilter", "\"", ",", "\"", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "\"", "}", ");", "xstream", ".", "denyTypes", "(", "new", "Class", "[", "]{", "java", ".", "lang", ".", "ProcessBuilder", ".", "class", ",", "java", ".", "beans", ".", "EventHandler", ".", "class", ",", "java", ".", "lang", ".", "ProcessBuilder", ".", "class", ",", "java", ".", "lang", ".", "Void", ".", "class", ",", "void", ".", "class", "}", ");", "xstream", ".", "denyTypesByRegExp", "(", "new", "String", "[", "]{", "\"", ".*", "\\\\", "$", "LazyIterator", "\"", ",", "\"", "javax", "\\", "\\.", "crypto", "\\", "\\.", ".*", "\",", "\"", ".*", "\\\\", ".", "ReadAllStream", "\\", "\\$", "FileStream", "\"", "}", ");", "<", "/", "pre", ">", "</", "div", ">", "<", "p", ">", "Users", "of", "XStream", "1", ".", "4", ".", "6", "or", "below", "can", "register", "an", "own", "converter", "to", "prevent", "the", "unmarshalling", "of", "the", "currently", "know", "critical", "types", "of", "the", "Java", "runtime", ".", "It", "is", "in", "fact", "an", "updated", "version", "of", "the", "workaround", "for", "CVE", "-", "2013", "-", "7285", ":", "</", "p", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", "><", "pre", ">", "xstream", ".", "registerConverter", "(", "new", "Converter", "(", ")", "{", "public", "boolean", "canConvert", "(", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "amp", ";", "&", "amp", ";", "(", "type", "=", "=", "java", ".", "beans", ".", "EventHandler", ".", "class", "|", "|", "type", "=", "=", "java", ".", "lang", ".", "ProcessBuilder", ".", "class", "|", "|", "type", ".", "getName", "(", ").", "equals", "(", "\"", "javax", ".", "imageio", ".", "ImageIO", "$", "ContainsFilter", "\"", ")", "|", "|", "type", ".", "getName", "(", ").", "equals", "(", "\"", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "\"", ")", "|", "|", "type", "=", "=", "java", ".", "lang", ".", "Void", ".", "class", "|", "|", "void", ".", "class", "|", "|", "Proxy", ".", "isProxy", "(", "type", ")", "|", "|", "type", ".", "getName", "(", ").", "startsWith", "(", "\"", "javax", ".", "crypto", ".", "\")", "|", "|", "type", ".", "getName", "(", ").", "endsWith", "(", "\"$", "LazyIterator", "\"", ")", "|", "|", "type", ".", "getName", "(", ").", "endsWith", "(", "\".", "ReadAllStream", "$", "FileStream", "\"", "))", ";", "}", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "throw", "new", "ConversionException", "(", "\"", "Unsupported", "type", "due", "to", "security", "reasons", ".", "\")", ";", "}", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "throw", "new", "ConversionException", "(", "\"", "Unsupported", "type", "due", "to", "security", "reasons", ".", "\")", ";", "}", "}", ",", "XStream", ".", "PRIORITY_LOW", ")", ";", "<", "/", "pre", ">", "</", "div", ">", "<", "h2", "id", "=", "\"", "credits", "\"", ">", "Credits", "<", "/", "h2", ">", "<", "p", ">", "\u949f\u6f66", "\u8d35", "(", "Liaogui", "Zhong", ")", "found", "and", "reported", "the", "issue", "to", "XStream", "and", "provided", "the", "required", "information", "to", "reproduce", "it", ".", "</", "p", ">", "<", "/", "body", ">", "<", "/", "html", ">", "<", "p", "class", "=", "\"", "highlight", "\"", ">", "This", "maintenance", "release", "addresses", "the", "security", "vulnerabilities", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26258", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26258", "<", "/", "a", ">", "and", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26259", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26259", "<", "/", "a", ">", ",", "when", "unmarshalling", "for", "XStream", "instances", "with", "uninitialized", "security", "framework", ".", "</", "p", ">", "<", "li", ">", "The", "type", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "and", "the", "internal", "JAX", "-", "WS", "type", "ReadAllStream", ".", "FileStream", "are", "now", "part", "of", "the", "default", "blacklist", "and", "the", "deserialization", "of", "XML", "containing", "one", "of", "the", "two", "types", "will", "fail", ".", "You", "will", "have", "to", "enable", "these", "types", "by", "explicit", "configuration", ",", "if", "you", "need", "them", ".", "</", "li", ">", "blacklist", "and", "the", "deserialization", "of", "XML", "containing", "one", "of", "the", "two", "types", "will", "fail", ".", "You", "will", "have", "to", "enable", "these", "types", "by", "explicit", "configuration", ",", "if", "you", "need", "them", ".", "</", "li", ">", "advantage", "of", "this", "to", "access", "private", "data", ",", "delete", "local", "files", ",", "execute", "arbitrary", "code", "or", "shell", "commands", "in", "the", "context", "of", "the", "server", "running", "the", "XStream", "process", ".", "Concrete", "cases", "are", "described", "in", "<", "a", "href", "=", "\"", "CVE", "-", "2013", "-", "7285", ".", "html", "\"", ">", "CVE", "-", "2013", "-", "7285", "<", "/", "a", ">", ",", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26217", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26217", "<", "/", "a", ">", ",", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26258", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26258", "<", "/", "a", ">", ",", "and", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26259", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26259", "<", "/", "a", ">", ".<", "/", "p", ">", "<", "page", ">", "CVE", "-", "2020", "-", "26259", ".", "html", "<", "/", "page", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "sun", ".", "xml", ".", "ws", "<", "/", "groupId", ">", "<", "artifactId", ">", "jaxws", "-", "rt", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "exclusions", ">", "<", "exclusion", ">", "<", "groupId", ">", "javax", ".", "xml", ".", "ws", "<", "/", "groupId", ">", "<", "artifactId", ">", "jaxws", "-", "api", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "com", ".", "sun", ".", "istack", "<", "/", "groupId", ">", "<", "artifactId", ">", "istack", "-", "commons", "-", "runtime", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "com", ".", "sun", ".", "xml", ".", "bind", "<", "/", "groupId", ">", "<", "artifactId", ">", "jaxb", "-", "impl", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "com", ".", "sun", ".", "xml", ".", "messaging", ".", "saaj", "<", "/", "groupId", ">", "<", "artifactId", ">", "saaj", "-", "impl", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "com", ".", "sun", ".", "xml", ".", "stream", ".", "buffer", "<", "/", "groupId", ">", "<", "artifactId", ">", "streambuffer", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "com", ".", "sun", ".", "xml", ".", "ws", "<", "/", "groupId", ">", "<", "artifactId", ">", "policy", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "com", ".", "sun", ".", "org", ".", "apache", ".", "xml", ".", "internal", "<", "/", "groupId", ">", "<", "artifactId", ">", "resolver", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "org", ".", "glassfish", ".", "gmbal", "<", "/", "groupId", ">", "<", "artifactId", ">", "gmbal", "-", "api", "-", "only", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "org", ".", "jvnet", "<", "/", "groupId", ">", "<", "artifactId", ">", "mimepull", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "exclusion", ">", "<", "groupId", ">", "org", ".", "jvnet", ".", "staxex", "<", "/", "groupId", ">", "<", "artifactId", ">", "stax", "-", "ex", "<", "/", "artifactId", ">", "<", "/", "exclusion", ">", "<", "/", "exclusions", ">", "<", "/", "dependency", ">", "private", "static", "final", "Pattern", "JAXWS_FILE_STREAM", "=", "Pattern", ".", "compile", "(", "\".", "*\\", "\\.", "ReadAllStream", "\\", "\\$", "FileStream", "\"", ");", "\"", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "\"", "}", ");", "denyTypesByRegExp", "(", "new", "Pattern", "[", "]{", "LAZY_ITERATORS", ",", "JAVAX_CRYPTO", ",", "JAXWS_FILE_STREAM", "}", ");", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "public", "void", "testCannotUseJaxwsInputStreamToDeleteFile", "(", ")", "{", "if", "(", "JVM", ".", "isVersion", "(", "5", ")", ")", "{", "final", "String", "xml", "=", "\"", "\"", "+", "\"", "<", "is", "class", "=", "'", "com", ".", "sun", ".", "xml", ".", "ws", ".", "util", ".", "ReadAllStream", "$", "FileStream", "'", ">\\", "n", "\"", "+", "\"", "<", "tempFile", ">", "target", "/", "junit", "/", "test", ".", "txt", "<", "/", "tempFile", ">", "\\", "n", "\"", "+", "\"", "</", "is", ">", "\";", "xstream", ".", "aliasType", "(", "\"", "is", "\"", ",", "InputStream", ".", "class", ")", ";", "try", "{", "xstream", ".", "fromXML", "(", "xml", ")", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ConversionException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "/", "/", "OK", "}", "}", "}", "public", "void", "testExplicitlyUseJaxwsInputStreamToDeleteFile", "(", ")", "throws", "IOException", "{", "if", "(", "JVM", ".", "isVersion", "(", "5", ")", ")", "{", "final", "File", "testDir", "=", "new", "File", "(", "\"", "target", "/", "junit", "\"", ");", "final", "File", "testFile", "=", "new", "File", "(", "testDir", ",", "\"", "test", ".", "txt", "\"", ");", "try", "{", "testDir", ".", "mkdirs", "(", ");", "final", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "testFile", ")", ";", "out", ".", "write", "(", "\"", "JUnit", "\"", ".", "getBytes", "(", "))", ";", "out", ".", "flush", "(", ");", "out", ".", "close", "(", ");", "assertTrue", "(", "\"", "Test", "file", "\"", "+", "testFile", ".", "getPath", "(", ")", "+", "\"", "does", "not", "exist", ".", "\",", "testFile", ".", "exists", "(", "))", ";", "final", "String", "xml", "=", "\"", "\"", "+", "\"", "<", "is", "class", "=", "'", "com", ".", "sun", ".", "xml", ".", "ws", ".", "util", ".", "ReadAllStream", "$", "FileStream", "'", ">\\", "n", "\"", "+", "\"", "<", "tempFile", ">", "target", "/", "junit", "/", "test", ".", "txt", "<", "/", "tempFile", ">", "\\", "n", "\"", "+", "\"", "</", "is", ">", "\";", "xstream", ".", "addPermission", "(", "AnyTypePermission", ".", "ANY", ")", ";", "/", "/", "clear", "out", "defaults", "xstream", ".", "aliasType", "(", "\"", "is", "\"", ",", "InputStream", ".", "class", ")", ";", "InputStream", "is", "=", "null", ";", "try", "{", "is", "=", "(", "InputStream", ")", "xstream", ".", "fromXML", "(", "xml", ")", ";", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "/", "/", "OK", "}", "assertTrue", "(", "\"", "Test", "file", "\"", "+", "testFile", ".", "getPath", "(", ")", "+", "\"", "no", "longer", "exists", ".", "\",", "testFile", ".", "exists", "(", "))", ";", "byte", "[", "]", "data", "=", "new", "byte", "[", "10", "]", ";", "is", ".", "read", "(", "data", ")", ";", "is", ".", "close", "(", ");", "assertFalse", "(", "\"", "Test", "file", "\"", "+", "testFile", ".", "getPath", "(", ")", "+", "\"", "still", "exists", "exist", ".", "\",", "testFile", ".", "exists", "(", "))", ";", "}", "finally", "{", "if", "(", "testFile", ".", "exists", "(", "))", "{", "testFile", ".", "delete", "(", ");", "}", "if", "(", "testDir", ".", "exists", "(", "))", "{", "testDir", ".", "delete", "(", ");", "}", "}", "}", "}</s><", "version", ".", "org", ".", "ops4j", ".", "pax", ".", "exam", ">", "3", ".", "5", ".", "0", "<", "/", "version", ".", "org", ".", "ops4j", ".", "pax", ".", "exam", ">", "<!", "--", "java", "6", "-", "->", "<", "p", "class", "=", "\"", "highlight", "\"", ">", "This", "maintenance", "release", "addresses", "the", "security", "vulnerability", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26258", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26258", "<", "/", "a", ">", ",", "when", "unmarshalling", "for", "XStream", "instances", "with", "uninitialized", "security", "framework", "in", "a", "Java", "runtime", "below", "Java", "15", ".", "</", "p", ">", "<", "li", ">", "The", "type", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "id", "now", "part", "of", "the", "default", "blacklist", "and", "the", "deserialization", "of", "XML", "containing", "one", "of", "the", "two", "types", "will", "fail", ".", "You", "will", "must", "enable", "these", "types", "by", "explicit", "configuration", ",", "if", "you", "need", "them", ".", "</", "li", ">", "blacklist", "and", "the", "deserialization", "of", "XML", "containing", "one", "of", "the", "two", "types", "will", "fail", ".", "You", "will", "must", "enable", "these", "types", "by", "explicit", "configuration", ",", "if", "you", "need", "them", ".", "</", "li", ">", "advantage", "of", "this", "to", "access", "private", "data", ",", "execute", "arbitrary", "code", "or", "shell", "commands", "in", "the", "context", "of", "the", "server", "running", "the", "XStream", "process", ".", "Concrete", "cases", "are", "described", "in", "<", "a", "href", "=", "\"", "CVE", "-", "2013", "-", "7285", ".", "html", "\"", ">", "CVE", "-", "2013", "-", "7285", "<", "/", "a", ">", ",", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26217", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26217", "<", "/", "a", ">", ",", "and", "<", "a", "href", "=", "\"", "CVE", "-", "2020", "-", "26258", ".", "html", "\"", ">", "CVE", "-", "2020", "-", "26258", "<", "/", "a", ">", ".<", "/", "p", ">", "\"", "jdk", ".", "nashorn", ".", "internal", ".", "objects", ".", "NativeString", "\"", "})", ";", "denyTypesByRegExp", "(", "new", "Pattern", "[", "]{", "LAZY_ITERATORS", ",", "JAVAX_CRYPTO", "}", ");"], "docstring_tokens": ["improper", "input", "sanitization"]}
{"contents": ["Fix", "Check", "session_cert", "is", "not", "NULL", "before", "dereferencing", "it."], "code_tokens": ["if", "(", "s", "-", ">", "session", "-", ">", "sess_cert", "=", "=", "NULL", ")", "{", "ssl3_send_alert", "(", "s", ",", "SSL3_AL_FATAL", ",", "SSL_AD_UNEXPECTED_MESSAGE", ")", ";", "SSLerr", "(", "SSL_F_SSL3_SEND_CLIENT_KEY_EXCHANGE", ",", "SSL_R_UNEXPECTED_MESSAGE", ")", ";", "goto", "err", ";", "}</s>"], "docstring_tokens": ["send", "carefully", "crafted", "packets"]}
{"contents": ["ALSA:", "control:", "Don't", "access", "controls", "outside", "of", "protected", "regions", "A", "control", "that", "is", "visible", "on", "the", "card->controls", "list", "can", "be", "freed", "at", "any", "time.", "This", "means", "we", "must", "not", "access", "any", "of", "its", "memory", "while", "not", "holding", "the", "controls_rw_lock.", "Otherwise", "we", "risk", "a", "use", "after", "free", "access.", "Signed-off-by:", "Lars-Peter", "Clausen", "<lars@metafoo.de>", "Acked-by:", "Jaroslav", "Kysela", "<perex@perex.cz>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["unsigned", "int", "count", ";", "count", "=", "kcontrol", "-", ">", "count", ";", "for", "(", "idx", "=", "0", ";", "idx", "<", "count", ";", "idx", "+", "+,", "id", ".", "index", "+", "+,", "id", ".", "numid", "+", "+)", "unsigned", "int", "count", ";", "count", "=", "kcontrol", "-", ">", "count", ";", "for", "(", "idx", "=", "0", ";", "idx", "<", "count", ";", "idx", "+", "+,", "id", ".", "index", "+", "+,", "id", ".", "numid", "+", "+)", "struct", "snd_ctl_elem_id", "id", "=", "control", "-", ">", "id", ";", "snd_ctl_notify", "(", "card", ",", "SNDRV_CTL_EVENT_MASK_VALUE", ",", "&", "id", ")", ";", "struct", "snd_ctl_elem_id", "id", "=", "kctl", "-", ">", "id", ";", "snd_ctl_notify", "(", "card", ",", "SNDRV_CTL_EVENT_MASK_TLV", ",", "&", "id", ")", ";</s>for", "(", "idx", "=", "0", ";", "idx", "<", "kcontrol", "-", ">", "count", ";", "idx", "+", "+,", "id", ".", "index", "+", "+,", "id", ".", "numid", "+", "+)", "for", "(", "idx", "=", "0", ";", "idx", "<", "kcontrol", "-", ">", "count", ";", "idx", "+", "+,", "id", ".", "index", "+", "+,", "id", ".", "numid", "+", "+)", "snd_ctl_notify", "(", "card", ",", "SNDRV_CTL_EVENT_MASK_VALUE", ",", "&", "control", "-", ">", "id", ")", ";", "snd_ctl_notify", "(", "card", ",", "SNDRV_CTL_EVENT_MASK_TLV", ",", "&", "kctl", "-", ">", "id", ")", ";"], "docstring_tokens": ["does", "not", "check", "if", "the", "control", "is", "actually", "a", "user", "control"]}
{"contents": ["Block", "URL", "Encoded", "\"/\"", "in", "DefaultHttpFirewall", "Fixes", "gh-4169"], "code_tokens": ["*", "Default", "implementation", "which", "wraps", "requests", "in", "order", "to", "provide", "consistent", "*", "values", "of", "the", "{", "@", "code", "servletPath", "}", "and", "{", "@", "code", "pathInfo", "}", ",", "which", "do", "not", "contain", "*", "path", "parameters", "(", "as", "defined", "in", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "ietf", ".", "org", "/", "rfc", "/", "rfc2396", ".", "txt", "\"", ">", "RFC", "2396", "<", "/", "a", ">", ").", "Different", "*", "servlet", "containers", "interpret", "the", "servlet", "spec", "differently", "as", "to", "how", "path", "*", "parameters", "are", "treated", "and", "it", "is", "possible", "they", "might", "be", "added", "in", "order", "to", "*", "bypass", "particular", "security", "constraints", ".", "When", "using", "this", "implementation", ",", "they", "*", "will", "be", "removed", "for", "all", "requests", "as", "the", "request", "passes", "through", "the", "security", "*", "filter", "chain", ".", "Note", "that", "this", "means", "that", "any", "segments", "in", "the", "decoded", "path", "*", "which", "contain", "a", "semi", "-", "colon", ",", "will", "have", "the", "part", "following", "the", "semi", "-", "colon", "*", "removed", "for", "request", "matching", ".", "Your", "application", "should", "not", "contain", "any", "valid", "*", "paths", "which", "contain", "semi", "-", "colons", ".", "*", "If", "any", "un", "-", "normalized", "paths", "are", "found", "(", "containing", "directory", "-", "traversal", "*", "character", "sequences", ")", ",", "the", "request", "will", "be", "rejected", "immediately", ".", "Most", "*", "containers", "normalize", "the", "paths", "before", "performing", "the", "servlet", "-", "mapping", ",", "but", "*", "again", "this", "is", "not", "guaranteed", "by", "the", "servlet", "spec", ".", "private", "boolean", "allowUrlEncodedSlash", ";", "@", "Override", "public", "FirewalledRequest", "getFirewalledRequest", "(", "HttpServletRequest", "request", ")", "throws", "RequestRejectedException", "{", "throw", "new", "RequestRejectedException", "(", "\"", "Un", "-", "normalized", "paths", "are", "not", "supported", ":", "\"", "+", "fwr", ".", "getServletPath", "(", ")", "+", "(", "fwr", ".", "getPathInfo", "(", ")", "!", "=", "null", "?", "fwr", ".", "getPathInfo", "(", ")", ":", "\"", "\")", ");", "String", "requestURI", "=", "fwr", ".", "getRequestURI", "(", ");", "if", "(", "containsInvalidUrlEncodedSlash", "(", "requestURI", ")", ")", "{", "throw", "new", "RequestRejectedException", "(", "\"", "The", "requestURI", "cannot", "contain", "encoded", "slash", ".", "Got", "\"", "+", "requestURI", ")", ";", "}", "@", "Override", "*", "<", "p", ">", "*", "Sets", "if", "the", "application", "should", "allow", "a", "URL", "encoded", "slash", "character", ".", "*", "<", "/", "p", ">", "*", "<", "p", ">", "*", "If", "true", "(", "default", "is", "false", ")", ",", "a", "URL", "encoded", "slash", "will", "be", "allowed", "in", "the", "*", "URL", ".", "Allowing", "encoded", "slashes", "can", "cause", "security", "vulnerabilities", "in", "some", "*", "situations", "depending", "on", "how", "the", "container", "constructs", "the", "*", "HttpServletRequest", ".", "*", "<", "/", "p", ">", "*", "@", "param", "allowUrlEncodedSlash", "*", "the", "new", "value", "(", "default", "false", ")", "*", "/", "public", "void", "setAllowUrlEncodedSlash", "(", "boolean", "allowUrlEncodedSlash", ")", "{", "this", ".", "allowUrlEncodedSlash", "=", "allowUrlEncodedSlash", ";", "}", "private", "boolean", "containsInvalidUrlEncodedSlash", "(", "String", "uri", ")", "{", "if", "(", "this", ".", "allowUrlEncodedSlash", "|", "|", "uri", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "uri", ".", "contains", "(", "\"%", "2f", "\"", ")", "|", "|", "uri", ".", "contains", "(", "\"%", "2F", "\"", "))", "{", "return", "true", ";", "}", "return", "false", ";", "}", "/", "**", "*", "Checks", "whether", "a", "path", "is", "normalized", "(", "doesn", "'", "t", "contain", "path", "traversal", "*", "sequences", "like", "\"", "./", "\",", "\"", "/.", "./", "\"", "or", "\"", "/.", "\")", "*", "*", "@", "param", "path", "*", "the", "path", "to", "test", "*", "@", "return", "true", "if", "the", "path", "doesn", "'", "t", "contain", "any", "path", "-", "traversal", "character", "*", "sequences", ".", "}", "else", "if", "(", "gap", "=", "=", "3", "&", "&", "path", ".", "charAt", "(", "i", "+", "1", ")", "=", "=", "'", ".'", "&", "&", "path", ".", "charAt", "(", "i", "+", "2", ")", "=", "=", "'", ".'", ")", "{", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "fail", ";", "public", "String", "[", "]", "unnormalizedPaths", "=", "{", "\"", "/.", ".\"", ",", "\"", "/.", "/", "path", "/", "\",", "\"", "/", "path", "/", "path", "/", ".\"", ",", "\"", "/", "path", "/", "path", "/", "/.", "\",", "\"", "./", "path", "/", "..", "/", "path", "/", "/.", "\",", "\"", "./", "path", "\"", ",", "\"", "./", "/", "path", "\"", ",", "\"", ".\"", "}", ";", "for", "(", "String", "path", ":", "this", ".", "unnormalizedPaths", ")", "{", "}", "catch", "(", "RequestRejectedException", "expected", ")", "{", "}", "catch", "(", "RequestRejectedException", "expected", ")", "{", "/", "**", "*", "On", "WebSphere", "8", ".", "5", "a", "URL", "like", "/", "context", "-", "root", "/", "a", "/", "b", ";", "%", "2f1", "/", "c", "can", "bypass", "a", "rule", "on", "*", "/", "a", "/", "b", "/", "c", "because", "the", "pathInfo", "is", "/", "a", "/", "b", ";", "/", "1", "/", "c", "which", "ends", "up", "being", "/", "a", "/", "b", "/", "1", "/", "c", "*", "while", "Spring", "MVC", "will", "strip", "the", ";", "content", "from", "requestURI", "before", "the", "path", "*", "is", "URL", "decoded", ".", "*", "/", "@", "Test", "(", "expected", "=", "RequestRejectedException", ".", "class", ")", "public", "void", "getFirewalledRequestWhenLowercaseEncodedPathThenException", "(", ")", "{", "DefaultHttpFirewall", "fw", "=", "new", "DefaultHttpFirewall", "(", ");", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "request", ".", "setRequestURI", "(", "\"/", "context", "-", "root", "/", "a", "/", "b", ";", "%", "2f1", "/", "c", "\"", ");", "request", ".", "setContextPath", "(", "\"/", "context", "-", "root", "\"", ");", "request", ".", "setServletPath", "(", "\"\"", ");", "request", ".", "setPathInfo", "(", "\"/", "a", "/", "b", ";", "/", "1", "/", "c", "\"", ");", "/", "/", "URL", "decoded", "requestURI", "fw", ".", "getFirewalledRequest", "(", "request", ")", ";", "}", "@", "Test", "(", "expected", "=", "RequestRejectedException", ".", "class", ")", "public", "void", "getFirewalledRequestWhenUppercaseEncodedPathThenException", "(", ")", "{", "DefaultHttpFirewall", "fw", "=", "new", "DefaultHttpFirewall", "(", ");", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "request", ".", "setRequestURI", "(", "\"/", "context", "-", "root", "/", "a", "/", "b", ";", "%", "2f1", "/", "c", "\"", ");", "request", ".", "setContextPath", "(", "\"/", "context", "-", "root", "\"", ");", "request", ".", "setServletPath", "(", "\"\"", ");", "request", ".", "setPathInfo", "(", "\"/", "a", "/", "b", ";", "/", "1", "/", "c", "\"", ");", "/", "/", "URL", "decoded", "requestURI", "fw", ".", "getFirewalledRequest", "(", "request", ")", ";", "}", "@", "Test", "public", "void", "getFirewalledRequestWhenAllowUrlEncodedSlashAndLowercaseEncodedPathThenNoException", "(", ")", "{", "DefaultHttpFirewall", "fw", "=", "new", "DefaultHttpFirewall", "(", ");", "fw", ".", "setAllowUrlEncodedSlash", "(", "true", ")", ";", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "request", ".", "setRequestURI", "(", "\"/", "context", "-", "root", "/", "a", "/", "b", ";", "%", "2f1", "/", "c", "\"", ");", "request", ".", "setContextPath", "(", "\"/", "context", "-", "root", "\"", ");", "request", ".", "setServletPath", "(", "\"\"", ");", "request", ".", "setPathInfo", "(", "\"/", "a", "/", "b", ";", "/", "1", "/", "c", "\"", ");", "/", "/", "URL", "decoded", "requestURI", "fw", ".", "getFirewalledRequest", "(", "request", ")", ";", "}", "@", "Test", "public", "void", "getFirewalledRequestWhenAllowUrlEncodedSlashAndUppercaseEncodedPathThenNoException", "(", ")", "{", "DefaultHttpFirewall", "fw", "=", "new", "DefaultHttpFirewall", "(", ");", "fw", ".", "setAllowUrlEncodedSlash", "(", "true", ")", ";", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "request", ".", "setRequestURI", "(", "\"/", "context", "-", "root", "/", "a", "/", "b", ";", "%", "2f1", "/", "c", "\"", ");", "request", ".", "setContextPath", "(", "\"/", "context", "-", "root", "\"", ");", "request", ".", "setServletPath", "(", "\"\"", ");", "request", ".", "setPathInfo", "(", "\"/", "a", "/", "b", ";", "/", "1", "/", "c", "\"", ");", "/", "/", "URL", "decoded", "requestURI", "fw", ".", "getFirewalledRequest", "(", "request", ")", ";", "}</s>*", "Default", "implementation", "which", "wraps", "requests", "in", "order", "to", "provide", "consistent", "values", "of", "*", "the", "{", "@", "code", "servletPath", "}", "and", "{", "@", "code", "pathInfo", "}", ",", "which", "do", "not", "contain", "path", "parameters", "(", "as", "*", "defined", "in", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "ietf", ".", "org", "/", "rfc", "/", "rfc2396", ".", "txt", "\"", ">", "RFC", "2396", "<", "/", "a", ">", ").", "Different", "*", "servlet", "containers", "interpret", "the", "servlet", "spec", "differently", "as", "to", "how", "path", "parameters", "are", "*", "treated", "and", "it", "is", "possible", "they", "might", "be", "added", "in", "order", "to", "bypass", "particular", "security", "*", "constraints", ".", "When", "using", "this", "implementation", ",", "they", "will", "be", "removed", "for", "all", "requests", "as", "*", "the", "request", "passes", "through", "the", "security", "filter", "chain", ".", "Note", "that", "this", "means", "that", "any", "*", "segments", "in", "the", "decoded", "path", "which", "contain", "a", "semi", "-", "colon", ",", "will", "have", "the", "part", "following", "*", "the", "semi", "-", "colon", "removed", "for", "request", "matching", ".", "Your", "application", "should", "not", "contain", "any", "*", "valid", "paths", "which", "contain", "semi", "-", "colons", ".", "*", "If", "any", "un", "-", "normalized", "paths", "are", "found", "(", "containing", "directory", "-", "traversal", "character", "*", "sequences", ")", ",", "the", "request", "will", "be", "rejected", "immediately", ".", "Most", "containers", "normalize", "the", "*", "paths", "before", "performing", "the", "servlet", "-", "mapping", ",", "but", "again", "this", "is", "not", "guaranteed", "by", "the", "*", "servlet", "spec", ".", "public", "FirewalledRequest", "getFirewalledRequest", "(", "HttpServletRequest", "request", ")", "throws", "RequestRejectedException", "{", "throw", "new", "RequestRejectedException", "(", "\"", "Un", "-", "normalized", "paths", "are", "not", "supported", ":", "\"", "+", "fwr", ".", "getServletPath", "(", ")", "*", "Checks", "whether", "a", "path", "is", "normalized", "(", "doesn", "'", "t", "contain", "path", "traversal", "sequences", "like", "*", "\"", "./", "\",", "\"", "/.", "./", "\"", "or", "\"", "/.", "\")", "*", "@", "param", "path", "the", "path", "to", "test", "*", "@", "return", "true", "if", "the", "path", "doesn", "'", "t", "contain", "any", "path", "-", "traversal", "character", "sequences", ".", "}", "else", "if", "(", "gap", "=", "=", "3", "&", "&", "path", ".", "charAt", "(", "i", "+", "1", ")", "=", "=", "'", ".'", "&", "&", "path", ".", "charAt", "(", "i", "+", "2", ")", "=", "=", "'", ".'", ")", "{", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "fail", ";", "public", "String", "[", "]", "unnormalizedPaths", "=", "{", "\"", "/.", ".\"", ",", "\"", "/.", "/", "path", "/", "\",", "\"", "/", "path", "/", "path", "/", ".\"", ",", "\"", "/", "path", "/", "path", "/", "/.", "\",", "\"", "./", "path", "/", "..", "/", "path", "/", "/.", "\",", "\"", "./", "path", "\"", ",", "\"", "./", "/", "path", "\"", ",", "\"", ".\"", "}", ";", "for", "(", "String", "path", ":", "unnormalizedPaths", ")", "{", "}", "catch", "(", "RequestRejectedException", "expected", ")", "{", "}", "catch", "(", "RequestRejectedException", "expected", ")", "{"], "docstring_tokens": ["the", "lack", "of", "handling", "of", "path", "parameters"]}
{"contents": ["Disallow", "access", "to", "prototype", "chain", "(", ")"], "code_tokens": ["root", "=", "true", "[", "*]", "end_of_line", "=", "lf", "insert_final_newline", "=", "true", "[", "*.", "js", "]", "charset", "=", "utf", "-", "8", "indent_style", "=", "tab", "[", "{.", "travis", ".", "yml", ",", "package", ".", "json", "}", "]", "indent_style", "=", "space", "indent_size", "=", "2", "@", "@", "-", "1", ",", "2", "+", "1", "@", "@", "\"", "parserOptions", "\"", ":", "{", "\"", "ecmaVersion", "\"", ":", "7", "}", ",", "\"", "plugins", "\"", ":", "[", "],", "\"", "globals", "\"", ":{", "\"", "Promise", "\"", ":", "true", ",", "\"", "JQLite", "\"", ":", "true", ",", "\"", "JQLitePrototype", "\"", ":", "true", ",", "\"", "ArrayBuffer", "\"", ":", "true", "}", ",", "\"", "env", "\"", ":", "{", "\"", "node", "\"", ":", "true", ",", "\"", "browser", "\"", ":", "true", ",", "\"", "mocha", "\"", ":", "true", "}", ",", "\"", "rules", "\"", ":", "{", "\"", "accessor", "-", "pairs", "\"", ":", "2", ",", "\"", "array", "-", "bracket", "-", "spacing", "\"", ":", "[", "2", ",", "\"", "never", "\"", "],", "\"", "arrow", "-", "parens", "\"", ":", "0", ",", "\"", "arrow", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "true", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "block", "-", "scoped", "-", "var", "\"", ":", "2", ",", "\"", "block", "-", "spacing", "\"", ":", "[", "2", ",", "\"", "always", "\"", "],", "\"", "brace", "-", "style", "\"", ":", "0", ",", "\"", "callback", "-", "return", "\"", ":", "2", ",", "\"", "camelcase", "\"", ":", "[", "0", ",", "{", "\"", "properties", "\"", ":", "\"", "never", "\"", "}]", ",", "\"", "comma", "-", "dangle", "\"", ":", "[", "0", ",", "\"", "always", "-", "multiline", "\"", "],", "\"", "comma", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "false", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "comma", "-", "style", "\"", ":", "[", "2", ",", "\"", "last", "\"", "],", "\"", "complexity", "\"", ":", "[", "2", ",", "10", "]", ",", "\"", "computed", "-", "property", "-", "spacing", "\"", ":", "[", "2", ",", "\"", "never", "\"", "],", "\"", "consistent", "-", "return", "\"", ":", "0", ",", "\"", "consistent", "-", "this", "\"", ":", "[", "2", ",", "\"", "self", "\"", "],", "\"", "constructor", "-", "super", "\"", ":", "2", ",", "\"", "curly", "\"", ":", "[", "2", ",", "\"", "all", "\"", "],", "\"", "default", "-", "case", "\"", ":", "0", ",", "\"", "dot", "-", "location", "\"", ":", "[", "2", ",", "\"", "property", "\"", "],", "\"", "dot", "-", "notation", "\"", ":", "2", ",", "\"", "eol", "-", "last", "\"", ":", "2", ",", "\"", "eqeqeq", "\"", ":", "[", "2", ",", "\"", "smart", "\"", "],", "\"", "func", "-", "names", "\"", ":", "0", ",", "\"", "func", "-", "style", "\"", ":", "[", "2", ",", "\"", "declaration", "\"", "],", "\"", "generator", "-", "star", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "false", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "global", "-", "require", "\"", ":", "0", ",", "\"", "guard", "-", "for", "-", "in", "\"", ":", "2", ",", "\"", "handle", "-", "callback", "-", "err", "\"", ":", "2", ",", "\"", "id", "-", "length", "\"", ":", "0", ",", "\"", "id", "-", "match", "\"", ":", "0", ",", "\"", "init", "-", "declarations", "\"", ":", "0", ",", "\"", "key", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "beforeColon", "\"", ":", "false", ",", "\"", "afterColon", "\"", ":", "true", ",", "\"", "mode", "\"", ":", "\"", "strict", "\"", "}]", ",", "\"", "linebreak", "-", "style", "\"", ":", "0", ",", "\"", "lines", "-", "around", "-", "comment", "\"", ":", "0", ",", "\"", "max", "-", "nested", "-", "callbacks", "\"", ":", "0", ",", "\"", "new", "-", "cap", "\"", ":", "[", "2", ",", "{", "\"", "newIsCapExceptions", "\"", ":", "[", "\"", "Boom", ".", "badRequest", "\"", ",", "\"", "Boom", ".", "forbidden", "\"", ",", "\"", "Boom", ".", "unauthorized", "\"", ",", "\"", "Boom", ".", "wrap", "\"", "],", "\"", "capIsNewExceptions", "\"", ":", "[", "\"", "squeeze", ".", "Squeeze", "\"", "]", "}", "],", "\"", "new", "-", "parens", "\"", ":", "2", ",", "\"", "newline", "-", "after", "-", "var", "\"", ":", "0", ",", "\"", "no", "-", "alert", "\"", ":", "2", ",", "\"", "no", "-", "array", "-", "constructor", "\"", ":", "2", ",", "\"", "no", "-", "caller", "\"", ":", "2", ",", "\"", "no", "-", "catch", "-", "shadow", "\"", ":", "0", ",", "\"", "no", "-", "class", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "console", "\"", ":", "2", ",", "\"", "no", "-", "const", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "constant", "-", "condition", "\"", ":", "[", "2", ",", "{", "\"", "checkLoops", "\"", ":", "false", "}", "],", "\"", "no", "-", "continue", "\"", ":", "0", ",", "\"", "no", "-", "control", "-", "regex", "\"", ":", "0", ",", "\"", "no", "-", "debugger", "\"", ":", "2", ",", "\"", "no", "-", "delete", "-", "var", "\"", ":", "2", ",", "\"", "no", "-", "div", "-", "regex", "\"", ":", "2", ",", "\"", "no", "-", "dupe", "-", "args", "\"", ":", "2", ",", "\"", "no", "-", "dupe", "-", "class", "-", "members", "\"", ":", "2", ",", "\"", "no", "-", "dupe", "-", "keys", "\"", ":", "2", ",", "\"", "no", "-", "duplicate", "-", "case", "\"", ":", "2", ",", "\"", "no", "-", "else", "-", "return", "\"", ":", "2", ",", "\"", "no", "-", "empty", "\"", ":", "2", ",", "\"", "no", "-", "empty", "-", "character", "-", "class", "\"", ":", "2", ",", "\"", "no", "-", "eval", "\"", ":", "2", ",", "\"", "no", "-", "ex", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "extend", "-", "native", "\"", ":", "2", ",", "\"", "no", "-", "extra", "-", "bind", "\"", ":", "2", ",", "\"", "no", "-", "extra", "-", "boolean", "-", "cast", "\"", ":", "2", ",", "\"", "no", "-", "extra", "-", "parens", "\"", ":", "[", "2", ",", "\"", "functions", "\"", "],", "\"", "no", "-", "extra", "-", "semi", "\"", ":", "2", ",", "\"", "no", "-", "fallthrough", "\"", ":", "2", ",", "\"", "no", "-", "floating", "-", "decimal", "\"", ":", "2", ",", "\"", "no", "-", "func", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "implicit", "-", "coercion", "\"", ":", "0", ",", "\"", "no", "-", "implied", "-", "eval", "\"", ":", "2", ",", "\"", "no", "-", "inline", "-", "comments", "\"", ":", "0", ",", "\"", "no", "-", "inner", "-", "declarations", "\"", ":", "2", ",", "\"", "no", "-", "invalid", "-", "regexp", "\"", ":", "2", ",", "\"", "no", "-", "irregular", "-", "whitespace", "\"", ":", "2", ",", "\"", "no", "-", "iterator", "\"", ":", "2", ",", "\"", "no", "-", "label", "-", "var", "\"", ":", "2", ",", "\"", "no", "-", "labels", "\"", ":", "0", ",", "\"", "no", "-", "lone", "-", "blocks", "\"", ":", "2", ",", "\"", "no", "-", "lonely", "-", "if", "\"", ":", "2", ",", "\"", "no", "-", "loop", "-", "func", "\"", ":", "2", ",", "\"", "no", "-", "mixed", "-", "requires", "\"", ":", "2", ",", "\"", "no", "-", "mixed", "-", "spaces", "-", "and", "-", "tabs", "\"", ":", "0", ",", "\"", "no", "-", "multi", "-", "spaces", "\"", ":", "2", ",", "\"", "no", "-", "multi", "-", "str", "\"", ":", "2", ",", "\"", "no", "-", "multiple", "-", "empty", "-", "lines", "\"", ":", "[", "2", ",", "{", "\"", "max", "\"", ":", "1", "}", "],", "\"", "no", "-", "native", "-", "reassign", "\"", ":", "2", ",", "\"", "no", "-", "negated", "-", "in", "-", "lhs", "\"", ":", "2", ",", "\"", "no", "-", "new", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "func", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "object", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "require", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "wrappers", "\"", ":", "2", ",", "\"", "no", "-", "obj", "-", "calls", "\"", ":", "2", ",", "\"", "no", "-", "octal", "\"", ":", "2", ",", "\"", "no", "-", "octal", "-", "escape", "\"", ":", "2", ",", "\"", "no", "-", "param", "-", "reassign", "\"", ":", "0", ",", "\"", "no", "-", "path", "-", "concat", "\"", ":", "2", ",", "\"", "no", "-", "process", "-", "env", "\"", ":", "2", ",", "\"", "no", "-", "process", "-", "exit", "\"", ":", "2", ",", "\"", "no", "-", "proto", "\"", ":", "2", ",", "\"", "no", "-", "redeclare", "\"", ":", "2", ",", "\"", "no", "-", "regex", "-", "spaces", "\"", ":", "2", ",", "\"", "no", "-", "restricted", "-", "modules", "\"", ":", "0", ",", "\"", "no", "-", "restricted", "-", "syntax", "\"", ":", "0", ",", "\"", "no", "-", "return", "-", "assign", "\"", ":", "0", ",", "\"", "no", "-", "script", "-", "url", "\"", ":", "2", ",", "\"", "no", "-", "self", "-", "compare", "\"", ":", "2", ",", "\"", "no", "-", "sequences", "\"", ":", "2", ",", "\"", "no", "-", "shadow", "\"", ":", "0", ",", "\"", "no", "-", "shadow", "-", "restricted", "-", "names", "\"", ":", "2", ",", "\"", "no", "-", "spaced", "-", "func", "\"", ":", "2", ",", "\"", "no", "-", "sparse", "-", "arrays", "\"", ":", "2", ",", "\"", "no", "-", "ternary", "\"", ":", "0", ",", "\"", "no", "-", "this", "-", "before", "-", "super", "\"", ":", "2", ",", "\"", "no", "-", "throw", "-", "literal", "\"", ":", "2", ",", "\"", "no", "-", "trailing", "-", "spaces", "\"", ":", "2", ",", "\"", "no", "-", "undef", "\"", ":", "2", ",", "\"", "no", "-", "undef", "-", "init", "\"", ":", "0", ",", "\"", "no", "-", "undefined", "\"", ":", "0", ",", "\"", "no", "-", "underscore", "-", "dangle", "\"", ":", "0", ",", "\"", "no", "-", "unexpected", "-", "multiline", "\"", ":", "2", ",", "\"", "no", "-", "unneeded", "-", "ternary", "\"", ":", "2", ",", "\"", "no", "-", "unreachable", "\"", ":", "2", ",", "\"", "no", "-", "unused", "-", "expressions", "\"", ":", "2", ",", "\"", "no", "-", "unused", "-", "vars", "\"", ":", "2", ",", "\"", "no", "-", "use", "-", "before", "-", "define", "\"", ":", "[", "2", ",", "\"", "nofunc", "\"", "],", "\"", "no", "-", "useless", "-", "call", "\"", ":", "2", ",", "\"", "no", "-", "useless", "-", "concat", "\"", ":", "2", ",", "\"", "no", "-", "var", "\"", ":", "0", ",", "\"", "no", "-", "void", "\"", ":", "2", ",", "\"", "no", "-", "warning", "-", "comments", "\"", ":", "[", "2", ",", "{", "\"", "terms", "\"", ":", "[", "\"", "todo", "\"", ",", "\"", "fixme", "\"", "],", "\"", "location", "\"", ":", "\"", "anywhere", "\"", "}]", ",", "\"", "no", "-", "with", "\"", ":", "2", ",", "\"", "object", "-", "curly", "-", "spacing", "\"", ":", "0", ",", "\"", "object", "-", "shorthand", "\"", ":", "0", ",", "\"", "one", "-", "var", "\"", ":", "0", ",", "\"", "operator", "-", "assignment", "\"", ":", "[", "0", ",", "\"", "always", "\"", "],", "\"", "operator", "-", "linebreak", "\"", ":", "0", ",", "\"", "padded", "-", "blocks", "\"", ":", "[", "2", ",", "\"", "never", "\"", "],", "\"", "prefer", "-", "arrow", "-", "callback", "\"", ":", "0", ",", "\"", "prefer", "-", "const", "\"", ":", "0", ",", "\"", "prefer", "-", "destructuring", "\"", ":", "[", "0", ",", "{", "\"", "AssignmentExpression", "\"", ":", "{", "\"", "array", "\"", ":", "true", ",", "\"", "object", "\"", ":", "false", "}", "}", "],", "\"", "prefer", "-", "reflect", "\"", ":", "0", ",", "\"", "prefer", "-", "spread", "\"", ":", "0", ",", "\"", "prefer", "-", "template", "\"", ":", "0", ",", "\"", "quotes", "\"", ":", "[", "2", ",", "\"", "double", "\"", ",", "{", "\"", "avoidEscape", "\"", ":", "true", "}", "],", "\"", "quote", "-", "props", "\"", ":", "[", "2", ",", "\"", "as", "-", "needed", "\"", "],", "\"", "radix", "\"", ":", "2", ",", "\"", "require", "-", "jsdoc", "\"", ":", "0", ",", "\"", "require", "-", "yield", "\"", ":", "2", ",", "\"", "semi", "\"", ":", "[", "2", ",", "\"", "always", "\"", "],", "\"", "semi", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "false", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "sort", "-", "vars", "\"", ":", "0", ",", "\"", "use", "-", "isnan", "\"", ":", "2", ",", "\"", "valid", "-", "jsdoc", "\"", ":", "0", ",", "\"", "valid", "-", "typeof", "\"", ":", "2", ",", "\"", "vars", "-", "on", "-", "top", "\"", ":", "0", ",", "\"", "wrap", "-", "iife", "\"", ":", "[", "2", ",", "\"", "inside", "\"", "],", "\"", "wrap", "-", "regex", "\"", ":", "0", ",", "\"", "yoda", "\"", ":", "[", "2", ",", "\"", "never", "\"", "]", "}", "*", "*", "A", "security", "vulnerability", "has", "been", "found", "that", "affects", "all", "versions", "before", "1", ".", "0", ".", "1", ".", "Please", "read", "this", "advisory", "https", ":", "//", "github", ".", "com", "/", "peerigon", "/", "angular", "-", "expressions", "/", "security", "/", "advisories", "/", "GHSA", "-", "hxhm", "-", "96pp", "-", "2m43", "for", "more", "information", ".", "**", "#", "angular", "-", "expressions", "#", "#", "Setup", "#", "#", "Filters", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "else", "{", "return", "input", "+", "\"", "$\"", ";", "}", "selectedCurrency", ":", "\"", "EUR", "\"", "#", "#", "API", "_NOTE_", "angular", "\\", "$", "parse", "do", "not", "export", "ast", "variable", "it", "'", "s", "done", "by", "this", "library", ".", "#", "##", "#", ".", "compile", ".", "cache", "=", "Object", ".", "create", "(", "null", ")", "-", "--", "#", "##", "evaluate", "(", "scope", "?", "):", "\\", "*", "#", "##", "evaluate", ".", "assign", "(", "scope", ",", "value", ")", ":", "\\", "*", "#", "#", "In", "the", "browser", "#", "#", "Security", "The", "code", "of", "angular", "was", "not", "secured", "from", "reading", "prototype", ",", "and", "since", "version", "1", ".", "0", ".", "1", "of", "angular", "-", "expressions", ",", "the", "module", "disallows", "reading", "properties", "that", "are", "not", "ownProperties", ".", "See", "[", "this", "blog", "post", "]", "(", "http", ":", "//", "blog", ".", "angularjs", ".", "org", "/", "2016", "/", "09", "/", "angular", "-", "16", "-", "expression", "-", "sandbox", "-", "removal", ".", "html", ")", "for", "more", "details", "about", "the", "sandbox", "that", "got", "removed", "completely", "in", "angular", "1", ".", "6", ".", "access", "to", "\\", "$", "scope", "and", "locals", ".", "However", ",", "one", "can", "obtain", "the", "ability", "to", "execute", "arbitrary", "JS", "code", "by", "#", "#", "Authorship", "#", "#", "Contributing", "#", "#", "License", "#", "#", "Sponsors", "csp", ":", "false", ",", "/", "/", "noUnsafeEval", ",", "expensiveChecks", ":", "true", ",", "literals", ":", "{", "/", "/", "defined", "at", ":", "function", "$", "ParseProvider", "(", ")", "{", "true", ":", "true", ",", "false", ":", "false", ",", "null", ":", "null", ",", "/", "*", "eslint", "no", "-", "undefined", ":", "0", "*", "/", "undefined", ":", "undefined", "/", "*", "eslint", ":", "no", "-", "undefined", ":", "1", "*", "/", "}", "/", "/", "isIdentifierStart", ":", "undefined", ",", "/", "/", "isFunction", "(", "identStart", ")", "&", "&", "identStart", ",", "/", "/", "isIdentifierContinue", ":", "undefined", "/", "/", "isFunction", "(", "identContinue", ")", "&", "&", "identContinue", "var", "parser", "=", "new", "Parser", "(", "lexer", ",", "function", "getFilter", "(", "name", ")", "{", "return", "filters", "[", "name", "]", ";", "}", ",", "parserOptions", ")", ";", "var", "cached", ";", "if", "(", "typeof", "src", "!", "==", "\"", "string", "\"", ")", "{", "throw", "new", "TypeError", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "\"", "+", "typeof", "src", "+", "\"", "'\"", ")", ";", "}", "if", "(", "!", "compile", ".", "cache", ")", "{", "return", "parser", ".", "parse", "(", "src", ")", ";", "}", "cached", "=", "compile", ".", "cache", "[", "src", "]", ";", "if", "(", "!", "cached", ")", "{", "cached", "=", "compile", ".", "cache", "[", "src", "]", "=", "parser", ".", "parse", "(", "src", ")", ";", "}", "return", "cached", ";", "compile", ".", "cache", "=", "Object", ".", "create", "(", "null", ")", ";", "\"", "test", "-", "browser", "\"", ":", "\"", "webpack", "-", "dev", "-", "server", "'", "mocha", "-", "loader", "!", "./", "test", "/", "main", ".", "test", ".", "js", "'", "-", "-", "output", "-", "filename", "output", ".", "js", "-", "-", "port", "8081", "\"", ",", "\"", "posttest", "\"", ":", "\"", "eslint", "-", "-", "fix", "lib", "test", "&", "&", "prettier", "-", "-", "write", "lib", "/", "*.", "js", "test", "/", "*.", "js", "\"", "\"", "eslint", "\"", ":", "\"", "^", "5", ".", "16", ".", "0", "\"", ",", "\"", "mocha", "\"", ":", "\"", "^", "7", ".", "0", ".", "0", "\"", ",", "\"", "mocha", "-", "loader", "\"", ":", "\"", "^", "4", ".", "0", ".", "1", "\"", ",", "\"", "prettier", "\"", ":", "\"", "^", "1", ".", "19", ".", "1", "\"", ",", "\"", "webpack", "\"", ":", "\"", "^", "4", ".", "41", ".", "5", "\"", ",", "\"", "webpack", "-", "cli", "\"", ":", "\"", "^", "3", ".", "3", ".", "10", "\"", ",", "\"", "webpack", "-", "dev", "-", "server", "\"", ":", "\"", "^", "3", ".", "10", ".", "1", "\"", "describe", "(", "\"", "expressions", "\"", ",", "function", "(", ")", "{", "describe", "(", "\".", "Lexer", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Lexer", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "lex", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "lexer", "=", "new", "expressions", ".", "Lexer", "(", ");", "expect", "(", "lexer", ".", "lex", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "Parser", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Parser", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "parse", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "parser", "=", "new", "expressions", ".", "Parser", "(", "undefined", ",", "undefined", ",", "{", "})", ";", "expect", "(", "parser", ".", "parse", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "compile", "(", "src", ")", "\",", "function", "(", ")", "{", "var", "scope", ";", "var", "evaluate", ";", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "ship", ":", "{", "pirate", ":", "{", "name", ":", "\"", "Jenny", "\"", "}", "}", "}", ";", "}", ");", "it", "(", "\"", "should", "return", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"\"", "))", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "throw", "an", "error", "if", "the", "given", "value", "is", "not", "a", "string", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", ");", "}", ").", "to", ".", "throw", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "undefined", "'", "\")", ";", "}", ");", "it", "(", "\"", "should", "expose", "the", "ast", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "tmp", "\"", ").", "ast", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "object", "\"", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "literals", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "null", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "null", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "null", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "true", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "false", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "false", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "2", ".", "34e5", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", ".", "34e5", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "2", ".", "34e5", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "'", "string", "'", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "string", "'", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "string", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ",", "1", ",", "2", ",", "[", "]]", ");", "}", ");", "it", "(", "\"", "should", "return", "{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "{", "test", ":", "\"", "value", "\"", ",", "\"", "new", "-", "object", "\"", ":", "{", "}", "}", ");", "}", ");", "it", "(", "\"", "should", "return", "context", "value", "when", "nothing", "in", "the", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "test", "\"", ");", "expect", "(", "evaluate", "(", "scope", ",", "{", "test", ":", "\"", "hello", "\"", "}", "))", ".", "to", ".", "equal", "(", "\"", "hello", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "context", "value", "when", "something", "in", "the", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "test", "\"", ");", "expect", "(", "evaluate", "(", "{", "test", ":", "\"", "bye", "\"", "}", ",", "{", "test", ":", "\"", "hello", "\"", "}", "))", ".", "to", ".", "equal", "(", "\"", "hello", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "key", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "notDefined", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "scope", "even", "when", "the", "'", "this", "'", "keyword", "is", "used", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "this", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "newValue", "=", "'", "new", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "newValue", ")", ".", "to", ".", "equal", "(", "\"", "new", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "=", "'", "ship", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ")", ".", "to", ".", "equal", "(", "\"", "ship", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "loop", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "island", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", ",", "{", "pirate", ":", "\"", "St", "\u00f6", "rtebeker", "\"", "}", "];", "}", ");", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "1", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "2", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", "];", "evaluate", "=", "compile", "(", "\"", "ships", "[", "0", "]", ".", "pirate", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ships", "[", "0", "]", ".", "pirate", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "function", "calls", "\"", ",", "function", "(", ")", "{", "describe", "(", "\"", "using", "no", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "function", "'", "s", "return", "value", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", ")", "{", "return", "scope", ".", "ship", ".", "pirate", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ".", "pirate", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "object", "where", "it", "is", "defined", "\"", ",", "function", "(", ")", "{", "scope", ".", "ship", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "ship", ".", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "using", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "parse", "the", "arguments", "accordingly", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", ")", "{", "return", "Array", ".", "prototype", ".", "slice", ".", "call", "(", "arguments", ")", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", "])", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "operators", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "+", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "+", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "-", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "-", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "0", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "*", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", "*", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "4", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "/", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "4", "/", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "%", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "3", "%", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "1", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "&", "&\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "|", "|\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "!", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"!", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"!", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "+", "+.", "Maybe", "someday", "?", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "-", "-.", "Maybe", "someday", "?", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "?", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "?", "'", "it", "works", "'", ":", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "evaluate", "=", "compile", "(", "\"", "false", "?", "false", ":", "'", "it", "works", "'", "\")", ";", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "using", "complex", "expressions", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", ",", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", "]", ";", "scope", ".", "index", "=", "0", ";", "scope", ".", "pi", "=", "\"", "pi", "\"", ";", "scope", ".", "Jenny", "=", "\"", "Jenny", "\"", ";", "}", ");", "it", "(", "\"", "should", "still", "be", "parseable", "and", "executable", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "index", "]", "[", "pi", "+", "'", "rate", "'", "](", "Jenny", ")", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "syntactical", "errors", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"'", "unterminated", "string", "\"", ");", "}", ").", "to", ".", "throw", "(", "\"", "Lexer", "Error", ":", "Unterminated", "quote", "at", "columns", "0", "-", "20", "[", "'", "unterminated", "string", "]", "in", "expression", "[", "'", "unterminated", "string", "]", ".\"", ")", ";", "}", ");", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"", "3", "=", "4", "\"", ");", "}", ").", "to", ".", "throw", "(", "'", "[$", "parse", ":", "lval", "]", "Trying", "to", "assign", "a", "value", "to", "a", "non", "l", "-", "value", "\\", "nhttp", ":", "//", "errors", ".", "angularjs", ".", "org", "/", "\"", "NG_VERSION_FULL", "\"", "/$", "parse", "/", "lval", "'", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "using", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "apply", "the", "given", "filter", "\"", ",", "function", "(", ")", "{", "expressions", ".", "filters", ".", "currency", "=", "function", "(", "input", ",", "currency", ",", "digits", ")", "{", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "return", "input", "+", "\"", "$\"", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "1", ".", "2345", "|", "currency", ":", "selectedCurrency", ":", "2", "\"", ");", "expect", "(", "evaluate", "(", "{", "selectedCurrency", ":", "\"", "EUR", "\"", "}", ")", ")", ".", "to", ".", "equal", "(", "\"", "1", ".", "23", "\u20ac", "\")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "the", "same", "expression", "multiple", "times", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "cache", "the", "generated", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "}", ");", "}", ");", "describe", "(", "\"", "for", "assigning", "values", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "};", "}", ");", "it", "(", "\"", "should", "expose", "an", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "fn", ".", "assign", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "describe", "(", "\"", "the", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "work", "for", "expressions", "ending", "with", "brackets", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", ".", "b", "[", "'", "c", "'", "]\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "for", "expressions", "with", "brackets", "in", "the", "middle", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "'", "a", "[", "\"", "b", "\"", "].", "c", "'", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "result", "of", "the", "assignment", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "'", "a", "[", "\"", "b", "\"", "].", "c", "'", ");", "expect", "(", "fn", ".", "assign", "(", "scope", ",", "123", ")", ").", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "cache", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "by", "default", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", ".", "cache", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "it", "(", "\"", "should", "cache", "the", "generated", "function", "by", "the", "expression", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "compile", ".", "cache", ".", "a", ")", ".", "to", ".", "equal", "(", "fn", ")", ";", "}", ");", "describe", "(", "\"", "when", "setting", "it", "to", "false", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "disable", "the", "cache", "\"", ",", "function", "(", ")", "{", "compile", ".", "cache", "=", "false", ";", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "not", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "compile", ".", "cache", "=", "Object", ".", "create", "(", "null", ")", ";", "}", ");", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "filters", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "prototype", "\"", ",", "function", "(", ")", "{", "var", "evaluate", ";", "it", "(", "\"", "should", "not", "leak", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "'.", "split", "\"", ");", "expect", "(", "evaluate", "(", "{}", "))", ".", "to", ".", "eql", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "not", "leak", "with", "computed", "prop", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "a", "[", "'", "split", "'", "]\"", ");", "expect", "(", "evaluate", "(", "{", "a", ":", "\"", "\"", "}", "))", ".", "to", ".", "eql", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "allow", "to", "read", "string", "length", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "abc", "'", ".", "length", "\"", ");", "expect", "(", "evaluate", "(", "{}", "))", ".", "to", ".", "eql", "(", "3", ")", ";", "}", ");", "it", "(", "\"", "should", "allow", "to", "read", "users", "length", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "users", ".", "length", "\"", ");", "expect", "(", "evaluate", "(", "{", "users", ":", "[", "1", ",", "4", ",", "4", "]", "}", "))", ".", "to", ".", "eql", "(", "3", ")", ";", "}", ");", "/", "/", "it", "(", "\"", "should", "disallow", "from", "changing", "prototype", "\"", ",", "function", "(", ")", "{", "/", "/", "evaluate", "=", "compile", "(", "\"", "name", ".", "split", "=", "10", "\"", ");", "/", "/", "var", "scope", "=", "{", "name", ":", "\"", "hello", "\"", "}", ";", "/", "/", "evaluate", "(", "scope", ")", ";", "/", "/", "expect", "(", "scope", ".", "name", ".", "split", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "/", "/", "}", ");", "/", "/", "/", "/", "it", "(", "\"", "should", "work", "with", "__proto__", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "__proto__", "\"", ");", "expect", "(", "evaluate", "(", "{}", "))", ".", "to", ".", "eql", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "with", "toString", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "toString", "\"", ");", "expect", "(", "evaluate", "(", "{", "toString", ":", "10", "}", "))", ".", "to", ".", "eql", "(", "10", ")", ";", "}", ");", "}", ");</s>lib", "/", "parse", ".", "js", "\"", "extends", "\"", ":", "\"", "peerigon", "/", "es5", "\"", ",", "\"", "root", "\"", ":", "true", ",", "\"", "env", "\"", ":", "{", "\"", "node", "\"", ":", "true", ",", "\"", "browser", "\"", ":", "true", "}", "angular", "-", "expressions", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "Setup", "Filters", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "else", "{", "return", "input", "+", "\"", "$\"", ";", "}", "selectedCurrency", ":", "\"", "EUR", "\"", "API", "*", "NOTE", "*", "angular", "$", "parse", "do", "not", "export", "ast", "variable", "it", "'", "s", "done", "by", "this", "library", ".", "#", "##", "#", ".", "compile", ".", "cache", "=", "{", "}", "#", "##", "evaluate", "(", "scope", "?", "):", "*", "#", "##", "evaluate", ".", "assign", "(", "scope", ",", "value", ")", ":", "*", "In", "the", "browser", "Security", "access", "to", "$", "scope", "and", "locals", ".", "However", ",", "one", "can", "obtain", "the", "ability", "to", "execute", "arbitrary", "JS", "code", "by", "Authorship", "Contributing", "License", "Sponsors", "csp", ":", "false", ",", "/", "/", "noUnsafeEval", ",", "expensiveChecks", ":", "true", ",", "literals", ":", "{", "/", "/", "defined", "at", ":", "function", "$", "ParseProvider", "(", ")", "{", "true", ":", "true", ",", "false", ":", "false", ",", "null", ":", "null", ",", "/", "*", "eslint", "no", "-", "undefined", ":", "0", "*", "/", "undefined", ":", "undefined", "/", "*", "eslint", ":", "no", "-", "undefined", ":", "1", "*", "/", "}", "/", "/", "isIdentifierStart", ":", "undefined", ",", "/", "/", "isFunction", "(", "identStart", ")", "&", "&", "identStart", ",", "/", "/", "isIdentifierContinue", ":", "undefined", "/", "/", "isFunction", "(", "identContinue", ")", "&", "&", "identContinue", "var", "parser", "=", "new", "Parser", "(", "lexer", ",", "function", "getFilter", "(", "name", ")", "{", "return", "filters", "[", "name", "]", ";", "}", ",", "parserOptions", ")", ";", "var", "cached", ";", "if", "(", "typeof", "src", "!", "==", "\"", "string", "\"", ")", "{", "throw", "new", "TypeError", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "\"", "+", "typeof", "src", "+", "\"", "'\"", ");", "}", "if", "(", "!", "compile", ".", "cache", ")", "{", "return", "parser", ".", "parse", "(", "src", ")", ";", "}", "cached", "=", "compile", ".", "cache", "[", "src", "]", ";", "if", "(", "!", "cached", ")", "{", "cached", "=", "compile", ".", "cache", "[", "src", "]", "=", "parser", ".", "parse", "(", "src", ")", ";", "}", "return", "cached", ";", "compile", ".", "cache", "=", "{", "};", "\"", "test", "-", "browser", "\"", ":", "\"", "webpack", "-", "dev", "-", "server", "mocha", "\\", "\\!", "./", "test", "/", "main", ".", "test", ".", "js", "-", "d", "\"", ",", "\"", "posttest", "\"", ":", "\"", "eslint", "-", "-", "fix", "lib", "test", "\"", "\"", "eslint", "\"", ":", "\"", "^", "1", ".", "5", ".", "0", "\"", ",", "\"", "eslint", "-", "config", "-", "peerigon", "\"", ":", "\"", "^", "0", ".", "1", ".", "0", "\"", ",", "\"", "mocha", "\"", ":", "\"", "^", "2", ".", "3", ".", "2", "\"", ",", "\"", "mocha", "-", "loader", "\"", ":", "\"", "^", "0", ".", "7", ".", "1", "\"", ",", "\"", "webpack", "-", "dev", "-", "server", "\"", ":", "\"", "^", "1", ".", "11", ".", "0", "\"", "{", "\"", "extends", "\"", ":", "\"", "peerigon", "/", "es5tests", "\"", "}", "@", "@", "-", "9", ",", "466", "+", "9", ",", "473", "@", "@", "chai", ".", "config", ".", "includeStack", "=", "true", ";", "describe", "(", "\"", "expressions", "\"", ",", "function", "(", ")", "{", "describe", "(", "\".", "Lexer", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Lexer", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "lex", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "lexer", "=", "new", "expressions", ".", "Lexer", "(", ");", "expect", "(", "lexer", ".", "lex", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "Parser", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Parser", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "parse", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "parser", "=", "new", "expressions", ".", "Parser", "(", "undefined", ",", "undefined", ",", "{", "})", ";", "expect", "(", "parser", ".", "parse", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "compile", "(", "src", ")", "\",", "function", "(", ")", "{", "var", "scope", ";", "var", "evaluate", ";", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "ship", ":", "{", "pirate", ":", "{", "name", ":", "\"", "Jenny", "\"", "}", "}", "}", ";", "}", ");", "it", "(", "\"", "should", "return", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"\"", "))", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "throw", "an", "error", "if", "the", "given", "value", "is", "not", "a", "string", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", ");", "}", ").", "to", ".", "throw", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "undefined", "'", "\")", ";", "}", ");", "it", "(", "\"", "should", "expose", "the", "ast", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "tmp", "\"", ").", "ast", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "object", "\"", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "literals", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "null", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "null", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "null", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "true", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "false", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "false", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "2", ".", "34e5", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", ".", "34e5", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "2", ".", "34e5", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "'", "string", "'", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "string", "'", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "string", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ",", "1", ",", "2", ",", "[", "]]", ");", "}", ");", "it", "(", "\"", "should", "return", "{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "{", "test", ":", "\"", "value", "\"", ",", "\"", "new", "-", "object", "\"", ":", "{", "}", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "key", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "notDefined", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "scope", "even", "when", "the", "'", "this", "'", "keyword", "is", "used", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "this", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "newValue", "=", "'", "new", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "newValue", ")", ".", "to", ".", "equal", "(", "\"", "new", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "=", "'", "ship", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ")", ".", "to", ".", "equal", "(", "\"", "ship", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "loop", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "island", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", ",", "{", "pirate", ":", "\"", "St", "\u00f6", "rtebeker", "\"", "}", "]", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "1", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "2", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", "]", ";", "evaluate", "=", "compile", "(", "\"", "ships", "[", "0", "]", ".", "pirate", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ships", "[", "0", "]", ".", "pirate", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "function", "calls", "\"", ",", "function", "(", ")", "{", "describe", "(", "\"", "using", "no", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "function", "'", "s", "return", "value", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", ")", "{", "return", "scope", ".", "ship", ".", "pirate", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ".", "pirate", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "object", "where", "it", "is", "defined", "\"", ",", "function", "(", ")", "{", "scope", ".", "ship", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "ship", ".", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "using", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "parse", "the", "arguments", "accordingly", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", "pirate", ")", "{", "return", "Array", ".", "prototype", ".", "slice", ".", "call", "(", "arguments", ")", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", "])", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "operators", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "+", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "+", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "-", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "-", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "0", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "*", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", "*", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "4", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "/", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "4", "/", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "%", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "3", "%", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "1", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "&", "&\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "|", "|\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "!", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"!", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"!", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "+", "+.", "Maybe", "someday", "?", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "-", "-.", "Maybe", "someday", "?", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "?", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "?", "'", "it", "works", "'", ":", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "evaluate", "=", "compile", "(", "\"", "false", "?", "false", ":", "'", "it", "works", "'", "\")", ";", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "using", "complex", "expressions", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", ",", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", "]", ";", "scope", ".", "index", "=", "0", ";", "scope", ".", "pi", "=", "\"", "pi", "\"", ";", "scope", ".", "Jenny", "=", "\"", "Jenny", "\"", ";", "}", ");", "it", "(", "\"", "should", "still", "be", "parseable", "and", "executable", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "index", "]", "[", "pi", "+", "'", "rate", "'", "](", "Jenny", ")", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "syntactical", "errors", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"'", "unterminated", "string", "\"", ");", "}", ").", "to", ".", "throw", "(", "\"", "Lexer", "Error", ":", "Unterminated", "quote", "at", "columns", "0", "-", "20", "[", "'", "unterminated", "string", "]", "in", "expression", "[", "'", "unterminated", "string", "]", ".\"", ");", "}", ");", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"", "3", "=", "4", "\"", ");", "}", ").", "to", ".", "throw", "(", "\"[", "$", "parse", ":", "lval", "]", "Trying", "to", "assign", "a", "value", "to", "a", "non", "l", "-", "value", "\\", "nhttp", ":", "//", "errors", ".", "angularjs", ".", "org", "/", "\\\"", "NG_VERSION_FULL", "\\", "\"/", "$", "parse", "/", "lval", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "using", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "apply", "the", "given", "filter", "\"", ",", "function", "(", ")", "{", "expressions", ".", "filters", ".", "currency", "=", "function", "(", "input", ",", "currency", ",", "digits", ")", "{", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "return", "input", "+", "\"", "$\"", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "1", ".", "2345", "|", "currency", ":", "selectedCurrency", ":", "2", "\"", ");", "expect", "(", "evaluate", "(", "{", "selectedCurrency", ":", "\"", "EUR", "\"", "}", "))", ".", "to", ".", "equal", "(", "\"", "1", ".", "23", "\u20ac", "\")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "the", "same", "expression", "multiple", "times", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "cache", "the", "generated", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "}", ");", "}", ");", "describe", "(", "\"", "for", "assigning", "values", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "};", "}", ");", "it", "(", "\"", "should", "expose", "an", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "fn", ".", "assign", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "describe", "(", "\"", "the", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "work", "for", "expressions", "ending", "with", "brackets", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", ".", "b", "[", "'", "c", "'", "]\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "for", "expressions", "with", "brackets", "in", "the", "middle", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "[", "\\\"", "b", "\\", "\"]", ".", "c", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "for", "expressions", "with", "brackets", "in", "the", "middle", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "[", "\\\"", "b", "\\", "\"]", ".", "c", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "result", "of", "the", "assignment", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "[", "\\\"", "b", "\\", "\"]", ".", "c", "\"", ");", "expect", "(", "fn", ".", "assign", "(", "scope", ",", "123", ")", ").", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "cache", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "by", "default", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", ".", "cache", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "it", "(", "\"", "should", "cache", "the", "generated", "function", "by", "the", "expression", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "compile", ".", "cache", ".", "a", ")", ".", "to", ".", "equal", "(", "fn", ")", ";", "}", ");", "describe", "(", "\"", "when", "setting", "it", "to", "false", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "disable", "the", "cache", "\"", ",", "function", "(", ")", "{", "compile", ".", "cache", "=", "false", ";", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "not", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "compile", ".", "cache", "=", "{", "};", "}", ");", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "filters", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "}", ");"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["econet:", "fix", "Don't", "declare", "variable", "sized", "array", "of", "iovecs", "on", "the", "stack", "since", "this", "could", "cause", "stack", "overflow", "if", "msg->msgiovlen", "is", "large.", "Instead,", "coalesce", "the", "user-supplied", "data", "into", "a", "new", "buffer", "and", "use", "a", "single", "iovec", "for", "it.", "Signed-off-by:", "Phil", "Blundell", "<philb@gnu.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["#", "include", "<", "linux", "/", "vmalloc", ".", "h", ">", "struct", "iovec", "iov", "[", "2", "]", ";", "char", "*", "userbuf", ";", "if", "(", "len", "+", "15", ">", "dev", "-", ">", "mtu", ")", "{", "mutex_unlock", "(", "&", "econet_mutex", ")", ";", "return", "-", "EMSGSIZE", ";", "}", "if", "(", "len", ">", "32768", ")", "{", "err", "=", "-", "E2BIG", ";", "goto", "error", ";", "}", "userbuf", "=", "vmalloc", "(", "len", ")", ";", "if", "(", "userbuf", "=", "=", "NULL", ")", "{", "err", "=", "-", "ENOMEM", ";", "goto", "error", ";", "iov", "[", "1", "]", ".", "iov_base", "=", "userbuf", ";", "iov", "[", "1", "]", ".", "iov_len", "=", "len", ";", "err", "=", "memcpy_fromiovec", "(", "userbuf", ",", "msg", "-", ">", "msg_iov", ",", "len", ")", ";", "if", "(", "err", ")", "goto", "error_free_buf", ";", "&", "err", ")", ")", "=", "=", "NULL", ")", "goto", "error_free_buf", ";", "udpmsg", ".", "msg_iovlen", "=", "2", ";", "error_free_buf", ":", "vfree", "(", "userbuf", ")", ";", "error", ":</s>struct", "iovec", "iov", "[", "msg", "-", ">", "msg_iovlen", "+", "1", "]", ";", "int", "i", ";", "if", "(", "len", "+", "15", ">", "dev", "-", ">", "mtu", ")", "{", "mutex_unlock", "(", "&", "econet_mutex", ")", ";", "return", "-", "EMSGSIZE", ";", "}", "/", "*", "*", "XXX", ":", "that", "is", "b0rken", ".", "We", "can", "'", "t", "mix", "userland", "and", "kernel", "pointers", "*", "in", "iovec", ",", "since", "on", "a", "lot", "of", "platforms", "copy_from_user", "(", ")", "will", "*", "*", "not", "*", "work", "with", "the", "kernel", "and", "userland", "ones", "at", "the", "same", "time", ",", "*", "regardless", "of", "what", "we", "do", "with", "set_fs", "(", ").", "And", "we", "are", "talking", "about", "*", "econet", "-", "over", "-", "ethernet", "here", ",", "so", "\"", "it", "'", "s", "only", "ARM", "anyway", "\"", "doesn", "'", "t", "*", "apply", ".", "Any", "suggestions", "on", "fixing", "that", "code", "?", "-", "-", "AV", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "msg", "-", ">", "msg_iovlen", ";", "i", "+", "+)", "{", "void", "__user", "*", "base", "=", "msg", "-", ">", "msg_iov", "[", "i", "]", ".", "iov_base", ";", "size_t", "iov_len", "=", "msg", "-", ">", "msg_iov", "[", "i", "]", ".", "iov_len", ";", "/", "*", "Check", "it", "now", "since", "we", "switch", "to", "KERNEL_DS", "later", ".", "*", "/", "if", "(", "!", "access_ok", "(", "VERIFY_READ", ",", "base", ",", "iov_len", ")", ")", "{", "mutex_unlock", "(", "&", "econet_mutex", ")", ";", "return", "-", "EFAULT", ";", "}", "iov", "[", "i", "+", "1", "]", ".", "iov_base", "=", "base", ";", "iov", "[", "i", "+", "1", "]", ".", "iov_len", "=", "iov_len", ";", "size", "+", "=", "iov_len", ";", "&", "err", ")", ")", "=", "=", "NULL", ")", "{", "mutex_unlock", "(", "&", "econet_mutex", ")", ";", "return", "err", ";", "}", "udpmsg", ".", "msg_iovlen", "=", "msg", "-", ">", "msg_iovlen", "+", "1", ";"], "docstring_tokens": ["does", "not", "initialize", "certain", "structures"]}
{"contents": ["Close", "#306.", "Close", "#359"], "code_tokens": ["*", "@", "param", "immune", "Additional", "characters", "not", "to", "encode", ".", "Note", "this", "could", "*", "break", "URL", "encoding", "as", "referenced", "in", "RFC", "3986", ".", "You", "should", "*", "especially", "be", "wary", "of", "including", "'", "%'", "in", "this", "list", "of", "immune", "*", "characters", "since", "it", "is", "used", "as", "the", "\"", "escape", "\"", "character", "for", "*", "the", "hex", "encoding", "and", "including", "it", "may", "result", "in", "subsequent", "*", "and", "/", "or", "dangerous", "results", "when", "decoding", ".", "/", "/", "check", "for", "user", "specified", "immune", "characters", "if", "(", "immune", "!", "=", "null", "&", "&", "containsCharacter", "(", "c", ".", "charValue", "(", "),", "immune", ")", ")", "return", "cStr", ";", "/", "/", "check", "for", "standard", "characters", "(", "e", ".", "g", ".", ",", "alphanumeric", ",", "etc", ".", ")", "package", "org", ".", "owasp", ".", "esapi", ".", "codecs", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameters", ";", "import", "org", ".", "owasp", ".", "esapi", ".", "EncoderConstants", ";", "import", "org", ".", "owasp", ".", "esapi", ".", "StringUtilities", ";", "import", "org", ".", "owasp", ".", "esapi", ".", "codecs", ".", "*;", "/", "**", "*", "Parameterized", "test", "to", "verify", "that", "the", "Immunity", "parameter", "for", "a", "codec", "*", "encode", "/", "decode", "event", "works", "as", "expected", "on", "a", "series", "of", "special", "characters", ".", "*", "*", "@", "author", "jeremiah", ".", "j", ".", "stacey", "@", "gmail", ".", "com", "*", "@", "since", "2", ".", "1", ".", "0", ".", "1", "*", "*", "/", "@", "RunWith", "(", "Parameterized", ".", "class", ")", "public", "class", "CodecImmunityTest", "{", "/", "**", "character", "arrays", "used", "as", "immunity", "lists", "from", "Default", "Encoder", ".", "*/", "private", "final", "static", "char", "[", "]", "IMMUNE_HTML", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "-'", ",", "'", "_", "'", ",", "'", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_HTMLATTR", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "-'", ",", "'", "_", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_CSS", "=", "{", "};", "private", "final", "static", "char", "[", "]", "IMMUNE_JAVASCRIPT", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "_", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_VBSCRIPT", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "_", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_XML", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "-'", ",", "'", "_", "'", ",", "'", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_SQL", "=", "{", "'", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_OS", "=", "{", "'", "-'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_XMLATTR", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "-'", ",", "'", "_", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_XPATH", "=", "{", "'", ",'", ",", "'", ".'", ",", "'", "-'", ",", "'", "_", "'", ",", "'", "'", "}", ";", "private", "final", "static", "char", "[", "]", "IMMUNE_PERCENT", "=", "{", "'", "%'", "}", ";", "/", "/", "These", "are", "inline", "in", "the", "encode", "methods", ",", "but", "same", "principle", ".", "/", "/", "private", "final", "static", "char", "[", "]", "IMMUNE_LDAP", "=", "{", "'", "\\\\", "',", "'", "*'", ",", "'", "('", ",", "'", ")'", ",", "'", "\\", "0", "'", "}", ";", "/", "/", "private", "final", "static", "char", "[", "]", "IMMUNE_DN", "=", "{", "'", "\\\\", "',", "'", ",'", ",", "'", "+'", ",", "'", "\"'", ",", "'", "<'", ",", "'", ">'", ",", "'", ";'", "}", ";", "@", "Parameters", "(", "name", "=", "\"", "{", "0", "}", "\")", "public", "static", "Collection", "<", "Object", "[", "]>", "getParams", "(", ")", "{", "Collection", "<", "Codec", ">", "knownCodecs", "=", "new", "ArrayList", "<", "Codec", ">", "()", ";", "knownCodecs", ".", "add", "(", "new", "CSSCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "DB2Codec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "HTMLEntityCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "JavaScriptCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "MySQLCodec", "(", "0", ")", ");", "/", "/", "Standard", "knownCodecs", ".", "add", "(", "new", "MySQLCodec", "(", "1", ")", ");", "/", "/", "ANSI", "knownCodecs", ".", "add", "(", "new", "OracleCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "PercentCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "UnixCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "VBScriptCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "WindowsCodec", "(", "))", ";", "knownCodecs", ".", "add", "(", "new", "XMLEntityCodec", "(", "))", ";", "/", "/", "TODO", ":", "Add", "more", "strings", "here", "!", "!", "List", "<", "String", ">", "sampleStrings", "=", "Arrays", ".", "asList", "(", "\"%", "De", "\"", ");", "Collection", "<", "Object", "[", "]>", "params", "=", "new", "ArrayList", "<", "Object", "[", "]>", "()", ";", "for", "(", "Codec", "codec", ":", "knownCodecs", ")", "{", "for", "(", "String", "sample", ":", "sampleStrings", ")", "{", "params", ".", "add", "(", "new", "Object", "[", "]{", "codec", ".", "getClass", "(", ").", "getSimpleName", "(", ")", "+", "\"", "\"", "+", "sample", ",", "codec", ",", "sample", "}", ");", "}", "}", "/", "/", "Add", "Tests", "for", "codecs", "against", "the", "configured", "ImmunityLists", "within", "the", "Default", "Encoder", ".", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "HTMLEntityCodec", "(", "),", "IMMUNE_HTML", ",", "\"", "IMMUNE_HTML", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "HTMLEntityCodec", "(", "),", "IMMUNE_XPATH", ",", "\"", "IMMUNE_XPATH", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "HTMLEntityCodec", "(", "),", "IMMUNE_HTMLATTR", ",", "\"", "IMMUNE_HTMLATTR", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "CSSCodec", "(", "),", "IMMUNE_CSS", ",", "\"", "IMMUNE_CSS", "\"", "))", ";", "/", "/", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "DB2Codec", "(", "),", "IMMUNE_HTML", ",", "\"", "\")", ");", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "JavaScriptCodec", "(", "),", "IMMUNE_JAVASCRIPT", ",", "\"", "IMMUNE_JAVASCRIPT", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "MySQLCodec", "(", "0", ")", ",", "IMMUNE_SQL", ",", "\"", "IMMUNE_SQL", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "MySQLCodec", "(", "1", ")", ",", "IMMUNE_SQL", ",", "\"", "IMMUNE_SQL", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "OracleCodec", "(", "),", "IMMUNE_HTML", ",", "\"", "IMMUNE_HTML", "\"", "))", ";", "/", "/", "No", "standard", "Immunity", "char", "array", "defined", "for", "PercentEncoder", ",", "but", "for", "/", "/", "GitHub", "issues", "#", "306", "and", "$", "350", ",", "we", "use", "'", "%'", ".", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "PercentCodec", "(", "),", "IMMUNE_PERCENT", ",", "\"", "IMMUNE_PERCENT", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "UnixCodec", "(", "),", "IMMUNE_OS", ",", "\"", "IMMUNE_OS", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "VBScriptCodec", "(", "),", "IMMUNE_VBSCRIPT", ",", "\"", "IMMUNE_VBSCRIPT", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "WindowsCodec", "(", "),", "IMMUNE_OS", ",", "\"", "IMMUNE_OS", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "XMLEntityCodec", "(", "),", "IMMUNE_XML", ",", "\"", "IMMUNE_XML", "\"", "))", ";", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "new", "XMLEntityCodec", "(", "),", "IMMUNE_XMLATTR", ",", "\"", "IMMUNE_XMLATTR", "\"", "))", ";", "params", ".", "addAll", "(", "fullCharacterCodecValidation", "(", "knownCodecs", ")", ");", "return", "params", ";", "}", "private", "static", "Collection", "<", "Object", "[", "]>", "buildImmunitiyValidation", "(", "Codec", "codec", ",", "char", "[", "]", "immunities", ",", "String", "descriptor", ")", "{", "Collection", "<", "Object", "[", "]>", "params", "=", "new", "ArrayList", "<", "Object", "[", "]>", "()", ";", "for", "(", "char", "c", ":", "immunities", ")", "{", "params", ".", "add", "(", "new", "Object", "[", "]{", "codec", ".", "getClass", "(", ").", "getSimpleName", "(", ")", "+", "\"", "\"", "+", "descriptor", "+", "\"", "(", "\"+", "c", "+", "\"", ")\"", ",", "codec", ",", "String", ".", "valueOf", "(", "c", ")", "})", ";", "}", "return", "params", ";", "}", "private", "static", "Collection", "<", "Object", "[", "]>", "fullCharacterCodecValidation", "(", "Collection", "<", "Codec", ">", "codecs", ")", "{", "char", "[", "]", "holyCowTesting", "=", "StringUtilities", ".", "union", "(", "EncoderConstants", ".", "CHAR_ALPHANUMERICS", ",", "EncoderConstants", ".", "CHAR_SPECIALS", ")", ";", "Collection", "<", "Object", "[", "]>", "params", "=", "new", "ArrayList", "<", "Object", "[", "]>", "()", ";", "for", "(", "Codec", "codec", ":", "codecs", ")", "{", "params", ".", "addAll", "(", "buildImmunitiyValidation", "(", "codec", ",", "holyCowTesting", ",", "\"", "Full_ALPHA_AND_SPECIALS", "\"", "))", ";", "}", "return", "params", ";", "}", "private", "final", "Codec", "codec", ";", "private", "final", "String", "string", ";", "private", "final", "char", "[", "]", "immunityList", ";", "public", "CodecImmunityTest", "(", "String", "ignored", ",", "Codec", "codec", ",", "String", "toTest", ")", "{", "this", ".", "codec", "=", "codec", ";", "this", ".", "string", "=", "toTest", ";", "/", "**", "*", "The", "Immunity", "character", "array", "is", "every", "character", "in", "the", "String", "we", "'", "re", "testing", ".", "*", "*", "/", "this", ".", "immunityList", "=", "toTest", ".", "toCharArray", "(", ");", "}", "@", "Test", "public", "void", "testImmuneEncode", "(", ")", "{", "String", "encoded", "=", "codec", ".", "encode", "(", "immunityList", ",", "string", ")", ";", "Assert", ".", "assertEquals", "(", "string", ",", "encoded", ")", ";", "}", "/", "*", "@", "Test", "public", "void", "testImmuneDecode", "(", ")", "{", "String", "decoded", "=", "codec", ".", "decode", "(", "string", ")", ";", "Assert", ".", "assertEquals", "(", "string", ",", "decoded", ")", ";", "}", "*", "/", "}</s>*", "@", "param", "immune", "characters", "not", "to", "encode"], "docstring_tokens": ["the", "failure", "to", "properly", "resist", "tampering", "with", "serialized", "ciphertext"]}
{"contents": ["Complete", "the", "fix", "of", "bug", "#70172", "for", "PHP", "7"], "code_tokens": ["object", "(", "obj2", ")", "#%", "d", "(", "1", ")", "{", "}", "@", "@", "-", "1036", ",", "6", "+", "1036", ",", "7", "@", "@", "PHP_FUNCTION", "(", "unserialize", ")", "zval", "*", "retval", ";", "retval", "=", "var_tmp_var", "(", "&", "var_hash", ")", ";", "if", "(", "!", "php_var_unserialize_ex", "(", "retval", ",", "&", "p", ",", "p", "+", "buf_len", ",", "&", "var_hash", ",", "class_hash", ")", ")", "{", "ZVAL_COPY", "(", "return_value", ",", "retval", ")", ";</s>-", "-", "TEST", "XFAIL", "Unfinished", "merge", ",", "needs", "fix", ".", "-", "-", "FILE", "&", "object", "(", "obj2", ")", "#%", "d", "(", "1", ")", "{", "}", "if", "(", "!", "php_var_unserialize_ex", "(", "return_value", ",", "&", "p", ",", "p", "+", "buf_len", ",", "&", "var_hash", ",", "class_hash", ")", ")", "{", "zval_ptr_dtor", "(", "return_value", ")", ";", "/", "*", "We", "should", "keep", "an", "reference", "to", "return_value", "to", "prevent", "it", "from", "being", "dtor", "in", "case", "nesting", "calls", "to", "unserialize", "*", "/", "var_push_dtor", "(", "&", "var_hash", ",", "return_value", ")", ";"], "docstring_tokens": ["empty", "boolean", "element"]}
{"contents": ["[SECURITY-997]"], "code_tokens": ["import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "@", "RequirePOST", "public", "HttpResponse", "doStopTracking", "(", "@", "QueryParameter", "int", "id", ",", "StaplerResponse", "rsp", ")", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "return", "HttpResponses", ".", "redirectViaContextPath", "(", "getUrl", "(", "))", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "MockAuthorizationStrategy", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "997", "\"", ")", "public", "void", "security997", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "MockAuthorizationStrategy", "mas", "=", "new", "MockAuthorizationStrategy", "(", ");", "mas", ".", "grant", "(", "Jenkins", ".", "READ", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "user", "\"", ");", "mas", ".", "grant", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "admin", "\"", ");", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "mas", ")", ";", "String", "disposerUrl", "=", "j", ".", "getURL", "(", ")", "+", "disposer", ".", "getUrl", "(", ");", "URL", "actionUrl", "=", "new", "URL", "(", "disposerUrl", "+", "\"", "/", "stopTracking", "/", "?", "id", "=", "42", "\"", ");", "JenkinsRule", ".", "WebClient", "uwc", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "user", "\"", ",", "\"", "user", "\"", ");", "try", "{", "uwc", ".", "getPage", "(", "disposerUrl", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "ex", ")", "{", "assertEquals", "(", "HttpServletResponse", ".", "SC_FORBIDDEN", ",", "ex", ".", "getResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "try", "{", "uwc", ".", "getPage", "(", "new", "WebRequest", "(", "actionUrl", ",", "HttpMethod", ".", "POST", ")", ");", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "ex", ")", "{", "assertEquals", "(", "HttpServletResponse", ".", "SC_FORBIDDEN", ",", "ex", ".", "getResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "try", "{", "uwc", ".", "getPage", "(", "actionUrl", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "ex", ")", "{", "assertEquals", "(", "HttpServletResponse", ".", "SC_METHOD_NOT_ALLOWED", ",", "ex", ".", "getResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "JenkinsRule", ".", "WebClient", "awc", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "admin", "\"", ",", "\"", "admin", "\"", ");", "awc", ".", "getPage", "(", "disposerUrl", ")", ";", "awc", ".", "getPage", "(", "new", "WebRequest", "(", "actionUrl", ",", "HttpMethod", ".", "POST", ")", ");", "try", "{", "uwc", ".", "getPage", "(", "actionUrl", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "ex", ")", "{", "assertEquals", "(", "HttpServletResponse", ".", "SC_METHOD_NOT_ALLOWED", ",", "ex", ".", "getResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "}</s><", "jenkins", "-", "test", "-", "harness", ".", "version", ">", "2", ".", "1", "<", "/", "jenkins", "-", "test", "-", "harness", ".", "version", ">", "public", "HttpResponses", ".", "HttpResponseException", "doStopTracking", "(", "@", "QueryParameter", "int", "id", ")", "{", "return", "HttpResponses", ".", "forwardToPreviousPage", "(", ");"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["mm_for_maps:", "simplify,", "use", "ptrace_may_access()", "It", "would", "be", "nice", "to", "kill", "__ptrace_may_access().", "It", "requires", "task_lock(),", "but", "this", "lock", "is", "only", "needed", "to", "read", "mm->flags", "in", "the", "middle.", "Convert", "mm_for_maps()", "to", "use", "ptrace_may_access(),", "this", "also", "simplifies", "the", "code", "a", "little", "bit.", "Also,", "we", "do", "not", "need", "to", "take", "->mmap_sem", "in", "advance.", "In", "fact", "I", "think", "mm_for_maps()", "should", "not", "play", "with", "->mmap_sem", "at", "all,", "the", "caller", "should", "take", "this", "lock.", "With", "or", "without", "this", "patch,", "without", "->cred_guard_mutex", "held", "we", "can", "race", "with", "exec()", "and", "get", "the", "new", "->mm", "but", "check", "old", "creds.", "Signed-off-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Reviewed-by:", "Serge", "Hallyn", "<serue@us.ibm.com>", "Signed-off-by:", "James", "Morris", "<jmorris@namei.org>"], "code_tokens": ["if", "(", "mm", "!", "=", "current", "-", ">", "mm", ")", "{", "/", "*", "*", "task", "-", ">", "mm", "can", "be", "changed", "before", "security", "check", ",", "*", "in", "that", "case", "we", "must", "notice", "the", "change", "after", ".", "*", "/", "if", "(", "!", "ptrace_may_access", "(", "task", ",", "PTRACE_MODE_READ", ")", "|", "|", "mm", "!", "=", "task", "-", ">", "mm", ")", "{", "mmput", "(", "mm", ")", ";", "return", "NULL", ";", "}", "}</s>task_lock", "(", "task", ")", ";", "if", "(", "task", "-", ">", "mm", "!", "=", "mm", ")", "goto", "out", ";", "if", "(", "task", "-", ">", "mm", "!", "=", "current", "-", ">", "mm", "&", "&", "__ptrace_may_access", "(", "task", ",", "PTRACE_MODE_READ", ")", "<", "0", ")", "goto", "out", ";", "task_unlock", "(", "task", ")", ";", "out", ":", "task_unlock", "(", "task", ")", ";", "up_read", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "mmput", "(", "mm", ")", ";", "return", "NULL", ";"], "docstring_tokens": ["it", "\"allows", "access", "to", "information", "or", "capabilities"]}
{"contents": ["Some", "improvements", "to", "the", "Spring", "plugins"], "code_tokens": ["if", "(", "session", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "throw", "new", "BadCredentialsException", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "}", "String", "savedContext", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "FederationAuthenticationEntryPoint", ".", "SAVED_CONTEXT", ")", ";", "String", "state", "=", "getState", "(", "request", ")", ";", "if", "(", "savedContext", "=", "=", "null", "|", "|", "!", "savedContext", ".", "equals", "(", "state", ")", ")", "{", "logger", ".", "warn", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "throw", "new", "BadCredentialsException", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "session", ".", "removeAttribute", "(", "FederationAuthenticationEntryPoint", ".", "SAVED_CONTEXT", ")", ";", "if", "(", "session", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "throw", "new", "BadCredentialsException", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "}", "String", "savedContext", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "FederationAuthenticationEntryPoint", ".", "SAVED_CONTEXT", ")", ";", "String", "state", "=", "getState", "(", "request", ")", ";", "if", "(", "savedContext", "=", "=", "null", "|", "|", "!", "savedContext", ".", "equals", "(", "state", ")", ")", "{", "logger", ".", "warn", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "throw", "new", "BadCredentialsException", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "session", ".", "removeAttribute", "(", "FederationAuthenticationEntryPoint", ".", "SAVED_CONTEXT", ")", ";", "@", "Override", "@", "org", ".", "junit", ".", "Test", "public", "void", "testCSRFAttack2", "(", ")", "throws", "Exception", "{", "String", "url", "=", "\"", "https", ":", "//", "localhost", ":", "\"", "+", "getRpHttpsPort", "(", ")", "+", "\"", "/\"", "+", "getServletContextName", "(", ")", "+", "\"", "/", "j_spring_fediz_security_check", "\"", ";", "csrfAttackTest2", "(", "url", ")", ";", "}", "+", "\"", "/", "j_spring_fediz_security_check", "\"", ";", "@", "Override", "@", "org", ".", "junit", ".", "Test", "public", "void", "testCSRFAttack2", "(", ")", "throws", "Exception", "{", "String", "url", "=", "\"", "https", ":", "//", "localhost", ":", "\"", "+", "getRpHttpsPort", "(", ")", "+", "\"", "/\"", "+", "getServletContextName", "(", ")", "+", "\"", "/", "j_spring_fediz_security_check", "\"", ";", "csrfAttackTest2", "(", "url", ")", ";", "}", "@", "org", ".", "junit", ".", "Test", "public", "void", "testCSRFAttack2", "(", ")", "throws", "Exception", "{", "String", "url", "=", "\"", "https", ":", "//", "localhost", ":", "\"", "+", "getRpHttpsPort", "(", ")", "+", "\"", "/\"", "+", "getServletContextName", "(", ")", "+", "\"", "/", "secure", "/", "fedservlet", "\"", ";", "csrfAttackTest2", "(", "url", ")", ";", "}", "protected", "void", "csrfAttackTest2", "(", "String", "rpURL", ")", "throws", "Exception", "{", "String", "url", "=", "\"", "https", ":", "//", "localhost", ":", "\"", "+", "getRpHttpsPort", "(", ")", "+", "\"", "/\"", "+", "getServletContextName", "(", ")", "+", "\"", "/", "secure", "/", "fedservlet", "\"", ";", "/", "/", "1", ".", "Log", "in", "as", "\"", "bob", "\"", "using", "another", "WebClient", "WebClient", "webClient2", "=", "new", "WebClient", "(", ");", "webClient2", ".", "getOptions", "(", ").", "setUseInsecureSSL", "(", "true", ")", ";", "webClient2", ".", "getCredentialsProvider", "(", ").", "setCredentials", "(", "new", "AuthScope", "(", "\"", "localhost", "\"", ",", "Integer", ".", "parseInt", "(", "getIdpHttpsPort", "(", "))", "),", "new", "UsernamePasswordCredentials", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", "))", ";", "webClient2", ".", "getOptions", "(", ").", "setJavaScriptEnabled", "(", "false", ")", ";", "final", "HtmlPage", "idpPage2", "=", "webClient2", ".", "getPage", "(", "url", ")", ";", "webClient2", ".", "getOptions", "(", ").", "setJavaScriptEnabled", "(", "true", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "IDP", "SignIn", "Response", "Form", "\"", ",", "idpPage2", ".", "getTitleText", "(", "))", ";", "/", "/", "2", ".", "Now", "instead", "of", "clicking", "on", "the", "form", ",", "send", "the", "form", "via", "alice", "'", "s", "WebClient", "instead", "/", "/", "Send", "with", "context", ".", "..", "WebRequest", "request", "=", "new", "WebRequest", "(", "new", "URL", "(", "rpURL", ")", ",", "HttpMethod", ".", "POST", ")", ";", "request", ".", "setRequestParameters", "(", "new", "ArrayList", "<", "NameValuePair", ">", "()", ");", "DomNodeList", "<", "DomElement", ">", "results", "=", "idpPage2", ".", "getElementsByTagName", "(", "\"", "input", "\"", ");", "for", "(", "DomElement", "result", ":", "results", ")", "{", "if", "(", "\"", "wresult", "\"", ".", "equals", "(", "result", ".", "getAttributeNS", "(", "null", ",", "\"", "name", "\"", "))", "|", "|", "\"", "wa", "\"", ".", "equals", "(", "result", ".", "getAttributeNS", "(", "null", ",", "\"", "name", "\"", "))", "|", "|", "\"", "wctx", "\"", ".", "equals", "(", "result", ".", "getAttributeNS", "(", "null", ",", "\"", "name", "\"", "))", ")", "{", "String", "value", "=", "result", ".", "getAttributeNS", "(", "null", ",", "\"", "value", "\"", ");", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "result", ".", "getAttributeNS", "(", "null", ",", "\"", "name", "\"", "),", "value", ")", ");", "}", "}", "WebClient", "webClient", "=", "new", "WebClient", "(", ");", "webClient", ".", "getOptions", "(", ").", "setUseInsecureSSL", "(", "true", ")", ";", "try", "{", "webClient", ".", "getPage", "(", "request", ")", ";", "Assert", ".", "fail", "(", "\"", "Failure", "expected", "on", "a", "CSRF", "attack", "\"", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "ex", ")", "{", "/", "/", "expected", "}", "webClient", ".", "close", "(", ");", "webClient2", ".", "close", "(", ");", "}", "<", "sec", ":", "intercept", "-", "url", "pattern", "=", "\"/", "secure", "/", "test", ".", "html", "\"", "access", "=", "\"", "isAuthenticated", "(", ")\"", "/></s>if", "(", "session", "!", "=", "null", ")", "{", "String", "savedContext", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "FederationAuthenticationEntryPoint", ".", "SAVED_CONTEXT", ")", ";", "String", "state", "=", "getState", "(", "request", ")", ";", "if", "(", "savedContext", "!", "=", "null", "&", "&", "!", "savedContext", ".", "equals", "(", "state", ")", ")", "{", "logger", ".", "warn", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "throw", "new", "BadCredentialsException", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "}", "if", "(", "session", "!", "=", "null", ")", "{", "String", "savedContext", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "FederationAuthenticationEntryPoint", ".", "SAVED_CONTEXT", ")", ";", "String", "state", "=", "getState", "(", "request", ")", ";", "if", "(", "savedContext", "!", "=", "null", "&", "&", "!", "savedContext", ".", "equals", "(", "state", ")", ")", "{", "logger", ".", "warn", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "throw", "new", "BadCredentialsException", "(", "\"", "The", "received", "state", "does", "not", "match", "the", "state", "saved", "in", "the", "context", "\"", ");", "}"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["bpf:", "fix", "sanitation", "of", "alu", "op", "with", "pointer", "/", "scalar", "type", "from", "different", "paths", "While", "979d63d50c0c", "(\"bpf:", "prevent", "out", "of", "bounds", "speculation", "on", "pointer", "arithmetic\")", "took", "care", "of", "rejecting", "alu", "op", "on", "pointer", "when", "e.g.", "pointer", "came", "from", "two", "different", "map", "values", "with", "different", "map", "properties", "such", "as", "value", "size,", "Jann", "reported", "that", "a", "case", "was", "not", "covered", "yet", "when", "a", "given", "alu", "op", "is", "used", "in", "both", "\"ptr_reg", "+=", "reg\"", "and", "\"numeric_reg", "+=", "reg\"", "from", "different", "branches", "where", "we", "would", "incorrectly", "try", "to", "sanitize", "based", "on", "the", "pointer's", "limit.", "Catch", "this", "corner", "case", "and", "reject", "the", "program", "instead.", "Fixes:", "979d63d50c0c", "(\"bpf:", "prevent", "out", "of", "bounds", "speculation", "on", "pointer", "arithmetic\")", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>", "Acked-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@kernel.org>"], "code_tokens": ["#", "define", "BPF_ALU_NON_POINTER", "(", "1U", "<", "<", "3", ")", "static", "bool", "can_skip_alu_sanitation", "(", "const", "struct", "bpf_verifier_env", "*", "env", ",", "const", "struct", "bpf_insn", "*", "insn", ")", "{", "return", "env", "-", ">", "allow_ptr_leaks", "|", "|", "BPF_SRC", "(", "insn", "-", ">", "code", ")", "=", "=", "BPF_K", ";", "}", "static", "int", "update_alu_sanitation_state", "(", "struct", "bpf_insn_aux_data", "*", "aux", ",", "u32", "alu_state", ",", "u32", "alu_limit", ")", "{", "/", "*", "If", "we", "arrived", "here", "from", "different", "branches", "with", "different", "*", "state", "or", "limits", "to", "sanitize", ",", "then", "this", "won", "'", "t", "work", ".", "*", "/", "if", "(", "aux", "-", ">", "alu_state", "&", "&", "(", "aux", "-", ">", "alu_state", "!", "=", "alu_state", "|", "|", "aux", "-", ">", "alu_limit", "!", "=", "alu_limit", ")", ")", "return", "-", "EACCES", ";", "/", "*", "Corresponding", "fixup", "done", "in", "fixup_bpf_calls", "(", ").", "*", "/", "aux", "-", ">", "alu_state", "=", "alu_state", ";", "aux", "-", ">", "alu_limit", "=", "alu_limit", ";", "return", "0", ";", "}", "static", "int", "sanitize_val_alu", "(", "struct", "bpf_verifier_env", "*", "env", ",", "struct", "bpf_insn", "*", "insn", ")", "{", "struct", "bpf_insn_aux_data", "*", "aux", "=", "cur_aux", "(", "env", ")", ";", "if", "(", "can_skip_alu_sanitation", "(", "env", ",", "insn", ")", ")", "return", "0", ";", "return", "update_alu_sanitation_state", "(", "aux", ",", "BPF_ALU_NON_POINTER", ",", "0", ")", ";", "}", "if", "(", "can_skip_alu_sanitation", "(", "env", ",", "insn", ")", ")", "if", "(", "update_alu_sanitation_state", "(", "aux", ",", "alu_state", ",", "alu_limit", ")", ")", "u32", "dst", "=", "insn", "-", ">", "dst_reg", ";", "int", "ret", ";", "ret", "=", "sanitize_val_alu", "(", "env", ",", "insn", ")", ";", "if", "(", "ret", "<", "0", ")", "{", "verbose", "(", "env", ",", "\"", "R", "%", "d", "tried", "to", "add", "from", "different", "pointers", "or", "scalars", "\\", "n", "\"", ",", "dst", ")", ";", "return", "ret", ";", "}", "ret", "=", "sanitize_val_alu", "(", "env", ",", "insn", ")", ";", "if", "(", "ret", "<", "0", ")", "{", "verbose", "(", "env", ",", "\"", "R", "%", "d", "tried", "to", "sub", "from", "different", "pointers", "or", "scalars", "\\", "n", "\"", ",", "dst", ")", ";", "return", "ret", ";", "}</s>if", "(", "env", "-", ">", "allow_ptr_leaks", "|", "|", "BPF_SRC", "(", "insn", "-", ">", "code", ")", "=", "=", "BPF_K", ")", "/", "*", "If", "we", "arrived", "here", "from", "different", "branches", "with", "different", "*", "limits", "to", "sanitize", ",", "then", "this", "won", "'", "t", "work", ".", "*", "/", "if", "(", "aux", "-", ">", "alu_state", "&", "&", "(", "aux", "-", ">", "alu_state", "!", "=", "alu_state", "|", "|", "aux", "-", ">", "alu_limit", "!", "=", "alu_limit", ")", ")", "/", "*", "Corresponding", "fixup", "done", "in", "fixup_bpf_calls", "(", ").", "*", "/", "aux", "-", ">", "alu_state", "=", "alu_state", ";", "aux", "-", ">", "alu_limit", "=", "alu_limit", ";"], "docstring_tokens": ["performs", "undesirable", "out-of-bounds", "speculation", "on", "pointer", "arithmetic", "in", "various", "cases"]}
{"contents": ["posix-timers:", "Sanitize", "overrun", "handling", "The", "posix", "timer", "overrun", "handling", "is", "broken", "because", "the", "forwarding", "functions", "can", "return", "a", "huge", "number", "of", "overruns", "which", "does", "not", "fit", "in", "an", "int.", "As", "a", "consequence", "timer_getoverrun(2)", "and", "siginfo::si_overrun", "can", "turn", "into", "random", "number", "generators.", "The", "k_clock::timer_forward()", "callbacks", "return", "a", "64", "bit", "value", "now.", "Make", "k_itimer::ti_overrun[_last]", "64bit", "as", "well,", "so", "the", "kernel", "internal", "accounting", "is", "correct.", "3Remove", "the", "temporary", "(int)", "casts.", "Add", "a", "helper", "function", "which", "clamps", "the", "overrun", "value", "returned", "to", "user", "space", "via", "timer_getoverrun(2)", "or", "siginfo::si_overrun", "limited", "to", "a", "positive", "value", "between", "0", "and", "INT_MAX.", "INT_MAX", "is", "an", "indicator", "for", "user", "space", "that", "the", "overrun", "value", "has", "been", "clamped.", "Reported-by:", "Team", "OWL337", "<icytxw@gmail.com>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Acked-by:", "John", "Stultz", "<john.stultz@linaro.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Michael", "Kerrisk", "<mtk.manpages@gmail.com>", "Link:", "https://lkml.kernel.org/r/20180626132705.018623573@linutronix.de"], "code_tokens": ["s64", "it_overrun", ";", "s64", "it_overrun_last", ";", "timer", "-", ">", "it_overrun", "+", "=", "1LL", "<", "<", "i", ";", "/", "*", "*", "The", "siginfo", "si_overrun", "field", "and", "the", "return", "value", "of", "timer_getoverrun", "(", "2", ")", "*", "are", "of", "type", "int", ".", "Clamp", "the", "overrun", "value", "to", "INT_MAX", "*", "/", "static", "inline", "int", "timer_overrun_to_int", "(", "struct", "k_itimer", "*", "timr", ",", "int", "baseval", ")", "{", "s64", "sum", "=", "timr", "-", ">", "it_overrun_last", "+", "(", "s64", ")", "baseval", ";", "return", "sum", ">", "(", "s64", ")", "INT_MAX", "?", "INT_MAX", ":", "(", "int", ")", "sum", ";", "}", "timr", "-", ">", "it_overrun", "+", "=", "hrtimer_forward", "(", "timer", ",", "timer", "-", ">", "base", "-", ">", "get_time", "(", "),", "timr", "-", ">", "it_interval", ")", ";", "timr", "-", ">", "it_overrun", "=", "-", "1LL", ";", "+", "+", "timr", "-", ">", "it_requeue_pending", ";", "info", "-", ">", "si_overrun", "=", "timer_overrun_to_int", "(", "timr", ",", "info", "-", ">", "si_overrun", ")", ";", "timr", "-", ">", "it_overrun", "+", "=", "hrtimer_forward", "(", "timer", ",", "now", ",", "timr", "-", ">", "it_interval", ")", ";", "+", "+", "timr", "-", ">", "it_requeue_pending", ";", "new_timer", "-", ">", "it_overrun", "=", "-", "1LL", ";", "timr", "-", ">", "it_overrun", "+", "=", "kc", "-", ">", "timer_forward", "(", "timr", ",", "now", ")", ";", "overrun", "=", "timer_overrun_to_int", "(", "timr", ",", "0", ")", ";</s>int", "it_overrun", ";", "int", "it_overrun_last", ";", "timer", "-", ">", "it_overrun", "+", "=", "1", "<", "<", "i", ";", "timr", "-", ">", "it_overrun", "+", "=", "(", "unsigned", "int", ")", "hrtimer_forward", "(", "timer", ",", "timer", "-", ">", "base", "-", ">", "get_time", "(", "),", "timr", "-", ">", "it_interval", ")", ";", "timr", "-", ">", "it_overrun", "=", "-", "1", ";", "info", "-", ">", "si_overrun", "+", "=", "timr", "-", ">", "it_overrun_last", ";", "timr", "-", ">", "it_overrun", "+", "=", "(", "unsigned", "int", ")", "hrtimer_forward", "(", "timer", ",", "now", ",", "timr", "-", ">", "it_interval", ")", ";", "new_timer", "-", ">", "it_overrun", "=", "-", "1", ";", "timr", "-", ">", "it_overrun", "+", "=", "(", "int", ")", "kc", "-", ">", "timer_forward", "(", "timr", ",", "now", ")", ";", "overrun", "=", "timr", "-", ">", "it_overrun_last", ";"], "docstring_tokens": ["the", "way", "the", "overrun", "accounting", "works", "."]}
{"contents": ["nfsd4:", "use", "common", "rpc_cred", "for", "all", "callbacks", "Callbacks", "are", "always", "made", "using", "the", "machine's", "identity,", "so", "we", "can", "use", "a", "single", "auth_generic", "credential", "shared", "among", "callbacks", "to", "all", "clients", "and", "let", "the", "rpc", "code", "take", "care", "of", "the", "rest.", "Signed-off-by:", "J.", "Bruce", "Fields", "<bfields@citi.umich.edu>"], "code_tokens": ["static", "struct", "rpc_cred", "*", "callback_cred", ";", "int", "set_callback_cred", "(", "void", ")", "callback_cred", "=", "rpc_lookup_machine_cred", "(", ");", "if", "(", "!", "callback_cred", ")", "return", "-", "ENOMEM", ";", "return", "0", ";", ".", "rpc_cred", "=", "callback_cred", ".", "rpc_cred", "=", "callback_cred", "return", "set_callback_cred", "(", ");", "extern", "int", "set_callback_cred", "(", "void", ")", ";</s>static", "struct", "rpc_cred", "*", "lookup_cb_cred", "(", "struct", "nfs4_cb_conn", "*", "cb", ")", "struct", "auth_cred", "acred", "=", "{", ".", "machine_cred", "=", "1", "}", ";", "struct", "rpc_auth", "*", "auth", "=", "cb", "-", ">", "cb_client", "-", ">", "cl_auth", ";", "/", "*", "*", "Note", "in", "the", "gss", "case", "this", "doesn", "'", "t", "actually", "have", "to", "wait", "for", "a", "*", "gss", "upcall", "(", "or", "any", "calls", "to", "the", "client", ")", ";", "this", "just", "creates", "a", "*", "non", "-", "uptodate", "cred", "which", "the", "rpc", "state", "machine", "will", "fill", "in", "with", "*", "a", "refresh_upcall", "later", ".", "*", "/", "return", "auth", "-", ">", "au_ops", "-", ">", "lookup_cred", "(", "auth", ",", "&", "acred", ",", "RPCAUTH_LOOKUP_NEW", ")", ";", "struct", "rpc_cred", "*", "cred", ";", "cred", "=", "lookup_cb_cred", "(", "cb", ")", ";", "if", "(", "IS_ERR", "(", "cred", ")", ")", "{", "status", "=", "PTR_ERR", "(", "cred", ")", ";", "goto", "out", ";", "}", "cb", "-", ">", "cb_cred", "=", "cred", ";", "msg", ".", "rpc_cred", "=", "cb", "-", ">", "cb_cred", ";", "out", ":", ".", "rpc_cred", "=", "clp", "-", ">", "cl_cb_conn", ".", "cb_cred", "if", "(", "clp", "-", ">", "cl_cb_conn", ".", "cb_cred", ")", "{", "put_rpccred", "(", "clp", "-", ">", "cl_cb_conn", ".", "cb_cred", ")", ";", "clp", "-", ">", "cl_cb_conn", ".", "cb_cred", "=", "NULL", ";", "}", "return", "0", ";", "struct", "rpc_cred", "*", "cb_cred", ";"], "docstring_tokens": ["the", "attempt", "to", "access", "a", "credentials", "cache", "although", "the", "client", "has", "already", "specified", "the", "AUTH_NULL", "authentication", "flavor"]}
{"contents": ["Btrfs:", "check", "for", "read", "permission", "on", "src", "file", "in", "the", "clone", "ioctl", "The", "existing", "code", "would", "have", "allowed", "you", "to", "clone", "a", "file", "that", "was", "only", "open", "for", "writing", "Signed-off-by:", "Chris", "Mason", "<chris.mason@oracle.com>"], "code_tokens": ["/", "*", "the", "src", "must", "be", "open", "for", "reading", "*", "/", "if", "(", "!(", "src_file", "-", ">", "f_mode", "&", "FMODE_READ", ")", ")", "goto", "out_fput", ";</s>"], "docstring_tokens": ["does", "not", "ensure", "that", "a", "cloned", "file", "descriptor", "has", "been", "opened", "for", "reading"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/131"], "code_tokens": ["quantum_info", "=", "DestroyQuantumInfo", "(", "quantum_info", ")", ";</s>"], "docstring_tokens": ["suspend", "exception", "processing"]}
{"contents": ["ipc,sem:", "fine", "grained", "locking", "for", "semtimedop", "Introduce", "finer", "grained", "locking", "for", "semtimedop,", "to", "handle", "the", "common", "case", "of", "a", "program", "wanting", "to", "manipulate", "one", "semaphore", "from", "an", "array", "with", "multiple", "semaphores.", "If", "the", "call", "is", "a", "semop", "manipulating", "just", "one", "semaphore", "in", "an", "array", "with", "multiple", "semaphores,", "only", "take", "the", "lock", "for", "that", "semaphore", "itself.", "If", "the", "call", "needs", "to", "manipulate", "multiple", "semaphores,", "or", "another", "caller", "is", "in", "a", "transaction", "that", "manipulates", "multiple", "semaphores,", "the", "sem_array", "lock", "is", "taken,", "as", "well", "as", "all", "the", "locks", "for", "the", "individual", "semaphores.", "On", "a", "24", "CPU", "system,", "performance", "numbers", "with", "the", "semop-multi", "test", "with", "N", "threads", "and", "N", "semaphores,", "look", "like", "this:", "vanilla", "Davidlohr's", "Davidlohr's", "+", "Davidlohr's", "+", "threads", "patches", "rwlock", "patches", "v3", "patches", "10", "610652", "726325", "1783589", "2142206", "20", "341570", "365699", "1520453", "1977878", "30", "288102", "307037", "1498167", "2037995", "40", "290714", "305955", "1612665", "2256484", "50", "288620", "312890", "1733453", "2650292", "60", "289987", "306043", "1649360", "2388008", "70", "291298", "306347", "1723167", "2717486", "80", "290948", "305662", "1729545", "2763582", "90", "290996", "306680", "1736021", "2757524", "100", "292243", "306700", "1773700", "3059159", "[davidlohr.bueso@hp.com:", "do", "not", "call", "sem_lock", "when", "bogus", "sma]", "[davidlohr.bueso@hp.com:", "make", "refcounter", "atomic]", "Signed-off-by:", "Rik", "van", "Riel", "<riel@redhat.com>", "Suggested-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Acked-by:", "Davidlohr", "Bueso", "<davidlohr.bueso@hp.com>", "Cc:", "Chegu", "Vinod", "<chegu_vinod@hp.com>", "Cc:", "Jason", "Low", "<jason.low2@hp.com>", "Reviewed-by:", "Michel", "Lespinasse", "<walken@google.com>", "Cc:", "Peter", "Hurley", "<peter@hurleysoftware.com>", "Cc:", "Stanislav", "Kinsbursky", "<skinsbursky@parallels.com>", "Tested-by:", "Emmanuel", "Benisty", "<benisty.e@gmail.com>", "Tested-by:", "Sedat", "Dilek", "<sedat.dilek@gmail.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "!", "ipc_rcu_getref", "(", "msq", ")", ")", "{", "err", "=", "-", "EIDRM", ";", "goto", "out_unlock_free", ";", "}", "spinlock_t", "lock", ";", "/", "*", "spinlock", "for", "fine", "-", "grained", "semtimedop", "*", "/", "/", "*", "*", "If", "the", "request", "contains", "only", "one", "semaphore", "operation", ",", "and", "there", "are", "*", "no", "complex", "transactions", "pending", ",", "lock", "only", "the", "semaphore", "involved", ".", "*", "Otherwise", ",", "lock", "the", "entire", "semaphore", "array", ",", "since", "we", "either", "have", "*", "multiple", "semaphores", "in", "our", "own", "semops", ",", "or", "we", "need", "to", "look", "at", "*", "semaphores", "from", "other", "pending", "complex", "operations", ".", "*", "*", "Carefully", "guard", "against", "sma", "-", ">", "complex_count", "changing", "between", "zero", "*", "and", "non", "-", "zero", "while", "we", "are", "spinning", "for", "the", "lock", ".", "The", "value", "of", "*", "sma", "-", ">", "complex_count", "cannot", "change", "while", "we", "are", "holding", "the", "lock", ",", "*", "so", "sem_unlock", "should", "be", "fine", ".", "*", "*", "The", "global", "lock", "path", "checks", "that", "all", "the", "local", "locks", "have", "been", "released", ",", "*", "checking", "each", "local", "lock", "once", ".", "This", "means", "that", "the", "local", "lock", "paths", "*", "cannot", "start", "their", "critical", "sections", "while", "the", "global", "lock", "is", "held", ".", "*", "/", "static", "inline", "int", "sem_lock", "(", "struct", "sem_array", "*", "sma", ",", "struct", "sembuf", "*", "sops", ",", "int", "nsops", ")", "{", "int", "locknum", ";", "again", ":", "if", "(", "nsops", "=", "=", "1", "&", "&", "!", "sma", "-", ">", "complex_count", ")", "{", "struct", "sem", "*", "sem", "=", "sma", "-", ">", "sem_base", "+", "sops", "-", ">", "sem_num", ";", "/", "*", "Lock", "just", "the", "semaphore", "we", "are", "interested", "in", ".", "*", "/", "spin_lock", "(", "&", "sem", "-", ">", "lock", ")", ";", "/", "*", "*", "If", "sma", "-", ">", "complex_count", "was", "set", "while", "we", "were", "spinning", ",", "*", "we", "may", "need", "to", "look", "at", "things", "we", "did", "not", "lock", "here", ".", "*", "/", "if", "(", "unlikely", "(", "sma", "-", ">", "complex_count", ")", ")", "{", "spin_unlock", "(", "&", "sem", "-", ">", "lock", ")", ";", "goto", "lock_array", ";", "}", "/", "*", "*", "Another", "process", "is", "holding", "the", "global", "lock", "on", "the", "*", "sem_array", ";", "we", "cannot", "enter", "our", "critical", "section", ",", "*", "but", "have", "to", "wait", "for", "the", "global", "lock", "to", "be", "released", ".", "*", "/", "if", "(", "unlikely", "(", "spin_is_locked", "(", "&", "sma", "-", ">", "sem_perm", ".", "lock", ")", "))", "{", "spin_unlock", "(", "&", "sem", "-", ">", "lock", ")", ";", "spin_unlock_wait", "(", "&", "sma", "-", ">", "sem_perm", ".", "lock", ")", ";", "goto", "again", ";", "}", "locknum", "=", "sops", "-", ">", "sem_num", ";", "}", "else", "{", "int", "i", ";", "/", "*", "*", "Lock", "the", "semaphore", "array", ",", "and", "wait", "for", "all", "of", "the", "*", "individual", "semaphore", "locks", "to", "go", "away", ".", "The", "code", "*", "above", "ensures", "no", "new", "single", "-", "lock", "holders", "will", "enter", "*", "their", "critical", "section", "while", "the", "array", "lock", "is", "held", ".", "*", "/", "lock_array", ":", "spin_lock", "(", "&", "sma", "-", ">", "sem_perm", ".", "lock", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "sma", "-", ">", "sem_nsems", ";", "i", "+", "+)", "{", "struct", "sem", "*", "sem", "=", "sma", "-", ">", "sem_base", "+", "i", ";", "spin_unlock_wait", "(", "&", "sem", "-", ">", "lock", ")", ";", "}", "locknum", "=", "-", "1", ";", "}", "return", "locknum", ";", "}", "static", "inline", "void", "sem_unlock", "(", "struct", "sem_array", "*", "sma", ",", "int", "locknum", ")", "{", "if", "(", "locknum", "=", "=", "-", "1", ")", "{", "spin_unlock", "(", "&", "sma", "-", ">", "sem_perm", ".", "lock", ")", ";", "}", "else", "{", "struct", "sem", "*", "sem", "=", "sma", "-", ">", "sem_base", "+", "locknum", ";", "spin_unlock", "(", "&", "sem", "-", ">", "lock", ")", ";", "}", "rcu_read_unlock", "(", ");", "}", "static", "inline", "struct", "sem_array", "*", "sem_obtain_lock", "(", "struct", "ipc_namespace", "*", "ns", ",", "int", "id", ",", "struct", "sembuf", "*", "sops", ",", "int", "nsops", ",", "int", "*", "locknum", ")", "sma", "=", "container_of", "(", "ipcp", ",", "struct", "sem_array", ",", "sem_perm", ")", ";", "*", "locknum", "=", "sem_lock", "(", "sma", ",", "sops", ",", "nsops", ")", ";", "sem_unlock", "(", "sma", ",", "*", "locknum", ")", ";", "rcu_read_lock", "(", ");", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "WARN_ON_ONCE", "(", "!", "ipc_rcu_getref", "(", "sma", ")", ");", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_lock_and_putref", "(", "sma", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "WARN_ON_ONCE", "(", "!", "ipc_rcu_getref", "(", "sma", ")", ");", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nsems", ";", "i", "+", "+)", "{", "spin_lock_init", "(", "&", "sma", "-", ">", "sem_base", "[", "i", "]", ".", "lock", ")", ";", "}", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "if", "(", "val", ">", "SEMVMX", "|", "|", "val", "<", "0", ")", "return", "-", "ERANGE", ";", "rcu_read_lock", "(", ");", "sma", "=", "sem_obtain_object_check", "(", "ns", ",", "semid", ")", ";", "if", "(", "IS_ERR", "(", "sma", ")", ")", "{", "rcu_read_unlock", "(", ");", "return", "PTR_ERR", "(", "sma", ")", ";", "}", "if", "(", "semnum", "<", "0", "|", "|", "semnum", ">", "=", "sma", "-", ">", "sem_nsems", ")", "{", "rcu_read_unlock", "(", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "ipcperms", "(", "ns", ",", "&", "sma", "-", ">", "sem_perm", ",", "S_IWUGO", ")", ")", "{", "rcu_read_unlock", "(", ");", "return", "-", "EACCES", ";", "}", "if", "(", "err", ")", "{", "rcu_read_unlock", "(", ");", "return", "-", "EACCES", ";", "}", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "return", "0", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "}", "else", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "if", "(", "!", "ipc_rcu_getref", "(", "sma", ")", ")", "{", "rcu_read_unlock", "(", ");", "return", "-", "EIDRM", ";", "}", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "int", "nsems", ",", "error", ";", "if", "(", "!", "ipc_rcu_getref", "(", "sma", ")", ")", "{", "rcu_read_unlock", "(", ");", "un", "=", "ERR_PTR", "(", "-", "EIDRM", ")", ";", "goto", "out", ";", "}", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "int", "undos", "=", "0", ",", "alter", "=", "0", ",", "max", ",", "locknum", ";", "INIT_LIST_HEAD", "(", "&", "tasks", ")", ";", "/", "*", "On", "success", ",", "find_alloc_undo", "takes", "the", "rcu_read_lock", "*", "/", "}", "else", "{", "rcu_read_lock", "(", ");", "}", "rcu_read_unlock", "(", ");", "locknum", "=", "sem_lock", "(", "sma", ",", "sops", ",", "nsops", ")", ";", "if", "(", "un", "&", "&", "un", "-", ">", "semid", "=", "=", "-", "1", ")", "goto", "out_unlock_free", ";", "sem_unlock", "(", "sma", ",", "locknum", ")", ";", "sma", "=", "sem_obtain_lock", "(", "ns", ",", "semid", ",", "sops", ",", "nsops", ",", "&", "locknum", ")", ";", "sem_unlock", "(", "sma", ",", "locknum", ")", ";", "int", "semid", ",", "i", ";", "if", "(", "semid", "=", "=", "-", "1", ")", "{", "rcu_read_unlock", "(", ");", "}", "sma", "=", "sem_obtain_object_check", "(", "tsk", "-", ">", "nsproxy", "-", ">", "ipc_ns", ",", "un", "-", ">", "semid", ")", ";", "if", "(", "IS_ERR", "(", "sma", ")", ")", "{", "rcu_read_unlock", "(", ");", "}", "sem_lock", "(", "sma", ",", "NULL", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "sem_unlock", "(", "sma", ",", "-", "1", ")", ";", "void", "*", "ipc_alloc", "(", "int", "size", ")", "void", "*", "out", ";", "atomic_t", "refcount", ";", "*", "Returns", "the", "pointer", "to", "the", "object", "or", "NULL", "upon", "failure", ".", "void", "*", "ipc_rcu_alloc", "(", "int", "size", ")", "void", "*", "out", ";", "/", "*", "*", "workqueue", "if", "necessary", "(", "for", "vmalloc", ")", ".", "if", "(", "!", "out", ")", "goto", "done", ";", "out", "+", "=", "HDRLEN_VMALLOC", ";", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "is_vmalloc", "=", "1", ";", "if", "(", "!", "out", ")", "goto", "done", ";", "out", "+", "=", "HDRLEN_KMALLOC", ";", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "is_vmalloc", "=", "0", ";", "/", "*", "set", "reference", "counter", "no", "matter", "what", "kind", "of", "allocation", "was", "done", "*", "/", "atomic_set", "(", "&", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", ",", "1", ")", ";", "done", ":", "int", "ipc_rcu_getref", "(", "void", "*", "ptr", ")", "return", "atomic_inc_not_zero", "(", "&", "container_of", "(", "ptr", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", ")", ";", "if", "(", "!", "atomic_dec_and_test", "(", "&", "container_of", "(", "ptr", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", ")", ")", "int", "ipc_rcu_getref", "(", "void", "*", "ptr", ")", ";</s>ipc_rcu_getref", "(", "msq", ")", ";", "#", "define", "sem_unlock", "(", "sma", ")", "ipc_unlock", "(", "&(", "sma", ")", "->", "sem_perm", ")", "static", "inline", "struct", "sem_array", "*", "sem_obtain_lock", "(", "struct", "ipc_namespace", "*", "ns", ",", "int", "id", ")", "spin_lock", "(", "&", "ipcp", "-", ">", "lock", ")", ";", "spin_unlock", "(", "&", "ipcp", "-", ">", "lock", ")", ";", "static", "inline", "struct", "sem_array", "*", "sem_lock_check", "(", "struct", "ipc_namespace", "*", "ns", ",", "int", "id", ")", "{", "struct", "kern_ipc_perm", "*", "ipcp", "=", "ipc_lock_check", "(", "&", "sem_ids", "(", "ns", ")", ",", "id", ")", ";", "if", "(", "IS_ERR", "(", "ipcp", ")", ")", "return", "ERR_CAST", "(", "ipcp", ")", ";", "return", "container_of", "(", "ipcp", ",", "struct", "sem_array", ",", "sem_perm", ")", ";", "}", "ipc_lock_by_ptr", "(", "&", "sma", "-", ">", "sem_perm", ")", ";", "ipc_rcu_getref", "(", "sma", ")", ";", "ipc_unlock", "(", "&(", "sma", ")", "->", "sem_perm", ")", ";", "ipc_lock_by_ptr", "(", "&", "sma", "-", ">", "sem_perm", ")", ";", "ipc_rcu_putref", "(", "sma", ")", ";", "ipc_unlock", "(", "&(", "sma", ")", "->", "sem_perm", ")", ";", "spin_lock", "(", "&(", "sma", ")", "->", "sem_perm", ".", "lock", ")", ";", "ipc_rcu_getref", "(", "sma", ")", ";", "ipc_unlock", "(", "&(", "sma", ")", "->", "sem_perm", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nsems", ";", "i", "+", "+)", "sem_unlock", "(", "sma", ")", ";", "sem_unlock", "(", "sma", ")", ";", "int", "nsems", ";", "sma", "=", "sem_lock_check", "(", "ns", ",", "semid", ")", ";", "if", "(", "IS_ERR", "(", "sma", ")", ")", "return", "PTR_ERR", "(", "sma", ")", ";", "nsems", "=", "sma", "-", ">", "sem_nsems", ";", "err", "=", "-", "EACCES", ";", "if", "(", "ipcperms", "(", "ns", ",", "&", "sma", "-", ">", "sem_perm", ",", "S_IWUGO", ")", ")", "goto", "out_unlock", ";", "if", "(", "err", ")", "goto", "out_unlock", ";", "err", "=", "-", "EINVAL", ";", "if", "(", "semnum", "<", "0", "|", "|", "semnum", ">", "=", "nsems", ")", "goto", "out_unlock", ";", "err", "=", "-", "ERANGE", ";", "if", "(", "val", ">", "SEMVMX", "|", "|", "val", "<", "0", ")", "goto", "out_unlock", ";", "err", "=", "0", ";", "out_unlock", ":", "sem_unlock", "(", "sma", ")", ";", "return", "err", ";", "sem_unlock", "(", "sma", ")", ";", "}", "spin_lock", "(", "&", "sma", "-", ">", "sem_perm", ".", "lock", ")", ";", "sem_unlock", "(", "sma", ")", ";", "ipc_rcu_getref", "(", "sma", ")", ";", "sem_unlock", "(", "sma", ")", ";", "spin_lock", "(", "&", "sma", "-", ">", "sem_perm", ".", "lock", ")", ";", "sem_unlock", "(", "sma", ")", ";", "ipc_lock_object", "(", "&", "sma", "-", ">", "sem_perm", ")", ";", "ipc_lock_object", "(", "&", "sma", "-", ">", "sem_perm", ")", ";", "sem_unlock", "(", "sma", ")", ";", "int", "nsems", ";", "int", "error", ";", "ipc_rcu_getref", "(", "sma", ")", ";", "sem_unlock", "(", "sma", ")", ";", "sem_unlock", "(", "sma", ")", ";", "int", "undos", "=", "0", ",", "alter", "=", "0", ",", "max", ";", "}", "else", "INIT_LIST_HEAD", "(", "&", "tasks", ")", ";", "rcu_read_lock", "(", ");", "if", "(", "un", ")", "rcu_read_unlock", "(", ");", "ipc_lock_object", "(", "&", "sma", "-", ">", "sem_perm", ")", ";", "if", "(", "un", ")", "{", "if", "(", "un", "-", ">", "semid", "=", "=", "-", "1", ")", "{", "rcu_read_unlock", "(", ");", "goto", "out_unlock_free", ";", "}", "else", "{", "/", "*", "*", "rcu", "lock", "can", "be", "released", ",", "\"", "un", "\"", "cannot", "disappear", ":", "*", "-", "sem_lock", "is", "acquired", ",", "thus", "IPC_RMID", "is", "*", "impossible", ".", "*", "-", "exit_sem", "is", "impossible", ",", "it", "always", "operates", "on", "*", "current", "(", "or", "a", "dead", "task", ")", ".", "*", "/", "rcu_read_unlock", "(", ");", "}", "}", "sem_unlock", "(", "sma", ")", ";", "sma", "=", "sem_obtain_lock", "(", "ns", ",", "semid", ")", ";", "sem_unlock", "(", "sma", ")", ";", "int", "semid", ";", "int", "i", ";", "rcu_read_unlock", "(", ");", "if", "(", "semid", "=", "=", "-", "1", ")", "sma", "=", "sem_lock_check", "(", "tsk", "-", ">", "nsproxy", "-", ">", "ipc_ns", ",", "un", "-", ">", "semid", ")", ";", "if", "(", "IS_ERR", "(", "sma", ")", ")", "sem_unlock", "(", "sma", ")", ";", "sem_unlock", "(", "sma", ")", ";", "void", "*", "ipc_alloc", "(", "int", "size", ")", "void", "*", "out", ";", "int", "refcount", ";", "*", "Returns", "the", "pointer", "to", "the", "object", ".", "*", "NULL", "is", "returned", "if", "the", "allocation", "fails", ".", "void", "*", "ipc_rcu_alloc", "(", "int", "size", ")", "void", "*", "out", ";", "/", "*", "*", "workqueue", "if", "necessary", "(", "for", "vmalloc", ")", ".", "if", "(", "out", ")", "{", "out", "+", "=", "HDRLEN_VMALLOC", ";", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "is_vmalloc", "=", "1", ";", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", "=", "1", ";", "}", "if", "(", "out", ")", "{", "out", "+", "=", "HDRLEN_KMALLOC", ";", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "is_vmalloc", "=", "0", ";", "container_of", "(", "out", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", "=", "1", ";", "}", "void", "ipc_rcu_getref", "(", "void", "*", "ptr", ")", "container_of", "(", "ptr", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", "+", "+;", "if", "(", "--", "container_of", "(", "ptr", ",", "struct", "ipc_rcu_hdr", ",", "data", ")", "->", "refcount", ">", "0", ")", "void", "ipc_rcu_getref", "(", "void", "*", "ptr", ")", ";"], "docstring_tokens": ["the", "failure", "to", "properly", "adjust", "reference", "counter"]}
{"contents": ["KVM:", "nVMX:", "unconditionally", "cancel", "preemption", "timer", "in", "free_nested", "(", ")", "Bugzilla:", "1671904", "There", "are", "multiple", "code", "paths", "where", "an", "hrtimer", "may", "have", "been", "started", "to", "emulate", "an", "L1", "VMX", "preemption", "timer", "that", "can", "result", "in", "a", "call", "to", "free_nested", "without", "an", "intervening", "L2", "exit", "where", "the", "hrtimer", "is", "normally", "cancelled.", "Unconditionally", "cancel", "in", "free_nested", "to", "cover", "all", "cases.", "Embargoed", "until", "Feb", "7th", "2019.", "Signed-off-by:", "Peter", "Shier", "<pshier@google.com>", "Reported-by:", "Jim", "Mattson", "<jmattson@google.com>", "Reviewed-by:", "Jim", "Mattson", "<jmattson@google.com>", "Reported-by:", "Felix", "Wilhelm", "<fwilhelm@google.com>", "Cc:", "stable@kernel.org", "Message-Id:", "<20181011184646.154065-1-pshier@google.com>", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["hrtimer_cancel", "(", "&", "vmx", "-", ">", "nested", ".", "preemption_timer", ")", ";</s>"], "docstring_tokens": ["requires", "nested", "virtualization", "support"]}
{"contents": ["#57031", "-", "Out", "of", "Memory", "when", "extracting", "text", "from", "attached", "files", "git-svn-id:", "https://svn.apache.org/repos/asf/poi/trunk@1734182", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "try", "{", "return", "parse", "(", "new", "StringReader", "(", "xmlText", ")", ",", "type", ",", "options", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "XmlException", "(", "\"", "Unable", "to", "parse", "xml", "bean", "\"", ",", "e", ")", ";", "}", "InputStream", "is", "=", "new", "FileInputStream", "(", "file", ")", ";", "try", "{", "return", "parse", "(", "is", ",", "type", ",", "options", ")", ";", "}", "finally", "{", "is", ".", "close", "(", ");", "}", "InputStream", "is", "=", "file", ".", "openStream", "(", ");", "try", "{", "return", "parse", "(", "is", ",", "type", ",", "options", ")", ";", "}", "finally", "{", "is", ".", "close", "(", ");", "}", "try", "{", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "jiois", ")", ";", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "doc", ".", "getDocumentElement", "(", "),", "type", ",", "getXmlOptions", "(", "options", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "parse", "xml", "bean", "\"", ",", "e", ")", ";", "}", "try", "{", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "new", "InputSource", "(", "jior", ")", ");", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "doc", ".", "getDocumentElement", "(", "),", "type", ",", "getXmlOptions", "(", "options", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "XmlException", "(", "\"", "Unable", "to", "parse", "xml", "bean", "\"", ",", "e", ")", ";", "}", "import", "org", ".", "xml", ".", "sax", ".", "ErrorHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "private", "static", "class", "DocHelperErrorHandler", "implements", "ErrorHandler", "{", "public", "void", "warning", "(", "SAXParseException", "exception", ")", "throws", "SAXException", "{", "printError", "(", "POILogger", ".", "WARN", ",", "exception", ")", ";", "}", "public", "void", "error", "(", "SAXParseException", "exception", ")", "throws", "SAXException", "{", "printError", "(", "POILogger", ".", "ERROR", ",", "exception", ")", ";", "}", "public", "void", "fatalError", "(", "SAXParseException", "exception", ")", "throws", "SAXException", "{", "printError", "(", "POILogger", ".", "FATAL", ",", "exception", ")", ";", "throw", "exception", ";", "}", "/", "**", "Prints", "the", "error", "message", ".", "*", "/", "private", "void", "printError", "(", "int", "type", ",", "SAXParseException", "ex", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "String", "systemId", "=", "ex", ".", "getSystemId", "(", ");", "if", "(", "systemId", "!", "=", "null", ")", "{", "int", "index", "=", "systemId", ".", "lastIndexOf", "(", "'/", "')", ";", "if", "(", "index", "!", "=", "-", "1", ")", "systemId", "=", "systemId", ".", "substring", "(", "index", "+", "1", ")", ";", "sb", ".", "append", "(", "systemId", ")", ";", "}", "sb", ".", "append", "(", "':", "')", ";", "sb", ".", "append", "(", "ex", ".", "getLineNumber", "(", "))", ";", "sb", ".", "append", "(", "':", "')", ";", "sb", ".", "append", "(", "ex", ".", "getColumnNumber", "(", "))", ";", "sb", ".", "append", "(", "\":", "\"", ");", "sb", ".", "append", "(", "ex", ".", "getMessage", "(", "))", ";", "logger", ".", "log", "(", "type", ",", "sb", ".", "toString", "(", "),", "ex", ")", ";", "}", "}", "documentBuilder", ".", "setErrorHandler", "(", "new", "DocHelperErrorHandler", "(", "))", ";", "private", "static", "void", "trySetSAXFeature", "(", "DocumentBuilderFactory", "dbf", ",", "String", "feature", ",", "boolean", "enabled", ")", "{", "dbf", ".", "setFeature", "(", "feature", ",", "enabled", ")", ";", "private", "static", "void", "trySetXercesSecurityManager", "(", "DocumentBuilderFactory", "dbf", ")", "{", "dbf", ".", "setAttribute", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "properties", "/", "security", "-", "manager", "\"", ",", "mgr", ")", ";", "/", "**", "*", "Parses", "the", "given", "stream", "via", "the", "default", "(", "sensible", ")", "*", "DocumentBuilder", "*", "@", "param", "inp", "sax", "source", "to", "read", "the", "XML", "data", "from", "*", "@", "return", "the", "parsed", "Document", "*", "/", "public", "static", "Document", "readDocument", "(", "InputSource", "inp", ")", "throws", "IOException", ",", "SAXException", "{", "return", "newDocumentBuilder", "(", ").", "parse", "(", "inp", ")", ";", "}", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "Document", "_doc", ";", "try", "{", "_doc", "=", "DocumentHelper", ".", "readDocument", "(", "getPackagePart", "(", ").", "getInputStream", "(", "))", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "SldDocument", "doc", "=", "SldDocument", ".", "Factory", ".", "parse", "(", "_doc", ",", "DEFAULT_XML_OPTIONS", ")", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "zip", ".", "getInputStream", "(", "entry", ")", ");", "XmlObject", "xml", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "doc", ",", "DEFAULT_XML_OPTIONS", ")", ";", "throw", "new", "IOException", "(", "\"", "unable", "to", "parse", "shared", "strings", "table", "\"", ",", "e", ")", ";", "XmlOptions", "xmlOptions", "=", "new", "XmlOptions", "(", "DEFAULT_XML_OPTIONS", ")", ";", "xmlOptions", ".", "setSaveCDataLengthThreshold", "(", "1000000", ")", ";", "xmlOptions", ".", "setSaveCDataEntityCountThreshold", "(", "-", "1", ")", ";", "_sstDoc", ".", "save", "(", "out", ",", "xmlOptions", ")", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "@", "SuppressWarnings", "(", "\"", "resource", "\"", ")", "Document", "doc", ";", "try", "{", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "new", "EvilUnclosedBRFixingInputStream", "(", "is", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "XmlException", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "XmlObject", "root", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "doc", ",", "DEFAULT_XML_OPTIONS", ")", ";", "Document", "doc2", ";", "try", "{", "InputSource", "is2", "=", "new", "InputSource", "(", "new", "StringReader", "(", "obj", ".", "xmlText", "(", "))", ");", "doc2", "=", "DocumentHelper", ".", "readDocument", "(", "is2", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "XmlException", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "_items", ".", "add", "(", "XmlObject", ".", "Factory", ".", "parse", "(", "doc2", ",", "DEFAULT_XML_OPTIONS", ")", ");", "if", "(", "readA", "=", "=", "0", ")", "{", "return", "readB", ";", "}", "import", "java", ".", "io", ".", "StringReader", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "DocumentHelper", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "List", "<", "CTPicture", ">", "pics", "=", "new", "ArrayList", "<", "CTPicture", ">", "()", ";", "pics", ".", "add", "(", "(", "CTPicture", ")", "pict", ")", ";", "return", "pics", ";", "@", "SuppressWarnings", "(", "\"", "resource", "\"", ")", "\"", "</", "a", ":", "graphic", ">", "\";", "InputSource", "is", "=", "new", "InputSource", "(", "new", "StringReader", "(", "xml", ")", ");", "org", ".", "w3c", ".", "dom", ".", "Document", "doc", "=", "DocumentHelper", ".", "readDocument", "(", "is", ")", ";", "inline", ".", "set", "(", "XmlToken", ".", "Factory", ".", "parse", "(", "doc", ".", "getDocumentElement", "(", "),", "DEFAULT_XML_OPTIONS", ")", ");", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "String", "msg", "=", "e", ".", "getMessage", "(", ");", "if", "(", "msg", "!", "=", "null", "&", "&", "msg", ".", "startsWith", "(", "\"", "Zip", "bomb", "detected", "!", "\")", ")", "{", "p", ".", "close", "(", ");", "is", ".", "close", "(", ");", "assertTrue", "(", "\"", "Had", ":", "\"", "+", "string", ",", "string", ".", "contains", "(", "\"", "The", "parser", "has", "encountered", "more", "than", "\"", "))", ";</s>return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "xmlText", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "file", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "file", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "jiois", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "return", "XmlBeans", ".", "getContextTypeLoader", "(", ").", "parse", "(", "jior", ",", "type", ",", "getXmlOptions", "(", "options", ")", ");", "private", "static", "void", "trySetSAXFeature", "(", "DocumentBuilderFactory", "documentBuilderFactory", ",", "String", "feature", ",", "boolean", "enabled", ")", "{", "documentBuilderFactory", ".", "setFeature", "(", "feature", ",", "enabled", ")", ";", "private", "static", "void", "trySetXercesSecurityManager", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "documentBuilderFactory", ".", "setAttribute", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "properties", "/", "security", "-", "manager", "\"", ",", "mgr", ")", ";", "SldDocument", "doc", "=", "SldDocument", ".", "Factory", ".", "parse", "(", "getPackagePart", "(", ").", "getInputStream", "(", "),", "DEFAULT_XML_OPTIONS", ")", ";", "import", "java", ".", "io", ".", "IOException", ";", "XmlObject", "xml", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "zip", ".", "getInputStream", "(", "entry", ")", ",", "DEFAULT_XML_OPTIONS", ")", ";", "throw", "new", "IOException", "(", "e", ")", ";", "XmlOptions", "options", "=", "new", "XmlOptions", "(", "DEFAULT_XML_OPTIONS", ")", ";", "options", ".", "setSaveCDataLengthThreshold", "(", "1000000", ")", ";", "options", ".", "setSaveCDataEntityCountThreshold", "(", "-", "1", ")", ";", "_sstDoc", ".", "save", "(", "out", ",", "options", ")", ";", "XmlObject", "root", "=", "XmlObject", ".", "Factory", ".", "parse", "(", "new", "EvilUnclosedBRFixingInputStream", "(", "is", ")", ",", "DEFAULT_XML_OPTIONS", ")", ";", "_items", ".", "add", "(", "XmlObject", ".", "Factory", ".", "parse", "(", "obj", ".", "xmlText", "(", "),", "DEFAULT_XML_OPTIONS", ")", ");", "List", "<", "CTPicture", ">", "pictures", "=", "new", "ArrayList", "<", "CTPicture", ">", "()", ";", "pictures", ".", "add", "(", "(", "CTPicture", ")", "pict", ")", ";", "return", "pictures", ";", "\"", "</", "a", ":", "graphic", ">", "\";", "inline", ".", "set", "(", "XmlToken", ".", "Factory", ".", "parse", "(", "xml", ",", "DEFAULT_XML_OPTIONS", ")", ");", "if", "(", "e", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "Zip", "bomb", "detected", "!", "\")", ")", "{", "assertTrue", "(", "\"", "Had", ":", "\"", "+", "string", ",", "string", ".", "contains", "(", "\"", "Exceeded", "Entity", "dereference", "bytes", "limit", "\"", "))", ";"], "docstring_tokens": ["accept", "content", "from", "external", "or", "untrusted", "sources"]}
{"contents": ["tcp:", "make", "challenge", "acks", "less", "predictable", "Yue", "Cao", "claims", "that", "current", "host", "rate", "limiting", "of", "challenge", "ACKS", "(RFC", "5961)", "could", "leak", "enough", "information", "to", "allow", "a", "patient", "attacker", "to", "hijack", "TCP", "sessions.", "He", "will", "soon", "provide", "details", "in", "an", "academic", "paper.", "This", "patch", "increases", "the", "default", "limit", "from", "100", "to", "1000,", "and", "adds", "some", "randomization", "so", "that", "the", "attacker", "can", "no", "longer", "hijack", "sessions", "without", "spending", "a", "considerable", "amount", "of", "probes.", "Based", "on", "initial", "analysis", "and", "patch", "from", "Linus.", "Note", "that", "we", "also", "have", "per", "socket", "rate", "limiting,", "so", "it", "is", "tempting", "to", "remove", "the", "host", "limit", "in", "the", "future.", "v2:", "randomize", "the", "count", "of", "challenge", "acks", "per", "second,", "not", "the", "period.", "Fixes:", "282f23c6ee34", "(\"tcp:", "implement", "RFC", "5961", "3.2\")", "Reported-by:", "Yue", "Cao", "<ycao009@ucr.edu>", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Suggested-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Yuchung", "Cheng", "<ycheng@google.com>", "Cc:", "Neal", "Cardwell", "<ncardwell@google.com>", "Acked-by:", "Neal", "Cardwell", "<ncardwell@google.com>", "Acked-by:", "Yuchung", "Cheng", "<ycheng@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["int", "sysctl_tcp_challenge_ack_limit", "=", "1000", ";", "u32", "count", ",", "now", ";", "/", "*", "Then", "check", "host", "-", "wide", "RFC", "5961", "rate", "limit", ".", "*", "/", "u32", "half", "=", "(", "sysctl_tcp_challenge_ack_limit", "+", "1", ")", ">", ">", "1", ";", "WRITE_ONCE", "(", "challenge_count", ",", "half", "prandom_u32_max", "(", "sysctl_tcp_challenge_ack_limit", ")", ");", "count", "=", "READ_ONCE", "(", "challenge_count", ")", ";", "if", "(", "count", ">", "0", ")", "{", "WRITE_ONCE", "(", "challenge_count", ",", "count", "-", "1", ")", ";</s>int", "sysctl_tcp_challenge_ack_limit", "=", "100", ";", "u32", "now", ";", "/", "*", "Then", "check", "the", "check", "host", "-", "wide", "RFC", "5961", "rate", "limit", ".", "*", "/", "challenge_count", "=", "0", ";", "if", "(", "++", "challenge_count", "<", "=", "sysctl_tcp_challenge_ack_limit", ")", "{"], "docstring_tokens": ["does", "not", "properly", "determine", "the", "rate", "of", "challenge", "ACK", "segments"]}
{"contents": ["HID:", "cp2112:", "fix", "gpio-callback", "error", "handling", "In", "case", "of", "a", "zero-length", "report,", "the", "gpio", "direction_input", "callback", "would", "currently", "return", "success", "instead", "of", "an", "errno.", "Fixes:", "1ffb3c40ffb5", "(\"HID:", "cp2112:", "make", "transfer", "buffers", "DMA", "capable\")", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "4.9", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Reviewed-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["return", "ret", "<", "0", "?", "ret", ":", "-", "EIO", ";</s>return", "ret", "<", "=", "0", "?", "ret", ":", "-", "EIO", ";"], "docstring_tokens": ["does", "not", "have", "the", "expected", "EIO", "error", "status", "for", "a", "zero-length", "report"]}
{"contents": ["improve", "ICNSParser"], "code_tokens": ["if", "(", "icon_length", "<", "=", "0", ")", "{", "break", ";", "}</s>"], "docstring_tokens": ["an", "out", "of", "memory", "error", "and", "infinite", "loop", "flaw"]}
{"contents": ["KVM:", "ioapic:", "fix", "assignment", "of", "ioapic->rtc_status.pending_eoi", "(", ")", "QE", "reported", "that", "they", "got", "the", "BUG_ON", "in", "ioapic_service", "to", "trigger.", "I", "cannot", "reproduce", "it,", "but", "there", "are", "two", "reasons", "why", "this", "could", "happen.", "The", "less", "likely", "but", "also", "easiest", "one,", "is", "when", "kvm_irq_delivery_to_apic", "does", "not", "deliver", "to", "any", "APIC", "and", "returns", "-1.", "Because", "irqe.shorthand", "==", "0,", "the", "kvm_for_each_vcpu", "loop", "in", "that", "function", "is", "never", "reached.", "However,", "you", "can", "target", "the", "similar", "loop", "in", "kvm_irq_delivery_to_apic_fast;", "just", "program", "a", "zero", "logical", "destination", "address", "into", "the", "IOAPIC,", "or", "an", "out-of-range", "physical", "destination", "address.", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["ioapic", "-", ">", "rtc_status", ".", "pending_eoi", "=", "(", "ret", "<", "0", "?", "0", ":", "ret", ")", ";</s>ioapic", "-", ">", "rtc_status", ".", "pending_eoi", "=", "ret", ";"], "docstring_tokens": ["does", "not", "properly", "validate", "the", "kvm_irq_delivery_to_apic", "return", "value"]}
{"contents": ["KEYS:", "ensure", "we", "free", "the", "assoc", "array", "edit", "if", "edit", "is", "valid", "__key_link_end", "is", "not", "freeing", "the", "associated", "array", "edit", "structure", "and", "this", "leads", "to", "a", "512", "byte", "memory", "leak", "each", "time", "an", "identical", "existing", "key", "is", "added", "with", "add_key().", "The", "reason", "the", "add_key()", "system", "call", "returns", "okay", "is", "that", "key_create_or_update()", "calls", "__key_link_begin()", "before", "checking", "to", "see", "whether", "it", "can", "update", "a", "key", "directly", "rather", "than", "adding/replacing", "-", "which", "it", "turns", "out", "it", "can.", "Thus", "__key_link()", "is", "not", "called", "through", "__key_instantiate_and_link()", "and", "__key_link_end()", "must", "cancel", "the", "edit.", "Signed-off-by:", "Colin", "Ian", "King", "<colin.king@canonical.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Signed-off-by:", "James", "Morris", "<james.l.morris@oracle.com>"], "code_tokens": ["if", "(", "edit", ")", "{", "if", "(", "!", "edit", "-", ">", "dead_leaf", ")", "{", "key_payload_reserve", "(", "keyring", ",", "keyring", "-", ">", "datalen", "-", "KEYQUOTA_LINK_BYTES", ")", ";", "}</s>if", "(", "edit", "&", "&", "!", "edit", "-", ">", "dead_leaf", ")", "{", "key_payload_reserve", "(", "keyring", ",", "keyring", "-", ">", "datalen", "-", "KEYQUOTA_LINK_BYTES", ")", ";"], "docstring_tokens": ["forgot", "to", "include", "an", "import", "detail", "in", "my", "original", "email"]}
{"contents": ["coredump:", "fix", "race", "condition", "between", "mmget_not_zero()/get_task_mm()", "and", "core", "dumping", "The", "core", "dumping", "code", "has", "always", "run", "without", "holding", "the", "mmap_sem", "for", "writing,", "despite", "that", "is", "the", "only", "way", "to", "ensure", "that", "the", "entire", "vma", "layout", "will", "not", "change", "from", "under", "it.", "Only", "using", "some", "signal", "serialization", "on", "the", "processes", "belonging", "to", "the", "mm", "is", "not", "nearly", "enough.", "This", "was", "pointed", "out", "earlier.", "For", "example", "in", "Hugh's", "post", "from", "Jul", "2017:", "https://lkml.kernel.org/r/alpine.LSU.2.11.1707191716030.2055@eggly.anvils", "\"Not", "strictly", "relevant", "here,", "but", "a", "related", "note:", "I", "was", "very", "surprised", "to", "discover,", "only", "quite", "recently,", "how", "handle_mm_fault()", "may", "be", "called", "without", "down_read(mmap_sem)", "-", "when", "core", "dumping.", "That", "seems", "a", "misguided", "optimization", "to", "me,", "which", "would", "also", "be", "nice", "to", "correct\"", "In", "particular", "because", "the", "growsdown", "and", "growsup", "can", "move", "the", "vm_start/vm_end", "the", "various", "loops", "the", "core", "dump", "does", "around", "the", "vma", "will", "not", "be", "consistent", "if", "page", "faults", "can", "happen", "concurrently.", "Pretty", "much", "all", "users", "calling", "mmget_not_zero()/get_task_mm()", "and", "then", "taking", "the", "mmap_sem", "had", "the", "potential", "to", "introduce", "unexpected", "side", "effects", "in", "the", "core", "dumping", "code.", "Adding", "mmap_sem", "for", "writing", "around", "the", "->core_dump", "invocation", "is", "a", "viable", "long", "term", "fix,", "but", "it", "requires", "removing", "all", "copy", "user", "and", "page", "faults", "and", "to", "replace", "them", "with", "get_dump_page()", "for", "all", "binary", "formats", "which", "is", "not", "suitable", "as", "a", "short", "term", "fix.", "For", "the", "time", "being", "this", "solution", "manually", "covers", "the", "places", "that", "can", "confuse", "the", "core", "dump", "either", "by", "altering", "the", "vma", "layout", "or", "the", "vma", "flags", "while", "it", "runs.", "Once", "->core_dump", "runs", "under", "mmap_sem", "for", "writing", "the", "function", "mmget_still_valid()", "can", "be", "dropped.", "Allowing", "mmap_sem", "protected", "sections", "to", "run", "in", "parallel", "with", "the", "coredump", "provides", "some", "minor", "parallelism", "advantage", "to", "the", "swapoff", "code", "(which", "seems", "to", "be", "safe", "enough", "by", "never", "mangling", "any", "vma", "field", "and", "can", "keep", "doing", "swapins", "in", "parallel", "to", "the", "core", "dumping)", "and", "to", "some", "other", "corner", "case.", "In", "order", "to", "facilitate", "the", "backporting", "I", "added", "\"Fixes:", "86039bd3b4e6\"", "however", "the", "side", "effect", "of", "this", "same", "race", "condition", "in", "/proc/pid/mem", "should", "be", "reproducible", "since", "before", "2.6.12-rc2", "so", "I", "couldn't", "add", "any", "other", "\"Fixes:\"", "because", "there's", "no", "hash", "beyond", "the", "git", "genesis", "commit.", "Because", "find_extend_vma()", "is", "the", "only", "location", "outside", "of", "the", "process", "context", "that", "could", "modify", "the", "\"mm\"", "structures", "under", "mmap_sem", "for", "reading,", "by", "adding", "the", "mmget_still_valid()", "check", "to", "it,", "all", "other", "cases", "that", "take", "the", "mmap_sem", "for", "reading", "don't", "need", "the", "new", "check", "after", "mmget_not_zero()/get_task_mm().", "The", "expand_stack()", "in", "page", "fault", "context", "also", "doesn't", "need", "the", "new", "check,", "because", "all", "tasks", "under", "core", "dumping", "are", "frozen.", "Link:", "http://lkml.kernel.org/r/20190325224949.11068-1-aarcange@redhat.com", "Fixes:", "86039bd3b4e6", "(\"userfaultfd:", "add", "new", "syscall", "to", "provide", "memory", "externalization\")", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Suggested-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Acked-by:", "Peter", "Xu", "<peterx@redhat.com>", "Reviewed-by:", "Mike", "Rapoport", "<rppt@linux.ibm.com>", "Reviewed-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Reviewed-by:", "Jann", "Horn", "<jannh@google.com>", "Acked-by:", "Jason", "Gunthorpe", "<jgg@mellanox.com>", "Acked-by:", "Michal", "Hocko", "<mhocko@suse.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "skip_mm", ";", "skip_mm", ":", "/", "*", "*", "Avoid", "to", "modify", "vma", "-", ">", "vm_flags", "*", "without", "locked", "ops", "while", "the", "*", "coredump", "reads", "the", "vm_flags", ".", "*", "/", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "{", "/", "*", "*", "Silently", "return", "\"", "count", "\"", "*", "like", "if", "get_task_mm", "(", ")", "*", "failed", ".", "FIXME", ":", "should", "this", "*", "function", "have", "returned", "*", "-", "ESRCH", "if", "get_task_mm", "(", ")", "*", "failed", "like", "if", "*", "get_proc_task", "(", ")", "fails", "?", "*", "/", "up_write", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "goto", "out_mm", ";", "}", "/", "*", "no", "task", "can", "run", "(", "and", "in", "turn", "coredump", ")", "yet", "*", "/", "VM_WARN_ON", "(", "!", "mmget_still_valid", "(", "mm", ")", ");", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "skip_mm", ";", "skip_mm", ":", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "out_unlock", ";", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "out_unlock", ";", "/", "*", "*", "This", "has", "to", "be", "called", "after", "a", "get_task_mm", "(", ")/", "mmget_not_zero", "(", ")", "*", "followed", "by", "taking", "the", "mmap_sem", "for", "writing", "before", "modifying", "the", "*", "vmas", "or", "anything", "the", "coredump", "pretends", "not", "to", "change", "from", "under", "it", ".", "*", "*", "NOTE", ":", "find_extend_vma", "(", ")", "called", "from", "GUP", "context", "is", "the", "only", "place", "*", "that", "can", "modify", "the", "\"", "mm", "\"", "(", "notably", "the", "vm_start", "/", "end", ")", "under", "mmap_sem", "*", "for", "reading", "and", "outside", "the", "context", "of", "the", "process", ",", "so", "it", "is", "also", "*", "the", "only", "case", "that", "holds", "the", "mmap_sem", "for", "reading", "that", "must", "call", "*", "this", "function", ".", "Generally", "if", "the", "mmap_sem", "is", "hold", "for", "reading", "*", "there", "'", "s", "no", "need", "of", "this", "check", "after", "get_task_mm", "(", ")/", "mmget_not_zero", "(", ").", "*", "*", "This", "function", "can", "be", "obsoleted", "and", "the", "check", "can", "be", "removed", ",", "after", "*", "the", "coredump", "code", "will", "hold", "the", "mmap_sem", "for", "writing", "before", "*", "invoking", "the", "-", ">", "core_dump", "methods", ".", "*", "/", "static", "inline", "bool", "mmget_still_valid", "(", "struct", "mm_struct", "*", "mm", ")", "{", "return", "likely", "(", "!", "mm", "-", ">", "core_state", ")", ";", "}", "#", "include", "<", "linux", "/", "sched", "/", "mm", ".", "h", ">", "/", "*", "don", "'", "t", "alter", "vm_end", "if", "the", "coredump", "is", "running", "*", "/", "if", "(", "!", "prev", "|", "|", "!", "mmget_still_valid", "(", "mm", ")", "|", "|", "expand_stack", "(", "prev", ",", "addr", ")", ")", "/", "*", "don", "'", "t", "alter", "vm_start", "if", "the", "coredump", "is", "running", "*", "/", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "return", "NULL", ";</s>if", "(", "!", "prev", "|", "|", "expand_stack", "(", "prev", ",", "addr", ")", ")"], "docstring_tokens": ["does", "not", "use", "locking", "or", "other", "mechanisms", "to", "prevent", "vma", "layout", "or", "vma", "flags", "changes", "while", "it", "runs"]}
{"contents": ["Fix", "https://issues.apache.org/bugzilla/show_bug.cgi?id=51872", "Ensure", "access", "log", "always", "logs", "the", "correct", "remote", "IP.", "Ensure", "requests", "with", "multiple", "errors", "do", "not", "result", "in", "multiple", "access", "log", "entries.", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1176592", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["}", "finally", "{", "if", "(", "error", ")", "{", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "if", "(", "!", "error", "&", "&", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "error", "&", "&", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "error", "&", "&", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "error", ")", "{", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "}", "/", "/", "Can", "'", "t", "add", "a", "500", "to", "the", "access", "log", "since", "that", "has", "already", "been", "/", "/", "written", "in", "the", "Adapter", ".", "service", "method", ".", "<", "fix", ">", "Ensure", "that", "the", "access", "log", "always", "uses", "the", "correct", "value", "for", "the", "remote", "IP", "address", "associated", "with", "the", "request", "and", "that", "requests", "with", "multiple", "errors", "do", "not", "result", "in", "multiple", "entires", "in", "the", "access", "log", ".", "(", "markt", ")", "<", "/", "fix", "></s>boolean", "create", "=", "false", ";", "create", "=", "true", ";", "}", "if", "(", "create", ")", "{", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "if", "(", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "if", "(", "!", "cping", "&", "&", "endpoint", ".", "isPaused", "(", "))", "{", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";", "adapter", ".", "log", "(", "request", ",", "response", ",", "0", ")", ";"], "docstring_tokens": ["does", "not", "properly", "perform", "certain", "caching", "and", "recycling", "operations", "involving", "request", "objects"]}
{"contents": ["af_rose/x25:", "Sanity", "check", "the", "maximum", "user", "frame", "size", "Otherwise", "we", "can", "wrap", "the", "sizes", "and", "end", "up", "sending", "garbage.", "Closes", "#10423", "Signed-off-by:", "Alan", "Cox", "<alan@lxorguk.ukuu.org.uk>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["/", "*", "Build", "a", "packet", "-", "the", "conventional", "user", "limit", "is", "236", "bytes", ".", "We", "can", "do", "ludicrously", "large", "NetROM", "frames", "but", "must", "not", "overflow", "*", "/", "if", "(", "len", ">", "65536", ")", "return", "-", "EMSGSIZE", ";", "/", "*", "Sanity", "check", "the", "packet", "size", "*", "/", "if", "(", "len", ">", "65535", ")", "return", "-", "EMSGSIZE", ";", "/", "*", "Sanity", "check", "the", "packet", "size", "*", "/", "if", "(", "len", ">", "65535", ")", "{", "rc", "=", "-", "EMSGSIZE", ";", "goto", "out", ";", "}</s>/", "*", "Build", "a", "packet", "*", "/"], "docstring_tokens": [">", "we", "must", "unlock", "the", "socket", "beforehand"]}
{"contents": ["packet:", "fix", "tp_reserve", "race", "in", "packet_set_ring", "Updates", "to", "tp_reserve", "can", "race", "with", "reads", "of", "the", "field", "in", "packet_set_ring.", "Avoid", "this", "by", "holding", "the", "socket", "lock", "during", "updates", "in", "setsockopt", "PACKET_RESERVE.", "This", "bug", "was", "discovered", "by", "syzkaller.", "Fixes:", "8913336a7e8d", "(\"packet:", "add", "PACKET_RESERVE", "sockopt\")", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Willem", "de", "Bruijn", "<willemb@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["lock_sock", "(", "sk", ")", ";", "if", "(", "po", "-", ">", "rx_ring", ".", "pg_vec", "|", "|", "po", "-", ">", "tx_ring", ".", "pg_vec", ")", "{", "ret", "=", "-", "EBUSY", ";", "}", "else", "{", "po", "-", ">", "tp_reserve", "=", "val", ";", "ret", "=", "0", ";", "}", "release_sock", "(", "sk", ")", ";", "return", "ret", ";</s>if", "(", "po", "-", ">", "rx_ring", ".", "pg_vec", "|", "|", "po", "-", ">", "tx_ring", ".", "pg_vec", ")", "return", "-", "EBUSY", ";", "po", "-", ">", "tp_reserve", "=", "val", ";", "return", "0", ";"], "docstring_tokens": ["improper", "bounds", "checking"]}
{"contents": ["fork:", "record", "start_time", "late", "This", "changes", "the", "fork(2)", "syscall", "to", "record", "the", "process", "start_time", "after", "initializing", "the", "basic", "task", "structure", "but", "still", "before", "making", "the", "new", "process", "visible", "to", "user-space.", "Technically,", "we", "could", "record", "the", "start_time", "anytime", "during", "fork(2).", "But", "this", "might", "lead", "to", "scenarios", "where", "a", "start_time", "is", "recorded", "long", "before", "a", "process", "becomes", "visible", "to", "user-space.", "For", "instance,", "with", "userfaultfd(2)", "and", "TLS,", "user-space", "can", "delay", "the", "execution", "of", "fork(2)", "for", "an", "indefinite", "amount", "of", "time", "(and", "will,", "if", "this", "causes", "network", "access,", "or", "similar).", "By", "recording", "the", "start_time", "late,", "it", "much", "closer", "reflects", "the", "point", "in", "time", "where", "the", "process", "becomes", "live", "and", "can", "be", "observed", "by", "other", "processes.", "Lastly,", "this", "makes", "it", "much", "harder", "for", "user-space", "to", "predict", "and", "control", "the", "start_time", "they", "get", "assigned.", "Previously,", "user-space", "could", "fork", "a", "process", "and", "stall", "it", "in", "copy_thread_tls()", "before", "its", "pid", "is", "allocated,", "but", "after", "its", "start_time", "is", "recorded.", "This", "can", "be", "misused", "to", "later-on", "cycle", "through", "PIDs", "and", "resume", "the", "stalled", "fork(2)", "yielding", "a", "process", "that", "has", "the", "same", "pid", "and", "start_time", "as", "a", "process", "that", "existed", "before.", "This", "can", "be", "used", "to", "circumvent", "security", "systems", "that", "identify", "processes", "by", "their", "pid+start_time", "combination.", "Even", "though", "user-space", "was", "always", "aware", "that", "start_time", "recording", "is", "flaky", "(but", "several", "projects", "are", "known", "to", "still", "rely", "on", "start_time-based", "identification),", "changing", "the", "start_time", "to", "be", "recorded", "late", "will", "help", "mitigate", "existing", "attacks", "and", "make", "it", "much", "harder", "for", "user-space", "to", "control", "the", "start_time", "a", "process", "gets", "assigned.", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Tom", "Gundersen", "<teg@jklm.no>", "Signed-off-by:", "David", "Herrmann", "<dh.herrmann@gmail.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "*", "From", "this", "point", "on", "we", "must", "avoid", "any", "synchronous", "user", "-", "space", "*", "communication", "until", "we", "take", "the", "tasklist", "-", "lock", ".", "In", "particular", ",", "we", "do", "*", "not", "want", "user", "-", "space", "to", "be", "able", "to", "predict", "the", "process", "start", "-", "time", "by", "*", "stalling", "fork", "(", "2", ")", "after", "we", "recorded", "the", "start_time", "but", "before", "it", "is", "*", "visible", "to", "the", "system", ".", "*", "/", "p", "-", ">", "start_time", "=", "ktime_get_ns", "(", ");", "p", "-", ">", "real_start_time", "=", "ktime_get_boot_ns", "(", ");</s>p", "-", ">", "start_time", "=", "ktime_get_ns", "(", ");", "p", "-", ">", "real_start_time", "=", "ktime_get_boot_ns", "(", ");"], "docstring_tokens": ["and", "therefore", "authorization", "decisions", "are", "improperly", "cached", "."]}
{"contents": ["[SPARK-20922][CORE]", "Add", "whitelist", "of", "classes", "that", "can", "be", "deserialized", "by", "the", "launcher.", "Blindly", "deserializing", "classes", "using", "Java", "serialization", "opens", "the", "code", "up", "to", "issues", "in", "other", "libraries,", "since", "just", "deserializing", "data", "from", "a", "stream", "may", "end", "up", "execution", "code", "(think", "readObject()).", "Since", "the", "launcher", "protocol", "is", "pretty", "self-contained,", "there's", "just", "a", "handful", "of", "classes", "it", "legitimately", "needs", "to", "deserialize,", "and", "they're", "in", "just", "two", "packages,", "so", "add", "a", "filter", "that", "throws", "errors", "if", "classes", "from", "any", "other", "package", "show", "up", "in", "the", "stream.", "This", "also", "maintains", "backwards", "compatibility", "(the", "updated", "launcher", "code", "can", "still", "communicate", "with", "the", "backend", "code", "in", "older", "Spark", "releases).", "Tested", "with", "new", "and", "existing", "unit", "tests.", "Author:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>", "Closes", "#18166", "from", "vanzin/SPARK-20922.", "(cherry", "picked", "from", "commit", "8efc6e986554ae66eab93cd64a9035d716adbab0)", "Signed-off-by:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>"], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "spark", ".", "launcher", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "An", "object", "input", "stream", "that", "only", "allows", "classes", "used", "by", "the", "launcher", "protocol", "to", "be", "in", "the", "*", "serialized", "stream", ".", "See", "SPARK", "-", "20922", ".", "*", "/", "class", "FilteredObjectInputStream", "extends", "ObjectInputStream", "{", "private", "static", "final", "List", "<", "String", ">", "ALLOWED_PACKAGES", "=", "Arrays", ".", "asList", "(", "\"", "org", ".", "apache", ".", "spark", ".", "launcher", ".", "\",", "\"", "java", ".", "lang", ".", "\")", ";", "FilteredObjectInputStream", "(", "InputStream", "is", ")", "throws", "IOException", "{", "super", "(", "is", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "boolean", "isValid", "=", "ALLOWED_PACKAGES", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ");", "if", "(", "!", "isValid", ")", "{", "throw", "new", "IllegalArgumentException", "(", "String", ".", "format", "(", "\"", "Unexpected", "class", "in", "stream", ":", "%", "s", "\"", ",", "desc", ".", "getName", "(", "))", ");", "}", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "FilteredObjectInputStream", "in", "=", "new", "FilteredObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "@", "Test", "public", "void", "testStreamFiltering", "(", ")", "throws", "Exception", "{", "ChildProcAppHandle", "handle", "=", "LauncherServer", ".", "newAppHandle", "(", ");", "TestClient", "client", "=", "null", ";", "try", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "client", ".", "send", "(", "new", "EvilPayload", "(", "))", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "assertEquals", "(", "0", ",", "EvilPayload", ".", "EVIL_BIT", ")", ";", "}", "finally", "{", "kill", "(", "handle", ")", ";", "close", "(", "client", ")", ";", "client", ".", "clientThread", ".", "join", "(", ");", "}", "}", "/", "**", "*", "Try", "a", "few", "times", "to", "get", "a", "client", "-", "side", "error", ",", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "*", "server", "-", "side", "close", "immediately", ".", "*", "/", "private", "void", "waitForError", "(", "TestClient", "client", ",", "String", "secret", ")", "throws", "Exception", "{", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "secret", ",", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "error", "but", "message", "went", "through", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "}", "private", "static", "class", "EvilPayload", "extends", "LauncherProtocol", ".", "Message", "{", "static", "int", "EVIL_BIT", "=", "0", ";", "/", "/", "This", "field", "should", "cause", "the", "launcher", "server", "to", "throw", "an", "error", "and", "not", "deserialize", "the", "/", "/", "message", ".", "private", "List", "<", "String", ">", "notAllowedField", "=", "Arrays", ".", "asList", "(", "\"", "disallowed", "\"", ");", "private", "void", "readObject", "(", "ObjectInputStream", "stream", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "stream", ".", "defaultReadObject", "(", ");", "EVIL_BIT", "=", "1", ";", "}", "}</s>import", "java", ".", "io", ".", "ObjectInputStream", ";", "ObjectInputStream", "in", "=", "new", "ObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "/", "/", "Try", "a", "few", "times", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "server", "-", "side", "close", "/", "/", "immediately", ".", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "handle", ".", "getSecret", "(", "),", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "exception", "caused", "by", "connection", "timeout", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}"], "docstring_tokens": ["performs", "unsafe", "deserialization", "of", "data", "received", "by", "its", "socket", "."]}
{"contents": ["Fix", "OID", "handling:", "-", "Upon", "parsing,", "reject", "OIDs", "with", "invalid", "base-128", "encoding.", "-", "Always", "NUL-terminate", "the", "destination", "buffer", "in", "OBJ_obj2txt", "printing", "function.", "Reviewed-by:", "Dr.", "Stephen", "Henson", "<steve@openssl.org>", "Reviewed-by:", "Kurt", "Roeckx", "<kurt@openssl.org>", "Reviewed-by:", "Tim", "Hudson", "<tjh@openssl.org>"], "code_tokens": ["int", "i", ",", "length", ";", "/", "*", "Sanity", "check", "OID", "encoding", ".", "*", "Need", "at", "least", "one", "content", "octet", ".", "*", "MSB", "must", "be", "clear", "in", "the", "last", "octet", ".", "*", "can", "'", "t", "have", "leading", "0x80", "in", "subidentifiers", ",", "see", ":", "X", ".", "690", "8", ".", "19", ".", "2", "if", "(", "len", "<", "=", "0", "|", "|", "len", ">", "INT_MAX", "|", "|", "pp", "=", "=", "NULL", "|", "|", "(", "p", "=", "*", "pp", ")", "=", "=", "NULL", "|", "|", "p", "[", "len", "-", "1", "]", "&", "0x80", ")", "{", "ASN1err", "(", "ASN1_F_C2I_ASN1_OBJECT", ",", "ASN1_R_INVALID_OBJECT_ENCODING", ")", ";", "return", "NULL", ";", "}", "/", "*", "Now", "0", "<", "len", "<", "=", "INT_MAX", ",", "so", "the", "cast", "is", "safe", ".", "*", "/", "length", "=", "(", "int", ")", "len", ";", "for", "(", "i", "=", "0", ";", "i", "<", "length", ";", "i", "+", "+,", "p", "+", "+)", "if", "(", "(", "data", "=", "=", "NULL", ")", "|", "|", "(", "ret", "-", ">", "length", "<", "length", ")", ")", "data", "=", "(", "unsigned", "char", "*", ")", "OPENSSL_malloc", "(", "length", ")", ";", "memcpy", "(", "data", ",", "p", ",", "length", ")", ";", "ret", "-", ">", "length", "=", "length", ";", "p", "+", "=", "length", ";", "/", "*", "Ensure", "that", ",", "at", "every", "state", ",", "|", "buf", "|", "is", "NUL", "-", "terminated", ".", "*", "/", "if", "(", "buf", "&", "&", "buf_len", ">", "0", ")", "buf", "[", "0", "]", "=", "'", "\\", "0", "'", ";", "if", "(", "(", "a", "=", "=", "NULL", ")", "|", "|", "(", "a", "-", ">", "data", "=", "=", "NULL", ")", ")", "return", "(", "0", ")", ";", "if", "(", "buf", "&", "&", "(", "buf_len", ">", "1", ")", ")", "*", "buf", "=", "'", "\\", "0", "'", ";", "if", "(", "buf_len", ">", "1", ")", "*", "buf", "=", "'", "\\", "0", "'", ";</s>int", "i", ";", "/", "*", "Sanity", "check", "OID", "encoding", ":", "can", "'", "t", "have", "leading", "0x80", "in", "*", "subidentifiers", ",", "see", ":", "X", ".", "690", "8", ".", "19", ".", "2", "for", "(", "i", "=", "0", ",", "p", "=", "*", "pp", ";", "i", "<", "len", ";", "i", "+", "+,", "p", "+", "+)", "if", "(", "(", "data", "=", "=", "NULL", ")", "|", "|", "(", "ret", "-", ">", "length", "<", "len", ")", ")", "data", "=", "(", "unsigned", "char", "*", ")", "OPENSSL_malloc", "(", "len", "?", "(", "int", ")", "len", ":", "1", ")", ";", "memcpy", "(", "data", ",", "p", ",", "(", "int", ")", "len", ")", ";", "ret", "-", ">", "length", "=", "(", "int", ")", "len", ";", "p", "+", "=", "len", ";", "if", "(", "(", "a", "=", "=", "NULL", ")", "|", "|", "(", "a", "-", ">", "data", "=", "=", "NULL", ")", ")", "{", "buf", "[", "0", "]", "='", "\\", "0", "'", ";", "return", "(", "0", ")", ";", "}", "if", "(", "buf", "&", "&", "(", "buf_len", ">", "0", ")", ")", "if", "(", "buf_len", ">", "0", ")"], "docstring_tokens": ["does", "not", "ensure", "the", "presence", "of", "'\\0", "'", "characters"]}
{"contents": ["Verifies", "resources", "are", "in", "allowed", "locations"], "code_tokens": ["import", "java", ".", "util", ".", "ArrayList", ";", "ArrayList", "<", "Resource", ">", "locationResources", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "!", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "locationResources", ".", "add", "(", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ");", "}", "}", "for", "(", "Resource", "location", ":", "locationResources", ")", "{", "Resource", "file", "=", "location", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", ")", "&", "&", "PathUtils", ".", "checkResource", "(", "file", ",", "location", ",", "locationResources", ")", ")", "{", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "/", "**", "*", "Perform", "additional", "checks", "on", "a", "resolved", "resource", "beyond", "checking", "whether", "the", "*", "resources", "exists", "and", "is", "readable", ".", "The", "default", "implementation", "also", "verifies", "the", "*", "resource", "is", "either", "under", "the", "location", "relative", "to", "which", "it", "was", "found", "or", "is", "under", "*", "one", "of", "the", "{", "@", "link", "#", "setAllowedLocations", "allowed", "locations", "}", ".", "*", "@", "param", "resource", "the", "resource", "to", "check", "*", "@", "param", "location", "the", "location", "relative", "to", "which", "the", "resource", "was", "found", "*", "@", "param", "allowedLocations", "set", "of", "allowed", "locations", "*", "@", "return", "\"", "true", "\"", "if", "resource", "is", "in", "a", "valid", "location", ",", "\"", "false", "\"", "otherwise", ".", "*", "@", "throws", "IOException", "if", "Resource", "URLS", "fail", "to", "parse", ".", "*", "@", "since", "4", ".", "1", ".", "2", "*", "/", "public", "static", "boolean", "checkResource", "(", "Resource", "resource", ",", "Resource", "location", ",", "List", "<", "Resource", ">", "allowedLocations", ")", "throws", "IOException", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "location", ")", ")", "{", "return", "true", ";", "}", "if", "(", "allowedLocations", "!", "=", "null", ")", "{", "for", "(", "Resource", "current", ":", "allowedLocations", ")", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "current", ")", ")", "{", "return", "true", ";", "}", "}", "}", "if", "(", "logger", ".", "isWarnEnabled", "(", "))", "{", "logger", ".", "warn", "(", "\"", "Resource", "path", "\\", "\"\"", "+", "location", ".", "getURI", "(", ")", "+", "\"", "\\\"", "was", "successfully", "resolved", "\"", "+", "\"", "but", "resource", "\\", "\"\"", "+", "resource", ".", "getURL", "(", ")", "+", "\"", "\\\"", "is", "neither", "under", "the", "\"", "+", "\"", "current", "location", "\\", "\"\"", "+", "location", ".", "getURL", "(", ")", "+", "\"", "\\\"", "nor", "under", "any", "of", "the", "\"", "+", "\"", "allowed", "locations", "\"", "+", "(", "allowedLocations", "!", "=", "null", "?", "allowedLocations", ":", "\"", "[]", "\")", ");", "}", "return", "false", ";", "}", "private", "static", "boolean", "isResourceUnderLocation", "(", "Resource", "resource", ",", "Resource", "location", ")", "throws", "IOException", "{", "if", "(", "resource", ".", "getClass", "(", ")", "!", "=", "location", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "String", "resourcePath", ";", "String", "locationPath", ";", "if", "(", "resource", "instanceof", "UrlResource", ")", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "toString", "(", "))", ";", "}", "else", "if", "(", "resource", "instanceof", "ClassPathResource", ")", "{", "resourcePath", "=", "(", "(", "ClassPathResource", ")", "resource", ")", ".", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "((", "ClassPathResource", ")", "location", ")", ".", "getPath", "(", "))", ";", "}", "else", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "getPath", "(", "))", ";", "}", "if", "(", "locationPath", ".", "equals", "(", "resourcePath", ")", ")", "{", "return", "true", ";", "}", "locationPath", "=", "(", "locationPath", ".", "endsWith", "(", "\"/", "\")", "|", "|", "locationPath", ".", "isEmpty", "(", ")", "?", "locationPath", ":", "locationPath", "+", "\"", "/\"", ");", "return", "(", "resourcePath", ".", "startsWith", "(", "locationPath", ")", "&", "&", "!", "isInvalidEncodedPath", "(", "resourcePath", ")", ");", "}", "@", "Test", "public", "void", "invalidPathEncodedSlash", "(", ")", "{", "String", "file", "=", "System", ".", "getProperty", "(", "\"", "user", ".", "dir", "\"", ");", "file", "=", "file", ".", "replaceFirst", "(", "\"\\", "\\/", "\",", "\"", "%", "2f", "\"", ");", "file", "+", "=", "\"", "/", "src", "/", "test", "/", "resources", "/", "ssh", "/", "key", "\"", ";", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "\")", ";", "this", ".", "output", ".", "expect", "(", "containsString", "(", "\"", "is", "neither", "under", "the", "current", "location", "\"", "))", ";", "this", ".", "repository", ".", "findOne", "(", "\"", "blah", "\"", ",", "\"", "local", "\"", ",", "\"", "master", "\"", ",", "file", ")", ";", "}</s>for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "continue", ";", "}", "Resource", "file", "=", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", "))", "{"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "request"]}
{"contents": ["Issue", "#3319", "-", "Refactoring", "DefaultServlet", "Index/Listing", "+", "Now", "generates", "valid", "HTML5", "+", "Now", "allows", "column", "sort", "Signed-off-by:", "Joakim", "Erdfelt", "<joakim.erdfelt@gmail.com>"], "code_tokens": ["request", ".", "getPathInfo", "(", ").", "lastIndexOf", "(", "\"/", "\")", ">", "0", ",", "request", ".", "getQueryString", "(", "))", ";", "String", "listing", "=", "resource", ".", "getListHTML", "(", "request", ".", "getRequestURI", "(", "),", "request", ".", "getPathInfo", "(", ").", "lastIndexOf", "(", "\"/", "\")", ">", "0", ",", "request", ".", "getQueryString", "(", "))", ";", "String", "dir", "=", "resource", ".", "getListHTML", "(", "base", ",", "pathInContext", ".", "length", "(", ")>", "1", ",", "request", ".", "getQueryString", "(", "))", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "File", "one", "=", "new", "File", "(", "resBase", ",", "\"", "one", "\"", ");", "assertTrue", "(", "one", ".", "mkdir", "(", "))", ";", "File", "alert", "=", "new", "File", "(", "one", ",", "\"", "onmouseclick", "=", "'", "alert", "(", "oops", ")", "'\"", ");", "FS", ".", "touch", "(", "alert", ")", ";", "req1", "=", "new", "StringBuffer", "(", ");", "req1", ".", "append", "(", "\"", "GET", "/", "context", "/", "one", "/", ";\\", "\"", "onmouseover", "=", "'", "alert", "(", "document", ".", "location", ")", "'", "HTTP", "/", "1", ".", "0", "\\", "n", "\"", ");", "req1", ".", "append", "(", "\"\\", "n", "\"", ");", "response", "=", "connector", ".", "getResponses", "(", "req1", ".", "toString", "(", "))", ";", "assertResponseNotContains", "(", "\"\\", "\"", "onmouseover", "\"", ",", "response", ")", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "MultiMap", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "UrlEncoded", ";", "import", "static", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ".", "UTF_8", ";", "public", "String", "getListHTML", "(", "String", "base", ",", "boolean", "parent", ")", "throws", "IOException", "{", "return", "getListHTML", "(", "base", ",", "parent", ",", "null", ")", ";", "}", "/", "**", "Get", "the", "resource", "list", "as", "a", "HTML", "directory", "listing", ".", "*", "@", "param", "base", "The", "base", "URL", "*", "@", "param", "parent", "True", "if", "the", "parent", "directory", "should", "be", "included", "*", "@", "param", "query", "query", "params", "*", "@", "return", "String", "of", "HTML", "*", "/", "public", "String", "getListHTML", "(", "String", "base", ",", "boolean", "parent", ",", "String", "query", ")", "throws", "IOException", "if", "(", "ls", "=", "=", "null", ")", "{", "}", "boolean", "sortOrderAscending", "=", "true", ";", "String", "sortColumn", "=", "\"", "N", "\"", ";", "/", "/", "name", "(", "or", "\"", "M", "\"", "for", "Last", "Modified", ",", "or", "\"", "S", "\"", "for", "Size", ")", "/", "/", "check", "for", "query", "if", "(", "query", "!", "=", "null", ")", "{", "MultiMap", "<", "String", ">", "params", "=", "new", "MultiMap", "<", ">(", ");", "byte", "[", "]", "rawQuery", "=", "query", ".", "getBytes", "(", "UTF_8", ")", ";", "UrlEncoded", ".", "decodeUtf8To", "(", "rawQuery", ",", "0", ",", "query", ".", "length", "(", "),", "params", ")", ";", "String", "paramO", "=", "params", ".", "getString", "(", "\"", "O", "\"", ");", "String", "paramC", "=", "params", ".", "getString", "(", "\"", "C", "\"", ");", "if", "(", "StringUtil", ".", "isNotBlank", "(", "paramO", ")", ")", "{", "if", "(", "paramO", ".", "equals", "(", "\"", "A", "\"", "))", "{", "sortOrderAscending", "=", "true", ";", "}", "else", "if", "(", "paramO", ".", "equals", "(", "\"", "D", "\"", "))", "{", "sortOrderAscending", "=", "false", ";", "}", "}", "if", "(", "StringUtil", ".", "isNotBlank", "(", "paramC", ")", ")", "{", "if", "(", "paramC", ".", "equals", "(", "\"", "N", "\"", ")", "|", "|", "paramC", ".", "equals", "(", "\"", "M", "\"", ")", "|", "|", "paramC", ".", "equals", "(", "\"", "S", "\"", "))", "{", "sortColumn", "=", "paramC", ";", "}", "}", "}", "/", "/", "Gather", "up", "entries", "List", "<", "Resource", ">", "items", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ls", ".", "length", ";", "i", "+", "+)", "{", "Resource", "item", "=", "addPath", "(", "ls", "[", "i", "]", ");", "items", ".", "add", "(", "item", ")", ";", "}", "/", "/", "Perform", "sort", "if", "(", "sortColumn", ".", "equals", "(", "\"", "M", "\"", "))", "{", "Collections", ".", "sort", "(", "items", ",", "ResourceCollators", ".", "byLastModified", "(", "sortOrderAscending", ")", ");", "}", "else", "if", "(", "sortColumn", ".", "equals", "(", "\"", "S", "\"", "))", "{", "Collections", ".", "sort", "(", "items", ",", "ResourceCollators", ".", "bySize", "(", "sortOrderAscending", ")", ");", "}", "else", "{", "Collections", ".", "sort", "(", "items", ",", "ResourceCollators", ".", "byName", "(", "sortOrderAscending", ")", ");", "}", "String", "title", "=", "\"", "Directory", ":", "\"", "+", "deTag", "(", "decodedBase", ")", ";", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "4096", ")", ";", "/", "/", "Doctype", "Declaration", "(", "HTML5", ")", "buf", ".", "append", "(", "\"<", "!", "DOCTYPE", "html", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "html", "lang", "=", "\\\"", "en", "\\", "\">", "\\", "n", "\"", ");", "/", "/", "HTML", "Header", "buf", ".", "append", "(", "\"<", "head", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "meta", "charset", "=", "\\\"", "utf", "-", "8", "\\", "\">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "link", "href", "=", "\\\"", "jetty", "-", "dir", ".", "css", "\\", "\"", "rel", "=", "\\\"", "stylesheet", "\\", "\"", "/", ">\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "title", ">", "\")", ";", "buf", ".", "append", "(", "\"<", "/", "title", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "/", "head", ">", "\\", "n", "\"", ");", "/", "/", "HTML", "Body", "buf", ".", "append", "(", "\"<", "body", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "h1", "class", "=", "\\\"", "title", "\\", "\">", "\")", ".", "append", "(", "title", ")", ".", "append", "(", "\"<", "/", "h1", ">", "\\", "n", "\"", ");", "/", "/", "HTML", "Table", "final", "String", "ARROW_DOWN", "=", "\"", "&", "nbsp", ";", "&", "#", "8681", ";", "\";", "final", "String", "ARROW_UP", "=", "\"", "&", "nbsp", ";", "&", "#", "8679", ";", "\";", "String", "arrow", ";", "String", "order", ";", "buf", ".", "append", "(", "\"<", "table", "class", "=", "\\\"", "listing", "\\", "\">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "thead", ">", "\\", "n", "\"", ");", "arrow", "=", "\"", "\";", "order", "=", "\"", "A", "\"", ";", "if", "(", "sortColumn", ".", "equals", "(", "\"", "N", "\"", "))", "if", "(", "sortOrderAscending", ")", "{", "order", "=", "\"", "D", "\"", ";", "arrow", "=", "ARROW_UP", ";", "}", "else", "{", "order", "=", "\"", "A", "\"", ";", "arrow", "=", "ARROW_DOWN", ";", "}", "buf", ".", "append", "(", "\"<", "tr", ">", "<", "th", "class", "=", "\\\"", "name", "\\", "\">", "<", "a", "href", "=", "\\\"", "?", "C", "=", "N", "&", "O", "=", "\")", ".", "append", "(", "order", ")", ".", "append", "(", "\"\\", "\">", "\")", ";", "buf", ".", "append", "(", "\"", "Name", "\"", ").", "append", "(", "arrow", ")", ";", "buf", ".", "append", "(", "\"<", "/", "a", ">", "</", "th", ">", "\")", ";", "arrow", "=", "\"", "\";", "order", "=", "\"", "A", "\"", ";", "if", "(", "sortColumn", ".", "equals", "(", "\"", "M", "\"", "))", "{", "if", "(", "sortOrderAscending", ")", "{", "order", "=", "\"", "D", "\"", ";", "arrow", "=", "ARROW_UP", ";", "}", "else", "{", "order", "=", "\"", "A", "\"", ";", "arrow", "=", "ARROW_DOWN", ";", "}", "}", "buf", ".", "append", "(", "\"<", "th", "class", "=", "\\\"", "lastmodified", "\\", "\">", "<", "a", "href", "=", "\\\"", "?", "C", "=", "M", "&", "O", "=", "\")", ".", "append", "(", "order", ")", ".", "append", "(", "\"\\", "\">", "\")", ";", "buf", ".", "append", "(", "\"", "Last", "Modified", "\"", ").", "append", "(", "arrow", ")", ";", "buf", ".", "append", "(", "\"<", "/", "a", ">", "</", "th", ">", "\")", ";", "arrow", "=", "\"", "\";", "order", "=", "\"", "A", "\"", ";", "if", "(", "sortColumn", ".", "equals", "(", "\"", "S", "\"", "))", "{", "if", "(", "sortOrderAscending", ")", "{", "order", "=", "\"", "D", "\"", ";", "arrow", "=", "ARROW_UP", ";", "}", "else", "{", "order", "=", "\"", "A", "\"", ";", "arrow", "=", "ARROW_DOWN", ";", "}", "}", "buf", ".", "append", "(", "\"<", "th", "class", "=", "\\\"", "size", "\\", "\">", "<", "a", "href", "=", "\\\"", "?", "C", "=", "S", "&", "O", "=", "\")", ".", "append", "(", "order", ")", ".", "append", "(", "\"\\", "\">", "\")", ";", "buf", ".", "append", "(", "\"", "Size", "\"", ").", "append", "(", "arrow", ")", ";", "buf", ".", "append", "(", "\"<", "/", "a", ">", "</", "th", ">", "</", "tr", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "/", "thead", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "tbody", ">", "\\", "n", "\"", ");", "if", "(", "parent", ")", "{", "/", "/", "Name", "buf", ".", "append", "(", "\"<", "tr", ">", "<", "td", "class", "=", "\\\"", "name", "\\", "\">", "<", "a", "href", "=", "\\\"", "\")", ";", "buf", ".", "append", "(", "URIUtil", ".", "addPaths", "(", "encodedBase", ",", "\".", "./", "\")", ");", "buf", ".", "append", "(", "\"\\", "\">", "Parent", "Directory", "<", "/", "a", ">", "</", "td", ">", "\")", ";", "/", "/", "Last", "Modified", "buf", ".", "append", "(", "\"<", "td", "class", "=", "\\\"", "lastmodified", "\\", "\">", "-<", "/", "td", ">", "\")", ";", "/", "/", "Size", "buf", ".", "append", "(", "\"<", "td", ">", "-<", "/", "td", ">", "\")", ";", "buf", ".", "append", "(", "\"<", "/", "tr", ">", "\\", "n", "\"", ");", "}", "for", "(", "Resource", "item", ":", "items", ")", "String", "name", "=", "item", ".", "getName", "(", ");", "int", "slashIdx", "=", "name", ".", "lastIndexOf", "(", "'/", "')", ";", "if", "(", "slashIdx", "!", "=", "-", "1", ")", "{", "name", "=", "name", ".", "substring", "(", "slashIdx", "+", "1", ")", ";", "}", "/", "/", "Name", "buf", ".", "append", "(", "\"<", "tr", ">", "<", "td", "class", "=", "\\\"", "name", "\\", "\">", "<", "a", "href", "=", "\\\"", "\")", ";", "String", "path", "=", "URIUtil", ".", "addPaths", "(", "encodedBase", ",", "URIUtil", ".", "encodePath", "(", "name", ")", ");", "{", "}", "buf", ".", "append", "(", "deTag", "(", "name", ")", ");", "if", "(", "item", ".", "isDirectory", "(", ")", "&", "&", "!", "path", ".", "endsWith", "(", "\"/", "\")", ")", "{", "buf", ".", "append", "(", "URIUtil", ".", "SLASH", ")", ";", "}", "buf", ".", "append", "(", "\"<", "/", "a", ">", "</", "td", ">", "\")", ";", "/", "/", "Last", "Modified", "buf", ".", "append", "(", "\"<", "td", "class", "=", "\\\"", "lastmodified", "\\", "\">", "\")", ";", "buf", ".", "append", "(", "\"<", "/", "td", ">", "\")", ";", "/", "/", "Size", "buf", ".", "append", "(", "\"<", "td", "class", "=", "\\\"", "size", "\\", "\">", "\")", ";", "buf", ".", "append", "(", "String", ".", "format", "(", "\"%", ",", "d", "\"", ",", "item", ".", "length", "(", "))", ");", "buf", ".", "append", "(", "\"", "bytes", "&", "nbsp", ";", "</", "td", ">", "</", "tr", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "/", "tbody", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "/", "table", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "/", "body", ">", "</", "html", ">", "\\", "n", "\"", ");", "/", "/", "/", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "/", "/", "Copyright", "(", "c", ")", "1995", "-", "2018", "Mort", "Bay", "Consulting", "Pty", ".", "Ltd", ".", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "/", "/", "All", "rights", "reserved", ".", "This", "program", "and", "the", "accompanying", "materials", "/", "/", "are", "made", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "v1", ".", "0", "/", "/", "and", "Apache", "License", "v2", ".", "0", "which", "accompanies", "this", "distribution", ".", "/", "/", "/", "/", "The", "Eclipse", "Public", "License", "is", "available", "at", "/", "/", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "v10", ".", "html", "/", "/", "/", "/", "The", "Apache", "License", "v2", ".", "0", "is", "available", "at", "/", "/", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "apache2", ".", "0", ".", "php", "/", "/", "/", "/", "You", "may", "elect", "to", "redistribute", "this", "code", "under", "either", "of", "these", "licenses", ".", "/", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "/", "/", "package", "org", ".", "eclipse", ".", "jetty", ".", "util", ".", "resource", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "public", "class", "ResourceCollators", "{", "private", "static", "Comparator", "<", "?", "super", "Resource", ">", "BY_NAME_ASCENDING", "=", "new", "Comparator", "<", "Resource", ">", "()", "{", "@", "Override", "public", "int", "compare", "(", "Resource", "o1", ",", "Resource", "o2", ")", "{", "return", "o1", ".", "getName", "(", ").", "compareTo", "(", "o2", ".", "getName", "(", "))", ";", "}", "}", ";", "private", "static", "Comparator", "<", "?", "super", "Resource", ">", "BY_NAME_DESCENDING", "=", "Collections", ".", "reverseOrder", "(", "BY_NAME_ASCENDING", ")", ";", "private", "static", "Comparator", "<", "?", "super", "Resource", ">", "BY_LAST_MODIFIED_ASCENDING", "=", "new", "Comparator", "<", "Resource", ">", "()", "{", "@", "Override", "public", "int", "compare", "(", "Resource", "o1", ",", "Resource", "o2", ")", "{", "return", "(", "int", ")", "(", "o1", ".", "lastModified", "(", ")", "-", "o2", ".", "lastModified", "(", "))", ";", "}", "}", ";", "private", "static", "Comparator", "<", "?", "super", "Resource", ">", "BY_LAST_MODIFIED_DESCENDING", "=", "Collections", ".", "reverseOrder", "(", "BY_LAST_MODIFIED_ASCENDING", ")", ";", "private", "static", "Comparator", "<", "?", "super", "Resource", ">", "BY_SIZE_ASCENDING", "=", "new", "Comparator", "<", "Resource", ">", "()", "{", "@", "Override", "public", "int", "compare", "(", "Resource", "o1", ",", "Resource", "o2", ")", "{", "return", "(", "int", ")", "(", "o1", ".", "length", "(", ")", "-", "o2", ".", "length", "(", "))", ";", "}", "}", ";", "private", "static", "Comparator", "<", "?", "super", "Resource", ">", "BY_SIZE_DESCENDING", "=", "Collections", ".", "reverseOrder", "(", "BY_SIZE_ASCENDING", ")", ";", "public", "static", "Comparator", "<", "?", "super", "Resource", ">", "byLastModified", "(", "boolean", "sortOrderAscending", ")", "{", "if", "(", "sortOrderAscending", ")", "{", "return", "BY_LAST_MODIFIED_ASCENDING", ";", "}", "else", "{", "return", "BY_LAST_MODIFIED_DESCENDING", ";", "}", "}", "public", "static", "Comparator", "<", "?", "super", "Resource", ">", "byName", "(", "boolean", "sortOrderAscending", ")", "{", "if", "(", "sortOrderAscending", ")", "{", "return", "BY_NAME_ASCENDING", ";", "}", "else", "{", "return", "BY_NAME_DESCENDING", ";", "}", "}", "public", "static", "Comparator", "<", "?", "super", "Resource", ">", "bySize", "(", "boolean", "sortOrderAscending", ")", "{", "if", "(", "sortOrderAscending", ")", "{", "return", "BY_SIZE_ASCENDING", ";", "}", "else", "{", "return", "BY_SIZE_DESCENDING", ";", "}", "}", "}", "@", "@", "-", "1", ",", "30", "+", "1", ",", "48", "@", "@", "body", "{", "font", "-", "family", ":", "sans", "-", "serif", ";", "h1", ".", "title", "{", "table", ".", "listing", "{", "border", ":", "0px", ";", "}", "thead", "a", "{", "color", ":", "blue", ";", "}", "thead", "th", "{", "border", "-", "bottom", ":", "black", "1px", "solid", ";", "}", ".", "name", ",", ".", "lastmodified", "{", "text", "-", "align", ":", "left", ";", "padding", "-", "right", ":", "15px", ";", "}", ".", "size", "{", "text", "-", "align", ":", "right", ";", "}", "a", "{", "td", "{", "padding", ":", "2px", ";</s>request", ".", "getPathInfo", "(", ").", "lastIndexOf", "(", "\"/", "\")", ">", "0", ")", ";", "String", "listing", "=", "resource", ".", "getListHTML", "(", "request", ".", "getRequestURI", "(", "),", "request", ".", "getPathInfo", "(", ").", "lastIndexOf", "(", "\"/", "\")", ">", "0", ")", ";", "String", "dir", "=", "resource", ".", "getListHTML", "(", "base", ",", "pathInContext", ".", "length", "(", ")>", "1", ")", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "assertTrue", "(", "new", "File", "(", "resBase", ",", "\"", "one", "\"", ").", "mkdir", "(", "))", ";", "public", "String", "getListHTML", "(", "String", "base", ",", "boolean", "parent", ")", "throws", "IOException", "if", "(", "ls", "=", "=", "null", ")", "String", "title", "=", "\"", "Directory", ":", "\"", "+", "deTag", "(", "decodedBase", ")", ";", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "4096", ")", ";", "buf", ".", "append", "(", "\"<", "HTML", ">", "<", "HEAD", ">", "\")", ";", "buf", ".", "append", "(", "\"<", "LINK", "HREF", "=", "\\\"", "\")", ".", "append", "(", "\"", "jetty", "-", "dir", ".", "css", "\"", ").", "append", "(", "\"\\", "\"", "REL", "=", "\\\"", "stylesheet", "\\", "\"", "TYPE", "=", "\\\"", "text", "/", "css", "\\", "\"/", "><", "TITLE", ">", "\")", ";", "buf", ".", "append", "(", "title", ")", ";", "buf", ".", "append", "(", "\"<", "/", "TITLE", ">", "</", "HEAD", ">", "<", "BODY", ">", "\\", "n", "<", "H1", ">", "\")", ";", "buf", ".", "append", "(", "\"<", "/", "H1", ">", "\\", "n", "<", "TABLE", "BORDER", "=", "0", ">", "\\", "n", "\"", ");", "if", "(", "parent", ")", "buf", ".", "append", "(", "\"<", "TR", ">", "<", "TD", ">", "<", "A", "HREF", "=", "\\\"", "\")", ";", "buf", ".", "append", "(", "URIUtil", ".", "addPaths", "(", "base", ",", "\".", "./", "\")", ");", "buf", ".", "append", "(", "\"\\", "\">", "Parent", "Directory", "<", "/", "A", ">", "</", "TD", ">", "<", "TD", ">", "</", "TD", ">", "<", "TD", ">", "</", "TD", ">", "</", "TR", ">", "\\", "n", "\"", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ls", ".", "length", ";", "i", "+", "+)", "Resource", "item", "=", "addPath", "(", "ls", "[", "i", "]", ");", "buf", ".", "append", "(", "\"\\", "n", "<", "TR", ">", "<", "TD", ">", "<", "A", "HREF", "=", "\\\"", "\")", ";", "String", "path", "=", "URIUtil", ".", "addPaths", "(", "encodedBase", ",", "URIUtil", ".", "encodePath", "(", "ls", "[", "i", "]", "))", ";", "/", "/", "URIUtil", ".", "encodePath", "(", "buf", ",", "path", ")", ";", "buf", ".", "append", "(", "deTag", "(", "ls", "[", "i", "]", "))", ";", "buf", ".", "append", "(", "\"<", "/", "A", ">", "</", "TD", ">", "<", "TD", "ALIGN", "=", "right", ">", "\")", ";", "buf", ".", "append", "(", "item", ".", "length", "(", "))", ";", "buf", ".", "append", "(", "\"", "bytes", "&", "nbsp", ";", "</", "TD", ">", "<", "TD", ">", "\")", ";", "buf", ".", "append", "(", "\"<", "/", "TD", ">", "</", "TR", ">", "\")", ";", "buf", ".", "append", "(", "\"<", "/", "TABLE", ">", "\\", "n", "\"", ");", "buf", ".", "append", "(", "\"<", "/", "BODY", ">", "</", "HTML", ">", "\\", "n", "\"", ");", "body", "{", "h1", "{", "a", "{", "td", "{", "padding", ":", "2px", "15px", "2px", "0px", ";"], "docstring_tokens": ["improper", "validation", "of", "user-supplied", "input"]}
{"contents": ["x86,", "mm/ASLR:", "Fix", "stack", "randomization", "on", "64-bit", "systems", "The", "issue", "is", "that", "the", "stack", "for", "processes", "is", "not", "properly", "randomized", "on", "64", "bit", "architectures", "due", "to", "an", "integer", "overflow.", "The", "affected", "function", "is", "randomize_stack_top()", "in", "file", "\"fs/binfmt_elf.c\":", "static", "unsigned", "long", "randomize_stack_top(unsigned", "long", "stack_top)", "{", "unsigned", "int", "random_variable", "=", "0;", "if", "((current->flags", "&", "PF_RANDOMIZE)", "&&", "!(current->personality", "&", "ADDR_NO_RANDOMIZE))", "{", "random_variable", "=", "get_random_int()", "&", "STACK_RND_MASK;", "random_variable", "<<=", "PAGE_SHIFT;", "}", "return", "PAGE_ALIGN(stack_top)", "+", "random_variable;", "return", "PAGE_ALIGN(stack_top)", "-", "random_variable;", "}", "Note", "that,", "it", "declares", "the", "\"random_variable\"", "variable", "as", "\"unsigned", "int\".", "Since", "the", "result", "of", "the", "shifting", "operation", "between", "STACK_RND_MASK", "(which", "is", "0x3fffff", "on", "x86_64,", "22", "bits)", "and", "PAGE_SHIFT", "(which", "is", "12", "on", "x86_64):", "random_variable", "<<=", "PAGE_SHIFT;", "then", "the", "two", "leftmost", "bits", "are", "dropped", "when", "storing", "the", "result", "in", "the", "\"random_variable\".", "This", "variable", "shall", "be", "at", "least", "34", "bits", "long", "to", "hold", "the", "(22+12)", "result.", "These", "two", "dropped", "bits", "have", "an", "impact", "on", "the", "entropy", "of", "process", "stack.", "Concretely,", "the", "total", "stack", "entropy", "is", "reduced", "by", "four:", "from", "2^28", "to", "2^30", "(One", "fourth", "of", "expected", "entropy).", "This", "patch", "restores", "back", "the", "entropy", "by", "correcting", "the", "types", "involved", "in", "the", "operations", "in", "the", "functions", "randomize_stack_top()", "and", "stack_maxrandom_size().", "The", "successful", "fix", "can", "be", "tested", "with:", "$", "for", "i", "in", "`seq", "1", "10`;", "do", "cat", "/proc/self/maps", "|", "grep", "stack;", "done", "7ffeda566000-7ffeda587000", "rw-p", "00000000", "00:00", "0", "[stack]", "7fff5a332000-7fff5a353000", "rw-p", "00000000", "00:00", "0", "[stack]", "7ffcdb7a1000-7ffcdb7c2000", "rw-p", "00000000", "00:00", "0", "[stack]", "7ffd5e2c4000-7ffd5e2e5000", "rw-p", "00000000", "00:00", "0", "[stack]", "...", "Once", "corrected,", "the", "leading", "bytes", "should", "be", "between", "7ffc", "and", "7fff,", "rather", "than", "always", "being", "7fff.", "Signed-off-by:", "Hector", "Marco-Gisbert", "<hecmargi@upv.es>", "Signed-off-by:", "Ismael", "Ripoll", "<iripoll@upv.es>", "[", "Rebased,", "fixed", "80", "char", "bugs,", "cleaned", "up", "commit", "message,", "added", "test", "example", "and", "CVE", "]", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "<stable@vger.kernel.org>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Cc:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Fixes:", "Link:", "http://lkml.kernel.org/r/20150214173350.GA18393@www.outflux.net", "Signed-off-by:", "Borislav", "Petkov", "<bp@suse.de>"], "code_tokens": ["static", "unsigned", "long", "stack_maxrandom_size", "(", "void", ")", "unsigned", "long", "max", "=", "0", ";", "max", "=", "(", "(-", "1UL", ")", "&", "STACK_RND_MASK", ")", "<", "<", "PAGE_SHIFT", ";", "unsigned", "long", "random_variable", "=", "0", ";", "random_variable", "=", "(", "unsigned", "long", ")", "get_random_int", "(", ");", "random_variable", "&", "=", "STACK_RND_MASK", ";</s>static", "unsigned", "int", "stack_maxrandom_size", "(", "void", ")", "unsigned", "int", "max", "=", "0", ";", "max", "=", "(", "(-", "1U", ")", "&", "STACK_RND_MASK", ")", "<", "<", "PAGE_SHIFT", ";", "unsigned", "int", "random_variable", "=", "0", ";", "random_variable", "=", "get_random_int", "(", ")", "&", "STACK_RND_MASK", ";"], "docstring_tokens": ["an", "integer", "overflow", "when", "the", "stack", "for", "processes", "are", "not", "properly", "randomized", "on", "some", "64", "bit", "architectures"]}
{"contents": ["usb:", "chipidea:", "Allow", "disabling", "streaming", "not", "only", "in", "udc", "mode", "When", "running", "a", "scp", "transfer", "using", "a", "USB/Ethernet", "adapter", "the", "following", "crash", "happens:", "$", "scp", "test.tar.gz", "fabio@192.168.1.100:/home/fabio", "fabio@192.168.1.100's", "password:", "test.tar.gz", "0%", "0", "0.0KB/s", "--:--", "ETA", "------------[", "cut", "here", "]------------", "WARNING:", "at", "net/sched/sch_generic.c:255", "dev_watchdog+0x2cc/0x2f0()", "NETDEV", "WATCHDOG:", "eth0", "(asix):", "transmit", "queue", "0", "timed", "out", "Modules", "linked", "in:", "Backtrace:", "[<80011c94>]", "(dump_backtrace+0x0/0x10c)", "from", "[<804d3a5c>]", "(dump_stack+0x18/0x1c)", "r6:000000ff", "r5:80412388", "r4:80685dc0", "r3:80696cc0", "[<804d3a44>]", "(dump_stack+0x0/0x1c)", "from", "[<80021868>]", "(warn_slowpath_common+0x54/0x6c)", "[<80021814>]", "(warn_slowpath_common+0x0/0x6c)", "from", "[<80021924>]", "(warn_slowpath_fmt+0x38/0x40)", "...", "Setting", "SDIS", "(Stream", "Disable", "Mode-", "bit", "4", "of", "USBMODE", "register)", "fixes", "the", "problem.", "However,", "in", "current", "code", "CI13XXX_DISABLE_STREAMING", "flag", "is", "only", "set", "in", "udc", "mode,", "so", "allow", "disabling", "streaming", "also", "in", "host", "mode.", "Tested", "on", "a", "mx6qsabrelite", "board.", "Suggested-by:", "Peter", "Chen", "<peter.chen@freescale.com>", "Signed-off-by:", "Fabio", "Estevam", "<fabio.estevam@freescale.com>", "Reviewed-by:", "Peter", "Chen", "<peter.chen@freescale.com>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["if", "(", "ci", "-", ">", "platdata", "-", ">", "flags", "&", "CI13XXX_DISABLE_STREAMING", ")", "hw_write", "(", "ci", ",", "OP_USBMODE", ",", "USBMODE_CI_SDIS", ",", "USBMODE_CI_SDIS", ")", ";</s>"], "docstring_tokens": ["does", "not", "properly", "support", "a", "certain", "non-streaming", "option"]}
{"contents": ["MINOR:", "Cleanup", "handling", "of", "mixed", "transactional/idempotent", "records", "(#6172)", "Reviewers:", "Rajini", "Sivaram", "<rajinisivaram@googlemail.com>,", "Ismael", "Juma", "<ismael@juma.me.uk>,", "Colin", "Patrick", "McCabe", "<colin@cmccabe.xyz>"], "code_tokens": ["private", "boolean", "hasTransactionalRecords", "=", "false", ";", "private", "boolean", "hasIdempotentRecords", "=", "false", ";", "hasIdempotentRecords", "=", "hasIdempotentRecords", "|", "|", "entry", ".", "hasProducerId", "(", ");", "hasTransactionalRecords", "=", "hasTransactionalRecords", "|", "|", "entry", ".", "isTransactional", "(", ");", "public", "boolean", "hasTransactionalRecords", "(", ")", "{", "return", "hasTransactionalRecords", ";", "public", "boolean", "hasIdempotentRecords", "(", ")", "{", "return", "hasIdempotentRecords", ";", "assertFalse", "(", "request", ".", "hasIdempotentRecords", "(", "))", ";", "assertTrue", "(", "produceRequest", ".", "hasIdempotentRecords", "(", "))", ";", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "hasIdempotentRecords", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "hasIdempotentRecords", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "hasIdempotentRecords", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "hasIdempotentRecords", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "hasIdempotentRecords", "(", ");", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "record", ".", "RecordVersion", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "assertTrue", "(", "request", ".", "hasTransactionalRecords", "(", "))", ";", "assertFalse", "(", "request", ".", "hasTransactionalRecords", "(", "))", ";", "assertFalse", "(", "request", ".", "hasTransactionalRecords", "(", "))", ";", "assertTrue", "(", "request", ".", "hasIdempotentRecords", "(", "))", ";", "@", "Test", "public", "void", "testMixedTransactionalData", "(", ")", "{", "final", "long", "producerId", "=", "15L", ";", "final", "short", "producerEpoch", "=", "5", ";", "final", "int", "sequence", "=", "10", ";", "final", "String", "transactionalId", "=", "\"", "txnlId", "\"", ";", "final", "MemoryRecords", "nonTxnRecords", "=", "MemoryRecords", ".", "withRecords", "(", "CompressionType", ".", "NONE", ",", "new", "SimpleRecord", "(", "\"", "foo", "\"", ".", "getBytes", "(", "))", ");", "final", "MemoryRecords", "txnRecords", "=", "MemoryRecords", ".", "withTransactionalRecords", "(", "CompressionType", ".", "NONE", ",", "producerId", ",", "producerEpoch", ",", "sequence", ",", "new", "SimpleRecord", "(", "\"", "bar", "\"", ".", "getBytes", "(", "))", ");", "final", "Map", "<", "TopicPartition", ",", "MemoryRecords", ">", "recordsByPartition", "=", "new", "LinkedHashMap", "<", ">(", ");", "recordsByPartition", ".", "put", "(", "new", "TopicPartition", "(", "\"", "foo", "\"", ",", "0", ")", ",", "txnRecords", ")", ";", "recordsByPartition", ".", "put", "(", "new", "TopicPartition", "(", "\"", "foo", "\"", ",", "1", ")", ",", "nonTxnRecords", ")", ";", "final", "ProduceRequest", ".", "Builder", "builder", "=", "ProduceRequest", ".", "Builder", ".", "forMagic", "(", "RecordVersion", ".", "current", "(", ").", "value", ",", "(", "short", ")", "-", "1", ",", "5000", ",", "recordsByPartition", ",", "transactionalId", ")", ";", "final", "ProduceRequest", "request", "=", "builder", ".", "build", "(", ");", "assertTrue", "(", "request", ".", "hasTransactionalRecords", "(", "))", ";", "assertTrue", "(", "request", ".", "hasIdempotentRecords", "(", "))", ";", "}", "@", "Test", "public", "void", "testMixedIdempotentData", "(", ")", "{", "final", "long", "producerId", "=", "15L", ";", "final", "short", "producerEpoch", "=", "5", ";", "final", "int", "sequence", "=", "10", ";", "final", "MemoryRecords", "nonTxnRecords", "=", "MemoryRecords", ".", "withRecords", "(", "CompressionType", ".", "NONE", ",", "new", "SimpleRecord", "(", "\"", "foo", "\"", ".", "getBytes", "(", "))", ");", "final", "MemoryRecords", "txnRecords", "=", "MemoryRecords", ".", "withIdempotentRecords", "(", "CompressionType", ".", "NONE", ",", "producerId", ",", "producerEpoch", ",", "sequence", ",", "new", "SimpleRecord", "(", "\"", "bar", "\"", ".", "getBytes", "(", "))", ");", "final", "Map", "<", "TopicPartition", ",", "MemoryRecords", ">", "recordsByPartition", "=", "new", "LinkedHashMap", "<", ">(", ");", "recordsByPartition", ".", "put", "(", "new", "TopicPartition", "(", "\"", "foo", "\"", ",", "0", ")", ",", "txnRecords", ")", ";", "recordsByPartition", ".", "put", "(", "new", "TopicPartition", "(", "\"", "foo", "\"", ",", "1", ")", ",", "nonTxnRecords", ")", ";", "final", "ProduceRequest", ".", "Builder", "builder", "=", "ProduceRequest", ".", "Builder", ".", "forMagic", "(", "RecordVersion", ".", "current", "(", ").", "value", ",", "(", "short", ")", "-", "1", ",", "5000", ",", "recordsByPartition", ",", "null", ")", ";", "final", "ProduceRequest", "request", "=", "builder", ".", "build", "(", ");", "assertFalse", "(", "request", ".", "hasTransactionalRecords", "(", "))", ";", "assertTrue", "(", "request", ".", "hasIdempotentRecords", "(", "))", ";", "}", "if", "(", "produceRequest", ".", "hasTransactionalRecords", ")", "{", "val", "isAuthorizedTransactional", "=", "produceRequest", ".", "transactionalId", "!", "=", "null", "&", "&", "authorize", "(", "request", ".", "session", ",", "Write", ",", "Resource", "(", "TransactionalId", ",", "produceRequest", ".", "transactionalId", ",", "LITERAL", ")", ")", "if", "(", "!", "isAuthorizedTransactional", ")", "{", "}", "else", "if", "(", "produceRequest", ".", "hasIdempotentRecords", "&", "&", "!", "authorize", "(", "request", ".", "session", ",", "IdempotentWrite", ",", "Resource", ".", "ClusterResource", ")", ")", "{</s>private", "boolean", "transactional", "=", "false", ";", "private", "boolean", "idempotent", "=", "false", ";", "idempotent", "=", "entry", ".", "hasProducerId", "(", ");", "transactional", "=", "entry", ".", "isTransactional", "(", ");", "public", "boolean", "isTransactional", "(", ")", "{", "return", "transactional", ";", "public", "boolean", "isIdempotent", "(", ")", "{", "return", "idempotent", ";", "assertFalse", "(", "request", ".", "isIdempotent", "(", "))", ";", "assertTrue", "(", "produceRequest", ".", "isIdempotent", "(", "))", ";", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "isIdempotent", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "isIdempotent", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "isIdempotent", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "isIdempotent", "(", ");", "return", "body", "instanceof", "ProduceRequest", "&", "&", "(", "(", "ProduceRequest", ")", "body", ")", ".", "isIdempotent", "(", ");", "assertTrue", "(", "request", ".", "isTransactional", "(", "))", ";", "assertFalse", "(", "request", ".", "isTransactional", "(", "))", ";", "assertFalse", "(", "request", ".", "isTransactional", "(", "))", ";", "assertTrue", "(", "request", ".", "isIdempotent", "(", "))", ";", "if", "(", "produceRequest", ".", "isTransactional", ")", "{", "if", "(", "!", "authorize", "(", "request", ".", "session", ",", "Write", ",", "Resource", "(", "TransactionalId", ",", "produceRequest", ".", "transactionalId", ",", "LITERAL", ")", "))", "{", "}", "else", "if", "(", "produceRequest", ".", "isIdempotent", "&", "&", "!", "authorize", "(", "request", ".", "session", ",", "IdempotentWrite", ",", "Resource", ".", "ClusterResource", ")", ")", "{"], "docstring_tokens": ["improper", "input", "validation"]}
{"contents": ["x86:", "replace", "LOCK_PREFIX", "in", "futex.h", "The", "exception", "fixup", "for", "the", "futex", "macros", "__futex_atomic_op1/2", "and", "futex_atomic_cmpxchg_inatomic()", "is", "missing", "an", "entry", "when", "the", "lock", "prefix", "is", "replaced", "by", "a", "NOP", "via", "SMP", "alternatives.", "Chuck", "Ebert", "tracked", "this", "down", "from", "the", "information", "provided", "in:", "https://bugzilla.redhat.com/show_bug.cgi?id=429412", "A", "possible", "solution", "would", "be", "to", "add", "another", "fixup", "after", "the", "LOCK_PREFIX,", "so", "both", "the", "LOCK", "and", "NOP", "case", "have", "their", "own", "entry", "in", "the", "exception", "table,", "but", "it's", "not", "really", "worth", "the", "trouble.", "Simply", "replace", "LOCK_PREFIX", "with", "lock", "and", "keep", "those", "untouched", "by", "SMP", "alternatives.", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Signed-off-by:", "Ingo", "Molnar", "<mingo@elte.hu>"], "code_tokens": ["\"", "2", ":", "lock", ";", "cmpxchgl", "%", "3", ",", "%", "2", "\\", "n", "\\", "__futex_atomic_op1", "(", "\"", "lock", ";", "xaddl", "%", "0", ",", "%", "2", "\"", ",", "ret", ",", "oldval", ",", "\"", "1", ":", "lock", ";", "cmpxchgl", "%", "3", ",", "%", "1", "\\", "n", "\"</s>\"", "2", ":", "\"", "LOCK_PREFIX", "\"", "cmpxchgl", "%", "3", ",", "%", "2", "\\", "n", "\\", "__futex_atomic_op1", "(", "LOCK_PREFIX", "\"", "xaddl", "%", "0", ",", "%", "2", "\"", ",", "ret", ",", "oldval", ",", "\"", "1", ":", "\"", "LOCK_PREFIX", "\"", "cmpxchgl", "%", "3", ",", "%", "1", "\\", "n", "\""], "docstring_tokens": ["does", "not", "properly", "implement", "exception", "fixup"]}
{"contents": ["[SPARK-20922][CORE]", "Add", "whitelist", "of", "classes", "that", "can", "be", "deserialized", "by", "the", "launcher.", "Blindly", "deserializing", "classes", "using", "Java", "serialization", "opens", "the", "code", "up", "to", "issues", "in", "other", "libraries,", "since", "just", "deserializing", "data", "from", "a", "stream", "may", "end", "up", "execution", "code", "(think", "readObject()).", "Since", "the", "launcher", "protocol", "is", "pretty", "self-contained,", "there's", "just", "a", "handful", "of", "classes", "it", "legitimately", "needs", "to", "deserialize,", "and", "they're", "in", "just", "two", "packages,", "so", "add", "a", "filter", "that", "throws", "errors", "if", "classes", "from", "any", "other", "package", "show", "up", "in", "the", "stream.", "This", "also", "maintains", "backwards", "compatibility", "(the", "updated", "launcher", "code", "can", "still", "communicate", "with", "the", "backend", "code", "in", "older", "Spark", "releases).", "Tested", "with", "new", "and", "existing", "unit", "tests.", "Author:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>", "Closes", "#18166", "from", "vanzin/SPARK-20922.", "(cherry", "picked", "from", "commit", "8efc6e986554ae66eab93cd64a9035d716adbab0)", "Signed-off-by:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>"], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "spark", ".", "launcher", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "An", "object", "input", "stream", "that", "only", "allows", "classes", "used", "by", "the", "launcher", "protocol", "to", "be", "in", "the", "*", "serialized", "stream", ".", "See", "SPARK", "-", "20922", ".", "*", "/", "class", "FilteredObjectInputStream", "extends", "ObjectInputStream", "{", "private", "static", "final", "List", "<", "String", ">", "ALLOWED_PACKAGES", "=", "Arrays", ".", "asList", "(", "\"", "org", ".", "apache", ".", "spark", ".", "launcher", ".", "\",", "\"", "java", ".", "lang", ".", "\")", ";", "FilteredObjectInputStream", "(", "InputStream", "is", ")", "throws", "IOException", "{", "super", "(", "is", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "boolean", "isValid", "=", "ALLOWED_PACKAGES", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ");", "if", "(", "!", "isValid", ")", "{", "throw", "new", "IllegalArgumentException", "(", "String", ".", "format", "(", "\"", "Unexpected", "class", "in", "stream", ":", "%", "s", "\"", ",", "desc", ".", "getName", "(", "))", ");", "}", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "FilteredObjectInputStream", "in", "=", "new", "FilteredObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "@", "Test", "public", "void", "testStreamFiltering", "(", ")", "throws", "Exception", "{", "ChildProcAppHandle", "handle", "=", "LauncherServer", ".", "newAppHandle", "(", ");", "TestClient", "client", "=", "null", ";", "try", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "client", ".", "send", "(", "new", "EvilPayload", "(", "))", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "assertEquals", "(", "0", ",", "EvilPayload", ".", "EVIL_BIT", ")", ";", "}", "finally", "{", "kill", "(", "handle", ")", ";", "close", "(", "client", ")", ";", "client", ".", "clientThread", ".", "join", "(", ");", "}", "}", "/", "**", "*", "Try", "a", "few", "times", "to", "get", "a", "client", "-", "side", "error", ",", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "*", "server", "-", "side", "close", "immediately", ".", "*", "/", "private", "void", "waitForError", "(", "TestClient", "client", ",", "String", "secret", ")", "throws", "Exception", "{", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "secret", ",", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "error", "but", "message", "went", "through", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "}", "private", "static", "class", "EvilPayload", "extends", "LauncherProtocol", ".", "Message", "{", "static", "int", "EVIL_BIT", "=", "0", ";", "/", "/", "This", "field", "should", "cause", "the", "launcher", "server", "to", "throw", "an", "error", "and", "not", "deserialize", "the", "/", "/", "message", ".", "private", "List", "<", "String", ">", "notAllowedField", "=", "Arrays", ".", "asList", "(", "\"", "disallowed", "\"", ");", "private", "void", "readObject", "(", "ObjectInputStream", "stream", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "stream", ".", "defaultReadObject", "(", ");", "EVIL_BIT", "=", "1", ";", "}", "}</s>import", "java", ".", "io", ".", "ObjectInputStream", ";", "ObjectInputStream", "in", "=", "new", "ObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "/", "/", "Try", "a", "few", "times", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "server", "-", "side", "close", "/", "/", "immediately", ".", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "handle", ".", "getSecret", "(", "),", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "exception", "caused", "by", "connection", "timeout", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}"], "docstring_tokens": ["performs", "unsafe", "deserialization", "of", "data", "received", "by", "its", "socket", "."]}
{"contents": ["Adapt", "driver", "behavior", "for", "XXE", "vulnerability", "on", "Java", "5."], "code_tokens": ["<", "tr", ">", "<", "td", ">", "DomDriver", "<", "/", "td", ">", "<", "td", ">", "no", ",", "Java", "6", "or", "higher", "<", "br", "/", ">", "yes", ",", "Java", "5", "<", "/", "td", ">", "<", "td", ">", "Driver", "turns", "off", "DOCTYPE", "processing", "with", "Java", "7", "runtime", "or", "higher", "to", "suppress", "handling", "of", "external", "entities", "with", "SAX", "reader", "in", "use", ".", "Suppress", "external", "entities", "only", "for", "Java", "6", "or", "lower", ",", "fails", "for", "parameterized", "entities", ".", "</", "td", ">", "</", "tr", ">", "Throwable", "cause", "=", "e", ".", "getCause", "(", ");", "if", "(", "JVM", ".", "is16", "(", ")", "|", "|", "(", "cause", "instanceof", "ParserConfigurationException", "&", "&", "cause", ".", "getMessage", "(", ").", "indexOf", "(", "\"", "disallow", "-", "doctype", "-", "decl", "\"", ")", "<", "0", ")", ")", "{", "throw", "new", "StreamException", "(", "cause", ")", ";", "}", "if", "(", "JVM", ".", "is16", "(", "))", "{", "if", "(", "JVM", ".", "is17", "(", ")", "|", "|", "!", "JVM", ".", "is16", "(", "))", "{", "/", "/", "XXE", "vulnerable", "with", "Sun", "Java", "1", ".", "6", "runtime", "if", "(", "JVM", ".", "is16", "(", ")", "|", "|", "!", "JVM", ".", "is15", "(", "))", "{", "throw", "e", ";", "}", "else", "{", "System", ".", "err", ".", "println", "(", "\"", "DomReader", "is", "vulnerable", "with", "Java", "5", "!", "\")", ";", "}", "if", "(", "JVM", ".", "is17", "(", ")", "|", "|", "!", "JVM", ".", "is16", "(", "))", "{", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "core", ".", "JVM", ";", "if", "(", "JVM", ".", "is16", "(", ")", "&", "&", "message", ".", "indexOf", "(", "\"", "com", ".", "wutka", ".", "dtd", ".", "DTDParseException", "\"", ")", ">", "=", "0", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "BEAStaxReader", "was", "selected", "as", "default", "StAX", "driver", "for", "StaxReaderTest", "!", "\")", ";", "}", "else", "if", "(", "JVM", ".", "is15", "(", ")", "&", "&", "message", ".", "replaceAll", "(", "\"[", ":", "space", ":", "]\"", ",", "\"", "\")", ".", "endsWith", "(", "\"", "null", "\"", "))", "{</s><", "tr", ">", "<", "td", ">", "DomDriver", "<", "/", "td", ">", "<", "td", ">", "no", "<", "/", "td", ">", "<", "td", ">", "Driver", "turns", "off", "DOCTYPE", "processing", "to", "suppress", "handling", "of", "external", "entities", "with", "SAX", "reader", "in", "use", ".", "</", "td", ">", "</", "tr", ">", "throw", "new", "StreamException", "(", "e", ".", "getCause", "(", "))", ";", "if", "(", "JVM", ".", "is15", "(", "))", "{", "if", "(", "JVM", ".", "is17", "(", "))", "{", "throw", "e", ";", "if", "(", "JVM", ".", "is17", "(", "))", "{", "if", "(", "message", ".", "indexOf", "(", "\"", "com", ".", "wutka", ".", "dtd", ".", "DTDParseException", "\"", ")", ">", "=", "0", ")", "{"], "docstring_tokens": ["does", "not", "parse", "entities", "at", "all"]}
{"contents": ["HID:", "validate", "HID", "report", "id", "size", "The", "\"Report", "ID\"", "field", "of", "a", "HID", "report", "is", "used", "to", "build", "indexes", "of", "reports.", "The", "kernel's", "index", "of", "these", "is", "limited", "to", "256", "entries,", "so", "any", "malicious", "device", "that", "sets", "a", "Report", "ID", "greater", "than", "255", "will", "trigger", "memory", "corruption", "on", "the", "host:", "[", "1347.156239]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "ffff88094958a878", "[", "1347.156261]", "IP:", "[<ffffffff813e4da0>]", "hid_register_report+0x2a/0x8b", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["if", "(", "id", ">", "=", "HID_MAX_IDS", ")", "return", "NULL", ";", "if", "(", "parser", "-", ">", "global", ".", "report_id", "=", "=", "0", "|", "|", "parser", "-", ">", "global", ".", "report_id", ">", "=", "HID_MAX_IDS", ")", "{", "hid_err", "(", "parser", "-", ">", "device", ",", "\"", "report_id", "%", "u", "is", "invalid", "\\", "n", "\"", ",", "parser", "-", ">", "global", ".", "report_id", ")", ";", "for", "(", "j", "=", "0", ";", "j", "<", "HID_MAX_IDS", ";", "j", "+", "+)", "{", "#", "define", "HID_MAX_IDS", "256", "struct", "hid_report", "*", "report_id_hash", "[", "HID_MAX_IDS", "]", ";</s>if", "(", "parser", "-", ">", "global", ".", "report_id", "=", "=", "0", ")", "{", "hid_err", "(", "parser", "-", ">", "device", ",", "\"", "report_id", "0", "is", "invalid", "\\", "n", "\"", ");", "for", "(", "j", "=", "0", ";", "j", "<", "256", ";", "j", "+", "+)", "{", "struct", "hid_report", "*", "report_id_hash", "[", "256", "]", ";"], "docstring_tokens": ["Requires", "CONFIG_HID", "Memory", "write", "via", "arbitrary", "heap", "array", "index"]}
{"contents": ["IGNITE-8565", "Client", "marshalling", "improvements"], "code_tokens": ["import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "TcpRestUnmarshalVulnerabilityTest", ";", "suite", ".", "addTestSuite", "(", "TcpRestUnmarshalVulnerabilityTest", ".", "class", ")", ";", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicBoolean", ";", "import", "org", ".", "apache", ".", "ignite", ".", "configuration", ".", "ConnectorConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "configuration", ".", "IgniteConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "marshaller", ".", "jdk", ".", "GridClientJdkMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "client", ".", "message", ".", "GridClientHandshakeRequest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "client", ".", "message", ".", "GridClientMessage", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "IgniteUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "lang", ".", "GridAbsPredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "typedef", ".", "internal", ".", "U", ";", "import", "org", ".", "apache", ".", "ignite", ".", "testframework", ".", "GridTestUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "testframework", ".", "junits", ".", "common", ".", "GridCommonAbstractTest", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_BLACKLIST", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_WHITELIST", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "GridMemcachedMessage", ".", "IGNITE_HANDSHAKE_FLAG", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "GridMemcachedMessage", ".", "IGNITE_REQ_FLAG", ";", "/", "**", "*", "Tests", "for", "whitelist", "and", "blacklist", "ot", "avoiding", "deserialization", "vulnerability", ".", "*", "/", "public", "class", "TcpRestUnmarshalVulnerabilityTest", "extends", "GridCommonAbstractTest", "{", "/", "**", "Marshaller", ".", "*", "/", "private", "static", "final", "GridClientJdkMarshaller", "MARSH", "=", "new", "GridClientJdkMarshaller", "(", ");", "/", "**", "Shared", "value", ".", "*", "/", "private", "static", "final", "AtomicBoolean", "SHARED", "=", "new", "AtomicBoolean", "(", ");", "/", "**", "Port", ".", "*", "/", "private", "static", "int", "port", ";", "/", "**", "Host", ".", "*", "/", "private", "static", "String", "host", ";", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "IgniteConfiguration", "getConfiguration", "(", "String", "igniteInstanceName", ")", "throws", "Exception", "{", "IgniteConfiguration", "cfg", "=", "super", ".", "getConfiguration", "(", "igniteInstanceName", ")", ";", "ConnectorConfiguration", "connCfg", "=", "new", "ConnectorConfiguration", "(", ");", "port", "=", "connCfg", ".", "getPort", "(", ");", "host", "=", "connCfg", ".", "getHost", "(", ");", "cfg", ".", "setConnectorConfiguration", "(", "connCfg", ")", ";", "return", "cfg", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "void", "beforeTest", "(", ")", "throws", "Exception", "{", "super", ".", "beforeTest", "(", ");", "SHARED", ".", "set", "(", "false", ")", ";", "System", ".", "clearProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ")", ";", "System", ".", "clearProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ")", ";", "IgniteUtils", ".", "clearClassCache", "(", ");", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testNoLists", "(", ")", "throws", "Exception", "{", "testExploit", "(", "true", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testWhiteListIncluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_included", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ",", "path", ")", ";", "testExploit", "(", "true", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testWhiteListExcluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_excluded", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ",", "path", ")", ";", "testExploit", "(", "false", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testBlackListIncluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_included", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ",", "path", ")", ";", "testExploit", "(", "false", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testBlackListExcluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_excluded", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ",", "path", ")", ";", "testExploit", "(", "true", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testBothListIncluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_included", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ",", "path", ")", ";", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ",", "path", ")", ";", "testExploit", "(", "false", ")", ";", "}", "/", "**", "*", "@", "param", "positive", "Positive", ".", "*", "/", "private", "void", "testExploit", "(", "boolean", "positive", ")", "throws", "Exception", "{", "try", "{", "startGrid", "(", ");", "attack", "(", "marshal", "(", "new", "Exploit", "(", "))", ".", "array", "(", "))", ";", "boolean", "res", "=", "GridTestUtils", ".", "waitForCondition", "(", "new", "GridAbsPredicate", "(", ")", "{", "@", "Override", "public", "boolean", "apply", "(", ")", "{", "return", "SHARED", ".", "get", "(", ");", "}", "}", ",", "3000L", ")", ";", "if", "(", "positive", ")", "assertTrue", "(", "res", ")", ";", "else", "assertFalse", "(", "res", ")", ";", "}", "finally", "{", "stopAllGrids", "(", ");", "}", "}", "/", "**", "*", "@", "param", "obj", "Object", ".", "*", "/", "private", "static", "ByteBuffer", "marshal", "(", "Object", "obj", ")", "throws", "IOException", "{", "return", "MARSH", ".", "marshal", "(", "obj", ",", "0", ")", ";", "}", "/", "**", "*", "@", "param", "data", "Data", ".", "*", "/", "private", "void", "attack", "(", "byte", "[", "]", "data", ")", "throws", "IOException", "{", "InetAddress", "addr", "=", "InetAddress", ".", "getByName", "(", "host", ")", ";", "try", "(", "Socket", "sock", "=", "new", "Socket", "(", "addr", ",", "port", ")", ";", "OutputStream", "os", "=", "new", "BufferedOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ")", "{", "/", "/", "Handshake", "request", ".", "os", ".", "write", "(", "IGNITE_HANDSHAKE_FLAG", ")", ";", "GridClientHandshakeRequest", "req", "=", "new", "GridClientHandshakeRequest", "(", ");", "req", ".", "marshallerId", "(", "GridClientJdkMarshaller", ".", "ID", ")", ";", "os", ".", "write", "(", "req", ".", "rawBytes", "(", "))", ";", "os", ".", "flush", "(", ");", "/", "/", "Handshake", "response", "InputStream", "is", "=", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ";", "is", ".", "read", "(", "new", "byte", "[", "146", "]", ");", "/", "/", "Read", "handshake", "response", ".", "int", "len", "=", "data", ".", "length", "+", "40", ";", "os", ".", "write", "(", "IGNITE_REQ_FLAG", ")", ";", "/", "/", "Package", "type", ".", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ">", ">", "24", ")", ");", "/", "/", "Package", "length", ".", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ">", ">", "16", ")", ");", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ">", ">", "8", ")", ");", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ")", ");", "os", ".", "write", "(", "new", "byte", "[", "40", "]", ");", "/", "/", "Stream", "header", ".", "os", ".", "write", "(", "data", ")", ";", "/", "/", "Exploit", ".", "os", ".", "flush", "(", ");", "}", "}", "/", "**", "*", "/", "private", "static", "class", "Exploit", "implements", "GridClientMessage", "{", "/", "**", "*", "@", "param", "is", "Input", "stream", ".", "*", "/", "private", "void", "readObject", "(", "ObjectInputStream", "is", ")", "throws", "ClassNotFoundException", ",", "IOException", "{", "SHARED", ".", "set", "(", "true", ")", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "long", "requestId", "(", ")", "{", "return", "0", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "requestId", "(", "long", "reqId", ")", "{", "/", "/", "No", "-", "op", ".", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "UUID", "clientId", "(", ")", "{", "return", "null", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "clientId", "(", "UUID", "id", ")", "{", "/", "/", "No", "-", "op", ".", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "UUID", "destinationId", "(", ")", "{", "return", "null", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "destinationId", "(", "UUID", "id", ")", "{", "/", "/", "No", "-", "op", ".", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "byte", "[", "]", "sessionToken", "(", ")", "{", "return", "new", "byte", "[", "0", "]", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "sessionToken", "(", "byte", "[", "]", "sesTok", ")", "{", "/", "/", "No", "-", "op", ".", "}", "}", "}", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "try", "{", "marshallers", "=", "new", "GridClientMarshaller", "[", "]", "{", "new", "GridClientJdkMarshaller", "(", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", "),", "new", "GridClientOptimizedMarshaller", "(", ")", "}", ";", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "/", "**", "Class", "name", "filter", ".", "*", "/", "private", "final", "IgnitePredicate", "<", "String", ">", "clsFilter", ";", "/", "**", "*", "Default", "constructor", ".", "*", "/", "public", "GridClientJdkMarshaller", "(", ")", "{", "this", "(", "null", ")", ";", "}", "/", "**", "*", "@", "param", "clsFilter", "Class", "filter", ".", "*", "/", "public", "GridClientJdkMarshaller", "(", "IgnitePredicate", "<", "String", ">", "clsFilter", ")", "{", "this", ".", "clsFilter", "=", "clsFilter", ";", "}", "ObjectInput", "in", "=", "new", "ClientJdkInputStream", "(", "tmp", ",", "clsFilter", ")", ";", "/", "**", "*", "Wrapper", "with", "class", "resolving", "control", ".", "*", "/", "private", "static", "class", "ClientJdkInputStream", "extends", "ObjectInputStream", "{", "/", "**", "Class", "name", "filter", ".", "*", "/", "private", "final", "IgnitePredicate", "<", "String", ">", "clsFilter", ";", "/", "**", "*", "@", "param", "in", "Input", "stream", ".", "*", "@", "param", "clsFilter", "Class", "filter", ".", "*", "/", "public", "ClientJdkInputStream", "(", "InputStream", "in", ",", "IgnitePredicate", "<", "String", ">", "clsFilter", ")", "throws", "IOException", "{", "super", "(", "in", ")", ";", "this", ".", "clsFilter", "=", "clsFilter", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "String", "clsName", "=", "desc", ".", "getName", "(", ");", "if", "(", "clsFilter", "!", "=", "null", "&", "&", "!", "clsFilter", ".", "apply", "(", "clsName", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "Deserialization", "of", "class", "\"", "+", "clsName", "+", "\"", "is", "disallowed", ".", "\")", ";", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "try", "{", "IgnitePredicate", "<", "String", ">", "clsFilter", "=", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "clsFilter", ")", ");", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "try", "{", "IgnitePredicate", "<", "String", ">", "clsFilter", "=", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "clsFilter", ")", ");", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteSystemProperties", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "ClassSet", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "/", "**", "*", "Returns", "class", "name", "filter", "for", "marshaller", ".", "*", "*", "@", "return", "Class", "name", "filter", "for", "marshaller", ".", "*", "/", "public", "static", "IgnitePredicate", "<", "String", ">", "classNameFilter", "(", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "whiteList", "=", "classWhiteList", "(", "clsLdr", ")", ";", "ClassSet", "blackList", "=", "classBlackList", "(", "clsLdr", ")", ";", "return", "new", "IgnitePredicate", "<", "String", ">", "()", "{", "@", "Override", "public", "boolean", "apply", "(", "String", "s", ")", "{", "/", "/", "Allows", "all", "primitive", "arrays", "and", "checks", "arrays", "'", "type", ".", "if", "(", "(", "blackList", "!", "=", "null", "|", "|", "whiteList", "!", "=", "null", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "=", "=", "'", "['", ")", "{", "if", "(", "s", ".", "charAt", "(", "1", ")", "=", "=", "'", "L", "'", "&", "&", "s", ".", "length", "(", ")", ">", "2", ")", "s", "=", "s", ".", "substring", "(", "2", ",", "s", ".", "length", "(", ")", "-", "1", ")", ";", "else", "return", "true", ";", "}", "return", "(", "blackList", "=", "=", "null", "|", "|", "!", "blackList", ".", "contains", "(", "s", ")", ")", "&", "&", "(", "whiteList", "=", "=", "null", "|", "|", "whiteList", ".", "contains", "(", "s", ")", ");", "}", "}", ";", "}", "/", "**", "*", "@", "param", "clsLdr", "Class", "loader", ".", "*", "@", "return", "White", "list", "of", "classes", ".", "*", "/", "private", "static", "ClassSet", "classWhiteList", "(", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "fileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_WHITELIST", ")", ";", "if", "(", "fileName", "!", "=", "null", ")", "{", "clsSet", "=", "new", "ClassSet", "(", ");", "addClassNames", "(", "JDK_CLS_NAMES_FILE", ",", "clsSet", ",", "clsLdr", ")", ";", "addClassNames", "(", "CLS_NAMES_FILE", ",", "clsSet", ",", "clsLdr", ")", ";", "addClassNames", "(", "fileName", ",", "clsSet", ",", "clsLdr", ")", ";", "}", "return", "clsSet", ";", "}", "/", "**", "*", "@", "param", "clsLdr", "Class", "loader", ".", "*", "@", "return", "Black", "list", "of", "classes", ".", "*", "/", "private", "static", "ClassSet", "classBlackList", "(", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "blackListFileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_BLACKLIST", ")", ";", "if", "(", "blackListFileName", "!", "=", "null", ")", "addClassNames", "(", "blackListFileName", ",", "clsSet", "=", "new", "ClassSet", "(", "),", "clsLdr", ")", ";", "return", "clsSet", ";", "}", "/", "**", "*", "Reads", "class", "names", "from", "resource", "referred", "by", "given", "system", "property", "name", "and", "returns", "set", "of", "classes", ".", "*", "*", "@", "param", "fileName", "File", "name", "containing", "list", "of", "classes", ".", "*", "@", "param", "clsSet", "Class", "set", "for", "update", ".", "*", "@", "param", "clsLdr", "Class", "loader", ".", "*", "/", "private", "static", "void", "addClassNames", "(", "String", "fileName", ",", "ClassSet", "clsSet", ",", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "InputStream", "is", "=", "clsLdr", ".", "getResourceAsStream", "(", "fileName", ")", ";", "if", "(", "is", "=", "=", "null", ")", "{", "try", "{", "is", "=", "new", "FileInputStream", "(", "new", "File", "(", "fileName", ")", ");", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "File", "\"", "+", "fileName", "+", "\"", "not", "found", ".", "\")", ";", "}", "}", "try", "(", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "is", ")", "))", "{", "String", "line", ";", "for", "(", "int", "i", "=", "1", ";", "(", "line", "=", "reader", ".", "readLine", "(", "))", "!", "=", "null", ";", "i", "+", "+)", "{", "String", "s", "=", "line", ".", "trim", "(", ");", "if", "(", "!", "s", ".", "isEmpty", "(", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "#'", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "['", ")", "{", "try", "{", "clsSet", ".", "add", "(", "s", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "list", "of", "classes", "\"", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "\"", ",", "row", "=", "\"", "+", "i", "+", "\"", ",", "line", "=", "\"", "+", "s", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "}", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "and", "creating", "list", "of", "classes", "\"", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "org", ".", "apache", ".", "ignite", ".", "stream", ".", "socket", ".", "SocketStreamerUnmarshalVulnerabilityTest", "$", "Exploit", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "TcpRestUnmarshalVulnerabilityTest", "$", "Exploit", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "try", "{", "IgnitePredicate", "<", "String", ">", "clsFilter", "=", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "cliCfg", ".", "setMarshaller", "(", "new", "GridClientJdkMarshaller", "(", "clsFilter", ")", ");", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}</s>marshallers", "=", "new", "GridClientMarshaller", "[", "]", "{", "new", "GridClientJdkMarshaller", "(", "),", "new", "GridClientOptimizedMarshaller", "(", ")", "}", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ".", "CLS_NAMES_FILE", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ".", "JDK_CLS_NAMES_FILE", ";", "classNameFilter", "(", ")", "/", "**", "*", "Returns", "class", "name", "filter", "for", "marshaller", ".", "*", "*", "@", "return", "Class", "name", "filter", "for", "marshaller", ".", "*", "/", "private", "IgnitePredicate", "<", "String", ">", "classNameFilter", "(", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "whiteList", "=", "classWhiteList", "(", ");", "ClassSet", "blackList", "=", "classBlackList", "(", ");", "return", "new", "IgnitePredicate", "<", "String", ">", "()", "{", "@", "Override", "public", "boolean", "apply", "(", "String", "s", ")", "{", "/", "/", "Allows", "all", "primitive", "arrays", "and", "checks", "arrays", "'", "type", ".", "if", "(", "(", "blackList", "!", "=", "null", "|", "|", "whiteList", "!", "=", "null", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "=", "=", "'", "['", ")", "{", "if", "(", "s", ".", "charAt", "(", "1", ")", "=", "=", "'", "L", "'", "&", "&", "s", ".", "length", "(", ")", ">", "2", ")", "s", "=", "s", ".", "substring", "(", "2", ",", "s", ".", "length", "(", ")", "-", "1", ")", ";", "else", "return", "true", ";", "}", "return", "(", "blackList", "=", "=", "null", "|", "|", "!", "blackList", ".", "contains", "(", "s", ")", ")", "&", "&", "(", "whiteList", "=", "=", "null", "|", "|", "whiteList", ".", "contains", "(", "s", ")", ");", "}", "}", ";", "}", "/", "**", "*", "@", "return", "White", "list", "of", "classes", ".", "*", "/", "private", "ClassSet", "classWhiteList", "(", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "fileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_WHITELIST", ")", ";", "if", "(", "fileName", "!", "=", "null", ")", "{", "clsSet", "=", "new", "ClassSet", "(", ");", "addClassNames", "(", "JDK_CLS_NAMES_FILE", ",", "clsSet", ")", ";", "addClassNames", "(", "CLS_NAMES_FILE", ",", "clsSet", ")", ";", "addClassNames", "(", "fileName", ",", "clsSet", ")", ";", "}", "return", "clsSet", ";", "}", "/", "**", "*", "@", "return", "Black", "list", "of", "classes", ".", "*", "/", "private", "ClassSet", "classBlackList", "(", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "blackListFileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_BLACKLIST", ")", ";", "if", "(", "blackListFileName", "!", "=", "null", ")", "addClassNames", "(", "blackListFileName", ",", "clsSet", "=", "new", "ClassSet", "(", "))", ";", "return", "clsSet", ";", "}", "/", "**", "*", "Reads", "class", "names", "from", "resource", "referred", "by", "given", "system", "property", "name", "and", "returns", "set", "of", "classes", ".", "*", "*", "@", "param", "fileName", "File", "name", "containing", "list", "of", "classes", ".", "*", "@", "param", "clsSet", "Class", "set", "for", "update", ".", "*", "@", "return", "Set", "of", "classes", ".", "*", "/", "private", "void", "addClassNames", "(", "String", "fileName", ",", "ClassSet", "clsSet", ")", "throws", "IgniteCheckedException", "{", "InputStream", "is", "=", "this", ".", "getClass", "(", ").", "getClassLoader", "(", ").", "getResourceAsStream", "(", "fileName", ")", ";", "if", "(", "is", "=", "=", "null", ")", "{", "try", "{", "is", "=", "new", "FileInputStream", "(", "new", "File", "(", "fileName", ")", ");", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "File", "\"", "+", "fileName", "+", "\"", "not", "found", ".", "\")", ";", "}", "}", "try", "(", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "is", ")", "))", "{", "String", "line", ";", "for", "(", "int", "i", "=", "1", ";", "(", "line", "=", "reader", ".", "readLine", "(", "))", "!", "=", "null", ";", "i", "+", "+)", "{", "String", "s", "=", "line", ".", "trim", "(", ");", "if", "(", "!", "s", ".", "isEmpty", "(", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "#'", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "['", ")", "{", "try", "{", "clsSet", ".", "add", "(", "s", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "list", "of", "classes", "\"", "+", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "\"", ",", "row", "=", "\"", "+", "i", "+", "\"", ",", "line", "=", "\"", "+", "s", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "}", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "and", "creating", "list", "of", "classes", "\"", "+", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "ObjectInput", "in", "=", "new", "ObjectInputStream", "(", "tmp", ")", ";", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "))", ";", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "))", ";", "org", ".", "apache", ".", "ignite", ".", "stream", ".", "socket", ".", "SocketStreamerUnmarshalVulnerabilityTest", "$", "Exploit", "cliCfg", ".", "setMarshaller", "(", "new", "GridClientJdkMarshaller", "(", "))", ";"], "docstring_tokens": ["does", "not", "have", "a", "list", "of", "classes", "allowed", "for", "serialization/deserialization"]}
{"contents": ["KYLIN-4426", "CliCommandExecutor"], "code_tokens": ["public", "static", "final", "String", "COMMAND_WHITE_LIST", "=", "\"", "[^", "\\\\", "w", "%", ",@", "/:", "=?", ".\\", "\"\\", "\\[", "\\\\", "]]", "\";", "return", "checkParameter", "(", "commandParameter", ",", "COMMAND_INJECT_REX", ")", ";", "}", "public", "static", "String", "checkParameterWhiteList", "(", "String", "commandParameter", ")", "{", "return", "checkParameter", "(", "commandParameter", ",", "COMMAND_WHITE_LIST", ")", ";", "}", "private", "static", "String", "checkParameter", "(", "String", "commandParameter", ",", "String", "rex", ")", "{", "String", "repaired", "=", "commandParameter", ".", "replaceAll", "(", "rex", ",", "\"", "\")", ";", "logger", ".", "info", "(", "\"", "Detected", "illegal", "character", "in", "command", "{", "}", "by", "{", "}", ",", "replace", "it", "to", "{", "}.", "\",", "commandParameter", ",", "rex", ",", "repaired", ")", ";", "private", "String", "[", "][", "]", "commands", "=", "{", "{", "\"", "nslookup", "unknown", ".", "com", "&", "\",", "\"", "nslookupunknown", ".", "com", "\"", "},", "{", "\"", "cat", "`", "whoami", "`", "\",", "\"", "catwhoami", "\"", "},", "{", "\"", "echo", "\\", "\"", "kylin", "@", "headnode", ":", "/", "home", "/", "kylin", "/", "lib", "/", "job", ".", "jar", "?", "key", "=", "Value123", "\\", "\",", "\",", "\"", "echo", "\\", "\"", "kylin", "@", "headnode", ":", "/", "home", "/", "kylin", "/", "lib", "/", "job", ".", "jar", "?", "key", "=", "Value123", "\\", "\",", "\"}", ",", "{", "\"", "whoami", ">", "/", "var", "/", "www", "/", "static", "/", "whoami", ".", "txt", "\"", ",", "\"", "whoami", "/", "var", "/", "www", "/", "static", "/", "whoami", ".", "txt", "\"", "},", "{", "\"", "mysql_test", "@", "jdbc", ",", "url", "=", "jdbc", ":", "mysql", ":", "//", "localhost", ":", "3306", "/", "kylin", ",", "username", "=", "kylin_test", ",", "password", "=", "bUmSqT", "/", "opyqz89Geu0yQ3g", "=", "=,", "maxActive", "=", "10", ",", "maxIdle", "=", "10", ",", "passwordEncrypted", "=", "true", "\"", ",", "\"", "mysql_test", "@", "jdbc", ",", "url", "=", "jdbc", ":", "mysql", ":", "//", "localhost", ":", "3306", "/", "kylin", ",", "username", "=", "kylin_test", ",", "password", "=", "bUmSqT", "/", "opyqz89Geu0yQ3g", "=", "=,", "maxActive", "=", "10", ",", "maxIdle", "=", "10", ",", "passwordEncrypted", "=", "true", "\"", "},", "{", "\"", "c1", "|", "|", "c2", "#", "|", "|", "c3", "|", "|", "*", "c4", "\\", "\\\"", ",", "\"", "c1c2c3c4", "\"", "},", "{", "\"", "c1", "&", "&\"", ",", "\"", "c1", "\"", "},", "{", "\"", "c1", "+", ">", "c2", "[", "p1", "]", "%\"", ",", "\"", "c1c2", "[", "p1", "]", "%\"", "},", "{", "\"", "c1", "|", "$", "{", "c2", "}", "\",", "\"", "c1c2", "\"", "},", "}", ";", "@", "Test", "public", "void", "testCmd2", "(", ")", "{", "for", "(", "String", "[", "]", "pair", ":", "commands", ")", "{", "assertEquals", "(", "pair", "[", "1", "]", ",", "CliCommandExecutor", ".", "checkParameterWhiteList", "(", "pair", "[", "0", "]", "))", ";", "}", "}", "String", "cmd", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "stringBuilder", ",", "KylinConfig", ".", "getKylinHome", "(", "),", "CliCommandExecutor", ".", "checkParameterWhiteList", "(", "srcCfgUri", ")", ",", "CliCommandExecutor", ".", "checkParameterWhiteList", "(", "dstCfgUri", ")", ",", "cube", ".", "getName", "(", "),", "CliCommandExecutor", ".", "checkParameterWhiteList", "(", "projectName", ")", ",", "config", ".", "isAutoMigrateCubeCopyAcl", "(", "),", "config", ".", "isAutoMigrateCubePurge", "(", "))", ";</s>String", "repaired", "=", "commandParameter", ".", "replaceAll", "(", "COMMAND_INJECT_REX", ",", "\"", "\")", ";", "logger", ".", "info", "(", "\"", "Detected", "illegal", "character", "in", "command", "{", "},", "replace", "it", "to", "{", "}.", "\",", "commandParameter", ",", "repaired", ")", ";", "String", "[", "][", "]", "commands", "=", "{", "{", "\"", "nslookup", "unknown", ".", "com", "&", "\",", "\"", "nslookupunknown", ".", "com", "\"", "},", "{", "\"", "cat", "`", "whoami", "`", "\",", "\"", "catwhoami", "\"", "},", "{", "\"", "whoami", ">", "/", "var", "/", "www", "/", "static", "/", "whoami", ".", "txt", "\"", ",", "\"", "whoami", "/", "var", "/", "www", "/", "static", "/", "whoami", ".", "txt", "\"", "},", "{", "\"", "c1", "|", "|", "c2", "#", "|", "|", "c3", "|", "|", "*", "c4", "\\", "\\\"", ",", "\"", "c1c2c3c4", "\"", "},", "{", "\"", "c1", "&", "&\"", ",", "\"", "c1", "\"", "},", "{", "\"", "c1", "+", ">", "c2", "[", "p1", "]", "%\"", ",", "\"", "c1c2", "[", "p1", "]", "%\"", "},", "{", "\"", "c1", "|", "$", "{", "c2", "}", "\",", "\"", "c1c2", "\"", "},", "}", ";", "String", "cmd", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "stringBuilder", ",", "KylinConfig", ".", "getKylinHome", "(", "),", "srcCfgUri", ",", "dstCfgUri", ",", "cube", ".", "getName", "(", "),", "projectName", ",", "config", ".", "isAutoMigrateCubeCopyAcl", "(", "),", "config", ".", "isAutoMigrateCubePurge", "(", "))", ";"], "docstring_tokens": ["misses", "necessary", "input", "validation"]}
{"contents": ["Add", "MvcRequestMatcher", "Fixes", "gh-3964"], "code_tokens": ["private", "final", "Map", "<", "Class", "<", "?", "extends", "Object", ">", ",", "Object", ">", "sharedObjects", "=", "new", "HashMap", "<", "Class", "<", "?", "extends", "Object", ">", ",", "Object", ">", "()", ";", "this", ".", "sharedObjects", ".", "put", "(", "sharedType", ",", "object", ")", ";", "public", "Map", "<", "Class", "<", "?", "extends", "Object", ">", ",", "Object", ">", "getSharedObjects", "(", ")", "{", "return", "this", ".", "objectPostProcessor", ".", "postProcess", "(", "object", ")", ";", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "servlet", ".", "util", ".", "matcher", ".", "MvcRequestMatcher", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "HandlerMappingIntrospector", ";", "private", "ApplicationContext", "context", ";", "protected", "final", "void", "setApplicationContext", "(", "ApplicationContext", "context", ")", "{", "this", ".", "context", "=", "context", ";", "}", "/", "**", "*", "<", "p", ">", "*", "Maps", "an", "{", "@", "link", "MvcRequestMatcher", "}", "that", "does", "not", "care", "which", "{", "@", "link", "HttpMethod", "}", "is", "*", "used", ".", "This", "matcher", "will", "use", "the", "same", "rules", "that", "Spring", "MVC", "uses", "for", "matching", ".", "For", "*", "example", ",", "often", "times", "a", "mapping", "of", "the", "path", "\"", "/", "path", "\"", "will", "match", "on", "\"", "/", "path", "\"", ",", "\"", "/", "path", "/", "\",", "*", "\"", "/", "path", ".", "html", "\"", ",", "etc", ".", "*", "<", "/", "p", ">", "*", "<", "p", ">", "*", "If", "the", "current", "request", "will", "not", "be", "processed", "by", "Spring", "MVC", ",", "a", "reasonable", "default", "*", "using", "the", "pattern", "as", "a", "ant", "pattern", "will", "be", "used", ".", "*", "<", "/", "p", ">", "*", "*", "@", "param", "mvcPatterns", "the", "patterns", "to", "match", "on", ".", "The", "rules", "for", "matching", "are", "defined", "by", "*", "Spring", "MVC", "*", "@", "return", "the", "object", "that", "is", "chained", "after", "creating", "the", "{", "@", "link", "RequestMatcher", "}", ".", "*", "/", "public", "C", "mvcMatchers", "(", "String", ".", "..", "mvcPatterns", ")", "{", "return", "mvcMatchers", "(", "null", ",", "mvcPatterns", ")", ";", "}", "/", "**", "*", "<", "p", ">", "*", "Maps", "an", "{", "@", "link", "MvcRequestMatcher", "}", "that", "also", "specifies", "a", "specific", "{", "@", "link", "HttpMethod", "}", "*", "to", "match", "on", ".", "This", "matcher", "will", "use", "the", "same", "rules", "that", "Spring", "MVC", "uses", "for", "*", "matching", ".", "For", "example", ",", "often", "times", "a", "mapping", "of", "the", "path", "\"", "/", "path", "\"", "will", "match", "on", "*", "\"", "/", "path", "\"", ",", "\"", "/", "path", "/", "\",", "\"", "/", "path", ".", "html", "\"", ",", "etc", ".", "*", "<", "/", "p", ">", "*", "<", "p", ">", "*", "If", "the", "current", "request", "will", "not", "be", "processed", "by", "Spring", "MVC", ",", "a", "reasonable", "default", "*", "using", "the", "pattern", "as", "a", "ant", "pattern", "will", "be", "used", ".", "*", "<", "/", "p", ">", "*", "*", "@", "param", "method", "the", "HTTP", "method", "to", "match", "on", "*", "@", "param", "mvcPatterns", "the", "patterns", "to", "match", "on", ".", "The", "rules", "for", "matching", "are", "defined", "by", "*", "Spring", "MVC", "*", "@", "return", "the", "object", "that", "is", "chained", "after", "creating", "the", "{", "@", "link", "RequestMatcher", "}", ".", "*", "/", "public", "C", "mvcMatchers", "(", "HttpMethod", "method", ",", "String", ".", "..", "mvcPatterns", ")", "{", "HandlerMappingIntrospector", "introspector", "=", "new", "HandlerMappingIntrospector", "(", "this", ".", "context", ")", ";", "List", "<", "RequestMatcher", ">", "matchers", "=", "new", "ArrayList", "<", "RequestMatcher", ">", "(", "mvcPatterns", ".", "length", ")", ";", "for", "(", "String", "mvcPattern", ":", "mvcPatterns", ")", "{", "MvcRequestMatcher", "matcher", "=", "new", "MvcRequestMatcher", "(", "introspector", ",", "mvcPattern", ")", ";", "if", "(", "method", "!", "=", "null", ")", "{", "matcher", ".", "setMethod", "(", "method", ")", ";", "}", "matchers", ".", "add", "(", "matcher", ")", ";", "}", "return", "chainRequestMatchers", "(", "matchers", ")", ";", "}", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "authentication", ".", "UsernamePasswordAuthenticationFilter", ";", "private", "final", "RequestMatcherConfigurer", "requestMatcherConfigurer", ";", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Map", "<", "Class", "<", "?", "extends", "Object", ">", ",", "Object", ">", "sharedObjects", ")", "{", "for", "(", "Map", ".", "Entry", "<", "Class", "<", "?", "extends", "Object", ">", ",", "Object", ">", "entry", ":", "sharedObjects", ".", "entrySet", "(", "))", "{", "setSharedObject", "(", "(", "Class", "<", "Object", ">", ")", "entry", ".", "getKey", "(", "),", "entry", ".", "getValue", "(", "))", ";", "ApplicationContext", "context", "=", "(", "ApplicationContext", ")", "sharedObjects", ".", "get", "(", "ApplicationContext", ".", "class", ")", ";", "this", ".", "requestMatcherConfigurer", "=", "new", "RequestMatcherConfigurer", "(", "context", ")", ";", "}", "private", "ApplicationContext", "getContext", "(", ")", "{", "return", "getSharedObject", "(", "ApplicationContext", ".", "class", ")", ";", "ApplicationContext", "context", "=", "getContext", "(", ");", "return", "getOrApply", "(", "new", "ExpressionUrlAuthorizationConfigurer", "<", "HttpSecurity", ">", "(", "context", ")", ")", "ApplicationContext", "context", "=", "getContext", "(", ");", "return", "getOrApply", "(", "new", "CsrfConfigurer", "<", "HttpSecurity", ">", "(", "context", ")", ");", "ApplicationContext", "context", "=", "getContext", "(", ");", "return", "getOrApply", "(", "new", "ChannelSecurityConfigurer", "<", "HttpSecurity", ">", "(", "context", ")", ")", ".", "getRegistry", "(", ");", "/", "**", "*", "@", "param", "context", "*", "/", "private", "RequestMatcherConfigurer", "(", "ApplicationContext", "context", ")", "{", "setApplicationContext", "(", "context", ")", ";", "}", "private", "IgnoredRequestConfigurer", "ignoredRequestRegistry", ";", "private", "IgnoredRequestConfigurer", "(", "ApplicationContext", "context", ")", "{", "setApplicationContext", "(", "context", ")", ";", "}", "@", "Override", "this", ".", "defaultWebSecurityExpressionHandler", ".", "setApplicationContext", "(", "applicationContext", ")", ";", "this", ".", "ignoredRequestRegistry", "=", "new", "IgnoredRequestConfigurer", "(", "applicationContext", ")", ";", "/", "**", "*", "Gets", "the", "ApplicationContext", "*", "@", "return", "the", "context", "*", "/", "protected", "final", "ApplicationContext", "getApplicationContext", "(", ")", "{", "return", "this", ".", "context", ";", "}", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "private", "final", "ChannelRequestMatcherRegistry", "REGISTRY", ";", "public", "ChannelSecurityConfigurer", "(", "ApplicationContext", "context", ")", "{", "this", ".", "REGISTRY", "=", "new", "ChannelRequestMatcherRegistry", "(", "context", ")", ";", "private", "ChannelRequestMatcherRegistry", "(", "ApplicationContext", "context", ")", "{", "setApplicationContext", "(", "context", ")", ";", "}", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "private", "final", "ApplicationContext", "context", ";", "public", "CsrfConfigurer", "(", "ApplicationContext", "context", ")", "{", "this", ".", "context", "=", "context", ";", "return", "new", "IgnoreCsrfProtectionRegistry", "(", "this", ".", "context", ")", ".", "antMatchers", "(", "antPatterns", ")", ".", "and", "(", ");", "/", "**", "*", "@", "param", "context", "*", "/", "private", "IgnoreCsrfProtectionRegistry", "(", "ApplicationContext", "context", ")", "{", "setApplicationContext", "(", "context", ")", ";", "}", "private", "final", "ExpressionInterceptUrlRegistry", "REGISTRY", ";", "public", "ExpressionUrlAuthorizationConfigurer", "(", "ApplicationContext", "context", ")", "{", "this", ".", "REGISTRY", "=", "new", "ExpressionInterceptUrlRegistry", "(", "context", ")", ";", "/", "**", "*", "@", "param", "context", "*", "/", "private", "ExpressionInterceptUrlRegistry", "(", "ApplicationContext", "context", ")", "{", "setApplicationContext", "(", "context", ")", ";", "}", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "private", "final", "StandardInterceptUrlRegistry", "REGISTRY", ";", "public", "UrlAuthorizationConfigurer", "(", "ApplicationContext", "context", ")", "{", "this", ".", "REGISTRY", "=", "new", "StandardInterceptUrlRegistry", "(", "context", ")", ";", "}", "/", "**", "*", "@", "param", "context", "*", "/", "private", "StandardInterceptUrlRegistry", "(", "ApplicationContext", "context", ")", "{", "setApplicationContext", "(", "context", ")", ";", "}", "builder", ".", "addConstructorArgValue", "(", "matcherType", ".", "createMatcher", "(", "pc", ",", "path", ",", "null", ")", ");", "+", "\"", "'", "must", "not", "be", "empty", "\"", ",", "elt", ")", ";", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "parserContext", ",", "path", ",", "null", ")", ";", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "parserContext", ",", "path", ",", "method", ")", ";", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "parserContext", ",", "\"", "/*", "*\"", ",", "null", ")", ";", "/", "*", "*", "Copyright", "2012", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "config", ".", "http", ";", "import", "org", ".", "springframework", ".", "beans", ".", "BeansException", ";", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContext", ";", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationContextAware", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "HandlerMappingIntrospector", ";", "/", "**", "*", "Used", "for", "creating", "an", "instance", "of", "{", "@", "link", "HandlerMappingIntrospector", "}", "and", "autowiring", "the", "*", "{", "@", "link", "ApplicationContext", "}", ".", "*", "*", "@", "author", "Rob", "Winch", "*", "@", "since", "4", ".", "1", ".", "1", "*", "/", "class", "HandlerMappingIntrospectorFactoryBean", "implements", "ApplicationContextAware", "{", "private", "ApplicationContext", "context", ";", "HandlerMappingIntrospector", "createHandlerMappingIntrospector", "(", ")", "{", "return", "new", "HandlerMappingIntrospector", "(", "this", ".", "context", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "@", "see", "org", ".", "springframework", ".", "context", ".", "ApplicationContextAware", "#", "setApplicationContext", "(", "org", ".", "*", "springframework", ".", "context", ".", "ApplicationContext", ")", "*", "/", "@", "Override", "public", "void", "setApplicationContext", "(", "ApplicationContext", "applicationContext", ")", "throws", "BeansException", "{", "this", ".", "context", "=", "applicationContext", ";", "}", "}", "@", "@", "-", "613", ",", "7", "+", "613", ",", "7", "@", "@", "private", "void", "createChannelProcessingFilter", "(", ")", "{", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "pc", ",", "path", ",", "method", ")", ";", "filterChainMatcher", "=", "MatcherType", ".", "fromElement", "(", "element", ")", ".", "createMatcher", "(", "pc", ",", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "xml", ".", "ParserContext", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "servlet", ".", "util", ".", "matcher", ".", "MvcRequestMatcher", ";", "RegexRequestMatcher", ".", "class", ")", ",", "mvc", "(", "MvcRequestMatcher", ".", "class", ")", ";", "private", "static", "final", "String", "HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME", "=", "\"", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "HandlerMappingIntrospector", "\"", ";", "private", "static", "final", "String", "HANDLER_MAPPING_INTROSPECTOR_FACTORY_BEAN_NAME", "=", "\"", "org", ".", "springframework", ".", "security", ".", "config", ".", "http", ".", "HandlerMappingIntrospectorFactoryBean", "\"", ";", "final", "Class", "<", "?", "extends", "RequestMatcher", ">", "type", ";", "public", "BeanDefinition", "createMatcher", "(", "ParserContext", "pc", ",", "String", "path", ",", "String", "method", ")", "{", "if", "(", "this", "=", "=", "mvc", ")", "{", "if", "(", "!", "pc", ".", "getRegistry", "(", ").", "isBeanNameInUse", "(", "HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME", ")", ")", "{", "BeanDefinitionBuilder", "hmifb", "=", "BeanDefinitionBuilder", ".", "rootBeanDefinition", "(", "HandlerMappingIntrospectorFactoryBean", ".", "class", ")", ";", "pc", ".", "getRegistry", "(", ").", "registerBeanDefinition", "(", "HANDLER_MAPPING_INTROSPECTOR_FACTORY_BEAN_NAME", ",", "hmifb", ".", "getBeanDefinition", "(", "))", ";", "RootBeanDefinition", "hmi", "=", "new", "RootBeanDefinition", "(", "HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME", ")", ";", "hmi", ".", "setFactoryBeanName", "(", "HANDLER_MAPPING_INTROSPECTOR_FACTORY_BEAN_NAME", ")", ";", "hmi", ".", "setFactoryMethodName", "(", "\"", "createHandlerMappingIntrospector", "\"", ");", "pc", ".", "getRegistry", "(", ").", "registerBeanDefinition", "(", "HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME", ",", "hmi", ")", ";", "}", "matcherBldr", ".", "addConstructorArgReference", "(", "HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME", ")", ";", "}", "if", "(", "this", "=", "=", "mvc", ")", "{", "matcherBldr", ".", "addPropertyValue", "(", "\"", "method", "\"", ",", "method", ")", ";", "}", "else", "{", "matcherBldr", ".", "addConstructorArgValue", "(", "method", ")", ";", "}", "#", "#", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "mvc", "'", "(", "for", "Spring", "MVC", "matcher", ")", ",", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "attribute", "request", "-", "matcher", "{", "\"", "mvc", "\"", "|", "\"", "ant", "\"", "|", "\"", "regex", "\"", "|", "\"", "ciRegex", "\"", "}", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "mvc", "'", "(", "for", "Spring", "MVC", "matcher", ")", ",", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "enumeration", "value", "=", "\"", "mvc", "\"", "/>", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "mvc", "'", "(", "for", "Spring", "MVC", "matcher", ")", ",", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "enumeration", "value", "=", "\"", "mvc", "\"", "/>", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "mvc", "'", "(", "for", "Spring", "MVC", "matcher", ")", ",", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "enumeration", "value", "=", "\"", "mvc", "\"", "/>", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "mvc", "'", "(", "for", "Spring", "MVC", "matcher", ")", ",", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "enumeration", "value", "=", "\"", "mvc", "\"", "/>", ".", "apply", "(", "new", "UrlAuthorizationConfigurer", "<", "HttpSecurity", ">", "(", "getApplicationContext", "(", "))", ").", "getRegistry", "(", ")", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RestController", ";", "def", "\"", "intercept", "-", "url", "supports", "mvc", "matchers", "\"", "()", "{", "setup", ":", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "method", ":", "'", "GET", "'", ")", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ")", "MockFilterChain", "chain", "=", "new", "MockFilterChain", "(", ")", "xml", ".", "http", "(", "'", "request", "-", "matcher", "'", ":'", "mvc", "'", ")", "{", "'", "http", "-", "basic", "'", "()", "'", "intercept", "-", "url", "'", "(", "pattern", ":", "'", "/", "path", "'", ",", "access", ":", "\"", "denyAll", "\"", ")", "}", "bean", "(", "'", "pathController", "'", ",", "PathController", ")", "xml", ".", "'", "mvc", ":", "annotation", "-", "driven", "'", "()", "createAppContext", "(", ")", "when", ":", "request", ".", "servletPath", "=", "\"", "/", "path", "\"", "springSecurityFilterChain", ".", "doFilter", "(", "request", ",", "response", ",", "chain", ")", "then", ":", "response", ".", "status", "=", "=", "HttpServletResponse", ".", "SC_UNAUTHORIZED", "when", ":", "request", "=", "new", "MockHttpServletRequest", "(", "method", ":", "'", "GET", "'", ")", "response", "=", "new", "MockHttpServletResponse", "(", ")", "chain", "=", "new", "MockFilterChain", "(", ")", "request", ".", "servletPath", "=", "\"", "/", "path", ".", "html", "\"", "springSecurityFilterChain", ".", "doFilter", "(", "request", ",", "response", ",", "chain", ")", "then", ":", "response", ".", "status", "=", "=", "HttpServletResponse", ".", "SC_UNAUTHORIZED", "when", ":", "request", "=", "new", "MockHttpServletRequest", "(", "method", ":", "'", "GET", "'", ")", "response", "=", "new", "MockHttpServletResponse", "(", ")", "chain", "=", "new", "MockFilterChain", "(", ")", "request", ".", "servletPath", "=", "\"", "/", "path", "/", "\"", "springSecurityFilterChain", ".", "doFilter", "(", "request", ",", "response", ",", "chain", ")", "then", ":", "response", ".", "status", "=", "=", "HttpServletResponse", ".", "SC_UNAUTHORIZED", "}", "def", "\"", "intercept", "-", "url", "mvc", "supports", "path", "variables", "\"", "()", "{", "setup", ":", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "method", ":", "'", "GET", "'", ")", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ")", "MockFilterChain", "chain", "=", "new", "MockFilterChain", "(", ")", "xml", ".", "http", "(", "'", "request", "-", "matcher", "'", ":'", "mvc", "'", ")", "{", "'", "http", "-", "basic", "'", "()", "'", "intercept", "-", "url", "'", "(", "pattern", ":", "'", "/", "user", "/", "{", "un", "}", "/*", "*'", ",", "access", ":", "\"", "#", "un", "=", "=", "'", "user", "'", "\")", "}", "createAppContext", "(", ")", "when", ":", "'", "user", "can", "access", "'", "request", ".", "servletPath", "=", "'", "/", "user", "/", "user", "/", "abc", "'", "springSecurityFilterChain", ".", "doFilter", "(", "request", ",", "response", ",", "chain", ")", "then", ":", "'", "The", "response", "is", "OK", "'", "response", ".", "status", "=", "=", "HttpServletResponse", ".", "SC_OK", "when", ":", "'", "cannot", "access", "otheruser", "'", "request", "=", "new", "MockHttpServletRequest", "(", "method", ":", "'", "GET", "'", ",", "servletPath", ":", "'", "/", "user", "/", "otheruser", "/", "abc", "'", ")", "login", "(", "request", ",", "'", "user", "'", ",", "'", "password", "'", ")", "chain", ".", "reset", "(", ")", "springSecurityFilterChain", ".", "doFilter", "(", "request", ",", "response", ",", "chain", ")", "then", ":", "'", "The", "response", "is", "OK", "'", "response", ".", "status", "=", "=", "HttpServletResponse", ".", "SC_FORBIDDEN", "when", ":", "'", "user", "can", "access", "case", "insensitive", "URL", "'", "request", "=", "new", "MockHttpServletRequest", "(", "method", ":", "'", "GET", "'", ",", "servletPath", ":", "'", "/", "USER", "/", "user", "/", "abc", "'", ")", "login", "(", "request", ",", "'", "user", "'", ",", "'", "password", "'", ")", "chain", ".", "reset", "(", ")", "springSecurityFilterChain", ".", "doFilter", "(", "request", ",", "response", ",", "chain", ")", "then", ":", "'", "The", "response", "is", "OK", "'", "response", ".", "status", "=", "=", "HttpServletResponse", ".", "SC_FORBIDDEN", "}", "@", "RestController", "static", "class", "PathController", "{", "@", "RequestMapping", "(", "\"/", "path", "\"", ")", "public", "String", "path", "(", ")", "{", "return", "\"", "path", "\"", ";", "}", "}", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockServletContext", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RestController", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "config", ".", "annotation", ".", "EnableWebMvc", ";", "@", "Test", "public", "void", "mvcMatcher", "(", ")", "throws", "Exception", "{", "loadConfig", "(", "MvcMatcherConfig", ".", "class", ")", ";", "this", ".", "request", ".", "setServletPath", "(", "\"/", "path", "\"", ");", "this", ".", "springSecurityFilterChain", ".", "doFilter", "(", "this", ".", "request", ",", "this", ".", "response", ",", "this", ".", "chain", ")", ";", "assertThat", "(", "this", ".", "response", ".", "getStatus", "(", "))", ".", "isEqualTo", "(", "HttpServletResponse", ".", "SC_UNAUTHORIZED", ")", ";", "setup", "(", ");", "this", ".", "request", ".", "setServletPath", "(", "\"/", "path", ".", "html", "\"", ");", "this", ".", "springSecurityFilterChain", ".", "doFilter", "(", "this", ".", "request", ",", "this", ".", "response", ",", "this", ".", "chain", ")", ";", "assertThat", "(", "this", ".", "response", ".", "getStatus", "(", "))", ".", "isEqualTo", "(", "HttpServletResponse", ".", "SC_UNAUTHORIZED", ")", ";", "setup", "(", ");", "this", ".", "request", ".", "setServletPath", "(", "\"/", "path", "/", "\")", ";", "this", ".", "springSecurityFilterChain", ".", "doFilter", "(", "this", ".", "request", ",", "this", ".", "response", ",", "this", ".", "chain", ")", ";", "assertThat", "(", "this", ".", "response", ".", "getStatus", "(", "))", ".", "isEqualTo", "(", "HttpServletResponse", ".", "SC_UNAUTHORIZED", ")", ";", "}", "@", "EnableWebSecurity", "@", "Configuration", "@", "EnableWebMvc", "static", "class", "MvcMatcherConfig", "extends", "WebSecurityConfigurerAdapter", "{", "@", "Override", "protected", "void", "configure", "(", "HttpSecurity", "http", ")", "throws", "Exception", "{", "/", "/", "@", "formatter", ":", "off", "http", ".", "httpBasic", "(", ").", "and", "(", ")", ".", "authorizeRequests", "(", ")", ".", "mvcMatchers", "(", "\"/", "path", "\"", ").", "denyAll", "(", ");", "/", "/", "@", "formatter", ":", "on", "}", "@", "Override", "protected", "void", "configure", "(", "AuthenticationManagerBuilder", "auth", ")", "throws", "Exception", "{", "/", "/", "@", "formatter", ":", "off", "auth", ".", "inMemoryAuthentication", "(", ");", "/", "/", "@", "formatter", ":", "on", "}", "@", "RestController", "static", "class", "PathController", "{", "@", "RequestMapping", "(", "\"/", "path", "\"", ")", "public", "String", "path", "(", ")", "{", "return", "\"", "path", "\"", ";", "}", "}", "}", "@", "Test", "public", "void", "mvcMatcherPathVariables", "(", ")", "throws", "Exception", "{", "loadConfig", "(", "MvcMatcherPathVariablesConfig", ".", "class", ")", ";", "this", ".", "request", ".", "setServletPath", "(", "\"/", "user", "/", "user", "\"", ");", "this", ".", "springSecurityFilterChain", ".", "doFilter", "(", "this", ".", "request", ",", "this", ".", "response", ",", "this", ".", "chain", ")", ";", "assertThat", "(", "this", ".", "response", ".", "getStatus", "(", "))", ".", "isEqualTo", "(", "HttpServletResponse", ".", "SC_OK", ")", ";", "this", ".", "setup", "(", ");", "this", ".", "request", ".", "setServletPath", "(", "\"/", "user", "/", "deny", "\"", ");", "this", ".", "springSecurityFilterChain", ".", "doFilter", "(", "this", ".", "request", ",", "this", ".", "response", ",", "this", ".", "chain", ")", ";", "assertThat", "(", "this", ".", "response", ".", "getStatus", "(", "))", ".", "isEqualTo", "(", "HttpServletResponse", ".", "SC_UNAUTHORIZED", ")", ";", "}", "@", "EnableWebSecurity", "@", "Configuration", "@", "EnableWebMvc", "static", "class", "MvcMatcherPathVariablesConfig", "extends", "WebSecurityConfigurerAdapter", "{", "@", "Override", "protected", "void", "configure", "(", "HttpSecurity", "http", ")", "throws", "Exception", "{", "/", "/", "@", "formatter", ":", "off", "http", ".", "httpBasic", "(", ").", "and", "(", ")", ".", "authorizeRequests", "(", ")", ".", "mvcMatchers", "(", "\"/", "user", "/", "{", "userName", "}", "\")", ".", "access", "(", "\"#", "userName", "=", "=", "'", "user", "'", "\")", ";", "/", "/", "@", "formatter", ":", "on", "}", "@", "Override", "protected", "void", "configure", "(", "AuthenticationManagerBuilder", "auth", ")", "throws", "Exception", "{", "/", "/", "@", "formatter", ":", "off", "auth", ".", "inMemoryAuthentication", "(", ");", "/", "/", "@", "formatter", ":", "on", "}", "@", "RestController", "static", "class", "PathController", "{", "@", "RequestMapping", "(", "\"/", "path", "\"", ")", "public", "String", "path", "(", ")", "{", "return", "\"", "path", "\"", ";", "}", "}", "}", "this", ".", "context", ".", "setServletContext", "(", "new", "MockServletContext", "(", "))", ";", "*", "<", "<", "mvc", "-", "requestmatcher", ",", "MvcRequestMatcher", ">", ">", "[", "[", "mvc", "-", "requestmatcher", "]", "]", "=", "==", "MvcRequestMatcher", "Spring", "Security", "provides", "deep", "integration", "with", "how", "Spring", "MVC", "matches", "on", "URLs", "with", "`", "MvcRequestMatcher", "`", ".", "This", "is", "helpful", "to", "ensure", "your", "Security", "rules", "match", "the", "logic", "used", "to", "handle", "your", "requests", ".", "[", "NOTE", "]", "=", "==", "=", "It", "is", "always", "recommended", "to", "provide", "authorization", "rules", "by", "matching", "on", "the", "`", "HttpServletRequest", "`", "and", "method", "security", ".", "Providing", "authorization", "rules", "by", "matching", "on", "`", "HttpServletRequest", "`", "is", "good", "because", "it", "happens", "very", "early", "in", "the", "code", "path", "and", "helps", "reduce", "the", "https", ":", "//", "en", ".", "wikipedia", ".", "org", "/", "wiki", "/", "Attack_surface", "[", "attack", "surface", "]", ".", "Method", "security", "ensures", "that", "if", "someone", "has", "bypassed", "the", "web", "authorization", "rules", ",", "that", "your", "application", "is", "still", "secured", ".", "This", "is", "what", "is", "known", "as", "https", ":", "//", "en", ".", "wikipedia", ".", "org", "/", "wiki", "/", "Defense_in_depth_", "(", "computing", ")", "[", "Defence", "in", "Depth", "]", "=", "==", "=", "Consider", "a", "controller", "that", "is", "mapped", "as", "follows", ":", "[", "source", ",", "java", "]", "-", "--", "-", "@", "RequestMapping", "(", "\"/", "admin", "\"", ")", "public", "String", "admin", "(", ")", "{", "-", "--", "-", "If", "we", "wanted", "to", "restrict", "access", "to", "this", "controller", "method", "to", "admin", "users", ",", "a", "developer", "can", "provide", "authorization", "rules", "by", "matching", "on", "the", "`", "HttpServletRequest", "`", "with", "the", "following", ":", "[", "source", ",", "java", "]", "-", "--", "-", "protected", "configure", "(", "HttpSecurity", "http", ")", "throws", "Exception", "{", "http", ".", "authorizeRequests", "(", ")", ".", "antMatchers", "(", "\"/", "admin", "\"", ").", "hasRole", "(", "\"", "ADMIN", "\"", ");", "}", "-", "--", "-", "or", "in", "XML", "[", "source", ",", "xml", "]", "-", "--", "-", "<", "http", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "admin", "\"", "access", "=", "\"", "hasRole", "(", "'", "ADMIN", "'", ")\"", "/>", "<", "/", "http", ">", "-", "--", "-", "With", "either", "configuration", ",", "the", "URL", "`", "/", "admin", "`", "will", "require", "the", "authenticated", "user", "to", "be", "an", "admin", "user", ".", "However", ",", "depending", "on", "our", "Spring", "MVC", "configuration", ",", "the", "URL", "`", "/", "admin", ".", "html", "`", "will", "also", "map", "to", "our", "`", "admin", "(", ")`", "method", ".", "Additionally", ",", "depending", "on", "our", "Spring", "MVC", "configuration", ",", "the", "URL", "`", "/", "admin", "/", "`", "will", "also", "map", "to", "our", "`", "admin", "(", ")`", "method", ".", "The", "problem", "is", "that", "our", "security", "rule", "is", "only", "protecting", "`", "/", "admin", "`", ".", "We", "could", "add", "additional", "rules", "for", "all", "the", "permutations", "of", "Spring", "MVC", ",", "but", "this", "would", "be", "quite", "verbose", "and", "tedious", ".", "Instead", ",", "we", "can", "leverage", "Spring", "Security", "'", "s", "`", "MvcRequestMatcher", "`", ".", "The", "following", "configuration", "will", "protect", "the", "same", "URLs", "that", "Spring", "MVC", "will", "match", "on", "by", "using", "Spring", "MVC", "to", "match", "on", "the", "URL", ".", "[", "source", ",", "java", "]", "-", "--", "-", "protected", "configure", "(", "HttpSecurity", "http", ")", "throws", "Exception", "{", "http", ".", "authorizeRequests", "(", ")", ".", "mvcMatchers", "(", "\"/", "admin", "\"", ").", "hasRole", "(", "\"", "ADMIN", "\"", ");", "}", "-", "--", "-", "or", "in", "XML", "[", "source", ",", "xml", "]", "-", "--", "-", "<", "http", "request", "-", "matcher", "=", "\"", "mvc", "\"", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "admin", "\"", "access", "=", "\"", "hasRole", "(", "'", "ADMIN", "'", ")\"", "/>", "<", "/", "http", ">", "-", "--", "-", "Defines", "the", "`", "RequestMatcher", "`", "strategy", "used", "in", "the", "`", "FilterChainProxy", "`", "and", "the", "beans", "created", "by", "the", "`", "intercept", "-", "url", "`", "to", "match", "incoming", "requests", ".", "Options", "are", "currently", "`", "mvc", "`", ",", "`", "ant", "`", ",", "`", "regex", "`", "and", "`", "ciRegex", "`", ",", "for", "Spring", "MVC", ",", "ant", ",", "regular", "-", "expression", "and", "case", "-", "insensitive", "regular", "-", "expression", "respectively", ".", "A", "separate", "instance", "is", "created", "for", "each", "<", "<", "nsa", "-", "intercept", "-", "url", ",", "intercept", "-", "url", ">", ">", "element", "using", "its", "<", "<", "nsa", "-", "intercept", "-", "url", "-", "pattern", ",", "pattern", ">", ">", "and", "<", "<", "nsa", "-", "intercept", "-", "url", "-", "method", ",", "method", ">", ">", "attributes", ".", "Ant", "paths", "are", "matched", "using", "an", "`", "AntPathRequestMatcher", "`", "and", "regular", "expressions", "are", "matched", "using", "a", "`", "RegexRequestMatcher", "`", ".", "See", "the", "Javadoc", "for", "these", "classes", "for", "more", "details", "on", "exactly", "how", "the", "matching", "is", "performed", ".", "Ant", "paths", "are", "the", "default", "strategy", ".", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "RequestVariablesExtractor", ";", "if", "(", "request", "instanceof", "RequestVariablesExtractor", ")", "{", "return", "new", "RequestVariablesExtractorEvaluationContextPostProcessor", "(", "(", "RequestVariablesExtractor", ")", "request", ")", ";", "}", "static", "class", "RequestVariablesExtractorEvaluationContextPostProcessor", "extends", "AbstractVariableEvaluationContextPostProcessor", "{", "private", "final", "RequestVariablesExtractor", "matcher", ";", "public", "RequestVariablesExtractorEvaluationContextPostProcessor", "(", "RequestVariablesExtractor", "matcher", ")", "{", "this", ".", "matcher", "=", "matcher", ";", "}", "@", "Override", "Map", "<", "String", ",", "String", ">", "extractVariables", "(", "HttpServletRequest", "request", ")", "{", "return", "this", ".", "matcher", ".", "extractUriTemplateVariables", "(", "request", ")", ";", "}", "@", "Override", "String", "postProcessVariableName", "(", "String", "variableName", ")", "{", "return", "variableName", ";", "}", "}", "/", "*", "*", "Copyright", "2012", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "web", ".", "servlet", ".", "util", ".", "matcher", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpMethod", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "RequestMatcher", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "RequestVariablesExtractor", ";", "import", "org", ".", "springframework", ".", "util", ".", "AntPathMatcher", ";", "import", "org", ".", "springframework", ".", "util", ".", "PathMatcher", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "HandlerMappingIntrospector", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "MatchableHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "RequestMatchResult", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UrlPathHelper", ";", "/", "**", "*", "A", "{", "@", "link", "RequestMatcher", "}", "that", "uses", "Spring", "MVC", "'", "s", "{", "@", "link", "HandlerMappingIntrospector", "}", "to", "*", "match", "the", "path", "and", "extract", "variables", ".", "*", "*", "@", "author", "Rob", "Winch", "*", "@", "since", "4", ".", "1", ".", "1", "*", "/", "public", "final", "class", "MvcRequestMatcher", "implements", "RequestMatcher", ",", "RequestVariablesExtractor", "{", "private", "final", "DefaultMatcher", "defaultMatcher", "=", "new", "DefaultMatcher", "(", ");", "private", "final", "HandlerMappingIntrospector", "introspector", ";", "private", "final", "String", "pattern", ";", "private", "HttpMethod", "method", ";", "public", "MvcRequestMatcher", "(", "HandlerMappingIntrospector", "introspector", ",", "String", "pattern", ")", "{", "this", ".", "introspector", "=", "introspector", ";", "this", ".", "pattern", "=", "pattern", ";", "}", "@", "Override", "public", "boolean", "matches", "(", "HttpServletRequest", "request", ")", "{", "if", "(", "this", ".", "method", "!", "=", "null", "&", "&", "!", "this", ".", "method", ".", "name", "(", ").", "equals", "(", "request", ".", "getMethod", "(", "))", ")", "{", "return", "false", ";", "}", "MatchableHandlerMapping", "mapping", "=", "getMapping", "(", "request", ")", ";", "if", "(", "mapping", "=", "=", "null", ")", "{", "return", "this", ".", "defaultMatcher", ".", "matches", "(", "request", ")", ";", "}", "RequestMatchResult", "matchResult", "=", "mapping", ".", "match", "(", "request", ",", "this", ".", "pattern", ")", ";", "return", "matchResult", "!", "=", "null", ";", "}", "private", "MatchableHandlerMapping", "getMapping", "(", "HttpServletRequest", "request", ")", "{", "try", "{", "return", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "request", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "return", "null", ";", "}", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "@", "see", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ".", "RequestVariablesExtractor", "#", "*", "extractUriTemplateVariables", "(", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ")", "*", "/", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "extractUriTemplateVariables", "(", "HttpServletRequest", "request", ")", "{", "MatchableHandlerMapping", "mapping", "=", "getMapping", "(", "request", ")", ";", "if", "(", "mapping", "=", "=", "null", ")", "{", "return", "this", ".", "defaultMatcher", ".", "extractUriTemplateVariables", "(", "request", ")", ";", "}", "RequestMatchResult", "result", "=", "mapping", ".", "match", "(", "request", ",", "this", ".", "pattern", ")", ";", "return", "result", "=", "=", "null", "?", "Collections", ".", "<", "String", ",", "String", ">", "emptyMap", "(", ")", ":", "result", ".", "extractUriTemplateVariables", "(", ");", "}", "/", "**", "*", "@", "param", "method", "the", "method", "to", "set", "*", "/", "public", "void", "setMethod", "(", "HttpMethod", "method", ")", "{", "this", ".", "method", "=", "method", ";", "}", "private", "class", "DefaultMatcher", "implements", "RequestMatcher", ",", "RequestVariablesExtractor", "{", "private", "final", "UrlPathHelper", "pathHelper", "=", "new", "UrlPathHelper", "(", ");", "private", "final", "PathMatcher", "pathMatcher", "=", "new", "AntPathMatcher", "(", ");", "@", "Override", "public", "boolean", "matches", "(", "HttpServletRequest", "request", ")", "{", "String", "lookupPath", "=", "this", ".", "pathHelper", ".", "getLookupPathForRequest", "(", "request", ")", ";", "return", "matches", "(", "lookupPath", ")", ";", "}", "private", "boolean", "matches", "(", "String", "lookupPath", ")", "{", "return", "this", ".", "pathMatcher", ".", "match", "(", "MvcRequestMatcher", ".", "this", ".", "pattern", ",", "lookupPath", ")", ";", "}", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "extractUriTemplateVariables", "(", "HttpServletRequest", "request", ")", "{", "String", "lookupPath", "=", "this", ".", "pathHelper", ".", "getLookupPathForRequest", "(", "request", ")", ";", "if", "(", "matches", "(", "lookupPath", ")", ")", "{", "return", "this", ".", "pathMatcher", ".", "extractUriTemplateVariables", "(", "MvcRequestMatcher", ".", "this", ".", "pattern", ",", "lookupPath", ")", ";", "}", "return", "Collections", ".", "emptyMap", "(", ");", "}", "}", "}", "/", "*", "*", "Copyright", "2012", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "web", ".", "util", ".", "matcher", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "/", "**", "*", "An", "interface", "for", "extracting", "URI", "variables", "from", "the", "{", "@", "link", "HttpServletRequest", "}", ".", "*", "*", "@", "author", "Rob", "Winch", "*", "@", "since", "4", ".", "1", ".", "1", "*", "/", "public", "interface", "RequestVariablesExtractor", "{", "/", "**", "*", "Extract", "URL", "template", "variables", "from", "the", "request", ".", "*", "*", "@", "param", "request", "the", "HttpServletRequest", "to", "obtain", "a", "URL", "to", "extract", "the", "variables", "from", "*", "@", "return", "the", "URL", "variables", "or", "empty", "if", "no", "variables", "are", "found", "*", "/", "Map", "<", "String", ",", "String", ">", "extractUriTemplateVariables", "(", "HttpServletRequest", "request", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "202", "@", "@", "/", "*", "*", "Copyright", "2012", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "web", ".", "servlet", ".", "util", ".", "matcher", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "mockito", ".", "ArgumentCaptor", ";", "import", "org", ".", "mockito", ".", "Captor", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "org", ".", "mockito", ".", "runners", ".", "MockitoJUnitRunner", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpMethod", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "web", ".", "HttpRequestMethodNotSupportedException", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "HandlerMappingIntrospector", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "MatchableHandlerMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "RequestMatchResult", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyZeroInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "/", "**", "*", "@", "author", "Rob", "Winch", "*", "/", "@", "RunWith", "(", "MockitoJUnitRunner", ".", "class", ")", "public", "class", "MvcRequestMatcherTests", "{", "@", "Mock", "HandlerMappingIntrospector", "introspector", ";", "@", "Mock", "MatchableHandlerMapping", "mapping", ";", "@", "Mock", "RequestMatchResult", "result", ";", "@", "Captor", "ArgumentCaptor", "<", "String", ">", "pattern", ";", "MockHttpServletRequest", "request", ";", "MvcRequestMatcher", "matcher", ";", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "this", ".", "request", "=", "new", "MockHttpServletRequest", "(", ");", "this", ".", "request", ".", "setMethod", "(", "\"", "GET", "\"", ");", "this", ".", "request", ".", "setServletPath", "(", "\"/", "path", "\"", ");", "this", ".", "matcher", "=", "new", "MvcRequestMatcher", "(", "this", ".", "introspector", ",", "\"", "/", "path", "\"", ");", "}", "@", "Test", "public", "void", "extractUriTemplateVariablesSuccess", "(", ")", "throws", "Exception", "{", "when", "(", "this", ".", "result", ".", "extractUriTemplateVariables", "(", "))", ".", "thenReturn", "(", "Collections", ".", "singletonMap", "(", "\"", "p", "\"", ",", "\"", "path", "\"", "))", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ")", ".", "thenReturn", "(", "this", ".", "mapping", ")", ";", "when", "(", "this", ".", "mapping", ".", "match", "(", "eq", "(", "this", ".", "request", ")", ",", "this", ".", "pattern", ".", "capture", "(", "))", ")", ".", "thenReturn", "(", "this", ".", "result", ")", ";", "this", ".", "matcher", "=", "new", "MvcRequestMatcher", "(", "this", ".", "introspector", ",", "\"", "/{", "p", "}", "\")", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ").", "thenReturn", "(", "null", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "extractUriTemplateVariables", "(", "this", ".", "request", ")", ")", ".", "containsEntry", "(", "\"", "p", "\"", ",", "\"", "path", "\"", ");", "}", "@", "Test", "public", "void", "extractUriTemplateVariablesFail", "(", ")", "throws", "Exception", "{", "when", "(", "this", ".", "result", ".", "extractUriTemplateVariables", "(", "))", ".", "thenReturn", "(", "Collections", ".", "<", "String", ",", "String", ">", "emptyMap", "(", "))", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ")", ".", "thenReturn", "(", "this", ".", "mapping", ")", ";", "when", "(", "this", ".", "mapping", ".", "match", "(", "eq", "(", "this", ".", "request", ")", ",", "this", ".", "pattern", ".", "capture", "(", "))", ")", ".", "thenReturn", "(", "this", ".", "result", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "extractUriTemplateVariables", "(", "this", ".", "request", ")", ").", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "extractUriTemplateVariablesDefaultSuccess", "(", ")", "throws", "Exception", "{", "this", ".", "matcher", "=", "new", "MvcRequestMatcher", "(", "this", ".", "introspector", ",", "\"", "/{", "p", "}", "\")", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ").", "thenReturn", "(", "null", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "extractUriTemplateVariables", "(", "this", ".", "request", ")", ")", ".", "containsEntry", "(", "\"", "p", "\"", ",", "\"", "path", "\"", ");", "}", "@", "Test", "public", "void", "extractUriTemplateVariablesDefaultFail", "(", ")", "throws", "Exception", "{", "this", ".", "matcher", "=", "new", "MvcRequestMatcher", "(", "this", ".", "introspector", ",", "\"", "/", "nomatch", "/", "{", "p", "}", "\")", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ").", "thenReturn", "(", "null", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "extractUriTemplateVariables", "(", "this", ".", "request", ")", ").", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "matchesPathOnlyTrue", "(", ")", "throws", "Exception", "{", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ")", ".", "thenReturn", "(", "this", ".", "mapping", ")", ";", "when", "(", "this", ".", "mapping", ".", "match", "(", "eq", "(", "this", ".", "request", ")", ",", "this", ".", "pattern", ".", "capture", "(", "))", ")", ".", "thenReturn", "(", "this", ".", "result", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isTrue", "(", ");", "assertThat", "(", "this", ".", "pattern", ".", "getValue", "(", "))", ".", "isEqualTo", "(", "\"/", "path", "\"", ");", "}", "@", "Test", "public", "void", "matchesDefaultMatches", "(", ")", "throws", "Exception", "{", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ").", "thenReturn", "(", "null", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isTrue", "(", ");", "}", "@", "Test", "public", "void", "matchesDefaultDoesNotMatch", "(", ")", "throws", "Exception", "{", "this", ".", "request", ".", "setServletPath", "(", "\"/", "other", "\"", ");", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ").", "thenReturn", "(", "null", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isFalse", "(", ");", "}", "@", "Test", "public", "void", "matchesPathOnlyFalse", "(", ")", "throws", "Exception", "{", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ")", ".", "thenReturn", "(", "this", ".", "mapping", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isFalse", "(", ");", "}", "@", "Test", "public", "void", "matchesMethodAndPathTrue", "(", ")", "throws", "Exception", "{", "this", ".", "matcher", ".", "setMethod", "(", "HttpMethod", ".", "GET", ")", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ")", ".", "thenReturn", "(", "this", ".", "mapping", ")", ";", "when", "(", "this", ".", "mapping", ".", "match", "(", "eq", "(", "this", ".", "request", ")", ",", "this", ".", "pattern", ".", "capture", "(", "))", ")", ".", "thenReturn", "(", "this", ".", "result", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isTrue", "(", ");", "assertThat", "(", "this", ".", "pattern", ".", "getValue", "(", "))", ".", "isEqualTo", "(", "\"/", "path", "\"", ");", "}", "@", "Test", "public", "void", "matchesMethodAndPathFalseMethod", "(", ")", "throws", "Exception", "{", "this", ".", "matcher", ".", "setMethod", "(", "HttpMethod", ".", "POST", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isFalse", "(", ");", "/", "/", "method", "compare", "should", "be", "done", "first", "since", "faster", "verifyZeroInteractions", "(", "this", ".", "introspector", ")", ";", "}", "/", "**", "*", "Malicious", "users", "can", "specify", "any", "HTTP", "Method", "to", "create", "a", "stacktrace", "and", "try", "to", "*", "expose", "useful", "information", "about", "the", "system", ".", "We", "should", "ensure", "we", "ignore", "invalid", "HTTP", "*", "methods", ".", "*", "@", "throws", "Exception", "if", "an", "error", "occurs", "*", "/", "@", "Test", "public", "void", "matchesInvalidMethodOnRequest", "(", ")", "throws", "Exception", "{", "this", ".", "matcher", ".", "setMethod", "(", "HttpMethod", ".", "GET", ")", ";", "this", ".", "request", ".", "setMethod", "(", "\"", "invalid", "\"", ");", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isFalse", "(", ");", "/", "/", "method", "compare", "should", "be", "done", "first", "since", "faster", "verifyZeroInteractions", "(", "this", ".", "introspector", ")", ";", "}", "@", "Test", "public", "void", "matchesMethodAndPathFalsePath", "(", ")", "throws", "Exception", "{", "this", ".", "matcher", ".", "setMethod", "(", "HttpMethod", ".", "GET", ")", ";", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ")", ".", "thenReturn", "(", "this", ".", "mapping", ")", ";", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isFalse", "(", ");", "}", "@", "Test", "public", "void", "matchesGetMatchableHandlerMappingNull", "(", ")", "throws", "Exception", "{", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isTrue", "(", ");", "}", "@", "Test", "public", "void", "matchesGetMatchableHandlerMappingThrows", "(", ")", "throws", "Exception", "{", "when", "(", "this", ".", "introspector", ".", "getMatchableHandlerMapping", "(", "this", ".", "request", ")", ").", "thenThrow", "(", "new", "HttpRequestMethodNotSupportedException", "(", "this", ".", "request", ".", "getMethod", "(", "))", ");", "assertThat", "(", "this", ".", "matcher", ".", "matches", "(", "this", ".", "request", ")", ").", "isTrue", "(", ");", "}", "}</s>private", "final", "Map", "<", "Class", "<", "Object", ">", ",", "Object", ">", "sharedObjects", "=", "new", "HashMap", "<", "Class", "<", "Object", ">", ",", "Object", ">", "()", ";", "this", ".", "sharedObjects", ".", "put", "(", "(", "Class", "<", "Object", ">", ")", "sharedType", ",", "object", ")", ";", "public", "Map", "<", "Class", "<", "Object", ">", ",", "Object", ">", "getSharedObjects", "(", ")", "{", "return", "(", "P", ")", "this", ".", "objectPostProcessor", ".", "postProcess", "(", "object", ")", ";", "private", "final", "RequestMatcherConfigurer", "requestMatcherConfigurer", "=", "new", "RequestMatcherConfigurer", "(", ");", "Map", "<", "Class", "<", "Object", ">", ",", "Object", ">", "sharedObjects", ")", "{", "for", "(", "Map", ".", "Entry", "<", "Class", "<", "Object", ">", ",", "Object", ">", "entry", ":", "sharedObjects", ".", "entrySet", "(", "))", "{", "setSharedObject", "(", "entry", ".", "getKey", "(", "),", "entry", ".", "getValue", "(", "))", ";", "return", "getOrApply", "(", "new", "ExpressionUrlAuthorizationConfigurer", "<", "HttpSecurity", ">", "()", ")", "return", "getOrApply", "(", "new", "CsrfConfigurer", "<", "HttpSecurity", ">", "()", ");", "return", "getOrApply", "(", "new", "ChannelSecurityConfigurer", "<", "HttpSecurity", ">", "()", ").", "getRegistry", "(", ");", "private", "RequestMatcherConfigurer", "(", ")", "{", "}", "private", "final", "IgnoredRequestConfigurer", "ignoredRequestRegistry", "=", "new", "IgnoredRequestConfigurer", "(", ");", "private", "IgnoredRequestConfigurer", "(", ")", "{", "}", "defaultWebSecurityExpressionHandler", ".", "setApplicationContext", "(", "applicationContext", ")", ";", "private", "final", "ChannelRequestMatcherRegistry", "REGISTRY", "=", "new", "ChannelRequestMatcherRegistry", "(", ");", "public", "ChannelSecurityConfigurer", "(", ")", "{", "private", "ChannelRequestMatcherRegistry", "(", ")", "{", "}", "public", "CsrfConfigurer", "(", ")", "{", "return", "new", "IgnoreCsrfProtectionRegistry", "(", ").", "antMatchers", "(", "antPatterns", ")", ".", "and", "(", ");", "private", "final", "ExpressionInterceptUrlRegistry", "REGISTRY", "=", "new", "ExpressionInterceptUrlRegistry", "(", ");", "public", "ExpressionUrlAuthorizationConfigurer", "(", ")", "{", "private", "final", "StandardInterceptUrlRegistry", "REGISTRY", "=", "new", "StandardInterceptUrlRegistry", "(", ");", "builder", ".", "addConstructorArgValue", "(", "matcherType", ".", "createMatcher", "(", "path", ",", "null", ")", ");", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "path", ",", "null", ")", ";", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "path", ",", "method", ")", ";", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "\"/", "**", "\",", "null", ")", ";", "BeanDefinition", "matcher", "=", "matcherType", ".", "createMatcher", "(", "path", ",", "method", ")", ";", "filterChainMatcher", "=", "MatcherType", ".", "fromElement", "(", "element", ")", ".", "createMatcher", "(", "RegexRequestMatcher", ".", "class", ")", ";", "private", "final", "Class", "<", "?", "extends", "RequestMatcher", ">", "type", ";", "public", "BeanDefinition", "createMatcher", "(", "String", "path", ",", "String", "method", ")", "{", "matcherBldr", ".", "addConstructorArgValue", "(", "method", ")", ";", "#", "#", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "attribute", "request", "-", "matcher", "{", "\"", "ant", "\"", "|", "\"", "regex", "\"", "|", "\"", "ciRegex", "\"", "}", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", "<", "xs", ":", "documentation", ">", "Defines", "the", "strategy", "use", "for", "matching", "incoming", "requests", ".", "Currently", "the", "options", "are", "'", "ant", "'", "(", "for", "ant", "path", "patterns", ")", ",", "'", "regex", "'", "for", "regular", "expressions", "and", "'", "ciRegex", "'", "for", "case", "-", "insensitive", "regular", "expressions", ".", ".", "apply", "(", "new", "UrlAuthorizationConfigurer", "<", "HttpSecurity", ">", "()", ").", "getRegistry", "(", ")", "Defines", "the", "`", "RequestMatcher", "`", "strategy", "used", "in", "the", "`", "FilterChainProxy", "`", "and", "the", "beans", "created", "by", "the", "`", "intercept", "-", "url", "`", "to", "match", "incoming", "requests", ".", "Options", "are", "currently", "`", "ant", "`", ",", "`", "regex", "`", "and", "`", "ciRegex", "`", ",", "for", "ant", ",", "regular", "-", "expression", "and", "case", "-", "insensitive", "regular", "-", "expression", "repsectively", ".", "A", "separate", "instance", "is", "created", "for", "each", "<", "<", "nsa", "-", "intercept", "-", "url", ",", "intercept", "-", "url", ">", ">", "element", "using", "its", "<", "<", "nsa", "-", "intercept", "-", "url", "-", "pattern", ",", "pattern", ">", ">", "and", "<", "<", "nsa", "-", "intercept", "-", "url", "-", "method", ",", "method", ">", ">", "attributes", ".", "Ant", "paths", "are", "matched", "using", "an", "`", "AntPathRequestMatcher", "`", "and", "regular", "expressions", "are", "matched", "using", "a", "`", "RegexRequestMatcher", "`", ".", "See", "the", "Javadoc", "for", "these", "classes", "for", "more", "details", "on", "exactly", "how", "the", "matching", "is", "preformed", ".", "Ant", "paths", "are", "the", "default", "strategy", "."], "docstring_tokens": ["the", "difference", "in", "the", "strictness", "of", "the", "pattern", "matching", "mechanisms"]}
{"contents": ["Fix", "bug", "#68819", "(Fileinfo", "on", "specific", "file", "causes", "spurious", "OOM", "and/or", "segfault)"], "code_tokens": ["-", "Fileinfo", ":", ".", "Fixed", "bug", "#", "68819", "(", "Fileinfo", "on", "specific", "file", "causes", "spurious", "OOM", "and", "/", "or", "segfault", ")", ".", "(", "Anatol", "Belski", ")", ")", "if", "(", "offset", ">", "bytecnt", ")", "{", "offset", "=", "bytecnt", ";", "}", "-", "-", "TEST", "-", "-", "Bug", "#", "68819", "Fileinfo", "on", "specific", "file", "causes", "spurious", "OOM", "and", "/", "or", "segfault", ",", "var", "1", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "dirname", "(", "__FILE__", ")", ".", "'", "/", "skipif", ".", "inc", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "string", "=", "<", "<<", "HERE", "-", "--", "-", "a", "-", "--", "--", "''", "'-", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "a", "-", "--", "--", "as", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "-", "as", "-", "--", "--", "s", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "a", "-", "--", "a", "-", "-", "s", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "asy", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "-", "s", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "-", "s", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "-", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "-\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "''", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "s", "-", "--", "--", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "a", "-", "--", "--", "as", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "-", "s", "-", "--", "-", "s", "-", "--", "--", "--", "--", "y", "-", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "s", "-", "--", "a", "-", "--", "--", "--", "''", "--", "--", "a", "-", "--", "s", "-", "-", "a", "-", "''", "--", "--", "--", "''", "--", "--", "s", "-", "--", "--", "--", "--", "--", "-", "a", "-", "y", "-", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "-", "a", "-", "--", "--", "y", "-", "-", "a", "-", "s", "-", "-", "a", "-", "s", "-", "--", "--", "-", "s", "-", "-", "a", "-", "s", "-", "--", "--", "--", "--", "-'", "'-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "s", "-", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "a", "-", "s", "-", "--", "a", "-", "s", "-", "--", "--", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "s", "-", "-", "a", "-", "y", "-", "--", "--", "--", "--", "--", "--", "as", "-", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "-", "a", "-", "--", "s", "-", "-", "a", "-", "s", "-", "--", "--", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "-", "y", "-", "-", "as", "-", "-", "a", "-", "--", "-", "a", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "a", "-", "a", "-", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "-", "a", "-", "--", "s", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "a", "-", "--", "--", "as", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "-", "s", "-", "--", "-", "s", "-", "--", "--", "--", "--", "y", "-", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "s", "-", "--", "a", "-", "--", "--", "--", "''", "--", "--", "a", "-", "--", "s", "-", "-", "a", "-", "''", "--", "--", "--", "''", "--", "--", "s", "-", "--", "--", "--", "--", "--", "-", "a", "-", "y", "-", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "-", "a", "-", "--", "--", "y", "-", "-", "a", "-", "s", "-", "-", "a", "-", "s", "-", "--", "--", "-", "s", "-", "-", "a", "-", "s", "-", "--", "--", "--", "--", "-'", "'-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "s", "-", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "a", "-", "s", "-", "--", "a", "-", "s", "-", "--", "--", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "s", "-", "-", "a", "-", "y", "-", "--", "--", "--", "--", "--", "--", "as", "-", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "-", "a", "-", "--", "s", "-", "-", "a", "-", "s", "-", "--", "--", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "-", "y", "-", "-", "as", "-", "-", "a", "-", "--", "-", "a", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "--", "--", "--", "a", "-", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "as", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "-", "a", "-", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "s", "-", "-", "a", "-", "--", "--", "''", "'-", "--", "--", "--", "--", "-", "a", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "s", "-", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "a", "-", "--", "a", "-", "-", "s", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "asy", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-\\", "r", "\\", "n", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "-", "y", "-", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "y", "-", "--", "--", "--", "--", "a", "-", "--", "--", "''", "'-", "--", "--", "--", "y", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "a", "-", "--", "a", "-", "--", "--", "--", "--", "-", "as", "-", "a", "-", "--", "a", "-", "-", "s", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "asy", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-\\", "r", "\\", "n", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "-", "y", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "y", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "''", "'-", "--", "--", "--", "y", "-", "--", "--", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "--", "a", "-", "--", "a", "-", "--", "--", "--", "--", "-", "as", "-", "a", "-", "--", "a", "-", "-", "s", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "asy", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "a", "-", "-", "a", "-", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "''", "'-", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "s", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "a", "-", "-", "s", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "-", "a", "-", "--", "-", "s", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "s", "-", "s", "-", "--", "--", "--", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-\\", "r", "\\", "n", "-", "--", "--", "-", "aa", "-", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "--", "--", "-", "s", "-", "a", "-", "-", "s", "-", "--", "--", "--", "--", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "s", "-", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "-", "a", "-", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "s", "-", "-", "a", "-", "--", "-", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "n", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "a", "-", "--", "a", "-", "--", "--", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "-", "a", "-", "--", "a", "-", "--", "--", "-", "as", "-", "--", "s", "-", "a", "-", "--", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "a", "-", "--", "--", "-", "a", "-", "y", "-", "-", "a", "-", "--", "--", "--", "a", "-", "--", "--", "a", "-", "-", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "--", "a", "-", "--", "--", "--", "-", "a", "-", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "a", "-", "--", "--", "a", "-", "--", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "-", "a", "-", "--", "--", "--", "--", "-", "s", "-", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "r", "\\", "nsay", "-", "--", "--", "--", "a", "-", "--", "--", "--", "--", "--", "-", "s", "-", "--", "--", "''", "--", "--", "--", "a", "-", "--", "-", "s", "-", "--", "--", "--", "-", "a", "-", "--", "--", "--", "--", "--", "--", "a", "-", "\\", "r", "\\", "n", "HERE", ";", "$", "finfo", "=", "new", "finfo", "(", ");", "$", "type", "=", "$", "finfo", "-", ">", "buffer", "(", "$", "string", ")", ";", "var_dump", "(", "$", "type", ")", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "string", "(", "60", ")", "\"", "ASCII", "text", ",", "with", "very", "long", "lines", ",", "with", "CRLF", "line", "terminators", "\"", "@", "@", "-", "0", ",", "0", "+", "1", ",", "26", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "68819", "Fileinfo", "on", "specific", "file", "causes", "spurious", "OOM", "and", "/", "or", "segfault", ",", "var", "2", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "dirname", "(", "__FILE__", ")", ".", "'", "/", "skipif", ".", "inc", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "string", "=", "'", "';", "/", "/", "These", "two", "in", "any", "order", "$", "string", ".", "=", "\"", "\\", "r", "\\", "n", "\"", ";", "$", "string", ".", "=", "\"", "''", "''", "\";", "/", "/", "Total", "string", "length", ">", "8192", "$", "string", ".", "=", "str_repeat", "(", "chr", "(", "rand", "(", "32", ",", "127", ")", "),", "8184", ")", ";", "/", "/", "Ending", "in", "this", "string", "$", "string", ".", "=", "\"", "say", "\"", ";", "$", "finfo", "=", "new", "finfo", "(", ");", "$", "type", "=", "$", "finfo", "-", ">", "buffer", "(", "$", "string", ")", ";", "var_dump", "(", "$", "type", ")", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "string", "(", "60", ")", "\"", "ASCII", "text", ",", "with", "very", "long", "lines", ",", "with", "CRLF", "line", "terminators", "\"</s>-", "SOAP", ":"], "docstring_tokens": ["does", "not", "properly", "maintain", "a", "certain", "pointer", "relationship"]}
{"contents": ["lz4:", "ensure", "length", "does", "not", "wrap", "Given", "some", "pathologically", "compressed", "data,", "lz4", "could", "possibly", "decide", "to", "wrap", "a", "few", "internal", "variables,", "causing", "unknown", "things", "to", "happen.", "Catch", "this", "before", "the", "wrapping", "happens", "and", "abort", "the", "decompression.", "Reported-by:", "\"Don", "A.", "Bailey\"", "<donb@securitymouse.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["if", "(", "unlikely", "(", "length", ">", "(", "size_t", ")", "(", "length", "+", "len", ")", "))", "goto", "_output_error", ";</s>"], "docstring_tokens": ["an", "attacker", "can", "specify", "any", "desired", "offset", "to", "a", "write", "pointer"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/120"], "code_tokens": ["ldblk", "+", "1", ",", "sizeof", "(", "*", "BImgBuff", ")", ");</s>ldblk", ",", "sizeof", "(", "*", "BImgBuff", ")", ");"], "docstring_tokens": ["not", "releasing", "memory"]}
{"contents": ["x86/mm/32:", "Enable", "full", "randomization", "on", "i386", "and", "X86_32", "Currently", "on", "i386", "and", "on", "X86_64", "when", "emulating", "X86_32", "in", "legacy", "mode,", "only", "the", "stack", "and", "the", "executable", "are", "randomized", "but", "not", "other", "mmapped", "files", "(libraries,", "vDSO,", "etc.).", "This", "patch", "enables", "randomization", "for", "the", "libraries,", "vDSO", "and", "mmap", "requests", "on", "i386", "and", "in", "X86_32", "in", "legacy", "mode.", "By", "default", "on", "i386", "there", "are", "8", "bits", "for", "the", "randomization", "of", "the", "libraries,", "vDSO", "and", "mmaps", "which", "only", "uses", "1MB", "of", "VA.", "This", "patch", "preserves", "the", "original", "randomness,", "using", "1MB", "of", "VA", "out", "of", "3GB", "or", "4GB.", "We", "think", "that", "1MB", "out", "of", "3GB", "is", "not", "a", "big", "cost", "for", "having", "the", "ASLR.", "The", "first", "obvious", "security", "benefit", "is", "that", "all", "objects", "are", "randomized", "(not", "only", "the", "stack", "and", "the", "executable)", "in", "legacy", "mode", "which", "highly", "increases", "the", "ASLR", "effectiveness,", "otherwise", "the", "attackers", "may", "use", "these", "non-randomized", "areas.", "But", "also", "sensitive", "setuid/setgid", "applications", "are", "more", "secure", "because", "currently,", "attackers", "can", "disable", "the", "randomization", "of", "these", "applications", "by", "setting", "the", "ulimit", "stack", "to", "\"unlimited\".", "This", "is", "a", "very", "old", "and", "widely", "known", "trick", "to", "disable", "the", "ASLR", "in", "i386", "which", "has", "been", "allowed", "for", "too", "long.", "Another", "trick", "used", "to", "disable", "the", "ASLR", "was", "to", "set", "the", "ADDR_NO_RANDOMIZE", "personality", "flag,", "but", "fortunately", "this", "doesn't", "work", "on", "setuid/setgid", "applications", "because", "there", "is", "security", "checks", "which", "clear", "Security-relevant", "flags.", "This", "patch", "always", "randomizes", "the", "mmap_legacy_base", "address,", "removing", "the", "possibility", "to", "disable", "the", "ASLR", "by", "setting", "the", "stack", "to", "\"unlimited\".", "Signed-off-by:", "Hector", "Marco-Gisbert", "<hecmargi@upv.es>", "Acked-by:", "Ismael", "Ripoll", "Ripoll", "<iripoll@upv.es>", "Acked-by:", "Kees", "Cook", "<keescook@chromium.org>", "Acked-by:", "Arjan", "van", "de", "Ven", "<arjan@linux.intel.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "akpm@linux-foundation.org", "Cc:", "kees", "Cook", "<keescook@chromium.org>", "Link:", "http://lkml.kernel.org/r/1457639460-5242-1-git-send-email-hecmargi@upv.es", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["mm", "-", ">", "mmap_legacy_base", "=", "TASK_UNMAPPED_BASE", "+", "random_factor", ";</s>/", "*", "*", "Bottom", "-", "up", "(", "legacy", ")", "layout", "on", "X86_32", "did", "not", "support", "randomization", ",", "X86_64", "*", "does", ",", "but", "not", "when", "emulating", "X86_32", "*", "/", "static", "unsigned", "long", "mmap_legacy_base", "(", "unsigned", "long", "rnd", ")", "{", "if", "(", "mmap_is_ia32", "(", "))", "return", "TASK_UNMAPPED_BASE", ";", "else", "return", "TASK_UNMAPPED_BASE", "+", "rnd", ";", "}", "mm", "-", ">", "mmap_legacy_base", "=", "mmap_legacy_base", "(", "random_factor", ")", ";"], "docstring_tokens": ["running", "32-bit", "applications", "in", "a", "x86", "machine", "disable", "the", "ASLR", "by", "setting", "the", "RLIMIT_STACK", "resource", "to", "unlimited"]}
{"contents": ["CAMEL-10894", "Fixed", "test", "failure"], "code_tokens": ["if", "(", "camelContext", "!", "=", "null", "&", "&", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{</s>if", "(", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{"], "docstring_tokens": ["improper", "handling", "of", "XML", "external", "entity", "(XXE", ")", "declarations"]}
{"contents": ["fs/partitions/efi.c:", "corrupted", "GUID", "partition", "tables", "can", "cause", "kernel", "oops", "The", "kernel", "automatically", "evaluates", "partition", "tables", "of", "storage", "devices.", "The", "code", "for", "evaluating", "GUID", "partitions", "(in", "fs/partitions/efi.c)", "contains", "a", "bug", "that", "causes", "a", "kernel", "oops", "on", "certain", "corrupted", "GUID", "partition", "tables.", "This", "bug", "has", "security", "impacts,", "because", "it", "allows,", "for", "example,", "to", "prepare", "a", "storage", "device", "that", "crashes", "a", "kernel", "subsystem", "upon", "connecting", "the", "device", "(e.g.,", "a", "\"USB", "Stick", "of", "(Partial)", "Death\").", "crc", "=", "efi_crc32((const", "unsigned", "char", "*)", "(*gpt),", "le32_to_cpu((*gpt)->header_size));", "computes", "a", "CRC32", "checksum", "over", "gpt", "covering", "(*gpt)->header_size", "bytes.", "There", "is", "no", "validation", "of", "(*gpt)->header_size", "before", "the", "efi_crc32", "call.", "A", "corrupted", "partition", "table", "may", "have", "large", "values", "for", "(*gpt)->header_size.", "In", "this", "case,", "the", "CRC32", "computation", "access", "memory", "beyond", "the", "memory", "allocated", "for", "gpt,", "which", "may", "cause", "a", "kernel", "heap", "overflow.", "Validate", "value", "of", "GUID", "partition", "table", "header", "size.", "[akpm@linux-foundation.org:", "fix", "layout", "and", "indenting]", "Signed-off-by:", "Timo", "Warns", "<warns@pre-sense.de>", "Cc:", "Matt", "Domsch", "<Matt_Domsch@dell.com>", "Cc:", "Eugene", "Teo", "<eugeneteo@kernel.sg>", "Cc:", "Dave", "Jones", "<davej@codemonkey.org.uk>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["/", "*", "Check", "the", "GUID", "Partition", "Table", "header", "size", "*", "/", "if", "(", "le32_to_cpu", "(", "(*", "gpt", ")", "->", "header_size", ")", ">", "bdev_logical_block_size", "(", "state", "-", ">", "bdev", ")", ")", "{", "pr_debug", "(", "\"", "GUID", "Partition", "Table", "Header", "size", "is", "wrong", ":", "%", "u", ">", "%", "u", "\\", "n", "\"", ",", "le32_to_cpu", "(", "(*", "gpt", ")", "->", "header_size", ")", ",", "bdev_logical_block_size", "(", "state", "-", ">", "bdev", ")", ");", "goto", "fail", ";", "}</s>"], "docstring_tokens": ["missing", "input", "validation", "on", "GUID", "partition", "tables"]}
{"contents": ["media:", "fix", "airspy", "usb", "probe", "error", "path", "Fix", "a", "memory", "leak", "on", "probe", "error", "of", "the", "airspy", "usb", "device", "driver.", "The", "problem", "is", "triggered", "when", "more", "than", "64", "usb", "devices", "register", "with", "v4l2", "of", "type", "VFL_TYPE_SDR", "or", "VFL_TYPE_SUBDEV.", "The", "memory", "leak", "is", "caused", "by", "the", "probe", "function", "of", "the", "airspy", "driver", "mishandeling", "errors", "and", "not", "freeing", "the", "corresponding", "control", "structures", "when", "an", "error", "occours", "registering", "the", "device", "to", "v4l2", "core.", "A", "badusb", "device", "can", "emulate", "64", "of", "these", "devices,", "and", "then", "through", "continual", "emulated", "connect/disconnect", "of", "the", "65th", "device,", "cause", "the", "kernel", "to", "run", "out", "of", "RAM", "and", "crash", "the", "kernel,", "thus", "causing", "a", "local", "DOS", "vulnerability.", "Fixes", "Signed-off-by:", "James", "Patrick-Evans", "<james@jmp-e.com>", "Reviewed-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@vger.kernel.org", "#", "3.17+", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["goto", "err_free_controls", ";</s>goto", "err_unregister_v4l2_dev", ";", "err_unregister_v4l2_dev", ":"], "docstring_tokens": ["no", "control", "over", "maintainers"]}
{"contents": ["KEYS:", "fix", "dereferencing", "NULL", "payload", "with", "nonzero", "length", "sys_add_key()", "and", "the", "KEYCTL_UPDATE", "operation", "of", "sys_keyctl()", "allowed", "a", "NULL", "payload", "with", "nonzero", "length", "to", "be", "passed", "to", "the", "key", "type's", "->preparse(),", "->instantiate(),", "and/or", "->update()", "methods.", "Various", "key", "types", "including", "asymmetric,", "cifs.idmap,", "cifs.spnego,", "and", "pkcs7_test", "did", "not", "handle", "this", "case,", "allowing", "an", "unprivileged", "user", "to", "trivially", "cause", "a", "NULL", "pointer", "dereference", "(kernel", "oops)", "if", "one", "of", "these", "key", "types", "was", "present.", "Fix", "it", "by", "doing", "the", "copy_from_user()", "when", "'plen'", "is", "nonzero", "rather", "than", "when", "'_payload'", "is", "non-NULL,", "causing", "the", "syscall", "to", "fail", "with", "EFAULT", "as", "expected", "when", "an", "invalid", "buffer", "is", "specified.", "Cc:", "stable@vger.kernel.org", "#", "2.6.10+", "Signed-off-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Signed-off-by:", "James", "Morris", "<james.l.morris@oracle.com>"], "code_tokens": ["if", "(", "plen", ")", "{", "if", "(", "plen", ")", "{</s>if", "(", "_payload", ")", "{", "if", "(", "_payload", ")", "{"], "docstring_tokens": ["does", "not", "consider", "the", "case", "of", "a", "NULL", "payload", "in", "conjunction", "with", "a", "nonzero", "length", "value"]}
{"contents": ["KEYS:", "potential", "uninitialized", "variable", "If", "__key_link_begin()", "failed", "then", "\"edit\"", "would", "be", "uninitialized.", "I've", "added", "a", "check", "to", "fix", "that.", "This", "allows", "a", "random", "user", "to", "crash", "the", "kernel,", "though", "it's", "quite", "difficult", "to", "achieve.", "There", "are", "three", "ways", "it", "can", "be", "done", "as", "the", "user", "would", "have", "to", "cause", "an", "error", "to", "occur", "in", "__key_link():", "(1)", "Cause", "the", "kernel", "to", "run", "out", "of", "memory.", "In", "practice,", "this", "is", "difficult", "to", "achieve", "without", "ENOMEM", "cropping", "up", "elsewhere", "and", "aborting", "the", "attempt.", "(2)", "Revoke", "the", "destination", "keyring", "between", "the", "keyring", "ID", "being", "looked", "up", "and", "it", "being", "tested", "for", "revocation.", "In", "practice,", "this", "is", "difficult", "to", "time", "correctly", "because", "the", "KEYCTL_REJECT", "function", "can", "only", "be", "used", "from", "the", "request-key", "upcall", "process.", "Further,", "users", "can", "only", "make", "use", "of", "what's", "in", "/sbin/request-key.conf,", "though", "this", "does", "including", "a", "rejection", "debugging", "test", "-", "which", "means", "that", "the", "destination", "keyring", "has", "to", "be", "the", "caller's", "session", "keyring", "in", "practice.", "(3)", "Have", "just", "enough", "key", "quota", "available", "to", "create", "a", "key,", "a", "new", "session", "keyring", "for", "the", "upcall", "and", "a", "link", "in", "the", "session", "keyring,", "but", "not", "then", "sufficient", "quota", "to", "create", "a", "link", "in", "the", "nominated", "destination", "keyring", "so", "that", "it", "fails", "with", "EDQUOT.", "The", "bug", "can", "be", "triggered", "using", "option", "(3)", "above", "using", "something", "like", "the", "following:", "echo", "80", ">/proc/sys/kernel/keys/root_maxbytes", "keyctl", "request2", "user", "debug:fred", "negate", "@t", "The", "above", "sets", "the", "quota", "to", "something", "much", "lower", "(80)", "to", "make", "the", "bug", "easier", "to", "trigger,", "but", "this", "is", "dependent", "on", "the", "system.", "Note", "also", "that", "the", "name", "of", "the", "keyring", "created", "contains", "a", "random", "number", "that", "may", "be", "between", "1", "and", "10", "characters", "in", "size,", "so", "may", "throw", "the", "test", "off", "by", "changing", "the", "amount", "of", "quota", "used.", "Assuming", "the", "failure", "occurs,", "something", "like", "the", "following", "will", "be", "seen:", "kfree_debugcheck:", "out", "of", "range", "ptr", "6b6b6b6b6b6b6b68h", "------------[", "cut", "here", "]------------", "kernel", "BUG", "at", "../mm/slab.c:2821!", "...", "RIP:", "0010:[<ffffffff811600f9>]", "kfree_debugcheck+0x20/0x25", "RSP:", "0018:ffff8804014a7de8", "EFLAGS:", "00010092", "RAX:", "0000000000000034", "RBX:", "6b6b6b6b6b6b6b68", "RCX:", "0000000000000000", "RDX:", "0000000000040001", "RSI:", "00000000000000f6", "RDI:", "0000000000000300", "RBP:", "ffff8804014a7df0", "R08:", "0000000000000001", "R09:", "0000000000000000", "R10:", "ffff8804014a7e68", "R11:", "0000000000000054", "R12:", "0000000000000202", "R13:", "ffffffff81318a66", "R14:", "0000000000000000", "R15:", "0000000000000001", "...", "Call", "Trace:", "kfree+0xde/0x1bc", "assoc_array_cancel_edit+0x1f/0x36", "__key_link_end+0x55/0x63", "key_reject_and_link+0x124/0x155", "keyctl_reject_key+0xb6/0xe0", "keyctl_negate_key+0x10/0x12", "SyS_keyctl+0x9f/0xe7", "do_syscall_64+0x63/0x13a", "entry_SYSCALL64_slow_path+0x25/0x25", "Fixes:", "f70e2e06196a", "('KEYS:", "Do", "preallocation", "for", "__key_link()')", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "cc:", "stable@vger.kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "keyring", "&", "&", "link_ret", "=", "=", "0", ")</s>if", "(", "keyring", ")"], "docstring_tokens": ["the", "improper", "handling", "of", "key", "lookups", "in", "the", "keychain", "subsystem"]}
